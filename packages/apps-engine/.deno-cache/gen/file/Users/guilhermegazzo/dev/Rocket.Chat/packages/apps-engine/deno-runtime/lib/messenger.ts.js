import { writeAll } from "https://deno.land/std@0.216.0/io/write_all.ts";
import * as jsonrpc from 'jsonrpc-lite';
import { AppObjectRegistry } from '../AppObjectRegistry.ts';
import { encoder } from './codec.ts';
export function isRequest(message) {
  return message.type === 'request' || message.type === 'notification';
}
export function isResponse(message) {
  return message.type === 'success' || message.type === 'error';
}
export function isErrorResponse(message) {
  return message instanceof jsonrpc.ErrorObject;
}
const COMMAND_PONG = '_zPONG';
export const RPCResponseObserver = new EventTarget();
export const Queue = new class Queue {
  queue = [];
  isProcessing = false;
  async processQueue() {
    if (this.isProcessing) {
      return;
    }
    this.isProcessing = true;
    while(this.queue.length){
      const message = this.queue.shift();
      if (message) {
        await Transport.send(message);
      }
    }
    this.isProcessing = false;
  }
  enqueue(message) {
    this.queue.push(encoder.encode(message));
    this.processQueue();
  }
};
export const Transport = new class Transporter {
  selectedTransport;
  constructor(){
    this.selectedTransport = this.stdoutTransport.bind(this);
  }
  async stdoutTransport(message) {
    await writeAll(Deno.stdout, message);
  }
  async noopTransport(_message) {}
  selectTransport(transport) {
    switch(transport){
      case 'stdout':
        this.selectedTransport = this.stdoutTransport.bind(this);
        break;
      case 'noop':
        this.selectedTransport = this.noopTransport.bind(this);
        break;
    }
  }
  send(message) {
    return this.selectedTransport(message);
  }
}();
export function parseMessage(message) {
  let parsed;
  if (typeof message === 'string') {
    parsed = jsonrpc.parse(message);
  } else {
    parsed = jsonrpc.parseObject(message);
  }
  if (Array.isArray(parsed)) {
    throw jsonrpc.error(null, jsonrpc.JsonRpcError.invalidRequest(null));
  }
  if (parsed.type === 'invalid') {
    throw jsonrpc.error(null, parsed.payload);
  }
  return parsed;
}
export async function sendInvalidRequestError() {
  const rpc = jsonrpc.error(null, jsonrpc.JsonRpcError.invalidRequest(null));
  await Queue.enqueue(rpc);
}
export async function sendInvalidParamsError(id) {
  const rpc = jsonrpc.error(id, jsonrpc.JsonRpcError.invalidParams(null));
  await Queue.enqueue(rpc);
}
export async function sendParseError() {
  const rpc = jsonrpc.error(null, jsonrpc.JsonRpcError.parseError(null));
  await Queue.enqueue(rpc);
}
export async function sendMethodNotFound(id) {
  const rpc = jsonrpc.error(id, jsonrpc.JsonRpcError.methodNotFound(null));
  await Queue.enqueue(rpc);
}
export async function errorResponse({ error: { message, code = -32000, data = {} }, id }) {
  const logger = AppObjectRegistry.get('logger');
  if (logger?.hasEntries()) {
    data.logs = logger.getLogs();
  }
  const rpc = jsonrpc.error(id, new jsonrpc.JsonRpcError(message, code, data));
  await Queue.enqueue(rpc);
}
export async function successResponse({ id, result }) {
  const payload = {
    value: result
  };
  const logger = AppObjectRegistry.get('logger');
  if (logger?.hasEntries()) {
    payload.logs = logger.getLogs();
  }
  const rpc = jsonrpc.success(id, payload);
  await Queue.enqueue(rpc);
}
export function pongResponse() {
  return Promise.resolve(Queue.enqueue(COMMAND_PONG));
}
export async function sendRequest(requestDescriptor) {
  const request = jsonrpc.request(Math.random().toString(36).slice(2), requestDescriptor.method, requestDescriptor.params);
  // TODO: add timeout to this
  const responsePromise = new Promise((resolve, reject)=>{
    const handler = (event)=>{
      if (event instanceof ErrorEvent) {
        reject(event.error);
      }
      if (event instanceof CustomEvent) {
        resolve(event.detail);
      }
      RPCResponseObserver.removeEventListener(`response:${request.id}`, handler);
    };
    RPCResponseObserver.addEventListener(`response:${request.id}`, handler);
  });
  await Queue.enqueue(request);
  return responsePromise;
}
export function sendNotification({ method, params }) {
  const request = jsonrpc.notification(method, params);
  Queue.enqueue(request);
}
export function log(params) {
  sendNotification({
    method: 'log',
    params
  });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vVXNlcnMvZ3VpbGhlcm1lZ2F6em8vZGV2L1JvY2tldC5DaGF0L3BhY2thZ2VzL2FwcHMtZW5naW5lL2Rlbm8tcnVudGltZS9saWIvbWVzc2VuZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHdyaXRlQWxsIH0gZnJvbSBcImh0dHBzOi8vZGVuby5sYW5kL3N0ZEAwLjIxNi4wL2lvL3dyaXRlX2FsbC50c1wiO1xuXG5pbXBvcnQgKiBhcyBqc29ucnBjIGZyb20gJ2pzb25ycGMtbGl0ZSc7XG5cbmltcG9ydCB7IEFwcE9iamVjdFJlZ2lzdHJ5IH0gZnJvbSAnLi4vQXBwT2JqZWN0UmVnaXN0cnkudHMnO1xuaW1wb3J0IHR5cGUgeyBMb2dnZXIgfSBmcm9tICcuL2xvZ2dlci50cyc7XG5pbXBvcnQgeyBlbmNvZGVyIH0gZnJvbSAnLi9jb2RlYy50cyc7XG5cbmV4cG9ydCB0eXBlIFJlcXVlc3REZXNjcmlwdG9yID0gUGljazxqc29ucnBjLlJlcXVlc3RPYmplY3QsICdtZXRob2QnIHwgJ3BhcmFtcyc+O1xuXG5leHBvcnQgdHlwZSBOb3RpZmljYXRpb25EZXNjcmlwdG9yID0gUGljazxqc29ucnBjLk5vdGlmaWNhdGlvbk9iamVjdCwgJ21ldGhvZCcgfCAncGFyYW1zJz47XG5cbmV4cG9ydCB0eXBlIFN1Y2Nlc3NSZXNwb25zZURlc2NyaXB0b3IgPSBQaWNrPGpzb25ycGMuU3VjY2Vzc09iamVjdCwgJ2lkJyB8ICdyZXN1bHQnPjtcblxuZXhwb3J0IHR5cGUgRXJyb3JSZXNwb25zZURlc2NyaXB0b3IgPSBQaWNrPGpzb25ycGMuRXJyb3JPYmplY3QsICdpZCcgfCAnZXJyb3InPjtcblxuZXhwb3J0IHR5cGUgSnNvblJwY1JlcXVlc3QgPSBqc29ucnBjLklQYXJzZWRPYmplY3RSZXF1ZXN0IHwganNvbnJwYy5JUGFyc2VkT2JqZWN0Tm90aWZpY2F0aW9uO1xuZXhwb3J0IHR5cGUgSnNvblJwY1Jlc3BvbnNlID0ganNvbnJwYy5JUGFyc2VkT2JqZWN0U3VjY2VzcyB8IGpzb25ycGMuSVBhcnNlZE9iamVjdEVycm9yO1xuXG5leHBvcnQgZnVuY3Rpb24gaXNSZXF1ZXN0KG1lc3NhZ2U6IGpzb25ycGMuSVBhcnNlZE9iamVjdCk6IG1lc3NhZ2UgaXMgSnNvblJwY1JlcXVlc3Qge1xuICAgIHJldHVybiBtZXNzYWdlLnR5cGUgPT09ICdyZXF1ZXN0JyB8fCBtZXNzYWdlLnR5cGUgPT09ICdub3RpZmljYXRpb24nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNSZXNwb25zZShtZXNzYWdlOiBqc29ucnBjLklQYXJzZWRPYmplY3QpOiBtZXNzYWdlIGlzIEpzb25ScGNSZXNwb25zZSB7XG4gICAgcmV0dXJuIG1lc3NhZ2UudHlwZSA9PT0gJ3N1Y2Nlc3MnIHx8IG1lc3NhZ2UudHlwZSA9PT0gJ2Vycm9yJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzRXJyb3JSZXNwb25zZShtZXNzYWdlOiBqc29ucnBjLkpzb25ScGMpOiBtZXNzYWdlIGlzIGpzb25ycGMuRXJyb3JPYmplY3Qge1xuICAgIHJldHVybiBtZXNzYWdlIGluc3RhbmNlb2YganNvbnJwYy5FcnJvck9iamVjdDtcbn1cblxuY29uc3QgQ09NTUFORF9QT05HID0gJ196UE9ORyc7XG5cbmV4cG9ydCBjb25zdCBSUENSZXNwb25zZU9ic2VydmVyID0gbmV3IEV2ZW50VGFyZ2V0KCk7XG5cbmV4cG9ydCBjb25zdCBRdWV1ZSA9IG5ldyAoY2xhc3MgUXVldWUge1xuICAgIHByaXZhdGUgcXVldWU6IFVpbnQ4QXJyYXlbXSA9IFtdO1xuICAgIHByaXZhdGUgaXNQcm9jZXNzaW5nID0gZmFsc2U7XG5cbiAgICBwcml2YXRlIGFzeW5jIHByb2Nlc3NRdWV1ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNQcm9jZXNzaW5nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmlzUHJvY2Vzc2luZyA9IHRydWU7XG5cbiAgICAgICAgd2hpbGUgKHRoaXMucXVldWUubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gdGhpcy5xdWV1ZS5zaGlmdCgpO1xuXG4gICAgICAgICAgICBpZiAobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IFRyYW5zcG9ydC5zZW5kKG1lc3NhZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pc1Byb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZW5xdWV1ZShtZXNzYWdlOiBqc29ucnBjLkpzb25ScGMgfCB0eXBlb2YgQ09NTUFORF9QT05HKSB7XG4gICAgICAgIHRoaXMucXVldWUucHVzaChlbmNvZGVyLmVuY29kZShtZXNzYWdlKSk7XG4gICAgICAgIHRoaXMucHJvY2Vzc1F1ZXVlKCk7XG4gICAgfVxufSk7XG5cbmV4cG9ydCBjb25zdCBUcmFuc3BvcnQgPSBuZXcgKGNsYXNzIFRyYW5zcG9ydGVyIHtcbiAgICBwcml2YXRlIHNlbGVjdGVkVHJhbnNwb3J0OiBUcmFuc3BvcnRlclsnc3Rkb3V0VHJhbnNwb3J0J10gfCBUcmFuc3BvcnRlclsnbm9vcFRyYW5zcG9ydCddO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRUcmFuc3BvcnQgPSB0aGlzLnN0ZG91dFRyYW5zcG9ydC5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgc3Rkb3V0VHJhbnNwb3J0KG1lc3NhZ2U6IFVpbnQ4QXJyYXkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgd3JpdGVBbGwoRGVuby5zdGRvdXQsIG1lc3NhZ2UpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgbm9vcFRyYW5zcG9ydChfbWVzc2FnZTogVWludDhBcnJheSk6IFByb21pc2U8dm9pZD4ge31cblxuICAgIHB1YmxpYyBzZWxlY3RUcmFuc3BvcnQodHJhbnNwb3J0OiAnc3Rkb3V0JyB8ICdub29wJyk6IHZvaWQge1xuICAgICAgICBzd2l0Y2ggKHRyYW5zcG9ydCkge1xuICAgICAgICAgICAgY2FzZSAnc3Rkb3V0JzpcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkVHJhbnNwb3J0ID0gdGhpcy5zdGRvdXRUcmFuc3BvcnQuYmluZCh0aGlzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ25vb3AnOlxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRUcmFuc3BvcnQgPSB0aGlzLm5vb3BUcmFuc3BvcnQuYmluZCh0aGlzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzZW5kKG1lc3NhZ2U6IFVpbnQ4QXJyYXkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRUcmFuc3BvcnQobWVzc2FnZSk7XG4gICAgfVxufSkoKTtcblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlTWVzc2FnZShtZXNzYWdlOiBzdHJpbmcgfCBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikge1xuICAgIGxldCBwYXJzZWQ6IGpzb25ycGMuSVBhcnNlZE9iamVjdCB8IGpzb25ycGMuSVBhcnNlZE9iamVjdFtdO1xuXG4gICAgaWYgKHR5cGVvZiBtZXNzYWdlID09PSAnc3RyaW5nJykge1xuICAgICAgICBwYXJzZWQgPSBqc29ucnBjLnBhcnNlKG1lc3NhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHBhcnNlZCA9IGpzb25ycGMucGFyc2VPYmplY3QobWVzc2FnZSk7XG4gICAgfVxuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkocGFyc2VkKSkge1xuICAgICAgICB0aHJvdyBqc29ucnBjLmVycm9yKG51bGwsIGpzb25ycGMuSnNvblJwY0Vycm9yLmludmFsaWRSZXF1ZXN0KG51bGwpKTtcbiAgICB9XG5cbiAgICBpZiAocGFyc2VkLnR5cGUgPT09ICdpbnZhbGlkJykge1xuICAgICAgICB0aHJvdyBqc29ucnBjLmVycm9yKG51bGwsIHBhcnNlZC5wYXlsb2FkKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcGFyc2VkO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZEludmFsaWRSZXF1ZXN0RXJyb3IoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcnBjID0ganNvbnJwYy5lcnJvcihudWxsLCBqc29ucnBjLkpzb25ScGNFcnJvci5pbnZhbGlkUmVxdWVzdChudWxsKSk7XG5cbiAgICBhd2FpdCBRdWV1ZS5lbnF1ZXVlKHJwYyk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kSW52YWxpZFBhcmFtc0Vycm9yKGlkOiBqc29ucnBjLklEKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcnBjID0ganNvbnJwYy5lcnJvcihpZCwganNvbnJwYy5Kc29uUnBjRXJyb3IuaW52YWxpZFBhcmFtcyhudWxsKSk7XG5cbiAgICBhd2FpdCBRdWV1ZS5lbnF1ZXVlKHJwYyk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kUGFyc2VFcnJvcigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBycGMgPSBqc29ucnBjLmVycm9yKG51bGwsIGpzb25ycGMuSnNvblJwY0Vycm9yLnBhcnNlRXJyb3IobnVsbCkpO1xuXG4gICAgYXdhaXQgUXVldWUuZW5xdWV1ZShycGMpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1ldGhvZE5vdEZvdW5kKGlkOiBqc29ucnBjLklEKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcnBjID0ganNvbnJwYy5lcnJvcihpZCwganNvbnJwYy5Kc29uUnBjRXJyb3IubWV0aG9kTm90Rm91bmQobnVsbCkpO1xuXG4gICAgYXdhaXQgUXVldWUuZW5xdWV1ZShycGMpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXJyb3JSZXNwb25zZSh7IGVycm9yOiB7IG1lc3NhZ2UsIGNvZGUgPSAtMzIwMDAsIGRhdGEgPSB7fSB9LCBpZCB9OiBFcnJvclJlc3BvbnNlRGVzY3JpcHRvcik6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGxvZ2dlciA9IEFwcE9iamVjdFJlZ2lzdHJ5LmdldDxMb2dnZXI+KCdsb2dnZXInKTtcblxuICAgIGlmIChsb2dnZXI/Lmhhc0VudHJpZXMoKSkge1xuICAgICAgICBkYXRhLmxvZ3MgPSBsb2dnZXIuZ2V0TG9ncygpO1xuICAgIH1cblxuICAgIGNvbnN0IHJwYyA9IGpzb25ycGMuZXJyb3IoaWQsIG5ldyBqc29ucnBjLkpzb25ScGNFcnJvcihtZXNzYWdlLCBjb2RlLCBkYXRhKSk7XG5cbiAgICBhd2FpdCBRdWV1ZS5lbnF1ZXVlKHJwYyk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdWNjZXNzUmVzcG9uc2UoeyBpZCwgcmVzdWx0IH06IFN1Y2Nlc3NSZXNwb25zZURlc2NyaXB0b3IpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBwYXlsb2FkID0geyB2YWx1ZTogcmVzdWx0IH0gYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gICAgY29uc3QgbG9nZ2VyID0gQXBwT2JqZWN0UmVnaXN0cnkuZ2V0PExvZ2dlcj4oJ2xvZ2dlcicpO1xuXG4gICAgaWYgKGxvZ2dlcj8uaGFzRW50cmllcygpKSB7XG4gICAgICAgIHBheWxvYWQubG9ncyA9IGxvZ2dlci5nZXRMb2dzKCk7XG4gICAgfVxuXG4gICAgY29uc3QgcnBjID0ganNvbnJwYy5zdWNjZXNzKGlkLCBwYXlsb2FkKTtcblxuICAgIGF3YWl0IFF1ZXVlLmVucXVldWUocnBjKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBvbmdSZXNwb25zZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFF1ZXVlLmVucXVldWUoQ09NTUFORF9QT05HKSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kUmVxdWVzdChyZXF1ZXN0RGVzY3JpcHRvcjogUmVxdWVzdERlc2NyaXB0b3IpOiBQcm9taXNlPGpzb25ycGMuU3VjY2Vzc09iamVjdD4ge1xuICAgIGNvbnN0IHJlcXVlc3QgPSBqc29ucnBjLnJlcXVlc3QoTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiksIHJlcXVlc3REZXNjcmlwdG9yLm1ldGhvZCwgcmVxdWVzdERlc2NyaXB0b3IucGFyYW1zKTtcblxuICAgIC8vIFRPRE86IGFkZCB0aW1lb3V0IHRvIHRoaXNcbiAgICBjb25zdCByZXNwb25zZVByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IGhhbmRsZXIgPSAoZXZlbnQ6IEV2ZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAoZXZlbnQgaW5zdGFuY2VvZiBFcnJvckV2ZW50KSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGV2ZW50LmVycm9yKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGV2ZW50IGluc3RhbmNlb2YgQ3VzdG9tRXZlbnQpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKGV2ZW50LmRldGFpbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIFJQQ1Jlc3BvbnNlT2JzZXJ2ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihgcmVzcG9uc2U6JHtyZXF1ZXN0LmlkfWAsIGhhbmRsZXIpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFJQQ1Jlc3BvbnNlT2JzZXJ2ZXIuYWRkRXZlbnRMaXN0ZW5lcihgcmVzcG9uc2U6JHtyZXF1ZXN0LmlkfWAsIGhhbmRsZXIpO1xuICAgIH0pO1xuXG4gICAgYXdhaXQgUXVldWUuZW5xdWV1ZShyZXF1ZXN0KTtcblxuICAgIHJldHVybiByZXNwb25zZVByb21pc2UgYXMgUHJvbWlzZTxqc29ucnBjLlN1Y2Nlc3NPYmplY3Q+O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2VuZE5vdGlmaWNhdGlvbih7IG1ldGhvZCwgcGFyYW1zIH06IE5vdGlmaWNhdGlvbkRlc2NyaXB0b3IpIHtcbiAgICBjb25zdCByZXF1ZXN0ID0ganNvbnJwYy5ub3RpZmljYXRpb24obWV0aG9kLCBwYXJhbXMpO1xuXG4gICAgUXVldWUuZW5xdWV1ZShyZXF1ZXN0KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvZyhwYXJhbXM6IGpzb25ycGMuUnBjUGFyYW1zKSB7XG4gICAgc2VuZE5vdGlmaWNhdGlvbih7IG1ldGhvZDogJ2xvZycsIHBhcmFtcyB9KTtcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxTQUFTLFFBQVEsUUFBUSxnREFBZ0Q7QUFFekUsWUFBWSxhQUFhLGVBQWU7QUFFeEMsU0FBUyxpQkFBaUIsUUFBUSwwQkFBMEI7QUFFNUQsU0FBUyxPQUFPLFFBQVEsYUFBYTtBQWFyQyxPQUFPLFNBQVMsVUFBVSxPQUE4QjtFQUNwRCxPQUFPLFFBQVEsSUFBSSxLQUFLLGFBQWEsUUFBUSxJQUFJLEtBQUs7QUFDMUQ7QUFFQSxPQUFPLFNBQVMsV0FBVyxPQUE4QjtFQUNyRCxPQUFPLFFBQVEsSUFBSSxLQUFLLGFBQWEsUUFBUSxJQUFJLEtBQUs7QUFDMUQ7QUFFQSxPQUFPLFNBQVMsZ0JBQWdCLE9BQXdCO0VBQ3BELE9BQU8sbUJBQW1CLFFBQVEsV0FBVztBQUNqRDtBQUVBLE1BQU0sZUFBZTtBQUVyQixPQUFPLE1BQU0sc0JBQXNCLElBQUksY0FBYztBQUVyRCxPQUFPLE1BQU0sUUFBUSxJQUFLLE1BQU07RUFDcEIsUUFBc0IsRUFBRSxDQUFDO0VBQ3pCLGVBQWUsTUFBTTtFQUU3QixNQUFjLGVBQWU7SUFDekIsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO01BQ25CO0lBQ0o7SUFFQSxJQUFJLENBQUMsWUFBWSxHQUFHO0lBRXBCLE1BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUU7TUFDdEIsTUFBTSxVQUFVLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSztNQUVoQyxJQUFJLFNBQVM7UUFDVCxNQUFNLFVBQVUsSUFBSSxDQUFDO01BQ3pCO0lBQ0o7SUFFQSxJQUFJLENBQUMsWUFBWSxHQUFHO0VBQ3hCO0VBRU8s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