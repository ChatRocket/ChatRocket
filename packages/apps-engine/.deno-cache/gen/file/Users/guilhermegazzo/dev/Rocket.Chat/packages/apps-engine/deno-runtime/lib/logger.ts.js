import stackTrace from 'stack-trace';
import { AppObjectRegistry } from '../AppObjectRegistry.ts';
var LogMessageSeverity;
(function(LogMessageSeverity) {
  LogMessageSeverity["DEBUG"] = "debug";
  LogMessageSeverity["INFORMATION"] = "info";
  LogMessageSeverity["LOG"] = "log";
  LogMessageSeverity["WARNING"] = "warning";
  LogMessageSeverity["ERROR"] = "error";
  LogMessageSeverity["SUCCESS"] = "success";
})(LogMessageSeverity || (LogMessageSeverity = {}));
export class Logger {
  entries;
  start;
  method;
  constructor(method){
    this.method = method;
    this.entries = [];
    this.start = new Date();
  }
  debug(...args) {
    this.addEntry(LogMessageSeverity.DEBUG, this.getStack(stackTrace.get()), ...args);
  }
  info(...args) {
    this.addEntry(LogMessageSeverity.INFORMATION, this.getStack(stackTrace.get()), ...args);
  }
  log(...args) {
    this.addEntry(LogMessageSeverity.LOG, this.getStack(stackTrace.get()), ...args);
  }
  warn(...args) {
    this.addEntry(LogMessageSeverity.WARNING, this.getStack(stackTrace.get()), ...args);
  }
  error(...args) {
    this.addEntry(LogMessageSeverity.ERROR, this.getStack(stackTrace.get()), ...args);
  }
  success(...args) {
    this.addEntry(LogMessageSeverity.SUCCESS, this.getStack(stackTrace.get()), ...args);
  }
  addEntry(severity, caller, ...items) {
    const i = items.map((args)=>{
      if (args instanceof Error) {
        return JSON.stringify(args, Object.getOwnPropertyNames(args));
      }
      if (typeof args === 'object' && args !== null && 'stack' in args) {
        return JSON.stringify(args, Object.getOwnPropertyNames(args));
      }
      if (typeof args === 'object' && args !== null && 'message' in args) {
        return JSON.stringify(args, Object.getOwnPropertyNames(args));
      }
      const str = JSON.stringify(args, null, 2);
      return str ? JSON.parse(str) : str; // force call toJSON to prevent circular references
    });
    this.entries.push({
      caller,
      severity,
      method: this.method,
      timestamp: new Date(),
      args: i
    });
  }
  getStack(stack) {
    let func = 'anonymous';
    if (stack.length === 1) {
      return func;
    }
    const frame = stack[1];
    if (frame.getMethodName() === null) {
      func = 'anonymous OR constructor';
    } else {
      func = frame.getMethodName();
    }
    if (frame.getFunctionName() !== null) {
      func = `${func} -> ${frame.getFunctionName()}`;
    }
    return func;
  }
  getTotalTime() {
    return new Date().getTime() - this.start.getTime();
  }
  hasEntries() {
    return this.entries.length > 0;
  }
  getLogs() {
    return {
      appId: AppObjectRegistry.get('id'),
      method: this.method,
      entries: this.entries,
      startTime: this.start,
      endTime: new Date(),
      totalTime: this.getTotalTime(),
      _createdAt: new Date()
    };
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vVXNlcnMvZ3VpbGhlcm1lZ2F6em8vZGV2L1JvY2tldC5DaGF0L3BhY2thZ2VzL2FwcHMtZW5naW5lL2Rlbm8tcnVudGltZS9saWIvbG9nZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzdGFja1RyYWNlIGZyb20gJ3N0YWNrLXRyYWNlJztcbmltcG9ydCB7IEFwcE9iamVjdFJlZ2lzdHJ5IH0gZnJvbSAnLi4vQXBwT2JqZWN0UmVnaXN0cnkudHMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFN0YWNrRnJhbWUge1xuICAgIGdldFR5cGVOYW1lKCk6IHN0cmluZztcbiAgICBnZXRGdW5jdGlvbk5hbWUoKTogc3RyaW5nO1xuICAgIGdldE1ldGhvZE5hbWUoKTogc3RyaW5nO1xuICAgIGdldEZpbGVOYW1lKCk6IHN0cmluZztcbiAgICBnZXRMaW5lTnVtYmVyKCk6IG51bWJlcjtcbiAgICBnZXRDb2x1bW5OdW1iZXIoKTogbnVtYmVyO1xuICAgIGlzTmF0aXZlKCk6IGJvb2xlYW47XG4gICAgaXNDb25zdHJ1Y3RvcigpOiBib29sZWFuO1xufVxuXG5lbnVtIExvZ01lc3NhZ2VTZXZlcml0eSB7XG4gICAgREVCVUcgPSAnZGVidWcnLFxuICAgIElORk9STUFUSU9OID0gJ2luZm8nLFxuICAgIExPRyA9ICdsb2cnLFxuICAgIFdBUk5JTkcgPSAnd2FybmluZycsXG4gICAgRVJST1IgPSAnZXJyb3InLFxuICAgIFNVQ0NFU1MgPSAnc3VjY2VzcycsXG59XG5cbnR5cGUgRW50cnkgPSB7XG4gICAgY2FsbGVyOiBzdHJpbmc7XG4gICAgc2V2ZXJpdHk6IExvZ01lc3NhZ2VTZXZlcml0eTtcbiAgICBtZXRob2Q6IHN0cmluZztcbiAgICB0aW1lc3RhbXA6IERhdGU7XG4gICAgYXJnczogQXJyYXk8dW5rbm93bj47XG59O1xuXG5pbnRlcmZhY2UgSUxvZ2dlclN0b3JhZ2VFbnRyeSB7XG4gICAgYXBwSWQ6IHN0cmluZztcbiAgICBtZXRob2Q6IHN0cmluZztcbiAgICBlbnRyaWVzOiBBcnJheTxFbnRyeT47XG4gICAgc3RhcnRUaW1lOiBEYXRlO1xuICAgIGVuZFRpbWU6IERhdGU7XG4gICAgdG90YWxUaW1lOiBudW1iZXI7XG4gICAgX2NyZWF0ZWRBdDogRGF0ZTtcbn1cblxuZXhwb3J0IGNsYXNzIExvZ2dlciB7XG4gICAgcHJpdmF0ZSBlbnRyaWVzOiBBcnJheTxFbnRyeT47XG4gICAgcHJpdmF0ZSBzdGFydDogRGF0ZTtcbiAgICBwcml2YXRlIG1ldGhvZDogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IobWV0aG9kOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5tZXRob2QgPSBtZXRob2Q7XG4gICAgICAgIHRoaXMuZW50cmllcyA9IFtdO1xuICAgICAgICB0aGlzLnN0YXJ0ID0gbmV3IERhdGUoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZGVidWcoLi4uYXJnczogQXJyYXk8dW5rbm93bj4pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5hZGRFbnRyeShMb2dNZXNzYWdlU2V2ZXJpdHkuREVCVUcsIHRoaXMuZ2V0U3RhY2soc3RhY2tUcmFjZS5nZXQoKSksIC4uLmFyZ3MpO1xuICAgIH1cblxuICAgIHB1YmxpYyBpbmZvKC4uLmFyZ3M6IEFycmF5PHVua25vd24+KTogdm9pZCB7XG4gICAgICAgIHRoaXMuYWRkRW50cnkoTG9nTWVzc2FnZVNldmVyaXR5LklORk9STUFUSU9OLCB0aGlzLmdldFN0YWNrKHN0YWNrVHJhY2UuZ2V0KCkpLCAuLi5hcmdzKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgbG9nKC4uLmFyZ3M6IEFycmF5PHVua25vd24+KTogdm9pZCB7XG4gICAgICAgIHRoaXMuYWRkRW50cnkoTG9nTWVzc2FnZVNldmVyaXR5LkxPRywgdGhpcy5nZXRTdGFjayhzdGFja1RyYWNlLmdldCgpKSwgLi4uYXJncyk7XG4gICAgfVxuXG4gICAgcHVibGljIHdhcm4oLi4uYXJnczogQXJyYXk8dW5rbm93bj4pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5hZGRFbnRyeShMb2dNZXNzYWdlU2V2ZXJpdHkuV0FSTklORywgdGhpcy5nZXRTdGFjayhzdGFja1RyYWNlLmdldCgpKSwgLi4uYXJncyk7XG4gICAgfVxuXG4gICAgcHVibGljIGVycm9yKC4uLmFyZ3M6IEFycmF5PHVua25vd24+KTogdm9pZCB7XG4gICAgICAgIHRoaXMuYWRkRW50cnkoTG9nTWVzc2FnZVNldmVyaXR5LkVSUk9SLCB0aGlzLmdldFN0YWNrKHN0YWNrVHJhY2UuZ2V0KCkpLCAuLi5hcmdzKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3VjY2VzcyguLi5hcmdzOiBBcnJheTx1bmtub3duPik6IHZvaWQge1xuICAgICAgICB0aGlzLmFkZEVudHJ5KExvZ01lc3NhZ2VTZXZlcml0eS5TVUNDRVNTLCB0aGlzLmdldFN0YWNrKHN0YWNrVHJhY2UuZ2V0KCkpLCAuLi5hcmdzKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFkZEVudHJ5KHNldmVyaXR5OiBMb2dNZXNzYWdlU2V2ZXJpdHksIGNhbGxlcjogc3RyaW5nLCAuLi5pdGVtczogQXJyYXk8dW5rbm93bj4pOiB2b2lkIHtcbiAgICAgICAgY29uc3QgaSA9IGl0ZW1zLm1hcCgoYXJncykgPT4ge1xuICAgICAgICAgICAgaWYgKGFyZ3MgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShhcmdzLCBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhhcmdzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIGFyZ3MgPT09ICdvYmplY3QnICYmIGFyZ3MgIT09IG51bGwgJiYgJ3N0YWNrJyBpbiBhcmdzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGFyZ3MsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGFyZ3MpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgYXJncyA9PT0gJ29iamVjdCcgJiYgYXJncyAhPT0gbnVsbCAmJiAnbWVzc2FnZScgaW4gYXJncykge1xuICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShhcmdzLCBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhhcmdzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzdHIgPSBKU09OLnN0cmluZ2lmeShhcmdzLCBudWxsLCAyKTtcbiAgICAgICAgICAgIHJldHVybiBzdHIgPyBKU09OLnBhcnNlKHN0cikgOiBzdHI7IC8vIGZvcmNlIGNhbGwgdG9KU09OIHRvIHByZXZlbnQgY2lyY3VsYXIgcmVmZXJlbmNlc1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmVudHJpZXMucHVzaCh7XG4gICAgICAgICAgICBjYWxsZXIsXG4gICAgICAgICAgICBzZXZlcml0eSxcbiAgICAgICAgICAgIG1ldGhvZDogdGhpcy5tZXRob2QsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBhcmdzOiBpLFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFN0YWNrKHN0YWNrOiBBcnJheTxTdGFja0ZyYW1lPik6IHN0cmluZyB7XG4gICAgICAgIGxldCBmdW5jID0gJ2Fub255bW91cyc7XG5cbiAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmM7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBmcmFtZSA9IHN0YWNrWzFdO1xuXG4gICAgICAgIGlmIChmcmFtZS5nZXRNZXRob2ROYW1lKCkgPT09IG51bGwpIHtcbiAgICAgICAgICAgIGZ1bmMgPSAnYW5vbnltb3VzIE9SIGNvbnN0cnVjdG9yJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZ1bmMgPSBmcmFtZS5nZXRNZXRob2ROYW1lKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZnJhbWUuZ2V0RnVuY3Rpb25OYW1lKCkgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGZ1bmMgPSBgJHtmdW5jfSAtPiAke2ZyYW1lLmdldEZ1bmN0aW9uTmFtZSgpfWA7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZnVuYztcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFRvdGFsVGltZSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLnN0YXJ0LmdldFRpbWUoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaGFzRW50cmllcygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZW50cmllcy5sZW5ndGggPiAwO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRMb2dzKCk6IElMb2dnZXJTdG9yYWdlRW50cnkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYXBwSWQ6IEFwcE9iamVjdFJlZ2lzdHJ5LmdldCgnaWQnKSEsXG4gICAgICAgICAgICBtZXRob2Q6IHRoaXMubWV0aG9kLFxuICAgICAgICAgICAgZW50cmllczogdGhpcy5lbnRyaWVzLFxuICAgICAgICAgICAgc3RhcnRUaW1lOiB0aGlzLnN0YXJ0LFxuICAgICAgICAgICAgZW5kVGltZTogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIHRvdGFsVGltZTogdGhpcy5nZXRUb3RhbFRpbWUoKSxcbiAgICAgICAgICAgIF9jcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH07XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sZ0JBQWdCLGNBQWM7QUFDckMsU0FBUyxpQkFBaUIsUUFBUSwwQkFBMEI7O1VBYXZEOzs7Ozs7O0dBQUEsdUJBQUE7QUEyQkwsT0FBTyxNQUFNO0VBQ0QsUUFBc0I7RUFDdEIsTUFBWTtFQUNaLE9BQWU7RUFFdkIsWUFBWSxNQUFjLENBQUU7SUFDeEIsSUFBSSxDQUFDLE1BQU0sR0FBRztJQUNkLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRTtJ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