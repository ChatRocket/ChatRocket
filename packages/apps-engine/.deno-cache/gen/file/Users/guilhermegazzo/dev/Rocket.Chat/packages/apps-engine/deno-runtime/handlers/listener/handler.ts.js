import { JsonRpcError } from 'jsonrpc-lite';
import { AppObjectRegistry } from '../../AppObjectRegistry.ts';
import { MessageExtender } from '../../lib/accessors/extenders/MessageExtender.ts';
import { RoomExtender } from '../../lib/accessors/extenders/RoomExtender.ts';
import { MessageBuilder } from '../../lib/accessors/builders/MessageBuilder.ts';
import { RoomBuilder } from '../../lib/accessors/builders/RoomBuilder.ts';
import { AppAccessorsInstance } from '../../lib/accessors/mod.ts';
import { require } from '../../lib/require.ts';
import createRoom from '../../lib/roomFactory.ts';
import { Room } from "../../lib/room.ts";
const { AppsEngineException } = require('@rocket.chat/apps-engine/definition/exceptions/AppsEngineException.js');
export default async function handleListener(evtInterface, params) {
  const app = AppObjectRegistry.get('app');
  const eventExecutor = app?.[evtInterface];
  if (typeof eventExecutor !== 'function') {
    return JsonRpcError.methodNotFound({
      message: 'Invalid event interface called on app'
    });
  }
  if (!Array.isArray(params) || params.length < 1 || params.length > 2) {
    return JsonRpcError.invalidParams(null);
  }
  try {
    const args = parseArgs({
      AppAccessorsInstance
    }, evtInterface, params);
    return await eventExecutor.apply(app, args);
  } catch (e) {
    if (e instanceof JsonRpcError) {
      return e;
    }
    if (e instanceof AppsEngineException) {
      return new JsonRpcError(e.message, AppsEngineException.JSONRPC_ERROR_CODE, {
        name: e.name
      });
    }
    return JsonRpcError.internalError({
      message: e.message
    });
  }
}
export function parseArgs(deps, evtMethod, params) {
  const { AppAccessorsInstance } = deps;
  /**
     * param1 is the context for the event handler execution
     * param2 is an optional extra content that some hanlers require
     */ const [param1, param2] = params;
  if (!param1) {
    throw JsonRpcError.invalidParams(null);
  }
  let context = param1;
  if (evtMethod.includes('Message')) {
    context = hydrateMessageObjects(context);
  } else if (evtMethod.endsWith('RoomUserJoined') || evtMethod.endsWith('RoomUserLeave')) {
    context.room = createRoom(context.room, AppAccessorsInstance.getSenderFn());
  } else if (evtMethod.includes('PreRoom')) {
    context = createRoom(context, AppAccessorsInstance.getSenderFn());
  }
  const args = [
    context,
    AppAccessorsInstance.getReader(),
    AppAccessorsInstance.getHttp()
  ];
  // "check" events will only go this far - (context, reader, http)
  if (evtMethod.startsWith('check')) {
    // "checkPostMessageDeleted" has an extra param - (context, reader, http, extraContext)
    if (param2) {
      args.push(hydrateMessageObjects(param2));
    }
    return args;
  }
  // From this point on, all events will require (reader, http, persistence) injected
  args.push(AppAccessorsInstance.getPersistence());
  // "extend" events have an additional "Extender" param - (context, extender, reader, http, persistence)
  if (evtMethod.endsWith('Extend')) {
    if (evtMethod.includes('Message')) {
      args.splice(1, 0, new MessageExtender(param1));
    } else if (evtMethod.includes('Room')) {
      args.splice(1, 0, new RoomExtender(param1));
    }
    return args;
  }
  // "Modify" events have an additional "Builder" param - (context, builder, reader, http, persistence)
  if (evtMethod.endsWith('Modify')) {
    if (evtMethod.includes('Message')) {
      args.splice(1, 0, new MessageBuilder(param1));
    } else if (evtMethod.includes('Room')) {
      args.splice(1, 0, new RoomBuilder(param1));
    }
    return args;
  }
  // From this point on, all events will require (reader, http, persistence, modifier) injected
  args.push(AppAccessorsInstance.getModifier());
  // This guy gets an extra one
  if (evtMethod === 'executePostMessageDeleted') {
    if (!param2) {
      throw JsonRpcError.invalidParams(null);
    }
    args.push(hydrateMessageObjects(param2));
  }
  return args;
}
/**
 * Hydrate the context object with the correct IMessage
 *
 * Some information is lost upon serializing the data from listeners through the pipes,
 * so here we hydrate the complete object as necessary
 */ function hydrateMessageObjects(context) {
  if (objectIsRawMessage(context)) {
    context.room = createRoom(context.room, AppAccessorsInstance.getSenderFn());
  } else if (context?.message) {
    context.message = hydrateMessageObjects(context.message);
  }
  return context;
}
function objectIsRawMessage(value) {
  if (!value) return false;
  const { id, room, sender, createdAt } = value;
  // Check if we have the fields of a message and the room hasn't already been hydrated
  return !!(id && room && sender && createdAt) && !(room instanceof Room);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vVXNlcnMvZ3VpbGhlcm1lZ2F6em8vZGV2L1JvY2tldC5DaGF0L3BhY2thZ2VzL2FwcHMtZW5naW5lL2Rlbm8tcnVudGltZS9oYW5kbGVycy9saXN0ZW5lci9oYW5kbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlZmluZWQsIEpzb25ScGNFcnJvciB9IGZyb20gJ2pzb25ycGMtbGl0ZSc7XG5pbXBvcnQgdHlwZSB7IEFwcCB9IGZyb20gJ0Byb2NrZXQuY2hhdC9hcHBzLWVuZ2luZS9kZWZpbml0aW9uL0FwcC50cyc7XG5pbXBvcnQgdHlwZSB7IElNZXNzYWdlIH0gZnJvbSAnQHJvY2tldC5jaGF0L2FwcHMtZW5naW5lL2RlZmluaXRpb24vbWVzc2FnZXMvSU1lc3NhZ2UudHMnO1xuaW1wb3J0IHR5cGUgeyBJUm9vbSB9IGZyb20gJ0Byb2NrZXQuY2hhdC9hcHBzLWVuZ2luZS9kZWZpbml0aW9uL3Jvb21zL0lSb29tLnRzJztcbmltcG9ydCB0eXBlIHsgQXBwc0VuZ2luZUV4Y2VwdGlvbiBhcyBfQXBwc0VuZ2luZUV4Y2VwdGlvbiB9IGZyb20gJ0Byb2NrZXQuY2hhdC9hcHBzLWVuZ2luZS9kZWZpbml0aW9uL2V4Y2VwdGlvbnMvQXBwc0VuZ2luZUV4Y2VwdGlvbi50cyc7XG5cbmltcG9ydCB7IEFwcE9iamVjdFJlZ2lzdHJ5IH0gZnJvbSAnLi4vLi4vQXBwT2JqZWN0UmVnaXN0cnkudHMnO1xuaW1wb3J0IHsgTWVzc2FnZUV4dGVuZGVyIH0gZnJvbSAnLi4vLi4vbGliL2FjY2Vzc29ycy9leHRlbmRlcnMvTWVzc2FnZUV4dGVuZGVyLnRzJztcbmltcG9ydCB7IFJvb21FeHRlbmRlciB9IGZyb20gJy4uLy4uL2xpYi9hY2Nlc3NvcnMvZXh0ZW5kZXJzL1Jvb21FeHRlbmRlci50cyc7XG5pbXBvcnQgeyBNZXNzYWdlQnVpbGRlciB9IGZyb20gJy4uLy4uL2xpYi9hY2Nlc3NvcnMvYnVpbGRlcnMvTWVzc2FnZUJ1aWxkZXIudHMnO1xuaW1wb3J0IHsgUm9vbUJ1aWxkZXIgfSBmcm9tICcuLi8uLi9saWIvYWNjZXNzb3JzL2J1aWxkZXJzL1Jvb21CdWlsZGVyLnRzJztcbmltcG9ydCB7IEFwcEFjY2Vzc29ycywgQXBwQWNjZXNzb3JzSW5zdGFuY2UgfSBmcm9tICcuLi8uLi9saWIvYWNjZXNzb3JzL21vZC50cyc7XG5pbXBvcnQgeyByZXF1aXJlIH0gZnJvbSAnLi4vLi4vbGliL3JlcXVpcmUudHMnO1xuaW1wb3J0IGNyZWF0ZVJvb20gZnJvbSAnLi4vLi4vbGliL3Jvb21GYWN0b3J5LnRzJztcbmltcG9ydCB7IFJvb20gfSBmcm9tIFwiLi4vLi4vbGliL3Jvb20udHNcIjtcblxuY29uc3QgeyBBcHBzRW5naW5lRXhjZXB0aW9uIH0gPSByZXF1aXJlKCdAcm9ja2V0LmNoYXQvYXBwcy1lbmdpbmUvZGVmaW5pdGlvbi9leGNlcHRpb25zL0FwcHNFbmdpbmVFeGNlcHRpb24uanMnKSBhcyB7XG4gICAgQXBwc0VuZ2luZUV4Y2VwdGlvbjogdHlwZW9mIF9BcHBzRW5naW5lRXhjZXB0aW9uO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlTGlzdGVuZXIoZXZ0SW50ZXJmYWNlOiBzdHJpbmcsIHBhcmFtczogdW5rbm93bik6IFByb21pc2U8RGVmaW5lZCB8IEpzb25ScGNFcnJvcj4ge1xuICAgIGNvbnN0IGFwcCA9IEFwcE9iamVjdFJlZ2lzdHJ5LmdldDxBcHA+KCdhcHAnKTtcblxuICAgIGNvbnN0IGV2ZW50RXhlY3V0b3IgPSBhcHA/LltldnRJbnRlcmZhY2UgYXMga2V5b2YgQXBwXTtcblxuICAgIGlmICh0eXBlb2YgZXZlbnRFeGVjdXRvciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZXR1cm4gSnNvblJwY0Vycm9yLm1ldGhvZE5vdEZvdW5kKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIGV2ZW50IGludGVyZmFjZSBjYWxsZWQgb24gYXBwJyxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHBhcmFtcykgfHwgcGFyYW1zLmxlbmd0aCA8IDEgfHwgcGFyYW1zLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgcmV0dXJuIEpzb25ScGNFcnJvci5pbnZhbGlkUGFyYW1zKG51bGwpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFyZ3MgPSBwYXJzZUFyZ3MoeyBBcHBBY2Nlc3NvcnNJbnN0YW5jZSB9LCBldnRJbnRlcmZhY2UsIHBhcmFtcyk7XG4gICAgICAgIHJldHVybiBhd2FpdCAoZXZlbnRFeGVjdXRvciBhcyAoLi4uYXJnczogdW5rbm93bltdKSA9PiBQcm9taXNlPERlZmluZWQ+KS5hcHBseShhcHAsIGFyZ3MpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBKc29uUnBjRXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBBcHBzRW5naW5lRXhjZXB0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEpzb25ScGNFcnJvcihlLm1lc3NhZ2UsIEFwcHNFbmdpbmVFeGNlcHRpb24uSlNPTlJQQ19FUlJPUl9DT0RFLCB7IG5hbWU6IGUubmFtZSB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBKc29uUnBjRXJyb3IuaW50ZXJuYWxFcnJvcih7IG1lc3NhZ2U6IGUubWVzc2FnZSB9KTtcbiAgICB9XG5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQXJncyhkZXBzOiB7IEFwcEFjY2Vzc29yc0luc3RhbmNlOiBBcHBBY2Nlc3NvcnMgfSwgZXZ0TWV0aG9kOiBzdHJpbmcsIHBhcmFtczogdW5rbm93bltdKTogdW5rbm93bltdIHtcbiAgICBjb25zdCB7IEFwcEFjY2Vzc29yc0luc3RhbmNlIH0gPSBkZXBzO1xuICAgIC8qKlxuICAgICAqIHBhcmFtMSBpcyB0aGUgY29udGV4dCBmb3IgdGhlIGV2ZW50IGhhbmRsZXIgZXhlY3V0aW9uXG4gICAgICogcGFyYW0yIGlzIGFuIG9wdGlvbmFsIGV4dHJhIGNvbnRlbnQgdGhhdCBzb21lIGhhbmxlcnMgcmVxdWlyZVxuICAgICAqL1xuICAgIGNvbnN0IFtwYXJhbTEsIHBhcmFtMl0gPSBwYXJhbXMgYXMgW3Vua25vd24sIHVua25vd25dO1xuXG4gICAgaWYgKCFwYXJhbTEpIHtcbiAgICAgICAgdGhyb3cgSnNvblJwY0Vycm9yLmludmFsaWRQYXJhbXMobnVsbCk7XG4gICAgfVxuXG4gICAgbGV0IGNvbnRleHQgPSBwYXJhbTE7XG5cbiAgICBpZiAoZXZ0TWV0aG9kLmluY2x1ZGVzKCdNZXNzYWdlJykpIHtcbiAgICAgICAgY29udGV4dCA9IGh5ZHJhdGVNZXNzYWdlT2JqZWN0cyhjb250ZXh0KSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICB9IGVsc2UgaWYgKGV2dE1ldGhvZC5lbmRzV2l0aCgnUm9vbVVzZXJKb2luZWQnKSB8fCBldnRNZXRob2QuZW5kc1dpdGgoJ1Jvb21Vc2VyTGVhdmUnKSkge1xuICAgICAgICAoY29udGV4dCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikucm9vbSA9IGNyZWF0ZVJvb20oKGNvbnRleHQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLnJvb20gYXMgSVJvb20sIEFwcEFjY2Vzc29yc0luc3RhbmNlLmdldFNlbmRlckZuKCkpO1xuICAgIH0gZWxzZSBpZiAoZXZ0TWV0aG9kLmluY2x1ZGVzKCdQcmVSb29tJykpIHtcbiAgICAgICAgY29udGV4dCA9IGNyZWF0ZVJvb20oY29udGV4dCBhcyBJUm9vbSwgQXBwQWNjZXNzb3JzSW5zdGFuY2UuZ2V0U2VuZGVyRm4oKSk7XG4gICAgfVxuXG4gICAgY29uc3QgYXJnczogdW5rbm93bltdID0gW2NvbnRleHQsIEFwcEFjY2Vzc29yc0luc3RhbmNlLmdldFJlYWRlcigpLCBBcHBBY2Nlc3NvcnNJbnN0YW5jZS5nZXRIdHRwKCldO1xuXG4gICAgLy8gXCJjaGVja1wiIGV2ZW50cyB3aWxsIG9ubHkgZ28gdGhpcyBmYXIgLSAoY29udGV4dCwgcmVhZGVyLCBodHRwKVxuICAgIGlmIChldnRNZXRob2Quc3RhcnRzV2l0aCgnY2hlY2snKSkge1xuICAgICAgICAvLyBcImNoZWNrUG9zdE1lc3NhZ2VEZWxldGVkXCIgaGFzIGFuIGV4dHJhIHBhcmFtIC0gKGNvbnRleHQsIHJlYWRlciwgaHR0cCwgZXh0cmFDb250ZXh0KVxuICAgICAgICBpZiAocGFyYW0yKSB7XG4gICAgICAgICAgICBhcmdzLnB1c2goaHlkcmF0ZU1lc3NhZ2VPYmplY3RzKHBhcmFtMikpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFyZ3M7XG4gICAgfVxuXG4gICAgLy8gRnJvbSB0aGlzIHBvaW50IG9uLCBhbGwgZXZlbnRzIHdpbGwgcmVxdWlyZSAocmVhZGVyLCBodHRwLCBwZXJzaXN0ZW5jZSkgaW5qZWN0ZWRcbiAgICBhcmdzLnB1c2goQXBwQWNjZXNzb3JzSW5zdGFuY2UuZ2V0UGVyc2lzdGVuY2UoKSk7XG5cbiAgICAvLyBcImV4dGVuZFwiIGV2ZW50cyBoYXZlIGFuIGFkZGl0aW9uYWwgXCJFeHRlbmRlclwiIHBhcmFtIC0gKGNvbnRleHQsIGV4dGVuZGVyLCByZWFkZXIsIGh0dHAsIHBlcnNpc3RlbmNlKVxuICAgIGlmIChldnRNZXRob2QuZW5kc1dpdGgoJ0V4dGVuZCcpKSB7XG4gICAgICAgIGlmIChldnRNZXRob2QuaW5jbHVkZXMoJ01lc3NhZ2UnKSkge1xuICAgICAgICAgICAgYXJncy5zcGxpY2UoMSwgMCwgbmV3IE1lc3NhZ2VFeHRlbmRlcihwYXJhbTEgYXMgSU1lc3NhZ2UpKTtcbiAgICAgICAgfSBlbHNlIGlmIChldnRNZXRob2QuaW5jbHVkZXMoJ1Jvb20nKSkge1xuICAgICAgICAgICAgYXJncy5zcGxpY2UoMSwgMCwgbmV3IFJvb21FeHRlbmRlcihwYXJhbTEgYXMgSVJvb20pKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhcmdzO1xuICAgIH1cblxuICAgIC8vIFwiTW9kaWZ5XCIgZXZlbnRzIGhhdmUgYW4gYWRkaXRpb25hbCBcIkJ1aWxkZXJcIiBwYXJhbSAtIChjb250ZXh0LCBidWlsZGVyLCByZWFkZXIsIGh0dHAsIHBlcnNpc3RlbmNlKVxuICAgIGlmIChldnRNZXRob2QuZW5kc1dpdGgoJ01vZGlmeScpKSB7XG4gICAgICAgIGlmIChldnRNZXRob2QuaW5jbHVkZXMoJ01lc3NhZ2UnKSkge1xuICAgICAgICAgICAgYXJncy5zcGxpY2UoMSwgMCwgbmV3IE1lc3NhZ2VCdWlsZGVyKHBhcmFtMSBhcyBJTWVzc2FnZSkpO1xuICAgICAgICB9IGVsc2UgaWYgKGV2dE1ldGhvZC5pbmNsdWRlcygnUm9vbScpKSB7XG4gICAgICAgICAgICBhcmdzLnNwbGljZSgxLCAwLCBuZXcgUm9vbUJ1aWxkZXIocGFyYW0xIGFzIElSb29tKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXJncztcbiAgICB9XG5cbiAgICAvLyBGcm9tIHRoaXMgcG9pbnQgb24sIGFsbCBldmVudHMgd2lsbCByZXF1aXJlIChyZWFkZXIsIGh0dHAsIHBlcnNpc3RlbmNlLCBtb2RpZmllcikgaW5qZWN0ZWRcbiAgICBhcmdzLnB1c2goQXBwQWNjZXNzb3JzSW5zdGFuY2UuZ2V0TW9kaWZpZXIoKSk7XG5cbiAgICAvLyBUaGlzIGd1eSBnZXRzIGFuIGV4dHJhIG9uZVxuICAgIGlmIChldnRNZXRob2QgPT09ICdleGVjdXRlUG9zdE1lc3NhZ2VEZWxldGVkJykge1xuICAgICAgICBpZiAoIXBhcmFtMikge1xuICAgICAgICAgICAgdGhyb3cgSnNvblJwY0Vycm9yLmludmFsaWRQYXJhbXMobnVsbCk7XG4gICAgICAgIH1cblxuICAgICAgICBhcmdzLnB1c2goaHlkcmF0ZU1lc3NhZ2VPYmplY3RzKHBhcmFtMikpO1xuICAgIH1cblxuICAgIHJldHVybiBhcmdzO1xufVxuXG4vKipcbiAqIEh5ZHJhdGUgdGhlIGNvbnRleHQgb2JqZWN0IHdpdGggdGhlIGNvcnJlY3QgSU1lc3NhZ2VcbiAqXG4gKiBTb21lIGluZm9ybWF0aW9uIGlzIGxvc3QgdXBvbiBzZXJpYWxpemluZyB0aGUgZGF0YSBmcm9tIGxpc3RlbmVycyB0aHJvdWdoIHRoZSBwaXBlcyxcbiAqIHNvIGhlcmUgd2UgaHlkcmF0ZSB0aGUgY29tcGxldGUgb2JqZWN0IGFzIG5lY2Vzc2FyeVxuICovXG5mdW5jdGlvbiBoeWRyYXRlTWVzc2FnZU9iamVjdHMoY29udGV4dDogdW5rbm93bik6IHVua25vd24ge1xuICAgIGlmIChvYmplY3RJc1Jhd01lc3NhZ2UoY29udGV4dCkpIHtcbiAgICAgICAgY29udGV4dC5yb29tID0gY3JlYXRlUm9vbShjb250ZXh0LnJvb20gYXMgSVJvb20sIEFwcEFjY2Vzc29yc0luc3RhbmNlLmdldFNlbmRlckZuKCkpO1xuICAgIH0gZWxzZSBpZiAoKGNvbnRleHQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5tZXNzYWdlKSB7XG4gICAgICAgIChjb250ZXh0IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5tZXNzYWdlID0gaHlkcmF0ZU1lc3NhZ2VPYmplY3RzKChjb250ZXh0IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5tZXNzYWdlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY29udGV4dDtcbn1cblxuZnVuY3Rpb24gb2JqZWN0SXNSYXdNZXNzYWdlKHZhbHVlOiB1bmtub3duKTogdmFsdWUgaXMgSU1lc3NhZ2Uge1xuICAgIGlmICghdmFsdWUpIHJldHVybiBmYWxzZTtcblxuICAgIGNvbnN0IHsgaWQsIHJvb20sIHNlbmRlciwgY3JlYXRlZEF0IH0gPSB2YWx1ZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcblxuICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgdGhlIGZpZWxkcyBvZiBhIG1lc3NhZ2UgYW5kIHRoZSByb29tIGhhc24ndCBhbHJlYWR5IGJlZW4gaHlkcmF0ZWRcbiAgICByZXR1cm4gISEoaWQgJiYgcm9vbSAmJiBzZW5kZXIgJiYgY3Jl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