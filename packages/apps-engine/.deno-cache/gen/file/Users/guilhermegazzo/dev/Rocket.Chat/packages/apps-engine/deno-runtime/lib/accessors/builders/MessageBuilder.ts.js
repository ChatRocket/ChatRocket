import { BlockBuilder } from './BlockBuilder.ts';
import { require } from '../../../lib/require.ts';
const { RocketChatAssociationModel } = require('@rocket.chat/apps-engine/definition/metadata/RocketChatAssociations.js');
export class MessageBuilder {
  kind;
  msg;
  constructor(message){
    this.kind = RocketChatAssociationModel.MESSAGE;
    this.msg = message || {};
  }
  setData(data) {
    delete data.id;
    this.msg = data;
    return this;
  }
  setUpdateData(data, editor) {
    this.msg = data;
    this.msg.editor = editor;
    this.msg.editedAt = new Date();
    return this;
  }
  setThreadId(threadId) {
    this.msg.threadId = threadId;
    return this;
  }
  getThreadId() {
    return this.msg.threadId;
  }
  setRoom(room) {
    this.msg.room = room;
    return this;
  }
  getRoom() {
    return this.msg.room;
  }
  setSender(sender) {
    this.msg.sender = sender;
    return this;
  }
  getSender() {
    return this.msg.sender;
  }
  setText(text) {
    this.msg.text = text;
    return this;
  }
  getText() {
    return this.msg.text;
  }
  setEmojiAvatar(emoji) {
    this.msg.emoji = emoji;
    return this;
  }
  getEmojiAvatar() {
    return this.msg.emoji;
  }
  setAvatarUrl(avatarUrl) {
    this.msg.avatarUrl = avatarUrl;
    return this;
  }
  getAvatarUrl() {
    return this.msg.avatarUrl;
  }
  setUsernameAlias(alias) {
    this.msg.alias = alias;
    return this;
  }
  getUsernameAlias() {
    return this.msg.alias;
  }
  addAttachment(attachment) {
    if (!this.msg.attachments) {
      this.msg.attachments = [];
    }
    this.msg.attachments.push(attachment);
    return this;
  }
  setAttachments(attachments) {
    this.msg.attachments = attachments;
    return this;
  }
  getAttachments() {
    return this.msg.attachments;
  }
  replaceAttachment(position, attachment) {
    if (!this.msg.attachments) {
      this.msg.attachments = [];
    }
    if (!this.msg.attachments[position]) {
      throw new Error(`No attachment found at the index of "${position}" to replace.`);
    }
    this.msg.attachments[position] = attachment;
    return this;
  }
  removeAttachment(position) {
    if (!this.msg.attachments) {
      this.msg.attachments = [];
    }
    if (!this.msg.attachments[position]) {
      throw new Error(`No attachment found at the index of "${position}" to remove.`);
    }
    this.msg.attachments.splice(position, 1);
    return this;
  }
  setEditor(user) {
    this.msg.editor = user;
    return this;
  }
  getEditor() {
    return this.msg.editor;
  }
  setGroupable(groupable) {
    this.msg.groupable = groupable;
    return this;
  }
  getGroupable() {
    return this.msg.groupable;
  }
  setParseUrls(parseUrls) {
    this.msg.parseUrls = parseUrls;
    return this;
  }
  getParseUrls() {
    return this.msg.parseUrls;
  }
  getMessage() {
    if (!this.msg.room) {
      throw new Error('The "room" property is required.');
    }
    return this.msg;
  }
  addBlocks(blocks) {
    if (!Array.isArray(this.msg.blocks)) {
      this.msg.blocks = [];
    }
    if (blocks instanceof BlockBuilder) {
      this.msg.blocks.push(...blocks.getBlocks());
    } else {
      this.msg.blocks.push(...blocks);
    }
    return this;
  }
  setBlocks(blocks) {
    if (blocks instanceof BlockBuilder) {
      this.msg.blocks = blocks.getBlocks();
    } else {
      this.msg.blocks = blocks;
    }
    return this;
  }
  getBlocks() {
    return this.msg.blocks;
  }
  addCustomField(key, value) {
    if (!this.msg.customFields) {
      this.msg.customFields = {};
    }
    if (this.msg.customFields[key]) {
      throw new Error(`The message already contains a custom field by the key: ${key}`);
    }
    if (key.includes('.')) {
      throw new Error(`The given key contains a period, which is not allowed. Key: ${key}`);
    }
    this.msg.customFields[key] = value;
    return this;
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vVXNlcnMvZ3VpbGhlcm1lZ2F6em8vZGV2L1JvY2tldC5DaGF0L3BhY2thZ2VzL2FwcHMtZW5naW5lL2Rlbm8tcnVudGltZS9saWIvYWNjZXNzb3JzL2J1aWxkZXJzL01lc3NhZ2VCdWlsZGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExheW91dEJsb2NrIH0gZnJvbSAnQHJvY2tldC5jaGF0L3VpLWtpdCc7XG5cbmltcG9ydCB0eXBlIHsgSU1lc3NhZ2VCdWlsZGVyIH0gZnJvbSAnQHJvY2tldC5jaGF0L2FwcHMtZW5naW5lL2RlZmluaXRpb24vYWNjZXNzb3JzL0lNZXNzYWdlQnVpbGRlci50cyc7XG5pbXBvcnQgdHlwZSB7IFJvY2tldENoYXRBc3NvY2lhdGlvbk1vZGVsIGFzIF9Sb2NrZXRDaGF0QXNzb2NpYXRpb25Nb2RlbCB9IGZyb20gJ0Byb2NrZXQuY2hhdC9hcHBzLWVuZ2luZS9kZWZpbml0aW9uL21ldGFkYXRhL1JvY2tldENoYXRBc3NvY2lhdGlvbnMudHMnO1xuaW1wb3J0IHR5cGUgeyBJTWVzc2FnZSB9IGZyb20gJ0Byb2NrZXQuY2hhdC9hcHBzLWVuZ2luZS9kZWZpbml0aW9uL21lc3NhZ2VzL0lNZXNzYWdlLnRzJztcbmltcG9ydCB0eXBlIHsgSU1lc3NhZ2VBdHRhY2htZW50IH0gZnJvbSAnQHJvY2tldC5jaGF0L2FwcHMtZW5naW5lL2RlZmluaXRpb24vbWVzc2FnZXMvSU1lc3NhZ2VBdHRhY2htZW50LnRzJztcbmltcG9ydCB0eXBlIHsgSVVzZXIgfSBmcm9tICdAcm9ja2V0LmNoYXQvYXBwcy1lbmdpbmUvZGVmaW5pdGlvbi91c2Vycy9JVXNlci50cyc7XG5pbXBvcnQgdHlwZSB7IElSb29tIH0gZnJvbSAnQHJvY2tldC5jaGF0L2FwcHMtZW5naW5lL2RlZmluaXRpb24vcm9vbXMvSVJvb20udHMnO1xuaW1wb3J0IHR5cGUgeyBJQmxvY2sgfSBmcm9tICdAcm9ja2V0LmNoYXQvYXBwcy1lbmdpbmUvZGVmaW5pdGlvbi91aWtpdC9ibG9ja3MvQmxvY2tzLnRzJztcblxuaW1wb3J0IHsgQmxvY2tCdWlsZGVyIH0gZnJvbSAnLi9CbG9ja0J1aWxkZXIudHMnO1xuaW1wb3J0IHsgcmVxdWlyZSB9IGZyb20gJy4uLy4uLy4uL2xpYi9yZXF1aXJlLnRzJztcblxuY29uc3QgeyBSb2NrZXRDaGF0QXNzb2NpYXRpb25Nb2RlbCB9ID0gcmVxdWlyZSgnQHJvY2tldC5jaGF0L2FwcHMtZW5naW5lL2RlZmluaXRpb24vbWV0YWRhdGEvUm9ja2V0Q2hhdEFzc29jaWF0aW9ucy5qcycpIGFzIHtcbiAgICBSb2NrZXRDaGF0QXNzb2NpYXRpb25Nb2RlbDogdHlwZW9mIF9Sb2NrZXRDaGF0QXNzb2NpYXRpb25Nb2RlbDtcbn07XG5cbmV4cG9ydCBjbGFzcyBNZXNzYWdlQnVpbGRlciBpbXBsZW1lbnRzIElNZXNzYWdlQnVpbGRlciB7XG4gICAgcHVibGljIGtpbmQ6IF9Sb2NrZXRDaGF0QXNzb2NpYXRpb25Nb2RlbC5NRVNTQUdFO1xuXG4gICAgcHJpdmF0ZSBtc2c6IElNZXNzYWdlO1xuXG4gICAgY29uc3RydWN0b3IobWVzc2FnZT86IElNZXNzYWdlKSB7XG4gICAgICAgIHRoaXMua2luZCA9IFJvY2tldENoYXRBc3NvY2lhdGlvbk1vZGVsLk1FU1NBR0U7XG4gICAgICAgIHRoaXMubXNnID0gbWVzc2FnZSB8fCAoe30gYXMgSU1lc3NhZ2UpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXREYXRhKGRhdGE6IElNZXNzYWdlKTogSU1lc3NhZ2VCdWlsZGVyIHtcbiAgICAgICAgZGVsZXRlIGRhdGEuaWQ7XG4gICAgICAgIHRoaXMubXNnID0gZGF0YTtcblxuICAgICAgICByZXR1cm4gdGhpcyBhcyBJTWVzc2FnZUJ1aWxkZXI7XG4gICAgfVxuXG4gICAgcHVibGljIHNldFVwZGF0ZURhdGEoZGF0YTogSU1lc3NhZ2UsIGVkaXRvcjogSVVzZXIpOiBJTWVzc2FnZUJ1aWxkZXIge1xuICAgICAgICB0aGlzLm1zZyA9IGRhdGE7XG4gICAgICAgIHRoaXMubXNnLmVkaXRvciA9IGVkaXRvcjtcbiAgICAgICAgdGhpcy5tc2cuZWRpdGVkQXQgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0VGhyZWFkSWQodGhyZWFkSWQ6IHN0cmluZyk6IElNZXNzYWdlQnVpbGRlciB7XG4gICAgICAgIHRoaXMubXNnLnRocmVhZElkID0gdGhyZWFkSWQ7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMgYXMgSU1lc3NhZ2VCdWlsZGVyO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRUaHJlYWRJZCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5tc2cudGhyZWFkSWQhO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRSb29tKHJvb206IElSb29tKTogSU1lc3NhZ2VCdWlsZGVyIHtcbiAgICAgICAgdGhpcy5tc2cucm9vbSA9IHJvb207XG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0Um9vbSgpOiBJUm9vbSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1zZy5yb29tO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRTZW5kZXIoc2VuZGVyOiBJVXNlcik6IElNZXNzYWdlQnVpbGRlciB7XG4gICAgICAgIHRoaXMubXNnLnNlbmRlciA9IHNlbmRlcjtcbiAgICAgICAgcmV0dXJuIHRoaXMgYXMgSU1lc3NhZ2VCdWlsZGVyO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRTZW5kZXIoKTogSVVzZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5tc2cuc2VuZGVyO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRUZXh0KHRleHQ6IHN0cmluZyk6IElNZXNzYWdlQnVpbGRlciB7XG4gICAgICAgIHRoaXMubXNnLnRleHQgPSB0ZXh0O1xuICAgICAgICByZXR1cm4gdGhpcyBhcyBJTWVzc2FnZUJ1aWxkZXI7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFRleHQoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubXNnLnRleHQhO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRFbW9qaUF2YXRhcihlbW9qaTogc3RyaW5nKTogSU1lc3NhZ2VCdWlsZGVyIHtcbiAgICAgICAgdGhpcy5tc2cuZW1vamkgPSBlbW9qaTtcbiAgICAgICAgcmV0dXJuIHRoaXMgYXMgSU1lc3NhZ2VCdWlsZGVyO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRFbW9qaUF2YXRhcigpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5tc2cuZW1vamkhO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRBdmF0YXJVcmwoYXZhdGFyVXJsOiBzdHJpbmcpOiBJTWVzc2FnZUJ1aWxkZXIge1xuICAgICAgICB0aGlzLm1zZy5hdmF0YXJVcmwgPSBhdmF0YXJVcmw7XG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0QXZhdGFyVXJsKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLm1zZy5hdmF0YXJVcmwhO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRVc2VybmFtZUFsaWFzKGFsaWFzOiBzdHJpbmcpOiBJTWVzc2FnZUJ1aWxkZXIge1xuICAgICAgICB0aGlzLm1zZy5hbGlhcyA9IGFsaWFzO1xuICAgICAgICByZXR1cm4gdGhpcyBhcyBJTWVzc2FnZUJ1aWxkZXI7XG4gICAgfVxuXG4gICAgcHVibGljIGdldFVzZXJuYW1lQWxpYXMoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubXNnLmFsaWFzITtcbiAgICB9XG5cbiAgICBwdWJsaWMgYWRkQXR0YWNobWVudChhdHRhY2htZW50OiBJTWVzc2FnZUF0dGFjaG1lbnQpOiBJTWVzc2FnZUJ1aWxkZXIge1xuICAgICAgICBpZiAoIXRoaXMubXNnLmF0dGFjaG1lbnRzKSB7XG4gICAgICAgICAgICB0aGlzLm1zZy5hdHRhY2htZW50cyA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tc2cuYXR0YWNobWVudHMucHVzaChhdHRhY2htZW50KTtcbiAgICAgICAgcmV0dXJuIHRoaXMgYXMgSU1lc3NhZ2VCdWlsZGVyO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRBdHRhY2htZW50cyhhdHRhY2htZW50czogQXJyYXk8SU1lc3NhZ2VBdHRhY2htZW50Pik6IElNZXNzYWdlQnVpbGRlciB7XG4gICAgICAgIHRoaXMubXNnLmF0dGFjaG1lbnRzID0gYXR0YWNobWVudHM7XG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0QXR0YWNobWVudHMoKTogQXJyYXk8SU1lc3NhZ2VBdHRhY2htZW50PiB7XG4gICAgICAgIHJldHVybiB0aGlzLm1zZy5hdHRhY2htZW50cyE7XG4gICAgfVxuXG4gICAgcHVibGljIHJlcGxhY2VBdHRhY2htZW50KHBvc2l0aW9uOiBudW1iZXIsIGF0dGFjaG1lbnQ6IElNZXNzYWdlQXR0YWNobWVudCk6IElNZXNzYWdlQnVpbGRlciB7XG4gICAgICAgIGlmICghdGhpcy5tc2cuYXR0YWNobWVudHMpIHtcbiAgICAgICAgICAgIHRoaXMubXNnLmF0dGFjaG1lbnRzID0gW107XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMubXNnLmF0dGFjaG1lbnRzW3Bvc2l0aW9uXSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBhdHRhY2htZW50IGZvdW5kIGF0IHRoZSBpbmRleCBvZiBcIiR7cG9zaXRpb259XCIgdG8gcmVwbGFjZS5gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubXNnLmF0dGFjaG1lbnRzW3Bvc2l0aW9uXSA9IGF0dGFjaG1lbnQ7XG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVtb3ZlQXR0YWNobWVudChwb3NpdGlvbjogbnVtYmVyKTogSU1lc3NhZ2VCdWlsZGVyIHtcbiAgICAgICAgaWYgKCF0aGlzLm1zZy5hdHRhY2htZW50cykge1xuICAgICAgICAgICAgdGhpcy5tc2cuYXR0YWNobWVudHMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5tc2cuYXR0YWNobWVudHNbcG9zaXRpb25dKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGF0dGFjaG1lbnQgZm91bmQgYXQgdGhlIGluZGV4IG9mIFwiJHtwb3NpdGlvbn1cIiB0byByZW1vdmUuYCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1zZy5hdHRhY2htZW50cy5zcGxpY2UocG9zaXRpb24sIDEpO1xuXG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0RWRpdG9yKHVzZXI6IElVc2VyKTogSU1lc3NhZ2VCdWlsZGVyIHtcbiAgICAgICAgdGhpcy5tc2cuZWRpdG9yID0gdXNlcjtcbiAgICAgICAgcmV0dXJuIHRoaXMgYXMgSU1lc3NhZ2VCdWlsZGVyO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRFZGl0b3IoKTogSVVzZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5tc2cuZWRpdG9yO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRHcm91cGFibGUoZ3JvdXBhYmxlOiBib29sZWFuKTogSU1lc3NhZ2VCdWlsZGVyIHtcbiAgICAgICAgdGhpcy5tc2cuZ3JvdXBhYmxlID0gZ3JvdXBhYmxlO1xuICAgICAgICByZXR1cm4gdGhpcyBhcyBJTWVzc2FnZUJ1aWxkZXI7XG4gICAgfVxuXG4gICAgcHVibGljIGdldEdyb3VwYWJsZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubXNnLmdyb3VwYWJsZSE7XG4gICAgfVxuXG4gICAgcHVibGljIHNldFBhcnNlVXJscyhwYXJzZVVybHM6IGJvb2xlYW4pOiBJTWVzc2FnZUJ1aWxkZXIge1xuICAgICAgICB0aGlzLm1zZy5wYXJzZVVybHMgPSBwYXJzZVVybHM7XG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UGFyc2VVcmxzKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5tc2cucGFyc2VVcmxzITtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0TWVzc2FnZSgpOiBJTWVzc2FnZSB7XG4gICAgICAgIGlmICghdGhpcy5tc2cucm9vbSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgXCJyb29tXCIgcHJvcGVydHkgaXMgcmVxdWlyZWQuJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5tc2c7XG4gICAgfVxuXG4gICAgcHVibGljIGFkZEJsb2NrcyhibG9ja3M6IEJsb2NrQnVpbGRlciB8IEFycmF5PElCbG9jayB8IExheW91dEJsb2NrPikge1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodGhpcy5tc2cuYmxvY2tzKSkge1xuICAgICAgICAgICAgdGhpcy5tc2cuYmxvY2tzID0gW107XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYmxvY2tzIGluc3RhbmNlb2YgQmxvY2tCdWlsZGVyKSB7XG4gICAgICAgICAgICB0aGlzLm1zZy5ibG9ja3MucHVzaCguLi5ibG9ja3MuZ2V0QmxvY2tzKCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5tc2cuYmxvY2tzLnB1c2goLi4uYmxvY2tzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0QmxvY2tzKGJsb2NrczogQmxvY2tCdWlsZGVyIHwgQXJyYXk8SUJsb2NrIHwgTGF5b3V0QmxvY2s+KSB7XG4gICAgICAgIGlmIChibG9ja3MgaW5zdGFuY2VvZiBCbG9ja0J1aWxkZXIpIHtcbiAgICAgICAgICAgIHRoaXMubXNnLmJsb2NrcyA9IGJsb2Nrcy5nZXRCbG9ja3MoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubXNnLmJsb2NrcyA9IGJsb2NrcztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0QmxvY2tzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tc2cuYmxvY2tzITtcbiAgICB9XG5cbiAgICBwdWJsaWMgYWRkQ3VzdG9tRmllbGQoa2V5OiBzdHJpbmcsIHZhbHVlOiB1bmtub3duKTogSU1lc3NhZ2VCdWlsZGVyIHtcbiAgICAgICAgaWYgKCF0aGlzLm1zZy5jdXN0b21GaWVsZHMpIHtcbiAgICAgICAgICAgIHRoaXMubXNnLmN1c3RvbUZpZWxkcyA9IHt9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMubXNnLmN1c3RvbUZpZWxkc1trZXldKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBtZXNzYWdlIGFscmVhZHkgY29udGFpbnMgYSBjdXN0b20gZmllbGQgYnkgdGhlIGtleTogJHtrZXl9YCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoa2V5LmluY2x1ZGVzKCcuJykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGdpdmVuIGtleSBjb250YWlucyBhIHBlcmlvZCwgd2hpY2ggaXMgbm90IGFsbG93ZWQuIEtleTogJHtrZXl9YCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1zZy5jdXN0b21GaWVsZHNba2V5XSA9IHZhbHVlO1xuXG4gICAgICAgIHJldHVybiB0aGlzIGFzIElNZXNzYWdlQnVpbGRlcjtcbiAgICB9XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBVUEsU0FBUyxZQUFZLFFBQVEsb0JBQW9CO0FBQ2pELFNBQVMsT0FBTyxRQUFRLDBCQUEwQjtBQUVsRCxN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