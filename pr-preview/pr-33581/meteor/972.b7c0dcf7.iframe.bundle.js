"use strict";(self.webpackChunk_rocket_chat_meteor=self.webpackChunk_rocket_chat_meteor||[]).push([[972],{"./client/components/InfoPanel/RetentionPolicyCallout.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var _rocket_chat_fuselage__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../packages/ui-contexts/dist/index.js"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/index.js"),_hooks_usePruneWarningMessage__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./client/hooks/usePruneWarningMessage.ts"),_withErrorBoundary__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./client/components/withErrorBoundary.tsx"),RetentionPolicyCallout=function RetentionPolicyCallout(_ref){var room=_ref.room,message=(0,_hooks_usePruneWarningMessage__WEBPACK_IMPORTED_MODULE_3__.l)(room),t=(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_1__.useTranslation)();return react__WEBPACK_IMPORTED_MODULE_2__.createElement(_rocket_chat_fuselage__WEBPACK_IMPORTED_MODULE_0__.Callout,{"arial-label":t("Retention_policy_warning_callout"),role:"alert","aria-live":"polite",type:"warning"},react__WEBPACK_IMPORTED_MODULE_2__.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_2__.createElement("p",null,message)))};__webpack_exports__.A=(0,_withErrorBoundary__WEBPACK_IMPORTED_MODULE_4__.X)(RetentionPolicyCallout),RetentionPolicyCallout.__docgenInfo={description:"",methods:[],displayName:"RetentionPolicyCallout",props:{room:{required:!0,tsType:{name:"IRoom"},description:""}}}},"./client/components/InfoPanel/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{jj:function(){return InfoPanel_InfoPanel},ZF:function(){return InfoPanel_InfoPanelAction},_v:function(){return InfoPanel_InfoPanelActionGroup},Y$:function(){return InfoPanel_InfoPanelAvatar},z6:function(){return InfoPanel_InfoPanelField},pm:function(){return InfoPanel_InfoPanelLabel},st:function(){return InfoPanel_InfoPanelSection},kq:function(){return InfoPanel_InfoPanelText},ly:function(){return InfoPanel_InfoPanelTitle}});var fuselage=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),react=__webpack_require__("./node_modules/react/index.js"),InfoPanel=function InfoPanel(_ref){var children=_ref.children;return react.createElement(fuselage.Box,{flexGrow:1,mb:"neg-x24"},children)},InfoPanel_InfoPanel=InfoPanel;InfoPanel.__docgenInfo={description:"",methods:[],displayName:"InfoPanel",props:{children:{required:!1,tsType:{name:"ReactNode"},description:""}}};var _excluded=["label","icon"];function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}var InfoPanelAction=function InfoPanelAction(_ref){var label=_ref.label,icon=_ref.icon,props=function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_ref,_excluded);return react.createElement(fuselage.Button,_extends({title:"string"==typeof label?label:void 0,"aria-label":"string"==typeof label?label:void 0},props,{icon:icon}),label)},InfoPanel_InfoPanelAction=InfoPanelAction;function InfoPanelSection_extends(){return InfoPanelSection_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},InfoPanelSection_extends.apply(null,arguments)}InfoPanelAction.__docgenInfo={description:"",methods:[],displayName:"InfoPanelAction",props:{icon:{required:!1,tsType:{name:"IconName"},description:""},label:{required:!0,tsType:{name:"ReactNode"},description:""}}};var InfoPanelSection=function InfoPanelSection(props){return react.createElement(fuselage.Box,InfoPanelSection_extends({mb:24},props))},InfoPanel_InfoPanelSection=InfoPanelSection;function InfoPanelActionGroup_extends(){return InfoPanelActionGroup_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},InfoPanelActionGroup_extends.apply(null,arguments)}InfoPanelSection.__docgenInfo={description:"",methods:[],displayName:"InfoPanelSection"};var InfoPanelActionGroup=function InfoPanelActionGroup(props){return react.createElement(InfoPanel_InfoPanelSection,null,react.createElement(fuselage.ButtonGroup,InfoPanelActionGroup_extends({align:"center",stretch:!0},props)))},InfoPanel_InfoPanelActionGroup=InfoPanelActionGroup;InfoPanelActionGroup.__docgenInfo={description:"",methods:[],displayName:"InfoPanelActionGroup"};var InfoPanelAvatar=function InfoPanelAvatar(_ref){var children=_ref.children;return react.createElement(InfoPanel_InfoPanelSection,{display:"flex",justifyContent:"center"},children)},InfoPanel_InfoPanelAvatar=InfoPanelAvatar;InfoPanelAvatar.__docgenInfo={description:"",methods:[],displayName:"InfoPanelAvatar",props:{children:{required:!1,tsType:{name:"ReactNode"},description:""}}};var InfoPanelField=function InfoPanelField(_ref){var children=_ref.children;return react.createElement(fuselage.Box,{mb:16},children)},InfoPanel_InfoPanelField=InfoPanelField;function InfoPanelLabel_extends(){return InfoPanelLabel_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},InfoPanelLabel_extends.apply(null,arguments)}InfoPanelField.__docgenInfo={description:"",methods:[],displayName:"InfoPanelField",props:{children:{required:!1,tsType:{name:"ReactNode"},description:""}}};var _templateObject,InfoPanelLabel=function InfoPanelLabel(props){return react.createElement(fuselage.Box,InfoPanelLabel_extends({mb:8,fontScale:"p2m",color:"default"},props))},InfoPanel_InfoPanelLabel=InfoPanelLabel;function InfoPanelText_extends(){return InfoPanelText_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},InfoPanelText_extends.apply(null,arguments)}InfoPanelLabel.__docgenInfo={description:"",methods:[],displayName:"InfoPanelLabel"};var wordBreak=(0,__webpack_require__("./node_modules/@rocket.chat/css-in-js/dist/index.module.js").css)(_templateObject||(_templateObject=function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n\tword-break: break-word;\n"]))),InfoPanelText=function InfoPanelText(props){return react.createElement(fuselage.Box,InfoPanelText_extends({mb:8,fontScale:"p2",color:"hint",className:wordBreak},props))},InfoPanel_InfoPanelText=InfoPanelText;InfoPanelText.__docgenInfo={description:"",methods:[],displayName:"InfoPanelText"};var InfoPanelTitle=function InfoPanelTitle(_ref){var title=_ref.title,icon=_ref.icon;return react.createElement(fuselage.Box,{display:"flex",flexShrink:0,alignItems:"center",fontScale:"h4",color:"default",withTruncatedText:!0},function isValidIcon(icon){return"string"==typeof icon}(icon)?react.createElement(fuselage.Icon,{name:icon,size:"x22"}):icon,react.createElement(fuselage.Box,{mis:8,withTruncatedText:!0,title:title},title))},InfoPanel_InfoPanelTitle=InfoPanelTitle;InfoPanelTitle.__docgenInfo={description:"",methods:[],displayName:"InfoPanelTitle",props:{title:{required:!0,tsType:{name:"string"},description:""},icon:{required:!0,tsType:{name:"ReactNode"},description:""}}}},"./client/components/withErrorBoundary.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{X:function(){return withErrorBoundary}});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_error_boundary__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-error-boundary/dist/react-error-boundary.umd.js");function withErrorBoundary(Component){var _ref,_Component$displayNam,fallback=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,WrappedComponent=function WrappedComponent(props){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_error_boundary__WEBPACK_IMPORTED_MODULE_1__.ErrorBoundary,{fallback:react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,fallback)},react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component,props))};return WrappedComponent.displayName="withErrorBoundary(".concat(null!==(_ref=null!==(_Component$displayNam=Component.displayName)&&void 0!==_Component$displayNam?_Component$displayNam:Component.name)&&void 0!==_ref?_ref:"Component",")"),WrappedComponent}},"./client/hooks/usePruneWarningMessage.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{l:function(){return usePruneWarningMessage}});var index_module=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),dist=__webpack_require__("../../packages/ui-contexts/dist/index.js"),cron=__webpack_require__("./node_modules/cron/lib/cron.js"),intlFormat=__webpack_require__("./node_modules/date-fns/esm/intlFormat/index.js"),react=__webpack_require__("./node_modules/react/index.js");var useRetentionPolicy=__webpack_require__("./client/views/room/hooks/useRetentionPolicy.ts"),moment=__webpack_require__("./node_modules/moment/moment.js"),moment_default=__webpack_require__.n(moment);function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var getNextRunDate=function getNextRunDate(_ref2){var enableAdvancedCronTimer=_ref2.enableAdvancedCronTimer,cronPrecision=_ref2.cronPrecision,advancedCronTimer=_ref2.advancedCronTimer;return enableAdvancedCronTimer?(0,cron.sendAt)(advancedCronTimer):(0,cron.sendAt)(function getCronAdvancedTimerFromPrecisionSetting(precision){switch(precision){case"0":return"*/30 * * * *";case"1":return"0 * * * *";case"2":return"0 */6 * * *";case"3":return"0 0 * * *"}}(cronPrecision))},usePruneWarningMessage=function usePruneWarningMessage(room){var retention=(0,useRetentionPolicy._)(room);if(!retention)throw new Error("usePruneWarningMessage - No room provided");var maxAge=retention.maxAge,filesOnly=retention.filesOnly,excludePinned=retention.excludePinned,cronPrecision=String((0,dist.useSetting)("RetentionPolicy_Precision")),t=(0,dist.useTranslation)(),enableAdvancedCronTimer=Boolean((0,dist.useSetting)("RetentionPolicy_Advanced_Precision")),advancedCronTimer=String((0,dist.useSetting)("RetentionPolicy_Advanced_Precision_Cron")),message=function getMessage(_ref){var filesOnly=_ref.filesOnly,excludePinned=_ref.excludePinned;return filesOnly?excludePinned?"RetentionPolicy_RoomWarning_UnpinnedFilesOnly_NextRunDate":"RetentionPolicy_RoomWarning_FilesOnly_NextRunDate":excludePinned?"RetentionPolicy_RoomWarning_Unpinned_NextRunDate":"RetentionPolicy_RoomWarning_NextRunDate"}({filesOnly:filesOnly,excludePinned:excludePinned}),nextRunDate=function useNextRunDate(_ref3){var enableAdvancedCronTimer=_ref3.enableAdvancedCronTimer,advancedCronTimer=_ref3.advancedCronTimer,cronPrecision=_ref3.cronPrecision,_useSafely2=_slicedToArray((0,index_module.useSafely)((0,react.useState)(getNextRunDate({enableAdvancedCronTimer:enableAdvancedCronTimer,advancedCronTimer:advancedCronTimer,cronPrecision:cronPrecision}))),2),nextRunDate=_useSafely2[0],setNextRunDate=_useSafely2[1],lang=(0,dist.useLanguage)();return(0,react.useEffect)((function(){var timeoutBetweenRunAndNow=nextRunDate.valueOf()-Date.now(),timeout=setTimeout((function(){return setNextRunDate(getNextRunDate({enableAdvancedCronTimer:enableAdvancedCronTimer,advancedCronTimer:advancedCronTimer,cronPrecision:cronPrecision}))}),timeoutBetweenRunAndNow);return function(){return clearTimeout(timeout)}}),[advancedCronTimer,cronPrecision,enableAdvancedCronTimer,nextRunDate,setNextRunDate]),(0,intlFormat.A)(new Date(nextRunDate.valueOf()),{localeMatcher:"best fit",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"},{locale:lang})}({enableAdvancedCronTimer:enableAdvancedCronTimer,advancedCronTimer:advancedCronTimer,cronPrecision:cronPrecision});return t(message,{maxAge:function useFormattedRelativeTime(timeMs){return(0,react.useMemo)((function(){return moment_default().relativeTimeThreshold("s",60),moment_default().relativeTimeThreshold("ss",0),moment_default().relativeTimeThreshold("m",60),moment_default().relativeTimeThreshold("h",24),moment_default().relativeTimeThreshold("d",31),moment_default().relativeTimeThreshold("M",12),moment_default().duration(timeMs).humanize()}),[timeMs])}(maxAge),nextRunDate:nextRunDate})}},"./client/lib/convertTimeUnit.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{k2:function(){return TIMEUNIT},ru:function(){return msToTimeUnit},vK:function(){return timeUnitToMs},yO:function(){return isValidTimespan}});var TIMEUNIT=function(TIMEUNIT){return TIMEUNIT.days="days",TIMEUNIT.hours="hours",TIMEUNIT.minutes="minutes",TIMEUNIT}({}),isValidTimespan=function isValidTimespan(timespan){return!Number.isNaN(timespan)&&(!!Number.isFinite(timespan)&&!(timespan<0))},timeUnitToMs=function timeUnitToMs(unit,timespan){if(!isValidTimespan(timespan))throw new Error("timeUnitToMs - invalid timespan:".concat(timespan));switch(unit){case TIMEUNIT.days:return 24*timespan*60*60*1e3;case TIMEUNIT.hours:return 60*timespan*60*1e3;case TIMEUNIT.minutes:return 60*timespan*1e3;default:throw new Error("timeUnitToMs - invalid time unit")}},msToTimeUnit=function msToTimeUnit(unit,timespan){if(!isValidTimespan(timespan))throw new Error("msToTimeUnit - invalid timespan:".concat(timespan));switch(unit){case TIMEUNIT.days:return timespan/24/60/60/1e3;case TIMEUNIT.hours:return timespan/60/60/1e3;case TIMEUNIT.minutes:return timespan/60/1e3;default:throw new Error("msToTimeUnit - invalid time unit")}}},"./client/views/room/hooks/useRetentionPolicy.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{_:function(){return useRetentionPolicy}});var _rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../packages/ui-contexts/dist/index.js"),_lib_convertTimeUnit__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./client/lib/convertTimeUnit.ts"),hasRetentionPolicy=function hasRetentionPolicy(room){return"retention"in room&&void 0!==room.retention},isRetentionOverridden=function isRetentionOverridden(room){return"overrideGlobal"in room.retention&&room.retention.overrideGlobal},isActive=function isActive(room,_ref){var enabled=_ref.enabled,appliesToChannels=_ref.appliesToChannels,appliesToGroups=_ref.appliesToGroups,appliesToDMs=_ref.appliesToDMs;if(!enabled)return!1;if(hasRetentionPolicy(room)&&void 0!==room.retention.enabled)return room.retention.enabled;switch(room.t){case"c":return appliesToChannels;case"p":return appliesToGroups;case"d":return appliesToDMs}return!1},extractFilesOnly=function extractFilesOnly(room,_ref2){var filesOnly=_ref2.filesOnly;return hasRetentionPolicy(room)&&isRetentionOverridden(room)?room.retention.filesOnly:filesOnly},extractExcludePinned=function extractExcludePinned(room,_ref3){var doNotPrunePinned=_ref3.doNotPrunePinned;return hasRetentionPolicy(room)&&isRetentionOverridden(room)?room.retention.excludePinned:doNotPrunePinned},extractIgnoreThreads=function extractIgnoreThreads(room,_ref4){var ignoreThreads=_ref4.ignoreThreads;return hasRetentionPolicy(room)&&isRetentionOverridden(room)?room.retention.ignoreThreads:ignoreThreads},getMaxAge=function getMaxAge(room,_ref5){var maxAgeChannels=_ref5.maxAgeChannels,maxAgeGroups=_ref5.maxAgeGroups,maxAgeDMs=_ref5.maxAgeDMs;return hasRetentionPolicy(room)&&isRetentionOverridden(room)&&(0,_lib_convertTimeUnit__WEBPACK_IMPORTED_MODULE_1__.yO)(room.retention.maxAge)?(0,_lib_convertTimeUnit__WEBPACK_IMPORTED_MODULE_1__.vK)(_lib_convertTimeUnit__WEBPACK_IMPORTED_MODULE_1__.k2.days,room.retention.maxAge):"c"===room.t?maxAgeChannels:"p"===room.t?maxAgeGroups:"d"===room.t?maxAgeDMs:-1/0},useRetentionPolicy=function useRetentionPolicy(room){var settings={enabled:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_Enabled"),filesOnly:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_FilesOnly"),doNotPrunePinned:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_DoNotPrunePinned"),ignoreThreads:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_DoNotPruneThreads"),appliesToChannels:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_AppliesToChannels"),maxAgeChannels:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_TTL_Channels"),appliesToGroups:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_AppliesToGroups"),maxAgeGroups:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_TTL_Groups"),appliesToDMs:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_AppliesToDMs"),maxAgeDMs:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_TTL_DMs")};if(room)return{enabled:settings.enabled,isActive:isActive(room,settings),filesOnly:extractFilesOnly(room,settings),excludePinned:extractExcludePinned(room,settings),ignoreThreads:extractIgnoreThreads(room,settings),maxAge:getMaxAge(room,settings)}}}}]);