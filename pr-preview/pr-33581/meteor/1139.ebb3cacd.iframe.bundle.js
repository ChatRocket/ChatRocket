/*! For license information please see 1139.ebb3cacd.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_rocket_chat_meteor=self.webpackChunk_rocket_chat_meteor||[]).push([[1139],{"./client/components/withErrorBoundary.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{X:function(){return withErrorBoundary}});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),react_error_boundary__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react-error-boundary/dist/react-error-boundary.umd.js");function withErrorBoundary(Component){var _ref,_Component$displayNam,fallback=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,WrappedComponent=function WrappedComponent(props){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_error_boundary__WEBPACK_IMPORTED_MODULE_1__.ErrorBoundary,{fallback:react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,fallback)},react__WEBPACK_IMPORTED_MODULE_0__.createElement(Component,props))};return WrappedComponent.displayName="withErrorBoundary(".concat(null!==(_ref=null!==(_Component$displayNam=Component.displayName)&&void 0!==_Component$displayNam?_Component$displayNam:Component.name)&&void 0!==_ref?_ref:"Component",")"),WrappedComponent}},"./client/hooks/usePruneWarningMessage.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{l:function(){return usePruneWarningMessage}});var index_module=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),dist=__webpack_require__("../../packages/ui-contexts/dist/index.js"),cron=__webpack_require__("./node_modules/cron/lib/cron.js"),intlFormat=__webpack_require__("./node_modules/date-fns/esm/intlFormat/index.js"),react=__webpack_require__("./node_modules/react/index.js");var useRetentionPolicy=__webpack_require__("./client/views/room/hooks/useRetentionPolicy.ts"),moment=__webpack_require__("./node_modules/moment/moment.js"),moment_default=__webpack_require__.n(moment);function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var getNextRunDate=function getNextRunDate(_ref2){var enableAdvancedCronTimer=_ref2.enableAdvancedCronTimer,cronPrecision=_ref2.cronPrecision,advancedCronTimer=_ref2.advancedCronTimer;return enableAdvancedCronTimer?(0,cron.sendAt)(advancedCronTimer):(0,cron.sendAt)(function getCronAdvancedTimerFromPrecisionSetting(precision){switch(precision){case"0":return"*/30 * * * *";case"1":return"0 * * * *";case"2":return"0 */6 * * *";case"3":return"0 0 * * *"}}(cronPrecision))},usePruneWarningMessage=function usePruneWarningMessage(room){var retention=(0,useRetentionPolicy._)(room);if(!retention)throw new Error("usePruneWarningMessage - No room provided");var maxAge=retention.maxAge,filesOnly=retention.filesOnly,excludePinned=retention.excludePinned,cronPrecision=String((0,dist.useSetting)("RetentionPolicy_Precision")),t=(0,dist.useTranslation)(),enableAdvancedCronTimer=Boolean((0,dist.useSetting)("RetentionPolicy_Advanced_Precision")),advancedCronTimer=String((0,dist.useSetting)("RetentionPolicy_Advanced_Precision_Cron")),message=function getMessage(_ref){var filesOnly=_ref.filesOnly,excludePinned=_ref.excludePinned;return filesOnly?excludePinned?"RetentionPolicy_RoomWarning_UnpinnedFilesOnly_NextRunDate":"RetentionPolicy_RoomWarning_FilesOnly_NextRunDate":excludePinned?"RetentionPolicy_RoomWarning_Unpinned_NextRunDate":"RetentionPolicy_RoomWarning_NextRunDate"}({filesOnly:filesOnly,excludePinned:excludePinned}),nextRunDate=function useNextRunDate(_ref3){var enableAdvancedCronTimer=_ref3.enableAdvancedCronTimer,advancedCronTimer=_ref3.advancedCronTimer,cronPrecision=_ref3.cronPrecision,_useSafely2=_slicedToArray((0,index_module.useSafely)((0,react.useState)(getNextRunDate({enableAdvancedCronTimer:enableAdvancedCronTimer,advancedCronTimer:advancedCronTimer,cronPrecision:cronPrecision}))),2),nextRunDate=_useSafely2[0],setNextRunDate=_useSafely2[1],lang=(0,dist.useLanguage)();return(0,react.useEffect)((function(){var timeoutBetweenRunAndNow=nextRunDate.valueOf()-Date.now(),timeout=setTimeout((function(){return setNextRunDate(getNextRunDate({enableAdvancedCronTimer:enableAdvancedCronTimer,advancedCronTimer:advancedCronTimer,cronPrecision:cronPrecision}))}),timeoutBetweenRunAndNow);return function(){return clearTimeout(timeout)}}),[advancedCronTimer,cronPrecision,enableAdvancedCronTimer,nextRunDate,setNextRunDate]),(0,intlFormat.A)(new Date(nextRunDate.valueOf()),{localeMatcher:"best fit",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"},{locale:lang})}({enableAdvancedCronTimer:enableAdvancedCronTimer,advancedCronTimer:advancedCronTimer,cronPrecision:cronPrecision});return t(message,{maxAge:function useFormattedRelativeTime(timeMs){return(0,react.useMemo)((function(){return moment_default().relativeTimeThreshold("s",60),moment_default().relativeTimeThreshold("ss",0),moment_default().relativeTimeThreshold("m",60),moment_default().relativeTimeThreshold("h",24),moment_default().relativeTimeThreshold("d",31),moment_default().relativeTimeThreshold("M",12),moment_default().duration(timeMs).humanize()}),[timeMs])}(maxAge),nextRunDate:nextRunDate})}},"./client/lib/convertTimeUnit.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{k2:function(){return TIMEUNIT},ru:function(){return msToTimeUnit},vK:function(){return timeUnitToMs},yO:function(){return isValidTimespan}});var TIMEUNIT=function(TIMEUNIT){return TIMEUNIT.days="days",TIMEUNIT.hours="hours",TIMEUNIT.minutes="minutes",TIMEUNIT}({}),isValidTimespan=function isValidTimespan(timespan){return!Number.isNaN(timespan)&&(!!Number.isFinite(timespan)&&!(timespan<0))},timeUnitToMs=function timeUnitToMs(unit,timespan){if(!isValidTimespan(timespan))throw new Error("timeUnitToMs - invalid timespan:".concat(timespan));switch(unit){case TIMEUNIT.days:return 24*timespan*60*60*1e3;case TIMEUNIT.hours:return 60*timespan*60*1e3;case TIMEUNIT.minutes:return 60*timespan*1e3;default:throw new Error("timeUnitToMs - invalid time unit")}},msToTimeUnit=function msToTimeUnit(unit,timespan){if(!isValidTimespan(timespan))throw new Error("msToTimeUnit - invalid timespan:".concat(timespan));switch(unit){case TIMEUNIT.days:return timespan/24/60/60/1e3;case TIMEUNIT.hours:return timespan/60/60/1e3;case TIMEUNIT.minutes:return timespan/60/1e3;default:throw new Error("msToTimeUnit - invalid time unit")}}},"./client/lib/federation/Federation.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{AT:function(){return isEditableByTheUser},JG:function(){return canCreateInviteLinks}});var _rocket_chat_core_typings__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../packages/core-typings/dist/index.js"),_definition_IRoomTypeConfig__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./app/models/client/index.ts"),__webpack_require__("./definition/IRoomTypeConfig.ts")),isEditableByTheUser=(_definition_IRoomTypeConfig__WEBPACK_IMPORTED_MODULE_2__.b6.REMOVE_USER,_definition_IRoomTypeConfig__WEBPACK_IMPORTED_MODULE_2__.b6.SET_AS_OWNER,_definition_IRoomTypeConfig__WEBPACK_IMPORTED_MODULE_2__.b6.SET_AS_MODERATOR,_definition_IRoomTypeConfig__WEBPACK_IMPORTED_MODULE_2__.Iq.NAME,_definition_IRoomTypeConfig__WEBPACK_IMPORTED_MODULE_2__.Iq.TOPIC,function isEditableByTheUser(user,room,subscription){var _subscription$roles,_subscription$roles2;return!!(user&&room&&subscription)&&((0,_rocket_chat_core_typings__WEBPACK_IMPORTED_MODULE_0__.isRoomFederated)(room)&&Boolean((null===(_subscription$roles=subscription.roles)||void 0===_subscription$roles?void 0:_subscription$roles.includes("owner"))||(null===(_subscription$roles2=subscription.roles)||void 0===_subscription$roles2?void 0:_subscription$roles2.includes("moderator"))))}),canCreateInviteLinks=function canCreateInviteLinks(user,room,subscription){var _subscription$roles3,_subscription$roles4;return!!(user&&room&&subscription)&&((0,_rocket_chat_core_typings__WEBPACK_IMPORTED_MODULE_0__.isRoomFederated)(room)&&(0,_rocket_chat_core_typings__WEBPACK_IMPORTED_MODULE_0__.isPublicRoom)(room)&&Boolean((null===(_subscription$roles3=subscription.roles)||void 0===_subscription$roles3?void 0:_subscription$roles3.includes("owner"))||(null===(_subscription$roles4=subscription.roles)||void 0===_subscription$roles4?void 0:_subscription$roles4.includes("moderator"))))}},"./client/lib/voip/parseOutboundPhoneNumber.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{X:function(){return parseOutboundPhoneNumber}});var parseOutboundPhoneNumber=function parseOutboundPhoneNumber(phoneNumber){return phoneNumber?phoneNumber.replace(/\*/g,"+"):""}},"./client/views/room/Announcement/index.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:function(){return Announcement_Announcement}});var _templateObject,fuselage=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),index_module=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),dist=__webpack_require__("../../packages/ui-contexts/dist/index.js"),react=__webpack_require__("./node_modules/react/index.js"),GenericModal=__webpack_require__("./client/components/GenericModal/index.ts"),MarkdownText=__webpack_require__("./client/components/MarkdownText.tsx"),dist_index_module=__webpack_require__("./node_modules/@rocket.chat/css-in-js/dist/index.module.js");var AnnouncementComponent=function AnnouncementComponent(_ref){var children=_ref.children,onClickOpen=_ref.onClickOpen,announcementBar=(0,dist_index_module.css)(_templateObject||(_templateObject=function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n\t\tbackground-color: ",";\n\t\tcolor: ",";\n\t\tcursor: pointer;\n\t\ttransition: transform 0.2s ease-out;\n\t\ta:link {\n\t\t\tcolor: ",";\n\t\t\ttext-decoration: underline;\n\t\t}\n\t\t> * {\n\t\t\tflex: auto;\n\t\t}\n\t\t&:hover,\n\t\t&:focus {\n\t\t\ttext-decoration: underline;\n\t\t}\n\t"])),fuselage.Palette.status["status-background-info"].theme("announcement-background"),fuselage.Palette.text["font-pure-black"].theme("announcement-text"),fuselage.Palette.text["font-pure-black"].theme("announcement-text"));return react.createElement(fuselage.Box,{onClick:onClickOpen,height:"x40",pi:24,alignItems:"center",display:"flex",fontScale:"p2m",textAlign:"center",className:announcementBar},react.createElement(fuselage.Box,{withTruncatedText:!0,w:"none","data-qa":"AnnouncementAnnoucementComponent"},children))},Announcement_AnnouncementComponent=AnnouncementComponent;AnnouncementComponent.__docgenInfo={description:"",methods:[],displayName:"AnnouncementComponent",props:{children:{required:!1,tsType:{name:"ReactNode"},description:""},onClickOpen:{required:!0,tsType:{name:"signature",type:"function",raw:"(e: MouseEvent<HTMLAnchorElement>) => void",signature:{arguments:[{type:{name:"MouseEvent",elements:[{name:"HTMLAnchorElement"}],raw:"MouseEvent<HTMLAnchorElement>"},name:"e"}],return:{name:"void"}}},description:""}}};var Announcement=function Announcement(_ref){var announcement=_ref.announcement,announcementDetails=_ref.announcementDetails,t=(0,dist.useTranslation)(),setModal=(0,dist.useSetModal)(),closeModal=(0,index_module.useMutableCallback)((function(){return setModal(null)}));return announcement?react.createElement(Announcement_AnnouncementComponent,{onClickOpen:function onClickOpen(e){return function handleClick(e){var _window;e.target.href||""===(null===(_window=window)||void 0===_window||null===(_window=_window.getSelection())||void 0===_window?void 0:_window.toString())&&(announcementDetails?announcementDetails():setModal(react.createElement(GenericModal.A,{icon:null,title:t("Announcement"),confirmText:t("Close"),onConfirm:closeModal,onClose:closeModal},react.createElement(fuselage.Box,{overflow:"hidden",wordBreak:"break-word"},react.createElement(MarkdownText.A,{content:announcement,parseEmoji:!0})))))}(e)}},react.createElement(MarkdownText.A,{variant:"inlineWithoutBreaks",content:announcement,withTruncatedText:!0,parseEmoji:!0})):null},Announcement_Announcement=Announcement;Announcement.__docgenInfo={description:"",methods:[],displayName:"Announcement",props:{announcement:{required:!0,tsType:{name:"string"},description:""},announcementDetails:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}}},"./client/views/room/MessageList/lib/isMessageSequential.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{H:function(){return isMessageSequential}});var date_fns__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/date-fns/esm/differenceInSeconds/index.js"),_app_ui_utils_lib_MessageTypes__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./app/ui-utils/lib/MessageTypes.ts"),_isMessageNewDay__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./client/views/room/MessageList/lib/isMessageNewDay.ts"),isMessageSequential=function isMessageSequential(current,previous,groupingRange){return!!previous&&(!_app_ui_utils_lib_MessageTypes__WEBPACK_IMPORTED_MODULE_0__.l.isSystemMessage(current)&&!_app_ui_utils_lib_MessageTypes__WEBPACK_IMPORTED_MODULE_0__.l.isSystemMessage(previous)&&(current.tmid?[previous.tmid,previous._id].includes(current.tmid):!previous.tmid&&(!1!==current.groupable&&(current.u._id===previous.u._id&&(current.alias===previous.alias&&((0,date_fns__WEBPACK_IMPORTED_MODULE_1__.A)(current.ts,previous.ts)<groupingRange&&!(0,_isMessageNewDay__WEBPACK_IMPORTED_MODULE_2__.O)(current,previous)))))))}},"./client/views/room/Room.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return room_Room}});var dist=__webpack_require__("../../packages/ui-client/dist/index.js"),ui_contexts_dist=__webpack_require__("../../packages/ui-contexts/dist/index.js"),react=__webpack_require__("./node_modules/react/index.js"),dist_import=__webpack_require__("./node_modules/@react-aria/focus/dist/import.mjs"),react_error_boundary_umd=__webpack_require__("./node_modules/react-error-boundary/dist/react-error-boundary.umd.js"),Contextualbar=__webpack_require__("./client/components/Contextualbar/index.ts"),client=__webpack_require__("./app/e2e/client/index.ts"),E2EEState=__webpack_require__("./app/e2e/client/E2EEState.ts"),E2ERoomState=__webpack_require__("./app/e2e/client/E2ERoomState.ts"),fuselage=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),index_module=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),models_client=__webpack_require__("./app/models/client/index.ts"),isTruthy=__webpack_require__("./lib/isTruthy.ts"),CustomScrollbars=__webpack_require__("./client/components/CustomScrollbars/index.ts"),useEmbeddedLayout=__webpack_require__("./client/hooks/useEmbeddedLayout.ts"),useReactiveQuery=__webpack_require__("./client/hooks/useReactiveQuery.ts"),Announcement=__webpack_require__("./client/views/room/Announcement/index.tsx"),BubbleDate=__webpack_require__("./client/views/room/BubbleDate/index.tsx"),core_typings_dist=__webpack_require__("../../packages/core-typings/dist/index.js"),ui_utils_client=__webpack_require__("./app/ui-utils/client/index.ts"),RoomContext=__webpack_require__("./client/views/room/contexts/RoomContext.ts"),useFirstUnreadMessageId=__webpack_require__("./client/views/room/hooks/useFirstUnreadMessageId.ts"),SelectedMessagesProvider=__webpack_require__("./client/views/room/providers/SelectedMessagesProvider.tsx"),RoomMessage=__webpack_require__("./client/components/message/variants/RoomMessage.tsx"),SystemMessage=__webpack_require__("./client/components/message/variants/SystemMessage.tsx"),ui_avatar_dist=__webpack_require__("../../packages/ui-avatar/dist/index.js"),SelectedMessagesContext=__webpack_require__("./client/views/room/MessageList/contexts/SelectedMessagesContext.tsx"),parseMessageTextToAstMarkdown=__webpack_require__("./client/lib/parseMessageTextToAstMarkdown.ts"),useAutoLinkDomains=__webpack_require__("./client/views/room/MessageList/hooks/useAutoLinkDomains.ts"),useAutoTranslate=__webpack_require__("./client/views/room/MessageList/hooks/useAutoTranslate.ts"),lib=__webpack_require__("../../node_modules/@tanstack/react-query/build/lib/index.js"),callWithErrorHandling=__webpack_require__("./client/lib/utils/callWithErrorHandling.ts"),highOrderFunctions=__webpack_require__("./lib/utils/highOrderFunctions.ts");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var resolve,waiting,pending,getMessages,get,findParentMessage=(waiting=[],pending=new Promise((function(r){resolve=r})),getMessages=(0,highOrderFunctions.z)({wait:500})(_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var _tmp;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:_tmp=[].concat(waiting),waiting.length=0,resolve((0,callWithErrorHandling.g)("getMessages",_tmp)),pending=new Promise((function(r){resolve=r}));case 4:case"end":return _context.stop()}}),_callee)})))),get=function(){var _ref2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(tmid){var messages;return _regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return getMessages(),_context2.next=3,pending;case 3:return messages=_context2.sent,_context2.abrupt("return",messages.find((function(_ref3){return _ref3._id===tmid})));case 5:case"end":return _context2.stop()}}),_callee2)})));return function get(_x){return _ref2.apply(this,arguments)}}(),function(){var _ref4=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(tmid){var message;return _regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!(message=models_client.ChatMessage.findOne({_id:tmid}))){_context3.next=3;break}return _context3.abrupt("return",message);case 3:return-1===waiting.indexOf(tmid)&&waiting.push(tmid),_context3.abrupt("return",get(tmid));case 5:case"end":return _context3.stop()}}),_callee3)})));return function(_x2){return _ref4.apply(this,arguments)}}());function useParentMessage_typeof(o){return useParentMessage_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useParentMessage_typeof(o)}function useParentMessage_regeneratorRuntime(){useParentMessage_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==useParentMessage_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(useParentMessage_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function useParentMessage_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function useParentMessage_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){useParentMessage_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){useParentMessage_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var isParsedMessage=__webpack_require__("./client/views/room/MessageList/lib/isParsedMessage.ts"),useGoToThread=__webpack_require__("./client/views/room/hooks/useGoToThread.ts"),Emoji=__webpack_require__("./client/components/Emoji.tsx"),MessageListContext=__webpack_require__("./client/components/message/list/MessageListContext.tsx"),gazzodown_dist=__webpack_require__("../../packages/gazzodown/dist/index.js"),GazzodownText=__webpack_require__("./client/components/GazzodownText.tsx");function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var ThreadMessagePreviewBody=function ThreadMessagePreviewBody(_ref){var message=_ref.message,t=(0,ui_contexts_dist.useTranslation)(),isEncryptedMessage=(0,core_typings_dist.isE2EEMessage)(message);return function getMessage(){var mdTokens=message.md&&_toConsumableArray(message.md);return message.attachments&&Array.isArray(message.attachments)&&message.attachments.length>0&&(0,core_typings_dist.isQuoteAttachment)(message.attachments[0])&&(null==mdTokens||mdTokens.shift()),message.attachments&&""===message.msg?react.createElement(react.Fragment,null,t("Message_with_attachment")):isEncryptedMessage&&"done"!==message.e2e?isEncryptedMessage&&"pending"===message.e2e?react.createElement(react.Fragment,null,t("E2E_message_encrypted_placeholder")):react.createElement(react.Fragment,null,message.msg):mdTokens?react.createElement(GazzodownText.A,null,react.createElement(gazzodown_dist.XI,{tokens:mdTokens})):react.createElement(react.Fragment,null,message.msg)}()},threadPreview_ThreadMessagePreviewBody=(0,react.memo)(ThreadMessagePreviewBody);function ThreadMessagePreview_typeof(o){return ThreadMessagePreview_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},ThreadMessagePreview_typeof(o)}ThreadMessagePreviewBody.__docgenInfo={description:"",methods:[],displayName:"ThreadMessagePreviewBody",props:{message:{required:!0,tsType:{name:"IMessage"},description:""}}};var _excluded=["message","showUserAvatar","sequential"];function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=ThreadMessagePreview_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=ThreadMessagePreview_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==ThreadMessagePreview_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var ThreadMessagePreview=function ThreadMessagePreview(_ref){var _parentMessage$data2,message=_ref.message,showUserAvatar=_ref.showUserAvatar,sequential=_ref.sequential,props=function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_ref,_excluded),parentMessage=function useParentMessage(mid){return(0,lib.useQuery)(["parent-message",{mid:mid}],useParentMessage_asyncToGenerator(useParentMessage_regeneratorRuntime().mark((function _callee(){return useParentMessage_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",findParentMessage(mid));case 1:case"end":return _context.stop()}}),_callee)}))))}(message.tmid),translated=(0,MessageListContext.pl)(message),t=(0,ui_contexts_dist.useTranslation)(),isSelecting=(0,SelectedMessagesContext.IV)(),toggleSelected=(0,SelectedMessagesContext.GS)(message._id),isSelected=(0,SelectedMessagesContext.qA)(message._id);(0,SelectedMessagesContext.MS)();var messageType=parentMessage.isSuccess?ui_utils_client.MessageTypes.getType(parentMessage.data):null,messageBody=function useMessageBody(message,rid){var subscription=(0,ui_contexts_dist.useUserSubscription)(rid),autoTranslateOptions=(0,useAutoTranslate.F)(subscription),customDomains=(0,useAutoLinkDomains.I)();return(0,react.useMemo)((function(){if(!message)return"";if(message.md){var parseOptions={customDomains:customDomains,emoticons:!0};return(0,parseMessageTextToAstMarkdown.Sr)(message,parseOptions,autoTranslateOptions).md}if(message.msg)return message.msg;if(message.attachments){var attachment=message.attachments.find((function(attachment){return attachment.title||attachment.description}));if(null!=attachment&&attachment.description)return attachment.description;if(null!=attachment&&attachment.title)return attachment.title}return""}),[message,customDomains,autoTranslateOptions])}(parentMessage.data,message.rid),previewMessage=(0,isParsedMessage.T)(messageBody)?{md:messageBody}:{msg:messageBody},goToThread=(0,useGoToThread.R)(),handleThreadClick=function handleThreadClick(){var _parentMessage$data;return isSelecting?toggleSelected():sequential?goToThread({rid:message.rid,tmid:message.tmid,msg:message._id}):parentMessage.isSuccess&&goToThread({rid:message.rid,tmid:message.tmid,msg:null===(_parentMessage$data=parentMessage.data)||void 0===_parentMessage$data?void 0:_parentMessage$data._id})};return react.createElement(fuselage.ThreadMessage,_extends({role:"link","aria-roledescription":"thread message preview",tabIndex:0,onClick:handleThreadClick,onKeyDown:function onKeyDown(e){return"Enter"===e.code&&handleThreadClick()},isSelected:isSelected,"data-qa-selected":isSelected},props),!sequential&&react.createElement(fuselage.ThreadMessageRow,null,react.createElement(fuselage.ThreadMessageLeftContainer,null,react.createElement(fuselage.ThreadMessageIconThread,null)),react.createElement(fuselage.ThreadMessageContainer,null,react.createElement(fuselage.ThreadMessageOrigin,{system:!!messageType},parentMessage.isSuccess&&!messageType&&react.createElement(react.Fragment,null,null!==(_parentMessage$data2=parentMessage.data)&&void 0!==_parentMessage$data2&&_parentMessage$data2.ignored?t("Message_Ignored"):react.createElement(threadPreview_ThreadMessagePreviewBody,{message:_objectSpread(_objectSpread({},parentMessage.data),previewMessage)}),translated&&react.createElement(react.Fragment,null," ",react.createElement(fuselage.MessageStatusIndicatorItem,{name:"language",color:"info",title:t("Translated")}))),messageType&&t(messageType.message,messageType.data?messageType.data(message):{}),parentMessage.isLoading&&react.createElement(fuselage.Skeleton,null)),react.createElement(fuselage.ThreadMessageUnfollow,null))),react.createElement(fuselage.ThreadMessageRow,null,react.createElement(fuselage.ThreadMessageLeftContainer,null,!isSelecting&&showUserAvatar&&react.createElement(ui_avatar_dist.Tx,{emoji:message.emoji?react.createElement(Emoji.A,{emojiHandle:message.emoji,fillContainer:!0}):void 0,username:message.u.username,size:"x18"}),isSelecting&&react.createElement(fuselage.CheckBox,{checked:isSelected,onChange:toggleSelected})),react.createElement(fuselage.ThreadMessageContainer,null,react.createElement(fuselage.ThreadMessageBody,null,message.ignored?t("Message_Ignored"):react.createElement(react.Fragment,null,react.createElement(threadPreview_ThreadMessagePreviewBody,{message:message}),translated&&react.createElement(react.Fragment,null," ",react.createElement(fuselage.MessageStatusIndicatorItem,{name:"language",title:t("Translated")})))))))},variants_ThreadMessagePreview=(0,react.memo)(ThreadMessagePreview);ThreadMessagePreview.__docgenInfo={description:"",methods:[],displayName:"ThreadMessagePreview",props:{message:{required:!0,tsType:{name:"IThreadMessage"},description:""},showUserAvatar:{required:!0,tsType:{name:"boolean"},description:""},sequential:{required:!0,tsType:{name:"boolean"},description:""}}};var useFormatDate=__webpack_require__("./client/hooks/useFormatDate.ts"),DateListProvider=__webpack_require__("./client/views/room/providers/DateListProvider.tsx"),isMessageNewDay=__webpack_require__("./client/views/room/MessageList/lib/isMessageNewDay.ts");function MessageListItem_extends(){return MessageListItem_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},MessageListItem_extends.apply(null,arguments)}var MessageListItem=function MessageListItem(_ref){var _subscription$tunread,_subscription$tunread2,_subscription$tunread3,_subscription$ignored,message=_ref.message,previous=_ref.previous,showUnreadDivider=_ref.showUnreadDivider,sequential=_ref.sequential,showUserAvatar=_ref.showUserAvatar,visible=_ref.visible,subscription=_ref.subscription,system=_ref.system,t=(0,ui_contexts_dist.useTranslation)(),formatDate=(0,useFormatDate.l)(),ref=(0,DateListProvider.$7)(),newDay=(0,isMessageNewDay.O)(message,previous),showDivider=newDay||showUnreadDivider,unread=Boolean(null==subscription||null===(_subscription$tunread=subscription.tunread)||void 0===_subscription$tunread?void 0:_subscription$tunread.includes(message._id)),mention=Boolean(null==subscription||null===(_subscription$tunread2=subscription.tunreadUser)||void 0===_subscription$tunread2?void 0:_subscription$tunread2.includes(message._id)),all=Boolean(null==subscription||null===(_subscription$tunread3=subscription.tunreadGroup)||void 0===_subscription$tunread3?void 0:_subscription$tunread3.includes(message._id)),ignoredUser=Boolean(null==subscription||null===(_subscription$ignored=subscription.ignored)||void 0===_subscription$ignored?void 0:_subscription$ignored.includes(message.u._id)),shouldShowAsSequential=sequential&&!newDay;return react.createElement(react.Fragment,null,showDivider&&react.createElement(fuselage.Box,MessageListItem_extends({ref:ref,"data-id":message.ts,role:"listitem"},newDay&&{"data-time":new Date(message.ts).toISOString().replaceAll(/[-T:.]/g,"").substring(0,8)}),react.createElement(fuselage.MessageDivider,{unreadLabel:showUnreadDivider?t("Unread_Messages").toLowerCase():void 0},newDay&&react.createElement(fuselage.Bubble,{small:!0,secondary:!0},formatDate(message.ts)))),visible&&react.createElement(RoomMessage.A,{message:message,showUserAvatar:showUserAvatar,sequential:shouldShowAsSequential,unread:unread,mention:mention,all:all,ignoredUser:ignoredUser}),(0,core_typings_dist.isThreadMessage)(message)&&react.createElement("li",null,react.createElement(variants_ThreadMessagePreview,{"data-mid":message._id,"data-tmid":message.tmid,"data-unread":showUnreadDivider,"data-sequential":sequential,sequential:shouldShowAsSequential,message:message,showUserAvatar:showUserAvatar})),system&&react.createElement(SystemMessage.A,{showUserAvatar:showUserAvatar,message:message}))};MessageListItem.__docgenInfo={description:"",methods:[],displayName:"MessageListItem",props:{message:{required:!0,tsType:{name:"IMessage"},description:""},previous:{required:!1,tsType:{name:"IMessage"},description:""},showUnreadDivider:{required:!0,tsType:{name:"boolean"},description:""},sequential:{required:!0,tsType:{name:"boolean"},description:""},showUserAvatar:{required:!0,tsType:{name:"boolean"},description:""},visible:{required:!0,tsType:{name:"boolean"},description:""},subscription:{required:!0,tsType:{name:"union",raw:"ISubscription | undefined",elements:[{name:"ISubscription"},{name:"undefined"}]},description:""},system:{required:!0,tsType:{name:"boolean"},description:""}}};var useReactiveValue=__webpack_require__("./client/hooks/useReactiveValue.ts");function useMessages_typeof(o){return useMessages_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useMessages_typeof(o)}function useMessages_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function useMessages_defineProperty(e,r,t){return(r=function useMessages_toPropertyKey(t){var i=function useMessages_toPrimitive(t,r){if("object"!=useMessages_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=useMessages_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==useMessages_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function useMessages_toConsumableArray(r){return function useMessages_arrayWithoutHoles(r){if(Array.isArray(r))return useMessages_arrayLikeToArray(r)}(r)||function useMessages_iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||function useMessages_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return useMessages_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?useMessages_arrayLikeToArray(r,a):void 0}}(r)||function useMessages_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useMessages_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var useMessages=function useMessages(_ref){var _useSetting,rid=_ref.rid,showThreadsInMainChannel=(0,ui_contexts_dist.useUserPreference)("showThreadsInMainChannel",!1),hideSysMesSetting=null!==(_useSetting=(0,ui_contexts_dist.useSetting)("Hide_System_Messages"))&&void 0!==_useSetting?_useSetting:[],room=(0,RoomContext.nq)(),hideRoomSysMes=Array.isArray(room.sysMes)?room.sysMes:[],hideSysMessages=(0,index_module.useStableArray)(function mergeHideSysMessages(sysMesArray1,sysMesArray2){return Array.from(new Set([].concat(useMessages_toConsumableArray(sysMesArray1),useMessages_toConsumableArray(sysMesArray2))))}(hideSysMesSetting,hideRoomSysMes)),query=(0,react.useMemo)((function(){return function useMessages_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?useMessages_ownKeys(Object(t),!0).forEach((function(r){useMessages_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):useMessages_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({rid:rid,_hidden:{$ne:!0},t:{$nin:hideSysMessages}},!showThreadsInMainChannel&&{$or:[{tmid:{$exists:!1}},{tshow:{$eq:!0}}]})}),[rid,hideSysMessages,showThreadsInMainChannel]);return(0,useReactiveValue.S)((0,react.useCallback)((function(){return models_client.ChatMessage.find(query,{sort:{ts:1}}).fetch()}),[query]))},isMessageSequential=__webpack_require__("./client/views/room/MessageList/lib/isMessageSequential.ts"),MessageListProvider=__webpack_require__("./client/views/room/MessageList/providers/MessageListProvider.tsx"),MessageList=function MessageList(_ref){var rid=_ref.rid,messageListRef=_ref.messageListRef,messages=useMessages({rid:rid}),subscription=(0,RoomContext.Mq)(),showUserAvatar=!!(0,ui_contexts_dist.useUserPreference)("displayAvatars"),messageGroupingPeriod=Number((0,ui_contexts_dist.useSetting)("Message_GroupingPeriod")),firstUnreadMessageId=(0,useFirstUnreadMessageId.L)();return react.createElement(MessageListProvider.A,{messageListRef:messageListRef},react.createElement(SelectedMessagesProvider.j,null,messages.map((function(message,index,_ref2){var previous=_ref2[index-1],sequential=(0,isMessageSequential.H)(message,previous,messageGroupingPeriod),showUnreadDivider=firstUnreadMessageId===message._id,system=ui_utils_client.MessageTypes.isSystemMessage(message),visible=!(0,core_typings_dist.isThreadMessage)(message)&&!system;return react.createElement(react.Fragment,{key:message._id},react.createElement(MessageListItem,{message:message,previous:previous,showUnreadDivider:showUnreadDivider,showUserAvatar:showUserAvatar,sequential:sequential,visible:visible,subscription:subscription,system:system}))}))))};MessageList.__docgenInfo={description:"",methods:[],displayName:"MessageList",props:{rid:{required:!0,tsType:{name:"IRoom['_id']",raw:"IRoom['_id']"},description:""},messageListRef:{required:!0,tsType:{name:"ComponentProps['messageListRef']",raw:"ComponentProps<typeof MessageListProvider>['messageListRef']"},description:""}}};var _templateObject,MessageListErrorBoundary=__webpack_require__("./client/views/room/MessageList/MessageListErrorBoundary.tsx"),ComposerContainer=__webpack_require__("./client/views/room/composer/ComposerContainer.tsx"),RoomComposer=__webpack_require__("./client/views/room/composer/RoomComposer/RoomComposer.tsx"),ChatContext=__webpack_require__("./client/views/room/contexts/ChatContext.ts"),RoomToolboxContext=__webpack_require__("./client/views/room/contexts/RoomToolboxContext.ts"),UserCardContext=__webpack_require__("./client/views/room/contexts/UserCardContext.ts"),useDateScroll=__webpack_require__("./client/views/room/hooks/useDateScroll.ts"),useMessageListNavigation=__webpack_require__("./client/views/room/hooks/useMessageListNavigation.ts"),useRetentionPolicy=__webpack_require__("./client/views/room/hooks/useRetentionPolicy.ts"),DropTargetOverlay=__webpack_require__("./client/views/room/body/DropTargetOverlay.tsx"),dist_index_module=__webpack_require__("./node_modules/@rocket.chat/css-in-js/dist/index.module.js");function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function JumpToRecentMessageButton_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return JumpToRecentMessageButton_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?JumpToRecentMessageButton_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function JumpToRecentMessageButton_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var buttonStyle=(0,dist_index_module.css)(_templateObject||(_templateObject=function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n\tposition: absolute;\n\tz-index: 2;\n\tbottom: 8px;\n\tleft: 50%;\n\tuser-select: none;\n\ttransform: translate(-50%, 0);\n\n\t&.not {\n\t\tvisibility: hidden;\n\t}\n\n\t&.clicked {\n\t\tanimation: fadeout 1s linear forwards;\n\t}\n\n\t@keyframes fadeout {\n\t\t50% {\n\t\t\tvisibility: visible;\n\t\t\ttransform: translate(-50%, 150%);\n\t\t}\n\t\t100% {\n\t\t\tvisibility: hidden;\n\t\t\ttransform: translate(-50%, 150%);\n\t\t\tposition: fixed;\n\t\t}\n\t}\n"]))),JumpToRecentMessageButton=function JumpToRecentMessageButton(_ref){var visible=_ref.visible,_onClick=_ref.onClick,text=_ref.text,_useState2=_slicedToArray((0,react.useState)(!1),2),clicked=_useState2[0],setClicked=_useState2[1];return react.createElement(fuselage.Box,{className:[buttonStyle,!visible&&"not",clicked&&"clicked"].filter(isTruthy.z)},react.createElement(fuselage.Bubble,{icon:"arrow-down",onClick:function onClick(){_onClick(),setClicked(!0)}},text))},body_JumpToRecentMessageButton=JumpToRecentMessageButton;JumpToRecentMessageButton.__docgenInfo={description:"",methods:[],displayName:"JumpToRecentMessageButton",props:{visible:{required:!0,tsType:{name:"boolean"},description:""},onClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},text:{required:!0,tsType:{name:"string"},description:""}}};var LeaderBar_templateObject,UserStatus=__webpack_require__("./client/components/UserStatus/index.ts"),roomCoordinator=__webpack_require__("./client/lib/rooms/roomCoordinator.tsx");function LeaderBar_extends(){return LeaderBar_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},LeaderBar_extends.apply(null,arguments)}var LeaderBar=function LeaderBar(_ref){var _id=_ref._id,name=_ref.name,username=_ref.username,visible=_ref.visible,onAvatarClick=_ref.onAvatarClick,triggerProps=_ref.triggerProps,t=(0,ui_contexts_dist.useTranslation)(),chatNowLink=(0,react.useMemo)((function(){return roomCoordinator.roomCoordinator.getRouteLink("d",{name:username})||void 0}),[username]),handleAvatarClick=(0,react.useCallback)((function(event){null==onAvatarClick||onAvatarClick(event,username)}),[onAvatarClick,username]);if(!username)throw new Error("username is required");var roomLeaderStyle=(0,dist_index_module.css)(LeaderBar_templateObject||(LeaderBar_templateObject=function LeaderBar_taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n\t\tposition: relative;\n\t\tz-index: 9;\n\t\tright: 0;\n\t\tleft: 0;\n\t\tdisplay: flex;\n\n\t\t&.animated-hidden {\n\t\t\tdisplay: none !important;\n\t\t}\n\t"])));return react.createElement(fuselage.Box,{backgroundColor:"light",color:"default",pi:24,pb:8,justifyContent:"space-between",borderBlockEndWidth:2,borderBlockEndColor:"extra-light",className:[roomLeaderStyle,"room-leader",!visible&&"animated-hidden"].filter(isTruthy.z)},react.createElement(fuselage.Box,{display:"flex",alignItems:"center"},react.createElement(fuselage.Box,LeaderBar_extends({mie:4,onClick:handleAvatarClick},triggerProps),react.createElement(ui_avatar_dist.H8,{username:username})),react.createElement(fuselage.Box,{fontScale:"p2",mi:4,display:"flex",alignItems:"center"},react.createElement(UserStatus.LO,{uid:_id}),react.createElement(fuselage.Box,{fontWeight:700,mis:8},name))),react.createElement(fuselage.Button,{role:"link",is:"a",href:chatNowLink},t("Chat_Now")))},body_LeaderBar=(0,react.memo)(LeaderBar);LeaderBar.__docgenInfo={description:"@deprecated on newNavigation feature. Remove after full migration.",methods:[],displayName:"LeaderBar",props:{_id:{required:!0,tsType:{name:"IUser['_id']",raw:"IUser['_id']"},description:""},name:{required:!0,tsType:{name:"IUser['name']",raw:"IUser['name']"},description:""},username:{required:!0,tsType:{name:"IUser['username']",raw:"IUser['username']"},description:""},visible:{required:!0,tsType:{name:"boolean"},description:""},onAvatarClick:{required:!1,tsType:{name:"signature",type:"function",raw:"(event: UIEvent, username: IUser['username']) => void",signature:{arguments:[{type:{name:"UIEvent"},name:"event"},{type:{name:"IUser['username']",raw:"IUser['username']"},name:"username"}],return:{name:"void"}}},description:""},triggerProps:{required:!0,tsType:{name:"AriaButtonProps",elements:[{name:"literal",value:"'button'"}],raw:"AriaButtonProps<'button'>"},description:""}}};var LoadingMessagesIndicator=__webpack_require__("./client/views/room/body/LoadingMessagesIndicator.tsx"),withErrorBoundary=__webpack_require__("./client/components/withErrorBoundary.tsx"),usePruneWarningMessage=__webpack_require__("./client/hooks/usePruneWarningMessage.ts"),RetentionPolicyWarning=function RetentionPolicyWarning(_ref){var room=_ref.room,t=(0,ui_contexts_dist.useTranslation)(),message=(0,usePruneWarningMessage.l)(room);return react.createElement(fuselage.Box,{display:"flex",justifyContent:"center",pi:20,mb:8},react.createElement(fuselage.Bubble,{role:"alert","aria-live":"polite","aria-label":t("Retention_policy_warning_banner"),small:!0,secondary:!0},message))},body_RetentionPolicyWarning=(0,withErrorBoundary.X)(RetentionPolicyWarning);RetentionPolicyWarning.__docgenInfo={description:"",methods:[],displayName:"RetentionPolicyWarning",props:{room:{required:!0,tsType:{name:"IRoom"},description:""}}};var utils_client=__webpack_require__("./app/utils/client/index.ts"),parseOutboundPhoneNumber=__webpack_require__("./client/lib/voip/parseOutboundPhoneNumber.ts"),VoipRoomForeword=function VoipRoomForeword(_ref){var room=_ref.room,t=(0,ui_contexts_dist.useTranslation)(),avatarUrl=(0,utils_client.ku)(room.name),roomName=room.fname;return react.createElement(fuselage.Box,{is:"div",flexGrow:1,display:"flex",justifyContent:"center",flexDirection:"column"},react.createElement(fuselage.Box,{display:"flex",justifyContent:"center",mbs:24},react.createElement(fuselage.Avatar,{size:"x48",title:room.name,url:avatarUrl})),react.createElement(fuselage.Box,{color:"default",fontScale:"h2",flexGrow:1,mb:16},t("You_have_joined_a_new_call_with")),react.createElement(fuselage.Box,{is:"div",mb:8,flexGrow:1,display:"flex",justifyContent:"center"},react.createElement(fuselage.Box,{mi:4},react.createElement(fuselage.Tag,{style:{cursor:"default"},variant:"primary",medium:!0},roomName&&(0,parseOutboundPhoneNumber.X)(roomName)))))};VoipRoomForeword.__docgenInfo={description:"",methods:[],displayName:"VoipRoomForeword",props:{room:{required:!0,tsType:{name:"IVoipRoom"},description:""}}};var getUserDisplayName=__webpack_require__("./lib/getUserDisplayName.ts"),useUserInfoQuery=__webpack_require__("./client/hooks/useUserInfoQuery.ts"),RoomForewordUsernameListItem=function RoomForewordUsernameListItem(_ref){var _data$user,username=_ref.username,href=_ref.href,useRealName=_ref.useRealName,_useUserInfoQuery=(0,useUserInfoQuery.H)({username:username}),data=_useUserInfoQuery.data,isLoading=_useUserInfoQuery.isLoading,isError=_useUserInfoQuery.isError;return react.createElement(fuselage.Tag,{icon:react.createElement(fuselage.Icon,{name:"user",size:"x20"}),"data-username":username,large:!0,href:href},isLoading&&react.createElement(fuselage.Skeleton,{variant:"rect"}),!isLoading&&isError&&username,!isLoading&&!isError&&(0,getUserDisplayName.N)(null==data||null===(_data$user=data.user)||void 0===_data$user?void 0:_data$user.name,username,useRealName))},RoomForeword_RoomForewordUsernameListItem=RoomForewordUsernameListItem;RoomForewordUsernameListItem.__docgenInfo={description:"",methods:[],displayName:"RoomForewordUsernameListItem",props:{href:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""},username:{required:!0,tsType:{name:"NonNullable",elements:[{name:"IUser['username']",raw:"IUser['username']"}],raw:"NonNullable<IUser['username']>"},description:""},useRealName:{required:!0,tsType:{name:"boolean"},description:""}}};var RoomForewordUsernameList=function RoomForewordUsernameList(_ref){var usernames=_ref.usernames,useRealName=Boolean((0,ui_contexts_dist.useSetting)("UI_Use_Real_Name"));return react.createElement(fuselage.Margins,{inline:4},usernames.map((function(username){return react.createElement(RoomForeword_RoomForewordUsernameListItem,{username:username,key:username,href:roomCoordinator.roomCoordinator.getRouteLink("d",{name:username})||void 0,useRealName:useRealName})})))},RoomForeword_RoomForewordUsernameList=RoomForewordUsernameList;RoomForewordUsernameList.__docgenInfo={description:"",methods:[],displayName:"RoomForewordUsernameList",props:{usernames:{required:!0,tsType:{name:"Array",elements:[{name:"NonNullable",elements:[{name:"IUser['username']",raw:"IUser['username']"}],raw:"NonNullable<IUser['username']>"}],raw:"Array<NonNullable<IUser['username']>>"},description:""}}};var UnreadMessagesIndicator_templateObject,RoomForeword=function RoomForeword(_ref){var _room$usernames,user=_ref.user,room=_ref.room,t=(0,ui_contexts_dist.useTranslation)();if((0,core_typings_dist.isVoipRoom)(room))return react.createElement(VoipRoomForeword,{room:room});if(!(0,core_typings_dist.isDirectMessageRoom)(room))return react.createElement(fuselage.Box,{fontScale:"c1",color:"default",display:"flex",justifyContent:"center",mb:8},t("Start_of_conversation"));var usernames=null===(_room$usernames=room.usernames)||void 0===_room$usernames?void 0:_room$usernames.filter((function(username){return username!==(null==user?void 0:user.username)}));return!usernames||usernames.length<1?null:react.createElement(fuselage.Box,{is:"div",flexGrow:1,display:"flex",justifyContent:"center",flexDirection:"column",mb:8},react.createElement(fuselage.Flex.Item,{grow:1},react.createElement(fuselage.Box,{display:"flex",alignItems:"center",justifyContent:"center"},usernames.map((function(username,index){return react.createElement(fuselage.Box,{is:"span",mi:4,key:index},react.createElement(ui_avatar_dist.H8,{size:"x48",username:username}))})))),react.createElement(fuselage.Box,{display:"flex",color:"default",fontScale:"h4",flexGrow:1,justifyContent:"center",mb:16},t("Direct_message_you_have_joined")),react.createElement(fuselage.Box,{is:"div",flexGrow:1,display:"flex",justifyContent:"center"},react.createElement(RoomForeword_RoomForewordUsernameList,{usernames:usernames})))},RoomForeword_RoomForeword=RoomForeword;RoomForeword.__docgenInfo={description:"",methods:[],displayName:"RoomForeword",props:{user:{required:!0,tsType:{name:"union",raw:"IUser | null",elements:[{name:"IUser"},{name:"null"}]},description:""},room:{required:!0,tsType:{name:"IRoom"},description:""}}};var indicatorStyle=(0,dist_index_module.css)(UnreadMessagesIndicator_templateObject||(UnreadMessagesIndicator_templateObject=function UnreadMessagesIndicator_taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n\tposition: relative;\n\tdisplay: flex;\n\tjustify-content: center;\n\tz-index: 3;\n"]))),UnreadMessagesIndicator=function UnreadMessagesIndicator(_ref){var count=_ref.count,onJumpButtonClick=_ref.onJumpButtonClick,onMarkAsReadButtonClick=_ref.onMarkAsReadButtonClick,t=(0,ui_contexts_dist.useTranslation)();return react.createElement(fuselage.Box,{className:indicatorStyle,mbs:8},react.createElement(fuselage.Bubble,{onClick:onJumpButtonClick,onDismiss:onMarkAsReadButtonClick,icon:"arrow-up",dismissProps:{title:t("Mark_as_read"),"aria-label":"".concat(t("Mark_as_read"))}},t("unread_messages",{count:count})))},body_UnreadMessagesIndicator=UnreadMessagesIndicator;UnreadMessagesIndicator.__docgenInfo={description:"",methods:[],displayName:"UnreadMessagesIndicator",props:{count:{required:!0,tsType:{name:"number"},description:""},onJumpButtonClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onMarkAsReadButtonClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};var ErroredUploadProgressIndicator=function ErroredUploadProgressIndicator(_ref){var id=_ref.id,error=_ref.error,onClose=_ref.onClose,t=(0,ui_contexts_dist.useTranslation)(),handleCloseClick=(0,react.useCallback)((function(){null==onClose||onClose(id)}),[id,onClose]);return react.createElement("div",{className:"upload-progress color-primary-action-color background-component-color error-background error-border"},react.createElement("div",{className:"upload-progress-text"},error),react.createElement("button",{type:"button",className:"upload-progress-close",onClick:handleCloseClick},t("close")))},body_ErroredUploadProgressIndicator=ErroredUploadProgressIndicator;ErroredUploadProgressIndicator.__docgenInfo={description:"",methods:[],displayName:"ErroredUploadProgressIndicator",props:{id:{required:!0,tsType:{name:"string",raw:"Upload['id']"},description:""},error:{required:!0,tsType:{name:"string"},description:""},onClose:{required:!1,tsType:{name:"signature",type:"function",raw:"(id: Upload['id']) => void",signature:{arguments:[{type:{name:"string",raw:"Upload['id']"},name:"id"}],return:{name:"void"}}},description:""}}};var UploadProgressIndicator=function UploadProgressIndicator(_ref){var id=_ref.id,name=_ref.name,percentage=_ref.percentage,error=_ref.error,onClose=_ref.onClose,t=(0,ui_contexts_dist.useTranslation)(),handleCloseClick=(0,react.useCallback)((function(){null==onClose||onClose(id)}),[id,onClose]);return error?react.createElement(body_ErroredUploadProgressIndicator,{id:id,error:error,onClose:onClose}):react.createElement("div",{className:"upload-progress color-primary-action-color background-component-color"},react.createElement("div",{className:"upload-progress-progress",style:{width:"".concat(percentage,"%")}}),react.createElement("div",{className:"upload-progress-text"},"[",percentage,"%] ",name),react.createElement("button",{type:"button",className:"upload-progress-close",onClick:handleCloseClick},t("Cancel")))},body_UploadProgressIndicator=UploadProgressIndicator;UploadProgressIndicator.__docgenInfo={description:"",methods:[],displayName:"UploadProgressIndicator",props:{id:{required:!0,tsType:{name:"string",raw:"Upload['id']"},description:""},name:{required:!0,tsType:{name:"string"},description:""},percentage:{required:!0,tsType:{name:"number"},description:""},error:{required:!1,tsType:{name:"string"},description:""},onClose:{required:!1,tsType:{name:"signature",type:"function",raw:"(id: Upload['id']) => void",signature:{arguments:[{type:{name:"string",raw:"Upload['id']"},name:"id"}],return:{name:"void"}}},description:""}}};var shim=__webpack_require__("./node_modules/use-sync-external-store/shim/index.js"),useFileUploadDropTarget=__webpack_require__("./client/views/room/body/hooks/useFileUploadDropTarget.ts"),useFileUpload=function useFileUpload(){var chat=(0,ChatContext.Y)();if(!chat)throw new Error("No ChatContext provided");return(0,react.useEffect)((function(){chat.uploads.wipeFailedOnes()}),[chat]),{uploads:(0,shim.useSyncExternalStore)(chat.uploads.subscribe,chat.uploads.get),handleUploadProgressClose:(0,react.useCallback)((function(id){chat.uploads.cancel(id)}),[chat]),handleUploadFiles:(0,react.useCallback)((function(files){chat.flows.uploadFiles(files)}),[chat]),targeDrop:(0,useFileUploadDropTarget.l)()}},useGetMore=function useGetMore(rid,atBottomRef){return{innerRef:(0,react.useCallback)((function(wrapper){if(wrapper){var lastScrollTopRef=0;wrapper.addEventListener("scroll",(0,highOrderFunctions.u)({wait:100})((function(event){lastScrollTopRef=event.target.scrollTop;var height=event.target.clientHeight,isLoading=ui_utils_client.RoomHistoryManager.isLoading(rid),hasMore=ui_utils_client.RoomHistoryManager.hasMore(rid),hasMoreNext=ui_utils_client.RoomHistoryManager.hasMoreNext(rid);(!1===isLoading&&!0===hasMore||!0===hasMoreNext)&&(!0===hasMore&&lastScrollTopRef<=height/3?ui_utils_client.RoomHistoryManager.getMore(rid):!0===hasMoreNext&&Math.ceil(lastScrollTopRef)>=event.target.scrollHeight-height&&(ui_utils_client.RoomHistoryManager.getMoreNext(rid,atBottomRef),atBottomRef.current=!1))})))}}),[atBottomRef,rid])}};function useGoToHomeOnRemoved(room,userId){var router=(0,ui_contexts_dist.useRouter)(),queryClient=(0,lib.useQueryClient)(),dispatchToastMessage=(0,ui_contexts_dist.useToastMessageDispatch)(),subscribeToNotifyUser=(0,ui_contexts_dist.useStream)("notify-user"),t=(0,ui_contexts_dist.useTranslation)(),_useOmnichannelCloseR=function useOmnichannelCloseRoute(){var _useUserPreference,hideConversationAfterClosing=null===(_useUserPreference=(0,ui_contexts_dist.useUserPreference)("omnichannelHideConversationAfterClosing"))||void 0===_useUserPreference||_useUserPreference,router=(0,ui_contexts_dist.useRouter)();return{navigateHome:(0,react.useCallback)((function(){hideConversationAfterClosing&&("omnichannel-current-chats"===router.getRouteName()?router.navigate({name:"omnichannel-current-chats"}):router.navigate({name:"home"}))}),[hideConversationAfterClosing,router])}}(),navigateHome=_useOmnichannelCloseR.navigateHome;(0,react.useEffect)((function(){if(userId)return subscribeToNotifyUser("".concat(userId,"/subscriptions-changed"),(function(event,subscription){if("removed"===event&&subscription.rid===room._id){if(queryClient.invalidateQueries(["rooms",room._id]),(0,core_typings_dist.isOmnichannelRoom)({t:room.t}))return void navigateHome();dispatchToastMessage({type:"info",message:t("You_have_been_removed_from__roomName_",{roomName:(null==room?void 0:room.fname)||(null==room?void 0:room.name)||""})}),router.navigate("/home")}}))}),[userId,router,subscribeToNotifyUser,room._id,room.t,null==room?void 0:room.fname,null==room?void 0:room.name,t,dispatchToastMessage,queryClient,navigateHome])}var callbacks=__webpack_require__("./lib/callbacks.ts");function useHasNewMessages_slicedToArray(r,e){return function useHasNewMessages_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function useHasNewMessages_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function useHasNewMessages_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return useHasNewMessages_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?useHasNewMessages_arrayLikeToArray(r,a):void 0}}(r,e)||function useHasNewMessages_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useHasNewMessages_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var useHasNewMessages=function useHasNewMessages(rid,uid,atBottomRef,_ref){var sendToBottom=_ref.sendToBottom,sendToBottomIfNecessary=_ref.sendToBottomIfNecessary,isAtBottom=_ref.isAtBottom,chat=(0,ChatContext.Y)();if(!chat)throw new Error("No ChatContext provided");var _useState2=useHasNewMessages_slicedToArray((0,react.useState)(!1),2),hasNewMessages=_useState2[0],setHasNewMessages=_useState2[1],handleNewMessageButtonClick=(0,react.useCallback)((function(){var _chat$composer;atBottomRef.current=!0,sendToBottomIfNecessary(),setHasNewMessages(!1),null===(_chat$composer=chat.composer)||void 0===_chat$composer||_chat$composer.focus()}),[atBottomRef,chat.composer,sendToBottomIfNecessary]),handleJumpToRecentButtonClick=(0,react.useCallback)((function(){atBottomRef.current=!0,ui_utils_client.RoomHistoryManager.clear(rid),ui_utils_client.RoomHistoryManager.getMoreIfIsEmpty(rid)}),[atBottomRef,rid]),handleComposerResize=(0,react.useCallback)((function(){sendToBottomIfNecessary(),setHasNewMessages(!1)}),[sendToBottomIfNecessary]);return(0,react.useEffect)((function(){return callbacks.l.add("streamNewMessage",(function(msg){if(rid===msg.rid&&!(0,core_typings_dist.isEditedMessage)(msg)&&!msg.tmid)return msg.u._id===uid?(sendToBottom(),void setHasNewMessages(!1)):void(isAtBottom()||setHasNewMessages(!0))}),callbacks.l.priority.MEDIUM,rid),function(){callbacks.l.remove("streamNewMessage",rid)}}),[isAtBottom,rid,sendToBottom,uid]),{newMessagesScrollRef:(0,react.useCallback)((function(node){node&&node.addEventListener("scroll",(0,highOrderFunctions.u)({wait:100})((function(){atBottomRef.current&&setHasNewMessages(!1)})),{passive:!0})}),[atBottomRef]),handleNewMessageButtonClick:handleNewMessageButtonClick,handleJumpToRecentButtonClick:handleJumpToRecentButtonClick,handleComposerResize:handleComposerResize,hasNewMessages:hasNewMessages}};function scrolling_isAtBottom(element){var scrollThreshold=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return element.scrollTop+scrollThreshold>=element.scrollHeight-element.clientHeight}function useLeaderBanner_slicedToArray(r,e){return function useLeaderBanner_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function useLeaderBanner_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function useLeaderBanner_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return useLeaderBanner_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?useLeaderBanner_arrayLikeToArray(r,a):void 0}}(r,e)||function useLeaderBanner_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useLeaderBanner_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var useListIsAtBottom=function useListIsAtBottom(){var atBottomRef=(0,react.useRef)(!0),innerBoxRef=(0,react.useRef)(null),sendToBottom=(0,react.useCallback)((function(){var _innerBoxRef$current,_innerBoxRef$current2;null===(_innerBoxRef$current=innerBoxRef.current)||void 0===_innerBoxRef$current||_innerBoxRef$current.scrollTo({left:30,top:null===(_innerBoxRef$current2=innerBoxRef.current)||void 0===_innerBoxRef$current2?void 0:_innerBoxRef$current2.scrollHeight})}),[]),sendToBottomIfNecessary=(0,react.useCallback)((function(){!0===atBottomRef.current&&sendToBottom()}),[atBottomRef,sendToBottom]),isAtBottom=(0,react.useCallback)((function(){var threshold=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return!innerBoxRef.current||scrolling_isAtBottom(innerBoxRef.current,threshold)}),[]),ref=(0,react.useCallback)((function(node){if(node){var messageList=node.querySelector("ul");if(messageList)new ResizeObserver((function(){!0===atBottomRef.current&&node.scrollTo({left:30,top:node.scrollHeight})})).observe(messageList),node.addEventListener("scroll",(0,highOrderFunctions.u)({wait:100})((function(){atBottomRef.current=isAtBottom(100)})),{passive:!0})}}),[isAtBottom]);return{atBottomRef:atBottomRef,innerRef:(0,index_module.useMergedRefs)(ref,innerBoxRef),sendToBottom:sendToBottom,sendToBottomIfNecessary:sendToBottomIfNecessary,isAtBottom:isAtBottom}},useQuoteMessageByUrl=function useQuoteMessageByUrl(){var replyMID=(0,ui_contexts_dist.useSearchParameter)("reply"),chat=(0,ChatContext.Y)();if(!chat)throw new Error("No ChatContext provided");(0,react.useEffect)((function(){replyMID&&chat.data.getMessageByID(replyMID).then((function(message){var _chat$composer;message&&(null===(_chat$composer=chat.composer)||void 0===_chat$composer||_chat$composer.quoteMessage(message))}))}),[chat.data,chat.composer,replyMID])};function useReadMessageWindowEvents(){var chat=(0,ChatContext.Y)();(0,react.useEffect)((function(){return null==chat?void 0:chat.readStateManager.handleWindowEvents()}),[null==chat?void 0:chat.readStateManager])}var RoomManager=__webpack_require__("./client/lib/RoomManager.ts");function useRestoreScrollPosition(roomId){var ref=(0,react.useCallback)((function(node){if(node){var store=RoomManager.RoomManager.getStore(roomId);null!=store&&store.scroll&&!store.atBottom?node.scrollTo({left:30,top:store.scroll}):node.scrollTo({top:node.scrollHeight})}}),[roomId]),refCallback=(0,react.useCallback)((function(node){if(node){var store=RoomManager.RoomManager.getStore(roomId),handleWrapperScroll=(0,highOrderFunctions.u)({wait:100})((function(){null==store||store.update({scroll:node.scrollTop,atBottom:scrolling_isAtBottom(node,50)})}));node.addEventListener("scroll",handleWrapperScroll,{passive:!0})}}),[roomId]);return{innerRef:(0,index_module.useMergedRefs)(refCallback,ref)}}var RouterProvider=__webpack_require__("./client/providers/RouterProvider.tsx");function setMessageJumpQueryStringParameter_typeof(o){return setMessageJumpQueryStringParameter_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},setMessageJumpQueryStringParameter_typeof(o)}var setMessageJumpQueryStringParameter_excluded=["msg"];function setMessageJumpQueryStringParameter_regeneratorRuntime(){setMessageJumpQueryStringParameter_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==setMessageJumpQueryStringParameter_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(setMessageJumpQueryStringParameter_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function setMessageJumpQueryStringParameter_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function setMessageJumpQueryStringParameter_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?setMessageJumpQueryStringParameter_ownKeys(Object(t),!0).forEach((function(r){setMessageJumpQueryStringParameter_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):setMessageJumpQueryStringParameter_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function setMessageJumpQueryStringParameter_defineProperty(e,r,t){return(r=function setMessageJumpQueryStringParameter_toPropertyKey(t){var i=function setMessageJumpQueryStringParameter_toPrimitive(t,r){if("object"!=setMessageJumpQueryStringParameter_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=setMessageJumpQueryStringParameter_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==setMessageJumpQueryStringParameter_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function setMessageJumpQueryStringParameter_objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function setMessageJumpQueryStringParameter_objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}function setMessageJumpQueryStringParameter_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}var setMessageJumpQueryStringParameter=function(){var _ref=function setMessageJumpQueryStringParameter_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){setMessageJumpQueryStringParameter_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){setMessageJumpQueryStringParameter_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(setMessageJumpQueryStringParameter_regeneratorRuntime().mark((function _callee(msg){var _router$getSearchPara,search,locationPathname;return setMessageJumpQueryStringParameter_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:_router$getSearchPara=RouterProvider.Q.getSearchParameters(),_router$getSearchPara.msg,search=setMessageJumpQueryStringParameter_objectWithoutProperties(_router$getSearchPara,setMessageJumpQueryStringParameter_excluded),locationPathname=new URL(window.location.href).pathname,RouterProvider.Q.navigate({pathname:locationPathname,search:msg?setMessageJumpQueryStringParameter_objectSpread(setMessageJumpQueryStringParameter_objectSpread({},search),{},{msg:msg}):search},{replace:!0});case 3:case"end":return _context.stop()}}),_callee)})));return function setMessageJumpQueryStringParameter(_x){return _ref.apply(this,arguments)}}();function useUnreadMessages_slicedToArray(r,e){return function useUnreadMessages_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function useUnreadMessages_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function useUnreadMessages_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return useUnreadMessages_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?useUnreadMessages_arrayLikeToArray(r,a):void 0}}(r,e)||function useUnreadMessages_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useUnreadMessages_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var useHandleUnread=function useHandleUnread(room,subscription){var _unread$count,messagesBoxRef=(0,react.useRef)(null),subscribed=Boolean(subscription),_useUnreadMessages=function useUnreadMessages(room){var notLoadedCount=(0,useReactiveValue.S)((0,react.useCallback)((function(){return ui_utils_client.RoomHistoryManager.getRoom(room._id).unreadNotLoaded.get()}),[room._id])),_useState2=useUnreadMessages_slicedToArray((0,react.useState)(0),2),loadedCount=_useState2[0],setLoadedCount=_useState2[1],count=(0,react.useMemo)((function(){return notLoadedCount+loadedCount}),[notLoadedCount,loadedCount]),since=(0,useReactiveValue.S)((0,react.useCallback)((function(){var _LegacyRoomManager$ge;return null===(_LegacyRoomManager$ge=ui_utils_client.LegacyRoomManager.getOpenedRoomByRid(room._id))||void 0===_LegacyRoomManager$ge?void 0:_LegacyRoomManager$ge.unreadSince.get()}),[room._id]));return(0,react.useMemo)((function(){return count&&since?[{count:count,since:since},setLoadedCount]:[void 0,setLoadedCount]}),[count,since])}(room),_useUnreadMessages2=useUnreadMessages_slicedToArray(_useUnreadMessages,2),unread=_useUnreadMessages2[0],setUnreadCount=_useUnreadMessages2[1],_useState4=useUnreadMessages_slicedToArray((0,react.useState)(),2),lastMessageDate=_useState4[0],setLastMessageDate=_useState4[1],chat=(0,ChatContext.Y)();if(!chat)throw new Error("No ChatContext provided");var handleUnreadBarJumpToButtonClick=(0,react.useCallback)((function(){var _message,rid=room._id,firstUnread=ui_utils_client.RoomHistoryManager.getRoom(rid).firstUnread,message=null==firstUnread?void 0:firstUnread.get();message||(message=models_client.ChatMessage.findOne({rid:rid,ts:{$gt:null==unread?void 0:unread.since}},{sort:{ts:1},limit:1})),message&&(setMessageJumpQueryStringParameter(null===(_message=message)||void 0===_message?void 0:_message._id),setUnreadCount(0))}),[room._id,null==unread?void 0:unread.since,setUnreadCount]),handleMarkAsReadButtonClick=(0,react.useCallback)((function(){chat.readStateManager.markAsRead(),setUnreadCount(0)}),[chat.readStateManager,setUnreadCount]);(0,react.useEffect)((function(){if(subscribed){var count=models_client.ChatMessage.find({rid:room._id,ts:{$lte:lastMessageDate,$gt:null==subscription?void 0:subscription.ls}}).count();setUnreadCount(count)}else setUnreadCount(0)}),[lastMessageDate,room._id,setUnreadCount,subscribed,null==subscription?void 0:subscription.ls]);var router=(0,ui_contexts_dist.useRouter)(),debouncedReadMessageRead=(0,react.useMemo)((function(){return(0,highOrderFunctions.z)({wait:500})((function(){subscribed&&chat.readStateManager.attemptMarkAsRead()}))}),[chat.readStateManager,subscribed]);(0,react.useEffect)((function(){return router.subscribeToRouteChange((function(){var routeName=router.getRouteName();routeName&&roomCoordinator.roomCoordinator.isRouteNameKnown(routeName)&&debouncedReadMessageRead()}))}),[debouncedReadMessageRead,room._id,router,subscribed,null==subscription?void 0:subscription.alert,null==subscription?void 0:subscription.unread]),(0,react.useEffect)((function(){if(null==unread||!unread.count)return debouncedReadMessageRead()}),[debouncedReadMessageRead,room._id,null==unread?void 0:unread.count]);var ref=(0,react.useCallback)((function(wrapper){if(wrapper){var getElementFromPoint=function getElementFromPoint(){var _element,_element2,topOffset=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,messagesBox=messagesBoxRef.current;if(messagesBox){var element,messagesBoxLeft=messagesBox.getBoundingClientRect().left+window.pageXOffset,messagesBoxTop=messagesBox.getBoundingClientRect().top+window.pageYOffset,messagesBoxWidth=parseFloat(getComputedStyle(messagesBox).width);return null!==(_element=element="rtl"===document.dir?document.elementFromPoint(messagesBoxLeft+messagesBoxWidth-2,messagesBoxTop+topOffset+2):document.elementFromPoint(messagesBoxLeft+2,messagesBoxTop+topOffset+2))&&void 0!==_element&&_element.classList.contains("rcx-message")||null!==(_element2=element)&&void 0!==_element2&&_element2.classList.contains("rcx-message--sequential")?element:void 0}};wrapper.addEventListener("scroll",(0,highOrderFunctions.u)({wait:300})((function(){Tracker.afterFlush((function(){var lastInvisibleMessageOnScreen=getElementFromPoint(0)||getElementFromPoint(20)||getElementFromPoint(40);if(lastInvisibleMessageOnScreen){var lastMessage=models_client.ChatMessage.findOne(lastInvisibleMessageOnScreen.id);lastMessage?setLastMessageDate(lastMessage.ts):setUnreadCount(0)}else setUnreadCount(0)}))})))}}),[setUnreadCount]);return{innerRef:ref,wrapperRef:messagesBoxRef,handleUnreadBarJumpToButtonClick:handleUnreadBarJumpToButtonClick,handleMarkAsReadButtonClick:handleMarkAsReadButtonClick,counter:[null!==(_unread$count=null==unread?void 0:unread.count)&&void 0!==_unread$count?_unread$count:0,null==unread?void 0:unread.since]}};function RoomBody_typeof(o){return RoomBody_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},RoomBody_typeof(o)}var RoomBody_excluded=["innerRef","bubbleRef","listStyle"];function RoomBody_extends(){return RoomBody_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},RoomBody_extends.apply(null,arguments)}function RoomBody_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function RoomBody_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?RoomBody_ownKeys(Object(t),!0).forEach((function(r){RoomBody_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):RoomBody_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function RoomBody_defineProperty(e,r,t){return(r=function RoomBody_toPropertyKey(t){var i=function RoomBody_toPrimitive(t,r){if("object"!=RoomBody_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=RoomBody_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==RoomBody_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function RoomBody_slicedToArray(r,e){return function RoomBody_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function RoomBody_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function RoomBody_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return RoomBody_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?RoomBody_arrayLikeToArray(r,a):void 0}}(r,e)||function RoomBody_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function RoomBody_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var RoomBody=function RoomBody(){var chat=(0,ChatContext.Y)();if(!chat)throw new Error("No ChatContext provided");var t=(0,ui_contexts_dist.useTranslation)(),isLayoutEmbedded=(0,useEmbeddedLayout.a)(),room=(0,RoomContext.nq)(),user=(0,ui_contexts_dist.useUser)(),toolbox=(0,RoomToolboxContext.W)(),admin=(0,ui_contexts_dist.useRole)("admin"),subscription=(0,RoomContext.Mq)(),retentionPolicy=(0,useRetentionPolicy._)(room),hideFlexTab=(0,ui_contexts_dist.useUserPreference)("hideFlexTab")||void 0,hideUsernames=(0,ui_contexts_dist.useUserPreference)("hideUsernames"),displayAvatars=(0,ui_contexts_dist.useUserPreference)("displayAvatars"),_useRoomMessages=(0,RoomContext.RV)(),hasMorePreviousMessages=_useRoomMessages.hasMorePreviousMessages,hasMoreNextMessages=_useRoomMessages.hasMoreNextMessages,isLoadingMoreMessages=_useRoomMessages.isLoadingMoreMessages,allowAnonymousRead=(0,ui_contexts_dist.useSetting)("Accounts_AllowAnonymousRead"),canPreviewChannelRoom=(0,ui_contexts_dist.usePermission)("preview-c-room"),subscribed=!!subscription,canPreview=(0,react.useMemo)((function(){return!(!room||"c"===room.t)||(!0===allowAnonymousRead||(!!canPreviewChannelRoom||subscribed))}),[allowAnonymousRead,canPreviewChannelRoom,room,subscribed]),useRealName=(0,ui_contexts_dist.useSetting)("UI_Use_Real_Name"),innerBoxRef=(0,react.useRef)(null),_useHandleUnread=useHandleUnread(room,subscription),unreadBarWrapperRef=_useHandleUnread.wrapperRef,unreadBarInnerRef=_useHandleUnread.innerRef,handleUnreadBarJumpToButtonClick=_useHandleUnread.handleUnreadBarJumpToButtonClick,handleMarkAsReadButtonClick=_useHandleUnread.handleMarkAsReadButtonClick,unread=RoomBody_slicedToArray(_useHandleUnread.counter,1)[0],_useDateScroll=(0,useDateScroll.v)(),dateScrollInnerRef=_useDateScroll.innerRef,bubbleRef=_useDateScroll.bubbleRef,listStyle=_useDateScroll.listStyle,bubbleDate=function RoomBody_objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function RoomBody_objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_useDateScroll,RoomBody_excluded),_useListIsAtBottom=useListIsAtBottom(),isAtBottomInnerRef=_useListIsAtBottom.innerRef,atBottomRef=_useListIsAtBottom.atBottomRef,sendToBottom=_useListIsAtBottom.sendToBottom,sendToBottomIfNecessary=_useListIsAtBottom.sendToBottomIfNecessary,isAtBottom=_useListIsAtBottom.isAtBottom,getMoreInnerRef=useGetMore(room._id,atBottomRef).innerRef,_useLeaderBanner=function useLeaderBanner(){var _useState2=useLeaderBanner_slicedToArray((0,react.useState)(!1),2),hideLeaderHeader=_useState2[0],setHideLeaderHeader=_useState2[1],wrapperBoxRef=(0,react.useRef)(null),innerScrollRef=(0,react.useCallback)((function(node){if(node){var lastScrollTopRef=0;node.addEventListener("scroll",(0,highOrderFunctions.u)({wait:100})((function(event){var _wrapperBoxRef$curren,roomLeader=null===(_wrapperBoxRef$curren=wrapperBoxRef.current)||void 0===_wrapperBoxRef$curren?void 0:_wrapperBoxRef$curren.querySelector(".room-leader");roomLeader&&(event.target.scrollTop<lastScrollTopRef?setHideLeaderHeader(!1):!1===scrolling_isAtBottom(node,100)&&event.target.scrollTop>parseFloat(getComputedStyle(roomLeader).height)&&setHideLeaderHeader(!0)),lastScrollTopRef=event.target.scrollTop})),{passive:!0})}}),[]);return{wrapperRef:wrapperBoxRef,hideLeaderHeader:hideLeaderHeader,innerRef:innerScrollRef}}(),leaderBannerWrapperRef=_useLeaderBanner.wrapperRef,hideLeaderHeader=_useLeaderBanner.hideLeaderHeader,leaderBannerInnerRef=_useLeaderBanner.innerRef,_useFileUpload=useFileUpload(),uploads=_useFileUpload.uploads,handleUploadFiles=_useFileUpload.handleUploadFiles,handleUploadProgressClose=_useFileUpload.handleUploadProgressClose,_useFileUpload$targeD=RoomBody_slicedToArray(_useFileUpload.targeDrop,2),fileUploadTriggerProps=_useFileUpload$targeD[0],fileUploadOverlayProps=_useFileUpload$targeD[1],restoreScrollPositionInnerRef=useRestoreScrollPosition(room._id).innerRef,messageListRef=(0,useMessageListNavigation.b)().messageListRef,_useHasNewMessages=useHasNewMessages(room._id,null==user?void 0:user._id,atBottomRef,{sendToBottom:sendToBottom,sendToBottomIfNecessary:sendToBottomIfNecessary,isAtBottom:isAtBottom}),handleNewMessageButtonClick=_useHasNewMessages.handleNewMessageButtonClick,handleJumpToRecentButtonClick=_useHasNewMessages.handleJumpToRecentButtonClick,handleComposerResize=_useHasNewMessages.handleComposerResize,hasNewMessages=_useHasNewMessages.hasNewMessages,newMessagesScrollRef=_useHasNewMessages.newMessagesScrollRef,innerRef=(0,index_module.useMergedRefs)(dateScrollInnerRef,innerBoxRef,restoreScrollPositionInnerRef,isAtBottomInnerRef,newMessagesScrollRef,leaderBannerInnerRef,unreadBarInnerRef,getMoreInnerRef,messageListRef),wrapperBoxRefs=(0,index_module.useMergedRefs)(unreadBarWrapperRef,leaderBannerWrapperRef),handleNavigateToPreviousMessage=(0,react.useCallback)((function(){chat.messageEditing.toPreviousMessage()}),[chat.messageEditing]),handleNavigateToNextMessage=(0,react.useCallback)((function(){chat.messageEditing.toNextMessage()}),[chat.messageEditing]),handleCloseFlexTab=(0,react.useCallback)((function(e){(function checkElement(element){return!!element&&(element instanceof HTMLButtonElement||"button"===element.getAttribute("role")||(element instanceof HTMLAnchorElement||"link"===element.getAttribute("role")||checkElement(element.parentElement)))})(e.target)||toolbox.closeTab()}),[toolbox]),_useUserCard=(0,UserCardContext.P)(),openUserCard=_useUserCard.openUserCard,triggerProps=_useUserCard.triggerProps,handleOpenUserCard=(0,react.useCallback)((function(event,username){username&&openUserCard(event,username)}),[openUserCard]);useGoToHomeOnRemoved(room,null==user?void 0:user._id),useReadMessageWindowEvents(),useQuoteMessageByUrl();var roomLeader=(0,useReactiveQuery.d)(["rooms",room._id,"leader",{not:null==user?void 0:user._id}],(function(){var leaderRoomRole=models_client.RoomRoles.findOne({rid:room._id,roles:"leader","u._id":{$ne:null==user?void 0:user._id}});return leaderRoomRole?RoomBody_objectSpread(RoomBody_objectSpread({},leaderRoomRole.u),{},{name:useRealName&&leaderRoomRole.u.name||leaderRoomRole.u.username}):null})).data;return react.createElement(react.Fragment,null,!isLayoutEmbedded&&room.announcement&&react.createElement(Announcement.A,{announcement:room.announcement,announcementDetails:void 0}),react.createElement(fuselage.Box,{key:room._id,className:["main-content-flex",listStyle]},react.createElement("section",{role:"presentation",className:"messages-container flex-tab-main-content ".concat(admin?"admin":""),id:"chat-window-".concat(room._id),onClick:hideFlexTab&&handleCloseFlexTab},react.createElement("div",{className:"messages-container-wrapper"},react.createElement("div",RoomBody_extends({className:"messages-container-main",ref:wrapperBoxRefs},fileUploadTriggerProps),react.createElement(DropTargetOverlay.A,fileUploadOverlayProps),react.createElement(fuselage.Box,{position:"absolute",w:"full"},roomLeader?react.createElement(body_LeaderBar,{_id:roomLeader._id,username:roomLeader.username,name:roomLeader.name,visible:!hideLeaderHeader,onAvatarClick:handleOpenUserCard,triggerProps:triggerProps}):null,react.createElement("div",{className:["container-bars",uploads.length&&"show"].filter(isTruthy.z).join(" ")},uploads.map((function(upload){return react.createElement(body_UploadProgressIndicator,{key:upload.id,id:upload.id,name:upload.name,percentage:upload.percentage,error:upload.error instanceof Error?upload.error.message:void 0,onClose:handleUploadProgressClose})}))),Boolean(unread)&&react.createElement(body_UnreadMessagesIndicator,{count:unread,onJumpButtonClick:handleUnreadBarJumpToButtonClick,onMarkAsReadButtonClick:handleMarkAsReadButtonClick}),react.createElement(BubbleDate.J,RoomBody_extends({ref:bubbleRef},bubbleDate))),react.createElement("div",{className:["messages-box",roomLeader&&!hideLeaderHeader&&"has-leader"].filter(isTruthy.z).join(" ")},react.createElement(body_JumpToRecentMessageButton,{visible:hasNewMessages,onClick:handleNewMessageButtonClick,text:t("New_messages")}),react.createElement(body_JumpToRecentMessageButton,{visible:hasMoreNextMessages,onClick:handleJumpToRecentButtonClick,text:t("Jump_to_recent_messages")}),canPreview?null:react.createElement("div",{className:"content room-not-found error-color"},react.createElement("div",null,t("You_must_join_to_view_messages_in_this_channel"))),react.createElement("div",{className:["wrapper",hasMoreNextMessages&&"has-more-next",hideUsernames&&"hide-usernames",!displayAvatars&&"hide-avatar"].filter(isTruthy.z).join(" ")},react.createElement(MessageListErrorBoundary.A,null,react.createElement(CustomScrollbars.z,{ref:innerRef},react.createElement("ul",{className:"messages-list","aria-label":t("Message_list"),"aria-busy":isLoadingMoreMessages},canPreview?react.createElement(react.Fragment,null,hasMorePreviousMessages?react.createElement("li",{className:"load-more"},isLoadingMoreMessages?react.createElement(LoadingMessagesIndicator.A,null):null):react.createElement("li",null,react.createElement(RoomForeword_RoomForeword,{user:user,room:room}),null!=retentionPolicy&&retentionPolicy.isActive?react.createElement(body_RetentionPolicyWarning,{room:room}):null)):null,react.createElement(MessageList,{rid:room._id,messageListRef:innerBoxRef}),hasMoreNextMessages?react.createElement("li",{className:"load-more"},isLoadingMoreMessages?react.createElement(LoadingMessagesIndicator.A,null):null):null))))),react.createElement(RoomComposer.A,null,react.createElement(ComposerContainer.A,{subscription:subscription,onResize:handleComposerResize,onNavigateToPreviousMessage:handleNavigateToPreviousMessage,onNavigateToNextMessage:handleNavigateToNextMessage,onUploadFiles:handleUploadFiles})))))))},body_RoomBody=(0,react.memo)(RoomBody);RoomBody.__docgenInfo={description:"",methods:[],displayName:"RoomBody"};var useE2EERoomState=__webpack_require__("./client/views/room/hooks/useE2EERoomState.ts"),useE2EEState=__webpack_require__("./client/views/room/hooks/useE2EEState.ts"),RoomE2EENotAllowed=function RoomE2EENotAllowed(_ref){var title=_ref.title,subTitle=_ref.subTitle,action=_ref.action,btnText=_ref.btnText,icon=_ref.icon,router=(0,ui_contexts_dist.useRouter)(),t=(0,ui_contexts_dist.useTranslation)();return react.createElement(fuselage.Box,{display:"flex",justifyContent:"center",height:"full"},react.createElement(fuselage.States,null,react.createElement(fuselage.StatesIcon,{name:icon,variation:"primary"}),react.createElement(fuselage.StatesTitle,null,title),react.createElement(fuselage.StatesSubtitle,null,subTitle),action&&react.createElement(fuselage.StatesActions,null,react.createElement(fuselage.Button,{secondary:!0,role:"link",onClick:function handleGoHomeClick(){router.navigate("/home")}},t("Back_to_home")),react.createElement(fuselage.StatesAction,{primary:!0,onClick:action,role:"button"},btnText)),react.createElement(fuselage.StatesLink,{target:"_blank",href:"https://go.rocket.chat/i/e2ee-guide"},t("Learn_more_about_E2EE"))))},E2EESetup_RoomE2EENotAllowed=RoomE2EENotAllowed;RoomE2EENotAllowed.__docgenInfo={description:"",methods:[],displayName:"RoomE2EENotAllowed",props:{title:{required:!0,tsType:{name:"string"},description:""},subTitle:{required:!0,tsType:{name:"string"},description:""},action:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},btnText:{required:!1,tsType:{name:"string"},description:""},icon:{required:!0,tsType:{name:"IconName"},description:""}}};var RoomE2EESetup=function RoomE2EESetup(){var room=(0,RoomContext.nq)(),e2eeState=(0,useE2EEState.W)(),e2eRoomState=(0,useE2EERoomState.N)(room._id),t=(0,ui_contexts_dist.useTranslation)(),randomPassword=window.localStorage.getItem("e2e.randomPassword"),onSavePassword=(0,react.useCallback)((function(){randomPassword&&client.D.openSaveE2EEPasswordModal(randomPassword)}),[randomPassword]),onEnterE2EEPassword=(0,react.useCallback)((function(){return client.D.decodePrivateKeyFlow()}),[]);return e2eeState===E2EEState.l.SAVE_PASSWORD?react.createElement(E2EESetup_RoomE2EENotAllowed,{title:t("__roomName__is_encrypted",{roomName:room.name}),subTitle:t("Save_your_encryption_password_to_access"),icon:"key",action:onSavePassword,btnText:t("Save_E2EE_password")}):e2eeState===E2EEState.l.ENTER_PASSWORD?react.createElement(E2EESetup_RoomE2EENotAllowed,{title:t("__roomName__is_encrypted",{roomName:room.name}),subTitle:t("Enter_your_E2E_password_to_access"),icon:"key",action:onEnterE2EEPassword,btnText:t("Enter_your_E2E_password")}):e2eRoomState===E2ERoomState.h.WAITING_KEYS?react.createElement(E2EESetup_RoomE2EENotAllowed,{title:t("Check_back_later"),subTitle:t("__roomName__encryption_keys_need_to_be_updated",{roomName:room.name}),icon:"clock"}):react.createElement(body_RoomBody,null)},E2EESetup_RoomE2EESetup=RoomE2EESetup;RoomE2EESetup.__docgenInfo={description:"",methods:[],displayName:"RoomE2EESetup"};var components_Header=__webpack_require__("./client/components/Header/index.ts"),SidebarToggler=__webpack_require__("./client/components/SidebarToggler/index.ts"),OmnichannelRoomHeader=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(3854),__webpack_require__.e(7436)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/Header/Omnichannel/OmnichannelRoomHeader.tsx"))})),VoipRoomHeader=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(3854),__webpack_require__.e(3292)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/Header/Omnichannel/VoipRoomHeader.tsx"))})),RoomHeaderE2EESetup=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(3854),__webpack_require__.e(7207)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/Header/RoomHeaderE2EESetup.tsx"))})),DirectRoomHeader=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(3854),__webpack_require__.e(5334)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/Header/DirectRoomHeader.tsx"))})),RoomHeader=(0,react.lazy)((function(){return __webpack_require__.e(3854).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/Header/RoomHeader.tsx"))})),Header=function Header(_ref){var _room$uids$length,_room$uids,room=_ref.room,_useLayout=(0,ui_contexts_dist.useLayout)(),isMobile=_useLayout.isMobile,isEmbedded=_useLayout.isEmbedded,showTopNavbarEmbeddedLayout=_useLayout.showTopNavbarEmbeddedLayout,encrypted=Boolean(room.encrypted),unencryptedMessagesAllowed=(0,ui_contexts_dist.useSetting)("E2E_Allow_Unencrypted_Messages"),shouldDisplayE2EESetup=encrypted&&!unencryptedMessagesAllowed,slots=(0,react.useMemo)((function(){return{start:isMobile&&react.createElement(components_Header.NV,null,react.createElement(SidebarToggler.A,null))}}),[isMobile]);return isEmbedded&&!showTopNavbarEmbeddedLayout?null:"l"===room.t?react.createElement(OmnichannelRoomHeader,{slots:slots}):(0,core_typings_dist.isVoipRoom)(room)?react.createElement(VoipRoomHeader,{slots:slots,room:room}):shouldDisplayE2EESetup?react.createElement(RoomHeaderE2EESetup,{room:room,topic:room.topic,slots:slots}):(0,core_typings_dist.isDirectMessageRoom)(room)&&(null!==(_room$uids$length=null===(_room$uids=room.uids)||void 0===_room$uids?void 0:_room$uids.length)&&void 0!==_room$uids$length?_room$uids$length:0)<3?react.createElement(DirectRoomHeader,{slots:slots,room:room}):react.createElement(RoomHeader,{room:room,topic:room.topic,slots:slots})},Header_Header=(0,react.memo)(Header);Header.__docgenInfo={description:"",methods:[],displayName:"Header",props:{room:{required:!0,tsType:{name:"T"},description:""}}};var Header_OmnichannelRoomHeader=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(1618),__webpack_require__.e(8528)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/HeaderV2/Omnichannel/OmnichannelRoomHeader.tsx"))})),Header_VoipRoomHeader=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(1618),__webpack_require__.e(6328)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/HeaderV2/Omnichannel/VoipRoomHeader.tsx"))})),Header_RoomHeaderE2EESetup=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(1618),__webpack_require__.e(9963)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/HeaderV2/RoomHeaderE2EESetup.tsx"))})),Header_RoomHeader=(0,react.lazy)((function(){return __webpack_require__.e(1618).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/HeaderV2/RoomHeader.tsx"))})),HeaderV2_Header_Header=function Header(_ref){var room=_ref.room,_useLayout=(0,ui_contexts_dist.useLayout)(),isMobile=_useLayout.isMobile,isEmbedded=_useLayout.isEmbedded,showTopNavbarEmbeddedLayout=_useLayout.showTopNavbarEmbeddedLayout,encrypted=Boolean(room.encrypted),unencryptedMessagesAllowed=(0,ui_contexts_dist.useSetting)("E2E_Allow_Unencrypted_Messages"),shouldDisplayE2EESetup=encrypted&&!unencryptedMessagesAllowed,slots=(0,react.useMemo)((function(){return{start:isMobile&&react.createElement(components_Header.NV,null,react.createElement(SidebarToggler.A,null))}}),[isMobile]);return isEmbedded&&!showTopNavbarEmbeddedLayout?null:"l"===room.t?react.createElement(Header_OmnichannelRoomHeader,{slots:slots}):(0,core_typings_dist.isVoipRoom)(room)?react.createElement(Header_VoipRoomHeader,{slots:slots,room:room}):shouldDisplayE2EESetup?react.createElement(Header_RoomHeaderE2EESetup,{room:room,slots:slots}):react.createElement(Header_RoomHeader,{slots:slots,room:room})},HeaderV2_Header=(0,react.memo)(HeaderV2_Header_Header);HeaderV2_Header_Header.__docgenInfo={description:"",methods:[],displayName:"Header",props:{room:{required:!0,tsType:{name:"IRoom"},description:""}}};var MessageHighlightContext=__webpack_require__("./client/views/room/MessageList/contexts/MessageHighlightContext.tsx"),messageHighlightSubscription=__webpack_require__("./client/views/room/MessageList/providers/messageHighlightSubscription.ts"),MessageHighlightProvider=function MessageHighlightProvider(_ref){var children=_ref.children,highlightMessageId=(0,shim.useSyncExternalStore)(messageHighlightSubscription.B1,messageHighlightSubscription.dV),contextValue=(0,react.useMemo)((function(){return{highlightMessageId:highlightMessageId}}),[highlightMessageId]);return react.createElement(MessageHighlightContext.A.Provider,{value:contextValue},children)},providers_MessageHighlightProvider=MessageHighlightProvider;MessageHighlightProvider.__docgenInfo={description:"",methods:[],displayName:"MessageHighlightProvider",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""}}};var RoomLeader_templateObject,RoomAnnouncement=__webpack_require__("./client/views/room/RoomAnnouncement/index.tsx"),MarkdownText=__webpack_require__("./client/components/MarkdownText.tsx"),usePresence=__webpack_require__("./client/hooks/usePresence.ts");function RoomLeader_extends(){return RoomLeader_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},RoomLeader_extends.apply(null,arguments)}var RoomLeader=function RoomLeader(_ref){var _id=_ref._id,name=_ref.name,username=_ref.username,t=(0,ui_contexts_dist.useTranslation)(),_useUserCard=(0,UserCardContext.P)(),openUserCard=_useUserCard.openUserCard,triggerProps=_useUserCard.triggerProps,onAvatarClick=(0,react.useCallback)((function(event,username){username&&openUserCard(event,username)}),[openUserCard]),chatNowLink=(0,react.useMemo)((function(){return roomCoordinator.roomCoordinator.getRouteLink("d",{name:username})||void 0}),[username]);if(!username)throw new Error("username is required");var roomLeaderStyle=(0,dist_index_module.css)(RoomLeader_templateObject||(RoomLeader_templateObject=function RoomLeader_taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tflex-shrink: 0;\n\t\tflex-grow: 0;\n\t\tgap: 4px;\n\n\t\t[role='button'] {\n\t\t\tcursor: pointer;\n\t\t}\n\t"])));return react.createElement(fuselage.Box,{className:roomLeaderStyle,mis:"x24"},react.createElement(ui_avatar_dist.H8,RoomLeader_extends({role:"button",username:username,size:"x18",onClick:function onClick(event){return onAvatarClick(event,username)}},triggerProps)),react.createElement(UserStatus.LO,{uid:_id}),react.createElement(components_Header.AZ,null,name),react.createElement(fuselage.IconButton,{role:"link",is:"a",title:t("Chat_with_leader"),icon:"message",small:!0,href:chatNowLink}))},HeaderV2_RoomLeader=RoomLeader;RoomLeader.__docgenInfo={description:"",methods:[],displayName:"RoomLeader",props:{_id:{required:!0,tsType:{name:"IUser['_id']",raw:"IUser['_id']"},description:""},name:{required:!0,tsType:{name:"IUser['name']",raw:"IUser['name']"},description:""},username:{required:!1,tsType:{name:"IUser['username']",raw:"IUser['username']"},description:""}}};var useCanEditRoom=__webpack_require__("./client/views/room/contextualBar/Info/hooks/useCanEditRoom.ts");function RoomTopic_typeof(o){return RoomTopic_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},RoomTopic_typeof(o)}function RoomTopic_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function RoomTopic_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?RoomTopic_ownKeys(Object(t),!0).forEach((function(r){RoomTopic_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):RoomTopic_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function RoomTopic_defineProperty(e,r,t){return(r=function RoomTopic_toPropertyKey(t){var i=function RoomTopic_toPrimitive(t,r){if("object"!=RoomTopic_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=RoomTopic_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==RoomTopic_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var RoomTopic=function RoomTopic(_ref){var _room$uids,_room$uids$length,_room$uids2,room=_ref.room,user=_ref.user,t=(0,ui_contexts_dist.useTranslation)(),canEdit=(0,useCanEditRoom.z)(room),userId=(0,ui_contexts_dist.useUserId)(),directUserId=null===(_room$uids=room.uids)||void 0===_room$uids?void 0:_room$uids.filter((function(uid){return uid!==userId})).shift(),directUserData=(0,usePresence.x)(directUserId),useRealName=(0,ui_contexts_dist.useSetting)("UI_Use_Real_Name"),currentRoute=(0,ui_contexts_dist.useRouter)().getLocationPathname(),href=(0,core_typings_dist.isTeamRoom)(room)?"".concat(currentRoute,"/team-info"):"".concat(currentRoute,"/channel-settings"),roomLeader=(0,useReactiveQuery.d)(["rooms",room._id,"leader",{not:null==user?void 0:user._id}],(function(){var leaderRoomRole=models_client.RoomRoles.findOne({rid:room._id,roles:"leader","u._id":{$ne:null==user?void 0:user._id}});return leaderRoomRole?RoomTopic_objectSpread(RoomTopic_objectSpread({},leaderRoomRole.u),{},{name:useRealName&&leaderRoomRole.u.name||leaderRoomRole.u.username}):null})).data,topic="d"===room.t&&(null!==(_room$uids$length=null===(_room$uids2=room.uids)||void 0===_room$uids2?void 0:_room$uids2.length)&&void 0!==_room$uids$length?_room$uids$length:0)<3?null==directUserData?void 0:directUserData.statusText:room.topic;return topic||roomLeader?react.createElement(dist.ER,{className:"rcx-header-section",role:"note"},react.createElement(dist.j5,null,roomLeader&&!topic&&canEdit?react.createElement(fuselage.Box,{is:"a",href:href},t("Add_topic")):react.createElement(MarkdownText.A,{parseEmoji:!0,variant:"inlineWithoutBreaks",withTruncatedText:!0,content:topic})),roomLeader&&react.createElement(HeaderV2_RoomLeader,roomLeader)):null};function useBannerSection_slicedToArray(r,e){return function useBannerSection_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function useBannerSection_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function useBannerSection_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return useBannerSection_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?useBannerSection_arrayLikeToArray(r,a):void 0}}(r,e)||function useBannerSection_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useBannerSection_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}RoomTopic.__docgenInfo={description:"",methods:[],displayName:"RoomTopic",props:{room:{required:!0,tsType:{name:"IRoom"},description:""},user:{required:!0,tsType:{name:"union",raw:"IUser | null",elements:[{name:"IUser"},{name:"null"}]},description:""}}};var RoomBodyV2_templateObject,RoomBodyV2_excluded=["innerRef","bubbleRef","listStyle"];function RoomBodyV2_extends(){return RoomBodyV2_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},RoomBodyV2_extends.apply(null,arguments)}function RoomBodyV2_slicedToArray(r,e){return function RoomBodyV2_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function RoomBodyV2_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function RoomBodyV2_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return RoomBodyV2_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?RoomBodyV2_arrayLikeToArray(r,a):void 0}}(r,e)||function RoomBodyV2_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function RoomBodyV2_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var RoomBodyV2_RoomBody=function RoomBody(){var chat=(0,ChatContext.Y)();if(!chat)throw new Error("No ChatContext provided");var t=(0,ui_contexts_dist.useTranslation)(),isLayoutEmbedded=(0,useEmbeddedLayout.a)(),room=(0,RoomContext.nq)(),user=(0,ui_contexts_dist.useUser)(),toolbox=(0,RoomToolboxContext.W)(),admin=(0,ui_contexts_dist.useRole)("admin"),subscription=(0,RoomContext.Mq)(),retentionPolicy=(0,useRetentionPolicy._)(room),hideFlexTab=(0,ui_contexts_dist.useUserPreference)("hideFlexTab")||void 0,hideUsernames=(0,ui_contexts_dist.useUserPreference)("hideUsernames"),displayAvatars=(0,ui_contexts_dist.useUserPreference)("displayAvatars"),_useRoomMessages=(0,RoomContext.RV)(),hasMorePreviousMessages=_useRoomMessages.hasMorePreviousMessages,hasMoreNextMessages=_useRoomMessages.hasMoreNextMessages,isLoadingMoreMessages=_useRoomMessages.isLoadingMoreMessages,allowAnonymousRead=(0,ui_contexts_dist.useSetting)("Accounts_AllowAnonymousRead"),canPreviewChannelRoom=(0,ui_contexts_dist.usePermission)("preview-c-room"),subscribed=!!subscription,canPreview=(0,react.useMemo)((function(){return!(!room||"c"===room.t)||(!0===allowAnonymousRead||(!!canPreviewChannelRoom||subscribed))}),[allowAnonymousRead,canPreviewChannelRoom,room,subscribed]),innerBoxRef=(0,react.useRef)(null),_useHandleUnread=useHandleUnread(room,subscription),unreadBarWrapperRef=_useHandleUnread.wrapperRef,unreadBarInnerRef=_useHandleUnread.innerRef,handleUnreadBarJumpToButtonClick=_useHandleUnread.handleUnreadBarJumpToButtonClick,handleMarkAsReadButtonClick=_useHandleUnread.handleMarkAsReadButtonClick,unread=RoomBodyV2_slicedToArray(_useHandleUnread.counter,1)[0],_useDateScroll=(0,useDateScroll.v)(),dateScrollInnerRef=_useDateScroll.innerRef,bubbleRef=_useDateScroll.bubbleRef,listStyle=_useDateScroll.listStyle,bubbleDate=function RoomBodyV2_objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function RoomBodyV2_objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_useDateScroll,RoomBodyV2_excluded),_useListIsAtBottom=useListIsAtBottom(),isAtBottomInnerRef=_useListIsAtBottom.innerRef,atBottomRef=_useListIsAtBottom.atBottomRef,sendToBottom=_useListIsAtBottom.sendToBottom,sendToBottomIfNecessary=_useListIsAtBottom.sendToBottomIfNecessary,isAtBottom=_useListIsAtBottom.isAtBottom,getMoreInnerRef=useGetMore(room._id,atBottomRef).innerRef,_useBannerSection=function useBannerSection(){var _useState2=useBannerSection_slicedToArray((0,react.useState)(!1),2),hideSection=_useState2[0],setHideSection=_useState2[1],wrapperBoxRef=(0,react.useRef)(null),innerScrollRef=(0,react.useCallback)((function(node){var _wrapperBoxRef$curren;if(node){var lastScrollTopRef=0;null===(_wrapperBoxRef$curren=wrapperBoxRef.current)||void 0===_wrapperBoxRef$curren||_wrapperBoxRef$curren.addEventListener("mouseover",(function(){return setHideSection(!1)})),node.addEventListener("scroll",(0,highOrderFunctions.u)({wait:100})((function(event){var _wrapperBoxRef$curren2,roomLeader=null===(_wrapperBoxRef$curren2=wrapperBoxRef.current)||void 0===_wrapperBoxRef$curren2?void 0:_wrapperBoxRef$curren2.querySelector(".rcx-header-section");roomLeader&&(scrolling_isAtBottom(node,0)?setHideSection(!1):(event.target.scrollTop<lastScrollTopRef||!scrolling_isAtBottom(node,100)&&event.target.scrollTop>parseFloat(getComputedStyle(roomLeader).height))&&setHideSection(!0)),lastScrollTopRef=event.target.scrollTop})),{passive:!0})}}),[]);return{wrapperRef:wrapperBoxRef,hideSection:hideSection,innerRef:innerScrollRef}}(),sectionWrapperRef=_useBannerSection.wrapperRef,hideSection=_useBannerSection.hideSection,sectionScrollRef=_useBannerSection.innerRef,_useFileUpload=useFileUpload(),uploads=_useFileUpload.uploads,handleUploadFiles=_useFileUpload.handleUploadFiles,handleUploadProgressClose=_useFileUpload.handleUploadProgressClose,_useFileUpload$targeD=RoomBodyV2_slicedToArray(_useFileUpload.targeDrop,2),fileUploadTriggerProps=_useFileUpload$targeD[0],fileUploadOverlayProps=_useFileUpload$targeD[1],restoreScrollPositionInnerRef=useRestoreScrollPosition(room._id).innerRef,messageListRef=(0,useMessageListNavigation.b)().messageListRef,_useHasNewMessages=useHasNewMessages(room._id,null==user?void 0:user._id,atBottomRef,{sendToBottom:sendToBottom,sendToBottomIfNecessary:sendToBottomIfNecessary,isAtBottom:isAtBottom}),handleNewMessageButtonClick=_useHasNewMessages.handleNewMessageButtonClick,handleJumpToRecentButtonClick=_useHasNewMessages.handleJumpToRecentButtonClick,handleComposerResize=_useHasNewMessages.handleComposerResize,hasNewMessages=_useHasNewMessages.hasNewMessages,newMessagesScrollRef=_useHasNewMessages.newMessagesScrollRef,innerRef=(0,index_module.useMergedRefs)(dateScrollInnerRef,innerBoxRef,restoreScrollPositionInnerRef,isAtBottomInnerRef,newMessagesScrollRef,sectionScrollRef,unreadBarInnerRef,getMoreInnerRef,messageListRef),wrapperBoxRefs=(0,index_module.useMergedRefs)(unreadBarWrapperRef),handleNavigateToPreviousMessage=(0,react.useCallback)((function(){chat.messageEditing.toPreviousMessage()}),[chat.messageEditing]),handleNavigateToNextMessage=(0,react.useCallback)((function(){chat.messageEditing.toNextMessage()}),[chat.messageEditing]),handleCloseFlexTab=(0,react.useCallback)((function(e){(function checkElement(element){return!!element&&(element instanceof HTMLButtonElement||"button"===element.getAttribute("role")||(element instanceof HTMLAnchorElement||"link"===element.getAttribute("role")||checkElement(element.parentElement)))})(e.target)||toolbox.closeTab()}),[toolbox]);useGoToHomeOnRemoved(room,null==user?void 0:user._id),useReadMessageWindowEvents(),useQuoteMessageByUrl();var wrapperStyle=(0,dist_index_module.css)(RoomBodyV2_templateObject||(RoomBodyV2_templateObject=function RoomBodyV2_taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n\t\tposition: absolute;\n\t\twidth: 100%;\n\t\tz-index: 5;\n\t\ttop: 0px;\n\n\t\t&.animated-hidden {\n\t\t\ttop: -88px;\n\t\t}\n\t"])));return react.createElement(react.Fragment,null,react.createElement(fuselage.Box,{position:"relative",w:"full"},react.createElement(fuselage.Box,{animated:!0,className:[wrapperStyle,hideSection&&"animated-hidden"].filter(isTruthy.z),ref:sectionWrapperRef},react.createElement(RoomTopic,{room:room,user:user}),!isLayoutEmbedded&&room.announcement&&react.createElement(RoomAnnouncement.A,{announcement:room.announcement,announcementDetails:void 0}))),react.createElement(fuselage.Box,{key:room._id,className:["main-content-flex",listStyle]},react.createElement("section",{role:"presentation",className:"messages-container flex-tab-main-content ".concat(admin?"admin":""),id:"chat-window-".concat(room._id),onClick:hideFlexTab&&handleCloseFlexTab},react.createElement("div",{className:"messages-container-wrapper"},react.createElement("div",RoomBodyV2_extends({className:"messages-container-main",ref:wrapperBoxRefs},fileUploadTriggerProps),react.createElement(DropTargetOverlay.A,fileUploadOverlayProps),react.createElement(fuselage.Box,{position:"absolute",w:"full"},react.createElement("div",{className:["container-bars",uploads.length&&"show"].filter(isTruthy.z).join(" ")},uploads.map((function(upload){return react.createElement(body_UploadProgressIndicator,{key:upload.id,id:upload.id,name:upload.name,percentage:upload.percentage,error:upload.error instanceof Error?upload.error.message:void 0,onClose:handleUploadProgressClose})}))),Boolean(unread)&&react.createElement(body_UnreadMessagesIndicator,{count:unread,onJumpButtonClick:handleUnreadBarJumpToButtonClick,onMarkAsReadButtonClick:handleMarkAsReadButtonClick}),react.createElement(BubbleDate.J,RoomBodyV2_extends({ref:bubbleRef},bubbleDate))),react.createElement("div",{className:["messages-box"].filter(isTruthy.z).join(" ")},react.createElement(body_JumpToRecentMessageButton,{visible:hasNewMessages,onClick:handleNewMessageButtonClick,text:t("New_messages")}),react.createElement(body_JumpToRecentMessageButton,{visible:hasMoreNextMessages,onClick:handleJumpToRecentButtonClick,text:t("Jump_to_recent_messages")}),canPreview?null:react.createElement("div",{className:"content room-not-found error-color"},react.createElement("div",null,t("You_must_join_to_view_messages_in_this_channel"))),react.createElement("div",{className:["wrapper",hasMoreNextMessages&&"has-more-next",hideUsernames&&"hide-usernames",!displayAvatars&&"hide-avatar"].filter(isTruthy.z).join(" ")},react.createElement(MessageListErrorBoundary.A,null,react.createElement(CustomScrollbars.z,{ref:innerRef},react.createElement("ul",{className:"messages-list","aria-label":t("Message_list"),"aria-busy":isLoadingMoreMessages},canPreview?react.createElement(react.Fragment,null,hasMorePreviousMessages?react.createElement("li",{className:"load-more"},isLoadingMoreMessages?react.createElement(LoadingMessagesIndicator.A,null):null):react.createElement("li",null,react.createElement(RoomForeword_RoomForeword,{user:user,room:room}),null!=retentionPolicy&&retentionPolicy.isActive?react.createElement(body_RetentionPolicyWarning,{room:room}):null)):null,react.createElement(MessageList,{rid:room._id,messageListRef:innerBoxRef}),hasMoreNextMessages?react.createElement("li",{className:"load-more"},isLoadingMoreMessages?react.createElement(LoadingMessagesIndicator.A,null):null):null))))),react.createElement(RoomComposer.A,null,react.createElement(ComposerContainer.A,{subscription:subscription,onResize:handleComposerResize,onNavigateToPreviousMessage:handleNavigateToPreviousMessage,onNavigateToNextMessage:handleNavigateToNextMessage,onUploadFiles:handleUploadFiles})))))))},RoomBodyV2=(0,react.memo)(RoomBodyV2_RoomBody);RoomBodyV2_RoomBody.__docgenInfo={description:"",methods:[],displayName:"RoomBody"};var useUiKitActionManager=__webpack_require__("./client/uikit/hooks/useUiKitActionManager.ts"),RoomLayout=__webpack_require__("./client/views/room/layout/RoomLayout.tsx"),ChatProvider=__webpack_require__("./client/views/room/providers/ChatProvider.tsx"),UiKitContextualBar=(0,react.lazy)((function(){return __webpack_require__.e(4099).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/uikit/UiKitContextualBar.tsx"))})),Room=function Room(){var _toolbox$tab,t=(0,ui_contexts_dist.useTranslation)(),room=(0,RoomContext.nq)(),toolbox=(0,RoomToolboxContext.W)(),contextualBarView=function useAppsContextualBar(){var viewId=(0,ui_contexts_dist.useRouteParameter)("context"),actionManager=(0,useUiKitActionManager.v)(),getSnapshot=(0,react.useCallback)((function(){var _actionManager$getInt;if(viewId)return null===(_actionManager$getInt=actionManager.getInteractionPayloadByViewId(viewId))||void 0===_actionManager$getInt?void 0:_actionManager$getInt.view}),[actionManager,viewId]),subscribe=(0,react.useCallback)((function(handler){return viewId?(actionManager.on(viewId,handler),function(){return actionManager.off(viewId,handler)}):function(){}}),[actionManager,viewId]);return(0,shim.useSyncExternalStore)(subscribe,getSnapshot)}(),isE2EEnabled=(0,ui_contexts_dist.useSetting)("E2E_Enable"),unencryptedMessagesAllowed=(0,ui_contexts_dist.useSetting)("E2E_Allow_Unencrypted_Messages"),shouldDisplayE2EESetup=(null==room?void 0:room.encrypted)&&!unencryptedMessagesAllowed&&isE2EEnabled;return react.createElement(ChatProvider.A,null,react.createElement(providers_MessageHighlightProvider,null,react.createElement(dist_import.n1,null,react.createElement(DateListProvider.E5,null,react.createElement(RoomLayout.default,{"data-qa-rc-room":room._id,"aria-label":"d"===room.t?t("Conversation_with__roomName__",{roomName:room.name}):t("Channel__roomName__",{roomName:room.name}),header:react.createElement(react.Fragment,null,react.createElement(dist.TW,{feature:"newNavigation"},react.createElement(dist.Uq,null,react.createElement(HeaderV2_Header,{room:room})),react.createElement(dist.sl,null,react.createElement(Header_Header,{room:room})))),body:shouldDisplayE2EESetup?react.createElement(E2EESetup_RoomE2EESetup,null):react.createElement(react.Fragment,null,react.createElement(dist.TW,{feature:"newNavigation"},react.createElement(dist.Uq,null,react.createElement(RoomBodyV2,null)),react.createElement(dist.sl,null,react.createElement(body_RoomBody,null)))),aside:(null===(_toolbox$tab=toolbox.tab)||void 0===_toolbox$tab?void 0:_toolbox$tab.tabComponent)&&react.createElement(react_error_boundary_umd.ErrorBoundary,{fallback:null},react.createElement(SelectedMessagesProvider.j,null,react.createElement(react.Suspense,{fallback:react.createElement(Contextualbar.Kg,null)},(0,react.createElement)(toolbox.tab.tabComponent))))||contextualBarView&&react.createElement(react_error_boundary_umd.ErrorBoundary,{fallback:null},react.createElement(SelectedMessagesProvider.j,null,react.createElement(react.Suspense,{fallback:react.createElement(Contextualbar.Kg,null)},react.createElement(UiKitContextualBar,{key:contextualBarView.id,initialView:contextualBarView}))))})))))},room_Room=(0,react.memo)(Room);Room.__docgenInfo={description:"",methods:[],displayName:"Room"}},"./client/views/room/RoomAnnouncement/index.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:function(){return RoomAnnouncement_RoomAnnouncement}});var fuselage=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),index_module=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),dist=__webpack_require__("../../packages/ui-contexts/dist/index.js"),react=__webpack_require__("./node_modules/react/index.js"),GenericModal=__webpack_require__("./client/components/GenericModal/index.ts"),MarkdownText=__webpack_require__("./client/components/MarkdownText.tsx"),ui_client_dist=__webpack_require__("../../packages/ui-client/dist/index.js"),AnnouncementComponent=function AnnouncementComponent(_ref){var children=_ref.children,onClickOpen=_ref.onClickOpen;return react.createElement(ui_client_dist.ER,{className:"rcx-header-section",onClick:onClickOpen},react.createElement(ui_client_dist.j5,{"data-qa":"AnnouncementAnnoucementComponent"},children))},RoomAnnouncement_AnnouncementComponent=AnnouncementComponent;AnnouncementComponent.__docgenInfo={description:"",methods:[],displayName:"AnnouncementComponent",props:{onClickOpen:{required:!0,tsType:{name:"signature",type:"function",raw:"(e: MouseEvent<HTMLAnchorElement>) => void",signature:{arguments:[{type:{name:"MouseEvent",elements:[{name:"HTMLAnchorElement"}],raw:"MouseEvent<HTMLAnchorElement>"},name:"e"}],return:{name:"void"}}},description:""}}};var RoomAnnouncement=function RoomAnnouncement(_ref){var announcement=_ref.announcement,announcementDetails=_ref.announcementDetails,t=(0,dist.useTranslation)(),setModal=(0,dist.useSetModal)(),closeModal=(0,index_module.useMutableCallback)((function(){return setModal(null)}));return announcement?react.createElement(RoomAnnouncement_AnnouncementComponent,{onClickOpen:function handleClick(e){var _window;e.target.href||""===(null===(_window=window)||void 0===_window||null===(_window=_window.getSelection())||void 0===_window?void 0:_window.toString())&&(announcementDetails?announcementDetails():setModal(react.createElement(GenericModal.A,{icon:null,title:t("Announcement"),confirmText:t("Close"),onConfirm:closeModal,onClose:closeModal},react.createElement(fuselage.Box,null,react.createElement(MarkdownText.A,{content:announcement,parseEmoji:!0})))))}},react.createElement(MarkdownText.A,{variant:"inlineWithoutBreaks",content:announcement,withTruncatedText:!0,parseEmoji:!0})):null},RoomAnnouncement_RoomAnnouncement=RoomAnnouncement;RoomAnnouncement.__docgenInfo={description:"",methods:[],displayName:"RoomAnnouncement",props:{announcement:{required:!0,tsType:{name:"string"},description:""},announcementDetails:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}}},"./client/views/room/contextualBar/Info/hooks/useCanEditRoom.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{z:function(){return useCanEditRoom}});var _rocket_chat_core_typings__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../packages/core-typings/dist/index.js"),_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../packages/ui-contexts/dist/index.js"),_lib_federation_Federation__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./client/lib/federation/Federation.ts"),_contexts_RoomContext__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./client/views/room/contexts/RoomContext.ts"),useCanEditRoom=function useCanEditRoom(room){var user=(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_1__.useUser)(),subscription=(0,_contexts_RoomContext__WEBPACK_IMPORTED_MODULE_3__.Mq)(),hasPermissionToEdit=(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_1__.usePermission)("edit-room",room._id),isFederated=(0,_rocket_chat_core_typings__WEBPACK_IMPORTED_MODULE_0__.isRoomFederated)(room);return user&&isFederated?_lib_federation_Federation__WEBPACK_IMPORTED_MODULE_2__.AT(user,room,subscription)&&hasPermissionToEdit:hasPermissionToEdit}},"./client/views/room/hooks/useRetentionPolicy.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{_:function(){return useRetentionPolicy}});var _rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../packages/ui-contexts/dist/index.js"),_lib_convertTimeUnit__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./client/lib/convertTimeUnit.ts"),hasRetentionPolicy=function hasRetentionPolicy(room){return"retention"in room&&void 0!==room.retention},isRetentionOverridden=function isRetentionOverridden(room){return"overrideGlobal"in room.retention&&room.retention.overrideGlobal},isActive=function isActive(room,_ref){var enabled=_ref.enabled,appliesToChannels=_ref.appliesToChannels,appliesToGroups=_ref.appliesToGroups,appliesToDMs=_ref.appliesToDMs;if(!enabled)return!1;if(hasRetentionPolicy(room)&&void 0!==room.retention.enabled)return room.retention.enabled;switch(room.t){case"c":return appliesToChannels;case"p":return appliesToGroups;case"d":return appliesToDMs}return!1},extractFilesOnly=function extractFilesOnly(room,_ref2){var filesOnly=_ref2.filesOnly;return hasRetentionPolicy(room)&&isRetentionOverridden(room)?room.retention.filesOnly:filesOnly},extractExcludePinned=function extractExcludePinned(room,_ref3){var doNotPrunePinned=_ref3.doNotPrunePinned;return hasRetentionPolicy(room)&&isRetentionOverridden(room)?room.retention.excludePinned:doNotPrunePinned},extractIgnoreThreads=function extractIgnoreThreads(room,_ref4){var ignoreThreads=_ref4.ignoreThreads;return hasRetentionPolicy(room)&&isRetentionOverridden(room)?room.retention.ignoreThreads:ignoreThreads},getMaxAge=function getMaxAge(room,_ref5){var maxAgeChannels=_ref5.maxAgeChannels,maxAgeGroups=_ref5.maxAgeGroups,maxAgeDMs=_ref5.maxAgeDMs;return hasRetentionPolicy(room)&&isRetentionOverridden(room)&&(0,_lib_convertTimeUnit__WEBPACK_IMPORTED_MODULE_1__.yO)(room.retention.maxAge)?(0,_lib_convertTimeUnit__WEBPACK_IMPORTED_MODULE_1__.vK)(_lib_convertTimeUnit__WEBPACK_IMPORTED_MODULE_1__.k2.days,room.retention.maxAge):"c"===room.t?maxAgeChannels:"p"===room.t?maxAgeGroups:"d"===room.t?maxAgeDMs:-1/0},useRetentionPolicy=function useRetentionPolicy(room){var settings={enabled:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_Enabled"),filesOnly:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_FilesOnly"),doNotPrunePinned:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_DoNotPrunePinned"),ignoreThreads:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_DoNotPruneThreads"),appliesToChannels:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_AppliesToChannels"),maxAgeChannels:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_TTL_Channels"),appliesToGroups:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_AppliesToGroups"),maxAgeGroups:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_TTL_Groups"),appliesToDMs:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_AppliesToDMs"),maxAgeDMs:(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("RetentionPolicy_TTL_DMs")};if(room)return{enabled:settings.enabled,isActive:isActive(room,settings),filesOnly:extractFilesOnly(room,settings),excludePinned:extractExcludePinned(room,settings),ignoreThreads:extractIgnoreThreads(room,settings),maxAge:getMaxAge(room,settings)}}}}]);