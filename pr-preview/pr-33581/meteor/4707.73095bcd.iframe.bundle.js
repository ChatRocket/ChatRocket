/*! For license information please see 4707.73095bcd.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_rocket_chat_meteor=self.webpackChunk_rocket_chat_meteor||[]).push([[4707],{"./client/components/FilterByText.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var _rocket_chat_fuselage__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),_rocket_chat_fuselage_hooks__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../packages/ui-contexts/dist/index.js"),react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/react/index.js"),_excluded=["placeholder","onChange","shouldAutoFocus","children"];function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var FilterByText=(0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)((function FilterByText(_ref,ref){var placeholder=_ref.placeholder,setFilter=_ref.onChange,_ref$shouldAutoFocus=_ref.shouldAutoFocus,shouldAutoFocus=void 0!==_ref$shouldAutoFocus&&_ref$shouldAutoFocus,children=_ref.children,props=function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_ref,_excluded),t=(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_2__.useTranslation)(),_useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(""),2),text=_useState2[0],setText=_useState2[1],autoFocusRef=(0,_rocket_chat_fuselage_hooks__WEBPACK_IMPORTED_MODULE_1__.useAutoFocus)(shouldAutoFocus),mergedRefs=(0,_rocket_chat_fuselage_hooks__WEBPACK_IMPORTED_MODULE_1__.useMergedRefs)(ref,autoFocusRef),handleFormSubmit=(0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)((function(event){event.preventDefault()}),[]);return react__WEBPACK_IMPORTED_MODULE_3__.createElement(_rocket_chat_fuselage__WEBPACK_IMPORTED_MODULE_0__.Box,{mb:16,mi:"neg-x4",is:"form",onSubmit:handleFormSubmit,display:"flex",flexWrap:"wrap",alignItems:"center"},react__WEBPACK_IMPORTED_MODULE_3__.createElement(_rocket_chat_fuselage__WEBPACK_IMPORTED_MODULE_0__.Box,{mi:4,display:"flex",flexGrow:1},react__WEBPACK_IMPORTED_MODULE_3__.createElement(_rocket_chat_fuselage__WEBPACK_IMPORTED_MODULE_0__.TextInput,_extends({},props,{placeholder:null!=placeholder?placeholder:t("Search"),ref:mergedRefs,addon:react__WEBPACK_IMPORTED_MODULE_3__.createElement(_rocket_chat_fuselage__WEBPACK_IMPORTED_MODULE_0__.Icon,{name:"magnifier",size:"x20"}),onChange:function handleInputChange(event){setText(event.currentTarget.value),setFilter(event.currentTarget.value)},value:text,flexGrow:2,minWidth:"x220","aria-label":null!=placeholder?placeholder:t("Search")}))),children&&react__WEBPACK_IMPORTED_MODULE_3__.createElement(_rocket_chat_fuselage__WEBPACK_IMPORTED_MODULE_0__.Margins,{inline:4},children))}));__webpack_exports__.A=(0,react__WEBPACK_IMPORTED_MODULE_3__.memo)(FilterByText),FilterByText.__docgenInfo={description:"",methods:[],displayName:"FilterByText",props:{shouldAutoFocus:{defaultValue:{value:"false",computed:!1},required:!1}}}},"./client/components/GenericTable/hooks/useSort.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{y:function(){return useSort}});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var useSort=function useSort(by){var initialDirection=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",_useState2=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_0__.useState)((function(){return[by,initialDirection]})),2),sort=_useState2[0],_setSort=_useState2[1],setSort=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(id,direction){_setSort((function(_ref){var _ref2=_slicedToArray(_ref,2),sortBy=_ref2[0],sortDirection=_ref2[1];return direction?[id,direction]:sortBy===id?[id,"asc"===sortDirection?"desc":"asc"]:[id,"asc"]}))}),[]);return{sortBy:sort[0],sortDirection:sort[1],setSort:setSort}}},"./client/components/GenericTable/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{oY:function(){return GenericTable},yT:function(){return GenericTableBody},Sr:function(){return GenericTableCell},Po:function(){return GenericTableHeader},Fp:function(){return GenericTableHeaderCell},aN:function(){return GenericTableLoadingRow},K1:function(){return GenericTableLoadingTable},aX:function(){return GenericTableRow}});var fuselage=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),react=__webpack_require__("./node_modules/react/index.js"),CustomScrollbars=__webpack_require__("./client/components/CustomScrollbars/index.ts"),_excluded=["fixed","children"];function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}var GenericTable=(0,react.forwardRef)((function GenericTable(_ref,ref){var _ref$fixed=_ref.fixed,fixed=void 0===_ref$fixed||_ref$fixed,children=_ref.children,props=function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_ref,_excluded);return react.createElement(fuselage.Box,{mi:"neg-x24",pi:24,flexShrink:1,flexGrow:1,ref:ref,overflow:"hidden"},react.createElement(CustomScrollbars.z,{overflowX:!0},react.createElement(fuselage.Table,_extends({fixed:fixed,sticky:!0},props),children)))}));GenericTable.__docgenInfo={description:"",methods:[],displayName:"GenericTable",props:{fixed:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};var GenericTableBody=function GenericTableBody(props){return react.createElement(fuselage.TableBody,props)};GenericTableBody.__docgenInfo={description:"",methods:[],displayName:"GenericTableBody"};var GenericTableCell=function GenericTableCell(props){return react.createElement(fuselage.TableCell,props)};GenericTableCell.__docgenInfo={description:"",methods:[],displayName:"GenericTableCell"};var GenericTableRow=function GenericTableRow(props){return react.createElement(fuselage.TableRow,props)};GenericTableRow.__docgenInfo={description:"",methods:[],displayName:"GenericTableRow"};var GenericTableHeader_excluded=["children"];var GenericTableHeader=function GenericTableHeader(_ref){var children=_ref.children,props=function GenericTableHeader_objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function GenericTableHeader_objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_ref,GenericTableHeader_excluded);return react.createElement(fuselage.TableHead,props,react.createElement(GenericTableRow,null,children))};GenericTableHeader.__docgenInfo={description:"",methods:[],displayName:"GenericTableHeader"};var SortIcon=function SortIcon(_ref){var direction=_ref.direction;return react.createElement(fuselage.Box,{is:"svg",width:"x16",height:"x16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},react.createElement("path",{d:"M5.33337 5.99999L8.00004 3.33333L10.6667 5.99999",stroke:"desc"===direction?"#9EA2A8":"#E4E7EA",strokeWidth:"1.33333",strokeLinecap:"round",strokeLinejoin:"round"}),react.createElement("path",{d:"M5.33337 10L8.00004 12.6667L10.6667 10",stroke:"asc"===direction?"#9EA2A8":"#E4E7EA",strokeWidth:"1.33333",strokeLinecap:"round",strokeLinejoin:"round"}))},GenericTable_SortIcon=SortIcon;SortIcon.__docgenInfo={description:"",methods:[],displayName:"SortIcon",props:{direction:{required:!1,tsType:{name:"union",raw:"'asc' | 'desc'",elements:[{name:"literal",value:"'asc'"},{name:"literal",value:"'desc'"}]},description:""}}};var GenericTableHeaderCell_excluded=["children","active","direction","sort","onClick"];function GenericTableHeaderCell_extends(){return GenericTableHeaderCell_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},GenericTableHeaderCell_extends.apply(null,arguments)}var GenericTableHeaderCell=function GenericTableHeaderCell(_ref){var children=_ref.children,active=_ref.active,direction=_ref.direction,sort=_ref.sort,onClick=_ref.onClick,props=function GenericTableHeaderCell_objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function GenericTableHeaderCell_objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_ref,GenericTableHeaderCell_excluded),fn=(0,react.useCallback)((function(){return onClick&&sort&&onClick(sort)}),[sort,onClick]);return react.createElement(fuselage.TableCell,GenericTableHeaderCell_extends({clickable:!!sort,onClick:fn},props),react.createElement(fuselage.Box,{display:"flex",alignItems:"center",wrap:"no-wrap"},children,sort&&react.createElement(GenericTable_SortIcon,{direction:active?direction:void 0})))};GenericTableHeaderCell.__docgenInfo={description:"",methods:[],displayName:"GenericTableHeaderCell",props:{active:{required:!1,tsType:{name:"boolean"},description:""},direction:{required:!1,tsType:{name:"union",raw:"'asc' | 'desc'",elements:[{name:"literal",value:"'asc'"},{name:"literal",value:"'desc'"}]},description:""},sort:{required:!1,tsType:{name:"T"},description:""},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"(sort: T) => void",signature:{arguments:[{type:{name:"T"},name:"sort"}],return:{name:"void"}}},description:""}}};var GenericTableLoadingRow=function GenericTableLoadingRow(_ref){var cols=_ref.cols;return react.createElement(fuselage.TableRow,null,react.createElement(fuselage.TableCell,null,react.createElement(fuselage.Box,{display:"flex"},react.createElement(fuselage.Skeleton,{variant:"rect",height:40,width:40}),react.createElement(fuselage.Box,{mi:8,flexGrow:1},react.createElement(fuselage.Skeleton,{width:"100%"}),react.createElement(fuselage.Skeleton,{width:"100%"})))),Array.from({length:cols-1},(function(_,i){return react.createElement(fuselage.TableCell,{key:i},react.createElement(fuselage.Skeleton,{width:"100%"}))})))};GenericTableLoadingRow.__docgenInfo={description:"",methods:[],displayName:"GenericTableLoadingRow",props:{cols:{required:!0,tsType:{name:"number"},description:""}}};var GenericTableLoadingTable=function GenericTableLoadingTable(_ref){var headerCells=_ref.headerCells;return react.createElement(react.Fragment,null,Array.from({length:10},(function(_,i){return react.createElement(GenericTableLoadingRow,{key:i,cols:headerCells})})))};GenericTableLoadingTable.__docgenInfo={description:"",methods:[],displayName:"GenericTableLoadingTable",props:{headerCells:{required:!0,tsType:{name:"number"},description:""}}}},"./client/components/LoadingIndicator.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),LoadingIndicator=function LoadingIndicator(_ref){var variation=_ref.variation;return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"loading__animation"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:["loading__animation__bounce",variation&&"loading__animation__bounce--".concat(variation)].filter(Boolean).join(" ")}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:["loading__animation__bounce",variation&&"loading__animation__bounce--".concat(variation)].filter(Boolean).join(" ")}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:["loading__animation__bounce",variation&&"loading__animation__bounce--".concat(variation)].filter(Boolean).join(" ")}))};__webpack_exports__.A=LoadingIndicator,LoadingIndicator.__docgenInfo={description:"",methods:[],displayName:"LoadingIndicator",props:{variation:{required:!1,tsType:{name:"union",raw:"'medium' | 'large'",elements:[{name:"literal",value:"'medium'"},{name:"literal",value:"'large'"}]},description:""}}}},"./client/contexts/EmojiPickerContext.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A1:function(){return useEmojiPickerData},Wq:function(){return useEmojiPicker},kO:function(){return usePreviewEmoji}});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),EmojiPickerContext=(0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(void 0),useEmojiPickerContext=function useEmojiPickerContext(){var context=(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(EmojiPickerContext);if(!context)throw new Error("Must be running in EmojiPicker Context");return context},useEmojiPicker=function useEmojiPicker(){return{open:useEmojiPickerContext().open,isOpen:useEmojiPickerContext().isOpen,close:useEmojiPickerContext().close}},usePreviewEmoji=function usePreviewEmoji(){return{emojiToPreview:useEmojiPickerContext().emojiToPreview,handlePreview:useEmojiPickerContext().handlePreview,handleRemovePreview:useEmojiPickerContext().handleRemovePreview}},useEmojiPickerData=function useEmojiPickerData(){var _useEmojiPickerContex=useEmojiPickerContext(),actualTone=_useEmojiPickerContex.actualTone,addRecentEmoji=_useEmojiPickerContex.addRecentEmoji,currentCategory=_useEmojiPickerContex.currentCategory,customItemsLimit=_useEmojiPickerContex.customItemsLimit,getEmojiListsByCategory=_useEmojiPickerContex.getEmojiListsByCategory,quickReactions=_useEmojiPickerContex.quickReactions,recentEmojis=_useEmojiPickerContex.recentEmojis,setActualTone=_useEmojiPickerContex.setActualTone,setCurrentCategory=_useEmojiPickerContex.setCurrentCategory,setCustomItemsLimit=_useEmojiPickerContex.setCustomItemsLimit;return{addRecentEmoji:addRecentEmoji,getEmojiListsByCategory:getEmojiListsByCategory,recentEmojis:recentEmojis,setRecentEmojis:_useEmojiPickerContex.setRecentEmojis,actualTone:actualTone,currentCategory:currentCategory,setCurrentCategory:setCurrentCategory,customItemsLimit:customItemsLimit,setCustomItemsLimit:setCustomItemsLimit,setActualTone:setActualTone,quickReactions:quickReactions}}},"./client/hooks/omnichannel/useOmnichannelAgentAvailable.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{U:function(){return useOmnichannelAgentAvailable}});var _useOmnichannel__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./client/hooks/omnichannel/useOmnichannel.ts"),useOmnichannelAgentAvailable=function useOmnichannelAgentAvailable(){return(0,_useOmnichannel__WEBPACK_IMPORTED_MODULE_0__.q)().agentAvailable}},"./client/hooks/webdav/useWebDAVAccountIntegrationsQuery.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{l:function(){return useWebDAVAccountIntegrationsQuery}});var _rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../packages/ui-contexts/dist/index.js"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/@tanstack/react-query/build/lib/index.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}var _excluded=["enabled"];function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var useWebDAVAccountIntegrationsQuery=function useWebDAVAccountIntegrationsQuery(){var _queryFn,_ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$enabled=_ref.enabled,enabled=void 0===_ref$enabled||_ref$enabled,options=function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_ref,_excluded),uid=(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useUserId)(),queryKey=(0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)((function(){return["webdav","account-integrations"]}),[]),getMyAccounts=(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useEndpoint)("GET","/v1/webdav.getMyAccounts"),integrationsQuery=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_2__.useQuery)(function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({queryKey:queryKey,queryFn:(_queryFn=function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(_regeneratorRuntime().mark((function _callee(){var _yield$getMyAccounts,accounts;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,getMyAccounts();case 2:return _yield$getMyAccounts=_context.sent,accounts=_yield$getMyAccounts.accounts,_context.abrupt("return",accounts);case 5:case"end":return _context.stop()}}),_callee)}))),function queryFn(){return _queryFn.apply(this,arguments)}),enabled:!!uid&&enabled,staleTime:1/0},options)),queryClient=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_2__.useQueryClient)(),subscribeToNotifyUser=(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useStream)("notify-user");return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){if(uid&&enabled)return subscribeToNotifyUser("".concat(uid,"/webdav"),(function(_ref2){var type=_ref2.type,account=_ref2.account;switch(type){case"changed":queryClient.invalidateQueries(queryKey);break;case"removed":queryClient.setQueryData(queryKey,(function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((function(oldAccount){return oldAccount._id!==account._id}))}))}}))}),[enabled,queryClient,queryKey,uid,subscribeToNotifyUser]),integrationsQuery}},"./client/views/room/BubbleDate/index.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{J:function(){return BubbleDate}});var fuselage=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),react=__webpack_require__("./node_modules/react/index.js"),useFormatDate=__webpack_require__("./client/hooks/useFormatDate.ts"),BubbleDate=(0,react.forwardRef)((function BubbleDate(_ref,ref){var bubbleDate=_ref.bubbleDate,showBubble=_ref.showBubble,bubbleDateStyle=_ref.bubbleDateStyle,bubbleDateClassName=_ref.bubbleDateClassName,formatDate=(0,useFormatDate.l)();return react.createElement(fuselage.Box,{ref:ref,position:"relative",display:"flex",justifyContent:"center"},react.createElement(fuselage.Box,{className:[bubbleDateClassName,showBubble&&"bubble-visible"],style:bubbleDateStyle},bubbleDate&&react.createElement(fuselage.Bubble,{small:!0,secondary:!0},formatDate(bubbleDate))))}));BubbleDate.__docgenInfo={description:"",methods:[],displayName:"BubbleDate",props:{bubbleDate:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""},bubbleDateClassName:{required:!1,tsType:{name:"ReturnType",elements:[{name:"css"}],raw:"ReturnType<typeof css>"},description:""},showBubble:{required:!0,tsType:{name:"boolean"},description:""},bubbleDateStyle:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:""}}}},"./client/views/room/body/DropTargetOverlay.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var _templateObject,_rocket_chat_css_in_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@rocket.chat/css-in-js/dist/index.module.js"),_rocket_chat_fuselage__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),_rocket_chat_fuselage_hooks__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../packages/ui-contexts/dist/index.js"),react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/react/index.js"),_hooks_useFormatDateAndTime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./client/hooks/useFormatDateAndTime.ts");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncIterator(r){var n,t,o,e=2;for("undefined"!=typeof Symbol&&(t=Symbol.asyncIterator,o=Symbol.iterator);e--;){if(t&&null!=(n=r[t]))return n.call(r);if(o&&null!=(n=r[o]))return new AsyncFromSyncIterator(n.call(r));t="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator(r){function AsyncFromSyncIteratorContinuation(r){if(Object(r)!==r)return Promise.reject(new TypeError(r+" is not an object."));var n=r.done;return Promise.resolve(r.value).then((function(r){return{value:r,done:n}}))}return AsyncFromSyncIterator=function AsyncFromSyncIterator(r){this.s=r,this.n=r.next},AsyncFromSyncIterator.prototype={s:null,n:null,next:function next(){return AsyncFromSyncIteratorContinuation(this.n.apply(this.s,arguments))},return:function _return(r){var n=this.s.return;return void 0===n?Promise.resolve({value:r,done:!0}):AsyncFromSyncIteratorContinuation(n.apply(this.s,arguments))},throw:function _throw(r){var n=this.s.return;return void 0===n?Promise.reject(r):AsyncFromSyncIteratorContinuation(n.apply(this.s,arguments))}},new AsyncFromSyncIterator(r)}function DropTargetOverlay(_ref){var enabled=_ref.enabled,reason=_ref.reason,onFileDrop=_ref.onFileDrop,_ref$visible=_ref.visible,visible=void 0===_ref$visible||_ref$visible,onDismiss=_ref.onDismiss,t=(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_3__.useTranslation)(),handleDragLeave=(0,_rocket_chat_fuselage_hooks__WEBPACK_IMPORTED_MODULE_2__.useMutableCallback)((function(event){event.stopPropagation(),null==onDismiss||onDismiss()})),handleDragOver=(0,_rocket_chat_fuselage_hooks__WEBPACK_IMPORTED_MODULE_2__.useMutableCallback)((function(event){event.stopPropagation(),event.preventDefault(),event.dataTransfer.dropEffect=["move","linkMove"].includes(event.dataTransfer.effectAllowed)?"move":"copy"})),formatDateAndTime=(0,_hooks_useFormatDateAndTime__WEBPACK_IMPORTED_MODULE_5__.J)(),handleDrop=(0,_rocket_chat_fuselage_hooks__WEBPACK_IMPORTED_MODULE_2__.useMutableCallback)(function(){var _ref2=function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(_regeneratorRuntime().mark((function _callee(event){var files,fragment,_iteratorAbruptCompletion,_didIteratorError,_iteratorError,_iterator,_step,src,response,data,extension,filename,file;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(event.stopPropagation(),null==onDismiss||onDismiss(),event.preventDefault(),files=Array.from(event.dataTransfer.files),!event.dataTransfer.types.includes("text/uri-list")||!event.dataTransfer.types.includes("text/html")){_context.next=51;break}fragment=document.createRange().createContextualFragment(event.dataTransfer.getData("text/html")),_iteratorAbruptCompletion=!1,_didIteratorError=!1,_context.prev=8,_iterator=_asyncIterator(Array.from(fragment.querySelectorAll("img")));case 10:return _context.next=12,_iterator.next();case 12:if(!(_iteratorAbruptCompletion=!(_step=_context.sent).done)){_context.next=35;break}return src=_step.value.src,_context.prev=14,_context.next=17,fetch(src);case 17:return response=_context.sent,_context.next=20,response.blob();case 20:return data=_context.sent,_context.next=23,Promise.all([__webpack_require__.e(9345),__webpack_require__.e(6039)]).then(__webpack_require__.bind(__webpack_require__,"./app/utils/lib/mimeTypes.ts"));case 23:extension=_context.sent.mime.extension(data.type),filename="File - ".concat(formatDateAndTime(new Date),".").concat(extension),file=new File([data],filename,{type:data.type}),files.push(file),_context.next=32;break;case 29:_context.prev=29,_context.t0=_context.catch(14),console.warn(_context.t0);case 32:_iteratorAbruptCompletion=!1,_context.next=10;break;case 35:_context.next=41;break;case 37:_context.prev=37,_context.t1=_context.catch(8),_didIteratorError=!0,_iteratorError=_context.t1;case 41:if(_context.prev=41,_context.prev=42,!_iteratorAbruptCompletion||null==_iterator.return){_context.next=46;break}return _context.next=46,_iterator.return();case 46:if(_context.prev=46,!_didIteratorError){_context.next=49;break}throw _iteratorError;case 49:return _context.finish(46);case 50:return _context.finish(41);case 51:null==onFileDrop||onFileDrop(files);case 52:case"end":return _context.stop()}}),_callee,null,[[8,37,41,51],[14,29],[42,,46,50]])})));return function(_x){return _ref2.apply(this,arguments)}}());return visible?react__WEBPACK_IMPORTED_MODULE_4__.createElement(_rocket_chat_fuselage__WEBPACK_IMPORTED_MODULE_1__.Box,{role:"dialog","data-qa":"DropTargetOverlay",position:"absolute",zIndex:1e6,inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontScale:"hero",textAlign:"center",backgroundColor:"rgba(255, 255, 255, 0.8)",borderWidth:4,borderStyle:"dashed",borderColor:"currentColor",color:enabled?"primary":"danger",className:(0,_rocket_chat_css_in_js__WEBPACK_IMPORTED_MODULE_0__.css)(_templateObject||(_templateObject=_taggedTemplateLiteral(["\n\t\t\t\tanimation-name: zoomIn;\n\t\t\t\tanimation-duration: 0.1s;\n\t\t\t"]))),onDragLeave:handleDragLeave,onDragOver:handleDragOver,onDrop:handleDrop},enabled?t("Drop_to_upload_file"):reason):null}__webpack_exports__.A=(0,react__WEBPACK_IMPORTED_MODULE_4__.memo)(DropTargetOverlay),DropTargetOverlay.__docgenInfo={description:"",methods:[],displayName:"DropTargetOverlay",props:{enabled:{required:!0,tsType:{name:"boolean"},description:""},reason:{required:!1,tsType:{name:"ReactNode"},description:""},onFileDrop:{required:!1,tsType:{name:"signature",type:"function",raw:"(files: File[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"File"}],raw:"File[]"},name:"files"}],return:{name:"void"}}},description:""},visible:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},onDismiss:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}}},"./client/views/room/body/LoadingMessagesIndicator.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_components_LoadingIndicator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./client/components/LoadingIndicator.tsx"),LoadingMessagesIndicator=function LoadingMessagesIndicator(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement(_components_LoadingIndicator__WEBPACK_IMPORTED_MODULE_1__.A,null)};__webpack_exports__.A=LoadingMessagesIndicator,LoadingMessagesIndicator.__docgenInfo={description:"",methods:[],displayName:"LoadingMessagesIndicator"}},"./client/views/room/body/hooks/useFileUploadDropTarget.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{l:function(){return useFileUploadDropTarget}});var index_module=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),dist=__webpack_require__("../../packages/ui-contexts/dist/index.js"),react=__webpack_require__("./node_modules/react/index.js"),useIsRoomOverMacLimit=__webpack_require__("./client/hooks/omnichannel/useIsRoomOverMacLimit.tsx"),useReactiveValue=__webpack_require__("./client/hooks/useReactiveValue.ts"),roomCoordinator=__webpack_require__("./client/lib/rooms/roomCoordinator.tsx"),ChatContext=__webpack_require__("./client/views/room/contexts/ChatContext.ts"),RoomContext=__webpack_require__("./client/views/room/contexts/RoomContext.ts");function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}var useFileUploadDropTarget=function useFileUploadDropTarget(){var room=(0,RoomContext.nq)(),_useDropTarget=function useDropTarget(){var _useState2=_slicedToArray((0,react.useState)(!1),2),visible=_useState2[0],setVisible=_useState2[1],onDragEnter=(0,react.useCallback)((function(event){event.stopPropagation(),(function hasFilesToUpload(dataTransfer){return dataTransfer.types.includes("Files")}(event.dataTransfer)||function hasURLToUpload(dataTransfer){return dataTransfer.types.includes("text/uri-list")&&dataTransfer.types.includes("text/html")}(event.dataTransfer))&&setVisible(!0)}),[]),onDismiss=(0,react.useCallback)((function(){setVisible(!1)}),[]);return{triggerProps:(0,react.useMemo)((function(){return{onDragEnter:onDragEnter}}),[onDragEnter]),overlayProps:(0,react.useMemo)((function(){return{visible:visible,onDismiss:onDismiss}}),[visible,onDismiss])}}(),triggerProps=_useDropTarget.triggerProps,overlayProps=_useDropTarget.overlayProps,isRoomOverMacLimit=(0,useIsRoomOverMacLimit.P)(room),t=(0,dist.useTranslation)(),fileUploadEnabled=(0,dist.useSetting)("FileUpload_Enabled"),user=(0,dist.useUser)(),fileUploadAllowedForUser=(0,useReactiveValue.S)((0,react.useCallback)((function(){return!roomCoordinator.roomCoordinator.readOnly(room._id,{username:null==user?void 0:user.username})}),[room._id,null==user?void 0:user.username])),chat=(0,ChatContext.Y)(),subscription=(0,RoomContext.Mq)(),onFileDrop=(0,index_module.useMutableCallback)(function(){var _ref=function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(_regeneratorRuntime().mark((function _callee(files){var _yield$import,getMimeType,getUniqueFiles,uniqueFiles,uploads;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,Promise.all([__webpack_require__.e(9345),__webpack_require__.e(6039)]).then(__webpack_require__.bind(__webpack_require__,"./app/utils/lib/mimeTypes.ts"));case 2:_yield$import=_context.sent,getMimeType=_yield$import.getMimeType,getUniqueFiles=function getUniqueFiles(){var uniqueFiles=[],st=new Set;return files.forEach((function(file){var key=file.size;st.has(key)||(uniqueFiles.push(file),st.add(key))})),uniqueFiles},uniqueFiles=getUniqueFiles(),uploads=Array.from(uniqueFiles).map((function(file){return Object.defineProperty(file,"type",{value:getMimeType(file.type,file.name)}),file})),null==chat||chat.flows.uploadFiles(uploads);case 8:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}());return[triggerProps,(0,react.useMemo)((function(){return _objectSpread(!fileUploadEnabled||isRoomOverMacLimit?{enabled:!1,reason:t("FileUpload_Disabled")}:fileUploadAllowedForUser&&subscription?{enabled:!0,onFileDrop:onFileDrop}:{enabled:!1,reason:t("error-not-allowed")},overlayProps)}),[fileUploadAllowedForUser,fileUploadEnabled,isRoomOverMacLimit,onFileDrop,overlayProps,subscription,t])]}},"./client/views/room/composer/ComposerContainer.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:function(){return composer_ComposerContainer}});var dist=__webpack_require__("../../packages/core-typings/dist/index.js"),ui_contexts_dist=__webpack_require__("../../packages/ui-contexts/dist/index.js"),react=__webpack_require__("./node_modules/react/index.js"),RoomContext=__webpack_require__("./client/views/room/contexts/RoomContext.ts"),fuselage=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),lib=__webpack_require__("../../node_modules/@tanstack/react-query/build/lib/index.js");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var ComposerAnonymous=function ComposerAnonymous(){var t=(0,ui_contexts_dist.useTranslation)(),dispatch=(0,ui_contexts_dist.useToastMessageDispatch)(),isAnonymousWriteEnabled=(0,ui_contexts_dist.useSetting)("Accounts_AllowAnonymousWrite"),loginWithToken=(0,ui_contexts_dist.useLoginWithToken)(),anonymousUser=(0,ui_contexts_dist.useMethod)("registerUser"),setForceLogin=(0,ui_contexts_dist.useSessionDispatch)("forceLogin"),registerAnonymous=(0,lib.useMutation)(_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var result,_args=arguments;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,anonymousUser.apply(void 0,_args);case 2:if("string"==typeof(result=_context.sent)||!result.token){_context.next=6;break}return _context.next=6,loginWithToken(result.token);case 6:return _context.abrupt("return",result);case 7:case"end":return _context.stop()}}),_callee)}))),{onError:function onError(error){dispatch({type:"error",message:error})}});return react.createElement(fuselage.Box,{mb:16},react.createElement(fuselage.ButtonGroup,null,react.createElement(fuselage.Button,{small:!0,primary:!0,onClick:function onClick(){return setForceLogin(!0)}},t("Sign_in_to_start_talking")),isAnonymousWriteEnabled&&react.createElement(fuselage.Button,{small:!0,secondary:!0,onClick:function onClick(){return function joinAnonymous(){registerAnonymous.mutate({email:null})}()}},t("Or_talk_as_anonymous"))))},composer_ComposerAnonymous=ComposerAnonymous;ComposerAnonymous.__docgenInfo={description:"",methods:[],displayName:"ComposerAnonymous"};var ui_composer_dist=__webpack_require__("../../packages/ui-composer/dist/index.js"),ComposerReadOnly=function ComposerReadOnly(){var t=(0,ui_contexts_dist.useTranslation)();return react.createElement(ui_composer_dist.r7,null,react.createElement(ui_composer_dist.yF,null,t("Room_archived")))},ComposerArchived=ComposerReadOnly;ComposerReadOnly.__docgenInfo={description:"",methods:[],displayName:"ComposerReadOnly"};var ComposerBlocked=function ComposerBlocked(){var t=(0,ui_contexts_dist.useTranslation)();return react.createElement(ui_composer_dist.r7,null,t("room_is_blocked"))},composer_ComposerBlocked=ComposerBlocked;ComposerBlocked.__docgenInfo={description:"",methods:[],displayName:"ComposerBlocked"};var useHasLicenseModule=__webpack_require__("./client/hooks/useHasLicenseModule.ts"),client=__webpack_require__("./app/ui-utils/client/index.ts"),useReactiveValue=__webpack_require__("./client/hooks/useReactiveValue.ts"),ChatContext=__webpack_require__("./client/views/room/contexts/ChatContext.ts"),ComposerSkeleton=__webpack_require__("./client/views/room/composer/ComposerSkeleton.tsx"),index_module=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),use_subscription=__webpack_require__("./node_modules/use-subscription/index.js"),dist_index_module=__webpack_require__("./node_modules/@rocket.chat/emitter/dist/index.module.js"),meteor=__webpack_require__("./.storybook/mocks/meteor.js"),highOrderFunctions=__webpack_require__("./lib/utils/highOrderFunctions.ts"),imperativeModal=__webpack_require__("./client/lib/imperativeModal.tsx"),settings_client=__webpack_require__("./app/settings/client/index.ts"),index_esm=__webpack_require__("./node_modules/react-hook-form/dist/index.esm.mjs"),GenericModal=__webpack_require__("./client/components/GenericModal/index.ts");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}var AddLinkComposerActionModal=function AddLinkComposerActionModal(_ref){var selectedText=_ref.selectedText,onClose=_ref.onClose,onConfirm=_ref.onConfirm,t=(0,ui_contexts_dist.useTranslation)(),textField=(0,index_module.useUniqueId)(),urlField=(0,index_module.useUniqueId)(),_useForm=(0,index_esm.mN)({mode:"onBlur",defaultValues:{text:selectedText||"",url:""}}),handleSubmit=_useForm.handleSubmit,setFocus=_useForm.setFocus,control=_useForm.control;(0,react.useEffect)((function(){setFocus(selectedText?"url":"text")}),[selectedText,setFocus]);var submit=handleSubmit((function onClickConfirm(_ref2){var url=_ref2.url,text=_ref2.text;onConfirm(url,text)}));return react.createElement(GenericModal.A,{variant:"warning",icon:null,confirmText:t("Add"),onCancel:onClose,wrapperFunction:function wrapperFunction(props){return react.createElement(fuselage.Box,_extends({is:"form",onSubmit:function onSubmit(e){submit(e)}},props))},title:t("Add_link")},react.createElement(fuselage.FieldGroup,null,react.createElement(fuselage.Field,null,react.createElement(fuselage.FieldLabel,{htmlFor:textField},t("Text")),react.createElement(fuselage.FieldRow,null,react.createElement(index_esm.xI,{control:control,name:"text",render:function render(_ref3){var field=_ref3.field;return react.createElement(fuselage.TextInput,_extends({autoComplete:"off",id:textField},field))}}))),react.createElement(fuselage.Field,null,react.createElement(fuselage.FieldLabel,{htmlFor:urlField},t("URL")),react.createElement(fuselage.FieldRow,null,react.createElement(index_esm.xI,{control:control,name:"url",render:function render(_ref4){var field=_ref4.field;return react.createElement(fuselage.TextInput,_extends({autoComplete:"off",id:urlField},field))}})))))},messageBox_AddLinkComposerActionModal=AddLinkComposerActionModal;AddLinkComposerActionModal.__docgenInfo={description:"",methods:[],displayName:"AddLinkComposerActionModal",props:{selectedText:{required:!1,tsType:{name:"string"},description:""},onConfirm:{required:!0,tsType:{name:"signature",type:"function",raw:"(url: string, text: string) => void",signature:{arguments:[{type:{name:"string"},name:"url"},{type:{name:"string"},name:"text"}],return:{name:"void"}}},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};var isPromptButton=function isPromptButton(button){return"prompt"in button},formattingButtons=[{label:"Bold",icon:"bold",pattern:"*{{text}}*",command:"b"},{label:"Italic",icon:"italic",pattern:"_{{text}}_",command:"i"},{label:"Strike",icon:"strike",pattern:"~{{text}}~"},{label:"Inline_code",icon:"code",pattern:"`{{text}}`"},{label:"Multi_line",icon:"multiline",pattern:"```\n{{text}}\n``` "},{label:"Link",icon:"link",prompt:function prompt(composerApi){var selection=composerApi.selection,selectedText=composerApi.substring(selection.start,selection.end),onClose=function onClose(){imperativeModal.K.close(),composerApi.focus()};imperativeModal.K.open({component:messageBox_AddLinkComposerActionModal,props:{onConfirm:function onConfirm(url,text){onClose(),composerApi.replaceText("[".concat(text,"](").concat(url,")"),selection),composerApi.setCursorToEnd()},selectedText:selectedText,onClose:onClose}})}},{label:"KaTeX",icon:"katex",text:function text(){if(settings_client.W.get("Katex_Enabled"))return settings_client.W.get("Katex_Dollar_Syntax")?"$$KaTeX$$":settings_client.W.get("Katex_Parenthesis_Syntax")?"\\[KaTeX\\]":void 0},link:"https://khan.github.io/KaTeX/function-support.html",condition:function condition(){return settings_client.W.get("Katex_Enabled")}}];function createComposerAPI_typeof(o){return createComposerAPI_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},createComposerAPI_typeof(o)}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||_unsupportedIterableToArray(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function createComposerAPI_regeneratorRuntime(){createComposerAPI_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==createComposerAPI_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(createComposerAPI_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function createComposerAPI_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function createComposerAPI_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){createComposerAPI_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){createComposerAPI_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var extensionsMap={"image/apng":"apng","image/avif":"avif","image/gif":"gif","image/jpeg":"jpg","image/png":"png","image/svg+xml":"svg","image/webp":"webp","image/bmp":"bmp","image/x-icon":"ico","image/tiff":"tif"},useFormatDateAndTime=__webpack_require__("./client/hooks/useFormatDateAndTime.ts"),roomCoordinator=__webpack_require__("./client/lib/rooms/roomCoordinator.tsx"),keyCodes_CARRIAGE_RETURN=10,keyCodes_NEW_LINE=13;function AudioEncoder_typeof(o){return AudioEncoder_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},AudioEncoder_typeof(o)}function AudioEncoder_toConsumableArray(r){return function AudioEncoder_arrayWithoutHoles(r){if(Array.isArray(r))return AudioEncoder_arrayLikeToArray(r)}(r)||function AudioEncoder_iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||function AudioEncoder_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return AudioEncoder_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?AudioEncoder_arrayLikeToArray(r,a):void 0}}(r)||function AudioEncoder_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function AudioEncoder_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _createSuper(t){var r=_isNativeReflectConstruct();return function(){var e,o=_getPrototypeOf(t);if(r){var s=_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function _possibleConstructorReturn(t,e){if(e&&("object"==AudioEncoder_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}(this,e)}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=AudioEncoder_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=AudioEncoder_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==AudioEncoder_typeof(i)?i:i+""}var AudioEncoder=function(_Emitter){!function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}(AudioEncoder,_Emitter);var _super=_createSuper(AudioEncoder);function AudioEncoder(source){var _this,_ref=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_ref$bufferLen=_ref.bufferLen,bufferLen=void 0===_ref$bufferLen?4096:_ref$bufferLen,_ref$numChannels=_ref.numChannels,numChannels=void 0===_ref$numChannels?1:_ref$numChannels,_ref$bitRate=_ref.bitRate,bitRate=void 0===_ref$bitRate?32:_ref$bitRate;!function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,AudioEncoder),_defineProperty(_assertThisInitialized(_this=_super.call(this)),"worker",void 0),_defineProperty(_assertThisInitialized(_this),"scriptNode",void 0),_defineProperty(_assertThisInitialized(_this),"handleWorkerMessage",(function(event){if("end"===event.data.command){var bufferWithMagicNo=[new Int8Array([73,68,51,3,0,0,0,0,0,0])].concat(AudioEncoder_toConsumableArray(event.data.buffer)),blob=new Blob(bufferWithMagicNo,{type:"audio/mpeg"});_this.emit("encoded",blob),_this.worker.terminate()}})),_defineProperty(_assertThisInitialized(_this),"handleAudioProcess",(function(event){for(var channel=0;channel<event.inputBuffer.numberOfChannels;channel++){var buffer=event.inputBuffer.getChannelData(channel);_this.worker.postMessage({command:"encode",buffer:buffer})}}));var workerPath=meteor.fj.absoluteUrl("workers/mp3-encoder/index.js");return _this.worker=new Worker(workerPath),_this.worker.onmessage=_this.handleWorkerMessage,_this.worker.postMessage({command:"init",config:{sampleRate:source.context.sampleRate,numChannels:numChannels,bitRate:bitRate}}),_this.scriptNode=source.context.createScriptProcessor(bufferLen,numChannels,numChannels),_this.scriptNode.onaudioprocess=_this.handleAudioProcess,source.connect(_this.scriptNode),_this.scriptNode.connect(source.context.destination),_this}return function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(AudioEncoder,[{key:"close",value:function close(){this.worker.postMessage({command:"finish"})}}]),AudioEncoder}(dist_index_module.v);function AudioRecorder_typeof(o){return AudioRecorder_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},AudioRecorder_typeof(o)}function AudioRecorder_regeneratorRuntime(){AudioRecorder_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==AudioRecorder_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(AudioRecorder_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function AudioRecorder_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function AudioRecorder_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){AudioRecorder_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){AudioRecorder_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}function AudioRecorder_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,AudioRecorder_toPropertyKey(o.key),o)}}function AudioRecorder_defineProperty(e,r,t){return(r=AudioRecorder_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function AudioRecorder_toPropertyKey(t){var i=function AudioRecorder_toPrimitive(t,r){if("object"!=AudioRecorder_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=AudioRecorder_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==AudioRecorder_typeof(i)?i:i+""}var AudioRecorder=function(){function AudioRecorder(){!function AudioRecorder_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,AudioRecorder),AudioRecorder_defineProperty(this,"audioContext",void 0),AudioRecorder_defineProperty(this,"stream",void 0),AudioRecorder_defineProperty(this,"encoder",void 0)}var _start,_createEncoder,_createStream;return function AudioRecorder_createClass(e,r,t){return r&&AudioRecorder_defineProperties(e.prototype,r),t&&AudioRecorder_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(AudioRecorder,[{key:"isSupported",value:function isSupported(){var _navigator$mediaDevic;return Boolean(null===(_navigator$mediaDevic=navigator.mediaDevices)||void 0===_navigator$mediaDevic?void 0:_navigator$mediaDevic.getUserMedia)&&Boolean(AudioContext)}},{key:"createAudioContext",value:function createAudioContext(){this.audioContext||(this.audioContext=new AudioContext)}},{key:"destroyAudioContext",value:function destroyAudioContext(){this.audioContext&&(this.audioContext.close(),delete this.audioContext)}},{key:"createStream",value:(_createStream=AudioRecorder_asyncToGenerator(AudioRecorder_regeneratorRuntime().mark((function _callee(){return AudioRecorder_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!this.stream){_context.next=2;break}return _context.abrupt("return");case 2:return _context.next=4,navigator.mediaDevices.getUserMedia({audio:!0});case 4:this.stream=_context.sent;case 5:case"end":return _context.stop()}}),_callee,this)}))),function createStream(){return _createStream.apply(this,arguments)})},{key:"destroyStream",value:function destroyStream(){this.stream&&(this.stream.getAudioTracks().forEach((function(track){return track.stop()})),delete this.stream)}},{key:"createEncoder",value:(_createEncoder=AudioRecorder_asyncToGenerator(AudioRecorder_regeneratorRuntime().mark((function _callee2(){var _this$audioContext,input;return AudioRecorder_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!this.encoder&&this.audioContext&&this.stream){_context2.next=2;break}return _context2.abrupt("return");case 2:input=null===(_this$audioContext=this.audioContext)||void 0===_this$audioContext?void 0:_this$audioContext.createMediaStreamSource(this.stream),this.encoder=new AudioEncoder(input,{bitRate:settings_client.W.get("Message_Audio_bitRate")||32});case 4:case"end":return _context2.stop()}}),_callee2,this)}))),function createEncoder(){return _createEncoder.apply(this,arguments)})},{key:"destroyEncoder",value:function destroyEncoder(){this.encoder&&(this.encoder.close(),delete this.encoder)}},{key:"start",value:(_start=AudioRecorder_asyncToGenerator(AudioRecorder_regeneratorRuntime().mark((function _callee3(cb){return AudioRecorder_regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,this.createAudioContext(),_context3.next=4,this.createStream();case 4:return _context3.next=6,this.createEncoder();case 6:null==cb||cb.call(this,!0),_context3.next=17;break;case 9:throw _context3.prev=9,_context3.t0=_context3.catch(0),console.error(_context3.t0),this.destroyEncoder(),this.destroyStream(),this.destroyAudioContext(),null==cb||cb.call(this,!1),_context3.t0;case 17:case"end":return _context3.stop()}}),_callee3,this,[[0,9]])}))),function start(_x){return _start.apply(this,arguments)})},{key:"stop",value:function stop(cb){var _this$encoder,_this$encoder2;null===(_this$encoder=this.encoder)||void 0===_this$encoder||_this$encoder.on("encoded",cb),null===(_this$encoder2=this.encoder)||void 0===_this$encoder2||_this$encoder2.close(),this.destroyEncoder(),this.destroyStream(),this.destroyAudioContext()}}]),AudioRecorder}();function AudioMessageRecorder_typeof(o){return AudioMessageRecorder_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},AudioMessageRecorder_typeof(o)}function AudioMessageRecorder_regeneratorRuntime(){AudioMessageRecorder_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==AudioMessageRecorder_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(AudioMessageRecorder_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function AudioMessageRecorder_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function AudioMessageRecorder_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){AudioMessageRecorder_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){AudioMessageRecorder_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}function AudioMessageRecorder_slicedToArray(r,e){return function AudioMessageRecorder_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function AudioMessageRecorder_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function AudioMessageRecorder_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return AudioMessageRecorder_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?AudioMessageRecorder_arrayLikeToArray(r,a):void 0}}(r,e)||function AudioMessageRecorder_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function AudioMessageRecorder_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var audioRecorder=new AudioRecorder,AudioMessageRecorder=function AudioMessageRecorder(_ref){var _useChat,rid=_ref.rid,chatContext=_ref.chatContext,isMicrophoneDenied=_ref.isMicrophoneDenied,t=(0,ui_contexts_dist.useTranslation)(),_useState2=AudioMessageRecorder_slicedToArray((0,react.useState)("recording"),2),state=_useState2[0],setState=_useState2[1],_useState4=AudioMessageRecorder_slicedToArray((0,react.useState)("00:00"),2),time=_useState4[0],setTime=_useState4[1],_useState6=AudioMessageRecorder_slicedToArray((0,react.useState)(null),2),recordingInterval=_useState6[0],setRecordingInterval=_useState6[1],_useState8=AudioMessageRecorder_slicedToArray((0,react.useState)(null),2),recordingRoomId=_useState8[0],setRecordingRoomId=_useState8[1],stopRecording=(0,index_module.useMutableCallback)(AudioMessageRecorder_asyncToGenerator(AudioMessageRecorder_regeneratorRuntime().mark((function _callee(){var _chat$composer,blob;return AudioMessageRecorder_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return recordingInterval&&clearInterval(recordingInterval),setRecordingInterval(null),setRecordingRoomId(null),setTime("00:00"),null==chat||chat.action.stop("recording"),null==chat||null===(_chat$composer=chat.composer)||void 0===_chat$composer||_chat$composer.setRecordingMode(!1),_context.next=8,new Promise((function(resolve){return audioRecorder.stop(resolve)}));case 8:return blob=_context.sent,_context.abrupt("return",blob);case 10:case"end":return _context.stop()}}),_callee)})))),handleUnmount=(0,index_module.useMutableCallback)(AudioMessageRecorder_asyncToGenerator(AudioMessageRecorder_regeneratorRuntime().mark((function _callee2(){return AudioMessageRecorder_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if("recording"!==state){_context2.next=3;break}return _context2.next=3,stopRecording();case 3:case"end":return _context2.stop()}}),_callee2)})))),handleRecord=(0,index_module.useMutableCallback)(AudioMessageRecorder_asyncToGenerator(AudioMessageRecorder_regeneratorRuntime().mark((function _callee3(){var startTime,_chat$composer2;return AudioMessageRecorder_regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!recordingRoomId||recordingRoomId===rid){_context3.next=2;break}return _context3.abrupt("return");case 2:return _context3.prev=2,_context3.next=5,audioRecorder.start();case 5:null==chat||chat.action.performContinuously("recording"),startTime=new Date,setRecordingInterval(setInterval((function(){var distance=((new Date).getTime()-startTime.getTime())/1e3,minutes=Math.floor(distance/60),seconds=Math.floor(distance%60);setTime("".concat(String(minutes).padStart(2,"0"),":").concat(String(seconds).padStart(2,"0")))}),1e3)),setRecordingRoomId(rid),_context3.next=15;break;case 11:_context3.prev=11,_context3.t0=_context3.catch(2),console.log(_context3.t0),null==chat||null===(_chat$composer2=chat.composer)||void 0===_chat$composer2||_chat$composer2.setRecordingMode(!1);case 15:case"end":return _context3.stop()}}),_callee3,null,[[2,11]])})))),handleCancelButtonClick=(0,index_module.useMutableCallback)(AudioMessageRecorder_asyncToGenerator(AudioMessageRecorder_regeneratorRuntime().mark((function _callee4(){return AudioMessageRecorder_regeneratorRuntime().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,stopRecording();case 2:case"end":return _context4.stop()}}),_callee4)})))),chat=null!==(_useChat=(0,ChatContext.Y)())&&void 0!==_useChat?_useChat:chatContext,handleDoneButtonClick=(0,index_module.useMutableCallback)(AudioMessageRecorder_asyncToGenerator(AudioMessageRecorder_regeneratorRuntime().mark((function _callee5(){var blob,fileName,file;return AudioMessageRecorder_regeneratorRuntime().wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return setState("loading"),_context5.next=3,stopRecording();case 3:return blob=_context5.sent,fileName="".concat(t("Audio_record"),".mp3"),file=new File([blob],fileName,{type:"audio/mpeg"}),_context5.next=8,null==chat?void 0:chat.flows.uploadFiles([file]);case 8:case"end":return _context5.stop()}}),_callee5)}))));(0,react.useEffect)((function(){return handleRecord(),function(){handleUnmount()}}),[handleUnmount,handleRecord]);var stateClass=(0,react.useMemo)((function(){return recordingRoomId&&recordingRoomId!==rid?"rc-message-box__audio-message--busy":state&&"rc-message-box__audio-message--".concat(state)}),[recordingRoomId,rid,state]);return isMicrophoneDenied?null:react.createElement(fuselage.Box,{position:"absolute",pi:4,pb:12,className:"rc-message-box__audio-message ".concat(stateClass)},"recording"===state&&react.createElement(react.Fragment,null,react.createElement(ui_composer_dist.i_,{icon:"circle-cross",className:"rc-message-box__icon rc-message-box__audio-message-cancel",onClick:handleCancelButtonClick}),react.createElement(fuselage.Box,{className:"rc-message-box__audio-message-timer",color:"default"},react.createElement("span",{className:"rc-message-box__audio-message-timer-dot"}),react.createElement("span",{className:"rc-message-box__audio-message-timer-text"},time)),react.createElement(ui_composer_dist.i_,{icon:"circle-check",className:"rc-message-box__icon rc-message-box__audio-message-done",onClick:handleDoneButtonClick})),"loading"===state&&react.createElement("div",{className:"rc-message-box__icon"},react.createElement(fuselage.Throbber,{inheritColor:!0,size:"x12"})))},AudioMessageRecorder_AudioMessageRecorder=AudioMessageRecorder;AudioMessageRecorder.__docgenInfo={description:"",methods:[],displayName:"AudioMessageRecorder",props:{rid:{required:!0,tsType:{name:"IRoom['_id']",raw:"IRoom['_id']"},description:""},chatContext:{required:!1,tsType:{name:"signature",type:"object",raw:"{\n\treadonly uid: string | null;\n\treadonly composer?: ComposerAPI;\n\treadonly setComposerAPI: (composer: ComposerAPI) => void;\n\treadonly data: DataAPI;\n\treadonly uploads: UploadsAPI;\n\treadonly readStateManager: ReadStateManager;\n\treadonly messageEditing: {\n\t\ttoPreviousMessage(): Promise<void>;\n\t\ttoNextMessage(): Promise<void>;\n\t\teditMessage(message: IMessage, options?: { cursorAtStart?: boolean }): Promise<void>;\n\t};\n\n\treadonly currentEditing:\n\t\t| {\n\t\t\t\treadonly mid: IMessage['_id'];\n\t\t\t\treset(): Promise<boolean>;\n\t\t\t\tstop(): Promise<void>;\n\t\t\t\tcancel(): Promise<void>;\n\t\t  }\n\t\t| undefined;\n\n\treadonly emojiPicker: {\n\t\topen(el: Element, cb: (emoji: string) => void): void;\n\t\tclose(): void;\n\t};\n\n\treadonly action: {\n\t\tstart(action: 'typing'): void;\n\t\tstop(action: 'typing' | 'recording' | 'uploading' | 'playing'): void;\n\t\tperformContinuously(action: 'recording' | 'uploading' | 'playing'): void;\n\t};\n\n\tActionManager: IActionManager;\n\n\treadonly flows: {\n\t\treadonly uploadFiles: (files: readonly File[], resetFileInput?: () => void) => Promise<void>;\n\t\treadonly sendMessage: ({\n\t\t\ttext,\n\t\t\ttshow,\n\t\t}: {\n\t\t\ttext: string;\n\t\t\ttshow?: boolean;\n\t\t\tpreviewUrls?: string[];\n\t\t\tisSlashCommandAllowed?: boolean;\n\t\t}) => Promise<boolean>;\n\t\treadonly processSlashCommand: (message: IMessage, userId: string | null) => Promise<boolean>;\n\t\treadonly processTooLongMessage: (message: IMessage) => Promise<boolean>;\n\t\treadonly processMessageEditing: (\n\t\t\tmessage: Pick<IMessage, '_id' | 't'> & Partial<Omit<IMessage, '_id' | 't'>>,\n\t\t\tpreviewUrls?: string[],\n\t\t) => Promise<boolean>;\n\t\treadonly processSetReaction: (message: Pick<IMessage, 'msg'>) => Promise<boolean>;\n\t\treadonly requestMessageDeletion: (message: IMessage) => Promise<void>;\n\t\treadonly replyBroadcast: (message: IMessage) => Promise<void>;\n\t};\n}",signature:{properties:[{key:"uid",value:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}],required:!0}},{key:"composer",value:{name:"signature",type:"object",raw:"{\n\trelease(): void;\n\treadonly text: string;\n\treadonly selection: { readonly start: number; readonly end: number };\n\tsetText(\n\t\ttext: string,\n\t\toptions?: {\n\t\t\tselection?:\n\t\t\t\t| { readonly start?: number; readonly end?: number }\n\t\t\t\t| ((previous: { readonly start: number; readonly end: number }) => { readonly start?: number; readonly end?: number });\n\t\t},\n\t): void;\n\twrapSelection(pattern: string): void;\n\tinsertText(text: string): void;\n\tinsertNewLine(): void;\n\tclear(): void;\n\tfocus(): void;\n\tblur(): void;\n\n\tgetCursorPosition(): number | undefined;\n\n\tsubstring(start: number, end?: number): string;\n\n\treplaceText(\n\t\ttext: string,\n\t\tselection: {\n\t\t\tstart: number;\n\t\t\tend: number;\n\t\t},\n\t): void;\n\n\tsetCursorToEnd(): void;\n\tsetCursorToStart(): void;\n\treplyWith(text: string): Promise<void>;\n\tquoteMessage(message: IMessage): Promise<void>;\n\tdismissQuotedMessage(mid: IMessage['_id']): Promise<void>;\n\tdismissAllQuotedMessages(): Promise<void>;\n\treadonly quotedMessages: Subscribable<IMessage[]>;\n\n\tsetEditingMode(editing: boolean): void;\n\treadonly editing: Subscribable<boolean>;\n\n\tsetRecordingMode(recording: boolean): void;\n\treadonly recording: Subscribable<boolean>;\n\n\tsetRecordingVideo(recording: boolean): void;\n\treadonly recordingVideo: Subscribable<boolean>;\n\n\tsetIsMicrophoneDenied(isMicrophoneDenied: boolean): void;\n\treadonly isMicrophoneDenied: Subscribable<boolean>;\n\n\treadonly formatters: Subscribable<FormattingButton[]>;\n}",signature:{properties:[{key:"release",value:{name:"void",required:!0}},{key:"text",value:{name:"string",required:!0}},{key:"selection",value:{name:"signature",type:"object",raw:"{ readonly start: number; readonly end: number }",signature:{properties:[{key:"start",value:{name:"number",required:!0}},{key:"end",value:{name:"number",required:!0}}]},required:!0}},{key:"setText",value:{name:"void",required:!0}},{key:"wrapSelection",value:{name:"void",required:!0}},{key:"insertText",value:{name:"void",required:!0}},{key:"insertNewLine",value:{name:"void",required:!0}},{key:"clear",value:{name:"void",required:!0}},{key:"focus",value:{name:"void",required:!0}},{key:"blur",value:{name:"void",required:!0}},{key:"getCursorPosition",value:{name:"union",raw:"number | undefined",elements:[{name:"number"},{name:"undefined"}],required:!0}},{key:"substring",value:{name:"string",required:!0}},{key:"replaceText",value:{name:"void",required:!0}},{key:"setCursorToEnd",value:{name:"void",required:!0}},{key:"setCursorToStart",value:{name:"void",required:!0}},{key:"replyWith",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quoteMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissQuotedMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissAllQuotedMessages",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quotedMessages",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setEditingMode",value:{name:"void",required:!0}},{key:"editing",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingMode",value:{name:"void",required:!0}},{key:"recording",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingVideo",value:{name:"void",required:!0}},{key:"recordingVideo",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setIsMicrophoneDenied",value:{name:"void",required:!0}},{key:"isMicrophoneDenied",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"formatters",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}}]},required:!1}},{key:"setComposerAPI",value:{name:"signature",type:"function",raw:"(composer: ComposerAPI) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{\n\trelease(): void;\n\treadonly text: string;\n\treadonly selection: { readonly start: number; readonly end: number };\n\tsetText(\n\t\ttext: string,\n\t\toptions?: {\n\t\t\tselection?:\n\t\t\t\t| { readonly start?: number; readonly end?: number }\n\t\t\t\t| ((previous: { readonly start: number; readonly end: number }) => { readonly start?: number; readonly end?: number });\n\t\t},\n\t): void;\n\twrapSelection(pattern: string): void;\n\tinsertText(text: string): void;\n\tinsertNewLine(): void;\n\tclear(): void;\n\tfocus(): void;\n\tblur(): void;\n\n\tgetCursorPosition(): number | undefined;\n\n\tsubstring(start: number, end?: number): string;\n\n\treplaceText(\n\t\ttext: string,\n\t\tselection: {\n\t\t\tstart: number;\n\t\t\tend: number;\n\t\t},\n\t): void;\n\n\tsetCursorToEnd(): void;\n\tsetCursorToStart(): void;\n\treplyWith(text: string): Promise<void>;\n\tquoteMessage(message: IMessage): Promise<void>;\n\tdismissQuotedMessage(mid: IMessage['_id']): Promise<void>;\n\tdismissAllQuotedMessages(): Promise<void>;\n\treadonly quotedMessages: Subscribable<IMessage[]>;\n\n\tsetEditingMode(editing: boolean): void;\n\treadonly editing: Subscribable<boolean>;\n\n\tsetRecordingMode(recording: boolean): void;\n\treadonly recording: Subscribable<boolean>;\n\n\tsetRecordingVideo(recording: boolean): void;\n\treadonly recordingVideo: Subscribable<boolean>;\n\n\tsetIsMicrophoneDenied(isMicrophoneDenied: boolean): void;\n\treadonly isMicrophoneDenied: Subscribable<boolean>;\n\n\treadonly formatters: Subscribable<FormattingButton[]>;\n}",signature:{properties:[{key:"release",value:{name:"void",required:!0}},{key:"text",value:{name:"string",required:!0}},{key:"selection",value:{name:"signature",type:"object",raw:"{ readonly start: number; readonly end: number }",signature:{properties:[{key:"start",value:{name:"number",required:!0}},{key:"end",value:{name:"number",required:!0}}]},required:!0}},{key:"setText",value:{name:"void",required:!0}},{key:"wrapSelection",value:{name:"void",required:!0}},{key:"insertText",value:{name:"void",required:!0}},{key:"insertNewLine",value:{name:"void",required:!0}},{key:"clear",value:{name:"void",required:!0}},{key:"focus",value:{name:"void",required:!0}},{key:"blur",value:{name:"void",required:!0}},{key:"getCursorPosition",value:{name:"union",raw:"number | undefined",elements:[{name:"number"},{name:"undefined"}],required:!0}},{key:"substring",value:{name:"string",required:!0}},{key:"replaceText",value:{name:"void",required:!0}},{key:"setCursorToEnd",value:{name:"void",required:!0}},{key:"setCursorToStart",value:{name:"void",required:!0}},{key:"replyWith",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quoteMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissQuotedMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissAllQuotedMessages",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quotedMessages",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setEditingMode",value:{name:"void",required:!0}},{key:"editing",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingMode",value:{name:"void",required:!0}},{key:"recording",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingVideo",value:{name:"void",required:!0}},{key:"recordingVideo",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setIsMicrophoneDenied",value:{name:"void",required:!0}},{key:"isMicrophoneDenied",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"formatters",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}}]},required:!1},name:"composer"}],return:{name:"void"}},required:!0}},{key:"data",value:{name:"signature",type:"object",raw:"{\n\tcomposeMessage(\n\t\ttext: string,\n\t\toptions: { sendToChannel?: boolean; quotedMessages: IMessage[]; originalMessage?: IMessage | null },\n\t): Promise<IMessage>;\n\tfindMessageByID(mid: IMessage['_id']): Promise<IMessage | null>;\n\tgetMessageByID(mid: IMessage['_id']): Promise<IMessage>;\n\tfindLastMessage(): Promise<IMessage | undefined>;\n\tgetLastMessage(): Promise<IMessage>;\n\tfindLastOwnMessage(): Promise<IMessage | undefined>;\n\tgetLastOwnMessage(): Promise<IMessage>;\n\tfindPreviousOwnMessage(message: IMessage): Promise<IMessage | undefined>;\n\tgetPreviousOwnMessage(message: IMessage): Promise<IMessage>;\n\tfindNextOwnMessage(message: IMessage): Promise<IMessage | undefined>;\n\tgetNextOwnMessage(message: IMessage): Promise<IMessage>;\n\tpushEphemeralMessage(message: Omit<IMessage, 'rid' | 'tmid'>): Promise<void>;\n\tcanUpdateMessage(message: IMessage): Promise<boolean>;\n\tupdateMessage(message: Pick<IMessage, '_id' | 't'> & Partial<Omit<IMessage, '_id' | 't'>>, previewUrls?: string[]): Promise<void>;\n\tcanDeleteMessage(message: IMessage): Promise<boolean>;\n\tdeleteMessage(msgIdOrMsg: IMessage | IMessage['_id']): Promise<void>;\n\tgetDraft(mid: IMessage['_id'] | undefined): Promise<string | undefined>;\n\tdiscardDraft(mid: IMessage['_id'] | undefined): Promise<void>;\n\tsaveDraft(mid: IMessage['_id'] | undefined, text: string): Promise<void>;\n\tfindRoom(): Promise<IRoom | undefined>;\n\tgetRoom(): Promise<IRoom>;\n\tisSubscribedToRoom(): Promise<boolean>;\n\tjoinRoom(): Promise<void>;\n\tfindDiscussionByID(drid: IRoom['_id']): Promise<IRoom | undefined>;\n\tgetDiscussionByID(drid: IRoom['_id']): Promise<IRoom>;\n\tfindSubscription(): Promise<ISubscription | undefined>;\n\tgetSubscription(): Promise<ISubscription>;\n\tfindSubscriptionFromMessage(message: IMessage): Promise<ISubscription | undefined>;\n\tgetSubscriptionFromMessage(message: IMessage): Promise<ISubscription>;\n}",signature:{properties:[{key:"composeMessage",value:{name:"Promise",elements:[{name:"IMessage"}],raw:"Promise<IMessage>",required:!0}},{key:"findMessageByID",value:{name:"Promise",elements:[{name:"union",raw:"IMessage | null",elements:[{name:"IMessage"},{name:"null"}]}],raw:"Promise<IMessage | null>",required:!0}},{key:"getMessageByID",value:{name:"Promise",elements:[{name:"IMessage"}],raw:"Promise<IMessage>",required:!0}},{key:"findLastMessage",value:{name:"Promise",elements:[{name:"union",raw:"IMessage | undefined",elements:[{name:"IMessage"},{name:"undefined"}]}],raw:"Promise<IMessage | undefined>",required:!0}},{key:"getLastMessage",value:{name:"Promise",elements:[{name:"IMessage"}],raw:"Promise<IMessage>",required:!0}},{key:"findLastOwnMessage",value:{name:"Promise",elements:[{name:"union",raw:"IMessage | undefined",elements:[{name:"IMessage"},{name:"undefined"}]}],raw:"Promise<IMessage | undefined>",required:!0}},{key:"getLastOwnMessage",value:{name:"Promise",elements:[{name:"IMessage"}],raw:"Promise<IMessage>",required:!0}},{key:"findPreviousOwnMessage",value:{name:"Promise",elements:[{name:"union",raw:"IMessage | undefined",elements:[{name:"IMessage"},{name:"undefined"}]}],raw:"Promise<IMessage | undefined>",required:!0}},{key:"getPreviousOwnMessage",value:{name:"Promise",elements:[{name:"IMessage"}],raw:"Promise<IMessage>",required:!0}},{key:"findNextOwnMessage",value:{name:"Promise",elements:[{name:"union",raw:"IMessage | undefined",elements:[{name:"IMessage"},{name:"undefined"}]}],raw:"Promise<IMessage | undefined>",required:!0}},{key:"getNextOwnMessage",value:{name:"Promise",elements:[{name:"IMessage"}],raw:"Promise<IMessage>",required:!0}},{key:"pushEphemeralMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"canUpdateMessage",value:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>",required:!0}},{key:"updateMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"canDeleteMessage",value:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>",required:!0}},{key:"deleteMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"getDraft",value:{name:"Promise",elements:[{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]}],raw:"Promise<string | undefined>",required:!0}},{key:"discardDraft",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"saveDraft",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"findRoom",value:{name:"Promise",elements:[{name:"union",raw:"IRoom | undefined",elements:[{name:"IRoom"},{name:"undefined"}]}],raw:"Promise<IRoom | undefined>",required:!0}},{key:"getRoom",value:{name:"Promise",elements:[{name:"IRoom"}],raw:"Promise<IRoom>",required:!0}},{key:"isSubscribedToRoom",value:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>",required:!0}},{key:"joinRoom",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"findDiscussionByID",value:{name:"Promise",elements:[{name:"union",raw:"IRoom | undefined",elements:[{name:"IRoom"},{name:"undefined"}]}],raw:"Promise<IRoom | undefined>",required:!0}},{key:"getDiscussionByID",value:{name:"Promise",elements:[{name:"IRoom"}],raw:"Promise<IRoom>",required:!0}},{key:"findSubscription",value:{name:"Promise",elements:[{name:"union",raw:"ISubscription | undefined",elements:[{name:"ISubscription"},{name:"undefined"}]}],raw:"Promise<ISubscription | undefined>",required:!0}},{key:"getSubscription",value:{name:"Promise",elements:[{name:"ISubscription"}],raw:"Promise<ISubscription>",required:!0}},{key:"findSubscriptionFromMessage",value:{name:"Promise",elements:[{name:"union",raw:"ISubscription | undefined",elements:[{name:"ISubscription"},{name:"undefined"}]}],raw:"Promise<ISubscription | undefined>",required:!0}},{key:"getSubscriptionFromMessage",value:{name:"Promise",elements:[{name:"ISubscription"}],raw:"Promise<ISubscription>",required:!0}}]},required:!0}},{key:"uploads",value:{name:"signature",type:"object",raw:"{\n\tget(): readonly Upload[];\n\tsubscribe(callback: () => void): () => void;\n\twipeFailedOnes(): void;\n\tcancel(id: Upload['id']): void;\n\tsend(\n\t\tfile: File,\n\t\t{ description, msg, t, e2e }: { description?: string; msg?: string; t?: IMessage['t']; e2e?: IMessage['e2e'] },\n\t\tgetContent?: (fileId: string, fileUrl: string) => Promise<IE2EEMessage['content']>,\n\t\tfileContent?: { raw: Partial<IUpload>; encrypted: IE2EEMessage['content'] },\n\t): Promise<void>;\n}",signature:{properties:[{key:"get",value:{name:"unknown",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}},{key:"wipeFailedOnes",value:{name:"void",required:!0}},{key:"cancel",value:{name:"void",required:!0}},{key:"send",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}}]},required:!0}},{key:"readStateManager",value:{name:"ReadStateManager",required:!0}},{key:"messageEditing",value:{name:"signature",type:"object",raw:"{\n\ttoPreviousMessage(): Promise<void>;\n\ttoNextMessage(): Promise<void>;\n\teditMessage(message: IMessage, options?: { cursorAtStart?: boolean }): Promise<void>;\n}",signature:{properties:[{key:"toPreviousMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"toNextMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"editMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}}]},required:!0}},{key:"currentEditing",value:{name:"union",raw:"| {\n\t\treadonly mid: IMessage['_id'];\n\t\treset(): Promise<boolean>;\n\t\tstop(): Promise<void>;\n\t\tcancel(): Promise<void>;\n  }\n| undefined",elements:[{name:"signature",type:"object",raw:"{\nreadonly mid: IMessage['_id'];\nreset(): Promise<boolean>;\nstop(): Promise<void>;\ncancel(): Promise<void>;\n}",signature:{properties:[{key:"mid",value:{name:"IMessage['_id']",raw:"IMessage['_id']",required:!0}},{key:"reset",value:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>",required:!0}},{key:"stop",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"cancel",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}}]}},{name:"undefined"}],required:!0}},{key:"emojiPicker",value:{name:"signature",type:"object",raw:"{\n\topen(el: Element, cb: (emoji: string) => void): void;\n\tclose(): void;\n}",signature:{properties:[{key:"open",value:{name:"void",required:!0}},{key:"close",value:{name:"void",required:!0}}]},required:!0}},{key:"action",value:{name:"signature",type:"object",raw:"{\n\tstart(action: 'typing'): void;\n\tstop(action: 'typing' | 'recording' | 'uploading' | 'playing'): void;\n\tperformContinuously(action: 'recording' | 'uploading' | 'playing'): void;\n}",signature:{properties:[{key:"start",value:{name:"void",required:!0}},{key:"stop",value:{name:"void",required:!0}},{key:"performContinuously",value:{name:"void",required:!0}}]},required:!0}},{key:"ActionManager",value:{name:"IActionManager",required:!0}},{key:"flows",value:{name:"signature",type:"object",raw:"{\n\treadonly uploadFiles: (files: readonly File[], resetFileInput?: () => void) => Promise<void>;\n\treadonly sendMessage: ({\n\t\ttext,\n\t\ttshow,\n\t}: {\n\t\ttext: string;\n\t\ttshow?: boolean;\n\t\tpreviewUrls?: string[];\n\t\tisSlashCommandAllowed?: boolean;\n\t}) => Promise<boolean>;\n\treadonly processSlashCommand: (message: IMessage, userId: string | null) => Promise<boolean>;\n\treadonly processTooLongMessage: (message: IMessage) => Promise<boolean>;\n\treadonly processMessageEditing: (\n\t\tmessage: Pick<IMessage, '_id' | 't'> & Partial<Omit<IMessage, '_id' | 't'>>,\n\t\tpreviewUrls?: string[],\n\t) => Promise<boolean>;\n\treadonly processSetReaction: (message: Pick<IMessage, 'msg'>) => Promise<boolean>;\n\treadonly requestMessageDeletion: (message: IMessage) => Promise<void>;\n\treadonly replyBroadcast: (message: IMessage) => Promise<void>;\n}",signature:{properties:[{key:"uploadFiles",value:{name:"signature",type:"function",raw:"(files: readonly File[], resetFileInput?: () => void) => Promise<void>",signature:{arguments:[{type:{name:"unknown"},name:"files"},{type:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},name:"resetFileInput"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!0}},{key:"sendMessage",value:{name:"signature",type:"function",raw:"({\n\ttext,\n\ttshow,\n}: {\n\ttext: string;\n\ttshow?: boolean;\n\tpreviewUrls?: string[];\n\tisSlashCommandAllowed?: boolean;\n}) => Promise<boolean>",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{\n\ttext: string;\n\ttshow?: boolean;\n\tpreviewUrls?: string[];\n\tisSlashCommandAllowed?: boolean;\n}",signature:{properties:[{key:"text",value:{name:"string",required:!0}},{key:"tshow",value:{name:"boolean",required:!1}},{key:"previewUrls",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"isSlashCommandAllowed",value:{name:"boolean",required:!1}}]}},name:""}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}},required:!0}},{key:"processSlashCommand",value:{name:"signature",type:"function",raw:"(message: IMessage, userId: string | null) => Promise<boolean>",signature:{arguments:[{type:{name:"IMessage"},name:"message"},{type:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},name:"userId"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}},required:!0}},{key:"processTooLongMessage",value:{name:"signature",type:"function",raw:"(message: IMessage) => Promise<boolean>",signature:{arguments:[{type:{name:"IMessage"},name:"message"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}},required:!0}},{key:"processMessageEditing",value:{name:"signature",type:"function",raw:"(\n\tmessage: Pick<IMessage, '_id' | 't'> & Partial<Omit<IMessage, '_id' | 't'>>,\n\tpreviewUrls?: string[],\n) => Promise<boolean>",signature:{arguments:[{type:{name:"intersection",raw:"Pick<IMessage, '_id' | 't'> & Partial<Omit<IMessage, '_id' | 't'>>",elements:[{name:"Pick",elements:[{name:"IMessage"},{name:"union",raw:"'_id' | 't'",elements:[{name:"literal",value:"'_id'"},{name:"literal",value:"'t'"}]}],raw:"Pick<IMessage, '_id' | 't'>"},{name:"Partial",elements:[{name:"Omit",elements:[{name:"IMessage"},{name:"union",raw:"'_id' | 't'",elements:[{name:"literal",value:"'_id'"},{name:"literal",value:"'t'"}]}],raw:"Omit<IMessage, '_id' | 't'>"}],raw:"Partial<Omit<IMessage, '_id' | 't'>>"}]},name:"message"},{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"previewUrls"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}},required:!0}},{key:"processSetReaction",value:{name:"signature",type:"function",raw:"(message: Pick<IMessage, 'msg'>) => Promise<boolean>",signature:{arguments:[{type:{name:"Pick",elements:[{name:"IMessage"},{name:"literal",value:"'msg'"}],raw:"Pick<IMessage, 'msg'>"},name:"message"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}},required:!0}},{key:"requestMessageDeletion",value:{name:"signature",type:"function",raw:"(message: IMessage) => Promise<void>",signature:{arguments:[{type:{name:"IMessage"},name:"message"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!0}},{key:"replyBroadcast",value:{name:"signature",type:"function",raw:"(message: IMessage) => Promise<void>",signature:{arguments:[{type:{name:"IMessage"},name:"message"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!0}}]},required:!0}}]}},description:""},isMicrophoneDenied:{required:!1,tsType:{name:"boolean"},description:""}}};var css_in_js_dist_index_module=__webpack_require__("./node_modules/@rocket.chat/css-in-js/dist/index.module.js"),UserAction=__webpack_require__("./app/ui/client/lib/UserAction.ts");function videoRecorder_typeof(o){return videoRecorder_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},videoRecorder_typeof(o)}function videoRecorder_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,videoRecorder_toPropertyKey(o.key),o)}}function videoRecorder_defineProperty(e,r,t){return(r=videoRecorder_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function videoRecorder_toPropertyKey(t){var i=function videoRecorder_toPrimitive(t,r){if("object"!=videoRecorder_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=videoRecorder_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==videoRecorder_typeof(i)?i:i+""}var _templateObject,VideoRecorder=function(){function VideoRecorder(){!function videoRecorder_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,VideoRecorder),videoRecorder_defineProperty(this,"cameraStarted",new meteor.Hw(!1)),videoRecorder_defineProperty(this,"started",!1),videoRecorder_defineProperty(this,"recording",new meteor.Hw(!1)),videoRecorder_defineProperty(this,"recordingAvailable",new meteor.Hw(!1)),videoRecorder_defineProperty(this,"videoel",void 0),videoRecorder_defineProperty(this,"chunks",[]),videoRecorder_defineProperty(this,"stream",void 0),videoRecorder_defineProperty(this,"mediaRecorder",void 0)}return function videoRecorder_createClass(e,r,t){return r&&videoRecorder_defineProperties(e.prototype,r),t&&videoRecorder_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(VideoRecorder,[{key:"getSupportedMimeTypes",value:function getSupportedMimeTypes(){return window.MediaRecorder.isTypeSupported("video/webm")?"video/webm; codecs=vp8,opus":window.MediaRecorder.isTypeSupported("video/mp4")?"video/mp4":""}},{key:"start",value:function start(videoel,cb){var _ref,_ref2,_navigator$getUserMed,_this=this;this.videoel=videoel;var handleSuccess=function handleSuccess(stream){_this.startUserMedia(stream),null==cb||cb.call(_this,!0)},handleError=function handleError(error){console.error(error),null==cb||cb.call(_this,!1)};if(navigator.mediaDevices)navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(handleSuccess,handleError);else{var oldGetUserMedia=null!==(_ref=null!==(_ref2=null!==(_navigator$getUserMed=navigator.getUserMedia)&&void 0!==_navigator$getUserMed?_navigator$getUserMed:navigator.webkitGetUserMedia)&&void 0!==_ref2?_ref2:navigator.mozGetUserMedia)&&void 0!==_ref?_ref:navigator.msGetUserMedia;oldGetUserMedia?oldGetUserMedia.call(navigator,{audio:!0,video:!0},handleSuccess,handleError):null==cb||cb.call(this,!1)}}},{key:"record",value:function record(){var _this2=this;if(this.chunks=[],this.stream)return this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:this.getSupportedMimeTypes()}),this.mediaRecorder.ondataavailable=function(blobev){if(_this2.chunks.push(blobev.data),!_this2.recordingAvailable.get())return _this2.recordingAvailable.set(!0)},this.mediaRecorder.start(),this.recording.set(!0)}},{key:"startUserMedia",value:function startUserMedia(stream){if(this.videoel){this.stream=stream;try{this.videoel.srcObject=stream}catch(error){var URL=window.URL||window.webkitURL;this.videoel.src=URL.createObjectURL(stream)}return this.started=!0,this.cameraStarted.set(!0)}}},{key:"stop",value:function stop(cb){if(this.started){if(this.stopRecording(),this.stream){for(var vtracks=this.stream.getVideoTracks(),_i=0,_Array$from=Array.from(vtracks);_i<_Array$from.length;_i++){_Array$from[_i].stop()}for(var atracks=this.stream.getAudioTracks(),_i2=0,_Array$from2=Array.from(atracks);_i2<_Array$from2.length;_i2++){_Array$from2[_i2].stop()}}if(this.videoel&&(this.videoel.pause,this.videoel.src=""),this.started=!1,this.cameraStarted.set(!1),this.recordingAvailable.set(!1),cb&&this.chunks)cb(new Blob(this.chunks));delete this.stream,delete this.videoel}}},{key:"stopRecording",value:function stopRecording(){this.started&&this.recording&&this.mediaRecorder&&(this.mediaRecorder.stop(),this.recording.set(!1),delete this.mediaRecorder)}}]),VideoRecorder}(),instance=new VideoRecorder;function VideoMessageRecorder_typeof(o){return VideoMessageRecorder_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},VideoMessageRecorder_typeof(o)}function VideoMessageRecorder_regeneratorRuntime(){VideoMessageRecorder_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==VideoMessageRecorder_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(VideoMessageRecorder_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function VideoMessageRecorder_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function VideoMessageRecorder_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){VideoMessageRecorder_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){VideoMessageRecorder_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}function VideoMessageRecorder_slicedToArray(r,e){return function VideoMessageRecorder_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function VideoMessageRecorder_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function VideoMessageRecorder_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return VideoMessageRecorder_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?VideoMessageRecorder_arrayLikeToArray(r,a):void 0}}(r,e)||function VideoMessageRecorder_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function VideoMessageRecorder_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var videoContainerClass=(0,css_in_js_dist_index_module.css)(_templateObject||(_templateObject=function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n\ttransform: scaleX(-1);\n\tfilter: FlipH;\n\n\t@media (max-width: 500px) {\n\t\t& > video {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t}\n\t}\n"]))),getVideoRecordingExtension=function getVideoRecordingExtension(){return instance.getSupportedMimeTypes().match(/video\/webm/)?"webm":"mp4"},VideoMessageRecorder=function VideoMessageRecorder(_ref){var _useChat,rid=_ref.rid,tmid=_ref.tmid,chatContext=_ref.chatContext,reference=_ref.reference,t=(0,ui_contexts_dist.useTranslation)(),videoRef=(0,react.useRef)(null),dispatchToastMessage=(0,ui_contexts_dist.useToastMessageDispatch)(),_useState2=VideoMessageRecorder_slicedToArray((0,react.useState)(),2),time=_useState2[0],setTime=_useState2[1],_useState4=VideoMessageRecorder_slicedToArray((0,react.useState)("idle"),2),recordingState=_useState4[0],setRecordingState=_useState4[1],_useState6=VideoMessageRecorder_slicedToArray((0,react.useState)(null),2),recordingInterval=_useState6[0],setRecordingInterval=_useState6[1],isRecording="recording"===recordingState,sendButtonDisabled=!(instance.cameraStarted.get()&&"recording"!==recordingState),chat=null!==(_useChat=(0,ChatContext.Y)())&&void 0!==_useChat?_useChat:chatContext,stopVideoRecording=function(){var _ref2=VideoMessageRecorder_asyncToGenerator(VideoMessageRecorder_regeneratorRuntime().mark((function _callee(rid,tmid){return VideoMessageRecorder_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:recordingInterval&&clearInterval(recordingInterval),setRecordingInterval(null),instance.stopRecording(),UserAction.a.stop(rid,UserAction.A.USER_RECORDING,{tmid:tmid}),setRecordingState("idle");case 5:case"end":return _context.stop()}}),_callee)})));return function stopVideoRecording(_x,_x2){return _ref2.apply(this,arguments)}}(),handleRecord=function(){var _ref3=VideoMessageRecorder_asyncToGenerator(VideoMessageRecorder_regeneratorRuntime().mark((function _callee2(){var startTime;return VideoMessageRecorder_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:"recording"===recordingState?stopVideoRecording(rid,tmid):(instance.record(),setRecordingState("recording"),UserAction.a.performContinuously(rid,UserAction.A.USER_RECORDING,{tmid:tmid}),setTime("00:00"),startTime=new Date,setRecordingInterval(setInterval((function(){var distance=((new Date).getTime()-startTime.getTime())/1e3,minutes=Math.floor(distance/60),seconds=Math.floor(distance%60);setTime("".concat(String(minutes).padStart(2,"0"),":").concat(String(seconds).padStart(2,"0")))}),1e3)));case 1:case"end":return _context2.stop()}}),_callee2)})));return function handleRecord(){return _ref3.apply(this,arguments)}}(),handleSendRecord=function(){var _ref4=VideoMessageRecorder_asyncToGenerator(VideoMessageRecorder_regeneratorRuntime().mark((function _callee4(){var cb;return VideoMessageRecorder_regeneratorRuntime().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:cb=function(){var _ref5=VideoMessageRecorder_asyncToGenerator(VideoMessageRecorder_regeneratorRuntime().mark((function _callee3(blob){var _chat$composer,fileName,file;return VideoMessageRecorder_regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return fileName="".concat(t("Video_record"),".").concat(getVideoRecordingExtension()),file=new File([blob],fileName,{type:instance.getSupportedMimeTypes().split(";")[0]}),_context3.next=4,null==chat?void 0:chat.flows.uploadFiles([file]);case 4:null==chat||null===(_chat$composer=chat.composer)||void 0===_chat$composer||_chat$composer.setRecordingVideo(!1);case 5:case"end":return _context3.stop()}}),_callee3)})));return function cb(_x3){return _ref5.apply(this,arguments)}}(),instance.stop(cb),setTime(void 0),stopVideoRecording(rid,tmid);case 4:case"end":return _context4.stop()}}),_callee4)})));return function handleSendRecord(){return _ref4.apply(this,arguments)}}(),handleCancel=(0,index_module.useMutableCallback)((function(){var _chat$composer2;instance.stop(),null==chat||null===(_chat$composer2=chat.composer)||void 0===_chat$composer2||_chat$composer2.setRecordingVideo(!1),setTime(void 0),stopVideoRecording(rid,tmid)}));return(0,react.useEffect)((function(){var _videoRef$current;return instance.getSupportedMimeTypes()?(instance.start(null!==(_videoRef$current=videoRef.current)&&void 0!==_videoRef$current?_videoRef$current:void 0,(function(success){return success?void 0:handleCancel()})),function(){instance.stop()}):dispatchToastMessage({type:"error",message:t("Browser_does_not_support_recording_video")})}),[dispatchToastMessage,handleCancel,t]),react.createElement(fuselage.PositionAnimated,{visible:"visible",anchor:reference,placement:"top-end"},react.createElement(fuselage.Box,{bg:"light",padding:4,borderRadius:4,elevation:"2"},react.createElement(fuselage.Box,{className:videoContainerClass,overflow:"hidden",height:240,borderRadius:4},react.createElement("video",{muted:!0,autoPlay:!0,playsInline:!0,ref:videoRef,width:320,height:240})),react.createElement(fuselage.Box,{mbs:4,display:"flex",justifyContent:"space-between"},react.createElement(fuselage.Button,{small:!0,onClick:handleRecord},react.createElement(fuselage.Box,{is:"span",display:"flex",alignItems:"center"},react.createElement(fuselage.Icon,{size:"x16",mie:time?4:void 0,name:isRecording?"stop-unfilled":"rec"}),time&&react.createElement("span",null,time))),react.createElement(fuselage.ButtonGroup,null,react.createElement(fuselage.Button,{small:!0,onClick:handleCancel},t("Cancel")),react.createElement(fuselage.Button,{primary:!0,small:!0,disabled:sendButtonDisabled,onClick:handleSendRecord},t("Send"))))))},VideoMessageRecorder_VideoMessageRecorder=VideoMessageRecorder;VideoMessageRecorder.__docgenInfo={description:"",methods:[],displayName:"VideoMessageRecorder",props:{rid:{required:!0,tsType:{name:"IRoom['_id']",raw:"IRoom['_id']"},description:""},tmid:{required:!1,tsType:{name:"IMessage['_id']",raw:"IMessage['_id']"},description:""},chatContext:{required:!1,tsType:{name:"signature",type:"object",raw:"{\n\treadonly uid: string | null;\n\treadonly composer?: ComposerAPI;\n\treadonly setComposerAPI: (composer: ComposerAPI) => void;\n\treadonly data: DataAPI;\n\treadonly uploads: UploadsAPI;\n\treadonly readStateManager: ReadStateManager;\n\treadonly messageEditing: {\n\t\ttoPreviousMessage(): Promise<void>;\n\t\ttoNextMessage(): Promise<void>;\n\t\teditMessage(message: IMessage, options?: { cursorAtStart?: boolean }): Promise<void>;\n\t};\n\n\treadonly currentEditing:\n\t\t| {\n\t\t\t\treadonly mid: IMessage['_id'];\n\t\t\t\treset(): Promise<boolean>;\n\t\t\t\tstop(): Promise<void>;\n\t\t\t\tcancel(): Promise<void>;\n\t\t  }\n\t\t| undefined;\n\n\treadonly emojiPicker: {\n\t\topen(el: Element, cb: (emoji: string) => void): void;\n\t\tclose(): void;\n\t};\n\n\treadonly action: {\n\t\tstart(action: 'typing'): void;\n\t\tstop(action: 'typing' | 'recording' | 'uploading' | 'playing'): void;\n\t\tperformContinuously(action: 'recording' | 'uploading' | 'playing'): void;\n\t};\n\n\tActionManager: IActionManager;\n\n\treadonly flows: {\n\t\treadonly uploadFiles: (files: readonly File[], resetFileInput?: () => void) => Promise<void>;\n\t\treadonly sendMessage: ({\n\t\t\ttext,\n\t\t\ttshow,\n\t\t}: {\n\t\t\ttext: string;\n\t\t\ttshow?: boolean;\n\t\t\tpreviewUrls?: string[];\n\t\t\tisSlashCommandAllowed?: boolean;\n\t\t}) => Promise<boolean>;\n\t\treadonly processSlashCommand: (message: IMessage, userId: string | null) => Promise<boolean>;\n\t\treadonly processTooLongMessage: (message: IMessage) => Promise<boolean>;\n\t\treadonly processMessageEditing: (\n\t\t\tmessage: Pick<IMessage, '_id' | 't'> & Partial<Omit<IMessage, '_id' | 't'>>,\n\t\t\tpreviewUrls?: string[],\n\t\t) => Promise<boolean>;\n\t\treadonly processSetReaction: (message: Pick<IMessage, 'msg'>) => Promise<boolean>;\n\t\treadonly requestMessageDeletion: (message: IMessage) => Promise<void>;\n\t\treadonly replyBroadcast: (message: IMessage) => Promise<void>;\n\t};\n}",signature:{properties:[{key:"uid",value:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}],required:!0}},{key:"composer",value:{name:"signature",type:"object",raw:"{\n\trelease(): void;\n\treadonly text: string;\n\treadonly selection: { readonly start: number; readonly end: number };\n\tsetText(\n\t\ttext: string,\n\t\toptions?: {\n\t\t\tselection?:\n\t\t\t\t| { readonly start?: number; readonly end?: number }\n\t\t\t\t| ((previous: { readonly start: number; readonly end: number }) => { readonly start?: number; readonly end?: number });\n\t\t},\n\t): void;\n\twrapSelection(pattern: string): void;\n\tinsertText(text: string): void;\n\tinsertNewLine(): void;\n\tclear(): void;\n\tfocus(): void;\n\tblur(): void;\n\n\tgetCursorPosition(): number | undefined;\n\n\tsubstring(start: number, end?: number): string;\n\n\treplaceText(\n\t\ttext: string,\n\t\tselection: {\n\t\t\tstart: number;\n\t\t\tend: number;\n\t\t},\n\t): void;\n\n\tsetCursorToEnd(): void;\n\tsetCursorToStart(): void;\n\treplyWith(text: string): Promise<void>;\n\tquoteMessage(message: IMessage): Promise<void>;\n\tdismissQuotedMessage(mid: IMessage['_id']): Promise<void>;\n\tdismissAllQuotedMessages(): Promise<void>;\n\treadonly quotedMessages: Subscribable<IMessage[]>;\n\n\tsetEditingMode(editing: boolean): void;\n\treadonly editing: Subscribable<boolean>;\n\n\tsetRecordingMode(recording: boolean): void;\n\treadonly recording: Subscribable<boolean>;\n\n\tsetRecordingVideo(recording: boolean): void;\n\treadonly recordingVideo: Subscribable<boolean>;\n\n\tsetIsMicrophoneDenied(isMicrophoneDenied: boolean): void;\n\treadonly isMicrophoneDenied: Subscribable<boolean>;\n\n\treadonly formatters: Subscribable<FormattingButton[]>;\n}",signature:{properties:[{key:"release",value:{name:"void",required:!0}},{key:"text",value:{name:"string",required:!0}},{key:"selection",value:{name:"signature",type:"object",raw:"{ readonly start: number; readonly end: number }",signature:{properties:[{key:"start",value:{name:"number",required:!0}},{key:"end",value:{name:"number",required:!0}}]},required:!0}},{key:"setText",value:{name:"void",required:!0}},{key:"wrapSelection",value:{name:"void",required:!0}},{key:"insertText",value:{name:"void",required:!0}},{key:"insertNewLine",value:{name:"void",required:!0}},{key:"clear",value:{name:"void",required:!0}},{key:"focus",value:{name:"void",required:!0}},{key:"blur",value:{name:"void",required:!0}},{key:"getCursorPosition",value:{name:"union",raw:"number | undefined",elements:[{name:"number"},{name:"undefined"}],required:!0}},{key:"substring",value:{name:"string",required:!0}},{key:"replaceText",value:{name:"void",required:!0}},{key:"setCursorToEnd",value:{name:"void",required:!0}},{key:"setCursorToStart",value:{name:"void",required:!0}},{key:"replyWith",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quoteMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissQuotedMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissAllQuotedMessages",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quotedMessages",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setEditingMode",value:{name:"void",required:!0}},{key:"editing",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingMode",value:{name:"void",required:!0}},{key:"recording",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingVideo",value:{name:"void",required:!0}},{key:"recordingVideo",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setIsMicrophoneDenied",value:{name:"void",required:!0}},{key:"isMicrophoneDenied",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"formatters",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}}]},required:!1}},{key:"setComposerAPI",value:{name:"signature",type:"function",raw:"(composer: ComposerAPI) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{\n\trelease(): void;\n\treadonly text: string;\n\treadonly selection: { readonly start: number; readonly end: number };\n\tsetText(\n\t\ttext: string,\n\t\toptions?: {\n\t\t\tselection?:\n\t\t\t\t| { readonly start?: number; readonly end?: number }\n\t\t\t\t| ((previous: { readonly start: number; readonly end: number }) => { readonly start?: number; readonly end?: number });\n\t\t},\n\t): void;\n\twrapSelection(pattern: string): void;\n\tinsertText(text: string): void;\n\tinsertNewLine(): void;\n\tclear(): void;\n\tfocus(): void;\n\tblur(): void;\n\n\tgetCursorPosition(): number | undefined;\n\n\tsubstring(start: number, end?: number): string;\n\n\treplaceText(\n\t\ttext: string,\n\t\tselection: {\n\t\t\tstart: number;\n\t\t\tend: number;\n\t\t},\n\t): void;\n\n\tsetCursorToEnd(): void;\n\tsetCursorToStart(): void;\n\treplyWith(text: string): Promise<void>;\n\tquoteMessage(message: IMessage): Promise<void>;\n\tdismissQuotedMessage(mid: IMessage['_id']): Promise<void>;\n\tdismissAllQuotedMessages(): Promise<void>;\n\treadonly quotedMessages: Subscribable<IMessage[]>;\n\n\tsetEditingMode(editing: boolean): void;\n\treadonly editing: Subscribable<boolean>;\n\n\tsetRecordingMode(recording: boolean): void;\n\treadonly recording: Subscribable<boolean>;\n\n\tsetRecordingVideo(recording: boolean): void;\n\treadonly recordingVideo: Subscribable<boolean>;\n\n\tsetIsMicrophoneDenied(isMicrophoneDenied: boolean): void;\n\treadonly isMicrophoneDenied: Subscribable<boolean>;\n\n\treadonly formatters: Subscribable<FormattingButton[]>;\n}",signature:{properties:[{key:"release",value:{name:"void",required:!0}},{key:"text",value:{name:"string",required:!0}},{key:"selection",value:{name:"signature",type:"object",raw:"{ readonly start: number; readonly end: number }",signature:{properties:[{key:"start",value:{name:"number",required:!0}},{key:"end",value:{name:"number",required:!0}}]},required:!0}},{key:"setText",value:{name:"void",required:!0}},{key:"wrapSelection",value:{name:"void",required:!0}},{key:"insertText",value:{name:"void",required:!0}},{key:"insertNewLine",value:{name:"void",required:!0}},{key:"clear",value:{name:"void",required:!0}},{key:"focus",value:{name:"void",required:!0}},{key:"blur",value:{name:"void",required:!0}},{key:"getCursorPosition",value:{name:"union",raw:"number | undefined",elements:[{name:"number"},{name:"undefined"}],required:!0}},{key:"substring",value:{name:"string",required:!0}},{key:"replaceText",value:{name:"void",required:!0}},{key:"setCursorToEnd",value:{name:"void",required:!0}},{key:"setCursorToStart",value:{name:"void",required:!0}},{key:"replyWith",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quoteMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissQuotedMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissAllQuotedMessages",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quotedMessages",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setEditingMode",value:{name:"void",required:!0}},{key:"editing",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingMode",value:{name:"void",required:!0}},{key:"recording",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingVideo",value:{name:"void",required:!0}},{key:"recordingVideo",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setIsMicrophoneDenied",value:{name:"void",required:!0}},{key:"isMicrophoneDenied",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"formatters",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}}]},required:!1},name:"composer"}],return:{name:"void"}},required:!0}},{key:"data",value:{name:"signature",type:"object",raw:"{\n\tcomposeMessage(\n\t\ttext: string,\n\t\toptions: { sendToChannel?: boolean; quotedMessages: IMessage[]; originalMessage?: IMessage | null },\n\t): Promise<IMessage>;\n\tfindMessageByID(mid: IMessage['_id']): Promise<IMessage | null>;\n\tgetMessageByID(mid: IMessage['_id']): Promise<IMessage>;\n\tfindLastMessage(): Promise<IMessage | undefined>;\n\tgetLastMessage(): Promise<IMessage>;\n\tfindLastOwnMessage(): Promise<IMessage | undefined>;\n\tgetLastOwnMessage(): Promise<IMessage>;\n\tfindPreviousOwnMessage(message: IMessage): Promise<IMessage | undefined>;\n\tgetPreviousOwnMessage(message: IMessage): Promise<IMessage>;\n\tfindNextOwnMessage(message: IMessage): Promise<IMessage | undefined>;\n\tgetNextOwnMessage(message: IMessage): Promise<IMessage>;\n\tpushEphemeralMessage(message: Omit<IMessage, 'rid' | 'tmid'>): Promise<void>;\n\tcanUpdateMessage(message: IMessage): Promise<boolean>;\n\tupdateMessage(message: Pick<IMessage, '_id' | 't'> & Partial<Omit<IMessage, '_id' | 't'>>, previewUrls?: string[]): Promise<void>;\n\tcanDeleteMessage(message: IMessage): Promise<boolean>;\n\tdeleteMessage(msgIdOrMsg: IMessage | IMessage['_id']): Promise<void>;\n\tgetDraft(mid: IMessage['_id'] | undefined): Promise<string | undefined>;\n\tdiscardDraft(mid: IMessage['_id'] | undefined): Promise<void>;\n\tsaveDraft(mid: IMessage['_id'] | undefined, text: string): Promise<void>;\n\tfindRoom(): Promise<IRoom | undefined>;\n\tgetRoom(): Promise<IRoom>;\n\tisSubscribedToRoom(): Promise<boolean>;\n\tjoinRoom(): Promise<void>;\n\tfindDiscussionByID(drid: IRoom['_id']): Promise<IRoom | undefined>;\n\tgetDiscussionByID(drid: IRoom['_id']): Promise<IRoom>;\n\tfindSubscription(): Promise<ISubscription | undefined>;\n\tgetSubscription(): Promise<ISubscription>;\n\tfindSubscriptionFromMessage(message: IMessage): Promise<ISubscription | undefined>;\n\tgetSubscriptionFromMessage(message: IMessage): Promise<ISubscription>;\n}",signature:{properties:[{key:"composeMessage",value:{name:"Promise",elements:[{name:"IMessage"}],raw:"Promise<IMessage>",required:!0}},{key:"findMessageByID",value:{name:"Promise",elements:[{name:"union",raw:"IMessage | null",elements:[{name:"IMessage"},{name:"null"}]}],raw:"Promise<IMessage | null>",required:!0}},{key:"getMessageByID",value:{name:"Promise",elements:[{name:"IMessage"}],raw:"Promise<IMessage>",required:!0}},{key:"findLastMessage",value:{name:"Promise",elements:[{name:"union",raw:"IMessage | undefined",elements:[{name:"IMessage"},{name:"undefined"}]}],raw:"Promise<IMessage | undefined>",required:!0}},{key:"getLastMessage",value:{name:"Promise",elements:[{name:"IMessage"}],raw:"Promise<IMessage>",required:!0}},{key:"findLastOwnMessage",value:{name:"Promise",elements:[{name:"union",raw:"IMessage | undefined",elements:[{name:"IMessage"},{name:"undefined"}]}],raw:"Promise<IMessage | undefined>",required:!0}},{key:"getLastOwnMessage",value:{name:"Promise",elements:[{name:"IMessage"}],raw:"Promise<IMessage>",required:!0}},{key:"findPreviousOwnMessage",value:{name:"Promise",elements:[{name:"union",raw:"IMessage | undefined",elements:[{name:"IMessage"},{name:"undefined"}]}],raw:"Promise<IMessage | undefined>",required:!0}},{key:"getPreviousOwnMessage",value:{name:"Promise",elements:[{name:"IMessage"}],raw:"Promise<IMessage>",required:!0}},{key:"findNextOwnMessage",value:{name:"Promise",elements:[{name:"union",raw:"IMessage | undefined",elements:[{name:"IMessage"},{name:"undefined"}]}],raw:"Promise<IMessage | undefined>",required:!0}},{key:"getNextOwnMessage",value:{name:"Promise",elements:[{name:"IMessage"}],raw:"Promise<IMessage>",required:!0}},{key:"pushEphemeralMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"canUpdateMessage",value:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>",required:!0}},{key:"updateMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"canDeleteMessage",value:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>",required:!0}},{key:"deleteMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"getDraft",value:{name:"Promise",elements:[{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]}],raw:"Promise<string | undefined>",required:!0}},{key:"discardDraft",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"saveDraft",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"findRoom",value:{name:"Promise",elements:[{name:"union",raw:"IRoom | undefined",elements:[{name:"IRoom"},{name:"undefined"}]}],raw:"Promise<IRoom | undefined>",required:!0}},{key:"getRoom",value:{name:"Promise",elements:[{name:"IRoom"}],raw:"Promise<IRoom>",required:!0}},{key:"isSubscribedToRoom",value:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>",required:!0}},{key:"joinRoom",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"findDiscussionByID",value:{name:"Promise",elements:[{name:"union",raw:"IRoom | undefined",elements:[{name:"IRoom"},{name:"undefined"}]}],raw:"Promise<IRoom | undefined>",required:!0}},{key:"getDiscussionByID",value:{name:"Promise",elements:[{name:"IRoom"}],raw:"Promise<IRoom>",required:!0}},{key:"findSubscription",value:{name:"Promise",elements:[{name:"union",raw:"ISubscription | undefined",elements:[{name:"ISubscription"},{name:"undefined"}]}],raw:"Promise<ISubscription | undefined>",required:!0}},{key:"getSubscription",value:{name:"Promise",elements:[{name:"ISubscription"}],raw:"Promise<ISubscription>",required:!0}},{key:"findSubscriptionFromMessage",value:{name:"Promise",elements:[{name:"union",raw:"ISubscription | undefined",elements:[{name:"ISubscription"},{name:"undefined"}]}],raw:"Promise<ISubscription | undefined>",required:!0}},{key:"getSubscriptionFromMessage",value:{name:"Promise",elements:[{name:"ISubscription"}],raw:"Promise<ISubscription>",required:!0}}]},required:!0}},{key:"uploads",value:{name:"signature",type:"object",raw:"{\n\tget(): readonly Upload[];\n\tsubscribe(callback: () => void): () => void;\n\twipeFailedOnes(): void;\n\tcancel(id: Upload['id']): void;\n\tsend(\n\t\tfile: File,\n\t\t{ description, msg, t, e2e }: { description?: string; msg?: string; t?: IMessage['t']; e2e?: IMessage['e2e'] },\n\t\tgetContent?: (fileId: string, fileUrl: string) => Promise<IE2EEMessage['content']>,\n\t\tfileContent?: { raw: Partial<IUpload>; encrypted: IE2EEMessage['content'] },\n\t): Promise<void>;\n}",signature:{properties:[{key:"get",value:{name:"unknown",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}},{key:"wipeFailedOnes",value:{name:"void",required:!0}},{key:"cancel",value:{name:"void",required:!0}},{key:"send",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}}]},required:!0}},{key:"readStateManager",value:{name:"ReadStateManager",required:!0}},{key:"messageEditing",value:{name:"signature",type:"object",raw:"{\n\ttoPreviousMessage(): Promise<void>;\n\ttoNextMessage(): Promise<void>;\n\teditMessage(message: IMessage, options?: { cursorAtStart?: boolean }): Promise<void>;\n}",signature:{properties:[{key:"toPreviousMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"toNextMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"editMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}}]},required:!0}},{key:"currentEditing",value:{name:"union",raw:"| {\n\t\treadonly mid: IMessage['_id'];\n\t\treset(): Promise<boolean>;\n\t\tstop(): Promise<void>;\n\t\tcancel(): Promise<void>;\n  }\n| undefined",elements:[{name:"signature",type:"object",raw:"{\nreadonly mid: IMessage['_id'];\nreset(): Promise<boolean>;\nstop(): Promise<void>;\ncancel(): Promise<void>;\n}",signature:{properties:[{key:"mid",value:{name:"IMessage['_id']",raw:"IMessage['_id']",required:!0}},{key:"reset",value:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>",required:!0}},{key:"stop",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"cancel",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}}]}},{name:"undefined"}],required:!0}},{key:"emojiPicker",value:{name:"signature",type:"object",raw:"{\n\topen(el: Element, cb: (emoji: string) => void): void;\n\tclose(): void;\n}",signature:{properties:[{key:"open",value:{name:"void",required:!0}},{key:"close",value:{name:"void",required:!0}}]},required:!0}},{key:"action",value:{name:"signature",type:"object",raw:"{\n\tstart(action: 'typing'): void;\n\tstop(action: 'typing' | 'recording' | 'uploading' | 'playing'): void;\n\tperformContinuously(action: 'recording' | 'uploading' | 'playing'): void;\n}",signature:{properties:[{key:"start",value:{name:"void",required:!0}},{key:"stop",value:{name:"void",required:!0}},{key:"performContinuously",value:{name:"void",required:!0}}]},required:!0}},{key:"ActionManager",value:{name:"IActionManager",required:!0}},{key:"flows",value:{name:"signature",type:"object",raw:"{\n\treadonly uploadFiles: (files: readonly File[], resetFileInput?: () => void) => Promise<void>;\n\treadonly sendMessage: ({\n\t\ttext,\n\t\ttshow,\n\t}: {\n\t\ttext: string;\n\t\ttshow?: boolean;\n\t\tpreviewUrls?: string[];\n\t\tisSlashCommandAllowed?: boolean;\n\t}) => Promise<boolean>;\n\treadonly processSlashCommand: (message: IMessage, userId: string | null) => Promise<boolean>;\n\treadonly processTooLongMessage: (message: IMessage) => Promise<boolean>;\n\treadonly processMessageEditing: (\n\t\tmessage: Pick<IMessage, '_id' | 't'> & Partial<Omit<IMessage, '_id' | 't'>>,\n\t\tpreviewUrls?: string[],\n\t) => Promise<boolean>;\n\treadonly processSetReaction: (message: Pick<IMessage, 'msg'>) => Promise<boolean>;\n\treadonly requestMessageDeletion: (message: IMessage) => Promise<void>;\n\treadonly replyBroadcast: (message: IMessage) => Promise<void>;\n}",signature:{properties:[{key:"uploadFiles",value:{name:"signature",type:"function",raw:"(files: readonly File[], resetFileInput?: () => void) => Promise<void>",signature:{arguments:[{type:{name:"unknown"},name:"files"},{type:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},name:"resetFileInput"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!0}},{key:"sendMessage",value:{name:"signature",type:"function",raw:"({\n\ttext,\n\ttshow,\n}: {\n\ttext: string;\n\ttshow?: boolean;\n\tpreviewUrls?: string[];\n\tisSlashCommandAllowed?: boolean;\n}) => Promise<boolean>",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{\n\ttext: string;\n\ttshow?: boolean;\n\tpreviewUrls?: string[];\n\tisSlashCommandAllowed?: boolean;\n}",signature:{properties:[{key:"text",value:{name:"string",required:!0}},{key:"tshow",value:{name:"boolean",required:!1}},{key:"previewUrls",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"isSlashCommandAllowed",value:{name:"boolean",required:!1}}]}},name:""}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}},required:!0}},{key:"processSlashCommand",value:{name:"signature",type:"function",raw:"(message: IMessage, userId: string | null) => Promise<boolean>",signature:{arguments:[{type:{name:"IMessage"},name:"message"},{type:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},name:"userId"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}},required:!0}},{key:"processTooLongMessage",value:{name:"signature",type:"function",raw:"(message: IMessage) => Promise<boolean>",signature:{arguments:[{type:{name:"IMessage"},name:"message"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}},required:!0}},{key:"processMessageEditing",value:{name:"signature",type:"function",raw:"(\n\tmessage: Pick<IMessage, '_id' | 't'> & Partial<Omit<IMessage, '_id' | 't'>>,\n\tpreviewUrls?: string[],\n) => Promise<boolean>",signature:{arguments:[{type:{name:"intersection",raw:"Pick<IMessage, '_id' | 't'> & Partial<Omit<IMessage, '_id' | 't'>>",elements:[{name:"Pick",elements:[{name:"IMessage"},{name:"union",raw:"'_id' | 't'",elements:[{name:"literal",value:"'_id'"},{name:"literal",value:"'t'"}]}],raw:"Pick<IMessage, '_id' | 't'>"},{name:"Partial",elements:[{name:"Omit",elements:[{name:"IMessage"},{name:"union",raw:"'_id' | 't'",elements:[{name:"literal",value:"'_id'"},{name:"literal",value:"'t'"}]}],raw:"Omit<IMessage, '_id' | 't'>"}],raw:"Partial<Omit<IMessage, '_id' | 't'>>"}]},name:"message"},{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"previewUrls"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}},required:!0}},{key:"processSetReaction",value:{name:"signature",type:"function",raw:"(message: Pick<IMessage, 'msg'>) => Promise<boolean>",signature:{arguments:[{type:{name:"Pick",elements:[{name:"IMessage"},{name:"literal",value:"'msg'"}],raw:"Pick<IMessage, 'msg'>"},name:"message"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}},required:!0}},{key:"requestMessageDeletion",value:{name:"signature",type:"function",raw:"(message: IMessage) => Promise<void>",signature:{arguments:[{type:{name:"IMessage"},name:"message"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!0}},{key:"replyBroadcast",value:{name:"signature",type:"function",raw:"(message: IMessage) => Promise<void>",signature:{arguments:[{type:{name:"IMessage"},name:"message"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!0}}]},required:!0}}]}},description:""},reference:{required:!0,tsType:{name:"RefObject",elements:[{name:"HTMLElement"}],raw:"RefObject<HTMLElement>"},description:""}}};var ComposerPopupContext=__webpack_require__("./client/views/room/contexts/ComposerPopupContext.ts");function ComposerBoxPopup_typeof(o){return ComposerBoxPopup_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},ComposerBoxPopup_typeof(o)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){ComposerBoxPopup_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function ComposerBoxPopup_defineProperty(e,r,t){return(r=function ComposerBoxPopup_toPropertyKey(t){var i=function ComposerBoxPopup_toPrimitive(t,r){if("object"!=ComposerBoxPopup_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=ComposerBoxPopup_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==ComposerBoxPopup_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function ComposerBoxPopup(_ref){var title=_ref.title,items=_ref.items,focused=_ref.focused,select=_ref.select,_ref$renderItem=_ref.renderItem,renderItem=void 0===_ref$renderItem?function(_ref2){var item=_ref2.item;return react.createElement(react.Fragment,null,JSON.stringify(item))}:_ref$renderItem,t=(0,ui_contexts_dist.useTranslation)(),id=(0,index_module.useUniqueId)(),composerBoxPopupRef=(0,react.useRef)(null),popupSizes=(0,index_module.useContentBoxSize)(composerBoxPopupRef),variant=popupSizes&&popupSizes.inlineSize<480?"small":"large",getOptionTitle=function getOptionTitle(item){if("small"===variant)return item.outside?t("Not_in_channel"):item.suggestion?t("Suggestion_from_recent_messages"):item.disabled?t("Unavailable_in_encrypted_channels"):void 0},itemsFlat=(0,react.useMemo)((function(){return items.flatMap((function(item){return item.isSuccess?item.data:[]})).sort((function(a,b){return("sort"in a&&a.sort||0)-("sort"in b&&b.sort||0)}))}),[items]),isLoading=items.some((function(item){return item.isLoading&&"idle"!==item.fetchStatus}));return(0,react.useEffect)((function(){if(focused){var element=document.getElementById("popup-item-".concat(focused._id));element&&element.scrollIntoView({behavior:"smooth",block:"nearest"})}}),[focused]),react.createElement(fuselage.Box,{className:"message-popup-position",position:"relative"},react.createElement(fuselage.Tile,{ref:composerBoxPopupRef,className:"message-popup",padding:0,role:"menu",mbe:8,overflow:"hidden","aria-labelledby":id},title&&react.createElement(fuselage.Box,{bg:"tint",pi:16,pb:8,id:id},title),react.createElement(fuselage.Box,{pb:8,maxHeight:"x320"},!isLoading&&0===itemsFlat.length&&react.createElement(fuselage.Option,null,t("No_results_found")),isLoading&&react.createElement(fuselage.OptionSkeleton,null),itemsFlat.map((function(item,index){return react.createElement(fuselage.Option,{title:getOptionTitle(item),onClick:function onClick(){return select(item)},selected:item===focused,key:index,id:"popup-item-".concat(item._id),tabIndex:item===focused?0:-1,"aria-selected":item===focused,disabled:item.disabled},renderItem({item:_objectSpread(_objectSpread({},item),{},{variant:variant})}))})))))}var composer_ComposerBoxPopup=(0,react.memo)(ComposerBoxPopup);function ComposerBoxPopupPreview_typeof(o){return ComposerBoxPopupPreview_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},ComposerBoxPopupPreview_typeof(o)}function ComposerBoxPopupPreview_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function ComposerBoxPopupPreview_defineProperty(e,r,t){return(r=function ComposerBoxPopupPreview_toPropertyKey(t){var i=function ComposerBoxPopupPreview_toPrimitive(t,r){if("object"!=ComposerBoxPopupPreview_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=ComposerBoxPopupPreview_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==ComposerBoxPopupPreview_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}ComposerBoxPopup.__docgenInfo={description:"",methods:[],displayName:"ComposerBoxPopup",props:{title:{required:!1,tsType:{name:"string"},description:""},focused:{required:!1,tsType:{name:"T"},description:""},items:{required:!0,tsType:{name:"Array",elements:[{name:"UseQueryResult",elements:[{name:"Array",elements:[{name:"T"}],raw:"T[]"}],raw:"UseQueryResult<T[]>"}],raw:"UseQueryResult<T[]>[]"},description:""},select:{required:!0,tsType:{name:"signature",type:"function",raw:"(item: T) => void",signature:{arguments:[{type:{name:"T"},name:"item"}],return:{name:"void"}}},description:""},renderItem:{required:!1,tsType:{name:"signature",type:"function",raw:"({ item }: { item: T }) => ReactElement",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ item: T }",signature:{properties:[{key:"item",value:{name:"T",required:!0}}]}},name:""}],return:{name:"ReactElement"}}},description:"",defaultValue:{value:"({ item }: { item: T }) => <>{JSON.stringify(item)}</>",computed:!1}}}};var ComposerBoxPopupPreview=(0,react.forwardRef)((function ComposerBoxPopupPreview(_ref,ref){var focused=_ref.focused,items=_ref.items,rid=_ref.rid,tmid=_ref.tmid,select=_ref.select,suspended=_ref.suspended,id=(0,index_module.useUniqueId)(),chat=(0,ChatContext.Y)(),executeSlashCommandPreviewMethod=(0,ui_contexts_dist.useMethod)("executeSlashCommandPreview");(0,react.useImperativeHandle)(ref,(function(){return function ComposerBoxPopupPreview_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ComposerBoxPopupPreview_ownKeys(Object(t),!0).forEach((function(r){ComposerBoxPopupPreview_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ComposerBoxPopupPreview_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({getFilter:function getFilter(){var _chat$composer,_chat$composer2,value=null==chat||null===(_chat$composer=chat.composer)||void 0===_chat$composer?void 0:_chat$composer.substring(0,null==chat||null===(_chat$composer2=chat.composer)||void 0===_chat$composer2?void 0:_chat$composer2.selection.start);if(!value)throw new Error("No value");var matches=value.match(/(\/[\w\d\S]+ )([^]*)$/);if(!matches)throw new Error("No matches");return{cmd:matches[1].replace("/","").trim().toLowerCase(),params:matches[2],msg:{rid:rid,tmid:tmid}}}},!suspended&&{select:function select(item){var _chat$composer3,_chat$composer4,_chat$composer5,value=null==chat||null===(_chat$composer3=chat.composer)||void 0===_chat$composer3?void 0:_chat$composer3.substring(0,null==chat||null===(_chat$composer4=chat.composer)||void 0===_chat$composer4?void 0:_chat$composer4.selection.start);if(!value)throw new Error("No value");var matches=value.match(/(\/[\w\d\S]+ )([^]*)$/);if(!matches)throw new Error("No matches");var cmd=matches[1].replace("/","").trim().toLowerCase(),params=matches[2];executeSlashCommandPreviewMethod({cmd:cmd,params:params,msg:{rid:rid,tmid:tmid}},{id:item._id,type:item.type,value:item.value}),null==chat||null===(_chat$composer5=chat.composer)||void 0===_chat$composer5||_chat$composer5.setText("")}})}),[null==chat?void 0:chat.composer,executeSlashCommandPreviewMethod,rid,tmid,suspended]);var itemsFlat=items.flatMap((function(item){return item.isSuccess?item.data:[]})).sort((function(a,b){return("sort"in a&&a.sort||0)-("sort"in b&&b.sort||0)})),isLoading=items.some((function(item){return item.isLoading&&"idle"!==item.fetchStatus}));return(0,react.useEffect)((function(){if(focused){var element=document.getElementById("popup-item-".concat(focused._id));element&&element.scrollIntoView({behavior:"smooth",block:"nearest"})}}),[focused]),suspended?null:react.createElement(fuselage.Box,{className:"message-popup-position",position:"relative"},react.createElement(fuselage.Tile,{className:"message-popup",display:"flex",padding:8,role:"menu",mbe:8,"aria-labelledby":id},react.createElement(fuselage.Box,{role:"listbox",display:"flex",overflow:"auto",fontSize:0,width:0,flexGrow:1,"aria-busy":isLoading},isLoading&&Array(5).fill(5).map((function(_,index){return react.createElement(fuselage.Skeleton,{variant:"rect",h:"100px",w:"120px",m:2,key:index})})),!isLoading&&itemsFlat.map((function(item){return react.createElement(fuselage.Box,{onClick:function onClick(){return select(item)},role:"option",className:["popup-item",item===focused&&"selected"].filter(Boolean).join(" "),id:"popup-item-".concat(item._id),key:item._id,bg:item===focused?"selected":void 0,borderColor:item===focused?"highlight":"transparent",tabIndex:item===focused?0:-1,"aria-selected":item===focused,m:2,borderWidth:"default",borderRadius:"x4"},"image"===item.type&&react.createElement("img",{src:item.value,alt:item._id}),"audio"===item.type&&react.createElement("audio",{controls:!0},react.createElement("track",{kind:"captions"}),react.createElement("source",{src:item.value}),"Your browser does not support the audio element."),"video"===item.type&&react.createElement("video",{controls:!0,className:"inline-video"},react.createElement("track",{kind:"captions"}),react.createElement("source",{src:item.value}),"Your browser does not support the video element."),"text"===item.type&&react.createElement(fuselage.Option,null,item.value),"other"===item.type&&react.createElement("code",null,item.value))})))))})),composer_ComposerBoxPopupPreview=ComposerBoxPopupPreview;function ComposerUserActionIndicator_slicedToArray(r,e){return function ComposerUserActionIndicator_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function ComposerUserActionIndicator_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function ComposerUserActionIndicator_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return ComposerUserActionIndicator_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?ComposerUserActionIndicator_arrayLikeToArray(r,a):void 0}}(r,e)||function ComposerUserActionIndicator_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ComposerUserActionIndicator_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}ComposerBoxPopupPreview.__docgenInfo={description:"",methods:[{name:"getFilter",docblock:null,modifiers:[],params:[],returns:null}],displayName:"ComposerBoxPopupPreview",props:{title:{required:!1,tsType:{name:"string"},description:""},focused:{required:!1,tsType:{name:"T"},description:""},items:{required:!0,tsType:{name:"Array",elements:[{name:"UseQueryResult",elements:[{name:"Array",elements:[{name:"T"}],raw:"T[]"}],raw:"UseQueryResult<T[]>"}],raw:"UseQueryResult<T[]>[]"},description:""},select:{required:!0,tsType:{name:"signature",type:"function",raw:"(item: T) => void",signature:{arguments:[{type:{name:"T"},name:"item"}],return:{name:"void"}}},description:""},renderItem:{required:!1,tsType:{name:"signature",type:"function",raw:"({ item }: { item: T }) => ReactElement",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ item: T }",signature:{properties:[{key:"item",value:{name:"T",required:!0}}]}},name:""}],return:{name:"ReactElement"}}},description:""},rid:{required:!0,tsType:{name:"string"},description:""},tmid:{required:!1,tsType:{name:"string"},description:""},suspended:{required:!1,tsType:{name:"boolean"},description:""}}};var ComposerUserActionIndicator=function ComposerUserActionIndicator(_ref){var rid=_ref.rid,tmid=_ref.tmid,t=(0,ui_contexts_dist.useTranslation)(),actions=(0,useReactiveValue.S)((0,react.useCallback)((function(){var roomAction=UserAction.a.get(tmid||rid)||{};return Object.entries(roomAction).map((function(_ref2){var _ref3=ComposerUserActionIndicator_slicedToArray(_ref2,2),key=_ref3[0],_users=_ref3[1],action=key.split("-")[1],users=Object.keys(_users);if(0!==users.length)return{action:action,users:users}})).filter(Boolean)}),[rid,tmid]));return react.createElement(fuselage.Box,{h:"x20",className:"rc-message-box__activity-wrapper",fontScale:"c1",color:"annotation","aria-live":"polite",display:"flex",alignItems:"center"},actions.map((function(_ref4,index){var action=_ref4.action,users=_ref4.users;return react.createElement(react.Fragment,{key:action},index>0&&", ",users.length<5?users.join(", "):"".concat(users.slice(0,4).join(", ")," ").concat(t("and")," ").concat(t("others"))," ",users.length>1?t("are_".concat(action)):t("is_".concat(action)))})))},ComposerUserActionIndicator_ComposerUserActionIndicator=ComposerUserActionIndicator;function useAutoGrow_typeof(o){return useAutoGrow_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useAutoGrow_typeof(o)}function useAutoGrow_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function useAutoGrow_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?useAutoGrow_ownKeys(Object(t),!0).forEach((function(r){useAutoGrow_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):useAutoGrow_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function useAutoGrow_defineProperty(e,r,t){return(r=function useAutoGrow_toPropertyKey(t){var i=function useAutoGrow_toPrimitive(t,r){if("object"!=useAutoGrow_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=useAutoGrow_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==useAutoGrow_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function useAutoGrow_slicedToArray(r,e){return function useAutoGrow_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function useAutoGrow_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function useAutoGrow_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return useAutoGrow_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?useAutoGrow_arrayLikeToArray(r,a):void 0}}(r,e)||function useAutoGrow_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useAutoGrow_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}ComposerUserActionIndicator.__docgenInfo={description:"",methods:[],displayName:"ComposerUserActionIndicator",props:{rid:{required:!0,tsType:{name:"string"},description:""},tmid:{required:!1,tsType:{name:"string"},description:""}}};var shadowStyleBase={position:"fixed",top:"-10000px",left:"-10000px",resize:"none",whiteSpace:"pre-wrap",wordWrap:"break-word",willChange:"contents"},slashCommand=__webpack_require__("./app/utils/client/slashCommand.ts"),useEnablePopupPreview=function useEnablePopupPreview(filter,popup){return popup&&!popup.preview&&(null==popup||!popup.triggerLength||"string"==typeof filter&&popup.triggerLength-1<filter.length)};function useComposerBoxPopupQueries_slicedToArray(r,e){return function useComposerBoxPopupQueries_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function useComposerBoxPopupQueries_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function useComposerBoxPopupQueries_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return useComposerBoxPopupQueries_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?useComposerBoxPopupQueries_arrayLikeToArray(r,a):void 0}}(r,e)||function useComposerBoxPopupQueries_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useComposerBoxPopupQueries_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function useComposerBoxPopup_slicedToArray(r,e){return function useComposerBoxPopup_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function useComposerBoxPopup_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function useComposerBoxPopup_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return useComposerBoxPopup_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?useComposerBoxPopup_arrayLikeToArray(r,a):void 0}}(r,e)||function useComposerBoxPopup_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useComposerBoxPopup_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var keys_TAB=9,keys_ENTER=13,keys_ESC=27,keys_ARROW_UP=38,keys_ARROW_DOWN=40,useComposerBoxPopup=function useComposerBoxPopup(_ref){var configurations=_ref.configurations,_useState2=useComposerBoxPopup_slicedToArray((0,react.useState)(void 0),2),popup=_useState2[0],setPopup=_useState2[1],_useState4=useComposerBoxPopup_slicedToArray((0,react.useState)(void 0),2),focused=_useState4[0],setFocused=_useState4[1],_useState6=useComposerBoxPopup_slicedToArray((0,react.useState)(""),2),filter=_useState6[0],setFilter=_useState6[1],commandsRef=(0,react.useRef)(),_ref2=function useComposerBoxPopupQueries(filter,popup){var _useState2=useComposerBoxPopupQueries_slicedToArray((0,react.useState)(0),2),counter=_useState2[0],setCounter=_useState2[1];(0,react.useEffect)((function(){setCounter(0)}),[popup,filter]);var shouldPopupPreview=useEnablePopupPreview(filter,popup),enableQuery=!popup||popup.preview&&Boolean(slashCommand.O.commands[null==filter?void 0:filter.cmd])&&slashCommand.O.commands[null==filter?void 0:filter.cmd].providesPreview||shouldPopupPreview;return{queries:(0,lib.useQueries)({queries:[(null==popup?void 0:popup.getItemsFromLocal)&&{keepPreviousData:!0,queryKey:["message-popup","local",filter,popup],queryFn:function queryFn(){return(null==popup?void 0:popup.getItemsFromLocal)&&popup.getItemsFromLocal(filter)},onSuccess:function onSuccess(args){args.length<5&&setCounter(1)},enabled:enableQuery},(null==popup?void 0:popup.getItemsFromServer)&&{keepPreviousData:!0,queryKey:["message-popup","server",filter,popup],queryFn:function queryFn(){return(null==popup?void 0:popup.getItemsFromServer)&&popup.getItemsFromServer(filter)},enabled:counter>0}].filter(Boolean)}),suspended:!enableQuery}}(filter,popup),items=_ref2.queries,suspended=_ref2.suspended,chat=(0,ChatContext.Y)(),ariaActiveDescendant=focused?"popup-item-".concat(focused._id):void 0;(0,react.useEffect)((function(){popup&&(null!=popup&&popup.preview&&suspended?setFocused(void 0):setFocused((function(focused){var _sortedItems$find,sortedItems=items.filter((function(item){return item.isSuccess})).flatMap((function(item){return item.data})).sort((function(a,b){return("sort"in a&&a.sort||0)-("sort"in b&&b.sort||0)}));return null!==(_sortedItems$find=sortedItems.find((function(item){return item._id===(null==focused?void 0:focused._id)})))&&void 0!==_sortedItems$find?_sortedItems$find:sortedItems[0]})))}),[items,popup,suspended]);var select=(0,index_module.useMutableCallback)((function(item){var _commandsRef$current;if(!popup)throw new Error("No popup is open");if(null!==(_commandsRef$current=commandsRef.current)&&void 0!==_commandsRef$current&&_commandsRef$current.select)commandsRef.current.select(item);else{var _chat$composer,_chat$composer2,_popup$matchSelectorR,_chat$composer3,_ref3,_popup$prefix,_popup$suffix,_chat$composer4,value=null==chat||null===(_chat$composer=chat.composer)||void 0===_chat$composer?void 0:_chat$composer.substring(0,null==chat||null===(_chat$composer2=chat.composer)||void 0===_chat$composer2?void 0:_chat$composer2.selection.start),selector=null!==(_popup$matchSelectorR=popup.matchSelectorRegex)&&void 0!==_popup$matchSelectorR?_popup$matchSelectorR:popup.triggerAnywhere?new RegExp("(?:^| |\n)(".concat(popup.trigger,")([^\\s]*$)")):new RegExp("(?:^)(".concat(popup.trigger,")([^\\s]*$)")),result=null==value?void 0:value.match(selector);if(!result||!value)return;null==chat||null===(_chat$composer3=chat.composer)||void 0===_chat$composer3||_chat$composer3.replaceText((null!==(_ref3=null!==(_popup$prefix=popup.prefix)&&void 0!==_popup$prefix?_popup$prefix:popup.trigger)&&void 0!==_ref3?_ref3:"")+popup.getValue(item)+(null!==(_popup$suffix=popup.suffix)&&void 0!==_popup$suffix?_popup$suffix:""),{start:value.lastIndexOf(result[1]+result[2]),end:null==chat||null===(_chat$composer4=chat.composer)||void 0===_chat$composer4?void 0:_chat$composer4.selection.start})}setPopup(void 0),setFocused(void 0)})),setConfigByInput=(0,index_module.useMutableCallback)((function(){var _chat$composer5,_chat$composer6,value=null==chat||null===(_chat$composer5=chat.composer)||void 0===_chat$composer5?void 0:_chat$composer5.substring(0,null==chat||null===(_chat$composer6=chat.composer)||void 0===_chat$composer6?void 0:_chat$composer6.selection.start);if(!value)return setPopup(void 0),void setFocused(void 0);var configuration=configurations.find((function(_ref4){var trigger=_ref4.trigger,matchSelectorRegex=_ref4.matchSelectorRegex,triggerAnywhere=_ref4.triggerAnywhere,triggerLength=_ref4.triggerLength,selector=null!=matchSelectorRegex?matchSelectorRegex:triggerAnywhere?new RegExp("(?:^| |\n)(".concat(trigger,")[^\\s]*$")):new RegExp("(?:^)(".concat(trigger,")[^\\s]*$")),result=selector.test(value);if(!triggerLength||!result)return result;var filter=value.match(selector);return filter&&triggerLength<filter[0].length}));if(setPopup(configuration),configuration||(setFocused(void 0),setFilter("")),configuration){var _configuration$matchS,_commandsRef$current$,_commandsRef$current2,_commandsRef$current3,selector=null!==(_configuration$matchS=configuration.matchSelectorRegex)&&void 0!==_configuration$matchS?_configuration$matchS:configuration.triggerAnywhere?new RegExp("(?:^| |\n)(".concat(configuration.trigger,")([^\\s]*$)")):new RegExp("(?:^)(".concat(configuration.trigger,")([^\\s]*$)")),result=value.match(selector);setFilter(null!==(_commandsRef$current$=null===(_commandsRef$current2=commandsRef.current)||void 0===_commandsRef$current2||null===(_commandsRef$current3=_commandsRef$current2.getFilter)||void 0===_commandsRef$current3?void 0:_commandsRef$current3.call(_commandsRef$current2))&&void 0!==_commandsRef$current$?_commandsRef$current$:result?result[2]:"")}return configuration})),onFocus=(0,index_module.useMutableCallback)((function(){popup||setConfigByInput()})),keyup=(0,index_module.useMutableCallback)((function(event){setConfigByInput()&&popup&&!0===popup.closeOnEsc&&event.which===keys_ESC&&(setPopup(void 0),setFocused(void 0),event.preventDefault(),event.stopImmediatePropagation())})),keydown=(0,index_module.useMutableCallback)((function(event){if(popup){if(event.which===keys_ENTER||event.which===keys_TAB){if(!focused)return;return select(focused),event.preventDefault(),event.stopImmediatePropagation(),!0}return event.which!==keys_ARROW_UP||event.shiftKey||event.ctrlKey||event.altKey||event.metaKey?event.which!==keys_ARROW_DOWN||event.shiftKey||event.ctrlKey||event.altKey||event.metaKey?void 0:(setFocused((function(focused){var list=items.filter((function(item){return item.isSuccess})).flatMap((function(item){return item.data})).sort((function(a,b){return("sort"in a&&a.sort||0)-("sort"in b&&b.sort||0)}));if(list){var focusedIndex=list.findIndex((function(item){return item===focused}));return focusedIndex<list.length-1?list[focusedIndex+1]:list[0]}})),event.preventDefault(),event.stopImmediatePropagation(),!0):(setFocused((function(focused){var list=items.filter((function(item){return item.isSuccess})).flatMap((function(item){return item.data})).sort((function(a,b){return("sort"in a&&a.sort||0)-("sort"in b&&b.sort||0)}));if(list){var focusedIndex=list.findIndex((function(item){return item===focused}));return focusedIndex>0?list[focusedIndex-1]:list[list.length-1]}})),event.preventDefault(),event.stopImmediatePropagation(),!0)}})),clearPopup=(0,index_module.useMutableCallback)((function(){popup&&(setPopup(void 0),setFocused(void 0),setFilter(""))})),callbackRef=(0,react.useCallback)((function(node){node&&(node.addEventListener("keyup",keyup),node.addEventListener("keydown",keydown),node.addEventListener("focus",onFocus))}),[keyup,keydown,onFocus]);return popup?{focused:focused,items:items,ariaActiveDescendant:ariaActiveDescendant,popup:popup,select:select,filter:filter,suspended:suspended,commandsRef:commandsRef,callbackRef:callbackRef,clearPopup:clearPopup}:{callbackRef:callbackRef,focused:void 0,items:void 0,ariaActiveDescendant:void 0,popup:void 0,select:void 0,suspended:!0,commandsRef:commandsRef,filter:void 0,clearPopup:clearPopup}};function useMessageComposerMergedRefs_typeof(o){return useMessageComposerMergedRefs_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useMessageComposerMergedRefs_typeof(o)}var useMessageComposerMergedRefs=function useMessageComposerMergedRefs(){for(var _len=arguments.length,refs=new Array(_len),_key=0;_key<_len;_key++)refs[_key]=arguments[_key];return(0,react.useCallback)((function(refValue){refs.filter(Boolean).forEach((function(ref){!function isRefCallback(x){return"function"==typeof x}(ref)?function isMutableRefObject(x){return"object"===useMessageComposerMergedRefs_typeof(x)}(ref)&&(ref.current=refValue):ref(refValue)}))}),refs)},ui_client_dist=__webpack_require__("../../packages/ui-client/dist/index.js"),isTruthy=__webpack_require__("./lib/isTruthy.ts"),useAppActionButtons=__webpack_require__("./client/hooks/useAppActionButtons.ts"),useMediaActionTitle=function useMediaActionTitle(media,isPermissionDenied,isFileUploadEnabled,isMediaEnabled,isAllowed){var t=(0,ui_contexts_dist.useTranslation)();return(0,react.useMemo)((function(){return t(isPermissionDenied?"audio"===media?"Microphone_access_not_allowed":"Camera_access_not_allowed":isFileUploadEnabled?isMediaEnabled?isAllowed?"audio"===media?"Audio_message":"Video_message":"error-not-allowed":"audio"===media?"Message_Audio_Recording_Disabled":"Message_Video_Recording_Disabled":"File_Upload_Disabled")}),[media,isPermissionDenied,isFileUploadEnabled,isMediaEnabled,isAllowed,t])},useMediaPermissions=__webpack_require__("./client/views/room/composer/messageBox/hooks/useMediaPermissions.ts");function useAudioMessageAction_slicedToArray(r,e){return function useAudioMessageAction_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function useAudioMessageAction_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function useAudioMessageAction_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return useAudioMessageAction_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?useAudioMessageAction_arrayLikeToArray(r,a):void 0}}(r,e)||function useAudioMessageAction_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useAudioMessageAction_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var useAudioMessageAction_audioRecorder=new AudioRecorder,CreateDiscussion=__webpack_require__("./client/components/CreateDiscussion/index.ts");function useFileInput_slicedToArray(r,e){return function useFileInput_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function useFileInput_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function useFileInput_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return useFileInput_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?useFileInput_arrayLikeToArray(r,a):void 0}}(r,e)||function useFileInput_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useFileInput_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function useFileUploadAction_typeof(o){return useFileUploadAction_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useFileUploadAction_typeof(o)}function useFileUploadAction_regeneratorRuntime(){useFileUploadAction_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==useFileUploadAction_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(useFileUploadAction_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function useFileUploadAction_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}var fileInputProps={type:"file",multiple:!0},useFileUploadAction=function useFileUploadAction(disabled){var t=(0,ui_contexts_dist.useTranslation)(),fileUploadEnabled=(0,ui_contexts_dist.useSetting)("FileUpload_Enabled"),fileInputRef=function useFileInput(props){var ref=(0,react.useRef)();return(0,react.useEffect)((function(){var fileInput=document.createElement("input");return fileInput.setAttribute("style","display: none;"),Object.entries(props).forEach((function(_ref){var _ref2=useFileInput_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];fileInput.setAttribute(key,value)})),document.body.appendChild(fileInput),ref.current=fileInput,function(){ref.current=void 0,fileInput.remove()}}),[props]),ref}(fileInputProps),chat=(0,ChatContext.Y)();(0,react.useEffect)((function(){var _fileInputRef$current3,resetFileInput=function resetFileInput(){null!=fileInputRef&&fileInputRef.current&&(fileInputRef.current.value="")},handleUploadChange=function(){var _ref=function useFileUploadAction_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){useFileUploadAction_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){useFileUploadAction_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(useFileUploadAction_regeneratorRuntime().mark((function _callee(){var _fileInputRef$current,_fileInputRef$current2,_yield$import,getMimeType,filesToUpload;return useFileUploadAction_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,Promise.all([__webpack_require__.e(9345),__webpack_require__.e(6039)]).then(__webpack_require__.bind(__webpack_require__,"./app/utils/lib/mimeTypes.ts"));case 2:_yield$import=_context.sent,getMimeType=_yield$import.getMimeType,filesToUpload=Array.from(null!==(_fileInputRef$current=null==fileInputRef||null===(_fileInputRef$current2=fileInputRef.current)||void 0===_fileInputRef$current2?void 0:_fileInputRef$current2.files)&&void 0!==_fileInputRef$current?_fileInputRef$current:[]).map((function(file){return Object.defineProperty(file,"type",{value:getMimeType(file.type,file.name)}),file})),null==chat||chat.flows.uploadFiles(filesToUpload,resetFileInput);case 6:case"end":return _context.stop()}}),_callee)})));return function handleUploadChange(){return _ref.apply(this,arguments)}}();return null===(_fileInputRef$current3=fileInputRef.current)||void 0===_fileInputRef$current3||_fileInputRef$current3.addEventListener("change",handleUploadChange),function(){var _fileInputRef$current4;return null==fileInputRef||null===(_fileInputRef$current4=fileInputRef.current)||void 0===_fileInputRef$current4?void 0:_fileInputRef$current4.removeEventListener("change",handleUploadChange)}}),[chat,fileInputRef]);return{id:"file-upload",content:t("Upload_file"),icon:"clip",onClick:function handleUpload(){var _fileInputRef$current5;null==fileInputRef||null===(_fileInputRef$current5=fileInputRef.current)||void 0===_fileInputRef$current5||_fileInputRef$current5.click()},disabled:!fileUploadEnabled||disabled}},MapView=__webpack_require__("./client/components/message/content/location/MapView.tsx"),getGeolocationPermission=function getGeolocationPermission(){return new Promise((function(resolve){navigator.permissions||resolve("granted"),navigator.permissions.query({name:"geolocation"}).then((function(_ref){var state=_ref.state;resolve(state)}))}))},getGeolocationPosition=function getGeolocationPosition(){return new Promise((function(resolvePos,rejectPos){navigator.geolocation.getCurrentPosition(resolvePos,rejectPos,{enableHighAccuracy:!0,maximumAge:0,timeout:1e4})}))};function ShareLocationModal_typeof(o){return ShareLocationModal_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},ShareLocationModal_typeof(o)}function ShareLocationModal_regeneratorRuntime(){ShareLocationModal_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==ShareLocationModal_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(ShareLocationModal_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function ShareLocationModal_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function ShareLocationModal_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){ShareLocationModal_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){ShareLocationModal_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var ShareLocationModal=function ShareLocationModal(_ref){var rid=_ref.rid,tmid=_ref.tmid,onClose=_ref.onClose,t=(0,ui_contexts_dist.useTranslation)(),dispatchToast=(0,ui_contexts_dist.useToastMessageDispatch)(),_useQuery=(0,lib.useQuery)(["geolocationPermission"],getGeolocationPermission),permissionData=_useQuery.data,permissionLoading=_useQuery.isLoading,positionData=(0,lib.useQuery)(["geolocationPosition",permissionData],ShareLocationModal_asyncToGenerator(ShareLocationModal_regeneratorRuntime().mark((function _callee(){return ShareLocationModal_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!permissionLoading&&"prompt"!==permissionData&&"denied"!==permissionData){_context.next=2;break}return _context.abrupt("return");case 2:return _context.abrupt("return",getGeolocationPosition());case 3:case"end":return _context.stop()}}),_callee)})))).data,queryClient=(0,lib.useQueryClient)(),sendMessage=(0,ui_contexts_dist.useEndpoint)("POST","/v1/chat.sendMessage"),onConfirmRequestLocation=function(){var _ref3=ShareLocationModal_asyncToGenerator(ShareLocationModal_regeneratorRuntime().mark((function _callee2(){var position;return ShareLocationModal_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.prev=0,_context2.next=3,getGeolocationPosition();case 3:position=_context2.sent,queryClient.setQueryData(["geolocationPosition","granted"],position),queryClient.setQueryData(["geolocationPermission"],"granted"),_context2.next=11;break;case 8:_context2.prev=8,_context2.t0=_context2.catch(0),queryClient.setQueryData(["geolocationPermission"],(function(){return getGeolocationPermission}));case 11:case"end":return _context2.stop()}}),_callee2,null,[[0,8]])})));return function onConfirmRequestLocation(){return _ref3.apply(this,arguments)}}();return permissionLoading||"prompt"===permissionData?react.createElement(GenericModal.A,{title:t("You_will_be_asked_for_permissions"),confirmText:t("Continue"),onConfirm:onConfirmRequestLocation,onClose:onClose,onCancel:onClose}):"denied"!==permissionData&&positionData?react.createElement(GenericModal.A,{title:t("Share_Location_Title"),confirmText:t("Share"),onConfirm:function onConfirm(){if(!positionData)throw new Error("Failed to load position");try{sendMessage({message:{rid:rid,tmid:tmid,location:{type:"Point",coordinates:[positionData.coords.longitude,positionData.coords.latitude]}}})}catch(error){dispatchToast({type:"error",message:error})}finally{onClose()}},onClose:onClose,onCancel:onClose},react.createElement(MapView.A,{latitude:positionData.coords.latitude,longitude:positionData.coords.longitude})):react.createElement(GenericModal.A,{title:t("Cannot_share_your_location"),confirmText:t("Ok"),onConfirm:onClose,onClose:onClose},t("The_necessary_browser_permissions_for_location_sharing_are_not_granted"))},ShareLocation_ShareLocationModal=ShareLocationModal;ShareLocationModal.__docgenInfo={description:"",methods:[],displayName:"ShareLocationModal",props:{rid:{required:!0,tsType:{name:"IRoom['_id']",raw:"IRoom['_id']"},description:""},tmid:{required:!0,tsType:{name:"IMessage['tmid']",raw:"IMessage['tmid']"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};function useVideoMessageAction_slicedToArray(r,e){return function useVideoMessageAction_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function useVideoMessageAction_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function useVideoMessageAction_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return useVideoMessageAction_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?useVideoMessageAction_arrayLikeToArray(r,a):void 0}}(r,e)||function useVideoMessageAction_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useVideoMessageAction_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),useWebDAVAccountIntegrationsQuery=__webpack_require__("./client/hooks/webdav/useWebDAVAccountIntegrationsQuery.ts");function AddWebdavAccountModal_typeof(o){return AddWebdavAccountModal_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},AddWebdavAccountModal_typeof(o)}function AddWebdavAccountModal_extends(){return AddWebdavAccountModal_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},AddWebdavAccountModal_extends.apply(null,arguments)}function AddWebdavAccountModal_regeneratorRuntime(){AddWebdavAccountModal_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==AddWebdavAccountModal_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(AddWebdavAccountModal_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function AddWebdavAccountModal_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function AddWebdavAccountModal_slicedToArray(r,e){return function AddWebdavAccountModal_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function AddWebdavAccountModal_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function AddWebdavAccountModal_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return AddWebdavAccountModal_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?AddWebdavAccountModal_arrayLikeToArray(r,a):void 0}}(r,e)||function AddWebdavAccountModal_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function AddWebdavAccountModal_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var AddWebdavAccountModal=function AddWebdavAccountModal(_ref){var onClose=_ref.onClose,onConfirm=_ref.onConfirm,handleAddWebdavAccount=(0,ui_contexts_dist.useMethod)("addWebdavAccount"),dispatchToastMessage=(0,ui_contexts_dist.useToastMessageDispatch)(),_useState2=AddWebdavAccountModal_slicedToArray((0,react.useState)(!1),2),isLoading=_useState2[0],setIsLoading=_useState2[1],_useForm=(0,index_esm.mN)(),register=_useForm.register,handleSubmit=_useForm.handleSubmit,errors=_useForm.formState.errors,t=(0,ui_contexts_dist.useTranslation)(),onSubmit=function(){var _ref2=function AddWebdavAccountModal_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){AddWebdavAccountModal_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){AddWebdavAccountModal_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(AddWebdavAccountModal_regeneratorRuntime().mark((function _callee(data){return AddWebdavAccountModal_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return setIsLoading(!0),_context.prev=1,_context.next=4,handleAddWebdavAccount(data);case 4:return _context.abrupt("return",dispatchToastMessage({type:"success",message:t("webdav-account-saved")}));case 7:return _context.prev=7,_context.t0=_context.catch(1),_context.abrupt("return",dispatchToastMessage({type:"error",message:_context.t0}));case 10:return _context.prev=10,onConfirm(),setIsLoading(!1),_context.finish(10);case 14:case"end":return _context.stop()}}),_callee,null,[[1,7,10,14]])})));return function onSubmit(_x){return _ref2.apply(this,arguments)}}();return react.createElement(fuselage.Modal,{wrapperFunction:function wrapperFunction(props){return react.createElement(fuselage.Box,AddWebdavAccountModal_extends({is:"form",onSubmit:handleSubmit(onSubmit)},props))}},react.createElement(fuselage.Modal.Header,null,react.createElement(fuselage.Modal.Title,null,t("Webdav_add_new_account")),react.createElement(fuselage.Modal.Close,{onClick:onClose})),react.createElement(fuselage.Modal.Content,null,react.createElement(fuselage.FieldGroup,null,react.createElement(fuselage.Field,null,react.createElement(fuselage.FieldLabel,null,t("Name_optional")),react.createElement(fuselage.FieldRow,null,react.createElement(fuselage.TextInput,AddWebdavAccountModal_extends({placeholder:t("Name_optional")},register("name"))))),react.createElement(fuselage.Field,null,react.createElement(fuselage.FieldLabel,null,t("Webdav_Server_URL")),react.createElement(fuselage.FieldRow,null,react.createElement(fuselage.TextInput,AddWebdavAccountModal_extends({placeholder:t("Webdav_Server_URL")},register("serverURL",{required:t("Required_field",{field:t("Webdav_Server_URL")})})))),errors.serverURL&&react.createElement(fuselage.FieldError,null,errors.serverURL.message)),react.createElement(fuselage.Field,null,react.createElement(fuselage.FieldLabel,null,t("Username")),react.createElement(fuselage.FieldRow,null,react.createElement(fuselage.TextInput,AddWebdavAccountModal_extends({placeholder:t("Username")},register("username",{required:t("Required_field",{field:t("Username")})})))),errors.username&&react.createElement(fuselage.FieldError,null,errors.username.message)),react.createElement(fuselage.Field,null,react.createElement(fuselage.FieldLabel,null,t("Password")),react.createElement(fuselage.FieldRow,null,react.createElement(fuselage.PasswordInput,AddWebdavAccountModal_extends({placeholder:t("Password")},register("password",{required:t("Required_field",{field:t("Password")})})))),errors.password&&react.createElement(fuselage.FieldError,null,errors.password.message)))),react.createElement(fuselage.Modal.Footer,null,react.createElement(fuselage.Modal.FooterControllers,null,react.createElement(fuselage.Button,{secondary:!0,onClick:onClose},t("Cancel")),react.createElement(fuselage.Button,{primary:!0,type:"submit",loading:isLoading},t("Webdav_add_new_account")))))},webdav_AddWebdavAccountModal=AddWebdavAccountModal;AddWebdavAccountModal.__docgenInfo={description:"",methods:[],displayName:"AddWebdavAccountModal",props:{onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onConfirm:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};var utils_client=__webpack_require__("./app/utils/client/index.ts"),FilterByText=__webpack_require__("./client/components/FilterByText.tsx"),useSort=__webpack_require__("./client/components/GenericTable/hooks/useSort.ts"),FileUploadModal=__webpack_require__("./client/views/room/modals/FileUploadModal/index.ts"),FilePickerBreadcrumbs=function FilePickerBreadcrumbs(_ref){var parentFolders=_ref.parentFolders,handleBreadcrumb=_ref.handleBreadcrumb,handleBack=_ref.handleBack,t=(0,ui_contexts_dist.useTranslation)();return react.createElement(fuselage.Box,{display:"flex",alignItems:"center",overflowX:"auto",mie:8},react.createElement(fuselage.IconButton,{disabled:0===parentFolders.length,title:t("Back"),"aria-label":"back",icon:"arrow-back",small:!0,onClick:handleBack}),react.createElement(fuselage.IconButton,{title:t("Root"),"aria-label":"home",icon:"home",small:!0,"data-index":-1,onClick:handleBreadcrumb}),null==parentFolders?void 0:parentFolders.map((function(parentFolder,index){return react.createElement(fuselage.Box,{display:"flex",alignItems:"center",key:index},react.createElement(fuselage.Icon,{name:"chevron-left"}),react.createElement(fuselage.Tag,{"aria-label":parentFolder,"data-index":index,onClick:handleBreadcrumb},parentFolder))})))},WebdavFilePickerModal_FilePickerBreadcrumbs=FilePickerBreadcrumbs;FilePickerBreadcrumbs.__docgenInfo={description:"",methods:[],displayName:"FilePickerBreadcrumbs",props:{parentFolders:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},handleBreadcrumb:{required:!0,tsType:{name:"signature",type:"function",raw:"(e: MouseEvent<HTMLElement>) => void",signature:{arguments:[{type:{name:"MouseEvent",elements:[{name:"HTMLElement"}],raw:"MouseEvent<HTMLElement>"},name:"e"}],return:{name:"void"}}},description:""},handleBack:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};var GenericNoResults=__webpack_require__("./client/components/GenericNoResults/index.ts"),getNodeIconType=function getNodeIconType(basename,fileType,mime){var icon="clip",type="",extension=null==basename?void 0:basename.split(".").pop();if(extension===basename&&(extension=""),!mime)throw new Error("mime is required");return"directory"===fileType?(icon="folder",type="directory"):mime.match(/application\/pdf/)?(icon="file-pdf",type="pdf"):["application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.presentation"].includes(mime)?(icon="file-document",type="document"):["application/vnd.ms-excel","application/vnd.oasis.opendocument.spreadsheet","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(mime)?(icon="file-sheets",type="sheets"):["application/vnd.ms-powerpoint","application/vnd.oasis.opendocument.presentation"].includes(mime)&&(icon="file-sheets",type="ppt"),{icon:icon,type:type,extension:extension}};function WebdavFilePickerGridItem_extends(){return WebdavFilePickerGridItem_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},WebdavFilePickerGridItem_extends.apply(null,arguments)}var WebdavFilePickerGrid_templateObject,WebdavFilePickerGridItem=function WebdavFilePickerGridItem(_ref){var props=WebdavFilePickerGridItem_extends({},(function _objectDestructuringEmpty(t){if(null==t)throw new TypeError("Cannot destructure "+t)}(_ref),_ref));return react.createElement(fuselage.Box,WebdavFilePickerGridItem_extends({borderRadius:"x4",width:"33.33%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"130px"},props))},WebdavFilePickerGrid_WebdavFilePickerGridItem=WebdavFilePickerGridItem;WebdavFilePickerGridItem.__docgenInfo={description:"",methods:[],displayName:"WebdavFilePickerGridItem"};var WebdavFilePickerGrid=function WebdavFilePickerGrid(_ref){var webdavNodes=_ref.webdavNodes,onNodeClick=_ref.onNodeClick,isLoading=_ref.isLoading,hoverStyle=(0,css_in_js_dist_index_module.css)(WebdavFilePickerGrid_templateObject||(WebdavFilePickerGrid_templateObject=function WebdavFilePickerGrid_taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n\t\t&:hover {\n\t\t\tbackground-color: ",";\n\t\t\tcursor: pointer;\n\t\t}\n\t"])),fuselage.Palette.surface["surface-neutral"]);return react.createElement(fuselage.Box,{display:"flex",flexWrap:"wrap"},isLoading&&Array(6).fill("").map((function(_,index){return react.createElement(WebdavFilePickerGrid_WebdavFilePickerGridItem,{p:4,key:index},react.createElement(fuselage.Skeleton,{variant:"rect",width:"full",height:"full"}))})),!isLoading&&webdavNodes.map((function(webdavNode,index){var icon=getNodeIconType(webdavNode.basename,webdavNode.type,webdavNode.mime).icon;return react.createElement(WebdavFilePickerGrid_WebdavFilePickerGridItem,{key:index,className:hoverStyle,onClick:function onClick(){return onNodeClick(webdavNode)}},react.createElement(fuselage.Icon,{mie:4,size:"x72",name:icon}),react.createElement(fuselage.Box,{textAlign:"center"},webdavNode.basename))})),!isLoading&&0===(null==webdavNodes?void 0:webdavNodes.length)&&react.createElement(GenericNoResults.A,null))},WebdavFilePickerGrid_WebdavFilePickerGrid=WebdavFilePickerGrid;WebdavFilePickerGrid.__docgenInfo={description:"",methods:[],displayName:"WebdavFilePickerGrid",props:{webdavNodes:{required:!0,tsType:{name:"Array",elements:[{name:"IWebdavNode"}],raw:"IWebdavNode[]"},description:""},onNodeClick:{required:!0,tsType:{name:"signature",type:"function",raw:"(file: IWebdavNode) => void",signature:{arguments:[{type:{name:"IWebdavNode"},name:"file"}],return:{name:"void"}}},description:""},isLoading:{required:!0,tsType:{name:"boolean"},description:""}}};var GenericTable=__webpack_require__("./client/components/GenericTable/index.ts"),moment=__webpack_require__("./node_modules/moment/moment.js"),moment_default=__webpack_require__.n(moment),i18n=__webpack_require__("./app/utils/lib/i18n.ts");function timeAgo_typeof(o){return timeAgo_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},timeAgo_typeof(o)}function timeAgo_regeneratorRuntime(){timeAgo_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==timeAgo_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(timeAgo_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function timeAgo_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}var dayFormat=["h:mm A","H:mm"],timeAgo=function(){var _ref=function timeAgo_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){timeAgo_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){timeAgo_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(timeAgo_regeneratorRuntime().mark((function _callee(date){var clockMode,messageTimeFormat,sameDay;return timeAgo_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return clockMode=meteor.JD.nonreactive((function(){return(0,utils_client.Tj)(meteor.fj.userId(),"clockMode",!1)})),messageTimeFormat=meteor.JD.nonreactive((function(){return settings_client.W.get("Message_TimeFormat")})),sameDay=("number"==typeof clockMode?dayFormat[clockMode-1]:void 0)||messageTimeFormat,_context.abrupt("return",moment_default()(date).calendar(null,{lastDay:"[".concat((0,i18n.t)("yesterday"),"]"),sameDay:sameDay,lastWeek:"dddd",sameElse:function sameElse(now){return Math.ceil(this.diff(now,"years",!0))<0?"MMM D YYYY":"MMM D"}}));case 4:case"end":return _context.stop()}}),_callee)})));return function timeAgo(_x){return _ref.apply(this,arguments)}}(),WebdavFilePickerTable=function WebdavFilePickerTable(_ref){var webdavNodes=_ref.webdavNodes,sortBy=_ref.sortBy,sortDirection=_ref.sortDirection,onSort=_ref.onSort,onNodeClick=_ref.onNodeClick,isLoading=_ref.isLoading,t=(0,ui_contexts_dist.useTranslation)();return react.createElement(fuselage.Box,{display:"flex",flexDirection:"column",overflowY:"hidden",height:"x256"},(isLoading||(null==webdavNodes?void 0:webdavNodes.length)>0)&&react.createElement(GenericTable.oY,null,react.createElement(GenericTable.Po,null,react.createElement(GenericTable.Fp,{width:"300px",key:"name",direction:sortDirection,active:"name"===sortBy,onClick:onSort,sort:"name"},t("Name")),react.createElement(GenericTable.Fp,{key:"size",direction:sortDirection,active:"size"===sortBy,onClick:onSort,sort:"size"},t("Size")),react.createElement(GenericTable.Fp,{key:"dataModified",direction:sortDirection,active:"dataModified"===sortBy,onClick:onSort,sort:"dataModified"},t("Data_modified"))),react.createElement(GenericTable.yT,null,isLoading&&Array(5).fill("").map((function(_,index){return react.createElement(GenericTable.aN,{key:index,cols:3})})),!isLoading&&(null==webdavNodes?void 0:webdavNodes.map((function(webdavNode,index){var icon=getNodeIconType(webdavNode.basename,webdavNode.type,webdavNode.mime).icon;return react.createElement(GenericTable.aX,{key:index,onClick:function onClick(){return onNodeClick(webdavNode)},tabIndex:index,role:"link",action:!0},react.createElement(GenericTable.Sr,{fontScale:"p2",color:"default",w:"x200",display:"flex",alignItems:"center"},react.createElement(fuselage.Icon,{mie:4,size:"x20",name:icon}),react.createElement(fuselage.Box,{withTruncatedText:!0},webdavNode.basename)),react.createElement(GenericTable.Sr,{fontScale:"p2",color:"default"},react.createElement(fuselage.Box,{withTruncatedText:!0},function getNodeFileSize(type,size){if("directory"===type)return"";var bytes=size;if(0===bytes)return"0 B";var i=Math.floor(Math.log(bytes)/Math.log(1024));return"".concat(parseFloat((bytes/Math.pow(1024,i)).toFixed(2))," ").concat(["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i])}(webdavNode.type,null==webdavNode?void 0:webdavNode.size))),react.createElement(GenericTable.Sr,{fontScale:"p2",color:"default"},react.createElement(fuselage.Box,{withTruncatedText:!0},timeAgo(new Date))))}))))),!isLoading&&0===(null==webdavNodes?void 0:webdavNodes.length)&&react.createElement(GenericNoResults.A,null))},WebdavFilePickerModal_WebdavFilePickerTable=WebdavFilePickerTable;WebdavFilePickerTable.__docgenInfo={description:"",methods:[],displayName:"WebdavFilePickerTable",props:{webdavNodes:{required:!0,tsType:{name:"Array",elements:[{name:"IWebdavNode"}],raw:"IWebdavNode[]"},description:""},sortBy:{required:!0,tsType:{name:"string"},description:""},sortDirection:{required:!0,tsType:{name:"union",raw:"'asc' | 'desc'",elements:[{name:"literal",value:"'asc'"},{name:"literal",value:"'desc'"}]},description:""},onSort:{required:!0,tsType:{name:"signature",type:"function",raw:"(sortBy: WebdavSortOptions, sortDirection?: 'asc' | 'desc') => void",signature:{arguments:[{type:{name:"union",raw:"'name' | 'size' | 'dataModified'",elements:[{name:"literal",value:"'name'"},{name:"literal",value:"'size'"},{name:"literal",value:"'dataModified'"}]},name:"sortBy"},{type:{name:"union",raw:"'asc' | 'desc'",elements:[{name:"literal",value:"'asc'"},{name:"literal",value:"'desc'"}]},name:"sortDirection"}],return:{name:"void"}}},description:""},onNodeClick:{required:!0,tsType:{name:"signature",type:"function",raw:"(webdavNode: IWebdavNode) => void",signature:{arguments:[{type:{name:"IWebdavNode"},name:"webdavNode"}],return:{name:"void"}}},description:""},isLoading:{required:!0,tsType:{name:"boolean"},description:""}}};function WebdavFilePickerModal_typeof(o){return WebdavFilePickerModal_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},WebdavFilePickerModal_typeof(o)}function WebdavFilePickerModal_regeneratorRuntime(){WebdavFilePickerModal_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==WebdavFilePickerModal_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(WebdavFilePickerModal_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function WebdavFilePickerModal_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function WebdavFilePickerModal_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){WebdavFilePickerModal_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){WebdavFilePickerModal_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}function WebdavFilePickerModal_slicedToArray(r,e){return function WebdavFilePickerModal_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function WebdavFilePickerModal_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function WebdavFilePickerModal_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return WebdavFilePickerModal_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?WebdavFilePickerModal_arrayLikeToArray(r,a):void 0}}(r,e)||function WebdavFilePickerModal_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function WebdavFilePickerModal_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var WebdavFilePickerModal=function WebdavFilePickerModal(_ref){var onUpload=_ref.onUpload,onClose=_ref.onClose,account=_ref.account,t=(0,ui_contexts_dist.useTranslation)(),setModal=(0,ui_contexts_dist.useSetModal)(),getWebdavFilePreview=(0,ui_contexts_dist.useMethod)("getWebdavFilePreview"),getWebdavFileList=(0,ui_contexts_dist.useMethod)("getWebdavFileList"),getFileFromWebdav=(0,ui_contexts_dist.useMethod)("getFileFromWebdav"),dispatchToastMessage=(0,ui_contexts_dist.useToastMessageDispatch)(),_useState2=WebdavFilePickerModal_slicedToArray((0,react.useState)("list"),2),typeView=_useState2[0],setTypeView=_useState2[1],_useSort=(0,useSort.y)("name"),sortBy=_useSort.sortBy,sortDirection=_useSort.sortDirection,setSort=_useSort.setSort,_useState4=WebdavFilePickerModal_slicedToArray((0,react.useState)("/"),2),currentFolder=_useState4[0],setCurrentFolder=_useState4[1],_useState6=WebdavFilePickerModal_slicedToArray((0,react.useState)([]),2),parentFolders=_useState6[0],setParentFolders=_useState6[1],_useState8=WebdavFilePickerModal_slicedToArray((0,react.useState)([]),2),webdavNodes=_useState8[0],setWebdavNodes=_useState8[1],_useState10=WebdavFilePickerModal_slicedToArray((0,react.useState)(""),2),filterText=_useState10[0],setFilterText=_useState10[1],debouncedFilter=(0,index_module.useDebouncedValue)(filterText,500),_useState12=WebdavFilePickerModal_slicedToArray((0,react.useState)(!1),2),isLoading=_useState12[0],setIsLoading=_useState12[1],showFilePreviews=(0,index_module.useMutableCallback)(function(){var _ref2=WebdavFilePickerModal_asyncToGenerator(WebdavFilePickerModal_regeneratorRuntime().mark((function _callee(accountId,nodes){var promises;return WebdavFilePickerModal_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(Array.isArray(nodes)&&nodes.length){_context.next=2;break}return _context.abrupt("return");case 2:return promises=nodes.map((function(node,index){if("file"===node.type)return getWebdavFilePreview(accountId,node.filename).then((function(res){if(null!=res&&res.data){var blob=new Blob([null==res?void 0:res.data],{type:"image/png"}),imgURL=URL.createObjectURL(blob);nodes[index].preview=imgURL}})).catch((function(e){return e}))})).filter(Boolean),_context.abrupt("return",Promise.all(promises).then((function(){return nodes})).catch((function(e){return e})));case 4:case"end":return _context.stop()}}),_callee)})));return function(_x,_x2){return _ref2.apply(this,arguments)}}()),handleFilterNodes=(0,react.useCallback)((function(webdavNodes){var regex=new RegExp("\\b".concat(debouncedFilter),"i"),filteredNodes=webdavNodes.filter((function(_ref3){return _ref3.basename.match(regex)}));return setWebdavNodes(filteredNodes)}),[debouncedFilter]),handleGetWebdavFileList=(0,react.useCallback)(WebdavFilePickerModal_asyncToGenerator(WebdavFilePickerModal_regeneratorRuntime().mark((function _callee2(){var result,_result,nodesWithPreviews;return WebdavFilePickerModal_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return setIsLoading(!0),_context2.prev=1,_context2.next=4,getWebdavFileList(account._id,currentFolder);case 4:result=_context2.sent,handleFilterNodes(result.data),_context2.next=12;break;case 8:_context2.prev=8,_context2.t0=_context2.catch(1),dispatchToastMessage({type:"error",message:_context2.t0}),onClose();case 12:return _context2.prev=12,setIsLoading(!1),_context2.next=16,showFilePreviews(account._id,null===(_result=result)||void 0===_result?void 0:_result.data);case 16:return nodesWithPreviews=_context2.sent,Array.isArray(nodesWithPreviews)&&nodesWithPreviews.length&&handleFilterNodes(nodesWithPreviews),_context2.finish(12);case 19:case"end":return _context2.stop()}}),_callee2,null,[[1,8,12,19]])}))),[account._id,currentFolder,dispatchToastMessage,getWebdavFileList,onClose,showFilePreviews,handleFilterNodes]),handleNodeClick=function handleNodeClick(webdavNode){return"directory"===webdavNode.type?setCurrentFolder(webdavNode.filename):handleUpload(webdavNode)},handleUpload=function(){var _ref5=WebdavFilePickerModal_asyncToGenerator(WebdavFilePickerModal_regeneratorRuntime().mark((function _callee4(webdavNode){var uploadFile,_yield$getFileFromWeb,data,blob,file;return WebdavFilePickerModal_regeneratorRuntime().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return setIsLoading(!0),uploadFile=function(){var _ref6=WebdavFilePickerModal_asyncToGenerator(WebdavFilePickerModal_regeneratorRuntime().mark((function _callee3(file,description){return WebdavFilePickerModal_regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,_context3.next=3,null==onUpload?void 0:onUpload(file,description);case 3:_context3.next=8;break;case 5:return _context3.prev=5,_context3.t0=_context3.catch(0),_context3.abrupt("return",dispatchToastMessage({type:"error",message:_context3.t0}));case 8:return _context3.prev=8,setIsLoading(!1),onClose(),_context3.finish(8);case 12:case"end":return _context3.stop()}}),_callee3,null,[[0,5,8,12]])})));return function uploadFile(_x4,_x5){return _ref6.apply(this,arguments)}}(),_context4.prev=2,_context4.next=5,getFileFromWebdav(account._id,webdavNode);case 5:_yield$getFileFromWeb=_context4.sent,data=_yield$getFileFromWeb.data,blob=new Blob([data]),file=new File([blob],webdavNode.basename,{type:webdavNode.mime}),setModal(react.createElement(FileUploadModal.A,{fileName:webdavNode.basename,onSubmit:function onSubmit(_,description){return uploadFile(file,description)},file:file,onClose:function onClose(){return setModal(null)},invalidContentType:Boolean(file.type&&!(0,utils_client.nj)(file.type))})),_context4.next=15;break;case 12:return _context4.prev=12,_context4.t0=_context4.catch(2),_context4.abrupt("return",dispatchToastMessage({type:"error",message:_context4.t0}));case 15:case"end":return _context4.stop()}}),_callee4,null,[[2,12]])})));return function handleUpload(_x3){return _ref5.apply(this,arguments)}}();(0,react.useEffect)((function(){handleGetWebdavFileList()}),[handleGetWebdavFileList]),(0,react.useEffect)((function(){setParentFolders((null==currentFolder?void 0:currentFolder.split("/").filter((function(s){return s})))||[])}),[currentFolder]);var handleSort=function handleSort(sortBy,sortDirection){setSort(sortBy);var sortedNodes=function sortWebdavNodes(data,sortBy,sortDirection){return"desc"===sortDirection?("name"===sortBy&&data.sort((function(a,b){return b.basename.localeCompare(a.basename)})),"size"===sortBy&&data.sort((function(a,b){return b.size-a.size})),"date"===sortBy&&data.sort((function(a,b){return new Date(b.lastmod).getTime()-new Date(a.lastmod).getTime()}))):("name"===sortBy&&data.sort((function(a,b){return a.basename.localeCompare(b.basename)})),"size"===sortBy&&data.sort((function(a,b){return a.size-b.size})),"date"===sortBy&&data.sort((function(a,b){return new Date(a.lastmod).getTime()-new Date(b.lastmod).getTime()}))),data}(webdavNodes,sortBy,sortDirection);return setWebdavNodes(sortedNodes)};return react.createElement(fuselage.Modal,null,react.createElement(fuselage.Modal.Header,null,react.createElement(fuselage.Modal.Title,null,t("Upload_From",{name:account.name})),react.createElement(fuselage.Modal.Close,{title:t("Close"),onClick:onClose})),react.createElement(fuselage.Modal.Content,null,react.createElement(fuselage.Box,{display:"flex",justifyContent:"space-between"},react.createElement(WebdavFilePickerModal_FilePickerBreadcrumbs,{parentFolders:parentFolders,handleBreadcrumb:function handleBreadcrumb(e){for(var index=e.currentTarget.dataset.index,parentFolders=currentFolder.split("/").filter((function(s){return s})),targetFolder="/",i=0;i<=Number(index);i++)targetFolder+=parentFolders[i],targetFolder+="/";setCurrentFolder(targetFolder)},handleBack:function handleBack(){var newCurrentFolder=currentFolder,parentFolder="/";newCurrentFolder&&"/"!==newCurrentFolder&&("/"===newCurrentFolder[newCurrentFolder.length-1]&&(newCurrentFolder=newCurrentFolder.slice(0,-1)),parentFolder=newCurrentFolder.substr(0,newCurrentFolder.lastIndexOf("/")+1)),setCurrentFolder(parentFolder)}}),react.createElement(fuselage.Box,null,"list"===typeView&&react.createElement(fuselage.IconButton,{icon:"squares",small:!0,title:t("Grid_view"),onClick:function onClick(){return setTypeView("grid")}}),"grid"===typeView&&react.createElement(fuselage.IconButton,{icon:"th-list",small:!0,title:t("List_view"),onClick:function onClick(){return setTypeView("list")}}))),react.createElement(fuselage.Box,{display:"flex",flexDirection:"column"},react.createElement(FilterByText.A,{onChange:setFilterText},"grid"===typeView&&react.createElement(fuselage.Select,{value:sortBy,onChange:function onChange(value){return handleSort(value)},options:[["name","Name"],["size","Size"],["dataModified","Data Modified"]]}))),"list"===typeView&&react.createElement(WebdavFilePickerModal_WebdavFilePickerTable,{webdavNodes:webdavNodes,sortBy:sortBy,sortDirection:sortDirection,onSort:handleSort,onNodeClick:handleNodeClick,isLoading:isLoading}),"grid"===typeView&&react.createElement(WebdavFilePickerGrid_WebdavFilePickerGrid,{webdavNodes:webdavNodes,onNodeClick:handleNodeClick,isLoading:isLoading})),react.createElement(fuselage.Modal.Footer,null))},WebdavFilePickerModal_WebdavFilePickerModal=WebdavFilePickerModal;function useWebdavActions_typeof(o){return useWebdavActions_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useWebdavActions_typeof(o)}function useWebdavActions_toConsumableArray(r){return function useWebdavActions_arrayWithoutHoles(r){if(Array.isArray(r))return useWebdavActions_arrayLikeToArray(r)}(r)||function useWebdavActions_iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||function useWebdavActions_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return useWebdavActions_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?useWebdavActions_arrayLikeToArray(r,a):void 0}}(r)||function useWebdavActions_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useWebdavActions_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function useWebdavActions_regeneratorRuntime(){useWebdavActions_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==useWebdavActions_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(useWebdavActions_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function useWebdavActions_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}WebdavFilePickerModal.__docgenInfo={description:"",methods:[],displayName:"WebdavFilePickerModal",props:{onUpload:{required:!0,tsType:{name:"signature",type:"function",raw:"(file: File, description?: string) => Promise<void>",signature:{arguments:[{type:{name:"File"},name:"file"},{type:{name:"string"},name:"description"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},account:{required:!0,tsType:{name:"IWebdavAccountIntegration"},description:""}}};var useWebdavActions=function useWebdavActions(){var enabled=(0,ui_contexts_dist.useSetting)("Webdav_Integration_Enabled",!1),_useWebDAVAccountInte=(0,useWebDAVAccountIntegrationsQuery.l)({enabled:enabled}),isSuccess=_useWebDAVAccountInte.isSuccess,data=_useWebDAVAccountInte.data,chat=(0,ChatContext.Y)(),t=(0,es.Bd)().t,setModal=(0,ui_contexts_dist.useSetModal)(),handleUpload=function(){var _ref=function useWebdavActions_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){useWebdavActions_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){useWebdavActions_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(useWebdavActions_regeneratorRuntime().mark((function _callee(file,description){return useWebdavActions_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",null==chat?void 0:chat.uploads.send(file,{description:description}));case 1:case"end":return _context.stop()}}),_callee)})));return function handleUpload(_x,_x2){return _ref.apply(this,arguments)}}();return[{id:"webdav-add",content:t("Add_Server"),icon:"cloud-plus",disabled:!isSuccess,onClick:function handleAddWebDav(){return setModal(react.createElement(webdav_AddWebdavAccountModal,{onClose:function onClose(){return setModal(null)},onConfirm:function onConfirm(){return setModal(null)}}))}}].concat(useWebdavActions_toConsumableArray(isSuccess?data.map((function(account){return{id:account._id,content:account.name,icon:"cloud-plus",onClick:function onClick(){return function handleOpenWebdav(account){return setModal(react.createElement(WebdavFilePickerModal_WebdavFilePickerModal,{account:account,onUpload:handleUpload,onClose:function onClose(){return setModal(null)}}))}(account)}}})):[]))};function MessageBoxActionsToolbar_typeof(o){return MessageBoxActionsToolbar_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},MessageBoxActionsToolbar_typeof(o)}function MessageBoxActionsToolbar_slicedToArray(r,e){return function MessageBoxActionsToolbar_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function MessageBoxActionsToolbar_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||MessageBoxActionsToolbar_unsupportedIterableToArray(r,e)||function MessageBoxActionsToolbar_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function MessageBoxActionsToolbar_toConsumableArray(r){return function MessageBoxActionsToolbar_arrayWithoutHoles(r){if(Array.isArray(r))return MessageBoxActionsToolbar_arrayLikeToArray(r)}(r)||function MessageBoxActionsToolbar_iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||MessageBoxActionsToolbar_unsupportedIterableToArray(r)||function MessageBoxActionsToolbar_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function MessageBoxActionsToolbar_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return MessageBoxActionsToolbar_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?MessageBoxActionsToolbar_arrayLikeToArray(r,a):void 0}}function MessageBoxActionsToolbar_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function MessageBoxActionsToolbar_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function MessageBoxActionsToolbar_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?MessageBoxActionsToolbar_ownKeys(Object(t),!0).forEach((function(r){MessageBoxActionsToolbar_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):MessageBoxActionsToolbar_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function MessageBoxActionsToolbar_defineProperty(e,r,t){return(r=function MessageBoxActionsToolbar_toPropertyKey(t){var i=function MessageBoxActionsToolbar_toPrimitive(t,r){if("object"!=MessageBoxActionsToolbar_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=MessageBoxActionsToolbar_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==MessageBoxActionsToolbar_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var isHidden=function isHidden(hiddenActions,action){return!action||hiddenActions.includes(action.id)},MessageBoxActionsToolbar=function MessageBoxActionsToolbar(_ref){var canSend=_ref.canSend,typing=_ref.typing,isRecording=_ref.isRecording,rid=_ref.rid,tmid=_ref.tmid,_ref$variant=_ref.variant,variant=void 0===_ref$variant?"large":_ref$variant,isMicrophoneDenied=_ref.isMicrophoneDenied,t=(0,ui_contexts_dist.useTranslation)(),chatContext=(0,ChatContext.Y)();if(!chatContext)throw new Error("useChat must be used within a ChatProvider");var room=(0,RoomContext.nq)(),audioMessageAction=function useAudioMessageAction(disabled,isMicrophoneDenied){var isFileUploadEnabled=(0,ui_contexts_dist.useSetting)("FileUpload_Enabled"),isAudioRecorderEnabled=(0,ui_contexts_dist.useSetting)("Message_AudioRecorderEnabled"),fileUploadMediaTypeBlackList=(0,ui_contexts_dist.useSetting)("FileUpload_MediaTypeBlackList"),fileUploadMediaTypeWhiteList=(0,ui_contexts_dist.useSetting)("FileUpload_MediaTypeWhiteList"),isPermissionDenied=useAudioMessageAction_slicedToArray((0,useMediaPermissions.u)("microphone"),1)[0],isAllowed=(0,react.useMemo)((function(){return Boolean(useAudioMessageAction_audioRecorder.isSupported()&&!isMicrophoneDenied&&isFileUploadEnabled&&isAudioRecorderEnabled&&!(null!=fileUploadMediaTypeBlackList&&fileUploadMediaTypeBlackList.match(/audio\/mp3|audio\/\*/i))&&(!fileUploadMediaTypeWhiteList||fileUploadMediaTypeWhiteList.match(/audio\/mp3|audio\/\*/i)))}),[fileUploadMediaTypeBlackList,fileUploadMediaTypeWhiteList,isAudioRecorderEnabled,isFileUploadEnabled,isMicrophoneDenied]),getMediaActionTitle=useMediaActionTitle("audio",isPermissionDenied,isFileUploadEnabled,isAudioRecorderEnabled,isAllowed),chat=(0,ChatContext.Y)(),stopRecording=(0,index_module.useMutableCallback)((function(){var _chat$composer;null==chat||chat.action.stop("recording"),null==chat||null===(_chat$composer=chat.composer)||void 0===_chat$composer||_chat$composer.setRecordingMode(!1)})),setMicrophoneDenied=(0,index_module.useMutableCallback)((function(isDenied){var _chat$composer2;isDenied&&stopRecording(),null==chat||null===(_chat$composer2=chat.composer)||void 0===_chat$composer2||_chat$composer2.setIsMicrophoneDenied(isDenied)}));return(0,react.useEffect)((function(){setMicrophoneDenied(isPermissionDenied)}),[setMicrophoneDenied,isPermissionDenied]),{id:"audio-message",content:getMediaActionTitle,icon:"mic",disabled:!isAllowed||Boolean(disabled),onClick:function handleRecordButtonClick(){var _chat$composer3;return null==chat||null===(_chat$composer3=chat.composer)||void 0===_chat$composer3?void 0:_chat$composer3.setRecordingMode(!0)}}}(!canSend||typing||isRecording||isMicrophoneDenied,isMicrophoneDenied),videoMessageAction=function useVideoMessageAction(disabled){var isFileUploadEnabled=(0,ui_contexts_dist.useSetting)("FileUpload_Enabled"),isVideoRecorderEnabled=(0,ui_contexts_dist.useSetting)("Message_VideoRecorderEnabled"),fileUploadMediaTypeBlackList=(0,ui_contexts_dist.useSetting)("FileUpload_MediaTypeBlackList"),fileUploadMediaTypeWhiteList=(0,ui_contexts_dist.useSetting)("FileUpload_MediaTypeWhiteList"),_useMediaPermissions2=useVideoMessageAction_slicedToArray((0,useMediaPermissions.u)("camera"),2),isPermissionDenied=_useMediaPermissions2[0],setIsPermissionDenied=_useMediaPermissions2[1],isAllowed=(0,react.useMemo)((function(){return Boolean(!isPermissionDenied&&navigator.mediaDevices&&window.MediaRecorder&&isFileUploadEnabled&&isVideoRecorderEnabled&&!(null!=fileUploadMediaTypeBlackList&&fileUploadMediaTypeBlackList.match(/video\/webm|video\/\*/i))&&(!fileUploadMediaTypeWhiteList||fileUploadMediaTypeWhiteList.match(/video\/webm|video\/\*/i))&&Boolean(instance.getSupportedMimeTypes()))}),[fileUploadMediaTypeBlackList,fileUploadMediaTypeWhiteList,isFileUploadEnabled,isPermissionDenied,isVideoRecorderEnabled]),getMediaActionTitle=useMediaActionTitle("video",isPermissionDenied,isFileUploadEnabled,isVideoRecorderEnabled,isAllowed),chat=(0,ChatContext.Y)(),handleDenyVideo=(0,index_module.useMutableCallback)((function(isDenied){var _chat$composer3;isDenied&&(null==chat||null===(_chat$composer3=chat.composer)||void 0===_chat$composer3||_chat$composer3.setRecordingVideo(!1)),setIsPermissionDenied(isDenied)}));return(0,react.useEffect)((function(){handleDenyVideo(isPermissionDenied)}),[handleDenyVideo,isPermissionDenied]),{id:"video-message",content:getMediaActionTitle,icon:"video",disabled:!isAllowed||Boolean(disabled),onClick:function handleOpenVideoMessage(){var _chat$composer,_chat$composer2;null!=chat&&null!==(_chat$composer=chat.composer)&&void 0!==_chat$composer&&_chat$composer.recordingVideo.get()||null==chat||null===(_chat$composer2=chat.composer)||void 0===_chat$composer2||_chat$composer2.setRecordingVideo(!0)}}}(!canSend||typing||isRecording),fileUploadAction=useFileUploadAction(!canSend||typing||isRecording),webdavActions=useWebdavActions(),createDiscussionAction=function useCreateDiscussionAction(room){var t=(0,ui_contexts_dist.useTranslation)(),setModal=(0,ui_contexts_dist.useSetModal)();if(!room)throw new Error("Invalid room");var discussionEnabled=(0,ui_contexts_dist.useSetting)("Discussion_enabled"),canStartDiscussion=(0,ui_contexts_dist.usePermission)("start-discussion",room._id),canSstartDiscussionOtherUser=(0,ui_contexts_dist.usePermission)("start-discussion-other-user",room._id),allowDiscussion=room&&discussionEnabled&&!(0,dist.isRoomFederated)(room)&&(canStartDiscussion||canSstartDiscussionOtherUser);return{id:"create-discussion",content:t("Discussion"),icon:"discussion",disabled:!allowDiscussion,onClick:function handleCreateDiscussion(){return setModal(react.createElement(CreateDiscussion.A,{onClose:function onClose(){return setModal(null)},defaultParentRoom:(null==room?void 0:room.prid)||(null==room?void 0:room._id)}))}}}(room),shareLocationAction=function useShareLocationAction(room,tmid){var _navigator$geolocatio;if(!room)throw new Error("Invalid room");var t=(0,ui_contexts_dist.useTranslation)(),setModal=(0,ui_contexts_dist.useSetModal)(),isMapViewEnabled=!0===(0,ui_contexts_dist.useSetting)("MapView_Enabled"),isGeolocationCurrentPositionSupported=Boolean(null===(_navigator$geolocatio=navigator.geolocation)||void 0===_navigator$geolocatio?void 0:_navigator$geolocatio.getCurrentPosition),googleMapsApiKey=(0,ui_contexts_dist.useSetting)("MapView_GMapsAPIKey"),canGetGeolocation=isMapViewEnabled&&isGeolocationCurrentPositionSupported&&googleMapsApiKey&&googleMapsApiKey.length,allowGeolocation=room&&canGetGeolocation&&!(0,dist.isRoomFederated)(room);return{id:"share-location",content:t("Location"),icon:"map-pin",onClick:function handleShareLocation(){return setModal(react.createElement(ShareLocation_ShareLocationModal,{rid:room._id,tmid:tmid,onClose:function onClose(){return setModal(null)}}))},disabled:!allowGeolocation}}(room,tmid),apps=(0,useAppActionButtons.zQ)(),hiddenActions=(0,ui_contexts_dist.useLayoutHiddenActions)().composerToolbox,allActions=MessageBoxActionsToolbar_objectSpread(MessageBoxActionsToolbar_objectSpread(MessageBoxActionsToolbar_objectSpread(MessageBoxActionsToolbar_objectSpread(MessageBoxActionsToolbar_objectSpread(MessageBoxActionsToolbar_objectSpread({},!isHidden(hiddenActions,audioMessageAction)&&{audioMessageAction:audioMessageAction}),!isHidden(hiddenActions,videoMessageAction)&&{videoMessageAction:videoMessageAction}),!isHidden(hiddenActions,fileUploadAction)&&{fileUploadAction:fileUploadAction}),!isHidden(hiddenActions,createDiscussionAction)&&{createDiscussionAction:createDiscussionAction}),!isHidden(hiddenActions,shareLocationAction)&&{shareLocationAction:shareLocationAction}),!hiddenActions.includes("webdav-add")&&{webdavActions:webdavActions}),featured=[],createNew=[],share=[];createNew.push(allActions.createDiscussionAction),"small"===variant?(featured.push(allActions.audioMessageAction),createNew.push(allActions.videoMessageAction,allActions.fileUploadAction)):featured.push(allActions.audioMessageAction,allActions.videoMessageAction,allActions.fileUploadAction),allActions.webdavActions&&createNew.push.apply(createNew,MessageBoxActionsToolbar_toConsumableArray(allActions.webdavActions)),share.push(allActions.shareLocationAction);var groups=MessageBoxActionsToolbar_objectSpread(MessageBoxActionsToolbar_objectSpread({},apps.isSuccess&&apps.data.length>0&&{Apps:apps.data}),client.messageBox.actions.get()),messageBoxActions=Object.entries(groups).map((function(_ref2){var _ref3=MessageBoxActionsToolbar_slicedToArray(_ref2,2),name=_ref3[0],items=_ref3[1].filter((function(item){return!hiddenActions.includes(item.id)})).map((function(item){return{id:item.id,icon:item.icon,content:t(item.label),onClick:function onClick(event){return item.action({rid:rid,tmid:tmid,event:event,chat:chatContext})},gap:Boolean(!item.icon)}}));return{title:t(name),items:items||[]}})),createNewFiltered=createNew.filter(isTruthy.z),shareFiltered=share.filter(isTruthy.z);return react.createElement(react.Fragment,null,react.createElement(ui_composer_dist.Y,null),featured.map((function(action){return action&&function renderAction(_ref4){var id=_ref4.id,icon=_ref4.icon,content=_ref4.content,disabled=_ref4.disabled,onClick=_ref4.onClick;if(icon)return react.createElement(ui_composer_dist.i_,{key:id,icon:icon,"data-qa-id":id,title:content,disabled:disabled,onClick:onClick})}(action)})),react.createElement(ui_client_dist.h4,{disabled:isRecording,"data-qa-id":"menu-more-actions",detached:!0,icon:"plus",sections:[{title:t("Create_new"),items:createNewFiltered},{title:t("Share"),items:shareFiltered}].concat(MessageBoxActionsToolbar_toConsumableArray(messageBoxActions)),title:t("More_actions")}))},MessageBoxActionsToolbar_MessageBoxActionsToolbar=(0,react.memo)(MessageBoxActionsToolbar);MessageBoxActionsToolbar.__docgenInfo={description:"",methods:[],displayName:"MessageBoxActionsToolbar",props:{canSend:{required:!0,tsType:{name:"boolean"},description:""},typing:{required:!0,tsType:{name:"boolean"},description:""},isMicrophoneDenied:{required:!0,tsType:{name:"boolean"},description:""},variant:{required:!1,tsType:{name:"union",raw:"'small' | 'large'",elements:[{name:"literal",value:"'small'"},{name:"literal",value:"'large'"}]},description:"",defaultValue:{value:"'large'",computed:!1}},isRecording:{required:!0,tsType:{name:"boolean"},description:""},rid:{required:!0,tsType:{name:"IRoom['_id']",raw:"IRoom['_id']"},description:""},tmid:{required:!1,tsType:{name:"IMessage['_id']",raw:"IMessage['_id']"},description:""}}};var FormattingToolbarDropdown=function FormattingToolbarDropdown(_ref){var composer=_ref.composer,items=_ref.items,disabled=_ref.disabled,t=(0,ui_contexts_dist.useTranslation)(),formattingItems=items.map((function(formatter){return{id:"formatter-".concat(formatter.label),content:t(formatter.label),icon:"icon"in formatter?formatter.icon:"link",onClick:function onClick(){return function handleFormattingAction(){if(!("link"in formatter))return isPromptButton(formatter)?formatter.prompt(composer):void composer.wrapSelection(formatter.pattern);window.open(formatter.link,"_blank","rel=noreferrer noopener")}()}}})),sections=[{title:t("Message_Formatting_Toolbox"),items:formattingItems}];return react.createElement(ui_client_dist.h4,{title:t("Message_Formatting_Toolbox"),disabled:disabled,detached:!0,icon:"meatballs",sections:sections})},MessageBoxFormattingToolbar_FormattingToolbarDropdown=FormattingToolbarDropdown;function MessageBoxFormattingToolbar_extends(){return MessageBoxFormattingToolbar_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},MessageBoxFormattingToolbar_extends.apply(null,arguments)}function MessageBoxFormattingToolbar_toConsumableArray(r){return function MessageBoxFormattingToolbar_arrayWithoutHoles(r){if(Array.isArray(r))return MessageBoxFormattingToolbar_arrayLikeToArray(r)}(r)||function MessageBoxFormattingToolbar_iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||function MessageBoxFormattingToolbar_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return MessageBoxFormattingToolbar_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?MessageBoxFormattingToolbar_arrayLikeToArray(r,a):void 0}}(r)||function MessageBoxFormattingToolbar_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function MessageBoxFormattingToolbar_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}FormattingToolbarDropdown.__docgenInfo={description:"",methods:[],displayName:"FormattingToolbarDropdown",props:{composer:{required:!0,tsType:{name:"signature",type:"object",raw:"{\n\trelease(): void;\n\treadonly text: string;\n\treadonly selection: { readonly start: number; readonly end: number };\n\tsetText(\n\t\ttext: string,\n\t\toptions?: {\n\t\t\tselection?:\n\t\t\t\t| { readonly start?: number; readonly end?: number }\n\t\t\t\t| ((previous: { readonly start: number; readonly end: number }) => { readonly start?: number; readonly end?: number });\n\t\t},\n\t): void;\n\twrapSelection(pattern: string): void;\n\tinsertText(text: string): void;\n\tinsertNewLine(): void;\n\tclear(): void;\n\tfocus(): void;\n\tblur(): void;\n\n\tgetCursorPosition(): number | undefined;\n\n\tsubstring(start: number, end?: number): string;\n\n\treplaceText(\n\t\ttext: string,\n\t\tselection: {\n\t\t\tstart: number;\n\t\t\tend: number;\n\t\t},\n\t): void;\n\n\tsetCursorToEnd(): void;\n\tsetCursorToStart(): void;\n\treplyWith(text: string): Promise<void>;\n\tquoteMessage(message: IMessage): Promise<void>;\n\tdismissQuotedMessage(mid: IMessage['_id']): Promise<void>;\n\tdismissAllQuotedMessages(): Promise<void>;\n\treadonly quotedMessages: Subscribable<IMessage[]>;\n\n\tsetEditingMode(editing: boolean): void;\n\treadonly editing: Subscribable<boolean>;\n\n\tsetRecordingMode(recording: boolean): void;\n\treadonly recording: Subscribable<boolean>;\n\n\tsetRecordingVideo(recording: boolean): void;\n\treadonly recordingVideo: Subscribable<boolean>;\n\n\tsetIsMicrophoneDenied(isMicrophoneDenied: boolean): void;\n\treadonly isMicrophoneDenied: Subscribable<boolean>;\n\n\treadonly formatters: Subscribable<FormattingButton[]>;\n}",signature:{properties:[{key:"release",value:{name:"void",required:!0}},{key:"text",value:{name:"string",required:!0}},{key:"selection",value:{name:"signature",type:"object",raw:"{ readonly start: number; readonly end: number }",signature:{properties:[{key:"start",value:{name:"number",required:!0}},{key:"end",value:{name:"number",required:!0}}]},required:!0}},{key:"setText",value:{name:"void",required:!0}},{key:"wrapSelection",value:{name:"void",required:!0}},{key:"insertText",value:{name:"void",required:!0}},{key:"insertNewLine",value:{name:"void",required:!0}},{key:"clear",value:{name:"void",required:!0}},{key:"focus",value:{name:"void",required:!0}},{key:"blur",value:{name:"void",required:!0}},{key:"getCursorPosition",value:{name:"union",raw:"number | undefined",elements:[{name:"number"},{name:"undefined"}],required:!0}},{key:"substring",value:{name:"string",required:!0}},{key:"replaceText",value:{name:"void",required:!0}},{key:"setCursorToEnd",value:{name:"void",required:!0}},{key:"setCursorToStart",value:{name:"void",required:!0}},{key:"replyWith",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quoteMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissQuotedMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissAllQuotedMessages",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quotedMessages",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setEditingMode",value:{name:"void",required:!0}},{key:"editing",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingMode",value:{name:"void",required:!0}},{key:"recording",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingVideo",value:{name:"void",required:!0}},{key:"recordingVideo",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setIsMicrophoneDenied",value:{name:"void",required:!0}},{key:"isMicrophoneDenied",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"formatters",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}}]}},description:""},items:{required:!0,tsType:{name:"Array",elements:[{name:"union",raw:"PatternButton | PromptButton | TextButton",elements:[{name:"intersection",raw:"{\n\ticon: IconName;\n\tpattern: string;\n\t// text?: () => string | undefined;\n\tcommand?: string;\n\tlink?: string;\n} & FormattingButtonDefault",elements:[{name:"signature",type:"object",raw:"{\n\ticon: IconName;\n\tpattern: string;\n\t// text?: () => string | undefined;\n\tcommand?: string;\n\tlink?: string;\n}",signature:{properties:[{key:"icon",value:{name:"IconName",required:!0}},{key:"pattern",value:{name:"string",required:!0}},{key:"command",value:{name:"string",required:!1}},{key:"link",value:{name:"string",required:!1}}]}},{name:"signature",type:"object",raw:"{ label: TranslationKey; condition?: () => boolean }",signature:{properties:[{key:"label",value:{name:"TranslationKey",required:!0}},{key:"condition",value:{name:"signature",type:"function",raw:"() => boolean",signature:{arguments:[],return:{name:"boolean"}},required:!1}}]}}]},{name:"intersection",raw:"{\n\tprompt: (composer: ComposerAPI) => void;\n\ticon: IconName;\n} & FormattingButtonDefault",elements:[{name:"signature",type:"object",raw:"{\n\tprompt: (composer: ComposerAPI) => void;\n\ticon: IconName;\n}",signature:{properties:[{key:"prompt",value:{name:"signature",type:"function",raw:"(composer: ComposerAPI) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{\n\trelease(): void;\n\treadonly text: string;\n\treadonly selection: { readonly start: number; readonly end: number };\n\tsetText(\n\t\ttext: string,\n\t\toptions?: {\n\t\t\tselection?:\n\t\t\t\t| { readonly start?: number; readonly end?: number }\n\t\t\t\t| ((previous: { readonly start: number; readonly end: number }) => { readonly start?: number; readonly end?: number });\n\t\t},\n\t): void;\n\twrapSelection(pattern: string): void;\n\tinsertText(text: string): void;\n\tinsertNewLine(): void;\n\tclear(): void;\n\tfocus(): void;\n\tblur(): void;\n\n\tgetCursorPosition(): number | undefined;\n\n\tsubstring(start: number, end?: number): string;\n\n\treplaceText(\n\t\ttext: string,\n\t\tselection: {\n\t\t\tstart: number;\n\t\t\tend: number;\n\t\t},\n\t): void;\n\n\tsetCursorToEnd(): void;\n\tsetCursorToStart(): void;\n\treplyWith(text: string): Promise<void>;\n\tquoteMessage(message: IMessage): Promise<void>;\n\tdismissQuotedMessage(mid: IMessage['_id']): Promise<void>;\n\tdismissAllQuotedMessages(): Promise<void>;\n\treadonly quotedMessages: Subscribable<IMessage[]>;\n\n\tsetEditingMode(editing: boolean): void;\n\treadonly editing: Subscribable<boolean>;\n\n\tsetRecordingMode(recording: boolean): void;\n\treadonly recording: Subscribable<boolean>;\n\n\tsetRecordingVideo(recording: boolean): void;\n\treadonly recordingVideo: Subscribable<boolean>;\n\n\tsetIsMicrophoneDenied(isMicrophoneDenied: boolean): void;\n\treadonly isMicrophoneDenied: Subscribable<boolean>;\n\n\treadonly formatters: Subscribable<FormattingButton[]>;\n}",signature:{properties:[{key:"release",value:{name:"void",required:!0}},{key:"text",value:{name:"string",required:!0}},{key:"selection",value:{name:"signature",type:"object",raw:"{ readonly start: number; readonly end: number }",signature:{properties:[{key:"start",value:{name:"number",required:!0}},{key:"end",value:{name:"number",required:!0}}]},required:!0}},{key:"setText",value:{name:"void",required:!0}},{key:"wrapSelection",value:{name:"void",required:!0}},{key:"insertText",value:{name:"void",required:!0}},{key:"insertNewLine",value:{name:"void",required:!0}},{key:"clear",value:{name:"void",required:!0}},{key:"focus",value:{name:"void",required:!0}},{key:"blur",value:{name:"void",required:!0}},{key:"getCursorPosition",value:{name:"union",raw:"number | undefined",elements:[{name:"number"},{name:"undefined"}],required:!0}},{key:"substring",value:{name:"string",required:!0}},{key:"replaceText",value:{name:"void",required:!0}},{key:"setCursorToEnd",value:{name:"void",required:!0}},{key:"setCursorToStart",value:{name:"void",required:!0}},{key:"replyWith",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quoteMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissQuotedMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissAllQuotedMessages",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quotedMessages",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setEditingMode",value:{name:"void",required:!0}},{key:"editing",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingMode",value:{name:"void",required:!0}},{key:"recording",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingVideo",value:{name:"void",required:!0}},{key:"recordingVideo",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setIsMicrophoneDenied",value:{name:"void",required:!0}},{key:"isMicrophoneDenied",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"formatters",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}}]}},name:"composer"}],return:{name:"void"}},required:!0}},{key:"icon",value:{name:"IconName",required:!0}}]}},{name:"signature",type:"object",raw:"{ label: TranslationKey; condition?: () => boolean }",signature:{properties:[{key:"label",value:{name:"TranslationKey",required:!0}},{key:"condition",value:{name:"signature",type:"function",raw:"() => boolean",signature:{arguments:[],return:{name:"boolean"}},required:!1}}]}}]},{name:"intersection",raw:"{\n\ttext: () => string | undefined;\n\tlink: string;\n} & FormattingButtonDefault",elements:[{name:"signature",type:"object",raw:"{\n\ttext: () => string | undefined;\n\tlink: string;\n}",signature:{properties:[{key:"text",value:{name:"signature",type:"function",raw:"() => string | undefined",signature:{arguments:[],return:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]}},required:!0}},{key:"link",value:{name:"string",required:!0}}]}},{name:"signature",type:"object",raw:"{ label: TranslationKey; condition?: () => boolean }",signature:{properties:[{key:"label",value:{name:"TranslationKey",required:!0}},{key:"condition",value:{name:"signature",type:"function",raw:"() => boolean",signature:{arguments:[],return:{name:"boolean"}},required:!1}}]}}]}]}],raw:"FormattingButton[]"},description:""},disabled:{required:!0,tsType:{name:"boolean"},description:""}}};var MessageBoxFormattingToolbar=function MessageBoxFormattingToolbar(_ref){var items=_ref.items,_ref$variant=_ref.variant,variant=void 0===_ref$variant?"large":_ref$variant,composer=_ref.composer,disabled=_ref.disabled,t=(0,ui_contexts_dist.useTranslation)();if("small"===variant){var collapsedItems=MessageBoxFormattingToolbar_toConsumableArray(items),featuredFormatter=collapsedItems.splice(0,1)[0];return react.createElement(react.Fragment,null,"icon"in featuredFormatter&&react.createElement(ui_composer_dist.i_,{onClick:function onClick(){return isPromptButton(featuredFormatter)?featuredFormatter.prompt(composer):composer.wrapSelection(featuredFormatter.pattern)},icon:featuredFormatter.icon,title:t(featuredFormatter.label),disabled:disabled}),react.createElement(MessageBoxFormattingToolbar_FormattingToolbarDropdown,{composer:composer,items:collapsedItems,disabled:disabled}))}return react.createElement(react.Fragment,null,items.map((function(formatter){return"icon"in formatter?react.createElement(ui_composer_dist.i_,{disabled:disabled,icon:formatter.icon,key:formatter.label,"data-id":formatter.label,title:t(formatter.label),onClick:function onClick(){isPromptButton(formatter)?formatter.prompt(composer):"link"in formatter?window.open(formatter.link,"_blank","rel=noreferrer noopener"):composer.wrapSelection(formatter.pattern)}}):react.createElement("span",MessageBoxFormattingToolbar_extends({},disabled&&{style:{pointerEvents:"none"}},{className:"rc-message-box__toolbar-formatting-item",title:formatter.label,key:formatter.label}),react.createElement("a",{href:formatter.link,target:"_blank",rel:"noopener noreferrer",className:"rc-message-box__toolbar-formatting-link"},formatter.text()))})))},MessageBoxFormattingToolbar_MessageBoxFormattingToolbar=(0,react.memo)(MessageBoxFormattingToolbar);MessageBoxFormattingToolbar.__docgenInfo={description:"",methods:[],displayName:"MessageBoxFormattingToolbar",props:{composer:{required:!0,tsType:{name:"signature",type:"object",raw:"{\n\trelease(): void;\n\treadonly text: string;\n\treadonly selection: { readonly start: number; readonly end: number };\n\tsetText(\n\t\ttext: string,\n\t\toptions?: {\n\t\t\tselection?:\n\t\t\t\t| { readonly start?: number; readonly end?: number }\n\t\t\t\t| ((previous: { readonly start: number; readonly end: number }) => { readonly start?: number; readonly end?: number });\n\t\t},\n\t): void;\n\twrapSelection(pattern: string): void;\n\tinsertText(text: string): void;\n\tinsertNewLine(): void;\n\tclear(): void;\n\tfocus(): void;\n\tblur(): void;\n\n\tgetCursorPosition(): number | undefined;\n\n\tsubstring(start: number, end?: number): string;\n\n\treplaceText(\n\t\ttext: string,\n\t\tselection: {\n\t\t\tstart: number;\n\t\t\tend: number;\n\t\t},\n\t): void;\n\n\tsetCursorToEnd(): void;\n\tsetCursorToStart(): void;\n\treplyWith(text: string): Promise<void>;\n\tquoteMessage(message: IMessage): Promise<void>;\n\tdismissQuotedMessage(mid: IMessage['_id']): Promise<void>;\n\tdismissAllQuotedMessages(): Promise<void>;\n\treadonly quotedMessages: Subscribable<IMessage[]>;\n\n\tsetEditingMode(editing: boolean): void;\n\treadonly editing: Subscribable<boolean>;\n\n\tsetRecordingMode(recording: boolean): void;\n\treadonly recording: Subscribable<boolean>;\n\n\tsetRecordingVideo(recording: boolean): void;\n\treadonly recordingVideo: Subscribable<boolean>;\n\n\tsetIsMicrophoneDenied(isMicrophoneDenied: boolean): void;\n\treadonly isMicrophoneDenied: Subscribable<boolean>;\n\n\treadonly formatters: Subscribable<FormattingButton[]>;\n}",signature:{properties:[{key:"release",value:{name:"void",required:!0}},{key:"text",value:{name:"string",required:!0}},{key:"selection",value:{name:"signature",type:"object",raw:"{ readonly start: number; readonly end: number }",signature:{properties:[{key:"start",value:{name:"number",required:!0}},{key:"end",value:{name:"number",required:!0}}]},required:!0}},{key:"setText",value:{name:"void",required:!0}},{key:"wrapSelection",value:{name:"void",required:!0}},{key:"insertText",value:{name:"void",required:!0}},{key:"insertNewLine",value:{name:"void",required:!0}},{key:"clear",value:{name:"void",required:!0}},{key:"focus",value:{name:"void",required:!0}},{key:"blur",value:{name:"void",required:!0}},{key:"getCursorPosition",value:{name:"union",raw:"number | undefined",elements:[{name:"number"},{name:"undefined"}],required:!0}},{key:"substring",value:{name:"string",required:!0}},{key:"replaceText",value:{name:"void",required:!0}},{key:"setCursorToEnd",value:{name:"void",required:!0}},{key:"setCursorToStart",value:{name:"void",required:!0}},{key:"replyWith",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quoteMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissQuotedMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissAllQuotedMessages",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quotedMessages",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setEditingMode",value:{name:"void",required:!0}},{key:"editing",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingMode",value:{name:"void",required:!0}},{key:"recording",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingVideo",value:{name:"void",required:!0}},{key:"recordingVideo",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setIsMicrophoneDenied",value:{name:"void",required:!0}},{key:"isMicrophoneDenied",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"formatters",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}}]}},description:""},variant:{required:!1,tsType:{name:"union",raw:"'small' | 'large'",elements:[{name:"literal",value:"'small'"},{name:"literal",value:"'large'"}]},description:"",defaultValue:{value:"'large'",computed:!1}},items:{required:!0,tsType:{name:"Array",elements:[{name:"union",raw:"PatternButton | PromptButton | TextButton",elements:[{name:"intersection",raw:"{\n\ticon: IconName;\n\tpattern: string;\n\t// text?: () => string | undefined;\n\tcommand?: string;\n\tlink?: string;\n} & FormattingButtonDefault",elements:[{name:"signature",type:"object",raw:"{\n\ticon: IconName;\n\tpattern: string;\n\t// text?: () => string | undefined;\n\tcommand?: string;\n\tlink?: string;\n}",signature:{properties:[{key:"icon",value:{name:"IconName",required:!0}},{key:"pattern",value:{name:"string",required:!0}},{key:"command",value:{name:"string",required:!1}},{key:"link",value:{name:"string",required:!1}}]}},{name:"signature",type:"object",raw:"{ label: TranslationKey; condition?: () => boolean }",signature:{properties:[{key:"label",value:{name:"TranslationKey",required:!0}},{key:"condition",value:{name:"signature",type:"function",raw:"() => boolean",signature:{arguments:[],return:{name:"boolean"}},required:!1}}]}}]},{name:"intersection",raw:"{\n\tprompt: (composer: ComposerAPI) => void;\n\ticon: IconName;\n} & FormattingButtonDefault",elements:[{name:"signature",type:"object",raw:"{\n\tprompt: (composer: ComposerAPI) => void;\n\ticon: IconName;\n}",signature:{properties:[{key:"prompt",value:{name:"signature",type:"function",raw:"(composer: ComposerAPI) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{\n\trelease(): void;\n\treadonly text: string;\n\treadonly selection: { readonly start: number; readonly end: number };\n\tsetText(\n\t\ttext: string,\n\t\toptions?: {\n\t\t\tselection?:\n\t\t\t\t| { readonly start?: number; readonly end?: number }\n\t\t\t\t| ((previous: { readonly start: number; readonly end: number }) => { readonly start?: number; readonly end?: number });\n\t\t},\n\t): void;\n\twrapSelection(pattern: string): void;\n\tinsertText(text: string): void;\n\tinsertNewLine(): void;\n\tclear(): void;\n\tfocus(): void;\n\tblur(): void;\n\n\tgetCursorPosition(): number | undefined;\n\n\tsubstring(start: number, end?: number): string;\n\n\treplaceText(\n\t\ttext: string,\n\t\tselection: {\n\t\t\tstart: number;\n\t\t\tend: number;\n\t\t},\n\t): void;\n\n\tsetCursorToEnd(): void;\n\tsetCursorToStart(): void;\n\treplyWith(text: string): Promise<void>;\n\tquoteMessage(message: IMessage): Promise<void>;\n\tdismissQuotedMessage(mid: IMessage['_id']): Promise<void>;\n\tdismissAllQuotedMessages(): Promise<void>;\n\treadonly quotedMessages: Subscribable<IMessage[]>;\n\n\tsetEditingMode(editing: boolean): void;\n\treadonly editing: Subscribable<boolean>;\n\n\tsetRecordingMode(recording: boolean): void;\n\treadonly recording: Subscribable<boolean>;\n\n\tsetRecordingVideo(recording: boolean): void;\n\treadonly recordingVideo: Subscribable<boolean>;\n\n\tsetIsMicrophoneDenied(isMicrophoneDenied: boolean): void;\n\treadonly isMicrophoneDenied: Subscribable<boolean>;\n\n\treadonly formatters: Subscribable<FormattingButton[]>;\n}",signature:{properties:[{key:"release",value:{name:"void",required:!0}},{key:"text",value:{name:"string",required:!0}},{key:"selection",value:{name:"signature",type:"object",raw:"{ readonly start: number; readonly end: number }",signature:{properties:[{key:"start",value:{name:"number",required:!0}},{key:"end",value:{name:"number",required:!0}}]},required:!0}},{key:"setText",value:{name:"void",required:!0}},{key:"wrapSelection",value:{name:"void",required:!0}},{key:"insertText",value:{name:"void",required:!0}},{key:"insertNewLine",value:{name:"void",required:!0}},{key:"clear",value:{name:"void",required:!0}},{key:"focus",value:{name:"void",required:!0}},{key:"blur",value:{name:"void",required:!0}},{key:"getCursorPosition",value:{name:"union",raw:"number | undefined",elements:[{name:"number"},{name:"undefined"}],required:!0}},{key:"substring",value:{name:"string",required:!0}},{key:"replaceText",value:{name:"void",required:!0}},{key:"setCursorToEnd",value:{name:"void",required:!0}},{key:"setCursorToStart",value:{name:"void",required:!0}},{key:"replyWith",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quoteMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissQuotedMessage",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"dismissAllQuotedMessages",value:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>",required:!0}},{key:"quotedMessages",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setEditingMode",value:{name:"void",required:!0}},{key:"editing",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingMode",value:{name:"void",required:!0}},{key:"recording",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setRecordingVideo",value:{name:"void",required:!0}},{key:"recordingVideo",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"setIsMicrophoneDenied",value:{name:"void",required:!0}},{key:"isMicrophoneDenied",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}},{key:"formatters",value:{name:"signature",type:"object",raw:"{\n\tget(): T;\n\tsubscribe(callback: () => void): () => void;\n}",signature:{properties:[{key:"get",value:{name:"Array",elements:[{name:"IMessage"}],raw:"IMessage[]",required:!0}},{key:"subscribe",value:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}},required:!0}}]},required:!0}}]}},name:"composer"}],return:{name:"void"}},required:!0}},{key:"icon",value:{name:"IconName",required:!0}}]}},{name:"signature",type:"object",raw:"{ label: TranslationKey; condition?: () => boolean }",signature:{properties:[{key:"label",value:{name:"TranslationKey",required:!0}},{key:"condition",value:{name:"signature",type:"function",raw:"() => boolean",signature:{arguments:[],return:{name:"boolean"}},required:!1}}]}}]},{name:"intersection",raw:"{\n\ttext: () => string | undefined;\n\tlink: string;\n} & FormattingButtonDefault",elements:[{name:"signature",type:"object",raw:"{\n\ttext: () => string | undefined;\n\tlink: string;\n}",signature:{properties:[{key:"text",value:{name:"signature",type:"function",raw:"() => string | undefined",signature:{arguments:[],return:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]}},required:!0}},{key:"link",value:{name:"string",required:!0}}]}},{name:"signature",type:"object",raw:"{ label: TranslationKey; condition?: () => boolean }",signature:{properties:[{key:"label",value:{name:"TranslationKey",required:!0}},{key:"condition",value:{name:"signature",type:"function",raw:"() => boolean",signature:{arguments:[],return:{name:"boolean"}},required:!1}}]}}]}]}],raw:"FormattingButton[]"},description:""},disabled:{required:!0,tsType:{name:"boolean"},description:""}}};var E2ERoomState=__webpack_require__("./app/e2e/client/E2ERoomState.ts"),useE2EERoomState=__webpack_require__("./client/views/room/hooks/useE2EERoomState.ts"),MessageBoxHint=function MessageBoxHint(_ref){var isEditing=_ref.isEditing,e2eEnabled=_ref.e2eEnabled,unencryptedMessagesAllowed=_ref.unencryptedMessagesAllowed,isMobile=_ref.isMobile,room=(0,RoomContext.nq)(),isReadOnly=(null==room?void 0:room.ro)||!1,t=(0,es.Bd)().t,e2eRoomState=(0,useE2EERoomState.N)(room._id),isUnencryptedHintVisible=e2eEnabled&&unencryptedMessagesAllowed&&e2eRoomState&&e2eRoomState!==E2ERoomState.h.READY&&e2eRoomState!==E2ERoomState.h.DISABLED&&!isEditing&&!isReadOnly;if(!isEditing&&!isUnencryptedHintVisible&&!isReadOnly)return null;return react.createElement(ui_composer_dist.XO,{icon:isEditing?"pencil":void 0,helperText:isEditing&&!isMobile?react.createElement(es.x6,{i18nKey:"Editing_message_hint"}):void 0},function renderHintText(){return isEditing?t("Editing_message"):isReadOnly?t("This_room_is_read_only"):isUnencryptedHintVisible?t("E2EE_Composer_Unencrypted_Message"):""}())},messageBox_MessageBoxHint=(0,react.memo)(MessageBoxHint);MessageBoxHint.__docgenInfo={description:"",methods:[],displayName:"MessageBoxHint",props:{isEditing:{required:!1,tsType:{name:"boolean"},description:""},e2eEnabled:{required:!1,tsType:{name:"boolean"},description:""},unencryptedMessagesAllowed:{required:!1,tsType:{name:"boolean"},description:""},isMobile:{required:!1,tsType:{name:"boolean"},description:""}}};var MessageBoxReplies_templateObject,getUserDisplayName=__webpack_require__("./lib/getUserDisplayName.ts"),QuoteAttachment=__webpack_require__("./client/components/message/content/attachments/QuoteAttachment.tsx"),AttachmentProvider=__webpack_require__("./client/providers/AttachmentProvider.tsx");function MessageBoxReplies_typeof(o){return MessageBoxReplies_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},MessageBoxReplies_typeof(o)}function MessageBoxReplies_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function MessageBoxReplies_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?MessageBoxReplies_ownKeys(Object(t),!0).forEach((function(r){MessageBoxReplies_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):MessageBoxReplies_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function MessageBoxReplies_defineProperty(e,r,t){return(r=function MessageBoxReplies_toPropertyKey(t){var i=function MessageBoxReplies_toPrimitive(t,r){if("object"!=MessageBoxReplies_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=MessageBoxReplies_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==MessageBoxReplies_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var MessageBoxReplies=function MessageBoxReplies(){var _chat$composer,chat=(0,ChatContext.Y)();if(null==chat||null===(_chat$composer=chat.composer)||void 0===_chat$composer||!_chat$composer.quotedMessages)throw new Error("Chat context not found");var replies=(0,use_subscription.useSubscription)({getCurrentValue:chat.composer.quotedMessages.get,subscribe:chat.composer.quotedMessages.subscribe}),useRealName=Boolean((0,ui_contexts_dist.useSetting)("UI_Use_Real_Name"));if(!replies.length)return null;var closeWrapperStyle=(0,css_in_js_dist_index_module.css)(MessageBoxReplies_templateObject||(MessageBoxReplies_templateObject=function MessageBoxReplies_taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n\t\tposition: absolute;\n\t\tright: 0.5rem;\n\t\ttop: 0.75rem;\n\t"])));return react.createElement(fuselage.Box,{mbe:8,position:"relative",overflowY:"auto",maxHeight:"x256"},replies.map((function(reply,key){var _reply$attachments;return react.createElement(fuselage.Margins,{block:4,key:key},react.createElement(fuselage.Box,{display:"flex",position:"relative"},react.createElement(AttachmentProvider.A,null,react.createElement(QuoteAttachment.k,{attachment:{text:reply.msg,md:reply.md,author_name:reply.alias||(0,getUserDisplayName.N)(reply.u.name,reply.u.username,useRealName),author_icon:"/avatar/".concat(reply.u.username),ts:reply.ts,attachments:null==reply||null===(_reply$attachments=reply.attachments)||void 0===_reply$attachments?void 0:_reply$attachments.map((function(obj){return MessageBoxReplies_objectSpread(MessageBoxReplies_objectSpread({},obj),{},{collapsed:!0})})),collapsed:!0}})),react.createElement(fuselage.Box,{className:closeWrapperStyle,"data-mid":reply._id,onClick:function onClick(){var _chat$composer2;null===(_chat$composer2=chat.composer)||void 0===_chat$composer2||_chat$composer2.dismissQuotedMessage(reply._id)}},react.createElement(fuselage.IconButton,{mini:!0,icon:"cross"}))))})))},messageBox_MessageBoxReplies=(0,react.memo)(MessageBoxReplies);MessageBoxReplies.__docgenInfo={description:"",methods:[],displayName:"MessageBoxReplies"};var useUserDisplayName=__webpack_require__("./client/hooks/useUserDisplayName.ts"),useMessageBoxPlaceholder=function useMessageBoxPlaceholder(placeholder,room){if(!room)throw new Error("In order to get the placeholder a `room` must be provided");var roomName=function useRoomName(room){var subscription=(0,ui_contexts_dist.useUserSubscription)(room._id),username=(0,useUserDisplayName.y)({name:null==subscription?void 0:subscription.fname,username:null==subscription?void 0:subscription.name});return(0,dist.isDirectMessageRoom)(room)?username:room.fname||room.name}(room);return(0,dist.isDirectMessageRoom)(room)?"".concat(placeholder," @").concat(roomName):"".concat(placeholder," #").concat(roomName)};function MessageBox_typeof(o){return MessageBox_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},MessageBox_typeof(o)}function MessageBox_regeneratorRuntime(){MessageBox_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==MessageBox_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(MessageBox_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function MessageBox_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function MessageBox_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){MessageBox_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){MessageBox_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}function MessageBox_toConsumableArray(r){return function MessageBox_arrayWithoutHoles(r){if(Array.isArray(r))return MessageBox_arrayLikeToArray(r)}(r)||function MessageBox_iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||MessageBox_unsupportedIterableToArray(r)||function MessageBox_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function MessageBox_slicedToArray(r,e){return function MessageBox_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function MessageBox_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||MessageBox_unsupportedIterableToArray(r,e)||function MessageBox_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function MessageBox_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return MessageBox_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?MessageBox_arrayLikeToArray(r,a):void 0}}function MessageBox_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var reducer=function reducer(_,event){var target=event.target;return Boolean(target.value.trim())},emptySubscribe=function emptySubscribe(){return function(){}},getEmptyFalse=function getEmptyFalse(){return!1},a=[],getEmptyArray=function getEmptyArray(){return a},MessageBox=function MessageBox(_ref){var _chat$composer$editin,_chat$composer5,_chat$composer$editin2,_chat$composer6,_chat$composer$record,_chat$composer7,_chat$composer$record2,_chat$composer8,_chat$composer$isMicr,_chat$composer9,_chat$composer$isMicr2,_chat$composer10,_chat$composer$record3,_chat$composer11,_chat$composer$record4,_chat$composer12,_chat$composer$format,_chat$composer13,_chat$composer$format2,_chat$composer14,_chat$composer15,tmid=_ref.tmid,onSend=_ref.onSend,onJoin=_ref.onJoin,onNavigateToNextMessage=_ref.onNavigateToNextMessage,onNavigateToPreviousMessage=_ref.onNavigateToPreviousMessage,onUploadFiles=_ref.onUploadFiles,onEscape=_ref.onEscape,onTyping=_ref.onTyping,tshow=_ref.tshow,previewUrls=_ref.previewUrls,chat=(0,ChatContext.Y)(),room=(0,RoomContext.nq)(),t=(0,ui_contexts_dist.useTranslation)(),e2eEnabled=(0,ui_contexts_dist.useSetting)("E2E_Enable"),unencryptedMessagesAllowed=(0,ui_contexts_dist.useSetting)("E2E_Allow_Unencrypted_Messages"),isSlashCommandAllowed=!e2eEnabled||!room.encrypted||unencryptedMessagesAllowed,composerPlaceholder=useMessageBoxPlaceholder(t("Message"),room),_useReducer2=MessageBox_slicedToArray((0,react.useReducer)(reducer,!1),2),typing=_useReducer2[0],setTyping=_useReducer2[1],isMobile=(0,ui_contexts_dist.useLayout)().isMobile,sendOnEnterBehavior=(0,ui_contexts_dist.useUserPreference)("sendOnEnter")||isMobile,sendOnEnter=null==sendOnEnterBehavior||"normal"===sendOnEnterBehavior||"desktop"===sendOnEnterBehavior&&!isMobile;if(!chat)throw new Error("Chat context not found");var textareaRef=(0,react.useRef)(null),messageComposerRef=(0,react.useRef)(null),shadowRef=(0,react.useRef)(null),storageID="messagebox_".concat(room._id).concat(tmid?"-".concat(tmid):""),callbackRef=(0,react.useCallback)((function(node){null===node||chat.composer||chat.setComposerAPI(function createComposerAPI(input,storageID){var _Accounts$storageLoca,triggerEvent=function triggerEvent(input,evt){var event=new Event(evt,{bubbles:!0}),tracker=input._valueTracker;tracker&&tracker.setValue((new Date).toString()),input.dispatchEvent(event)},emitter=new dist_index_module.v,_quotedMessages=[],persist=(0,highOrderFunctions.z)({wait:300})((function(){input.value?meteor.bX.storageLocation.setItem(storageID,input.value):meteor.bX.storageLocation.removeItem(storageID)})),notifyQuotedMessagesUpdate=function notifyQuotedMessagesUpdate(){emitter.emit("quotedMessagesUpdate")};input.addEventListener("input",persist);var actions,setText=function setText(text){var _ref=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},selection=_ref.selection,skipFocus=_ref.skipFocus;!skipFocus&&focus();var _document$execCommand,_document,_selection$start,_selection$end,selectionStart=input.selectionStart,selectionEnd=input.selectionEnd,textAreaTxt=input.value;"function"==typeof selection&&(selection=selection({start:selectionStart,end:selectionEnd})),selection&&(null!==(_document$execCommand=(_document=document).execCommand)&&void 0!==_document$execCommand&&_document$execCommand.call(_document,"insertText",!1,text)||(input.value=textAreaTxt.substring(0,selectionStart)+text+textAreaTxt.substring(selectionStart),!skipFocus&&focus()),input.setSelectionRange(null!==(_selection$start=selection.start)&&void 0!==_selection$start?_selection$start:0,null!==(_selection$end=selection.end)&&void 0!==_selection$end?_selection$end:text.length)),selection||(input.value=text),triggerEvent(input,"input"),triggerEvent(input,"change"),!skipFocus&&focus()},insertText=function insertText(text){setText(text,{selection:function selection(_ref2){var start=_ref2.start,end=_ref2.end;return{start:start+text.length,end:end+text.length}}})},focus=function focus(){input.focus()},replyWith=function(){var _ref3=createComposerAPI_asyncToGenerator(createComposerAPI_regeneratorRuntime().mark((function _callee(text){return createComposerAPI_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:input&&(input.value=text,input.focus());case 1:case"end":return _context.stop()}}),_callee)})));return function replyWith(_x){return _ref3.apply(this,arguments)}}(),quoteMessage=function(){var _ref4=createComposerAPI_asyncToGenerator(createComposerAPI_regeneratorRuntime().mark((function _callee2(message){return createComposerAPI_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:_quotedMessages=[].concat(_toConsumableArray(_quotedMessages.filter((function(_message){return _message._id!==message._id}))),[message]),notifyQuotedMessagesUpdate(),input.focus();case 3:case"end":return _context2.stop()}}),_callee2)})));return function quoteMessage(_x2){return _ref4.apply(this,arguments)}}(),dismissQuotedMessage=function(){var _ref5=createComposerAPI_asyncToGenerator(createComposerAPI_regeneratorRuntime().mark((function _callee3(mid){return createComposerAPI_regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:_quotedMessages=_quotedMessages.filter((function(message){return message._id!==mid})),notifyQuotedMessagesUpdate();case 2:case"end":return _context3.stop()}}),_callee3)})));return function dismissQuotedMessage(_x3){return _ref5.apply(this,arguments)}}(),dismissAllQuotedMessages=function(){var _ref6=createComposerAPI_asyncToGenerator(createComposerAPI_regeneratorRuntime().mark((function _callee4(){return createComposerAPI_regeneratorRuntime().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:_quotedMessages=[],notifyQuotedMessagesUpdate();case 2:case"end":return _context4.stop()}}),_callee4)})));return function dismissAllQuotedMessages(){return _ref6.apply(this,arguments)}}(),quotedMessages={get:function get(){return _quotedMessages},subscribe:function subscribe(callback){return emitter.on("quotedMessagesUpdate",callback)}},_ref8=_slicedToArray(function(){var editing=!1;return[{get:function get(){return editing},subscribe:function subscribe(callback){return emitter.on("editing",callback)}},function(value){editing=value,emitter.emit("editing")}]}(),2),editing=_ref8[0],setEditing=_ref8[1],_ref10=_slicedToArray(function(){var recording=!1;return[{get:function get(){return recording},subscribe:function subscribe(callback){return emitter.on("recording",callback)}},function(value){recording=value,emitter.emit("recording")}]}(),2),recording=_ref10[0],setRecordingMode=_ref10[1],_ref12=_slicedToArray(function(){var recordingVideo=!1;return[{get:function get(){return recordingVideo},subscribe:function subscribe(callback){return emitter.on("recordingVideo",callback)}},function(value){recordingVideo=value,emitter.emit("recordingVideo")}]}(),2),recordingVideo=_ref12[0],setRecordingVideo=_ref12[1],_ref13=function(){var isMicrophoneDenied=!1;return[{get:function get(){return isMicrophoneDenied},subscribe:function subscribe(callback){return emitter.on("mircophoneDenied",callback)}},function(value){isMicrophoneDenied=value,emitter.emit("mircophoneDenied")}]}(),_ref14=_slicedToArray(_ref13,2),isMicrophoneDenied=_ref14[0],setIsMicrophoneDenied=_ref14[1],_ref16=_slicedToArray((actions=[],[{get:function get(){return actions},subscribe:function subscribe(callback){return emitter.on("formatting",callback)}},Tracker.autorun((function(){actions=formattingButtons.filter((function(_ref17){var condition=_ref17.condition;return!condition||condition()})),emitter.emit("formatting")}))]),2),formatters=_ref16[0],stopFormatterTracker=_ref16[1];return setText(null!==(_Accounts$storageLoca=meteor.bX.storageLocation.getItem(storageID))&&void 0!==_Accounts$storageLoca?_Accounts$storageLoca:"",{skipFocus:!0}),{replaceText:function replaceText(text,selection){var _selection$start2,_selection$end2,_document$execCommand4,_document4,selectionStart=input.selectionStart,selectionEnd=input.selectionEnd;input.setSelectionRange(null!==(_selection$start2=selection.start)&&void 0!==_selection$start2?_selection$start2:0,null!==(_selection$end2=selection.end)&&void 0!==_selection$end2?_selection$end2:text.length);var textAreaTxt=input.value;null!==(_document$execCommand4=(_document4=document).execCommand)&&void 0!==_document$execCommand4&&_document$execCommand4.call(_document4,"insertText",!1,text)||(input.value=textAreaTxt.substring(0,selection.start)+text+textAreaTxt.substring(selection.end)),input.selectionStart=selectionStart+text.length,input.selectionEnd=selectionStart+text.length,selectionStart!==selectionEnd&&(input.selectionStart=selectionStart),triggerEvent(input,"input"),triggerEvent(input,"change"),focus()},insertNewLine:function insertNewLine(){return insertText("\n")},blur:function blur(){return input.blur()},substring:function substring(start,end){return input.value.substring(start,end)},getCursorPosition:function getCursorPosition(){return input.selectionStart},setCursorToEnd:function setCursorToEnd(){input.selectionEnd=input.value.length,input.selectionStart=input.selectionEnd,focus()},setCursorToStart:function setCursorToStart(){input.selectionStart=0,input.selectionEnd=input.selectionStart,focus()},release:function release(){input.removeEventListener("input",persist),stopFormatterTracker.stop()},wrapSelection:function wrapSelection(pattern){var _document$execCommand3,_document3,_input$selectionEnd=input.selectionEnd,selectionEnd=void 0===_input$selectionEnd?input.value.length:_input$selectionEnd,_input$selectionStart=input.selectionStart,selectionStart=void 0===_input$selectionStart?0:_input$selectionStart,initText=input.value.slice(0,selectionStart),selectedText=input.value.slice(selectionStart,selectionEnd),finalText=input.value.slice(selectionEnd,input.value.length);focus();var startPattern=pattern.slice(0,pattern.indexOf("{{text}}"));if(_toConsumableArray(startPattern).reverse().every((function(char,index){return input.value.slice(selectionStart-index-1,1)===char}))){var _document$execCommand2,_document2,endPattern=pattern.slice(pattern.indexOf("{{text}}")+8);if(_toConsumableArray(endPattern).every((function(char,index){return input.value.slice(selectionEnd+index,1)===char})))return insertText(selectedText),input.selectionStart=selectionStart-startPattern.length,input.selectionEnd=selectionEnd+endPattern.length,null!==(_document$execCommand2=(_document2=document).execCommand)&&void 0!==_document$execCommand2&&_document$execCommand2.call(_document2,"insertText",!1,selectedText)||(input.value=initText.slice(0,initText.length-startPattern.length)+selectedText+finalText.slice(endPattern.length)),input.selectionStart=selectionStart-startPattern.length,input.selectionEnd=input.selectionStart+selectedText.length,triggerEvent(input,"input"),triggerEvent(input,"change"),void focus()}null!==(_document$execCommand3=(_document3=document).execCommand)&&void 0!==_document$execCommand3&&_document$execCommand3.call(_document3,"insertText",!1,pattern.replace("{{text}}",selectedText))||(input.value=initText+pattern.replace("{{text}}",selectedText)+finalText),input.selectionStart=selectionStart+pattern.indexOf("{{text}}"),input.selectionEnd=input.selectionStart+selectedText.length,triggerEvent(input,"input"),triggerEvent(input,"change"),focus()},get text(){return input.value},get selection(){return{start:input.selectionStart,end:input.selectionEnd}},editing:editing,setEditingMode:function setEditingMode(editing){setEditing(editing)},recording:recording,setRecordingMode:setRecordingMode,recordingVideo:recordingVideo,setRecordingVideo:setRecordingVideo,insertText:insertText,setText:setText,clear:function clear(){setText("")},focus:focus,replyWith:replyWith,quoteMessage:quoteMessage,dismissQuotedMessage:dismissQuotedMessage,dismissAllQuotedMessages:dismissAllQuotedMessages,quotedMessages:quotedMessages,formatters:formatters,isMicrophoneDenied:isMicrophoneDenied,setIsMicrophoneDenied:setIsMicrophoneDenied}}(node,storageID))}),[chat,storageID]),autofocusRef=function useMessageBoxAutoFocus(enabled){var ref=(0,react.useRef)();return(0,react.useEffect)((function(){var handleKeyDown=function handleKeyDown(e){var node=ref.current,target=e.target;target&&target!==node&&(e.keyCode>45&&e.keyCode<91||8===e.keyCode)&&(/input|textarea|select/i.test(target.tagName)||!0!==e.ctrlKey&&!0!==e.metaKey&&(null==node||node.focus()))};return document.addEventListener("keydown",handleKeyDown),function(){document.removeEventListener("keydown",handleKeyDown)}}),[]),(0,react.useCallback)((function(node){node&&(ref.current=node,enabled&&ref.current&&ref.current.focus())}),[enabled,ref])}(!isMobile),useEmojis=(0,ui_contexts_dist.useUserPreference)("useEmojis"),handleOpenEmojiPicker=(0,index_module.useMutableCallback)((function(e){if(e.stopPropagation(),e.preventDefault(),useEmojis){var ref=messageComposerRef.current;chat.emojiPicker.open(ref,(function(emoji){var _chat$composer;return null===(_chat$composer=chat.composer)||void 0===_chat$composer?void 0:_chat$composer.insertText(" :".concat(emoji,": "))}))}})),handleSendMessage=(0,index_module.useMutableCallback)((function(){var _chat$composer$text,_chat$composer2,_chat$composer3,text=null!==(_chat$composer$text=null===(_chat$composer2=chat.composer)||void 0===_chat$composer2?void 0:_chat$composer2.text)&&void 0!==_chat$composer$text?_chat$composer$text:"";null===(_chat$composer3=chat.composer)||void 0===_chat$composer3||_chat$composer3.clear(),clearPopup(),null==onSend||onSend({value:text,tshow:tshow,previewUrls:previewUrls,isSlashCommandAllowed:isSlashCommandAllowed})})),closeEditing=function closeEditing(event){chat.currentEditing&&(event.preventDefault(),event.stopPropagation(),chat.currentEditing.reset().then((function(reset){var _chat$currentEditing;reset||(null===(_chat$currentEditing=chat.currentEditing)||void 0===_chat$currentEditing||_chat$currentEditing.cancel())})))},handler=(0,index_module.useMutableCallback)((function(event){var keyCode=event.which,input=event.target;if(keyCode===keyCodes_CARRIAGE_RETURN||keyCode===keyCodes_NEW_LINE){var _chat$composer4,withModifier=event.shiftKey||event.ctrlKey||event.altKey||event.metaKey,isSending=sendOnEnter&&!withModifier||!sendOnEnter&&withModifier;return event.preventDefault(),isSending?(handleSendMessage(),!1):(null===(_chat$composer4=chat.composer)||void 0===_chat$composer4||_chat$composer4.insertNewLine(),!1)}if(!(chat.composer&&function handleFormattingShortcut(event,formattingButtons,composer){var isMacOS=-1!==navigator.platform.indexOf("Mac");if(!(isMacOS&&event.metaKey||!isMacOS&&event.ctrlKey))return!1;var key=event.key.toLowerCase(),formatter=formattingButtons.find((function(formatter){return"command"in formatter&&formatter.command===key}));return!(!formatter||!("pattern"in formatter)||(composer.wrapSelection(formatter.pattern),0))}(event,MessageBox_toConsumableArray(formattingButtons),chat.composer)||event.shiftKey||event.ctrlKey||event.metaKey)){switch(event.key){case"Escape":return closeEditing(event),void(input.value.trim()||null==onEscape||onEscape());case"ArrowUp":return void(0===input.selectionEnd&&(event.preventDefault(),event.stopPropagation(),null==onNavigateToPreviousMessage||onNavigateToPreviousMessage(),event.altKey&&input.setSelectionRange(0,0)));case"ArrowDown":input.selectionEnd===input.value.length&&(event.preventDefault(),event.stopPropagation(),null==onNavigateToNextMessage||onNavigateToNextMessage(),event.altKey&&input.setSelectionRange(input.value.length,input.value.length))}null==onTyping||onTyping()}})),isEditing=(0,use_subscription.useSubscription)({getCurrentValue:null!==(_chat$composer$editin=null===(_chat$composer5=chat.composer)||void 0===_chat$composer5?void 0:_chat$composer5.editing.get)&&void 0!==_chat$composer$editin?_chat$composer$editin:getEmptyFalse,subscribe:null!==(_chat$composer$editin2=null===(_chat$composer6=chat.composer)||void 0===_chat$composer6?void 0:_chat$composer6.editing.subscribe)&&void 0!==_chat$composer$editin2?_chat$composer$editin2:emptySubscribe}),isRecordingAudio=(0,use_subscription.useSubscription)({getCurrentValue:null!==(_chat$composer$record=null===(_chat$composer7=chat.composer)||void 0===_chat$composer7?void 0:_chat$composer7.recording.get)&&void 0!==_chat$composer$record?_chat$composer$record:getEmptyFalse,subscribe:null!==(_chat$composer$record2=null===(_chat$composer8=chat.composer)||void 0===_chat$composer8?void 0:_chat$composer8.recording.subscribe)&&void 0!==_chat$composer$record2?_chat$composer$record2:emptySubscribe}),isMicrophoneDenied=(0,use_subscription.useSubscription)({getCurrentValue:null!==(_chat$composer$isMicr=null===(_chat$composer9=chat.composer)||void 0===_chat$composer9?void 0:_chat$composer9.isMicrophoneDenied.get)&&void 0!==_chat$composer$isMicr?_chat$composer$isMicr:getEmptyFalse,subscribe:null!==(_chat$composer$isMicr2=null===(_chat$composer10=chat.composer)||void 0===_chat$composer10?void 0:_chat$composer10.isMicrophoneDenied.subscribe)&&void 0!==_chat$composer$isMicr2?_chat$composer$isMicr2:emptySubscribe}),isRecordingVideo=(0,use_subscription.useSubscription)({getCurrentValue:null!==(_chat$composer$record3=null===(_chat$composer11=chat.composer)||void 0===_chat$composer11?void 0:_chat$composer11.recordingVideo.get)&&void 0!==_chat$composer$record3?_chat$composer$record3:getEmptyFalse,subscribe:null!==(_chat$composer$record4=null===(_chat$composer12=chat.composer)||void 0===_chat$composer12?void 0:_chat$composer12.recordingVideo.subscribe)&&void 0!==_chat$composer$record4?_chat$composer$record4:emptySubscribe}),formatters=(0,use_subscription.useSubscription)({getCurrentValue:null!==(_chat$composer$format=null===(_chat$composer13=chat.composer)||void 0===_chat$composer13?void 0:_chat$composer13.formatters.get)&&void 0!==_chat$composer$format?_chat$composer$format:getEmptyArray,subscribe:null!==(_chat$composer$format2=null===(_chat$composer14=chat.composer)||void 0===_chat$composer14?void 0:_chat$composer14.formatters.subscribe)&&void 0!==_chat$composer$format2?_chat$composer$format2:emptySubscribe}),isRecording=isRecordingAudio||isRecordingVideo,_useAutoGrow=function useAutoGrow(ref,shadowRef,hideTextArea){var _useState2=useAutoGrow_slicedToArray((0,react.useState)((function(){return ref.current&&window.getComputedStyle(ref.current)})),2),style=_useState2[0],setStyle=_useState2[1];(0,react.useEffect)((function(){ref.current&&setStyle((function(){return ref.current&&window.getComputedStyle(ref.current)}))}),[ref]),(0,react.useEffect)((function(){var textarea=ref.current;if(textarea){var updateTextareaSize=function updateTextareaSize(){var value=textarea.value,shadow=shadowRef.current;shadow&&(shadow.innerHTML=value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>"))};return updateTextareaSize(),textarea.addEventListener("input",updateTextareaSize),function(){textarea.removeEventListener("input",updateTextareaSize)}}}),[ref,shadowRef]);var shadowContentSize=(0,index_module.useContentBoxSize)(shadowRef),composerContentSize=(0,index_module.useContentBoxSize)(ref);return{textAreaStyle:useAutoGrow_objectSpread(useAutoGrow_objectSpread({},hideTextArea&&{visibility:"hidden"}),{},{whiteSpace:"pre-wrap",wordWrap:"break-word",overflowWrap:"break-word",willChange:"contents",wordBreak:"normal",overflowY:shadowContentSize.blockSize>parseInt((null==style?void 0:style.maxHeight)||"0")?"scroll":"hidden"},shadowContentSize.blockSize&&{height:"".concat(shadowContentSize.blockSize,"px")}),shadowStyle:useAutoGrow_objectSpread(useAutoGrow_objectSpread({},shadowStyleBase),{},{font:null==style?void 0:style.font,width:composerContentSize.inlineSize,minHeight:null==style?void 0:style.lineHeight,lineHeight:null==style?void 0:style.lineHeight})}}(textareaRef,shadowRef,isRecordingAudio),textAreaStyle=_useAutoGrow.textAreaStyle,shadowStyle=_useAutoGrow.shadowStyle,canSend=(0,useReactiveValue.S)((0,react.useCallback)((function(){return roomCoordinator.roomCoordinator.verifyCanSendMessage(room._id)}),[room._id])),sizes=(0,index_module.useContentBoxSize)(textareaRef),format=(0,useFormatDateAndTime.J)(),joinMutation=(0,lib.useMutation)(MessageBox_asyncToGenerator(MessageBox_regeneratorRuntime().mark((function _callee(){return MessageBox_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",null==onJoin?void 0:onJoin());case 1:case"end":return _context.stop()}}),_callee)})))),handlePaste=(0,index_module.useMutableCallback)((function(event){var clipboardData=event.clipboardData;if(clipboardData){var items=Array.from(clipboardData.items);if(!items.some((function(_ref3){var kind=_ref3.kind,type=_ref3.type;return"string"===kind&&"text/plain"===type}))){var files=items.filter((function(item){return"file"===item.kind&&-1!==item.type.indexOf("image/")})).map((function(item){var fileItem=item.getAsFile();if(fileItem){var imageExtension=fileItem?function getImageExtensionFromMime(mime){return extensionsMap[mime]}(fileItem.type):void 0,extension=imageExtension?".".concat(imageExtension):"";return Object.defineProperty(fileItem,"name",{writable:!0,value:"Clipboard - ".concat(format(new Date)).concat(extension)}),fileItem}})).filter((function(file){return!!file}));files.length&&(event.preventDefault(),null==onUploadFiles||onUploadFiles(files))}}})),composerPopupConfig=(0,ComposerPopupContext.SI)(),_useComposerBoxPopup=useComposerBoxPopup({configurations:composerPopupConfig}),popup=_useComposerBoxPopup.popup,focused=_useComposerBoxPopup.focused,items=_useComposerBoxPopup.items,ariaActiveDescendant=_useComposerBoxPopup.ariaActiveDescendant,suspended=_useComposerBoxPopup.suspended,select=_useComposerBoxPopup.select,commandsRef=_useComposerBoxPopup.commandsRef,c=_useComposerBoxPopup.callbackRef,filter=_useComposerBoxPopup.filter,clearPopup=_useComposerBoxPopup.clearPopup,keyDownHandlerCallbackRef=(0,react.useCallback)((function(node){null!==node&&node.addEventListener("keydown",(function(e){handler(e)}))}),[handler]),mergedRefs=useMessageComposerMergedRefs(c,textareaRef,callbackRef,autofocusRef,keyDownHandlerCallbackRef),shouldPopupPreview=useEnablePopupPreview(filter,popup);return react.createElement(react.Fragment,null,(null===(_chat$composer15=chat.composer)||void 0===_chat$composer15?void 0:_chat$composer15.quotedMessages)&&react.createElement(messageBox_MessageBoxReplies,null),shouldPopupPreview&&popup&&react.createElement(composer_ComposerBoxPopup,{select:select,items:items,focused:focused,title:popup.title,renderItem:popup.renderItem}),(null==popup?void 0:popup.preview)&&react.createElement(composer_ComposerBoxPopupPreview,{select:select,items:items,focused:focused,renderItem:popup.renderItem,ref:commandsRef,rid:room._id,tmid:tmid,suspended:suspended}),react.createElement(messageBox_MessageBoxHint,{isEditing:isEditing,e2eEnabled:e2eEnabled,unencryptedMessagesAllowed:unencryptedMessagesAllowed,isMobile:isMobile}),isRecordingVideo&&react.createElement(VideoMessageRecorder_VideoMessageRecorder,{reference:messageComposerRef,rid:room._id,tmid:tmid}),react.createElement(ui_composer_dist.oc,{ref:messageComposerRef,variant:isEditing?"editing":void 0},isRecordingAudio&&react.createElement(AudioMessageRecorder_AudioMessageRecorder,{rid:room._id,isMicrophoneDenied:isMicrophoneDenied}),react.createElement(ui_composer_dist.ul,{ref:mergedRefs,"aria-label":composerPlaceholder,name:"msg",disabled:isRecording||!canSend,onChange:setTyping,style:textAreaStyle,placeholder:composerPlaceholder,onPaste:handlePaste,"aria-activedescendant":ariaActiveDescendant}),react.createElement("div",{ref:shadowRef,style:shadowStyle}),react.createElement(ui_composer_dist.FS,null,react.createElement(ui_composer_dist.kp,{"aria-label":t("Message_composer_toolbox_primary_actions")},react.createElement(ui_composer_dist.i_,{icon:"emoji",disabled:!useEmojis||isRecording||!canSend,onClick:handleOpenEmojiPicker,title:t("Emoji")}),react.createElement(ui_composer_dist.Y,null),chat.composer&&formatters.length>0&&react.createElement(MessageBoxFormattingToolbar_MessageBoxFormattingToolbar,{composer:chat.composer,variant:sizes.inlineSize<480?"small":"large",items:formatters,disabled:isRecording||!canSend}),react.createElement(MessageBoxActionsToolbar_MessageBoxActionsToolbar,{canSend:canSend,typing:typing,isMicrophoneDenied:isMicrophoneDenied,rid:room._id,tmid:tmid,isRecording:isRecording,variant:sizes.inlineSize<480?"small":"large"})),react.createElement(ui_composer_dist.fZ,null,!canSend&&react.createElement(ui_composer_dist.WF,{primary:!0,onClick:onJoin,loading:joinMutation.isLoading},t("Join")),canSend&&react.createElement(react.Fragment,null,isEditing&&react.createElement(ui_composer_dist.WF,{onClick:closeEditing},t("Cancel")),react.createElement(ui_composer_dist.i_,{"aria-label":t("Send"),icon:"send",disabled:!canSend||!typing&&!isEditing,onClick:handleSendMessage,secondary:typing||isEditing,info:typing||isEditing}))))),react.createElement(ComposerUserActionIndicator_ComposerUserActionIndicator,{rid:room._id,tmid:tmid}))},messageBox_MessageBox=(0,react.memo)(MessageBox);function ComposerMessage_typeof(o){return ComposerMessage_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},ComposerMessage_typeof(o)}MessageBox.__docgenInfo={description:"",methods:[],displayName:"MessageBox",props:{tmid:{required:!1,tsType:{name:"IMessage['_id']",raw:"IMessage['_id']"},description:""},onSend:{required:!1,tsType:{name:"signature",type:"function",raw:"(params: { value: string; tshow?: boolean; previewUrls?: string[]; isSlashCommandAllowed?: boolean }) => Promise<void>",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ value: string; tshow?: boolean; previewUrls?: string[]; isSlashCommandAllowed?: boolean }",signature:{properties:[{key:"value",value:{name:"string",required:!0}},{key:"tshow",value:{name:"boolean",required:!1}},{key:"previewUrls",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!1}},{key:"isSlashCommandAllowed",value:{name:"boolean",required:!1}}]}},name:"params"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""},onJoin:{required:!1,tsType:{name:"signature",type:"function",raw:"() => Promise<void>",signature:{arguments:[],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""},onResize:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onTyping:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onEscape:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNavigateToPreviousMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNavigateToNextMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onUploadFiles:{required:!1,tsType:{name:"signature",type:"function",raw:"(files: readonly File[]) => void",signature:{arguments:[{type:{name:"unknown"},name:"files"}],return:{name:"void"}}},description:""},tshow:{required:!1,tsType:{name:"IMessage['tshow']",raw:"IMessage['tshow']"},description:""},previewUrls:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},subscription:{required:!1,tsType:{name:"ISubscription"},description:""},showFormattingTips:{required:!0,tsType:{name:"boolean"},description:""},isEmbedded:{required:!1,tsType:{name:"boolean"},description:""}}};var _excluded=["tmid","onSend"];function ComposerMessage_extends(){return ComposerMessage_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ComposerMessage_extends.apply(null,arguments)}function ComposerMessage_regeneratorRuntime(){ComposerMessage_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==ComposerMessage_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(ComposerMessage_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function ComposerMessage_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function ComposerMessage_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){ComposerMessage_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){ComposerMessage_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var ComposerMessage=function ComposerMessage(_ref){var _chat$composer2,tmid=_ref.tmid,_onSend=_ref.onSend,props=function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_ref,_excluded),chat=(0,ChatContext.Y)(),room=(0,RoomContext.nq)(),dispatchToastMessage=(0,ui_contexts_dist.useToastMessageDispatch)(),composerProps=(0,react.useMemo)((function(){return{onJoin:(_onJoin=ComposerMessage_asyncToGenerator(ComposerMessage_regeneratorRuntime().mark((function _callee(){var _chat$data;return ComposerMessage_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,null==chat||null===(_chat$data=chat.data)||void 0===_chat$data?void 0:_chat$data.joinRoom();case 3:_context.next=9;break;case 5:throw _context.prev=5,_context.t0=_context.catch(0),dispatchToastMessage({type:"error",message:_context.t0}),_context.t0;case 9:case"end":return _context.stop()}}),_callee,null,[[0,5]])}))),function onJoin(){return _onJoin.apply(this,arguments)}),onSend:(_onSend2=ComposerMessage_asyncToGenerator(ComposerMessage_regeneratorRuntime().mark((function _callee2(_ref2){var text,tshow,previewUrls,isSlashCommandAllowed;return ComposerMessage_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return text=_ref2.value,tshow=_ref2.tshow,previewUrls=_ref2.previewUrls,isSlashCommandAllowed=_ref2.isSlashCommandAllowed,_context2.prev=1,_context2.next=4,null==chat?void 0:chat.action.stop("typing");case 4:return _context2.next=6,null==chat?void 0:chat.flows.sendMessage({text:text,tshow:tshow,previewUrls:previewUrls,isSlashCommandAllowed:isSlashCommandAllowed});case 6:_context2.sent&&(null==_onSend||_onSend()),_context2.next=13;break;case 10:_context2.prev=10,_context2.t0=_context2.catch(1),dispatchToastMessage({type:"error",message:_context2.t0});case 13:case"end":return _context2.stop()}}),_callee2,null,[[1,10]])}))),function onSend(_x){return _onSend2.apply(this,arguments)}),onTyping:(_onTyping=ComposerMessage_asyncToGenerator(ComposerMessage_regeneratorRuntime().mark((function _callee3(){var _chat$composer;return ComposerMessage_regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(""!==(null==chat||null===(_chat$composer=chat.composer)||void 0===_chat$composer||null===(_chat$composer=_chat$composer.text)||void 0===_chat$composer?void 0:_chat$composer.trim())){_context3.next=4;break}return _context3.next=3,null==chat?void 0:chat.action.stop("typing");case 3:return _context3.abrupt("return");case 4:return _context3.next=6,null==chat?void 0:chat.action.start("typing");case 6:case"end":return _context3.stop()}}),_callee3)}))),function onTyping(){return _onTyping.apply(this,arguments)}),onNavigateToPreviousMessage:function onNavigateToPreviousMessage(){return null==chat?void 0:chat.messageEditing.toPreviousMessage()},onNavigateToNextMessage:function onNavigateToNextMessage(){return null==chat?void 0:chat.messageEditing.toNextMessage()},onUploadFiles:function onUploadFiles(files){return null==chat?void 0:chat.flows.uploadFiles(files)}};var _onTyping,_onSend2,_onJoin}),[null==chat?void 0:chat.data,null==chat?void 0:chat.flows,null==chat?void 0:chat.action,null==chat||null===(_chat$composer2=chat.composer)||void 0===_chat$composer2?void 0:_chat$composer2.text,null==chat?void 0:chat.messageEditing,dispatchToastMessage,_onSend]);return(0,useReactiveValue.S)((0,react.useCallback)((function(){var _LegacyRoomManager$ge,_LegacyRoomManager$ge2;return null!==(_LegacyRoomManager$ge=null===(_LegacyRoomManager$ge2=client.LegacyRoomManager.getOpenedRoomByRid(room._id))||void 0===_LegacyRoomManager$ge2?void 0:_LegacyRoomManager$ge2.streamActive)&&void 0!==_LegacyRoomManager$ge&&_LegacyRoomManager$ge}),[room._id]))?react.createElement(messageBox_MessageBox,ComposerMessage_extends({key:room._id,tmid:tmid},composerProps,{showFormattingTips:!0},props)):react.createElement(ComposerSkeleton.A,null)},composer_ComposerMessage=(0,react.memo)(ComposerMessage);ComposerMessage.__docgenInfo={description:"",methods:[],displayName:"ComposerMessage",props:{tmid:{required:!1,tsType:{name:"IMessage['_id']",raw:"IMessage['_id']"},description:""},children:{required:!1,tsType:{name:"ReactNode"},description:""},subscription:{required:!1,tsType:{name:"ISubscription"},description:""},tshow:{required:!1,tsType:{name:"boolean"},description:""},previewUrls:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},onResize:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onEscape:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onSend:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNavigateToNextMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNavigateToPreviousMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onUploadFiles:{required:!1,tsType:{name:"signature",type:"function",raw:"(files: readonly File[]) => void",signature:{arguments:[{type:{name:"unknown"},name:"files"}],return:{name:"void"}}},description:""}}};var ComposerFederationDisabled=function ComposerFederationDisabled(){var t=(0,ui_contexts_dist.useTranslation)();return react.createElement(ui_composer_dist.r7,null,t("Federation_Matrix_Federated_Description_disabled"))},ComposerFederation_ComposerFederationDisabled=ComposerFederationDisabled;ComposerFederationDisabled.__docgenInfo={description:"",methods:[],displayName:"ComposerFederationDisabled"};var ComposerFederationJoinRoomDisabled=function ComposerFederationJoinRoomDisabled(){var t=(0,ui_contexts_dist.useTranslation)();return react.createElement(ui_composer_dist.r7,null,t("Federation_Matrix_join_public_rooms_is_premium"))},ComposerFederation_ComposerFederationJoinRoomDisabled=ComposerFederationJoinRoomDisabled;ComposerFederationJoinRoomDisabled.__docgenInfo={description:"",methods:[],displayName:"ComposerFederationJoinRoomDisabled"};var ComposerFederation_excluded=["subscription","children"];var ComposerFederation=function ComposerFederation(_ref){var subscription=_ref.subscription,children=_ref.children,props=function ComposerFederation_objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function ComposerFederation_objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_ref,ComposerFederation_excluded),federationEnabled=!0===(0,ui_contexts_dist.useSetting)("Federation_Matrix_enabled"),federationModuleEnabled=!0===(0,useHasLicenseModule.b)("federation");return federationEnabled?subscription||federationModuleEnabled?react.createElement(react.Fragment,null,children,react.createElement(composer_ComposerMessage,props)):react.createElement(ComposerFederation_ComposerFederationJoinRoomDisabled,null):react.createElement(ComposerFederation_ComposerFederationDisabled,null)},ComposerFederation_ComposerFederation=ComposerFederation;function ComposerJoinWithPassword_typeof(o){return ComposerJoinWithPassword_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},ComposerJoinWithPassword_typeof(o)}function ComposerJoinWithPassword_extends(){return ComposerJoinWithPassword_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ComposerJoinWithPassword_extends.apply(null,arguments)}function ComposerJoinWithPassword_regeneratorRuntime(){ComposerJoinWithPassword_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==ComposerJoinWithPassword_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(ComposerJoinWithPassword_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function ComposerJoinWithPassword_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}ComposerFederation.__docgenInfo={description:"",methods:[],displayName:"ComposerFederation",props:{tmid:{required:!1,tsType:{name:"IMessage['_id']",raw:"IMessage['_id']"},description:""},children:{required:!1,tsType:{name:"ReactNode"},description:""},subscription:{required:!1,tsType:{name:"ISubscription"},description:""},tshow:{required:!1,tsType:{name:"boolean"},description:""},previewUrls:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},onResize:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onEscape:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onSend:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNavigateToNextMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNavigateToPreviousMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onUploadFiles:{required:!1,tsType:{name:"signature",type:"function",raw:"(files: readonly File[]) => void",signature:{arguments:[{type:{name:"unknown"},name:"files"}],return:{name:"void"}}},description:""}}};var ComposerJoinWithPassword=function ComposerJoinWithPassword(){var t=(0,ui_contexts_dist.useTranslation)(),room=(0,RoomContext.nq)(),dispatchToastMessage=(0,ui_contexts_dist.useToastMessageDispatch)(),joinChannelEndpoint=(0,ui_contexts_dist.useEndpoint)("POST","/v1/channels.join"),_useForm=(0,index_esm.mN)({defaultValues:{joinCode:""}}),control=_useForm.control,handleSubmit=_useForm.handleSubmit,setError=_useForm.setError,_useForm$formState=_useForm.formState,errors=_useForm$formState.errors,isDirty=_useForm$formState.isDirty,handleJoinChannel=function(){var _ref2=function ComposerJoinWithPassword_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){ComposerJoinWithPassword_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){ComposerJoinWithPassword_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(ComposerJoinWithPassword_regeneratorRuntime().mark((function _callee(_ref){var joinCode;return ComposerJoinWithPassword_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return joinCode=_ref.joinCode,_context.prev=1,_context.next=4,joinChannelEndpoint({roomId:room._id,joinCode:joinCode});case 4:_context.next=10;break;case 6:_context.prev=6,_context.t0=_context.catch(1),setError("joinCode",{type:_context.t0.errorType,message:_context.t0.error}),dispatchToastMessage({type:"error",message:_context.t0});case 10:case"end":return _context.stop()}}),_callee,null,[[1,6]])})));return function handleJoinChannel(_x){return _ref2.apply(this,arguments)}}();return react.createElement(ui_composer_dist.r7,{is:"form","aria-label":t("Join_with_password"),onSubmit:handleSubmit(handleJoinChannel)},react.createElement(ui_composer_dist.yF,null,t("you_are_in_preview")),react.createElement(ui_composer_dist.yF,null,react.createElement(index_esm.xI,{name:"joinCode",control:control,render:function render(_ref3){var _errors$joinCode,field=_ref3.field;return react.createElement(fuselage.PasswordInput,ComposerJoinWithPassword_extends({error:null===(_errors$joinCode=errors.joinCode)||void 0===_errors$joinCode?void 0:_errors$joinCode.message},field,{placeholder:t("you_are_in_preview_please_insert_the_password")}))}})),react.createElement(ui_composer_dist.fU,{type:"submit",disabled:!isDirty},t("Join_with_password")))},composer_ComposerJoinWithPassword=ComposerJoinWithPassword;ComposerJoinWithPassword.__docgenInfo={description:"",methods:[],displayName:"ComposerJoinWithPassword"};var useIsRoomOverMacLimit=__webpack_require__("./client/hooks/omnichannel/useIsRoomOverMacLimit.tsx"),useOmnichannelAgentAvailable=__webpack_require__("./client/hooks/omnichannel/useOmnichannelAgentAvailable.ts");function ComposerOmnichannelInquiry_typeof(o){return ComposerOmnichannelInquiry_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},ComposerOmnichannelInquiry_typeof(o)}function ComposerOmnichannelInquiry_extends(){return ComposerOmnichannelInquiry_extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ComposerOmnichannelInquiry_extends.apply(null,arguments)}function ComposerOmnichannelInquiry_regeneratorRuntime(){ComposerOmnichannelInquiry_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==ComposerOmnichannelInquiry_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(ComposerOmnichannelInquiry_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function ComposerOmnichannelInquiry_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}var ComposerOmnichannelInquiry=function ComposerOmnichannelInquiry(){var t=(0,ui_contexts_dist.useTranslation)(),dispatchToastMessage=(0,ui_contexts_dist.useToastMessageDispatch)(),user=(0,ui_contexts_dist.useUser)(),agentAvailable=(0,useOmnichannelAgentAvailable.U)(),room=(0,RoomContext.vK)(),getInquire=(0,ui_contexts_dist.useEndpoint)("GET","/v1/livechat/inquiries.getOne"),result=(0,lib.useQuery)(["inquire",room._id],(function(){return getInquire({roomId:room._id})})),takeInquiry=(0,ui_contexts_dist.useMethod)("livechat:takeInquiry"),handleTakeInquiry=function(){var _ref=function ComposerOmnichannelInquiry_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){ComposerOmnichannelInquiry_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){ComposerOmnichannelInquiry_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(ComposerOmnichannelInquiry_regeneratorRuntime().mark((function _callee(){return ComposerOmnichannelInquiry_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(result.isSuccess){_context.next=2;break}return _context.abrupt("return");case 2:if(result.data.inquiry){_context.next=4;break}return _context.abrupt("return");case 4:return _context.prev=4,_context.next=7,takeInquiry(result.data.inquiry._id,{clientAction:!0});case 7:_context.next=12;break;case 9:_context.prev=9,_context.t0=_context.catch(4),dispatchToastMessage({type:"error",message:_context.t0});case 12:case"end":return _context.stop()}}),_callee,null,[[4,9]])})));return function handleTakeInquiry(){return _ref.apply(this,arguments)}}(),title=(0,react.useMemo)((function(){return"offline"===(null==user?void 0:user.status)?t("You_cant_take_chats_offline"):agentAvailable?void 0:t("You_cant_take_chats_unavailable")}),[agentAvailable,t,null==user?void 0:user.status]);return react.createElement(ui_composer_dist.r7,{"aria-busy":result.isLoading},react.createElement(ui_composer_dist.yF,null,t("you_are_in_preview_mode_of_incoming_livechat")),react.createElement(ui_composer_dist.fU,ComposerOmnichannelInquiry_extends({},title&&{title:title},{disabled:result.isLoading||"offline"===(null==user?void 0:user.status)||!agentAvailable,onClick:handleTakeInquiry}),t("Take_it")))};function ComposerOmnichannelJoin_typeof(o){return ComposerOmnichannelJoin_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},ComposerOmnichannelJoin_typeof(o)}function ComposerOmnichannelJoin_regeneratorRuntime(){ComposerOmnichannelJoin_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==ComposerOmnichannelJoin_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(ComposerOmnichannelJoin_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function ComposerOmnichannelJoin_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function ComposerOmnichannelJoin_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){ComposerOmnichannelJoin_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){ComposerOmnichannelJoin_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}ComposerOmnichannelInquiry.__docgenInfo={description:"",methods:[],displayName:"ComposerOmnichannelInquiry"};var ComposerOmnichannelJoin=function ComposerOmnichannelJoin(){var room=(0,RoomContext.vK)(),join=(0,ui_contexts_dist.useEndpoint)("GET","/v1/livechat/room.join"),dispatchToastMessage=(0,ui_contexts_dist.useToastMessageDispatch)(),t=(0,ui_contexts_dist.useTranslation)();return react.createElement(ui_composer_dist.r7,null,react.createElement(ui_composer_dist.yF,null,t("room_is_read_only")),react.createElement(ui_composer_dist.fU,{onClick:ComposerOmnichannelJoin_asyncToGenerator(ComposerOmnichannelJoin_regeneratorRuntime().mark((function _callee(){return ComposerOmnichannelJoin_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,join({roomId:room._id});case 3:_context.next=8;break;case 5:_context.prev=5,_context.t0=_context.catch(0),dispatchToastMessage({type:"error",message:_context.t0});case 8:case"end":return _context.stop()}}),_callee,null,[[0,5]])})))},t("Join")))};function useResumeChatOnHoldMutation_typeof(o){return useResumeChatOnHoldMutation_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useResumeChatOnHoldMutation_typeof(o)}function useResumeChatOnHoldMutation_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function useResumeChatOnHoldMutation_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?useResumeChatOnHoldMutation_ownKeys(Object(t),!0).forEach((function(r){useResumeChatOnHoldMutation_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):useResumeChatOnHoldMutation_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function useResumeChatOnHoldMutation_defineProperty(e,r,t){return(r=function useResumeChatOnHoldMutation_toPropertyKey(t){var i=function useResumeChatOnHoldMutation_toPrimitive(t,r){if("object"!=useResumeChatOnHoldMutation_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=useResumeChatOnHoldMutation_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==useResumeChatOnHoldMutation_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function useResumeChatOnHoldMutation_regeneratorRuntime(){useResumeChatOnHoldMutation_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==useResumeChatOnHoldMutation_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(useResumeChatOnHoldMutation_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function useResumeChatOnHoldMutation_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function useResumeChatOnHoldMutation_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){useResumeChatOnHoldMutation_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){useResumeChatOnHoldMutation_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}ComposerOmnichannelJoin.__docgenInfo={description:"",methods:[],displayName:"ComposerOmnichannelJoin"};var ComposerOmnichannelOnHold=function ComposerOmnichannelOnHold(){var resumeChatOnHoldMutation=function useResumeChatOnHoldMutation(options){var _onSuccess,resumeChatOnHold=(0,ui_contexts_dist.useEndpoint)("POST","/v1/livechat/room.resumeOnHold"),dispatchToastMessage=(0,ui_contexts_dist.useToastMessageDispatch)(),queryClient=(0,lib.useQueryClient)();return(0,lib.useMutation)(function(){var _ref=useResumeChatOnHoldMutation_asyncToGenerator(useResumeChatOnHoldMutation_regeneratorRuntime().mark((function _callee(roomId){return useResumeChatOnHoldMutation_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,resumeChatOnHold({roomId:roomId});case 2:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}(),useResumeChatOnHoldMutation_objectSpread(useResumeChatOnHoldMutation_objectSpread({},options),{},{onSuccess:(_onSuccess=useResumeChatOnHoldMutation_asyncToGenerator(useResumeChatOnHoldMutation_regeneratorRuntime().mark((function _callee2(data,rid,context){var _options$onSuccess;return useResumeChatOnHoldMutation_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,queryClient.invalidateQueries(["current-chats"]);case 2:return _context2.next=4,queryClient.invalidateQueries(["rooms",rid]);case 4:return _context2.next=6,queryClient.invalidateQueries(["subscriptions",{rid:rid}]);case 6:return _context2.abrupt("return",null==options||null===(_options$onSuccess=options.onSuccess)||void 0===_options$onSuccess?void 0:_options$onSuccess.call(options,data,rid,context));case 7:case"end":return _context2.stop()}}),_callee2)}))),function onSuccess(_x2,_x3,_x4){return _onSuccess.apply(this,arguments)}),onError:function onError(error){dispatchToastMessage({type:"error",message:error})}}))}(),room=(0,RoomContext.vK)(),t=(0,ui_contexts_dist.useTranslation)();return react.createElement(ui_composer_dist.r7,null,react.createElement(ui_composer_dist.yF,null,t("chat_on_hold_due_to_inactivity")),react.createElement(ui_composer_dist.fU,{disabled:resumeChatOnHoldMutation.isLoading,onClick:function onClick(){return resumeChatOnHoldMutation.mutate(room._id)}},t("Resume")))};ComposerOmnichannelOnHold.__docgenInfo={description:"",methods:[],displayName:"ComposerOmnichannelOnHold"};var ComposerOmnichannel=function ComposerOmnichannel(props){var room=(0,RoomContext.vK)(),servedBy=room.servedBy,queuedAt=room.queuedAt,open=room.open,onHold=room.onHold,userId=(0,ui_contexts_dist.useUserId)(),isSubscribed=(0,RoomContext.Nl)(),t=(0,ui_contexts_dist.useTranslation)(),isInquired=!servedBy&&queuedAt,isSameAgent=(null==servedBy?void 0:servedBy._id)===userId,isRoomOverMacLimit=(0,useIsRoomOverMacLimit.P)(room);return open?isRoomOverMacLimit?react.createElement(ui_composer_dist.r7,{color:"default"},t("Workspace_exceeded_MAC_limit_disclaimer")):onHold?react.createElement(ComposerOmnichannelOnHold,null):isInquired?react.createElement(ComposerOmnichannelInquiry,null):isSubscribed||isSameAgent?react.createElement(composer_ComposerMessage,props):react.createElement(ComposerOmnichannelJoin,null):react.createElement(ui_composer_dist.r7,{color:"default"},t("This_conversation_is_already_closed"))},ComposerOmnichannel_ComposerOmnichannel=ComposerOmnichannel;ComposerOmnichannel.__docgenInfo={description:"",methods:[],displayName:"ComposerOmnichannel",props:{tmid:{required:!1,tsType:{name:"IMessage['_id']",raw:"IMessage['_id']"},description:""},children:{required:!1,tsType:{name:"ReactNode"},description:""},subscription:{required:!1,tsType:{name:"ISubscription"},description:""},tshow:{required:!1,tsType:{name:"boolean"},description:""},previewUrls:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},onResize:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onEscape:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onSend:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNavigateToNextMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNavigateToPreviousMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onUploadFiles:{required:!1,tsType:{name:"signature",type:"function",raw:"(files: readonly File[]) => void",signature:{arguments:[{type:{name:"unknown"},name:"files"}],return:{name:"void"}}},description:""}}};var toast=__webpack_require__("./client/lib/toast.ts"),ComposerReadOnly_ComposerReadOnly=function ComposerReadOnly(){var t=(0,ui_contexts_dist.useTranslation)(),room=(0,RoomContext.nq)(),isSubscribed=(0,RoomContext.Nl)(),joinChannel=(0,ui_contexts_dist.useEndpoint)("POST","/v1/channels.join"),join=(0,lib.useMutation)((function(){return joinChannel({roomId:room._id})}),{onError:function onError(error){(0,toast.b)({type:"error",message:error})}});return react.createElement(ui_composer_dist.r7,null,react.createElement(ui_composer_dist.yF,null,t("room_is_read_only")),!isSubscribed&&react.createElement(fuselage.Button,{primary:!0,onClick:function onClick(){return join.mutate()},loading:join.isLoading},t("Join")))},composer_ComposerReadOnly=ComposerReadOnly_ComposerReadOnly;ComposerReadOnly_ComposerReadOnly.__docgenInfo={description:"",methods:[],displayName:"ComposerReadOnly"};var ComposerVoIP=function ComposerVoIP(){var t=(0,ui_contexts_dist.useTranslation)();return react.createElement(ui_composer_dist.r7,null,t("Composer_not_available_phone_calls"))},composer_ComposerVoIP=ComposerVoIP;ComposerVoIP.__docgenInfo={description:"",methods:[],displayName:"ComposerVoIP"};var ComposerContainer_excluded=["children"];var ComposerContainer=function ComposerContainer(_ref){var children=_ref.children,props=function ComposerContainer_objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function ComposerContainer_objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_ref,ComposerContainer_excluded),room=(0,RoomContext.nq)(),canJoinWithoutCode=(0,ui_contexts_dist.usePermission)("join-without-join-code"),mustJoinWithCode=!props.subscription&&room.joinCodeRequired&&!canJoinWithoutCode,isAnonymous=function useMessageComposerIsAnonymous(){var isAnonymousReadEnabled=(0,ui_contexts_dist.useSetting)("Accounts_AllowAnonymousRead"),isAnonymousWriteEnabled=(0,ui_contexts_dist.useSetting)("Accounts_AllowAnonymousWrite"),uid=(0,ui_contexts_dist.useUserId)();if(!uid&&!isAnonymousReadEnabled&&!isAnonymousWriteEnabled)throw new Error("Anonymous access is disabled");return Boolean(!uid)}(),isBlockedOrBlocker=function useMessageComposerIsBlocked(_ref){var subscription=_ref.subscription,room=(0,RoomContext.nq)();if(!(0,dist.isDirectMessageRoom)(room))return!1;if(!subscription)return!1;var isBlocked=Boolean(subscription.blocked),isBlocker=Boolean(subscription.blocker);return isBlocked||isBlocker}({subscription:props.subscription}),isArchived=function useMessageComposerIsArchived(rid,subscription){var isArchived=(0,useReactiveValue.S)((0,react.useCallback)((function(){return roomCoordinator.roomCoordinator.archived(rid)||Boolean(subscription&&"d"===subscription.t&&subscription.archived)}),[rid,subscription]));return Boolean(isArchived)}(room._id,props.subscription),isReadOnly=function useMessageComposerIsReadOnly(rid){var isReadOnly=(0,useReactiveValue.S)((0,react.useCallback)((function(){return roomCoordinator.roomCoordinator.readOnly(rid,meteor.fj.users.findOne(meteor.fj.userId(),{fields:{username:1}}))}),[rid]));return Boolean(isReadOnly)}(room._id),isOmnichannel=(0,dist.isOmnichannelRoom)(room),isFederation=(0,dist.isRoomFederated)(room),isVoip=(0,dist.isVoipRoom)(room);return isOmnichannel?react.createElement(ComposerOmnichannel_ComposerOmnichannel,props):isVoip?react.createElement(composer_ComposerVoIP,null):isFederation?react.createElement(ComposerFederation_ComposerFederation,props):isAnonymous?react.createElement(composer_ComposerAnonymous,null):isReadOnly?react.createElement(composer_ComposerReadOnly,null):isArchived?react.createElement(ComposerArchived,null):mustJoinWithCode?react.createElement(composer_ComposerJoinWithPassword,null):isBlockedOrBlocker?react.createElement(composer_ComposerBlocked,null):react.createElement(react.Fragment,null,children,react.createElement(composer_ComposerMessage,props))},composer_ComposerContainer=(0,react.memo)(ComposerContainer);ComposerContainer.__docgenInfo={description:"",methods:[],displayName:"ComposerContainer",props:{tmid:{required:!1,tsType:{name:"IMessage['_id']",raw:"IMessage['_id']"},description:""},children:{required:!1,tsType:{name:"ReactNode"},description:""},subscription:{required:!1,tsType:{name:"ISubscription"},description:""},tshow:{required:!1,tsType:{name:"boolean"},description:""},previewUrls:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},onResize:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onEscape:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onSend:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNavigateToNextMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNavigateToPreviousMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onUploadFiles:{required:!1,tsType:{name:"signature",type:"function",raw:"(files: readonly File[]) => void",signature:{arguments:[{type:{name:"unknown"},name:"files"}],return:{name:"void"}}},description:""}}}},"./client/views/room/hooks/useDateScroll.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{v:function(){return useDateScroll}});var _templateObject,_templateObject2,_rocket_chat_css_in_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@rocket.chat/css-in-js/dist/index.module.js"),_rocket_chat_fuselage_hooks__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/index.js"),_lib_utils_highOrderFunctions__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./lib/utils/highOrderFunctions.ts"),_providers_DateListProvider__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./client/views/room/providers/DateListProvider.tsx");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _taggedTemplateLiteral(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||_unsupportedIterableToArray(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var useDateScroll=function useDateScroll(){var margin=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,_useSafely2=_slicedToArray((0,_rocket_chat_fuselage_hooks__WEBPACK_IMPORTED_MODULE_1__.useSafely)((0,react__WEBPACK_IMPORTED_MODULE_2__.useState)({date:"",show:!1,style:void 0,bubbleDateClassName:void 0,offset:0})),2),bubbleDate=_useSafely2[0],setBubbleDate=_useSafely2[1],list=(0,_providers_DateListProvider__WEBPACK_IMPORTED_MODULE_3__.EZ)().list,bubbleRef=(0,react__WEBPACK_IMPORTED_MODULE_2__.useRef)(null),callbackRef=(0,react__WEBPACK_IMPORTED_MODULE_2__.useCallback)((function(node){var _bubbleRef$current;if(node){var timeout,bubbleOffset=(null===(_bubbleRef$current=bubbleRef.current)||void 0===_bubbleRef$current?void 0:_bubbleRef$current.getBoundingClientRect().bottom)||0,onScroll=function(elements){clearTimeout(timeout);var _reduce=_toConsumableArray(elements).reduce((function(ret,message){if(!message.dataset.id)return ret;var _message$getBoundingC=message.getBoundingClientRect(),top=_message$getBoundingC.top,height=_message$getBoundingC.height,id=message.dataset.id;return top>bubbleOffset&&top<bubbleOffset+height?[ret[0]||new Date(id).toISOString(),ret[1]||message,{position:"absolute",top:"".concat(top-height-bubbleOffset+margin,"px"),left:" 50%",translate:"-50%",zIndex:11}]:top<bubbleOffset+height?[new Date(id).toISOString(),message,{position:"absolute",top:"".concat(margin,"px"),left:" 50%",translate:"-50%",zIndex:11}]:ret}),[]),_reduce2=_slicedToArray(_reduce,3),date=_reduce2[0],message=_reduce2[1],style=_reduce2[2];if(setBubbleDate((function(current){return _objectSpread(_objectSpread(_objectSpread({},current),{},{date:""},date&&{date:date}),{},{show:Boolean(date),style:style,bubbleDateClassName:(0,_rocket_chat_css_in_js__WEBPACK_IMPORTED_MODULE_0__.css)(_templateObject||(_templateObject=_taggedTemplateLiteral(["\n\t\t\t\t\t\t\topacity: 0;\n\t\t\t\t\t\t\ttransition: opacity 0.6s;\n\t\t\t\t\t\t\t&.bubble-visible {\n\t\t\t\t\t\t\t\topacity: 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t"])))})})),message){var top=message.getBoundingClientRect().top;if(top<bubbleOffset&&top>0)return}timeout=setTimeout((function(){return setBubbleDate((function(current){return _objectSpread(_objectSpread({},current),{},{show:!1})}))}),1e3)},fn=(0,_lib_utils_highOrderFunctions__WEBPACK_IMPORTED_MODULE_4__.u)({wait:30})((function(){onScroll(list)}));node.addEventListener("scroll",fn,{passive:!0})}}),[list,margin,setBubbleDate]),listStyle=bubbleDate.show&&bubbleDate.date?(0,_rocket_chat_css_in_js__WEBPACK_IMPORTED_MODULE_0__.css)(_templateObject2||(_templateObject2=_taggedTemplateLiteral(["\n\t\t\t\t\tposition: relative;\n\t\t\t\t\t& [data-time='","'] {\n\t\t\t\t\t\topacity: 0;\n\t\t\t\t\t}\n\t\t\t  "])),bubbleDate.date.replaceAll(/[-T:.]/g,"").substring(0,8)):void 0;return{innerRef:callbackRef,bubbleRef:bubbleRef,listStyle:listStyle,bubbleDate:bubbleDate.date,bubbleDateStyle:bubbleDate.style,showBubble:Boolean(bubbleDate.show),bubbleDateClassName:bubbleDate.bubbleDateClassName}}},"./client/views/room/hooks/useE2EERoomState.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{N:function(){return useE2EERoomState}});var react=__webpack_require__("./node_modules/react/index.js"),shim=__webpack_require__("./node_modules/use-sync-external-store/shim/index.js"),lib=__webpack_require__("../../node_modules/@tanstack/react-query/build/lib/index.js"),client=__webpack_require__("./app/e2e/client/index.ts");function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var useE2EERoomState=function useE2EERoomState(rid){var e2eRoom=function useE2EERoom(rid){return(0,lib.useQuery)(["e2eRoom",rid],(function(){return client.D.getInstanceByRoomId(rid)})).data}(rid),subscribeE2EERoomState=(0,react.useMemo)((function(){return[function(callback){return e2eRoom?e2eRoom.onStateChange(callback):function(){}},function(){return e2eRoom?e2eRoom.getState():void 0}]}),[e2eRoom]);return shim.useSyncExternalStore.apply(void 0,_toConsumableArray(subscribeE2EERoomState))}},"./client/views/room/hooks/useFirstUnreadMessageId.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{L:function(){return useFirstUnreadMessageId}});var use_sync_external_store_shim__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/use-sync-external-store/shim/index.js"),_contexts_ChatContext__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./client/views/room/contexts/ChatContext.ts"),useFirstUnreadMessageId=function useFirstUnreadMessageId(){var chat=(0,_contexts_ChatContext__WEBPACK_IMPORTED_MODULE_1__.Y)();if(!chat)throw new Error("useFirstUnreadMessageId must be used within a ChatContextProvider");return(0,use_sync_external_store_shim__WEBPACK_IMPORTED_MODULE_0__.useSyncExternalStore)(chat.readStateManager.onUnreadStateChange,chat.readStateManager.getFirstUnreadRecordId)}},"./client/views/room/hooks/useMessageListNavigation.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{b:function(){return useMessageListNavigation}});var react_aria__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@react-aria/focus/dist/import.mjs"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),isListItem=function isListItem(node){return"listitem"===node.getAttribute("role")||"link"===node.getAttribute("role")},useMessageListNavigation=function useMessageListNavigation(){var roomFocusManager=(0,react_aria__WEBPACK_IMPORTED_MODULE_1__.H8)();return{messageListRef:(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((function(node){var lastMessageFocused=null,initialFocus=!0;if(node){var massageListFocusManager=(0,react_aria__WEBPACK_IMPORTED_MODULE_1__.C7)({current:node});node.addEventListener("keydown",(function(e){e.target&&isListItem(e.target)&&("Tab"===e.key&&(e.shiftKey?(e.preventDefault(),e.stopPropagation(),roomFocusManager.focusFirst({from:document.getElementsByClassName("rcx-room-header")[0]})):(function isThreadMessage(node){return node.classList.contains("rcx-message-thread")}(e.target)||function isSystemMessage(node){return node.classList.contains("rcx-message-system")}(e.target)||function isMessageToolbarAction(node){var _parentElement;return"toolbar"===(null===(_parentElement=node.parentElement)||void 0===_parentElement?void 0:_parentElement.getAttribute("role"))}(e.target))&&(e.preventDefault(),e.stopPropagation(),roomFocusManager.focusNext({accept:function accept(node){return"TEXTAREA"===node.tagName}}))),"ArrowUp"!==e.key&&"ArrowDown"!==e.key||("ArrowUp"===e.key&&massageListFocusManager.focusPrevious({accept:function accept(node){return isListItem(node)}}),"ArrowDown"===e.key&&massageListFocusManager.focusNext({accept:function accept(node){return isListItem(node)}}),lastMessageFocused=document.activeElement))})),node.addEventListener("blur",(function(e){var _e$relatedTarget;null!==(_e$relatedTarget=e.relatedTarget)&&void 0!==_e$relatedTarget&&_e$relatedTarget.classList.contains("focus-visible")&&e.currentTarget instanceof HTMLElement&&e.relatedTarget instanceof HTMLElement&&(e.currentTarget.contains(e.relatedTarget)||lastMessageFocused||(lastMessageFocused=e.target))}),{capture:!0}),node.addEventListener("focus",(function(e){var _e$target;if((null===(_e$target=e.target)||void 0===_e$target?void 0:_e$target.classList.contains("focus-visible"))&&e.currentTarget instanceof HTMLElement&&e.relatedTarget instanceof HTMLElement){if(initialFocus)return massageListFocusManager.focusLast({accept:function accept(node){return isListItem(node)}}),lastMessageFocused=document.activeElement,void(initialFocus=!1);var _lastMessageFocused;if(lastMessageFocused&&!e.currentTarget.contains(e.relatedTarget)&&node.contains(e.target))null===(_lastMessageFocused=lastMessageFocused)||void 0===_lastMessageFocused||_lastMessageFocused.focus()}}),{capture:!0})}}),[roomFocusManager])}}},"./client/views/room/providers/ChatProvider.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:function(){return providers_ChatProvider}});var react=__webpack_require__("./node_modules/react/index.js"),ChatContext=__webpack_require__("./client/views/room/contexts/ChatContext.ts"),RoomContext=__webpack_require__("./client/views/room/contexts/RoomContext.ts"),dist=__webpack_require__("../../packages/ui-contexts/dist/index.js"),core_typings_dist=__webpack_require__("../../packages/core-typings/dist/index.js"),main_client=__webpack_require__("../../packages/random/dist/main.client.js"),moment=__webpack_require__("./node_modules/moment/moment.js"),moment_default=__webpack_require__.n(moment),client=__webpack_require__("./app/authorization/client/index.ts"),models_client=__webpack_require__("./app/models/client/index.ts"),settings_client=__webpack_require__("./app/settings/client/index.ts"),ui_utils_client=__webpack_require__("./app/ui-utils/client/index.ts"),SDKClient=__webpack_require__("./app/utils/client/lib/SDKClient.ts"),prependReplies=__webpack_require__("./client/lib/utils/prependReplies.ts");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var toast=__webpack_require__("./client/lib/toast.ts");function processMessageEditing_typeof(o){return processMessageEditing_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},processMessageEditing_typeof(o)}function processMessageEditing_regeneratorRuntime(){processMessageEditing_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==processMessageEditing_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(processMessageEditing_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function processMessageEditing_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function processMessageEditing_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?processMessageEditing_ownKeys(Object(t),!0).forEach((function(r){processMessageEditing_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):processMessageEditing_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function processMessageEditing_defineProperty(e,r,t){return(r=function processMessageEditing_toPropertyKey(t){var i=function processMessageEditing_toPrimitive(t,r){if("object"!=processMessageEditing_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=processMessageEditing_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==processMessageEditing_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function processMessageEditing_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}var processMessageEditing=function(){var _ref=function processMessageEditing_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){processMessageEditing_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){processMessageEditing_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(processMessageEditing_regeneratorRuntime().mark((function _callee(chat,message,previewUrls){var _message$attachments;return processMessageEditing_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(chat.currentEditing){_context.next=2;break}return _context.abrupt("return",!1);case 2:if(!ui_utils_client.MessageTypes.isSystemMessage(message)){_context.next=4;break}return _context.abrupt("return",!1);case 4:if(message.msg||null!==(_message$attachments=message.attachments)&&void 0!==_message$attachments&&_message$attachments.length||message.content){_context.next=6;break}return _context.abrupt("return",!1);case 6:return _context.prev=6,_context.next=9,chat.data.updateMessage(processMessageEditing_objectSpread(processMessageEditing_objectSpread({},message),{},{_id:chat.currentEditing.mid}),previewUrls);case 9:_context.next=14;break;case 11:_context.prev=11,_context.t0=_context.catch(6),(0,toast.b)({type:"error",message:_context.t0});case 14:return chat.currentEditing.stop(),_context.abrupt("return",!0);case 16:case"end":return _context.stop()}}),_callee,null,[[6,11]])})));return function processMessageEditing(_x,_x2,_x3){return _ref.apply(this,arguments)}}(),emoji_client=__webpack_require__("./app/emoji/client/index.ts"),callWithErrorHandling=__webpack_require__("./client/lib/utils/callWithErrorHandling.ts");function processSetReaction_typeof(o){return processSetReaction_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},processSetReaction_typeof(o)}function processSetReaction_regeneratorRuntime(){processSetReaction_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==processSetReaction_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(processSetReaction_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function processSetReaction_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}var processSetReaction=function(){var _ref2=function processSetReaction_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){processSetReaction_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){processSetReaction_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(processSetReaction_regeneratorRuntime().mark((function _callee(chat,_ref){var msg,match,_match,reaction,lastMessage;return processSetReaction_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(msg=_ref.msg,match=msg.trim().match(/^\+(:.*?:)$/m)){_context.next=4;break}return _context.abrupt("return",!1);case 4:if(_match=_slicedToArray(match,2),reaction=_match[1],emoji_client.Zg.list[reaction]){_context.next=7;break}return _context.abrupt("return",!1);case 7:return _context.next=9,chat.data.findLastMessage();case 9:if(lastMessage=_context.sent){_context.next=12;break}return _context.abrupt("return",!1);case 12:return _context.next=14,(0,callWithErrorHandling.g)("setReaction",reaction,lastMessage._id);case 14:return _context.abrupt("return",!0);case 15:case"end":return _context.stop()}}),_callee)})));return function processSetReaction(_x,_x2){return _ref2.apply(this,arguments)}}(),esm=__webpack_require__("./node_modules/@rocket.chat/string-helpers/dist/esm/index.js"),utils_client=__webpack_require__("./app/utils/client/index.ts"),i18n=__webpack_require__("./app/utils/lib/i18n.ts");function processSlashCommand_typeof(o){return processSlashCommand_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},processSlashCommand_typeof(o)}function processSlashCommand_regeneratorRuntime(){processSlashCommand_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==processSlashCommand_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(processSlashCommand_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function processSlashCommand_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function processSlashCommand_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){processSlashCommand_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){processSlashCommand_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}function processSlashCommand_slicedToArray(r,e){return function processSlashCommand_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function processSlashCommand_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function processSlashCommand_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return processSlashCommand_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?processSlashCommand_arrayLikeToArray(r,a):void 0}}(r,e)||function processSlashCommand_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function processSlashCommand_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var parse=function parse(msg){var match=msg.match(/^\/([^\s]+)(.*)/);if(match){var _match=processSlashCommand_slicedToArray(match,3),cmd=_match[1],params=_match[2],command=utils_client.O4.commands[cmd];return command?{command:command,params:params}:{command:cmd,params:params}}},warnUnrecognizedSlashCommand=function(){var _ref=processSlashCommand_asyncToGenerator(processSlashCommand_regeneratorRuntime().mark((function _callee(chat,message){return processSlashCommand_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return console.error(message),_context.next=3,chat.data.pushEphemeralMessage({_id:main_client.o.id(),ts:new Date,msg:message,u:{_id:"rocket.cat",username:"rocket.cat",name:"Rocket.Cat"},private:!0,_updatedAt:new Date});case 3:case"end":return _context.stop()}}),_callee)})));return function warnUnrecognizedSlashCommand(_x,_x2){return _ref.apply(this,arguments)}}(),processSlashCommand=function(){var _ref2=processSlashCommand_asyncToGenerator(processSlashCommand_regeneratorRuntime().mark((function _callee2(chat,message){var match,command,params,permission,clientOnly,handleOnClient,handleResult,appId,commandName,triggerId,data,result;return processSlashCommand_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(match=parse(message.msg)){_context2.next=3;break}return _context2.abrupt("return",!1);case 3:if(command=match.command,params=match.params,"string"!=typeof command){_context2.next=10;break}if(settings_client.W.get("Message_AllowUnrecognizedSlashCommand")){_context2.next=9;break}return _context2.next=8,warnUnrecognizedSlashCommand(chat,(0,i18n.t)("No_such_command",{command:(0,esm.Zn)(command)}));case 8:return _context2.abrupt("return",!0);case 9:return _context2.abrupt("return",!1);case 10:if(permission=command.permission,clientOnly=command.clientOnly,handleOnClient=command.callback,handleResult=command.result,appId=command.appId,commandName=command.command,!permission||(0,client.WX)(permission,message.rid)){_context2.next=15;break}return _context2.next=14,warnUnrecognizedSlashCommand(chat,(0,i18n.t)("You_do_not_have_permission_to_execute_this_command",{command:(0,esm.Zn)(commandName)}));case 14:return _context2.abrupt("return",!0);case 15:if(!clientOnly||!chat.uid){_context2.next=18;break}return null==handleOnClient||handleOnClient({command:commandName,message:message,params:params,userId:chat.uid}),_context2.abrupt("return",!0);case 18:return _context2.next=20,SDKClient.sdk.rest.post("/v1/statistics.telemetry",{params:[{eventName:"slashCommandsStats",timestamp:Date.now(),command:commandName}]});case 20:return triggerId=chat.ActionManager.generateTriggerId(appId),data={cmd:commandName,params:params,msg:message,userId:chat.uid},_context2.prev=22,appId&&chat.ActionManager.notifyBusy(),_context2.next=26,SDKClient.sdk.call("slashCommand",{cmd:commandName,params:params,msg:message,triggerId:triggerId});case 26:result=_context2.sent,null==handleResult||handleResult(void 0,result,data),_context2.next=35;break;case 30:return _context2.prev=30,_context2.t0=_context2.catch(22),_context2.next=34,warnUnrecognizedSlashCommand(chat,(0,i18n.t)("Something_went_wrong_while_executing_command",{command:commandName}));case 34:null==handleResult||handleResult(_context2.t0,void 0,data);case 35:return appId&&chat.ActionManager.notifyIdle(),_context2.abrupt("return",!0);case 37:case"end":return _context2.stop()}}),_callee2,null,[[22,30]])})));return function processSlashCommand(_x3,_x4){return _ref2.apply(this,arguments)}}(),GenericModal=__webpack_require__("./client/components/GenericModal/index.ts"),imperativeModal=__webpack_require__("./client/lib/imperativeModal.tsx");function processTooLongMessage_typeof(o){return processTooLongMessage_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},processTooLongMessage_typeof(o)}function processTooLongMessage_regeneratorRuntime(){processTooLongMessage_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==processTooLongMessage_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(processTooLongMessage_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function processTooLongMessage_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function processTooLongMessage_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){processTooLongMessage_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){processTooLongMessage_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var processTooLongMessage=function(){var _ref2=processTooLongMessage_asyncToGenerator(processTooLongMessage_regeneratorRuntime().mark((function _callee2(chat,_ref){var msg,maxAllowedSize,fileUploadsEnabled,convertLongMessagesToAttachment,_chat$composer;return processTooLongMessage_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(msg=_ref.msg,maxAllowedSize=settings_client.W.get("Message_MaxAllowedSize"),!(msg.length<=maxAllowedSize)){_context2.next=4;break}return _context2.abrupt("return",!1);case 4:if(fileUploadsEnabled=settings_client.W.get("FileUpload_Enabled"),convertLongMessagesToAttachment=settings_client.W.get("Message_AllowConvertLongMessagesToAttachment"),!chat.currentEditing&&fileUploadsEnabled&&convertLongMessagesToAttachment){_context2.next=10;break}return(0,toast.b)({type:"error",message:new Error((0,i18n.t)("Message_too_long"))}),null===(_chat$composer=chat.composer)||void 0===_chat$composer||_chat$composer.setText(msg),_context2.abrupt("return",!0);case 10:return _context2.next=12,new Promise((function(resolve){var onConfirm=function(){var _ref3=processTooLongMessage_asyncToGenerator(processTooLongMessage_regeneratorRuntime().mark((function _callee(){var _Meteor$user$username,_Meteor$user,messageBlob,fileName,file;return processTooLongMessage_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return"text/plain",messageBlob=new Blob([msg],{type:"text/plain"}),fileName="".concat(null!==(_Meteor$user$username=null===(_Meteor$user=Meteor.user())||void 0===_Meteor$user?void 0:_Meteor$user.username)&&void 0!==_Meteor$user$username?_Meteor$user$username:"anonymous"," - ").concat(new Date,".txt"),file=new File([messageBlob],fileName,{type:"text/plain",lastModified:Date.now()}),imperativeModal.K.close(),_context.next=7,chat.flows.uploadFiles([file]);case 7:resolve();case 8:case"end":return _context.stop()}}),_callee)})));return function onConfirm(){return _ref3.apply(this,arguments)}}(),onClose=function onClose(){var _chat$composer2;null===(_chat$composer2=chat.composer)||void 0===_chat$composer2||_chat$composer2.setText(msg),imperativeModal.K.close(),resolve()};imperativeModal.K.open({component:GenericModal.A,props:{title:(0,i18n.t)("Message_too_long"),children:(0,i18n.t)("Send_it_as_attachment_instead_question"),onConfirm:onConfirm,onClose:onClose,onCancel:onClose,variant:"warning"}})}));case 12:return _context2.abrupt("return",!0);case 13:case"end":return _context2.stop()}}),_callee2)})));return function processTooLongMessage(_x,_x2){return _ref2.apply(this,arguments)}}(),RouterProvider=__webpack_require__("./client/providers/RouterProvider.tsx"),roomCoordinator=__webpack_require__("./client/lib/rooms/roomCoordinator.tsx");function replyBroadcast_typeof(o){return replyBroadcast_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},replyBroadcast_typeof(o)}function replyBroadcast_regeneratorRuntime(){replyBroadcast_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==replyBroadcast_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(replyBroadcast_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function replyBroadcast_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function replyBroadcast_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?replyBroadcast_ownKeys(Object(t),!0).forEach((function(r){replyBroadcast_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):replyBroadcast_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function replyBroadcast_defineProperty(e,r,t){return(r=function replyBroadcast_toPropertyKey(t){var i=function replyBroadcast_toPrimitive(t,r){if("object"!=replyBroadcast_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=replyBroadcast_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==replyBroadcast_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function replyBroadcast_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}var replyBroadcast=function(){var _ref=function replyBroadcast_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){replyBroadcast_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){replyBroadcast_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(replyBroadcast_regeneratorRuntime().mark((function _callee(_chat,message){return replyBroadcast_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:roomCoordinator.roomCoordinator.openRouteLink("d",{name:message.u.username},replyBroadcast_objectSpread(replyBroadcast_objectSpread({},RouterProvider.Q.getSearchParameters()),{},{reply:message._id}));case 1:case"end":return _context.stop()}}),_callee)})));return function replyBroadcast(_x,_x2){return _ref.apply(this,arguments)}}();function requestMessageDeletion_typeof(o){return requestMessageDeletion_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},requestMessageDeletion_typeof(o)}function requestMessageDeletion_regeneratorRuntime(){requestMessageDeletion_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==requestMessageDeletion_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(requestMessageDeletion_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function requestMessageDeletion_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function requestMessageDeletion_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){requestMessageDeletion_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){requestMessageDeletion_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var requestMessageDeletion=function(){var _ref=requestMessageDeletion_asyncToGenerator(requestMessageDeletion_regeneratorRuntime().mark((function _callee3(chat,message){var room;return requestMessageDeletion_regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,chat.data.canDeleteMessage(message);case 2:if(_context3.sent){_context3.next=5;break}return(0,toast.b)({type:"error",message:(0,i18n.t)("Message_deleting_blocked")}),_context3.abrupt("return");case 5:if(!message.drid){_context3.next=11;break}return _context3.next=8,chat.data.getDiscussionByID(message.drid);case 8:_context3.t0=_context3.sent,_context3.next=12;break;case 11:_context3.t0=void 0;case 12:return room=_context3.t0,_context3.next=15,new Promise((function(resolve,reject){var onConfirm=function(){var _ref2=requestMessageDeletion_asyncToGenerator(requestMessageDeletion_regeneratorRuntime().mark((function _callee(){var _chat$currentEditing,_chat$composer;return requestMessageDeletion_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,chat.data.canDeleteMessage(message);case 3:if(_context.sent){_context.next=6;break}return(0,toast.b)({type:"error",message:(0,i18n.t)("Message_deleting_blocked")}),_context.abrupt("return");case 6:return _context.next=8,chat.data.deleteMessage(message);case 8:imperativeModal.K.close(),(null===(_chat$currentEditing=chat.currentEditing)||void 0===_chat$currentEditing?void 0:_chat$currentEditing.mid)===message._id&&chat.currentEditing.stop(),null===(_chat$composer=chat.composer)||void 0===_chat$composer||_chat$composer.focus(),(0,toast.b)({type:"success",message:(0,i18n.t)("Your_entry_has_been_deleted")}),resolve(),_context.next=19;break;case 15:_context.prev=15,_context.t0=_context.catch(0),(0,toast.b)({type:"error",message:_context.t0}),reject(_context.t0);case 19:case"end":return _context.stop()}}),_callee,null,[[0,15]])})));return function onConfirm(){return _ref2.apply(this,arguments)}}(),onCloseModal=function(){var _ref3=requestMessageDeletion_asyncToGenerator(requestMessageDeletion_regeneratorRuntime().mark((function _callee2(){var _chat$currentEditing2,_chat$composer2;return requestMessageDeletion_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:imperativeModal.K.close(),(null===(_chat$currentEditing2=chat.currentEditing)||void 0===_chat$currentEditing2?void 0:_chat$currentEditing2.mid)===message._id&&chat.currentEditing.stop(),null===(_chat$composer2=chat.composer)||void 0===_chat$composer2||_chat$composer2.focus(),resolve();case 4:case"end":return _context2.stop()}}),_callee2)})));return function onCloseModal(){return _ref3.apply(this,arguments)}}();imperativeModal.K.open({component:GenericModal.A,props:{title:(0,i18n.t)("Are_you_sure"),children:room?(0,i18n.t)("The_message_is_a_discussion_you_will_not_be_able_to_recover"):(0,i18n.t)("You_will_not_be_able_to_recover"),variant:"danger",confirmText:(0,i18n.t)("Yes_delete_it"),onConfirm:onConfirm,onClose:onCloseModal,onCancel:onCloseModal}})}));case 15:case"end":return _context3.stop()}}),_callee3)})));return function requestMessageDeletion(_x,_x2){return _ref.apply(this,arguments)}}(),meteor=__webpack_require__("./.storybook/mocks/meteor.js"),RoomManager=__webpack_require__("./client/lib/RoomManager.ts"),onClientMessageReceived=__webpack_require__("./client/lib/onClientMessageReceived.ts"),getUserAvatarURL=__webpack_require__("./app/utils/client/getUserAvatarURL.ts"),getAvatarAsPng=function getAvatarAsPng(username,cb){var image=new Image,onError=function onError(){return cb("")};return image.onload=function onLoad(){var canvas=document.createElement("canvas");canvas.width=image.width,canvas.height=image.height;var context=canvas.getContext("2d");if(!context)throw new Error("failed to get canvas context");context.drawImage(image,0,0);try{return cb(canvas.toDataURL("image/png"))}catch(e){return cb("")}},image.onerror=onError,image.src=(0,getUserAvatarURL.k)(username||""),onError},stringUtils=__webpack_require__("./lib/utils/stringUtils.ts");function CustomSounds_typeof(o){return CustomSounds_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},CustomSounds_typeof(o)}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=function CustomSounds_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return CustomSounds_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?CustomSounds_arrayLikeToArray(r,a):void 0}}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function CustomSounds_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function CustomSounds_regeneratorRuntime(){CustomSounds_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==CustomSounds_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(CustomSounds_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function CustomSounds_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function CustomSounds_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){CustomSounds_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){CustomSounds_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,CustomSounds_toPropertyKey(o.key),o)}}function CustomSounds_defineProperty(e,r,t){return(r=CustomSounds_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function CustomSounds_toPropertyKey(t){var i=function CustomSounds_toPrimitive(t,r){if("object"!=CustomSounds_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=CustomSounds_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==CustomSounds_typeof(i)?i:i+""}var getCustomSoundId=function getCustomSoundId(soundId){return"custom-sound-".concat(soundId)},getAssetUrl=function getAssetUrl(asset,params){return(0,utils_client.AP)(asset,params,void 0,!0)},defaultSounds=[{_id:"chime",name:"Chime",extension:"mp3",src:getAssetUrl("sounds/chime.mp3")},{_id:"door",name:"Door",extension:"mp3",src:getAssetUrl("sounds/door.mp3")},{_id:"beep",name:"Beep",extension:"mp3",src:getAssetUrl("sounds/beep.mp3")},{_id:"chelle",name:"Chelle",extension:"mp3",src:getAssetUrl("sounds/chelle.mp3")},{_id:"ding",name:"Ding",extension:"mp3",src:getAssetUrl("sounds/ding.mp3")},{_id:"droplet",name:"Droplet",extension:"mp3",src:getAssetUrl("sounds/droplet.mp3")},{_id:"highbell",name:"Highbell",extension:"mp3",src:getAssetUrl("sounds/highbell.mp3")},{_id:"seasons",name:"Seasons",extension:"mp3",src:getAssetUrl("sounds/seasons.mp3")},{_id:"telephone",name:"Telephone",extension:"mp3",src:getAssetUrl("sounds/telephone.mp3")},{_id:"outbound-call-ringing",name:"Outbound Call Ringing",extension:"mp3",src:getAssetUrl("sounds/outbound-call-ringing.mp3")},{_id:"call-ended",name:"Call Ended",extension:"mp3",src:getAssetUrl("sounds/call-ended.mp3")},{_id:"dialtone",name:"Dialtone",extension:"mp3",src:getAssetUrl("sounds/dialtone.mp3")},{_id:"ringtone",name:"Ringtone",extension:"mp3",src:getAssetUrl("sounds/ringtone.mp3")}],CustomSoundsClass=function(){function CustomSoundsClass(){var _this=this;!function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,CustomSoundsClass),CustomSounds_defineProperty(this,"list",void 0),CustomSounds_defineProperty(this,"initialFetchDone",void 0),CustomSounds_defineProperty(this,"play",function(){var _ref=CustomSounds_asyncToGenerator(CustomSounds_regeneratorRuntime().mark((function _callee(soundId){var _ref2,_ref2$volume,volume,_ref2$loop,loop,audio,_args=arguments;return CustomSounds_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_ref2$volume=(_ref2=_args.length>1&&void 0!==_args[1]?_args[1]:{}).volume,volume=void 0===_ref2$volume?1:_ref2$volume,_ref2$loop=_ref2.loop,loop=void 0!==_ref2$loop&&_ref2$loop,null!=(audio=document.querySelector("#".concat(getCustomSoundId(soundId))))&&audio.play){_context.next=4;break}return _context.abrupt("return");case 4:return audio.volume=volume,audio.loop=loop,_context.next=8,audio.play();case 8:return _context.abrupt("return",audio);case 9:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}()),CustomSounds_defineProperty(this,"pause",(function(soundId){var audio=document.querySelector("#".concat(getCustomSoundId(soundId)));null!=audio&&audio.pause&&audio.pause()})),CustomSounds_defineProperty(this,"stop",(function(soundId){var audio=document.querySelector("#".concat(getCustomSoundId(soundId)));null!=audio&&audio.load&&(null==audio||audio.load())})),CustomSounds_defineProperty(this,"isPlaying",(function(soundId){var audio=document.querySelector("#".concat(getCustomSoundId(soundId)));return audio&&audio.duration>0&&!audio.paused})),CustomSounds_defineProperty(this,"fetchCustomSoundList",CustomSounds_asyncToGenerator(CustomSounds_regeneratorRuntime().mark((function _callee2(){var result,_iterator,_step,sound;return CustomSounds_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!_this.initialFetchDone){_context2.next=2;break}return _context2.abrupt("return");case 2:return _context2.next=4,SDKClient.sdk.call("listCustomSounds");case 4:result=_context2.sent,_iterator=_createForOfIteratorHelper(result);try{for(_iterator.s();!(_step=_iterator.n()).done;)sound=_step.value,_this.add(sound)}catch(err){_iterator.e(err)}finally{_iterator.f()}_this.initialFetchDone=!0;case 8:case"end":return _context2.stop()}}),_callee2)})))),this.list=new meteor.Hw({}),this.initialFetchDone=!1,defaultSounds.forEach((function(sound){return _this.add(sound)}))}return function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(CustomSoundsClass,[{key:"add",value:function add(sound){sound.src||(sound.src=this.getURL(sound));var source=document.createElement("source");source.src=sound.src;var audio=document.createElement("audio");audio.id=getCustomSoundId(sound._id),audio.preload="none",audio.appendChild(source),document.body.appendChild(audio);var list=this.list.get();list[sound._id]=sound,this.list.set(list)}},{key:"remove",value:function remove(sound){var list=this.list.get();delete list[sound._id],this.list.set(list);var audio=document.querySelector("#".concat(getCustomSoundId(sound._id)));null==audio||audio.remove()}},{key:"getSound",value:function getSound(soundId){return this.list.get()[soundId]}},{key:"update",value:function update(sound){var audio=document.querySelector("#".concat(getCustomSoundId(sound._id)));if(audio){var list=this.list.get();sound.src||(sound.src=this.getURL(sound)),list[sound._id]=sound,this.list.set(list);var sourceEl=audio.querySelector("source");sourceEl&&(sourceEl.src=sound.src),audio.load()}else this.add(sound)}},{key:"getURL",value:function getURL(sound){return getAssetUrl("/custom-sounds/".concat(sound._id,".").concat(sound.extension),{_dc:sound.random||0})}},{key:"getList",value:function getList(){return Object.values(this.list.get()).sort((function(a,b){var _a$name,_b$name;return(null!==(_a$name=a.name)&&void 0!==_a$name?_a$name:"").localeCompare(null!==(_b$name=b.name)&&void 0!==_b$name?_b$name:"")}))}}]),CustomSoundsClass}(),CustomSounds=new CustomSoundsClass,e2e_client=__webpack_require__("./app/e2e/client/index.ts");function KonchatNotification_typeof(o){return KonchatNotification_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},KonchatNotification_typeof(o)}function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return KonchatNotification_arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||function KonchatNotification_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return KonchatNotification_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?KonchatNotification_arrayLikeToArray(r,a):void 0}}(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function KonchatNotification_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function KonchatNotification_regeneratorRuntime(){KonchatNotification_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==KonchatNotification_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(KonchatNotification_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function KonchatNotification_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function KonchatNotification_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?KonchatNotification_ownKeys(Object(t),!0).forEach((function(r){KonchatNotification_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):KonchatNotification_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function KonchatNotification_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function KonchatNotification_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){KonchatNotification_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){KonchatNotification_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}function KonchatNotification_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,KonchatNotification_toPropertyKey(o.key),o)}}function KonchatNotification_defineProperty(e,r,t){return(r=KonchatNotification_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function KonchatNotification_toPropertyKey(t){var i=function KonchatNotification_toPrimitive(t,r){if("object"!=KonchatNotification_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=KonchatNotification_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==KonchatNotification_typeof(i)?i:i+""}var KonchatNotification=function(){function KonchatNotification(){!function KonchatNotification_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,KonchatNotification),KonchatNotification_defineProperty(this,"notificationStatus",new meteor.Hw(void 0))}var _newMessage,_showDesktop,_notify;return function KonchatNotification_createClass(e,r,t){return r&&KonchatNotification_defineProperties(e.prototype,r),t&&KonchatNotification_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(KonchatNotification,[{key:"getDesktopPermission",value:function getDesktopPermission(){var _this=this;if(window.Notification&&"granted"!==Notification.permission)return Notification.requestPermission((function(status){_this.notificationStatus.set(status)}))}},{key:"notify",value:(_notify=KonchatNotification_asyncToGenerator(KonchatNotification_regeneratorRuntime().mark((function _callee(notification){var _notification$payload,_notification$duratio,rid,message,requireInteraction,n,notificationDuration;return KonchatNotification_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(void 0!==window.Notification&&"granted"===Notification.permission){_context.next=2;break}return _context.abrupt("return");case 2:if(notification.payload){_context.next=4;break}return _context.abrupt("return");case 4:if(rid=notification.payload.rid){_context.next=7;break}return _context.abrupt("return");case 7:return _context.next=9,(0,onClientMessageReceived.H)({rid:rid,msg:notification.text,notification:!0});case 9:message=_context.sent,requireInteraction=(0,utils_client.Tj)(meteor.fj.userId(),"desktopNotificationRequireInteraction"),n=new Notification(notification.title,{icon:notification.icon||(0,getUserAvatarURL.k)(null===(_notification$payload=notification.payload.sender)||void 0===_notification$payload?void 0:_notification$payload.username),body:(0,stringUtils.Kq)(message.msg),tag:notification.payload._id,canReply:!0,silent:!0,requireInteraction:requireInteraction}),(notificationDuration=requireInteraction?-1:(null!==(_notification$duratio=notification.duration)&&void 0!==_notification$duratio?_notification$duratio:0)-0||10)>0&&setTimeout((function(){return n.close()}),1e3*notificationDuration),n.addEventListener&&n.addEventListener("reply",(function(_ref){var response=_ref.response;SDKClient.sdk.call("sendMessage",{_id:main_client.o.id(),rid:rid,msg:response})})),n.onclick=function(){var _notification$payload2;if(this.close(),window.focus(),notification.payload._id&&notification.payload.rid&&notification.payload.name)switch(null===(_notification$payload2=notification.payload)||void 0===_notification$payload2?void 0:_notification$payload2.type){case"d":return RouterProvider.Q.navigate({pattern:"/direct/:rid/:tab?/:context?",params:KonchatNotification_objectSpread({rid:notification.payload.rid},notification.payload.tmid&&{tab:"thread",context:notification.payload.tmid}),search:KonchatNotification_objectSpread(KonchatNotification_objectSpread({},RouterProvider.Q.getSearchParameters()),{},{jump:notification.payload._id})});case"c":return RouterProvider.Q.navigate({pattern:"/channel/:name/:tab?/:context?",params:KonchatNotification_objectSpread({name:notification.payload.name},notification.payload.tmid&&{tab:"thread",context:notification.payload.tmid}),search:KonchatNotification_objectSpread(KonchatNotification_objectSpread({},RouterProvider.Q.getSearchParameters()),{},{jump:notification.payload._id})});case"p":return RouterProvider.Q.navigate({pattern:"/group/:name/:tab?/:context?",params:KonchatNotification_objectSpread({name:notification.payload.name},notification.payload.tmid&&{tab:"thread",context:notification.payload.tmid}),search:KonchatNotification_objectSpread(KonchatNotification_objectSpread({},RouterProvider.Q.getSearchParameters()),{},{jump:notification.payload._id})});case"l":return RouterProvider.Q.navigate({pattern:"/live/:id/:tab?/:context?",params:{id:notification.payload.rid,tab:"room-info"},search:KonchatNotification_objectSpread(KonchatNotification_objectSpread({},RouterProvider.Q.getSearchParameters()),{},{jump:notification.payload._id})})}};case 16:case"end":return _context.stop()}}),_callee)}))),function notify(_x){return _notify.apply(this,arguments)})},{key:"showDesktop",value:(_showDesktop=KonchatNotification_asyncToGenerator(KonchatNotification_regeneratorRuntime().mark((function _callee2(notification){var _notification$payload3,_Meteor$user,_notification$payload4,_notification$payload5,e2eRoom,_this2=this;return KonchatNotification_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(notification.payload.rid){_context2.next=2;break}return _context2.abrupt("return");case 2:if((null===(_notification$payload3=notification.payload)||void 0===_notification$payload3?void 0:_notification$payload3.rid)!==RoomManager.RoomManager.opened||!("function"==typeof window.document.hasFocus?window.document.hasFocus():void 0)){_context2.next=4;break}return _context2.abrupt("return");case 4:if("busy"!==(null===(_Meteor$user=meteor.fj.user())||void 0===_Meteor$user?void 0:_Meteor$user.status)){_context2.next=6;break}return _context2.abrupt("return");case 6:if("e2e"!==(null===(_notification$payload4=notification.payload)||void 0===_notification$payload4||null===(_notification$payload4=_notification$payload4.message)||void 0===_notification$payload4?void 0:_notification$payload4.t)){_context2.next=14;break}return _context2.next=9,e2e_client.D.getInstanceByRoomId(notification.payload.rid);case 9:if(!(e2eRoom=_context2.sent)){_context2.next=14;break}return _context2.next=13,e2eRoom.decrypt(notification.payload.message.msg);case 13:notification.text=_context2.sent.text;case 14:return _context2.abrupt("return",getAvatarAsPng(null===(_notification$payload5=notification.payload)||void 0===_notification$payload5||null===(_notification$payload5=_notification$payload5.sender)||void 0===_notification$payload5?void 0:_notification$payload5.username,(function(avatarAsPng){return notification.icon=avatarAsPng,_this2.notify(notification)})));case 15:case"end":return _context2.stop()}}),_callee2)}))),function showDesktop(_x2){return _showDesktop.apply(this,arguments)})},{key:"newMessage",value:(_newMessage=KonchatNotification_asyncToGenerator(KonchatNotification_regeneratorRuntime().mark((function _callee3(rid){var _Meteor$user2,userId,newMessageNotification,audioVolume,sub;return KonchatNotification_regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if("busy"!==(null===(_Meteor$user2=meteor.fj.user())||void 0===_Meteor$user2?void 0:_Meteor$user2.status)){_context3.next=2;break}return _context3.abrupt("return");case 2:if(userId=meteor.fj.userId(),newMessageNotification=(0,utils_client.Tj)(userId,"newMessageNotification"),audioVolume=(0,utils_client.Tj)(userId,"notificationsSoundVolume",100),rid){_context3.next=7;break}return _context3.abrupt("return");case 7:if((sub=models_client.ChatSubscription.findOne({rid:rid},{fields:{audioNotificationValue:1}}))&&"none"!==sub.audioNotificationValue){_context3.next=10;break}return _context3.abrupt("return");case 10:if(_context3.prev=10,!sub.audioNotificationValue||"0"===sub.audioNotificationValue){_context3.next=14;break}return CustomSounds.play(sub.audioNotificationValue,{volume:Number((audioVolume/100).toPrecision(2))}),_context3.abrupt("return");case 14:newMessageNotification&&"none"!==newMessageNotification&&CustomSounds.play(newMessageNotification,{volume:Number((audioVolume/100).toPrecision(2))}),_context3.next=19;break;case 17:_context3.prev=17,_context3.t0=_context3.catch(10);case 19:case"end":return _context3.stop()}}),_callee3,null,[[10,17]])}))),function newMessage(_x3){return _newMessage.apply(this,arguments)})},{key:"newRoom",value:function newRoom(rid){Tracker.nonreactive((function(){var newRoomSound=Session.get("newRoomSound");return newRoomSound=newRoomSound?[].concat(_toConsumableArray(newRoomSound),[rid]):[rid],Session.set("newRoomSound",newRoomSound)}))}},{key:"removeRoomNotification",value:function removeRoomNotification(rid){var _ref2,newRoomSound=null!==(_ref2=Session.get("newRoomSound"))&&void 0!==_ref2?_ref2:[];newRoomSound=newRoomSound.filter((function(_rid){return _rid!==rid})),Tracker.nonreactive((function(){return Session.set("newRoomSound",newRoomSound)}));var link=document.querySelector(".link-room-".concat(rid));null==link||link.classList.remove("new-room-highlight")}}]),KonchatNotification}(),instance=new KonchatNotification,onClientBeforeSendMessage=(0,__webpack_require__("./lib/transforms.ts").o)();function sendMessage_typeof(o){return sendMessage_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},sendMessage_typeof(o)}function sendMessage_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function sendMessage_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?sendMessage_ownKeys(Object(t),!0).forEach((function(r){sendMessage_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):sendMessage_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function sendMessage_defineProperty(e,r,t){return(r=function sendMessage_toPropertyKey(t){var i=function sendMessage_toPrimitive(t,r){if("object"!=sendMessage_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=sendMessage_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==sendMessage_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function sendMessage_regeneratorRuntime(){sendMessage_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==sendMessage_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(sendMessage_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function sendMessage_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function sendMessage_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){sendMessage_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){sendMessage_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var process=function(){var _ref=sendMessage_asyncToGenerator(sendMessage_regeneratorRuntime().mark((function _callee(chat,message,previewUrls,isSlashCommandAllowed){return sendMessage_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return instance.removeRoomNotification(message.rid),_context.next=3,processSetReaction(chat,message);case 3:if(!_context.sent){_context.next=5;break}return _context.abrupt("return");case 5:return _context.next=7,processTooLongMessage(chat,message);case 7:if(!_context.sent){_context.next=9;break}return _context.abrupt("return");case 9:if(_context.t0=isSlashCommandAllowed,!_context.t0){_context.next=14;break}return _context.next=13,processSlashCommand(chat,message);case 13:_context.t0=_context.sent;case 14:if(!_context.t0){_context.next=16;break}return _context.abrupt("return");case 16:return _context.next=18,onClientBeforeSendMessage(message);case 18:return delete(message=_context.sent).e2e,_context.next=22,processMessageEditing(chat,message,previewUrls);case 22:if(!_context.sent){_context.next=24;break}return _context.abrupt("return");case 24:return _context.next=26,SDKClient.sdk.call("sendMessage",message,previewUrls);case 26:case"end":return _context.stop()}}),_callee)})));return function process(_x,_x2,_x3,_x4){return _ref.apply(this,arguments)}}(),sendMessage=function(){var _ref3=sendMessage_asyncToGenerator(sendMessage_regeneratorRuntime().mark((function _callee2(chat,_ref2){var text,tshow,previewUrls,isSlashCommandAllowed,_chat$composer$quoted,_chat$composer,message,originalMessage,_chat$composer2,_originalMessage,_chat$currentEditing;return sendMessage_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return text=_ref2.text,tshow=_ref2.tshow,previewUrls=_ref2.previewUrls,isSlashCommandAllowed=_ref2.isSlashCommandAllowed,_context2.next=3,chat.data.isSubscribedToRoom();case 3:if(_context2.sent){_context2.next=13;break}return _context2.prev=4,_context2.next=7,chat.data.joinRoom();case 7:_context2.next=13;break;case 9:return _context2.prev=9,_context2.t0=_context2.catch(4),(0,toast.b)({type:"error",message:_context2.t0}),_context2.abrupt("return",!1);case 13:if(chat.readStateManager.clearUnreadMark(),(text=text.trim())||chat.currentEditing){_context2.next=17;break}return _context2.abrupt("return",!1);case 17:if(!text){_context2.next=49;break}if(_context2.t1=chat.data,_context2.t2=text,_context2.t3=tshow,_context2.t4=null!==(_chat$composer$quoted=null===(_chat$composer=chat.composer)||void 0===_chat$composer?void 0:_chat$composer.quotedMessages.get())&&void 0!==_chat$composer$quoted?_chat$composer$quoted:[],!chat.currentEditing){_context2.next=28;break}return _context2.next=25,chat.data.findMessageByID(chat.currentEditing.mid);case 25:_context2.t5=_context2.sent,_context2.next=29;break;case 28:_context2.t5=null;case 29:return _context2.t6=_context2.t5,_context2.t7={sendToChannel:_context2.t3,quotedMessages:_context2.t4,originalMessage:_context2.t6},_context2.next=33,_context2.t1.composeMessage.call(_context2.t1,_context2.t2,_context2.t7);case 33:if(message=_context2.sent,!chat.currentEditing){_context2.next=39;break}return _context2.next=37,chat.data.findMessageByID(chat.currentEditing.mid);case 37:"e2e"===(null==(originalMessage=_context2.sent)?void 0:originalMessage.t)&&originalMessage.attachments&&originalMessage.attachments.length>0&&void 0!==originalMessage.attachments[0].description&&(originalMessage.attachments[0].description=message.msg,message.attachments=originalMessage.attachments,message.msg=originalMessage.msg);case 39:return _context2.prev=39,_context2.next=42,process(chat,message,previewUrls,isSlashCommandAllowed);case 42:null===(_chat$composer2=chat.composer)||void 0===_chat$composer2||_chat$composer2.dismissAllQuotedMessages(),_context2.next=48;break;case 45:_context2.prev=45,_context2.t8=_context2.catch(39),(0,toast.b)({type:"error",message:_context2.t8});case 48:return _context2.abrupt("return",!0);case 49:if(!chat.currentEditing){_context2.next=72;break}return _context2.next=52,chat.data.findMessageByID(chat.currentEditing.mid);case 52:if(_originalMessage=_context2.sent){_context2.next=56;break}return(0,toast.b)({type:"warning",message:(0,i18n.t)("Message_not_found")}),_context2.abrupt("return",!1);case 56:return _context2.prev=56,_context2.next=59,chat.flows.processMessageEditing(sendMessage_objectSpread(sendMessage_objectSpread({},_originalMessage),{},{msg:""}),previewUrls);case 59:if(!_context2.sent){_context2.next=62;break}return chat.currentEditing.stop(),_context2.abrupt("return",!1);case 62:return _context2.next=64,null===(_chat$currentEditing=chat.currentEditing)||void 0===_chat$currentEditing?void 0:_chat$currentEditing.reset();case 64:return _context2.next=66,chat.flows.requestMessageDeletion(_originalMessage);case 66:return _context2.abrupt("return",!1);case 69:_context2.prev=69,_context2.t9=_context2.catch(56),(0,toast.b)({type:"error",message:_context2.t9});case 72:return _context2.abrupt("return",!1);case 73:case"end":return _context2.stop()}}),_callee2,null,[[4,9],[39,45],[56,69]])})));return function sendMessage(_x5,_x6){return _ref3.apply(this,arguments)}}(),getFileExtension=__webpack_require__("./lib/utils/getFileExtension.ts"),FileUploadModal=__webpack_require__("./client/views/room/modals/FileUploadModal/index.ts");function uploadFiles_typeof(o){return uploadFiles_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},uploadFiles_typeof(o)}function uploadFiles_regeneratorRuntime(){uploadFiles_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==uploadFiles_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(uploadFiles_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function uploadFiles_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function uploadFiles_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?uploadFiles_ownKeys(Object(t),!0).forEach((function(r){uploadFiles_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):uploadFiles_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function uploadFiles_defineProperty(e,r,t){return(r=function uploadFiles_toPropertyKey(t){var i=function uploadFiles_toPrimitive(t,r){if("object"!=uploadFiles_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=uploadFiles_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==uploadFiles_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function uploadFiles_toConsumableArray(r){return function uploadFiles_arrayWithoutHoles(r){if(Array.isArray(r))return uploadFiles_arrayLikeToArray(r)}(r)||function uploadFiles_iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||function uploadFiles_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return uploadFiles_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?uploadFiles_arrayLikeToArray(r,a):void 0}}(r)||function uploadFiles_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uploadFiles_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function uploadFiles_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function uploadFiles_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){uploadFiles_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){uploadFiles_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var getHeightAndWidthFromDataUrl=function getHeightAndWidthFromDataUrl(dataURL){return new Promise((function(resolve){var img=new Image;img.onload=function(){resolve({height:img.height,width:img.width})},img.src=dataURL}))},uploadFiles=function(){var _ref=uploadFiles_asyncToGenerator(uploadFiles_regeneratorRuntime().mark((function _callee3(chat,files,resetFileInput){var _chat$composer$quoted,_chat$composer,replies,msg,room,queue,uploadFile,uploadNextFile;return uploadFiles_regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return replies=null!==(_chat$composer$quoted=null===(_chat$composer=chat.composer)||void 0===_chat$composer?void 0:_chat$composer.quotedMessages.get())&&void 0!==_chat$composer$quoted?_chat$composer$quoted:[],_context3.next=3,(0,prependReplies.j)("",replies);case 3:return msg=_context3.sent,_context3.next=6,chat.data.getRoom();case 6:room=_context3.sent,queue=uploadFiles_toConsumableArray(files),uploadFile=function uploadFile(file,extraData,getContent,fileContent){var _chat$composer2;chat.uploads.send(file,uploadFiles_objectSpread({msg:msg},extraData),getContent,fileContent),null===(_chat$composer2=chat.composer)||void 0===_chat$composer2||_chat$composer2.clear(),imperativeModal.K.close(),uploadNextFile()},uploadNextFile=function uploadNextFile(){var _chat$composer$text,_chat$composer4,_onSubmit,_chat$composer3,file=queue.pop();file?imperativeModal.K.open({component:FileUploadModal.A,props:{file:file,fileName:file.name,fileDescription:null!==(_chat$composer$text=null===(_chat$composer4=chat.composer)||void 0===_chat$composer4?void 0:_chat$composer4.text)&&void 0!==_chat$composer$text?_chat$composer$text:"",showDescription:room&&!(0,core_typings_dist.isRoomFederated)(room),onClose:function onClose(){imperativeModal.K.close(),uploadNextFile()},onSubmit:(_onSubmit=uploadFiles_asyncToGenerator(uploadFiles_regeneratorRuntime().mark((function _callee2(fileName,description){var e2eRoom,encryptedFile,getContent,fileContentData,fileContent;return uploadFiles_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return Object.defineProperty(file,"name",{writable:!0,value:fileName}),_context2.next=3,e2e_client.D.getInstanceByRoomId(room._id);case 3:if(e2eRoom=_context2.sent){_context2.next=7;break}return uploadFile(file,{description:description}),_context2.abrupt("return");case 7:if(settings_client.W.get("E2E_Enable_Encrypt_Files")){_context2.next=10;break}return uploadFile(file,{description:description}),_context2.abrupt("return");case 10:return _context2.next=12,e2eRoom.shouldConvertSentMessages({msg:msg});case 12:if(_context2.sent){_context2.next=16;break}return uploadFile(file,{description:description}),_context2.abrupt("return");case 16:return _context2.next=18,e2eRoom.encryptFile(file);case 18:if(!(encryptedFile=_context2.sent)){_context2.next=28;break}return getContent=function(){var _ref2=uploadFiles_asyncToGenerator(uploadFiles_regeneratorRuntime().mark((function _callee(_id,fileUrl){var attachments,attachment,dimensions,files;return uploadFiles_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(attachments=[],attachment={title:file.name,type:"file",description:description,title_link:fileUrl,title_link_download:!0,encryption:{key:encryptedFile.key,iv:encryptedFile.iv},hashes:{sha256:encryptedFile.hash}},!/^image\/.+/.test(file.type)){_context.next=9;break}return _context.next=5,getHeightAndWidthFromDataUrl(window.URL.createObjectURL(file));case 5:dimensions=_context.sent,attachments.push(uploadFiles_objectSpread(uploadFiles_objectSpread({},attachment),{},{image_url:fileUrl,image_type:file.type,image_size:file.size},dimensions&&{image_dimensions:dimensions})),_context.next=10;break;case 9:/^audio\/.+/.test(file.type)?attachments.push(uploadFiles_objectSpread(uploadFiles_objectSpread({},attachment),{},{audio_url:fileUrl,audio_type:file.type,audio_size:file.size})):/^video\/.+/.test(file.type)?attachments.push(uploadFiles_objectSpread(uploadFiles_objectSpread({},attachment),{},{video_url:fileUrl,video_type:file.type,video_size:file.size})):attachments.push(uploadFiles_objectSpread(uploadFiles_objectSpread({},attachment),{},{size:file.size,format:(0,getFileExtension.Q)(file.name)}));case 10:return files=[{_id:_id,name:file.name,type:file.type,size:file.size}],_context.abrupt("return",e2eRoom.encryptMessageContent({attachments:attachments,files:files,file:files[0]}));case 12:case"end":return _context.stop()}}),_callee)})));return function getContent(_x6,_x7){return _ref2.apply(this,arguments)}}(),fileContentData={type:file.type,typeGroup:file.type.split("/")[0],name:fileName,encryption:{key:encryptedFile.key,iv:encryptedFile.iv},hashes:{sha256:encryptedFile.hash}},_context2.t0=fileContentData,_context2.next=25,e2eRoom.encryptMessageContent(fileContentData);case 25:_context2.t1=_context2.sent,fileContent={raw:_context2.t0,encrypted:_context2.t1},uploadFile(encryptedFile.file,{t:"e2e"},getContent,fileContent);case 28:case"end":return _context2.stop()}}),_callee2)}))),function onSubmit(_x4,_x5){return _onSubmit.apply(this,arguments)}),invalidContentType:!(0,utils_client.nj)(null==file?void 0:file.type)}}):null===(_chat$composer3=chat.composer)||void 0===_chat$composer3||_chat$composer3.dismissAllQuotedMessages()},uploadNextFile(),null==resetFileInput||resetFileInput();case 12:case"end":return _context3.stop()}}),_callee3)})));return function uploadFiles(_x,_x2,_x3){return _ref.apply(this,arguments)}}(),index_module=__webpack_require__("./node_modules/@rocket.chat/emitter/dist/index.module.js"),LegacyRoomManager=__webpack_require__("./app/ui-utils/client/lib/LegacyRoomManager.ts"),RoomHistoryManager=__webpack_require__("./app/ui-utils/client/lib/RoomHistoryManager.ts"),highOrderFunctions=__webpack_require__("./lib/utils/highOrderFunctions.ts");function readStateManager_typeof(o){return readStateManager_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},readStateManager_typeof(o)}function readStateManager_regeneratorRuntime(){readStateManager_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==readStateManager_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(readStateManager_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function readStateManager_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function readStateManager_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,readStateManager_toPropertyKey(o.key),o)}}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _createSuper(t){var r=_isNativeReflectConstruct();return function(){var e,o=_getPrototypeOf(t);if(r){var s=_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function _possibleConstructorReturn(t,e){if(e&&("object"==readStateManager_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}(this,e)}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function readStateManager_defineProperty(e,r,t){return(r=readStateManager_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function readStateManager_toPropertyKey(t){var i=function readStateManager_toPrimitive(t,r){if("object"!=readStateManager_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=readStateManager_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==readStateManager_typeof(i)?i:i+""}var ReadStateManager=function(_Emitter){!function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}(ReadStateManager,_Emitter);var _markAsRead,_super=_createSuper(ReadStateManager);function ReadStateManager(rid){var _this;return function readStateManager_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,ReadStateManager),readStateManager_defineProperty(_assertThisInitialized(_this=_super.call(this)),"rid",void 0),readStateManager_defineProperty(_assertThisInitialized(_this),"firstUnreadRecordId",void 0),readStateManager_defineProperty(_assertThisInitialized(_this),"subscription",void 0),readStateManager_defineProperty(_assertThisInitialized(_this),"onUnreadStateChange",(function(callback){return _this.on("unread-state-change",callback)})),readStateManager_defineProperty(_assertThisInitialized(_this),"getFirstUnreadRecordId",(function(){return _this.firstUnreadRecordId})),readStateManager_defineProperty(_assertThisInitialized(_this),"handleWindowEvents",(function(){var handleWindowFocus=function handleWindowFocus(){_this.attemptMarkAsRead()},handleWindowKeyUp=function handleWindowKeyUp(event){"Escape"===event.key&&(_this.markAsRead(),_this.updateFirstUnreadRecordId())};return window.addEventListener("focus",handleWindowFocus),window.addEventListener("keyup",handleWindowKeyUp),function(){window.removeEventListener("focus",handleWindowFocus),window.removeEventListener("keyup",handleWindowKeyUp)}})),readStateManager_defineProperty(_assertThisInitialized(_this),"debouncedMarkAsRead",(0,highOrderFunctions.z)({wait:1e3})((function(){try{return _this.markAsRead()}catch(e){console.error(e)}}))),_this.rid=rid,_this}return function readStateManager_createClass(e,r,t){return r&&readStateManager_defineProperties(e.prototype,r),t&&readStateManager_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(ReadStateManager,[{key:"getRid",value:function getRid(){return this.rid}},{key:"unreadMark",get:function get(){return document.querySelector(".rcx-message-divider--unread")}},{key:"updateSubscription",value:function updateSubscription(subscription){var _LegacyRoomManager$ge;if(subscription){var firstUpdate=!this.subscription;this.subscription=subscription,null===(_LegacyRoomManager$ge=LegacyRoomManager.c.getOpenedRoomByRid(this.rid))||void 0===_LegacyRoomManager$ge||_LegacyRoomManager$ge.unreadSince.set(this.subscription.ls);var _this$subscription=this.subscription,unread=_this$subscription.unread,alert=_this$subscription.alert;(unread||alert)&&(firstUpdate?this.updateFirstUnreadRecordId():document.hasFocus()&&this.firstUnreadRecordId||this.updateFirstUnreadRecordId())}}},{key:"updateFirstUnreadRecordId",value:function updateFirstUnreadRecordId(){var _this$subscription2,_Meteor$userId,_this2=this;if(null!==(_this$subscription2=this.subscription)&&void 0!==_this$subscription2&&_this$subscription2.ls){var firstUnreadRecord=models_client.ChatMessage.findOne({rid:this.subscription.rid,ts:{$gt:this.subscription.ls},"u._id":{$ne:null!==(_Meteor$userId=meteor.fj.userId())&&void 0!==_Meteor$userId?_Meteor$userId:void 0}},{sort:{ts:1}});this.setFirstUnreadRecordId(null==firstUnreadRecord?void 0:firstUnreadRecord._id),RoomHistoryManager.PV.once("loaded-messages",(function(){return _this2.updateFirstUnreadRecordId()}))}}},{key:"setFirstUnreadRecordId",value:function setFirstUnreadRecordId(firstUnreadRecordId){this.firstUnreadRecordId=firstUnreadRecordId,this.emit("unread-state-change",this.firstUnreadRecordId)}},{key:"clearUnreadMark",value:function clearUnreadMark(){this.setFirstUnreadRecordId(void 0)}},{key:"isUnreadMarkVisible",value:function isUnreadMarkVisible(){var _this$unreadMark$offs;return!!this.unreadMark&&this.unreadMark.offsetTop>((null===(_this$unreadMark$offs=this.unreadMark.offsetParent)||void 0===_this$unreadMark$offs?void 0:_this$unreadMark$offs.scrollTop)||0)}},{key:"attemptMarkAsRead",value:function attemptMarkAsRead(){var _ref=this.subscription||{},alert=_ref.alert,unread=_ref.unread;if((alert||0!==unread)&&document.hasFocus()&&(!this.unreadMark||this.isUnreadMarkVisible())&&!(RoomHistoryManager.PV.getRoom(this.rid).unreadNotLoaded.get()>0))return this.markAsRead()}},{key:"markAsRead",value:(_markAsRead=function readStateManager_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){readStateManager_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){readStateManager_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(readStateManager_regeneratorRuntime().mark((function _callee(){var _this3=this;return readStateManager_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(this.rid){_context.next=2;break}return _context.abrupt("return");case 2:return _context.abrupt("return",SDKClient.sdk.rest.post("/v1/subscriptions.read",{rid:this.rid}).then((function(){RoomHistoryManager.PV.getRoom(_this3.rid).unreadNotLoaded.set(0)})));case 3:case"end":return _context.stop()}}),_callee,this)}))),function markAsRead(){return _markAsRead.apply(this,arguments)})}]),ReadStateManager}(index_module.v),UserAction=__webpack_require__("./app/ui/client/lib/UserAction.ts"),errorHandling=__webpack_require__("./client/lib/errorHandling.ts");function uploads_typeof(o){return uploads_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},uploads_typeof(o)}function uploads_regeneratorRuntime(){uploads_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==uploads_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(uploads_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function uploads_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function uploads_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?uploads_ownKeys(Object(t),!0).forEach((function(r){uploads_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):uploads_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function uploads_defineProperty(e,r,t){return(r=function uploads_toPropertyKey(t){var i=function uploads_toPrimitive(t,r){if("object"!=uploads_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=uploads_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==uploads_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function uploads_toConsumableArray(r){return function uploads_arrayWithoutHoles(r){if(Array.isArray(r))return uploads_arrayLikeToArray(r)}(r)||function uploads_iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||function uploads_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return uploads_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?uploads_arrayLikeToArray(r,a):void 0}}(r)||function uploads_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uploads_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function uploads_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function uploads_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){uploads_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){uploads_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var uploads=[],emitter=new index_module.v,updateUploads=function updateUploads(update){uploads=update(uploads),emitter.emit("update")},get=function get(){return uploads},subscribe=function subscribe(callback){return emitter.on("update",callback)},cancel=function cancel(id){emitter.emit("cancelling-".concat(id))},wipeFailedOnes=function wipeFailedOnes(){updateUploads((function(uploads){return uploads.filter((function(upload){return!upload.error}))}))},_send=function(){var _ref2=uploads_asyncToGenerator(uploads_regeneratorRuntime().mark((function _callee2(file,_ref,getContent,fileContent){var description,msg,rid,tmid,t,id;return uploads_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return description=_ref.description,msg=_ref.msg,rid=_ref.rid,tmid=_ref.tmid,t=_ref.t,id=main_client.o.id(),updateUploads((function(uploads){return[].concat(uploads_toConsumableArray(uploads),[{id:id,name:(null==fileContent?void 0:fileContent.raw.name)||file.name,percentage:0}])})),_context2.prev=3,_context2.next=6,new Promise((function(resolve,reject){var xhr=SDKClient.sdk.rest.upload("/v1/rooms.media/".concat(rid),uploads_objectSpread({file:file},fileContent&&{content:JSON.stringify(fileContent.encrypted)}),{load:function load(event){resolve(event)},progress:function progress(event){if(event.lengthComputable){var progress=event.loaded/event.total*100;100!==progress&&updateUploads((function(uploads){return uploads.map((function(upload){return upload.id!==id?upload:uploads_objectSpread(uploads_objectSpread({},upload),{},{percentage:Math.round(progress)||0})}))}))}},error:function error(event){updateUploads((function(uploads){return uploads.map((function(upload){return upload.id!==id?upload:uploads_objectSpread(uploads_objectSpread({},upload),{},{percentage:0,error:new Error(xhr.responseText)})}))})),reject(event)}});xhr.onload=uploads_asyncToGenerator(uploads_regeneratorRuntime().mark((function _callee(){var result,content;return uploads_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(xhr.readyState!==xhr.DONE||200!==xhr.status){_context.next=8;break}if(result=JSON.parse(xhr.responseText),!getContent){_context.next=6;break}return _context.next=5,getContent(result.file._id,result.file.url);case 5:content=_context.sent;case 6:return _context.next=8,SDKClient.sdk.rest.post("/v1/rooms.mediaConfirm/".concat(rid,"/").concat(result.file._id),{msg:msg,tmid:tmid,description:description,t:t,content:content});case 8:case"end":return _context.stop()}}),_callee)}))),uploads.length&&UserAction.a.performContinuously(rid,UserAction.A.USER_UPLOADING,{tmid:tmid}),emitter.once("cancelling-".concat(id),(function(){xhr.abort(),updateUploads((function(uploads){return uploads.filter((function(upload){return upload.id!==id}))}))}))}));case 6:updateUploads((function(uploads){return uploads.filter((function(upload){return upload.id!==id}))})),_context2.next=12;break;case 9:_context2.prev=9,_context2.t0=_context2.catch(3),updateUploads((function(uploads){return uploads.map((function(upload){return upload.id!==id?upload:uploads_objectSpread(uploads_objectSpread({},upload),{},{percentage:0,error:new Error((0,errorHandling.u)(_context2.t0))})}))}));case 12:return _context2.prev=12,uploads.length||UserAction.a.stop(rid,UserAction.A.USER_UPLOADING,{tmid:tmid}),_context2.finish(12);case 15:case"end":return _context2.stop()}}),_callee2,null,[[3,9,12,15]])})));return function send(_x,_x2,_x3,_x4){return _ref2.apply(this,arguments)}}(),messageHighlightSubscription=__webpack_require__("./client/views/room/MessageList/providers/messageHighlightSubscription.ts");function ChatMessages_typeof(o){return ChatMessages_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},ChatMessages_typeof(o)}function ChatMessages_regeneratorRuntime(){ChatMessages_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==ChatMessages_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(ChatMessages_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function ChatMessages_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function ChatMessages_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){ChatMessages_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){ChatMessages_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}function ChatMessages_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ChatMessages_toPropertyKey(o.key),o)}}function ChatMessages_defineProperty(e,r,t){return(r=ChatMessages_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function ChatMessages_toPropertyKey(t){var i=function ChatMessages_toPrimitive(t,r){if("object"!=ChatMessages_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=ChatMessages_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==ChatMessages_typeof(i)?i:i+""}var ChatMessages=function(){function ChatMessages(params){var _editMessage,_toNextMessage,_toPreviousMessage,_this=this;!function ChatMessages_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,ChatMessages),ChatMessages_defineProperty(this,"uid",void 0),ChatMessages_defineProperty(this,"composer",void 0),ChatMessages_defineProperty(this,"setComposerAPI",(function(composer){var _this$composer;null===(_this$composer=_this.composer)||void 0===_this$composer||_this$composer.release(),_this.composer=composer})),ChatMessages_defineProperty(this,"data",void 0),ChatMessages_defineProperty(this,"readStateManager",void 0),ChatMessages_defineProperty(this,"uploads",void 0),ChatMessages_defineProperty(this,"ActionManager",void 0),ChatMessages_defineProperty(this,"emojiPicker",void 0),ChatMessages_defineProperty(this,"action",void 0),ChatMessages_defineProperty(this,"currentEditingMID",void 0),ChatMessages_defineProperty(this,"messageEditing",{toPreviousMessage:(_toPreviousMessage=ChatMessages_asyncToGenerator(ChatMessages_regeneratorRuntime().mark((function _callee(){var lastMessage,currentMessage,previousMessage;return ChatMessages_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_this.composer){_context.next=2;break}return _context.abrupt("return");case 2:if(_this.currentEditing){_context.next=16;break}return _context.next=5,_this.data.findLastOwnMessage();case 5:if(!(lastMessage=_context.sent)||!(0,core_typings_dist.isVideoConfMessage)(lastMessage)){_context.next=10;break}return _context.next=9,_this.data.findPreviousOwnMessage(lastMessage);case 9:lastMessage=_context.sent;case 10:if(!lastMessage){_context.next=15;break}return _context.next=13,_this.data.saveDraft(void 0,_this.composer.text);case 13:return _context.next=15,_this.messageEditing.editMessage(lastMessage);case 15:return _context.abrupt("return");case 16:return _context.next=18,_this.data.findMessageByID(_this.currentEditing.mid);case 18:if(!(currentMessage=_context.sent)){_context.next=25;break}return _context.next=22,_this.data.findPreviousOwnMessage(currentMessage);case 22:_context.t0=_context.sent,_context.next=26;break;case 25:_context.t0=void 0;case 26:if(!(previousMessage=_context.t0)||!(0,core_typings_dist.isVideoConfMessage)(previousMessage)){_context.next=31;break}return _context.next=30,_this.data.findPreviousOwnMessage(previousMessage);case 30:previousMessage=_context.sent;case 31:if(!previousMessage){_context.next=35;break}return _context.next=34,_this.messageEditing.editMessage(previousMessage);case 34:return _context.abrupt("return");case 35:return _context.next=37,_this.currentEditing.cancel();case 37:case"end":return _context.stop()}}),_callee)}))),function toPreviousMessage(){return _toPreviousMessage.apply(this,arguments)}),toNextMessage:(_toNextMessage=ChatMessages_asyncToGenerator(ChatMessages_regeneratorRuntime().mark((function _callee2(){var currentMessage,nextMessage;return ChatMessages_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(_this.composer&&_this.currentEditing){_context2.next=2;break}return _context2.abrupt("return");case 2:return _context2.next=4,_this.data.findMessageByID(_this.currentEditing.mid);case 4:if(!(currentMessage=_context2.sent)){_context2.next=11;break}return _context2.next=8,_this.data.findNextOwnMessage(currentMessage);case 8:_context2.t0=_context2.sent,_context2.next=12;break;case 11:_context2.t0=void 0;case 12:if(!(nextMessage=_context2.t0)||!(0,core_typings_dist.isVideoConfMessage)(nextMessage)){_context2.next=17;break}return _context2.next=16,_this.data.findNextOwnMessage(nextMessage);case 16:nextMessage=_context2.sent;case 17:if(!nextMessage){_context2.next=21;break}return _context2.next=20,_this.messageEditing.editMessage(nextMessage,{cursorAtStart:!0});case 20:return _context2.abrupt("return");case 21:return _context2.next=23,_this.currentEditing.cancel();case 23:case"end":return _context2.stop()}}),_callee2)}))),function toNextMessage(){return _toNextMessage.apply(this,arguments)}),editMessage:(_editMessage=ChatMessages_asyncToGenerator(ChatMessages_regeneratorRuntime().mark((function _callee3(message){var _message$attachments,_this$currentEditing,_ref$cursorAtStart,cursorAtStart,text,_args3=arguments;return ChatMessages_regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _ref$cursorAtStart=(_args3.length>1&&void 0!==_args3[1]?_args3[1]:{}).cursorAtStart,cursorAtStart=void 0!==_ref$cursorAtStart&&_ref$cursorAtStart,_context3.next=3,_this.data.getDraft(message._id);case 3:if(_context3.t1=_context3.sent,_context3.t1){_context3.next=6;break}_context3.t1=null===(_message$attachments=message.attachments)||void 0===_message$attachments||null===(_message$attachments=_message$attachments[0])||void 0===_message$attachments?void 0:_message$attachments.description;case 6:if(_context3.t0=_context3.t1,_context3.t0){_context3.next=9;break}_context3.t0=message.msg;case 9:return text=_context3.t0,_context3.next=12,null===(_this$currentEditing=_this.currentEditing)||void 0===_this$currentEditing?void 0:_this$currentEditing.stop();case 12:if(_context3.t2=!_this.composer,_context3.t2){_context3.next=17;break}return _context3.next=16,_this.data.canUpdateMessage(message);case 16:_context3.t2=!_context3.sent;case 17:if(!_context3.t2){_context3.next=19;break}return _context3.abrupt("return");case 19:_this.currentEditingMID=message._id,(0,messageHighlightSubscription.wh)(message._id),_this.composer.setEditingMode(!0),_this.composer.setText(text),cursorAtStart&&_this.composer.setCursorToStart(),!cursorAtStart&&_this.composer.setCursorToEnd(),_this.composer.focus();case 26:case"end":return _context3.stop()}}),_callee3)}))),function editMessage(_x){return _editMessage.apply(this,arguments)})}),ChatMessages_defineProperty(this,"flows",void 0),this.params=params;var rid=params.rid,tmid=params.tmid;this.uid=params.uid,this.data=function createDataAPI(_ref){var rid=_ref.rid,tmid=_ref.tmid,composeMessage=function(){var _ref3=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(text,_ref2){var _originalMessage$rid,_originalMessage$_id,sendToChannel,quotedMessages,originalMessage,msg,effectiveRID,effectiveTMID;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return sendToChannel=_ref2.sendToChannel,quotedMessages=_ref2.quotedMessages,originalMessage=_ref2.originalMessage,_context.next=3,(0,prependReplies.j)(text,quotedMessages);case 3:return msg=_context.sent,effectiveRID=null!==(_originalMessage$rid=null==originalMessage?void 0:originalMessage.rid)&&void 0!==_originalMessage$rid?_originalMessage$rid:rid,effectiveTMID=originalMessage?originalMessage.tmid:tmid,_context.abrupt("return",_objectSpread(_objectSpread({_id:null!==(_originalMessage$_id=null==originalMessage?void 0:originalMessage._id)&&void 0!==_originalMessage$_id?_originalMessage$_id:main_client.o.id(),rid:effectiveRID},effectiveTMID&&_objectSpread({tmid:effectiveTMID},sendToChannel&&{tshow:sendToChannel})),{},{msg:msg}));case 7:case"end":return _context.stop()}}),_callee)})));return function composeMessage(_x,_x2){return _ref3.apply(this,arguments)}}(),findMessageByID=function(){var _ref4=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(mid){var _Messages$findOne;return _regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",null!==(_Messages$findOne=models_client.Messages.findOne({_id:mid,_hidden:{$ne:!0}},{reactive:!1}))&&void 0!==_Messages$findOne?_Messages$findOne:SDKClient.sdk.call("getSingleMessage",mid));case 1:case"end":return _context2.stop()}}),_callee2)})));return function findMessageByID(_x3){return _ref4.apply(this,arguments)}}(),getMessageByID=function(){var _ref5=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(mid){var message;return _regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,findMessageByID(mid);case 2:if(message=_context3.sent){_context3.next=5;break}throw new Error("Message not found");case 5:return _context3.abrupt("return",message);case 6:case"end":return _context3.stop()}}),_callee3)})));return function getMessageByID(_x4){return _ref5.apply(this,arguments)}}(),findLastMessage=function(){var _ref6=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(){return _regeneratorRuntime().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",models_client.Messages.findOne({rid:rid,tmid:null!=tmid?tmid:{$exists:!1},_hidden:{$ne:!0}},{sort:{ts:-1},reactive:!1}));case 1:case"end":return _context4.stop()}}),_callee4)})));return function findLastMessage(){return _ref6.apply(this,arguments)}}(),getLastMessage=function(){var _ref7=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(){var message;return _regeneratorRuntime().wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,findLastMessage();case 2:if(message=_context5.sent){_context5.next=5;break}throw new Error("Message not found");case 5:return _context5.abrupt("return",message);case 6:case"end":return _context5.stop()}}),_callee5)})));return function getLastMessage(){return _ref7.apply(this,arguments)}}(),findLastOwnMessage=function(){var _ref8=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(){var uid;return _regeneratorRuntime().wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(uid=Meteor.userId()){_context6.next=3;break}return _context6.abrupt("return",void 0);case 3:return _context6.abrupt("return",models_client.Messages.findOne({rid:rid,tmid:null!=tmid?tmid:{$exists:!1},"u._id":uid,_hidden:{$ne:!0}},{sort:{ts:-1},reactive:!1}));case 4:case"end":return _context6.stop()}}),_callee6)})));return function findLastOwnMessage(){return _ref8.apply(this,arguments)}}(),getLastOwnMessage=function(){var _ref9=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(){var message;return _regeneratorRuntime().wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=2,findLastOwnMessage();case 2:if(message=_context7.sent){_context7.next=5;break}throw new Error("Message not found");case 5:return _context7.abrupt("return",message);case 6:case"end":return _context7.stop()}}),_callee7)})));return function getLastOwnMessage(){return _ref9.apply(this,arguments)}}(),canUpdateMessage=function(){var _ref10=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(message){var _ref11,canEditMessage,editAllowed,editOwn,blockEditInMinutes,bypassBlockTimeLimit,elapsedMinutes;return _regeneratorRuntime().wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(!ui_utils_client.MessageTypes.isSystemMessage(message)){_context8.next=2;break}return _context8.abrupt("return",!1);case 2:if(canEditMessage=(0,client.WX)("edit-message",message.rid),editAllowed=null!==(_ref11=settings_client.W.get("Message_AllowEditing"))&&void 0!==_ref11&&_ref11,editOwn=(null==message?void 0:message.u)&&message.u._id===Meteor.userId(),canEditMessage||editAllowed&&editOwn){_context8.next=7;break}return _context8.abrupt("return",!1);case 7:if(blockEditInMinutes=settings_client.W.get("Message_AllowEditing_BlockEditInMinutes"),bypassBlockTimeLimit=(0,client._m)("bypass-time-limit-edit-and-delete",message.rid),elapsedMinutes=moment_default()().diff(message.ts,"minutes"),!(!bypassBlockTimeLimit&&elapsedMinutes&&blockEditInMinutes&&elapsedMinutes>blockEditInMinutes)){_context8.next=12;break}return _context8.abrupt("return",!1);case 12:return _context8.abrupt("return",!0);case 13:case"end":return _context8.stop()}}),_callee8)})));return function canUpdateMessage(_x5){return _ref10.apply(this,arguments)}}(),findPreviousOwnMessage=function(){var _ref12=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(message){var uid,msg;return _regeneratorRuntime().wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(uid=Meteor.userId()){_context9.next=3;break}return _context9.abrupt("return",void 0);case 3:if(msg=models_client.Messages.findOne({rid:rid,tmid:null!=tmid?tmid:{$exists:!1},"u._id":uid,_hidden:{$ne:!0},ts:{$lt:message.ts}},{sort:{ts:-1},reactive:!1})){_context9.next=6;break}return _context9.abrupt("return",void 0);case 6:return _context9.next=8,canUpdateMessage(msg);case 8:if(!_context9.sent){_context9.next=10;break}return _context9.abrupt("return",msg);case 10:return _context9.abrupt("return",findPreviousOwnMessage(msg));case 11:case"end":return _context9.stop()}}),_callee9)})));return function findPreviousOwnMessage(_x6){return _ref12.apply(this,arguments)}}(),getPreviousOwnMessage=function(){var _ref13=_asyncToGenerator(_regeneratorRuntime().mark((function _callee10(message){var previousMessage;return _regeneratorRuntime().wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.next=2,findPreviousOwnMessage(message);case 2:if(previousMessage=_context10.sent){_context10.next=5;break}throw new Error("Message not found");case 5:return _context10.abrupt("return",previousMessage);case 6:case"end":return _context10.stop()}}),_callee10)})));return function getPreviousOwnMessage(_x7){return _ref13.apply(this,arguments)}}(),findNextOwnMessage=function(){var _ref14=_asyncToGenerator(_regeneratorRuntime().mark((function _callee11(message){var uid,msg;return _regeneratorRuntime().wrap((function _callee11$(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:if(uid=Meteor.userId()){_context11.next=3;break}return _context11.abrupt("return",void 0);case 3:if(msg=models_client.Messages.findOne({rid:rid,tmid:null!=tmid?tmid:{$exists:!1},"u._id":uid,_hidden:{$ne:!0},ts:{$gt:message.ts}},{sort:{ts:1},reactive:!1})){_context11.next=6;break}return _context11.abrupt("return",void 0);case 6:return _context11.next=8,canUpdateMessage(msg);case 8:if(!_context11.sent){_context11.next=10;break}return _context11.abrupt("return",msg);case 10:return _context11.abrupt("return",findNextOwnMessage(msg));case 11:case"end":return _context11.stop()}}),_callee11)})));return function findNextOwnMessage(_x8){return _ref14.apply(this,arguments)}}(),getNextOwnMessage=function(){var _ref15=_asyncToGenerator(_regeneratorRuntime().mark((function _callee12(message){var nextMessage;return _regeneratorRuntime().wrap((function _callee12$(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return _context12.next=2,findNextOwnMessage(message);case 2:if(nextMessage=_context12.sent){_context12.next=5;break}throw new Error("Message not found");case 5:return _context12.abrupt("return",nextMessage);case 6:case"end":return _context12.stop()}}),_callee12)})));return function getNextOwnMessage(_x9){return _ref15.apply(this,arguments)}}(),pushEphemeralMessage=function(){var _ref16=_asyncToGenerator(_regeneratorRuntime().mark((function _callee13(message){return _regeneratorRuntime().wrap((function _callee13$(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:models_client.Messages.upsert({_id:message._id},{$set:_objectSpread(_objectSpread({},message),{},{rid:rid},tmid&&{tmid:tmid})});case 1:case"end":return _context13.stop()}}),_callee13)})));return function pushEphemeralMessage(_x10){return _ref16.apply(this,arguments)}}(),updateMessage=function(){var _ref17=_asyncToGenerator(_regeneratorRuntime().mark((function _callee14(message,previewUrls){return _regeneratorRuntime().wrap((function _callee14$(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return _context14.abrupt("return",SDKClient.sdk.call("updateMessage",message,previewUrls));case 1:case"end":return _context14.stop()}}),_callee14)})));return function updateMessage(_x11,_x12){return _ref17.apply(this,arguments)}}(),canDeleteMessage=function(){var _ref18=_asyncToGenerator(_regeneratorRuntime().mark((function _callee15(message){var deleteAnyAllowed,deleteOwnAllowed,deleteAllowed,blockDeleteInMinutes,bypassBlockTimeLimit,elapsedMinutes,onTimeForDelete;return _regeneratorRuntime().wrap((function _callee15$(_context15){for(;;)switch(_context15.prev=_context15.next){case 0:if(Meteor.userId()){_context15.next=3;break}return _context15.abrupt("return",!1);case 3:if(!ui_utils_client.MessageTypes.isSystemMessage(message)){_context15.next=5;break}return _context15.abrupt("return",!1);case 5:if(!(0,client._m)("force-delete-message",message.rid)){_context15.next=8;break}return _context15.abrupt("return",!0);case 8:if(settings_client.W.get("Message_AllowDeleting")){_context15.next=11;break}return _context15.abrupt("return",!1);case 11:if(deleteAnyAllowed=(0,client._m)("delete-message",rid),deleteOwnAllowed=(0,client._m)("delete-own-message"),deleteAllowed=deleteAnyAllowed||deleteOwnAllowed&&(null==message?void 0:message.u)&&message.u._id===Meteor.userId()){_context15.next=16;break}return _context15.abrupt("return",!1);case 16:return blockDeleteInMinutes=settings_client.W.get("Message_AllowDeleting_BlockDeleteInMinutes"),bypassBlockTimeLimit=(0,client._m)("bypass-time-limit-edit-and-delete",message.rid),elapsedMinutes=moment_default()().diff(message.ts,"minutes"),onTimeForDelete=bypassBlockTimeLimit||!blockDeleteInMinutes||!elapsedMinutes||elapsedMinutes<=blockDeleteInMinutes,_context15.abrupt("return",deleteAllowed&&onTimeForDelete);case 21:case"end":return _context15.stop()}}),_callee15)})));return function canDeleteMessage(_x13){return _ref18.apply(this,arguments)}}(),deleteMessage=function(){var _ref19=_asyncToGenerator(_regeneratorRuntime().mark((function _callee16(msgIdOrMsg){var msgId,roomId,msg;return _regeneratorRuntime().wrap((function _callee16$(_context16){for(;;)switch(_context16.prev=_context16.next){case 0:if("string"!=typeof msgIdOrMsg){_context16.next=10;break}return msgId=msgIdOrMsg,_context16.next=4,findMessageByID(msgId);case 4:if(msg=_context16.sent){_context16.next=7;break}throw new Error("Message not found");case 7:roomId=msg.rid,_context16.next=12;break;case 10:msgId=msgIdOrMsg._id,roomId=msgIdOrMsg.rid;case 12:return _context16.next=14,SDKClient.sdk.rest.post("/v1/chat.delete",{msgId:msgId,roomId:roomId});case 14:case"end":return _context16.stop()}}),_callee16)})));return function deleteMessage(_x14){return _ref19.apply(this,arguments)}}(),drafts=new Map,getDraft=function(){var _ref20=_asyncToGenerator(_regeneratorRuntime().mark((function _callee17(mid){return _regeneratorRuntime().wrap((function _callee17$(_context17){for(;;)switch(_context17.prev=_context17.next){case 0:return _context17.abrupt("return",drafts.get(mid));case 1:case"end":return _context17.stop()}}),_callee17)})));return function getDraft(_x15){return _ref20.apply(this,arguments)}}(),discardDraft=function(){var _ref21=_asyncToGenerator(_regeneratorRuntime().mark((function _callee18(mid){return _regeneratorRuntime().wrap((function _callee18$(_context18){for(;;)switch(_context18.prev=_context18.next){case 0:drafts.delete(mid);case 1:case"end":return _context18.stop()}}),_callee18)})));return function discardDraft(_x16){return _ref21.apply(this,arguments)}}(),saveDraft=function(){var _ref22=_asyncToGenerator(_regeneratorRuntime().mark((function _callee19(mid,draft){return _regeneratorRuntime().wrap((function _callee19$(_context19){for(;;)switch(_context19.prev=_context19.next){case 0:drafts.set(mid,draft);case 1:case"end":return _context19.stop()}}),_callee19)})));return function saveDraft(_x17,_x18){return _ref22.apply(this,arguments)}}(),findRoom=function(){var _ref23=_asyncToGenerator(_regeneratorRuntime().mark((function _callee20(){return _regeneratorRuntime().wrap((function _callee20$(_context20){for(;;)switch(_context20.prev=_context20.next){case 0:return _context20.abrupt("return",models_client.ChatRoom.findOne({_id:rid},{reactive:!1}));case 1:case"end":return _context20.stop()}}),_callee20)})));return function findRoom(){return _ref23.apply(this,arguments)}}(),getRoom=function(){var _ref24=_asyncToGenerator(_regeneratorRuntime().mark((function _callee21(){var room;return _regeneratorRuntime().wrap((function _callee21$(_context21){for(;;)switch(_context21.prev=_context21.next){case 0:return _context21.next=2,findRoom();case 2:if(room=_context21.sent){_context21.next=5;break}throw new Error("Room not found");case 5:return _context21.abrupt("return",room);case 6:case"end":return _context21.stop()}}),_callee21)})));return function getRoom(){return _ref24.apply(this,arguments)}}(),isSubscribedToRoom=function(){var _ref25=_asyncToGenerator(_regeneratorRuntime().mark((function _callee22(){return _regeneratorRuntime().wrap((function _callee22$(_context22){for(;;)switch(_context22.prev=_context22.next){case 0:return _context22.abrupt("return",!!models_client.ChatSubscription.findOne({rid:rid},{reactive:!1}));case 1:case"end":return _context22.stop()}}),_callee22)})));return function isSubscribedToRoom(){return _ref25.apply(this,arguments)}}(),joinRoom=function(){var _ref26=_asyncToGenerator(_regeneratorRuntime().mark((function _callee23(){return _regeneratorRuntime().wrap((function _callee23$(_context23){for(;;)switch(_context23.prev=_context23.next){case 0:return _context23.next=2,SDKClient.sdk.call("joinRoom",rid);case 2:case"end":return _context23.stop()}}),_callee23)})));return function joinRoom(){return _ref26.apply(this,arguments)}}(),findDiscussionByID=function(){var _ref27=_asyncToGenerator(_regeneratorRuntime().mark((function _callee24(drid){return _regeneratorRuntime().wrap((function _callee24$(_context24){for(;;)switch(_context24.prev=_context24.next){case 0:return _context24.abrupt("return",models_client.ChatRoom.findOne({_id:drid,prid:{$exists:!0}},{reactive:!1}));case 1:case"end":return _context24.stop()}}),_callee24)})));return function findDiscussionByID(_x19){return _ref27.apply(this,arguments)}}(),getDiscussionByID=function(){var _ref28=_asyncToGenerator(_regeneratorRuntime().mark((function _callee25(drid){var discussion;return _regeneratorRuntime().wrap((function _callee25$(_context25){for(;;)switch(_context25.prev=_context25.next){case 0:return _context25.next=2,findDiscussionByID(drid);case 2:if(discussion=_context25.sent){_context25.next=5;break}throw new Error("Discussion not found");case 5:return _context25.abrupt("return",discussion);case 6:case"end":return _context25.stop()}}),_callee25)})));return function getDiscussionByID(_x20){return _ref28.apply(this,arguments)}}(),createStrictGetter=function createStrictGetter(find,errorMessage){return _asyncToGenerator(_regeneratorRuntime().mark((function _callee26(){var result,_args26=arguments;return _regeneratorRuntime().wrap((function _callee26$(_context26){for(;;)switch(_context26.prev=_context26.next){case 0:return _context26.next=2,find.apply(void 0,_args26);case 2:if(result=_context26.sent){_context26.next=5;break}throw new Error(errorMessage);case 5:return _context26.abrupt("return",result);case 6:case"end":return _context26.stop()}}),_callee26)})))},findSubscription=function(){var _ref30=_asyncToGenerator(_regeneratorRuntime().mark((function _callee27(){return _regeneratorRuntime().wrap((function _callee27$(_context27){for(;;)switch(_context27.prev=_context27.next){case 0:return _context27.abrupt("return",models_client.ChatSubscription.findOne({rid:rid},{reactive:!1}));case 1:case"end":return _context27.stop()}}),_callee27)})));return function findSubscription(){return _ref30.apply(this,arguments)}}(),getSubscription=createStrictGetter(findSubscription,"Subscription not found"),findSubscriptionFromMessage=function(){var _ref31=_asyncToGenerator(_regeneratorRuntime().mark((function _callee28(message){return _regeneratorRuntime().wrap((function _callee28$(_context28){for(;;)switch(_context28.prev=_context28.next){case 0:return _context28.abrupt("return",models_client.ChatSubscription.findOne({rid:message.rid},{reactive:!1}));case 1:case"end":return _context28.stop()}}),_callee28)})));return function findSubscriptionFromMessage(_x21){return _ref31.apply(this,arguments)}}(),getSubscriptionFromMessage=createStrictGetter(findSubscriptionFromMessage,"Subscription not found");return{composeMessage:composeMessage,findMessageByID:findMessageByID,getMessageByID:getMessageByID,findLastMessage:findLastMessage,getLastMessage:getLastMessage,findLastOwnMessage:findLastOwnMessage,getLastOwnMessage:getLastOwnMessage,findPreviousOwnMessage:findPreviousOwnMessage,getPreviousOwnMessage:getPreviousOwnMessage,findNextOwnMessage:findNextOwnMessage,getNextOwnMessage:getNextOwnMessage,pushEphemeralMessage:pushEphemeralMessage,canUpdateMessage:canUpdateMessage,updateMessage:updateMessage,canDeleteMessage:canDeleteMessage,deleteMessage:deleteMessage,getDraft:getDraft,saveDraft:saveDraft,discardDraft:discardDraft,findRoom:findRoom,getRoom:getRoom,isSubscribedToRoom:isSubscribedToRoom,joinRoom:joinRoom,findDiscussionByID:findDiscussionByID,getDiscussionByID:getDiscussionByID,findSubscription:findSubscription,getSubscription:getSubscription,findSubscriptionFromMessage:findSubscriptionFromMessage,getSubscriptionFromMessage:getSubscriptionFromMessage}}({rid:rid,tmid:tmid}),this.uploads=function createUploadsAPI(_ref4){var rid=_ref4.rid,tmid=_ref4.tmid;return{get:get,subscribe:subscribe,wipeFailedOnes:wipeFailedOnes,cancel:cancel,send:function send(file,_ref5,getContent,fileContent){var description=_ref5.description,msg=_ref5.msg,t=_ref5.t;return _send(file,{description:description,msg:msg,rid:rid,tmid:tmid,t:t},getContent,fileContent)}}}({rid:rid,tmid:tmid}),this.ActionManager=params.actionManager;var _stop,_performContinuously,_start,unimplemented=function unimplemented(){throw new Error("Flow is not implemented")};this.readStateManager=new ReadStateManager(rid),this.emojiPicker={open:unimplemented,close:unimplemented},this.action={start:(_start=ChatMessages_asyncToGenerator(ChatMessages_regeneratorRuntime().mark((function _callee4(action){return ChatMessages_regeneratorRuntime().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:UserAction.a.start(params.rid,"user-".concat(action),{tmid:params.tmid});case 1:case"end":return _context4.stop()}}),_callee4)}))),function start(_x2){return _start.apply(this,arguments)}),performContinuously:(_performContinuously=ChatMessages_asyncToGenerator(ChatMessages_regeneratorRuntime().mark((function _callee5(action){return ChatMessages_regeneratorRuntime().wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:UserAction.a.performContinuously(params.rid,"user-".concat(action),{tmid:params.tmid});case 1:case"end":return _context5.stop()}}),_callee5)}))),function performContinuously(_x3){return _performContinuously.apply(this,arguments)}),stop:(_stop=ChatMessages_asyncToGenerator(ChatMessages_regeneratorRuntime().mark((function _callee6(action){return ChatMessages_regeneratorRuntime().wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:UserAction.a.stop(params.rid,"user-".concat(action),{tmid:params.tmid});case 1:case"end":return _context6.stop()}}),_callee6)}))),function stop(_x4){return _stop.apply(this,arguments)})},this.flows={uploadFiles:uploadFiles.bind(null,this),sendMessage:sendMessage.bind(this,this),processSlashCommand:processSlashCommand.bind(null,this),processTooLongMessage:processTooLongMessage.bind(null,this),processMessageEditing:processMessageEditing.bind(null,this),processSetReaction:processSetReaction.bind(null,this),requestMessageDeletion:requestMessageDeletion.bind(this,this),replyBroadcast:replyBroadcast.bind(null,this)}}var _release;return function ChatMessages_createClass(e,r,t){return r&&ChatMessages_defineProperties(e.prototype,r),t&&ChatMessages_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(ChatMessages,[{key:"currentEditing",get:function get(){var _cancel,_stop2,_reset,_this2=this;if(this.composer&&this.currentEditingMID)return{mid:this.currentEditingMID,reset:(_reset=ChatMessages_asyncToGenerator(ChatMessages_regeneratorRuntime().mark((function _callee7(){var message,_message$msg;return ChatMessages_regeneratorRuntime().wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(_this2.composer&&_this2.currentEditingMID){_context7.next=2;break}return _context7.abrupt("return",!1);case 2:return _context7.next=4,_this2.data.findMessageByID(_this2.currentEditingMID);case 4:if(message=_context7.sent,_this2.composer.text===(null==message?void 0:message.msg)){_context7.next=8;break}return _this2.composer.setText(null!==(_message$msg=null==message?void 0:message.msg)&&void 0!==_message$msg?_message$msg:""),_context7.abrupt("return",!0);case 8:return _context7.abrupt("return",!1);case 9:case"end":return _context7.stop()}}),_callee7)}))),function reset(){return _reset.apply(this,arguments)}),stop:(_stop2=ChatMessages_asyncToGenerator(ChatMessages_regeneratorRuntime().mark((function _callee8(){var message,draft;return ChatMessages_regeneratorRuntime().wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(_this2.composer&&_this2.currentEditingMID){_context8.next=2;break}return _context8.abrupt("return");case 2:return _context8.next=4,_this2.data.findMessageByID(_this2.currentEditingMID);case 4:if(message=_context8.sent,(draft=_this2.composer.text)!==(null==message?void 0:message.msg)){_context8.next=11;break}return _context8.next=9,_this2.data.discardDraft(_this2.currentEditingMID);case 9:_context8.next=21;break;case 11:return _context8.t0=_this2.data,_context8.t1=_this2.currentEditingMID,_context8.next=15,_this2.data.getDraft(_this2.currentEditingMID);case 15:if(_context8.t2=_context8.sent,_context8.t2){_context8.next=18;break}_context8.t2=draft;case 18:return _context8.t3=_context8.t2,_context8.next=21,_context8.t0.saveDraft.call(_context8.t0,_context8.t1,_context8.t3);case 21:_this2.composer.setEditingMode(!1),_this2.currentEditingMID=void 0,(0,messageHighlightSubscription.t2)();case 24:case"end":return _context8.stop()}}),_callee8)}))),function stop(){return _stop2.apply(this,arguments)}),cancel:(_cancel=ChatMessages_asyncToGenerator(ChatMessages_regeneratorRuntime().mark((function _callee9(){var _this2$currentEditing,_this2$composer,_yield$_this2$data$ge;return ChatMessages_regeneratorRuntime().wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(_this2.currentEditingMID){_context9.next=2;break}return _context9.abrupt("return");case 2:return _context9.next=4,_this2.data.discardDraft(_this2.currentEditingMID);case 4:return _context9.next=6,null===(_this2$currentEditing=_this2.currentEditing)||void 0===_this2$currentEditing?void 0:_this2$currentEditing.stop();case 6:if(_context9.t0=null===(_this2$composer=_this2.composer)||void 0===_this2$composer,_context9.t0){_context9.next=22;break}return _context9.t1=_this2$composer,_context9.next=11,_this2.data.getDraft(void 0);case 11:if(_context9.t3=_yield$_this2$data$ge=_context9.sent,_context9.t2=null!==_context9.t3,!_context9.t2){_context9.next=15;break}_context9.t2=void 0!==_yield$_this2$data$ge;case 15:if(!_context9.t2){_context9.next=19;break}_context9.t4=_yield$_this2$data$ge,_context9.next=20;break;case 19:_context9.t4="";case 20:_context9.t5=_context9.t4,_context9.t1.setText.call(_context9.t1,_context9.t5);case 22:case"end":return _context9.stop()}}),_callee9)}))),function cancel(){return _cancel.apply(this,arguments)})}}},{key:"release",value:(_release=ChatMessages_asyncToGenerator(ChatMessages_regeneratorRuntime().mark((function _callee10(){var _this$composer2;return ChatMessages_regeneratorRuntime().wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:if(!this.currentEditing){_context10.next=5;break}if(this.params.tmid){_context10.next=4;break}return _context10.next=4,this.currentEditing.cancel();case 4:null===(_this$composer2=this.composer)||void 0===_this$composer2||_this$composer2.clear();case 5:case"end":return _context10.stop()}}),_callee10,this)}))),function release(){return _release.apply(this,arguments)})}]),ChatMessages}(),EmojiPickerContext=__webpack_require__("./client/contexts/EmojiPickerContext.ts"),useUiKitActionManager=__webpack_require__("./client/uikit/hooks/useUiKitActionManager.ts"),useE2EERoomState=__webpack_require__("./client/views/room/hooks/useE2EERoomState.ts"),useDepsMatch=function useDepsMatch(deps){var prevDepsRef=(0,react.useRef)(deps),match=function depsMatch(a,b){return a.every((function(value,index){return Object.is(value,b[index])}))}(prevDepsRef.current,deps);return prevDepsRef.current=deps,match};function useChatMessagesInstance(_ref){var rid=_ref.rid,tmid=_ref.tmid,encrypted=_ref.encrypted,uid=(0,dist.useUserId)(),subscription=(0,RoomContext.Mq)(),actionManager=(0,useUiKitActionManager.v)(),e2eRoomState=(0,useE2EERoomState.N)(rid),chatMessages=function useInstance(factory,deps){var ref=(0,react.useRef)();(0,react.useEffect)((function(){return function(){var _ref$current,_ref$current$;null===(_ref$current=ref.current)||void 0===_ref$current||null===(_ref$current$=_ref$current[1])||void 0===_ref$current$||_ref$current$.call(_ref$current)}}),[]);var _ref$current2,_ref$current2$,depsMatch=useDepsMatch(deps);return ref.current&&depsMatch||(null===(_ref$current2=ref.current)||void 0===_ref$current2||null===(_ref$current2$=_ref$current2[1])||void 0===_ref$current2$||_ref$current2$.call(_ref$current2),ref.current=factory()),ref.current[0]}((function(){var instance=new ChatMessages({rid:rid,tmid:tmid,uid:uid,actionManager:actionManager});return[instance,function(){return instance.release()}]}),[rid,tmid,uid,encrypted,e2eRoomState]);return(0,react.useEffect)((function(){subscription&&(null==chatMessages||chatMessages.readStateManager.updateSubscription(subscription))}),[subscription,null==chatMessages?void 0:chatMessages.readStateManager]),chatMessages.emojiPicker=(0,EmojiPickerContext.Wq)(),chatMessages}var ChatProvider=function ChatProvider(_ref){var children=_ref.children,tmid=_ref.tmid,_useRoom=(0,RoomContext.nq)(),value=useChatMessagesInstance({rid:_useRoom._id,tmid:tmid,encrypted:_useRoom.encrypted});return react.createElement(ChatContext.U.Provider,{value:value},children)},providers_ChatProvider=ChatProvider;ChatProvider.__docgenInfo={description:"",methods:[],displayName:"ChatProvider",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""},tmid:{required:!1,tsType:{name:"string"},description:""}}}},"./client/views/room/providers/DateListProvider.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{$7:function(){return useDateRef},E5:function(){return DateListProvider},EZ:function(){return useDateListController}});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js");function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var DateListContext=(0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(void 0),useDateRef=function useDateRef(){var context=useDateListController();return(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((function(){return context.dateRef()}),[context])},DateListProvider=function DateListProvider(_ref){var children=_ref.children,list=_slicedToArray((0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(new Set),1)[0];return react__WEBPACK_IMPORTED_MODULE_0__.createElement(DateListContext.Provider,{value:{list:list,dateRef:function dateRef(){var remove;return function(ref){remove&&remove(),ref&&(remove=function addToList(value){return list.add(value),function(){list.delete(value)}}(ref))}}}},children)},useDateListController=function useDateListController(){var context=(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(DateListContext);if(!context)throw new Error("useDateController must be used within an DateScrollProvider");return context};DateListProvider.__docgenInfo={description:"",methods:[],displayName:"DateListProvider",props:{children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}}},"./node_modules/date-fns/esm/differenceInSeconds/index.js":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:function(){return differenceInSeconds}});var differenceInMilliseconds=__webpack_require__("./node_modules/date-fns/esm/differenceInMilliseconds/index.js"),requiredArgs=__webpack_require__("./node_modules/date-fns/esm/_lib/requiredArgs/index.js"),roundingMap={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(value){return value<0?Math.ceil(value):Math.floor(value)}},defaultRoundingMethod="trunc";function differenceInSeconds(dateLeft,dateRight,options){(0,requiredArgs.A)(2,arguments);var diff=(0,differenceInMilliseconds.A)(dateLeft,dateRight)/1e3;return function getRoundingMethod(method){return method?roundingMap[method]:roundingMap[defaultRoundingMethod]}(null==options?void 0:options.roundingMethod)(diff)}}}]);