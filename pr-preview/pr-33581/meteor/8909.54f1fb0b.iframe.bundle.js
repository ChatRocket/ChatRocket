/*! For license information please see 8909.54f1fb0b.iframe.bundle.js.LICENSE.txt */
(self.webpackChunk_rocket_chat_meteor=self.webpackChunk_rocket_chat_meteor||[]).push([[8909],{"./app/models/client/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{AuthzCachedCollection:function(){return AuthzCachedCollection},Base:function(){return Base},CachedChannelList:function(){return CachedChannelList},CachedChatRoom:function(){return CachedChatRoom_instance},CachedChatSubscription:function(){return instance},CachedUserList:function(){return CachedUserList},ChatMessage:function(){return ChatMessage},ChatPermissions:function(){return ChatPermissions},ChatRoom:function(){return ChatRoom},ChatSubscription:function(){return ChatSubscription},CustomSounds:function(){return models_CustomSounds},EmojiCustom:function(){return models_EmojiCustom},Messages:function(){return ChatMessage},Roles:function(){return Roles},RoomRoles:function(){return RoomRoles},Subscriptions:function(){return ChatSubscription},UserRoles:function(){return UserRoles},Users:function(){return Users}});var meteor=__webpack_require__("./.storybook/mocks/meteor.js");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}var Base=function(){function Base(){!function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,Base),function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}(this,"model",void 0)}return function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(Base,[{key:"_baseName",value:function _baseName(){return"rocketchat_"}},{key:"_initModel",value:function _initModel(name){return(0,meteor.z6)(name,String),this.model=new meteor.Nf.Collection(this._baseName()+name),this.model}},{key:"find",value:function find(){var _this$model;return(_this$model=this.model).find.apply(_this$model,arguments)}},{key:"findOne",value:function findOne(){var _this$model2;return(_this$model2=this.model).findOne.apply(_this$model2,arguments)}},{key:"insert",value:function insert(){var _this$model3;return(_this$model3=this.model).insert.apply(_this$model3,arguments)}},{key:"update",value:function update(){var _this$model4;return(_this$model4=this.model).update.apply(_this$model4,arguments)}},{key:"upsert",value:function upsert(){var _this$model5;return(_this$model5=this.model).upsert.apply(_this$model5,arguments)}},{key:"remove",value:function remove(){var _this$model6;return(_this$model6=this.model).remove.apply(_this$model6,arguments)}},{key:"allow",value:function allow(){var _this$model7;return(_this$model7=this.model).allow.apply(_this$model7,arguments)}},{key:"deny",value:function deny(){var _this$model8;return(_this$model8=this.model).deny.apply(_this$model8,arguments)}},{key:"ensureIndex",value:function ensureIndex(){}},{key:"dropIndex",value:function dropIndex(){}},{key:"tryEnsureIndex",value:function tryEnsureIndex(){}},{key:"tryDropIndex",value:function tryDropIndex(){}}]),Base}(),CachedChannelList=new meteor.Nf.Collection(null),dist=__webpack_require__("../../packages/core-typings/dist/index.js"),CachedCollection=__webpack_require__("./app/ui-cached-collection/client/models/CachedCollection.ts");function CachedChatSubscription_typeof(o){return CachedChatSubscription_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},CachedChatSubscription_typeof(o)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){CachedChatSubscription_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function CachedChatSubscription_defineProperty(e,r,t){return(r=CachedChatSubscription_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function CachedChatSubscription_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,CachedChatSubscription_toPropertyKey(o.key),o)}}function CachedChatSubscription_toPropertyKey(t){var i=function CachedChatSubscription_toPrimitive(t,r){if("object"!=CachedChatSubscription_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=CachedChatSubscription_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==CachedChatSubscription_typeof(i)?i:i+""}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var p=function _superPropBase(t,o){for(;!{}.hasOwnProperty.call(t,o)&&null!==(t=_getPrototypeOf(t)););return t}(e,t);if(p){var n=Object.getOwnPropertyDescriptor(p,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}},_get.apply(null,arguments)}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _createSuper(t){var r=_isNativeReflectConstruct();return function(){var e,o=_getPrototypeOf(t);if(r){var s=_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function _possibleConstructorReturn(t,e){if(e&&("object"==CachedChatSubscription_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,e)}}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var instance=new(function(_CachedCollection){!function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}(CachedChatSubscription,_CachedCollection);var _super=_createSuper(CachedChatSubscription);function CachedChatSubscription(){return function CachedChatSubscription_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,CachedChatSubscription),_super.call(this,{name:"subscriptions"})}return function CachedChatSubscription_createClass(e,r,t){return r&&CachedChatSubscription_defineProperties(e.prototype,r),t&&CachedChatSubscription_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(CachedChatSubscription,[{key:"handleLoadFromServer",value:function handleLoadFromServer(record){return this.mergeWithRoom(record)}},{key:"handleReceived",value:function handleReceived(record){return this.mergeWithRoom(record)}},{key:"handleSync",value:function handleSync(record){return this.mergeWithRoom(record)}},{key:"mergeWithRoom",value:function mergeWithRoom(subscription){var _room$usersCount,_room$ts,name,fname,room=CachedChatRoom_instance.collection.findOne({_id:subscription.rid},{fields:{lm:1,lastMessage:1,uids:1,usernames:1,usersCount:1,topic:1,encrypted:1,description:1,announcement:1,broadcast:1,archived:1,avatarETag:1,retention:1,teamId:1,teamMain:1,msgs:1,onHold:1,metrics:1,muted:1,servedBy:1,ts:1,waitingResponse:1,v:1,transcriptRequest:1,tags:1,closedAt:1,responseBy:1,priorityId:1,priorityWeight:1,slaId:1,estimatedWaitingTimeQueue:1,livechatData:1,departmentId:1,source:1,queuedAt:1,federated:1}}),lastRoomUpdate=(null==room?void 0:room.lm)||subscription.ts||(null==room?void 0:room.ts);return _objectSpread(_objectSpread(_objectSpread({},subscription),(name=subscription.name,fname=subscription.fname||name,{lowerCaseName:String(subscription.prid?fname:name).toLowerCase(),lowerCaseFName:String(fname).toLowerCase()})),{},{encrypted:null==room?void 0:room.encrypted,description:null==room?void 0:room.description,cl:null==room?void 0:room.cl,topic:null==room?void 0:room.topic,announcement:null==room?void 0:room.announcement,broadcast:null==room?void 0:room.broadcast,archived:null==room?void 0:room.archived,avatarETag:null==room?void 0:room.avatarETag,retention:null==room?void 0:room.retention,lastMessage:null==room?void 0:room.lastMessage,teamId:null==room?void 0:room.teamId,teamMain:null==room?void 0:room.teamMain,uids:null==room?void 0:room.uids,usernames:null==room?void 0:room.usernames,usersCount:null!==(_room$usersCount=null==room?void 0:room.usersCount)&&void 0!==_room$usersCount?_room$usersCount:0,v:null==room?void 0:room.v,transcriptRequest:null==room?void 0:room.transcriptRequest,servedBy:null==room?void 0:room.servedBy,onHold:null==room?void 0:room.onHold,tags:null==room?void 0:room.tags,closedAt:null==room?void 0:room.closedAt,metrics:null==room?void 0:room.metrics,muted:null==room?void 0:room.muted,waitingResponse:null==room?void 0:room.waitingResponse,responseBy:null==room?void 0:room.responseBy,priorityId:null==room?void 0:room.priorityId,slaId:null==room?void 0:room.slaId,priorityWeight:(null==room?void 0:room.priorityWeight)||dist.LivechatPriorityWeight.NOT_SPECIFIED,estimatedWaitingTimeQueue:(null==room?void 0:room.estimatedWaitingTimeQueue)||dist.DEFAULT_SLA_CONFIG.ESTIMATED_WAITING_TIME_QUEUE,livechatData:null==room?void 0:room.livechatData,departmentId:null==room?void 0:room.departmentId,ts:null!==(_room$ts=null==room?void 0:room.ts)&&void 0!==_room$ts?_room$ts:subscription.ts,source:null==room?void 0:room.source,queuedAt:null==room?void 0:room.queuedAt,federated:null==room?void 0:room.federated,lm:subscription.lr?new Date(Math.max(subscription.lr.getTime(),(null==lastRoomUpdate?void 0:lastRoomUpdate.getTime())||0)):lastRoomUpdate})}},{key:"deserializeFromCache",value:function deserializeFromCache(record){var _deserialized$lastMes,deserialized=_get(_getPrototypeOf(CachedChatSubscription.prototype),"deserializeFromCache",this).call(this,record);return null!=deserialized&&null!==(_deserialized$lastMes=deserialized.lastMessage)&&void 0!==_deserialized$lastMes&&_deserialized$lastMes._updatedAt&&(deserialized.lastMessage._updatedAt=new Date(deserialized.lastMessage._updatedAt)),deserialized}}]),CachedChatSubscription}(CachedCollection.p));function CachedChatRoom_typeof(o){return CachedChatRoom_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},CachedChatRoom_typeof(o)}function CachedChatRoom_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function CachedChatRoom_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?CachedChatRoom_ownKeys(Object(t),!0).forEach((function(r){CachedChatRoom_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):CachedChatRoom_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function CachedChatRoom_defineProperty(e,r,t){return(r=CachedChatRoom_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function CachedChatRoom_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,CachedChatRoom_toPropertyKey(o.key),o)}}function CachedChatRoom_toPropertyKey(t){var i=function CachedChatRoom_toPrimitive(t,r){if("object"!=CachedChatRoom_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=CachedChatRoom_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==CachedChatRoom_typeof(i)?i:i+""}function CachedChatRoom_get(){return CachedChatRoom_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var p=function CachedChatRoom_superPropBase(t,o){for(;!{}.hasOwnProperty.call(t,o)&&null!==(t=CachedChatRoom_getPrototypeOf(t)););return t}(e,t);if(p){var n=Object.getOwnPropertyDescriptor(p,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}},CachedChatRoom_get.apply(null,arguments)}function CachedChatRoom_setPrototypeOf(t,e){return CachedChatRoom_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},CachedChatRoom_setPrototypeOf(t,e)}function CachedChatRoom_createSuper(t){var r=CachedChatRoom_isNativeReflectConstruct();return function(){var e,o=CachedChatRoom_getPrototypeOf(t);if(r){var s=CachedChatRoom_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function CachedChatRoom_possibleConstructorReturn(t,e){if(e&&("object"==CachedChatRoom_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function CachedChatRoom_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,e)}}function CachedChatRoom_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(CachedChatRoom_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function CachedChatRoom_getPrototypeOf(t){return CachedChatRoom_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},CachedChatRoom_getPrototypeOf(t)}var CachedChatRoom_instance=new(function(_CachedCollection){!function CachedChatRoom_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&CachedChatRoom_setPrototypeOf(t,e)}(CachedChatRoom,_CachedCollection);var _super=CachedChatRoom_createSuper(CachedChatRoom);function CachedChatRoom(){return function CachedChatRoom_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,CachedChatRoom),_super.call(this,{name:"rooms"})}return function CachedChatRoom_createClass(e,r,t){return r&&CachedChatRoom_defineProperties(e.prototype,r),t&&CachedChatRoom_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(CachedChatRoom,[{key:"handleLoadFromServer",value:function handleLoadFromServer(record){return this.mergeWithSubscription(record)}},{key:"handleReceived",value:function handleReceived(record){return this.mergeWithSubscription(record)}},{key:"handleSync",value:function handleSync(record){return this.mergeWithSubscription(record)}},{key:"mergeWithSubscription",value:function mergeWithSubscription(room){var name,fname,sub=instance.collection.findOne({rid:room._id});return sub?(instance.collection.update({rid:room._id},{$set:CachedChatRoom_objectSpread({encrypted:room.encrypted,description:room.description,cl:room.cl,topic:room.topic,announcement:room.announcement,broadcast:room.broadcast,archived:room.archived,avatarETag:room.avatarETag,retention:null==room?void 0:room.retention,uids:room.uids,usernames:room.usernames,usersCount:room.usersCount,lastMessage:room.lastMessage,teamId:room.teamId,teamMain:room.teamMain,v:null==room?void 0:room.v,transcriptRequest:null==room?void 0:room.transcriptRequest,servedBy:null==room?void 0:room.servedBy,onHold:null==room?void 0:room.onHold,tags:null==room?void 0:room.tags,closedAt:null==room?void 0:room.closedAt,metrics:null==room?void 0:room.metrics,muted:room.muted,waitingResponse:null==room?void 0:room.waitingResponse,responseBy:null==room?void 0:room.responseBy,priorityId:null==room?void 0:room.priorityId,priorityWeight:(null==room?void 0:room.priorityWeight)||dist.LivechatPriorityWeight.NOT_SPECIFIED,estimatedWaitingTimeQueue:(null==room?void 0:room.estimatedWaitingTimeQueue)||dist.DEFAULT_SLA_CONFIG.ESTIMATED_WAITING_TIME_QUEUE,slaId:null==room?void 0:room.slaId,livechatData:null==room?void 0:room.livechatData,departmentId:null==room?void 0:room.departmentId,ts:room.ts,source:null==room?void 0:room.source,queuedAt:null==room?void 0:room.queuedAt,federated:room.federated},(name=room.name||sub.name,fname=room.fname||sub.fname||name,{lowerCaseName:String(room.prid?fname:name).toLowerCase(),lowerCaseFName:String(fname).toLowerCase()}))}),instance.collection.update({rid:room._id,lm:{$lt:room.lm}},{$set:{lm:room.lm}}),room):room}},{key:"deserializeFromCache",value:function deserializeFromCache(record){var _deserialized$lastMes,deserialized=CachedChatRoom_get(CachedChatRoom_getPrototypeOf(CachedChatRoom.prototype),"deserializeFromCache",this).call(this,record);return null!=deserialized&&null!==(_deserialized$lastMes=deserialized.lastMessage)&&void 0!==_deserialized$lastMes&&_deserialized$lastMes._updatedAt&&(deserialized.lastMessage._updatedAt=new Date(deserialized.lastMessage._updatedAt)),deserialized}}]),CachedChatRoom}(CachedCollection.p)),CachedUserList=new meteor.Nf.Collection(null);function ChatMessage_typeof(o){return ChatMessage_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},ChatMessage_typeof(o)}function ChatMessage_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,ChatMessage_toPropertyKey(o.key),o)}}function ChatMessage_toPropertyKey(t){var i=function ChatMessage_toPrimitive(t,r){if("object"!=ChatMessage_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=ChatMessage_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==ChatMessage_typeof(i)?i:i+""}function ChatMessage_setPrototypeOf(t,e){return ChatMessage_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ChatMessage_setPrototypeOf(t,e)}function ChatMessage_createSuper(t){var r=ChatMessage_isNativeReflectConstruct();return function(){var e,o=ChatMessage_getPrototypeOf(t);if(r){var s=ChatMessage_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function ChatMessage_possibleConstructorReturn(t,e){if(e&&("object"==ChatMessage_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function ChatMessage_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,e)}}function ChatMessage_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ChatMessage_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function ChatMessage_getPrototypeOf(t){return ChatMessage_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ChatMessage_getPrototypeOf(t)}var ChatMessage=new(function(_ref){!function ChatMessage_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ChatMessage_setPrototypeOf(t,e)}(ChatMessageCollection,_ref);var _super=ChatMessage_createSuper(ChatMessageCollection);function ChatMessageCollection(){return function ChatMessage_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,ChatMessageCollection),_super.call(this,null)}return function ChatMessage_createClass(e,r,t){return r&&ChatMessage_defineProperties(e.prototype,r),t&&ChatMessage_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(ChatMessageCollection,[{key:"findOneByRoomIdAndMessageId",value:function findOneByRoomIdAndMessageId(rid,messageId,options){var query={rid:rid,_id:messageId};return this.findOne(query,options)}}]),ChatMessageCollection}(meteor.Nf.Collection)),AuthzCachedCollection=new(__webpack_require__("./app/ui-cached-collection/client/index.ts").p)({name:"permissions",eventType:"notify-logged"}),ChatPermissions=AuthzCachedCollection.collection,ChatRoom=Object.assign(CachedChatRoom_instance.collection,{setReactionsInLastMessage:function setReactionsInLastMessage(roomId,lastMessage){return this.update({_id:roomId},{$set:{lastMessage:lastMessage}})},unsetReactionsInLastMessage:function unsetReactionsInLastMessage(roomId){return this.update({_id:roomId},{$unset:{"lastMessage.reactions":1}})}}),mem_dist=__webpack_require__("./node_modules/mem/dist/index.js"),mem_dist_default=__webpack_require__.n(mem_dist),isTruthy=__webpack_require__("./lib/isTruthy.ts"),ChatSubscription=Object.assign(instance.collection,{isUserInRole:mem_dist_default()((function(_uid,roleId,rid){if(!rid)return!1;var query={rid:rid},subscription=this.findOne(query,{fields:{roles:1}});return subscription&&Array.isArray(subscription.roles)&&subscription.roles.includes(roleId)}),{maxAge:1e3,cacheKey:JSON.stringify}),findUsersInRoles:mem_dist_default()((function(roles,scope,options){var query={roles:{$in:roles=Array.isArray(roles)?roles:[roles]}};scope&&(query.rid=scope);var uids=this.find(query).fetch().map((function(subscription){if(void 0!==subscription.u&&void 0!==subscription.u._id)return subscription.u._id})).filter(isTruthy.z);return meteor.fj.users.find({_id:{$in:uids}},options)}),{maxAge:1e3,cacheKey:JSON.stringify})});function CustomSounds_typeof(o){return CustomSounds_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},CustomSounds_typeof(o)}function CustomSounds_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,CustomSounds_toPropertyKey(o.key),o)}}function CustomSounds_toPropertyKey(t){var i=function CustomSounds_toPrimitive(t,r){if("object"!=CustomSounds_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=CustomSounds_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==CustomSounds_typeof(i)?i:i+""}function CustomSounds_setPrototypeOf(t,e){return CustomSounds_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},CustomSounds_setPrototypeOf(t,e)}function CustomSounds_createSuper(t){var r=CustomSounds_isNativeReflectConstruct();return function(){var e,o=CustomSounds_getPrototypeOf(t);if(r){var s=CustomSounds_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function CustomSounds_possibleConstructorReturn(t,e){if(e&&("object"==CustomSounds_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function CustomSounds_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,e)}}function CustomSounds_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(CustomSounds_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function CustomSounds_getPrototypeOf(t){return CustomSounds_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},CustomSounds_getPrototypeOf(t)}var models_CustomSounds=new(function(_Base){!function CustomSounds_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&CustomSounds_setPrototypeOf(t,e)}(CustomSounds,_Base);var _super=CustomSounds_createSuper(CustomSounds);function CustomSounds(){var _this;return function CustomSounds_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,CustomSounds),(_this=_super.call(this))._initModel("custom_sounds"),_this}return function CustomSounds_createClass(e,r,t){return r&&CustomSounds_defineProperties(e.prototype,r),t&&CustomSounds_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(CustomSounds)}(Base));function EmojiCustom_typeof(o){return EmojiCustom_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},EmojiCustom_typeof(o)}function EmojiCustom_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,EmojiCustom_toPropertyKey(o.key),o)}}function EmojiCustom_toPropertyKey(t){var i=function EmojiCustom_toPrimitive(t,r){if("object"!=EmojiCustom_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=EmojiCustom_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==EmojiCustom_typeof(i)?i:i+""}function EmojiCustom_setPrototypeOf(t,e){return EmojiCustom_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},EmojiCustom_setPrototypeOf(t,e)}function EmojiCustom_createSuper(t){var r=EmojiCustom_isNativeReflectConstruct();return function(){var e,o=EmojiCustom_getPrototypeOf(t);if(r){var s=EmojiCustom_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function EmojiCustom_possibleConstructorReturn(t,e){if(e&&("object"==EmojiCustom_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function EmojiCustom_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,e)}}function EmojiCustom_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(EmojiCustom_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function EmojiCustom_getPrototypeOf(t){return EmojiCustom_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},EmojiCustom_getPrototypeOf(t)}var models_EmojiCustom=new(function(_Base){!function EmojiCustom_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&EmojiCustom_setPrototypeOf(t,e)}(EmojiCustom,_Base);var _super=EmojiCustom_createSuper(EmojiCustom);function EmojiCustom(){var _this;return function EmojiCustom_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,EmojiCustom),(_this=_super.call(this))._initModel("custom_emoji"),_this}return function EmojiCustom_createClass(e,r,t){return r&&EmojiCustom_defineProperties(e.prototype,r),t&&EmojiCustom_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(EmojiCustom,[{key:"findByNameOrAlias",value:function findByNameOrAlias(name,options){var query={$or:[{name:name},{aliases:name}]};return this.find(query,options)}}]),EmojiCustom}(Base));function Users_typeof(o){return Users_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Users_typeof(o)}function Users_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Users_toPropertyKey(o.key),o)}}function Users_toPropertyKey(t){var i=function Users_toPrimitive(t,r){if("object"!=Users_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=Users_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==Users_typeof(i)?i:i+""}function Users_setPrototypeOf(t,e){return Users_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Users_setPrototypeOf(t,e)}function Users_createSuper(t){var r=Users_isNativeReflectConstruct();return function(){var e,o=Users_getPrototypeOf(t);if(r){var s=Users_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function Users_possibleConstructorReturn(t,e){if(e&&("object"==Users_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function Users_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,e)}}function Users_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Users_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function Users_getPrototypeOf(t){return Users_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Users_getPrototypeOf(t)}var UsersCollection=function(_Mongo$Collection){!function Users_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Users_setPrototypeOf(t,e)}(UsersCollection,_Mongo$Collection);var _super=Users_createSuper(UsersCollection);function UsersCollection(){return function Users_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,UsersCollection),_super.call(this,null)}return function Users_createClass(e,r,t){return r&&Users_defineProperties(e.prototype,r),t&&Users_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(UsersCollection,[{key:"findOneById",value:function findOneById(uid,options){var query={_id:uid};return this.findOne(query,options)}},{key:"isUserInRole",value:function isUserInRole(uid,roleId){var user=this.findOneById(uid,{fields:{roles:1}});return user&&Array.isArray(user.roles)&&user.roles.includes(roleId)}},{key:"findUsersInRoles",value:function findUsersInRoles(roles,_scope,options){var query={roles:{$in:roles=Array.isArray(roles)?roles:[roles]}};return this.find(query,options)}}]),UsersCollection}(meteor.Nf.Collection);Object.assign(meteor.fj.users,{_connection:void 0,findOneById:UsersCollection.prototype.findOneById,isUserInRole:UsersCollection.prototype.isUserInRole,findUsersInRoles:UsersCollection.prototype.findUsersInRoles,remove:UsersCollection.prototype.remove});var Users=meteor.fj.users;function Roles_typeof(o){return Roles_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Roles_typeof(o)}function Roles_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Roles_toPropertyKey(o.key),o)}}function Roles_setPrototypeOf(t,e){return Roles_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Roles_setPrototypeOf(t,e)}function Roles_createSuper(t){var r=Roles_isNativeReflectConstruct();return function(){var e,o=Roles_getPrototypeOf(t);if(r){var s=Roles_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function Roles_possibleConstructorReturn(t,e){if(e&&("object"==Roles_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Roles_assertThisInitialized(t)}(this,e)}}function Roles_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Roles_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Roles_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function Roles_getPrototypeOf(t){return Roles_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Roles_getPrototypeOf(t)}function Roles_toPropertyKey(t){var i=function Roles_toPrimitive(t,r){if("object"!=Roles_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=Roles_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==Roles_typeof(i)?i:i+""}var RolesCollection=function(_Mongo$Collection){!function Roles_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Roles_setPrototypeOf(t,e)}(RolesCollection,_Mongo$Collection);var _super=Roles_createSuper(RolesCollection);function RolesCollection(){var _this;return function Roles_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,RolesCollection),function Roles_defineProperty(e,r,t){return(r=Roles_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}(Roles_assertThisInitialized(_this=_super.call(this,null)),"ready",new meteor.Hw(!1)),_this}return function Roles_createClass(e,r,t){return r&&Roles_defineProperties(e.prototype,r),t&&Roles_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(RolesCollection,[{key:"findUsersInRole",value:function findUsersInRole(roleId,scope,options){var role=this.findOne(roleId);switch((null==role?void 0:role.scope)||"Users"){case"Subscriptions":return ChatSubscription.findUsersInRoles(roleId,scope,options);case"Users":return Users.findUsersInRoles(roleId,scope,options);default:return}}},{key:"isUserInRoles",value:function isUserInRoles(userId,roles,scope){var _this2=this,ignoreSubscriptions=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(roles=Array.isArray(roles)?roles:[roles]).some((function(roleId){var role=_this2.findOne(roleId);switch(ignoreSubscriptions?"Users":(null==role?void 0:role.scope)||"Users"){case"Subscriptions":return ChatSubscription.isUserInRole(userId,roleId,scope);case"Users":return Users.isUserInRole(userId,roleId);default:return!1}}))}}]),RolesCollection}(meteor.Nf.Collection),Roles=new RolesCollection,RoomRoles=new meteor.Nf.Collection(null),UserRoles=new meteor.Nf.Collection(null)},"./app/settings/client/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{W:function(){return settings}});var meteor=__webpack_require__("./.storybook/mocks/meteor.js");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _createSuper(t){var r=_isNativeReflectConstruct();return function(){var e,o=_getPrototypeOf(t);if(r){var s=_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,e)}}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var instance=new(function(_CachedCollection){!function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}(PublicSettingsCachedCollection,_CachedCollection);var _super=_createSuper(PublicSettingsCachedCollection);function PublicSettingsCachedCollection(){return function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,PublicSettingsCachedCollection),_super.call(this,{name:"public-settings",eventType:"notify-all",userRelated:!1})}return function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(PublicSettingsCachedCollection)}(__webpack_require__("./app/ui-cached-collection/client/index.ts").p)),index_all=__webpack_require__("./node_modules/underscore/modules/index-all.js"),SDKClient=__webpack_require__("./app/utils/client/lib/SDKClient.ts");function settings_typeof(o){return settings_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},settings_typeof(o)}function settings_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,settings_toPropertyKey(o.key),o)}}function _defineProperty(e,r,t){return(r=settings_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function settings_toPropertyKey(t){var i=function settings_toPrimitive(t,r){if("object"!=settings_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=settings_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==settings_typeof(i)?i:i+""}var SettingsBase=function(){function SettingsBase(){!function settings_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,SettingsBase),_defineProperty(this,"callbacks",new Map),_defineProperty(this,"regexCallbacks",new Map)}return function settings_createClass(e,r,t){return r&&settings_defineProperties(e.prototype,r),t&&settings_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(SettingsBase,[{key:"get",value:function get(_id,callback){var _Meteor$settings;if(null!=callback){if(this.onload(_id,callback),!meteor.fj.settings)return;if("*"===_id)return Object.keys(meteor.fj.settings).forEach((function(key){var value=meteor.fj.settings[key];callback(key,value)}));if(index_all.Ay.isRegExp(_id)&&meteor.fj.settings)return Object.keys(meteor.fj.settings).forEach((function(key){if(_id.test(key)){var value=meteor.fj.settings[key];callback(key,value)}}));if("string"==typeof _id)return void(null!=meteor.fj.settings[_id]&&callback(_id,meteor.fj.settings[_id]))}if(meteor.fj.settings)return index_all.Ay.isRegExp(_id)?Object.keys(meteor.fj.settings).reduce((function(items,key){var value=meteor.fj.settings[key];return _id.test(key)&&items.push({key:key,value:value}),items}),[]):null===(_Meteor$settings=meteor.fj.settings)||void 0===_Meteor$settings?void 0:_Meteor$settings[_id]}},{key:"set",value:function set(_id,value,callback){SDKClient.sdk.call("saveSetting",_id,value).then((function(result){return callback(void 0,result)})).catch(callback)}},{key:"batchSet",value:function batchSet(settings,callback){SDKClient.sdk.call("saveSettings",settings).then((function(result){return callback(void 0,result)})).catch(callback)}},{key:"load",value:function load(key,value,initialLoad){var _this=this;["*",key].forEach((function(item){var callbacks=_this.callbacks.get(item);callbacks&&callbacks.forEach((function(callback){return callback(key,value,initialLoad)}))})),this.regexCallbacks.forEach((function(cbValue){null!=cbValue&&cbValue.regex.test(key)&&cbValue.callbacks.forEach((function(callback){return callback(key,value,initialLoad)}))}))}},{key:"onload",value:function onload(key,callback){var _this2=this;(Array.isArray(key)?key:[key]).forEach((function(k){var _this2$regexCallbacks,_this2$callbacks$get;index_all.Ay.isRegExp(k)?(_this2.regexCallbacks.has(k.source)||_this2.regexCallbacks.set(k.source,{regex:k,callbacks:[]}),null===(_this2$regexCallbacks=_this2.regexCallbacks.get(k.source))||void 0===_this2$regexCallbacks||_this2$regexCallbacks.callbacks.push(callback)):(_this2.callbacks.has(k)||_this2.callbacks.set(k,[]),null===(_this2$callbacks$get=_this2.callbacks.get(k))||void 0===_this2$callbacks$get||_this2$callbacks$get.push(callback))}))}}]),SettingsBase}();function lib_settings_typeof(o){return lib_settings_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},lib_settings_typeof(o)}function lib_settings_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,lib_settings_toPropertyKey(o.key),o)}}function settings_setPrototypeOf(t,e){return settings_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},settings_setPrototypeOf(t,e)}function settings_createSuper(t){var r=settings_isNativeReflectConstruct();return function(){var e,o=settings_getPrototypeOf(t);if(r){var s=settings_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function settings_possibleConstructorReturn(t,e){if(e&&("object"==lib_settings_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return settings_assertThisInitialized(t)}(this,e)}}function settings_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function settings_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(settings_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function settings_getPrototypeOf(t){return settings_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},settings_getPrototypeOf(t)}function settings_defineProperty(e,r,t){return(r=lib_settings_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function lib_settings_toPropertyKey(t){var i=function lib_settings_toPrimitive(t,r){if("object"!=lib_settings_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=lib_settings_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==lib_settings_typeof(i)?i:i+""}var Settings=function(_SettingsBase){!function settings_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&settings_setPrototypeOf(t,e)}(Settings,_SettingsBase);var _super=settings_createSuper(Settings);function Settings(){var _this;!function lib_settings_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,Settings);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return settings_defineProperty(settings_assertThisInitialized(_this=_super.call.apply(_super,[this].concat(args))),"cachedCollection",instance),settings_defineProperty(settings_assertThisInitialized(_this),"collection",instance.collection),settings_defineProperty(settings_assertThisInitialized(_this),"dict",new meteor.Q("settings")),_this}return function lib_settings_createClass(e,r,t){return r&&lib_settings_defineProperties(e.prototype,r),t&&lib_settings_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(Settings,[{key:"get",value:function get(_id){if(_id instanceof RegExp)throw new Error("RegExp Settings.get(RegExp)");if((arguments.length<=1?0:arguments.length-1)>0)throw new Error("settings.get(String, callback) only works on backend");return this.dict.get(_id)}},{key:"_storeSettingValue",value:function _storeSettingValue(record,initialLoad){meteor.fj.settings[record._id]=record.value,this.dict.set(record._id,record.value),this.load(record._id,record.value,initialLoad)}},{key:"init",value:function init(){var _this2=this,initialLoad=!0;this.collection.find().observe({added:function added(record){return _this2._storeSettingValue(record,initialLoad)},changed:function changed(record){return _this2._storeSettingValue(record,initialLoad)},removed:function removed(record){delete meteor.fj.settings[record._id],_this2.dict.set(record._id,null),_this2.load(record._id,void 0,initialLoad)}}),initialLoad=!1}}]),Settings}(SettingsBase),settings=new Settings;settings.init()},"./app/ui-cached-collection/client/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{I:function(){return _models_CachedCollectionManager__WEBPACK_IMPORTED_MODULE_1__.I},p:function(){return _models_CachedCollection__WEBPACK_IMPORTED_MODULE_0__.p}});var _models_CachedCollection__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./app/ui-cached-collection/client/models/CachedCollection.ts"),_models_CachedCollectionManager__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./app/ui-cached-collection/client/models/CachedCollectionManager.ts")},"./app/ui-cached-collection/client/models/CachedCollection.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{p:function(){return CachedCollection}});var _rocket_chat_emitter__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@rocket.chat/emitter/dist/index.module.js"),localforage__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/localforage/dist/localforage.js"),localforage__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(localforage__WEBPACK_IMPORTED_MODULE_1__),meteor_accounts_base__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./.storybook/mocks/meteor.js"),_client_lib_baseURI__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./client/lib/baseURI.ts"),_client_lib_utils_getConfig__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./client/lib/utils/getConfig.ts"),_lib_isTruthy__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./lib/isTruthy.ts"),_lib_utils_highOrderFunctions__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./lib/utils/highOrderFunctions.ts"),_utils_client_lib_SDKClient__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./app/utils/client/lib/SDKClient.ts"),_CachedCollectionManager__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./app/ui-cached-collection/client/models/CachedCollectionManager.ts");function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _createSuper(t){var r=_isNativeReflectConstruct();return function(){var e,o=_getPrototypeOf(t);if(r){var s=_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return _possibleConstructorReturn(this,e)}}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}var hasId=function hasId(record){return"object"===_typeof(record)&&null!==record&&"_id"in record},hasUpdatedAt=function hasUpdatedAt(record){return"object"===_typeof(record)&&null!==record&&"_updatedAt"in record&&record._updatedAt instanceof Date},hasDeletedAt=function hasDeletedAt(record){return"object"===_typeof(record)&&null!==record&&"_deletedAt"in record&&record._deletedAt instanceof Date};localforage__WEBPACK_IMPORTED_MODULE_1___default().config({name:_client_lib_baseURI__WEBPACK_IMPORTED_MODULE_3__.a});var CachedCollection=function(_Emitter){!function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}(CachedCollection,_Emitter);var _init,_sync,_setupListener,_clearCache,_loadFromServerAndPopulate,_loadFromServer,_callSync,_callLoad,_loadFromCache,_super=_createSuper(CachedCollection);function CachedCollection(_ref){var _this,name=_ref.name,_ref$eventType=_ref.eventType,eventType=void 0===_ref$eventType?"notify-user":_ref$eventType,_ref$userRelated=_ref.userRelated,userRelated=void 0===_ref$userRelated||_ref$userRelated;return function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,CachedCollection),_defineProperty(_assertThisInitialized(_this=_super.call(this)),"collection",void 0),_defineProperty(_assertThisInitialized(_this),"ready",new meteor_accounts_base__WEBPACK_IMPORTED_MODULE_2__.Hw(!1)),_defineProperty(_assertThisInitialized(_this),"name",void 0),_defineProperty(_assertThisInitialized(_this),"eventType",void 0),_defineProperty(_assertThisInitialized(_this),"version",18),_defineProperty(_assertThisInitialized(_this),"userRelated",void 0),_defineProperty(_assertThisInitialized(_this),"updatedAt",new Date(0)),_defineProperty(_assertThisInitialized(_this),"log",void 0),_defineProperty(_assertThisInitialized(_this),"timer",void 0),_defineProperty(_assertThisInitialized(_this),"save",(0,_lib_utils_highOrderFunctions__WEBPACK_IMPORTED_MODULE_7__.z)({wait:1e3})(_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var data;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _this.log("saving cache"),data=_this.collection.find().fetch(),_context.next=4,localforage__WEBPACK_IMPORTED_MODULE_1___default().setItem(_this.name,{updatedAt:_this.updatedAt,version:_this.version,token:_this.getToken(),records:data});case 4:_this.log("saving cache (done)");case 5:case"end":return _context.stop()}}),_callee)}))))),_this.collection=new meteor_accounts_base__WEBPACK_IMPORTED_MODULE_2__.Nf.Collection(null),_this.name=name,_this.eventType=eventType,_this.userRelated=userRelated,_this.log=[(0,_client_lib_utils_getConfig__WEBPACK_IMPORTED_MODULE_4__.z)("debugCachedCollection-".concat(_this.name)),(0,_client_lib_utils_getConfig__WEBPACK_IMPORTED_MODULE_4__.z)("debugCachedCollection"),(0,_client_lib_utils_getConfig__WEBPACK_IMPORTED_MODULE_4__.z)("debug")].includes("true")?console.log.bind(console,"%cCachedCollection ".concat(_this.name),"color: navy; font-weight: bold;"):function(){},_CachedCollectionManager__WEBPACK_IMPORTED_MODULE_6__.I.register(_assertThisInitialized(_this)),userRelated?(_CachedCollectionManager__WEBPACK_IMPORTED_MODULE_6__.I.onLogin((function(){_this.init()})),_this):(_this.init(),_possibleConstructorReturn(_this))}return function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(CachedCollection,[{key:"eventName",get:function get(){return"notify-user"===this.eventType?"".concat(meteor_accounts_base__WEBPACK_IMPORTED_MODULE_2__.fj.userId(),"/").concat(this.name,"-changed"):"".concat(this.name,"-changed")}},{key:"getToken",value:function getToken(){if(!1!==this.userRelated)return meteor_accounts_base__WEBPACK_IMPORTED_MODULE_2__.bX._storedLoginToken()}},{key:"loadFromCache",value:(_loadFromCache=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var data,deserializedRecords,updatedAt,_this2=this;return _regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,localforage__WEBPACK_IMPORTED_MODULE_1___default().getItem(this.name);case 2:if(data=_context2.sent){_context2.next=5;break}return _context2.abrupt("return",!1);case 5:if(!(data.version<this.version||data.token!==this.getToken())){_context2.next=7;break}return _context2.abrupt("return",!1);case 7:if(!(data.records.length<=0)){_context2.next=9;break}return _context2.abrupt("return",!1);case 9:if(data.updatedAt instanceof Date||(data.updatedAt=new Date(data.updatedAt)),!(Date.now()-data.updatedAt.getTime()>=1e3*CachedCollection.MAX_CACHE_TIME)){_context2.next=12;break}return _context2.abrupt("return",!1);case 12:return this.log("".concat(data.records.length," records loaded from cache")),deserializedRecords=data.records.map((function(record){return _this2.deserializeFromCache(record)})).filter(_lib_isTruthy__WEBPACK_IMPORTED_MODULE_8__.z),(updatedAt=Math.max.apply(Math,_toConsumableArray(deserializedRecords.filter(hasUpdatedAt).map((function(record){var _record$_updatedAt$ge;return null!==(_record$_updatedAt$ge=null==record?void 0:record._updatedAt.getTime())&&void 0!==_record$_updatedAt$ge?_record$_updatedAt$ge:0})))))>this.updatedAt.getTime()&&(this.updatedAt=new Date(updatedAt)),this.collection._collection._docs._map=new Map(deserializedRecords.filter(hasId).map((function(record){return[_this2.collection._collection._docs._idStringify(record._id),record]}))),this.updatedAt=data.updatedAt||this.updatedAt,Object.values(this.collection._collection.queries).forEach((function(query){return _this2.collection._collection._recomputeResults(query)})),_context2.abrupt("return",!0);case 20:case"end":return _context2.stop()}}),_callee2,this)}))),function loadFromCache(){return _loadFromCache.apply(this,arguments)})},{key:"deserializeFromCache",value:function deserializeFromCache(record){if("object"===_typeof(record)&&null!==record)return _objectSpread(_objectSpread({},record),function hasUnserializedUpdatedAt(record){return"object"===_typeof(record)&&null!==record&&"_updatedAt"in record&&!(record._updatedAt instanceof Date)}(record)&&{_updatedAt:new Date(record._updatedAt)})}},{key:"callLoad",value:(_callLoad=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(){var data;return _regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,_utils_client_lib_SDKClient__WEBPACK_IMPORTED_MODULE_5__.sdk.call("".concat(this.name,"/get"));case 2:return data=_context3.sent,_context3.abrupt("return",data);case 4:case"end":return _context3.stop()}}),_callee3,this)}))),function callLoad(){return _callLoad.apply(this,arguments)})},{key:"callSync",value:(_callSync=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(updatedSince){var data;return _regeneratorRuntime().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,_utils_client_lib_SDKClient__WEBPACK_IMPORTED_MODULE_5__.sdk.call("".concat(this.name,"/get"),updatedSince);case 2:return data=_context4.sent,_context4.abrupt("return",data);case 4:case"end":return _context4.stop()}}),_callee4,this)}))),function callSync(_x){return _callSync.apply(this,arguments)})},{key:"loadFromServer",value:(_loadFromServer=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(){var startTime,lastTime,data,_this3=this;return _regeneratorRuntime().wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return startTime=new Date,lastTime=this.updatedAt,_context5.next=4,this.callLoad();case 4:data=_context5.sent,this.log("".concat(data.length," records loaded from server")),data.forEach((function(record){var newRecord=_this3.handleLoadFromServer(record);if(hasId(newRecord)){var _id=newRecord._id;_this3.collection.upsert({_id:_id},newRecord),_this3.emit("changed",newRecord),hasUpdatedAt(newRecord)&&newRecord._updatedAt>_this3.updatedAt&&(_this3.updatedAt=newRecord._updatedAt)}})),this.updatedAt=this.updatedAt===lastTime?startTime:this.updatedAt;case 8:case"end":return _context5.stop()}}),_callee5,this)}))),function loadFromServer(){return _loadFromServer.apply(this,arguments)})},{key:"handleLoadFromServer",value:function handleLoadFromServer(record){return record}},{key:"handleReceived",value:function handleReceived(record,_action){return record}},{key:"handleSync",value:function handleSync(record,_action){return record}},{key:"loadFromServerAndPopulate",value:(_loadFromServerAndPopulate=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(){return _regeneratorRuntime().wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,this.loadFromServer();case 2:return _context6.next=4,this.save();case 4:case"end":return _context6.stop()}}),_callee6,this)}))),function loadFromServerAndPopulate(){return _loadFromServerAndPopulate.apply(this,arguments)})},{key:"clearCacheOnLogout",value:function clearCacheOnLogout(){!0===this.userRelated&&this.clearCache()}},{key:"clearCache",value:(_clearCache=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(){return _regeneratorRuntime().wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return this.log("clearing cache"),_context7.next=3,localforage__WEBPACK_IMPORTED_MODULE_1___default().removeItem(this.name);case 3:this.collection.remove({});case 4:case"end":return _context7.stop()}}),_callee7,this)}))),function clearCache(){return _clearCache.apply(this,arguments)})},{key:"setupListener",value:(_setupListener=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(){var _this4=this;return _regeneratorRuntime().wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:_utils_client_lib_SDKClient__WEBPACK_IMPORTED_MODULE_5__.sdk.stream(this.eventType,[this.eventName],function(){var _ref3=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(action,record){var newRecord,_id;return _regeneratorRuntime().wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(_this4.log("record received",action,record),newRecord=_this4.handleReceived(record,action),hasId(newRecord)){_context8.next=4;break}return _context8.abrupt("return");case 4:if("removed"!==action){_context8.next=8;break}_this4.collection.remove(newRecord._id),_context8.next=12;break;case 8:if(_id=newRecord._id){_context8.next=11;break}return _context8.abrupt("return");case 11:_this4.collection.upsert({_id:_id},newRecord);case 12:return _context8.next=14,_this4.save();case 14:case"end":return _context8.stop()}}),_callee8)})));return function(_x2,_x3){return _ref3.apply(this,arguments)}}());case 1:case"end":return _context9.stop()}}),_callee9,this)}))),function setupListener(){return _setupListener.apply(this,arguments)})},{key:"trySync",value:function trySync(){var _this5=this,delay=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;clearTimeout(this.timer),this.timer=setTimeout(_asyncToGenerator(_regeneratorRuntime().mark((function _callee10(){return _regeneratorRuntime().wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return _context10.next=2,_this5.sync();case 2:if(_context10.sent){_context10.next=4;break}return _context10.abrupt("return",_this5.trySync(delay));case 4:return _context10.next=6,_this5.save();case 6:case"end":return _context10.stop()}}),_callee10)}))),delay)}},{key:"sync",value:(_sync=_asyncToGenerator(_regeneratorRuntime().mark((function _callee11(){var startTime,lastTime,data,changes,_iterator,_step,_loop,_iterator2,_step2,_loop2,_this6=this;return _regeneratorRuntime().wrap((function _callee11$(_context13){for(;;)switch(_context13.prev=_context13.next){case 0:if(this.updatedAt&&0!==this.updatedAt.getTime()&&0===meteor_accounts_base__WEBPACK_IMPORTED_MODULE_2__.fj.connection._outstandingMethodBlocks.length){_context13.next=2;break}return _context13.abrupt("return",!1);case 2:return startTime=new Date,lastTime=this.updatedAt,this.log("syncing from ".concat(this.updatedAt)),_context13.next=7,this.callSync(this.updatedAt);case 7:if(data=_context13.sent,changes=[],!(data.update&&data.update.length>0)){_context13.next=29;break}this.log("".concat(data.update.length," records updated in sync")),_iterator=_createForOfIteratorHelper(data.update),_context13.prev=12,_loop=_regeneratorRuntime().mark((function _loop(){var record,_action2,newRecord,actionTime;return _regeneratorRuntime().wrap((function _loop$(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:if(record=_step.value,_action2="changed",newRecord=_this6.handleSync(record,_action2),hasId(newRecord)){_context11.next=5;break}return _context11.abrupt("return",1);case 5:actionTime=hasUpdatedAt(newRecord)?newRecord._updatedAt:startTime,changes.push({action:function action(){var _id=newRecord._id;_this6.collection.upsert({_id:_id},newRecord),actionTime>_this6.updatedAt&&(_this6.updatedAt=actionTime),_this6.emit(_action2,newRecord)},timestamp:actionTime.getTime()});case 7:case"end":return _context11.stop()}}),_loop)})),_iterator.s();case 15:if((_step=_iterator.n()).done){_context13.next=21;break}return _context13.delegateYield(_loop(),"t0",17);case 17:if(!_context13.t0){_context13.next=19;break}return _context13.abrupt("continue",19);case 19:_context13.next=15;break;case 21:_context13.next=26;break;case 23:_context13.prev=23,_context13.t1=_context13.catch(12),_iterator.e(_context13.t1);case 26:return _context13.prev=26,_iterator.f(),_context13.finish(26);case 29:if(!(data.remove&&data.remove.length>0)){_context13.next=49;break}this.log("".concat(data.remove.length," records removed in sync")),_iterator2=_createForOfIteratorHelper(data.remove),_context13.prev=32,_loop2=_regeneratorRuntime().mark((function _loop2(){var record,_action3,newRecord,actionTime;return _regeneratorRuntime().wrap((function _loop2$(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:if(record=_step2.value,_action3="removed",newRecord=_this6.handleSync(record,_action3),hasId(newRecord)&&hasDeletedAt(newRecord)){_context12.next=5;break}return _context12.abrupt("return",1);case 5:actionTime=newRecord._deletedAt,changes.push({action:function action(){var _id=newRecord._id;_this6.collection.remove({_id:_id}),actionTime>_this6.updatedAt&&(_this6.updatedAt=actionTime),_this6.emit(_action3,newRecord)},timestamp:actionTime.getTime()});case 7:case"end":return _context12.stop()}}),_loop2)})),_iterator2.s();case 35:if((_step2=_iterator2.n()).done){_context13.next=41;break}return _context13.delegateYield(_loop2(),"t2",37);case 37:if(!_context13.t2){_context13.next=39;break}return _context13.abrupt("continue",39);case 39:_context13.next=35;break;case 41:_context13.next=46;break;case 43:_context13.prev=43,_context13.t3=_context13.catch(32),_iterator2.e(_context13.t3);case 46:return _context13.prev=46,_iterator2.f(),_context13.finish(46);case 49:return changes.sort((function(a,b){return a.timestamp-b.timestamp})).forEach((function(c){c.action()})),this.updatedAt=this.updatedAt===lastTime?startTime:this.updatedAt,_context13.abrupt("return",!0);case 52:case"end":return _context13.stop()}}),_callee11,this,[[12,23,26,29],[32,43,46,49]])}))),function sync(){return _sync.apply(this,arguments)})},{key:"init",value:(_init=_asyncToGenerator(_regeneratorRuntime().mark((function _callee12(){var _this7=this;return _regeneratorRuntime().wrap((function _callee12$(_context14){for(;;)switch(_context14.prev=_context14.next){case 0:return this.ready.set(!1),_context14.next=3,this.loadFromCache();case 3:if(!_context14.sent){_context14.next=7;break}this.trySync(),_context14.next=9;break;case 7:return _context14.next=9,this.loadFromServerAndPopulate();case 9:return this.ready.set(!0),_CachedCollectionManager__WEBPACK_IMPORTED_MODULE_6__.I.onReconnect((function(){_this7.trySync()})),_context14.abrupt("return",this.setupListener());case 12:case"end":return _context14.stop()}}),_callee12,this)}))),function init(){return _init.apply(this,arguments)})}]),CachedCollection}(_rocket_chat_emitter__WEBPACK_IMPORTED_MODULE_0__.v);_defineProperty(CachedCollection,"MAX_CACHE_TIME",2592e3)},"./app/ui-cached-collection/client/models/CachedCollectionManager.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{I:function(){return instance}});var _rocket_chat_emitter__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@rocket.chat/emitter/dist/index.module.js"),meteor_accounts_base__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./.storybook/mocks/meteor.js");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _createSuper(t){var r=_isNativeReflectConstruct();return function(){var e,o=_getPrototypeOf(t);if(r){var s=_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}(this,e)}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}var CachedCollectionManager=function(_Emitter){!function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}(CachedCollectionManager,_Emitter);var _super=_createSuper(CachedCollectionManager);function CachedCollectionManager(){var _this;!function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,CachedCollectionManager),_defineProperty(_assertThisInitialized(_this=_super.call(this)),"items",void 0),_defineProperty(_assertThisInitialized(_this),"_syncEnabled",void 0),_defineProperty(_assertThisInitialized(_this),"logged",void 0),_defineProperty(_assertThisInitialized(_this),"step",void 0),_this.items=[],_this._syncEnabled=!1,_this.logged=!1;var _unstoreLoginToken=meteor_accounts_base__WEBPACK_IMPORTED_MODULE_1__.bX._unstoreLoginToken;return meteor_accounts_base__WEBPACK_IMPORTED_MODULE_1__.bX._unstoreLoginToken=function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];_unstoreLoginToken.apply(meteor_accounts_base__WEBPACK_IMPORTED_MODULE_1__.bX,args),_this.clearAllCacheOnLogout()},meteor_accounts_base__WEBPACK_IMPORTED_MODULE_1__.JD.autorun((function(){_this.step=_this.step||0;var connected=meteor_accounts_base__WEBPACK_IMPORTED_MODULE_1__.fj.status().connected;switch(_this.step){case 0:return!connected||_this.step++;case 1:return connected||_this.step++;case 2:return connected&&_this.emit("reconnect")}})),meteor_accounts_base__WEBPACK_IMPORTED_MODULE_1__.bX.onLogin((function(){_this.emit("login",meteor_accounts_base__WEBPACK_IMPORTED_MODULE_1__.fj.userId())})),meteor_accounts_base__WEBPACK_IMPORTED_MODULE_1__.JD.autorun((function(){var uid=meteor_accounts_base__WEBPACK_IMPORTED_MODULE_1__.fj.userId();_this.logged=null!==uid})),_this}return function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(CachedCollectionManager,[{key:"register",value:function register(cachedCollection){this.items.push(cachedCollection)}},{key:"clearAllCache",value:function clearAllCache(){var _step,_iterator=_createForOfIteratorHelper(this.items);try{for(_iterator.s();!(_step=_iterator.n()).done;){_step.value.clearCache()}}catch(err){_iterator.e(err)}finally{_iterator.f()}}},{key:"clearAllCacheOnLogout",value:function clearAllCacheOnLogout(){var _step2,_iterator2=_createForOfIteratorHelper(this.items);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){_step2.value.clearCacheOnLogout()}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}},{key:"syncEnabled",get:function get(){return this._syncEnabled},set:function set(value){(0,meteor_accounts_base__WEBPACK_IMPORTED_MODULE_1__.z6)(value,Boolean),this._syncEnabled=value}},{key:"onReconnect",value:function onReconnect(cb){this.on("reconnect",cb)}},{key:"onLogin",value:function onLogin(cb){this.on("login",cb),this.logged&&cb()}}]),CachedCollectionManager}(_rocket_chat_emitter__WEBPACK_IMPORTED_MODULE_0__.v),instance=new CachedCollectionManager},"./app/utils/client/getAvatarURL.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{$:function(){return getAvatarURL}});var _getURL__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./app/utils/client/getURL.ts"),getAvatarURL=function getAvatarURL(_ref){var username=_ref.username,roomId=_ref.roomId,cache=_ref.cache;return username?(0,_getURL__WEBPACK_IMPORTED_MODULE_0__.A)("/avatar/".concat(encodeURIComponent(username)).concat(cache?"?etag=".concat(cache):"")):roomId?(0,_getURL__WEBPACK_IMPORTED_MODULE_0__.A)("/avatar/room/".concat(encodeURIComponent(roomId)).concat(cache?"?etag=".concat(cache):"")):void 0}},"./app/utils/client/getURL.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{A:function(){return getURL}});var client=__webpack_require__("./app/settings/client/index.ts"),esm=__webpack_require__("./node_modules/@rocket.chat/string-helpers/dist/esm/index.js"),stringUtils=__webpack_require__("./lib/utils/stringUtils.ts");function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var _getURL=function _getURL(path,_ref3,deeplinkUrl){var cdn=_ref3.cdn,full=_ref3.full,cloud=_ref3.cloud,cloud_route=_ref3.cloud_route,cloud_params=_ref3.cloud_params,_cdn_prefix=_ref3._cdn_prefix,_root_url_path_prefix=_ref3._root_url_path_prefix,_site_url=_ref3._site_url;if(function isURL(str){return/^(https?:\/\/|data:)/.test(str)}(path))return path;var _path$split2=_slicedToArray(path.split("?"),2),_path=_path$split2[0],_query=_path$split2[1];path=_path;var query=_query?"?".concat(_query):"",siteUrl=(0,stringUtils.BO)((0,stringUtils.Bq)(_site_url||""),"/"),cloudRoute=(0,stringUtils.Bq)(cloud_route||""),cdnPrefix=(0,stringUtils.BO)((0,stringUtils.Bq)(_cdn_prefix||""),"/"),pathPrefix=(0,stringUtils.BO)((0,stringUtils.Bq)(_root_url_path_prefix||""),"/"),finalPath=(0,stringUtils.NB)((0,stringUtils.Bq)(path),"/"),url=(0,stringUtils.BO)("".concat(pathPrefix,"/").concat(finalPath),"/")+query;return cloud?function getCloudUrl(path,_site_url,cloudRoute){var cloudParams=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},cloudBaseUrl=(arguments.length>4&&void 0!==arguments[4]?arguments[4]:"").replace(/\/+$/,""),siteUrl=(0,stringUtils.BO)(_site_url,"/"),host=siteUrl.replace(/https?\:\/\//i,"");path=(0,stringUtils.NB)(path,"/"),Object.assign(cloudParams,{host:host,path:path}),siteUrl.includes("http://")&&(cloudParams.secure="no");var params=Object.entries(cloudParams).map((function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];return"".concat(key,"=").concat(encodeURIComponent(value))})).join("&");return"".concat(cloudBaseUrl,"/").concat(cloudRoute,"?").concat(params)}(url,siteUrl,cloudRoute,cloud_params||{},deeplinkUrl):cdn&&""!==cdnPrefix?cdnPrefix+url:full?siteUrl.replace(new RegExp("".concat((0,esm.Nt)(pathPrefix),"$")),"")+url:url},rocketchat=__webpack_require__("./app/utils/rocketchat.info"),getURL=function getURL(path){var params=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},cloudDeepLinkUrl=arguments.length>2?arguments[2]:void 0,cacheKey=arguments.length>3?arguments[3]:void 0,cdnPrefix=client.W.get("CDN_PREFIX")||"",siteUrl=client.W.get("Site_Url")||"";return cacheKey&&(path+="".concat(path.includes("?")?"&":"?","cacheKey=").concat(rocketchat.Info.version)),function getURLWithoutSettings(path,_ref4,cdnPrefix,siteUrl,cloudDeepLinkUrl){var _ref4$cdn=_ref4.cdn,cdn=void 0===_ref4$cdn||_ref4$cdn,_ref4$full=_ref4.full,full=void 0!==_ref4$full&&_ref4$full,_ref4$cloud=_ref4.cloud,cloud=void 0!==_ref4$cloud&&_ref4$cloud,_ref4$cloud_route=_ref4.cloud_route,cloud_route=void 0===_ref4$cloud_route?"":_ref4$cloud_route,_ref4$cloud_params=_ref4.cloud_params;return _getURL(path,{cdn:cdn,full:full,cloud:cloud,cloud_route:cloud_route,cloud_params:void 0===_ref4$cloud_params?{}:_ref4$cloud_params,_cdn_prefix:cdnPrefix,_root_url_path_prefix:__meteor_runtime_config__.ROOT_URL_PATH_PREFIX,_site_url:siteUrl},cloudDeepLinkUrl)}(path,params,cdnPrefix,siteUrl,cloudDeepLinkUrl)}},"./app/utils/client/getUserAvatarURL.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{k:function(){return getUserAvatarURL}});var _getAvatarURL__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./app/utils/client/getAvatarURL.ts"),getUserAvatarURL=function getUserAvatarURL(username){var cache=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(null!=username)return(0,_getAvatarURL__WEBPACK_IMPORTED_MODULE_0__.$)({username:username,cache:cache})}},"./app/utils/client/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{nj:function(){return fileUploadIsValidContentType},AP:function(){return getURL.A},ku:function(){return getUserAvatarURL.k},Tj:function(){return getUserPreference},O4:function(){return slashCommand.O}});__webpack_require__("./app/utils/rocketchat.info");var client=__webpack_require__("./app/models/client/index.ts"),settings_client=__webpack_require__("./app/settings/client/index.ts");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function getUserPreference(userIdOrUser,key,defaultValue){var _ref,_user$settings$prefer,_user$settings,user="string"==typeof userIdOrUser?client.Users.findOne(userIdOrUser,{fields:_defineProperty({},"settings.preferences.".concat(key),1)}):userIdOrUser;return null!==(_ref=null!==(_user$settings$prefer=null==user||null===(_user$settings=user.settings)||void 0===_user$settings||null===(_user$settings=_user$settings.preferences)||void 0===_user$settings?void 0:_user$settings[key])&&void 0!==_user$settings$prefer?_user$settings$prefer:defaultValue)&&void 0!==_ref?_ref:settings_client.W.get("Accounts_Default_User_Preferences_".concat(key))}var isTypeOnList=function isTypeOnList(type,list){if(!type||!list)return!1;if(list.includes(type))return!0;return!!list.filter((function(item){return item.indexOf("/*")>0})).includes(type.replace(/(\/.*)$/,"/*"))},fileUploadIsValidContentType=function fileUploadIsValidContentType(type,customWhiteList){var blackList=settings_client.W.get("FileUpload_MediaTypeBlackList");return function fileUploadIsValidContentTypeFromSettings(type,customWhiteList,customBlackList){var blackList=function fileUploadMediaBlackList(customBlackList){if(customBlackList)return customBlackList.split(",").map((function(item){return item.trim()}))}(customBlackList),whiteList=function fileUploadMediaWhiteList(customWhiteList){if(customWhiteList&&"*"!==customWhiteList)return customWhiteList.split(",").map((function(item){return item.trim()}))}(customWhiteList);return!(blackList&&type&&isTypeOnList(type,blackList))&&(whiteList?isTypeOnList(type,whiteList):!whiteList)}(type,customWhiteList||settings_client.W.get("FileUpload_MediaTypeWhiteList"),blackList)},getUserAvatarURL=__webpack_require__("./app/utils/client/getUserAvatarURL.ts"),slashCommand=__webpack_require__("./app/utils/client/slashCommand.ts"),getURL=__webpack_require__("./app/utils/client/getURL.ts");__webpack_require__("./app/utils/client/lib/RestApiClient.ts")},"./app/utils/client/slashCommand.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{O:function(){return slashCommands}});var RocketChatError=__webpack_require__("./client/lib/errors/RocketChatError.ts");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _createSuper(t){var r=_isNativeReflectConstruct();return function(){var e,o=_getPrototypeOf(t);if(r){var s=_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,e)}}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var InvalidCommandUsage=function(_RocketChatError){!function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}(InvalidCommandUsage,_RocketChatError);var _super=_createSuper(InvalidCommandUsage);function InvalidCommandUsage(){var message=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Executing a command requires at least a message with a room id.",details=arguments.length>1?arguments[1]:void 0;return function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,InvalidCommandUsage),_super.call(this,"invalid-command-usage",message,details)}return function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(InvalidCommandUsage)}(RocketChatError.H);function InvalidPreview_typeof(o){return InvalidPreview_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},InvalidPreview_typeof(o)}function InvalidPreview_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,InvalidPreview_toPropertyKey(o.key),o)}}function InvalidPreview_toPropertyKey(t){var i=function InvalidPreview_toPrimitive(t,r){if("object"!=InvalidPreview_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=InvalidPreview_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==InvalidPreview_typeof(i)?i:i+""}function InvalidPreview_setPrototypeOf(t,e){return InvalidPreview_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},InvalidPreview_setPrototypeOf(t,e)}function InvalidPreview_createSuper(t){var r=InvalidPreview_isNativeReflectConstruct();return function(){var e,o=InvalidPreview_getPrototypeOf(t);if(r){var s=InvalidPreview_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function InvalidPreview_possibleConstructorReturn(t,e){if(e&&("object"==InvalidPreview_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function InvalidPreview_assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,e)}}function InvalidPreview_isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(InvalidPreview_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function InvalidPreview_getPrototypeOf(t){return InvalidPreview_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},InvalidPreview_getPrototypeOf(t)}var InvalidPreview=function(_RocketChatError){!function InvalidPreview_inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&InvalidPreview_setPrototypeOf(t,e)}(InvalidPreview,_RocketChatError);var _super=InvalidPreview_createSuper(InvalidPreview);function InvalidPreview(){var message=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Preview Item must have an id, type, and value.",details=arguments.length>1?arguments[1]:void 0;return function InvalidPreview_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,InvalidPreview),_super.call(this,"error-invalid-preview",message,details)}return function InvalidPreview_createClass(e,r,t){return r&&InvalidPreview_defineProperties(e.prototype,r),t&&InvalidPreview_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(InvalidPreview)}(RocketChatError.H);function slashCommand_typeof(o){return slashCommand_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},slashCommand_typeof(o)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==slashCommand_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(slashCommand_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var slashCommands={commands:{},add:function add(_ref){var command=_ref.command,callback=_ref.callback,_ref$options=_ref.options,options=void 0===_ref$options?{}:_ref$options,result=_ref.result,_ref$providesPreview=_ref.providesPreview,providesPreview=void 0!==_ref$providesPreview&&_ref$providesPreview,previewer=_ref.previewer,previewCallback=_ref.previewCallback,appId=_ref.appId,_ref$description=_ref.description,description=void 0===_ref$description?"":_ref$description;this.commands[command]||(this.commands[command]={command:command,callback:callback,params:options.params,description:options.description||description,permission:options.permission,clientOnly:options.clientOnly||!1,result:result,providesPreview:Boolean(providesPreview),previewer:previewer,previewCallback:previewCallback,appId:appId})},run:function run(_ref2){var _this=this;return _asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var command,message,params,triggerId,userId,cmd;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(command=_ref2.command,message=_ref2.message,params=_ref2.params,triggerId=_ref2.triggerId,userId=_ref2.userId,"function"==typeof(null==(cmd=_this.commands[command])?void 0:cmd.callback)){_context.next=4;break}return _context.abrupt("return");case 4:if(null!=message&&message.rid){_context.next=6;break}throw new InvalidCommandUsage;case 6:return _context.abrupt("return",cmd.callback({command:command,params:params,message:message,triggerId:triggerId,userId:userId}));case 7:case"end":return _context.stop()}}),_callee)})))()},getPreviews:function getPreviews(command,params,message){var _this2=this;return _asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var _previewInfo$items,cmd,previewInfo;return _regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if("function"==typeof(null==(cmd=_this2.commands[command])?void 0:cmd.previewer)){_context2.next=3;break}return _context2.abrupt("return");case 3:if(null!=message&&message.rid){_context2.next=5;break}throw new InvalidCommandUsage;case 5:return _context2.next=7,cmd.previewer(command,params,message);case 7:if(null!=(previewInfo=_context2.sent)&&null!==(_previewInfo$items=previewInfo.items)&&void 0!==_previewInfo$items&&_previewInfo$items.length){_context2.next=10;break}return _context2.abrupt("return");case 10:return previewInfo.items.length>=10&&(previewInfo.items=previewInfo.items.slice(0,10)),_context2.abrupt("return",previewInfo);case 12:case"end":return _context2.stop()}}),_callee2)})))()},executePreview:function executePreview(command,params,message,preview,triggerId){var _this3=this;return _asyncToGenerator(_regeneratorRuntime().mark((function _callee3(){var cmd;return _regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if("function"==typeof(null==(cmd=_this3.commands[command])?void 0:cmd.previewCallback)){_context3.next=3;break}return _context3.abrupt("return");case 3:if(null!=message&&message.rid){_context3.next=5;break}throw new InvalidCommandUsage;case 5:if(preview.id&&preview.type&&preview.value){_context3.next=7;break}throw new InvalidPreview;case 7:return _context3.abrupt("return",cmd.previewCallback(command,params,message,preview,triggerId));case 8:case"end":return _context3.stop()}}),_callee3)})))()}}},"./client/lib/errors/RocketChatError.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createSuper(t){var r=_isNativeReflectConstruct();return function(){var e,o=_getPrototypeOf(t);if(r){var s=_getPrototypeOf(this).constructor;e=Reflect.construct(o,arguments,s)}else e=o.apply(this,arguments);return function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}(this,e)}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _wrapNativeSuper(t){var r="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!function _isNativeFunction(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(n){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,Wrapper)}function Wrapper(){return function _construct(t,e,r){if(_isNativeReflectConstruct())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,e);var p=new(t.bind.apply(t,o));return r&&_setPrototypeOf(p,r.prototype),p}(t,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,t)},_wrapNativeSuper(t)}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}__webpack_require__.d(__webpack_exports__,{H:function(){return RocketChatError}});var RocketChatError=function(_Error){!function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}(RocketChatError,_Error);var _super=_createSuper(RocketChatError);function RocketChatError(error,reason,details){var _this;return function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,RocketChatError),_defineProperty(_assertThisInitialized(_this=_super.call(this,reason?"".concat(reason," [").concat(error,"]"):"[".concat(error,"]"))),"error",void 0),_defineProperty(_assertThisInitialized(_this),"reason",void 0),_defineProperty(_assertThisInitialized(_this),"details",void 0),_this.error=error,_this.reason=reason,_this.details=details,_this}return function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(RocketChatError)}(_wrapNativeSuper(Error))},"./client/lib/utils/getConfig.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{z:function(){return getConfig}});var meteor_meteor__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./.storybook/mocks/meteor.js"),getConfig=function getConfig(key,defaultValue){var _ref,storedItem=new URLSearchParams(window.location.search).get(key)||meteor_meteor__WEBPACK_IMPORTED_MODULE_0__.fj._localStorage.getItem("rc-config-".concat(key));return null!==(_ref=null!=storedItem?storedItem:defaultValue)&&void 0!==_ref?_ref:null}},"./lib/isTruthy.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{z:function(){return isTruthy}});var isTruthy=function isTruthy(x){return Boolean(x)}},"./lib/utils/highOrderFunctions.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{u:function(){return withThrottling},z:function(){return withDebouncing}});var withThrottling=function withThrottling(_ref){var wait=_ref.wait,leading=_ref.leading,trailing=_ref.trailing;return function(fn){var result,timer=void 0,previous=0;return Object.assign((function throttled(){for(var _this=this,_len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var now=Date.now();previous||!1!==leading||(previous=now);var remaining=wait-(now-previous);if(remaining<=0||remaining>wait)timer&&clearTimeout(timer),timer=void 0,previous=now,result=fn.apply(this,args);else if(!timer&&!1!==trailing){timer=setTimeout((function later(){previous=!1===leading?0:Date.now(),result=fn.apply(_this,args),timer=void 0}),remaining)}return result}),{cancel:function cancel(){timer&&clearTimeout(timer),previous=0,timer=void 0}})}},withDebouncing=function withDebouncing(_ref2){var wait=_ref2.wait,immediate=_ref2.immediate;return function(fn){var result,previous,timer=void 0;return Object.assign((function debounced(){for(var _this2=this,_len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];if(previous=Date.now(),!timer){timer=setTimeout((function later(){var passed=Date.now()-previous;wait>passed?timer=setTimeout(later,wait-passed):(timer=void 0,immediate||(result=fn.apply(_this2,args)))}),wait),immediate&&(result=fn.apply(this,args))}return result}),{cancel:function cancel(){clearTimeout(timer),timer=void 0}})}}},"./lib/utils/stringUtils.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{BO:function(){return rtrim},Bq:function(){return trim},Kq:function(){return stripTags},NB:function(){return ltrim},g:function(){return strRight},jq:function(){return numberFormat}});var _rocket_chat_string_helpers__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@rocket.chat/string-helpers/dist/esm/index.js"),dompurify__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/dompurify/dist/purify.js");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function makeString(object){return object?String(object):""}function defaultToWhiteSpace(characters){return characters?"object"===_typeof(characters)&&"source"in characters?characters.source:"[".concat((0,_rocket_chat_string_helpers__WEBPACK_IMPORTED_MODULE_0__.Nt)(makeString(characters)),"]"):"\\s"}var nativeTrim=String.prototype.trim,nativeTrimLeft=String.prototype.trimLeft,nativeTrimRight=String.prototype.trimRight;function trim(_str,_characters){var str=makeString(_str);if(!_characters&&nativeTrim)return nativeTrim.call(str);var characters=defaultToWhiteSpace(_characters);return str.replace(new RegExp("^".concat(characters,"+|").concat(characters,"+$"),"g"),"")}function ltrim(_str,_characters){var str=makeString(_str);if(!_characters&&nativeTrimLeft)return nativeTrimLeft.call(str);var characters=defaultToWhiteSpace(_characters);return str.replace(new RegExp("^".concat(characters,"+")),"")}function rtrim(_str,_characters){var str=makeString(_str);if(!_characters&&nativeTrimRight)return nativeTrimRight.call(str);var characters=defaultToWhiteSpace(_characters);return str.replace(new RegExp("".concat(characters,"+$")),"")}function stripTags(str){return(0,dompurify__WEBPACK_IMPORTED_MODULE_1__.sanitize)(makeString(str)).replace(/<\/?[^>]+>/g,"")}function strRight(_str,_sep){var str=makeString(_str),sep=makeString(_sep),pos=sep?str.indexOf(sep):-1;return~pos?str.slice(pos+sep.length,str.length):str}function numberFormat(_number,dec,dsep,tsep){if(isNaN(_number)||null==_number)return"";tsep="string"==typeof tsep?tsep:",";var parts=_number.toFixed(~~dec).split("."),fnums=parts[0],decimals=parts[1]?(dsep||".")+parts[1]:"";return fnums.replace(/(\d)(?=(?:\d{3})+$)/g,"$1".concat(tsep))+decimals}},"./node_modules/localforage/dist sync recursive":function(module){function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=function(){return[]},webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id="./node_modules/localforage/dist sync recursive",module.exports=webpackEmptyContext},"./app/utils/rocketchat.info":function(module){"use strict";module.exports={}}}]);