/*! For license information please see 9524.1edf4415.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_rocket_chat_meteor=self.webpackChunk_rocket_chat_meteor||[]).push([[9524],{"./app/otr/lib/OtrRoomState.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Q:function(){return OtrRoomState}});var OtrRoomState=function(OtrRoomState){return OtrRoomState.DISABLED="DISABLED",OtrRoomState.NOT_STARTED="NOT_STARTED",OtrRoomState.REQUESTED="REQUESTED",OtrRoomState.ESTABLISHING="ESTABLISHING",OtrRoomState.ESTABLISHED="ESTABLISHED",OtrRoomState.ERROR="ERROR",OtrRoomState.TIMEOUT="TIMEOUT",OtrRoomState.DECLINED="DECLINED",OtrRoomState}({})},"./client/apps/gameCenter/hooks/useExternalComponentsQuery.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{X:function(){return useExternalComponentsQuery}});var _rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../packages/ui-contexts/dist/index.js"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/@tanstack/react-query/build/lib/index.js");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var useExternalComponentsQuery=function useExternalComponentsQuery(){var getExternalComponents=(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useEndpoint)("GET","/apps/externalComponents");return(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_1__.useQuery)(["apps/external-components"],_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,getExternalComponents();case 2:return _context.abrupt("return",_context.sent.externalComponents);case 3:case"end":return _context.stop()}}),_callee)}))),{staleTime:1e4})}},"./client/hooks/useOTR.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{N:function(){return useOTR}});var dist=__webpack_require__("../../packages/ui-contexts/dist/index.js"),react=__webpack_require__("./node_modules/react/index.js"),core_typings_dist=__webpack_require__("../../packages/core-typings/dist/index.js"),main_client=__webpack_require__("../../packages/random/dist/main.client.js"),ejson=__webpack_require__("./node_modules/ejson/index.js"),ejson_default=__webpack_require__.n(ejson),meteor=__webpack_require__("./.storybook/mocks/meteor.js"),GenericModal=__webpack_require__("./client/components/GenericModal/index.ts"),imperativeModal=__webpack_require__("./client/lib/imperativeModal.tsx"),presence=__webpack_require__("./client/lib/presence.ts"),toast=__webpack_require__("./client/lib/toast.ts"),client=__webpack_require__("./app/models/client/index.ts"),goToRoomById=__webpack_require__("./client/lib/utils/goToRoomById.ts"),SDKClient=__webpack_require__("./app/utils/client/lib/SDKClient.ts"),i18n=__webpack_require__("./app/utils/lib/i18n.ts"),OtrRoomState=__webpack_require__("./app/otr/lib/OtrRoomState.ts"),otrSystemMessages=function(otrSystemMessages){return otrSystemMessages.USER_JOINED_OTR="user_joined_otr",otrSystemMessages.USER_REQUESTED_OTR_KEY_REFRESH="user_requested_otr_key_refresh",otrSystemMessages.USER_KEY_REFRESHED_SUCCESSFULLY="user_key_refreshed_successfully",otrSystemMessages}({});function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var subtle=__webpack_require__.g.crypto.subtle,joinEncryptedData=function joinEncryptedData(_ref){var encryptedData=_ref.encryptedData,iv=_ref.iv,cipherText=new Uint8Array(encryptedData),output=new Uint8Array(iv.length+cipherText.length);return output.set(iv,0),output.set(cipherText,iv.length),output},encryptAES=function(){var _ref3=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(_ref2){var iv,_sessionKey,data;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return iv=_ref2.iv,_sessionKey=_ref2._sessionKey,data=_ref2.data,_context.abrupt("return",subtle.encrypt({name:"AES-GCM",iv:iv},_sessionKey,data));case 2:case"end":return _context.stop()}}),_callee)})));return function encryptAES(_x){return _ref3.apply(this,arguments)}}(),digest=function(){var _ref4=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(bits){return _regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",subtle.digest({name:"SHA-256"},bits));case 1:case"end":return _context2.stop()}}),_callee2)})));return function digest(_x2){return _ref4.apply(this,arguments)}}(),deriveBits=function(){var _ref6=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(_ref5){var ecdhObj,_keyPair;return _regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(ecdhObj=_ref5.ecdhObj,(_keyPair=_ref5._keyPair).privateKey){_context3.next=3;break}throw new Error("No private key");case 3:return _context3.abrupt("return",subtle.deriveBits(ecdhObj,_keyPair.privateKey,256));case 4:case"end":return _context3.stop()}}),_callee3)})));return function deriveBits(_x3){return _ref6.apply(this,arguments)}}(),importKey=function(){var _ref7=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(publicKeyObject){return _regeneratorRuntime().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",subtle.importKey("jwk",publicKeyObject,{name:"ECDH",namedCurve:"P-256"},!1,[]));case 1:case"end":return _context4.stop()}}),_callee4)})));return function importKey(_x4){return _ref7.apply(this,arguments)}}(),importKeyRaw=function(){var _ref8=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(sessionKeyData){return _regeneratorRuntime().wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.abrupt("return",subtle.importKey("raw",sessionKeyData,{name:"AES-GCM"},!1,["encrypt","decrypt"]));case 1:case"end":return _context5.stop()}}),_callee5)})));return function importKeyRaw(_x5){return _ref8.apply(this,arguments)}}(),exportKey=function(){var _ref9=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(_keyPair){return _regeneratorRuntime().wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.abrupt("return",subtle.exportKey("jwk",_keyPair));case 1:case"end":return _context6.stop()}}),_callee6)})));return function exportKey(_x6){return _ref9.apply(this,arguments)}}(),functions_generateKeyPair=function(){var _ref10=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(){return _regeneratorRuntime().wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.abrupt("return",subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey","deriveBits"]));case 1:case"end":return _context7.stop()}}),_callee7)})));return function generateKeyPair(){return _ref10.apply(this,arguments)}}(),decryptAES=function(){var _ref11=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(cipherText,_sessionKey){var iv,data;return _regeneratorRuntime().wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return iv=cipherText.slice(0,12),cipherText=cipherText.slice(12),_context8.next=4,subtle.decrypt({name:"AES-GCM",iv:iv},_sessionKey,cipherText);case 4:return data=_context8.sent,_context8.abrupt("return",data);case 6:case"end":return _context8.stop()}}),_callee8)})));return function decryptAES(_x7,_x8){return _ref11.apply(this,arguments)}}();function OTRRoom_typeof(o){return OTRRoom_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},OTRRoom_typeof(o)}function OTRRoom_regeneratorRuntime(){OTRRoom_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==OTRRoom_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(OTRRoom_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function OTRRoom_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function OTRRoom_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){OTRRoom_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){OTRRoom_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=OTRRoom_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=OTRRoom_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==OTRRoom_typeof(i)?i:i+""}var OTRRoom=function(){function OTRRoom(uid,rid,peerId){!function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,OTRRoom),_defineProperty(this,"_userId",void 0),_defineProperty(this,"_roomId",void 0),_defineProperty(this,"_keyPair",void 0),_defineProperty(this,"_exportedPublicKey",void 0),_defineProperty(this,"_sessionKey",void 0),_defineProperty(this,"_userOnlineComputation",void 0),_defineProperty(this,"peerId",void 0),_defineProperty(this,"state",new meteor.Hw(OtrRoomState.Q.NOT_STARTED)),_defineProperty(this,"isFirstOTR",void 0),_defineProperty(this,"onPresenceEventHook",void 0),this._userId=uid,this._roomId=rid,this._keyPair=null,this._sessionKey=null,this.peerId=peerId,this.isFirstOTR=!0,this.onPresenceEventHook=this.onPresenceEvent.bind(this)}var _onUserStream,_decrypt,_encrypt,_encryptText,_importPublicKey,_generateKeyPair2,_handshake;return function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(OTRRoom,[{key:"getPeerId",value:function getPeerId(){return this.peerId}},{key:"getState",value:function getState(){return this.state.get()}},{key:"setState",value:function setState(nextState){this.getState()!==nextState&&this.state.set(nextState)}},{key:"handshake",value:(_handshake=OTRRoom_asyncToGenerator(OTRRoom_regeneratorRuntime().mark((function _callee(refresh){return OTRRoom_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return this.setState(OtrRoomState.Q.ESTABLISHING),_context.next=3,this.generateKeyPair();case 3:if(SDKClient.sdk.publish("notify-user",["".concat(this.peerId,"/otr"),"handshake",{roomId:this._roomId,userId:this._userId,publicKey:ejson_default().stringify(this._exportedPublicKey),refresh:refresh}]),!refresh){_context.next=11;break}if(meteor.fj.user()){_context.next=8;break}return _context.abrupt("return");case 8:return _context.next=10,SDKClient.sdk.rest.post("/v1/chat.otr",{roomId:this._roomId,type:otrSystemMessages.USER_REQUESTED_OTR_KEY_REFRESH});case 10:this.isFirstOTR=!1;case 11:case"end":return _context.stop()}}),_callee,this)}))),function handshake(_x){return _handshake.apply(this,arguments)})},{key:"onPresenceEvent",value:function onPresenceEvent(event){event&&event.status===core_typings_dist.UserStatus.OFFLINE&&(console.warn("OTR Room ".concat(this._roomId," ended because ").concat(this.peerId," went offline")),this.end(),imperativeModal.K.open({component:GenericModal.A,props:{variant:"warning",title:(0,i18n.t)("OTR"),children:(0,i18n.t)("OTR_Session_ended_other_user_went_offline",{username:event.username}),confirmText:(0,i18n.t)("Ok"),onClose:imperativeModal.K.close,onConfirm:imperativeModal.K.close}}))}},{key:"listenToUserStatus",value:function listenToUserStatus(){presence.C.listen(this.peerId,this.onPresenceEventHook)}},{key:"acknowledge",value:function acknowledge(){SDKClient.sdk.rest.post("/v1/statistics.telemetry",{params:[{eventName:"otrStats",timestamp:Date.now(),rid:this._roomId}]}),SDKClient.sdk.publish("notify-user",["".concat(this.peerId,"/otr"),"acknowledge",{roomId:this._roomId,userId:this._userId,publicKey:ejson_default().stringify(this._exportedPublicKey)}])}},{key:"deny",value:function deny(){this.reset(),this.setState(OtrRoomState.Q.DECLINED),SDKClient.sdk.publish("notify-user",["".concat(this.peerId,"/otr"),"deny",{roomId:this._roomId,userId:this._userId}])}},{key:"softReset",value:function softReset(){this.isFirstOTR=!0,this.setState(OtrRoomState.Q.NOT_STARTED),this._keyPair=null,this._exportedPublicKey={},this._sessionKey=null}},{key:"end",value:function end(){this.isFirstOTR=!0,this.reset(),this.setState(OtrRoomState.Q.NOT_STARTED),presence.C.stop(this.peerId,this.onPresenceEventHook),SDKClient.sdk.publish("notify-user",["".concat(this.peerId,"/otr"),"end",{roomId:this._roomId,userId:this._userId}])}},{key:"reset",value:function reset(){this._keyPair=null,this._exportedPublicKey={},this._sessionKey=null,SDKClient.sdk.call("deleteOldOTRMessages",this._roomId)}},{key:"generateKeyPair",value:(_generateKeyPair2=OTRRoom_asyncToGenerator(OTRRoom_regeneratorRuntime().mark((function _callee2(){var _this=this;return OTRRoom_regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return this._userOnlineComputation&&this._userOnlineComputation.stop(),this._userOnlineComputation=meteor.JD.autorun((function(){var $room=document.querySelector("#chat-window-".concat(_this._roomId)),$title=null==$room?void 0:$room.querySelector(".rc-header__title");if(_this.getState()===OtrRoomState.Q.ESTABLISHED)$room&&$title&&!$title.querySelector(".otr-icon")&&$title.prepend("<i class='otr-icon icon-key'></i>");else if($title){var _$title$querySelector;null===(_$title$querySelector=$title.querySelector(".otr-icon"))||void 0===_$title$querySelector||_$title$querySelector.remove()}})),_context2.prev=2,_context2.next=5,functions_generateKeyPair();case 5:if(this._keyPair=_context2.sent,this._keyPair.publicKey){_context2.next=8;break}throw new Error("Public key is not generated");case 8:return _context2.next=10,exportKey(this._keyPair.publicKey);case 10:this._exportedPublicKey=_context2.sent,SDKClient.sdk.call("deleteOldOTRMessages",this._roomId),_context2.next=18;break;case 14:throw _context2.prev=14,_context2.t0=_context2.catch(2),this.setState(OtrRoomState.Q.ERROR),_context2.t0;case 18:case"end":return _context2.stop()}}),_callee2,this,[[2,14]])}))),function generateKeyPair(){return _generateKeyPair2.apply(this,arguments)})},{key:"importPublicKey",value:(_importPublicKey=OTRRoom_asyncToGenerator(OTRRoom_regeneratorRuntime().mark((function _callee3(publicKey){var publicKeyObject,peerPublicKey,ecdhObj,bits,hashedBits,sessionKeyData;return OTRRoom_regeneratorRuntime().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(_context3.prev=0,this._keyPair){_context3.next=3;break}throw new Error("No key pair");case 3:return publicKeyObject=ejson_default().parse(publicKey),_context3.next=6,importKey(publicKeyObject);case 6:return peerPublicKey=_context3.sent,ecdhObj={name:"ECDH",namedCurve:"P-256",public:peerPublicKey},_context3.next=10,deriveBits({ecdhObj:ecdhObj,_keyPair:this._keyPair});case 10:return bits=_context3.sent,_context3.next=13,digest(bits);case 13:return hashedBits=_context3.sent,sessionKeyData=new Uint8Array(hashedBits).slice(0,16),_context3.next=17,importKeyRaw(sessionKeyData);case 17:this._sessionKey=_context3.sent,_context3.next=24;break;case 20:throw _context3.prev=20,_context3.t0=_context3.catch(0),this.setState(OtrRoomState.Q.ERROR),_context3.t0;case 24:case"end":return _context3.stop()}}),_callee3,this,[[0,20]])}))),function importPublicKey(_x2){return _importPublicKey.apply(this,arguments)})},{key:"encryptText",value:(_encryptText=OTRRoom_asyncToGenerator(OTRRoom_regeneratorRuntime().mark((function _callee4(data){var iv,encryptedData,output;return OTRRoom_regeneratorRuntime().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if("string"==typeof data&&(data=(new TextEncoder).encode(ejson_default().stringify({text:data,ack:main_client.o.id(20*(main_client.o.fraction()+1))}))),_context4.prev=1,this._sessionKey){_context4.next=4;break}throw new Error("Session Key not available");case 4:return iv=crypto.getRandomValues(new Uint8Array(12)),_context4.next=7,encryptAES({iv:iv,_sessionKey:this._sessionKey,data:data});case 7:return encryptedData=_context4.sent,output=joinEncryptedData({encryptedData:encryptedData,iv:iv}),_context4.abrupt("return",ejson_default().stringify(output));case 12:throw _context4.prev=12,_context4.t0=_context4.catch(1),this.setState(OtrRoomState.Q.ERROR),new meteor.fj.Error("encryption-error","Encryption error.");case 16:case"end":return _context4.stop()}}),_callee4,this,[[1,12]])}))),function encryptText(_x3){return _encryptText.apply(this,arguments)})},{key:"encrypt",value:(_encrypt=OTRRoom_asyncToGenerator(OTRRoom_regeneratorRuntime().mark((function _callee5(message){var data,enc;return OTRRoom_regeneratorRuntime().wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.prev=0,data=(new TextEncoder).encode(ejson_default().stringify({_id:message._id,text:message.msg,userId:this._userId,ack:main_client.o.id(20*(main_client.o.fraction()+1)),ts:new Date})),_context5.next=4,this.encryptText(data);case 4:return enc=_context5.sent,_context5.abrupt("return",enc);case 8:throw _context5.prev=8,_context5.t0=_context5.catch(0),new meteor.fj.Error("encryption-error","Encryption error.");case 11:case"end":return _context5.stop()}}),_callee5,this,[[0,8]])}))),function encrypt(_x4){return _encrypt.apply(this,arguments)})},{key:"decrypt",value:(_decrypt=OTRRoom_asyncToGenerator(OTRRoom_regeneratorRuntime().mark((function _callee6(message){var cipherText,data,msgDecoded;return OTRRoom_regeneratorRuntime().wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(_context6.prev=0,this._sessionKey){_context6.next=3;break}throw new Error("Session Key not available.");case 3:return cipherText=ejson_default().parse(message),_context6.next=6,decryptAES(cipherText,this._sessionKey);case 6:if(data=_context6.sent,!(msgDecoded=ejson_default().parse(new TextDecoder("UTF-8").decode(new Uint8Array(data))))||"object"!==OTRRoom_typeof(msgDecoded)){_context6.next=10;break}return _context6.abrupt("return",msgDecoded);case 10:return _context6.abrupt("return",message);case 13:return _context6.prev=13,_context6.t0=_context6.catch(0),(0,toast.b)({type:"error",message:_context6.t0}),this.setState(OtrRoomState.Q.ERROR),_context6.abrupt("return",message);case 18:case"end":return _context6.stop()}}),_callee6,this,[[0,13]])}))),function decrypt(_x5){return _decrypt.apply(this,arguments)})},{key:"onUserStream",value:(_onUserStream=OTRRoom_asyncToGenerator(OTRRoom_regeneratorRuntime().mark((function _callee10(type,data){var timeout,establishConnection,closeOrCancelModal,obj,_obj,_this2=this;return OTRRoom_regeneratorRuntime().wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:_context10.t0=type,_context10.next="handshake"===_context10.t0?3:"acknowledge"===_context10.t0?29:"deny"===_context10.t0?46:"end"===_context10.t0?48:61;break;case 3:return establishConnection=function(){var _ref=OTRRoom_asyncToGenerator(OTRRoom_regeneratorRuntime().mark((function _callee8(){return OTRRoom_regeneratorRuntime().wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:if(_this2.setState(OtrRoomState.Q.ESTABLISHING),clearTimeout(timeout),_context8.prev=2,data.publicKey){_context8.next=5;break}throw new Error("Public key is not generated");case 5:return _context8.next=7,_this2.generateKeyPair();case 7:return _context8.next=9,_this2.importPublicKey(data.publicKey);case 9:return _context8.next=11,(0,goToRoomById.P)(data.roomId);case 11:setTimeout(OTRRoom_asyncToGenerator(OTRRoom_regeneratorRuntime().mark((function _callee7(){return OTRRoom_regeneratorRuntime().wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(_this2.setState(OtrRoomState.Q.ESTABLISHED),_this2.acknowledge(),_this2.listenToUserStatus(),!data.refresh){_context7.next=6;break}return _context7.next=6,SDKClient.sdk.rest.post("/v1/chat.otr",{roomId:_this2._roomId,type:otrSystemMessages.USER_KEY_REFRESHED_SUCCESSFULLY});case 6:case"end":return _context7.stop()}}),_callee7)}))),0),_context8.next=18;break;case 14:throw _context8.prev=14,_context8.t0=_context8.catch(2),(0,toast.b)({type:"error",message:_context8.t0}),new meteor.fj.Error("establish-connection-error","Establish connection error.");case 18:case"end":return _context8.stop()}}),_callee8,null,[[2,14]])})));return function establishConnection(){return _ref.apply(this,arguments)}}(),closeOrCancelModal=function closeOrCancelModal(){clearTimeout(timeout),_this2.deny(),imperativeModal.K.close()},_context10.prev=5,_context10.next=8,presence.C.get(data.userId);case 8:if(null!=(obj=_context10.sent)&&obj.username){_context10.next=11;break}throw new meteor.fj.Error("user-not-defined","User not defined.");case 11:if(!data.refresh||this.getState()!==OtrRoomState.Q.ESTABLISHED){_context10.next=17;break}return this.reset(),_context10.next=15,establishConnection();case 15:_context10.next=23;break;case 17:if(this.getState()!==OtrRoomState.Q.REQUESTED){_context10.next=19;break}return _context10.abrupt("return");case 19:this.getState()===OtrRoomState.Q.ESTABLISHED&&this.reset(),this.setState(OtrRoomState.Q.REQUESTED),imperativeModal.K.open({component:GenericModal.A,props:{variant:"warning",title:(0,i18n.t)("OTR"),children:(0,i18n.t)("Username_wants_to_start_otr_Do_you_want_to_accept",{username:obj.username}),confirmText:(0,i18n.t)("Yes"),cancelText:(0,i18n.t)("No"),onClose:function onClose(){return closeOrCancelModal()},onCancel:function onCancel(){return closeOrCancelModal()},onConfirm:function(){var _onConfirm=OTRRoom_asyncToGenerator(OTRRoom_regeneratorRuntime().mark((function _callee9(){return OTRRoom_regeneratorRuntime().wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.next=2,establishConnection();case 2:imperativeModal.K.close();case 3:case"end":return _context9.stop()}}),_callee9)})));return function onConfirm(){return _onConfirm.apply(this,arguments)}}()}}),timeout=setTimeout((function(){_this2.setState(OtrRoomState.Q.TIMEOUT),imperativeModal.K.close()}),1e4);case 23:_context10.next=28;break;case 25:_context10.prev=25,_context10.t1=_context10.catch(5),(0,toast.b)({type:"error",message:_context10.t1});case 28:return _context10.abrupt("break",61);case 29:if(_context10.prev=29,data.publicKey){_context10.next=32;break}throw new Error("Public key is not generated");case 32:return _context10.next=34,this.importPublicKey(data.publicKey);case 34:if(this.setState(OtrRoomState.Q.ESTABLISHED),!this.isFirstOTR){_context10.next=39;break}return this.listenToUserStatus(),_context10.next=39,SDKClient.sdk.rest.post("/v1/chat.otr",{roomId:this._roomId,type:otrSystemMessages.USER_JOINED_OTR});case 39:this.isFirstOTR=!1,_context10.next=45;break;case 42:_context10.prev=42,_context10.t2=_context10.catch(29),(0,toast.b)({type:"error",message:_context10.t2});case 45:return _context10.abrupt("break",61);case 46:return this.getState()===OtrRoomState.Q.ESTABLISHING&&(this.reset(),this.setState(OtrRoomState.Q.DECLINED)),_context10.abrupt("break",61);case 48:return _context10.prev=48,_context10.next=51,presence.C.get(this.peerId);case 51:if(null!=(_obj=_context10.sent)&&_obj.username){_context10.next=54;break}throw new meteor.fj.Error("user-not-defined","User not defined.");case 54:this.getState()===OtrRoomState.Q.ESTABLISHED&&(this.reset(),this.setState(OtrRoomState.Q.NOT_STARTED),imperativeModal.K.open({component:GenericModal.A,props:{variant:"warning",title:(0,i18n.t)("OTR"),children:(0,i18n.t)("Username_ended_the_OTR_session",{username:_obj.username}),confirmText:(0,i18n.t)("Ok"),onClose:imperativeModal.K.close,onConfirm:imperativeModal.K.close}})),_context10.next=60;break;case 57:_context10.prev=57,_context10.t3=_context10.catch(48),(0,toast.b)({type:"error",message:_context10.t3});case 60:return _context10.abrupt("break",61);case 61:case"end":return _context10.stop()}}),_callee10,this,[[5,25],[29,42],[48,57]])}))),function onUserStream(_x6,_x7){return _onUserStream.apply(this,arguments)})}],[{key:"create",value:function create(uid,rid){var peerId=function getUidDirectMessage(rid){var uid=arguments.length>1&&void 0!==arguments[1]?arguments[1]:meteor.fj.userId(),room=client.ChatRoom.findOne({_id:rid},{fields:{t:1,uids:1}});if(room&&"d"===room.t&&room.uids&&!(room.uids.length>2))return room.uids.filter((function(_uid){return _uid!==uid}))[0]}(rid);if(peerId)return new OTRRoom(uid,rid,peerId)}}]),OTRRoom}();function OTR_typeof(o){return OTR_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},OTR_typeof(o)}function OTR_defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,OTR_toPropertyKey(o.key),o)}}function OTR_toPropertyKey(t){var i=function OTR_toPrimitive(t,r){if("object"!=OTR_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=OTR_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==OTR_typeof(i)?i:i+""}var client_OTR=new(function(){function OTR(){!function OTR_classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}(this,OTR),function OTR_defineProperty(e,r,t){return(r=OTR_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}(this,"instancesByRoomId",void 0),this.instancesByRoomId={}}return function OTR_createClass(e,r,t){return r&&OTR_defineProperties(e.prototype,r),t&&OTR_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(OTR,[{key:"getInstanceByRoomId",value:function getInstanceByRoomId(uid,rid){if(this.instancesByRoomId[rid])return this.instancesByRoomId[rid];var otrRoom=OTRRoom.create(uid,rid);return otrRoom?(this.instancesByRoomId[rid]=otrRoom,this.instancesByRoomId[rid]):void 0}},{key:"closeAllInstances",value:function closeAllInstances(){Object.values(this.instancesByRoomId).forEach((function(instance){instance.softReset()})),this.instancesByRoomId={}}}]),OTR}()),RoomContext=__webpack_require__("./client/views/room/contexts/RoomContext.ts"),useReactiveValue=__webpack_require__("./client/hooks/useReactiveValue.ts"),useOTR=function useOTR(){var uid=(0,dist.useUserId)(),room=(0,RoomContext.nq)(),otr=(0,react.useMemo)((function(){if(uid&&room)return client_OTR.getInstanceByRoomId(uid,room._id)}),[uid,room]),otrState=(0,useReactiveValue.S)((0,react.useCallback)((function(){return otr?otr.getState():OtrRoomState.Q.ERROR}),[otr]));return{otr:otr,otrState:otrState}}},"./client/ui.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Kb:function(){return quickActionHooks},I7:function(){return roomActionHooks},Xy:function(){return roomActionHooksForE2EESetup}});var react=__webpack_require__("./node_modules/react/index.js"),quickActions=__webpack_require__("./client/views/room/lib/quickActions.tsx"),useHasLicenseModule=__webpack_require__("./client/hooks/useHasLicenseModule.ts"),dist=__webpack_require__("../../packages/ui-contexts/dist/index.js"),AutoTranslate=(0,react.lazy)((function(){return __webpack_require__.e(1041).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/AutoTranslate/index.ts"))})),core_typings_dist=__webpack_require__("../../packages/core-typings/dist/index.js"),es=__webpack_require__("./node_modules/react-i18next/dist/es/index.js"),RoomContext=__webpack_require__("./client/views/room/contexts/RoomContext.ts");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var VideoConfList=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(8038),__webpack_require__.e(1113)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/VideoConference/VideoConfList/index.ts"))})),CannedResponse=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(8038),__webpack_require__.e(8463),__webpack_require__.e(1417),__webpack_require__.e(9605),__webpack_require__.e(9362),__webpack_require__.e(9312)]).then(__webpack_require__.bind(__webpack_require__,"./client/omnichannel/cannedResponses/contextualBar/CannedResponse/WrapCannedResponseList.tsx"))})),Info=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(1697),__webpack_require__.e(972),__webpack_require__.e(4407),__webpack_require__.e(2094),__webpack_require__.e(2158),__webpack_require__.e(5163)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/Info/index.ts"))})),useChannelSettingsRoomAction=function useChannelSettingsRoomAction(){return(0,react.useMemo)((function(){return{id:"channel-settings",groups:["channel","group"],anonymous:!0,full:!0,title:"Room_Info",icon:"info-circled",tabComponent:Info,order:1}}),[])};function useCleanHistoryRoomAction_typeof(o){return useCleanHistoryRoomAction_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useCleanHistoryRoomAction_typeof(o)}function useCleanHistoryRoomAction_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function useCleanHistoryRoomAction_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?useCleanHistoryRoomAction_ownKeys(Object(t),!0).forEach((function(r){useCleanHistoryRoomAction_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):useCleanHistoryRoomAction_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function useCleanHistoryRoomAction_defineProperty(e,r,t){return(r=function useCleanHistoryRoomAction_toPropertyKey(t){var i=function useCleanHistoryRoomAction_toPrimitive(t,r){if("object"!=useCleanHistoryRoomAction_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=useCleanHistoryRoomAction_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==useCleanHistoryRoomAction_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var PruneMessages=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(7394),__webpack_require__.e(9382)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/PruneMessages/index.ts"))})),ContactHistory=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(3528),__webpack_require__.e(8038),__webpack_require__.e(4609),__webpack_require__.e(5159),__webpack_require__.e(8455),__webpack_require__.e(227)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/omnichannel/contactHistory/ContactHistory.tsx"))})),ContactsContextualBar=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(3832),__webpack_require__.e(8038),__webpack_require__.e(8463),__webpack_require__.e(1417),__webpack_require__.e(5289),__webpack_require__.e(9893),__webpack_require__.e(7643)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/omnichannel/directory/contacts/contextualBar/ContactsContextualBar.tsx"))}));function useDiscussionsRoomAction_typeof(o){return useDiscussionsRoomAction_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useDiscussionsRoomAction_typeof(o)}function useDiscussionsRoomAction_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function useDiscussionsRoomAction_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?useDiscussionsRoomAction_ownKeys(Object(t),!0).forEach((function(r){useDiscussionsRoomAction_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):useDiscussionsRoomAction_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function useDiscussionsRoomAction_defineProperty(e,r,t){return(r=function useDiscussionsRoomAction_toPropertyKey(t){var i=function useDiscussionsRoomAction_toPrimitive(t,r){if("object"!=useDiscussionsRoomAction_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=useDiscussionsRoomAction_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==useDiscussionsRoomAction_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var Discussions=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(8038),__webpack_require__.e(4609),__webpack_require__.e(8474),__webpack_require__.e(5131)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/Discussions/index.ts"))})),index_module=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),E2EEState=__webpack_require__("./app/e2e/client/E2EEState.ts"),OtrRoomState=__webpack_require__("./app/otr/lib/OtrRoomState.ts"),toast=__webpack_require__("./client/lib/toast.ts"),useE2EEState=__webpack_require__("./client/views/room/hooks/useE2EEState.ts"),useOTR=__webpack_require__("./client/hooks/useOTR.ts");function useE2EERoomAction_typeof(o){return useE2EERoomAction_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useE2EERoomAction_typeof(o)}function useE2EERoomAction_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function useE2EERoomAction_defineProperty(e,r,t){return(r=function useE2EERoomAction_toPropertyKey(t){var i=function useE2EERoomAction_toPrimitive(t,r){if("object"!=useE2EERoomAction_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=useE2EERoomAction_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==useE2EERoomAction_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==useE2EERoomAction_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(useE2EERoomAction_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var useE2EERoomAction=function useE2EERoomAction(){var enabled=(0,dist.useSetting)("E2E_Enable",!1),room=(0,RoomContext.nq)(),subscription=(0,RoomContext.Mq)(),e2eeState=(0,useE2EEState.W)(),readyToEncrypt=e2eeState===E2EEState.l.READY||e2eeState===E2EEState.l.SAVE_PASSWORD||room.encrypted,permittedToToggleEncryption=(0,dist.usePermission)("toggle-room-e2e-encryption",room._id),permittedToEditRoom=(0,dist.usePermission)("edit-room",room._id),permitted=("d"===room.t||permittedToEditRoom&&permittedToToggleEncryption)&&readyToEncrypt,federated=(0,core_typings_dist.isRoomFederated)(room),t=(0,es.Bd)().t,otrState=(0,useOTR.N)().otrState,toggleE2E=(0,dist.useEndpoint)("POST","/v1/rooms.saveRoomSettings"),action=(0,index_module.useEffectEvent)(_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var _yield$toggleE2E;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(otrState!==OtrRoomState.Q.ESTABLISHED&&otrState!==OtrRoomState.Q.ESTABLISHING&&otrState!==OtrRoomState.Q.REQUESTED){_context.next=3;break}return(0,toast.b)({type:"error",message:t("E2EE_not_available_OTR")}),_context.abrupt("return");case 3:return _context.next=5,toggleE2E({rid:room._id,encrypted:!room.encrypted});case 5:if(_yield$toggleE2E=_context.sent,_yield$toggleE2E.success){_context.next=9;break}return _context.abrupt("return");case 9:(0,toast.b)({type:"success",message:room.encrypted?t("E2E_Encryption_disabled_for_room",{roomName:room.name}):t("E2E_Encryption_enabled_for_room",{roomName:room.name})}),null!=subscription&&subscription.autoTranslate&&(0,toast.b)({type:"success",message:t("AutoTranslate_Disabled_for_room",{roomName:room.name})});case 11:case"end":return _context.stop()}}),_callee)})))),enabledOnRoom=!!room.encrypted;return(0,react.useMemo)((function(){if(enabled&&permitted)return function useE2EERoomAction_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?useE2EERoomAction_ownKeys(Object(t),!0).forEach((function(r){useE2EERoomAction_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):useE2EERoomAction_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({id:"e2e",groups:["direct","direct_multiple","group","team"],title:enabledOnRoom?"E2E_disable":"E2E_enable",icon:"key",order:13,action:action,type:"organization"},federated&&{tooltip:t("core.E2E_unavailable_for_federation"),disabled:!0})}),[enabled,permitted,federated,t,enabledOnRoom,action])},ExportMessages=(0,react.lazy)((function(){return __webpack_require__.e(6585).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/ExportMessages/index.ts"))})),useExternalComponentsQuery=__webpack_require__("./client/apps/gameCenter/hooks/useExternalComponentsQuery.ts"),GameCenter=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(7746),__webpack_require__.e(8209)]).then(__webpack_require__.bind(__webpack_require__,"./client/apps/gameCenter/GameCenter.tsx"))})),KeyboardShortcuts=(0,react.lazy)((function(){return __webpack_require__.e(5543).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/KeyboardShortcuts/index.ts"))})),MemberListRouter=(__webpack_require__("./client/views/room/RoomSkeleton.tsx"),(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(3832),__webpack_require__.e(7746),__webpack_require__.e(2498),__webpack_require__.e(5062),__webpack_require__.e(7390),__webpack_require__.e(4481)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/MemberListRouter.js"))}))),useMembersListRoomAction=function useMembersListRoomAction(){var room=(0,RoomContext.nq)(),broadcast=!!room.broadcast,team=!!room.teamMain,permittedToViewBroadcastMemberList=(0,dist.usePermission)("view-broadcast-member-list",room._id);return(0,react.useMemo)((function(){if(!broadcast||permittedToViewBroadcastMemberList)return{id:"members-list",groups:["channel","group","team"],title:team?"Teams_members":"Members",icon:"members",tabComponent:MemberListRouter,order:7}}),[broadcast,permittedToViewBroadcastMemberList,team])},MentionsTab=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(3832),__webpack_require__.e(3528),__webpack_require__.e(4609),__webpack_require__.e(5159),__webpack_require__.e(8455),__webpack_require__.e(5146),__webpack_require__.e(8411),__webpack_require__.e(7269)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/MentionsTab.tsx"))}));function useOTRRoomAction_typeof(o){return useOTRRoomAction_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useOTRRoomAction_typeof(o)}function useOTRRoomAction_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function useOTRRoomAction_defineProperty(e,r,t){return(r=function useOTRRoomAction_toPropertyKey(t){var i=function useOTRRoomAction_toPrimitive(t,r){if("object"!=useOTRRoomAction_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=useOTRRoomAction_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==useOTRRoomAction_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var OTR=(0,react.lazy)((function(){return __webpack_require__.e(7144).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/OTR/index.ts"))})),ExternalFrameContainer=(0,react.lazy)((function(){return __webpack_require__.e(6830).then(__webpack_require__.bind(__webpack_require__,"./client/views/omnichannel/ExternalFrameContainer.tsx"))})),OutlookEventsRoute=(0,react.lazy)((function(){return __webpack_require__.e(7222).then(__webpack_require__.bind(__webpack_require__,"./client/views/outlookCalendar/OutlookEventsRoute.tsx"))}));function usePinnedMessagesRoomAction_typeof(o){return usePinnedMessagesRoomAction_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},usePinnedMessagesRoomAction_typeof(o)}function usePinnedMessagesRoomAction_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function usePinnedMessagesRoomAction_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?usePinnedMessagesRoomAction_ownKeys(Object(t),!0).forEach((function(r){usePinnedMessagesRoomAction_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):usePinnedMessagesRoomAction_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function usePinnedMessagesRoomAction_defineProperty(e,r,t){return(r=function usePinnedMessagesRoomAction_toPropertyKey(t){var i=function usePinnedMessagesRoomAction_toPrimitive(t,r){if("object"!=usePinnedMessagesRoomAction_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=usePinnedMessagesRoomAction_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==usePinnedMessagesRoomAction_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var PinnedMessagesTab=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(3832),__webpack_require__.e(3528),__webpack_require__.e(4609),__webpack_require__.e(5159),__webpack_require__.e(8455),__webpack_require__.e(5146),__webpack_require__.e(8411),__webpack_require__.e(2926)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/PinnedMessagesTab.tsx"))})),NotificationPreferences=(0,react.lazy)((function(){return __webpack_require__.e(3110).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/NotificationPreferences/index.ts"))})),MessageSearchTab=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(3832),__webpack_require__.e(3528),__webpack_require__.e(4609),__webpack_require__.e(5159),__webpack_require__.e(8455),__webpack_require__.e(5146),__webpack_require__.e(8411),__webpack_require__.e(7707)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/MessageSearchTab/index.ts"))})),ChatsContextualBar=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(3832),__webpack_require__.e(6453),__webpack_require__.e(8038),__webpack_require__.e(8463),__webpack_require__.e(1417),__webpack_require__.e(5289),__webpack_require__.e(9893),__webpack_require__.e(1366)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/omnichannel/directory/chats/contextualBar/ChatsContextualBar.tsx"))})),StarredMessagesTab=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(3832),__webpack_require__.e(3528),__webpack_require__.e(4609),__webpack_require__.e(5159),__webpack_require__.e(8455),__webpack_require__.e(5146),__webpack_require__.e(8411),__webpack_require__.e(2291)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/StarredMessagesTab.tsx"))})),ui_client_dist=__webpack_require__("../../packages/ui-client/dist/index.js"),HeaderToolbarAction=__webpack_require__("./client/components/Header/HeaderToolbarAction.tsx"),fuselage=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),VideoConfContext=__webpack_require__("./client/contexts/VideoConfContext.ts"),VideoConfManager=__webpack_require__("./client/lib/VideoConfManager.ts"),useVideoConfWarning=__webpack_require__("./client/views/room/contextualBar/VideoConference/hooks/useVideoConfWarning.tsx");function useVideoConfMenuOptions_typeof(o){return useVideoConfMenuOptions_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useVideoConfMenuOptions_typeof(o)}function useVideoConfMenuOptions_regeneratorRuntime(){useVideoConfMenuOptions_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==useVideoConfMenuOptions_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(useVideoConfMenuOptions_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function useVideoConfMenuOptions_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function useVideoConfMenuOptions_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){useVideoConfMenuOptions_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){useVideoConfMenuOptions_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var useStartCallRoomAction_useVideoConfMenuOptions=function useVideoConfMenuOptions(){var _ref,_room$uids,_room$muted,t=(0,es.Bd)().t,room=(0,RoomContext.nq)(),user=(0,dist.useUser)(),federated=(0,core_typings_dist.isRoomFederated)(room),ownUser=null!==(_ref=1===(null===(_room$uids=room.uids)||void 0===_room$uids?void 0:_room$uids.length))&&void 0!==_ref&&_ref,permittedToPostReadonly=(0,dist.usePermission)("post-readonly",room._id),permittedToCallManagement=(0,dist.usePermission)("call-management",room._id),dispatchWarning=(0,useVideoConfWarning.h)(),dispatchPopup=(0,VideoConfContext.j7)(),isCalling=(0,VideoConfContext.pJ)(),isRinging=(0,VideoConfContext.bd)(),enabledForDMs=(0,dist.useSetting)("VideoConf_Enable_DMs",!0),enabledForChannels=(0,dist.useSetting)("VideoConf_Enable_Channels",!0),enabledForTeams=(0,dist.useSetting)("VideoConf_Enable_Teams",!0),enabledForGroups=(0,dist.useSetting)("VideoConf_Enable_Groups",!0),enabledForLiveChat="default-provider"===(0,dist.useSetting)("Omnichannel_call_provider","default-provider"),groups=(0,index_module.useStableArray)([enabledForDMs&&"direct",enabledForDMs&&"direct_multiple",enabledForGroups&&"group",enabledForLiveChat&&"live",enabledForTeams&&"team",enabledForChannels&&"channel"].filter((function(group){return!!group}))),allowed=groups.length>0&&permittedToCallManagement&&(!(null!=user&&user.username)||!(null!==(_room$muted=room.muted)&&void 0!==_room$muted&&_room$muted.includes(user.username)))&&!ownUser,disabled=federated||!!room.ro&&!permittedToPostReadonly,tooltip=disabled?t("core.Video_Call_unavailable_for_this_type_of_room"):"",order=(0,core_typings_dist.isOmnichannelRoom)(room)?-1:4,handleOpenVideoConf=(0,index_module.useEffectEvent)(useVideoConfMenuOptions_asyncToGenerator(useVideoConfMenuOptions_regeneratorRuntime().mark((function _callee(){return useVideoConfMenuOptions_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!isCalling&&!isRinging){_context.next=2;break}return _context.abrupt("return");case 2:return _context.prev=2,_context.next=5,VideoConfManager.X.loadCapabilities();case 5:dispatchPopup({rid:room._id}),_context.next=11;break;case 8:_context.prev=8,_context.t0=_context.catch(2),dispatchWarning(_context.t0.error);case 11:case"end":return _context.stop()}}),_callee,null,[[2,8]])}))));return(0,react.useMemo)((function(){return{items:[{id:"start-video-call",icon:"video",disabled:disabled,onClick:handleOpenVideoConf,content:react.createElement(fuselage.Box,{is:"span",title:tooltip},t("Video_call"))}],disabled:disabled,allowed:allowed,order:order,groups:groups}}),[allowed,disabled,groups,handleOpenVideoConf,order,t,tooltip])},ui_voip_dist=__webpack_require__("../../packages/ui-voip/dist/index.js"),useMediaPermissions=__webpack_require__("./client/views/room/composer/messageBox/hooks/useMediaPermissions.ts"),useUserInfoQuery=__webpack_require__("./client/hooks/useUserInfoQuery.ts");function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var useStartCallRoomAction_useVoipMenuOptions=function useVoipMenuOptions(){var t=(0,es.Bd)().t,_useRoom$uids=(0,RoomContext.nq)().uids,uids=void 0===_useRoom$uids?[]:_useRoom$uids,ownUserId=(0,dist.useUserId)(),isMicPermissionDenied=_slicedToArray((0,useMediaPermissions.u)("microphone"),1)[0],_useVoipState=(0,ui_voip_dist.Xg)(),isEnabled=_useVoipState.isEnabled,isRegistered=_useVoipState.isRegistered,isInCall=_useVoipState.isInCall,makeCall=(0,ui_voip_dist.qR)().makeCall,members=(0,react.useMemo)((function(){return uids.filter((function(uid){return uid!==ownUserId}))}),[uids,ownUserId]),remoteUserId=members[0],_useUserInfoQuery=(0,useUserInfoQuery.H)({userId:remoteUserId},{enabled:Boolean(remoteUserId)}),_useUserInfoQuery$dat=_useUserInfoQuery.data,remoteUser=(void 0===_useUserInfoQuery$dat?{}:_useUserInfoQuery$dat).user,isLoading=_useUserInfoQuery.isLoading,isRemoteRegistered=!(null==remoteUser||!remoteUser.freeSwitchExtension),isDM=1===members.length,disabled=isMicPermissionDenied||!isDM||!isRemoteRegistered||!isRegistered||isInCall||isLoading,title=(0,react.useMemo)((function(){return isMicPermissionDenied?t("Microphone_access_not_allowed"):isInCall?t("Unable_to_make_calls_while_another_is_ongoing"):disabled?t("Voice_calling_disabled"):""}),[disabled,isInCall,isMicPermissionDenied,t]);return(0,react.useMemo)((function(){var items=[{id:"start-voip-call",icon:"phone",disabled:disabled,onClick:function onClick(){return makeCall(null==remoteUser?void 0:remoteUser.freeSwitchExtension)},content:react.createElement(fuselage.Box,{is:"span",title:title},t("Voice_call"))}];return{items:isEnabled?items:[],groups:["direct"],disabled:disabled,allowed:isEnabled,order:4}}),[disabled,title,t,isEnabled,makeCall,null==remoteUser?void 0:remoteUser.freeSwitchExtension])};function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return useStartCallRoomAction_arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||function useStartCallRoomAction_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return useStartCallRoomAction_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?useStartCallRoomAction_arrayLikeToArray(r,a):void 0}}(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function useStartCallRoomAction_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var TeamsChannels=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(8038),__webpack_require__.e(7746),__webpack_require__.e(4407),__webpack_require__.e(8425),__webpack_require__.e(32)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/teams/contextualBar/channels/index.ts"))})),TeamsInfoWithRooms=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(1697),__webpack_require__.e(972),__webpack_require__.e(4407),__webpack_require__.e(9764),__webpack_require__.e(2158),__webpack_require__.e(3495)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/teams/contextualBar/info/TeamsInfoWithRooms.tsx"))})),Header=__webpack_require__("./client/components/Header/index.ts"),Threads=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(3832),__webpack_require__.e(3528),__webpack_require__.e(8038),__webpack_require__.e(4609),__webpack_require__.e(5159),__webpack_require__.e(1515),__webpack_require__.e(8455),__webpack_require__.e(5146),__webpack_require__.e(6395),__webpack_require__.e(4707),__webpack_require__.e(8474),__webpack_require__.e(5352)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/Threads/index.ts"))})),RoomFiles=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(8038),__webpack_require__.e(3510),__webpack_require__.e(8474),__webpack_require__.e(7554)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/room/contextualBar/RoomFiles/index.ts"))})),CallsContextualBarRoom=(0,react.lazy)((function(){return Promise.all([__webpack_require__.e(3832),__webpack_require__.e(5289),__webpack_require__.e(4325)]).then(__webpack_require__.bind(__webpack_require__,"./client/views/omnichannel/directory/calls/contextualBar/CallsContextualBarRoom.tsx"))})),SDKClient=__webpack_require__("./app/utils/client/lib/SDKClient.ts");function useWebRTCVideoRoomAction_typeof(o){return useWebRTCVideoRoomAction_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useWebRTCVideoRoomAction_typeof(o)}function useWebRTCVideoRoomAction_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function useWebRTCVideoRoomAction_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?useWebRTCVideoRoomAction_ownKeys(Object(t),!0).forEach((function(r){useWebRTCVideoRoomAction_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):useWebRTCVideoRoomAction_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function useWebRTCVideoRoomAction_defineProperty(e,r,t){return(r=function useWebRTCVideoRoomAction_toPropertyKey(t){var i=function useWebRTCVideoRoomAction_toPrimitive(t,r){if("object"!=useWebRTCVideoRoomAction_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=useWebRTCVideoRoomAction_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==useWebRTCVideoRoomAction_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function useWebRTCVideoRoomAction_regeneratorRuntime(){useWebRTCVideoRoomAction_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==useWebRTCVideoRoomAction_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(useWebRTCVideoRoomAction_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function useWebRTCVideoRoomAction_asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}function useWebRTCVideoRoomAction_asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){useWebRTCVideoRoomAction_asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){useWebRTCVideoRoomAction_asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}var roomActionHooks=[useChannelSettingsRoomAction,function useTeamInfoRoomAction(){return(0,react.useMemo)((function(){return{id:"team-info",groups:["team"],anonymous:!0,full:!0,title:"Teams_Info",icon:"info-circled",tabComponent:TeamsInfoWithRooms,order:1}}),[])},function useUserInfoGroupRoomAction(){return(0,react.useMemo)((function(){return{id:"user-info-group",groups:["direct_multiple"],title:"Members",icon:"members",tabComponent:MemberListRouter,order:1}}),[])},function useUserInfoRoomAction(){return(0,react.useMemo)((function(){return{id:"user-info",groups:["direct"],title:"User_Info",icon:"user",tabComponent:MemberListRouter,order:1}}),[])},function useThreadRoomAction(){var _subscription$tunread,_subscription$tunread2,_subscription$tunread3,_subscription$tunread4,_subscription$tunread5,_subscription$tunread6,enabled=(0,dist.useSetting)("Threads_enabled",!1),subscription=(0,RoomContext.Mq)(),tunread=null!==(_subscription$tunread=null==subscription||null===(_subscription$tunread2=subscription.tunread)||void 0===_subscription$tunread2?void 0:_subscription$tunread2.length)&&void 0!==_subscription$tunread?_subscription$tunread:0,tunreadUser=null!==(_subscription$tunread3=null==subscription||null===(_subscription$tunread4=subscription.tunreadUser)||void 0===_subscription$tunread4?void 0:_subscription$tunread4.length)&&void 0!==_subscription$tunread3?_subscription$tunread3:0,tunreadGroup=null!==(_subscription$tunread5=null==subscription||null===(_subscription$tunread6=subscription.tunreadGroup)||void 0===_subscription$tunread6?void 0:_subscription$tunread6.length)&&void 0!==_subscription$tunread5?_subscription$tunread5:0,unread=tunread>99?"99+":tunread,variant=function getVariant(tunreadUser,tunreadGroup){return tunreadUser>0?"danger":tunreadGroup>0?"warning":"primary"}(tunreadUser,tunreadGroup),t=(0,es.Bd)().t;return(0,react.useMemo)((function(){if(enabled)return{id:"thread",groups:["channel","group","direct","direct_multiple","team"],full:!0,title:"Threads",icon:"thread",tabComponent:Threads,order:2,renderToolboxItem:function renderToolboxItem(_ref){var id=_ref.id,className=_ref.className,index=_ref.index,icon=_ref.icon,title=_ref.title,tab=_ref.toolbox.tab,action=_ref.action,disabled=_ref.disabled,tooltip=_ref.tooltip;return react.createElement(Header.jJ,{key:id,className:className,index:index,id:id,icon:icon,title:t(title),pressed:id===(null==tab?void 0:tab.id),action:action,disabled:disabled,tooltip:tooltip},!!unread&&react.createElement(Header.M9,{variant:variant},unread))}}}),[enabled,t,unread,variant])},function useAutotranslateRoomAction(){var permitted=(0,dist.usePermission)("auto-translate"),enabled=(0,dist.useSetting)("AutoTranslate_Enabled",!1);return(0,react.useMemo)((function(){if(permitted&&enabled)return{id:"autotranslate",groups:["channel","group","direct","direct_multiple","team"],title:"Auto_Translate",icon:"language",tabComponent:AutoTranslate,order:20,full:!0,type:"customization"}}),[enabled,permitted])},function useCallsRoomAction(){var _useContext,licensed=!0===(0,useHasLicenseModule.b)("videoconference-enterprise"),room=null===(_useContext=(0,react.useContext)(RoomContext.p))||void 0===_useContext?void 0:_useContext.room,federated=!!room&&(0,core_typings_dist.isRoomFederated)(room),t=(0,es.Bd)().t;return(0,react.useMemo)((function(){if(licensed)return _objectSpread(_objectSpread({id:"calls",groups:["channel","group","team","direct","direct_multiple"],icon:"phone",title:"Calls"},federated&&{tooltip:t("core.Video_Call_unavailable_for_this_type_of_room"),disabled:!0}),{},{tabComponent:VideoConfList,order:999})}),[licensed,federated,t])},function useCannedResponsesRoomAction(){var licensed=!0===(0,useHasLicenseModule.b)("canned-responses"),enabled=(0,dist.useSetting)("Canned_Responses_Enable",!1);return(0,react.useMemo)((function(){if(licensed&&enabled)return{id:"canned-responses",groups:["live"],title:"Canned_Responses",icon:"canned-response",tabComponent:CannedResponse,order:0}}),[enabled,licensed])},function useCleanHistoryRoomAction(){var room=(0,RoomContext.nq)(),federated=(0,core_typings_dist.isRoomFederated)(room),permitted=(0,dist.usePermission)("clean-channel-history",room._id),t=(0,es.Bd)().t;return(0,react.useMemo)((function(){if(permitted)return useCleanHistoryRoomAction_objectSpread(useCleanHistoryRoomAction_objectSpread({id:"clean-history",groups:["channel","group","team","direct_multiple","direct"],full:!0,title:"Prune_Messages",icon:"eraser"},federated&&{tooltip:t("core.Clean_History_unavailable_for_federation"),disabled:!0}),{},{tabComponent:PruneMessages,order:250,type:"customization"})}),[federated,permitted,t])},function useContactChatHistoryRoomAction(){return(0,react.useMemo)((function(){return{id:"contact-chat-history",groups:["live"],title:"Contact_Chat_History",icon:"clock",tabComponent:ContactHistory,order:11}}),[])},function useContactProfileRoomAction(){return(0,react.useMemo)((function(){return{id:"contact-profile",groups:["live"],title:"Contact_Info",icon:"user",tabComponent:ContactsContextualBar,order:1}}),[])},function useDiscussionsRoomAction(){var room=(0,RoomContext.nq)(),federated=(0,core_typings_dist.isRoomFederated)(room),enabled=(0,dist.useSetting)("Discussion_enabled",!1),t=(0,es.Bd)().t;return(0,react.useMemo)((function(){if(enabled&&!room.prid)return useDiscussionsRoomAction_objectSpread(useDiscussionsRoomAction_objectSpread({id:"discussions",groups:["channel","group","direct","direct_multiple","team"],title:"Discussions",icon:"discussion",tabComponent:Discussions,full:!0},federated&&{disabled:!0,tooltip:t("core.Discussions_unavailable_for_federation")}),{},{order:3})}),[enabled,federated,room.prid,t])},useE2EERoomAction,function useExportMessagesRoomAction(){var room=(0,RoomContext.nq)(),permitted=(0,dist.usePermission)("mail-messages",room._id);return(0,react.useMemo)((function(){if(permitted)return{id:"export-messages",groups:["channel","group","direct","direct_multiple","team"],anonymous:!0,title:"Export_Messages",icon:"mail",tabComponent:ExportMessages,full:!0,order:12,type:"communication"}}),[permitted])},function useGameCenterRoomAction(){var result=(0,useExternalComponentsQuery.X)(),enabled=result.isSuccess&&result.data.length>0;return(0,react.useMemo)((function(){if(enabled)return{id:"game-center",groups:["channel","group","direct","direct_multiple","team"],title:"Apps_Game_Center",icon:"game",tabComponent:GameCenter,order:-1}}),[enabled])},function useKeyboardShortcutListRoomAction(){return(0,react.useMemo)((function(){return{id:"keyboard-shortcut-list",groups:["channel","group","direct","direct_multiple","team"],title:"Keyboard_Shortcuts_Title",icon:"keyboard",tabComponent:KeyboardShortcuts,order:99,type:"customization"}}),[])},useMembersListRoomAction,function useMentionsRoomAction(){return(0,react.useMemo)((function(){return{id:"mentions",groups:["channel","group","team"],title:"Mentions",icon:"at",tabComponent:MentionsTab,order:6,type:"organization"}}),[])},function useOTRRoomAction(){var enabled=(0,dist.useSetting)("OTR_Enable",!1),room=(0,RoomContext.nq)(),federated=(0,core_typings_dist.isRoomFederated)(room),capable=!!__webpack_require__.g.crypto,t=(0,es.Bd)().t;return(0,react.useMemo)((function(){if(enabled&&capable)return function useOTRRoomAction_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?useOTRRoomAction_ownKeys(Object(t),!0).forEach((function(r){useOTRRoomAction_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):useOTRRoomAction_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({id:"otr",groups:["direct"],title:"OTR",icon:"stopwatch",tabComponent:OTR,order:13,full:!0,type:"communication"},federated&&{tooltip:t("core.OTR_unavailable_for_federation"),disabled:!0})}),[enabled,capable,federated,t])},function useOmnichannelExternalFrameRoomAction(){var enabled=(0,dist.useSetting)("Omnichannel_External_Frame_Enabled",!1);return(0,react.useMemo)((function(){if(enabled)return{id:"omnichannel-external-frame",groups:["live"],title:"Omnichannel_External_Frame",icon:"cube",tabComponent:ExternalFrameContainer,order:-1}}),[enabled])},function useOutlookCalenderRoomAction(){var enabled=(0,dist.useSetting)("Outlook_Calendar_Enabled",!1);return(0,react.useMemo)((function(){if(enabled)return{id:"outlookCalendar",groups:["channel","group","team"],icon:"calendar",title:"Outlook_calendar",tabComponent:OutlookEventsRoute,order:999}}),[enabled])},function usePinnedMessagesRoomAction(){var room=(0,RoomContext.nq)(),federated=(0,core_typings_dist.isRoomFederated)(room),enabled=(0,dist.useSetting)("Message_AllowPinning",!1),t=(0,es.Bd)().t;return(0,react.useMemo)((function(){if(enabled)return usePinnedMessagesRoomAction_objectSpread(usePinnedMessagesRoomAction_objectSpread({id:"pinned-messages",groups:["channel","group","direct","direct_multiple","team"],title:"Pinned_Messages",icon:"pin",tabComponent:PinnedMessagesTab},federated&&{tooltip:t("core.Pinned_messages_unavailable_for_federation"),disabled:!0}),{},{order:9,type:"organization"})}),[enabled,federated,t])},function usePushNotificationsRoomAction(){var capable=!!(0,RoomContext.Mq)();return(0,react.useMemo)((function(){if(capable)return{id:"push-notifications",groups:["channel","group","direct","direct_multiple","team"],title:"Notifications_Preferences",icon:"bell",tabComponent:NotificationPreferences,order:11,type:"customization"}}),[capable])},function useRocketSearchRoomAction(){return(0,react.useMemo)((function(){return{id:"rocket-search",groups:["channel","group","direct","direct_multiple","live","team"],title:"Search_Messages",icon:"magnifier",tabComponent:MessageSearchTab,order:5}}),[])},function useRoomInfoRoomAction(){return(0,react.useMemo)((function(){return{id:"room-info",groups:["live"],title:"Room_Info",icon:"info-circled",tabComponent:ChatsContextualBar,order:0}}),[])},function useStarredMessagesRoomAction(){return(0,react.useMemo)((function(){return{id:"starred-messages",groups:["channel","group","direct","direct_multiple","team"],title:"Starred_Messages",icon:"star",tabComponent:StarredMessagesTab,order:10,type:"organization"}}),[])},function useStartCallRoomAction(){var voipCall=useStartCallRoomAction_useVideoConfMenuOptions(),videoCall=useStartCallRoomAction_useVoipMenuOptions();return(0,react.useMemo)((function(){if(videoCall.allowed||voipCall.allowed)return{id:"start-call",title:"Call",icon:"phone",groups:[].concat(_toConsumableArray(videoCall.groups),_toConsumableArray(voipCall.groups)),disabled:videoCall.disabled&&voipCall.disabled,full:!0,order:Math.max(voipCall.order,videoCall.order),featured:!0,renderToolboxItem:function renderToolboxItem(_ref){var id=_ref.id,icon=_ref.icon,title=_ref.title,disabled=_ref.disabled,className=_ref.className;return react.createElement(ui_client_dist.h4,{button:react.createElement(HeaderToolbarAction.A,null),key:id,title:title,disabled:disabled,items:[].concat(_toConsumableArray(voipCall.items),_toConsumableArray(videoCall.items)),className:className,placement:"bottom-start",icon:icon})}}}),[videoCall,voipCall])},function useTeamChannelsRoomAction(){return(0,react.useMemo)((function(){return{id:"team-channels",groups:["team"],anonymous:!0,full:!0,title:"Team_Channels",icon:"hash",tabComponent:TeamsChannels,order:2}}),[])},function useUploadedFilesListRoomAction(){return(0,react.useMemo)((function(){return{id:"uploaded-files-list",groups:["channel","group","direct","direct_multiple","live","team"],title:"Files",icon:"clip",tabComponent:RoomFiles,order:8,type:"organization"}}),[])},function useVoIPRoomInfoRoomAction(){return(0,react.useMemo)((function(){return{id:"voip-room-info",groups:["voip"],title:"Call_Information",icon:"info-circled",tabComponent:CallsContextualBarRoom,order:0}}),[])},function useWebRTCVideoRoomAction(){var enabled=(0,dist.useSetting)("WebRTC_Enabled",!1),room=(0,RoomContext.nq)(),federated=(0,core_typings_dist.isRoomFederated)(room),callProvider=(0,dist.useSetting)("Omnichannel_call_provider","default-provider"),allowed=enabled&&"WebRTC"===callProvider&&room.servedBy,t=(0,es.Bd)().t,handleClick=(0,react.useCallback)(useWebRTCVideoRoomAction_asyncToGenerator(useWebRTCVideoRoomAction_regeneratorRuntime().mark((function _callee(){return useWebRTCVideoRoomAction_regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(room.callStatus&&"declined"!==room.callStatus&&"ended"!==room.callStatus){_context.next=3;break}return _context.next=3,SDKClient.sdk.rest.get("/v1/livechat/webrtc.call",{rid:room._id});case 3:window.open("/meet/".concat(room._id),room._id);case 4:case"end":return _context.stop()}}),_callee)}))),[room._id,room.callStatus]);return(0,react.useMemo)((function(){if(allowed)return useWebRTCVideoRoomAction_objectSpread(useWebRTCVideoRoomAction_objectSpread({id:"webRTCVideo",groups:["live"],title:"WebRTC_Call",icon:"phone"},federated&&{tooltip:t("core.Call_unavailable_for_federation"),disabled:!0}),{},{action:function action(){handleClick()},full:!0,order:4})}),[allowed,federated,handleClick,t])}],quickActionHooks=[function useMoveQueueQuickAction(){return(0,react.useMemo)((function(){return{groups:["live"],id:quickActions.i.MoveQueue,title:"Move_queue",icon:"burger-arrow-left",order:1}}),[])},function useChatForwardQuickAction(){return(0,react.useMemo)((function(){return{groups:["live"],id:quickActions.i.ChatForward,title:"Forward_chat",icon:"balloon-arrow-top-right",order:2}}),[])},function useTranscriptQuickAction(){return(0,react.useMemo)((function(){return{groups:["live"],id:quickActions.i.Transcript,title:"Send_transcript",icon:"mail-arrow-top-right",order:3,options:[{label:"Send_via_email",id:quickActions.i.TranscriptEmail},{label:"Export_as_PDF",id:quickActions.i.TranscriptPDF,validate:function validate(room){return{tooltip:"Export_enabled_at_the_end_of_the_conversation",value:!(null!=room&&room.open)}}}]}}),[])},function useCloseChatQuickAction(){return(0,react.useMemo)((function(){return{groups:["live"],id:quickActions.i.CloseChat,title:"End_conversation",icon:"balloon-close-top-right",order:5,color:"danger"}}),[])},function useOnHoldChatQuickAction(){var licensed=!0===(0,useHasLicenseModule.b)("livechat-enterprise");return(0,react.useMemo)((function(){if(licensed)return{groups:["live"],id:quickActions.i.OnHoldChat,title:"Omnichannel_onHold_Chat",icon:"pause-unfilled",order:4}}),[licensed])}],roomActionHooksForE2EESetup=[useChannelSettingsRoomAction,useMembersListRoomAction,useE2EERoomAction]},"./client/views/room/lib/quickActions.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{i:function(){return QuickActionsEnum}});var QuickActionsEnum=function(QuickActionsEnum){return QuickActionsEnum.MoveQueue="rocket-move-to-queue",QuickActionsEnum.ChatForward="rocket-chat-forward",QuickActionsEnum.Transcript="rocket-transcript",QuickActionsEnum.TranscriptEmail="rocket-transcript-email",QuickActionsEnum.TranscriptPDF="rocket-transcript-pdf",QuickActionsEnum.CloseChat="rocket-close-chat",QuickActionsEnum.OnHoldChat="rocket-on-hold-chat",QuickActionsEnum}({})}}]);