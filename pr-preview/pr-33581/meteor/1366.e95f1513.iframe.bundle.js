/*! For license information please see 1366.e95f1513.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_rocket_chat_meteor=self.webpackChunk_rocket_chat_meteor||[]).push([[1366],{"./client/components/Omnichannel/Skeleton.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{e:function(){return FormSkeleton}});var _rocket_chat_fuselage__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js");function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}var FormSkeleton=function FormSkeleton(props){return react__WEBPACK_IMPORTED_MODULE_1__.createElement(_rocket_chat_fuselage__WEBPACK_IMPORTED_MODULE_0__.Box,_extends({w:"full",pb:24},props),react__WEBPACK_IMPORTED_MODULE_1__.createElement(_rocket_chat_fuselage__WEBPACK_IMPORTED_MODULE_0__.Skeleton,{mbe:8}),react__WEBPACK_IMPORTED_MODULE_1__.createElement(_rocket_chat_fuselage__WEBPACK_IMPORTED_MODULE_0__.Skeleton,{mbe:4}))};FormSkeleton.__docgenInfo={description:"",methods:[],displayName:"FormSkeleton"}},"./client/components/Omnichannel/Tags.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:function(){return Omnichannel_Tags}});var fuselage=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),index_module=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),dist=__webpack_require__("../../packages/ui-contexts/dist/index.js"),react=__webpack_require__("./node_modules/react/index.js"),additionalForms=__webpack_require__("./client/views/omnichannel/additionalForms.tsx"),Skeleton=__webpack_require__("./client/components/Omnichannel/Skeleton.tsx"),lib=__webpack_require__("../../node_modules/@tanstack/react-query/build/lib/index.js"),useOmnichannel=__webpack_require__("./client/hooks/omnichannel/useOmnichannel.ts");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||_unsupportedIterableToArray(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var Tags=function Tags(_ref){var _ref$tags=_ref.tags,tags=void 0===_ref$tags?[]:_ref$tags,_handler=_ref.handler,error=_ref.error,tagRequired=_ref.tagRequired,department=_ref.department,t=(0,dist.useTranslation)(),_useLivechatTags=function useLivechatTags(options){var getTags=(0,dist.useEndpoint)("GET","/v1/livechat/tags"),isEnterprise=(0,useOmnichannel.q)().isEnterprise,department=options.department,text=options.text,viewAll=options.viewAll;return(0,lib.useQuery)(["/v1/livechat/tags",text,department],(function(){return getTags(_objectSpread(_objectSpread({text:text||""},department&&{department:department}),{},{viewAll:viewAll?"true":"false"}))}),{enabled:isEnterprise})}({department:department,viewAll:!department}),tagsResult=_useLivechatTags.data,isInitialLoading=_useLivechatTags.isInitialLoading,customTags=(0,react.useMemo)((function(){return tags.filter((function(tag){return!(null!=tagsResult&&tagsResult.tags.find((function(rtag){return rtag.name===tag})))}))}),[tags,null==tagsResult?void 0:tagsResult.tags]),dispatchToastMessage=(0,dist.useToastMessageDispatch)(),_useState2=_slicedToArray((0,react.useState)(""),2),tagValue=_useState2[0],handleTagValue=_useState2[1],paginatedTagValue=(0,react.useMemo)((function(){return tags.map((function(tag){return{label:tag,value:tag}}))}),[tags]),handleTagTextSubmit=(0,index_module.useMutableCallback)((function(){if(tags)return tagValue&&""!==tagValue.trim()?void(tags.includes(tagValue)?dispatchToastMessage({type:"error",message:t("Tag_already_exists")}):(_handler([].concat(_toConsumableArray(tags),[tagValue])),handleTagValue(""))):(dispatchToastMessage({type:"error",message:t("Enter_a_tag")}),void handleTagValue(""))}));return isInitialLoading?react.createElement(Skeleton.e,null):react.createElement(react.Fragment,null,react.createElement(fuselage.FieldLabel,{required:tagRequired,mb:4},t("Tags")),null!=tagsResult&&tagsResult.tags&&null!=tagsResult&&tagsResult.tags.length?react.createElement(fuselage.FieldRow,null,react.createElement(additionalForms.bz,{value:paginatedTagValue,handler:function handler(tags){_handler(tags.map((function(tag){return tag.label})))},department:department,viewAll:!department})):react.createElement(react.Fragment,null,react.createElement(fuselage.FieldRow,null,react.createElement(fuselage.TextInput,{error:error,value:tagValue,onChange:function onChange(_ref2){var currentTarget=_ref2.currentTarget;return handleTagValue(currentTarget.value)},flexGrow:1,placeholder:t("Enter_a_tag")}),react.createElement(fuselage.Button,{disabled:!tagValue,mis:8,title:t("Add"),onClick:handleTagTextSubmit},t("Add")))),customTags.length>0&&react.createElement(fuselage.FieldRow,{justifyContent:"flex-start"},null==customTags?void 0:customTags.map((function(tag,i){return react.createElement(fuselage.Chip,{key:i,onClick:function onClick(){return function removeTag(tagToRemove){tags&&_handler(tags.filter((function(tag){return tag!==tagToRemove})))}(tag)},mie:8},tag)}))))},Omnichannel_Tags=Tags;Tags.__docgenInfo={description:"",methods:[],displayName:"Tags",props:{tags:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:"",defaultValue:{value:"[]",computed:!1}},handler:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: string[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"value"}],return:{name:"void"}}},description:""},error:{required:!1,tsType:{name:"string"},description:""},tagRequired:{required:!1,tsType:{name:"boolean"},description:""},department:{required:!1,tsType:{name:"string"},description:""}}}},"./client/hooks/useFormatDateAndTime.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{J:function(){return useFormatDateAndTime}});var _rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../packages/ui-contexts/dist/index.js"),moment__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/moment/moment.js"),moment__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_1__),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/index.js"),useFormatDateAndTime=function useFormatDateAndTime(){var withSeconds=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).withSeconds,clockMode=(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useUserPreference)("clockMode"),format=(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_0__.useSetting)("Message_TimeAndDateFormat");return(0,react__WEBPACK_IMPORTED_MODULE_2__.useCallback)((function(time){switch(clockMode){case 1:return moment__WEBPACK_IMPORTED_MODULE_1___default()(time).format(withSeconds?"MMMM D, Y h:mm:ss A":"MMMM D, Y h:mm A");case 2:return moment__WEBPACK_IMPORTED_MODULE_1___default()(time).format(withSeconds?"MMMM D, Y H:mm:ss":"MMMM D, Y H:mm");default:return moment__WEBPACK_IMPORTED_MODULE_1___default()(time).format(withSeconds?"L LTS":format)}}),[clockMode,format,withSeconds])}},"./client/views/omnichannel/directory/chats/contextualBar/ChatsContextualBar.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return contextualBar_ChatsContextualBar}});var dist=__webpack_require__("../../packages/ui-contexts/dist/index.js"),react=__webpack_require__("./node_modules/react/index.js"),Contextualbar=__webpack_require__("./client/components/Contextualbar/index.ts"),RoomContext=__webpack_require__("./client/views/room/contexts/RoomContext.ts"),RoomToolboxContext=__webpack_require__("./client/views/room/contexts/RoomToolboxContext.ts"),fuselage=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),index_module=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),meteor=__webpack_require__("./.storybook/mocks/meteor.js"),moment=__webpack_require__("./node_modules/moment/moment.js"),moment_default=__webpack_require__.n(moment),InfoPanel=__webpack_require__("./client/components/InfoPanel/index.ts"),MarkdownText=__webpack_require__("./client/components/MarkdownText.tsx"),useEndpointData=__webpack_require__("./client/hooks/useEndpointData.ts"),useFormatDateAndTime=__webpack_require__("./client/hooks/useFormatDateAndTime.ts"),CustomField=__webpack_require__("./client/views/omnichannel/components/CustomField.tsx"),AgentField=__webpack_require__("./client/views/omnichannel/directory/components/AgentField.tsx"),Field=__webpack_require__("./client/views/omnichannel/components/Field.tsx"),Info=__webpack_require__("./client/views/omnichannel/components/Info.tsx"),Label=__webpack_require__("./client/views/omnichannel/components/Label.tsx"),lib=__webpack_require__("../../node_modules/@tanstack/react-query/build/lib/index.js"),useHasLicenseModule=__webpack_require__("./client/hooks/useHasLicenseModule.ts"),FormSkeleton=__webpack_require__("./client/views/omnichannel/directory/components/FormSkeleton.tsx"),SlaField=function SlaField(_ref){var id=_ref.id,t=(0,dist.useTranslation)(),_useSlaInfo=function useSlaInfo(slaId){var isEnterprise=!0===(0,useHasLicenseModule.b)("livechat-enterprise"),getSLA=(0,dist.useEndpoint)("GET","/v1/livechat/sla/:slaId",{slaId:slaId});return(0,lib.useQuery)(["/v1/livechat/sla/:slaId",slaId],(function(){return getSLA()}),{enabled:isEnterprise&&!!slaId})}(id),data=_useSlaInfo.data,isInitialLoading=_useSlaInfo.isInitialLoading,isError=_useSlaInfo.isError;if(isInitialLoading)return react.createElement(FormSkeleton.e,null);if(isError||!data)return react.createElement(fuselage.Box,{mbs:16},t("Custom_Field_Not_Found"));var name=data.name;return react.createElement(Field.A,null,react.createElement(Label.A,null,t("SLA_Policy")),react.createElement(Info.A,null,name))},components_SlaField=SlaField;SlaField.__docgenInfo={description:"",methods:[],displayName:"SlaField",props:{id:{required:!0,tsType:{name:"string"},description:""}}};var OmnichannelRoomIcon=__webpack_require__("./client/components/RoomIcon/OmnichannelRoomIcon/index.tsx"),SourceField=function SourceField(_ref){var room=_ref.room,t=(0,dist.useTranslation)(),roomSource=room.source.alias||room.source.id||room.source.type,defaultTypesLabels={widget:t("Livechat"),email:t("Email"),sms:t("SMS"),app:room.source.alias||t("Custom_Integration"),api:room.source.alias||t("Custom_Integration"),other:t("Custom_Integration")},defaultTypesVisitorData={widget:"",email:null==room?void 0:room.source.id,sms:t("External"),app:room.source.label||t("External"),api:room.source.label||t("External"),other:t("External")};return react.createElement(Field.A,null,react.createElement(Label.A,null,t("Channel")),react.createElement(Info.A,null,react.createElement(fuselage.Box,{display:"flex",alignItems:"center"},react.createElement(OmnichannelRoomIcon.p,{source:room.source,status:room.v.status,size:"x24"}),react.createElement(Label.A,{mi:8,mbe:"0"},defaultTypesLabels[room.source.type]||roomSource),defaultTypesVisitorData[room.source.type])))},components_SourceField=SourceField;SourceField.__docgenInfo={description:"",methods:[],displayName:"SourceField",props:{room:{required:!0,tsType:{name:"IOmnichannelRoom"},description:""}}};var UserStatus=__webpack_require__("./client/components/UserStatus/index.ts"),roomCoordinator=__webpack_require__("./client/lib/rooms/roomCoordinator.tsx"),AgentInfoDetails=__webpack_require__("./client/views/omnichannel/components/AgentInfoDetails.tsx"),ContactField=function ContactField(_ref){var contact=_ref.contact,room=_ref.room,t=(0,dist.useTranslation)(),status=contact.status,fname=room.fname,type=room.t,avatarUrl=roomCoordinator.roomCoordinator.getRoomDirectives(type).getAvatarPath(room)||"",getVisitorInfo=(0,dist.useEndpoint)("GET","/v1/livechat/visitors.info"),_useQuery=(0,lib.useQuery)(["/v1/livechat/visitors.info",contact._id],(function(){return getVisitorInfo({visitorId:contact._id})})),data=_useQuery.data,isLoading=_useQuery.isLoading,isError=_useQuery.isError;if(isLoading)return react.createElement(FormSkeleton.e,null);if(isError||null==data||!data.visitor)return react.createElement(fuselage.Box,{mbs:16},t("Contact_not_found"));var _data$visitor=data.visitor,username=_data$visitor.username,displayName=_data$visitor.name||username;return react.createElement(Field.A,null,react.createElement(Label.A,null,t("Contact")),react.createElement(Info.A,{style:{display:"flex"}},react.createElement(fuselage.Avatar,{size:"x40",title:fname,url:avatarUrl}),react.createElement(AgentInfoDetails.A,{"data-qa-id":"contactInfo-name",mis:10,name:displayName,shortName:username,status:react.createElement(UserStatus._O,{status:status})})))},components_ContactField=ContactField;ContactField.__docgenInfo={description:"",methods:[],displayName:"ContactField",props:{contact:{required:!0,tsType:{name:"IVisitor"},description:""},room:{required:!0,tsType:{name:"IOmnichannelGenericRoom"},description:""}}};var useOmnichannelPriorities=__webpack_require__("./client/omnichannel/hooks/useOmnichannelPriorities.ts"),PriorityField=function PriorityField(_ref){var id=_ref.id,t=(0,dist.useTranslation)(),_usePriorityInfo=function usePriorityInfo(priorityId){var enabled=(0,useOmnichannelPriorities.Y)().enabled,getPriority=(0,dist.useEndpoint)("GET","/v1/livechat/priorities/:priorityId",{priorityId:priorityId});return(0,lib.useQuery)(["/v1/livechat/priorities",priorityId],(function(){return getPriority()}),{cacheTime:0,enabled:enabled})}(id),data=_usePriorityInfo.data,isInitialLoading=_usePriorityInfo.isInitialLoading,isError=_usePriorityInfo.isError;if(isInitialLoading)return react.createElement(FormSkeleton.e,null);if(isError||!data)return react.createElement(fuselage.Box,{mbs:16},t("Custom_Field_Not_Found"));var dirty=data.dirty,name=data.name,i18n=data.i18n;return react.createElement(Field.A,null,react.createElement(Label.A,null,t("Priority")),react.createElement(Info.A,null,dirty?name:t(i18n)))},components_PriorityField=PriorityField;PriorityField.__docgenInfo={description:"",methods:[],displayName:"PriorityField",props:{id:{required:!0,tsType:{name:"string"},description:""}}};var useRoomInfoEndpoint=__webpack_require__("./client/hooks/useRoomInfoEndpoint.ts");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}var _excluded=["data"];function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var useOmnichannelRoomInfo=function useOmnichannelRoomInfo(roomId){var _useRoomInfoEndpoint=(0,useRoomInfoEndpoint.s)(roomId),roomData=_useRoomInfoEndpoint.data,props=function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_useRoomInfoEndpoint,_excluded);return function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({data:null==roomData?void 0:roomData.room},props)},DepartmentField=function DepartmentField(_ref){var _data$department,departmentId=_ref.departmentId,t=(0,dist.useTranslation)(),_useDepartmentInfo=function useDepartmentInfo(departmentId){var deptInfo=(0,dist.useEndpoint)("GET","/v1/livechat/department/:_id",{_id:departmentId});return(0,lib.useQuery)(["livechat/department",departmentId],(function(){return deptInfo({})}))}(departmentId),data=_useDepartmentInfo.data,isLoading=_useDepartmentInfo.isLoading,isError=_useDepartmentInfo.isError;return react.createElement(Field.A,null,react.createElement(Label.A,null,t("Department")),isLoading&&react.createElement(fuselage.Skeleton,null),isError&&react.createElement(fuselage.Box,{color:"danger"},t("Something_went_wrong")),!isLoading&&!isError&&react.createElement(Info.A,null,(null==data||null===(_data$department=data.department)||void 0===_data$department?void 0:_data$department.name)||t("Department_not_found")))},contextualBar_DepartmentField=DepartmentField;DepartmentField.__docgenInfo={description:"",methods:[],displayName:"DepartmentField",props:{departmentId:{required:!0,tsType:{name:"string"},description:""}}};var ua_parser=__webpack_require__("./node_modules/ua-parser-js/src/ua-parser.js"),ua_parser_default=__webpack_require__.n(ua_parser),asyncState=__webpack_require__("./client/lib/asyncState/index.ts"),VisitorClientInfo=function VisitorClientInfo(_ref){var uid=_ref.uid,t=(0,dist.useTranslation)(),_useEndpointData=(0,useEndpointData.t)("/v1/livechat/visitors.info",{params:(0,react.useMemo)((function(){return{visitorId:uid}}),[uid])}),userData=_useEndpointData.value,state=_useEndpointData.phase,error=_useEndpointData.error;if(state===asyncState.Z7.LOADING)return react.createElement(FormSkeleton.e,null);if(error||!userData||!userData.visitor.userAgent)return null;var clientData={},ua=new(ua_parser_default());return ua.setUA(userData.visitor.userAgent),clientData.os="".concat(ua.getOS().name," ").concat(ua.getOS().version),clientData.browser="".concat(ua.getBrowser().name," ").concat(ua.getBrowser().version),clientData.host=userData.visitor.host,clientData.ip=userData.visitor.ip,react.createElement(react.Fragment,null,clientData.os&&react.createElement(Field.A,null,react.createElement(Label.A,null,t("OS")),react.createElement(Info.A,null,clientData.os)),clientData.browser&&react.createElement(Field.A,null,react.createElement(Label.A,null,t("Browser")),react.createElement(Info.A,null,clientData.browser)),clientData.host&&react.createElement(Field.A,null,react.createElement(Label.A,null,t("Host")),react.createElement(Info.A,null,clientData.host)),clientData.ip&&react.createElement(Field.A,null,react.createElement(Label.A,null,t("IP")),react.createElement(Info.A,null,clientData.ip)))},contextualBar_VisitorClientInfo=VisitorClientInfo;function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function ChatInfo(_ref){var _metrics$response,id=_ref.id,route=_ref.route,t=(0,dist.useTranslation)(),dispatchToastMessage=(0,dist.useToastMessageDispatch)(),formatDateAndTime=(0,useFormatDateAndTime.J)(),_useEndpointData=(0,useEndpointData.t)("/v1/livechat/custom-fields"),allCustomFields=_useEndpointData.value,stateCustomFields=_useEndpointData.phase,_useState2=_slicedToArray((0,react.useState)([]),2),customFields=_useState2[0],setCustomFields=_useState2[1],formatDuration=function useFormatDuration(){var t=(0,dist.useTranslation)();return(0,react.useCallback)((function(duration){var days=Math.floor(duration/86400),hours=Math.floor(duration%86400/3600),minutes=Math.floor(duration%86400%3600/60),seconds=Math.floor(duration%86400%3600%60),out="";return days>0&&(out+="".concat(days," ").concat(t("days"),", ")),hours>0&&(out+="".concat(hours," ").concat(t("hours"),", ")),minutes>0&&(out+="".concat(minutes," ").concat(t("minutes"),", ")),seconds>0&&(out+="".concat(seconds," ").concat(t("seconds"))),out}),[t])}(),room=useOmnichannelRoomInfo(id).data,_ref2=room||{room:{v:{}}},ts=_ref2.ts,tags=_ref2.tags,closedAt=_ref2.closedAt,departmentId=_ref2.departmentId,v=_ref2.v,servedBy=_ref2.servedBy,metrics=_ref2.metrics,topic=_ref2.topic,waitingResponse=_ref2.waitingResponse,responseBy=_ref2.responseBy,slaId=_ref2.slaId,priorityId=_ref2.priorityId,livechatData=_ref2.livechatData,source=_ref2.source,queuedAt=_ref2.queuedAt,routePath=(0,dist.useRoute)(route||"omnichannel-directory"),canViewCustomFields=(0,dist.usePermission)("view-livechat-room-customfields"),subscription=(0,dist.useUserSubscription)(id),hasGlobalEditRoomPermission=(0,dist.usePermission)("save-others-livechat-room-info"),hasLocalEditRoomPermission=(null==servedBy?void 0:servedBy._id)===meteor.fj.userId(),visitorId=null==v?void 0:v._id,queueStartedAt=queuedAt||ts,queueTime=(0,react.useMemo)((function(){return function formatQueuedAt(room){var _ref=room||{},servedBy=_ref.servedBy,closedAt=_ref.closedAt,open=_ref.open,queuedAt=_ref.queuedAt,ts=_ref.ts,queueStartedAt=queuedAt||ts;return servedBy?moment_default()(servedBy.ts).from(moment_default()(queueStartedAt),!0):open?moment_default()(queueStartedAt).fromNow(!0):closedAt&&queueStartedAt?moment_default()(closedAt).from(moment_default()(queueStartedAt),!0):""}(room)}),[room]);(0,react.useEffect)((function(){if(allCustomFields){var customFieldsAPI=allCustomFields.customFields;setCustomFields(customFieldsAPI)}}),[allCustomFields,stateCustomFields]);var onEditClick=(0,index_module.useMutableCallback)((function(){if(!(!!subscription||hasLocalEditRoomPermission||hasGlobalEditRoomPermission))return dispatchToastMessage({type:"error",message:t("Not_authorized")});routePath.push(route?{tab:"room-info",context:"edit",id:id}:{page:"chats",id:id,bar:"edit"})})),customFieldEntries=Object.entries(livechatData||{}).filter((function(_ref4){var key=_slicedToArray(_ref4,1)[0];return function checkIsVisibleAndScopeRoom(key){var field=customFields.find((function(_ref3){return _ref3._id===key}));return"visible"===(null==field?void 0:field.visibility)&&"room"===(null==field?void 0:field.scope)}(key)&&livechatData[key]}));return react.createElement(react.Fragment,null,react.createElement(Contextualbar.xN,{p:24},react.createElement(fuselage.Margins,{block:"x4"},source&&react.createElement(components_SourceField,{room:room}),room&&v&&react.createElement(components_ContactField,{contact:v,room:room}),visitorId&&react.createElement(contextualBar_VisitorClientInfo,{uid:visitorId}),servedBy&&react.createElement(AgentField.A,{agent:servedBy}),departmentId&&react.createElement(contextualBar_DepartmentField,{departmentId:departmentId}),tags&&tags.length>0&&react.createElement(InfoPanel.z6,null,react.createElement(InfoPanel.pm,null,t("Tags")),react.createElement(InfoPanel.kq,null,tags.map((function(tag){return react.createElement(fuselage.Box,{key:tag,mie:4,display:"inline"},react.createElement(fuselage.Tag,{style:{display:"inline"},disabled:!0},tag))})))),topic&&react.createElement(InfoPanel.z6,null,react.createElement(InfoPanel.pm,null,t("Topic")),react.createElement(InfoPanel.kq,{withTruncatedText:!1},react.createElement(MarkdownText.A,{variant:"inline",content:topic}))),queueStartedAt&&react.createElement(InfoPanel.z6,null,react.createElement(InfoPanel.pm,null,t("Queue_Time")),react.createElement(InfoPanel.kq,null,queueTime)),closedAt&&react.createElement(InfoPanel.z6,null,react.createElement(InfoPanel.pm,null,t("Chat_Duration")),react.createElement(InfoPanel.kq,null,moment_default()(closedAt).from(moment_default()(ts),!0))),ts&&react.createElement(InfoPanel.z6,null,react.createElement(InfoPanel.pm,null,t("Created_at")),react.createElement(InfoPanel.kq,null,formatDateAndTime(ts))),closedAt&&react.createElement(InfoPanel.z6,null,react.createElement(InfoPanel.pm,null,t("Closed_At")),react.createElement(InfoPanel.kq,null,formatDateAndTime(closedAt))),(null==servedBy?void 0:servedBy.ts)&&react.createElement(InfoPanel.z6,null,react.createElement(InfoPanel.pm,null,t("Taken_at")),react.createElement(InfoPanel.kq,null,formatDateAndTime(servedBy.ts))),(null==metrics||null===(_metrics$response=metrics.response)||void 0===_metrics$response?void 0:_metrics$response.avg)&&formatDuration(metrics.response.avg)&&react.createElement(InfoPanel.z6,null,react.createElement(InfoPanel.pm,null,t("Avg_response_time")),react.createElement(InfoPanel.kq,null,formatDuration(metrics.response.avg))),!waitingResponse&&(null==responseBy?void 0:responseBy.lastMessageTs)&&react.createElement(InfoPanel.z6,null,react.createElement(InfoPanel.pm,null,t("Inactivity_Time")),react.createElement(InfoPanel.kq,null,moment_default()(responseBy.lastMessageTs).fromNow(!0))),canViewCustomFields&&customFieldEntries.map((function(_ref6){var _ref7=_slicedToArray(_ref6,2),key=_ref7[0],value=_ref7[1];return react.createElement(CustomField.A,{key:key,id:key,value:value})})),slaId&&react.createElement(components_SlaField,{id:slaId}),priorityId&&react.createElement(components_PriorityField,{id:priorityId}))),react.createElement(Contextualbar.kV,null,react.createElement(fuselage.ButtonGroup,{stretch:!0},react.createElement(fuselage.Button,{icon:"pencil",onClick:onEditClick,"data-qa-id":"room-info-edit"},t("Edit")))))}VisitorClientInfo.__docgenInfo={description:"",methods:[],displayName:"VisitorClientInfo"};var contextualBar_ChatInfo=ChatInfo;function useVisitorInfo_typeof(o){return useVisitorInfo_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useVisitorInfo_typeof(o)}ChatInfo.__docgenInfo={description:"",methods:[],displayName:"ChatInfo"};var useVisitorInfo_excluded=["data"];function useVisitorInfo_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function useVisitorInfo_defineProperty(e,r,t){return(r=function useVisitorInfo_toPropertyKey(t){var i=function useVisitorInfo_toPrimitive(t,r){if("object"!=useVisitorInfo_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=useVisitorInfo_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==useVisitorInfo_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var useVisitorInfo=function useVisitorInfo(visitorId){var _ref=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_ref$enabled=_ref.enabled,enabled=void 0===_ref$enabled||_ref$enabled,_ref$cacheTime=_ref.cacheTime,cacheTime=void 0===_ref$cacheTime?0:_ref$cacheTime,getVisitorInfo=(0,dist.useEndpoint)("GET","/v1/livechat/visitors.info"),_useQuery=(0,lib.useQuery)(["/v1/livechat/visitors.info",visitorId],(function(){return getVisitorInfo({visitorId:visitorId})}),{enabled:enabled,cacheTime:cacheTime}),_useQuery$data=_useQuery.data;return function useVisitorInfo_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?useVisitorInfo_ownKeys(Object(t),!0).forEach((function(r){useVisitorInfo_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):useVisitorInfo_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({data:(void 0===_useQuery$data?{}:_useQuery$data).visitor},function useVisitorInfo_objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function useVisitorInfo_objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_useQuery,useVisitorInfo_excluded))},ui_client_dist=__webpack_require__("../../packages/ui-client/dist/index.js"),index_esm=__webpack_require__("./node_modules/react-hook-form/dist/index.esm.mjs"),client=__webpack_require__("./app/authorization/client/index.ts"),Tags=__webpack_require__("./client/components/Omnichannel/Tags.tsx"),additionalForms=__webpack_require__("./client/views/omnichannel/additionalForms.tsx"),useCustomFieldsMetadata=__webpack_require__("./client/views/omnichannel/directory/hooks/useCustomFieldsMetadata.tsx"),millisecondsToMinutes=__webpack_require__("./node_modules/date-fns/esm/millisecondsToMinutes/index.js");function useSlaPolicies_typeof(o){return useSlaPolicies_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},useSlaPolicies_typeof(o)}var useSlaPolicies_excluded=["data"];function useSlaPolicies_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function useSlaPolicies_defineProperty(e,r,t){return(r=function useSlaPolicies_toPropertyKey(t){var i=function useSlaPolicies_toPrimitive(t,r){if("object"!=useSlaPolicies_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=useSlaPolicies_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==useSlaPolicies_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var useSlaPolicies=function useSlaPolicies(){var isEnterprise=!0===(0,useHasLicenseModule.b)("livechat-enterprise"),getSlaPolicies=(0,dist.useEndpoint)("GET","/v1/livechat/sla"),_useQuery=(0,lib.useQuery)(["/v1/livechat/sla"],(function(){return getSlaPolicies({})}),{staleTime:(0,millisecondsToMinutes.A)(10),enabled:isEnterprise}),_useQuery$data=_useQuery.data;return function useSlaPolicies_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?useSlaPolicies_ownKeys(Object(t),!0).forEach((function(r){useSlaPolicies_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):useSlaPolicies_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({data:(void 0===_useQuery$data?{}:_useQuery$data).sla},function useSlaPolicies_objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function useSlaPolicies_objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_useQuery,useSlaPolicies_excluded))};function RoomEdit_typeof(o){return RoomEdit_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},RoomEdit_typeof(o)}function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,(function(){return this}));var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach((function(e){define(t,e,(function(t){return this._invoke(e,t)}))}))}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==RoomEdit_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){invoke("next",t,i,a)}),(function(t){invoke("throw",t,i,a)})):e.resolve(h).then((function(t){u.value=t,i(u)}),(function(t){return invoke("throw",t,i,a)}))}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e((function(e,r){invoke(t,n,e,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(RoomEdit_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function RoomEdit_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function RoomEdit_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?RoomEdit_ownKeys(Object(t),!0).forEach((function(r){RoomEdit_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):RoomEdit_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function RoomEdit_defineProperty(e,r,t){return(r=function RoomEdit_toPropertyKey(t){var i=function RoomEdit_toPrimitive(t,r){if("object"!=RoomEdit_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=RoomEdit_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==RoomEdit_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function asyncGeneratorStep(n,t,e,r,o,a,c){try{var i=n[a](c),u=i.value}catch(n){return void e(n)}i.done?t(u):Promise.resolve(u).then(r,o)}var ROOM_INTIAL_VALUE={topic:"",tags:[],livechatData:{},slaId:""},getInitialValuesRoom=function getInitialValuesRoom(room){var _ref=null!=room?room:ROOM_INTIAL_VALUE,topic=_ref.topic,tags=_ref.tags,livechatData=_ref.livechatData,slaId=_ref.slaId,priorityId=_ref.priorityId;return{topic:null!=topic?topic:"",tags:null!=tags?tags:[],livechatData:null!=livechatData?livechatData:{},slaId:null!=slaId?slaId:"",priorityId:null!=priorityId?priorityId:""}};function RoomEdit(_ref2){var room=_ref2.room,visitor=_ref2.visitor,reload=_ref2.reload,reloadInfo=_ref2.reloadInfo,onClose=_ref2.onClose,t=(0,dist.useTranslation)(),dispatchToastMessage=(0,dist.useToastMessageDispatch)(),queryClient=(0,lib.useQueryClient)(),canViewCustomFields=(0,client.WX)(["view-livechat-room-customfields","edit-livechat-room-customfields"]),saveRoom=(0,dist.useEndpoint)("POST","/v1/livechat/room.saveInfo"),_useSlaPolicies=useSlaPolicies(),slaPolicies=_useSlaPolicies.data,isSlaPoliciesLoading=_useSlaPolicies.isInitialLoading,_useCustomFieldsMetad=(0,useCustomFieldsMetadata.h)({scope:"room",enabled:canViewCustomFields}),customFieldsMetadata=_useCustomFieldsMetad.data,isCustomFieldsLoading=_useCustomFieldsMetad.isInitialLoading,_useOmnichannelPriori=(0,useOmnichannelPriorities.Y)(),priorities=_useOmnichannelPriori.data,isPrioritiesLoading=_useOmnichannelPriori.isLoading,_useForm=(0,index_esm.mN)({mode:"onChange",defaultValues:getInitialValuesRoom(room)}),register=_useForm.register,control=_useForm.control,_useForm$formState=_useForm.formState,isFormDirty=_useForm$formState.isDirty,isFormValid=_useForm$formState.isValid,isSubmitting=_useForm$formState.isSubmitting,handleSubmit=_useForm.handleSubmit,tagsField=(0,index_esm.as)({control:control,name:"tags"}).field,slaIdField=(0,index_esm.as)({control:control,name:"slaId"}).field,priorityIdField=(0,index_esm.as)({control:control,name:"priorityId"}).field,handleSave=(0,react.useCallback)(function(){var _ref3=function _asyncToGenerator(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function _next(n){asyncGeneratorStep(a,r,o,_next,_throw,"next",n)}function _throw(n){asyncGeneratorStep(a,r,o,_next,_throw,"throw",n)}_next(void 0)}))}}(_regeneratorRuntime().mark((function _callee(data){var topic,tags,livechatData,slaId,priorityId,guestData,roomData;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(isFormValid){_context.next=2;break}return _context.abrupt("return");case 2:return topic=data.topic,tags=data.tags,livechatData=data.livechatData,slaId=data.slaId,priorityId=data.priorityId,guestData={_id:visitor._id},roomData=RoomEdit_objectSpread({_id:room._id,topic:topic,tags:tags.sort(),livechatData:livechatData,priorityId:priorityId},slaId&&{slaId:slaId}),_context.prev=5,_context.next=8,saveRoom({guestData:guestData,roomData:roomData});case 8:return _context.next=10,queryClient.invalidateQueries(["/v1/rooms.info",room._id]);case 10:dispatchToastMessage({type:"success",message:t("Saved")}),null==reload||reload(),null==reloadInfo||reloadInfo(),onClose(),_context.next=19;break;case 16:_context.prev=16,_context.t0=_context.catch(5),dispatchToastMessage({type:"error",message:_context.t0});case 19:case"end":return _context.stop()}}),_callee,null,[[5,16]])})));return function(_x){return _ref3.apply(this,arguments)}}(),[dispatchToastMessage,isFormValid,onClose,queryClient,reload,reloadInfo,room._id,saveRoom,t,visitor._id]);return isCustomFieldsLoading||isSlaPoliciesLoading||isPrioritiesLoading?react.createElement(Contextualbar.xN,null,react.createElement(FormSkeleton.e,null)):react.createElement(react.Fragment,null,react.createElement(Contextualbar.xN,{is:"form",onSubmit:handleSubmit(handleSave)},canViewCustomFields&&customFieldsMetadata&&react.createElement(ui_client_dist.V6,{formName:"livechatData",formControl:control,metadata:customFieldsMetadata}),react.createElement(fuselage.Field,null,react.createElement(fuselage.FieldLabel,null,t("Topic")),react.createElement(fuselage.FieldRow,null,react.createElement(fuselage.TextInput,_extends({},register("topic"),{flexGrow:1})))),react.createElement(fuselage.Field,null,react.createElement(Tags.A,{tags:tagsField.value,handler:tagsField.onChange,department:room.departmentId})),additionalForms.$I&&!(null==slaPolicies||!slaPolicies.length)&&react.createElement(additionalForms.$I,{label:t("SLA_Policy"),value:slaIdField.value,options:slaPolicies,onChange:slaIdField.onChange}),additionalForms.lQ&&!(null==priorities||!priorities.length)&&react.createElement(additionalForms.lQ,{label:t("Priority"),value:priorityIdField.value,options:priorities,onChange:priorityIdField.onChange})),react.createElement(Contextualbar.kV,null,react.createElement(fuselage.ButtonGroup,{stretch:!0},react.createElement(fuselage.Button,{flexGrow:1,onClick:onClose},t("Cancel")),react.createElement(fuselage.Button,{mie:"none",flexGrow:1,onClick:handleSubmit(handleSave),loading:isSubmitting,disabled:!isFormValid||!isFormDirty,primary:!0},t("Save")))))}var RoomEdit_RoomEdit=RoomEdit;function RoomEditWithData(_ref){var _room$v,roomId=_ref.id,reload=_ref.reload,reloadInfo=_ref.reloadInfo,onClose=_ref.onClose,t=(0,dist.useTranslation)(),_useOmnichannelRoomIn=useOmnichannelRoomInfo(roomId),room=_useOmnichannelRoomIn.data,isRoomLoading=_useOmnichannelRoomIn.isLoading,isRoomError=_useOmnichannelRoomIn.isError,visitorId=(null!==(_room$v=null==room?void 0:room.v)&&void 0!==_room$v?_room$v:{})._id,_useVisitorInfo=useVisitorInfo(visitorId,{enabled:!!visitorId}),visitor=_useVisitorInfo.data,isVisitorLoading=_useVisitorInfo.isInitialLoading,isVisitorError=_useVisitorInfo.isError;return isRoomLoading||isVisitorLoading?react.createElement(FormSkeleton.e,null):isRoomError||!room?react.createElement(fuselage.Box,{mbs:16},t("Room_not_found")):isVisitorError||!visitor?react.createElement(fuselage.Box,{mbs:16},t("Visitor_not_found")):react.createElement(RoomEdit_RoomEdit,{room:room,visitor:visitor,reload:reload,reloadInfo:reloadInfo,onClose:onClose})}RoomEdit.__docgenInfo={description:"",methods:[],displayName:"RoomEdit",props:{room:{required:!0,tsType:{name:"Serialized",elements:[{name:"IOmnichannelRoom"}],raw:"Serialized<IOmnichannelRoom>"},description:""},visitor:{required:!0,tsType:{name:"Serialized",elements:[{name:"ILivechatVisitor"}],raw:"Serialized<ILivechatVisitor>"},description:""},reload:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},reloadInfo:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};var RoomEdit_RoomEditWithData=RoomEditWithData;RoomEditWithData.__docgenInfo={description:"",methods:[],displayName:"RoomEditWithData",props:{id:{required:!0,tsType:{name:"string"},description:""},reload:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},reloadInfo:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};var HEADER_DATA={info:{icon:"info-circled",title:"Room_Info"},edit:{icon:"pencil",title:"edit-room"}},ChatsContextualBar=function ChatsContextualBar(){var t=(0,dist.useTranslation)(),context=(0,dist.useRouteParameter)("context"),directoryRoute=(0,dist.useRoute)("live"),room=(0,RoomContext.nq)(),closeTab=(0,RoomToolboxContext.W)().closeTab,_useMemo=(0,react.useMemo)((function(){return HEADER_DATA[null!=context?context:"info"]||HEADER_DATA.info}),[context]),icon=_useMemo.icon,title=_useMemo.title;return react.createElement(react.Fragment,null,react.createElement(Contextualbar.mH,null,react.createElement(Contextualbar.A4,{name:icon}),react.createElement(Contextualbar.jY,null,t(title)),react.createElement(Contextualbar.pi,{onClick:closeTab})),"edit"===context?react.createElement(RoomEdit_RoomEditWithData,{id:room._id,onClose:function handleRoomEditBarCloseButtonClick(){directoryRoute.push({id:room._id,tab:"room-info"})}}):react.createElement(contextualBar_ChatInfo,{route:"live",id:room._id}))},contextualBar_ChatsContextualBar=ChatsContextualBar;ChatsContextualBar.__docgenInfo={description:"",methods:[],displayName:"ChatsContextualBar"}},"./client/views/omnichannel/directory/components/AgentField.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var _rocket_chat_ui_avatar__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../packages/ui-avatar/dist/index.js"),_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../packages/ui-contexts/dist/index.js"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../node_modules/@tanstack/react-query/build/lib/index.js"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/index.js"),_components_UserStatus__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./client/components/UserStatus/index.ts"),_components_AgentInfoDetails__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./client/views/omnichannel/components/AgentInfoDetails.tsx"),_components_Field__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./client/views/omnichannel/components/Field.tsx"),_components_Info__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./client/views/omnichannel/components/Info.tsx"),_components_Label__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./client/views/omnichannel/components/Label.tsx"),_FormSkeleton__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./client/views/omnichannel/directory/components/FormSkeleton.tsx"),AgentField=function AgentField(_ref){var agent=_ref.agent,_ref$isSmall=_ref.isSmall,isSmall=void 0!==_ref$isSmall&&_ref$isSmall,t=(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_1__.useTranslation)(),_ref2$username=(null!=agent?agent:{}).username,username=void 0===_ref2$username?"":_ref2$username,getUserInfo=(0,_rocket_chat_ui_contexts__WEBPACK_IMPORTED_MODULE_1__.useEndpoint)("GET","/v1/users.info"),_useQuery=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_9__.useQuery)(["/v1/users.info",username],(function(){return getUserInfo({username:username})})),data=_useQuery.data;if(_useQuery.isLoading)return react__WEBPACK_IMPORTED_MODULE_2__.createElement(_FormSkeleton__WEBPACK_IMPORTED_MODULE_8__.e,null);var _ref3$user=(null!=data?data:{user:{}}).user,name=_ref3$user.name,status=_ref3$user.status,displayName=name||username;return react__WEBPACK_IMPORTED_MODULE_2__.createElement(_components_Field__WEBPACK_IMPORTED_MODULE_5__.A,null,react__WEBPACK_IMPORTED_MODULE_2__.createElement(_components_Label__WEBPACK_IMPORTED_MODULE_7__.A,null,t("Agent")),react__WEBPACK_IMPORTED_MODULE_2__.createElement(_components_Info__WEBPACK_IMPORTED_MODULE_6__.A,{style:{display:"flex"}},react__WEBPACK_IMPORTED_MODULE_2__.createElement(_rocket_chat_ui_avatar__WEBPACK_IMPORTED_MODULE_0__.H8,{size:isSmall?"x28":"x40",title:username,username:username||""}),react__WEBPACK_IMPORTED_MODULE_2__.createElement(_components_AgentInfoDetails__WEBPACK_IMPORTED_MODULE_4__.A,{mis:isSmall?"x8":"x10",name:displayName,shortName:username,status:react__WEBPACK_IMPORTED_MODULE_2__.createElement(_components_UserStatus__WEBPACK_IMPORTED_MODULE_3__._O,{status:status})})))};__webpack_exports__.A=AgentField,AgentField.__docgenInfo={description:"",methods:[],displayName:"AgentField",props:{agent:{required:!0,tsType:{name:"IOmnichannelRoom['servedBy']",raw:"IOmnichannelRoom['servedBy']"},description:""},isSmall:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}}}}]);