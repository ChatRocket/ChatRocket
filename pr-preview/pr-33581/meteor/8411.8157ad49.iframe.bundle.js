"use strict";(self.webpackChunk_rocket_chat_meteor=self.webpackChunk_rocket_chat_meteor||[]).push([[8411],{"./client/components/message/variants/RoomMessage.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{A:function(){return variants_RoomMessage}});var fuselage=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),index_module=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),dist=__webpack_require__("../../packages/ui-avatar/dist/index.js"),ui_contexts_dist=__webpack_require__("../../packages/ui-contexts/dist/index.js"),react=__webpack_require__("./node_modules/react/index.js"),MessageHighlightContext=__webpack_require__("./client/views/room/MessageList/contexts/MessageHighlightContext.tsx"),SelectedMessagesContext=__webpack_require__("./client/views/room/MessageList/contexts/SelectedMessagesContext.tsx"),useJumpToMessage=__webpack_require__("./client/views/room/MessageList/hooks/useJumpToMessage.ts"),UserCardContext=__webpack_require__("./client/views/room/contexts/UserCardContext.ts"),Emoji=__webpack_require__("./client/components/Emoji.tsx"),IgnoredContent=__webpack_require__("./client/components/message/IgnoredContent.tsx"),MessageHeader=__webpack_require__("./client/components/message/MessageHeader.tsx"),MessageToolbarHolder=__webpack_require__("./client/components/message/MessageToolbarHolder.tsx"),StatusIndicators=__webpack_require__("./client/components/message/StatusIndicators.tsx"),core_typings_dist=__webpack_require__("../../packages/core-typings/dist/index.js"),useUserData=__webpack_require__("./client/hooks/useUserData.ts"),ChatContext=__webpack_require__("./client/views/room/contexts/ChatContext.ts"),MessageContentBody=__webpack_require__("./client/components/message/MessageContentBody.tsx"),ReadReceiptIndicator=__webpack_require__("./client/components/message/ReadReceiptIndicator.tsx"),Attachments=__webpack_require__("./client/components/message/content/Attachments.tsx"),BroadcastMetrics=__webpack_require__("./client/components/message/content/BroadcastMetrics.tsx"),useTimeAgo=__webpack_require__("./client/hooks/useTimeAgo.ts"),useGoToRoom=__webpack_require__("./client/views/room/hooks/useGoToRoom.ts"),DiscussionMetrics=function DiscussionMetrics(_ref){var lm=_ref.lm,count=_ref.count,rid=_ref.rid,drid=_ref.drid,t=(0,ui_contexts_dist.useTranslation)(),format=(0,useTimeAgo.u)(),goToRoom=(0,useGoToRoom.q)();return react.createElement(fuselage.MessageBlock,null,react.createElement(fuselage.MessageMetrics,null,react.createElement(fuselage.MessageMetricsReply,{"data-rid":rid,"data-drid":drid,onClick:function onClick(){return goToRoom(drid)}},count?t("message_counter",{count:count}):t("Reply")),react.createElement(fuselage.MessageMetricsItem,{title:null==lm?void 0:lm.toLocaleString()},react.createElement(fuselage.MessageMetricsItemIcon,{name:"clock"}),react.createElement(fuselage.MessageMetricsItemLabel,null,lm?format(lm):t("No_messages_yet")))))},content_DiscussionMetrics=DiscussionMetrics;DiscussionMetrics.__docgenInfo={description:"",methods:[],displayName:"DiscussionMetrics",props:{drid:{required:!0,tsType:{name:"string"},description:""},rid:{required:!0,tsType:{name:"string"},description:""},count:{required:!0,tsType:{name:"number"},description:""},lm:{required:!1,tsType:{name:"Date"},description:""}}};var Location=__webpack_require__("./client/components/message/content/Location.tsx"),MessageActions=__webpack_require__("./client/components/message/content/MessageActions.tsx"),Reactions=__webpack_require__("./client/components/message/content/Reactions.tsx"),useToggleFollowingThreadMutation=__webpack_require__("./client/views/room/contextualBar/Threads/hooks/useToggleFollowingThreadMutation.ts"),useGoToThread=__webpack_require__("./client/views/room/hooks/useGoToThread.ts"),followSyle=__webpack_require__("./client/components/message/helpers/followSyle.ts"),AllMentionNotification=__webpack_require__("./client/components/message/notification/AllMentionNotification.tsx"),MeMentionNotification=__webpack_require__("./client/components/message/notification/MeMentionNotification.tsx"),UnreadMessagesNotification=__webpack_require__("./client/components/message/notification/UnreadMessagesNotification.tsx"),ThreadMetrics=function ThreadMetrics(_ref){var unread=_ref.unread,mention=_ref.mention,all=_ref.all,rid=_ref.rid,mid=_ref.mid,counter=_ref.counter,participants=_ref.participants,following=_ref.following,lm=_ref.lm,t=(0,ui_contexts_dist.useTranslation)(),format=(0,useTimeAgo.u)(),goToThread=(0,useGoToThread.R)(),dispatchToastMessage=(0,ui_contexts_dist.useToastMessageDispatch)(),toggleFollowingThreadMutation=(0,useToggleFollowingThreadMutation.M)({onError:function onError(error){dispatchToastMessage({type:"error",message:error})}}),handleFollow=(0,react.useCallback)((function(){toggleFollowingThreadMutation.mutate({rid:rid,tmid:mid,follow:!following})}),[following,rid,mid,toggleFollowingThreadMutation]);return react.createElement(fuselage.MessageBlock,{className:followSyle.d},react.createElement(fuselage.MessageMetrics,null,react.createElement(fuselage.MessageMetricsReply,{"data-rid":rid,"data-mid":mid,onClick:function onClick(){return goToThread({rid:rid,tmid:mid})}},t("Reply")),react.createElement(fuselage.MessageMetricsItem,{title:t("Replies")},react.createElement(fuselage.MessageMetricsItem.Icon,{name:"thread"}),react.createElement(fuselage.MessageMetricsItem.Label,null,counter)),!!participants&&react.createElement(fuselage.MessageMetricsItem,{title:t("Participants")},react.createElement(fuselage.MessageMetricsItem.Icon,{name:"user"}),react.createElement(fuselage.MessageMetricsItem.Label,null,participants)),react.createElement(fuselage.MessageMetricsItem,{title:null==lm?void 0:lm.toLocaleString()},react.createElement(fuselage.MessageMetricsItem.Icon,{name:"clock"}),react.createElement(fuselage.MessageMetricsItem.Label,null,format(lm))),react.createElement(fuselage.MessageMetricsItem,{className:following?void 0:followSyle.Y,"data-rid":rid},react.createElement(fuselage.MessageMetricsFollowing,{title:t(following?"Following":"Not_following"),name:following?"bell":"bell-off",onClick:handleFollow})),(mention||all||unread)&&react.createElement(fuselage.MessageMetricsItem,null,react.createElement(fuselage.MessageMetricsItem.Label,null,mention&&react.createElement(MeMentionNotification.A,null)||all&&react.createElement(AllMentionNotification.A,null)||unread&&react.createElement(UnreadMessagesNotification.A,null)))))},content_ThreadMetrics=ThreadMetrics;ThreadMetrics.__docgenInfo={description:"",methods:[],displayName:"ThreadMetrics",props:{unread:{required:!0,tsType:{name:"boolean"},description:""},mention:{required:!0,tsType:{name:"boolean"},description:""},all:{required:!0,tsType:{name:"boolean"},description:""},lm:{required:!0,tsType:{name:"Date"},description:""},mid:{required:!0,tsType:{name:"string"},description:""},rid:{required:!0,tsType:{name:"string"},description:""},counter:{required:!0,tsType:{name:"number"},description:""},participants:{required:!0,tsType:{name:"number"},description:""},following:{required:!0,tsType:{name:"boolean"},description:""}}};var UrlPreviews=__webpack_require__("./client/components/message/content/UrlPreviews.tsx"),useNormalizedMessage=__webpack_require__("./client/components/message/hooks/useNormalizedMessage.ts"),useOembedLayout=__webpack_require__("./client/components/message/hooks/useOembedLayout.ts"),useSubscriptionFromMessageQuery=__webpack_require__("./client/components/message/hooks/useSubscriptionFromMessageQuery.ts"),UiKitMessageBlock=__webpack_require__("./client/components/message/uikit/UiKitMessageBlock.tsx"),_excluded=["method_id","i18nLabel"];function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var RoomMessageContent=function RoomMessageContent(_ref){var _useSubscriptionFromM,_subscription$broadca,_normalizedMessage$at,_normalizedMessage$at2,_normalizedMessage$bl,_normalizedMessage$md,_message$files,_normalizedMessage$ur,_normalizedMessage$ac,_normalizedMessage$re,_normalizedMessage$re2,message=_ref.message,unread=_ref.unread,all=_ref.all,mention=_ref.mention,searchText=_ref.searchText,encrypted=(0,core_typings_dist.isE2EEMessage)(message),oembedEnabled=(0,useOembedLayout.y)().enabled,subscription=null!==(_useSubscriptionFromM=(0,useSubscriptionFromMessageQuery.g)(message).data)&&void 0!==_useSubscriptionFromM?_useSubscriptionFromM:void 0,broadcast=null!==(_subscription$broadca=null==subscription?void 0:subscription.broadcast)&&void 0!==_subscription$broadca&&_subscription$broadca,uid=(0,ui_contexts_dist.useUserId)(),messageUser=_objectSpread(_objectSpread({},message.u),{},{roles:[]},(0,useUserData.P)(message.u._id)),readReceiptEnabled=(0,ui_contexts_dist.useSetting)("Message_Read_Receipt_Enabled",!1),chat=(0,ChatContext.Y)(),t=(0,ui_contexts_dist.useTranslation)(),normalizedMessage=(0,useNormalizedMessage.Q)(message),isMessageEncrypted=encrypted&&"pending"===(null==normalizedMessage?void 0:normalizedMessage.e2e),quotes=(null==normalizedMessage||null===(_normalizedMessage$at=normalizedMessage.attachments)||void 0===_normalizedMessage$at?void 0:_normalizedMessage$at.filter(core_typings_dist.isQuoteAttachment))||[],attachments=(null==normalizedMessage||null===(_normalizedMessage$at2=normalizedMessage.attachments)||void 0===_normalizedMessage$at2?void 0:_normalizedMessage$at2.filter((function(attachment){return!(0,core_typings_dist.isQuoteAttachment)(attachment)})))||[];return react.createElement(react.Fragment,null,isMessageEncrypted&&react.createElement(fuselage.MessageBody,null,t("E2E_message_encrypted_placeholder")),!(null==quotes||!quotes.length)&&react.createElement(Attachments.A,{attachments:quotes}),!(null!==(_normalizedMessage$bl=normalizedMessage.blocks)&&void 0!==_normalizedMessage$bl&&_normalizedMessage$bl.length)&&!(null===(_normalizedMessage$md=normalizedMessage.md)||void 0===_normalizedMessage$md||!_normalizedMessage$md.length)&&react.createElement(react.Fragment,null,(!encrypted||"done"===normalizedMessage.e2e)&&react.createElement(MessageContentBody.A,{id:"".concat(normalizedMessage._id,"-content"),md:normalizedMessage.md,mentions:normalizedMessage.mentions,channels:normalizedMessage.channels,searchText:searchText})),!!attachments&&react.createElement(Attachments.A,{id:null===(_message$files=message.files)||void 0===_message$files||null===(_message$files=_message$files[0])||void 0===_message$files?void 0:_message$files._id,attachments:attachments}),normalizedMessage.blocks&&react.createElement(UiKitMessageBlock.A,{rid:normalizedMessage.rid,mid:normalizedMessage._id,blocks:normalizedMessage.blocks}),oembedEnabled&&!(null===(_normalizedMessage$ur=normalizedMessage.urls)||void 0===_normalizedMessage$ur||!_normalizedMessage$ur.length)&&react.createElement(UrlPreviews.A,{urls:normalizedMessage.urls}),(null===(_normalizedMessage$ac=normalizedMessage.actionLinks)||void 0===_normalizedMessage$ac?void 0:_normalizedMessage$ac.length)&&react.createElement(MessageActions.A,{message:normalizedMessage,actions:normalizedMessage.actionLinks.map((function(_ref2){var methodId=_ref2.method_id,i18nLabel=_ref2.i18nLabel,action=function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_ref2,_excluded);return _objectSpread({methodId:methodId,i18nLabel:i18nLabel},action)}))}),normalizedMessage.reactions&&Object.keys(normalizedMessage.reactions).length&&react.createElement(Reactions.A,{message:normalizedMessage}),chat&&(0,core_typings_dist.isThreadMainMessage)(normalizedMessage)&&react.createElement(content_ThreadMetrics,{counter:normalizedMessage.tcount,following:Boolean(uid&&(null==normalizedMessage||null===(_normalizedMessage$re=normalizedMessage.replies)||void 0===_normalizedMessage$re?void 0:_normalizedMessage$re.indexOf(uid))>-1),mid:normalizedMessage._id,rid:normalizedMessage.rid,lm:normalizedMessage.tlm,unread:unread,mention:mention,all:all,participants:null==normalizedMessage||null===(_normalizedMessage$re2=normalizedMessage.replies)||void 0===_normalizedMessage$re2?void 0:_normalizedMessage$re2.length}),(0,core_typings_dist.isDiscussionMessage)(normalizedMessage)&&react.createElement(content_DiscussionMetrics,{count:normalizedMessage.dcount,drid:normalizedMessage.drid,lm:normalizedMessage.dlm,rid:normalizedMessage.rid}),normalizedMessage.location&&react.createElement(Location.A,{location:normalizedMessage.location}),broadcast&&!!messageUser.username&&normalizedMessage.u._id!==uid&&react.createElement(BroadcastMetrics.A,{username:messageUser.username,message:normalizedMessage}),readReceiptEnabled&&react.createElement(ReadReceiptIndicator.A,{mid:normalizedMessage._id,unread:normalizedMessage.unread}))},room_RoomMessageContent=(0,react.memo)(RoomMessageContent);RoomMessageContent.__docgenInfo={description:"",methods:[],displayName:"RoomMessageContent",props:{message:{required:!0,tsType:{name:"IMessage"},description:""},unread:{required:!0,tsType:{name:"boolean"},description:""},mention:{required:!0,tsType:{name:"boolean"},description:""},all:{required:!0,tsType:{name:"boolean"},description:""},searchText:{required:!1,tsType:{name:"string"},description:""}}};var RoomMessage_excluded=["message","showUserAvatar","sequential","all","mention","unread","context","ignoredUser","searchText"];function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var RoomMessage=function RoomMessage(_ref){var message=_ref.message,showUserAvatar=_ref.showUserAvatar,sequential=_ref.sequential,all=_ref.all,mention=_ref.mention,unread=_ref.unread,context=_ref.context,ignoredUser=_ref.ignoredUser,searchText=_ref.searchText,props=function RoomMessage_objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function RoomMessage_objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_ref,RoomMessage_excluded),t=(0,ui_contexts_dist.useTranslation)(),uid=(0,ui_contexts_dist.useUserId)(),editing=(0,MessageHighlightContext.B)(message._id),_useToggle2=_slicedToArray((0,index_module.useToggle)(!1),2),displayIgnoredMessage=_useToggle2[0],toggleDisplayIgnoredMessage=_useToggle2[1],ignored=(ignoredUser||message.ignored)&&!displayIgnoredMessage,_useUserCard=(0,UserCardContext.P)(),openUserCard=_useUserCard.openUserCard,triggerProps=_useUserCard.triggerProps,selecting=(0,SelectedMessagesContext.IV)(),toggleSelected=(0,SelectedMessagesContext.GS)(message._id),selected=(0,SelectedMessagesContext.qA)(message._id);(0,SelectedMessagesContext.MS)();var messageRef=(0,useJumpToMessage._)(message._id);return react.createElement(fuselage.Message,_extends({ref:messageRef,id:message._id,role:"listitem","aria-roledescription":t(sequential?"sequential_message":"message"),tabIndex:0,"aria-labelledby":"".concat(message._id,"-displayName ").concat(message._id,"-time ").concat(message._id,"-content ").concat(message._id,"-read-status"),onClick:selecting?toggleSelected:void 0,isSelected:selected,isEditing:editing,isPending:message.temp,sequential:sequential,"data-qa-editing":editing,"data-qa-selected":selected,"data-id":message._id,"data-mid":message._id,"data-unread":unread,"data-sequential":sequential,"data-own":message.u._id===uid,"data-qa-type":"message","aria-busy":message.temp},props),react.createElement(fuselage.MessageLeftContainer,null,!sequential&&message.u.username&&!selecting&&showUserAvatar&&react.createElement(dist.Tx,_extends({emoji:message.emoji?react.createElement(Emoji.A,{emojiHandle:message.emoji,fillContainer:!0}):void 0,avatarUrl:message.avatar,username:message.u.username,size:"x36",onClick:function onClick(e){return openUserCard(e,message.u.username)},style:{cursor:"pointer"},role:"button"},triggerProps)),selecting&&react.createElement(fuselage.CheckBox,{checked:selected,onChange:toggleSelected}),sequential&&react.createElement(StatusIndicators.A,{message:message})),react.createElement(fuselage.MessageContainer,null,!sequential&&react.createElement(MessageHeader.A,{message:message}),ignored?react.createElement(IgnoredContent.A,{onShowMessageIgnored:toggleDisplayIgnoredMessage}):react.createElement(room_RoomMessageContent,{message:message,unread:unread,mention:mention,all:all,searchText:searchText})),!message.private&&react.createElement(MessageToolbarHolder.A,{message:message,context:context}))},variants_RoomMessage=(0,react.memo)(RoomMessage);RoomMessage.__docgenInfo={description:"",methods:[],displayName:"RoomMessage",props:{message:{required:!0,tsType:{name:"intersection",raw:"IMessage & { ignored?: boolean }",elements:[{name:"IMessage"},{name:"signature",type:"object",raw:"{ ignored?: boolean }",signature:{properties:[{key:"ignored",value:{name:"boolean",required:!1}}]}}]},description:""},showUserAvatar:{required:!0,tsType:{name:"boolean"},description:""},sequential:{required:!0,tsType:{name:"boolean"},description:""},unread:{required:!0,tsType:{name:"boolean"},description:""},mention:{required:!0,tsType:{name:"boolean"},description:""},all:{required:!0,tsType:{name:"boolean"},description:""},context:{required:!1,tsType:{name:"union",raw:"| 'message'\n| 'threads'\n| 'message-mobile'\n| 'pinned'\n| 'direct'\n| 'starred'\n| 'mentions'\n| 'federated'\n| 'videoconf'\n| 'search'\n| 'videoconf-threads'",elements:[{name:"literal",value:"'message'"},{name:"literal",value:"'threads'"},{name:"literal",value:"'message-mobile'"},{name:"literal",value:"'pinned'"},{name:"literal",value:"'direct'"},{name:"literal",value:"'starred'"},{name:"literal",value:"'mentions'"},{name:"literal",value:"'federated'"},{name:"literal",value:"'videoconf'"},{name:"literal",value:"'search'"},{name:"literal",value:"'videoconf-threads'"}]},description:""},ignoredUser:{required:!1,tsType:{name:"boolean"},description:""},searchText:{required:!1,tsType:{name:"string"},description:""}}}}}]);