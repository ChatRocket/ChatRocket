/*! For license information please see 6395.b75ecdd1.iframe.bundle.js.LICENSE.txt */
(self.webpackChunk_rocket_chat_meteor=self.webpackChunk_rocket_chat_meteor||[]).push([[6395],{"./client/views/room/modals/FileUploadModal/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{A:function(){return FileUploadModal_FileUploadModal}});var fuselage=__webpack_require__("./node_modules/@rocket.chat/fuselage/index.js"),index_module=__webpack_require__("./node_modules/@rocket.chat/fuselage-hooks/dist/index.module.js"),dist=__webpack_require__("../../packages/ui-contexts/dist/index.js"),filesize_min=__webpack_require__("./node_modules/filesize/lib/filesize.min.js"),filesize_min_default=__webpack_require__.n(filesize_min),react=__webpack_require__("./node_modules/react/index.js"),isIE11=__webpack_require__("./client/lib/utils/isIE11.ts"),GenericPreview=function GenericPreview(_ref){var file=_ref.file;return react.createElement(fuselage.Box,{display:"flex",alignItems:"center",w:"full",fontScale:"h4"},react.createElement(fuselage.Icon,{name:"file",size:"x24",mis:-2,mie:4}),"".concat(file.name," - ").concat(function formatBytes(bytes,decimals){if(0===bytes)return"0 Bytes";var dm=decimals||0,i=Math.floor(Math.log(bytes)/Math.log(1024));return"".concat(parseFloat((bytes/Math.pow(1024,i)).toFixed(dm))," ").concat(["Bytes","KB","MB","GB","TB","PB"][i])}(file.size,2)))},FileUploadModal_GenericPreview=GenericPreview;GenericPreview.__docgenInfo={description:"",methods:[],displayName:"GenericPreview",props:{file:{required:!0,tsType:{name:"File"},description:""}}};var userAgentMIMETypeFallback=__webpack_require__("./client/lib/utils/userAgentMIMETypeFallback.ts"),PreviewSkeleton=function PreviewSkeleton(){return react.createElement(fuselage.Skeleton,{variant:"rect",w:"full",h:"x200"})},FileUploadModal_PreviewSkeleton=PreviewSkeleton;function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}PreviewSkeleton.__docgenInfo={description:"",methods:[],displayName:"PreviewSkeleton"};var ImagePreview=function ImagePreview(_ref){var url=_ref.url,file=_ref.file,_useState2=_slicedToArray((0,react.useState)(!1),2),error=_useState2[0],setError=_useState2[1],_useState4=_slicedToArray((0,react.useState)(!0),2),loading=_useState4[0],setLoading=_useState4[1];return error?react.createElement(FileUploadModal_GenericPreview,{file:file}):react.createElement(react.Fragment,null,loading&&react.createElement(FileUploadModal_PreviewSkeleton,null),react.createElement(fuselage.Box,{is:"img",src:url,maxWidth:"full",style:{objectFit:"contain"},onLoad:function handleLoad(){return setLoading(!1)},onError:function handleError(){setLoading(!1),setError(!0)},display:loading?"none":"initial"}))},FileUploadModal_ImagePreview=ImagePreview;function MediaPreview_slicedToArray(r,e){return function MediaPreview_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function MediaPreview_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function MediaPreview_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return MediaPreview_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?MediaPreview_arrayLikeToArray(r,a):void 0}}(r,e)||function MediaPreview_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function MediaPreview_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}ImagePreview.__docgenInfo={description:"",methods:[],displayName:"ImagePreview",props:{url:{required:!0,tsType:{name:"string"},description:""},file:{required:!0,tsType:{name:"File"},description:""}}};var useFileAsDataURL=function useFileAsDataURL(file){var _useState2=MediaPreview_slicedToArray((0,react.useState)(!1),2),loaded=_useState2[0],setLoaded=_useState2[1],_useState4=MediaPreview_slicedToArray((0,react.useState)(null),2),url=_useState4[0],setUrl=_useState4[1];return(0,react.useEffect)((function(){setLoaded(!1),function readFileAsDataURL(file,callback){var reader=new FileReader;reader.onload=function(e){var _e$target;return callback((null==e||null===(_e$target=e.target)||void 0===_e$target?void 0:_e$target.result)||null)},reader.readAsDataURL(file)}(file,(function(url){setUrl(url),setLoaded(!0)}))}),[file]),[loaded,url]},MediaPreview=function MediaPreview(_ref){var file=_ref.file,fileType=_ref.fileType,_useFileAsDataURL2=MediaPreview_slicedToArray(useFileAsDataURL(file),2),loaded=_useFileAsDataURL2[0],url=_useFileAsDataURL2[1],t=(0,dist.useTranslation)();if(!loaded)return react.createElement(FileUploadModal_PreviewSkeleton,null);if("string"!=typeof url)return react.createElement(fuselage.Box,{display:"flex",alignItems:"center",w:"full"},react.createElement(fuselage.Icon,{name:"image",size:"x24",mie:4}),t("FileUpload_Cannot_preview_file"));if(fileType===FilePreviewType.IMAGE)return react.createElement(FileUploadModal_ImagePreview,{url:url,file:file});if(fileType===FilePreviewType.VIDEO)return react.createElement(fuselage.Box,{is:"video",w:"full",controls:!0},react.createElement("source",{src:url,type:(0,userAgentMIMETypeFallback.z)(file.type)}),t("Browser_does_not_support_video_element"));if(fileType===FilePreviewType.AUDIO)return react.createElement(fuselage.AudioPlayer,{src:url});throw new Error("Wrong props provided for MediaPreview")},FileUploadModal_MediaPreview=(0,react.memo)(MediaPreview);MediaPreview.__docgenInfo={description:"",methods:[],displayName:"MediaPreview",props:{file:{required:!0,tsType:{name:"File"},description:""},fileType:{required:!0,tsType:{name:"FilePreviewType"},description:""}}};var FilePreviewType=function(FilePreviewType){return FilePreviewType.IMAGE="image",FilePreviewType.AUDIO="audio",FilePreviewType.VIDEO="video",FilePreviewType}({}),FilePreview=function FilePreview(_ref){var file=_ref.file,fileType=function getFileType(fileType){if(fileType)for(var _i=0,_Object$values=Object.values(FilePreviewType);_i<_Object$values.length;_i++){var type=_Object$values[_i];if(fileType.indexOf(type)>-1)return type}}(file.type);return function shouldShowMediaPreview(file,fileType){return!(!fileType||isIE11.l||file.size>1e7||!Object.values(FilePreviewType).includes(fileType))}(file,fileType)?react.createElement(FileUploadModal_MediaPreview,{file:file,fileType:fileType}):react.createElement(FileUploadModal_GenericPreview,{file:file})},FileUploadModal_FilePreview=FilePreview;function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}function FileUploadModal_slicedToArray(r,e){return function FileUploadModal_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function FileUploadModal_iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||function FileUploadModal_unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return FileUploadModal_arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?FileUploadModal_arrayLikeToArray(r,a):void 0}}(r,e)||function FileUploadModal_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function FileUploadModal_arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}FilePreview.__docgenInfo={description:"",methods:[],displayName:"FilePreview",props:{file:{required:!0,tsType:{name:"File"},description:""}}};var FileUploadModal=function FileUploadModal(_ref){var onClose=_ref.onClose,file=_ref.file,fileName=_ref.fileName,fileDescription=_ref.fileDescription,onSubmit=_ref.onSubmit,invalidContentType=_ref.invalidContentType,_ref$showDescription=_ref.showDescription,showDescription=void 0===_ref$showDescription||_ref$showDescription,_useState2=FileUploadModal_slicedToArray((0,react.useState)(fileName),2),name=_useState2[0],setName=_useState2[1],_useState4=FileUploadModal_slicedToArray((0,react.useState)(fileDescription||""),2),description=_useState4[0],setDescription=_useState4[1],t=(0,dist.useTranslation)(),dispatchToastMessage=(0,dist.useToastMessageDispatch)(),maxFileSize=(0,dist.useSetting)("FileUpload_MaxFileSize"),ref=(0,index_module.useAutoFocus)(),handleSubmit=function handleSubmit(e){return e.preventDefault(),name?maxFileSize>-1&&(file.size||0)>maxFileSize?(onClose(),dispatchToastMessage({type:"error",message:t("File_exceeds_allowed_size_of_bytes",{size:filesize_min_default()(maxFileSize)})})):void onSubmit(name,description):dispatchToastMessage({type:"error",message:t("Required_field",{field:t("Upload_file_name")})})};return(0,react.useEffect)((function(){if(invalidContentType)return dispatchToastMessage({type:"error",message:t("FileUpload_MediaType_NotAccepted__type__",{type:file.type})}),void onClose();0===file.size&&(dispatchToastMessage({type:"error",message:t("FileUpload_File_Empty")}),onClose())}),[file,dispatchToastMessage,invalidContentType,t,onClose]),react.createElement(fuselage.Modal,{wrapperFunction:function wrapperFunction(props){return react.createElement(fuselage.Box,_extends({is:"form",onSubmit:handleSubmit},props))}},react.createElement(fuselage.Box,{display:"flex",flexDirection:"column",height:"100%"},react.createElement(fuselage.Modal.Header,null,react.createElement(fuselage.Modal.Title,null,t("FileUpload")),react.createElement(fuselage.Modal.Close,{onClick:onClose})),react.createElement(fuselage.Modal.Content,null,react.createElement(fuselage.Box,{display:"flex",maxHeight:"x360",w:"full",justifyContent:"center",alignContent:"center",mbe:16},react.createElement(FileUploadModal_FilePreview,{file:file})),react.createElement(fuselage.FieldGroup,null,react.createElement(fuselage.Field,null,react.createElement(fuselage.FieldLabel,null,t("Upload_file_name")),react.createElement(fuselage.FieldRow,null,react.createElement(fuselage.TextInput,{value:name,onChange:function handleName(e){setName(e.currentTarget.value)}})),!name&&react.createElement(fuselage.FieldError,null,t("Required_field",{field:t("Upload_file_name")}))),showDescription&&react.createElement(fuselage.Field,null,react.createElement(fuselage.FieldLabel,null,t("Upload_file_description")),react.createElement(fuselage.FieldRow,null,react.createElement(fuselage.TextInput,{value:description,onChange:function handleDescription(e){setDescription(e.currentTarget.value)},placeholder:t("Description"),ref:ref}))))),react.createElement(fuselage.Modal.Footer,null,react.createElement(fuselage.Modal.FooterControllers,null,react.createElement(fuselage.Button,{secondary:!0,onClick:onClose},t("Cancel")),react.createElement(fuselage.Button,{primary:!0,type:"submit"},t("Send"))))))},FileUploadModal_FileUploadModal=(0,react.memo)(FileUploadModal);FileUploadModal.__docgenInfo={description:"",methods:[],displayName:"FileUploadModal",props:{onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onSubmit:{required:!0,tsType:{name:"signature",type:"function",raw:"(name: string, description?: string) => void",signature:{arguments:[{type:{name:"string"},name:"name"},{type:{name:"string"},name:"description"}],return:{name:"void"}}},description:""},file:{required:!0,tsType:{name:"File"},description:""},fileName:{required:!0,tsType:{name:"string"},description:""},fileDescription:{required:!1,tsType:{name:"string"},description:""},invalidContentType:{required:!0,tsType:{name:"boolean"},description:""},showDescription:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}}}}},"./node_modules/filesize/lib/filesize.min.js":function(module){module.exports=function(){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(t)}var t="array",o="bits",e="byte",n="bytes",r="",b="exponent",l="function",a="iec",d="Invalid number",f="Invalid rounding method",u="jedec",s="object",c=".",p="round",y="kbit",m="string",v={symbol:{iec:{bits:["bit","Kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["bit","Kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},fullform:{iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]}};function g(g){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},B=h.bits,M=void 0!==B&&B,S=h.pad,T=void 0!==S&&S,w=h.base,x=void 0===w?-1:w,E=h.round,j=void 0===E?2:E,N=h.locale,P=void 0===N?r:N,k=h.localeOptions,G=void 0===k?{}:k,K=h.separator,Y=void 0===K?r:K,Z=h.spacer,z=void 0===Z?" ":Z,I=h.symbols,L=void 0===I?{}:I,O=h.standard,q=void 0===O?r:O,A=h.output,C=void 0===A?m:A,D=h.fullform,F=void 0!==D&&D,H=h.fullforms,J=void 0===H?[]:H,Q=h.exponent,R=void 0===Q?-1:Q,U=h.roundingMethod,V=void 0===U?p:U,W=h.precision,X=void 0===W?0:W,$=R,_=Number(g),ii=[],ti=0,oi=r;-1===x&&0===q.length?(x=10,q=u):-1===x&&q.length>0?x=(q=q===a?a:u)===a?2:10:q=10==(x=2===x?2:10)||q===u?u:a;var ei=10===x?1e3:1024,ni=!0===F,ri=_<0,bi=Math[V];if(isNaN(g))throw new TypeError(d);if(i(bi)!==l)throw new TypeError(f);if(ri&&(_=-_),(-1===$||isNaN($))&&($=Math.floor(Math.log(_)/Math.log(ei)))<0&&($=0),$>8&&(X>0&&(X+=8-$),$=8),C===b)return $;if(0===_)ii[0]=0,oi=ii[1]=v.symbol[q][M?o:n][$];else{ti=_/(2===x?Math.pow(2,10*$):Math.pow(1e3,$)),M&&(ti*=8)>=ei&&$<8&&(ti/=ei,$++);var li=Math.pow(10,$>0?j:0);ii[0]=bi(ti*li)/li,ii[0]===ei&&$<8&&-1===R&&(ii[0]=1,$++),oi=ii[1]=10===x&&1===$?M?y:"kB":v.symbol[q][M?o:n][$]}if(ri&&(ii[0]=-ii[0]),X>0&&(ii[0]=ii[0].toPrecision(X)),ii[1]=L[ii[1]]||ii[1],!0===P?ii[0]=ii[0].toLocaleString():P.length>0?ii[0]=ii[0].toLocaleString(P,G):Y.length>0&&(ii[0]=ii[0].toString().replace(c,Y)),T&&!1===Number.isInteger(ii[0])&&j>0){var ai=Y||c,di=ii[0].toString().split(ai),fi=di[1]||r,ui=fi.length,si=j-ui;ii[0]="".concat(di[0]).concat(ai).concat(fi.padEnd(ui+si,"0"))}return ni&&(ii[1]=J[$]?J[$]:v.fullform[q][$]+(M?"bit":e)+(1===ii[0]?r:"s")),C===t?ii:C===s?{value:ii[0],symbol:ii[1],exponent:$,unit:oi}:ii.join(z)}return g.partial=function(i){return function(t){return g(t,i)}},g}()}}]);