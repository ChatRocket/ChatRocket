{"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":15},"end":{"line":6,"column":31}},"3":{"start":{"line":7,"column":19},"end":{"line":7,"column":41}},"4":{"start":{"line":8,"column":23},"end":{"line":8,"column":59}},"5":{"start":{"line":9,"column":0},"end":{"line":28,"column":3}},"6":{"start":{"line":10,"column":4},"end":{"line":15,"column":7}},"7":{"start":{"line":11,"column":8},"end":{"line":11,"column":96}},"8":{"start":{"line":11,"column":45},"end":{"line":11,"column":54}},"9":{"start":{"line":12,"column":23},"end":{"line":12,"column":67}},"10":{"start":{"line":13,"column":8},"end":{"line":13,"column":45}},"11":{"start":{"line":14,"column":8},"end":{"line":14,"column":49}},"12":{"start":{"line":16,"column":4},"end":{"line":21,"column":7}},"13":{"start":{"line":17,"column":8},"end":{"line":17,"column":92}},"14":{"start":{"line":17,"column":45},"end":{"line":17,"column":50}},"15":{"start":{"line":18,"column":23},"end":{"line":18,"column":67}},"16":{"start":{"line":19,"column":8},"end":{"line":19,"column":46}},"17":{"start":{"line":20,"column":8},"end":{"line":20,"column":49}},"18":{"start":{"line":22,"column":4},"end":{"line":27,"column":7}},"19":{"start":{"line":23,"column":8},"end":{"line":23,"column":57}},"20":{"start":{"line":23,"column":48},"end":{"line":23,"column":55}},"21":{"start":{"line":24,"column":8},"end":{"line":24,"column":57}},"22":{"start":{"line":24,"column":48},"end":{"line":24,"column":55}},"23":{"start":{"line":25,"column":8},"end":{"line":25,"column":85}},"24":{"start":{"line":26,"column":8},"end":{"line":26,"column":85}},"25":{"start":{"line":29,"column":0},"end":{"line":49,"column":3}},"26":{"start":{"line":30,"column":4},"end":{"line":35,"column":7}},"27":{"start":{"line":31,"column":21},"end":{"line":31,"column":60}},"28":{"start":{"line":32,"column":8},"end":{"line":32,"column":72}},"29":{"start":{"line":32,"column":21},"end":{"line":32,"column":30}},"30":{"start":{"line":33,"column":23},"end":{"line":33,"column":43}},"31":{"start":{"line":34,"column":8},"end":{"line":34,"column":45}},"32":{"start":{"line":36,"column":4},"end":{"line":41,"column":7}},"33":{"start":{"line":37,"column":21},"end":{"line":37,"column":60}},"34":{"start":{"line":38,"column":8},"end":{"line":38,"column":68}},"35":{"start":{"line":38,"column":21},"end":{"line":38,"column":26}},"36":{"start":{"line":39,"column":23},"end":{"line":39,"column":43}},"37":{"start":{"line":40,"column":8},"end":{"line":40,"column":46}},"38":{"start":{"line":42,"column":4},"end":{"line":48,"column":7}},"39":{"start":{"line":43,"column":21},"end":{"line":43,"column":60}},"40":{"start":{"line":44,"column":8},"end":{"line":44,"column":33}},"41":{"start":{"line":44,"column":24},"end":{"line":44,"column":31}},"42":{"start":{"line":45,"column":8},"end":{"line":45,"column":33}},"43":{"start":{"line":45,"column":24},"end":{"line":45,"column":31}},"44":{"start":{"line":46,"column":8},"end":{"line":46,"column":61}},"45":{"start":{"line":47,"column":8},"end":{"line":47,"column":61}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":9,"column":41},"end":{"line":9,"column":42}},"loc":{"start":{"line":9,"column":45},"end":{"line":28,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":10,"column":90},"end":{"line":10,"column":91}},"loc":{"start":{"line":10,"column":100},"end":{"line":15,"column":5}},"line":10},"2":{"name":"(anonymous_2)","decl":{"start":{"line":11,"column":41},"end":{"line":11,"column":42}},"loc":{"start":{"line":11,"column":45},"end":{"line":11,"column":54}},"line":11},"3":{"name":"(anonymous_3)","decl":{"start":{"line":16,"column":71},"end":{"line":16,"column":72}},"loc":{"start":{"line":16,"column":81},"end":{"line":21,"column":5}},"line":16},"4":{"name":"(anonymous_4)","decl":{"start":{"line":17,"column":41},"end":{"line":17,"column":42}},"loc":{"start":{"line":17,"column":45},"end":{"line":17,"column":50}},"line":17},"5":{"name":"(anonymous_5)","decl":{"start":{"line":22,"column":77},"end":{"line":22,"column":78}},"loc":{"start":{"line":22,"column":87},"end":{"line":27,"column":5}},"line":22},"6":{"name":"(anonymous_6)","decl":{"start":{"line":23,"column":41},"end":{"line":23,"column":42}},"loc":{"start":{"line":23,"column":48},"end":{"line":23,"column":55}},"line":23},"7":{"name":"(anonymous_7)","decl":{"start":{"line":24,"column":41},"end":{"line":24,"column":42}},"loc":{"start":{"line":24,"column":48},"end":{"line":24,"column":55}},"line":24},"8":{"name":"(anonymous_8)","decl":{"start":{"line":29,"column":34},"end":{"line":29,"column":35}},"loc":{"start":{"line":29,"column":38},"end":{"line":49,"column":1}},"line":29},"9":{"name":"(anonymous_9)","decl":{"start":{"line":30,"column":90},"end":{"line":30,"column":91}},"loc":{"start":{"line":30,"column":100},"end":{"line":35,"column":5}},"line":30},"10":{"name":"(anonymous_10)","decl":{"start":{"line":32,"column":17},"end":{"line":32,"column":18}},"loc":{"start":{"line":32,"column":21},"end":{"line":32,"column":30}},"line":32},"11":{"name":"(anonymous_11)","decl":{"start":{"line":36,"column":71},"end":{"line":36,"column":72}},"loc":{"start":{"line":36,"column":81},"end":{"line":41,"column":5}},"line":36},"12":{"name":"(anonymous_12)","decl":{"start":{"line":38,"column":17},"end":{"line":38,"column":18}},"loc":{"start":{"line":38,"column":21},"end":{"line":38,"column":26}},"line":38},"13":{"name":"(anonymous_13)","decl":{"start":{"line":42,"column":77},"end":{"line":42,"column":78}},"loc":{"start":{"line":42,"column":87},"end":{"line":48,"column":5}},"line":42},"14":{"name":"(anonymous_14)","decl":{"start":{"line":44,"column":17},"end":{"line":44,"column":18}},"loc":{"start":{"line":44,"column":24},"end":{"line":44,"column":31}},"line":44},"15":{"name":"(anonymous_15)","decl":{"start":{"line":45,"column":17},"end":{"line":45,"column":18}},"loc":{"start":{"line":45,"column":24},"end":{"line":45,"column":31}},"line":45}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":2,"21":1,"22":2,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":2,"42":1,"43":2,"44":1,"45":1},"f":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":2,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":2,"15":2},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks.spec.ts"],"sourcesContent":["import { expect } from 'chai';\nimport { describe, it } from 'mocha';\n\nimport { callbacks } from './callbacks';\nimport { Callbacks } from './callbacks/callbacksBase';\n\ndescribe('callbacks legacy', () => {\n\tit(\"if the callback doesn't return any value should return the original\", async () => {\n\t\tcallbacks.add('test', () => undefined, callbacks.priority.LOW, '1');\n\n\t\tconst result = await callbacks.run('test', true);\n\n\t\texpect(result).to.be.true;\n\n\t\tcallbacks.remove('test', '1');\n\t});\n\n\tit('should return the value returned by the callback', async () => {\n\t\tcallbacks.add('test', () => false, callbacks.priority.LOW, '1');\n\n\t\tconst result = await callbacks.run('test', true);\n\n\t\texpect(result).to.be.false;\n\n\t\tcallbacks.remove('test', '1');\n\t});\n\n\tit('should accumulate the values returned by the callbacks', async () => {\n\t\tcallbacks.add('test', (old: number) => old * 5);\n\n\t\tcallbacks.add('test', (old: number) => old * 2);\n\n\t\texpect(await callbacks.run('test', 3)).to.be.equal(30);\n\n\t\texpect(await callbacks.run('test', 2)).to.be.equal(20);\n\t});\n});\n\ndescribe('callbacks', () => {\n\tit(\"if the callback doesn't return any value should return the original\", async () => {\n\t\tconst test = Callbacks.create<(data: boolean) => boolean>('test');\n\n\t\ttest.add(() => undefined, callbacks.priority.LOW, '1');\n\n\t\tconst result = await test.run(true);\n\n\t\texpect(result).to.be.true;\n\t});\n\n\tit('should return the value returned by the callback', async () => {\n\t\tconst test = Callbacks.create<(data: boolean) => boolean>('test');\n\n\t\ttest.add(() => false, callbacks.priority.LOW, '1');\n\n\t\tconst result = await test.run(true);\n\n\t\texpect(result).to.be.false;\n\t});\n\n\tit('should accumulate the values returned by the callbacks', async () => {\n\t\tconst test = Callbacks.create<(data: number) => number>('test');\n\n\t\ttest.add((old) => old * 5);\n\n\t\ttest.add((old) => old * 2);\n\n\t\texpect(await test.run(3)).to.be.equal(30);\n\n\t\texpect(await test.run(2)).to.be.equal(20);\n\t});\n});\n"],"names":["describe","it","callbacks","add","undefined","priority","LOW","result","run","expect","to","be","true","remove","false","old","equal","test","Callbacks","create"],"mappings":";;;;sBAAuB;uBACM;2BAEH;+BACA;AAE1BA,IAAAA,eAAQ,EAAC,oBAAoB;IAC5BC,IAAAA,SAAE,EAAC,uEAAuE;QACzEC,oBAAS,CAACC,GAAG,CAAC,QAAQ,IAAMC,WAAWF,oBAAS,CAACG,QAAQ,CAACC,GAAG,EAAE;QAE/D,MAAMC,SAAS,MAAML,oBAAS,CAACM,GAAG,CAAC,QAAQ;QAE3CC,IAAAA,YAAM,EAACF,QAAQG,EAAE,CAACC,EAAE,CAACC,IAAI;QAEzBV,oBAAS,CAACW,MAAM,CAAC,QAAQ;IAC1B;IAEAZ,IAAAA,SAAE,EAAC,oDAAoD;QACtDC,oBAAS,CAACC,GAAG,CAAC,QAAQ,IAAM,OAAOD,oBAAS,CAACG,QAAQ,CAACC,GAAG,EAAE;QAE3D,MAAMC,SAAS,MAAML,oBAAS,CAACM,GAAG,CAAC,QAAQ;QAE3CC,IAAAA,YAAM,EAACF,QAAQG,EAAE,CAACC,EAAE,CAACG,KAAK;QAE1BZ,oBAAS,CAACW,MAAM,CAAC,QAAQ;IAC1B;IAEAZ,IAAAA,SAAE,EAAC,0DAA0D;QAC5DC,oBAAS,CAACC,GAAG,CAAC,QAAQ,CAACY,MAAgBA,MAAM;QAE7Cb,oBAAS,CAACC,GAAG,CAAC,QAAQ,CAACY,MAAgBA,MAAM;QAE7CN,IAAAA,YAAM,EAAC,MAAMP,oBAAS,CAACM,GAAG,CAAC,QAAQ,IAAIE,EAAE,CAACC,EAAE,CAACK,KAAK,CAAC;QAEnDP,IAAAA,YAAM,EAAC,MAAMP,oBAAS,CAACM,GAAG,CAAC,QAAQ,IAAIE,EAAE,CAACC,EAAE,CAACK,KAAK,CAAC;IACpD;AACD;AAEAhB,IAAAA,eAAQ,EAAC,aAAa;IACrBC,IAAAA,SAAE,EAAC,uEAAuE;QACzE,MAAMgB,OAAOC,wBAAS,CAACC,MAAM,CAA6B;QAE1DF,KAAKd,GAAG,CAAC,IAAMC,WAAWF,oBAAS,CAACG,QAAQ,CAACC,GAAG,EAAE;QAElD,MAAMC,SAAS,MAAMU,KAAKT,GAAG,CAAC;QAE9BC,IAAAA,YAAM,EAACF,QAAQG,EAAE,CAACC,EAAE,CAACC,IAAI;IAC1B;IAEAX,IAAAA,SAAE,EAAC,oDAAoD;QACtD,MAAMgB,OAAOC,wBAAS,CAACC,MAAM,CAA6B;QAE1DF,KAAKd,GAAG,CAAC,IAAM,OAAOD,oBAAS,CAACG,QAAQ,CAACC,GAAG,EAAE;QAE9C,MAAMC,SAAS,MAAMU,KAAKT,GAAG,CAAC;QAE9BC,IAAAA,YAAM,EAACF,QAAQG,EAAE,CAACC,EAAE,CAACG,KAAK;IAC3B;IAEAb,IAAAA,SAAE,EAAC,0DAA0D;QAC5D,MAAMgB,OAAOC,wBAAS,CAACC,MAAM,CAA2B;QAExDF,KAAKd,GAAG,CAAC,CAACY,MAAQA,MAAM;QAExBE,KAAKd,GAAG,CAAC,CAACY,MAAQA,MAAM;QAExBN,IAAAA,YAAM,EAAC,MAAMQ,KAAKT,GAAG,CAAC,IAAIE,EAAE,CAACC,EAAE,CAACK,KAAK,CAAC;QAEtCP,IAAAA,YAAM,EAAC,MAAMQ,KAAKT,GAAG,CAAC,IAAIE,EAAE,CAACC,EAAE,CAACK,KAAK,CAAC;IACvC;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2dab0d0dd9f152d3f787dcee68b52c0cc25ab740","contentHash":"a2c23b0a87473f1deb71f5b0b7bfdd282b9e0eae1908455b2499a7ee1cc36356"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":25}},"3":{"start":{"line":11,"column":23},"end":{"line":11,"column":59}},"4":{"start":{"line":12,"column":18},"end":{"line":12,"column":48}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7}},"branchMap":{},"s":{"0":1,"1":1,"2":40,"3":1,"4":1},"f":{"0":40},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks.ts"],"sourcesContent":["import type {\n\tIMessage,\n\tIRoom,\n\tIUser,\n\tILivechatDepartmentRecord,\n\tILivechatAgent,\n\tOmnichannelAgentStatus,\n\tILivechatInquiryRecord,\n\tILivechatVisitor,\n\tVideoConference,\n\tOEmbedMeta,\n\tOEmbedUrlContent,\n\tUsername,\n\tIOmnichannelRoom,\n\tILivechatTag,\n\tSelectedAgent,\n\tInquiryWithAgentInfo,\n\tILivechatTagRecord,\n\tTransferData,\n\tAtLeast,\n\tUserStatus,\n\tILivechatDepartment,\n\tMessageMention,\n\tIOmnichannelRoomInfo,\n\tIOmnichannelInquiryExtraData,\n\tIOmnichannelRoomExtraData,\n} from '@rocket.chat/core-typings';\nimport type { Updater } from '@rocket.chat/models';\nimport type { FilterOperators } from 'mongodb';\n\nimport type { ILoginAttempt } from '../app/authentication/server/ILoginAttempt';\nimport type { IBusinessHourBehavior } from '../app/livechat/server/business-hour/AbstractBusinessHour';\nimport type { CloseRoomParams } from '../app/livechat/server/lib/localTypes';\nimport { Callbacks } from './callbacks/callbacksBase';\n\n/**\n * Callbacks returning void, like event listeners.\n *\n * TODO: move those to event-based systems\n */\n// eslint-disable-next-line @typescript-eslint/naming-convention\ninterface EventLikeCallbackSignatures {\n\t'afterActivateUser': (user: IUser) => void;\n\t'afterCreateChannel': (owner: IUser, room: IRoom) => void;\n\t'afterCreatePrivateGroup': (owner: IUser, room: IRoom) => void;\n\t'afterDeactivateUser': (user: IUser) => void;\n\t'afterDeleteMessage': (message: IMessage, room: IRoom) => void;\n\t'workspaceLicenseChanged': (license: string) => void;\n\t'workspaceLicenseRemoved': () => void;\n\t'afterReadMessages': (rid: IRoom['_id'], params: { uid: IUser['_id']; lastSeen?: Date; tmid?: IMessage['_id'] }) => void;\n\t'beforeReadMessages': (rid: IRoom['_id'], uid: IUser['_id']) => void;\n\t'afterDeleteUser': (user: IUser) => void;\n\t'afterFileUpload': (params: { user: IUser; room: IRoom; message: IMessage }) => void;\n\t'afterRoomNameChange': (params: { rid: string; name: string; oldName: string }) => void;\n\t'afterSaveMessage': (message: IMessage, params: { room: IRoom; uid?: string; roomUpdater?: Updater<IRoom> }) => void;\n\t'afterOmnichannelSaveMessage': (message: IMessage, constant: { room: IOmnichannelRoom; roomUpdater: Updater<IOmnichannelRoom> }) => void;\n\t'livechat.removeAgentDepartment': (params: { departmentId: ILivechatDepartmentRecord['_id']; agentsId: ILivechatAgent['_id'][] }) => void;\n\t'livechat.saveAgentDepartment': (params: { departmentId: ILivechatDepartmentRecord['_id']; agentsId: ILivechatAgent['_id'][] }) => void;\n\t'livechat.closeRoom': (params: { room: IOmnichannelRoom; options: CloseRoomParams['options'] }) => void;\n\t'livechat:afterReturnRoomAsInquiry': (params: { room: IRoom }) => void;\n\t'livechat.setUserStatusLivechat': (params: { userId: IUser['_id']; status: OmnichannelAgentStatus }) => void;\n\t'livechat.agentStatusChanged': (params: { userId: IUser['_id']; status: UserStatus }) => void;\n\t'livechat.onNewAgentCreated': (agentId: string) => void;\n\t'livechat.afterTakeInquiry': (\n\t\tparams: { inquiry: InquiryWithAgentInfo; room: IOmnichannelRoom },\n\t\tagent: { agentId: string; username: string },\n\t) => void;\n\t'livechat.afterAgentRemoved': (params: { agent: Pick<IUser, '_id' | 'username'> }) => void;\n\t'afterAddedToRoom': (params: { user: IUser; inviter?: IUser }, room: IRoom) => void;\n\t'beforeAddedToRoom': (params: {\n\t\tuser: AtLeast<IUser, '_id' | 'federated' | 'roles'>;\n\t\tinviter: AtLeast<IUser, '_id' | 'username'>;\n\t}) => void;\n\t'afterCreateDirectRoom': (params: IRoom, second: { members: IUser[]; creatorId: IUser['_id'] }) => void;\n\t'beforeDeleteRoom': (params: IRoom) => void;\n\t'beforeJoinDefaultChannels': (user: IUser) => void;\n\t'beforeCreateChannel': (owner: IUser, room: IRoom) => void;\n\t'afterCreateRoom': (owner: IUser, room: IRoom) => void;\n\t'onValidateLogin': (login: ILoginAttempt) => void;\n\t'federation.afterCreateFederatedRoom': (room: IRoom, second: { owner: IUser; originalMemberList: string[] }) => void;\n\t'beforeCreateDirectRoom': (members: IUser[]) => void;\n\t'federation.beforeCreateDirectMessage': (members: IUser[]) => void;\n\t'afterSetReaction': (message: IMessage, { user, reaction }: { user: IUser; reaction: string; shouldReact: boolean }) => void;\n\t'afterUnsetReaction': (\n\t\tmessage: IMessage,\n\t\t{ user, reaction }: { user: IUser; reaction: string; shouldReact: boolean; oldMessage: IMessage },\n\t) => void;\n\t'federation.beforeAddUserToARoom': (params: { user: IUser | string; inviter: IUser }, room: IRoom) => void;\n\t'federation.onAddUsersToARoom': (params: { invitees: IUser[] | Username[]; inviter: IUser }, room: IRoom) => void;\n\t'onJoinVideoConference': (callId: VideoConference['_id'], userId?: IUser['_id']) => Promise<void>;\n\t'usernameSet': () => void;\n\t'beforeJoinRoom': (user: IUser, room: IRoom) => void;\n\t'beforeMuteUser': (users: { mutedUser: IUser; fromUser: IUser }, room: IRoom) => void;\n\t'afterMuteUser': (users: { mutedUser: IUser; fromUser: IUser }, room: IRoom) => void;\n\t'beforeUnmuteUser': (users: { mutedUser: IUser; fromUser: IUser }, room: IRoom) => void;\n\t'afterUnmuteUser': (users: { mutedUser: IUser; fromUser: IUser }, room: IRoom) => void;\n\t'afterValidateLogin': (login: { user: IUser }) => void;\n\t'afterJoinRoom': (user: IUser, room: IRoom) => void;\n\t'livechat.afterDepartmentDisabled': (department: ILivechatDepartmentRecord) => void;\n\t'livechat.afterDepartmentArchived': (department: Pick<ILivechatDepartmentRecord, '_id' | 'businessHourId'>) => void;\n\t'beforeSaveUser': ({ user, oldUser }: { user: IUser; oldUser?: IUser }) => void;\n\t'afterSaveUser': ({ user, oldUser }: { user: IUser; oldUser?: IUser | null }) => void;\n\t'livechat.afterTagRemoved': (tag: ILivechatTagRecord) => void;\n\t'afterUserImport': (data: { inserted: IUser['_id'][]; updated: IUser['_id']; skipped: number; failed: number }) => void;\n}\n\n/**\n * Callbacks that are supposed to be composed like a chain.\n *\n * TODO: develop a middleware alternative and grant independence of execution order\n */\ntype ChainedCallbackSignatures = {\n\t'livechat.beforeRoom': (roomInfo: IOmnichannelRoomInfo, extraData?: IOmnichannelRoomExtraData) => Partial<IOmnichannelRoom>;\n\t'livechat.newRoom': (room: IOmnichannelRoom) => IOmnichannelRoom;\n\n\t'livechat.beforeForwardRoomToDepartment': <T extends { room: IOmnichannelRoom; transferData?: { department: { _id: string } } }>(\n\t\toptions: T,\n\t) => Promise<T>;\n\n\t'livechat.beforeRouteChat': (inquiry: ILivechatInquiryRecord, agent?: { agentId: string; username: string }) => ILivechatInquiryRecord;\n\t'livechat.checkDefaultAgentOnNewRoom': (agent: SelectedAgent, visitor?: ILivechatVisitor) => SelectedAgent | null;\n\n\t'livechat.onLoadForwardDepartmentRestrictions': (params: { departmentId: string }) => Record<string, unknown>;\n\n\t'livechat.saveInfo': (\n\t\tnewRoom: IOmnichannelRoom,\n\t\tprops: { user: Required<Pick<IUser, '_id' | 'username' | 'name'>>; oldRoom: IOmnichannelRoom },\n\t) => IOmnichannelRoom;\n\n\t'livechat.onCheckRoomApiParams': (params: Record<string, unknown>) => Record<string, unknown>;\n\n\t'livechat.onLoadConfigApi': (config: { room: IOmnichannelRoom }) => Record<string, unknown>;\n\n\t'afterCreateUser': (user: AtLeast<IUser, '_id' | 'username' | 'roles'>) => IUser;\n\t'afterDeleteRoom': (rid: IRoom['_id']) => IRoom['_id'];\n\t'livechat:afterOnHold': (room: Pick<IOmnichannelRoom, '_id'>) => Pick<IOmnichannelRoom, '_id'>;\n\t'livechat:afterOnHoldChatResumed': (room: Pick<IOmnichannelRoom, '_id'>) => Pick<IOmnichannelRoom, '_id'>;\n\t'livechat:onTransferFailure': (\n\t\troom: IRoom,\n\t\tparams: {\n\t\t\tguest: ILivechatVisitor;\n\t\t\ttransferData: TransferData;\n\t\t\tdepartment: AtLeast<ILivechatDepartmentRecord, '_id' | 'fallbackForwardDepartment' | 'name'>;\n\t\t},\n\t) => IOmnichannelRoom | Promise<boolean>;\n\t'livechat.afterForwardChatToAgent': (params: {\n\t\trid: IRoom['_id'];\n\t\tservedBy: { _id: string; ts: Date; username?: string };\n\t\toldServedBy: { _id: string; ts: Date; username?: string };\n\t}) => {\n\t\trid: IRoom['_id'];\n\t\tservedBy: { _id: string; ts: Date; username?: string };\n\t\toldServedBy: { _id: string; ts: Date; username?: string };\n\t};\n\t'livechat.afterForwardChatToDepartment': (params: {\n\t\trid: IRoom['_id'];\n\t\tnewDepartmentId: ILivechatDepartmentRecord['_id'];\n\t\toldDepartmentId: ILivechatDepartmentRecord['_id'];\n\t}) => {\n\t\trid: IRoom['_id'];\n\t\tnewDepartmentId: ILivechatDepartmentRecord['_id'];\n\t\toldDepartmentId: ILivechatDepartmentRecord['_id'];\n\t};\n\t'livechat.afterInquiryQueued': (inquiry: ILivechatInquiryRecord) => ILivechatInquiryRecord;\n\t'livechat.afterRemoveDepartment': (params: {\n\t\tdepartment: AtLeast<ILivechatDepartment, '_id' | 'businessHourId'>;\n\t\tagentsId: ILivechatAgent['_id'][];\n\t}) => {\n\t\tdepartment: AtLeast<ILivechatDepartment, '_id' | 'businessHourId'>;\n\t\tagentsId: ILivechatAgent['_id'][];\n\t};\n\t'livechat.applySimultaneousChatRestrictions': (_: undefined, params: { departmentId?: ILivechatDepartmentRecord['_id'] }) => undefined;\n\t'livechat.beforeDelegateAgent': (agent: SelectedAgent | undefined, params?: { department?: string }) => SelectedAgent | null | undefined;\n\t'livechat.applyDepartmentRestrictions': (\n\t\tquery: FilterOperators<ILivechatDepartmentRecord>,\n\t\tparams: { userId: IUser['_id'] },\n\t) => FilterOperators<ILivechatDepartmentRecord>;\n\t'livechat.applyRoomRestrictions': (query: FilterOperators<IOmnichannelRoom>) => FilterOperators<IOmnichannelRoom>;\n\t'livechat.onMaxNumberSimultaneousChatsReached': (inquiry: ILivechatInquiryRecord) => ILivechatInquiryRecord;\n\t'on-business-hour-start': (params: { BusinessHourBehaviorClass: { new (): IBusinessHourBehavior } }) => {\n\t\tBusinessHourBehaviorClass: { new (): IBusinessHourBehavior };\n\t};\n\t'renderMessage': <T extends IMessage & { html: string }>(message: T) => T;\n\t'oembed:beforeGetUrlContent': (data: { urlObj: URL }) => {\n\t\turlObj: URL;\n\t};\n\t'oembed:afterParseContent': (data: { url: string; meta: OEmbedMeta; headers: { [k: string]: string }; content: OEmbedUrlContent }) => {\n\t\turl: string;\n\t\tmeta: OEmbedMeta;\n\t\theaders: { [k: string]: string };\n\t\tcontent: OEmbedUrlContent;\n\t};\n\t'livechat.beforeListTags': () => ILivechatTag[];\n\t'livechat.offlineMessage': (data: { name: string; email: string; message: string; department?: string; host?: string }) => void;\n\t'livechat.chatQueued': (room: IOmnichannelRoom) => IOmnichannelRoom;\n\t'livechat.leadCapture': (room: IOmnichannelRoom) => IOmnichannelRoom;\n\t'beforeSendMessageNotifications': (message: string) => string;\n\t'livechat.onAgentAssignmentFailed': (\n\t\troom: IOmnichannelRoom,\n\t\tparams: {\n\t\t\tinquiry: {\n\t\t\t\t_id: string;\n\t\t\t\trid: string;\n\t\t\t\tstatus: string;\n\t\t\t};\n\t\t\toptions: { forwardingToDepartment?: { oldDepartmentId?: string; transferData?: any }; clientAction?: boolean };\n\t\t},\n\t) => Promise<(IOmnichannelRoom & { chatQueued: boolean }) | undefined>;\n\t'livechat.beforeInquiry': (data: IOmnichannelInquiryExtraData) => Partial<ILivechatInquiryRecord>;\n\t'roomNameChanged': (room: IRoom) => void;\n\t'roomTopicChanged': (room: IRoom) => void;\n\t'roomAnnouncementChanged': (room: IRoom) => void;\n\t'roomTypeChanged': (room: IRoom) => void;\n\t'archiveRoom': (room: IRoom) => void;\n\t'unarchiveRoom': (room: IRoom) => void;\n\t'roomAvatarChanged': (room: IRoom) => void;\n\t'beforeGetMentions': (mentionIds: string[], teamMentions: MessageMention[]) => Promise<string[]>;\n\t'livechat.manageDepartmentUnit': (params: { userId: string; departmentId: string; unitId?: string }) => void;\n};\n\nexport type Hook =\n\t| keyof EventLikeCallbackSignatures\n\t| keyof ChainedCallbackSignatures\n\t| 'afterProcessOAuthUser'\n\t| 'afterRoomArchived'\n\t| 'afterRoomTopicChange'\n\t| 'afterSaveUser'\n\t| 'afterValidateNewOAuthUser'\n\t| 'beforeActivateUser'\n\t| 'beforeReadMessages'\n\t| 'beforeRemoveFromRoom'\n\t| 'beforeValidateLogin'\n\t| 'livechat.beforeForwardRoomToDepartment'\n\t| 'livechat.chatQueued'\n\t| 'livechat.checkAgentBeforeTakeInquiry'\n\t| 'livechat.sendTranscript'\n\t| 'livechat.closeRoom'\n\t| 'livechat.offlineMessage'\n\t| 'livechat.onCheckRoomApiParams'\n\t| 'livechat.onLoadConfigApi'\n\t| 'livechat.manageDepartmentUnit'\n\t| 'loginPageStateChange'\n\t| 'mapLDAPUserData'\n\t| 'onCreateUser'\n\t| 'onLDAPLogin'\n\t| 'onValidateLogin'\n\t| 'openBroadcast'\n\t| 'renderNotification'\n\t| 'streamMessage'\n\t| 'streamNewMessage'\n\t| 'userAvatarSet'\n\t| 'userConfirmationEmailRequested'\n\t| 'userForgotPasswordEmailRequested'\n\t| 'usernameSet'\n\t| 'userPasswordReset'\n\t| 'userRegistered'\n\t| 'userStatusManuallySet'\n\t| 'test';\n\n/**\n * Callback hooks provide an easy way to add extra steps to common operations.\n * @deprecated\n */\n\nexport const callbacks = new Callbacks<\n\t{\n\t\t[key in keyof ChainedCallbackSignatures]: ChainedCallbackSignatures[key];\n\t},\n\t{\n\t\t[key in keyof EventLikeCallbackSignatures]: EventLikeCallbackSignatures[key];\n\t},\n\tHook\n>();\n"],"names":["callbacks","Callbacks"],"mappings":";;;;+BAwQaA;;;eAAAA;;;+BAvOa;AAuOnB,MAAMA,YAAY,IAAIC,wBAAS","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"fbf74045a03151a9ea40b1a42bed9b0d5776016a","contentHash":"1096f5dfe71059d605b858da3181cd4a1cc6be2a4af1ab841c271ded7a6ac93b"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks/callbacksBase.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks/callbacksBase.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":25}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":21},"end":{"line":12,"column":52}},"5":{"start":{"line":13,"column":37},"end":{"line":18,"column":25}},"6":{"start":{"line":14,"column":4},"end":{"line":14,"column":64}},"7":{"start":{"line":15,"column":4},"end":{"line":15,"column":64}},"8":{"start":{"line":16,"column":4},"end":{"line":16,"column":61}},"9":{"start":{"line":17,"column":4},"end":{"line":17,"column":28}},"10":{"start":{"line":19,"column":16},"end":{"line":140,"column":1}},"11":{"start":{"line":21,"column":8},"end":{"line":21,"column":29}},"12":{"start":{"line":24,"column":8},"end":{"line":24,"column":43}},"13":{"start":{"line":25,"column":8},"end":{"line":25,"column":35}},"14":{"start":{"line":29,"column":29},"end":{"line":29,"column":177}},"15":{"start":{"line":30,"column":8},"end":{"line":30,"column":79}},"16":{"start":{"line":33,"column":29},"end":{"line":38,"column":13}},"17":{"start":{"line":33,"column":41},"end":{"line":38,"column":13}},"18":{"start":{"line":35,"column":16},"end":{"line":35,"column":182}},"19":{"start":{"line":37,"column":16},"end":{"line":37,"column":118}},"20":{"start":{"line":39,"column":25},"end":{"line":39,"column":54}},"21":{"start":{"line":39,"column":33},"end":{"line":39,"column":54}},"22":{"start":{"line":40,"column":21},"end":{"line":40,"column":101}},"23":{"start":{"line":40,"column":35},"end":{"line":40,"column":101}},"24":{"start":{"line":40,"column":59},"end":{"line":40,"column":101}},"25":{"start":{"line":41,"column":19},"end":{"line":41,"column":69}},"26":{"start":{"line":42,"column":8},"end":{"line":49,"column":10}},"27":{"start":{"line":44,"column":33},"end":{"line":47,"column":14}},"28":{"start":{"line":48,"column":12},"end":{"line":48,"column":126}},"29":{"start":{"line":48,"column":50},"end":{"line":48,"column":124}},"30":{"start":{"line":52,"column":8},"end":{"line":62,"column":10}},"31":{"start":{"line":53,"column":12},"end":{"line":55,"column":13}},"32":{"start":{"line":54,"column":16},"end":{"line":54,"column":83}},"33":{"start":{"line":56,"column":12},"end":{"line":60,"column":13}},"34":{"start":{"line":57,"column":16},"end":{"line":59,"column":22}},"35":{"start":{"line":58,"column":20},"end":{"line":58,"column":63}},"36":{"start":{"line":61,"column":12},"end":{"line":61,"column":24}},"37":{"start":{"line":66,"column":8},"end":{"line":66,"column":134}},"38":{"start":{"line":69,"column":8},"end":{"line":69,"column":44}},"39":{"start":{"line":70,"column":8},"end":{"line":70,"column":87}},"40":{"start":{"line":71,"column":8},"end":{"line":71,"column":77}},"41":{"start":{"line":74,"column":26},"end":{"line":74,"column":49}},"42":{"start":{"line":75,"column":8},"end":{"line":77,"column":9}},"43":{"start":{"line":75,"column":33},"end":{"line":75,"column":45}},"44":{"start":{"line":76,"column":12},"end":{"line":76,"column":19}},"45":{"start":{"line":78,"column":8},"end":{"line":83,"column":12}},"46":{"start":{"line":84,"column":8},"end":{"line":87,"column":12}},"47":{"start":{"line":86,"column":12},"end":{"line":86,"column":146}},"48":{"start":{"line":88,"column":8},"end":{"line":88,"column":43}},"49":{"start":{"line":96,"column":22},"end":{"line":96,"column":84}},"50":{"start":{"line":96,"column":65},"end":{"line":96,"column":83}},"51":{"start":{"line":97,"column":8},"end":{"line":97,"column":39}},"52":{"start":{"line":108,"column":23},"end":{"line":108,"column":200}},"53":{"start":{"line":108,"column":196},"end":{"line":108,"column":200}},"54":{"start":{"line":109,"column":8},"end":{"line":109,"column":38}},"55":{"start":{"line":120,"column":23},"end":{"line":120,"column":174}},"56":{"start":{"line":120,"column":170},"end":{"line":120,"column":174}},"57":{"start":{"line":121,"column":8},"end":{"line":121,"column":38}},"58":{"start":{"line":124,"column":26},"end":{"line":124,"column":41}},"59":{"start":{"line":125,"column":8},"end":{"line":129,"column":10}},"60":{"start":{"line":126,"column":43},"end":{"line":126,"column":86}},"61":{"start":{"line":127,"column":26},"end":{"line":127,"column":52}},"62":{"start":{"line":128,"column":35},"end":{"line":128,"column":70}},"63":{"start":{"line":132,"column":8},"end":{"line":132,"column":32}},"64":{"start":{"line":133,"column":8},"end":{"line":133,"column":39}},"65":{"start":{"line":134,"column":8},"end":{"line":134,"column":35}},"66":{"start":{"line":135,"column":8},"end":{"line":135,"column":35}},"67":{"start":{"line":136,"column":8},"end":{"line":136,"column":43}},"68":{"start":{"line":137,"column":8},"end":{"line":137,"column":38}},"69":{"start":{"line":138,"column":8},"end":{"line":138,"column":41}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":37},"end":{"line":13,"column":38}},"loc":{"start":{"line":13,"column":64},"end":{"line":18,"column":1}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":20,"column":4},"end":{"line":20,"column":5}},"loc":{"start":{"line":20,"column":22},"end":{"line":22,"column":5}},"line":20},"3":{"name":"(anonymous_3)","decl":{"start":{"line":23,"column":4},"end":{"line":23,"column":5}},"loc":{"start":{"line":23,"column":53},"end":{"line":26,"column":5}},"line":23},"4":{"name":"(anonymous_4)","decl":{"start":{"line":27,"column":4},"end":{"line":27,"column":5}},"loc":{"start":{"line":27,"column":37},"end":{"line":31,"column":5}},"line":27},"5":{"name":"(anonymous_5)","decl":{"start":{"line":32,"column":4},"end":{"line":32,"column":5}},"loc":{"start":{"line":32,"column":44},"end":{"line":50,"column":5}},"line":32},"6":{"name":"(anonymous_6)","decl":{"start":{"line":33,"column":29},"end":{"line":33,"column":30}},"loc":{"start":{"line":33,"column":41},"end":{"line":38,"column":13}},"line":33},"7":{"name":"(anonymous_7)","decl":{"start":{"line":33,"column":41},"end":{"line":33,"column":42}},"loc":{"start":{"line":33,"column":65},"end":{"line":38,"column":13}},"line":33},"8":{"name":"(anonymous_8)","decl":{"start":{"line":39,"column":25},"end":{"line":39,"column":26}},"loc":{"start":{"line":39,"column":33},"end":{"line":39,"column":54}},"line":39},"9":{"name":"(anonymous_9)","decl":{"start":{"line":40,"column":21},"end":{"line":40,"column":22}},"loc":{"start":{"line":40,"column":35},"end":{"line":40,"column":101}},"line":40},"10":{"name":"(anonymous_10)","decl":{"start":{"line":40,"column":35},"end":{"line":40,"column":36}},"loc":{"start":{"line":40,"column":59},"end":{"line":40,"column":101}},"line":40},"11":{"name":"(anonymous_11)","decl":{"start":{"line":42,"column":15},"end":{"line":42,"column":16}},"loc":{"start":{"line":42,"column":39},"end":{"line":49,"column":9}},"line":42},"12":{"name":"(anonymous_12)","decl":{"start":{"line":48,"column":46},"end":{"line":48,"column":47}},"loc":{"start":{"line":48,"column":50},"end":{"line":48,"column":124}},"line":48},"13":{"name":"(anonymous_13)","decl":{"start":{"line":51,"column":4},"end":{"line":51,"column":5}},"loc":{"start":{"line":51,"column":36},"end":{"line":63,"column":5}},"line":51},"14":{"name":"(anonymous_14)","decl":{"start":{"line":52,"column":15},"end":{"line":52,"column":16}},"loc":{"start":{"line":52,"column":33},"end":{"line":62,"column":9}},"line":52},"15":{"name":"(anonymous_15)","decl":{"start":{"line":57,"column":27},"end":{"line":57,"column":28}},"loc":{"start":{"line":57,"column":31},"end":{"line":59,"column":17}},"line":57},"16":{"name":"(anonymous_16)","decl":{"start":{"line":64,"column":4},"end":{"line":64,"column":5}},"loc":{"start":{"line":64,"column":23},"end":{"line":67,"column":5}},"line":64},"17":{"name":"(anonymous_17)","decl":{"start":{"line":68,"column":4},"end":{"line":68,"column":5}},"loc":{"start":{"line":68,"column":34},"end":{"line":72,"column":5}},"line":68},"18":{"name":"(anonymous_18)","decl":{"start":{"line":73,"column":4},"end":{"line":73,"column":5}},"loc":{"start":{"line":73,"column":83},"end":{"line":89,"column":5}},"line":73},"19":{"name":"(anonymous_19)","decl":{"start":{"line":75,"column":27},"end":{"line":75,"column":28}},"loc":{"start":{"line":75,"column":33},"end":{"line":75,"column":45}},"line":75},"20":{"name":"(anonymous_20)","decl":{"start":{"line":84,"column":58},"end":{"line":84,"column":59}},"loc":{"start":{"line":84,"column":70},"end":{"line":87,"column":9}},"line":84},"21":{"name":"(anonymous_21)","decl":{"start":{"line":95,"column":5},"end":{"line":95,"column":6}},"loc":{"start":{"line":95,"column":22},"end":{"line":98,"column":5}},"line":95},"22":{"name":"(anonymous_22)","decl":{"start":{"line":96,"column":53},"end":{"line":96,"column":54}},"loc":{"start":{"line":96,"column":65},"end":{"line":96,"column":83}},"line":96},"23":{"name":"(anonymous_23)","decl":{"start":{"line":106,"column":5},"end":{"line":106,"column":6}},"loc":{"start":{"line":106,"column":31},"end":{"line":110,"column":5}},"line":106},"24":{"name":"(anonymous_24)","decl":{"start":{"line":108,"column":171},"end":{"line":108,"column":172}},"loc":{"start":{"line":108,"column":196},"end":{"line":108,"column":200}},"line":108},"25":{"name":"(anonymous_25)","decl":{"start":{"line":118,"column":5},"end":{"line":118,"column":6}},"loc":{"start":{"line":118,"column":36},"end":{"line":122,"column":5}},"line":118},"26":{"name":"(anonymous_26)","decl":{"start":{"line":120,"column":151},"end":{"line":120,"column":152}},"loc":{"start":{"line":120,"column":170},"end":{"line":120,"column":174}},"line":120},"27":{"name":"(anonymous_27)","decl":{"start":{"line":123,"column":4},"end":{"line":123,"column":5}},"loc":{"start":{"line":123,"column":24},"end":{"line":130,"column":5}},"line":123},"28":{"name":"(anonymous_28)","decl":{"start":{"line":126,"column":17},"end":{"line":126,"column":18}},"loc":{"start":{"line":126,"column":43},"end":{"line":126,"column":86}},"line":126},"29":{"name":"(anonymous_29)","decl":{"start":{"line":127,"column":20},"end":{"line":127,"column":21}},"loc":{"start":{"line":127,"column":26},"end":{"line":127,"column":52}},"line":127},"30":{"name":"(anonymous_30)","decl":{"start":{"line":128,"column":17},"end":{"line":128,"column":18}},"loc":{"start":{"line":128,"column":35},"end":{"line":128,"column":70}},"line":128},"31":{"name":"(anonymous_31)","decl":{"start":{"line":131,"column":4},"end":{"line":131,"column":5}},"loc":{"start":{"line":131,"column":17},"end":{"line":139,"column":5}},"line":131}},"branchMap":{"0":{"loc":{"start":{"line":18,"column":2},"end":{"line":18,"column":24}},"type":"binary-expr","locations":[{"start":{"line":18,"column":2},"end":{"line":18,"column":18}},{"start":{"line":18,"column":22},"end":{"line":18,"column":24}}],"line":18},"1":{"loc":{"start":{"line":29,"column":29},"end":{"line":29,"column":177}},"type":"cond-expr","locations":[{"start":{"line":29,"column":127},"end":{"line":29,"column":133}},{"start":{"line":29,"column":136},"end":{"line":29,"column":177}}],"line":29},"2":{"loc":{"start":{"line":29,"column":29},"end":{"line":29,"column":124}},"type":"binary-expr","locations":[{"start":{"line":29,"column":29},"end":{"line":29,"column":90}},{"start":{"line":29,"column":94},"end":{"line":29,"column":124}}],"line":29},"3":{"loc":{"start":{"line":35,"column":16},"end":{"line":35,"column":181}},"type":"cond-expr","locations":[{"start":{"line":35,"column":83},"end":{"line":35,"column":89}},{"start":{"line":35,"column":92},"end":{"line":35,"column":181}}],"line":35},"4":{"loc":{"start":{"line":35,"column":16},"end":{"line":35,"column":80}},"type":"binary-expr","locations":[{"start":{"line":35,"column":16},"end":{"line":35,"column":53}},{"start":{"line":35,"column":57},"end":{"line":35,"column":80}}],"line":35},"5":{"loc":{"start":{"line":37,"column":23},"end":{"line":37,"column":117}},"type":"cond-expr","locations":[{"start":{"line":37,"column":106},"end":{"line":37,"column":110}},{"start":{"line":37,"column":113},"end":{"line":37,"column":117}}],"line":37},"6":{"loc":{"start":{"line":37,"column":23},"end":{"line":37,"column":103}},"type":"binary-expr","locations":[{"start":{"line":37,"column":23},"end":{"line":37,"column":84}},{"start":{"line":37,"column":88},"end":{"line":37,"column":103}}],"line":37},"7":{"loc":{"start":{"line":44,"column":33},"end":{"line":47,"column":14}},"type":"cond-expr","locations":[{"start":{"line":44,"column":119},"end":{"line":44,"column":125}},{"start":{"line":44,"column":128},"end":{"line":47,"column":14}}],"line":44},"8":{"loc":{"start":{"line":44,"column":33},"end":{"line":44,"column":116}},"type":"binary-expr","locations":[{"start":{"line":44,"column":33},"end":{"line":44,"column":86}},{"start":{"line":44,"column":90},"end":{"line":44,"column":116}}],"line":44},"9":{"loc":{"start":{"line":48,"column":50},"end":{"line":48,"column":124}},"type":"cond-expr","locations":[{"start":{"line":48,"column":101},"end":{"line":48,"column":107}},{"start":{"line":48,"column":110},"end":{"line":48,"column":124}}],"line":48},"10":{"loc":{"start":{"line":48,"column":50},"end":{"line":48,"column":98}},"type":"binary-expr","locations":[{"start":{"line":48,"column":50},"end":{"line":48,"column":71}},{"start":{"line":48,"column":75},"end":{"line":48,"column":98}}],"line":48},"11":{"loc":{"start":{"line":53,"column":12},"end":{"line":55,"column":13}},"type":"if","locations":[{"start":{"line":53,"column":12},"end":{"line":55,"column":13}},{"start":{"line":53,"column":12},"end":{"line":55,"column":13}}],"line":53},"12":{"loc":{"start":{"line":66,"column":15},"end":{"line":66,"column":133}},"type":"cond-expr","locations":[{"start":{"line":66,"column":109},"end":{"line":66,"column":128}},{"start":{"line":66,"column":131},"end":{"line":66,"column":133}}],"line":66},"13":{"loc":{"start":{"line":66,"column":15},"end":{"line":66,"column":106}},"type":"binary-expr","locations":[{"start":{"line":66,"column":15},"end":{"line":66,"column":72}},{"start":{"line":66,"column":76},"end":{"line":66,"column":106}}],"line":66},"14":{"loc":{"start":{"line":73,"column":24},"end":{"line":73,"column":55}},"type":"default-arg","locations":[{"start":{"line":73,"column":35},"end":{"line":73,"column":55}}],"line":73},"15":{"loc":{"start":{"line":73,"column":57},"end":{"line":73,"column":81}},"type":"default-arg","locations":[{"start":{"line":73,"column":62},"end":{"line":73,"column":81}}],"line":73},"16":{"loc":{"start":{"line":75,"column":8},"end":{"line":77,"column":9}},"type":"if","locations":[{"start":{"line":75,"column":8},"end":{"line":77,"column":9}},{"start":{"line":75,"column":8},"end":{"line":77,"column":9}}],"line":75},"17":{"loc":{"start":{"line":86,"column":19},"end":{"line":86,"column":145}},"type":"cond-expr","locations":[{"start":{"line":86,"column":104},"end":{"line":86,"column":122}},{"start":{"line":86,"column":125},"end":{"line":86,"column":145}}],"line":86},"18":{"loc":{"start":{"line":86,"column":19},"end":{"line":86,"column":101}},"type":"binary-expr","locations":[{"start":{"line":86,"column":19},"end":{"line":86,"column":68}},{"start":{"line":86,"column":72},"end":{"line":86,"column":101}}],"line":86},"19":{"loc":{"start":{"line":108,"column":23},"end":{"line":108,"column":200}},"type":"cond-expr","locations":[{"start":{"line":108,"column":141},"end":{"line":108,"column":168}},{"start":{"line":108,"column":171},"end":{"line":108,"column":200}}],"line":108},"20":{"loc":{"start":{"line":108,"column":23},"end":{"line":108,"column":138}},"type":"binary-expr","locations":[{"start":{"line":108,"column":23},"end":{"line":108,"column":96}},{"start":{"line":108,"column":100},"end":{"line":108,"column":138}}],"line":108},"21":{"loc":{"start":{"line":120,"column":23},"end":{"line":120,"column":174}},"type":"cond-expr","locations":[{"start":{"line":120,"column":126},"end":{"line":120,"column":148}},{"start":{"line":120,"column":151},"end":{"line":120,"column":174}}],"line":120},"22":{"loc":{"start":{"line":120,"column":23},"end":{"line":120,"column":123}},"type":"binary-expr","locations":[{"start":{"line":120,"column":23},"end":{"line":120,"column":86}},{"start":{"line":120,"column":90},"end":{"line":120,"column":123}}],"line":120}},"s":{"0":1,"1":1,"2":6,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":0,"12":0,"13":0,"14":28,"15":28,"16":187,"17":33,"18":28,"19":28,"20":187,"21":24,"22":187,"23":33,"24":28,"25":187,"26":187,"27":24,"28":24,"29":24,"30":187,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":187,"38":187,"39":187,"40":187,"41":31,"42":31,"43":2,"44":0,"45":31,"46":31,"47":4,"48":31,"49":156,"50":14,"51":156,"52":24,"53":0,"54":24,"55":0,"56":0,"57":0,"58":5,"59":5,"60":16,"61":154,"62":16,"63":6,"64":6,"65":6,"66":6,"67":6,"68":6,"69":6},"f":{"0":6,"1":1,"2":0,"3":0,"4":28,"5":187,"6":33,"7":28,"8":24,"9":33,"10":28,"11":24,"12":24,"13":187,"14":0,"15":0,"16":187,"17":187,"18":31,"19":2,"20":4,"21":156,"22":14,"23":24,"24":0,"25":0,"26":0,"27":5,"28":16,"29":154,"30":16,"31":6},"b":{"0":[1,1],"1":[28,0],"2":[28,28],"3":[28,0],"4":[28,28],"5":[13,12],"6":[28,25],"7":[24,0],"8":[24,24],"9":[24,0],"10":[24,24],"11":[0,0],"12":[170,17],"13":[187,187],"14":[4],"15":[4],"16":[0,31],"17":[4,0],"18":[4,4],"19":[24,0],"20":[24,24],"21":[0,0],"22":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks/callbacksBase.ts"],"sourcesContent":["import type { Logger } from '@rocket.chat/logger';\nimport { Random } from '@rocket.chat/random';\n\nimport { compareByRanking } from '../utils/comparisons';\n\nenum CallbackPriority {\n\tHIGH = -1000,\n\tMEDIUM = 0,\n\tLOW = 1000,\n}\n\ntype Callback<H> = {\n\t(item: unknown, constant?: unknown): Promise<unknown>;\n\thook: H;\n\tid: string;\n\tpriority: CallbackPriority;\n\tstack: string;\n};\n\ntype CallbackTracker<H> = (callback: Callback<H>) => () => void;\n\ntype HookTracker<H> = (params: { hook: H; length: number }) => () => void;\n\nexport class Callbacks<\n\tTChainedCallbackSignatures extends {\n\t\t[key: string]: (item: any, constant?: any) => any;\n\t},\n\tTEventLikeCallbackSignatures extends {\n\t\t[key: string]: (item: any, constant?: any) => any;\n\t},\n\tTHook extends string = keyof TChainedCallbackSignatures & keyof TEventLikeCallbackSignatures & string,\n> {\n\tprivate logger: Logger | undefined = undefined;\n\n\tprivate trackCallback: CallbackTracker<THook> | undefined = undefined;\n\n\tprivate trackHook: HookTracker<THook> | undefined = undefined;\n\n\tprivate callbacks = new Map<THook, Callback<THook>[]>();\n\n\tprivate sequentialRunners = new Map<THook, (item: unknown, constant?: unknown) => Promise<unknown>>();\n\n\tprivate asyncRunners = new Map<THook, (item: unknown, constant?: unknown) => unknown>();\n\n\treadonly priority = CallbackPriority;\n\n\tsetLogger(logger: Logger): void {\n\t\tthis.logger = logger;\n\t}\n\n\tsetMetricsTrackers({ trackCallback, trackHook }: { trackCallback?: CallbackTracker<THook>; trackHook?: HookTracker<THook> }): void {\n\t\tthis.trackCallback = trackCallback;\n\t\tthis.trackHook = trackHook;\n\t}\n\n\tprivate runOne(callback: Callback<THook>, item: unknown, constant: unknown): Promise<unknown> {\n\t\tconst stopTracking = this.trackCallback?.(callback);\n\n\t\treturn Promise.resolve(callback(item, constant)).finally(stopTracking);\n\t}\n\n\tprivate createSequentialRunner(hook: THook, callbacks: Callback<THook>[]): (item: unknown, constant?: unknown) => Promise<unknown> {\n\t\tconst wrapCallback =\n\t\t\t(callback: Callback<THook>) =>\n\t\t\tasync (item: unknown, constant?: unknown): Promise<unknown> => {\n\t\t\t\tthis.logger?.debug(`Executing callback with id ${callback.id} for hook ${callback.hook}`);\n\n\t\t\t\treturn (await this.runOne(callback, item, constant)) ?? item;\n\t\t\t};\n\n\t\tconst identity = <TItem>(item: TItem): Promise<TItem> => Promise.resolve(item);\n\n\t\tconst pipe =\n\t\t\t(curr: (item: unknown, constant?: unknown) => Promise<unknown>, next: (item: unknown, constant?: unknown) => Promise<unknown>) =>\n\t\t\tasync (item: unknown, constant?: unknown): Promise<unknown> =>\n\t\t\t\tnext(await curr(item, constant), constant);\n\n\t\tconst fn = callbacks.map(wrapCallback).reduce(pipe, identity);\n\n\t\treturn async (item: unknown, constant?: unknown): Promise<unknown> => {\n\t\t\tconst stopTracking = this.trackHook?.({ hook, length: callbacks.length });\n\n\t\t\treturn fn(item, constant).finally(() => stopTracking?.());\n\t\t};\n\t}\n\n\tprivate createAsyncRunner(_: THook, callbacks: Callback<THook>[]) {\n\t\treturn (item: unknown, constant?: unknown): unknown => {\n\t\t\tif (typeof window !== 'undefined') {\n\t\t\t\tthrow new Error('callbacks.runAsync on client server not allowed');\n\t\t\t}\n\n\t\t\tfor (const callback of callbacks) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tvoid this.runOne(callback, item, constant);\n\t\t\t\t}, 0);\n\t\t\t}\n\n\t\t\treturn item;\n\t\t};\n\t}\n\n\tgetCallbacks(hook: THook): Callback<THook>[] {\n\t\treturn this.callbacks.get(hook) ?? [];\n\t}\n\n\tsetCallbacks(hook: THook, callbacks: Callback<THook>[]): void {\n\t\tthis.callbacks.set(hook, callbacks);\n\t\tthis.sequentialRunners.set(hook, this.createSequentialRunner(hook, callbacks));\n\t\tthis.asyncRunners.set(hook, this.createAsyncRunner(hook, callbacks));\n\t}\n\n\t/**\n\t * Add a callback function to a hook\n\t *\n\t * @param hook the name of the hook\n\t * @param callback the callback function\n\t * @param priority the callback run priority (order)\n\t * @param id human friendly name for this callback\n\t */\n\tadd<Hook extends keyof TEventLikeCallbackSignatures>(\n\t\thook: Hook,\n\t\tcallback: TEventLikeCallbackSignatures[Hook],\n\t\tpriority?: CallbackPriority,\n\t\tid?: string,\n\t): void;\n\n\tadd<Hook extends keyof TChainedCallbackSignatures>(\n\t\thook: Hook,\n\t\tcallback: TChainedCallbackSignatures[Hook],\n\t\tpriority?: CallbackPriority,\n\t\tid?: string,\n\t): void;\n\n\tadd<TItem, TConstant, TNextItem = TItem>(\n\t\thook: THook,\n\t\tcallback: (item: TItem, constant?: TConstant) => TNextItem,\n\t\tpriority?: CallbackPriority,\n\t\tid?: string,\n\t): void;\n\n\tadd(hook: THook, callback: (item: unknown, constant?: unknown) => unknown, priority = this.priority.MEDIUM, id = Random.id()): void {\n\t\tconst callbacks = this.getCallbacks(hook);\n\n\t\tif (callbacks.some((cb) => cb.id === id)) {\n\t\t\treturn;\n\t\t}\n\n\t\tcallbacks.push(\n\t\t\tObject.assign(callback as Callback<THook>, {\n\t\t\t\thook,\n\t\t\t\tpriority,\n\t\t\t\tid,\n\t\t\t\tstack: new Error().stack,\n\t\t\t}),\n\t\t);\n\t\tcallbacks.sort(compareByRanking((callback: Callback<THook>): number => callback.priority ?? this.priority.MEDIUM));\n\n\t\tthis.setCallbacks(hook, callbacks);\n\t}\n\n\t/**\n\t * Remove a callback from a hook\n\t *\n\t * @param hook the name of the hook\n\t * @param id the callback's id\n\t */\n\tremove(hook: THook, id: string): void {\n\t\tconst hooks = this.getCallbacks(hook).filter((callback) => callback.id !== id);\n\t\tthis.setCallbacks(hook, hooks);\n\t}\n\n\trun<Hook extends keyof TEventLikeCallbackSignatures>(hook: Hook, ...args: Parameters<TEventLikeCallbackSignatures[Hook]>): Promise<void>;\n\n\trun<Hook extends keyof TChainedCallbackSignatures>(\n\t\thook: Hook,\n\t\t...args: Parameters<TChainedCallbackSignatures[Hook]>\n\t): Promise<ReturnType<TChainedCallbackSignatures[Hook]>>;\n\n\trun<TItem, TConstant, TNextItem = TItem>(hook: THook, item: TItem, constant?: TConstant): Promise<TNextItem>;\n\n\t/**\n\t * Successively run all of a hook's callbacks on an item\n\t *\n\t * @param hook the name of the hook\n\t * @param item the post, comment, modifier, etc. on which to run the callbacks\n\t * @param constant an optional constant that will be passed along to each callback\n\t * @returns returns the item after it's been through all the callbacks for this hook\n\t */\n\trun(hook: THook, item: unknown, constant?: unknown): Promise<unknown> {\n\t\tconst runner = this.sequentialRunners.get(hook) ?? (async (item: unknown, _constant?: unknown): Promise<unknown> => item);\n\t\treturn runner(item, constant);\n\t}\n\n\trunAsync<Hook extends keyof TEventLikeCallbackSignatures>(hook: Hook, ...args: Parameters<TEventLikeCallbackSignatures[Hook]>): void;\n\n\t/**\n\t * Successively run all of a hook's callbacks on an item, in async mode (only works on server)\n\t *\n\t * @param hook the name of the hook\n\t * @param item the post, comment, modifier, etc. on which to run the callbacks\n\t * @param constant an optional constant that will be passed along to each callback\n\t * @returns the post, comment, modifier, etc. on which to run the callbacks\n\t */\n\trunAsync(hook: THook, item: unknown, constant?: unknown): unknown {\n\t\tconst runner = this.asyncRunners.get(hook) ?? ((item: unknown, _constant?: unknown): unknown => item);\n\t\treturn runner(item, constant);\n\t}\n\n\tstatic create<F extends (item: any, constant?: any) => any | Promise<any>>(\n\t\thook: string,\n\t): Cb<Parameters<F>[0], ReturnType<F>, Parameters<F>[1]>;\n\n\tstatic create<I, R, C = undefined>(hook: string): Cb<I, R, C> {\n\t\tconst callbacks = new Callbacks();\n\n\t\treturn {\n\t\t\tadd: (callback, priority, id) => callbacks.add(hook as any, callback, priority, id),\n\t\t\tremove: (id) => callbacks.remove(hook as any, id),\n\t\t\trun: (item, constant) => callbacks.run(hook as any, item, constant) as any,\n\t\t};\n\t}\n}\n\n/**\n * Callback hooks provide an easy way to add extra steps to common operations.\n * @deprecated\n */\ntype Cb<I, R, C = undefined> = {\n\tadd: (\n\t\tcallback: (item: I, constant: C) => Promise<R | undefined | void> | R | undefined | void,\n\t\tpriority?: CallbackPriority,\n\t\tid?: string,\n\t) => void;\n\tremove: (id: string) => void;\n\trun: (item: I, constant?: C) => Promise<R>;\n};\n"],"names":["Callbacks","CallbackPriority","setLogger","logger","setMetricsTrackers","trackCallback","trackHook","runOne","callback","item","constant","stopTracking","Promise","resolve","finally","createSequentialRunner","hook","callbacks","wrapCallback","debug","id","identity","pipe","curr","next","fn","map","reduce","length","createAsyncRunner","_","window","Error","setTimeout","getCallbacks","get","setCallbacks","set","sequentialRunners","asyncRunners","add","priority","MEDIUM","Random","some","cb","push","Object","assign","stack","sort","compareByRanking","remove","hooks","filter","run","runner","_constant","runAsync","create","undefined","Map"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks/callbacksBase.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2e5e8cab5dac432beed002f014ab748cf97b5278","contentHash":"58fc8e3454975dea8043426a2a0886f498d3bdc54ac17d366506e9936b5c62bf"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/comparisons.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/comparisons.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":32}},"3":{"start":{"line":11,"column":25},"end":{"line":13,"column":5}},"4":{"start":{"line":11,"column":33},"end":{"line":13,"column":5}},"5":{"start":{"line":12,"column":8},"end":{"line":12,"column":33}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":25},"end":{"line":11,"column":26}},"loc":{"start":{"line":11,"column":33},"end":{"line":13,"column":5}},"line":11},"2":{"name":"(anonymous_2)","decl":{"start":{"line":11,"column":33},"end":{"line":11,"column":34}},"loc":{"start":{"line":11,"column":41},"end":{"line":13,"column":5}},"line":11}},"branchMap":{},"s":{"0":1,"1":1,"2":31,"3":1,"4":31,"5":2},"f":{"0":31,"1":31,"2":2},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/comparisons.ts"],"sourcesContent":["export const compareByRanking =\n\t<T>(rank: (x: T) => number) =>\n\t(a: T, b: T) => {\n\t\treturn rank(a) - rank(b);\n\t};\n"],"names":["compareByRanking","rank","a","b"],"mappings":";;;;+BAAaA;;;eAAAA;;;AAAN,MAAMA,mBACZ,CAAIC,OACJ,CAACC,GAAMC;QACN,OAAOF,KAAKC,KAAKD,KAAKE;IACvB","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/comparisons.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c89272ce33d6fa4bde4725f4feae958cf3460419","contentHash":"26fcecfb5e4486ee0f593de255242892ae0a82163e26b2143e54064f6706dd96"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/copyCustomFieldsLDAP.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/copyCustomFieldsLDAP.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":30},"end":{"line":6,"column":63}},"3":{"start":{"line":7,"column":0},"end":{"line":197,"column":3}},"4":{"start":{"line":8,"column":4},"end":{"line":38,"column":7}},"5":{"start":{"line":9,"column":25},"end":{"line":12,"column":9}},"6":{"start":{"line":13,"column":25},"end":{"line":16,"column":9}},"7":{"start":{"line":17,"column":8},"end":{"line":33,"column":11}},"8":{"start":{"line":31,"column":23},"end":{"line":31,"column":32}},"9":{"start":{"line":32,"column":23},"end":{"line":32,"column":32}},"10":{"start":{"line":34,"column":8},"end":{"line":34,"column":69}},"11":{"start":{"line":35,"column":8},"end":{"line":37,"column":11}},"12":{"start":{"line":39,"column":4},"end":{"line":73,"column":7}},"13":{"start":{"line":40,"column":25},"end":{"line":43,"column":9}},"14":{"start":{"line":44,"column":25},"end":{"line":50,"column":9}},"15":{"start":{"line":51,"column":8},"end":{"line":67,"column":11}},"16":{"start":{"line":65,"column":23},"end":{"line":65,"column":32}},"17":{"start":{"line":66,"column":23},"end":{"line":66,"column":32}},"18":{"start":{"line":68,"column":8},"end":{"line":68,"column":69}},"19":{"start":{"line":69,"column":8},"end":{"line":72,"column":11}},"20":{"start":{"line":74,"column":4},"end":{"line":101,"column":7}},"21":{"start":{"line":75,"column":25},"end":{"line":78,"column":9}},"22":{"start":{"line":79,"column":25},"end":{"line":82,"column":9}},"23":{"start":{"line":83,"column":8},"end":{"line":99,"column":11}},"24":{"start":{"line":97,"column":23},"end":{"line":97,"column":32}},"25":{"start":{"line":98,"column":23},"end":{"line":98,"column":32}},"26":{"start":{"line":100,"column":8},"end":{"line":100,"column":73}},"27":{"start":{"line":102,"column":4},"end":{"line":131,"column":7}},"28":{"start":{"line":103,"column":22},"end":{"line":103,"column":38}},"29":{"start":{"line":104,"column":22},"end":{"line":104,"column":38}},"30":{"start":{"line":105,"column":25},"end":{"line":108,"column":9}},"31":{"start":{"line":109,"column":25},"end":{"line":112,"column":9}},"32":{"start":{"line":113,"column":8},"end":{"line":129,"column":11}},"33":{"start":{"line":130,"column":8},"end":{"line":130,"column":64}},"34":{"start":{"line":132,"column":4},"end":{"line":161,"column":7}},"35":{"start":{"line":133,"column":22},"end":{"line":133,"column":38}},"36":{"start":{"line":134,"column":22},"end":{"line":134,"column":38}},"37":{"start":{"line":135,"column":25},"end":{"line":138,"column":9}},"38":{"start":{"line":139,"column":25},"end":{"line":142,"column":9}},"39":{"start":{"line":143,"column":8},"end":{"line":159,"column":11}},"40":{"start":{"line":160,"column":8},"end":{"line":160,"column":64}},"41":{"start":{"line":162,"column":4},"end":{"line":196,"column":7}},"42":{"start":{"line":163,"column":22},"end":{"line":163,"column":38}},"43":{"start":{"line":164,"column":22},"end":{"line":164,"column":38}},"44":{"start":{"line":165,"column":25},"end":{"line":168,"column":9}},"45":{"start":{"line":169,"column":25},"end":{"line":172,"column":9}},"46":{"start":{"line":173,"column":8},"end":{"line":190,"column":11}},"47":{"start":{"line":191,"column":8},"end":{"line":191,"column":64}},"48":{"start":{"line":192,"column":8},"end":{"line":192,"column":69}},"49":{"start":{"line":193,"column":8},"end":{"line":195,"column":11}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":38},"end":{"line":7,"column":39}},"loc":{"start":{"line":7,"column":42},"end":{"line":197,"column":1}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":8,"column":60},"end":{"line":8,"column":61}},"loc":{"start":{"line":8,"column":64},"end":{"line":38,"column":5}},"line":8},"2":{"name":"(anonymous_2)","decl":{"start":{"line":31,"column":19},"end":{"line":31,"column":20}},"loc":{"start":{"line":31,"column":23},"end":{"line":31,"column":32}},"line":31},"3":{"name":"(anonymous_3)","decl":{"start":{"line":32,"column":19},"end":{"line":32,"column":20}},"loc":{"start":{"line":32,"column":23},"end":{"line":32,"column":32}},"line":32},"4":{"name":"(anonymous_4)","decl":{"start":{"line":39,"column":95},"end":{"line":39,"column":96}},"loc":{"start":{"line":39,"column":99},"end":{"line":73,"column":5}},"line":39},"5":{"name":"(anonymous_5)","decl":{"start":{"line":65,"column":19},"end":{"line":65,"column":20}},"loc":{"start":{"line":65,"column":23},"end":{"line":65,"column":32}},"line":65},"6":{"name":"(anonymous_6)","decl":{"start":{"line":66,"column":19},"end":{"line":66,"column":20}},"loc":{"start":{"line":66,"column":23},"end":{"line":66,"column":32}},"line":66},"7":{"name":"(anonymous_7)","decl":{"start":{"line":74,"column":93},"end":{"line":74,"column":94}},"loc":{"start":{"line":74,"column":97},"end":{"line":101,"column":5}},"line":74},"8":{"name":"(anonymous_8)","decl":{"start":{"line":97,"column":19},"end":{"line":97,"column":20}},"loc":{"start":{"line":97,"column":23},"end":{"line":97,"column":32}},"line":97},"9":{"name":"(anonymous_9)","decl":{"start":{"line":98,"column":19},"end":{"line":98,"column":20}},"loc":{"start":{"line":98,"column":23},"end":{"line":98,"column":32}},"line":98},"10":{"name":"(anonymous_10)","decl":{"start":{"line":102,"column":79},"end":{"line":102,"column":80}},"loc":{"start":{"line":102,"column":83},"end":{"line":131,"column":5}},"line":102},"11":{"name":"(anonymous_11)","decl":{"start":{"line":132,"column":74},"end":{"line":132,"column":75}},"loc":{"start":{"line":132,"column":78},"end":{"line":161,"column":5}},"line":132},"12":{"name":"(anonymous_12)","decl":{"start":{"line":162,"column":107},"end":{"line":162,"column":108}},"loc":{"start":{"line":162,"column":111},"end":{"line":196,"column":5}},"line":162}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":0,"9":0,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":0,"17":0,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":0,"25":0,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1},"f":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":0,"6":0,"7":1,"8":0,"9":0,"10":1,"11":1,"12":1},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/copyCustomFieldsLDAP.spec.ts"],"sourcesContent":["import type { IImportUser, ILDAPEntry } from '@rocket.chat/core-typings';\nimport type { Logger } from '@rocket.chat/logger';\nimport { expect, spy } from 'chai';\n\nimport { copyCustomFieldsLDAP } from './copyCustomFieldsLDAP';\n\ndescribe('LDAP copyCustomFieldsLDAP', () => {\n\tit('should copy custom fields from ldapUser to rcUser', () => {\n\t\tconst ldapUser = {\n\t\t\tmail: 'test@test.com',\n\t\t\tgivenName: 'Test',\n\t\t} as unknown as ILDAPEntry;\n\n\t\tconst userData = {\n\t\t\tname: 'Test',\n\t\t\tusername: 'test',\n\t\t} as unknown as IImportUser;\n\n\t\tcopyCustomFieldsLDAP(\n\t\t\t{\n\t\t\t\tldapUser,\n\t\t\t\tuserData,\n\t\t\t\tsyncCustomFields: true,\n\t\t\t\tcustomFieldsSettings: JSON.stringify({\n\t\t\t\t\tmappedGivenName: { type: 'text', required: false },\n\t\t\t\t}),\n\t\t\t\tcustomFieldsMap: JSON.stringify({\n\t\t\t\t\tgivenName: 'mappedGivenName',\n\t\t\t\t}),\n\t\t\t},\n\t\t\t{\n\t\t\t\tdebug: () => undefined,\n\t\t\t\terror: () => undefined,\n\t\t\t} as unknown as Logger,\n\t\t);\n\n\t\texpect(userData).to.have.property('customFields');\n\t\texpect(userData.customFields).to.be.eql({ mappedGivenName: 'Test' });\n\t});\n\n\tit('should copy custom fields from ldapUser to rcUser already having other custom fields', () => {\n\t\tconst ldapUser = {\n\t\t\tmail: 'test@test.com',\n\t\t\tgivenName: 'Test',\n\t\t} as unknown as ILDAPEntry;\n\n\t\tconst userData = {\n\t\t\tname: 'Test',\n\t\t\tusername: 'test',\n\t\t\tcustomFields: {\n\t\t\t\tcustom: 'Test',\n\t\t\t},\n\t\t} as unknown as IImportUser;\n\n\t\tcopyCustomFieldsLDAP(\n\t\t\t{\n\t\t\t\tldapUser,\n\t\t\t\tuserData,\n\t\t\t\tsyncCustomFields: true,\n\t\t\t\tcustomFieldsSettings: JSON.stringify({\n\t\t\t\t\tmappedGivenName: { type: 'text', required: false },\n\t\t\t\t}),\n\t\t\t\tcustomFieldsMap: JSON.stringify({\n\t\t\t\t\tgivenName: 'mappedGivenName',\n\t\t\t\t}),\n\t\t\t},\n\t\t\t{\n\t\t\t\tdebug: () => undefined,\n\t\t\t\terror: () => undefined,\n\t\t\t} as unknown as Logger,\n\t\t);\n\n\t\texpect(userData).to.have.property('customFields');\n\t\texpect(userData.customFields).to.be.eql({ custom: 'Test', mappedGivenName: 'Test' });\n\t});\n\n\tit('should not copy custom fields from ldapUser to rcUser if syncCustomFields is false', () => {\n\t\tconst ldapUser = {\n\t\t\tmail: 'test@test.com',\n\t\t\tgivenName: 'Test',\n\t\t} as unknown as ILDAPEntry;\n\n\t\tconst userData = {\n\t\t\tname: 'Test',\n\t\t\tusername: 'test',\n\t\t} as unknown as IImportUser;\n\n\t\tcopyCustomFieldsLDAP(\n\t\t\t{\n\t\t\t\tldapUser,\n\t\t\t\tuserData,\n\t\t\t\tsyncCustomFields: false,\n\t\t\t\tcustomFieldsSettings: JSON.stringify({\n\t\t\t\t\tmappedGivenName: { type: 'text', required: false },\n\t\t\t\t}),\n\t\t\t\tcustomFieldsMap: JSON.stringify({\n\t\t\t\t\tgivenName: 'mappedGivenName',\n\t\t\t\t}),\n\t\t\t},\n\t\t\t{\n\t\t\t\tdebug: () => undefined,\n\t\t\t\terror: () => undefined,\n\t\t\t} as unknown as Logger,\n\t\t);\n\n\t\texpect(userData).to.not.have.property('customFields');\n\t});\n\n\tit('should call logger.error if customFieldsSettings is not a valid JSON', () => {\n\t\tconst debug = spy();\n\t\tconst error = spy();\n\t\tconst ldapUser = {\n\t\t\tmail: 'test@test.com',\n\t\t\tgivenName: 'Test',\n\t\t} as unknown as ILDAPEntry;\n\n\t\tconst userData = {\n\t\t\tname: 'Test',\n\t\t\tusername: 'test',\n\t\t} as unknown as IImportUser;\n\n\t\tcopyCustomFieldsLDAP(\n\t\t\t{\n\t\t\t\tldapUser,\n\t\t\t\tuserData,\n\t\t\t\tsyncCustomFields: true,\n\t\t\t\tcustomFieldsSettings: `${JSON.stringify({\n\t\t\t\t\tmappedGivenName: { type: 'text', required: false },\n\t\t\t\t})}}`,\n\t\t\t\tcustomFieldsMap: JSON.stringify({\n\t\t\t\t\tgivenName: 'mappedGivenName',\n\t\t\t\t}),\n\t\t\t},\n\t\t\t{\n\t\t\t\tdebug,\n\t\t\t\terror,\n\t\t\t} as unknown as Logger,\n\t\t);\n\t\texpect(error).to.have.been.called.exactly(1);\n\t});\n\tit('should call logger.error if customFieldsMap is not a valid JSON', () => {\n\t\tconst debug = spy();\n\t\tconst error = spy();\n\t\tconst ldapUser = {\n\t\t\tmail: 'test@test.com',\n\t\t\tgivenName: 'Test',\n\t\t} as unknown as ILDAPEntry;\n\n\t\tconst userData = {\n\t\t\tname: 'Test',\n\t\t\tusername: 'test',\n\t\t} as unknown as IImportUser;\n\n\t\tcopyCustomFieldsLDAP(\n\t\t\t{\n\t\t\t\tldapUser,\n\t\t\t\tuserData,\n\t\t\t\tsyncCustomFields: true,\n\t\t\t\tcustomFieldsSettings: JSON.stringify({\n\t\t\t\t\tmappedGivenName: { type: 'text', required: false },\n\t\t\t\t}),\n\t\t\t\tcustomFieldsMap: `${JSON.stringify({\n\t\t\t\t\tgivenName: 'mappedGivenName',\n\t\t\t\t})}}`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tdebug,\n\t\t\t\terror,\n\t\t\t} as unknown as Logger,\n\t\t);\n\t\texpect(error).to.have.been.called.exactly(1);\n\t});\n\n\tit('should call logger.debug if some custom fields are not mapped but still mapping the other fields', () => {\n\t\tconst debug = spy();\n\t\tconst error = spy();\n\t\tconst ldapUser = {\n\t\t\tmail: 'test@test.com',\n\t\t\tgivenName: 'Test',\n\t\t} as unknown as ILDAPEntry;\n\n\t\tconst userData = {\n\t\t\tname: 'Test',\n\t\t\tusername: 'test',\n\t\t} as unknown as IImportUser;\n\n\t\tcopyCustomFieldsLDAP(\n\t\t\t{\n\t\t\t\tldapUser,\n\t\t\t\tuserData,\n\t\t\t\tsyncCustomFields: true,\n\t\t\t\tcustomFieldsSettings: JSON.stringify({\n\t\t\t\t\tmappedGivenName: { type: 'text', required: false },\n\t\t\t\t}),\n\t\t\t\tcustomFieldsMap: JSON.stringify({\n\t\t\t\t\tgivenName: 'mappedGivenName',\n\t\t\t\t\ttest: 'test',\n\t\t\t\t}),\n\t\t\t},\n\t\t\t{\n\t\t\t\tdebug,\n\t\t\t\terror,\n\t\t\t} as unknown as Logger,\n\t\t);\n\t\texpect(debug).to.have.been.called.exactly(1);\n\t\texpect(userData).to.have.property('customFields');\n\t\texpect(userData.customFields).to.be.eql({ mappedGivenName: 'Test' });\n\t});\n});\n"],"names":["describe","it","ldapUser","mail","givenName","userData","name","username","copyCustomFieldsLDAP","syncCustomFields","customFieldsSettings","JSON","stringify","mappedGivenName","type","required","customFieldsMap","debug","undefined","error","expect","to","have","property","customFields","be","eql","custom","not","spy","been","called","exactly","test"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/copyCustomFieldsLDAP.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"596998731162674aacff1a623077cf98547b28f3","contentHash":"d3b9c8b2859b64d2b3e19b1b89a132215ae9a831a712e044f2c1ed1ae0b020ed"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/copyCustomFieldsLDAP.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/copyCustomFieldsLDAP.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":36}},"3":{"start":{"line":11,"column":28},"end":{"line":11,"column":83}},"4":{"start":{"line":12,"column":23},"end":{"line":12,"column":70}},"5":{"start":{"line":13,"column":30},"end":{"line":13,"column":63}},"6":{"start":{"line":14,"column":29},"end":{"line":62,"column":1}},"7":{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},"8":{"start":{"line":16,"column":8},"end":{"line":16,"column":15}},"9":{"start":{"line":18,"column":4},"end":{"line":25,"column":5}},"10":{"start":{"line":19,"column":8},"end":{"line":22,"column":9}},"11":{"start":{"line":20,"column":12},"end":{"line":20,"column":107}},"12":{"start":{"line":21,"column":12},"end":{"line":21,"column":19}},"13":{"start":{"line":23,"column":8},"end":{"line":23,"column":99}},"14":{"start":{"line":24,"column":8},"end":{"line":24,"column":15}},"15":{"start":{"line":26,"column":16},"end":{"line":35,"column":8}},"16":{"start":{"line":27,"column":8},"end":{"line":34,"column":9}},"17":{"start":{"line":28,"column":12},"end":{"line":28,"column":47}},"18":{"start":{"line":30,"column":12},"end":{"line":33,"column":15}},"19":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"20":{"start":{"line":37,"column":8},"end":{"line":37,"column":15}},"21":{"start":{"line":40,"column":4},"end":{"line":48,"column":5}},"22":{"start":{"line":41,"column":8},"end":{"line":41,"column":56}},"23":{"start":{"line":43,"column":8},"end":{"line":46,"column":11}},"24":{"start":{"line":47,"column":8},"end":{"line":47,"column":15}},"25":{"start":{"line":49,"column":4},"end":{"line":61,"column":7}},"26":{"start":{"line":50,"column":8},"end":{"line":53,"column":9}},"27":{"start":{"line":51,"column":12},"end":{"line":51,"column":72}},"28":{"start":{"line":52,"column":12},"end":{"line":52,"column":19}},"29":{"start":{"line":54,"column":22},"end":{"line":54,"column":86}},"30":{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},"31":{"start":{"line":56,"column":12},"end":{"line":56,"column":19}},"32":{"start":{"line":58,"column":8},"end":{"line":60,"column":29}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":29},"end":{"line":14,"column":30}},"loc":{"start":{"line":14,"column":120},"end":{"line":62,"column":1}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":26,"column":17},"end":{"line":26,"column":18}},"loc":{"start":{"line":26,"column":21},"end":{"line":35,"column":5}},"line":26},"3":{"name":"(anonymous_3)","decl":{"start":{"line":49,"column":32},"end":{"line":49,"column":33}},"loc":{"start":{"line":49,"column":58},"end":{"line":61,"column":5}},"line":49}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},"type":"if","locations":[{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},{"start":{"line":15,"column":4},"end":{"line":17,"column":5}}],"line":15},"1":{"loc":{"start":{"line":18,"column":4},"end":{"line":25,"column":5}},"type":"if","locations":[{"start":{"line":18,"column":4},"end":{"line":25,"column":5}},{"start":{"line":18,"column":4},"end":{"line":25,"column":5}}],"line":18},"2":{"loc":{"start":{"line":18,"column":8},"end":{"line":18,"column":49}},"type":"binary-expr","locations":[{"start":{"line":18,"column":8},"end":{"line":18,"column":24}},{"start":{"line":18,"column":28},"end":{"line":18,"column":49}}],"line":18},"3":{"loc":{"start":{"line":19,"column":8},"end":{"line":22,"column":9}},"type":"if","locations":[{"start":{"line":19,"column":8},"end":{"line":22,"column":9}},{"start":{"line":19,"column":8},"end":{"line":22,"column":9}}],"line":19},"4":{"loc":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},{"start":{"line":36,"column":4},"end":{"line":38,"column":5}}],"line":36},"5":{"loc":{"start":{"line":50,"column":8},"end":{"line":53,"column":9}},"type":"if","locations":[{"start":{"line":50,"column":8},"end":{"line":53,"column":9}},{"start":{"line":50,"column":8},"end":{"line":53,"column":9}}],"line":50},"6":{"loc":{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},"type":"if","locations":[{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},{"start":{"line":55,"column":8},"end":{"line":57,"column":9}}],"line":55}},"s":{"0":1,"1":1,"2":6,"3":1,"4":1,"5":1,"6":1,"7":6,"8":1,"9":5,"10":0,"11":0,"12":0,"13":0,"14":0,"15":5,"16":5,"17":5,"18":1,"19":5,"20":1,"21":4,"22":4,"23":1,"24":1,"25":3,"26":4,"27":1,"28":1,"29":3,"30":3,"31":0,"32":3},"f":{"0":6,"1":6,"2":5,"3":4},"b":{"0":[1,5],"1":[0,5],"2":[5,5],"3":[0,0],"4":[1,4],"5":[1,3],"6":[0,3]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/copyCustomFieldsLDAP.ts"],"sourcesContent":["import type { IImportUser, ILDAPEntry } from '@rocket.chat/core-typings';\nimport type { Logger } from '@rocket.chat/logger';\n\nimport { templateVarHandler } from '../../../../app/utils/lib/templateVarHandler';\nimport { getNestedProp } from '../../../../server/lib/getNestedProp';\nimport { replacesNestedValues } from './replacesNestedValues';\n\nexport const copyCustomFieldsLDAP = (\n\t{\n\t\tldapUser,\n\t\tuserData,\n\t\tcustomFieldsSettings,\n\t\tcustomFieldsMap,\n\t\tsyncCustomFields,\n\t}: {\n\t\tldapUser: ILDAPEntry;\n\t\tuserData: IImportUser;\n\t\tsyncCustomFields: boolean;\n\t\tcustomFieldsSettings: string;\n\t\tcustomFieldsMap: string;\n\t},\n\tlogger: Logger,\n): void => {\n\tif (!syncCustomFields) {\n\t\treturn;\n\t}\n\n\tif (!customFieldsMap || !customFieldsSettings) {\n\t\tif (customFieldsMap) {\n\t\t\tlogger.debug('Skipping LDAP custom fields because there are no custom map fields configured.');\n\t\t\treturn;\n\t\t}\n\t\tlogger.debug('Skipping LDAP custom fields because there are no custom fields configured.');\n\t\treturn;\n\t}\n\n\tconst map: Record<string, string> = (() => {\n\t\ttry {\n\t\t\treturn JSON.parse(customFieldsMap);\n\t\t} catch (err) {\n\t\t\tlogger.error({ msg: 'Error parsing LDAP custom fields map.', err });\n\t\t}\n\t})();\n\n\tif (!map) {\n\t\treturn;\n\t}\n\n\tlet customFields: Record<string, any>;\n\ttry {\n\t\tcustomFields = JSON.parse(customFieldsSettings) as Record<string, any>;\n\t} catch (err) {\n\t\tlogger.error({ msg: 'Failed to parse Custom Fields', err });\n\t\treturn;\n\t}\n\n\tObject.entries(map).forEach(([ldapField, userField]) => {\n\t\tif (!getNestedProp(customFields, userField)) {\n\t\t\tlogger.debug(`User attribute does not exist: ${userField}`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst value = templateVarHandler(ldapField, ldapUser);\n\n\t\tif (!value) {\n\t\t\treturn;\n\t\t}\n\n\t\tuserData.customFields = replacesNestedValues({ ...userData.customFields }, userField, value);\n\t});\n};\n"],"names":["copyCustomFieldsLDAP","ldapUser","userData","customFieldsSettings","customFieldsMap","syncCustomFields","logger","debug","map","JSON","parse","err","error","msg","customFields","Object","entries","forEach","ldapField","userField","getNestedProp","value","templateVarHandler","replacesNestedValues"],"mappings":";;;;+BAOaA;;;eAAAA;;;oCAJsB;+BACL;sCACO;AAE9B,MAAMA,uBAAuB,CACnC,EACCC,QAAQ,EACRC,QAAQ,EACRC,oBAAoB,EACpBC,eAAe,EACfC,gBAAgB,EAOhB,EACDC;IAEA,IAAI,CAACD,kBAAkB;QACtB;IACD;IAEA,IAAI,CAACD,mBAAmB,CAACD,sBAAsB;QAC9C,IAAIC,iBAAiB;YACpBE,OAAOC,KAAK,CAAC;YACb;QACD;QACAD,OAAOC,KAAK,CAAC;QACb;IACD;IAEA,MAAMC,MAA8B,AAAC,CAAA;QACpC,IAAI;YACH,OAAOC,KAAKC,KAAK,CAACN;QACnB,EAAE,OAAOO,KAAK;YACbL,OAAOM,KAAK,CAAC;gBAAEC,KAAK;gBAAyCF;YAAI;QAClE;IACD,CAAA;IAEA,IAAI,CAACH,KAAK;QACT;IACD;IAEA,IAAIM;IACJ,IAAI;QACHA,eAAeL,KAAKC,KAAK,CAACP;IAC3B,EAAE,OAAOQ,KAAK;QACbL,OAAOM,KAAK,CAAC;YAAEC,KAAK;YAAiCF;QAAI;QACzD;IACD;IAEAI,OAAOC,OAAO,CAACR,KAAKS,OAAO,CAAC,CAAC,CAACC,WAAWC,UAAU;QAClD,IAAI,CAACC,IAAAA,4BAAa,EAACN,cAAcK,YAAY;YAC5Cb,OAAOC,KAAK,CAAC,CAAC,+BAA+B,EAAEY,WAAW;YAC1D;QACD;QAEA,MAAME,QAAQC,IAAAA,sCAAkB,EAACJ,WAAWjB;QAE5C,IAAI,CAACoB,OAAO;YACX;QACD;QAEAnB,SAASY,YAAY,GAAGS,IAAAA,0CAAoB,EAAC;YAAE,GAAGrB,SAASY,YAAY;QAAC,GAAGK,WAAWE;IACvF;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/copyCustomFieldsLDAP.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f05b4b97dfbbb52e52a7b12691667b7cf4317e6d","contentHash":"3fd9bfd4640f731c1f950dcf1d3b5045a258c8c916746ae8b183903f1f0c42d6"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/templateVarHandler.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/templateVarHandler.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":34}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":15},"end":{"line":12,"column":55}},"5":{"start":{"line":13,"column":27},"end":{"line":38,"column":1}},"6":{"start":{"line":14,"column":26},"end":{"line":14,"column":42}},"7":{"start":{"line":15,"column":16},"end":{"line":15,"column":44}},"8":{"start":{"line":16,"column":22},"end":{"line":16,"column":30}},"9":{"start":{"line":17,"column":4},"end":{"line":23,"column":5}},"10":{"start":{"line":18,"column":8},"end":{"line":21,"column":9}},"11":{"start":{"line":19,"column":12},"end":{"line":19,"column":118}},"12":{"start":{"line":20,"column":12},"end":{"line":20,"column":19}},"13":{"start":{"line":22,"column":8},"end":{"line":22,"column":32}},"14":{"start":{"line":24,"column":4},"end":{"line":24,"column":101}},"15":{"start":{"line":25,"column":4},"end":{"line":36,"column":5}},"16":{"start":{"line":26,"column":24},"end":{"line":26,"column":32}},"17":{"start":{"line":27,"column":29},"end":{"line":27,"column":37}},"18":{"start":{"line":28,"column":8},"end":{"line":31,"column":9}},"19":{"start":{"line":29,"column":12},"end":{"line":29,"column":122}},"20":{"start":{"line":30,"column":12},"end":{"line":30,"column":19}},"21":{"start":{"line":32,"column":24},"end":{"line":32,"column":44}},"22":{"start":{"line":33,"column":8},"end":{"line":33,"column":130}},"23":{"start":{"line":34,"column":8},"end":{"line":34,"column":60}},"24":{"start":{"line":35,"column":8},"end":{"line":35,"column":45}},"25":{"start":{"line":37,"column":4},"end":{"line":37,"column":23}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":27},"end":{"line":13,"column":28}},"loc":{"start":{"line":13,"column":54},"end":{"line":38,"column":1}},"line":13}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":4},"end":{"line":23,"column":5}},"type":"if","locations":[{"start":{"line":17,"column":4},"end":{"line":23,"column":5}},{"start":{"line":17,"column":4},"end":{"line":23,"column":5}}],"line":17},"1":{"loc":{"start":{"line":18,"column":8},"end":{"line":21,"column":9}},"type":"if","locations":[{"start":{"line":18,"column":8},"end":{"line":21,"column":9}},{"start":{"line":18,"column":8},"end":{"line":21,"column":9}}],"line":18},"2":{"loc":{"start":{"line":19,"column":12},"end":{"line":19,"column":117}},"type":"cond-expr","locations":[{"start":{"line":19,"column":51},"end":{"line":19,"column":57}},{"start":{"line":19,"column":60},"end":{"line":19,"column":117}}],"line":19},"3":{"loc":{"start":{"line":19,"column":12},"end":{"line":19,"column":48}},"type":"binary-expr","locations":[{"start":{"line":19,"column":12},"end":{"line":19,"column":27}},{"start":{"line":19,"column":31},"end":{"line":19,"column":48}}],"line":19},"4":{"loc":{"start":{"line":24,"column":4},"end":{"line":24,"column":100}},"type":"cond-expr","locations":[{"start":{"line":24,"column":43},"end":{"line":24,"column":49}},{"start":{"line":24,"column":52},"end":{"line":24,"column":100}}],"line":24},"5":{"loc":{"start":{"line":24,"column":4},"end":{"line":24,"column":40}},"type":"binary-expr","locations":[{"start":{"line":24,"column":4},"end":{"line":24,"column":19}},{"start":{"line":24,"column":23},"end":{"line":24,"column":40}}],"line":24},"6":{"loc":{"start":{"line":28,"column":8},"end":{"line":31,"column":9}},"type":"if","locations":[{"start":{"line":28,"column":8},"end":{"line":31,"column":9}},{"start":{"line":28,"column":8},"end":{"line":31,"column":9}}],"line":28},"7":{"loc":{"start":{"line":29,"column":12},"end":{"line":29,"column":121}},"type":"cond-expr","locations":[{"start":{"line":29,"column":51},"end":{"line":29,"column":57}},{"start":{"line":29,"column":60},"end":{"line":29,"column":121}}],"line":29},"8":{"loc":{"start":{"line":29,"column":12},"end":{"line":29,"column":48}},"type":"binary-expr","locations":[{"start":{"line":29,"column":12},"end":{"line":29,"column":27}},{"start":{"line":29,"column":31},"end":{"line":29,"column":48}}],"line":29},"9":{"loc":{"start":{"line":33,"column":8},"end":{"line":33,"column":129}},"type":"cond-expr","locations":[{"start":{"line":33,"column":47},"end":{"line":33,"column":53}},{"start":{"line":33,"column":56},"end":{"line":33,"column":129}}],"line":33},"10":{"loc":{"start":{"line":33,"column":8},"end":{"line":33,"column":44}},"type":"binary-expr","locations":[{"start":{"line":33,"column":8},"end":{"line":33,"column":23}},{"start":{"line":33,"column":27},"end":{"line":33,"column":44}}],"line":33}},"s":{"0":1,"1":1,"2":3,"3":1,"4":1,"5":1,"6":3,"7":3,"8":3,"9":3,"10":3,"11":0,"12":0,"13":3,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0},"f":{"0":3,"1":3},"b":{"0":[3,0],"1":[0,3],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/templateVarHandler.ts"],"sourcesContent":["import { Logger } from '@rocket.chat/logger';\n\nconst logger = new Logger('TemplateVarHandler');\n\nexport const templateVarHandler = function (variable: string, object: Record<string, any>): string | undefined {\n\tconst templateRegex = /#{([\\w\\-]+)}/gi;\n\tlet match = templateRegex.exec(variable);\n\tlet tmpVariable = variable;\n\n\tif (match == null) {\n\t\tif (!object.hasOwnProperty(variable)) {\n\t\t\tlogger?.debug(`user does not have attribute: ${variable}`);\n\t\t\treturn;\n\t\t}\n\t\treturn object[variable];\n\t}\n\tlogger?.debug('template found. replacing values');\n\twhile (match != null) {\n\t\tconst tmplVar = match[0];\n\t\tconst tmplAttrName = match[1];\n\n\t\tif (!object.hasOwnProperty(tmplAttrName)) {\n\t\t\tlogger?.debug(`user does not have attribute: ${tmplAttrName}`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst attrVal = object[tmplAttrName];\n\t\tlogger?.debug(`replacing template var: ${tmplVar} with value: ${attrVal}`);\n\t\ttmpVariable = tmpVariable.replace(tmplVar, attrVal);\n\t\tmatch = templateRegex.exec(variable);\n\t}\n\treturn tmpVariable;\n};\n"],"names":["templateVarHandler","logger","Logger","variable","object","templateRegex","match","exec","tmpVariable","hasOwnProperty","debug","tmplVar","tmplAttrName","attrVal","replace"],"mappings":";;;;+BAIaA;;;eAAAA;;;wBAJU;AAEvB,MAAMC,SAAS,IAAIC,cAAM,CAAC;AAEnB,MAAMF,qBAAqB,SAAUG,QAAgB,EAAEC,MAA2B;IACxF,MAAMC,gBAAgB;IACtB,IAAIC,QAAQD,cAAcE,IAAI,CAACJ;IAC/B,IAAIK,cAAcL;IAElB,IAAIG,SAAS,MAAM;QAClB,IAAI,CAACF,OAAOK,cAAc,CAACN,WAAW;YACrCF,mBAAAA,6BAAAA,OAAQS,KAAK,CAAC,CAAC,8BAA8B,EAAEP,UAAU;YACzD;QACD;QACA,OAAOC,MAAM,CAACD,SAAS;IACxB;IACAF,mBAAAA,6BAAAA,OAAQS,KAAK,CAAC;IACd,MAAOJ,SAAS,KAAM;QACrB,MAAMK,UAAUL,KAAK,CAAC,EAAE;QACxB,MAAMM,eAAeN,KAAK,CAAC,EAAE;QAE7B,IAAI,CAACF,OAAOK,cAAc,CAACG,eAAe;YACzCX,mBAAAA,6BAAAA,OAAQS,KAAK,CAAC,CAAC,8BAA8B,EAAEE,cAAc;YAC7D;QACD;QAEA,MAAMC,UAAUT,MAAM,CAACQ,aAAa;QACpCX,mBAAAA,6BAAAA,OAAQS,KAAK,CAAC,CAAC,wBAAwB,EAAEC,QAAQ,aAAa,EAAEE,SAAS;QACzEL,cAAcA,YAAYM,OAAO,CAACH,SAASE;QAC3CP,QAAQD,cAAcE,IAAI,CAACJ;IAC5B;IACA,OAAOK;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/templateVarHandler.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5d6a14078a5b0fe28adfa9be1c756b8b3cc501cf","contentHash":"7da66364a8c51e0e0e68745e3e0581ce3ac80f56b1c8ca4c6a9301a638185056"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/getNestedProp.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/getNestedProp.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":29}},"3":{"start":{"line":11,"column":22},"end":{"line":17,"column":1}},"4":{"start":{"line":12,"column":4},"end":{"line":16,"column":5}},"5":{"start":{"line":13,"column":8},"end":{"line":13,"column":76}},"6":{"start":{"line":13,"column":53},"end":{"line":13,"column":60}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":22},"end":{"line":11,"column":23}},"loc":{"start":{"line":11,"column":48},"end":{"line":17,"column":1}},"line":11},"2":{"name":"(anonymous_2)","decl":{"start":{"line":13,"column":42},"end":{"line":13,"column":43}},"loc":{"start":{"line":13,"column":53},"end":{"line":13,"column":60}},"line":13}},"branchMap":{},"s":{"0":1,"1":1,"2":4,"3":1,"4":4,"5":4,"6":4},"f":{"0":4,"1":4,"2":4},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/getNestedProp.ts"],"sourcesContent":["export const getNestedProp = (customFields: Record<string, any>, property: string): unknown => {\n\ttry {\n\t\treturn property.split('.').reduce((acc, el) => acc[el], customFields);\n\t} catch {\n\t\t// ignore errors\n\t}\n};\n"],"names":["getNestedProp","customFields","property","split","reduce","acc","el"],"mappings":";;;;+BAAaA;;;eAAAA;;;AAAN,MAAMA,gBAAgB,CAACC,cAAmCC;IAChE,IAAI;QACH,OAAOA,SAASC,KAAK,CAAC,KAAKC,MAAM,CAAC,CAACC,KAAKC,KAAOD,GAAG,CAACC,GAAG,EAAEL;IACzD,EAAE,UAAM;IACP,gBAAgB;IACjB;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/getNestedProp.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3122c2b1a0b00d13799e773456c1f7edd33a3912","contentHash":"67595650d72cf76a1e0dc3b281c6a003651f6481b699ad782d4b4553be03582c"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/replacesNestedValues.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/replacesNestedValues.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":36}},"3":{"start":{"line":11,"column":29},"end":{"line":32,"column":1}},"4":{"start":{"line":12,"column":17},"end":{"line":12,"column":31}},"5":{"start":{"line":13,"column":20},"end":{"line":13,"column":32}},"6":{"start":{"line":14,"column":4},"end":{"line":16,"column":5}},"7":{"start":{"line":15,"column":8},"end":{"line":15,"column":65}},"8":{"start":{"line":17,"column":4},"end":{"line":19,"column":5}},"9":{"start":{"line":18,"column":8},"end":{"line":18,"column":65}},"10":{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},"11":{"start":{"line":21,"column":8},"end":{"line":21,"column":65}},"12":{"start":{"line":23,"column":4},"end":{"line":31,"column":6}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":29},"end":{"line":11,"column":30}},"loc":{"start":{"line":11,"column":48},"end":{"line":32,"column":1}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":14,"column":4},"end":{"line":16,"column":5}},"type":"if","locations":[{"start":{"line":14,"column":4},"end":{"line":16,"column":5}},{"start":{"line":14,"column":4},"end":{"line":16,"column":5}}],"line":14},"1":{"loc":{"start":{"line":17,"column":4},"end":{"line":19,"column":5}},"type":"if","locations":[{"start":{"line":17,"column":4},"end":{"line":19,"column":5}},{"start":{"line":17,"column":4},"end":{"line":19,"column":5}}],"line":17},"2":{"loc":{"start":{"line":17,"column":8},"end":{"line":17,"column":118}},"type":"binary-expr","locations":[{"start":{"line":17,"column":8},"end":{"line":17,"column":19}},{"start":{"line":17,"column":23},"end":{"line":17,"column":49}},{"start":{"line":17,"column":54},"end":{"line":17,"column":86}},{"start":{"line":17,"column":90},"end":{"line":17,"column":117}}],"line":17},"3":{"loc":{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},"type":"if","locations":[{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},{"start":{"line":20,"column":4},"end":{"line":22,"column":5}}],"line":20},"4":{"loc":{"start":{"line":20,"column":8},"end":{"line":20,"column":61}},"type":"binary-expr","locations":[{"start":{"line":20,"column":8},"end":{"line":20,"column":25}},{"start":{"line":20,"column":29},"end":{"line":20,"column":61}}],"line":20},"5":{"loc":{"start":{"line":25,"column":11},"end":{"line":27,"column":9}},"type":"binary-expr","locations":[{"start":{"line":25,"column":11},"end":{"line":25,"column":28}},{"start":{"line":25,"column":32},"end":{"line":27,"column":9}}],"line":25},"6":{"loc":{"start":{"line":28,"column":11},"end":{"line":30,"column":9}},"type":"binary-expr","locations":[{"start":{"line":28,"column":11},"end":{"line":28,"column":26}},{"start":{"line":28,"column":30},"end":{"line":30,"column":9}}],"line":28}},"s":{"0":1,"1":1,"2":10,"3":1,"4":13,"5":13,"6":13,"7":0,"8":13,"9":2,"10":11,"11":1,"12":10},"f":{"0":10,"1":13},"b":{"0":[0,13],"1":[2,11],"2":[13,5,5,4],"3":[1,10],"4":[11,8],"5":[10,7],"6":[10,3]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/replacesNestedValues.ts"],"sourcesContent":["export const replacesNestedValues = (obj: Record<string, unknown>, key: string, value: unknown): Record<string, unknown> => {\n\tconst keys = key.split('.');\n\tconst lastKey = keys.shift();\n\n\tif (!lastKey) {\n\t\tthrow new Error(`Failed to assign custom field: ${key}`);\n\t}\n\n\tif (keys.length && obj[lastKey] !== undefined && (typeof obj[lastKey] !== 'object' || Array.isArray(obj[lastKey]))) {\n\t\tthrow new Error(`Failed to assign custom field: ${key}`);\n\t}\n\n\tif (keys.length === 0 && typeof obj[lastKey] === 'object') {\n\t\tthrow new Error(`Failed to assign custom field: ${key}`);\n\t}\n\n\treturn {\n\t\t...obj,\n\t\t...(keys.length === 0 && {\n\t\t\t[lastKey]: value,\n\t\t}),\n\t\t...(keys.length > 0 && {\n\t\t\t[lastKey]: replacesNestedValues(obj[lastKey] as Record<string, unknown>, keys.join('.'), value),\n\t\t}),\n\t};\n};\n"],"names":["replacesNestedValues","obj","key","value","keys","split","lastKey","shift","Error","length","undefined","Array","isArray","join"],"mappings":";;;;+BAAaA;;;eAAAA;;;AAAN,MAAMA,uBAAuB,CAACC,KAA8BC,KAAaC;IAC/E,MAAMC,OAAOF,IAAIG,KAAK,CAAC;IACvB,MAAMC,UAAUF,KAAKG,KAAK;IAE1B,IAAI,CAACD,SAAS;QACb,MAAM,IAAIE,MAAM,CAAC,+BAA+B,EAAEN,KAAK;IACxD;IAEA,IAAIE,KAAKK,MAAM,IAAIR,GAAG,CAACK,QAAQ,KAAKI,aAAc,CAAA,OAAOT,GAAG,CAACK,QAAQ,KAAK,YAAYK,MAAMC,OAAO,CAACX,GAAG,CAACK,QAAQ,CAAA,GAAI;QACnH,MAAM,IAAIE,MAAM,CAAC,+BAA+B,EAAEN,KAAK;IACxD;IAEA,IAAIE,KAAKK,MAAM,KAAK,KAAK,OAAOR,GAAG,CAACK,QAAQ,KAAK,UAAU;QAC1D,MAAM,IAAIE,MAAM,CAAC,+BAA+B,EAAEN,KAAK;IACxD;IAEA,OAAO;QACN,GAAGD,GAAG;QACN,GAAIG,KAAKK,MAAM,KAAK,KAAK;YACxB,CAACH,QAAQ,EAAEH;QACZ,CAAC;QACD,GAAIC,KAAKK,MAAM,GAAG,KAAK;YACtB,CAACH,QAAQ,EAAEN,qBAAqBC,GAAG,CAACK,QAAQ,EAA6BF,KAAKS,IAAI,CAAC,MAAMV;QAC1F,CAAC;IACF;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/replacesNestedValues.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f1e17e1bfa653fb6c30eaa9163354f043ba8165a","contentHash":"d297abd4caf4aa387250a71bb9f27fbf0c30414b1917a103630eb18e690848ed"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/replacesNestedValues.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/replacesNestedValues.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":30},"end":{"line":6,"column":63}},"3":{"start":{"line":7,"column":0},"end":{"line":57,"column":3}},"4":{"start":{"line":8,"column":4},"end":{"line":15,"column":7}},"5":{"start":{"line":9,"column":23},"end":{"line":11,"column":18}},"6":{"start":{"line":12,"column":8},"end":{"line":14,"column":11}},"7":{"start":{"line":16,"column":4},"end":{"line":21,"column":7}},"8":{"start":{"line":17,"column":23},"end":{"line":17,"column":82}},"9":{"start":{"line":18,"column":8},"end":{"line":20,"column":11}},"10":{"start":{"line":22,"column":4},"end":{"line":33,"column":7}},"11":{"start":{"line":23,"column":23},"end":{"line":27,"column":20}},"12":{"start":{"line":28,"column":8},"end":{"line":32,"column":11}},"13":{"start":{"line":34,"column":4},"end":{"line":43,"column":7}},"14":{"start":{"line":35,"column":23},"end":{"line":37,"column":20}},"15":{"start":{"line":38,"column":8},"end":{"line":42,"column":11}},"16":{"start":{"line":44,"column":4},"end":{"line":56,"column":7}},"17":{"start":{"line":45,"column":8},"end":{"line":47,"column":37}},"18":{"start":{"line":45,"column":30},"end":{"line":47,"column":24}},"19":{"start":{"line":48,"column":8},"end":{"line":50,"column":37}},"20":{"start":{"line":48,"column":30},"end":{"line":50,"column":24}},"21":{"start":{"line":51,"column":8},"end":{"line":55,"column":37}},"22":{"start":{"line":51,"column":30},"end":{"line":55,"column":24}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":38},"end":{"line":7,"column":39}},"loc":{"start":{"line":7,"column":42},"end":{"line":57,"column":1}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":8,"column":40},"end":{"line":8,"column":41}},"loc":{"start":{"line":8,"column":44},"end":{"line":15,"column":5}},"line":8},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":42},"end":{"line":16,"column":43}},"loc":{"start":{"line":16,"column":46},"end":{"line":21,"column":5}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":22,"column":39},"end":{"line":22,"column":40}},"loc":{"start":{"line":22,"column":43},"end":{"line":33,"column":5}},"line":22},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":49},"end":{"line":34,"column":50}},"loc":{"start":{"line":34,"column":53},"end":{"line":43,"column":5}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":44,"column":67},"end":{"line":44,"column":68}},"loc":{"start":{"line":44,"column":71},"end":{"line":56,"column":5}},"line":44},"6":{"name":"(anonymous_6)","decl":{"start":{"line":45,"column":26},"end":{"line":45,"column":27}},"loc":{"start":{"line":45,"column":30},"end":{"line":47,"column":24}},"line":45},"7":{"name":"(anonymous_7)","decl":{"start":{"line":48,"column":26},"end":{"line":48,"column":27}},"loc":{"start":{"line":48,"column":30},"end":{"line":50,"column":24}},"line":48},"8":{"name":"(anonymous_8)","decl":{"start":{"line":51,"column":26},"end":{"line":51,"column":27}},"loc":{"start":{"line":51,"column":30},"end":{"line":55,"column":24}},"line":51}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1},"f":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/replacesNestedValues.spec.ts"],"sourcesContent":["import { expect } from 'chai';\n\nimport { replacesNestedValues } from './replacesNestedValues';\n\ndescribe('LDAP replacesNestedValues', () => {\n\tit('should replace shallow values', () => {\n\t\tconst result = replacesNestedValues(\n\t\t\t{\n\t\t\t\ta: 1,\n\t\t\t},\n\t\t\t'a',\n\t\t\t2,\n\t\t);\n\t\texpect(result).to.eql({\n\t\t\ta: 2,\n\t\t});\n\t});\n\n\tit('should replace undefined values', () => {\n\t\tconst result = replacesNestedValues({}, 'a', 2);\n\t\texpect(result).to.eql({\n\t\t\ta: 2,\n\t\t});\n\t});\n\n\tit('should replace nested values', () => {\n\t\tconst result = replacesNestedValues(\n\t\t\t{\n\t\t\t\ta: {\n\t\t\t\t\tb: 1,\n\t\t\t\t},\n\t\t\t},\n\t\t\t'a.b',\n\t\t\t2,\n\t\t);\n\t\texpect(result).to.eql({\n\t\t\ta: {\n\t\t\t\tb: 2,\n\t\t\t},\n\t\t});\n\t});\n\tit('should replace undefined nested values', () => {\n\t\tconst result = replacesNestedValues(\n\t\t\t{\n\t\t\t\ta: {},\n\t\t\t},\n\t\t\t'a.b',\n\t\t\t2,\n\t\t);\n\t\texpect(result).to.eql({\n\t\t\ta: {\n\t\t\t\tb: 2,\n\t\t\t},\n\t\t});\n\t});\n\n\tit('should fail if the value being replaced is not an object', () => {\n\t\texpect(() =>\n\t\t\treplacesNestedValues(\n\t\t\t\t{\n\t\t\t\t\ta: [],\n\t\t\t\t},\n\t\t\t\t'a.b',\n\t\t\t\t2,\n\t\t\t),\n\t\t).to.throw();\n\t\texpect(() =>\n\t\t\treplacesNestedValues(\n\t\t\t\t{\n\t\t\t\t\ta: 1,\n\t\t\t\t},\n\t\t\t\t'a.b',\n\t\t\t\t2,\n\t\t\t),\n\t\t).to.throw();\n\n\t\texpect(() =>\n\t\t\treplacesNestedValues(\n\t\t\t\t{\n\t\t\t\t\ta: { b: [] },\n\t\t\t\t},\n\t\t\t\t'a.b',\n\t\t\t\t2,\n\t\t\t),\n\t\t).to.throw();\n\t});\n});\n"],"names":["describe","it","result","replacesNestedValues","a","expect","to","eql","b","throw"],"mappings":";;;;sBAAuB;sCAEc;AAErCA,SAAS,6BAA6B;IACrCC,GAAG,iCAAiC;QACnC,MAAMC,SAASC,IAAAA,0CAAoB,EAClC;YACCC,GAAG;QACJ,GACA,KACA;QAEDC,IAAAA,YAAM,EAACH,QAAQI,EAAE,CAACC,GAAG,CAAC;YACrBH,GAAG;QACJ;IACD;IAEAH,GAAG,mCAAmC;QACrC,MAAMC,SAASC,IAAAA,0CAAoB,EAAC,CAAC,GAAG,KAAK;QAC7CE,IAAAA,YAAM,EAACH,QAAQI,EAAE,CAACC,GAAG,CAAC;YACrBH,GAAG;QACJ;IACD;IAEAH,GAAG,gCAAgC;QAClC,MAAMC,SAASC,IAAAA,0CAAoB,EAClC;YACCC,GAAG;gBACFI,GAAG;YACJ;QACD,GACA,OACA;QAEDH,IAAAA,YAAM,EAACH,QAAQI,EAAE,CAACC,GAAG,CAAC;YACrBH,GAAG;gBACFI,GAAG;YACJ;QACD;IACD;IACAP,GAAG,0CAA0C;QAC5C,MAAMC,SAASC,IAAAA,0CAAoB,EAClC;YACCC,GAAG,CAAC;QACL,GACA,OACA;QAEDC,IAAAA,YAAM,EAACH,QAAQI,EAAE,CAACC,GAAG,CAAC;YACrBH,GAAG;gBACFI,GAAG;YACJ;QACD;IACD;IAEAP,GAAG,4DAA4D;QAC9DI,IAAAA,YAAM,EAAC,IACNF,IAAAA,0CAAoB,EACnB;gBACCC,GAAG,EAAE;YACN,GACA,OACA,IAEAE,EAAE,CAACG,KAAK;QACVJ,IAAAA,YAAM,EAAC,IACNF,IAAAA,0CAAoB,EACnB;gBACCC,GAAG;YACJ,GACA,OACA,IAEAE,EAAE,CAACG,KAAK;QAEVJ,IAAAA,YAAM,EAAC,IACNF,IAAAA,0CAAoB,EACnB;gBACCC,GAAG;oBAAEI,GAAG,EAAE;gBAAC;YACZ,GACA,OACA,IAEAF,EAAE,CAACG,KAAK;IACX;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/ldap/replacesNestedValues.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4eb4b96c165752638f70f1b053588c5179dac738","contentHash":"501366015e8c07cd6deee92d5ac32274bc1a2843d19ad2c4fb8a71a99be8f86d"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/livechat-enterprise/lib/AutoCloseOnHold.tests.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/livechat-enterprise/lib/AutoCloseOnHold.tests.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":28},"end":{"line":5,"column":70}},"2":{"start":{"line":6,"column":36},"end":{"line":6,"column":86}},"3":{"start":{"line":7,"column":15},"end":{"line":7,"column":31}},"4":{"start":{"line":8,"column":30},"end":{"line":8,"column":73}},"5":{"start":{"line":9,"column":34},"end":{"line":9,"column":81}},"6":{"start":{"line":10,"column":29},"end":{"line":10,"column":71}},"7":{"start":{"line":12,"column":4},"end":{"line":14,"column":6}},"8":{"start":{"line":17,"column":4},"end":{"line":17,"column":51}},"9":{"start":{"line":17,"column":39},"end":{"line":17,"column":51}},"10":{"start":{"line":18,"column":28},"end":{"line":18,"column":41}},"11":{"start":{"line":19,"column":27},"end":{"line":19,"column":40}},"12":{"start":{"line":20,"column":4},"end":{"line":22,"column":20}},"13":{"start":{"line":21,"column":8},"end":{"line":21,"column":66}},"14":{"start":{"line":25,"column":4},"end":{"line":27,"column":5}},"15":{"start":{"line":26,"column":8},"end":{"line":26,"column":19}},"16":{"start":{"line":28,"column":4},"end":{"line":32,"column":5}},"17":{"start":{"line":29,"column":8},"end":{"line":31,"column":10}},"18":{"start":{"line":33,"column":16},"end":{"line":33,"column":53}},"19":{"start":{"line":34,"column":4},"end":{"line":36,"column":5}},"20":{"start":{"line":35,"column":8},"end":{"line":35,"column":30}},"21":{"start":{"line":37,"column":17},"end":{"line":39,"column":5}},"22":{"start":{"line":40,"column":32},"end":{"line":40,"column":88}},"23":{"start":{"line":41,"column":4},"end":{"line":50,"column":5}},"24":{"start":{"line":42,"column":8},"end":{"line":49,"column":9}},"25":{"start":{"line":43,"column":23},"end":{"line":43,"column":95}},"26":{"start":{"line":44,"column":12},"end":{"line":48,"column":13}},"27":{"start":{"line":45,"column":16},"end":{"line":45,"column":57}},"28":{"start":{"line":47,"column":16},"end":{"line":47,"column":39}},"29":{"start":{"line":51,"column":4},"end":{"line":51,"column":25}},"30":{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},"31":{"start":{"line":53,"column":8},"end":{"line":53,"column":31}},"32":{"start":{"line":55,"column":4},"end":{"line":55,"column":18}},"33":{"start":{"line":57,"column":0},"end":{"line":57,"column":41}},"34":{"start":{"line":58,"column":30},"end":{"line":58,"column":51}},"35":{"start":{"line":59,"column":24},"end":{"line":59,"column":45}},"36":{"start":{"line":60,"column":28},"end":{"line":60,"column":49}},"37":{"start":{"line":61,"column":25},"end":{"line":61,"column":46}},"38":{"start":{"line":62,"column":25},"end":{"line":62,"column":46}},"39":{"start":{"line":63,"column":30},"end":{"line":63,"column":51}},"40":{"start":{"line":64,"column":26},"end":{"line":64,"column":47}},"41":{"start":{"line":65,"column":26},"end":{"line":67,"column":1}},"42":{"start":{"line":68,"column":18},"end":{"line":70,"column":1}},"43":{"start":{"line":71,"column":22},"end":{"line":87,"column":1}},"44":{"start":{"line":73,"column":8},"end":{"line":73,"column":33}},"45":{"start":{"line":76,"column":8},"end":{"line":76,"column":44}},"46":{"start":{"line":79,"column":8},"end":{"line":79,"column":41}},"47":{"start":{"line":82,"column":8},"end":{"line":82,"column":41}},"48":{"start":{"line":85,"column":8},"end":{"line":85,"column":36}},"49":{"start":{"line":88,"column":17},"end":{"line":88,"column":38}},"50":{"start":{"line":89,"column":18},"end":{"line":89,"column":39}},"51":{"start":{"line":90,"column":19},"end":{"line":95,"column":1}},"52":{"start":{"line":96,"column":14},"end":{"line":130,"column":1}},"53":{"start":{"line":108,"column":16},"end":{"line":114,"column":18}},"54":{"start":{"line":131,"column":42},"end":{"line":131,"column":164}},"55":{"start":{"line":132,"column":0},"end":{"line":308,"column":3}},"56":{"start":{"line":133,"column":4},"end":{"line":135,"column":7}},"57":{"start":{"line":134,"column":8},"end":{"line":134,"column":41}},"58":{"start":{"line":136,"column":4},"end":{"line":138,"column":7}},"59":{"start":{"line":137,"column":8},"end":{"line":137,"column":64}},"60":{"start":{"line":139,"column":4},"end":{"line":157,"column":7}},"61":{"start":{"line":140,"column":8},"end":{"line":143,"column":11}},"62":{"start":{"line":141,"column":12},"end":{"line":141,"column":43}},"63":{"start":{"line":142,"column":12},"end":{"line":142,"column":47}},"64":{"start":{"line":144,"column":8},"end":{"line":149,"column":11}},"65":{"start":{"line":145,"column":30},"end":{"line":145,"column":65}},"66":{"start":{"line":146,"column":12},"end":{"line":146,"column":37}},"67":{"start":{"line":147,"column":12},"end":{"line":147,"column":35}},"68":{"start":{"line":148,"column":12},"end":{"line":148,"column":70}},"69":{"start":{"line":150,"column":8},"end":{"line":156,"column":11}},"70":{"start":{"line":151,"column":30},"end":{"line":151,"column":65}},"71":{"start":{"line":152,"column":12},"end":{"line":152,"column":35}},"72":{"start":{"line":153,"column":12},"end":{"line":153,"column":69}},"73":{"start":{"line":154,"column":12},"end":{"line":154,"column":60}},"74":{"start":{"line":155,"column":12},"end":{"line":155,"column":81}},"75":{"start":{"line":158,"column":4},"end":{"line":185,"column":7}},"76":{"start":{"line":159,"column":8},"end":{"line":162,"column":11}},"77":{"start":{"line":160,"column":12},"end":{"line":160,"column":44}},"78":{"start":{"line":161,"column":12},"end":{"line":161,"column":44}},"79":{"start":{"line":163,"column":8},"end":{"line":170,"column":11}},"80":{"start":{"line":164,"column":30},"end":{"line":164,"column":65}},"81":{"start":{"line":165,"column":12},"end":{"line":169,"column":13}},"82":{"start":{"line":166,"column":16},"end":{"line":166,"column":74}},"83":{"start":{"line":168,"column":16},"end":{"line":168,"column":97}},"84":{"start":{"line":171,"column":8},"end":{"line":184,"column":11}},"85":{"start":{"line":172,"column":30},"end":{"line":172,"column":65}},"86":{"start":{"line":173,"column":12},"end":{"line":173,"column":35}},"87":{"start":{"line":174,"column":12},"end":{"line":174,"column":70}},"88":{"start":{"line":175,"column":35},"end":{"line":175,"column":88}},"89":{"start":{"line":176,"column":12},"end":{"line":176,"column":90}},"90":{"start":{"line":177,"column":12},"end":{"line":179,"column":16}},"91":{"start":{"line":180,"column":12},"end":{"line":180,"column":115}},"92":{"start":{"line":181,"column":37},"end":{"line":181,"column":76}},"93":{"start":{"line":182,"column":12},"end":{"line":182,"column":85}},"94":{"start":{"line":183,"column":12},"end":{"line":183,"column":118}},"95":{"start":{"line":186,"column":4},"end":{"line":206,"column":7}},"96":{"start":{"line":187,"column":8},"end":{"line":189,"column":11}},"97":{"start":{"line":188,"column":12},"end":{"line":188,"column":44}},"98":{"start":{"line":190,"column":8},"end":{"line":197,"column":11}},"99":{"start":{"line":191,"column":30},"end":{"line":191,"column":65}},"100":{"start":{"line":192,"column":12},"end":{"line":196,"column":13}},"101":{"start":{"line":193,"column":16},"end":{"line":193,"column":57}},"102":{"start":{"line":195,"column":16},"end":{"line":195,"column":97}},"103":{"start":{"line":198,"column":8},"end":{"line":205,"column":11}},"104":{"start":{"line":199,"column":30},"end":{"line":199,"column":65}},"105":{"start":{"line":200,"column":12},"end":{"line":200,"column":35}},"106":{"start":{"line":201,"column":12},"end":{"line":201,"column":53}},"107":{"start":{"line":202,"column":12},"end":{"line":204,"column":16}},"108":{"start":{"line":207,"column":4},"end":{"line":277,"column":7}},"109":{"start":{"line":208,"column":8},"end":{"line":212,"column":11}},"110":{"start":{"line":209,"column":12},"end":{"line":209,"column":49}},"111":{"start":{"line":210,"column":12},"end":{"line":210,"column":50}},"112":{"start":{"line":211,"column":12},"end":{"line":211,"column":42}},"113":{"start":{"line":213,"column":8},"end":{"line":231,"column":11}},"114":{"start":{"line":214,"column":30},"end":{"line":214,"column":65}},"115":{"start":{"line":215,"column":12},"end":{"line":215,"column":56}},"116":{"start":{"line":216,"column":12},"end":{"line":218,"column":15}},"117":{"start":{"line":219,"column":12},"end":{"line":230,"column":13}},"118":{"start":{"line":220,"column":16},"end":{"line":227,"column":19}},"119":{"start":{"line":229,"column":16},"end":{"line":229,"column":180}},"120":{"start":{"line":232,"column":8},"end":{"line":250,"column":11}},"121":{"start":{"line":233,"column":30},"end":{"line":233,"column":65}},"122":{"start":{"line":234,"column":12},"end":{"line":236,"column":15}},"123":{"start":{"line":237,"column":12},"end":{"line":237,"column":48}},"124":{"start":{"line":238,"column":12},"end":{"line":249,"column":13}},"125":{"start":{"line":239,"column":16},"end":{"line":246,"column":19}},"126":{"start":{"line":248,"column":16},"end":{"line":248,"column":85}},"127":{"start":{"line":251,"column":8},"end":{"line":276,"column":11}},"128":{"start":{"line":252,"column":30},"end":{"line":252,"column":65}},"129":{"start":{"line":253,"column":12},"end":{"line":255,"column":15}},"130":{"start":{"line":256,"column":12},"end":{"line":258,"column":15}},"131":{"start":{"line":259,"column":12},"end":{"line":266,"column":15}},"132":{"start":{"line":267,"column":12},"end":{"line":275,"column":16}},"133":{"start":{"line":278,"column":4},"end":{"line":307,"column":7}},"134":{"start":{"line":279,"column":8},"end":{"line":281,"column":11}},"135":{"start":{"line":280,"column":12},"end":{"line":280,"column":42}},"136":{"start":{"line":282,"column":8},"end":{"line":289,"column":11}},"137":{"start":{"line":283,"column":30},"end":{"line":283,"column":65}},"138":{"start":{"line":284,"column":12},"end":{"line":286,"column":14}},"139":{"start":{"line":287,"column":25},"end":{"line":287,"column":59}},"140":{"start":{"line":288,"column":12},"end":{"line":288,"column":73}},"141":{"start":{"line":290,"column":8},"end":{"line":298,"column":11}},"142":{"start":{"line":291,"column":30},"end":{"line":291,"column":65}},"143":{"start":{"line":292,"column":12},"end":{"line":292,"column":48}},"144":{"start":{"line":293,"column":12},"end":{"line":297,"column":13}},"145":{"start":{"line":294,"column":16},"end":{"line":294,"column":51}},"146":{"start":{"line":296,"column":16},"end":{"line":296,"column":85}},"147":{"start":{"line":299,"column":8},"end":{"line":306,"column":11}},"148":{"start":{"line":300,"column":30},"end":{"line":300,"column":65}},"149":{"start":{"line":301,"column":12},"end":{"line":303,"column":15}},"150":{"start":{"line":304,"column":22},"end":{"line":304,"column":56}},"151":{"start":{"line":305,"column":12},"end":{"line":305,"column":87}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":33}},"loc":{"start":{"line":11,"column":39},"end":{"line":15,"column":1}},"line":11},"1":{"name":"_getRequireWildcardCache","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":33}},"loc":{"start":{"line":16,"column":47},"end":{"line":23,"column":1}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":20,"column":39},"end":{"line":20,"column":40}},"loc":{"start":{"line":20,"column":61},"end":{"line":22,"column":5}},"line":20},"3":{"name":"_interop_require_wildcard","decl":{"start":{"line":24,"column":9},"end":{"line":24,"column":34}},"loc":{"start":{"line":24,"column":53},"end":{"line":56,"column":1}},"line":24},"4":{"name":"(anonymous_4)","decl":{"start":{"line":72,"column":4},"end":{"line":72,"column":5}},"loc":{"start":{"line":72,"column":18},"end":{"line":74,"column":5}},"line":72},"5":{"name":"(anonymous_5)","decl":{"start":{"line":75,"column":4},"end":{"line":75,"column":5}},"loc":{"start":{"line":75,"column":28},"end":{"line":77,"column":5}},"line":75},"6":{"name":"(anonymous_6)","decl":{"start":{"line":78,"column":4},"end":{"line":78,"column":5}},"loc":{"start":{"line":78,"column":26},"end":{"line":80,"column":5}},"line":78},"7":{"name":"(anonymous_7)","decl":{"start":{"line":81,"column":4},"end":{"line":81,"column":5}},"loc":{"start":{"line":81,"column":26},"end":{"line":83,"column":5}},"line":81},"8":{"name":"(anonymous_8)","decl":{"start":{"line":84,"column":4},"end":{"line":84,"column":5}},"loc":{"start":{"line":84,"column":21},"end":{"line":86,"column":5}},"line":84},"9":{"name":"(anonymous_9)","decl":{"start":{"line":107,"column":43},"end":{"line":107,"column":44}},"loc":{"start":{"line":107,"column":47},"end":{"line":115,"column":13}},"line":107},"10":{"name":"(anonymous_10)","decl":{"start":{"line":132,"column":49},"end":{"line":132,"column":50}},"loc":{"start":{"line":132,"column":53},"end":{"line":308,"column":1}},"line":132},"11":{"name":"(anonymous_11)","decl":{"start":{"line":133,"column":27},"end":{"line":133,"column":28}},"loc":{"start":{"line":133,"column":31},"end":{"line":135,"column":5}},"line":133},"12":{"name":"(anonymous_12)","decl":{"start":{"line":136,"column":68},"end":{"line":136,"column":69}},"loc":{"start":{"line":136,"column":72},"end":{"line":138,"column":5}},"line":136},"13":{"name":"(anonymous_13)","decl":{"start":{"line":139,"column":33},"end":{"line":139,"column":34}},"loc":{"start":{"line":139,"column":37},"end":{"line":157,"column":5}},"line":139},"14":{"name":"(anonymous_14)","decl":{"start":{"line":140,"column":31},"end":{"line":140,"column":32}},"loc":{"start":{"line":140,"column":35},"end":{"line":143,"column":9}},"line":140},"15":{"name":"(anonymous_15)","decl":{"start":{"line":144,"column":76},"end":{"line":144,"column":77}},"loc":{"start":{"line":144,"column":86},"end":{"line":149,"column":9}},"line":144},"16":{"name":"(anonymous_16)","decl":{"start":{"line":150,"column":64},"end":{"line":150,"column":65}},"loc":{"start":{"line":150,"column":74},"end":{"line":156,"column":9}},"line":150},"17":{"name":"(anonymous_17)","decl":{"start":{"line":158,"column":41},"end":{"line":158,"column":42}},"loc":{"start":{"line":158,"column":45},"end":{"line":185,"column":5}},"line":158},"18":{"name":"(anonymous_18)","decl":{"start":{"line":159,"column":31},"end":{"line":159,"column":32}},"loc":{"start":{"line":159,"column":35},"end":{"line":162,"column":9}},"line":159},"19":{"name":"(anonymous_19)","decl":{"start":{"line":163,"column":69},"end":{"line":163,"column":70}},"loc":{"start":{"line":163,"column":79},"end":{"line":170,"column":9}},"line":163},"20":{"name":"(anonymous_20)","decl":{"start":{"line":171,"column":49},"end":{"line":171,"column":50}},"loc":{"start":{"line":171,"column":59},"end":{"line":184,"column":9}},"line":171},"21":{"name":"(anonymous_21)","decl":{"start":{"line":186,"column":43},"end":{"line":186,"column":44}},"loc":{"start":{"line":186,"column":47},"end":{"line":206,"column":5}},"line":186},"22":{"name":"(anonymous_22)","decl":{"start":{"line":187,"column":31},"end":{"line":187,"column":32}},"loc":{"start":{"line":187,"column":35},"end":{"line":189,"column":9}},"line":187},"23":{"name":"(anonymous_23)","decl":{"start":{"line":190,"column":69},"end":{"line":190,"column":70}},"loc":{"start":{"line":190,"column":79},"end":{"line":197,"column":9}},"line":190},"24":{"name":"(anonymous_24)","decl":{"start":{"line":198,"column":67},"end":{"line":198,"column":68}},"loc":{"start":{"line":198,"column":77},"end":{"line":205,"column":9}},"line":198},"25":{"name":"(anonymous_25)","decl":{"start":{"line":207,"column":39},"end":{"line":207,"column":40}},"loc":{"start":{"line":207,"column":43},"end":{"line":277,"column":5}},"line":207},"26":{"name":"(anonymous_26)","decl":{"start":{"line":208,"column":31},"end":{"line":208,"column":32}},"loc":{"start":{"line":208,"column":35},"end":{"line":212,"column":9}},"line":208},"27":{"name":"(anonymous_27)","decl":{"start":{"line":213,"column":60},"end":{"line":213,"column":61}},"loc":{"start":{"line":213,"column":70},"end":{"line":231,"column":9}},"line":213},"28":{"name":"(anonymous_28)","decl":{"start":{"line":232,"column":85},"end":{"line":232,"column":86}},"loc":{"start":{"line":232,"column":95},"end":{"line":250,"column":9}},"line":232},"29":{"name":"(anonymous_29)","decl":{"start":{"line":251,"column":78},"end":{"line":251,"column":79}},"loc":{"start":{"line":251,"column":88},"end":{"line":276,"column":9}},"line":251},"30":{"name":"(anonymous_30)","decl":{"start":{"line":278,"column":45},"end":{"line":278,"column":46}},"loc":{"start":{"line":278,"column":49},"end":{"line":307,"column":5}},"line":278},"31":{"name":"(anonymous_31)","decl":{"start":{"line":279,"column":31},"end":{"line":279,"column":32}},"loc":{"start":{"line":279,"column":35},"end":{"line":281,"column":9}},"line":279},"32":{"name":"(anonymous_32)","decl":{"start":{"line":282,"column":78},"end":{"line":282,"column":79}},"loc":{"start":{"line":282,"column":88},"end":{"line":289,"column":9}},"line":282},"33":{"name":"(anonymous_33)","decl":{"start":{"line":290,"column":69},"end":{"line":290,"column":70}},"loc":{"start":{"line":290,"column":79},"end":{"line":298,"column":9}},"line":290},"34":{"name":"(anonymous_34)","decl":{"start":{"line":299,"column":51},"end":{"line":299,"column":52}},"loc":{"start":{"line":299,"column":61},"end":{"line":306,"column":9}},"line":299}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":11},"end":{"line":14,"column":5}},"type":"cond-expr","locations":[{"start":{"line":12,"column":35},"end":{"line":12,"column":38}},{"start":{"line":12,"column":41},"end":{"line":14,"column":5}}],"line":12},"1":{"loc":{"start":{"line":12,"column":11},"end":{"line":12,"column":32}},"type":"binary-expr","locations":[{"start":{"line":12,"column":11},"end":{"line":12,"column":14}},{"start":{"line":12,"column":18},"end":{"line":12,"column":32}}],"line":12},"2":{"loc":{"start":{"line":17,"column":4},"end":{"line":17,"column":51}},"type":"if","locations":[{"start":{"line":17,"column":4},"end":{"line":17,"column":51}},{"start":{"line":17,"column":4},"end":{"line":17,"column":51}}],"line":17},"3":{"loc":{"start":{"line":21,"column":15},"end":{"line":21,"column":65}},"type":"cond-expr","locations":[{"start":{"line":21,"column":29},"end":{"line":21,"column":45}},{"start":{"line":21,"column":48},"end":{"line":21,"column":65}}],"line":21},"4":{"loc":{"start":{"line":25,"column":4},"end":{"line":27,"column":5}},"type":"if","locations":[{"start":{"line":25,"column":4},"end":{"line":27,"column":5}},{"start":{"line":25,"column":4},"end":{"line":27,"column":5}}],"line":25},"5":{"loc":{"start":{"line":25,"column":8},"end":{"line":25,"column":45}},"type":"binary-expr","locations":[{"start":{"line":25,"column":8},"end":{"line":25,"column":20}},{"start":{"line":25,"column":24},"end":{"line":25,"column":27}},{"start":{"line":25,"column":31},"end":{"line":25,"column":45}}],"line":25},"6":{"loc":{"start":{"line":28,"column":4},"end":{"line":32,"column":5}},"type":"if","locations":[{"start":{"line":28,"column":4},"end":{"line":32,"column":5}},{"start":{"line":28,"column":4},"end":{"line":32,"column":5}}],"line":28},"7":{"loc":{"start":{"line":28,"column":8},"end":{"line":28,"column":76}},"type":"binary-expr","locations":[{"start":{"line":28,"column":8},"end":{"line":28,"column":20}},{"start":{"line":28,"column":24},"end":{"line":28,"column":47}},{"start":{"line":28,"column":51},"end":{"line":28,"column":76}}],"line":28},"8":{"loc":{"start":{"line":34,"column":4},"end":{"line":36,"column":5}},"type":"if","locations":[{"start":{"line":34,"column":4},"end":{"line":36,"column":5}},{"start":{"line":34,"column":4},"end":{"line":36,"column":5}}],"line":34},"9":{"loc":{"start":{"line":34,"column":8},"end":{"line":34,"column":31}},"type":"binary-expr","locations":[{"start":{"line":34,"column":8},"end":{"line":34,"column":13}},{"start":{"line":34,"column":17},"end":{"line":34,"column":31}}],"line":34},"10":{"loc":{"start":{"line":40,"column":32},"end":{"line":40,"column":88}},"type":"binary-expr","locations":[{"start":{"line":40,"column":32},"end":{"line":40,"column":53}},{"start":{"line":40,"column":57},"end":{"line":40,"column":88}}],"line":40},"11":{"loc":{"start":{"line":42,"column":8},"end":{"line":49,"column":9}},"type":"if","locations":[{"start":{"line":42,"column":8},"end":{"line":49,"column":9}},{"start":{"line":42,"column":8},"end":{"line":49,"column":9}}],"line":42},"12":{"loc":{"start":{"line":42,"column":12},"end":{"line":42,"column":79}},"type":"binary-expr","locations":[{"start":{"line":42,"column":12},"end":{"line":42,"column":29}},{"start":{"line":42,"column":33},"end":{"line":42,"column":79}}],"line":42},"13":{"loc":{"start":{"line":43,"column":23},"end":{"line":43,"column":95}},"type":"cond-expr","locations":[{"start":{"line":43,"column":47},"end":{"line":43,"column":88}},{"start":{"line":43,"column":91},"end":{"line":43,"column":95}}],"line":43},"14":{"loc":{"start":{"line":44,"column":12},"end":{"line":48,"column":13}},"type":"if","locations":[{"start":{"line":44,"column":12},"end":{"line":48,"column":13}},{"start":{"line":44,"column":12},"end":{"line":48,"column":13}}],"line":44},"15":{"loc":{"start":{"line":44,"column":16},"end":{"line":44,"column":46}},"type":"binary-expr","locations":[{"start":{"line":44,"column":16},"end":{"line":44,"column":20}},{"start":{"line":44,"column":25},"end":{"line":44,"column":33}},{"start":{"line":44,"column":37},"end":{"line":44,"column":45}}],"line":44},"16":{"loc":{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},"type":"if","locations":[{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},{"start":{"line":52,"column":4},"end":{"line":54,"column":5}}],"line":52}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":4,"8":1,"9":0,"10":1,"11":1,"12":1,"13":1,"14":1,"15":0,"16":1,"17":0,"18":1,"19":1,"20":0,"21":1,"22":1,"23":1,"24":12,"25":12,"26":12,"27":0,"28":12,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":3,"45":1,"46":2,"47":1,"48":3,"49":1,"50":1,"51":1,"52":1,"53":3,"54":1,"55":1,"56":1,"57":13,"58":1,"59":1,"60":1,"61":1,"62":2,"63":2,"64":1,"65":1,"66":1,"67":1,"68":1,"69":1,"70":1,"71":1,"72":1,"73":1,"74":1,"75":1,"76":1,"77":2,"78":2,"79":1,"80":1,"81":1,"82":1,"83":1,"84":1,"85":1,"86":1,"87":1,"88":1,"89":1,"90":1,"91":1,"92":1,"93":1,"94":1,"95":1,"96":1,"97":2,"98":1,"99":1,"100":1,"101":1,"102":1,"103":1,"104":1,"105":1,"106":1,"107":1,"108":1,"109":1,"110":3,"111":3,"112":3,"113":1,"114":1,"115":1,"116":1,"117":1,"118":1,"119":1,"120":1,"121":1,"122":1,"123":1,"124":1,"125":1,"126":1,"127":1,"128":1,"129":1,"130":1,"131":1,"132":1,"133":1,"134":1,"135":3,"136":1,"137":1,"138":1,"139":1,"140":1,"141":1,"142":1,"143":1,"144":1,"145":1,"146":1,"147":1,"148":1,"149":1,"150":1,"151":1},"f":{"0":4,"1":1,"2":1,"3":1,"4":3,"5":1,"6":2,"7":1,"8":3,"9":3,"10":1,"11":13,"12":1,"13":1,"14":2,"15":1,"16":1,"17":1,"18":2,"19":1,"20":1,"21":1,"22":2,"23":1,"24":1,"25":1,"26":3,"27":1,"28":1,"29":1,"30":1,"31":3,"32":1,"33":1,"34":1},"b":{"0":[0,4],"1":[4,4],"2":[0,1],"3":[0,1],"4":[0,1],"5":[1,1,1],"6":[0,1],"7":[1,1,0],"8":[0,1],"9":[1,1],"10":[1,1],"11":[12,0],"12":[12,12],"13":[12,0],"14":[0,12],"15":[12,12,12],"16":[1,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/livechat-enterprise/lib/AutoCloseOnHold.tests.ts"],"sourcesContent":["import chai, { expect } from 'chai';\nimport chaiDateTime from 'chai-datetime';\nimport { beforeEach, describe, it } from 'mocha';\nimport moment from 'moment';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\nchai.use(chaiDateTime);\n\nconst mockAgendaConstructor = sinon.stub();\nconst mockAgendaStart = sinon.stub();\nconst mockAgendaScheduler = sinon.stub();\nconst mockAgendaCancel = sinon.stub();\nconst mockAgendaDefine = sinon.stub();\nconst mockLivechatCloseRoom = sinon.stub();\nconst mockMeteorStartup = sinon.stub();\nconst mockLivechatRooms = {\n\tfindOneById: sinon.stub(),\n};\nconst mockUsers = {\n\tfindOneById: sinon.stub(),\n};\n\nclass MockAgendaClass {\n\tconstructor(opts: Record<string, any>) {\n\t\tmockAgendaConstructor(opts);\n\t}\n\n\tasync start() {\n\t\treturn mockAgendaStart();\n\t}\n\n\tasync schedule(...args: any) {\n\t\treturn mockAgendaScheduler(...args);\n\t}\n\n\tasync cancel(...args: any) {\n\t\treturn mockAgendaCancel(...args);\n\t}\n\n\tasync define(...args: any) {\n\t\treturn mockAgendaDefine(...args);\n\t}\n}\n\nconst infoStub = sinon.stub();\nconst debugStub = sinon.stub();\nconst mockLogger = {\n\tsection: sinon.stub().returns({\n\t\tinfo: infoStub,\n\t\tdebug: debugStub,\n\t}),\n};\n\nconst mocks = {\n\t'@rocket.chat/agenda': { Agenda: MockAgendaClass },\n\t'meteor/meteor': { Meteor: { startup: mockMeteorStartup } },\n\t'meteor/mongo': {\n\t\tMongoInternals: {\n\t\t\tdefaultRemoteCollectionDriver: () => {\n\t\t\t\treturn {\n\t\t\t\t\tmongo: { client: { db: sinon.stub() } },\n\t\t\t\t};\n\t\t\t},\n\t\t},\n\t},\n\t'../../../../../app/livechat/server/lib/LivechatTyped': { Livechat: { closeRoom: mockLivechatCloseRoom } },\n\t'./logger': { schedulerLogger: mockLogger },\n\t'@rocket.chat/models': {\n\t\tLivechatRooms: mockLivechatRooms,\n\t\tUsers: mockUsers,\n\t},\n};\n\nconst { AutoCloseOnHoldSchedulerClass } = proxyquire\n\t.noCallThru()\n\t.load('../../../../../app/livechat-enterprise/server/lib/AutoCloseOnHoldScheduler', mocks);\n\ndescribe('AutoCloseOnHoldScheduler', () => {\n\tbeforeEach(() => {\n\t\tmockMeteorStartup.resetHistory();\n\t});\n\n\tit('should call logger.section upon instantiating', () => {\n\t\texpect(mockLogger.section.called).to.be.true;\n\t});\n\n\tdescribe('init', () => {\n\t\tbeforeEach(() => {\n\t\t\tmockAgendaStart.resetHistory();\n\t\t\tmockAgendaScheduler.resetHistory();\n\t\t});\n\n\t\tit('should do nothing if scheduler is already running', async () => {\n\t\t\tconst scheduler = new AutoCloseOnHoldSchedulerClass();\n\t\t\tscheduler.running = true;\n\n\t\t\tawait scheduler.init();\n\n\t\t\texpect(mockAgendaScheduler.called).to.be.false;\n\t\t});\n\n\t\tit('should succesfully init the scheduler', async () => {\n\t\t\tconst scheduler = new AutoCloseOnHoldSchedulerClass();\n\n\t\t\tawait scheduler.init();\n\n\t\t\texpect(mockAgendaStart.calledOnce).to.be.true;\n\t\t\texpect(scheduler.running).to.be.true;\n\t\t\texpect(infoStub.calledWith('Service started')).to.be.true;\n\t\t});\n\t});\n\n\tdescribe('scheduleRoom', () => {\n\t\tbeforeEach(() => {\n\t\t\tmockAgendaCancel.resetHistory();\n\t\t\tmockAgendaDefine.resetHistory();\n\t\t});\n\n\t\tit('should fail if scheduler has not been init', async () => {\n\t\t\tconst scheduler = new AutoCloseOnHoldSchedulerClass();\n\n\t\t\ttry {\n\t\t\t\tawait scheduler.scheduleRoom('roomId', 5, 'test comment');\n\t\t\t} catch (e: any) {\n\t\t\t\texpect(e.message).to.equal('AutoCloseOnHoldScheduler is not running');\n\t\t\t}\n\t\t});\n\n\t\tit('should schedule a room', async () => {\n\t\t\tconst scheduler = new AutoCloseOnHoldSchedulerClass();\n\n\t\t\tawait scheduler.init();\n\t\t\tawait scheduler.scheduleRoom('roomId', 5, 'test comment');\n\n\t\t\tconst myScheduleTime = moment(new Date()).add(5, 's').toDate();\n\t\t\texpect(mockAgendaCancel.calledBefore(mockAgendaDefine)).to.be.true;\n\t\t\texpect(mockAgendaCancel.calledWith({ name: 'omnichannel_auto_close_on_hold_scheduler-roomId' }));\n\t\t\texpect(mockAgendaDefine.calledWithMatch('omnichannel_auto_close_on_hold_scheduler-roomId'));\n\t\t\tconst funcScheduleTime = mockAgendaScheduler.getCall(0).firstArg;\n\n\t\t\texpect(funcScheduleTime).to.be.closeToTime(myScheduleTime, 5);\n\t\t\texpect(mockAgendaScheduler.calledWithMatch('omnichannel_auto_close_on_hold_scheduler-roomId'));\n\t\t});\n\t});\n\n\tdescribe('unscheduleRoom', () => {\n\t\tbeforeEach(() => {\n\t\t\tmockAgendaCancel.resetHistory();\n\t\t});\n\n\t\tit('should fail if scheduler has not been init', async () => {\n\t\t\tconst scheduler = new AutoCloseOnHoldSchedulerClass();\n\n\t\t\ttry {\n\t\t\t\tawait scheduler.unscheduleRoom('roomId');\n\t\t\t} catch (e: any) {\n\t\t\t\texpect(e.message).to.equal('AutoCloseOnHoldScheduler is not running');\n\t\t\t}\n\t\t});\n\n\t\tit('should call .cancel to unschedule a room', async () => {\n\t\t\tconst scheduler = new AutoCloseOnHoldSchedulerClass();\n\n\t\t\tawait scheduler.init();\n\n\t\t\tawait scheduler.unscheduleRoom('roomId');\n\n\t\t\texpect(mockAgendaCancel.calledWith({ name: 'omnichannel_auto_close_on_hold_scheduler-roomId' }));\n\t\t});\n\t});\n\n\tdescribe('executeJob', () => {\n\t\tbeforeEach(() => {\n\t\t\tmockLivechatCloseRoom.resetHistory();\n\t\t\tmockLivechatRooms.findOneById.reset();\n\t\t\tmockUsers.findOneById.reset();\n\t\t});\n\n\t\tit('should throw if roomId is invalid', async () => {\n\t\t\tconst scheduler = new AutoCloseOnHoldSchedulerClass();\n\n\t\t\tmockLivechatRooms.findOneById.returns(null);\n\t\t\tmockUsers.findOneById.returns({ _id: 'rocket.cat' });\n\n\t\t\ttry {\n\t\t\t\tawait scheduler.executeJob({ attrs: { data: { roomId: 'roomId', comment: 'comment' } } });\n\t\t\t} catch (e: any) {\n\t\t\t\texpect(e.message).to.be.equal(\n\t\t\t\t\t'Unable to process AutoCloseOnHoldScheduler job because room or user not found for roomId: roomId and userId: rocket.cat',\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\tit('should throw if user returned from scheduleUser is invalid', async () => {\n\t\t\tconst scheduler = new AutoCloseOnHoldSchedulerClass();\n\n\t\t\tmockLivechatRooms.findOneById.returns({ _id: 'me' });\n\t\t\tmockUsers.findOneById.returns(null);\n\n\t\t\ttry {\n\t\t\t\tawait scheduler.executeJob({ attrs: { data: { roomId: 'roomId', comment: 'comment' } } });\n\t\t\t} catch (e: any) {\n\t\t\t\texpect(e.message).to.be.equal('Scheduler user not found');\n\t\t\t}\n\t\t});\n\n\t\tit('should call Livechat.closeRoom if all data is valid', async () => {\n\t\t\tconst scheduler = new AutoCloseOnHoldSchedulerClass();\n\n\t\t\tmockLivechatRooms.findOneById.returns({ _id: 'me' });\n\t\t\tmockUsers.findOneById.returns({ _id: 'rocket.cat' });\n\n\t\t\tawait scheduler.executeJob({ attrs: { data: { roomId: 'roomId', comment: 'comment' } } });\n\n\t\t\texpect(mockLivechatCloseRoom.calledWithMatch({ room: { _id: 'me' }, user: { _id: 'rocket.cat' }, comment: 'comment' }));\n\t\t});\n\t});\n\n\tdescribe('getSchedulerUser', () => {\n\t\tbeforeEach(() => {\n\t\t\tmockUsers.findOneById.reset();\n\t\t});\n\n\t\tit('should do nothing when schedulerUser is already set', async () => {\n\t\t\tconst scheduler = new AutoCloseOnHoldSchedulerClass();\n\t\t\tscheduler.schedulerUser = { _id: 'me' };\n\n\t\t\tconst user = await scheduler.getSchedulerUser();\n\n\t\t\texpect(user).to.be.equal(scheduler.schedulerUser);\n\t\t});\n\n\t\tit('should fail when rocket.cat does not exist', async () => {\n\t\t\tconst scheduler = new AutoCloseOnHoldSchedulerClass();\n\n\t\t\tmockUsers.findOneById.returns(null);\n\n\t\t\ttry {\n\t\t\t\tawait scheduler.getSchedulerUser();\n\t\t\t} catch (e: any) {\n\t\t\t\texpect(e.message).to.be.equal('Scheduler user not found');\n\t\t\t}\n\t\t});\n\n\t\tit('should return rocket.cat', async () => {\n\t\t\tconst scheduler = new AutoCloseOnHoldSchedulerClass();\n\n\t\t\tmockUsers.findOneById.returns({ _id: 'rocket.cat' });\n\n\t\t\tconst u = await scheduler.getSchedulerUser();\n\n\t\t\texpect(u).to.be.an('object').with.property('_id', 'rocket.cat');\n\t\t});\n\t});\n});\n"],"names":["chai","use","chaiDateTime","mockAgendaConstructor","sinon","stub","mockAgendaStart","mockAgendaScheduler","mockAgendaCancel","mockAgendaDefine","mockLivechatCloseRoom","mockMeteorStartup","mockLivechatRooms","findOneById","mockUsers","MockAgendaClass","start","schedule","args","cancel","define","constructor","opts","infoStub","debugStub","mockLogger","section","returns","info","debug","mocks","Agenda","Meteor","startup","MongoInternals","defaultRemoteCollectionDriver","mongo","client","db","Livechat","closeRoom","schedulerLogger","LivechatRooms","Users","AutoCloseOnHoldSchedulerClass","proxyquire","noCallThru","load","describe","beforeEach","resetHistory","it","expect","called","to","be","true","scheduler","running","init","false","calledOnce","calledWith","scheduleRoom","e","message","equal","myScheduleTime","moment","Date","add","toDate","calledBefore","name","calledWithMatch","funcScheduleTime","getCall","firstArg","closeToTime","unscheduleRoom","reset","_id","executeJob","attrs","data","roomId","comment","room","user","schedulerUser","getSchedulerUser","u","an","with","property"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/livechat-enterprise/lib/AutoCloseOnHold.tests.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4c60c1036dda5bcda4931e88d889a17089e4eb3e","contentHash":"cda5b715abb6e431316e90d3d98b6f331021ce1e81ea749b83e9fe0d497cd42e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/lib/AutoCloseOnHoldScheduler.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/lib/AutoCloseOnHoldScheduler.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":40}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":45}},"6":{"start":{"line":19,"column":16},"end":{"line":19,"column":46}},"7":{"start":{"line":20,"column":16},"end":{"line":20,"column":46}},"8":{"start":{"line":21,"column":16},"end":{"line":21,"column":40}},"9":{"start":{"line":22,"column":15},"end":{"line":22,"column":38}},"10":{"start":{"line":23,"column":30},"end":{"line":23,"column":73}},"11":{"start":{"line":24,"column":23},"end":{"line":24,"column":86}},"12":{"start":{"line":25,"column":16},"end":{"line":25,"column":35}},"13":{"start":{"line":27,"column":4},"end":{"line":29,"column":6}},"14":{"start":{"line":31,"column":23},"end":{"line":31,"column":65}},"15":{"start":{"line":32,"column":36},"end":{"line":103,"column":1}},"16":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"17":{"start":{"line":35,"column":12},"end":{"line":35,"column":19}},"18":{"start":{"line":37,"column":8},"end":{"line":44,"column":11}},"19":{"start":{"line":45,"column":8},"end":{"line":45,"column":37}},"20":{"start":{"line":46,"column":8},"end":{"line":46,"column":28}},"21":{"start":{"line":47,"column":8},"end":{"line":47,"column":44}},"22":{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},"23":{"start":{"line":51,"column":12},"end":{"line":51,"column":71}},"24":{"start":{"line":53,"column":8},"end":{"line":53,"column":90}},"25":{"start":{"line":54,"column":8},"end":{"line":54,"column":42}},"26":{"start":{"line":55,"column":24},"end":{"line":55,"column":53}},"27":{"start":{"line":56,"column":21},"end":{"line":56,"column":80}},"28":{"start":{"line":57,"column":8},"end":{"line":57,"column":67}},"29":{"start":{"line":58,"column":8},"end":{"line":61,"column":11}},"30":{"start":{"line":64,"column":8},"end":{"line":66,"column":9}},"31":{"start":{"line":65,"column":12},"end":{"line":65,"column":71}},"32":{"start":{"line":67,"column":8},"end":{"line":67,"column":57}},"33":{"start":{"line":68,"column":24},"end":{"line":68,"column":53}},"34":{"start":{"line":69,"column":8},"end":{"line":71,"column":11}},"35":{"start":{"line":74,"column":8},"end":{"line":74,"column":67}},"36":{"start":{"line":75,"column":36},"end":{"line":75,"column":40}},"37":{"start":{"line":76,"column":29},"end":{"line":79,"column":10}},"38":{"start":{"line":80,"column":8},"end":{"line":82,"column":9}},"39":{"start":{"line":81,"column":12},"end":{"line":81,"column":154}},"40":{"start":{"line":83,"column":24},"end":{"line":87,"column":9}},"41":{"start":{"line":88,"column":8},"end":{"line":88,"column":57}},"42":{"start":{"line":91,"column":8},"end":{"line":97,"column":9}},"43":{"start":{"line":92,"column":34},"end":{"line":92,"column":79}},"44":{"start":{"line":93,"column":12},"end":{"line":95,"column":13}},"45":{"start":{"line":94,"column":16},"end":{"line":94,"column":60}},"46":{"start":{"line":96,"column":12},"end":{"line":96,"column":47}},"47":{"start":{"line":98,"column":8},"end":{"line":98,"column":34}},"48":{"start":{"line":101,"column":8},"end":{"line":101,"column":82}},"49":{"start":{"line":104,"column":33},"end":{"line":104,"column":68}},"50":{"start":{"line":105,"column":0},"end":{"line":107,"column":3}},"51":{"start":{"line":106,"column":4},"end":{"line":106,"column":41}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":30},"end":{"line":12,"column":31}},"loc":{"start":{"line":12,"column":41},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":35},"end":{"line":15,"column":36}},"loc":{"start":{"line":15,"column":46},"end":{"line":17,"column":5}},"line":15},"3":{"name":"_interop_require_default","decl":{"start":{"line":26,"column":9},"end":{"line":26,"column":33}},"loc":{"start":{"line":26,"column":39},"end":{"line":30,"column":1}},"line":26},"4":{"name":"(anonymous_4)","decl":{"start":{"line":33,"column":4},"end":{"line":33,"column":5}},"loc":{"start":{"line":33,"column":17},"end":{"line":48,"column":5}},"line":33},"5":{"name":"(anonymous_5)","decl":{"start":{"line":49,"column":4},"end":{"line":49,"column":5}},"loc":{"start":{"line":49,"column":49},"end":{"line":62,"column":5}},"line":49},"6":{"name":"(anonymous_6)","decl":{"start":{"line":63,"column":4},"end":{"line":63,"column":5}},"loc":{"start":{"line":63,"column":33},"end":{"line":72,"column":5}},"line":63},"7":{"name":"(anonymous_7)","decl":{"start":{"line":73,"column":4},"end":{"line":73,"column":5}},"loc":{"start":{"line":73,"column":47},"end":{"line":89,"column":5}},"line":73},"8":{"name":"(anonymous_8)","decl":{"start":{"line":90,"column":4},"end":{"line":90,"column":5}},"loc":{"start":{"line":90,"column":29},"end":{"line":99,"column":5}},"line":90},"9":{"name":"(anonymous_9)","decl":{"start":{"line":100,"column":4},"end":{"line":100,"column":5}},"loc":{"start":{"line":100,"column":17},"end":{"line":102,"column":5}},"line":100},"10":{"name":"(anonymous_10)","decl":{"start":{"line":105,"column":23},"end":{"line":105,"column":24}},"loc":{"start":{"line":105,"column":27},"end":{"line":107,"column":1}},"line":105}},"branchMap":{"0":{"loc":{"start":{"line":27,"column":11},"end":{"line":29,"column":5}},"type":"cond-expr","locations":[{"start":{"line":27,"column":35},"end":{"line":27,"column":38}},{"start":{"line":27,"column":41},"end":{"line":29,"column":5}}],"line":27},"1":{"loc":{"start":{"line":27,"column":11},"end":{"line":27,"column":32}},"type":"binary-expr","locations":[{"start":{"line":27,"column":11},"end":{"line":27,"column":14}},{"start":{"line":27,"column":18},"end":{"line":27,"column":32}}],"line":27},"2":{"loc":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"type":"if","locations":[{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},{"start":{"line":34,"column":8},"end":{"line":36,"column":9}}],"line":34},"3":{"loc":{"start":{"line":43,"column":26},"end":{"line":43,"column":85}},"type":"cond-expr","locations":[{"start":{"line":43,"column":61},"end":{"line":43,"column":72}},{"start":{"line":43,"column":75},"end":{"line":43,"column":85}}],"line":43},"4":{"loc":{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},"type":"if","locations":[{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},{"start":{"line":50,"column":8},"end":{"line":52,"column":9}}],"line":50},"5":{"loc":{"start":{"line":64,"column":8},"end":{"line":66,"column":9}},"type":"if","locations":[{"start":{"line":64,"column":8},"end":{"line":66,"column":9}},{"start":{"line":64,"column":8},"end":{"line":66,"column":9}}],"line":64},"6":{"loc":{"start":{"line":73,"column":21},"end":{"line":73,"column":45}},"type":"default-arg","locations":[{"start":{"line":73,"column":43},"end":{"line":73,"column":45}}],"line":73},"7":{"loc":{"start":{"line":80,"column":8},"end":{"line":82,"column":9}},"type":"if","locations":[{"start":{"line":80,"column":8},"end":{"line":82,"column":9}},{"start":{"line":80,"column":8},"end":{"line":82,"column":9}}],"line":80},"8":{"loc":{"start":{"line":80,"column":12},"end":{"line":80,"column":26}},"type":"binary-expr","locations":[{"start":{"line":80,"column":12},"end":{"line":80,"column":17}},{"start":{"line":80,"column":21},"end":{"line":80,"column":26}}],"line":80},"9":{"loc":{"start":{"line":91,"column":8},"end":{"line":97,"column":9}},"type":"if","locations":[{"start":{"line":91,"column":8},"end":{"line":97,"column":9}},{"start":{"line":91,"column":8},"end":{"line":97,"column":9}}],"line":91},"10":{"loc":{"start":{"line":93,"column":12},"end":{"line":95,"column":13}},"type":"if","locations":[{"start":{"line":93,"column":12},"end":{"line":95,"column":13}},{"start":{"line":93,"column":12},"end":{"line":95,"column":13}}],"line":93}},"s":{"0":1,"1":1,"2":2,"3":1,"4":0,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":4,"17":1,"18":3,"19":3,"20":3,"21":3,"22":2,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":3,"31":1,"32":2,"33":2,"34":2,"35":3,"36":3,"37":3,"38":2,"39":1,"40":1,"41":1,"42":6,"43":5,"44":5,"45":2,"46":3,"47":4,"48":13,"49":1,"50":1,"51":0},"f":{"0":1,"1":0,"2":1,"3":1,"4":4,"5":2,"6":3,"7":3,"8":6,"9":13,"10":0},"b":{"0":[0,1],"1":[1,1],"2":[1,3],"3":[0,3],"4":[1,1],"5":[1,2],"6":[0],"7":[1,1],"8":[2,1],"9":[5,1],"10":[2,3]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/lib/AutoCloseOnHoldScheduler.ts"],"sourcesContent":["import { Agenda } from '@rocket.chat/agenda';\nimport type { IUser } from '@rocket.chat/core-typings';\nimport type { MainLogger } from '@rocket.chat/logger';\nimport { LivechatRooms, Users } from '@rocket.chat/models';\nimport { Meteor } from 'meteor/meteor';\nimport { MongoInternals } from 'meteor/mongo';\nimport moment from 'moment';\n\nimport { Livechat } from '../../../../../app/livechat/server/lib/LivechatTyped';\nimport { schedulerLogger } from './logger';\n\nconst SCHEDULER_NAME = 'omnichannel_auto_close_on_hold_scheduler';\n\nexport class AutoCloseOnHoldSchedulerClass {\n\tscheduler: Agenda;\n\n\tschedulerUser: IUser;\n\n\trunning: boolean;\n\n\tlogger: MainLogger;\n\n\tconstructor() {\n\t\tthis.logger = schedulerLogger.section('AutoCloseOnHoldScheduler');\n\t}\n\n\tpublic async init(): Promise<void> {\n\t\tif (this.running) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.scheduler = new Agenda({\n\t\t\tmongo: (MongoInternals.defaultRemoteCollectionDriver().mongo as any).client.db(),\n\t\t\tdb: { collection: SCHEDULER_NAME },\n\t\t\tdefaultConcurrency: 1,\n\t\t\tprocessEvery: process.env.TEST_MODE === 'true' ? '3 seconds' : '1 minute',\n\t\t});\n\n\t\tawait this.scheduler.start();\n\t\tthis.running = true;\n\t\tthis.logger.info('Service started');\n\t}\n\n\tpublic async scheduleRoom(roomId: string, timeout: number, comment: string): Promise<void> {\n\t\tif (!this.running) {\n\t\t\tthrow new Error('AutoCloseOnHoldScheduler is not running');\n\t\t}\n\n\t\tthis.logger.debug(`Scheduling room ${roomId} to be closed in ${timeout} seconds`);\n\t\tawait this.unscheduleRoom(roomId);\n\n\t\tconst jobName = `${SCHEDULER_NAME}-${roomId}`;\n\t\tconst when = moment(new Date()).add(timeout, 's').toDate();\n\n\t\tthis.scheduler.define(jobName, this.executeJob.bind(this));\n\t\tawait this.scheduler.schedule(when, jobName, { roomId, comment });\n\t}\n\n\tpublic async unscheduleRoom(roomId: string): Promise<void> {\n\t\tif (!this.running) {\n\t\t\tthrow new Error('AutoCloseOnHoldScheduler is not running');\n\t\t}\n\t\tthis.logger.debug(`Unscheduling room ${roomId}`);\n\t\tconst jobName = `${SCHEDULER_NAME}-${roomId}`;\n\t\tawait this.scheduler.cancel({ name: jobName });\n\t}\n\n\tprivate async executeJob({ attrs: { data } }: any = {}): Promise<void> {\n\t\tthis.logger.debug(`Executing job for room ${data.roomId}`);\n\t\tconst { roomId, comment } = data;\n\n\t\tconst [room, user] = await Promise.all([LivechatRooms.findOneById(roomId), this.getSchedulerUser()]);\n\t\tif (!room || !user) {\n\t\t\tthrow new Error(\n\t\t\t\t`Unable to process AutoCloseOnHoldScheduler job because room or user not found for roomId: ${roomId} and userId: rocket.cat`,\n\t\t\t);\n\t\t}\n\n\t\tconst payload = {\n\t\t\troom,\n\t\t\tuser,\n\t\t\tcomment,\n\t\t};\n\n\t\tawait Livechat.closeRoom(payload);\n\t}\n\n\tprivate async getSchedulerUser(): Promise<IUser> {\n\t\tif (!this.schedulerUser) {\n\t\t\tconst schedulerUser = await Users.findOneById('rocket.cat');\n\t\t\tif (!schedulerUser) {\n\t\t\t\tthrow new Error('Scheduler user not found');\n\t\t\t}\n\t\t\tthis.schedulerUser = schedulerUser;\n\t\t}\n\n\t\treturn this.schedulerUser;\n\t}\n}\n\nexport const AutoCloseOnHoldScheduler = new AutoCloseOnHoldSchedulerClass();\n\nMeteor.startup(() => {\n\tvoid AutoCloseOnHoldScheduler.init();\n});\n"],"names":["AutoCloseOnHoldScheduler","AutoCloseOnHoldSchedulerClass","SCHEDULER_NAME","init","running","scheduler","Agenda","mongo","MongoInternals","defaultRemoteCollectionDriver","client","db","collection","defaultConcurrency","processEvery","process","env","TEST_MODE","start","logger","info","scheduleRoom","roomId","timeout","comment","Error","debug","unscheduleRoom","jobName","when","moment","Date","add","toDate","define","executeJob","bind","schedule","cancel","name","attrs","data","room","user","Promise","all","LivechatRooms","findOneById","getSchedulerUser","payload","Livechat","closeRoom","schedulerUser","Users","constructor","schedulerLogger","section","Meteor","startup"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/lib/AutoCloseOnHoldScheduler.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"55ac2aed6823ba8c67463e92130231ba85078df9","contentHash":"4929e1fc658b636065c0da54b792d2489328004a7b7ae75db6da01d0bf4462b4"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/hooks/messages/BeforeSaveCannedResponse.tests.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/hooks/messages/BeforeSaveCannedResponse.tests.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":16},"end":{"line":5,"column":46}},"2":{"start":{"line":6,"column":14},"end":{"line":6,"column":29}},"3":{"start":{"line":7,"column":15},"end":{"line":7,"column":31}},"4":{"start":{"line":8,"column":29},"end":{"line":8,"column":71}},"5":{"start":{"line":9,"column":17},"end":{"line":9,"column":71}},"6":{"start":{"line":10,"column":34},"end":{"line":10,"column":106}},"7":{"start":{"line":12,"column":4},"end":{"line":14,"column":6}},"8":{"start":{"line":16,"column":22},"end":{"line":27,"column":6}},"9":{"start":{"line":16,"column":42},"end":{"line":27,"column":5}},"10":{"start":{"line":28,"column":19},"end":{"line":32,"column":6}},"11":{"start":{"line":28,"column":34},"end":{"line":32,"column":5}},"12":{"start":{"line":33,"column":19},"end":{"line":43,"column":6}},"13":{"start":{"line":33,"column":34},"end":{"line":43,"column":5}},"14":{"start":{"line":44,"column":28},"end":{"line":48,"column":1}},"15":{"start":{"line":46,"column":8},"end":{"line":46,"column":18}},"16":{"start":{"line":49,"column":17},"end":{"line":55,"column":1}},"17":{"start":{"line":51,"column":8},"end":{"line":53,"column":10}},"18":{"start":{"line":56,"column":11},"end":{"line":58,"column":1}},"19":{"start":{"line":57,"column":21},"end":{"line":57,"column":23}},"20":{"start":{"line":59,"column":0},"end":{"line":192,"column":3}},"21":{"start":{"line":60,"column":4},"end":{"line":63,"column":7}},"22":{"start":{"line":61,"column":8},"end":{"line":61,"column":107}},"23":{"start":{"line":61,"column":65},"end":{"line":61,"column":105}},"24":{"start":{"line":62,"column":8},"end":{"line":62,"column":82}},"25":{"start":{"line":62,"column":54},"end":{"line":62,"column":80}},"26":{"start":{"line":64,"column":4},"end":{"line":81,"column":7}},"27":{"start":{"line":65,"column":8},"end":{"line":65,"column":75}},"28":{"start":{"line":66,"column":23},"end":{"line":66,"column":79}},"29":{"start":{"line":67,"column":24},"end":{"line":79,"column":10}},"30":{"start":{"line":80,"column":8},"end":{"line":80,"column":77}},"31":{"start":{"line":82,"column":4},"end":{"line":91,"column":7}},"32":{"start":{"line":83,"column":8},"end":{"line":83,"column":74}},"33":{"start":{"line":84,"column":23},"end":{"line":84,"column":79}},"34":{"start":{"line":85,"column":24},"end":{"line":89,"column":10}},"35":{"start":{"line":90,"column":8},"end":{"line":90,"column":77}},"36":{"start":{"line":92,"column":4},"end":{"line":111,"column":7}},"37":{"start":{"line":93,"column":8},"end":{"line":93,"column":74}},"38":{"start":{"line":94,"column":23},"end":{"line":94,"column":79}},"39":{"start":{"line":95,"column":24},"end":{"line":109,"column":10}},"40":{"start":{"line":110,"column":8},"end":{"line":110,"column":77}},"41":{"start":{"line":112,"column":4},"end":{"line":126,"column":7}},"42":{"start":{"line":113,"column":8},"end":{"line":113,"column":74}},"43":{"start":{"line":114,"column":23},"end":{"line":114,"column":79}},"44":{"start":{"line":115,"column":24},"end":{"line":124,"column":10}},"45":{"start":{"line":125,"column":8},"end":{"line":125,"column":77}},"46":{"start":{"line":127,"column":4},"end":{"line":144,"column":7}},"47":{"start":{"line":128,"column":8},"end":{"line":128,"column":74}},"48":{"start":{"line":129,"column":23},"end":{"line":129,"column":79}},"49":{"start":{"line":130,"column":24},"end":{"line":142,"column":10}},"50":{"start":{"line":143,"column":8},"end":{"line":143,"column":63}},"51":{"start":{"line":145,"column":4},"end":{"line":169,"column":7}},"52":{"start":{"line":146,"column":8},"end":{"line":146,"column":74}},"53":{"start":{"line":147,"column":27},"end":{"line":147,"column":53}},"54":{"start":{"line":148,"column":20},"end":{"line":148,"column":65}},"55":{"start":{"line":149,"column":8},"end":{"line":149,"column":66}},"56":{"start":{"line":149,"column":54},"end":{"line":149,"column":64}},"57":{"start":{"line":150,"column":23},"end":{"line":150,"column":79}},"58":{"start":{"line":151,"column":24},"end":{"line":166,"column":10}},"59":{"start":{"line":167,"column":8},"end":{"line":167,"column":76}},"60":{"start":{"line":168,"column":8},"end":{"line":168,"column":50}},"61":{"start":{"line":170,"column":4},"end":{"line":191,"column":7}},"62":{"start":{"line":171,"column":8},"end":{"line":171,"column":74}},"63":{"start":{"line":172,"column":27},"end":{"line":172,"column":53}},"64":{"start":{"line":173,"column":20},"end":{"line":173,"column":65}},"65":{"start":{"line":174,"column":8},"end":{"line":174,"column":66}},"66":{"start":{"line":174,"column":54},"end":{"line":174,"column":64}},"67":{"start":{"line":175,"column":23},"end":{"line":175,"column":79}},"68":{"start":{"line":176,"column":24},"end":{"line":188,"column":10}},"69":{"start":{"line":189,"column":8},"end":{"line":189,"column":77}},"70":{"start":{"line":190,"column":8},"end":{"line":190,"column":49}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":33}},"loc":{"start":{"line":11,"column":39},"end":{"line":15,"column":1}},"line":11},"1":{"name":"(anonymous_1)","decl":{"start":{"line":16,"column":22},"end":{"line":16,"column":23}},"loc":{"start":{"line":16,"column":42},"end":{"line":27,"column":5}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":28,"column":19},"end":{"line":28,"column":20}},"loc":{"start":{"line":28,"column":34},"end":{"line":32,"column":5}},"line":28},"3":{"name":"(anonymous_3)","decl":{"start":{"line":33,"column":19},"end":{"line":33,"column":20}},"loc":{"start":{"line":33,"column":34},"end":{"line":43,"column":5}},"line":33},"4":{"name":"(anonymous_4)","decl":{"start":{"line":45,"column":4},"end":{"line":45,"column":5}},"loc":{"start":{"line":45,"column":25},"end":{"line":47,"column":5}},"line":45},"5":{"name":"(anonymous_5)","decl":{"start":{"line":50,"column":4},"end":{"line":50,"column":5}},"loc":{"start":{"line":50,"column":24},"end":{"line":54,"column":5}},"line":50},"6":{"name":"(anonymous_6)","decl":{"start":{"line":57,"column":16},"end":{"line":57,"column":17}},"loc":{"start":{"line":57,"column":21},"end":{"line":57,"column":23}},"line":57},"7":{"name":"(anonymous_7)","decl":{"start":{"line":59,"column":53},"end":{"line":59,"column":54}},"loc":{"start":{"line":59,"column":57},"end":{"line":192,"column":1}},"line":59},"8":{"name":"(anonymous_8)","decl":{"start":{"line":60,"column":23},"end":{"line":60,"column":24}},"loc":{"start":{"line":60,"column":27},"end":{"line":63,"column":5}},"line":60},"9":{"name":"(anonymous_9)","decl":{"start":{"line":61,"column":61},"end":{"line":61,"column":62}},"loc":{"start":{"line":61,"column":65},"end":{"line":61,"column":105}},"line":61},"10":{"name":"(anonymous_10)","decl":{"start":{"line":62,"column":50},"end":{"line":62,"column":51}},"loc":{"start":{"line":62,"column":54},"end":{"line":62,"column":80}},"line":62},"11":{"name":"(anonymous_11)","decl":{"start":{"line":64,"column":71},"end":{"line":64,"column":72}},"loc":{"start":{"line":64,"column":81},"end":{"line":81,"column":5}},"line":64},"12":{"name":"(anonymous_12)","decl":{"start":{"line":82,"column":67},"end":{"line":82,"column":68}},"loc":{"start":{"line":82,"column":77},"end":{"line":91,"column":5}},"line":82},"13":{"name":"(anonymous_13)","decl":{"start":{"line":92,"column":73},"end":{"line":92,"column":74}},"loc":{"start":{"line":92,"column":83},"end":{"line":111,"column":5}},"line":92},"14":{"name":"(anonymous_14)","decl":{"start":{"line":112,"column":74},"end":{"line":112,"column":75}},"loc":{"start":{"line":112,"column":84},"end":{"line":126,"column":5}},"line":112},"15":{"name":"(anonymous_15)","decl":{"start":{"line":127,"column":61},"end":{"line":127,"column":62}},"loc":{"start":{"line":127,"column":71},"end":{"line":144,"column":5}},"line":127},"16":{"name":"(anonymous_16)","decl":{"start":{"line":145,"column":115},"end":{"line":145,"column":116}},"loc":{"start":{"line":145,"column":125},"end":{"line":169,"column":5}},"line":145},"17":{"name":"(anonymous_17)","decl":{"start":{"line":149,"column":50},"end":{"line":149,"column":51}},"loc":{"start":{"line":149,"column":54},"end":{"line":149,"column":64}},"line":149},"18":{"name":"(anonymous_18)","decl":{"start":{"line":170,"column":84},"end":{"line":170,"column":85}},"loc":{"start":{"line":170,"column":94},"end":{"line":191,"column":5}},"line":170},"19":{"name":"(anonymous_19)","decl":{"start":{"line":174,"column":50},"end":{"line":174,"column":51}},"loc":{"start":{"line":174,"column":54},"end":{"line":174,"column":64}},"line":174}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":11},"end":{"line":14,"column":5}},"type":"cond-expr","locations":[{"start":{"line":12,"column":35},"end":{"line":12,"column":38}},{"start":{"line":12,"column":41},"end":{"line":14,"column":5}}],"line":12},"1":{"loc":{"start":{"line":12,"column":11},"end":{"line":12,"column":32}},"type":"binary-expr","locations":[{"start":{"line":12,"column":11},"end":{"line":12,"column":14}},{"start":{"line":12,"column":18},"end":{"line":12,"column":32}}],"line":12},"2":{"loc":{"start":{"line":16,"column":28},"end":{"line":16,"column":38}},"type":"default-arg","locations":[{"start":{"line":16,"column":36},"end":{"line":16,"column":38}}],"line":16},"3":{"loc":{"start":{"line":28,"column":20},"end":{"line":28,"column":30}},"type":"default-arg","locations":[{"start":{"line":28,"column":28},"end":{"line":28,"column":30}}],"line":28},"4":{"loc":{"start":{"line":33,"column":20},"end":{"line":33,"column":30}},"type":"default-arg","locations":[{"start":{"line":33,"column":28},"end":{"line":33,"column":30}}],"line":33}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":7,"10":1,"11":7,"12":1,"13":7,"14":1,"15":2,"16":1,"17":1,"18":1,"19":3,"20":1,"21":1,"22":1,"23":1,"24":1,"25":0,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":0,"57":1,"58":1,"59":1,"60":1,"61":1,"62":1,"63":1,"64":1,"65":1,"66":1,"67":1,"68":1,"69":1,"70":1},"f":{"0":1,"1":7,"2":7,"3":7,"4":2,"5":1,"6":3,"7":1,"8":1,"9":1,"10":0,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":0,"18":1,"19":1},"b":{"0":[0,1],"1":[1,1],"2":[7],"3":[1],"4":[5]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/hooks/messages/BeforeSaveCannedResponse.tests.ts"],"sourcesContent":["import { registerModel } from '@rocket.chat/models';\nimport { expect } from 'chai';\nimport { before, describe, it } from 'mocha';\nimport sinon from 'sinon';\n\nimport { BaseRaw } from '../../../../../../server/models/raw/BaseRaw';\nimport { BeforeSaveCannedResponse } from '../../../../../server/hooks/messages/BeforeSaveCannedResponse';\n\nconst createMessage = (msg?: string, extra: any = {}) => ({\n\t_id: 'msg-id',\n\trid: 'GENERAL',\n\tts: new Date(),\n\tu: {\n\t\t_id: 'user-id',\n\t\tusername: 'user',\n\t},\n\t_updatedAt: new Date(),\n\tmsg: msg as string,\n\t...extra,\n});\n\nconst createRoom = (extra: any = {}) => ({\n\t_id: 'GENERAL',\n\tname: 'general',\n\t...extra,\n});\n\nconst createUser = (extra: any = {}) => ({\n\t_id: 'user-id',\n\tname: 'User Name',\n\tusername: 'user',\n\temails: [{ address: 'user@user.com' }],\n\t...extra,\n});\n\nclass LivechatVisitorsModel extends BaseRaw<any> {\n\tfindOneEnabledById() {\n\t\treturn {};\n\t}\n}\n\nclass UsersModel extends BaseRaw<any> {\n\tasync findOneById() {\n\t\treturn {\n\t\t\tname: 'John Doe Agent',\n\t\t};\n\t}\n}\n\nconst db = {\n\tcollection: () => ({}),\n};\n\ndescribe('Omnichannel canned responses', () => {\n\tbefore(() => {\n\t\tregisterModel('ILivechatVisitorsModel', () => new LivechatVisitorsModel(db as unknown as any, 'visitor'));\n\t\tregisterModel('IUsersModel', () => new UsersModel(db as unknown as any, 'user'));\n\t});\n\n\tit('should do nothing if canned response is disabled', async () => {\n\t\tBeforeSaveCannedResponse.enabled = false;\n\n\t\tconst canned = new BeforeSaveCannedResponse();\n\n\t\tconst message = await canned.replacePlaceholders({\n\t\t\tmessage: createMessage('{{agent.name}}'),\n\t\t\troom: createRoom({ t: 'l', servedBy: { _id: 'agent' }, v: { _id: 'visitor' } }),\n\t\t\tuser: createUser(),\n\t\t});\n\n\t\texpect(message).to.have.property('msg', '{{agent.name}}');\n\t});\n\n\tit('should do nothing if not an omnichannel room', async () => {\n\t\tBeforeSaveCannedResponse.enabled = true;\n\n\t\tconst canned = new BeforeSaveCannedResponse();\n\n\t\tconst message = await canned.replacePlaceholders({\n\t\t\tmessage: createMessage('{{agent.name}}'),\n\t\t\troom: createRoom(),\n\t\t\tuser: createUser(),\n\t\t});\n\n\t\texpect(message).to.have.property('msg', '{{agent.name}}');\n\t});\n\n\tit('should do nothing if the message is from a visitor', async () => {\n\t\tBeforeSaveCannedResponse.enabled = true;\n\n\t\tconst canned = new BeforeSaveCannedResponse();\n\n\t\tconst message = await canned.replacePlaceholders({\n\t\t\tmessage: createMessage('{{agent.name}}'),\n\t\t\troom: createRoom({ t: 'l', servedBy: { _id: 'agent' }, v: { _id: 'visitor' } }),\n\t\t\tuser: createUser({ token: 'visitor-token' }),\n\t\t});\n\n\t\texpect(message).to.have.property('msg', '{{agent.name}}');\n\t});\n\n\tit('should do nothing if room is not served by an agent', async () => {\n\t\tBeforeSaveCannedResponse.enabled = true;\n\n\t\tconst canned = new BeforeSaveCannedResponse();\n\n\t\tconst message = await canned.replacePlaceholders({\n\t\t\tmessage: createMessage('{{agent.name}}'),\n\t\t\troom: createRoom({ t: 'l', v: { _id: 'visitor' } }),\n\t\t\tuser: createUser(),\n\t\t});\n\n\t\texpect(message).to.have.property('msg', '{{agent.name}}');\n\t});\n\n\tit('should do nothing for an empty message', async () => {\n\t\tBeforeSaveCannedResponse.enabled = true;\n\n\t\tconst canned = new BeforeSaveCannedResponse();\n\n\t\tconst message = await canned.replacePlaceholders({\n\t\t\tmessage: createMessage(''),\n\t\t\troom: createRoom({ t: 'l', servedBy: { _id: 'agent' }, v: { _id: 'visitor' } }),\n\t\t\tuser: createUser(),\n\t\t});\n\n\t\texpect(message).to.have.property('msg', '');\n\t});\n\n\tit('should replace {{agent.name}} without finding the user from DB (sender is the agent of room)', async () => {\n\t\tBeforeSaveCannedResponse.enabled = true;\n\n\t\tconst usersModel = new UsersModel(db as unknown as any, 'user');\n\t\tconst spy = sinon.spy(usersModel, 'findOneById');\n\n\t\tregisterModel('IUsersModel', () => usersModel);\n\n\t\tconst canned = new BeforeSaveCannedResponse();\n\n\t\tconst message = await canned.replacePlaceholders({\n\t\t\tmessage: createMessage('{{agent.name}}'),\n\t\t\troom: createRoom({ t: 'l', servedBy: { _id: 'agent' }, v: { _id: 'visitor' } }),\n\t\t\tuser: createUser({ _id: 'agent', name: 'User As Agent' }),\n\t\t});\n\n\t\texpect(message).to.have.property('msg', 'User As Agent');\n\t\texpect(spy.called).to.be.false;\n\t});\n\n\tit('should replace {{agent.name}} when canned response is enabled', async () => {\n\t\tBeforeSaveCannedResponse.enabled = true;\n\n\t\tconst usersModel = new UsersModel(db as unknown as any, 'user');\n\t\tconst spy = sinon.spy(usersModel, 'findOneById');\n\n\t\tregisterModel('IUsersModel', () => usersModel);\n\n\t\tconst canned = new BeforeSaveCannedResponse();\n\n\t\tconst message = await canned.replacePlaceholders({\n\t\t\tmessage: createMessage('{{agent.name}}'),\n\t\t\troom: createRoom({ t: 'l', servedBy: { _id: 'agent' }, v: { _id: 'visitor' } }),\n\t\t\tuser: createUser(),\n\t\t});\n\n\t\texpect(message).to.have.property('msg', 'John Doe Agent');\n\t\texpect(spy.called).to.be.true;\n\t});\n});\n"],"names":["createMessage","msg","extra","_id","rid","ts","Date","u","username","_updatedAt","createRoom","name","createUser","emails","address","LivechatVisitorsModel","BaseRaw","findOneEnabledById","UsersModel","findOneById","db","collection","describe","before","registerModel","it","BeforeSaveCannedResponse","enabled","canned","message","replacePlaceholders","room","t","servedBy","v","user","expect","to","have","property","token","usersModel","spy","sinon","called","be","false","true"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/hooks/messages/BeforeSaveCannedResponse.tests.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"50ca769e99aa36438315dcda4ccb7ebf84cf6d6a","contentHash":"323e7cd89c0e7ac96aa01cc1bd3893bea9dca674e4406552da3f6a91f03432dc"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/models/raw/BaseRaw.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/models/raw/BaseRaw.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":23}},"3":{"start":{"line":11,"column":22},"end":{"line":11,"column":59}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":46}},"5":{"start":{"line":13,"column":17},"end":{"line":13,"column":35}},"6":{"start":{"line":14,"column":22},"end":{"line":14,"column":47}},"7":{"start":{"line":15,"column":19},"end":{"line":17,"column":18}},"8":{"start":{"line":16,"column":4},"end":{"line":16,"column":45}},"9":{"start":{"line":18,"column":14},"end":{"line":403,"column":1}},"10":{"start":{"line":21,"column":24},"end":{"line":21,"column":43}},"11":{"start":{"line":22,"column":8},"end":{"line":29,"column":9}},"12":{"start":{"line":23,"column":12},"end":{"line":28,"column":15}},"13":{"start":{"line":30,"column":8},"end":{"line":41,"column":9}},"14":{"start":{"line":31,"column":12},"end":{"line":33,"column":13}},"15":{"start":{"line":32,"column":16},"end":{"line":32,"column":42}},"16":{"start":{"line":34,"column":12},"end":{"line":36,"column":15}},"17":{"start":{"line":35,"column":16},"end":{"line":35,"column":123}},"18":{"start":{"line":37,"column":12},"end":{"line":39,"column":15}},"19":{"start":{"line":38,"column":16},"end":{"line":38,"column":48}},"20":{"start":{"line":40,"column":12},"end":{"line":40,"column":39}},"21":{"start":{"line":44,"column":8},"end":{"line":44,"column":25}},"22":{"start":{"line":47,"column":8},"end":{"line":47,"column":35}},"23":{"start":{"line":50,"column":8},"end":{"line":50,"column":41}},"24":{"start":{"line":53,"column":29},"end":{"line":53,"column":54}},"25":{"start":{"line":54,"column":8},"end":{"line":57,"column":11}},"26":{"start":{"line":55,"column":12},"end":{"line":55,"column":42}},"27":{"start":{"line":56,"column":12},"end":{"line":56,"column":37}},"28":{"start":{"line":60,"column":27},"end":{"line":60,"column":60}},"29":{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},"30":{"start":{"line":62,"column":12},"end":{"line":62,"column":30}},"31":{"start":{"line":64,"column":27},"end":{"line":64,"column":104}},"32":{"start":{"line":65,"column":21},"end":{"line":65,"column":44}},"33":{"start":{"line":66,"column":27},"end":{"line":66,"column":68}},"34":{"start":{"line":66,"column":46},"end":{"line":66,"column":67}},"35":{"start":{"line":67,"column":8},"end":{"line":69,"column":9}},"36":{"start":{"line":68,"column":12},"end":{"line":68,"column":62}},"37":{"start":{"line":68,"column":38},"end":{"line":68,"column":60}},"38":{"start":{"line":70,"column":8},"end":{"line":73,"column":10}},"39":{"start":{"line":76,"column":8},"end":{"line":78,"column":9}},"40":{"start":{"line":77,"column":12},"end":{"line":77,"column":75}},"41":{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},"42":{"start":{"line":80,"column":12},"end":{"line":80,"column":27}},"43":{"start":{"line":82,"column":66},"end":{"line":82,"column":79}},"44":{"start":{"line":83,"column":23},"end":{"line":86,"column":9}},"45":{"start":{"line":87,"column":8},"end":{"line":93,"column":10}},"46":{"start":{"line":96,"column":8},"end":{"line":96,"column":34}},"47":{"start":{"line":97,"column":8},"end":{"line":97,"column":71}},"48":{"start":{"line":100,"column":22},"end":{"line":102,"column":9}},"49":{"start":{"line":103,"column":8},"end":{"line":105,"column":9}},"50":{"start":{"line":104,"column":12},"end":{"line":104,"column":48}},"51":{"start":{"line":106,"column":8},"end":{"line":106,"column":35}},"52":{"start":{"line":109,"column":18},"end":{"line":111,"column":17}},"53":{"start":{"line":112,"column":27},"end":{"line":112,"column":76}},"54":{"start":{"line":113,"column":8},"end":{"line":115,"column":9}},"55":{"start":{"line":114,"column":12},"end":{"line":114,"column":51}},"56":{"start":{"line":116,"column":8},"end":{"line":116,"column":35}},"57":{"start":{"line":119,"column":27},"end":{"line":119,"column":76}},"58":{"start":{"line":120,"column":8},"end":{"line":120,"column":48}},"59":{"start":{"line":123,"column":27},"end":{"line":123,"column":76}},"60":{"start":{"line":124,"column":23},"end":{"line":124,"column":91}},"61":{"start":{"line":125,"column":27},"end":{"line":125,"column":57}},"62":{"start":{"line":126,"column":8},"end":{"line":129,"column":10}},"63":{"start":{"line":134,"column":26},"end":{"line":134,"column":120}},"64":{"start":{"line":135,"column":8},"end":{"line":135,"column":56}},"65":{"start":{"line":138,"column":8},"end":{"line":138,"column":34}},"66":{"start":{"line":139,"column":8},"end":{"line":141,"column":9}},"67":{"start":{"line":140,"column":12},"end":{"line":140,"column":63}},"68":{"start":{"line":142,"column":8},"end":{"line":142,"column":50}},"69":{"start":{"line":145,"column":8},"end":{"line":145,"column":34}},"70":{"start":{"line":146,"column":8},"end":{"line":148,"column":9}},"71":{"start":{"line":147,"column":12},"end":{"line":147,"column":64}},"72":{"start":{"line":149,"column":8},"end":{"line":149,"column":51}},"73":{"start":{"line":152,"column":8},"end":{"line":162,"column":11}},"74":{"start":{"line":153,"column":12},"end":{"line":159,"column":13}},"75":{"start":{"line":154,"column":28},"end":{"line":154,"column":51}},"76":{"start":{"line":155,"column":16},"end":{"line":158,"column":18}},"77":{"start":{"line":160,"column":12},"end":{"line":160,"column":35}},"78":{"start":{"line":161,"column":12},"end":{"line":161,"column":23}},"79":{"start":{"line":164,"column":8},"end":{"line":164,"column":56}},"80":{"start":{"line":167,"column":8},"end":{"line":173,"column":9}},"81":{"start":{"line":168,"column":24},"end":{"line":168,"column":47}},"82":{"start":{"line":169,"column":12},"end":{"line":172,"column":14}},"83":{"start":{"line":174,"column":8},"end":{"line":174,"column":31}},"84":{"start":{"line":176,"column":8},"end":{"line":176,"column":54}},"85":{"start":{"line":179,"column":8},"end":{"line":181,"column":11}},"86":{"start":{"line":184,"column":8},"end":{"line":188,"column":11}},"87":{"start":{"line":191,"column":8},"end":{"line":196,"column":9}},"88":{"start":{"line":192,"column":12},"end":{"line":194,"column":13}},"89":{"start":{"line":193,"column":16},"end":{"line":193,"column":59}},"90":{"start":{"line":195,"column":12},"end":{"line":195,"column":46}},"91":{"start":{"line":197,"column":20},"end":{"line":197,"column":46}},"92":{"start":{"line":198,"column":8},"end":{"line":214,"column":9}},"93":{"start":{"line":200,"column":39},"end":{"line":200,"column":42}},"94":{"start":{"line":201,"column":26},"end":{"line":205,"column":13}},"95":{"start":{"line":207,"column":12},"end":{"line":213,"column":16}},"96":{"start":{"line":215,"column":8},"end":{"line":217,"column":9}},"97":{"start":{"line":216,"column":12},"end":{"line":216,"column":55}},"98":{"start":{"line":218,"column":8},"end":{"line":218,"column":42}},"99":{"start":{"line":222,"column":8},"end":{"line":224,"column":9}},"100":{"start":{"line":223,"column":12},"end":{"line":223,"column":68}},"101":{"start":{"line":225,"column":20},"end":{"line":225,"column":50}},"102":{"start":{"line":226,"column":8},"end":{"line":231,"column":9}},"103":{"start":{"line":227,"column":12},"end":{"line":230,"column":14}},"104":{"start":{"line":232,"column":35},"end":{"line":232,"column":38}},"105":{"start":{"line":233,"column":22},"end":{"line":237,"column":9}},"106":{"start":{"line":238,"column":8},"end":{"line":244,"column":12}},"107":{"start":{"line":245,"column":8},"end":{"line":255,"column":9}},"108":{"start":{"line":246,"column":12},"end":{"line":248,"column":15}},"109":{"start":{"line":251,"column":12},"end":{"line":253,"column":16}},"110":{"start":{"line":254,"column":12},"end":{"line":254,"column":20}},"111":{"start":{"line":256,"column":8},"end":{"line":259,"column":10}},"112":{"start":{"line":262,"column":8},"end":{"line":267,"column":9}},"113":{"start":{"line":263,"column":12},"end":{"line":265,"column":13}},"114":{"start":{"line":264,"column":16},"end":{"line":264,"column":60}},"115":{"start":{"line":266,"column":12},"end":{"line":266,"column":47}},"116":{"start":{"line":268,"column":23},"end":{"line":270,"column":10}},"117":{"start":{"line":271,"column":20},"end":{"line":271,"column":22}},"118":{"start":{"line":272,"column":8},"end":{"line":291,"column":9}},"119":{"start":{"line":274,"column":39},"end":{"line":274,"column":42}},"120":{"start":{"line":275,"column":26},"end":{"line":279,"column":13}},"121":{"start":{"line":280,"column":12},"end":{"line":280,"column":26}},"122":{"start":{"line":282,"column":12},"end":{"line":289,"column":16}},"123":{"start":{"line":290,"column":12},"end":{"line":290,"column":193}},"124":{"start":{"line":292,"column":8},"end":{"line":298,"column":9}},"125":{"start":{"line":293,"column":12},"end":{"line":297,"column":24}},"126":{"start":{"line":299,"column":8},"end":{"line":303,"column":11}},"127":{"start":{"line":307,"column":8},"end":{"line":309,"column":9}},"128":{"start":{"line":308,"column":12},"end":{"line":308,"column":29}},"129":{"start":{"line":310,"column":8},"end":{"line":315,"column":9}},"130":{"start":{"line":311,"column":12},"end":{"line":314,"column":24}},"131":{"start":{"line":316,"column":8},"end":{"line":319,"column":11}},"132":{"start":{"line":322,"column":22},"end":{"line":325,"column":9}},"133":{"start":{"line":326,"column":8},"end":{"line":328,"column":9}},"134":{"start":{"line":327,"column":12},"end":{"line":327,"column":24}},"135":{"start":{"line":329,"column":8},"end":{"line":331,"column":9}},"136":{"start":{"line":330,"column":12},"end":{"line":330,"column":54}},"137":{"start":{"line":332,"column":8},"end":{"line":332,"column":41}},"138":{"start":{"line":335,"column":8},"end":{"line":337,"column":9}},"139":{"start":{"line":336,"column":12},"end":{"line":336,"column":19}},"140":{"start":{"line":338,"column":8},"end":{"line":338,"column":48}},"141":{"start":{"line":341,"column":18},"end":{"line":347,"column":9}},"142":{"start":{"line":348,"column":8},"end":{"line":350,"column":9}},"143":{"start":{"line":349,"column":12},"end":{"line":349,"column":72}},"144":{"start":{"line":351,"column":8},"end":{"line":353,"column":9}},"145":{"start":{"line":352,"column":12},"end":{"line":352,"column":47}},"146":{"start":{"line":354,"column":8},"end":{"line":354,"column":34}},"147":{"start":{"line":357,"column":18},"end":{"line":363,"column":9}},"148":{"start":{"line":364,"column":8},"end":{"line":366,"column":9}},"149":{"start":{"line":365,"column":12},"end":{"line":365,"column":72}},"150":{"start":{"line":367,"column":23},"end":{"line":367,"column":81}},"151":{"start":{"line":368,"column":27},"end":{"line":368,"column":55}},"152":{"start":{"line":369,"column":8},"end":{"line":372,"column":10}},"153":{"start":{"line":375,"column":8},"end":{"line":375,"column":40}},"154":{"start":{"line":378,"column":8},"end":{"line":380,"column":9}},"155":{"start":{"line":379,"column":12},"end":{"line":379,"column":59}},"156":{"start":{"line":381,"column":8},"end":{"line":381,"column":46}},"157":{"start":{"line":384,"column":8},"end":{"line":384,"column":49}},"158":{"start":{"line":392,"column":8},"end":{"line":392,"column":21}},"159":{"start":{"line":393,"column":8},"end":{"line":393,"column":25}},"160":{"start":{"line":394,"column":8},"end":{"line":394,"column":27}},"161":{"start":{"line":395,"column":8},"end":{"line":395,"column":31}},"162":{"start":{"line":396,"column":8},"end":{"line":396,"column":191}},"163":{"start":{"line":397,"column":8},"end":{"line":397,"column":137}},"164":{"start":{"line":398,"column":8},"end":{"line":398,"column":34}},"165":{"start":{"line":400,"column":8},"end":{"line":400,"column":237}},"166":{"start":{"line":401,"column":8},"end":{"line":401,"column":61}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":99},"end":{"line":15,"column":100}},"loc":{"start":{"line":15,"column":110},"end":{"line":17,"column":1}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":19,"column":4},"end":{"line":19,"column":5}},"loc":{"start":{"line":19,"column":26},"end":{"line":42,"column":5}},"line":19},"3":{"name":"(anonymous_3)","decl":{"start":{"line":34,"column":72},"end":{"line":34,"column":73}},"loc":{"start":{"line":34,"column":77},"end":{"line":36,"column":13}},"line":34},"4":{"name":"(anonymous_4)","decl":{"start":{"line":37,"column":45},"end":{"line":37,"column":46}},"loc":{"start":{"line":37,"column":49},"end":{"line":39,"column":13}},"line":37},"5":{"name":"(anonymous_5)","decl":{"start":{"line":43,"column":4},"end":{"line":43,"column":5}},"loc":{"start":{"line":43,"column":19},"end":{"line":45,"column":5}},"line":43},"6":{"name":"(anonymous_6)","decl":{"start":{"line":46,"column":4},"end":{"line":46,"column":5}},"loc":{"start":{"line":46,"column":24},"end":{"line":48,"column":5}},"line":46},"7":{"name":"(anonymous_7)","decl":{"start":{"line":49,"column":4},"end":{"line":49,"column":5}},"loc":{"start":{"line":49,"column":17},"end":{"line":51,"column":5}},"line":49},"8":{"name":"(anonymous_8)","decl":{"start":{"line":52,"column":4},"end":{"line":52,"column":5}},"loc":{"start":{"line":52,"column":38},"end":{"line":58,"column":5}},"line":52},"9":{"name":"(anonymous_9)","decl":{"start":{"line":54,"column":57},"end":{"line":54,"column":58}},"loc":{"start":{"line":54,"column":62},"end":{"line":57,"column":9}},"line":54},"10":{"name":"(anonymous_10)","decl":{"start":{"line":59,"column":4},"end":{"line":59,"column":5}},"loc":{"start":{"line":59,"column":54},"end":{"line":74,"column":5}},"line":59},"11":{"name":"(anonymous_11)","decl":{"start":{"line":66,"column":39},"end":{"line":66,"column":40}},"loc":{"start":{"line":66,"column":46},"end":{"line":66,"column":67}},"line":66},"12":{"name":"(anonymous_12)","decl":{"start":{"line":68,"column":31},"end":{"line":68,"column":32}},"loc":{"start":{"line":68,"column":38},"end":{"line":68,"column":60}},"line":68},"13":{"name":"(anonymous_13)","decl":{"start":{"line":75,"column":4},"end":{"line":75,"column":5}},"loc":{"start":{"line":75,"column":33},"end":{"line":94,"column":5}},"line":75},"14":{"name":"(anonymous_14)","decl":{"start":{"line":95,"column":4},"end":{"line":95,"column":5}},"loc":{"start":{"line":95,"column":45},"end":{"line":98,"column":5}},"line":95},"15":{"name":"(anonymous_15)","decl":{"start":{"line":99,"column":4},"end":{"line":99,"column":5}},"loc":{"start":{"line":99,"column":36},"end":{"line":107,"column":5}},"line":99},"16":{"name":"(anonymous_16)","decl":{"start":{"line":108,"column":4},"end":{"line":108,"column":5}},"loc":{"start":{"line":108,"column":39},"end":{"line":117,"column":5}},"line":108},"17":{"name":"(anonymous_17)","decl":{"start":{"line":118,"column":4},"end":{"line":118,"column":5}},"loc":{"start":{"line":118,"column":30},"end":{"line":121,"column":5}},"line":118},"18":{"name":"(anonymous_18)","decl":{"start":{"line":122,"column":4},"end":{"line":122,"column":5}},"loc":{"start":{"line":122,"column":39},"end":{"line":130,"column":5}},"line":122},"19":{"name":"(anonymous_19)","decl":{"start":{"line":133,"column":5},"end":{"line":133,"column":6}},"loc":{"start":{"line":133,"column":37},"end":{"line":136,"column":5}},"line":133},"20":{"name":"(anonymous_20)","decl":{"start":{"line":137,"column":4},"end":{"line":137,"column":5}},"loc":{"start":{"line":137,"column":39},"end":{"line":143,"column":5}},"line":137},"21":{"name":"(anonymous_21)","decl":{"start":{"line":144,"column":4},"end":{"line":144,"column":5}},"loc":{"start":{"line":144,"column":40},"end":{"line":150,"column":5}},"line":144},"22":{"name":"(anonymous_22)","decl":{"start":{"line":151,"column":4},"end":{"line":151,"column":5}},"loc":{"start":{"line":151,"column":30},"end":{"line":165,"column":5}},"line":151},"23":{"name":"(anonymous_23)","decl":{"start":{"line":152,"column":24},"end":{"line":152,"column":25}},"loc":{"start":{"line":152,"column":31},"end":{"line":162,"column":9}},"line":152},"24":{"name":"(anonymous_24)","decl":{"start":{"line":166,"column":4},"end":{"line":166,"column":5}},"loc":{"start":{"line":166,"column":28},"end":{"line":177,"column":5}},"line":166},"25":{"name":"(anonymous_25)","decl":{"start":{"line":178,"column":4},"end":{"line":178,"column":5}},"loc":{"start":{"line":178,"column":20},"end":{"line":182,"column":5}},"line":178},"26":{"name":"(anonymous_26)","decl":{"start":{"line":183,"column":4},"end":{"line":183,"column":5}},"loc":{"start":{"line":183,"column":21},"end":{"line":189,"column":5}},"line":183},"27":{"name":"(anonymous_27)","decl":{"start":{"line":190,"column":4},"end":{"line":190,"column":5}},"loc":{"start":{"line":190,"column":37},"end":{"line":219,"column":5}},"line":190},"28":{"name":"(anonymous_28)","decl":{"start":{"line":220,"column":4},"end":{"line":220,"column":5}},"loc":{"start":{"line":220,"column":44},"end":{"line":260,"column":5}},"line":220},"29":{"name":"(anonymous_29)","decl":{"start":{"line":261,"column":4},"end":{"line":261,"column":5}},"loc":{"start":{"line":261,"column":38},"end":{"line":304,"column":5}},"line":261},"30":{"name":"(anonymous_30)","decl":{"start":{"line":306,"column":4},"end":{"line":306,"column":5}},"loc":{"start":{"line":306,"column":30},"end":{"line":320,"column":5}},"line":306},"31":{"name":"(anonymous_31)","decl":{"start":{"line":321,"column":4},"end":{"line":321,"column":5}},"loc":{"start":{"line":321,"column":41},"end":{"line":333,"column":5}},"line":321},"32":{"name":"(anonymous_32)","decl":{"start":{"line":334,"column":4},"end":{"line":334,"column":5}},"loc":{"start":{"line":334,"column":25},"end":{"line":339,"column":5}},"line":334},"33":{"name":"(anonymous_33)","decl":{"start":{"line":340,"column":4},"end":{"line":340,"column":5}},"loc":{"start":{"line":340,"column":53},"end":{"line":355,"column":5}},"line":340},"34":{"name":"(anonymous_34)","decl":{"start":{"line":356,"column":4},"end":{"line":356,"column":5}},"loc":{"start":{"line":356,"column":62},"end":{"line":373,"column":5}},"line":356},"35":{"name":"(anonymous_35)","decl":{"start":{"line":374,"column":4},"end":{"line":374,"column":5}},"loc":{"start":{"line":374,"column":20},"end":{"line":376,"column":5}},"line":374},"36":{"name":"(anonymous_36)","decl":{"start":{"line":377,"column":4},"end":{"line":377,"column":5}},"loc":{"start":{"line":377,"column":35},"end":{"line":382,"column":5}},"line":377},"37":{"name":"(anonymous_37)","decl":{"start":{"line":383,"column":4},"end":{"line":383,"column":5}},"loc":{"start":{"line":383,"column":29},"end":{"line":385,"column":5}},"line":383},"38":{"name":"(anonymous_38)","decl":{"start":{"line":391,"column":5},"end":{"line":391,"column":6}},"loc":{"start":{"line":391,"column":42},"end":{"line":402,"column":5}},"line":391}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":19},"end":{"line":17,"column":18}},"type":"cond-expr","locations":[{"start":{"line":15,"column":99},"end":{"line":17,"column":1}},{"start":{"line":17,"column":4},"end":{"line":17,"column":18}}],"line":15},"1":{"loc":{"start":{"line":15,"column":19},"end":{"line":15,"column":96}},"type":"binary-expr","locations":[{"start":{"line":15,"column":19},"end":{"line":15,"column":56}},{"start":{"line":15,"column":60},"end":{"line":15,"column":96}}],"line":15},"2":{"loc":{"start":{"line":22,"column":8},"end":{"line":29,"column":9}},"type":"if","locations":[{"start":{"line":22,"column":8},"end":{"line":29,"column":9}},{"start":{"line":22,"column":8},"end":{"line":29,"column":9}}],"line":22},"3":{"loc":{"start":{"line":22,"column":12},"end":{"line":22,"column":127}},"type":"cond-expr","locations":[{"start":{"line":22,"column":82},"end":{"line":22,"column":88}},{"start":{"line":22,"column":91},"end":{"line":22,"column":127}}],"line":22},"4":{"loc":{"start":{"line":22,"column":12},"end":{"line":22,"column":79}},"type":"binary-expr","locations":[{"start":{"line":22,"column":12},"end":{"line":22,"column":51}},{"start":{"line":22,"column":55},"end":{"line":22,"column":79}}],"line":22},"5":{"loc":{"start":{"line":23,"column":12},"end":{"line":28,"column":14}},"type":"cond-expr","locations":[{"start":{"line":23,"column":53},"end":{"line":23,"column":59}},{"start":{"line":23,"column":62},"end":{"line":28,"column":14}}],"line":23},"6":{"loc":{"start":{"line":23,"column":12},"end":{"line":23,"column":50}},"type":"binary-expr","locations":[{"start":{"line":23,"column":12},"end":{"line":23,"column":28}},{"start":{"line":23,"column":32},"end":{"line":23,"column":50}}],"line":23},"7":{"loc":{"start":{"line":30,"column":8},"end":{"line":41,"column":9}},"type":"if","locations":[{"start":{"line":30,"column":8},"end":{"line":41,"column":9}},{"start":{"line":30,"column":8},"end":{"line":41,"column":9}}],"line":30},"8":{"loc":{"start":{"line":30,"column":12},"end":{"line":30,"column":76}},"type":"cond-expr","locations":[{"start":{"line":30,"column":53},"end":{"line":30,"column":59}},{"start":{"line":30,"column":62},"end":{"line":30,"column":76}}],"line":30},"9":{"loc":{"start":{"line":30,"column":12},"end":{"line":30,"column":50}},"type":"binary-expr","locations":[{"start":{"line":30,"column":12},"end":{"line":30,"column":28}},{"start":{"line":30,"column":32},"end":{"line":30,"column":50}}],"line":30},"10":{"loc":{"start":{"line":31,"column":12},"end":{"line":33,"column":13}},"type":"if","locations":[{"start":{"line":31,"column":12},"end":{"line":33,"column":13}},{"start":{"line":31,"column":12},"end":{"line":33,"column":13}}],"line":31},"11":{"loc":{"start":{"line":59,"column":40},"end":{"line":59,"column":52}},"type":"default-arg","locations":[{"start":{"line":59,"column":50},"end":{"line":59,"column":52}}],"line":59},"12":{"loc":{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},"type":"if","locations":[{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},{"start":{"line":61,"column":8},"end":{"line":63,"column":9}}],"line":61},"13":{"loc":{"start":{"line":61,"column":13},"end":{"line":61,"column":90}},"type":"cond-expr","locations":[{"start":{"line":61,"column":60},"end":{"line":61,"column":66}},{"start":{"line":61,"column":69},"end":{"line":61,"column":90}}],"line":61},"14":{"loc":{"start":{"line":61,"column":13},"end":{"line":61,"column":57}},"type":"binary-expr","locations":[{"start":{"line":61,"column":13},"end":{"line":61,"column":32}},{"start":{"line":61,"column":36},"end":{"line":61,"column":57}}],"line":61},"15":{"loc":{"start":{"line":64,"column":27},"end":{"line":64,"column":104}},"type":"cond-expr","locations":[{"start":{"line":64,"column":74},"end":{"line":64,"column":80}},{"start":{"line":64,"column":83},"end":{"line":64,"column":104}}],"line":64},"16":{"loc":{"start":{"line":64,"column":27},"end":{"line":64,"column":71}},"type":"binary-expr","locations":[{"start":{"line":64,"column":27},"end":{"line":64,"column":46}},{"start":{"line":64,"column":50},"end":{"line":64,"column":71}}],"line":64},"17":{"loc":{"start":{"line":67,"column":8},"end":{"line":69,"column":9}},"type":"if","locations":[{"start":{"line":67,"column":8},"end":{"line":69,"column":9}},{"start":{"line":67,"column":8},"end":{"line":69,"column":9}}],"line":67},"18":{"loc":{"start":{"line":76,"column":8},"end":{"line":78,"column":9}},"type":"if","locations":[{"start":{"line":76,"column":8},"end":{"line":78,"column":9}},{"start":{"line":76,"column":8},"end":{"line":78,"column":9}}],"line":76},"19":{"loc":{"start":{"line":76,"column":12},"end":{"line":76,"column":76}},"type":"cond-expr","locations":[{"start":{"line":76,"column":53},"end":{"line":76,"column":59}},{"start":{"line":76,"column":62},"end":{"line":76,"column":76}}],"line":76},"20":{"loc":{"start":{"line":76,"column":12},"end":{"line":76,"column":50}},"type":"binary-expr","locations":[{"start":{"line":76,"column":12},"end":{"line":76,"column":28}},{"start":{"line":76,"column":32},"end":{"line":76,"column":50}}],"line":76},"21":{"loc":{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},"type":"if","locations":[{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},{"start":{"line":79,"column":8},"end":{"line":81,"column":9}}],"line":79},"22":{"loc":{"start":{"line":82,"column":66},"end":{"line":82,"column":79}},"type":"binary-expr","locations":[{"start":{"line":82,"column":66},"end":{"line":82,"column":73}},{"start":{"line":82,"column":77},"end":{"line":82,"column":79}}],"line":82},"23":{"loc":{"start":{"line":89,"column":15},"end":{"line":91,"column":13}},"type":"binary-expr","locations":[{"start":{"line":89,"column":15},"end":{"line":89,"column":21}},{"start":{"line":89,"column":25},"end":{"line":89,"column":53}},{"start":{"line":89,"column":57},"end":{"line":91,"column":13}}],"line":89},"24":{"loc":{"start":{"line":97,"column":56},"end":{"line":97,"column":69}},"type":"binary-expr","locations":[{"start":{"line":97,"column":56},"end":{"line":97,"column":63}},{"start":{"line":97,"column":67},"end":{"line":97,"column":69}}],"line":97},"25":{"loc":{"start":{"line":103,"column":8},"end":{"line":105,"column":9}},"type":"if","locations":[{"start":{"line":103,"column":8},"end":{"line":105,"column":9}},{"start":{"line":103,"column":8},"end":{"line":105,"column":9}}],"line":103},"26":{"loc":{"start":{"line":108,"column":18},"end":{"line":108,"column":28}},"type":"default-arg","locations":[{"start":{"line":108,"column":26},"end":{"line":108,"column":28}}],"line":108},"27":{"loc":{"start":{"line":109,"column":18},"end":{"line":111,"column":17}},"type":"cond-expr","locations":[{"start":{"line":109,"column":46},"end":{"line":111,"column":9}},{"start":{"line":111,"column":12},"end":{"line":111,"column":17}}],"line":109},"28":{"loc":{"start":{"line":113,"column":8},"end":{"line":115,"column":9}},"type":"if","locations":[{"start":{"line":113,"column":8},"end":{"line":115,"column":9}},{"start":{"line":113,"column":8},"end":{"line":115,"column":9}}],"line":113},"29":{"loc":{"start":{"line":118,"column":9},"end":{"line":118,"column":19}},"type":"default-arg","locations":[{"start":{"line":118,"column":17},"end":{"line":118,"column":19}}],"line":118},"30":{"loc":{"start":{"line":122,"column":18},"end":{"line":122,"column":28}},"type":"default-arg","locations":[{"start":{"line":122,"column":26},"end":{"line":122,"column":28}}],"line":122},"31":{"loc":{"start":{"line":124,"column":23},"end":{"line":124,"column":91}},"type":"cond-expr","locations":[{"start":{"line":124,"column":36},"end":{"line":124,"column":68}},{"start":{"line":124,"column":71},"end":{"line":124,"column":91}}],"line":124},"32":{"loc":{"start":{"line":134,"column":26},"end":{"line":134,"column":120}},"type":"cond-expr","locations":[{"start":{"line":134,"column":94},"end":{"line":134,"column":106}},{"start":{"line":134,"column":109},"end":{"line":134,"column":120}}],"line":134},"33":{"loc":{"start":{"line":134,"column":27},"end":{"line":134,"column":90}},"type":"cond-expr","locations":[{"start":{"line":134,"column":68},"end":{"line":134,"column":74}},{"start":{"line":134,"column":77},"end":{"line":134,"column":90}}],"line":134},"34":{"loc":{"start":{"line":134,"column":27},"end":{"line":134,"column":65}},"type":"binary-expr","locations":[{"start":{"line":134,"column":27},"end":{"line":134,"column":43}},{"start":{"line":134,"column":47},"end":{"line":134,"column":65}}],"line":134},"35":{"loc":{"start":{"line":139,"column":8},"end":{"line":141,"column":9}},"type":"if","locations":[{"start":{"line":139,"column":8},"end":{"line":141,"column":9}},{"start":{"line":139,"column":8},"end":{"line":141,"column":9}}],"line":139},"36":{"loc":{"start":{"line":146,"column":8},"end":{"line":148,"column":9}},"type":"if","locations":[{"start":{"line":146,"column":8},"end":{"line":148,"column":9}},{"start":{"line":146,"column":8},"end":{"line":148,"column":9}}],"line":146},"37":{"loc":{"start":{"line":153,"column":12},"end":{"line":159,"column":13}},"type":"if","locations":[{"start":{"line":153,"column":12},"end":{"line":159,"column":13}},{"start":{"line":153,"column":12},"end":{"line":159,"column":13}}],"line":153},"38":{"loc":{"start":{"line":153,"column":16},"end":{"line":153,"column":55}},"type":"binary-expr","locations":[{"start":{"line":153,"column":16},"end":{"line":153,"column":24}},{"start":{"line":153,"column":28},"end":{"line":153,"column":55}}],"line":153},"39":{"loc":{"start":{"line":164,"column":41},"end":{"line":164,"column":54}},"type":"binary-expr","locations":[{"start":{"line":164,"column":41},"end":{"line":164,"column":48}},{"start":{"line":164,"column":52},"end":{"line":164,"column":54}}],"line":164},"40":{"loc":{"start":{"line":167,"column":8},"end":{"line":173,"column":9}},"type":"if","locations":[{"start":{"line":167,"column":8},"end":{"line":173,"column":9}},{"start":{"line":167,"column":8},"end":{"line":173,"column":9}}],"line":167},"41":{"loc":{"start":{"line":167,"column":12},"end":{"line":167,"column":51}},"type":"binary-expr","locations":[{"start":{"line":167,"column":12},"end":{"line":167,"column":20}},{"start":{"line":167,"column":24},"end":{"line":167,"column":51}}],"line":167},"42":{"loc":{"start":{"line":176,"column":39},"end":{"line":176,"column":52}},"type":"binary-expr","locations":[{"start":{"line":176,"column":39},"end":{"line":176,"column":46}},{"start":{"line":176,"column":50},"end":{"line":176,"column":52}}],"line":176},"43":{"loc":{"start":{"line":191,"column":8},"end":{"line":196,"column":9}},"type":"if","locations":[{"start":{"line":191,"column":8},"end":{"line":196,"column":9}},{"start":{"line":191,"column":8},"end":{"line":196,"column":9}}],"line":191},"44":{"loc":{"start":{"line":192,"column":12},"end":{"line":194,"column":13}},"type":"if","locations":[{"start":{"line":192,"column":12},"end":{"line":194,"column":13}},{"start":{"line":192,"column":12},"end":{"line":194,"column":13}}],"line":192},"45":{"loc":{"start":{"line":198,"column":8},"end":{"line":214,"column":9}},"type":"if","locations":[{"start":{"line":198,"column":8},"end":{"line":214,"column":9}},{"start":{"line":198,"column":8},"end":{"line":214,"column":9}}],"line":198},"46":{"loc":{"start":{"line":207,"column":19},"end":{"line":213,"column":14}},"type":"cond-expr","locations":[{"start":{"line":207,"column":83},"end":{"line":207,"column":89}},{"start":{"line":207,"column":92},"end":{"line":213,"column":14}}],"line":207},"47":{"loc":{"start":{"line":207,"column":19},"end":{"line":207,"column":80}},"type":"binary-expr","locations":[{"start":{"line":207,"column":19},"end":{"line":207,"column":54}},{"start":{"line":207,"column":58},"end":{"line":207,"column":80}}],"line":207},"48":{"loc":{"start":{"line":215,"column":8},"end":{"line":217,"column":9}},"type":"if","locations":[{"start":{"line":215,"column":8},"end":{"line":217,"column":9}},{"start":{"line":215,"column":8},"end":{"line":217,"column":9}}],"line":215},"49":{"loc":{"start":{"line":222,"column":8},"end":{"line":224,"column":9}},"type":"if","locations":[{"start":{"line":222,"column":8},"end":{"line":224,"column":9}},{"start":{"line":222,"column":8},"end":{"line":224,"column":9}}],"line":222},"50":{"loc":{"start":{"line":223,"column":53},"end":{"line":223,"column":66}},"type":"binary-expr","locations":[{"start":{"line":223,"column":53},"end":{"line":223,"column":60}},{"start":{"line":223,"column":64},"end":{"line":223,"column":66}}],"line":223},"51":{"loc":{"start":{"line":226,"column":8},"end":{"line":231,"column":9}},"type":"if","locations":[{"start":{"line":226,"column":8},"end":{"line":231,"column":9}},{"start":{"line":226,"column":8},"end":{"line":231,"column":9}}],"line":226},"52":{"loc":{"start":{"line":238,"column":15},"end":{"line":244,"column":10}},"type":"cond-expr","locations":[{"start":{"line":238,"column":79},"end":{"line":238,"column":85}},{"start":{"line":238,"column":88},"end":{"line":244,"column":10}}],"line":238},"53":{"loc":{"start":{"line":238,"column":15},"end":{"line":238,"column":76}},"type":"binary-expr","locations":[{"start":{"line":238,"column":15},"end":{"line":238,"column":50}},{"start":{"line":238,"column":54},"end":{"line":238,"column":76}}],"line":238},"54":{"loc":{"start":{"line":251,"column":19},"end":{"line":253,"column":14}},"type":"cond-expr","locations":[{"start":{"line":251,"column":85},"end":{"line":251,"column":91}},{"start":{"line":251,"column":94},"end":{"line":253,"column":14}}],"line":251},"55":{"loc":{"start":{"line":251,"column":19},"end":{"line":251,"column":82}},"type":"binary-expr","locations":[{"start":{"line":251,"column":19},"end":{"line":251,"column":55}},{"start":{"line":251,"column":59},"end":{"line":251,"column":82}}],"line":251},"56":{"loc":{"start":{"line":262,"column":8},"end":{"line":267,"column":9}},"type":"if","locations":[{"start":{"line":262,"column":8},"end":{"line":267,"column":9}},{"start":{"line":262,"column":8},"end":{"line":267,"column":9}}],"line":262},"57":{"loc":{"start":{"line":263,"column":12},"end":{"line":265,"column":13}},"type":"if","locations":[{"start":{"line":263,"column":12},"end":{"line":265,"column":13}},{"start":{"line":263,"column":12},"end":{"line":265,"column":13}}],"line":263},"58":{"loc":{"start":{"line":269,"column":21},"end":{"line":269,"column":86}},"type":"cond-expr","locations":[{"start":{"line":269,"column":62},"end":{"line":269,"column":68}},{"start":{"line":269,"column":71},"end":{"line":269,"column":86}}],"line":269},"59":{"loc":{"start":{"line":269,"column":21},"end":{"line":269,"column":59}},"type":"binary-expr","locations":[{"start":{"line":269,"column":21},"end":{"line":269,"column":37}},{"start":{"line":269,"column":41},"end":{"line":269,"column":59}}],"line":269},"60":{"loc":{"start":{"line":282,"column":19},"end":{"line":289,"column":14}},"type":"cond-expr","locations":[{"start":{"line":282,"column":83},"end":{"line":282,"column":89}},{"start":{"line":282,"column":92},"end":{"line":289,"column":14}}],"line":282},"61":{"loc":{"start":{"line":282,"column":19},"end":{"line":282,"column":80}},"type":"binary-expr","locations":[{"start":{"line":282,"column":19},"end":{"line":282,"column":54}},{"start":{"line":282,"column":58},"end":{"line":282,"column":80}}],"line":282},"62":{"loc":{"start":{"line":288,"column":25},"end":{"line":288,"column":90}},"type":"cond-expr","locations":[{"start":{"line":288,"column":66},"end":{"line":288,"column":72}},{"start":{"line":288,"column":75},"end":{"line":288,"column":90}}],"line":288},"63":{"loc":{"start":{"line":288,"column":25},"end":{"line":288,"column":63}},"type":"binary-expr","locations":[{"start":{"line":288,"column":25},"end":{"line":288,"column":41}},{"start":{"line":288,"column":45},"end":{"line":288,"column":63}}],"line":288},"64":{"loc":{"start":{"line":290,"column":18},"end":{"line":290,"column":191}},"type":"cond-expr","locations":[{"start":{"line":290,"column":59},"end":{"line":290,"column":65}},{"start":{"line":290,"column":68},"end":{"line":290,"column":191}}],"line":290},"65":{"loc":{"start":{"line":290,"column":18},"end":{"line":290,"column":56}},"type":"binary-expr","locations":[{"start":{"line":290,"column":18},"end":{"line":290,"column":34}},{"start":{"line":290,"column":38},"end":{"line":290,"column":56}}],"line":290},"66":{"loc":{"start":{"line":290,"column":68},"end":{"line":290,"column":191}},"type":"cond-expr","locations":[{"start":{"line":290,"column":147},"end":{"line":290,"column":153}},{"start":{"line":290,"column":156},"end":{"line":290,"column":191}}],"line":290},"67":{"loc":{"start":{"line":290,"column":68},"end":{"line":290,"column":144}},"type":"binary-expr","locations":[{"start":{"line":290,"column":68},"end":{"line":290,"column":113}},{"start":{"line":290,"column":117},"end":{"line":290,"column":144}}],"line":290},"68":{"loc":{"start":{"line":292,"column":8},"end":{"line":298,"column":9}},"type":"if","locations":[{"start":{"line":292,"column":8},"end":{"line":298,"column":9}},{"start":{"line":292,"column":8},"end":{"line":298,"column":9}}],"line":292},"69":{"loc":{"start":{"line":307,"column":8},"end":{"line":309,"column":9}},"type":"if","locations":[{"start":{"line":307,"column":8},"end":{"line":309,"column":9}},{"start":{"line":307,"column":8},"end":{"line":309,"column":9}}],"line":307},"70":{"loc":{"start":{"line":310,"column":8},"end":{"line":315,"column":9}},"type":"if","locations":[{"start":{"line":310,"column":8},"end":{"line":315,"column":9}},{"start":{"line":310,"column":8},"end":{"line":315,"column":9}}],"line":310},"71":{"loc":{"start":{"line":326,"column":8},"end":{"line":328,"column":9}},"type":"if","locations":[{"start":{"line":326,"column":8},"end":{"line":328,"column":9}},{"start":{"line":326,"column":8},"end":{"line":328,"column":9}}],"line":326},"72":{"loc":{"start":{"line":329,"column":8},"end":{"line":331,"column":9}},"type":"if","locations":[{"start":{"line":329,"column":8},"end":{"line":331,"column":9}},{"start":{"line":329,"column":8},"end":{"line":331,"column":9}}],"line":329},"73":{"loc":{"start":{"line":335,"column":8},"end":{"line":337,"column":9}},"type":"if","locations":[{"start":{"line":335,"column":8},"end":{"line":337,"column":9}},{"start":{"line":335,"column":8},"end":{"line":337,"column":9}}],"line":335},"74":{"loc":{"start":{"line":348,"column":8},"end":{"line":350,"column":9}},"type":"if","locations":[{"start":{"line":348,"column":8},"end":{"line":350,"column":9}},{"start":{"line":348,"column":8},"end":{"line":350,"column":9}}],"line":348},"75":{"loc":{"start":{"line":351,"column":8},"end":{"line":353,"column":9}},"type":"if","locations":[{"start":{"line":351,"column":8},"end":{"line":353,"column":9}},{"start":{"line":351,"column":8},"end":{"line":353,"column":9}}],"line":351},"76":{"loc":{"start":{"line":364,"column":8},"end":{"line":366,"column":9}},"type":"if","locations":[{"start":{"line":364,"column":8},"end":{"line":366,"column":9}},{"start":{"line":364,"column":8},"end":{"line":366,"column":9}}],"line":364},"77":{"loc":{"start":{"line":367,"column":23},"end":{"line":367,"column":81}},"type":"cond-expr","locations":[{"start":{"line":367,"column":33},"end":{"line":367,"column":60}},{"start":{"line":367,"column":63},"end":{"line":367,"column":81}}],"line":367},"78":{"loc":{"start":{"line":378,"column":8},"end":{"line":380,"column":9}},"type":"if","locations":[{"start":{"line":378,"column":8},"end":{"line":380,"column":9}},{"start":{"line":378,"column":8},"end":{"line":380,"column":9}}],"line":378},"79":{"loc":{"start":{"line":396,"column":30},"end":{"line":396,"column":190}},"type":"cond-expr","locations":[{"start":{"line":396,"column":115},"end":{"line":396,"column":151}},{"start":{"line":396,"column":154},"end":{"line":396,"column":190}}],"line":396},"80":{"loc":{"start":{"line":396,"column":31},"end":{"line":396,"column":111}},"type":"cond-expr","locations":[{"start":{"line":396,"column":72},"end":{"line":396,"column":78}},{"start":{"line":396,"column":81},"end":{"line":396,"column":111}}],"line":396},"81":{"loc":{"start":{"line":396,"column":31},"end":{"line":396,"column":69}},"type":"binary-expr","locations":[{"start":{"line":396,"column":31},"end":{"line":396,"column":47}},{"start":{"line":396,"column":51},"end":{"line":396,"column":69}}],"line":396},"82":{"loc":{"start":{"line":397,"column":59},"end":{"line":397,"column":135}},"type":"binary-expr","locations":[{"start":{"line":397,"column":60},"end":{"line":397,"column":128}},{"start":{"line":397,"column":133},"end":{"line":397,"column":135}}],"line":397},"83":{"loc":{"start":{"line":397,"column":60},"end":{"line":397,"column":128}},"type":"cond-expr","locations":[{"start":{"line":397,"column":101},"end":{"line":397,"column":107}},{"start":{"line":397,"column":110},"end":{"line":397,"column":128}}],"line":397},"84":{"loc":{"start":{"line":397,"column":60},"end":{"line":397,"column":98}},"type":"binary-expr","locations":[{"start":{"line":397,"column":60},"end":{"line":397,"column":76}},{"start":{"line":397,"column":80},"end":{"line":397,"column":98}}],"line":397},"85":{"loc":{"start":{"line":400,"column":35},"end":{"line":400,"column":236}},"type":"cond-expr","locations":[{"start":{"line":400,"column":200},"end":{"line":400,"column":228}},{"start":{"line":400,"column":231},"end":{"line":400,"column":236}}],"line":400},"86":{"loc":{"start":{"line":400,"column":35},"end":{"line":400,"column":197}},"type":"binary-expr","locations":[{"start":{"line":400,"column":35},"end":{"line":400,"column":154}},{"start":{"line":400,"column":158},"end":{"line":400,"column":197}}],"line":400},"87":{"loc":{"start":{"line":400,"column":67},"end":{"line":400,"column":144}},"type":"cond-expr","locations":[{"start":{"line":400,"column":108},"end":{"line":400,"column":114}},{"start":{"line":400,"column":117},"end":{"line":400,"column":144}}],"line":400},"88":{"loc":{"start":{"line":400,"column":67},"end":{"line":400,"column":105}},"type":"binary-expr","locations":[{"start":{"line":400,"column":67},"end":{"line":400,"column":83}},{"start":{"line":400,"column":87},"end":{"line":400,"column":105}}],"line":400}},"s":{"0":1,"1":1,"2":6,"3":1,"4":1,"5":1,"6":1,"7":1,"8":0,"9":1,"10":7,"11":7,"12":0,"13":7,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":7,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":7,"159":7,"160":7,"161":7,"162":7,"163":7,"164":7,"165":7,"166":7},"f":{"0":6,"1":0,"2":7,"3":0,"4":0,"5":7,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":7},"b":{"0":[1,0],"1":[1,0],"2":[0,7],"3":[7,0],"4":[7,7],"5":[0,0],"6":[0,0],"7":[0,7],"8":[7,0],"9":[7,7],"10":[0,0],"11":[0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0,0],"24":[0,0],"25":[0,0],"26":[0],"27":[0,0],"28":[0,0],"29":[0],"30":[0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0],"56":[0,0],"57":[0,0],"58":[0,0],"59":[0,0],"60":[0,0],"61":[0,0],"62":[0,0],"63":[0,0],"64":[0,0],"65":[0,0],"66":[0,0],"67":[0,0],"68":[0,0],"69":[0,0],"70":[0,0],"71":[0,0],"72":[0,0],"73":[0,0],"74":[0,0],"75":[0,0],"76":[0,0],"77":[0,0],"78":[0,0],"79":[0,7],"80":[7,0],"81":[7,7],"82":[7,7],"83":[7,0],"84":[7,7],"85":[0,7],"86":[7,7],"87":[7,0],"88":[7,7]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/models/raw/BaseRaw.ts"],"sourcesContent":["import { traceInstanceMethods } from '@rocket.chat/core-services';\nimport type { RocketChatRecordDeleted } from '@rocket.chat/core-typings';\nimport type { IBaseModel, DefaultFields, ResultFields, FindPaginated, InsertionModel } from '@rocket.chat/model-typings';\nimport type { Updater } from '@rocket.chat/models';\nimport { getCollectionName, UpdaterImpl } from '@rocket.chat/models';\nimport { ObjectId } from 'mongodb';\nimport type {\n\tBulkWriteOptions,\n\tChangeStream,\n\tCollection,\n\tCollectionOptions,\n\tDb,\n\tFilter,\n\tFindOneAndUpdateOptions,\n\tIndexDescription,\n\tInsertOneOptions,\n\tModifyResult,\n\tOptionalUnlessRequiredId,\n\tUpdateFilter,\n\tWithId,\n\tUpdateOptions,\n\tDocument,\n\tFindOptions,\n\tFindCursor,\n\tUpdateResult,\n\tInsertManyResult,\n\tInsertOneResult,\n\tDeleteResult,\n\tDeleteOptions,\n\tFindOneAndDeleteOptions,\n\tCountDocumentsOptions,\n} from 'mongodb';\n\nimport { setUpdatedAt } from './setUpdatedAt';\n\nconst warnFields =\n\tprocess.env.NODE_ENV !== 'production' || process.env.SHOW_WARNINGS === 'true'\n\t\t? (...rest: any): void => {\n\t\t\t\tconsole.warn(...rest, new Error().stack);\n\t\t\t}\n\t\t: new Function();\n\ntype ModelOptions = {\n\tpreventSetUpdatedAt?: boolean;\n\tcollectionNameResolver?: (name: string) => string;\n\tcollection?: CollectionOptions;\n\t_updatedAtIndexOptions?: Omit<IndexDescription, 'key'>;\n};\n\nexport abstract class BaseRaw<\n\tT extends { _id: string },\n\tC extends DefaultFields<T> = undefined,\n\tTDeleted extends RocketChatRecordDeleted<T> = RocketChatRecordDeleted<T>,\n> implements IBaseModel<T, C, TDeleted>\n{\n\tpublic readonly defaultFields: C;\n\n\tpublic readonly col: Collection<T>;\n\n\tprivate preventSetUpdatedAt: boolean;\n\n\t/**\n\t * Collection name to store data.\n\t */\n\tprivate collectionName: string;\n\n\t/**\n\t * @param db MongoDB instance\n\t * @param name Name of the model without any prefix. Used by trash records to set the `__collection__` field.\n\t * @param trash Trash collection instance\n\t * @param options Model options\n\t */\n\tconstructor(\n\t\tprivate db: Db,\n\t\tprotected name: string,\n\t\tprotected trash?: Collection<TDeleted>,\n\t\tprivate options?: ModelOptions,\n\t) {\n\t\tthis.collectionName = options?.collectionNameResolver ? options.collectionNameResolver(name) : getCollectionName(name);\n\n\t\tthis.col = this.db.collection(this.collectionName, options?.collection || {});\n\n\t\tvoid this.createIndexes();\n\n\t\tthis.preventSetUpdatedAt = options?.preventSetUpdatedAt ?? false;\n\n\t\treturn traceInstanceMethods(this);\n\t}\n\n\tprivate pendingIndexes: Promise<void> | undefined;\n\n\tpublic async createIndexes() {\n\t\tconst indexes = this.modelIndexes();\n\t\tif (this.options?._updatedAtIndexOptions) {\n\t\t\tindexes?.push({ ...this.options._updatedAtIndexOptions, key: { _updatedAt: 1 } });\n\t\t}\n\n\t\tif (indexes?.length) {\n\t\t\tif (this.pendingIndexes) {\n\t\t\t\tawait this.pendingIndexes;\n\t\t\t}\n\n\t\t\tthis.pendingIndexes = this.col.createIndexes(indexes).catch((e) => {\n\t\t\t\tconsole.warn(`Some indexes for collection '${this.collectionName}' could not be created:\\n\\t${e.message}`);\n\t\t\t}) as unknown as Promise<void>;\n\n\t\t\tvoid this.pendingIndexes.finally(() => {\n\t\t\t\tthis.pendingIndexes = undefined;\n\t\t\t});\n\n\t\t\treturn this.pendingIndexes;\n\t\t}\n\t}\n\n\tprotected modelIndexes(): IndexDescription[] | undefined {\n\t\treturn undefined;\n\t}\n\n\tgetCollectionName(): string {\n\t\treturn this.collectionName;\n\t}\n\n\tpublic getUpdater(): Updater<T> {\n\t\treturn new UpdaterImpl<T>();\n\t}\n\n\tpublic updateFromUpdater(query: Filter<T>, updater: Updater<T>): Promise<UpdateResult> {\n\t\tconst updateFilter = updater.getUpdateFilter();\n\t\treturn this.updateOne(query, updateFilter).catch((e) => {\n\t\t\tconsole.warn(e, updateFilter);\n\t\t\treturn Promise.reject(e);\n\t\t});\n\t}\n\n\tprivate doNotMixInclusionAndExclusionFields(options: FindOptions<T> = {}): FindOptions<T> {\n\t\tconst optionsDef = this.ensureDefaultFields(options);\n\t\tif (optionsDef?.projection === undefined) {\n\t\t\treturn optionsDef;\n\t\t}\n\n\t\tconst projection: Record<string, any> = optionsDef?.projection;\n\t\tconst keys = Object.keys(projection);\n\t\tconst removeKeys = keys.filter((key) => projection[key] === 0);\n\t\tif (keys.length > removeKeys.length) {\n\t\t\tremoveKeys.forEach((key) => delete projection[key]);\n\t\t}\n\n\t\treturn {\n\t\t\t...optionsDef,\n\t\t\tprojection,\n\t\t};\n\t}\n\n\tprivate ensureDefaultFields<P extends Document>(options: FindOptions<P>): FindOptions<P>;\n\n\tprivate ensureDefaultFields<P extends Document>(\n\t\toptions?: FindOptions<P> & { fields?: FindOptions<P>['projection'] },\n\t): FindOptions<P> | FindOptions<T> | undefined {\n\t\tif (options?.fields) {\n\t\t\twarnFields(\"Using 'fields' in models is deprecated.\", options);\n\t\t}\n\n\t\tif (this.defaultFields === undefined) {\n\t\t\treturn options;\n\t\t}\n\n\t\tconst { fields: deprecatedFields, projection, ...rest } = options || {};\n\n\t\tconst fields = { ...deprecatedFields, ...projection };\n\n\t\treturn {\n\t\t\tprojection: this.defaultFields,\n\t\t\t...(fields && Object.values(fields).length && { projection: fields }),\n\t\t\t...rest,\n\t\t};\n\t}\n\n\tpublic findOneAndUpdate(query: Filter<T>, update: UpdateFilter<T> | T, options?: FindOneAndUpdateOptions): Promise<ModifyResult<T>> {\n\t\tthis.setUpdatedAt(update);\n\t\treturn this.col.findOneAndUpdate(query, update, options || {});\n\t}\n\n\tasync findOneById(_id: T['_id'], options?: FindOptions<T>): Promise<T | null>;\n\n\tasync findOneById<P extends Document = T>(_id: T['_id'], options?: FindOptions<P>): Promise<P | null>;\n\n\tasync findOneById(_id: T['_id'], options?: any): Promise<T | null> {\n\t\tconst query: Filter<T> = { _id } as Filter<T>;\n\t\tif (options) {\n\t\t\treturn this.findOne(query, options);\n\t\t}\n\t\treturn this.findOne(query);\n\t}\n\n\tasync findOne(query?: Filter<T> | T['_id'], options?: undefined): Promise<T | null>;\n\n\tasync findOne<P extends Document = T>(query: Filter<T> | T['_id'], options?: FindOptions<P extends T ? T : P>): Promise<P | null>;\n\n\tasync findOne<P>(query: Filter<T> | T['_id'] = {}, options?: any): Promise<WithId<T> | WithId<P> | null> {\n\t\tconst q: Filter<T> = typeof query === 'string' ? ({ _id: query } as Filter<T>) : query;\n\t\tconst optionsDef = this.doNotMixInclusionAndExclusionFields(options);\n\t\tif (optionsDef) {\n\t\t\treturn this.col.findOne(q, optionsDef);\n\t\t}\n\t\treturn this.col.findOne(q);\n\t}\n\n\tfind(query?: Filter<T>): FindCursor<ResultFields<T, C>>;\n\n\tfind<P extends Document = T>(query: Filter<T>, options?: FindOptions<P extends T ? T : P>): FindCursor<P>;\n\n\tfind<P extends Document>(\n\t\tquery: Filter<T> = {},\n\t\toptions?: FindOptions<P extends T ? T : P>,\n\t): FindCursor<WithId<P>> | FindCursor<WithId<T>> {\n\t\tconst optionsDef = this.doNotMixInclusionAndExclusionFields(options);\n\t\treturn this.col.find(query, optionsDef);\n\t}\n\n\tfindPaginated<P extends Document = T>(query: Filter<T>, options?: FindOptions<P extends T ? T : P>): FindPaginated<FindCursor<WithId<P>>>;\n\n\tfindPaginated(query: Filter<T> = {}, options?: any): FindPaginated<FindCursor<WithId<T>>> {\n\t\tconst optionsDef = this.doNotMixInclusionAndExclusionFields(options);\n\n\t\tconst cursor = optionsDef ? this.col.find(query, optionsDef) : this.col.find(query);\n\t\tconst totalCount = this.col.countDocuments(query);\n\n\t\treturn {\n\t\t\tcursor,\n\t\t\ttotalCount,\n\t\t};\n\t}\n\n\t/**\n\t * @deprecated use {@link updateOne} or {@link updateAny} instead\n\t */\n\tupdate(\n\t\tfilter: Filter<T>,\n\t\tupdate: UpdateFilter<T> | Partial<T>,\n\t\toptions?: UpdateOptions & { multi?: true },\n\t): Promise<UpdateResult | Document> {\n\t\tconst operation = options?.multi ? 'updateMany' : 'updateOne';\n\n\t\treturn this[operation](filter, update, options);\n\t}\n\n\tupdateOne(filter: Filter<T>, update: UpdateFilter<T> | Partial<T>, options?: UpdateOptions): Promise<UpdateResult> {\n\t\tthis.setUpdatedAt(update);\n\t\tif (options) {\n\t\t\treturn this.col.updateOne(filter, update, options);\n\t\t}\n\t\treturn this.col.updateOne(filter, update);\n\t}\n\n\tupdateMany(filter: Filter<T>, update: UpdateFilter<T> | Partial<T>, options?: UpdateOptions): Promise<Document | UpdateResult> {\n\t\tthis.setUpdatedAt(update);\n\t\tif (options) {\n\t\t\treturn this.col.updateMany(filter, update, options);\n\t\t}\n\t\treturn this.col.updateMany(filter, update);\n\t}\n\n\tinsertMany(docs: InsertionModel<T>[], options?: BulkWriteOptions): Promise<InsertManyResult<T>> {\n\t\tdocs = docs.map((doc) => {\n\t\t\tif (!doc._id || typeof doc._id !== 'string') {\n\t\t\t\tconst oid = new ObjectId();\n\t\t\t\treturn { _id: oid.toHexString(), ...doc };\n\t\t\t}\n\t\t\tthis.setUpdatedAt(doc);\n\t\t\treturn doc;\n\t\t});\n\n\t\t// TODO reavaluate following type casting\n\t\treturn this.col.insertMany(docs as unknown as OptionalUnlessRequiredId<T>[], options || {});\n\t}\n\n\tinsertOne(doc: InsertionModel<T>, options?: InsertOneOptions): Promise<InsertOneResult<T>> {\n\t\tif (!doc._id || typeof doc._id !== 'string') {\n\t\t\tconst oid = new ObjectId();\n\t\t\tdoc = { _id: oid.toHexString(), ...doc };\n\t\t}\n\n\t\tthis.setUpdatedAt(doc);\n\n\t\t// TODO reavaluate following type casting\n\t\treturn this.col.insertOne(doc as unknown as OptionalUnlessRequiredId<T>, options || {});\n\t}\n\n\tremoveById(_id: T['_id']): Promise<DeleteResult> {\n\t\treturn this.deleteOne({ _id } as Filter<T>);\n\t}\n\n\tremoveByIds(ids: T['_id'][]): Promise<DeleteResult> {\n\t\treturn this.deleteMany({ _id: { $in: ids } } as unknown as Filter<T>);\n\t}\n\n\tasync deleteOne(filter: Filter<T>, options?: DeleteOptions & { bypassDocumentValidation?: boolean }): Promise<DeleteResult> {\n\t\tif (!this.trash) {\n\t\t\tif (options) {\n\t\t\t\treturn this.col.deleteOne(filter, options);\n\t\t\t}\n\t\t\treturn this.col.deleteOne(filter);\n\t\t}\n\n\t\tconst doc = await this.findOne(filter);\n\n\t\tif (doc) {\n\t\t\tconst { _id, ...record } = doc;\n\n\t\t\tconst trash: TDeleted = {\n\t\t\t\t...record,\n\t\t\t\t_deletedAt: new Date(),\n\t\t\t\t__collection__: this.name,\n\t\t\t} as unknown as TDeleted;\n\n\t\t\t// since the operation is not atomic, we need to make sure that the record is not already deleted/inserted\n\t\t\tawait this.trash?.updateOne({ _id } as Filter<TDeleted>, { $set: trash } as UpdateFilter<TDeleted>, {\n\t\t\t\tupsert: true,\n\t\t\t});\n\t\t}\n\n\t\tif (options) {\n\t\t\treturn this.col.deleteOne(filter, options);\n\t\t}\n\t\treturn this.col.deleteOne(filter);\n\t}\n\n\tasync findOneAndDelete(filter: Filter<T>, options?: FindOneAndDeleteOptions): Promise<ModifyResult<T>> {\n\t\tif (!this.trash) {\n\t\t\treturn this.col.findOneAndDelete(filter, options || {});\n\t\t}\n\n\t\tconst doc = await this.col.findOne(filter);\n\t\tif (!doc) {\n\t\t\treturn { ok: 1, value: null };\n\t\t}\n\n\t\tconst { _id, ...record } = doc;\n\t\tconst trash: TDeleted = {\n\t\t\t...record,\n\t\t\t_deletedAt: new Date(),\n\t\t\t__collection__: this.name,\n\t\t} as unknown as TDeleted;\n\n\t\tawait this.trash?.updateOne({ _id } as Filter<TDeleted>, { $set: trash } as UpdateFilter<TDeleted>, {\n\t\t\tupsert: true,\n\t\t});\n\n\t\ttry {\n\t\t\tawait this.col.deleteOne({ _id } as Filter<T>);\n\t\t} catch (e) {\n\t\t\tawait this.trash?.deleteOne({ _id } as Filter<TDeleted>);\n\t\t\tthrow e;\n\t\t}\n\n\t\treturn { ok: 1, value: doc };\n\t}\n\n\tasync deleteMany(filter: Filter<T>, options?: DeleteOptions & { onTrash?: (record: ResultFields<T, C>) => void }): Promise<DeleteResult> {\n\t\tif (!this.trash) {\n\t\t\tif (options) {\n\t\t\t\treturn this.col.deleteMany(filter, options);\n\t\t\t}\n\t\t\treturn this.col.deleteMany(filter);\n\t\t}\n\n\t\tconst cursor = this.find<ResultFields<T, C>>(filter, { session: options?.session });\n\n\t\tconst ids: T['_id'][] = [];\n\t\tfor await (const doc of cursor) {\n\t\t\tconst { _id, ...record } = doc as T;\n\n\t\t\tconst trash: TDeleted = {\n\t\t\t\t...record,\n\t\t\t\t_deletedAt: new Date(),\n\t\t\t\t__collection__: this.name,\n\t\t\t} as unknown as TDeleted;\n\n\t\t\tids.push(_id as T['_id']);\n\n\t\t\t// since the operation is not atomic, we need to make sure that the record is not already deleted/inserted\n\t\t\tawait this.trash?.updateOne({ _id } as Filter<TDeleted>, { $set: trash } as UpdateFilter<TDeleted>, {\n\t\t\t\tupsert: true,\n\t\t\t\tsession: options?.session,\n\t\t\t});\n\n\t\t\tvoid options?.onTrash?.(doc);\n\t\t}\n\n\t\tif (options) {\n\t\t\treturn this.col.deleteMany({ _id: { $in: ids } } as unknown as Filter<T>, options);\n\t\t}\n\t\treturn this.col.deleteMany({ _id: { $in: ids } } as unknown as Filter<T>);\n\t}\n\n\t// Trash\n\ttrashFind<P extends TDeleted>(\n\t\tquery: Filter<TDeleted>,\n\t\toptions?: FindOptions<P extends TDeleted ? TDeleted : P>,\n\t): FindCursor<WithId<TDeleted>> | undefined {\n\t\tif (!this.trash) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (options) {\n\t\t\treturn this.trash.find(\n\t\t\t\t{\n\t\t\t\t\t__collection__: this.name,\n\t\t\t\t\t...query,\n\t\t\t\t},\n\t\t\t\toptions,\n\t\t\t);\n\t\t}\n\n\t\treturn this.trash.find({\n\t\t\t__collection__: this.name,\n\t\t\t...query,\n\t\t});\n\t}\n\n\ttrashFindOneById(_id: TDeleted['_id']): Promise<TDeleted | null>;\n\n\ttrashFindOneById<P extends Document>(_id: TDeleted['_id'], options: FindOptions<P extends TDeleted ? TDeleted : P>): Promise<P | null>;\n\n\tasync trashFindOneById<P extends TDeleted>(\n\t\t_id: TDeleted['_id'],\n\t\toptions?: FindOptions<P extends TDeleted ? TDeleted : P>,\n\t): Promise<WithId<P | TDeleted> | null> {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\t__collection__: this.name,\n\t\t} as Filter<P | TDeleted>;\n\n\t\tif (!this.trash) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (options) {\n\t\t\treturn (this.trash as Collection<P | TDeleted>).findOne(query, options);\n\t\t}\n\t\treturn (this.trash as Collection<P | TDeleted>).findOne(query);\n\t}\n\n\tprivate setUpdatedAt(record: UpdateFilter<T> | InsertionModel<T>): void {\n\t\tif (this.preventSetUpdatedAt) {\n\t\t\treturn;\n\t\t}\n\t\tsetUpdatedAt(record);\n\t}\n\n\ttrashFindDeletedAfter(deletedAt: Date): FindCursor<WithId<TDeleted>>;\n\n\ttrashFindDeletedAfter<P extends Document = TDeleted>(\n\t\tdeletedAt: Date,\n\t\tquery?: Filter<TDeleted>,\n\t\toptions?: FindOptions<P extends TDeleted ? TDeleted : P>,\n\t): FindCursor<WithId<TDeleted>> {\n\t\tconst q = {\n\t\t\t__collection__: this.name,\n\t\t\t_deletedAt: {\n\t\t\t\t$gt: deletedAt,\n\t\t\t},\n\t\t\t...query,\n\t\t} as Filter<TDeleted>;\n\n\t\tif (!this.trash) {\n\t\t\tthrow new Error('Trash is not enabled for this collection');\n\t\t}\n\n\t\tif (options) {\n\t\t\treturn this.trash.find(q, options);\n\t\t}\n\t\treturn this.trash.find(q);\n\t}\n\n\ttrashFindPaginatedDeletedAfter<P extends Document = TDeleted>(\n\t\tdeletedAt: Date,\n\t\tquery?: Filter<TDeleted>,\n\t\toptions?: FindOptions<P extends TDeleted ? TDeleted : P>,\n\t): FindPaginated<FindCursor<WithId<TDeleted>>> {\n\t\tconst q: Filter<TDeleted> = {\n\t\t\t__collection__: this.name,\n\t\t\t_deletedAt: {\n\t\t\t\t$gt: deletedAt,\n\t\t\t},\n\t\t\t...query,\n\t\t} as Filter<TDeleted>;\n\n\t\tif (!this.trash) {\n\t\t\tthrow new Error('Trash is not enabled for this collection');\n\t\t}\n\n\t\tconst cursor = options ? this.trash.find(q, options) : this.trash.find(q);\n\t\tconst totalCount = this.trash.countDocuments(q);\n\n\t\treturn {\n\t\t\tcursor,\n\t\t\ttotalCount,\n\t\t};\n\t}\n\n\twatch(pipeline?: object[]): ChangeStream<T> {\n\t\treturn this.col.watch(pipeline);\n\t}\n\n\tcountDocuments(query: Filter<T>, options?: CountDocumentsOptions): Promise<number> {\n\t\tif (options) {\n\t\t\treturn this.col.countDocuments(query, options);\n\t\t}\n\t\treturn this.col.countDocuments(query);\n\t}\n\n\testimatedDocumentCount(): Promise<number> {\n\t\treturn this.col.estimatedDocumentCount();\n\t}\n}\n"],"names":["BaseRaw","warnFields","process","env","NODE_ENV","SHOW_WARNINGS","rest","console","warn","Error","stack","Function","createIndexes","indexes","modelIndexes","options","_updatedAtIndexOptions","push","key","_updatedAt","length","pendingIndexes","col","catch","e","collectionName","message","finally","undefined","getCollectionName","getUpdater","UpdaterImpl","updateFromUpdater","query","updater","updateFilter","getUpdateFilter","updateOne","Promise","reject","doNotMixInclusionAndExclusionFields","optionsDef","ensureDefaultFields","projection","keys","Object","removeKeys","filter","forEach","fields","defaultFields","deprecatedFields","values","findOneAndUpdate","update","setUpdatedAt","findOneById","_id","findOne","q","find","findPaginated","cursor","totalCount","countDocuments","operation","multi","updateMany","insertMany","docs","map","doc","oid","ObjectId","toHexString","insertOne","removeById","deleteOne","removeByIds","ids","deleteMany","$in","trash","record","_deletedAt","Date","__collection__","name","$set","upsert","findOneAndDelete","ok","value","session","onTrash","trashFind","trashFindOneById","preventSetUpdatedAt","trashFindDeletedAfter","deletedAt","$gt","trashFindPaginatedDeletedAfter","watch","pipeline","estimatedDocumentCount","constructor","db","collectionNameResolver","collection","traceInstanceMethods"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/models/raw/BaseRaw.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"dfe7fe1cb4aa107c5a1493b95efac14e90a8a1eb","contentHash":"5bf1cdb9db08694143cc63572e40e00191beb9f35bddc3792638455bce5b75cf"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/models/raw/setUpdatedAt.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/models/raw/setUpdatedAt.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":28}},"3":{"start":{"line":12,"column":4},"end":{"line":17,"column":5}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":40}},"5":{"start":{"line":14,"column":8},"end":{"line":14,"column":44}},"6":{"start":{"line":16,"column":8},"end":{"line":16,"column":39}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"setUpdatedAt","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":21}},"loc":{"start":{"line":11,"column":30},"end":{"line":18,"column":1}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":4},"end":{"line":17,"column":5}},"type":"if","locations":[{"start":{"line":12,"column":4},"end":{"line":17,"column":5}},{"start":{"line":12,"column":4},"end":{"line":17,"column":5}}],"line":12},"1":{"loc":{"start":{"line":13,"column":22},"end":{"line":13,"column":39}},"type":"binary-expr","locations":[{"start":{"line":13,"column":22},"end":{"line":13,"column":33}},{"start":{"line":13,"column":37},"end":{"line":13,"column":39}}],"line":13}},"s":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":0},"f":{"0":0,"1":0},"b":{"0":[0,0],"1":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/models/raw/setUpdatedAt.ts"],"sourcesContent":["export function setUpdatedAt(record: Record<string, any>): void {\n\tif (/(^|,)\\$/.test(Object.keys(record).join(','))) {\n\t\trecord.$set = record.$set || {};\n\t\trecord.$set._updatedAt = new Date();\n\t} else {\n\t\trecord._updatedAt = new Date();\n\t}\n}\n"],"names":["setUpdatedAt","record","test","Object","keys","join","$set","_updatedAt","Date"],"mappings":";;;;+BAAgBA;;;eAAAA;;;AAAT,SAASA,aAAaC,MAA2B;IACvD,IAAI,UAAUC,IAAI,CAACC,OAAOC,IAAI,CAACH,QAAQI,IAAI,CAAC,OAAO;QAClDJ,OAAOK,IAAI,GAAGL,OAAOK,IAAI,IAAI,CAAC;QAC9BL,OAAOK,IAAI,CAACC,UAAU,GAAG,IAAIC;IAC9B,OAAO;QACNP,OAAOM,UAAU,GAAG,IAAIC;IACzB;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/models/raw/setUpdatedAt.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"48815a68fec297e79e396c248690855129829eb9","contentHash":"0efb67198e1476f62c1f5da4539165f87aa875604df388048d33166f35d70283"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/hooks/messages/BeforeSaveCannedResponse.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/hooks/messages/BeforeSaveCannedResponse.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":40}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":46}},"5":{"start":{"line":13,"column":33},"end":{"line":13,"column":80}},"6":{"start":{"line":14,"column":27},"end":{"line":14,"column":67}},"7":{"start":{"line":16,"column":4},"end":{"line":18,"column":6}},"8":{"start":{"line":20,"column":26},"end":{"line":41,"column":1}},"9":{"start":{"line":42,"column":31},"end":{"line":91,"column":1}},"10":{"start":{"line":46,"column":8},"end":{"line":48,"column":9}},"11":{"start":{"line":47,"column":12},"end":{"line":47,"column":27}},"12":{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},"13":{"start":{"line":50,"column":12},"end":{"line":50,"column":27}},"14":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"15":{"start":{"line":53,"column":12},"end":{"line":53,"column":27}},"16":{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},"17":{"start":{"line":57,"column":12},"end":{"line":57,"column":27}},"18":{"start":{"line":59,"column":24},"end":{"line":59,"column":168}},"19":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"20":{"start":{"line":61,"column":12},"end":{"line":61,"column":27}},"21":{"start":{"line":63,"column":25},"end":{"line":68,"column":9}},"22":{"start":{"line":64,"column":12},"end":{"line":66,"column":13}},"23":{"start":{"line":65,"column":16},"end":{"line":65,"column":28}},"24":{"start":{"line":67,"column":12},"end":{"line":67,"column":41}},"25":{"start":{"line":69,"column":8},"end":{"line":74,"column":41}},"26":{"start":{"line":70,"column":38},"end":{"line":70,"column":62}},"27":{"start":{"line":71,"column":25},"end":{"line":71,"column":121}},"28":{"start":{"line":72,"column":25},"end":{"line":72,"column":85}},"29":{"start":{"line":73,"column":12},"end":{"line":73,"column":86}},"30":{"start":{"line":75,"column":8},"end":{"line":75,"column":23}},"31":{"start":{"line":78,"column":8},"end":{"line":86,"column":11}},"32":{"start":{"line":78,"column":51},"end":{"line":84,"column":14}},"33":{"start":{"line":87,"column":8},"end":{"line":89,"column":11}},"34":{"start":{"line":87,"column":57},"end":{"line":87,"column":111}},"35":{"start":{"line":92,"column":0},"end":{"line":92,"column":41}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":15,"column":9},"end":{"line":15,"column":33}},"loc":{"start":{"line":15,"column":39},"end":{"line":19,"column":1}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":43,"column":4},"end":{"line":43,"column":5}},"loc":{"start":{"line":43,"column":55},"end":{"line":76,"column":5}},"line":43},"3":{"name":"(anonymous_3)","decl":{"start":{"line":63,"column":25},"end":{"line":63,"column":26}},"loc":{"start":{"line":63,"column":36},"end":{"line":68,"column":9}},"line":63},"4":{"name":"(anonymous_4)","decl":{"start":{"line":69,"column":66},"end":{"line":69,"column":67}},"loc":{"start":{"line":69,"column":94},"end":{"line":74,"column":9}},"line":69},"5":{"name":"(anonymous_5)","decl":{"start":{"line":77,"column":4},"end":{"line":77,"column":5}},"loc":{"start":{"line":77,"column":17},"end":{"line":90,"column":5}},"line":77},"6":{"name":"(anonymous_6)","decl":{"start":{"line":78,"column":41},"end":{"line":78,"column":42}},"loc":{"start":{"line":78,"column":51},"end":{"line":84,"column":14}},"line":78},"7":{"name":"(anonymous_7)","decl":{"start":{"line":87,"column":44},"end":{"line":87,"column":45}},"loc":{"start":{"line":87,"column":57},"end":{"line":87,"column":111}},"line":87}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":11},"end":{"line":18,"column":5}},"type":"cond-expr","locations":[{"start":{"line":16,"column":35},"end":{"line":16,"column":38}},{"start":{"line":16,"column":41},"end":{"line":18,"column":5}}],"line":16},"1":{"loc":{"start":{"line":16,"column":11},"end":{"line":16,"column":32}},"type":"binary-expr","locations":[{"start":{"line":16,"column":11},"end":{"line":16,"column":14}},{"start":{"line":16,"column":18},"end":{"line":16,"column":32}}],"line":16},"2":{"loc":{"start":{"line":46,"column":8},"end":{"line":48,"column":9}},"type":"if","locations":[{"start":{"line":46,"column":8},"end":{"line":48,"column":9}},{"start":{"line":46,"column":8},"end":{"line":48,"column":9}}],"line":46},"3":{"loc":{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},"type":"if","locations":[{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},{"start":{"line":49,"column":8},"end":{"line":51,"column":9}}],"line":49},"4":{"loc":{"start":{"line":49,"column":12},"end":{"line":49,"column":46}},"type":"binary-expr","locations":[{"start":{"line":49,"column":12},"end":{"line":49,"column":24}},{"start":{"line":49,"column":28},"end":{"line":49,"column":46}}],"line":49},"5":{"loc":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"type":"if","locations":[{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},{"start":{"line":52,"column":8},"end":{"line":54,"column":9}}],"line":52},"6":{"loc":{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},"type":"if","locations":[{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},{"start":{"line":56,"column":8},"end":{"line":58,"column":9}}],"line":56},"7":{"loc":{"start":{"line":56,"column":12},"end":{"line":56,"column":63}},"type":"binary-expr","locations":[{"start":{"line":56,"column":12},"end":{"line":56,"column":17}},{"start":{"line":56,"column":21},"end":{"line":56,"column":63}}],"line":56},"8":{"loc":{"start":{"line":59,"column":24},"end":{"line":59,"column":168}},"type":"cond-expr","locations":[{"start":{"line":59,"column":59},"end":{"line":59,"column":65}},{"start":{"line":59,"column":68},"end":{"line":59,"column":168}}],"line":59},"9":{"loc":{"start":{"line":59,"column":24},"end":{"line":59,"column":56}},"type":"binary-expr","locations":[{"start":{"line":59,"column":24},"end":{"line":59,"column":37}},{"start":{"line":59,"column":41},"end":{"line":59,"column":56}}],"line":59},"10":{"loc":{"start":{"line":59,"column":68},"end":{"line":59,"column":168}},"type":"cond-expr","locations":[{"start":{"line":59,"column":141},"end":{"line":59,"column":147}},{"start":{"line":59,"column":150},"end":{"line":59,"column":168}}],"line":59},"11":{"loc":{"start":{"line":59,"column":68},"end":{"line":59,"column":138}},"type":"binary-expr","locations":[{"start":{"line":59,"column":68},"end":{"line":59,"column":109}},{"start":{"line":59,"column":113},"end":{"line":59,"column":138}}],"line":59},"12":{"loc":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"type":"if","locations":[{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},{"start":{"line":60,"column":8},"end":{"line":62,"column":9}}],"line":60},"13":{"loc":{"start":{"line":64,"column":12},"end":{"line":66,"column":13}},"type":"if","locations":[{"start":{"line":64,"column":12},"end":{"line":66,"column":13}},{"start":{"line":64,"column":12},"end":{"line":66,"column":13}}],"line":64},"14":{"loc":{"start":{"line":71,"column":25},"end":{"line":71,"column":121}},"type":"cond-expr","locations":[{"start":{"line":71,"column":62},"end":{"line":71,"column":85}},{"start":{"line":71,"column":88},"end":{"line":71,"column":121}}],"line":71}},"s":{"0":1,"1":1,"2":14,"3":1,"4":1,"5":1,"6":1,"7":2,"8":1,"9":1,"10":7,"11":1,"12":6,"13":1,"14":5,"15":1,"16":4,"17":1,"18":3,"19":3,"20":1,"21":2,"22":4,"23":2,"24":2,"25":2,"26":10,"27":10,"28":10,"29":10,"30":2,"31":7,"32":1,"33":7,"34":2,"35":1},"f":{"0":14,"1":2,"2":7,"3":4,"4":10,"5":7,"6":1,"7":2},"b":{"0":[0,2],"1":[2,2],"2":[1,6],"3":[1,5],"4":[6,5],"5":[1,4],"6":[1,3],"7":[4,4],"8":[0,3],"9":[3,3],"10":[1,2],"11":[3,3],"12":[1,2],"13":[2,2],"14":[4,6]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/hooks/messages/BeforeSaveCannedResponse.ts"],"sourcesContent":["import { isILivechatVisitor, isOmnichannelRoom } from '@rocket.chat/core-typings';\nimport type { IMessage, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { LivechatVisitors, Users } from '@rocket.chat/models';\nimport get from 'lodash.get';\nimport mem from 'mem';\n\nconst placeholderFields = {\n\t'contact.name': {\n\t\tfrom: 'visitor',\n\t\tdataKey: 'name',\n\t},\n\t'contact.email': {\n\t\tfrom: 'visitor',\n\t\tdataKey: 'visitorEmails[0].address',\n\t},\n\t'contact.phone': {\n\t\tfrom: 'visitor',\n\t\tdataKey: 'phone[0].phoneNumber',\n\t},\n\t'agent.name': {\n\t\tfrom: 'agent',\n\t\tdataKey: 'name',\n\t},\n\t'agent.email': {\n\t\tfrom: 'agent',\n\t\tdataKey: 'emails[0].address',\n\t},\n};\n\nexport class BeforeSaveCannedResponse {\n\tstatic enabled = false;\n\n\tprivate getUser = mem((userId: string) => Users.findOneById(userId, { projection: { name: 1, _id: 1, emails: 1 } }), {\n\t\tmaxAge: 1000 * 30,\n\t});\n\n\tprivate getVisitor = mem((visitorId: string) => LivechatVisitors.findOneEnabledById(visitorId), {\n\t\tmaxAge: 1000 * 30,\n\t});\n\n\tasync replacePlaceholders({\n\t\tmessage,\n\t\troom,\n\t\tuser,\n\t}: {\n\t\tmessage: IMessage;\n\t\troom: IRoom;\n\t\tuser: Pick<IUser, '_id' | 'username' | 'name' | 'emails' | 'language'>;\n\t}): Promise<IMessage> {\n\t\t// If the feature is disabled, return the message as is\n\t\tif (!BeforeSaveCannedResponse.enabled) {\n\t\t\treturn message;\n\t\t}\n\n\t\tif (!message.msg || message.msg === '') {\n\t\t\treturn message;\n\t\t}\n\n\t\tif (!isOmnichannelRoom(room)) {\n\t\t\treturn message;\n\t\t}\n\n\t\t// do not replace placeholders for visitors\n\t\tif (!user || isILivechatVisitor(user)) {\n\t\t\treturn message;\n\t\t}\n\n\t\tconst agentId = room?.servedBy?._id;\n\t\tif (!agentId) {\n\t\t\treturn message;\n\t\t}\n\n\t\tconst getAgent = (agentId: string) => {\n\t\t\tif (agentId === user._id) {\n\t\t\t\treturn user;\n\t\t\t}\n\n\t\t\treturn this.getUser(agentId);\n\t\t};\n\n\t\tmessage.msg = await Object.keys(placeholderFields).reduce(async (messageText, field) => {\n\t\t\tconst placeholderConfig = placeholderFields[field as keyof typeof placeholderFields];\n\n\t\t\tconst from = placeholderConfig.from === 'agent' ? await getAgent(agentId) : await this.getVisitor(room.v._id);\n\n\t\t\tconst data = get(from, placeholderConfig.dataKey, '');\n\n\t\t\treturn (await messageText).replace(new RegExp(`{{${field}}}`, 'g'), data);\n\t\t}, Promise.resolve(message.msg));\n\n\t\treturn message;\n\t}\n}\n"],"names":["BeforeSaveCannedResponse","placeholderFields","from","dataKey","replacePlaceholders","message","room","user","enabled","msg","isOmnichannelRoom","isILivechatVisitor","agentId","servedBy","_id","getAgent","getUser","Object","keys","reduce","messageText","field","placeholderConfig","getVisitor","v","data","get","replace","RegExp","Promise","resolve","mem","userId","Users","findOneById","projection","name","emails","maxAge","visitorId","LivechatVisitors","findOneEnabledById"],"mappings":";;;;+BA6BaA;;;eAAAA;;;6BA7ByC;wBAEd;kEACxB;4DACA;;;;;;AAEhB,MAAMC,oBAAoB;IACzB,gBAAgB;QACfC,MAAM;QACNC,SAAS;IACV;IACA,iBAAiB;QAChBD,MAAM;QACNC,SAAS;IACV;IACA,iBAAiB;QAChBD,MAAM;QACNC,SAAS;IACV;IACA,cAAc;QACbD,MAAM;QACNC,SAAS;IACV;IACA,eAAe;QACdD,MAAM;QACNC,SAAS;IACV;AACD;AAEO,IAAA,AAAMH,2BAAN,MAAMA;IAWZ,MAAMI,oBAAoB,EACzBC,OAAO,EACPC,IAAI,EACJC,IAAI,EAKJ,EAAqB;YAmBLD;QAlBhB,uDAAuD;QACvD,IAAI,CAACN,yBAAyBQ,OAAO,EAAE;YACtC,OAAOH;QACR;QAEA,IAAI,CAACA,QAAQI,GAAG,IAAIJ,QAAQI,GAAG,KAAK,IAAI;YACvC,OAAOJ;QACR;QAEA,IAAI,CAACK,IAAAA,8BAAiB,EAACJ,OAAO;YAC7B,OAAOD;QACR;QAEA,2CAA2C;QAC3C,IAAI,CAACE,QAAQI,IAAAA,+BAAkB,EAACJ,OAAO;YACtC,OAAOF;QACR;QAEA,MAAMO,UAAUN,iBAAAA,4BAAAA,iBAAAA,KAAMO,QAAQ,cAAdP,qCAAAA,eAAgBQ,GAAG;QACnC,IAAI,CAACF,SAAS;YACb,OAAOP;QACR;QAEA,MAAMU,WAAW,CAACH;YACjB,IAAIA,YAAYL,KAAKO,GAAG,EAAE;gBACzB,OAAOP;YACR;YAEA,OAAO,IAAI,CAACS,OAAO,CAACJ;QACrB;QAEAP,QAAQI,GAAG,GAAG,MAAMQ,OAAOC,IAAI,CAACjB,mBAAmBkB,MAAM,CAAC,OAAOC,aAAaC;YAC7E,MAAMC,oBAAoBrB,iBAAiB,CAACoB,MAAwC;YAEpF,MAAMnB,OAAOoB,kBAAkBpB,IAAI,KAAK,UAAU,MAAMa,SAASH,WAAW,MAAM,IAAI,CAACW,UAAU,CAACjB,KAAKkB,CAAC,CAACV,GAAG;YAE5G,MAAMW,OAAOC,IAAAA,kBAAG,EAACxB,MAAMoB,kBAAkBnB,OAAO,EAAE;YAElD,OAAO,AAAC,CAAA,MAAMiB,WAAU,EAAGO,OAAO,CAAC,IAAIC,OAAO,CAAC,EAAE,EAAEP,MAAM,EAAE,CAAC,EAAE,MAAMI;QACrE,GAAGI,QAAQC,OAAO,CAACzB,QAAQI,GAAG;QAE9B,OAAOJ;IACR;;aA3DQW,UAAUe,IAAAA,YAAG,EAAC,CAACC,SAAmBC,aAAK,CAACC,WAAW,CAACF,QAAQ;gBAAEG,YAAY;oBAAEC,MAAM;oBAAGtB,KAAK;oBAAGuB,QAAQ;gBAAE;YAAE,IAAI;YACpHC,QAAQ,OAAO;QAChB;aAEQf,aAAaQ,IAAAA,YAAG,EAAC,CAACQ,YAAsBC,wBAAgB,CAACC,kBAAkB,CAACF,YAAY;YAC/FD,QAAQ,OAAO;QAChB;;AAsDD;AA/DatC,yBACLQ,UAAU","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/hooks/messages/BeforeSaveCannedResponse.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"852ab07f8abda8400711514c1fa444445d20d42f","contentHash":"993e7a2c8ef8db03948367cb322e8d88bea96fd2b88d393c4569f0b92eea2aea"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/livechat-enterprise/server/hooks/afterInquiryQueued.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/livechat-enterprise/server/hooks/afterInquiryQueued.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":15},"end":{"line":6,"column":31}},"3":{"start":{"line":7,"column":30},"end":{"line":7,"column":73}},"4":{"start":{"line":8,"column":34},"end":{"line":8,"column":81}},"5":{"start":{"line":9,"column":29},"end":{"line":9,"column":71}},"6":{"start":{"line":11,"column":4},"end":{"line":13,"column":6}},"7":{"start":{"line":15,"column":20},"end":{"line":18,"column":1}},"8":{"start":{"line":19,"column":21},"end":{"line":25,"column":1}},"9":{"start":{"line":26,"column":25},"end":{"line":28,"column":1}},"10":{"start":{"line":29,"column":31},"end":{"line":44,"column":2}},"11":{"start":{"line":45,"column":0},"end":{"line":114,"column":3}},"12":{"start":{"line":46,"column":4},"end":{"line":51,"column":7}},"13":{"start":{"line":47,"column":8},"end":{"line":47,"column":40}},"14":{"start":{"line":48,"column":8},"end":{"line":48,"column":43}},"15":{"start":{"line":49,"column":8},"end":{"line":49,"column":56}},"16":{"start":{"line":50,"column":8},"end":{"line":50,"column":39}},"17":{"start":{"line":52,"column":4},"end":{"line":54,"column":7}},"18":{"start":{"line":53,"column":8},"end":{"line":53,"column":70}},"19":{"start":{"line":55,"column":4},"end":{"line":67,"column":7}},"20":{"start":{"line":56,"column":21},"end":{"line":56,"column":57}},"21":{"start":{"line":57,"column":8},"end":{"line":57,"column":16}},"22":{"start":{"line":58,"column":8},"end":{"line":58,"column":69}},"23":{"start":{"line":59,"column":8},"end":{"line":59,"column":16}},"24":{"start":{"line":60,"column":8},"end":{"line":60,"column":69}},"25":{"start":{"line":61,"column":8},"end":{"line":61,"column":16}},"26":{"start":{"line":62,"column":8},"end":{"line":62,"column":72}},"27":{"start":{"line":63,"column":8},"end":{"line":63,"column":17}},"28":{"start":{"line":64,"column":8},"end":{"line":64,"column":72}},"29":{"start":{"line":65,"column":8},"end":{"line":65,"column":16}},"30":{"start":{"line":66,"column":8},"end":{"line":66,"column":69}},"31":{"start":{"line":68,"column":4},"end":{"line":81,"column":7}},"32":{"start":{"line":69,"column":8},"end":{"line":69,"column":81}},"33":{"start":{"line":70,"column":8},"end":{"line":70,"column":79}},"34":{"start":{"line":71,"column":8},"end":{"line":73,"column":35}},"35":{"start":{"line":74,"column":8},"end":{"line":76,"column":12}},"36":{"start":{"line":77,"column":8},"end":{"line":80,"column":35}},"37":{"start":{"line":82,"column":4},"end":{"line":93,"column":7}},"38":{"start":{"line":83,"column":24},"end":{"line":86,"column":9}},"39":{"start":{"line":87,"column":8},"end":{"line":87,"column":35}},"40":{"start":{"line":88,"column":8},"end":{"line":88,"column":42}},"41":{"start":{"line":89,"column":8},"end":{"line":89,"column":85}},"42":{"start":{"line":90,"column":8},"end":{"line":90,"column":36}},"43":{"start":{"line":91,"column":8},"end":{"line":91,"column":42}},"44":{"start":{"line":92,"column":8},"end":{"line":92,"column":85}},"45":{"start":{"line":94,"column":4},"end":{"line":103,"column":7}},"46":{"start":{"line":95,"column":24},"end":{"line":98,"column":9}},"47":{"start":{"line":99,"column":8},"end":{"line":99,"column":35}},"48":{"start":{"line":100,"column":8},"end":{"line":100,"column":42}},"49":{"start":{"line":101,"column":29},"end":{"line":101,"column":87}},"50":{"start":{"line":102,"column":8},"end":{"line":102,"column":128}},"51":{"start":{"line":104,"column":4},"end":{"line":113,"column":7}},"52":{"start":{"line":105,"column":24},"end":{"line":108,"column":9}},"53":{"start":{"line":109,"column":8},"end":{"line":109,"column":35}},"54":{"start":{"line":110,"column":8},"end":{"line":110,"column":42}},"55":{"start":{"line":111,"column":29},"end":{"line":111,"column":87}},"56":{"start":{"line":112,"column":8},"end":{"line":112,"column":128}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":10,"column":9},"end":{"line":10,"column":33}},"loc":{"start":{"line":10,"column":39},"end":{"line":14,"column":1}},"line":10},"1":{"name":"(anonymous_1)","decl":{"start":{"line":45,"column":49},"end":{"line":45,"column":50}},"loc":{"start":{"line":45,"column":53},"end":{"line":114,"column":1}},"line":45},"2":{"name":"(anonymous_2)","decl":{"start":{"line":46,"column":15},"end":{"line":46,"column":16}},"loc":{"start":{"line":46,"column":19},"end":{"line":51,"column":5}},"line":46},"3":{"name":"(anonymous_3)","decl":{"start":{"line":52,"column":58},"end":{"line":52,"column":59}},"loc":{"start":{"line":52,"column":62},"end":{"line":54,"column":5}},"line":52},"4":{"name":"(anonymous_4)","decl":{"start":{"line":55,"column":84},"end":{"line":55,"column":85}},"loc":{"start":{"line":55,"column":88},"end":{"line":67,"column":5}},"line":55},"5":{"name":"(anonymous_5)","decl":{"start":{"line":68,"column":114},"end":{"line":68,"column":115}},"loc":{"start":{"line":68,"column":124},"end":{"line":81,"column":5}},"line":68},"6":{"name":"(anonymous_6)","decl":{"start":{"line":82,"column":69},"end":{"line":82,"column":70}},"loc":{"start":{"line":82,"column":79},"end":{"line":93,"column":5}},"line":82},"7":{"name":"(anonymous_7)","decl":{"start":{"line":94,"column":68},"end":{"line":94,"column":69}},"loc":{"start":{"line":94,"column":78},"end":{"line":103,"column":5}},"line":94},"8":{"name":"(anonymous_8)","decl":{"start":{"line":104,"column":108},"end":{"line":104,"column":109}},"loc":{"start":{"line":104,"column":118},"end":{"line":113,"column":5}},"line":104}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":11},"end":{"line":13,"column":5}},"type":"cond-expr","locations":[{"start":{"line":11,"column":35},"end":{"line":11,"column":38}},{"start":{"line":11,"column":41},"end":{"line":13,"column":5}}],"line":11},"1":{"loc":{"start":{"line":11,"column":11},"end":{"line":11,"column":32}},"type":"binary-expr","locations":[{"start":{"line":11,"column":11},"end":{"line":11,"column":14}},{"start":{"line":11,"column":18},"end":{"line":11,"column":32}}],"line":11}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":3,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":6,"14":6,"15":6,"16":6,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1},"f":{"0":3,"1":1,"2":6,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1},"b":{"0":[0,3],"1":[3,3]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/livechat-enterprise/server/hooks/afterInquiryQueued.spec.ts"],"sourcesContent":["import { expect } from 'chai';\nimport { describe, it } from 'mocha';\nimport moment from 'moment';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\nconst settingStub = {\n\twatch: sinon.stub(),\n\tget: sinon.stub(),\n};\n\nconst callbackStub = {\n\tadd: sinon.stub(),\n\tremove: sinon.stub(),\n\tpriority: { HIGH: 'high' },\n};\n\nconst queueMonitorStub = {\n\tscheduleInquiry: sinon.stub(),\n};\n\nconst { afterInquiryQueued } = proxyquire\n\t.noCallThru()\n\t.load('../../../../../../app/livechat-enterprise/server/hooks/afterInquiryQueued.ts', {\n\t\t'../../../../../app/settings/server': {\n\t\t\tsettings: settingStub,\n\t\t},\n\t\t'../../../../../lib/callbacks': {\n\t\t\tcallbacks: callbackStub,\n\t\t},\n\t\t'../lib/QueueInactivityMonitor': {\n\t\t\tOmnichannelQueueInactivityMonitor: queueMonitorStub,\n\t\t},\n\t\t'../lib/logger': {\n\t\t\tcbLogger: { debug: sinon.stub() },\n\t\t},\n\t});\n\ndescribe('hooks/afterInquiryQueued', () => {\n\tbeforeEach(() => {\n\t\tcallbackStub.add.resetHistory();\n\t\tcallbackStub.remove.resetHistory();\n\t\tqueueMonitorStub.scheduleInquiry.resetHistory();\n\t\tsettingStub.get.resetHistory();\n\t});\n\n\tit('should call settings.watch at first', () => {\n\t\texpect(settingStub.watch.callCount).to.be.equal(1);\n\t});\n\n\tit('should call the callback on settings.watch with proper values', () => {\n\t\tconst func = settingStub.watch.getCall(0).args[1];\n\n\t\tfunc(1);\n\t\texpect(callbackStub.add.callCount).to.be.equal(1);\n\n\t\tfunc(2);\n\t\texpect(callbackStub.add.callCount).to.be.equal(2);\n\n\t\tfunc(0);\n\t\texpect(callbackStub.remove.callCount).to.be.equal(1);\n\n\t\tfunc(-1);\n\t\texpect(callbackStub.remove.callCount).to.be.equal(2);\n\n\t\tfunc(3);\n\t\texpect(callbackStub.add.callCount).to.be.equal(3);\n\t});\n\n\tit('should return undefined if no inquiry is passed, or if inquiry doesnt have valid properties', async () => {\n\t\texpect(await afterInquiryQueued(null)).to.be.equal(undefined);\n\t\texpect(await afterInquiryQueued({})).to.be.equal(undefined);\n\t\texpect(await afterInquiryQueued({ _id: 'invalid' })).to.be.equal(undefined);\n\t\texpect(await afterInquiryQueued({ _updatedAt: new Date() }));\n\t\texpect(await afterInquiryQueued({ _updatedAt: null, _id: 'afsd34asdX' })).to.be.equal(undefined);\n\t});\n\n\tit('should do nothing if timer is set to 0 or less', async () => {\n\t\tconst inquiry = {\n\t\t\t_id: 'afsd34asdX',\n\t\t\t_updatedAt: new Date(),\n\t\t};\n\n\t\tsettingStub.get.returns(0);\n\t\tawait afterInquiryQueued(inquiry);\n\t\texpect(queueMonitorStub.scheduleInquiry.callCount).to.be.equal(0);\n\n\t\tsettingStub.get.returns(-1);\n\t\tawait afterInquiryQueued(inquiry);\n\t\texpect(queueMonitorStub.scheduleInquiry.callCount).to.be.equal(0);\n\t});\n\n\tit('should call .scheduleInquiry with proper data', async () => {\n\t\tconst inquiry = {\n\t\t\t_id: 'afsd34asdX',\n\t\t\t_updatedAt: new Date(),\n\t\t};\n\n\t\tsettingStub.get.returns(1);\n\t\tawait afterInquiryQueued(inquiry);\n\n\t\tconst newQueueTime = moment(inquiry._updatedAt).add(1, 'minutes');\n\n\t\texpect(queueMonitorStub.scheduleInquiry.calledWith(inquiry._id, new Date(newQueueTime.format()))).to.be.true;\n\t});\n\n\tit('should call .scheduleInquiry with proper data when more than 1 min is passed as param', async () => {\n\t\tconst inquiry = {\n\t\t\t_id: 'afv34avzx',\n\t\t\t_updatedAt: new Date(),\n\t\t};\n\n\t\tsettingStub.get.returns(3);\n\t\tawait afterInquiryQueued(inquiry);\n\n\t\tconst newQueueTime = moment(inquiry._updatedAt).add(3, 'minutes');\n\n\t\texpect(queueMonitorStub.scheduleInquiry.calledWith(inquiry._id, new Date(newQueueTime.format()))).to.be.true;\n\t});\n});\n"],"names":["settingStub","watch","sinon","stub","get","callbackStub","add","remove","priority","HIGH","queueMonitorStub","scheduleInquiry","afterInquiryQueued","proxyquire","noCallThru","load","settings","callbacks","OmnichannelQueueInactivityMonitor","cbLogger","debug","describe","beforeEach","resetHistory","it","expect","callCount","to","be","equal","func","getCall","args","undefined","_id","_updatedAt","Date","inquiry","returns","newQueueTime","moment","calledWith","format","true"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/livechat-enterprise/server/hooks/afterInquiryQueued.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"dcbeda1542911b7ea771273fcc305b034479067f","contentHash":"57ceb624335e103445e77471b6100d5b3b3eb531d8988f351b216836df6fa155"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/hooks/afterInquiryQueued.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/hooks/afterInquiryQueued.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":34}},"3":{"start":{"line":11,"column":30},"end":{"line":11,"column":73}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":61}},"5":{"start":{"line":13,"column":19},"end":{"line":13,"column":58}},"6":{"start":{"line":14,"column":32},"end":{"line":14,"column":72}},"7":{"start":{"line":15,"column":16},"end":{"line":15,"column":40}},"8":{"start":{"line":17,"column":4},"end":{"line":19,"column":6}},"9":{"start":{"line":21,"column":27},"end":{"line":33,"column":1}},"10":{"start":{"line":22,"column":4},"end":{"line":24,"column":5}},"11":{"start":{"line":23,"column":8},"end":{"line":23,"column":15}},"12":{"start":{"line":25,"column":18},"end":{"line":25,"column":70}},"13":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"14":{"start":{"line":27,"column":8},"end":{"line":27,"column":15}},"15":{"start":{"line":30,"column":25},"end":{"line":30,"column":87}},"16":{"start":{"line":31,"column":4},"end":{"line":31,"column":115}},"17":{"start":{"line":32,"column":4},"end":{"line":32,"column":130}},"18":{"start":{"line":34,"column":0},"end":{"line":40,"column":3}},"19":{"start":{"line":35,"column":4},"end":{"line":38,"column":5}},"20":{"start":{"line":36,"column":8},"end":{"line":36,"column":110}},"21":{"start":{"line":37,"column":8},"end":{"line":37,"column":15}},"22":{"start":{"line":39,"column":4},"end":{"line":39,"column":159}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":33}},"loc":{"start":{"line":16,"column":39},"end":{"line":20,"column":1}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":21,"column":27},"end":{"line":21,"column":28}},"loc":{"start":{"line":21,"column":44},"end":{"line":33,"column":1}},"line":21},"3":{"name":"(anonymous_3)","decl":{"start":{"line":34,"column":55},"end":{"line":34,"column":56}},"loc":{"start":{"line":34,"column":64},"end":{"line":40,"column":1}},"line":34}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":11},"end":{"line":19,"column":5}},"type":"cond-expr","locations":[{"start":{"line":17,"column":35},"end":{"line":17,"column":38}},{"start":{"line":17,"column":41},"end":{"line":19,"column":5}}],"line":17},"1":{"loc":{"start":{"line":17,"column":11},"end":{"line":17,"column":32}},"type":"binary-expr","locations":[{"start":{"line":17,"column":11},"end":{"line":17,"column":14}},{"start":{"line":17,"column":18},"end":{"line":17,"column":32}}],"line":17},"2":{"loc":{"start":{"line":22,"column":4},"end":{"line":24,"column":5}},"type":"if","locations":[{"start":{"line":22,"column":4},"end":{"line":24,"column":5}},{"start":{"line":22,"column":4},"end":{"line":24,"column":5}}],"line":22},"3":{"loc":{"start":{"line":22,"column":8},"end":{"line":22,"column":147}},"type":"binary-expr","locations":[{"start":{"line":22,"column":8},"end":{"line":22,"column":72}},{"start":{"line":22,"column":76},"end":{"line":22,"column":147}}],"line":22},"4":{"loc":{"start":{"line":22,"column":10},"end":{"line":22,"column":71}},"type":"cond-expr","locations":[{"start":{"line":22,"column":51},"end":{"line":22,"column":57}},{"start":{"line":22,"column":60},"end":{"line":22,"column":71}}],"line":22},"5":{"loc":{"start":{"line":22,"column":10},"end":{"line":22,"column":48}},"type":"binary-expr","locations":[{"start":{"line":22,"column":10},"end":{"line":22,"column":26}},{"start":{"line":22,"column":30},"end":{"line":22,"column":48}}],"line":22},"6":{"loc":{"start":{"line":22,"column":78},"end":{"line":22,"column":146}},"type":"cond-expr","locations":[{"start":{"line":22,"column":119},"end":{"line":22,"column":125}},{"start":{"line":22,"column":128},"end":{"line":22,"column":146}}],"line":22},"7":{"loc":{"start":{"line":22,"column":78},"end":{"line":22,"column":116}},"type":"binary-expr","locations":[{"start":{"line":22,"column":78},"end":{"line":22,"column":94}},{"start":{"line":22,"column":98},"end":{"line":22,"column":116}}],"line":22},"8":{"loc":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"type":"if","locations":[{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},{"start":{"line":26,"column":4},"end":{"line":28,"column":5}}],"line":26},"9":{"loc":{"start":{"line":35,"column":4},"end":{"line":38,"column":5}},"type":"if","locations":[{"start":{"line":35,"column":4},"end":{"line":38,"column":5}},{"start":{"line":35,"column":4},"end":{"line":38,"column":5}}],"line":35}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":9,"11":5,"12":4,"13":4,"14":2,"15":2,"16":2,"17":2,"18":1,"19":5,"20":2,"21":2,"22":3},"f":{"0":1,"1":1,"2":9,"3":5},"b":{"0":[0,1],"1":[1,1],"2":[5,4],"3":[9,6],"4":[1,8],"5":[9,8],"6":[0,6],"7":[6,6],"8":[2,2],"9":[2,3]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/hooks/afterInquiryQueued.ts"],"sourcesContent":["import type { ILivechatInquiryRecord } from '@rocket.chat/core-typings';\nimport moment from 'moment';\n\nimport { settings } from '../../../../../app/settings/server';\nimport { callbacks } from '../../../../../lib/callbacks';\nimport { OmnichannelQueueInactivityMonitor } from '../lib/QueueInactivityMonitor';\nimport { cbLogger } from '../lib/logger';\n\nexport const afterInquiryQueued = async (inquiry: ILivechatInquiryRecord) => {\n\tif (!inquiry?._id || !inquiry?._updatedAt) {\n\t\treturn;\n\t}\n\n\tconst timer = settings.get<number>('Livechat_max_queue_wait_time');\n\n\tif (timer <= 0) {\n\t\treturn;\n\t}\n\n\t// schedule individual jobs instead of property for close inactivty\n\tconst newQueueTime = moment(inquiry._updatedAt).add(timer, 'minutes');\n\tcbLogger.debug(`Scheduling estimated close time at ${newQueueTime} for queued inquiry ${inquiry._id}`);\n\tawait OmnichannelQueueInactivityMonitor.scheduleInquiry(inquiry._id, new Date(newQueueTime.format()));\n};\n\nsettings.watch<number>('Livechat_max_queue_wait_time', (value) => {\n\tif (value <= 0) {\n\t\tcallbacks.remove('livechat.afterInquiryQueued', 'livechat-inquiry-queued-set-queue-timer');\n\t\treturn;\n\t}\n\tcallbacks.add('livechat.afterInquiryQueued', afterInquiryQueued, callbacks.priority.HIGH, 'livechat-inquiry-queued-set-queue-timer');\n});\n"],"names":["afterInquiryQueued","inquiry","_id","_updatedAt","timer","settings","get","newQueueTime","moment","add","cbLogger","debug","OmnichannelQueueInactivityMonitor","scheduleInquiry","Date","format","watch","value","callbacks","remove","priority","HIGH"],"mappings":";;;;+BAQaA;;;eAAAA;;;+DAPM;wBAEM;2BACC;wCACwB;wBACzB;;;;;;AAElB,MAAMA,qBAAqB,OAAOC;IACxC,IAAI,EAACA,oBAAAA,8BAAAA,QAASC,GAAG,KAAI,EAACD,oBAAAA,8BAAAA,QAASE,UAAU,GAAE;QAC1C;IACD;IAEA,MAAMC,QAAQC,gBAAQ,CAACC,GAAG,CAAS;IAEnC,IAAIF,SAAS,GAAG;QACf;IACD;IAEA,mEAAmE;IACnE,MAAMG,eAAeC,IAAAA,eAAM,EAACP,QAAQE,UAAU,EAAEM,GAAG,CAACL,OAAO;IAC3DM,gBAAQ,CAACC,KAAK,CAAC,CAAC,mCAAmC,EAAEJ,aAAa,oBAAoB,EAAEN,QAAQC,GAAG,EAAE;IACrG,MAAMU,yDAAiC,CAACC,eAAe,CAACZ,QAAQC,GAAG,EAAE,IAAIY,KAAKP,aAAaQ,MAAM;AAClG;AAEAV,gBAAQ,CAACW,KAAK,CAAS,gCAAgC,CAACC;IACvD,IAAIA,SAAS,GAAG;QACfC,oBAAS,CAACC,MAAM,CAAC,+BAA+B;QAChD;IACD;IACAD,oBAAS,CAACT,GAAG,CAAC,+BAA+BT,oBAAoBkB,oBAAS,CAACE,QAAQ,CAACC,IAAI,EAAE;AAC3F","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/hooks/afterInquiryQueued.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d175f1cb590b0b82413c49c0cf773bf95bed1c31","contentHash":"51436ae22eadabcdc76031b9b77f571d4ea5fa36d81e507ef8e400c277e5a85a"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/livechat-enterprise/server/hooks/manageDepartmentUnit.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/livechat-enterprise/server/hooks/manageDepartmentUnit.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":15},"end":{"line":6,"column":31}},"3":{"start":{"line":7,"column":34},"end":{"line":7,"column":81}},"4":{"start":{"line":8,"column":29},"end":{"line":8,"column":71}},"5":{"start":{"line":10,"column":4},"end":{"line":12,"column":6}},"6":{"start":{"line":14,"column":31},"end":{"line":18,"column":1}},"7":{"start":{"line":19,"column":25},"end":{"line":23,"column":1}},"8":{"start":{"line":24,"column":23},"end":{"line":24,"column":44}},"9":{"start":{"line":25,"column":29},"end":{"line":25,"column":50}},"10":{"start":{"line":26,"column":33},"end":{"line":37,"column":2}},"11":{"start":{"line":38,"column":0},"end":{"line":290,"column":3}},"12":{"start":{"line":39,"column":4},"end":{"line":47,"column":7}},"13":{"start":{"line":40,"column":8},"end":{"line":40,"column":51}},"14":{"start":{"line":41,"column":8},"end":{"line":41,"column":59}},"15":{"start":{"line":42,"column":8},"end":{"line":42,"column":64}},"16":{"start":{"line":43,"column":8},"end":{"line":43,"column":45}},"17":{"start":{"line":44,"column":8},"end":{"line":44,"column":59}},"18":{"start":{"line":45,"column":8},"end":{"line":45,"column":59}},"19":{"start":{"line":46,"column":8},"end":{"line":46,"column":31}},"20":{"start":{"line":48,"column":4},"end":{"line":63,"column":7}},"21":{"start":{"line":49,"column":8},"end":{"line":49,"column":58}},"22":{"start":{"line":50,"column":8},"end":{"line":50,"column":38}},"23":{"start":{"line":51,"column":8},"end":{"line":53,"column":11}},"24":{"start":{"line":54,"column":8},"end":{"line":58,"column":11}},"25":{"start":{"line":59,"column":8},"end":{"line":59,"column":91}},"26":{"start":{"line":60,"column":8},"end":{"line":60,"column":96}},"27":{"start":{"line":61,"column":8},"end":{"line":61,"column":91}},"28":{"start":{"line":62,"column":8},"end":{"line":62,"column":91}},"29":{"start":{"line":64,"column":4},"end":{"line":85,"column":7}},"30":{"start":{"line":65,"column":8},"end":{"line":71,"column":11}},"31":{"start":{"line":72,"column":8},"end":{"line":72,"column":38}},"32":{"start":{"line":73,"column":8},"end":{"line":75,"column":11}},"33":{"start":{"line":76,"column":8},"end":{"line":80,"column":11}},"34":{"start":{"line":81,"column":8},"end":{"line":81,"column":91}},"35":{"start":{"line":82,"column":8},"end":{"line":82,"column":96}},"36":{"start":{"line":83,"column":8},"end":{"line":83,"column":91}},"37":{"start":{"line":84,"column":8},"end":{"line":84,"column":91}},"38":{"start":{"line":86,"column":4},"end":{"line":107,"column":7}},"39":{"start":{"line":87,"column":8},"end":{"line":93,"column":11}},"40":{"start":{"line":94,"column":8},"end":{"line":94,"column":39}},"41":{"start":{"line":95,"column":8},"end":{"line":97,"column":11}},"42":{"start":{"line":98,"column":8},"end":{"line":102,"column":11}},"43":{"start":{"line":103,"column":8},"end":{"line":103,"column":91}},"44":{"start":{"line":104,"column":8},"end":{"line":104,"column":96}},"45":{"start":{"line":105,"column":8},"end":{"line":105,"column":91}},"46":{"start":{"line":106,"column":8},"end":{"line":106,"column":91}},"47":{"start":{"line":108,"column":4},"end":{"line":129,"column":7}},"48":{"start":{"line":109,"column":8},"end":{"line":115,"column":11}},"49":{"start":{"line":116,"column":8},"end":{"line":116,"column":39}},"50":{"start":{"line":117,"column":8},"end":{"line":119,"column":11}},"51":{"start":{"line":120,"column":8},"end":{"line":124,"column":11}},"52":{"start":{"line":125,"column":8},"end":{"line":125,"column":91}},"53":{"start":{"line":126,"column":8},"end":{"line":126,"column":96}},"54":{"start":{"line":127,"column":8},"end":{"line":127,"column":91}},"55":{"start":{"line":128,"column":8},"end":{"line":128,"column":91}},"56":{"start":{"line":130,"column":4},"end":{"line":150,"column":7}},"57":{"start":{"line":131,"column":8},"end":{"line":137,"column":11}},"58":{"start":{"line":138,"column":8},"end":{"line":138,"column":57}},"59":{"start":{"line":139,"column":8},"end":{"line":139,"column":38}},"60":{"start":{"line":140,"column":8},"end":{"line":140,"column":49}},"61":{"start":{"line":141,"column":8},"end":{"line":145,"column":11}},"62":{"start":{"line":146,"column":8},"end":{"line":146,"column":91}},"63":{"start":{"line":147,"column":8},"end":{"line":147,"column":96}},"64":{"start":{"line":148,"column":8},"end":{"line":148,"column":91}},"65":{"start":{"line":149,"column":8},"end":{"line":149,"column":91}},"66":{"start":{"line":151,"column":4},"end":{"line":170,"column":7}},"67":{"start":{"line":152,"column":8},"end":{"line":158,"column":11}},"68":{"start":{"line":159,"column":8},"end":{"line":159,"column":38}},"69":{"start":{"line":160,"column":8},"end":{"line":160,"column":49}},"70":{"start":{"line":161,"column":8},"end":{"line":165,"column":11}},"71":{"start":{"line":166,"column":8},"end":{"line":166,"column":91}},"72":{"start":{"line":167,"column":8},"end":{"line":167,"column":91}},"73":{"start":{"line":168,"column":8},"end":{"line":168,"column":118}},"74":{"start":{"line":169,"column":8},"end":{"line":169,"column":107}},"75":{"start":{"line":171,"column":4},"end":{"line":191,"column":7}},"76":{"start":{"line":172,"column":8},"end":{"line":174,"column":11}},"77":{"start":{"line":175,"column":8},"end":{"line":177,"column":11}},"78":{"start":{"line":178,"column":8},"end":{"line":178,"column":38}},"79":{"start":{"line":179,"column":8},"end":{"line":179,"column":49}},"80":{"start":{"line":180,"column":8},"end":{"line":184,"column":11}},"81":{"start":{"line":185,"column":8},"end":{"line":187,"column":23}},"82":{"start":{"line":188,"column":8},"end":{"line":188,"column":107}},"83":{"start":{"line":189,"column":8},"end":{"line":189,"column":96}},"84":{"start":{"line":190,"column":8},"end":{"line":190,"column":91}},"85":{"start":{"line":192,"column":4},"end":{"line":216,"column":7}},"86":{"start":{"line":193,"column":8},"end":{"line":199,"column":11}},"87":{"start":{"line":200,"column":8},"end":{"line":202,"column":11}},"88":{"start":{"line":203,"column":8},"end":{"line":203,"column":38}},"89":{"start":{"line":204,"column":8},"end":{"line":204,"column":49}},"90":{"start":{"line":205,"column":8},"end":{"line":209,"column":11}},"91":{"start":{"line":210,"column":8},"end":{"line":212,"column":23}},"92":{"start":{"line":213,"column":8},"end":{"line":213,"column":111}},"93":{"start":{"line":214,"column":8},"end":{"line":214,"column":96}},"94":{"start":{"line":215,"column":8},"end":{"line":215,"column":107}},"95":{"start":{"line":217,"column":4},"end":{"line":238,"column":7}},"96":{"start":{"line":218,"column":8},"end":{"line":224,"column":11}},"97":{"start":{"line":225,"column":8},"end":{"line":225,"column":39}},"98":{"start":{"line":226,"column":8},"end":{"line":228,"column":11}},"99":{"start":{"line":229,"column":8},"end":{"line":233,"column":11}},"100":{"start":{"line":234,"column":8},"end":{"line":234,"column":91}},"101":{"start":{"line":235,"column":8},"end":{"line":235,"column":91}},"102":{"start":{"line":236,"column":8},"end":{"line":236,"column":118}},"103":{"start":{"line":237,"column":8},"end":{"line":237,"column":107}},"104":{"start":{"line":239,"column":4},"end":{"line":261,"column":7}},"105":{"start":{"line":240,"column":8},"end":{"line":242,"column":11}},"106":{"start":{"line":243,"column":8},"end":{"line":245,"column":11}},"107":{"start":{"line":246,"column":8},"end":{"line":246,"column":39}},"108":{"start":{"line":247,"column":8},"end":{"line":249,"column":11}},"109":{"start":{"line":250,"column":8},"end":{"line":254,"column":11}},"110":{"start":{"line":255,"column":8},"end":{"line":257,"column":23}},"111":{"start":{"line":258,"column":8},"end":{"line":258,"column":107}},"112":{"start":{"line":259,"column":8},"end":{"line":259,"column":96}},"113":{"start":{"line":260,"column":8},"end":{"line":260,"column":91}},"114":{"start":{"line":262,"column":4},"end":{"line":289,"column":7}},"115":{"start":{"line":263,"column":8},"end":{"line":269,"column":11}},"116":{"start":{"line":270,"column":8},"end":{"line":272,"column":11}},"117":{"start":{"line":273,"column":8},"end":{"line":273,"column":39}},"118":{"start":{"line":274,"column":8},"end":{"line":277,"column":11}},"119":{"start":{"line":278,"column":8},"end":{"line":282,"column":11}},"120":{"start":{"line":283,"column":8},"end":{"line":285,"column":23}},"121":{"start":{"line":286,"column":8},"end":{"line":286,"column":111}},"122":{"start":{"line":287,"column":8},"end":{"line":287,"column":96}},"123":{"start":{"line":288,"column":8},"end":{"line":288,"column":107}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":33}},"loc":{"start":{"line":9,"column":39},"end":{"line":13,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":38,"column":51},"end":{"line":38,"column":52}},"loc":{"start":{"line":38,"column":55},"end":{"line":290,"column":1}},"line":38},"2":{"name":"(anonymous_2)","decl":{"start":{"line":39,"column":15},"end":{"line":39,"column":16}},"loc":{"start":{"line":39,"column":19},"end":{"line":47,"column":5}},"line":39},"3":{"name":"(anonymous_3)","decl":{"start":{"line":48,"column":94},"end":{"line":48,"column":95}},"loc":{"start":{"line":48,"column":104},"end":{"line":63,"column":5}},"line":48},"4":{"name":"(anonymous_4)","decl":{"start":{"line":64,"column":101},"end":{"line":64,"column":102}},"loc":{"start":{"line":64,"column":111},"end":{"line":85,"column":5}},"line":64},"5":{"name":"(anonymous_5)","decl":{"start":{"line":86,"column":102},"end":{"line":86,"column":103}},"loc":{"start":{"line":86,"column":112},"end":{"line":107,"column":5}},"line":86},"6":{"name":"(anonymous_6)","decl":{"start":{"line":108,"column":106},"end":{"line":108,"column":107}},"loc":{"start":{"line":108,"column":116},"end":{"line":129,"column":5}},"line":108},"7":{"name":"(anonymous_7)","decl":{"start":{"line":130,"column":115},"end":{"line":130,"column":116}},"loc":{"start":{"line":130,"column":125},"end":{"line":150,"column":5}},"line":130},"8":{"name":"(anonymous_8)","decl":{"start":{"line":151,"column":97},"end":{"line":151,"column":98}},"loc":{"start":{"line":151,"column":107},"end":{"line":170,"column":5}},"line":151},"9":{"name":"(anonymous_9)","decl":{"start":{"line":171,"column":82},"end":{"line":171,"column":83}},"loc":{"start":{"line":171,"column":92},"end":{"line":191,"column":5}},"line":171},"10":{"name":"(anonymous_10)","decl":{"start":{"line":192,"column":87},"end":{"line":192,"column":88}},"loc":{"start":{"line":192,"column":97},"end":{"line":216,"column":5}},"line":192},"11":{"name":"(anonymous_11)","decl":{"start":{"line":217,"column":123},"end":{"line":217,"column":124}},"loc":{"start":{"line":217,"column":133},"end":{"line":238,"column":5}},"line":217},"12":{"name":"(anonymous_12)","decl":{"start":{"line":239,"column":104},"end":{"line":239,"column":105}},"loc":{"start":{"line":239,"column":114},"end":{"line":261,"column":5}},"line":239},"13":{"name":"(anonymous_13)","decl":{"start":{"line":262,"column":122},"end":{"line":262,"column":123}},"loc":{"start":{"line":262,"column":132},"end":{"line":289,"column":5}},"line":262}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":11},"end":{"line":12,"column":5}},"type":"cond-expr","locations":[{"start":{"line":10,"column":35},"end":{"line":10,"column":38}},{"start":{"line":10,"column":41},"end":{"line":12,"column":5}}],"line":10},"1":{"loc":{"start":{"line":10,"column":11},"end":{"line":10,"column":32}},"type":"binary-expr","locations":[{"start":{"line":10,"column":11},"end":{"line":10,"column":14}},{"start":{"line":10,"column":18},"end":{"line":10,"column":32}}],"line":10}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":2,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":11,"14":11,"15":11,"16":11,"17":11,"18":11,"19":11,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1,"61":1,"62":1,"63":1,"64":1,"65":1,"66":1,"67":1,"68":1,"69":1,"70":1,"71":1,"72":1,"73":1,"74":1,"75":1,"76":1,"77":1,"78":1,"79":1,"80":1,"81":1,"82":1,"83":1,"84":1,"85":1,"86":1,"87":1,"88":1,"89":1,"90":1,"91":1,"92":1,"93":1,"94":1,"95":1,"96":1,"97":1,"98":1,"99":1,"100":1,"101":1,"102":1,"103":1,"104":1,"105":1,"106":1,"107":1,"108":1,"109":1,"110":1,"111":1,"112":1,"113":1,"114":1,"115":1,"116":1,"117":1,"118":1,"119":1,"120":1,"121":1,"122":1,"123":1},"f":{"0":2,"1":1,"2":11,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1},"b":{"0":[0,2],"1":[2,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/livechat-enterprise/server/hooks/manageDepartmentUnit.spec.ts"],"sourcesContent":["import { expect } from 'chai';\nimport { describe, it } from 'mocha';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\nconst livechatDepartmentStub = {\n\tfindOneById: sinon.stub(),\n\taddDepartmentToUnit: sinon.stub(),\n\tremoveDepartmentFromUnit: sinon.stub(),\n};\n\nconst livechatUnitStub = {\n\tfindOneById: sinon.stub(),\n\tdecrementDepartmentsCount: sinon.stub(),\n\tincrementDepartmentsCount: sinon.stub(),\n};\n\nconst hasAnyRoleStub = sinon.stub();\nconst getUnitsFromUserStub = sinon.stub();\n\nconst { manageDepartmentUnit } = proxyquire\n\t.noCallThru()\n\t.load('../../../../../../app/livechat-enterprise/server/hooks/manageDepartmentUnit.ts', {\n\t\t'../methods/getUnitsFromUserRoles': {\n\t\t\tgetUnitsFromUser: getUnitsFromUserStub,\n\t\t},\n\t\t'../../../../../app/authorization/server/functions/hasRole': {\n\t\t\thasAnyRoleAsync: hasAnyRoleStub,\n\t\t},\n\t\t'@rocket.chat/models': {\n\t\t\tLivechatDepartment: livechatDepartmentStub,\n\t\t\tLivechatUnit: livechatUnitStub,\n\t\t},\n\t});\n\ndescribe('hooks/manageDepartmentUnit', () => {\n\tbeforeEach(() => {\n\t\tlivechatDepartmentStub.findOneById.reset();\n\t\tlivechatDepartmentStub.addDepartmentToUnit.reset();\n\t\tlivechatDepartmentStub.removeDepartmentFromUnit.reset();\n\t\tlivechatUnitStub.findOneById.reset();\n\t\tlivechatUnitStub.decrementDepartmentsCount.reset();\n\t\tlivechatUnitStub.incrementDepartmentsCount.reset();\n\t\thasAnyRoleStub.reset();\n\t});\n\n\tit('should not perform any operation when an invalid department is provided', async () => {\n\t\tlivechatDepartmentStub.findOneById.resolves(null);\n\t\thasAnyRoleStub.resolves(true);\n\t\tgetUnitsFromUserStub.resolves(['unit-id']);\n\n\t\tawait manageDepartmentUnit({ userId: 'user-id', departmentId: 'department-id', unitId: 'unit-id' });\n\t\texpect(livechatDepartmentStub.addDepartmentToUnit.notCalled).to.be.true;\n\t\texpect(livechatDepartmentStub.removeDepartmentFromUnit.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.decrementDepartmentsCount.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.incrementDepartmentsCount.notCalled).to.be.true;\n\t});\n\n\tit('should not perform any operation if the provided department is already in unit', async () => {\n\t\tlivechatDepartmentStub.findOneById.resolves({ _id: 'department-id', ancestors: ['unit-id'], parentId: 'unit-id' });\n\t\thasAnyRoleStub.resolves(true);\n\t\tgetUnitsFromUserStub.resolves(['unit-id']);\n\n\t\tawait manageDepartmentUnit({ userId: 'user-id', departmentId: 'department-id', unitId: 'unit-id' });\n\t\texpect(livechatDepartmentStub.addDepartmentToUnit.notCalled).to.be.true;\n\t\texpect(livechatDepartmentStub.removeDepartmentFromUnit.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.decrementDepartmentsCount.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.incrementDepartmentsCount.notCalled).to.be.true;\n\t});\n\n\tit(\"should not perform any operation if user is a monitor and can't manage new unit\", async () => {\n\t\tlivechatDepartmentStub.findOneById.resolves({ _id: 'department-id', ancestors: ['unit-id'], parentId: 'unit-id' });\n\t\thasAnyRoleStub.resolves(false);\n\t\tgetUnitsFromUserStub.resolves(['unit-id']);\n\n\t\tawait manageDepartmentUnit({ userId: 'user-id', departmentId: 'department-id', unitId: 'new-unit-id' });\n\t\texpect(livechatDepartmentStub.addDepartmentToUnit.notCalled).to.be.true;\n\t\texpect(livechatDepartmentStub.removeDepartmentFromUnit.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.decrementDepartmentsCount.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.incrementDepartmentsCount.notCalled).to.be.true;\n\t});\n\n\tit(\"should not perform any operation if user is a monitor and can't manage current unit\", async () => {\n\t\tlivechatDepartmentStub.findOneById.resolves({ _id: 'department-id', ancestors: ['unit-id'], parentId: 'unit-id' });\n\t\thasAnyRoleStub.resolves(false);\n\t\tgetUnitsFromUserStub.resolves(['new-unit-id']);\n\n\t\tawait manageDepartmentUnit({ userId: 'user-id', departmentId: 'department-id', unitId: 'new-unit-id' });\n\t\texpect(livechatDepartmentStub.addDepartmentToUnit.notCalled).to.be.true;\n\t\texpect(livechatDepartmentStub.removeDepartmentFromUnit.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.decrementDepartmentsCount.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.incrementDepartmentsCount.notCalled).to.be.true;\n\t});\n\n\tit('should not perform any operation if user is an admin/manager but an invalid unit is provided', async () => {\n\t\tlivechatDepartmentStub.findOneById.resolves({ _id: 'department-id', ancestors: ['unit-id'], parentId: 'unit-id' });\n\t\tlivechatUnitStub.findOneById.resolves(undefined);\n\t\thasAnyRoleStub.resolves(true);\n\t\tgetUnitsFromUserStub.resolves(undefined);\n\n\t\tawait manageDepartmentUnit({ userId: 'user-id', departmentId: 'department-id', unitId: 'new-unit-id' });\n\t\texpect(livechatDepartmentStub.addDepartmentToUnit.notCalled).to.be.true;\n\t\texpect(livechatDepartmentStub.removeDepartmentFromUnit.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.decrementDepartmentsCount.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.incrementDepartmentsCount.notCalled).to.be.true;\n\t});\n\n\tit('should remove department from its current unit if user is an admin/manager', async () => {\n\t\tlivechatDepartmentStub.findOneById.resolves({ _id: 'department-id', ancestors: ['unit-id'], parentId: 'unit-id' });\n\t\thasAnyRoleStub.resolves(true);\n\t\tgetUnitsFromUserStub.resolves(undefined);\n\n\t\tawait manageDepartmentUnit({ userId: 'user-id', departmentId: 'department-id', unitId: undefined });\n\t\texpect(livechatDepartmentStub.addDepartmentToUnit.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.incrementDepartmentsCount.notCalled).to.be.true;\n\t\texpect(livechatDepartmentStub.removeDepartmentFromUnit.calledOnceWith('department-id')).to.be.true;\n\t\texpect(livechatUnitStub.decrementDepartmentsCount.calledOnceWith('unit-id')).to.be.true;\n\t});\n\n\tit('should add department to a unit if user is an admin/manager', async () => {\n\t\tlivechatDepartmentStub.findOneById.resolves({ _id: 'department-id' });\n\t\tlivechatUnitStub.findOneById.resolves({ _id: 'unit-id' });\n\t\thasAnyRoleStub.resolves(true);\n\t\tgetUnitsFromUserStub.resolves(undefined);\n\n\t\tawait manageDepartmentUnit({ userId: 'user-id', departmentId: 'department-id', unitId: 'unit-id' });\n\t\texpect(livechatDepartmentStub.addDepartmentToUnit.calledOnceWith('department-id', 'unit-id', ['unit-id'])).to.be.true;\n\t\texpect(livechatUnitStub.incrementDepartmentsCount.calledOnceWith('unit-id')).to.be.true;\n\t\texpect(livechatDepartmentStub.removeDepartmentFromUnit.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.decrementDepartmentsCount.notCalled).to.be.true;\n\t});\n\n\tit('should move department to a new unit if user is an admin/manager', async () => {\n\t\tlivechatDepartmentStub.findOneById.resolves({ _id: 'department-id', ancestors: ['unit-id'], parentId: 'unit-id' });\n\t\tlivechatUnitStub.findOneById.resolves({ _id: 'new-unit-id' });\n\t\thasAnyRoleStub.resolves(true);\n\t\tgetUnitsFromUserStub.resolves(undefined);\n\n\t\tawait manageDepartmentUnit({ userId: 'user-id', departmentId: 'department-id', unitId: 'new-unit-id' });\n\t\texpect(livechatDepartmentStub.addDepartmentToUnit.calledOnceWith('department-id', 'new-unit-id', ['new-unit-id'])).to.be.true;\n\t\texpect(livechatUnitStub.incrementDepartmentsCount.calledOnceWith('new-unit-id')).to.be.true;\n\t\texpect(livechatDepartmentStub.removeDepartmentFromUnit.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.decrementDepartmentsCount.calledOnceWith('unit-id')).to.be.true;\n\t});\n\n\tit('should remove department from its current unit if user is a monitor that supervises the current unit', async () => {\n\t\tlivechatDepartmentStub.findOneById.resolves({ _id: 'department-id', ancestors: ['unit-id'], parentId: 'unit-id' });\n\t\thasAnyRoleStub.resolves(false);\n\t\tgetUnitsFromUserStub.resolves(['unit-id']);\n\n\t\tawait manageDepartmentUnit({ userId: 'user-id', departmentId: 'department-id', unitId: undefined });\n\t\texpect(livechatDepartmentStub.addDepartmentToUnit.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.incrementDepartmentsCount.notCalled).to.be.true;\n\t\texpect(livechatDepartmentStub.removeDepartmentFromUnit.calledOnceWith('department-id')).to.be.true;\n\t\texpect(livechatUnitStub.decrementDepartmentsCount.calledOnceWith('unit-id')).to.be.true;\n\t});\n\n\tit('should add department to a unit if user is a monitor that supervises the new unit', async () => {\n\t\tlivechatDepartmentStub.findOneById.resolves({ _id: 'department-id' });\n\t\tlivechatUnitStub.findOneById.resolves({ _id: 'unit-id' });\n\t\thasAnyRoleStub.resolves(false);\n\t\tgetUnitsFromUserStub.resolves(['unit-id']);\n\n\t\tawait manageDepartmentUnit({ userId: 'user-id', departmentId: 'department-id', unitId: 'unit-id' });\n\t\texpect(livechatDepartmentStub.addDepartmentToUnit.calledOnceWith('department-id', 'unit-id', ['unit-id'])).to.be.true;\n\t\texpect(livechatUnitStub.incrementDepartmentsCount.calledOnceWith('unit-id')).to.be.true;\n\t\texpect(livechatDepartmentStub.removeDepartmentFromUnit.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.decrementDepartmentsCount.notCalled).to.be.true;\n\t});\n\n\tit('should move department to a new unit if user is a monitor that supervises the current and new units', async () => {\n\t\tlivechatDepartmentStub.findOneById.resolves({ _id: 'department-id', ancestors: ['unit-id'], parentId: 'unit-id' });\n\t\tlivechatUnitStub.findOneById.resolves({ _id: 'unit-id' });\n\t\thasAnyRoleStub.resolves(false);\n\t\tgetUnitsFromUserStub.resolves(['unit-id', 'new-unit-id']);\n\n\t\tawait manageDepartmentUnit({ userId: 'user-id', departmentId: 'department-id', unitId: 'new-unit-id' });\n\t\texpect(livechatDepartmentStub.addDepartmentToUnit.calledOnceWith('department-id', 'new-unit-id', ['new-unit-id'])).to.be.true;\n\t\texpect(livechatUnitStub.incrementDepartmentsCount.calledOnceWith('new-unit-id')).to.be.true;\n\t\texpect(livechatDepartmentStub.removeDepartmentFromUnit.notCalled).to.be.true;\n\t\texpect(livechatUnitStub.decrementDepartmentsCount.calledOnceWith('unit-id')).to.be.true;\n\t});\n});\n"],"names":["livechatDepartmentStub","findOneById","sinon","stub","addDepartmentToUnit","removeDepartmentFromUnit","livechatUnitStub","decrementDepartmentsCount","incrementDepartmentsCount","hasAnyRoleStub","getUnitsFromUserStub","manageDepartmentUnit","proxyquire","noCallThru","load","getUnitsFromUser","hasAnyRoleAsync","LivechatDepartment","LivechatUnit","describe","beforeEach","reset","it","resolves","userId","departmentId","unitId","expect","notCalled","to","be","true","_id","ancestors","parentId","undefined","calledOnceWith"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/livechat-enterprise/server/hooks/manageDepartmentUnit.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2ea7a847db306e47b205fa776b4accd42822fc0d","contentHash":"79a2e2327d4ba9e63e908c4f0da3086b5a63e660f2453eb698b8a94870ae048d"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/hooks/manageDepartmentUnit.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/hooks/manageDepartmentUnit.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":36}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":17},"end":{"line":12,"column":85}},"5":{"start":{"line":13,"column":19},"end":{"line":13,"column":58}},"6":{"start":{"line":14,"column":31},"end":{"line":14,"column":74}},"7":{"start":{"line":15,"column":29},"end":{"line":61,"column":1}},"8":{"start":{"line":17,"column":28},"end":{"line":17,"column":86}},"9":{"start":{"line":18,"column":30},"end":{"line":21,"column":6}},"10":{"start":{"line":22,"column":23},"end":{"line":27,"column":6}},"11":{"start":{"line":28,"column":38},"end":{"line":28,"column":247}},"12":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"13":{"start":{"line":30,"column":8},"end":{"line":30,"column":15}},"14":{"start":{"line":32,"column":36},"end":{"line":32,"column":55}},"15":{"start":{"line":33,"column":29},"end":{"line":33,"column":127}},"16":{"start":{"line":34,"column":33},"end":{"line":34,"column":165}},"17":{"start":{"line":35,"column":4},"end":{"line":37,"column":5}},"18":{"start":{"line":36,"column":8},"end":{"line":36,"column":15}},"19":{"start":{"line":38,"column":4},"end":{"line":56,"column":5}},"20":{"start":{"line":39,"column":21},"end":{"line":43,"column":10}},"21":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"22":{"start":{"line":45,"column":12},"end":{"line":45,"column":19}},"23":{"start":{"line":47,"column":8},"end":{"line":49,"column":9}},"24":{"start":{"line":48,"column":12},"end":{"line":48,"column":90}},"25":{"start":{"line":50,"column":8},"end":{"line":53,"column":11}},"26":{"start":{"line":54,"column":8},"end":{"line":54,"column":69}},"27":{"start":{"line":55,"column":8},"end":{"line":55,"column":15}},"28":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"29":{"start":{"line":58,"column":8},"end":{"line":58,"column":86}},"30":{"start":{"line":60,"column":4},"end":{"line":60,"column":76}},"31":{"start":{"line":62,"column":0},"end":{"line":62,"column":151}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":29},"end":{"line":15,"column":30}},"loc":{"start":{"line":15,"column":71},"end":{"line":61,"column":1}},"line":15}},"branchMap":{"0":{"loc":{"start":{"line":28,"column":38},"end":{"line":28,"column":247}},"type":"binary-expr","locations":[{"start":{"line":28,"column":38},"end":{"line":28,"column":44}},{"start":{"line":28,"column":49},"end":{"line":28,"column":246}}],"line":28},"1":{"loc":{"start":{"line":28,"column":49},"end":{"line":28,"column":246}},"type":"cond-expr","locations":[{"start":{"line":28,"column":96},"end":{"line":28,"column":102}},{"start":{"line":28,"column":105},"end":{"line":28,"column":246}}],"line":28},"2":{"loc":{"start":{"line":28,"column":49},"end":{"line":28,"column":93}},"type":"binary-expr","locations":[{"start":{"line":28,"column":49},"end":{"line":28,"column":68}},{"start":{"line":28,"column":72},"end":{"line":28,"column":93}}],"line":28},"3":{"loc":{"start":{"line":28,"column":105},"end":{"line":28,"column":246}},"type":"cond-expr","locations":[{"start":{"line":28,"column":199},"end":{"line":28,"column":205}},{"start":{"line":28,"column":208},"end":{"line":28,"column":246}}],"line":28},"4":{"loc":{"start":{"line":28,"column":105},"end":{"line":28,"column":196}},"type":"binary-expr","locations":[{"start":{"line":28,"column":105},"end":{"line":28,"column":160}},{"start":{"line":28,"column":164},"end":{"line":28,"column":196}}],"line":28},"5":{"loc":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},{"start":{"line":29,"column":4},"end":{"line":31,"column":5}}],"line":29},"6":{"loc":{"start":{"line":29,"column":8},"end":{"line":29,"column":48}},"type":"binary-expr","locations":[{"start":{"line":29,"column":8},"end":{"line":29,"column":19}},{"start":{"line":29,"column":23},"end":{"line":29,"column":48}}],"line":29},"7":{"loc":{"start":{"line":33,"column":29},"end":{"line":33,"column":127}},"type":"binary-expr","locations":[{"start":{"line":33,"column":29},"end":{"line":33,"column":36}},{"start":{"line":33,"column":40},"end":{"line":33,"column":57}},{"start":{"line":33,"column":61},"end":{"line":33,"column":91}},{"start":{"line":33,"column":95},"end":{"line":33,"column":127}}],"line":33},"8":{"loc":{"start":{"line":34,"column":33},"end":{"line":34,"column":165}},"type":"binary-expr","locations":[{"start":{"line":34,"column":33},"end":{"line":34,"column":57}},{"start":{"line":34,"column":61},"end":{"line":34,"column":78}},{"start":{"line":34,"column":82},"end":{"line":34,"column":112}},{"start":{"line":34,"column":116},"end":{"line":34,"column":165}}],"line":34},"9":{"loc":{"start":{"line":35,"column":4},"end":{"line":37,"column":5}},"type":"if","locations":[{"start":{"line":35,"column":4},"end":{"line":37,"column":5}},{"start":{"line":35,"column":4},"end":{"line":37,"column":5}}],"line":35},"10":{"loc":{"start":{"line":35,"column":8},"end":{"line":35,"column":50}},"type":"binary-expr","locations":[{"start":{"line":35,"column":8},"end":{"line":35,"column":25}},{"start":{"line":35,"column":29},"end":{"line":35,"column":50}}],"line":35},"11":{"loc":{"start":{"line":38,"column":4},"end":{"line":56,"column":5}},"type":"if","locations":[{"start":{"line":38,"column":4},"end":{"line":56,"column":5}},{"start":{"line":38,"column":4},"end":{"line":56,"column":5}}],"line":38},"12":{"loc":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"type":"if","locations":[{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},{"start":{"line":44,"column":8},"end":{"line":46,"column":9}}],"line":44},"13":{"loc":{"start":{"line":47,"column":8},"end":{"line":49,"column":9}},"type":"if","locations":[{"start":{"line":47,"column":8},"end":{"line":49,"column":9}},{"start":{"line":47,"column":8},"end":{"line":49,"column":9}}],"line":47},"14":{"loc":{"start":{"line":52,"column":15},"end":{"line":52,"column":35}},"type":"binary-expr","locations":[{"start":{"line":52,"column":15},"end":{"line":52,"column":29}},{"start":{"line":52,"column":33},"end":{"line":52,"column":35}}],"line":52},"15":{"loc":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"type":"if","locations":[{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},{"start":{"line":57,"column":4},"end":{"line":59,"column":5}}],"line":57}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":11,"9":11,"10":11,"11":11,"12":11,"13":2,"14":9,"15":9,"16":9,"17":9,"18":2,"19":7,"20":5,"21":5,"22":1,"23":4,"24":2,"25":4,"26":4,"27":4,"28":2,"29":2,"30":2,"31":1},"f":{"0":1,"1":11},"b":{"0":[11,9],"1":[1,8],"2":[9,8],"3":[2,6],"4":[8,8],"5":[2,9],"6":[11,10],"7":[9,7,4,4],"8":[9,7,4,4],"9":[2,7],"10":[9,8],"11":[5,2],"12":[1,4],"13":[2,2],"14":[4,4],"15":[2,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/hooks/manageDepartmentUnit.ts"],"sourcesContent":["import type { ILivechatDepartment, IOmnichannelBusinessUnit } from '@rocket.chat/core-typings';\nimport { LivechatDepartment, LivechatUnit } from '@rocket.chat/models';\n\nimport { hasAnyRoleAsync } from '../../../../../app/authorization/server/functions/hasRole';\nimport { callbacks } from '../../../../../lib/callbacks';\nimport { getUnitsFromUser } from '../methods/getUnitsFromUserRoles';\n\nexport const manageDepartmentUnit = async ({ userId, departmentId, unitId }: { userId: string; departmentId: string; unitId: string }) => {\n\tconst accessibleUnits = await getUnitsFromUser(userId);\n\tconst isLivechatManager = await hasAnyRoleAsync(userId, ['admin', 'livechat-manager']);\n\tconst department = await LivechatDepartment.findOneById<Pick<ILivechatDepartment, '_id' | 'ancestors' | 'parentId'>>(departmentId, {\n\t\tprojection: { ancestors: 1, parentId: 1 },\n\t});\n\n\tconst isDepartmentAlreadyInUnit = unitId && department?.ancestors?.includes(unitId);\n\tif (!department || isDepartmentAlreadyInUnit) {\n\t\treturn;\n\t}\n\n\tconst currentDepartmentUnitId = department.parentId;\n\tconst canManageNewUnit = !unitId || isLivechatManager || (Array.isArray(accessibleUnits) && accessibleUnits.includes(unitId));\n\tconst canManageCurrentUnit =\n\t\t!currentDepartmentUnitId || isLivechatManager || (Array.isArray(accessibleUnits) && accessibleUnits.includes(currentDepartmentUnitId));\n\tif (!canManageNewUnit || !canManageCurrentUnit) {\n\t\treturn;\n\t}\n\n\tif (unitId) {\n\t\tconst unit = await LivechatUnit.findOneById<Pick<IOmnichannelBusinessUnit, '_id' | 'ancestors'>>(unitId, {\n\t\t\tprojection: { ancestors: 1 },\n\t\t});\n\n\t\tif (!unit) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (currentDepartmentUnitId) {\n\t\t\tawait LivechatUnit.decrementDepartmentsCount(currentDepartmentUnitId);\n\t\t}\n\n\t\tawait LivechatDepartment.addDepartmentToUnit(departmentId, unitId, [unitId, ...(unit.ancestors || [])]);\n\t\tawait LivechatUnit.incrementDepartmentsCount(unitId);\n\t\treturn;\n\t}\n\n\tif (currentDepartmentUnitId) {\n\t\tawait LivechatUnit.decrementDepartmentsCount(currentDepartmentUnitId);\n\t}\n\n\tawait LivechatDepartment.removeDepartmentFromUnit(departmentId);\n};\n\ncallbacks.add('livechat.manageDepartmentUnit', manageDepartmentUnit, callbacks.priority.HIGH, 'livechat-manage-department-unit');\n"],"names":["manageDepartmentUnit","userId","departmentId","unitId","department","accessibleUnits","getUnitsFromUser","isLivechatManager","hasAnyRoleAsync","LivechatDepartment","findOneById","projection","ancestors","parentId","isDepartmentAlreadyInUnit","includes","currentDepartmentUnitId","canManageNewUnit","Array","isArray","canManageCurrentUnit","unit","LivechatUnit","decrementDepartmentsCount","addDepartmentToUnit","incrementDepartmentsCount","removeDepartmentFromUnit","callbacks","add","priority","HIGH"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBANoC;yBAEjB;2BACN;uCACO;AAE1B,MAAMA,uBAAuB,OAAO,EAAEC,MAAM,EAAEC,YAAY,EAAEC,MAAM,EAA4D;QAOxFC;IAN5C,MAAMC,kBAAkB,MAAMC,IAAAA,uCAAgB,EAACL;IAC/C,MAAMM,oBAAoB,MAAMC,IAAAA,wBAAe,EAACP,QAAQ;QAAC;QAAS;KAAmB;IACrF,MAAMG,aAAa,MAAMK,0BAAkB,CAACC,WAAW,CAA8DR,cAAc;QAClIS,YAAY;YAAEC,WAAW;YAAGC,UAAU;QAAE;IACzC;IAEA,MAAMC,4BAA4BX,WAAUC,uBAAAA,kCAAAA,wBAAAA,WAAYQ,SAAS,cAArBR,4CAAAA,sBAAuBW,QAAQ,CAACZ;IAC5E,IAAI,CAACC,cAAcU,2BAA2B;QAC7C;IACD;IAEA,MAAME,0BAA0BZ,WAAWS,QAAQ;IACnD,MAAMI,mBAAmB,CAACd,UAAUI,qBAAsBW,MAAMC,OAAO,CAACd,oBAAoBA,gBAAgBU,QAAQ,CAACZ;IACrH,MAAMiB,uBACL,CAACJ,2BAA2BT,qBAAsBW,MAAMC,OAAO,CAACd,oBAAoBA,gBAAgBU,QAAQ,CAACC;IAC9G,IAAI,CAACC,oBAAoB,CAACG,sBAAsB;QAC/C;IACD;IAEA,IAAIjB,QAAQ;QACX,MAAMkB,OAAO,MAAMC,oBAAY,CAACZ,WAAW,CAAsDP,QAAQ;YACxGQ,YAAY;gBAAEC,WAAW;YAAE;QAC5B;QAEA,IAAI,CAACS,MAAM;YACV;QACD;QAEA,IAAIL,yBAAyB;YAC5B,MAAMM,oBAAY,CAACC,yBAAyB,CAACP;QAC9C;QAEA,MAAMP,0BAAkB,CAACe,mBAAmB,CAACtB,cAAcC,QAAQ;YAACA;eAAYkB,KAAKT,SAAS,IAAI,EAAE;SAAE;QACtG,MAAMU,oBAAY,CAACG,yBAAyB,CAACtB;QAC7C;IACD;IAEA,IAAIa,yBAAyB;QAC5B,MAAMM,oBAAY,CAACC,yBAAyB,CAACP;IAC9C;IAEA,MAAMP,0BAAkB,CAACiB,wBAAwB,CAACxB;AACnD;AAEAyB,oBAAS,CAACC,GAAG,CAAC,iCAAiC5B,sBAAsB2B,oBAAS,CAACE,QAAQ,CAACC,IAAI,EAAE","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/hooks/manageDepartmentUnit.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"cbaea0fc296e7b8d466cbcfc4408d5d38fa8a42f","contentHash":"3c8870f78af0892d3639ac5297d6362a06c13e15824f1ed7bbc335bbd3358ca0"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/meteor/ee/server/local-services/instance/getTransporter.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/meteor/ee/server/local-services/instance/getTransporter.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":24},"end":{"line":6,"column":104}},"3":{"start":{"line":7,"column":0},"end":{"line":48,"column":3}},"4":{"start":{"line":8,"column":4},"end":{"line":14,"column":7}},"5":{"start":{"line":9,"column":8},"end":{"line":13,"column":11}},"6":{"start":{"line":15,"column":4},"end":{"line":37,"column":7}},"7":{"start":{"line":16,"column":8},"end":{"line":22,"column":11}},"8":{"start":{"line":23,"column":8},"end":{"line":29,"column":11}},"9":{"start":{"line":30,"column":8},"end":{"line":36,"column":11}},"10":{"start":{"line":38,"column":4},"end":{"line":42,"column":7}},"11":{"start":{"line":39,"column":8},"end":{"line":41,"column":48}},"12":{"start":{"line":39,"column":30},"end":{"line":41,"column":14}},"13":{"start":{"line":43,"column":4},"end":{"line":47,"column":7}},"14":{"start":{"line":44,"column":8},"end":{"line":46,"column":39}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":27},"end":{"line":7,"column":28}},"loc":{"start":{"line":7,"column":31},"end":{"line":48,"column":1}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":8,"column":51},"end":{"line":8,"column":52}},"loc":{"start":{"line":8,"column":55},"end":{"line":14,"column":5}},"line":8},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":54},"end":{"line":15,"column":55}},"loc":{"start":{"line":15,"column":58},"end":{"line":37,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":38,"column":54},"end":{"line":38,"column":55}},"loc":{"start":{"line":38,"column":58},"end":{"line":42,"column":5}},"line":38},"4":{"name":"(anonymous_4)","decl":{"start":{"line":39,"column":26},"end":{"line":39,"column":27}},"loc":{"start":{"line":39,"column":30},"end":{"line":41,"column":14}},"line":39},"5":{"name":"(anonymous_5)","decl":{"start":{"line":43,"column":53},"end":{"line":43,"column":54}},"loc":{"start":{"line":43,"column":57},"end":{"line":47,"column":5}},"line":43}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1},"f":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/meteor/ee/server/local-services/instance/getTransporter.spec.ts"],"sourcesContent":["import { expect } from 'chai';\n\nimport { getTransporter } from '../../../../../../../../server/local-services/instance/getTransporter';\n\ndescribe('getTransporter', () => {\n\tit('should return TCP with port 0 by default', () => {\n\t\texpect(getTransporter()).to.deep.equal({ port: 0, udpDiscovery: false, useHostname: false });\n\t});\n\n\tit('should return TCP with port set via env var', () => {\n\t\texpect(getTransporter({ port: '1234' })).to.deep.equal({ port: '1234', udpDiscovery: false, useHostname: false });\n\n\t\texpect(getTransporter({ port: '   1234' })).to.deep.equal({ port: '1234', udpDiscovery: false, useHostname: false });\n\n\t\texpect(getTransporter({ port: '   1234   ' })).to.deep.equal({ port: '1234', udpDiscovery: false, useHostname: false });\n\t});\n\n\tit('should throw if transporter set incorrectly', () => {\n\t\texpect(() => getTransporter({ transporter: 'something' })).to.throw('invalid transporter');\n\t});\n\n\tit('should return transporter if set correctly', () => {\n\t\texpect(getTransporter({ transporter: 'monolith+nats://address' })).to.equal('nats://address');\n\t});\n});\n"],"names":["describe","it","expect","getTransporter","to","deep","equal","port","udpDiscovery","useHostname","transporter","throw"],"mappings":";;;;sBAAuB;gCAEQ;AAE/BA,SAAS,kBAAkB;IAC1BC,GAAG,4CAA4C;QAC9CC,IAAAA,YAAM,EAACC,IAAAA,8BAAc,KAAIC,EAAE,CAACC,IAAI,CAACC,KAAK,CAAC;YAAEC,MAAM;YAAGC,cAAc;YAAOC,aAAa;QAAM;IAC3F;IAEAR,GAAG,+CAA+C;QACjDC,IAAAA,YAAM,EAACC,IAAAA,8BAAc,EAAC;YAAEI,MAAM;QAAO,IAAIH,EAAE,CAACC,IAAI,CAACC,KAAK,CAAC;YAAEC,MAAM;YAAQC,cAAc;YAAOC,aAAa;QAAM;QAE/GP,IAAAA,YAAM,EAACC,IAAAA,8BAAc,EAAC;YAAEI,MAAM;QAAU,IAAIH,EAAE,CAACC,IAAI,CAACC,KAAK,CAAC;YAAEC,MAAM;YAAQC,cAAc;YAAOC,aAAa;QAAM;QAElHP,IAAAA,YAAM,EAACC,IAAAA,8BAAc,EAAC;YAAEI,MAAM;QAAa,IAAIH,EAAE,CAACC,IAAI,CAACC,KAAK,CAAC;YAAEC,MAAM;YAAQC,cAAc;YAAOC,aAAa;QAAM;IACtH;IAEAR,GAAG,+CAA+C;QACjDC,IAAAA,YAAM,EAAC,IAAMC,IAAAA,8BAAc,EAAC;gBAAEO,aAAa;YAAY,IAAIN,EAAE,CAACO,KAAK,CAAC;IACrE;IAEAV,GAAG,8CAA8C;QAChDC,IAAAA,YAAM,EAACC,IAAAA,8BAAc,EAAC;YAAEO,aAAa;QAA0B,IAAIN,EAAE,CAACE,KAAK,CAAC;IAC7E;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/apps/meteor/ee/server/local-services/instance/getTransporter.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4ca7cc9dde12966e599ac7e6673a37fa205b0691","contentHash":"d6b6de9f74cfa92d8bc0d6faedf2bb7fae474a080ef73d5e2d86bc6e9b1d2780"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/instance/getTransporter.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/instance/getTransporter.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":30}},"3":{"start":{"line":12,"column":4},"end":{"line":18,"column":5}},"4":{"start":{"line":13,"column":8},"end":{"line":15,"column":9}},"5":{"start":{"line":14,"column":12},"end":{"line":14,"column":51}},"6":{"start":{"line":16,"column":27},"end":{"line":16,"column":49}},"7":{"start":{"line":17,"column":8},"end":{"line":17,"column":28}},"8":{"start":{"line":19,"column":4},"end":{"line":24,"column":6}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"getTransporter","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":23}},"loc":{"start":{"line":11,"column":59},"end":{"line":25,"column":1}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":24},"end":{"line":11,"column":57}},"type":"default-arg","locations":[{"start":{"line":11,"column":55},"end":{"line":11,"column":57}}],"line":11},"1":{"loc":{"start":{"line":12,"column":4},"end":{"line":18,"column":5}},"type":"if","locations":[{"start":{"line":12,"column":4},"end":{"line":18,"column":5}},{"start":{"line":12,"column":4},"end":{"line":18,"column":5}}],"line":12},"2":{"loc":{"start":{"line":13,"column":8},"end":{"line":15,"column":9}},"type":"if","locations":[{"start":{"line":13,"column":8},"end":{"line":15,"column":9}},{"start":{"line":13,"column":8},"end":{"line":15,"column":9}}],"line":13},"3":{"loc":{"start":{"line":20,"column":14},"end":{"line":20,"column":36}},"type":"cond-expr","locations":[{"start":{"line":20,"column":21},"end":{"line":20,"column":32}},{"start":{"line":20,"column":35},"end":{"line":20,"column":36}}],"line":20},"4":{"loc":{"start":{"line":23,"column":11},"end":{"line":23,"column":41}},"type":"cond-expr","locations":[{"start":{"line":23,"column":19},"end":{"line":23,"column":36}},{"start":{"line":23,"column":39},"end":{"line":23,"column":41}}],"line":23}},"s":{"0":1,"1":1,"2":6,"3":6,"4":2,"5":1,"6":1,"7":1,"8":4},"f":{"0":6,"1":6},"b":{"0":[1],"1":[2,4],"2":[1,1],"3":[3,1],"4":[0,4]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/instance/getTransporter.ts"],"sourcesContent":["export function getTransporter({ transporter, port, extra }: { transporter?: string; port?: string; extra?: string } = {}) {\n\tif (transporter) {\n\t\tif (!transporter.match(/^(?:monolith\\+)/)) {\n\t\t\tthrow new Error('invalid transporter');\n\t\t}\n\n\t\tconst [, ...url] = transporter.split('+');\n\t\treturn url.join('');\n\t}\n\n\treturn {\n\t\tport: port ? port.trim() : 0,\n\t\tudpDiscovery: false,\n\t\tuseHostname: false,\n\t\t...(extra ? JSON.parse(extra) : {}),\n\t};\n}\n"],"names":["getTransporter","transporter","port","extra","match","Error","url","split","join","trim","udpDiscovery","useHostname","JSON","parse"],"mappings":";;;;+BAAgBA;;;eAAAA;;;AAAT,SAASA,eAAe,EAAEC,WAAW,EAAEC,IAAI,EAAEC,KAAK,EAA2D,GAAG,CAAC,CAAC;IACxH,IAAIF,aAAa;QAChB,IAAI,CAACA,YAAYG,KAAK,CAAC,oBAAoB;YAC1C,MAAM,IAAIC,MAAM;QACjB;QAEA,MAAM,GAAG,GAAGC,IAAI,GAAGL,YAAYM,KAAK,CAAC;QACrC,OAAOD,IAAIE,IAAI,CAAC;IACjB;IAEA,OAAO;QACNN,MAAMA,OAAOA,KAAKO,IAAI,KAAK;QAC3BC,cAAc;QACdC,aAAa;QACb,GAAIR,QAAQS,KAAKC,KAAK,CAACV,SAAS,CAAC,CAAC;IACnC;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/instance/getTransporter.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8c92b20438bdd788bf905497b15d6ba7385a7188","contentHash":"12377dc9deda0c5d40168b998285a7c1eb4a626bd1bff0d0491fc75391c32523"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/airgappedRestrictions/airgappedRestrictions.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/airgappedRestrictions/airgappedRestrictions.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":17},"end":{"line":5,"column":48}},"2":{"start":{"line":6,"column":14},"end":{"line":6,"column":29}},"3":{"start":{"line":7,"column":34},"end":{"line":7,"column":81}},"4":{"start":{"line":8,"column":29},"end":{"line":8,"column":71}},"5":{"start":{"line":10,"column":4},"end":{"line":12,"column":6}},"6":{"start":{"line":14,"column":15},"end":{"line":14,"column":17}},"7":{"start":{"line":15,"column":27},"end":{"line":25,"column":1}},"8":{"start":{"line":17,"column":22},"end":{"line":19,"column":9}},"9":{"start":{"line":18,"column":12},"end":{"line":18,"column":39}},"10":{"start":{"line":20,"column":8},"end":{"line":20,"column":37}},"11":{"start":{"line":23,"column":8},"end":{"line":23,"column":117}},"12":{"start":{"line":26,"column":32},"end":{"line":26,"column":58}},"13":{"start":{"line":27,"column":14},"end":{"line":39,"column":1}},"14":{"start":{"line":29,"column":8},"end":{"line":33,"column":11}},"15":{"start":{"line":40,"column":20},"end":{"line":49,"column":1}},"16":{"start":{"line":41,"column":26},"end":{"line":41,"column":35}},"17":{"start":{"line":42,"column":24},"end":{"line":42,"column":33}},"18":{"start":{"line":44,"column":8},"end":{"line":44,"column":36}},"19":{"start":{"line":47,"column":8},"end":{"line":47,"column":34}},"20":{"start":{"line":50,"column":0},"end":{"line":74,"column":3}},"21":{"start":{"line":75,"column":0},"end":{"line":132,"column":3}},"22":{"start":{"line":76,"column":4},"end":{"line":88,"column":7}},"23":{"start":{"line":77,"column":8},"end":{"line":84,"column":11}},"24":{"start":{"line":78,"column":12},"end":{"line":80,"column":13}},"25":{"start":{"line":79,"column":16},"end":{"line":79,"column":36}},"26":{"start":{"line":81,"column":12},"end":{"line":83,"column":13}},"27":{"start":{"line":82,"column":16},"end":{"line":82,"column":29}},"28":{"start":{"line":85,"column":8},"end":{"line":85,"column":66}},"29":{"start":{"line":86,"column":8},"end":{"line":86,"column":56}},"30":{"start":{"line":87,"column":8},"end":{"line":87,"column":22}},"31":{"start":{"line":89,"column":4},"end":{"line":97,"column":7}},"32":{"start":{"line":90,"column":8},"end":{"line":92,"column":11}},"33":{"start":{"line":93,"column":8},"end":{"line":93,"column":36}},"34":{"start":{"line":94,"column":8},"end":{"line":94,"column":131}},"35":{"start":{"line":95,"column":8},"end":{"line":95,"column":126}},"36":{"start":{"line":96,"column":8},"end":{"line":96,"column":86}},"37":{"start":{"line":98,"column":4},"end":{"line":106,"column":7}},"38":{"start":{"line":99,"column":8},"end":{"line":101,"column":11}},"39":{"start":{"line":102,"column":8},"end":{"line":102,"column":36}},"40":{"start":{"line":103,"column":8},"end":{"line":103,"column":130}},"41":{"start":{"line":104,"column":8},"end":{"line":104,"column":126}},"42":{"start":{"line":105,"column":8},"end":{"line":105,"column":86}},"43":{"start":{"line":107,"column":4},"end":{"line":119,"column":7}},"44":{"start":{"line":108,"column":8},"end":{"line":110,"column":11}},"45":{"start":{"line":111,"column":8},"end":{"line":111,"column":62}},"46":{"start":{"line":112,"column":8},"end":{"line":112,"column":36}},"47":{"start":{"line":113,"column":8},"end":{"line":113,"column":130}},"48":{"start":{"line":114,"column":8},"end":{"line":114,"column":126}},"49":{"start":{"line":115,"column":8},"end":{"line":115,"column":85}},"50":{"start":{"line":116,"column":8},"end":{"line":118,"column":12}},"51":{"start":{"line":120,"column":4},"end":{"line":125,"column":7}},"52":{"start":{"line":121,"column":8},"end":{"line":121,"column":45}},"53":{"start":{"line":122,"column":8},"end":{"line":122,"column":39}},"54":{"start":{"line":123,"column":8},"end":{"line":123,"column":69}},"55":{"start":{"line":124,"column":8},"end":{"line":124,"column":101}},"56":{"start":{"line":126,"column":4},"end":{"line":131,"column":7}},"57":{"start":{"line":127,"column":8},"end":{"line":127,"column":45}},"58":{"start":{"line":128,"column":8},"end":{"line":128,"column":37}},"59":{"start":{"line":129,"column":8},"end":{"line":129,"column":69}},"60":{"start":{"line":130,"column":8},"end":{"line":130,"column":101}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":33}},"loc":{"start":{"line":9,"column":39},"end":{"line":13,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":16,"column":4},"end":{"line":16,"column":5}},"loc":{"start":{"line":16,"column":17},"end":{"line":21,"column":5}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":17,"column":22},"end":{"line":17,"column":23}},"loc":{"start":{"line":17,"column":33},"end":{"line":19,"column":9}},"line":17},"3":{"name":"(anonymous_3)","decl":{"start":{"line":22,"column":4},"end":{"line":22,"column":5}},"loc":{"start":{"line":22,"column":24},"end":{"line":24,"column":5}},"line":22},"4":{"name":"(anonymous_4)","decl":{"start":{"line":28,"column":26},"end":{"line":28,"column":27}},"loc":{"start":{"line":28,"column":38},"end":{"line":34,"column":5}},"line":28},"5":{"name":"(anonymous_5)","decl":{"start":{"line":41,"column":16},"end":{"line":41,"column":17}},"loc":{"start":{"line":41,"column":26},"end":{"line":41,"column":35}},"line":41},"6":{"name":"(anonymous_6)","decl":{"start":{"line":42,"column":14},"end":{"line":42,"column":15}},"loc":{"start":{"line":42,"column":24},"end":{"line":42,"column":33}},"line":42},"7":{"name":"(anonymous_7)","decl":{"start":{"line":43,"column":23},"end":{"line":43,"column":24}},"loc":{"start":{"line":43,"column":35},"end":{"line":45,"column":5}},"line":43},"8":{"name":"(anonymous_8)","decl":{"start":{"line":46,"column":21},"end":{"line":46,"column":22}},"loc":{"start":{"line":46,"column":33},"end":{"line":48,"column":5}},"line":46},"9":{"name":"(anonymous_9)","decl":{"start":{"line":75,"column":34},"end":{"line":75,"column":35}},"loc":{"start":{"line":75,"column":38},"end":{"line":132,"column":1}},"line":75},"10":{"name":"(anonymous_10)","decl":{"start":{"line":76,"column":14},"end":{"line":76,"column":15}},"loc":{"start":{"line":76,"column":18},"end":{"line":88,"column":5}},"line":76},"11":{"name":"(anonymous_11)","decl":{"start":{"line":77,"column":37},"end":{"line":77,"column":38}},"loc":{"start":{"line":77,"column":45},"end":{"line":84,"column":9}},"line":77},"12":{"name":"(anonymous_12)","decl":{"start":{"line":89,"column":60},"end":{"line":89,"column":61}},"loc":{"start":{"line":89,"column":70},"end":{"line":97,"column":5}},"line":89},"13":{"name":"(anonymous_13)","decl":{"start":{"line":98,"column":60},"end":{"line":98,"column":61}},"loc":{"start":{"line":98,"column":70},"end":{"line":106,"column":5}},"line":98},"14":{"name":"(anonymous_14)","decl":{"start":{"line":107,"column":83},"end":{"line":107,"column":84}},"loc":{"start":{"line":107,"column":93},"end":{"line":119,"column":5}},"line":107},"15":{"name":"(anonymous_15)","decl":{"start":{"line":120,"column":61},"end":{"line":120,"column":62}},"loc":{"start":{"line":120,"column":71},"end":{"line":125,"column":5}},"line":120},"16":{"name":"(anonymous_16)","decl":{"start":{"line":126,"column":61},"end":{"line":126,"column":62}},"loc":{"start":{"line":126,"column":71},"end":{"line":131,"column":5}},"line":126}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":11},"end":{"line":12,"column":5}},"type":"cond-expr","locations":[{"start":{"line":10,"column":35},"end":{"line":10,"column":38}},{"start":{"line":10,"column":41},"end":{"line":12,"column":5}}],"line":10},"1":{"loc":{"start":{"line":10,"column":11},"end":{"line":10,"column":32}},"type":"binary-expr","locations":[{"start":{"line":10,"column":11},"end":{"line":10,"column":14}},{"start":{"line":10,"column":18},"end":{"line":10,"column":32}}],"line":10},"2":{"loc":{"start":{"line":78,"column":12},"end":{"line":80,"column":13}},"type":"if","locations":[{"start":{"line":78,"column":12},"end":{"line":80,"column":13}},{"start":{"line":78,"column":12},"end":{"line":80,"column":13}}],"line":78},"3":{"loc":{"start":{"line":81,"column":12},"end":{"line":83,"column":13}},"type":"if","locations":[{"start":{"line":81,"column":12},"end":{"line":83,"column":13}},{"start":{"line":81,"column":12},"end":{"line":83,"column":13}}],"line":81}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":2,"6":1,"7":1,"8":1,"9":3,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":0,"17":0,"18":1,"19":1,"20":1,"21":1,"22":1,"23":5,"24":25,"25":20,"26":25,"27":5,"28":5,"29":5,"30":5,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1},"f":{"0":2,"1":1,"2":3,"3":1,"4":1,"5":0,"6":0,"7":1,"8":1,"9":1,"10":5,"11":25,"12":1,"13":1,"14":1,"15":1,"16":1},"b":{"0":[0,2],"1":[2,2],"2":[20,5],"3":[5,20]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/airgappedRestrictions/airgappedRestrictions.spec.ts"],"sourcesContent":["import { Emitter } from '@rocket.chat/emitter';\nimport { expect } from 'chai';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\nlet promises: Array<Promise<any>> = [];\n\nclass AirgappedRestriction extends Emitter<{ remainingDays: { days: number } }> {\n\tcomputeRestriction = sinon.spy();\n\n\tisWarningPeriod = sinon.stub();\n\n\ton(type: any, cb: any): any {\n\t\tconst newCb = (...args: any) => {\n\t\t\tpromises.push(cb(...args));\n\t\t};\n\t\treturn super.on(type, newCb);\n\t}\n}\n\nconst airgappedRestrictionObj = new AirgappedRestriction();\n\nconst mocks = {\n\tsendMessagesToAdmins: ({ msgs }: any) => {\n\t\tmsgs({ adminUser: { language: 'pt-br' } });\n\t},\n\tsettingsUpdate: sinon.spy(),\n\tnotifySetting: sinon.spy(),\n\ti18n: sinon.spy(),\n\tfindLastToken: sinon.stub(),\n};\n\nconst licenseMock = {\n\tvalidateCb: async () => undefined,\n\tremoveCb: async () => undefined,\n\tonValidateLicense: async (cb: any) => {\n\t\tlicenseMock.validateCb = cb;\n\t},\n\tonRemoveLicense: async (cb: any) => {\n\t\tlicenseMock.removeCb = cb;\n\t},\n};\n\nproxyquire.noCallThru().load('../../../../app/license/server/airGappedRestrictions.ts', {\n\t'@rocket.chat/license': {\n\t\tAirGappedRestriction: airgappedRestrictionObj,\n\t\tLicense: licenseMock,\n\t},\n\t'@rocket.chat/models': {\n\t\tSettings: {\n\t\t\tupdateValueById: mocks.settingsUpdate,\n\t\t},\n\t\tStatistics: {\n\t\t\tfindLastStatsToken: mocks.findLastToken,\n\t\t},\n\t},\n\t'../../../../app/lib/server/lib/notifyListener': {\n\t\tnotifyOnSettingChangedById: mocks.notifySetting,\n\t},\n\t'../../../../server/lib/i18n': {\n\t\ti18n: {\n\t\t\tt: mocks.i18n,\n\t\t},\n\t},\n\t'../../../../server/lib/sendMessagesToAdmins': {\n\t\tsendMessagesToAdmins: mocks.sendMessagesToAdmins,\n\t},\n});\n\ndescribe('airgappedRestrictions', () => {\n\tafterEach(() => {\n\t\tObject.values(mocks).forEach((mock) => {\n\t\t\tif ('resetHistory' in mock) {\n\t\t\t\tmock.resetHistory();\n\t\t\t}\n\t\t\tif ('reset' in mock) {\n\t\t\t\tmock.reset();\n\t\t\t}\n\t\t});\n\t\tairgappedRestrictionObj.computeRestriction.resetHistory();\n\t\tairgappedRestrictionObj.isWarningPeriod.reset();\n\t\tpromises = [];\n\t});\n\tit('should update setting when restriction is removed', async () => {\n\t\tairgappedRestrictionObj.emit('remainingDays', { days: -1 });\n\n\t\tawait Promise.all(promises);\n\t\texpect(mocks.settingsUpdate.calledWith('Cloud_Workspace_AirGapped_Restrictions_Remaining_Days', -1)).to.be.true;\n\t\texpect(mocks.notifySetting.calledWith('Cloud_Workspace_AirGapped_Restrictions_Remaining_Days')).to.be.true;\n\t\texpect(airgappedRestrictionObj.isWarningPeriod.called).to.be.false;\n\t});\n\n\tit('should update setting when restriction is applied', async () => {\n\t\tairgappedRestrictionObj.emit('remainingDays', { days: 0 });\n\n\t\tawait Promise.all(promises);\n\t\texpect(mocks.settingsUpdate.calledWith('Cloud_Workspace_AirGapped_Restrictions_Remaining_Days', 0)).to.be.true;\n\t\texpect(mocks.notifySetting.calledWith('Cloud_Workspace_AirGapped_Restrictions_Remaining_Days')).to.be.true;\n\t\texpect(airgappedRestrictionObj.isWarningPeriod.called).to.be.false;\n\t});\n\n\tit('should update setting and send rocket.cat message when in warning period', async () => {\n\t\tairgappedRestrictionObj.emit('remainingDays', { days: 1 });\n\t\tairgappedRestrictionObj.isWarningPeriod.returns(true);\n\n\t\tawait Promise.all(promises);\n\t\texpect(mocks.settingsUpdate.calledWith('Cloud_Workspace_AirGapped_Restrictions_Remaining_Days', 1)).to.be.true;\n\t\texpect(mocks.notifySetting.calledWith('Cloud_Workspace_AirGapped_Restrictions_Remaining_Days')).to.be.true;\n\t\texpect(airgappedRestrictionObj.isWarningPeriod.called).to.be.true;\n\t\texpect(mocks.i18n.calledWith('AirGapped_Restriction_Warning', { lng: 'pt-br' }));\n\t});\n\n\tit('should recompute restriction if license is applied', async () => {\n\t\tmocks.findLastToken.returns('token');\n\t\tawait licenseMock.validateCb();\n\t\texpect(mocks.findLastToken.calledOnce).to.be.true;\n\t\texpect(airgappedRestrictionObj.computeRestriction.calledWith('token')).to.be.true;\n\t});\n\n\tit('should recompute restriction if license is removed', async () => {\n\t\tmocks.findLastToken.returns('token');\n\t\tawait licenseMock.removeCb();\n\t\texpect(mocks.findLastToken.calledOnce).to.be.true;\n\t\texpect(airgappedRestrictionObj.computeRestriction.calledWith('token')).to.be.true;\n\t});\n});\n"],"names":["promises","AirgappedRestriction","Emitter","on","type","cb","newCb","args","push","computeRestriction","sinon","spy","isWarningPeriod","stub","airgappedRestrictionObj","mocks","sendMessagesToAdmins","msgs","adminUser","language","settingsUpdate","notifySetting","i18n","findLastToken","licenseMock","validateCb","undefined","removeCb","onValidateLicense","onRemoveLicense","proxyquire","noCallThru","load","AirGappedRestriction","License","Settings","updateValueById","Statistics","findLastStatsToken","notifyOnSettingChangedById","t","describe","afterEach","Object","values","forEach","mock","resetHistory","reset","it","emit","days","Promise","all","expect","calledWith","to","be","true","called","false","returns","lng","calledOnce"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/airgappedRestrictions/airgappedRestrictions.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8bd4c64ed0c515a4c22b044e0ab69baf4055e232","contentHash":"14f32d77b5abb4cb58e1fabc18e737f2e6a46f4f5f5a35fab3330a2baf3d989c"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/license/server/airGappedRestrictions.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/license/server/airGappedRestrictions.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":17},"end":{"line":5,"column":48}},"2":{"start":{"line":6,"column":16},"end":{"line":6,"column":46}},"3":{"start":{"line":7,"column":24},"end":{"line":7,"column":80}},"4":{"start":{"line":8,"column":14},"end":{"line":8,"column":52}},"5":{"start":{"line":9,"column":30},"end":{"line":9,"column":84}},"6":{"start":{"line":10,"column":33},"end":{"line":13,"column":1}},"7":{"start":{"line":11,"column":4},"end":{"line":11,"column":115}},"8":{"start":{"line":12,"column":4},"end":{"line":12,"column":114}},"9":{"start":{"line":14,"column":37},"end":{"line":29,"column":1}},"10":{"start":{"line":15,"column":41},"end":{"line":15,"column":59}},"11":{"start":{"line":16,"column":4},"end":{"line":18,"column":5}},"12":{"start":{"line":17,"column":8},"end":{"line":17,"column":15}},"13":{"start":{"line":19,"column":4},"end":{"line":28,"column":5}},"14":{"start":{"line":20,"column":8},"end":{"line":27,"column":11}},"15":{"start":{"line":21,"column":42},"end":{"line":26,"column":17}},"16":{"start":{"line":30,"column":0},"end":{"line":33,"column":3}},"17":{"start":{"line":31,"column":4},"end":{"line":31,"column":41}},"18":{"start":{"line":32,"column":4},"end":{"line":32,"column":45}},"19":{"start":{"line":34,"column":0},"end":{"line":37,"column":3}},"20":{"start":{"line":35,"column":18},"end":{"line":35,"column":63}},"21":{"start":{"line":36,"column":4},"end":{"line":36,"column":65}},"22":{"start":{"line":38,"column":0},"end":{"line":41,"column":3}},"23":{"start":{"line":39,"column":18},"end":{"line":39,"column":63}},"24":{"start":{"line":40,"column":4},"end":{"line":40,"column":65}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":10,"column":33},"end":{"line":10,"column":34}},"loc":{"start":{"line":10,"column":56},"end":{"line":13,"column":1}},"line":10},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":37},"end":{"line":14,"column":38}},"loc":{"start":{"line":14,"column":60},"end":{"line":29,"column":1}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":21,"column":18},"end":{"line":21,"column":19}},"loc":{"start":{"line":21,"column":42},"end":{"line":26,"column":17}},"line":21},"3":{"name":"(anonymous_3)","decl":{"start":{"line":30,"column":50},"end":{"line":30,"column":51}},"loc":{"start":{"line":30,"column":68},"end":{"line":33,"column":1}},"line":30},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":35},"end":{"line":34,"column":36}},"loc":{"start":{"line":34,"column":45},"end":{"line":37,"column":1}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":38,"column":33},"end":{"line":38,"column":34}},"loc":{"start":{"line":38,"column":43},"end":{"line":41,"column":1}},"line":38}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":4},"end":{"line":18,"column":5}},"type":"if","locations":[{"start":{"line":16,"column":4},"end":{"line":18,"column":5}},{"start":{"line":16,"column":4},"end":{"line":18,"column":5}}],"line":16},"1":{"loc":{"start":{"line":19,"column":4},"end":{"line":28,"column":5}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":28,"column":5}},{"start":{"line":19,"column":4},"end":{"line":28,"column":5}}],"line":19},"2":{"loc":{"start":{"line":23,"column":29},"end":{"line":23,"column":55}},"type":"binary-expr","locations":[{"start":{"line":23,"column":29},"end":{"line":23,"column":47}},{"start":{"line":23,"column":51},"end":{"line":23,"column":55}}],"line":23}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":3,"8":3,"9":1,"10":3,"11":3,"12":2,"13":1,"14":1,"15":1,"16":1,"17":3,"18":3,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1},"f":{"0":3,"1":3,"2":1,"3":3,"4":1,"5":1},"b":{"0":[2,1],"1":[1,0],"2":[1,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/license/server/airGappedRestrictions.ts"],"sourcesContent":["import { AirGappedRestriction, License } from '@rocket.chat/license';\nimport { Settings, Statistics } from '@rocket.chat/models';\n\nimport { notifyOnSettingChangedById } from '../../../../app/lib/server/lib/notifyListener';\nimport { i18n } from '../../../../server/lib/i18n';\nimport { sendMessagesToAdmins } from '../../../../server/lib/sendMessagesToAdmins';\n\nconst updateRestrictionSetting = async (remainingDays: number) => {\n\tawait Settings.updateValueById('Cloud_Workspace_AirGapped_Restrictions_Remaining_Days', remainingDays);\n\tvoid notifyOnSettingChangedById('Cloud_Workspace_AirGapped_Restrictions_Remaining_Days');\n};\n\nconst sendRocketCatWarningToAdmins = async (remainingDays: number) => {\n\tconst lastDayOrNoRestrictionsAtAll = remainingDays <= 0;\n\tif (lastDayOrNoRestrictionsAtAll) {\n\t\treturn;\n\t}\n\tif (AirGappedRestriction.isWarningPeriod(remainingDays)) {\n\t\tawait sendMessagesToAdmins({\n\t\t\tmsgs: async ({ adminUser }) => ({\n\t\t\t\tmsg: i18n.t('AirGapped_Restriction_Warning', { lng: adminUser.language || 'en', remainingDays }),\n\t\t\t}),\n\t\t});\n\t}\n};\n\nAirGappedRestriction.on('remainingDays', async ({ days }: { days: number }) => {\n\tawait updateRestrictionSetting(days);\n\tawait sendRocketCatWarningToAdmins(days);\n});\n\nLicense.onValidateLicense(async () => {\n\tconst token = await Statistics.findLastStatsToken();\n\tvoid AirGappedRestriction.computeRestriction(token);\n});\n\nLicense.onRemoveLicense(async () => {\n\tconst token = await Statistics.findLastStatsToken();\n\tvoid AirGappedRestriction.computeRestriction(token);\n});\n"],"names":["updateRestrictionSetting","remainingDays","Settings","updateValueById","notifyOnSettingChangedById","sendRocketCatWarningToAdmins","lastDayOrNoRestrictionsAtAll","AirGappedRestriction","isWarningPeriod","sendMessagesToAdmins","msgs","adminUser","msg","i18n","t","lng","language","on","days","License","onValidateLicense","token","Statistics","findLastStatsToken","computeRestriction","onRemoveLicense"],"mappings":";;;;yBAA8C;wBACT;gCAEM;sBACtB;sCACgB;AAErC,MAAMA,2BAA2B,OAAOC;IACvC,MAAMC,gBAAQ,CAACC,eAAe,CAAC,yDAAyDF;IACxF,KAAKG,IAAAA,0CAA0B,EAAC;AACjC;AAEA,MAAMC,+BAA+B,OAAOJ;IAC3C,MAAMK,+BAA+BL,iBAAiB;IACtD,IAAIK,8BAA8B;QACjC;IACD;IACA,IAAIC,6BAAoB,CAACC,eAAe,CAACP,gBAAgB;QACxD,MAAMQ,IAAAA,0CAAoB,EAAC;YAC1BC,MAAM,OAAO,EAAEC,SAAS,EAAE,GAAM,CAAA;oBAC/BC,KAAKC,UAAI,CAACC,CAAC,CAAC,iCAAiC;wBAAEC,KAAKJ,UAAUK,QAAQ,IAAI;wBAAMf;oBAAc;gBAC/F,CAAA;QACD;IACD;AACD;AAEAM,6BAAoB,CAACU,EAAE,CAAC,iBAAiB,OAAO,EAAEC,IAAI,EAAoB;IACzE,MAAMlB,yBAAyBkB;IAC/B,MAAMb,6BAA6Ba;AACpC;AAEAC,gBAAO,CAACC,iBAAiB,CAAC;IACzB,MAAMC,QAAQ,MAAMC,kBAAU,CAACC,kBAAkB;IACjD,KAAKhB,6BAAoB,CAACiB,kBAAkB,CAACH;AAC9C;AAEAF,gBAAO,CAACM,eAAe,CAAC;IACvB,MAAMJ,QAAQ,MAAMC,kBAAU,CAACC,kBAAkB;IACjD,KAAKhB,6BAAoB,CAACiB,kBAAkB,CAACH;AAC9C","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/license/server/airGappedRestrictions.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"693355a2d129c8f497adb79c1404a5088cd05953","contentHash":"0b1c492145c41519276de123a75b4db4c9c9ad0fd061e345bf5e86c548225a86"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/airgappedRestrictions/airGappedRestrictionsWrapper.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/airgappedRestrictions/airGappedRestrictionsWrapper.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":34},"end":{"line":6,"column":81}},"3":{"start":{"line":7,"column":29},"end":{"line":7,"column":71}},"4":{"start":{"line":8,"column":38},"end":{"line":8,"column":111}},"5":{"start":{"line":10,"column":4},"end":{"line":12,"column":6}},"6":{"start":{"line":14,"column":22},"end":{"line":14,"column":26}},"7":{"start":{"line":15,"column":24},"end":{"line":19,"column":1}},"8":{"start":{"line":17,"column":8},"end":{"line":17,"column":31}},"9":{"start":{"line":20,"column":0},"end":{"line":27,"column":3}},"10":{"start":{"line":28,"column":0},"end":{"line":38,"column":3}},"11":{"start":{"line":29,"column":4},"end":{"line":31,"column":7}},"12":{"start":{"line":30,"column":8},"end":{"line":30,"column":171}},"13":{"start":{"line":32,"column":4},"end":{"line":37,"column":7}},"14":{"start":{"line":33,"column":8},"end":{"line":33,"column":32}},"15":{"start":{"line":34,"column":20},"end":{"line":34,"column":41}},"16":{"start":{"line":35,"column":8},"end":{"line":35,"column":141}},"17":{"start":{"line":36,"column":8},"end":{"line":36,"column":53}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":33}},"loc":{"start":{"line":9,"column":39},"end":{"line":13,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":16,"column":4},"end":{"line":16,"column":5}},"loc":{"start":{"line":16,"column":22},"end":{"line":18,"column":5}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":28,"column":44},"end":{"line":28,"column":45}},"loc":{"start":{"line":28,"column":48},"end":{"line":38,"column":1}},"line":28},"3":{"name":"(anonymous_3)","decl":{"start":{"line":29,"column":65},"end":{"line":29,"column":66}},"loc":{"start":{"line":29,"column":75},"end":{"line":31,"column":5}},"line":29},"4":{"name":"(anonymous_4)","decl":{"start":{"line":32,"column":73},"end":{"line":32,"column":74}},"loc":{"start":{"line":32,"column":83},"end":{"line":37,"column":5}},"line":32}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":11},"end":{"line":12,"column":5}},"type":"cond-expr","locations":[{"start":{"line":10,"column":35},"end":{"line":10,"column":38}},{"start":{"line":10,"column":41},"end":{"line":12,"column":5}}],"line":10},"1":{"loc":{"start":{"line":10,"column":11},"end":{"line":10,"column":32}},"type":"binary-expr","locations":[{"start":{"line":10,"column":11},"end":{"line":10,"column":14}},{"start":{"line":10,"column":18},"end":{"line":10,"column":32}}],"line":10}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":2,"6":1,"7":1,"8":2,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1},"f":{"0":2,"1":2,"2":1,"3":1,"4":1},"b":{"0":[0,2],"1":[2,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/airgappedRestrictions/airGappedRestrictionsWrapper.spec.ts"],"sourcesContent":["import { expect } from 'chai';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\nimport { applyAirGappedRestrictionsValidation } from '../../../../../app/license/server/airGappedRestrictionsWrapper';\n\nlet restrictionFlag = true;\n\nconst airgappedModule = {\n\tget restricted() {\n\t\treturn restrictionFlag;\n\t},\n};\n\nproxyquire.noCallThru().load('../../../../server/patches/airGappedRestrictionsWrapper.ts', {\n\t'@rocket.chat/license': {\n\t\tAirGappedRestriction: airgappedModule,\n\t},\n\t'../../../app/license/server/airGappedRestrictionsWrapper': {\n\t\tapplyAirGappedRestrictionsValidation,\n\t},\n});\n\ndescribe('#airGappedRestrictionsWrapper()', () => {\n\tit('should throw an error when the workspace is restricted', async () => {\n\t\tawait expect(applyAirGappedRestrictionsValidation(sinon.stub())).to.be.rejectedWith('restricted-workspace');\n\t});\n\tit('should NOT throw an error when the workspace is not restricted', async () => {\n\t\trestrictionFlag = false;\n\t\tconst spy = sinon.stub();\n\t\tawait expect(applyAirGappedRestrictionsValidation(spy)).to.eventually.equal(undefined);\n\t\texpect(spy.calledOnce).to.be.true;\n\t});\n});\n"],"names":["restrictionFlag","airgappedModule","restricted","proxyquire","noCallThru","load","AirGappedRestriction","applyAirGappedRestrictionsValidation","describe","it","expect","sinon","stub","to","be","rejectedWith","spy","eventually","equal","undefined","calledOnce","true"],"mappings":";;;;sBAAuB;mEACA;8DACL;8CAEmC;;;;;;AAErD,IAAIA,kBAAkB;AAEtB,MAAMC,kBAAkB;IACvB,IAAIC,cAAa;QAChB,OAAOF;IACR;AACD;AAEAG,mBAAU,CAACC,UAAU,GAAGC,IAAI,CAAC,8DAA8D;IAC1F,wBAAwB;QACvBC,sBAAsBL;IACvB;IACA,4DAA4D;QAC3DM,sCAAAA,kEAAoC;IACrC;AACD;AAEAC,SAAS,mCAAmC;IAC3CC,GAAG,0DAA0D;QAC5D,MAAMC,IAAAA,YAAM,EAACH,IAAAA,kEAAoC,EAACI,cAAK,CAACC,IAAI,KAAKC,EAAE,CAACC,EAAE,CAACC,YAAY,CAAC;IACrF;IACAN,GAAG,kEAAkE;QACpET,kBAAkB;QAClB,MAAMgB,MAAML,cAAK,CAACC,IAAI;QACtB,MAAMF,IAAAA,YAAM,EAACH,IAAAA,kEAAoC,EAACS,MAAMH,EAAE,CAACI,UAAU,CAACC,KAAK,CAACC;QAC5ET,IAAAA,YAAM,EAACM,IAAII,UAAU,EAAEP,EAAE,CAACC,EAAE,CAACO,IAAI;IAClC;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/airgappedRestrictions/airGappedRestrictionsWrapper.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"02947a5f5248efbaca8ca7f0e6bb613e266a475f","contentHash":"0ca7e537c19cea290019e4406fcf81be4675dfec1fe1689f3e174185151800c6"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/license/server/airGappedRestrictionsWrapper.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/license/server/airGappedRestrictionsWrapper.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":52}},"3":{"start":{"line":11,"column":24},"end":{"line":11,"column":63}},"4":{"start":{"line":12,"column":45},"end":{"line":14,"column":2}},"5":{"start":{"line":13,"column":4},"end":{"line":13,"column":16}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":79},"end":{"line":12,"column":80}},"loc":{"start":{"line":12,"column":91},"end":{"line":14,"column":1}},"line":12}},"branchMap":{},"s":{"0":1,"1":1,"2":3,"3":1,"4":1,"5":0},"f":{"0":3,"1":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/license/server/airGappedRestrictionsWrapper.ts"],"sourcesContent":["import { makeFunction } from '@rocket.chat/patch-injection';\n\nexport const applyAirGappedRestrictionsValidation = makeFunction(async <T>(fn: () => Promise<T>): Promise<T> => {\n\treturn fn();\n});\n"],"names":["applyAirGappedRestrictionsValidation","makeFunction","fn"],"mappings":";;;;+BAEaA;;;eAAAA;;;gCAFgB;AAEtB,MAAMA,uCAAuCC,IAAAA,4BAAY,EAAC,OAAUC;IAC1E,OAAOA;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/license/server/airGappedRestrictionsWrapper.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"54acd74855e849fd4e8bc8f9b93a0a7441de2d90","contentHash":"803a6ead7f41fee5d15b71f4745b3f34656f21f911fdbb8efe18b95883bb3477"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/patches/airGappedRestrictionsWrapper.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/patches/airGappedRestrictionsWrapper.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":17},"end":{"line":5,"column":48}},"2":{"start":{"line":6,"column":38},"end":{"line":6,"column":105}},"3":{"start":{"line":7,"column":0},"end":{"line":12,"column":3}},"4":{"start":{"line":8,"column":4},"end":{"line":10,"column":5}},"5":{"start":{"line":9,"column":8},"end":{"line":9,"column":48}},"6":{"start":{"line":11,"column":4},"end":{"line":11,"column":16}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":73},"end":{"line":7,"column":74}},"loc":{"start":{"line":7,"column":88},"end":{"line":12,"column":1}},"line":7}},"branchMap":{"0":{"loc":{"start":{"line":8,"column":4},"end":{"line":10,"column":5}},"type":"if","locations":[{"start":{"line":8,"column":4},"end":{"line":10,"column":5}},{"start":{"line":8,"column":4},"end":{"line":10,"column":5}}],"line":8}},"s":{"0":1,"1":1,"2":1,"3":1,"4":2,"5":1,"6":1},"f":{"0":2},"b":{"0":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/patches/airGappedRestrictionsWrapper.ts"],"sourcesContent":["import { AirGappedRestriction } from '@rocket.chat/license';\n\nimport { applyAirGappedRestrictionsValidation } from '../../../app/license/server/airGappedRestrictionsWrapper';\n\napplyAirGappedRestrictionsValidation.patch(async <T>(_: any, fn: () => Promise<T>): Promise<T> => {\n\tif (AirGappedRestriction.restricted) {\n\t\tthrow new Error('restricted-workspace');\n\t}\n\treturn fn();\n});\n"],"names":["applyAirGappedRestrictionsValidation","patch","_","fn","AirGappedRestriction","restricted","Error"],"mappings":";;;;yBAAqC;8CAEgB;AAErDA,kEAAoC,CAACC,KAAK,CAAC,OAAUC,GAAQC;IAC5D,IAAIC,6BAAoB,CAACC,UAAU,EAAE;QACpC,MAAM,IAAIC,MAAM;IACjB;IACA,OAAOH;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/patches/airGappedRestrictionsWrapper.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a10fe674f30fadbb646d387deba772aaf9ca68cb","contentHash":"3edbf2654ea57c9141207edc22089edab9d8c67bca8d75ef4099798283f2bd16"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/room/sender/DirectMessageRoomServiceSender.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/room/sender/DirectMessageRoomServiceSender.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":15},"end":{"line":5,"column":67}},"2":{"start":{"line":6,"column":14},"end":{"line":6,"column":29}},"3":{"start":{"line":7,"column":34},"end":{"line":7,"column":81}},"4":{"start":{"line":8,"column":29},"end":{"line":8,"column":71}},"5":{"start":{"line":10,"column":4},"end":{"line":12,"column":6}},"6":{"start":{"line":14,"column":28},"end":{"line":23,"column":2}},"7":{"start":{"line":18,"column":16},"end":{"line":18,"column":35}},"8":{"start":{"line":24,"column":28},"end":{"line":33,"column":2}},"9":{"start":{"line":28,"column":16},"end":{"line":28,"column":35}},"10":{"start":{"line":34,"column":53},"end":{"line":43,"column":2}},"11":{"start":{"line":38,"column":16},"end":{"line":38,"column":35}},"12":{"start":{"line":44,"column":0},"end":{"line":326,"column":3}},"13":{"start":{"line":46,"column":24},"end":{"line":49,"column":5}},"14":{"start":{"line":50,"column":24},"end":{"line":58,"column":5}},"15":{"start":{"line":59,"column":28},"end":{"line":61,"column":5}},"16":{"start":{"line":62,"column":19},"end":{"line":68,"column":5}},"17":{"start":{"line":69,"column":21},"end":{"line":75,"column":5}},"18":{"start":{"line":76,"column":4},"end":{"line":78,"column":7}},"19":{"start":{"line":77,"column":8},"end":{"line":77,"column":118}},"20":{"start":{"line":79,"column":4},"end":{"line":93,"column":7}},"21":{"start":{"line":80,"column":8},"end":{"line":80,"column":57}},"22":{"start":{"line":81,"column":8},"end":{"line":81,"column":64}},"23":{"start":{"line":82,"column":8},"end":{"line":82,"column":57}},"24":{"start":{"line":83,"column":8},"end":{"line":83,"column":48}},"25":{"start":{"line":84,"column":8},"end":{"line":84,"column":48}},"26":{"start":{"line":85,"column":8},"end":{"line":85,"column":63}},"27":{"start":{"line":86,"column":8},"end":{"line":86,"column":57}},"28":{"start":{"line":87,"column":8},"end":{"line":87,"column":44}},"29":{"start":{"line":88,"column":8},"end":{"line":88,"column":54}},"30":{"start":{"line":89,"column":8},"end":{"line":89,"column":47}},"31":{"start":{"line":90,"column":8},"end":{"line":90,"column":34}},"32":{"start":{"line":91,"column":8},"end":{"line":91,"column":47}},"33":{"start":{"line":92,"column":8},"end":{"line":92,"column":32}},"34":{"start":{"line":94,"column":4},"end":{"line":303,"column":7}},"35":{"start":{"line":95,"column":21},"end":{"line":99,"column":10}},"36":{"start":{"line":100,"column":21},"end":{"line":100,"column":140}},"37":{"start":{"line":101,"column":8},"end":{"line":110,"column":11}},"38":{"start":{"line":102,"column":12},"end":{"line":102,"column":68}},"39":{"start":{"line":103,"column":12},"end":{"line":103,"column":68}},"40":{"start":{"line":104,"column":12},"end":{"line":108,"column":15}},"41":{"start":{"line":109,"column":12},"end":{"line":109,"column":68}},"42":{"start":{"line":111,"column":8},"end":{"line":132,"column":11}},"43":{"start":{"line":112,"column":12},"end":{"line":112,"column":83}},"44":{"start":{"line":113,"column":12},"end":{"line":113,"column":78}},"45":{"start":{"line":114,"column":12},"end":{"line":117,"column":15}},"46":{"start":{"line":118,"column":12},"end":{"line":118,"column":68}},"47":{"start":{"line":119,"column":12},"end":{"line":119,"column":60}},"48":{"start":{"line":120,"column":12},"end":{"line":124,"column":15}},"49":{"start":{"line":125,"column":28},"end":{"line":129,"column":14}},"50":{"start":{"line":130,"column":12},"end":{"line":130,"column":106}},"51":{"start":{"line":131,"column":12},"end":{"line":131,"column":94}},"52":{"start":{"line":133,"column":8},"end":{"line":144,"column":11}},"53":{"start":{"line":134,"column":12},"end":{"line":134,"column":73}},"54":{"start":{"line":135,"column":12},"end":{"line":138,"column":15}},"55":{"start":{"line":139,"column":12},"end":{"line":143,"column":87}},"56":{"start":{"line":145,"column":8},"end":{"line":159,"column":11}},"57":{"start":{"line":146,"column":12},"end":{"line":146,"column":75}},"58":{"start":{"line":147,"column":12},"end":{"line":147,"column":66}},"59":{"start":{"line":148,"column":12},"end":{"line":148,"column":68}},"60":{"start":{"line":149,"column":12},"end":{"line":149,"column":74}},"61":{"start":{"line":150,"column":12},"end":{"line":150,"column":73}},"62":{"start":{"line":151,"column":12},"end":{"line":151,"column":70}},"63":{"start":{"line":152,"column":12},"end":{"line":156,"column":15}},"64":{"start":{"line":157,"column":12},"end":{"line":157,"column":153}},"65":{"start":{"line":157,"column":118},"end":{"line":157,"column":138}},"66":{"start":{"line":158,"column":12},"end":{"line":158,"column":137}},"67":{"start":{"line":160,"column":8},"end":{"line":173,"column":11}},"68":{"start":{"line":161,"column":12},"end":{"line":161,"column":75}},"69":{"start":{"line":162,"column":12},"end":{"line":162,"column":66}},"70":{"start":{"line":163,"column":12},"end":{"line":163,"column":68}},"71":{"start":{"line":164,"column":12},"end":{"line":164,"column":74}},"72":{"start":{"line":165,"column":12},"end":{"line":165,"column":73}},"73":{"start":{"line":166,"column":12},"end":{"line":166,"column":70}},"74":{"start":{"line":167,"column":12},"end":{"line":171,"column":15}},"75":{"start":{"line":172,"column":12},"end":{"line":172,"column":138}},"76":{"start":{"line":172,"column":40},"end":{"line":172,"column":136}},"77":{"start":{"line":174,"column":8},"end":{"line":187,"column":11}},"78":{"start":{"line":175,"column":12},"end":{"line":175,"column":66}},"79":{"start":{"line":176,"column":12},"end":{"line":176,"column":68}},"80":{"start":{"line":177,"column":12},"end":{"line":177,"column":74}},"81":{"start":{"line":178,"column":12},"end":{"line":178,"column":73}},"82":{"start":{"line":179,"column":12},"end":{"line":179,"column":70}},"83":{"start":{"line":180,"column":12},"end":{"line":184,"column":15}},"84":{"start":{"line":185,"column":12},"end":{"line":185,"column":81}},"85":{"start":{"line":186,"column":12},"end":{"line":186,"column":98}},"86":{"start":{"line":188,"column":8},"end":{"line":199,"column":11}},"87":{"start":{"line":189,"column":12},"end":{"line":189,"column":69}},"88":{"start":{"line":190,"column":12},"end":{"line":190,"column":68}},"89":{"start":{"line":191,"column":12},"end":{"line":191,"column":73}},"90":{"start":{"line":192,"column":12},"end":{"line":196,"column":15}},"91":{"start":{"line":197,"column":12},"end":{"line":197,"column":81}},"92":{"start":{"line":198,"column":12},"end":{"line":198,"column":98}},"93":{"start":{"line":200,"column":8},"end":{"line":218,"column":11}},"94":{"start":{"line":201,"column":12},"end":{"line":201,"column":75}},"95":{"start":{"line":202,"column":12},"end":{"line":202,"column":66}},"96":{"start":{"line":203,"column":12},"end":{"line":203,"column":68}},"97":{"start":{"line":204,"column":12},"end":{"line":204,"column":68}},"98":{"start":{"line":205,"column":12},"end":{"line":205,"column":89}},"99":{"start":{"line":206,"column":12},"end":{"line":206,"column":74}},"100":{"start":{"line":207,"column":12},"end":{"line":211,"column":15}},"101":{"start":{"line":212,"column":28},"end":{"line":216,"column":14}},"102":{"start":{"line":217,"column":12},"end":{"line":217,"column":94}},"103":{"start":{"line":219,"column":8},"end":{"line":236,"column":11}},"104":{"start":{"line":220,"column":12},"end":{"line":220,"column":69}},"105":{"start":{"line":221,"column":12},"end":{"line":221,"column":68}},"106":{"start":{"line":222,"column":12},"end":{"line":222,"column":68}},"107":{"start":{"line":223,"column":12},"end":{"line":223,"column":89}},"108":{"start":{"line":224,"column":12},"end":{"line":224,"column":74}},"109":{"start":{"line":225,"column":12},"end":{"line":229,"column":15}},"110":{"start":{"line":230,"column":28},"end":{"line":234,"column":14}},"111":{"start":{"line":235,"column":12},"end":{"line":235,"column":94}},"112":{"start":{"line":237,"column":8},"end":{"line":247,"column":11}},"113":{"start":{"line":238,"column":12},"end":{"line":238,"column":68}},"114":{"start":{"line":239,"column":12},"end":{"line":239,"column":68}},"115":{"start":{"line":240,"column":12},"end":{"line":240,"column":74}},"116":{"start":{"line":241,"column":12},"end":{"line":245,"column":15}},"117":{"start":{"line":246,"column":12},"end":{"line":246,"column":82}},"118":{"start":{"line":248,"column":8},"end":{"line":259,"column":11}},"119":{"start":{"line":249,"column":12},"end":{"line":249,"column":69}},"120":{"start":{"line":250,"column":12},"end":{"line":250,"column":68}},"121":{"start":{"line":251,"column":12},"end":{"line":251,"column":68}},"122":{"start":{"line":252,"column":12},"end":{"line":252,"column":74}},"123":{"start":{"line":253,"column":12},"end":{"line":257,"column":15}},"124":{"start":{"line":258,"column":12},"end":{"line":258,"column":68}},"125":{"start":{"line":260,"column":8},"end":{"line":271,"column":11}},"126":{"start":{"line":261,"column":12},"end":{"line":261,"column":75}},"127":{"start":{"line":262,"column":12},"end":{"line":262,"column":66}},"128":{"start":{"line":263,"column":12},"end":{"line":263,"column":68}},"129":{"start":{"line":264,"column":12},"end":{"line":264,"column":68}},"130":{"start":{"line":265,"column":12},"end":{"line":265,"column":79}},"131":{"start":{"line":266,"column":12},"end":{"line":270,"column":110}},"132":{"start":{"line":272,"column":8},"end":{"line":284,"column":11}},"133":{"start":{"line":273,"column":12},"end":{"line":273,"column":66}},"134":{"start":{"line":274,"column":12},"end":{"line":274,"column":68}},"135":{"start":{"line":275,"column":12},"end":{"line":275,"column":68}},"136":{"start":{"line":276,"column":12},"end":{"line":276,"column":74}},"137":{"start":{"line":277,"column":12},"end":{"line":277,"column":58}},"138":{"start":{"line":278,"column":12},"end":{"line":282,"column":15}},"139":{"start":{"line":283,"column":12},"end":{"line":283,"column":68}},"140":{"start":{"line":285,"column":8},"end":{"line":302,"column":11}},"141":{"start":{"line":286,"column":12},"end":{"line":286,"column":69}},"142":{"start":{"line":287,"column":12},"end":{"line":287,"column":68}},"143":{"start":{"line":288,"column":12},"end":{"line":288,"column":68}},"144":{"start":{"line":289,"column":12},"end":{"line":289,"column":74}},"145":{"start":{"line":290,"column":12},"end":{"line":290,"column":65}},"146":{"start":{"line":291,"column":12},"end":{"line":295,"column":15}},"147":{"start":{"line":296,"column":28},"end":{"line":300,"column":14}},"148":{"start":{"line":301,"column":12},"end":{"line":301,"column":143}},"149":{"start":{"line":304,"column":4},"end":{"line":325,"column":7}},"150":{"start":{"line":305,"column":8},"end":{"line":324,"column":11}},"151":{"start":{"line":306,"column":12},"end":{"line":306,"column":79}},"152":{"start":{"line":307,"column":12},"end":{"line":307,"column":76}},"153":{"start":{"line":308,"column":12},"end":{"line":317,"column":15}},"154":{"start":{"line":318,"column":28},"end":{"line":322,"column":14}},"155":{"start":{"line":323,"column":12},"end":{"line":323,"column":101}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":33}},"loc":{"start":{"line":9,"column":39},"end":{"line":13,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":17,"column":12},"end":{"line":17,"column":13}},"loc":{"start":{"line":17,"column":26},"end":{"line":19,"column":13}},"line":17},"2":{"name":"(anonymous_2)","decl":{"start":{"line":27,"column":12},"end":{"line":27,"column":13}},"loc":{"start":{"line":27,"column":26},"end":{"line":29,"column":13}},"line":27},"3":{"name":"(anonymous_3)","decl":{"start":{"line":37,"column":12},"end":{"line":37,"column":13}},"loc":{"start":{"line":37,"column":26},"end":{"line":39,"column":13}},"line":37},"4":{"name":"(anonymous_4)","decl":{"start":{"line":44,"column":82},"end":{"line":44,"column":83}},"loc":{"start":{"line":44,"column":86},"end":{"line":326,"column":1}},"line":44},"5":{"name":"(anonymous_5)","decl":{"start":{"line":76,"column":15},"end":{"line":76,"column":16}},"loc":{"start":{"line":76,"column":19},"end":{"line":78,"column":5}},"line":76},"6":{"name":"(anonymous_6)","decl":{"start":{"line":79,"column":14},"end":{"line":79,"column":15}},"loc":{"start":{"line":79,"column":18},"end":{"line":93,"column":5}},"line":79},"7":{"name":"(anonymous_7)","decl":{"start":{"line":94,"column":47},"end":{"line":94,"column":48}},"loc":{"start":{"line":94,"column":51},"end":{"line":303,"column":5}},"line":94},"8":{"name":"(anonymous_8)","decl":{"start":{"line":101,"column":101},"end":{"line":101,"column":102}},"loc":{"start":{"line":101,"column":111},"end":{"line":110,"column":9}},"line":101},"9":{"name":"(anonymous_9)","decl":{"start":{"line":111,"column":98},"end":{"line":111,"column":99}},"loc":{"start":{"line":111,"column":108},"end":{"line":132,"column":9}},"line":111},"10":{"name":"(anonymous_10)","decl":{"start":{"line":133,"column":67},"end":{"line":133,"column":68}},"loc":{"start":{"line":133,"column":77},"end":{"line":144,"column":9}},"line":133},"11":{"name":"(anonymous_11)","decl":{"start":{"line":145,"column":161},"end":{"line":145,"column":162}},"loc":{"start":{"line":145,"column":171},"end":{"line":159,"column":9}},"line":145},"12":{"name":"(anonymous_12)","decl":{"start":{"line":157,"column":107},"end":{"line":157,"column":108}},"loc":{"start":{"line":157,"column":118},"end":{"line":157,"column":138}},"line":157},"13":{"name":"(anonymous_13)","decl":{"start":{"line":160,"column":99},"end":{"line":160,"column":100}},"loc":{"start":{"line":160,"column":109},"end":{"line":173,"column":9}},"line":160},"14":{"name":"(anonymous_14)","decl":{"start":{"line":172,"column":29},"end":{"line":172,"column":30}},"loc":{"start":{"line":172,"column":40},"end":{"line":172,"column":136}},"line":172},"15":{"name":"(anonymous_15)","decl":{"start":{"line":174,"column":143},"end":{"line":174,"column":144}},"loc":{"start":{"line":174,"column":153},"end":{"line":187,"column":9}},"line":174},"16":{"name":"(anonymous_16)","decl":{"start":{"line":188,"column":121},"end":{"line":188,"column":122}},"loc":{"start":{"line":188,"column":131},"end":{"line":199,"column":9}},"line":188},"17":{"name":"(anonymous_17)","decl":{"start":{"line":200,"column":166},"end":{"line":200,"column":167}},"loc":{"start":{"line":200,"column":176},"end":{"line":218,"column":9}},"line":200},"18":{"name":"(anonymous_18)","decl":{"start":{"line":219,"column":107},"end":{"line":219,"column":108}},"loc":{"start":{"line":219,"column":117},"end":{"line":236,"column":9}},"line":219},"19":{"name":"(anonymous_19)","decl":{"start":{"line":237,"column":70},"end":{"line":237,"column":71}},"loc":{"start":{"line":237,"column":80},"end":{"line":247,"column":9}},"line":237},"20":{"name":"(anonymous_20)","decl":{"start":{"line":248,"column":135},"end":{"line":248,"column":136}},"loc":{"start":{"line":248,"column":145},"end":{"line":259,"column":9}},"line":248},"21":{"name":"(anonymous_21)","decl":{"start":{"line":260,"column":164},"end":{"line":260,"column":165}},"loc":{"start":{"line":260,"column":174},"end":{"line":271,"column":9}},"line":260},"22":{"name":"(anonymous_22)","decl":{"start":{"line":272,"column":125},"end":{"line":272,"column":126}},"loc":{"start":{"line":272,"column":135},"end":{"line":284,"column":9}},"line":272},"23":{"name":"(anonymous_23)","decl":{"start":{"line":285,"column":127},"end":{"line":285,"column":128}},"loc":{"start":{"line":285,"column":137},"end":{"line":302,"column":9}},"line":285},"24":{"name":"(anonymous_24)","decl":{"start":{"line":304,"column":51},"end":{"line":304,"column":52}},"loc":{"start":{"line":304,"column":55},"end":{"line":325,"column":5}},"line":304},"25":{"name":"(anonymous_25)","decl":{"start":{"line":305,"column":71},"end":{"line":305,"column":72}},"loc":{"start":{"line":305,"column":81},"end":{"line":324,"column":9}},"line":305}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":11},"end":{"line":12,"column":5}},"type":"cond-expr","locations":[{"start":{"line":10,"column":35},"end":{"line":10,"column":38}},{"start":{"line":10,"column":41},"end":{"line":12,"column":5}}],"line":10},"1":{"loc":{"start":{"line":10,"column":11},"end":{"line":10,"column":32}},"type":"binary-expr","locations":[{"start":{"line":10,"column":11},"end":{"line":10,"column":14}},{"start":{"line":10,"column":18},"end":{"line":10,"column":32}}],"line":10}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":2,"6":1,"7":1,"8":1,"9":5,"10":1,"11":8,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":15,"20":1,"21":15,"22":15,"23":15,"24":15,"25":15,"26":15,"27":15,"28":15,"29":15,"30":15,"31":15,"32":15,"33":15,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1,"61":1,"62":1,"63":1,"64":1,"65":1,"66":1,"67":1,"68":1,"69":1,"70":1,"71":1,"72":1,"73":1,"74":1,"75":1,"76":1,"77":1,"78":1,"79":1,"80":1,"81":1,"82":1,"83":1,"84":1,"85":1,"86":1,"87":1,"88":1,"89":1,"90":1,"91":1,"92":1,"93":1,"94":1,"95":1,"96":1,"97":1,"98":1,"99":1,"100":1,"101":1,"102":1,"103":1,"104":1,"105":1,"106":1,"107":1,"108":1,"109":1,"110":1,"111":1,"112":1,"113":1,"114":1,"115":1,"116":1,"117":1,"118":1,"119":1,"120":1,"121":1,"122":1,"123":1,"124":1,"125":1,"126":1,"127":1,"128":1,"129":1,"130":1,"131":1,"132":1,"133":1,"134":1,"135":1,"136":1,"137":1,"138":1,"139":1,"140":1,"141":1,"142":1,"143":1,"144":1,"145":1,"146":1,"147":1,"148":1,"149":1,"150":1,"151":1,"152":1,"153":1,"154":1,"155":1},"f":{"0":2,"1":1,"2":5,"3":8,"4":1,"5":15,"6":15,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1},"b":{"0":[0,2],"1":[2,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/room/sender/DirectMessageRoomServiceSender.spec.ts"],"sourcesContent":["import { RoomType } from '@rocket.chat/apps-engine/definition/rooms';\nimport { expect } from 'chai';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\nconst { FederatedRoomEE } = proxyquire.noCallThru().load('../../../../../../../../server/local-services/federation/domain/FederatedRoom', {\n\tmongodb: {\n\t\t'ObjectId': class ObjectId {\n\t\t\ttoHexString(): string {\n\t\t\t\treturn 'hexString';\n\t\t\t}\n\t\t},\n\t\t'@global': true,\n\t},\n});\nconst { FederatedUserEE } = proxyquire.noCallThru().load('../../../../../../../../server/local-services/federation/domain/FederatedUser', {\n\tmongodb: {\n\t\t'ObjectId': class ObjectId {\n\t\t\ttoHexString(): string {\n\t\t\t\treturn 'hexString';\n\t\t\t}\n\t\t},\n\t\t'@global': true,\n\t},\n});\nconst { FederationDirectMessageRoomServiceSender } = proxyquire\n\t.noCallThru()\n\t.load('../../../../../../../../server/local-services/federation/application/room/sender/DirectMessageRoomServiceSender', {\n\t\tmongodb: {\n\t\t\t'ObjectId': class ObjectId {\n\t\t\t\ttoHexString(): string {\n\t\t\t\t\treturn 'hexString';\n\t\t\t\t}\n\t\t\t},\n\t\t\t'@global': true,\n\t\t},\n\t});\n\ndescribe('FederationEE - Application - FederationDirectMessageRoomServiceSender', () => {\n\tlet service: typeof FederationDirectMessageRoomServiceSender;\n\tconst roomAdapter = {\n\t\tgetFederatedRoomByInternalId: sinon.stub(),\n\t\tupdateFederatedRoomByInternalRoomId: sinon.stub(),\n\t};\n\tconst userAdapter = {\n\t\tgetFederatedUserByExternalId: sinon.stub(),\n\t\tgetFederatedUserByInternalId: sinon.stub(),\n\t\tcreateFederatedUser: sinon.stub(),\n\t\tgetInternalUserById: sinon.stub(),\n\t\tgetFederatedUserByInternalUsername: sinon.stub(),\n\t\tcreateLocalUser: sinon.stub(),\n\t\tgetInternalUserByUsername: sinon.stub(),\n\t};\n\tconst settingsAdapter = {\n\t\tgetHomeServerDomain: sinon.stub().returns('localDomain'),\n\t};\n\tconst bridge = {\n\t\tgetUserProfileInformation: sinon.stub().resolves({}),\n\t\textractHomeserverOrigin: sinon.stub(),\n\t\tcreateUser: sinon.stub(),\n\t\tcreateDirectMessageRoom: sinon.stub(),\n\t\tjoinRoom: sinon.stub(),\n\t};\n\tconst invitees = [\n\t\t{\n\t\t\tinviteeUsernameOnly: 'marcos.defendi',\n\t\t\tnormalizedInviteeId: 'marcos.defendi:matrix.com',\n\t\t\trawInviteeId: '@marcos.defendi:matrix.com',\n\t\t},\n\t];\n\n\tbeforeEach(() => {\n\t\tservice = new FederationDirectMessageRoomServiceSender(\n\t\t\troomAdapter as any,\n\t\t\tuserAdapter as any,\n\t\t\t{} as any,\n\t\t\tsettingsAdapter as any,\n\t\t\tbridge as any,\n\t\t);\n\t});\n\n\tafterEach(() => {\n\t\troomAdapter.getFederatedRoomByInternalId.reset();\n\t\troomAdapter.updateFederatedRoomByInternalRoomId.reset();\n\t\tuserAdapter.getFederatedUserByInternalId.reset();\n\t\tuserAdapter.getInternalUserById.reset();\n\t\tuserAdapter.createFederatedUser.reset();\n\t\tuserAdapter.getFederatedUserByInternalUsername.reset();\n\t\tuserAdapter.getFederatedUserByExternalId.reset();\n\t\tuserAdapter.createLocalUser.reset();\n\t\tuserAdapter.getInternalUserByUsername.reset();\n\t\tbridge.extractHomeserverOrigin.reset();\n\t\tbridge.createUser.reset();\n\t\tbridge.createDirectMessageRoom.reset();\n\t\tbridge.joinRoom.reset();\n\t});\n\n\tdescribe('#onDirectMessageRoomCreation()', () => {\n\t\tconst user = FederatedUserEE.createInstance('externalInviterId', {\n\t\t\tname: 'normalizedInviterId',\n\t\t\tusername: 'normalizedInviterId',\n\t\t\texistsOnlyOnProxyServer: true,\n\t\t});\n\t\tconst room = FederatedRoomEE.createInstance('externalRoomId', 'normalizedRoomId', user, RoomType.CHANNEL, 'externalRoomName');\n\n\t\tit('should NOT create the inviter user both externally and internally if it already exists', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tawait service.onDirectMessageRoomCreation({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t} as any);\n\n\t\t\texpect(bridge.createUser.called).to.be.false;\n\t\t});\n\n\t\tit('should create the inviter user both externally and internally if it does not exists', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.onCall(0).resolves(undefined);\n\t\t\tuserAdapter.getFederatedUserByInternalId.onCall(1).resolves(user);\n\t\t\tuserAdapter.getInternalUserById.resolves({ username: 'username', name: 'name' } as any);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.createUser.resolves('externalInviterId');\n\t\t\tawait service.onDirectMessageRoomCreation({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t} as any);\n\n\t\t\tconst inviter = FederatedUserEE.createInstance('externalInviterId', {\n\t\t\t\tname: 'name',\n\t\t\t\tusername: 'username',\n\t\t\t\texistsOnlyOnProxyServer: true,\n\t\t\t});\n\t\t\texpect(bridge.createUser.calledWith('username', 'name', 'localDomain')).to.be.true;\n\t\t\texpect(userAdapter.createFederatedUser.calledWith(inviter)).to.be.true;\n\t\t});\n\n\t\tit('should throw an error if the inviter does not exists', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(undefined);\n\t\t\tuserAdapter.getInternalUserById.resolves({ username: 'username', name: 'name' } as any);\n\n\t\t\tawait expect(\n\t\t\t\tservice.onDirectMessageRoomCreation({ invitees, internalInviterId: 'internalInviterId', internalRoomId: 'internalRoomId' } as any),\n\t\t\t).to.be.rejectedWith('User with internalId internalInviterId not found');\n\t\t});\n\n\t\tit('should create the external room with all (the external) the invitees, the inviter is from the same homeserver and at least one invitee is external', async () => {\n\t\t\tbridge.extractHomeserverOrigin.onCall(0).returns('matrix.com');\n\t\t\tbridge.extractHomeserverOrigin.returns('localDomain');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(undefined);\n\t\t\tbridge.createDirectMessageRoom.resolves('externalRoomId');\n\n\t\t\tawait service.onDirectMessageRoomCreation({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t} as any);\n\n\t\t\texpect(\n\t\t\t\tbridge.createDirectMessageRoom.calledWith(\n\t\t\t\t\tuser.getExternalId(),\n\t\t\t\t\tinvitees.map((invitee) => invitee.rawInviteeId),\n\t\t\t\t),\n\t\t\t).to.be.true;\n\t\t\texpect(roomAdapter.updateFederatedRoomByInternalRoomId.calledWith('internalRoomId', 'externalRoomId')).to.be.true;\n\t\t});\n\n\t\tit('should automatically join all the invitees who are original from the same homeserver', async () => {\n\t\t\tbridge.extractHomeserverOrigin.onCall(0).returns('matrix.com');\n\t\t\tbridge.extractHomeserverOrigin.returns('localDomain');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(undefined);\n\t\t\tbridge.createDirectMessageRoom.resolves('externalRoomId');\n\n\t\t\tawait service.onDirectMessageRoomCreation({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t} as any);\n\n\t\t\tinvitees.forEach((invitee) => expect(bridge.joinRoom.calledWith('externalRoomId', invitee.rawInviteeId)).to.be.true);\n\t\t});\n\n\t\tit('should NOT create the external room with any invitee when all of them are local only and the inviter is from the same homeserver', async () => {\n\t\t\tbridge.extractHomeserverOrigin.returns('localDomain');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(undefined);\n\t\t\tbridge.createDirectMessageRoom.resolves('externalRoomId');\n\n\t\t\tawait service.onDirectMessageRoomCreation({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t} as any);\n\n\t\t\texpect(bridge.createDirectMessageRoom.called).to.be.false;\n\t\t\texpect(roomAdapter.updateFederatedRoomByInternalRoomId.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT create the external room with all the invitees when the inviter is NOT from the same homeserver', async () => {\n\t\t\tbridge.extractHomeserverOrigin.returns('externalDomain');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(undefined);\n\t\t\tawait service.onDirectMessageRoomCreation({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t} as any);\n\n\t\t\texpect(bridge.createDirectMessageRoom.called).to.be.false;\n\t\t\texpect(roomAdapter.updateFederatedRoomByInternalRoomId.called).to.be.false;\n\t\t});\n\n\t\tit('should create the invitee user if it does not exists and it is from the same home server, but he is not the only one, there is also an external invitee', async () => {\n\t\t\tbridge.extractHomeserverOrigin.onCall(0).returns('matrix.com');\n\t\t\tbridge.extractHomeserverOrigin.returns('localDomain');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.onCall(0).resolves(undefined);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\tawait service.onDirectMessageRoomCreation({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t} as any);\n\n\t\t\tconst invitee = FederatedUserEE.createInstance(invitees[0].rawInviteeId, {\n\t\t\t\tname: invitees[0].inviteeUsernameOnly,\n\t\t\t\tusername: invitees[0].inviteeUsernameOnly,\n\t\t\t\texistsOnlyOnProxyServer: true,\n\t\t\t});\n\n\t\t\texpect(userAdapter.createFederatedUser.calledWith(invitee)).to.be.true;\n\t\t});\n\n\t\tit('should create the invitee user if it does not exists and it is NOT from the same home server', async () => {\n\t\t\tbridge.extractHomeserverOrigin.returns('externalDomain');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.onCall(0).resolves(undefined);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\tawait service.onDirectMessageRoomCreation({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t} as any);\n\n\t\t\tconst invitee = FederatedUserEE.createInstance(invitees[0].rawInviteeId, {\n\t\t\t\tname: invitees[0].normalizedInviteeId,\n\t\t\t\tusername: invitees[0].normalizedInviteeId,\n\t\t\t\texistsOnlyOnProxyServer: false,\n\t\t\t});\n\n\t\t\texpect(userAdapter.createFederatedUser.calledWith(invitee)).to.be.true;\n\t\t});\n\n\t\tit('should NOT create the invitee user if it already exists', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\tawait service.onDirectMessageRoomCreation({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t} as any);\n\n\t\t\texpect(userAdapter.createFederatedUser.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT create the user on the proxy homeserver if it is NOT from the same homeserver, which means is a external user', async () => {\n\t\t\tbridge.extractHomeserverOrigin.returns('externalDomain');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\tawait service.onDirectMessageRoomCreation({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t} as any);\n\n\t\t\texpect(bridge.createUser.called).to.be.false;\n\t\t});\n\n\t\tit('should throw an error if the invitee is from the same home server but the federated user does not exists and also there is at least one external user', async () => {\n\t\t\tbridge.extractHomeserverOrigin.onCall(0).returns('matrix.com');\n\t\t\tbridge.extractHomeserverOrigin.returns('localDomain');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(undefined);\n\n\t\t\tawait expect(\n\t\t\t\tservice.onDirectMessageRoomCreation({ invitees, internalInviterId: 'internalInviterId', internalRoomId: 'internalRoomId' } as any),\n\t\t\t).to.be.rejectedWith(`User with internalUsername ${invitees[0].inviteeUsernameOnly} not found`);\n\t\t});\n\n\t\tit('should NOT create the user on the proxy homeserver if it is from the same home server AND already exists on it', async () => {\n\t\t\tbridge.extractHomeserverOrigin.returns('localDomain');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\tbridge.getUserProfileInformation.resolves({});\n\t\t\tawait service.onDirectMessageRoomCreation({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t} as any);\n\n\t\t\texpect(bridge.createUser.called).to.be.false;\n\t\t});\n\n\t\tit('should create the user on the proxy home server if it is from the same home server AND does not exists there yet', async () => {\n\t\t\tbridge.extractHomeserverOrigin.returns('externalDomain');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\tbridge.getUserProfileInformation.resolves(undefined);\n\t\t\tawait service.onDirectMessageRoomCreation({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t} as any);\n\n\t\t\tconst invitee = FederatedUserEE.createInstance(invitees[0].rawInviteeId, {\n\t\t\t\tname: invitees[0].normalizedInviteeId,\n\t\t\t\tusername: invitees[0].normalizedInviteeId,\n\t\t\t\texistsOnlyOnProxyServer: false,\n\t\t\t});\n\n\t\t\texpect(bridge.createUser.calledWith(invitees[0].inviteeUsernameOnly, invitee.getUsername(), 'localDomain')).to.be.false;\n\t\t});\n\t});\n\n\tdescribe('#beforeDirectMessageRoomCreation()', () => {\n\t\tit('should create the invitee locally for each external user', async () => {\n\t\t\tbridge.extractHomeserverOrigin.onCall(0).returns('externalDomain');\n\t\t\tbridge.extractHomeserverOrigin.onCall(1).returns('localDomain');\n\t\t\tawait service.beforeDirectMessageRoomCreation({\n\t\t\t\tinvitees: [\n\t\t\t\t\t...invitees,\n\t\t\t\t\t{\n\t\t\t\t\t\tinviteeUsernameOnly: 'marcos.defendiNotToBeInvited',\n\t\t\t\t\t\tnormalizedInviteeId: 'marcos.defendi:matrix.comNotToBeInvited',\n\t\t\t\t\t\trawInviteeId: '@marcos.defendi:matrix.comNotToBeInvited',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t} as any);\n\n\t\t\tconst invitee = FederatedUserEE.createLocalInstanceOnly({\n\t\t\t\tname: invitees[0].normalizedInviteeId,\n\t\t\t\tusername: invitees[0].normalizedInviteeId,\n\t\t\t\texistsOnlyOnProxyServer: false,\n\t\t\t});\n\n\t\t\texpect(userAdapter.createLocalUser.calledOnceWithExactly(invitee)).to.be.true;\n\t\t});\n\t});\n});\n"],"names":["FederatedRoomEE","proxyquire","noCallThru","load","mongodb","ObjectId","toHexString","FederatedUserEE","FederationDirectMessageRoomServiceSender","describe","service","roomAdapter","getFederatedRoomByInternalId","sinon","stub","updateFederatedRoomByInternalRoomId","userAdapter","getFederatedUserByExternalId","getFederatedUserByInternalId","createFederatedUser","getInternalUserById","getFederatedUserByInternalUsername","createLocalUser","getInternalUserByUsername","settingsAdapter","getHomeServerDomain","returns","bridge","getUserProfileInformation","resolves","extractHomeserverOrigin","createUser","createDirectMessageRoom","joinRoom","invitees","inviteeUsernameOnly","normalizedInviteeId","rawInviteeId","beforeEach","afterEach","reset","user","createInstance","name","username","existsOnlyOnProxyServer","room","RoomType","CHANNEL","it","onDirectMessageRoomCreation","internalInviterId","internalRoomId","expect","called","to","be","false","onCall","undefined","inviter","calledWith","true","rejectedWith","getExternalId","map","invitee","forEach","getUsername","beforeDirectMessageRoomCreation","createLocalInstanceOnly","calledOnceWithExactly"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/room/sender/DirectMessageRoomServiceSender.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"66d2a00d235333bf08032db265e3561c90a50612","contentHash":"80225047d7d917ce5751fba5a7b943bdb32bc7661e635b835af5f4b6ee23834d"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/domain/FederatedRoom.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/domain/FederatedRoom.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":31}},"3":{"start":{"line":11,"column":23},"end":{"line":11,"column":96}},"4":{"start":{"line":12,"column":22},"end":{"line":13,"column":1}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7}},"branchMap":{},"s":{"0":2,"1":2,"2":2,"3":2,"4":2},"f":{"0":2},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/domain/FederatedRoom.ts"],"sourcesContent":["import { FederatedRoom } from '../../../../../server/services/federation/domain/FederatedRoom';\n\nexport class FederatedRoomEE extends FederatedRoom {}\n"],"names":["FederatedRoomEE","FederatedRoom"],"mappings":";;;;+BAEaA;;;eAAAA;;;+BAFiB;AAEvB,IAAA,AAAMA,kBAAN,MAAMA,wBAAwBC,4BAAa;AAAE","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/domain/FederatedRoom.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f8db3d0fa15218ede9734d69f12d15922dab46df","contentHash":"da38d36ac7fe4f58e40f1c883d07b6c5e8dfa6f926c6b17dcd96d503b46668c6"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/domain/FederatedRoom.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/domain/FederatedRoom.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":24,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":37}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":42}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":29}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":38}},"8":{"start":{"line":25,"column":15},"end":{"line":25,"column":67}},"9":{"start":{"line":26,"column":17},"end":{"line":26,"column":35}},"10":{"start":{"line":27,"column":31},"end":{"line":29,"column":1}},"11":{"start":{"line":28,"column":4},"end":{"line":28,"column":46}},"12":{"start":{"line":30,"column":28},"end":{"line":117,"column":1}},"13":{"start":{"line":32,"column":8},"end":{"line":32,"column":52}},"14":{"start":{"line":35,"column":8},"end":{"line":35,"column":31}},"15":{"start":{"line":38,"column":8},"end":{"line":38,"column":40}},"16":{"start":{"line":41,"column":8},"end":{"line":41,"column":31}},"17":{"start":{"line":44,"column":8},"end":{"line":44,"column":44}},"18":{"start":{"line":47,"column":8},"end":{"line":47,"column":43}},"19":{"start":{"line":50,"column":8},"end":{"line":50,"column":44}},"20":{"start":{"line":53,"column":8},"end":{"line":53,"column":77}},"21":{"start":{"line":56,"column":8},"end":{"line":59,"column":11}},"22":{"start":{"line":63,"column":8},"end":{"line":63,"column":165}},"23":{"start":{"line":67,"column":8},"end":{"line":67,"column":173}},"24":{"start":{"line":71,"column":8},"end":{"line":71,"column":160}},"25":{"start":{"line":74,"column":8},"end":{"line":76,"column":9}},"26":{"start":{"line":75,"column":12},"end":{"line":75,"column":80}},"27":{"start":{"line":77,"column":8},"end":{"line":77,"column":40}},"28":{"start":{"line":80,"column":8},"end":{"line":82,"column":9}},"29":{"start":{"line":81,"column":12},"end":{"line":81,"column":80}},"30":{"start":{"line":83,"column":8},"end":{"line":83,"column":51}},"31":{"start":{"line":87,"column":8},"end":{"line":87,"column":196}},"32":{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},"33":{"start":{"line":91,"column":12},"end":{"line":91,"column":80}},"34":{"start":{"line":93,"column":8},"end":{"line":93,"column":43}},"35":{"start":{"line":96,"column":8},"end":{"line":98,"column":9}},"36":{"start":{"line":97,"column":12},"end":{"line":97,"column":81}},"37":{"start":{"line":99,"column":8},"end":{"line":99,"column":45}},"38":{"start":{"line":103,"column":8},"end":{"line":103,"column":197}},"39":{"start":{"line":107,"column":8},"end":{"line":107,"column":198}},"40":{"start":{"line":110,"column":8},"end":{"line":110,"column":54}},"41":{"start":{"line":113,"column":8},"end":{"line":113,"column":37}},"42":{"start":{"line":114,"column":8},"end":{"line":114,"column":51}},"43":{"start":{"line":115,"column":8},"end":{"line":115,"column":89}},"44":{"start":{"line":118,"column":20},"end":{"line":152,"column":1}},"45":{"start":{"line":120,"column":8},"end":{"line":122,"column":9}},"46":{"start":{"line":121,"column":12},"end":{"line":121,"column":69}},"47":{"start":{"line":123,"column":25},"end":{"line":123,"column":97}},"48":{"start":{"line":124,"column":8},"end":{"line":132,"column":11}},"49":{"start":{"line":135,"column":8},"end":{"line":137,"column":9}},"50":{"start":{"line":136,"column":12},"end":{"line":136,"column":69}},"51":{"start":{"line":138,"column":8},"end":{"line":141,"column":11}},"52":{"start":{"line":144,"column":8},"end":{"line":144,"column":21}},"53":{"start":{"line":147,"column":8},"end":{"line":150,"column":11}},"54":{"start":{"line":153,"column":33},"end":{"line":200,"column":1}},"55":{"start":{"line":155,"column":8},"end":{"line":162,"column":11}},"56":{"start":{"line":165,"column":8},"end":{"line":169,"column":11}},"57":{"start":{"line":172,"column":8},"end":{"line":172,"column":82}},"58":{"start":{"line":172,"column":40},"end":{"line":172,"column":64}},"59":{"start":{"line":175,"column":8},"end":{"line":175,"column":28}},"60":{"start":{"line":178,"column":8},"end":{"line":178,"column":34}},"61":{"start":{"line":181,"column":8},"end":{"line":181,"column":20}},"62":{"start":{"line":185,"column":8},"end":{"line":187,"column":9}},"63":{"start":{"line":186,"column":12},"end":{"line":186,"column":25}},"64":{"start":{"line":188,"column":8},"end":{"line":190,"column":9}},"65":{"start":{"line":189,"column":12},"end":{"line":189,"column":25}},"66":{"start":{"line":191,"column":8},"end":{"line":191,"column":86}},"67":{"start":{"line":194,"column":8},"end":{"line":197,"column":11}},"68":{"start":{"line":198,"column":8},"end":{"line":198,"column":31}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":27},"end":{"line":12,"column":28}},"loc":{"start":{"line":12,"column":38},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":32},"end":{"line":15,"column":33}},"loc":{"start":{"line":15,"column":43},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":19},"end":{"line":18,"column":20}},"loc":{"start":{"line":18,"column":30},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":28},"end":{"line":21,"column":29}},"loc":{"start":{"line":21,"column":39},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":27,"column":31},"end":{"line":27,"column":32}},"loc":{"start":{"line":27,"column":66},"end":{"line":29,"column":1}},"line":27},"6":{"name":"(anonymous_6)","decl":{"start":{"line":31,"column":4},"end":{"line":31,"column":5}},"loc":{"start":{"line":31,"column":55},"end":{"line":33,"column":5}},"line":31},"7":{"name":"(anonymous_7)","decl":{"start":{"line":34,"column":4},"end":{"line":34,"column":5}},"loc":{"start":{"line":34,"column":20},"end":{"line":36,"column":5}},"line":34},"8":{"name":"(anonymous_8)","decl":{"start":{"line":37,"column":4},"end":{"line":37,"column":5}},"loc":{"start":{"line":37,"column":18},"end":{"line":39,"column":5}},"line":37},"9":{"name":"(anonymous_9)","decl":{"start":{"line":40,"column":4},"end":{"line":40,"column":5}},"loc":{"start":{"line":40,"column":20},"end":{"line":42,"column":5}},"line":40},"10":{"name":"(anonymous_10)","decl":{"start":{"line":43,"column":4},"end":{"line":43,"column":5}},"loc":{"start":{"line":43,"column":21},"end":{"line":45,"column":5}},"line":43},"11":{"name":"(anonymous_11)","decl":{"start":{"line":46,"column":4},"end":{"line":46,"column":5}},"loc":{"start":{"line":46,"column":14},"end":{"line":48,"column":5}},"line":46},"12":{"name":"(anonymous_12)","decl":{"start":{"line":49,"column":4},"end":{"line":49,"column":5}},"loc":{"start":{"line":49,"column":15},"end":{"line":51,"column":5}},"line":49},"13":{"name":"(anonymous_13)","decl":{"start":{"line":52,"column":4},"end":{"line":52,"column":5}},"loc":{"start":{"line":52,"column":79},"end":{"line":54,"column":5}},"line":52},"14":{"name":"(anonymous_14)","decl":{"start":{"line":55,"column":4},"end":{"line":55,"column":5}},"loc":{"start":{"line":55,"column":27},"end":{"line":60,"column":5}},"line":55},"15":{"name":"(anonymous_15)","decl":{"start":{"line":61,"column":4},"end":{"line":61,"column":5}},"loc":{"start":{"line":61,"column":25},"end":{"line":64,"column":5}},"line":61},"16":{"name":"(anonymous_16)","decl":{"start":{"line":65,"column":4},"end":{"line":65,"column":5}},"loc":{"start":{"line":65,"column":25},"end":{"line":68,"column":5}},"line":65},"17":{"name":"(anonymous_17)","decl":{"start":{"line":69,"column":4},"end":{"line":69,"column":5}},"loc":{"start":{"line":69,"column":19},"end":{"line":72,"column":5}},"line":69},"18":{"name":"(anonymous_18)","decl":{"start":{"line":73,"column":4},"end":{"line":73,"column":5}},"loc":{"start":{"line":73,"column":25},"end":{"line":78,"column":5}},"line":73},"19":{"name":"(anonymous_19)","decl":{"start":{"line":79,"column":4},"end":{"line":79,"column":5}},"loc":{"start":{"line":79,"column":39},"end":{"line":84,"column":5}},"line":79},"20":{"name":"(anonymous_20)","decl":{"start":{"line":85,"column":4},"end":{"line":85,"column":5}},"loc":{"start":{"line":85,"column":36},"end":{"line":88,"column":5}},"line":85},"21":{"name":"(anonymous_21)","decl":{"start":{"line":89,"column":4},"end":{"line":89,"column":5}},"loc":{"start":{"line":89,"column":25},"end":{"line":94,"column":5}},"line":89},"22":{"name":"(anonymous_22)","decl":{"start":{"line":95,"column":4},"end":{"line":95,"column":5}},"loc":{"start":{"line":95,"column":27},"end":{"line":100,"column":5}},"line":95},"23":{"name":"(anonymous_23)","decl":{"start":{"line":101,"column":4},"end":{"line":101,"column":5}},"loc":{"start":{"line":101,"column":43},"end":{"line":104,"column":5}},"line":101},"24":{"name":"(anonymous_24)","decl":{"start":{"line":105,"column":4},"end":{"line":105,"column":5}},"loc":{"start":{"line":105,"column":38},"end":{"line":108,"column":5}},"line":105},"25":{"name":"(anonymous_25)","decl":{"start":{"line":109,"column":4},"end":{"line":109,"column":5}},"loc":{"start":{"line":109,"column":64},"end":{"line":111,"column":5}},"line":109},"26":{"name":"(anonymous_26)","decl":{"start":{"line":112,"column":4},"end":{"line":112,"column":5}},"loc":{"start":{"line":112,"column":50},"end":{"line":116,"column":5}},"line":112},"27":{"name":"(anonymous_27)","decl":{"start":{"line":119,"column":4},"end":{"line":119,"column":5}},"loc":{"start":{"line":119,"column":94},"end":{"line":133,"column":5}},"line":119},"28":{"name":"(anonymous_28)","decl":{"start":{"line":134,"column":4},"end":{"line":134,"column":5}},"loc":{"start":{"line":134,"column":70},"end":{"line":142,"column":5}},"line":134},"29":{"name":"(anonymous_29)","decl":{"start":{"line":143,"column":4},"end":{"line":143,"column":5}},"loc":{"start":{"line":143,"column":22},"end":{"line":145,"column":5}},"line":143},"30":{"name":"(anonymous_30)","decl":{"start":{"line":146,"column":4},"end":{"line":146,"column":5}},"loc":{"start":{"line":146,"column":50},"end":{"line":151,"column":5}},"line":146},"31":{"name":"(anonymous_31)","decl":{"start":{"line":154,"column":4},"end":{"line":154,"column":5}},"loc":{"start":{"line":154,"column":56},"end":{"line":163,"column":5}},"line":154},"32":{"name":"(anonymous_32)","decl":{"start":{"line":164,"column":4},"end":{"line":164,"column":5}},"loc":{"start":{"line":164,"column":79},"end":{"line":170,"column":5}},"line":164},"33":{"name":"(anonymous_33)","decl":{"start":{"line":171,"column":4},"end":{"line":171,"column":5}},"loc":{"start":{"line":171,"column":26},"end":{"line":173,"column":5}},"line":171},"34":{"name":"(anonymous_34)","decl":{"start":{"line":172,"column":32},"end":{"line":172,"column":33}},"loc":{"start":{"line":172,"column":40},"end":{"line":172,"column":64}},"line":172},"35":{"name":"(anonymous_35)","decl":{"start":{"line":174,"column":4},"end":{"line":174,"column":5}},"loc":{"start":{"line":174,"column":17},"end":{"line":176,"column":5}},"line":174},"36":{"name":"(anonymous_36)","decl":{"start":{"line":177,"column":4},"end":{"line":177,"column":5}},"loc":{"start":{"line":177,"column":22},"end":{"line":179,"column":5}},"line":177},"37":{"name":"(anonymous_37)","decl":{"start":{"line":180,"column":4},"end":{"line":180,"column":5}},"loc":{"start":{"line":180,"column":22},"end":{"line":182,"column":5}},"line":180},"38":{"name":"(anonymous_38)","decl":{"start":{"line":183,"column":4},"end":{"line":183,"column":5}},"loc":{"start":{"line":183,"column":39},"end":{"line":192,"column":5}},"line":183},"39":{"name":"(anonymous_39)","decl":{"start":{"line":193,"column":4},"end":{"line":193,"column":5}},"loc":{"start":{"line":193,"column":59},"end":{"line":199,"column":5}},"line":193}},"branchMap":{"0":{"loc":{"start":{"line":63,"column":15},"end":{"line":63,"column":164}},"type":"cond-expr","locations":[{"start":{"line":63,"column":121},"end":{"line":63,"column":127}},{"start":{"line":63,"column":130},"end":{"line":63,"column":164}}],"line":63},"1":{"loc":{"start":{"line":63,"column":15},"end":{"line":63,"column":118}},"type":"binary-expr","locations":[{"start":{"line":63,"column":15},"end":{"line":63,"column":78}},{"start":{"line":63,"column":82},"end":{"line":63,"column":118}}],"line":63},"2":{"loc":{"start":{"line":67,"column":16},"end":{"line":67,"column":160}},"type":"cond-expr","locations":[{"start":{"line":67,"column":122},"end":{"line":67,"column":128}},{"start":{"line":67,"column":131},"end":{"line":67,"column":160}}],"line":67},"3":{"loc":{"start":{"line":67,"column":16},"end":{"line":67,"column":119}},"type":"binary-expr","locations":[{"start":{"line":67,"column":16},"end":{"line":67,"column":79}},{"start":{"line":67,"column":83},"end":{"line":67,"column":119}}],"line":67},"4":{"loc":{"start":{"line":71,"column":15},"end":{"line":71,"column":159}},"type":"cond-expr","locations":[{"start":{"line":71,"column":121},"end":{"line":71,"column":127}},{"start":{"line":71,"column":130},"end":{"line":71,"column":159}}],"line":71},"5":{"loc":{"start":{"line":71,"column":15},"end":{"line":71,"column":118}},"type":"binary-expr","locations":[{"start":{"line":71,"column":15},"end":{"line":71,"column":78}},{"start":{"line":71,"column":82},"end":{"line":71,"column":118}}],"line":71},"6":{"loc":{"start":{"line":74,"column":8},"end":{"line":76,"column":9}},"type":"if","locations":[{"start":{"line":74,"column":8},"end":{"line":76,"column":9}},{"start":{"line":74,"column":8},"end":{"line":76,"column":9}}],"line":74},"7":{"loc":{"start":{"line":80,"column":8},"end":{"line":82,"column":9}},"type":"if","locations":[{"start":{"line":80,"column":8},"end":{"line":82,"column":9}},{"start":{"line":80,"column":8},"end":{"line":82,"column":9}}],"line":80},"8":{"loc":{"start":{"line":87,"column":15},"end":{"line":87,"column":195}},"type":"binary-expr","locations":[{"start":{"line":87,"column":15},"end":{"line":87,"column":168}},{"start":{"line":87,"column":172},"end":{"line":87,"column":195}}],"line":87},"9":{"loc":{"start":{"line":87,"column":16},"end":{"line":87,"column":153}},"type":"cond-expr","locations":[{"start":{"line":87,"column":116},"end":{"line":87,"column":122}},{"start":{"line":87,"column":125},"end":{"line":87,"column":153}}],"line":87},"10":{"loc":{"start":{"line":87,"column":16},"end":{"line":87,"column":113}},"type":"binary-expr","locations":[{"start":{"line":87,"column":16},"end":{"line":87,"column":75}},{"start":{"line":87,"column":79},"end":{"line":87,"column":113}}],"line":87},"11":{"loc":{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},"type":"if","locations":[{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},{"start":{"line":90,"column":8},"end":{"line":92,"column":9}}],"line":90},"12":{"loc":{"start":{"line":96,"column":8},"end":{"line":98,"column":9}},"type":"if","locations":[{"start":{"line":96,"column":8},"end":{"line":98,"column":9}},{"start":{"line":96,"column":8},"end":{"line":98,"column":9}}],"line":96},"13":{"loc":{"start":{"line":103,"column":15},"end":{"line":103,"column":196}},"type":"binary-expr","locations":[{"start":{"line":103,"column":15},"end":{"line":103,"column":169}},{"start":{"line":103,"column":173},"end":{"line":103,"column":196}}],"line":103},"14":{"loc":{"start":{"line":103,"column":16},"end":{"line":103,"column":154}},"type":"cond-expr","locations":[{"start":{"line":103,"column":116},"end":{"line":103,"column":122}},{"start":{"line":103,"column":125},"end":{"line":103,"column":154}}],"line":103},"15":{"loc":{"start":{"line":103,"column":16},"end":{"line":103,"column":113}},"type":"binary-expr","locations":[{"start":{"line":103,"column":16},"end":{"line":103,"column":75}},{"start":{"line":103,"column":79},"end":{"line":103,"column":113}}],"line":103},"16":{"loc":{"start":{"line":107,"column":15},"end":{"line":107,"column":197}},"type":"binary-expr","locations":[{"start":{"line":107,"column":15},"end":{"line":107,"column":170}},{"start":{"line":107,"column":174},"end":{"line":107,"column":197}}],"line":107},"17":{"loc":{"start":{"line":107,"column":16},"end":{"line":107,"column":154}},"type":"cond-expr","locations":[{"start":{"line":107,"column":116},"end":{"line":107,"column":122}},{"start":{"line":107,"column":125},"end":{"line":107,"column":154}}],"line":107},"18":{"loc":{"start":{"line":107,"column":16},"end":{"line":107,"column":113}},"type":"binary-expr","locations":[{"start":{"line":107,"column":16},"end":{"line":107,"column":75}},{"start":{"line":107,"column":79},"end":{"line":107,"column":113}}],"line":107},"19":{"loc":{"start":{"line":115,"column":26},"end":{"line":115,"column":88}},"type":"binary-expr","locations":[{"start":{"line":115,"column":26},"end":{"line":115,"column":47}},{"start":{"line":115,"column":51},"end":{"line":115,"column":88}}],"line":115},"20":{"loc":{"start":{"line":120,"column":8},"end":{"line":122,"column":9}},"type":"if","locations":[{"start":{"line":120,"column":8},"end":{"line":122,"column":9}},{"start":{"line":120,"column":8},"end":{"line":122,"column":9}}],"line":120},"21":{"loc":{"start":{"line":123,"column":25},"end":{"line":123,"column":97}},"type":"binary-expr","locations":[{"start":{"line":123,"column":25},"end":{"line":123,"column":36}},{"start":{"line":123,"column":40},"end":{"line":123,"column":97}}],"line":123},"22":{"loc":{"start":{"line":135,"column":8},"end":{"line":137,"column":9}},"type":"if","locations":[{"start":{"line":135,"column":8},"end":{"line":137,"column":9}},{"start":{"line":135,"column":8},"end":{"line":137,"column":9}}],"line":135},"23":{"loc":{"start":{"line":172,"column":40},"end":{"line":172,"column":64}},"type":"binary-expr","locations":[{"start":{"line":172,"column":40},"end":{"line":172,"column":58}},{"start":{"line":172,"column":62},"end":{"line":172,"column":64}}],"line":172},"24":{"loc":{"start":{"line":185,"column":8},"end":{"line":187,"column":9}},"type":"if","locations":[{"start":{"line":185,"column":8},"end":{"line":187,"column":9}},{"start":{"line":185,"column":8},"end":{"line":187,"column":9}}],"line":185},"25":{"loc":{"start":{"line":188,"column":8},"end":{"line":190,"column":9}},"type":"if","locations":[{"start":{"line":188,"column":8},"end":{"line":190,"column":9}},{"start":{"line":188,"column":8},"end":{"line":190,"column":9}}],"line":188},"26":{"loc":{"start":{"line":188,"column":14},"end":{"line":188,"column":156}},"type":"cond-expr","locations":[{"start":{"line":188,"column":114},"end":{"line":188,"column":120}},{"start":{"line":188,"column":123},"end":{"line":188,"column":156}}],"line":188},"27":{"loc":{"start":{"line":188,"column":14},"end":{"line":188,"column":111}},"type":"binary-expr","locations":[{"start":{"line":188,"column":14},"end":{"line":188,"column":73}},{"start":{"line":188,"column":77},"end":{"line":188,"column":111}}],"line":188}},"s":{"0":26,"1":26,"2":104,"3":26,"4":1,"5":10,"6":39,"7":334,"8":26,"9":26,"10":26,"11":354,"12":26,"13":15,"14":91,"15":2,"16":62,"17":4,"18":3,"19":3,"20":19,"21":6,"22":2,"23":4,"24":20,"25":4,"26":1,"27":3,"28":5,"29":1,"30":4,"31":8,"32":6,"33":1,"34":5,"35":5,"36":1,"37":4,"38":11,"39":7,"40":6,"41":115,"42":115,"43":115,"44":26,"45":51,"46":1,"47":50,"48":50,"49":3,"50":1,"51":2,"52":27,"53":52,"54":26,"55":23,"56":8,"57":1,"58":2,"59":6,"60":2,"61":5,"62":6,"63":1,"64":5,"65":1,"66":4,"67":31,"68":31},"f":{"0":26,"1":1,"2":10,"3":39,"4":334,"5":354,"6":15,"7":91,"8":2,"9":62,"10":4,"11":3,"12":3,"13":19,"14":6,"15":2,"16":4,"17":20,"18":4,"19":5,"20":8,"21":6,"22":5,"23":11,"24":7,"25":6,"26":115,"27":51,"28":3,"29":27,"30":52,"31":23,"32":8,"33":1,"34":2,"35":6,"36":2,"37":5,"38":6,"39":31},"b":{"0":[1,1],"1":[2,2],"2":[0,4],"3":[4,4],"4":[1,19],"5":[20,20],"6":[1,3],"7":[1,4],"8":[8,5],"9":[0,8],"10":[8,8],"11":[1,5],"12":[1,4],"13":[11,5],"14":[0,11],"15":[11,11],"16":[7,5],"17":[0,7],"18":[7,7],"19":[115,110],"20":[1,50],"21":[50,14],"22":[1,2],"23":[2,0],"24":[1,5],"25":[1,4],"26":[0,5],"27":[5,5]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/domain/FederatedRoom.ts"],"sourcesContent":["import { RoomType } from '@rocket.chat/apps-engine/definition/rooms';\nimport type { IDirectMessageRoom, IMessage, IRoom } from '@rocket.chat/core-typings';\nimport { ObjectId } from 'mongodb'; // This should not be in the domain layer, but its a known \"problem\"\n\nimport type { FederatedUser } from './FederatedUser';\n\nexport const isAnInternalIdentifier = (fromOriginName: string, localOriginName: string): boolean => {\n\treturn fromOriginName === localOriginName;\n};\n\nexport abstract class AbstractFederatedRoom {\n\tprotected externalId: string;\n\n\tprotected internalId: string;\n\n\tprotected internalReference: Partial<IRoom>;\n\n\tprotected constructor({ externalId, internalReference }: { externalId: string; internalReference: Partial<IRoom> }) {\n\t\tthis.externalId = externalId;\n\t\tthis.internalReference = internalReference;\n\t\tthis.internalId = internalReference._id || new ObjectId().toHexString();\n\t}\n\n\tprotected static generateTemporaryName(normalizedExternalId: string): string {\n\t\treturn `Federation-${normalizedExternalId}`;\n\t}\n\n\tpublic abstract isDirectMessage(): boolean;\n\n\tpublic getExternalId(): string {\n\t\treturn this.externalId;\n\t}\n\n\tpublic getRoomType(): RoomType {\n\t\treturn this.internalReference.t as RoomType;\n\t}\n\n\tpublic getInternalId(): string {\n\t\treturn this.internalId;\n\t}\n\n\tpublic getDisplayName(): string | undefined {\n\t\treturn this.internalReference.fname;\n\t}\n\n\tpublic getName(): string | undefined {\n\t\treturn this.internalReference.name;\n\t}\n\n\tpublic getTopic(): string | undefined {\n\t\treturn this.internalReference.topic;\n\t}\n\n\tpublic static isOriginalFromTheProxyServer(fromOriginName: string, proxyServerOriginName: string): boolean {\n\t\treturn isAnInternalIdentifier(fromOriginName, proxyServerOriginName);\n\t}\n\n\tpublic getInternalReference(): Readonly<Partial<IRoom>> {\n\t\treturn Object.freeze({\n\t\t\t...this.internalReference,\n\t\t\t_id: this.internalId,\n\t\t});\n\t}\n\n\tpublic getCreatorUsername(): string | undefined {\n\t\treturn this.internalReference.u?.username;\n\t}\n\n\tpublic isTheCreator(userId: string): boolean {\n\t\treturn this.internalReference.u?._id === userId;\n\t}\n\n\tpublic getCreatorId(): string | undefined {\n\t\treturn this.internalReference.u?._id;\n\t}\n\n\tpublic changeRoomType(type: RoomType): void {\n\t\tif (this.isDirectMessage()) {\n\t\t\tthrow new Error('Its not possible to change a direct message type');\n\t\t}\n\t\tthis.internalReference.t = type;\n\t}\n\n\tpublic changeDisplayRoomName(displayName: string): void {\n\t\tif (this.isDirectMessage()) {\n\t\t\tthrow new Error('Its not possible to change a direct message name');\n\t\t}\n\t\tthis.internalReference.fname = displayName;\n\t}\n\n\tpublic shouldUpdateRoomName(aRoomName: string): boolean {\n\t\treturn this.internalReference?.name !== aRoomName && !this.isDirectMessage();\n\t}\n\n\tpublic changeRoomName(name: string): void {\n\t\tif (this.isDirectMessage()) {\n\t\t\tthrow new Error('Its not possible to change a direct message name');\n\t\t}\n\t\tthis.internalReference.name = name;\n\t}\n\n\tpublic changeRoomTopic(topic: string): void {\n\t\tif (this.isDirectMessage()) {\n\t\t\tthrow new Error('Its not possible to change a direct message topic');\n\t\t}\n\t\tthis.internalReference.topic = topic;\n\t}\n\n\tpublic shouldUpdateDisplayRoomName(aRoomName: string): boolean {\n\t\treturn this.internalReference?.fname !== aRoomName && !this.isDirectMessage();\n\t}\n\n\tpublic shouldUpdateRoomTopic(aRoomTopic: string): boolean {\n\t\treturn this.internalReference?.topic !== aRoomTopic && !this.isDirectMessage();\n\t}\n\n\tpublic static shouldUpdateMessage(newMessageText: string, originalMessage: IMessage): boolean {\n\t\treturn originalMessage.msg !== newMessageText;\n\t}\n}\n\nexport class FederatedRoom extends AbstractFederatedRoom {\n\tprotected constructor({ externalId, internalReference }: { externalId: string; internalReference: Partial<IRoom> }) {\n\t\tsuper({ externalId, internalReference });\n\t}\n\n\tpublic static createInstance(\n\t\texternalId: string,\n\t\tnormalizedExternalId: string,\n\t\tcreator: FederatedUser,\n\t\ttype: RoomType,\n\t\tdisplayName?: string,\n\t\tname?: string,\n\t): FederatedRoom {\n\t\tif (type === RoomType.DIRECT_MESSAGE) {\n\t\t\tthrow new Error('For DMs please use the specific class');\n\t\t}\n\t\tconst roomName = displayName || FederatedRoom.generateTemporaryName(normalizedExternalId);\n\t\treturn new FederatedRoom({\n\t\t\texternalId,\n\t\t\tinternalReference: {\n\t\t\t\tt: type,\n\t\t\t\tfname: roomName,\n\t\t\t\tname,\n\t\t\t\tu: creator.getInternalReference(),\n\t\t\t},\n\t\t});\n\t}\n\n\tpublic static createWithInternalReference(externalId: string, internalReference: IRoom): FederatedRoom {\n\t\tif (internalReference.t === RoomType.DIRECT_MESSAGE) {\n\t\t\tthrow new Error('For DMs please use the specific class');\n\t\t}\n\t\treturn new FederatedRoom({\n\t\t\texternalId,\n\t\t\tinternalReference,\n\t\t});\n\t}\n\n\tpublic isDirectMessage(): boolean {\n\t\treturn false;\n\t}\n}\n\nexport class DirectMessageFederatedRoom extends AbstractFederatedRoom {\n\tpublic members: FederatedUser[];\n\n\tprotected constructor({\n\t\texternalId,\n\t\tinternalReference,\n\t\tmembers,\n\t}: {\n\t\texternalId: string;\n\t\tinternalReference: Partial<IRoom>;\n\t\tmembers: FederatedUser[];\n\t}) {\n\t\tsuper({ externalId, internalReference });\n\t\tthis.members = members;\n\t}\n\n\tpublic static createInstance(externalId: string, creator: FederatedUser, members: FederatedUser[]): DirectMessageFederatedRoom {\n\t\treturn new DirectMessageFederatedRoom({\n\t\t\texternalId,\n\t\t\tmembers,\n\t\t\tinternalReference: {\n\t\t\t\tt: RoomType.DIRECT_MESSAGE,\n\t\t\t\tu: creator.getInternalReference(),\n\t\t\t},\n\t\t});\n\t}\n\n\tpublic static createWithInternalReference<T extends IRoom | IDirectMessageRoom>(\n\t\texternalId: string,\n\t\tinternalReference: T,\n\t\tmembers: FederatedUser[],\n\t): DirectMessageFederatedRoom {\n\t\treturn new DirectMessageFederatedRoom({\n\t\t\texternalId,\n\t\t\tinternalReference,\n\t\t\tmembers,\n\t\t});\n\t}\n\n\tpublic getMembersUsernames(): string[] {\n\t\treturn this.members.map((user) => user.getUsername() || '').filter(Boolean);\n\t}\n\n\tpublic getMembers(): FederatedUser[] {\n\t\treturn this.members;\n\t}\n\n\tpublic addMember(member: FederatedUser): void {\n\t\tthis.members.push(member);\n\t}\n\n\tpublic isDirectMessage(): boolean {\n\t\treturn true;\n\t}\n\n\tpublic isUserPartOfTheRoom(federatedUser: FederatedUser): boolean {\n\t\tif (!federatedUser.getUsername()) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!this.internalReference?.usernames) {\n\t\t\treturn false;\n\t\t}\n\t\treturn this.internalReference.usernames.includes(federatedUser.getUsername() as string);\n\t}\n}\n"],"names":["AbstractFederatedRoom","DirectMessageFederatedRoom","FederatedRoom","isAnInternalIdentifier","fromOriginName","localOriginName","generateTemporaryName","normalizedExternalId","getExternalId","externalId","getRoomType","internalReference","t","getInternalId","internalId","getDisplayName","fname","getName","name","getTopic","topic","isOriginalFromTheProxyServer","proxyServerOriginName","getInternalReference","Object","freeze","_id","getCreatorUsername","u","username","isTheCreator","userId","getCreatorId","changeRoomType","type","isDirectMessage","Error","changeDisplayRoomName","displayName","shouldUpdateRoomName","aRoomName","changeRoomName","changeRoomTopic","shouldUpdateDisplayRoomName","shouldUpdateRoomTopic","aRoomTopic","shouldUpdateMessage","newMessageText","originalMessage","msg","ObjectId","toHexString","createInstance","creator","RoomType","DIRECT_MESSAGE","roomName","createWithInternalReference","members","getMembersUsernames","map","user","getUsername","filter","Boolean","getMembers","addMember","member","push","isUserPartOfTheRoom","federatedUser","usernames","includes"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/domain/FederatedRoom.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"300bf13958a867689b73a3421dce708e395bc31c","contentHash":"403a385273254e1c82a90ed89cb64f81076031ea89e46ffc1722aa02292a31ee"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/domain/FederatedUser.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/domain/FederatedUser.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":31}},"3":{"start":{"line":11,"column":23},"end":{"line":11,"column":96}},"4":{"start":{"line":12,"column":22},"end":{"line":13,"column":1}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7}},"branchMap":{},"s":{"0":5,"1":5,"2":154,"3":5,"4":5},"f":{"0":154},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/domain/FederatedUser.ts"],"sourcesContent":["import { FederatedUser } from '../../../../../server/services/federation/domain/FederatedUser';\n\nexport class FederatedUserEE extends FederatedUser {}\n"],"names":["FederatedUserEE","FederatedUser"],"mappings":";;;;+BAEaA;;;eAAAA;;;+BAFiB;AAEvB,IAAA,AAAMA,kBAAN,MAAMA,wBAAwBC,4BAAa;AAAE","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/domain/FederatedUser.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"219f99bd0bd1f6df39ad56cbf7d0b8441c1e27a8","contentHash":"ac24741f3b73e81b326d14dc171a487566a1d7775b203c76210b4d4632822ea9"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/domain/FederatedUser.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/domain/FederatedUser.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":29}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":17},"end":{"line":12,"column":35}},"5":{"start":{"line":13,"column":23},"end":{"line":13,"column":49}},"6":{"start":{"line":14,"column":20},"end":{"line":97,"column":1}},"7":{"start":{"line":16,"column":8},"end":{"line":20,"column":11}},"8":{"start":{"line":23,"column":8},"end":{"line":34,"column":10}},"9":{"start":{"line":37,"column":8},"end":{"line":41,"column":11}},"10":{"start":{"line":44,"column":8},"end":{"line":47,"column":11}},"11":{"start":{"line":50,"column":8},"end":{"line":62,"column":10}},"12":{"start":{"line":66,"column":8},"end":{"line":66,"column":157}},"13":{"start":{"line":70,"column":8},"end":{"line":70,"column":153}},"14":{"start":{"line":73,"column":8},"end":{"line":73,"column":91}},"15":{"start":{"line":76,"column":8},"end":{"line":76,"column":31}},"16":{"start":{"line":79,"column":8},"end":{"line":79,"column":45}},"17":{"start":{"line":83,"column":8},"end":{"line":83,"column":228}},"18":{"start":{"line":86,"column":8},"end":{"line":86,"column":59}},"19":{"start":{"line":89,"column":8},"end":{"line":89,"column":31}},"20":{"start":{"line":92,"column":8},"end":{"line":92,"column":37}},"21":{"start":{"line":93,"column":8},"end":{"line":93,"column":63}},"22":{"start":{"line":94,"column":8},"end":{"line":94,"column":51}},"23":{"start":{"line":95,"column":8},"end":{"line":95,"column":89}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":46},"end":{"line":21,"column":5}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":22,"column":4},"end":{"line":22,"column":5}},"loc":{"start":{"line":22,"column":43},"end":{"line":35,"column":5}},"line":22},"3":{"name":"(anonymous_3)","decl":{"start":{"line":36,"column":4},"end":{"line":36,"column":5}},"loc":{"start":{"line":36,"column":95},"end":{"line":42,"column":5}},"line":36},"4":{"name":"(anonymous_4)","decl":{"start":{"line":43,"column":4},"end":{"line":43,"column":5}},"loc":{"start":{"line":43,"column":27},"end":{"line":48,"column":5}},"line":43},"5":{"name":"(anonymous_5)","decl":{"start":{"line":49,"column":4},"end":{"line":49,"column":5}},"loc":{"start":{"line":49,"column":31},"end":{"line":63,"column":5}},"line":49},"6":{"name":"(anonymous_6)","decl":{"start":{"line":64,"column":4},"end":{"line":64,"column":5}},"loc":{"start":{"line":64,"column":18},"end":{"line":67,"column":5}},"line":64},"7":{"name":"(anonymous_7)","decl":{"start":{"line":68,"column":4},"end":{"line":68,"column":5}},"loc":{"start":{"line":68,"column":14},"end":{"line":71,"column":5}},"line":68},"8":{"name":"(anonymous_8)","decl":{"start":{"line":72,"column":4},"end":{"line":72,"column":5}},"loc":{"start":{"line":72,"column":73},"end":{"line":74,"column":5}},"line":72},"9":{"name":"(anonymous_9)","decl":{"start":{"line":75,"column":4},"end":{"line":75,"column":5}},"loc":{"start":{"line":75,"column":20},"end":{"line":77,"column":5}},"line":75},"10":{"name":"(anonymous_10)","decl":{"start":{"line":78,"column":4},"end":{"line":78,"column":5}},"loc":{"start":{"line":78,"column":15},"end":{"line":80,"column":5}},"line":78},"11":{"name":"(anonymous_11)","decl":{"start":{"line":81,"column":4},"end":{"line":81,"column":5}},"loc":{"start":{"line":81,"column":54},"end":{"line":84,"column":5}},"line":81},"12":{"name":"(anonymous_12)","decl":{"start":{"line":85,"column":4},"end":{"line":85,"column":5}},"loc":{"start":{"line":85,"column":41},"end":{"line":87,"column":5}},"line":85},"13":{"name":"(anonymous_13)","decl":{"start":{"line":88,"column":4},"end":{"line":88,"column":5}},"loc":{"start":{"line":88,"column":20},"end":{"line":90,"column":5}},"line":88},"14":{"name":"(anonymous_14)","decl":{"start":{"line":91,"column":4},"end":{"line":91,"column":5}},"loc":{"start":{"line":91,"column":75},"end":{"line":96,"column":5}},"line":91}},"branchMap":{"0":{"loc":{"start":{"line":52,"column":22},"end":{"line":52,"column":59}},"type":"binary-expr","locations":[{"start":{"line":52,"column":22},"end":{"line":52,"column":53}},{"start":{"line":52,"column":57},"end":{"line":52,"column":59}}],"line":52},"1":{"loc":{"start":{"line":66,"column":15},"end":{"line":66,"column":156}},"type":"cond-expr","locations":[{"start":{"line":66,"column":115},"end":{"line":66,"column":121}},{"start":{"line":66,"column":124},"end":{"line":66,"column":156}}],"line":66},"2":{"loc":{"start":{"line":66,"column":15},"end":{"line":66,"column":112}},"type":"binary-expr","locations":[{"start":{"line":66,"column":15},"end":{"line":66,"column":74}},{"start":{"line":66,"column":78},"end":{"line":66,"column":112}}],"line":66},"3":{"loc":{"start":{"line":70,"column":15},"end":{"line":70,"column":152}},"type":"cond-expr","locations":[{"start":{"line":70,"column":115},"end":{"line":70,"column":121}},{"start":{"line":70,"column":124},"end":{"line":70,"column":152}}],"line":70},"4":{"loc":{"start":{"line":70,"column":15},"end":{"line":70,"column":112}},"type":"binary-expr","locations":[{"start":{"line":70,"column":15},"end":{"line":70,"column":74}},{"start":{"line":70,"column":78},"end":{"line":70,"column":112}}],"line":70},"5":{"loc":{"start":{"line":83,"column":16},"end":{"line":83,"column":202}},"type":"cond-expr","locations":[{"start":{"line":83,"column":149},"end":{"line":83,"column":155}},{"start":{"line":83,"column":158},"end":{"line":83,"column":202}}],"line":83},"6":{"loc":{"start":{"line":83,"column":16},"end":{"line":83,"column":146}},"type":"binary-expr","locations":[{"start":{"line":83,"column":16},"end":{"line":83,"column":97}},{"start":{"line":83,"column":101},"end":{"line":83,"column":146}}],"line":83},"7":{"loc":{"start":{"line":95,"column":26},"end":{"line":95,"column":88}},"type":"binary-expr","locations":[{"start":{"line":95,"column":26},"end":{"line":95,"column":47}},{"start":{"line":95,"column":51},"end":{"line":95,"column":88}}],"line":95}},"s":{"0":17,"1":17,"2":242,"3":17,"4":17,"5":17,"6":17,"7":113,"8":126,"9":33,"10":83,"11":1,"12":27,"13":13,"14":333,"15":224,"16":34,"17":8,"18":10,"19":105,"20":146,"21":146,"22":146,"23":146},"f":{"0":242,"1":113,"2":126,"3":33,"4":83,"5":1,"6":27,"7":13,"8":333,"9":224,"10":34,"11":8,"12":10,"13":105,"14":146},"b":{"0":[1,1],"1":[0,27],"2":[27,27],"3":[0,13],"4":[13,13],"5":[2,6],"6":[8,8],"7":[146,130]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/domain/FederatedUser.ts"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { UserStatus } from '@rocket.chat/core-typings';\nimport { ObjectId } from 'mongodb'; // This should not be in the domain layer, but its a known \"problem\"\n\nimport { isAnInternalIdentifier } from './FederatedRoom';\n\ninterface IFederatedUserCreationParams {\n\tname: string;\n\tusername: string;\n\texistsOnlyOnProxyServer: boolean;\n}\n\nexport class FederatedUser {\n\tprotected externalId: string;\n\n\tprotected internalId: string;\n\n\tprotected existsOnlyOnProxyServer: boolean;\n\n\tprotected internalReference: IUser;\n\n\tprotected constructor({\n\t\texternalId,\n\t\tinternalReference,\n\t\texistsOnlyOnProxyServer,\n\t}: {\n\t\texternalId: string;\n\t\tinternalReference: IUser;\n\t\texistsOnlyOnProxyServer: boolean;\n\t}) {\n\t\tthis.externalId = externalId;\n\t\tthis.existsOnlyOnProxyServer = existsOnlyOnProxyServer;\n\t\tthis.internalReference = internalReference;\n\t\tthis.internalId = internalReference._id || new ObjectId().toHexString();\n\t}\n\n\tpublic static createInstance(externalId: string, params: IFederatedUserCreationParams): FederatedUser {\n\t\treturn new FederatedUser({\n\t\t\texternalId,\n\t\t\texistsOnlyOnProxyServer: params.existsOnlyOnProxyServer,\n\t\t\tinternalReference: FederatedUser.createLocalInstanceOnly(params),\n\t\t});\n\t}\n\n\tpublic static createLocalInstanceOnly(params: IFederatedUserCreationParams): IUser {\n\t\treturn {\n\t\t\tusername: params.username,\n\t\t\tname: params.name,\n\t\t\ttype: 'user',\n\t\t\tstatus: UserStatus.ONLINE,\n\t\t\tactive: true,\n\t\t\troles: ['user'],\n\t\t\trequirePasswordChange: false,\n\t\t\tfederated: !params.existsOnlyOnProxyServer,\n\t\t} as unknown as IUser;\n\t}\n\n\tpublic static createWithInternalReference(externalId: string, existsOnlyOnProxyServer: boolean, internalReference: IUser): FederatedUser {\n\t\treturn new FederatedUser({\n\t\t\texternalId,\n\t\t\texistsOnlyOnProxyServer,\n\t\t\tinternalReference,\n\t\t});\n\t}\n\n\tpublic getInternalReference(): Readonly<IUser> {\n\t\treturn Object.freeze({\n\t\t\t...this.internalReference,\n\t\t\t_id: this.internalId,\n\t\t});\n\t}\n\n\tpublic getStorageRepresentation(): Readonly<IUser> {\n\t\treturn {\n\t\t\t_id: this.internalId,\n\t\t\tusername: this.internalReference.username || '',\n\t\t\ttype: this.internalReference.type,\n\t\t\tstatus: this.internalReference.status,\n\t\t\tactive: this.internalReference.active,\n\t\t\troles: this.internalReference.roles,\n\t\t\tname: this.internalReference.name,\n\t\t\trequirePasswordChange: this.internalReference.requirePasswordChange,\n\t\t\tcreatedAt: new Date(),\n\t\t\t_updatedAt: new Date(),\n\t\t\tfederated: this.isRemote(),\n\t\t};\n\t}\n\n\tpublic getUsername(): string | undefined {\n\t\treturn this.internalReference?.username;\n\t}\n\n\tpublic getName(): string | undefined {\n\t\treturn this.internalReference?.name;\n\t}\n\n\tpublic static isOriginalFromTheProxyServer(fromOriginName: string, localOriginName: string): boolean {\n\t\treturn isAnInternalIdentifier(fromOriginName, localOriginName);\n\t}\n\n\tpublic getExternalId(): string {\n\t\treturn this.externalId;\n\t}\n\n\tpublic isRemote(): boolean {\n\t\treturn !this.existsOnlyOnProxyServer;\n\t}\n\n\tpublic shouldUpdateFederationAvatar(federationAvatarUrl: string): boolean {\n\t\treturn this.internalReference.federation?.avatarUrl !== federationAvatarUrl;\n\t}\n\n\tpublic shouldUpdateDisplayName(displayName: string): boolean {\n\t\treturn this.internalReference.name !== displayName;\n\t}\n\n\tpublic getInternalId(): string {\n\t\treturn this.internalId;\n\t}\n}\n"],"names":["FederatedUser","createInstance","externalId","params","existsOnlyOnProxyServer","internalReference","createLocalInstanceOnly","username","name","type","status","UserStatus","ONLINE","active","roles","requirePasswordChange","federated","createWithInternalReference","getInternalReference","Object","freeze","_id","internalId","getStorageRepresentation","createdAt","Date","_updatedAt","isRemote","getUsername","getName","isOriginalFromTheProxyServer","fromOriginName","localOriginName","isAnInternalIdentifier","getExternalId","shouldUpdateFederationAvatar","federationAvatarUrl","federation","avatarUrl","shouldUpdateDisplayName","displayName","getInternalId","ObjectId","toHexString"],"mappings":";;;;+BAYaA;;;eAAAA;;;6BAXc;yBACF;+BAEc;AAQhC,IAAA,AAAMA,gBAAN,MAAMA;IAwBZ,OAAcC,eAAeC,UAAkB,EAAEC,MAAoC,EAAiB;QACrG,OAAO,IAAIH,cAAc;YACxBE;YACAE,yBAAyBD,OAAOC,uBAAuB;YACvDC,mBAAmBL,cAAcM,uBAAuB,CAACH;QAC1D;IACD;IAEA,OAAcG,wBAAwBH,MAAoC,EAAS;QAClF,OAAO;YACNI,UAAUJ,OAAOI,QAAQ;YACzBC,MAAML,OAAOK,IAAI;YACjBC,MAAM;YACNC,QAAQC,uBAAU,CAACC,MAAM;YACzBC,QAAQ;YACRC,OAAO;gBAAC;aAAO;YACfC,uBAAuB;YACvBC,WAAW,CAACb,OAAOC,uBAAuB;QAC3C;IACD;IAEA,OAAca,4BAA4Bf,UAAkB,EAAEE,uBAAgC,EAAEC,iBAAwB,EAAiB;QACxI,OAAO,IAAIL,cAAc;YACxBE;YACAE;YACAC;QACD;IACD;IAEOa,uBAAwC;QAC9C,OAAOC,OAAOC,MAAM,CAAC;YACpB,GAAG,IAAI,CAACf,iBAAiB;YACzBgB,KAAK,IAAI,CAACC,UAAU;QACrB;IACD;IAEOC,2BAA4C;QAClD,OAAO;YACNF,KAAK,IAAI,CAACC,UAAU;YACpBf,UAAU,IAAI,CAACF,iBAAiB,CAACE,QAAQ,IAAI;YAC7CE,MAAM,IAAI,CAACJ,iBAAiB,CAACI,IAAI;YACjCC,QAAQ,IAAI,CAACL,iBAAiB,CAACK,MAAM;YACrCG,QAAQ,IAAI,CAACR,iBAAiB,CAACQ,MAAM;YACrCC,OAAO,IAAI,CAACT,iBAAiB,CAACS,KAAK;YACnCN,MAAM,IAAI,CAACH,iBAAiB,CAACG,IAAI;YACjCO,uBAAuB,IAAI,CAACV,iBAAiB,CAACU,qBAAqB;YACnES,WAAW,IAAIC;YACfC,YAAY,IAAID;YAChBT,WAAW,IAAI,CAACW,QAAQ;QACzB;IACD;IAEOC,cAAkC;YACjC;QAAP,QAAO,0BAAA,IAAI,CAACvB,iBAAiB,cAAtB,8CAAA,wBAAwBE,QAAQ;IACxC;IAEOsB,UAA8B;YAC7B;QAAP,QAAO,0BAAA,IAAI,CAACxB,iBAAiB,cAAtB,8CAAA,wBAAwBG,IAAI;IACpC;IAEA,OAAcsB,6BAA6BC,cAAsB,EAAEC,eAAuB,EAAW;QACpG,OAAOC,IAAAA,qCAAsB,EAACF,gBAAgBC;IAC/C;IAEOE,gBAAwB;QAC9B,OAAO,IAAI,CAAChC,UAAU;IACvB;IAEOyB,WAAoB;QAC1B,OAAO,CAAC,IAAI,CAACvB,uBAAuB;IACrC;IAEO+B,6BAA6BC,mBAA2B,EAAW;YAClE;QAAP,OAAO,EAAA,qCAAA,IAAI,CAAC/B,iBAAiB,CAACgC,UAAU,cAAjC,yDAAA,mCAAmCC,SAAS,MAAKF;IACzD;IAEOG,wBAAwBC,WAAmB,EAAW;QAC5D,OAAO,IAAI,CAACnC,iBAAiB,CAACG,IAAI,KAAKgC;IACxC;IAEOC,gBAAwB;QAC9B,OAAO,IAAI,CAACnB,UAAU;IACvB;IAjGA,YAAsB,EACrBpB,UAAU,EACVG,iBAAiB,EACjBD,uBAAuB,EAKvB,CAAE;QACF,IAAI,CAACF,UAAU,GAAGA;QAClB,IAAI,CAACE,uBAAuB,GAAGA;QAC/B,IAAI,CAACC,iBAAiB,GAAGA;QACzB,IAAI,CAACiB,UAAU,GAAGjB,kBAAkBgB,GAAG,IAAI,IAAIqB,iBAAQ,GAAGC,WAAW;IACtE;AAqFD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/domain/FederatedUser.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3a1e894ceb53236c11355fbb4c455bbb383ea0f8","contentHash":"4511fa1c633dd0464cb1c72a556dd5e2759ffd6ba806dcbd731d09582c5990bc"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/DirectMessageRoomServiceSender.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/DirectMessageRoomServiceSender.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":56}},"3":{"start":{"line":11,"column":23},"end":{"line":11,"column":63}},"4":{"start":{"line":12,"column":48},"end":{"line":12,"column":103}},"5":{"start":{"line":13,"column":47},"end":{"line":98,"column":1}},"6":{"start":{"line":15,"column":101},"end":{"line":15,"column":122}},"7":{"start":{"line":16,"column":39},"end":{"line":16,"column":215}},"8":{"start":{"line":16,"column":64},"end":{"line":16,"column":214}},"9":{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},"10":{"start":{"line":18,"column":12},"end":{"line":18,"column":19}},"11":{"start":{"line":20,"column":8},"end":{"line":25,"column":11}},"12":{"start":{"line":28,"column":34},"end":{"line":28,"column":59}},"13":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"14":{"start":{"line":30,"column":12},"end":{"line":30,"column":19}},"15":{"start":{"line":32,"column":8},"end":{"line":32,"column":52}},"16":{"start":{"line":35,"column":48},"end":{"line":35,"column":65}},"17":{"start":{"line":36,"column":8},"end":{"line":36,"column":97}},"18":{"start":{"line":39,"column":64},"end":{"line":39,"column":85}},"19":{"start":{"line":40,"column":28},"end":{"line":40,"column":106}},"20":{"start":{"line":41,"column":8},"end":{"line":48,"column":9}},"21":{"start":{"line":42,"column":33},"end":{"line":42,"column":102}},"22":{"start":{"line":43,"column":29},"end":{"line":43,"column":71}},"23":{"start":{"line":44,"column":25},"end":{"line":44,"column":63}},"24":{"start":{"line":45,"column":44},"end":{"line":45,"column":48}},"25":{"start":{"line":46,"column":38},"end":{"line":46,"column":113}},"26":{"start":{"line":47,"column":12},"end":{"line":47,"column":117}},"27":{"start":{"line":49,"column":37},"end":{"line":49,"column":130}},"28":{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},"29":{"start":{"line":51,"column":12},"end":{"line":51,"column":83}},"30":{"start":{"line":53,"column":47},"end":{"line":53,"column":212}},"31":{"start":{"line":54,"column":38},"end":{"line":54,"column":113}},"32":{"start":{"line":55,"column":8},"end":{"line":61,"column":17}},"33":{"start":{"line":55,"column":49},"end":{"line":61,"column":14}},"34":{"start":{"line":62,"column":8},"end":{"line":64,"column":9}},"35":{"start":{"line":63,"column":12},"end":{"line":63,"column":19}},"36":{"start":{"line":65,"column":38},"end":{"line":65,"column":83}},"37":{"start":{"line":65,"column":62},"end":{"line":65,"column":82}},"38":{"start":{"line":66,"column":31},"end":{"line":68,"column":10}},"39":{"start":{"line":69,"column":46},"end":{"line":69,"column":223}},"40":{"start":{"line":69,"column":73},"end":{"line":69,"column":222}},"41":{"start":{"line":70,"column":8},"end":{"line":70,"column":132}},"42":{"start":{"line":70,"column":71},"end":{"line":70,"column":129}},"43":{"start":{"line":71,"column":8},"end":{"line":71,"column":107}},"44":{"start":{"line":74,"column":75},"end":{"line":74,"column":94}},"45":{"start":{"line":75,"column":47},"end":{"line":75,"column":188}},"46":{"start":{"line":76,"column":25},"end":{"line":76,"column":99}},"47":{"start":{"line":77,"column":40},"end":{"line":77,"column":70}},"48":{"start":{"line":78,"column":28},"end":{"line":78,"column":103}},"49":{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},"50":{"start":{"line":80,"column":12},"end":{"line":80,"column":106}},"51":{"start":{"line":82,"column":8},"end":{"line":84,"column":9}},"52":{"start":{"line":83,"column":12},"end":{"line":83,"column":19}},"53":{"start":{"line":85,"column":37},"end":{"line":85,"column":138}},"54":{"start":{"line":86,"column":8},"end":{"line":88,"column":9}},"55":{"start":{"line":87,"column":12},"end":{"line":87,"column":91}},"56":{"start":{"line":89,"column":24},"end":{"line":89,"column":105}},"57":{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},"58":{"start":{"line":91,"column":12},"end":{"line":91,"column":19}},"59":{"start":{"line":93,"column":8},"end":{"line":93,"column":182}},"60":{"start":{"line":96,"column":8},"end":{"line":96,"column":311}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":61},"end":{"line":26,"column":5}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":53},"end":{"line":16,"column":54}},"loc":{"start":{"line":16,"column":64},"end":{"line":16,"column":214}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":27,"column":4},"end":{"line":27,"column":5}},"loc":{"start":{"line":27,"column":69},"end":{"line":33,"column":5}},"line":27},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":4},"end":{"line":34,"column":5}},"loc":{"start":{"line":34,"column":66},"end":{"line":37,"column":5}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":38,"column":4},"end":{"line":38,"column":5}},"loc":{"start":{"line":38,"column":79},"end":{"line":72,"column":5}},"line":38},"6":{"name":"(anonymous_6)","decl":{"start":{"line":55,"column":39},"end":{"line":55,"column":40}},"loc":{"start":{"line":55,"column":49},"end":{"line":61,"column":14}},"line":55},"7":{"name":"(anonymous_7)","decl":{"start":{"line":65,"column":51},"end":{"line":65,"column":52}},"loc":{"start":{"line":65,"column":62},"end":{"line":65,"column":82}},"line":65},"8":{"name":"(anonymous_8)","decl":{"start":{"line":69,"column":62},"end":{"line":69,"column":63}},"loc":{"start":{"line":69,"column":73},"end":{"line":69,"column":222}},"line":69},"9":{"name":"(anonymous_9)","decl":{"start":{"line":70,"column":60},"end":{"line":70,"column":61}},"loc":{"start":{"line":70,"column":71},"end":{"line":70,"column":129}},"line":70},"10":{"name":"(anonymous_10)","decl":{"start":{"line":73,"column":4},"end":{"line":73,"column":5}},"loc":{"start":{"line":73,"column":62},"end":{"line":94,"column":5}},"line":73},"11":{"name":"(anonymous_11)","decl":{"start":{"line":95,"column":4},"end":{"line":95,"column":5}},"loc":{"start":{"line":95,"column":111},"end":{"line":97,"column":5}},"line":95}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},"type":"if","locations":[{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},{"start":{"line":17,"column":8},"end":{"line":19,"column":9}}],"line":17},"1":{"loc":{"start":{"line":17,"column":12},"end":{"line":17,"column":99}},"type":"binary-expr","locations":[{"start":{"line":17,"column":12},"end":{"line":17,"column":33}},{"start":{"line":17,"column":37},"end":{"line":17,"column":72}},{"start":{"line":17,"column":76},"end":{"line":17,"column":99}}],"line":17},"2":{"loc":{"start":{"line":28,"column":16},"end":{"line":28,"column":29}},"type":"default-arg","locations":[{"start":{"line":28,"column":27},"end":{"line":28,"column":29}}],"line":28},"3":{"loc":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"type":"if","locations":[{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},{"start":{"line":29,"column":8},"end":{"line":31,"column":9}}],"line":29},"4":{"loc":{"start":{"line":41,"column":8},"end":{"line":48,"column":9}},"type":"if","locations":[{"start":{"line":41,"column":8},"end":{"line":48,"column":9}},{"start":{"line":41,"column":8},"end":{"line":48,"column":9}}],"line":41},"5":{"loc":{"start":{"line":43,"column":29},"end":{"line":43,"column":71}},"type":"binary-expr","locations":[{"start":{"line":43,"column":29},"end":{"line":43,"column":50}},{"start":{"line":43,"column":54},"end":{"line":43,"column":71}}],"line":43},"6":{"loc":{"start":{"line":44,"column":25},"end":{"line":44,"column":63}},"type":"binary-expr","locations":[{"start":{"line":44,"column":25},"end":{"line":44,"column":42}},{"start":{"line":44,"column":46},"end":{"line":44,"column":63}}],"line":44},"7":{"loc":{"start":{"line":49,"column":37},"end":{"line":49,"column":130}},"type":"binary-expr","locations":[{"start":{"line":49,"column":37},"end":{"line":49,"column":48}},{"start":{"line":49,"column":52},"end":{"line":49,"column":130}}],"line":49},"8":{"loc":{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},"type":"if","locations":[{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},{"start":{"line":50,"column":8},"end":{"line":52,"column":9}}],"line":50},"9":{"loc":{"start":{"line":62,"column":8},"end":{"line":64,"column":9}},"type":"if","locations":[{"start":{"line":62,"column":8},"end":{"line":64,"column":9}},{"start":{"line":62,"column":8},"end":{"line":64,"column":9}}],"line":62},"10":{"loc":{"start":{"line":62,"column":12},"end":{"line":62,"column":68}},"type":"binary-expr","locations":[{"start":{"line":62,"column":12},"end":{"line":62,"column":33}},{"start":{"line":62,"column":37},"end":{"line":62,"column":68}}],"line":62},"11":{"loc":{"start":{"line":76,"column":25},"end":{"line":76,"column":99}},"type":"cond-expr","locations":[{"start":{"line":76,"column":58},"end":{"line":76,"column":77}},{"start":{"line":76,"column":80},"end":{"line":76,"column":99}}],"line":76},"12":{"loc":{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},"type":"if","locations":[{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},{"start":{"line":79,"column":8},"end":{"line":81,"column":9}}],"line":79},"13":{"loc":{"start":{"line":82,"column":8},"end":{"line":84,"column":9}},"type":"if","locations":[{"start":{"line":82,"column":8},"end":{"line":84,"column":9}},{"start":{"line":82,"column":8},"end":{"line":84,"column":9}}],"line":82},"14":{"loc":{"start":{"line":85,"column":37},"end":{"line":85,"column":138}},"type":"binary-expr","locations":[{"start":{"line":85,"column":37},"end":{"line":85,"column":48}},{"start":{"line":85,"column":52},"end":{"line":85,"column":138}}],"line":85},"15":{"loc":{"start":{"line":86,"column":8},"end":{"line":88,"column":9}},"type":"if","locations":[{"start":{"line":86,"column":8},"end":{"line":88,"column":9}},{"start":{"line":86,"column":8},"end":{"line":88,"column":9}}],"line":86},"16":{"loc":{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},"type":"if","locations":[{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},{"start":{"line":90,"column":8},"end":{"line":92,"column":9}}],"line":90},"17":{"loc":{"start":{"line":93,"column":58},"end":{"line":93,"column":149}},"type":"binary-expr","locations":[{"start":{"line":93,"column":58},"end":{"line":93,"column":88}},{"start":{"line":93,"column":92},"end":{"line":93,"column":126}},{"start":{"line":93,"column":130},"end":{"line":93,"column":149}}],"line":93}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":14,"7":14,"8":14,"9":14,"10":2,"11":12,"12":1,"13":1,"14":0,"15":1,"16":0,"17":0,"18":12,"19":12,"20":12,"21":2,"22":2,"23":2,"24":2,"25":2,"26":2,"27":12,"28":12,"29":1,"30":11,"31":11,"32":11,"33":11,"34":10,"35":8,"36":2,"37":2,"38":2,"39":2,"40":2,"41":2,"42":2,"43":2,"44":11,"45":11,"46":11,"47":11,"48":11,"49":11,"50":6,"51":11,"52":7,"53":4,"54":4,"55":1,"56":3,"57":3,"58":3,"59":0,"60":15},"f":{"0":1,"1":14,"2":14,"3":1,"4":0,"5":12,"6":11,"7":2,"8":2,"9":2,"10":11,"11":15},"b":{"0":[2,12],"1":[14,14,14],"2":[0],"3":[0,1],"4":[2,10],"5":[2,0],"6":[2,0],"7":[12,2],"8":[1,11],"9":[8,2],"10":[10,3],"11":[4,7],"12":[6,5],"13":[7,4],"14":[4,2],"15":[1,3],"16":[3,0],"17":[0,0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/DirectMessageRoomServiceSender.ts"],"sourcesContent":["import type { RocketChatFileAdapter } from '../../../../../../../server/services/federation/infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatSettingsAdapter } from '../../../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Settings';\nimport { FederatedUserEE } from '../../../domain/FederatedUser';\nimport type { IFederationBridgeEE } from '../../../domain/IFederationBridge';\nimport type { RocketChatRoomAdapterEE } from '../../../infrastructure/rocket-chat/adapters/Room';\nimport type { RocketChatUserAdapterEE } from '../../../infrastructure/rocket-chat/adapters/User';\nimport { AbstractFederationApplicationServiceEE } from '../../AbstractFederationApplicationServiceEE';\nimport type {\n\tFederationBeforeDirectMessageRoomCreationDto,\n\tFederationCreateDirectMessageDto,\n\tFederationOnDirectMessageRoomCreationDto,\n\tFederationRoomInviteUserDto,\n} from './input/RoomSenderDto';\n\nexport class FederationDirectMessageRoomServiceSender extends AbstractFederationApplicationServiceEE {\n\tconstructor(\n\t\tprotected internalRoomAdapter: RocketChatRoomAdapterEE,\n\t\tprotected internalUserAdapter: RocketChatUserAdapterEE,\n\t\tprotected internalFileAdapter: RocketChatFileAdapter,\n\t\tprotected internalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tprotected bridge: IFederationBridgeEE,\n\t) {\n\t\tsuper(bridge, internalUserAdapter, internalFileAdapter, internalSettingsAdapter);\n\t}\n\n\tpublic async onDirectMessageRoomCreation(dmRoomOnCreationInput: FederationOnDirectMessageRoomCreationDto): Promise<void> {\n\t\tconst { internalRoomId, internalInviterId, invitees, inviteComesFromAnExternalHomeServer } = dmRoomOnCreationInput;\n\n\t\tconst atLeastOneExternalUser = invitees.some(\n\t\t\t(invitee) =>\n\t\t\t\t!FederatedUserEE.isOriginalFromTheProxyServer(\n\t\t\t\t\tthis.bridge.extractHomeserverOrigin(invitee.rawInviteeId),\n\t\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t\t),\n\t\t);\n\t\tif (invitees.length === 0 || inviteComesFromAnExternalHomeServer || !atLeastOneExternalUser) {\n\t\t\treturn;\n\t\t}\n\t\tawait this.createExternalDirectMessageRoomAndInviteUsers({\n\t\t\tinternalInviterId,\n\t\t\tinternalRoomId,\n\t\t\tinvitees,\n\t\t\tinviteComesFromAnExternalHomeServer,\n\t\t});\n\t}\n\n\tpublic async beforeDirectMessageRoomCreation(dmBeforeRoomCreationInput: FederationBeforeDirectMessageRoomCreationDto): Promise<void> {\n\t\tconst { invitees = [] } = dmBeforeRoomCreationInput;\n\n\t\tif (invitees.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.createUsersLocallyOnly(invitees);\n\t}\n\n\tpublic async createInternalLocalDirectMessageRoom(dmRoomCreateInput: FederationCreateDirectMessageDto): Promise<void> {\n\t\tconst { internalInviterId, invitees } = dmRoomCreateInput;\n\n\t\tawait this.internalRoomAdapter.createLocalDirectMessageRoom(invitees, internalInviterId);\n\t}\n\n\tprivate async createExternalDirectMessageRoomAndInviteUsers(\n\t\tdmRoomOnCreationInput: FederationOnDirectMessageRoomCreationDto,\n\t): Promise<void> {\n\t\tconst { internalRoomId, internalInviterId, invitees } = dmRoomOnCreationInput;\n\n\t\tconst inviterUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalInviterId);\n\t\tif (!inviterUser) {\n\t\t\tconst internalUser = await this.internalUserAdapter.getInternalUserById(internalInviterId);\n\t\t\tconst username = internalUser.username || internalInviterId;\n\t\t\tconst name = internalUser.name || internalInviterId;\n\t\t\tconst existsOnlyOnProxyServer = true;\n\t\t\tconst externalInviterId = await this.bridge.createUser(username, name, this.internalHomeServerDomain);\n\n\t\t\tawait this.createFederatedUserInternallyOnly(externalInviterId, username, existsOnlyOnProxyServer, name);\n\t\t}\n\n\t\tconst federatedInviterUser = inviterUser || (await this.internalUserAdapter.getFederatedUserByInternalId(internalInviterId));\n\t\tif (!federatedInviterUser) {\n\t\t\tthrow new Error(`User with internalId ${internalInviterId} not found`);\n\t\t}\n\n\t\tconst isInviterFromTheSameHomeServer = FederatedUserEE.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(federatedInviterUser.getExternalId()),\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t\tconst internalFederatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\n\t\tawait Promise.all(\n\t\t\tinvitees.map((member) =>\n\t\t\t\tthis.createUserForDirectMessageRoom({\n\t\t\t\t\tinternalInviterId,\n\t\t\t\t\tinternalRoomId,\n\t\t\t\t\tinviteeUsernameOnly: member.inviteeUsernameOnly,\n\t\t\t\t\tnormalizedInviteeId: member.normalizedInviteeId,\n\t\t\t\t\trawInviteeId: member.rawInviteeId,\n\t\t\t\t}),\n\t\t\t),\n\t\t);\n\n\t\tif (internalFederatedRoom || !isInviterFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst allInviteeExternalIds = invitees.map((invitee) => invitee.rawInviteeId);\n\t\tconst externalRoomId = await this.bridge.createDirectMessageRoom(federatedInviterUser.getExternalId(), allInviteeExternalIds, {\n\t\t\tinternalRoomId,\n\t\t});\n\t\tconst inviteesFromTheSameHomeServer = invitees.filter((invitee) =>\n\t\t\tFederatedUserEE.isOriginalFromTheProxyServer(\n\t\t\t\tthis.bridge.extractHomeserverOrigin(invitee.rawInviteeId),\n\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t),\n\t\t);\n\t\tawait Promise.all(inviteesFromTheSameHomeServer.map((invitee) => this.bridge.joinRoom(externalRoomId, invitee.rawInviteeId)));\n\t\tawait this.internalRoomAdapter.updateFederatedRoomByInternalRoomId(internalRoomId, externalRoomId);\n\t}\n\n\tprivate async createUserForDirectMessageRoom(roomInviteUserInput: FederationRoomInviteUserDto): Promise<void> {\n\t\tconst { normalizedInviteeId, inviteeUsernameOnly, rawInviteeId } = roomInviteUserInput;\n\n\t\tconst isInviteeFromTheSameHomeServer = FederatedUserEE.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(rawInviteeId),\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\n\t\tconst username = isInviteeFromTheSameHomeServer ? inviteeUsernameOnly : normalizedInviteeId;\n\t\tconst existsOnlyOnProxyServer = isInviteeFromTheSameHomeServer;\n\t\tconst inviteeUser = await this.internalUserAdapter.getFederatedUserByInternalUsername(username);\n\t\tif (!inviteeUser) {\n\t\t\tawait this.createFederatedUserInternallyOnly(rawInviteeId, username, existsOnlyOnProxyServer);\n\t\t}\n\n\t\tif (!isInviteeFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedInviteeUser = inviteeUser || (await this.internalUserAdapter.getFederatedUserByInternalUsername(inviteeUsernameOnly));\n\t\tif (!federatedInviteeUser) {\n\t\t\tthrow new Error(`User with internalUsername ${inviteeUsernameOnly} not found`);\n\t\t}\n\n\t\tconst profile = await this.bridge.getUserProfileInformation(federatedInviteeUser.getExternalId());\n\t\tif (profile) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.bridge.createUser(\n\t\t\tinviteeUsernameOnly,\n\t\t\tfederatedInviteeUser.getName() || federatedInviteeUser.getUsername() || inviteeUsernameOnly,\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t}\n}\n"],"names":["FederationDirectMessageRoomServiceSender","AbstractFederationApplicationServiceEE","onDirectMessageRoomCreation","dmRoomOnCreationInput","internalRoomId","internalInviterId","invitees","inviteComesFromAnExternalHomeServer","atLeastOneExternalUser","some","invitee","FederatedUserEE","isOriginalFromTheProxyServer","bridge","extractHomeserverOrigin","rawInviteeId","internalHomeServerDomain","length","createExternalDirectMessageRoomAndInviteUsers","beforeDirectMessageRoomCreation","dmBeforeRoomCreationInput","createUsersLocallyOnly","createInternalLocalDirectMessageRoom","dmRoomCreateInput","internalRoomAdapter","createLocalDirectMessageRoom","inviterUser","internalUserAdapter","getFederatedUserByInternalId","internalUser","getInternalUserById","username","name","existsOnlyOnProxyServer","externalInviterId","createUser","createFederatedUserInternallyOnly","federatedInviterUser","Error","isInviterFromTheSameHomeServer","getExternalId","internalFederatedRoom","getFederatedRoomByInternalId","Promise","all","map","member","createUserForDirectMessageRoom","inviteeUsernameOnly","normalizedInviteeId","allInviteeExternalIds","externalRoomId","createDirectMessageRoom","inviteesFromTheSameHomeServer","filter","joinRoom","updateFederatedRoomByInternalRoomId","roomInviteUserInput","isInviteeFromTheSameHomeServer","inviteeUser","getFederatedUserByInternalUsername","federatedInviteeUser","profile","getUserProfileInformation","getName","getUsername","constructor","internalFileAdapter","internalSettingsAdapter"],"mappings":";;;;+BAcaA;;;eAAAA;;;+BAZmB;wDAIuB;AAQhD,IAAA,AAAMA,2CAAN,MAAMA,iDAAiDC,8EAAsC;IAWnG,MAAaC,4BAA4BC,qBAA+D,EAAiB;QACxH,MAAM,EAAEC,cAAc,EAAEC,iBAAiB,EAAEC,QAAQ,EAAEC,mCAAmC,EAAE,GAAGJ;QAE7F,MAAMK,yBAAyBF,SAASG,IAAI,CAC3C,CAACC,UACA,CAACC,8BAAe,CAACC,4BAA4B,CAC5C,IAAI,CAACC,MAAM,CAACC,uBAAuB,CAACJ,QAAQK,YAAY,GACxD,IAAI,CAACC,wBAAwB;QAGhC,IAAIV,SAASW,MAAM,KAAK,KAAKV,uCAAuC,CAACC,wBAAwB;YAC5F;QACD;QACA,MAAM,IAAI,CAACU,6CAA6C,CAAC;YACxDb;YACAD;YACAE;YACAC;QACD;IACD;IAEA,MAAaY,gCAAgCC,yBAAuE,EAAiB;QACpI,MAAM,EAAEd,WAAW,EAAE,EAAE,GAAGc;QAE1B,IAAId,SAASW,MAAM,KAAK,GAAG;YAC1B;QACD;QAEA,MAAM,IAAI,CAACI,sBAAsB,CAACf;IACnC;IAEA,MAAagB,qCAAqCC,iBAAmD,EAAiB;QACrH,MAAM,EAAElB,iBAAiB,EAAEC,QAAQ,EAAE,GAAGiB;QAExC,MAAM,IAAI,CAACC,mBAAmB,CAACC,4BAA4B,CAACnB,UAAUD;IACvE;IAEA,MAAca,8CACbf,qBAA+D,EAC/C;QAChB,MAAM,EAAEC,cAAc,EAAEC,iBAAiB,EAAEC,QAAQ,EAAE,GAAGH;QAExD,MAAMuB,cAAc,MAAM,IAAI,CAACC,mBAAmB,CAACC,4BAA4B,CAACvB;QAChF,IAAI,CAACqB,aAAa;YACjB,MAAMG,eAAe,MAAM,IAAI,CAACF,mBAAmB,CAACG,mBAAmB,CAACzB;YACxE,MAAM0B,WAAWF,aAAaE,QAAQ,IAAI1B;YAC1C,MAAM2B,OAAOH,aAAaG,IAAI,IAAI3B;YAClC,MAAM4B,0BAA0B;YAChC,MAAMC,oBAAoB,MAAM,IAAI,CAACrB,MAAM,CAACsB,UAAU,CAACJ,UAAUC,MAAM,IAAI,CAAChB,wBAAwB;YAEpG,MAAM,IAAI,CAACoB,iCAAiC,CAACF,mBAAmBH,UAAUE,yBAAyBD;QACpG;QAEA,MAAMK,uBAAuBX,eAAgB,MAAM,IAAI,CAACC,mBAAmB,CAACC,4BAA4B,CAACvB;QACzG,IAAI,CAACgC,sBAAsB;YAC1B,MAAM,IAAIC,MAAM,CAAC,qBAAqB,EAAEjC,kBAAkB,UAAU,CAAC;QACtE;QAEA,MAAMkC,iCAAiC5B,8BAAe,CAACC,4BAA4B,CAClF,IAAI,CAACC,MAAM,CAACC,uBAAuB,CAACuB,qBAAqBG,aAAa,KACtE,IAAI,CAACxB,wBAAwB;QAE9B,MAAMyB,wBAAwB,MAAM,IAAI,CAACjB,mBAAmB,CAACkB,4BAA4B,CAACtC;QAE1F,MAAMuC,QAAQC,GAAG,CAChBtC,SAASuC,GAAG,CAAC,CAACC,SACb,IAAI,CAACC,8BAA8B,CAAC;gBACnC1C;gBACAD;gBACA4C,qBAAqBF,OAAOE,mBAAmB;gBAC/CC,qBAAqBH,OAAOG,mBAAmB;gBAC/ClC,cAAc+B,OAAO/B,YAAY;YAClC;QAIF,IAAI0B,yBAAyB,CAACF,gCAAgC;YAC7D;QACD;QAEA,MAAMW,wBAAwB5C,SAASuC,GAAG,CAAC,CAACnC,UAAYA,QAAQK,YAAY;QAC5E,MAAMoC,iBAAiB,MAAM,IAAI,CAACtC,MAAM,CAACuC,uBAAuB,CAACf,qBAAqBG,aAAa,IAAIU,uBAAuB;YAC7H9C;QACD;QACA,MAAMiD,gCAAgC/C,SAASgD,MAAM,CAAC,CAAC5C,UACtDC,8BAAe,CAACC,4BAA4B,CAC3C,IAAI,CAACC,MAAM,CAACC,uBAAuB,CAACJ,QAAQK,YAAY,GACxD,IAAI,CAACC,wBAAwB;QAG/B,MAAM2B,QAAQC,GAAG,CAACS,8BAA8BR,GAAG,CAAC,CAACnC,UAAY,IAAI,CAACG,MAAM,CAAC0C,QAAQ,CAACJ,gBAAgBzC,QAAQK,YAAY;QAC1H,MAAM,IAAI,CAACS,mBAAmB,CAACgC,mCAAmC,CAACpD,gBAAgB+C;IACpF;IAEA,MAAcJ,+BAA+BU,mBAAgD,EAAiB;QAC7G,MAAM,EAAER,mBAAmB,EAAED,mBAAmB,EAAEjC,YAAY,EAAE,GAAG0C;QAEnE,MAAMC,iCAAiC/C,8BAAe,CAACC,4BAA4B,CAClF,IAAI,CAACC,MAAM,CAACC,uBAAuB,CAACC,eACpC,IAAI,CAACC,wBAAwB;QAG9B,MAAMe,WAAW2B,iCAAiCV,sBAAsBC;QACxE,MAAMhB,0BAA0ByB;QAChC,MAAMC,cAAc,MAAM,IAAI,CAAChC,mBAAmB,CAACiC,kCAAkC,CAAC7B;QACtF,IAAI,CAAC4B,aAAa;YACjB,MAAM,IAAI,CAACvB,iCAAiC,CAACrB,cAAcgB,UAAUE;QACtE;QAEA,IAAI,CAACyB,gCAAgC;YACpC;QACD;QAEA,MAAMG,uBAAuBF,eAAgB,MAAM,IAAI,CAAChC,mBAAmB,CAACiC,kCAAkC,CAACZ;QAC/G,IAAI,CAACa,sBAAsB;YAC1B,MAAM,IAAIvB,MAAM,CAAC,2BAA2B,EAAEU,oBAAoB,UAAU,CAAC;QAC9E;QAEA,MAAMc,UAAU,MAAM,IAAI,CAACjD,MAAM,CAACkD,yBAAyB,CAACF,qBAAqBrB,aAAa;QAC9F,IAAIsB,SAAS;YACZ;QACD;QAEA,MAAM,IAAI,CAACjD,MAAM,CAACsB,UAAU,CAC3Ba,qBACAa,qBAAqBG,OAAO,MAAMH,qBAAqBI,WAAW,MAAMjB,qBACxE,IAAI,CAAChC,wBAAwB;IAE/B;IA1IAkD,YACC,AAAU1C,mBAA4C,EACtD,AAAUG,mBAA4C,EACtD,AAAUwC,mBAA0C,EACpD,AAAUC,uBAAkD,EAC5D,AAAUvD,MAA2B,CACpC;QACD,KAAK,CAACA,QAAQc,qBAAqBwC,qBAAqBC,+BAN9C5C,sBAAAA,0BACAG,sBAAAA,0BACAwC,sBAAAA,0BACAC,0BAAAA,8BACAvD,SAAAA;IAGX;AAmID","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/DirectMessageRoomServiceSender.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6bcb16c7bb28f27ab5efdab0a839f165ee1223a5","contentHash":"01335e74219be9091110602ab9757ad6ea9401bab171678cba8cfbe17070c612"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/AbstractFederationApplicationServiceEE.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/AbstractFederationApplicationServiceEE.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":54}},"3":{"start":{"line":11,"column":46},"end":{"line":11,"column":147}},"4":{"start":{"line":12,"column":23},"end":{"line":12,"column":57}},"5":{"start":{"line":13,"column":45},"end":{"line":37,"column":1}},"6":{"start":{"line":15,"column":48},"end":{"line":15,"column":226}},"7":{"start":{"line":15,"column":75},"end":{"line":15,"column":225}},"8":{"start":{"line":16,"column":8},"end":{"line":32,"column":9}},"9":{"start":{"line":17,"column":51},"end":{"line":17,"column":116}},"10":{"start":{"line":18,"column":25},"end":{"line":18,"column":196}},"11":{"start":{"line":19,"column":29},"end":{"line":19,"column":56}},"12":{"start":{"line":20,"column":44},"end":{"line":20,"column":49}},"13":{"start":{"line":21,"column":12},"end":{"line":25,"column":16}},"14":{"start":{"line":26,"column":34},"end":{"line":26,"column":115}},"15":{"start":{"line":27,"column":12},"end":{"line":29,"column":13}},"16":{"start":{"line":28,"column":16},"end":{"line":28,"column":23}},"17":{"start":{"line":30,"column":12},"end":{"line":30,"column":203}},"18":{"start":{"line":31,"column":12},"end":{"line":31,"column":210}},"19":{"start":{"line":35,"column":8},"end":{"line":35,"column":263}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":43},"end":{"line":33,"column":5}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":64},"end":{"line":15,"column":65}},"loc":{"start":{"line":15,"column":75},"end":{"line":15,"column":225}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":34,"column":4},"end":{"line":34,"column":5}},"loc":{"start":{"line":34,"column":90},"end":{"line":36,"column":5}},"line":34}},"branchMap":{"0":{"loc":{"start":{"line":18,"column":25},"end":{"line":18,"column":196}},"type":"binary-expr","locations":[{"start":{"line":18,"column":26},"end":{"line":18,"column":164}},{"start":{"line":18,"column":169},"end":{"line":18,"column":196}}],"line":18},"1":{"loc":{"start":{"line":18,"column":26},"end":{"line":18,"column":164}},"type":"cond-expr","locations":[{"start":{"line":18,"column":113},"end":{"line":18,"column":119}},{"start":{"line":18,"column":122},"end":{"line":18,"column":164}}],"line":18},"2":{"loc":{"start":{"line":18,"column":26},"end":{"line":18,"column":110}},"type":"binary-expr","locations":[{"start":{"line":18,"column":26},"end":{"line":18,"column":65}},{"start":{"line":18,"column":69},"end":{"line":18,"column":110}}],"line":18},"3":{"loc":{"start":{"line":27,"column":12},"end":{"line":29,"column":13}},"type":"if","locations":[{"start":{"line":27,"column":12},"end":{"line":29,"column":13}},{"start":{"line":27,"column":12},"end":{"line":29,"column":13}}],"line":27},"4":{"loc":{"start":{"line":30,"column":65},"end":{"line":30,"column":201}},"type":"cond-expr","locations":[{"start":{"line":30,"column":152},"end":{"line":30,"column":158}},{"start":{"line":30,"column":161},"end":{"line":30,"column":201}}],"line":30},"5":{"loc":{"start":{"line":30,"column":65},"end":{"line":30,"column":149}},"type":"binary-expr","locations":[{"start":{"line":30,"column":65},"end":{"line":30,"column":104}},{"start":{"line":30,"column":108},"end":{"line":30,"column":149}}],"line":30},"6":{"loc":{"start":{"line":31,"column":70},"end":{"line":31,"column":208}},"type":"cond-expr","locations":[{"start":{"line":31,"column":157},"end":{"line":31,"column":163}},{"start":{"line":31,"column":166},"end":{"line":31,"column":208}}],"line":31},"7":{"loc":{"start":{"line":31,"column":70},"end":{"line":31,"column":154}},"type":"binary-expr","locations":[{"start":{"line":31,"column":70},"end":{"line":31,"column":109}},{"start":{"line":31,"column":113},"end":{"line":31,"column":154}}],"line":31}},"s":{"0":3,"1":3,"2":3,"3":3,"4":3,"5":3,"6":11,"7":22,"8":11,"9":11,"10":11,"11":11,"12":11,"13":11,"14":11,"15":11,"16":4,"17":7,"18":7,"19":85},"f":{"0":3,"1":11,"2":22,"3":85},"b":{"0":[11,5],"1":[4,7],"2":[11,11],"3":[4,7],"4":[0,7],"5":[7,7],"6":[0,7],"7":[7,7]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/AbstractFederationApplicationServiceEE.ts"],"sourcesContent":["import { AbstractFederationApplicationService } from '../../../../../server/services/federation/application/AbstractFederationApplicationService';\nimport type { RocketChatFileAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatSettingsAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Settings';\nimport { FederatedUserEE } from '../domain/FederatedUser';\nimport type { IFederationBridgeEE } from '../domain/IFederationBridge';\nimport type { RocketChatUserAdapterEE } from '../infrastructure/rocket-chat/adapters/User';\nimport type { IFederationInviteeDto } from './room/sender/input/RoomSenderDto';\n\nexport abstract class AbstractFederationApplicationServiceEE extends AbstractFederationApplicationService {\n\tconstructor(\n\t\tprotected bridge: IFederationBridgeEE,\n\t\tprotected internalUserAdapter: RocketChatUserAdapterEE,\n\t\tprotected internalFileAdapter: RocketChatFileAdapter,\n\t\tprotected internalSettingsAdapter: RocketChatSettingsAdapter,\n\t) {\n\t\tsuper(bridge, internalUserAdapter, internalFileAdapter, internalSettingsAdapter);\n\t}\n\n\tprotected async createUsersLocallyOnly(invitees: IFederationInviteeDto[]): Promise<void> {\n\t\tconst externalUsersToBeCreatedLocally = invitees.filter(\n\t\t\t(invitee) =>\n\t\t\t\t!FederatedUserEE.isOriginalFromTheProxyServer(\n\t\t\t\t\tthis.bridge.extractHomeserverOrigin(invitee.rawInviteeId),\n\t\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t\t),\n\t\t);\n\n\t\tfor await (const invitee of externalUsersToBeCreatedLocally) {\n\t\t\tconst externalUserProfileInformation = await this.bridge.getUserProfileInformation(invitee.rawInviteeId);\n\n\t\t\tconst name = externalUserProfileInformation?.displayName || invitee.normalizedInviteeId;\n\t\t\tconst username = invitee.normalizedInviteeId;\n\t\t\tconst existsOnlyOnProxyServer = false;\n\n\t\t\tawait this.internalUserAdapter.createLocalUser(\n\t\t\t\tFederatedUserEE.createLocalInstanceOnly({\n\t\t\t\t\tusername,\n\t\t\t\t\tname,\n\t\t\t\t\texistsOnlyOnProxyServer,\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByExternalId(invitee.rawInviteeId);\n\t\t\tif (!federatedUser) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.updateUserAvatarInternally(federatedUser, externalUserProfileInformation?.avatarUrl);\n\t\t\tawait this.updateUserDisplayNameInternally(federatedUser, externalUserProfileInformation?.displayName);\n\t\t}\n\t}\n}\n"],"names":["AbstractFederationApplicationServiceEE","AbstractFederationApplicationService","createUsersLocallyOnly","invitees","externalUsersToBeCreatedLocally","filter","invitee","FederatedUserEE","isOriginalFromTheProxyServer","bridge","extractHomeserverOrigin","rawInviteeId","internalHomeServerDomain","externalUserProfileInformation","getUserProfileInformation","name","displayName","normalizedInviteeId","username","existsOnlyOnProxyServer","internalUserAdapter","createLocalUser","createLocalInstanceOnly","federatedUser","getFederatedUserByExternalId","updateUserAvatarInternally","avatarUrl","updateUserDisplayNameInternally","constructor","internalFileAdapter","internalSettingsAdapter"],"mappings":";;;;+BAQsBA;;;eAAAA;;;sDAR+B;+BAGrB;AAKzB,IAAA,AAAeA,yCAAf,MAAeA,+CAA+CC,0EAAoC;IAUxG,MAAgBC,uBAAuBC,QAAiC,EAAiB;QACxF,MAAMC,kCAAkCD,SAASE,MAAM,CACtD,CAACC,UACA,CAACC,8BAAe,CAACC,4BAA4B,CAC5C,IAAI,CAACC,MAAM,CAACC,uBAAuB,CAACJ,QAAQK,YAAY,GACxD,IAAI,CAACC,wBAAwB;QAIhC,WAAW,MAAMN,WAAWF,gCAAiC;YAC5D,MAAMS,iCAAiC,MAAM,IAAI,CAACJ,MAAM,CAACK,yBAAyB,CAACR,QAAQK,YAAY;YAEvG,MAAMI,OAAOF,CAAAA,2CAAAA,qDAAAA,+BAAgCG,WAAW,KAAIV,QAAQW,mBAAmB;YACvF,MAAMC,WAAWZ,QAAQW,mBAAmB;YAC5C,MAAME,0BAA0B;YAEhC,MAAM,IAAI,CAACC,mBAAmB,CAACC,eAAe,CAC7Cd,8BAAe,CAACe,uBAAuB,CAAC;gBACvCJ;gBACAH;gBACAI;YACD;YAGD,MAAMI,gBAAgB,MAAM,IAAI,CAACH,mBAAmB,CAACI,4BAA4B,CAAClB,QAAQK,YAAY;YACtG,IAAI,CAACY,eAAe;gBACnB;YACD;YACA,MAAM,IAAI,CAACE,0BAA0B,CAACF,eAAeV,2CAAAA,qDAAAA,+BAAgCa,SAAS;YAC9F,MAAM,IAAI,CAACC,+BAA+B,CAACJ,eAAeV,2CAAAA,qDAAAA,+BAAgCG,WAAW;QACtG;IACD;IAxCAY,YACC,AAAUnB,MAA2B,EACrC,AAAUW,mBAA4C,EACtD,AAAUS,mBAA0C,EACpD,AAAUC,uBAAkD,CAC3D;QACD,KAAK,CAACrB,QAAQW,qBAAqBS,qBAAqBC,+BAL9CrB,SAAAA,aACAW,sBAAAA,0BACAS,sBAAAA,0BACAC,0BAAAA;IAGX;AAkCD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/AbstractFederationApplicationServiceEE.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c1b7efb4f6cd3b555e1d2a70dad14a0676d1d03a","contentHash":"3f0a07932f927185b30e3216dc2e990c383288cc12a00e6831613e6973a09048"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/AbstractFederationApplicationService.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/AbstractFederationApplicationService.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":52}},"3":{"start":{"line":11,"column":23},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":43},"end":{"line":99,"column":1}},"5":{"start":{"line":14,"column":29},"end":{"line":14,"column":95}},"6":{"start":{"line":15,"column":47},"end":{"line":15,"column":106}},"7":{"start":{"line":17,"column":8},"end":{"line":26,"column":9}},"8":{"start":{"line":18,"column":12},"end":{"line":18,"column":140}},"9":{"start":{"line":20,"column":25},"end":{"line":20,"column":193}},"10":{"start":{"line":21,"column":12},"end":{"line":25,"column":15}},"11":{"start":{"line":27,"column":8},"end":{"line":27,"column":74}},"12":{"start":{"line":28,"column":29},"end":{"line":28,"column":104}},"13":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"14":{"start":{"line":30,"column":12},"end":{"line":30,"column":19}},"15":{"start":{"line":32,"column":8},"end":{"line":32,"column":198}},"16":{"start":{"line":33,"column":8},"end":{"line":33,"column":205}},"17":{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},"18":{"start":{"line":37,"column":12},"end":{"line":37,"column":19}},"19":{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},"20":{"start":{"line":40,"column":12},"end":{"line":40,"column":19}},"21":{"start":{"line":42,"column":8},"end":{"line":45,"column":9}},"22":{"start":{"line":43,"column":12},"end":{"line":43,"column":152}},"23":{"start":{"line":44,"column":12},"end":{"line":44,"column":108}},"24":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"25":{"start":{"line":49,"column":12},"end":{"line":49,"column":19}},"26":{"start":{"line":51,"column":8},"end":{"line":53,"column":9}},"27":{"start":{"line":52,"column":12},"end":{"line":52,"column":19}},"28":{"start":{"line":54,"column":8},"end":{"line":56,"column":9}},"29":{"start":{"line":55,"column":12},"end":{"line":55,"column":109}},"30":{"start":{"line":59,"column":29},"end":{"line":59,"column":98}},"31":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"32":{"start":{"line":61,"column":12},"end":{"line":61,"column":79}},"33":{"start":{"line":63,"column":21},"end":{"line":63,"column":63}},"34":{"start":{"line":64,"column":34},"end":{"line":64,"column":122}},"35":{"start":{"line":65,"column":40},"end":{"line":65,"column":44}},"36":{"start":{"line":66,"column":8},"end":{"line":66,"column":126}},"37":{"start":{"line":67,"column":8},"end":{"line":67,"column":140}},"38":{"start":{"line":68,"column":8},"end":{"line":68,"column":33}},"39":{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},"40":{"start":{"line":72,"column":12},"end":{"line":72,"column":19}},"41":{"start":{"line":74,"column":23},"end":{"line":74,"column":99}},"42":{"start":{"line":75,"column":8},"end":{"line":77,"column":9}},"43":{"start":{"line":76,"column":12},"end":{"line":76,"column":19}},"44":{"start":{"line":78,"column":33},"end":{"line":78,"column":115}},"45":{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},"46":{"start":{"line":80,"column":12},"end":{"line":80,"column":19}},"47":{"start":{"line":82,"column":32},"end":{"line":85,"column":10}},"48":{"start":{"line":86,"column":8},"end":{"line":88,"column":9}},"49":{"start":{"line":87,"column":12},"end":{"line":87,"column":19}},"50":{"start":{"line":89,"column":8},"end":{"line":89,"column":97}},"51":{"start":{"line":90,"column":8},"end":{"line":90,"column":90}},"52":{"start":{"line":93,"column":8},"end":{"line":93,"column":29}},"53":{"start":{"line":94,"column":8},"end":{"line":94,"column":55}},"54":{"start":{"line":95,"column":8},"end":{"line":95,"column":55}},"55":{"start":{"line":96,"column":8},"end":{"line":96,"column":63}},"56":{"start":{"line":97,"column":8},"end":{"line":97,"column":91}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":4},"end":{"line":13,"column":5}},"loc":{"start":{"line":13,"column":117},"end":{"line":34,"column":5}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":35,"column":4},"end":{"line":35,"column":5}},"loc":{"start":{"line":35,"column":63},"end":{"line":46,"column":5}},"line":35},"3":{"name":"(anonymous_3)","decl":{"start":{"line":47,"column":4},"end":{"line":47,"column":5}},"loc":{"start":{"line":47,"column":70},"end":{"line":57,"column":5}},"line":47},"4":{"name":"(anonymous_4)","decl":{"start":{"line":58,"column":4},"end":{"line":58,"column":5}},"loc":{"start":{"line":58,"column":89},"end":{"line":69,"column":5}},"line":58},"5":{"name":"(anonymous_5)","decl":{"start":{"line":70,"column":4},"end":{"line":70,"column":5}},"loc":{"start":{"line":70,"column":68},"end":{"line":91,"column":5}},"line":70},"6":{"name":"(anonymous_6)","decl":{"start":{"line":92,"column":4},"end":{"line":92,"column":5}},"loc":{"start":{"line":92,"column":90},"end":{"line":98,"column":5}},"line":92}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":70},"end":{"line":13,"column":101}},"type":"default-arg","locations":[{"start":{"line":13,"column":96},"end":{"line":13,"column":101}}],"line":13},"1":{"loc":{"start":{"line":17,"column":8},"end":{"line":26,"column":9}},"type":"if","locations":[{"start":{"line":17,"column":8},"end":{"line":26,"column":9}},{"start":{"line":17,"column":8},"end":{"line":26,"column":9}}],"line":17},"2":{"loc":{"start":{"line":20,"column":25},"end":{"line":20,"column":193}},"type":"binary-expr","locations":[{"start":{"line":20,"column":26},"end":{"line":20,"column":164}},{"start":{"line":20,"column":169},"end":{"line":20,"column":181}},{"start":{"line":20,"column":185},"end":{"line":20,"column":193}}],"line":20},"3":{"loc":{"start":{"line":20,"column":26},"end":{"line":20,"column":164}},"type":"cond-expr","locations":[{"start":{"line":20,"column":113},"end":{"line":20,"column":119}},{"start":{"line":20,"column":122},"end":{"line":20,"column":164}}],"line":20},"4":{"loc":{"start":{"line":20,"column":26},"end":{"line":20,"column":110}},"type":"binary-expr","locations":[{"start":{"line":20,"column":26},"end":{"line":20,"column":65}},{"start":{"line":20,"column":69},"end":{"line":20,"column":110}}],"line":20},"5":{"loc":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"type":"if","locations":[{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},{"start":{"line":29,"column":8},"end":{"line":31,"column":9}}],"line":29},"6":{"loc":{"start":{"line":32,"column":60},"end":{"line":32,"column":196}},"type":"cond-expr","locations":[{"start":{"line":32,"column":147},"end":{"line":32,"column":153}},{"start":{"line":32,"column":156},"end":{"line":32,"column":196}}],"line":32},"7":{"loc":{"start":{"line":32,"column":60},"end":{"line":32,"column":144}},"type":"binary-expr","locations":[{"start":{"line":32,"column":60},"end":{"line":32,"column":99}},{"start":{"line":32,"column":103},"end":{"line":32,"column":144}}],"line":32},"8":{"loc":{"start":{"line":33,"column":65},"end":{"line":33,"column":203}},"type":"cond-expr","locations":[{"start":{"line":33,"column":152},"end":{"line":33,"column":158}},{"start":{"line":33,"column":161},"end":{"line":33,"column":203}}],"line":33},"9":{"loc":{"start":{"line":33,"column":65},"end":{"line":33,"column":149}},"type":"binary-expr","locations":[{"start":{"line":33,"column":65},"end":{"line":33,"column":104}},{"start":{"line":33,"column":108},"end":{"line":33,"column":149}}],"line":33},"10":{"loc":{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},"type":"if","locations":[{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},{"start":{"line":36,"column":8},"end":{"line":38,"column":9}}],"line":36},"11":{"loc":{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},"type":"if","locations":[{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},{"start":{"line":39,"column":8},"end":{"line":41,"column":9}}],"line":39},"12":{"loc":{"start":{"line":42,"column":8},"end":{"line":45,"column":9}},"type":"if","locations":[{"start":{"line":42,"column":8},"end":{"line":45,"column":9}},{"start":{"line":42,"column":8},"end":{"line":45,"column":9}}],"line":42},"13":{"loc":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"type":"if","locations":[{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},{"start":{"line":48,"column":8},"end":{"line":50,"column":9}}],"line":48},"14":{"loc":{"start":{"line":51,"column":8},"end":{"line":53,"column":9}},"type":"if","locations":[{"start":{"line":51,"column":8},"end":{"line":53,"column":9}},{"start":{"line":51,"column":8},"end":{"line":53,"column":9}}],"line":51},"15":{"loc":{"start":{"line":54,"column":8},"end":{"line":56,"column":9}},"type":"if","locations":[{"start":{"line":54,"column":8},"end":{"line":56,"column":9}},{"start":{"line":54,"column":8},"end":{"line":56,"column":9}}],"line":54},"16":{"loc":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"type":"if","locations":[{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},{"start":{"line":60,"column":8},"end":{"line":62,"column":9}}],"line":60},"17":{"loc":{"start":{"line":60,"column":12},"end":{"line":60,"column":113}},"type":"binary-expr","locations":[{"start":{"line":60,"column":12},"end":{"line":60,"column":25}},{"start":{"line":60,"column":29},"end":{"line":60,"column":113}}],"line":60},"18":{"loc":{"start":{"line":60,"column":31},"end":{"line":60,"column":112}},"type":"cond-expr","locations":[{"start":{"line":60,"column":82},"end":{"line":60,"column":88}},{"start":{"line":60,"column":91},"end":{"line":60,"column":112}}],"line":60},"19":{"loc":{"start":{"line":60,"column":31},"end":{"line":60,"column":79}},"type":"binary-expr","locations":[{"start":{"line":60,"column":31},"end":{"line":60,"column":52}},{"start":{"line":60,"column":56},"end":{"line":60,"column":79}}],"line":60},"20":{"loc":{"start":{"line":63,"column":21},"end":{"line":63,"column":63}},"type":"binary-expr","locations":[{"start":{"line":63,"column":21},"end":{"line":63,"column":38}},{"start":{"line":63,"column":42},"end":{"line":63,"column":63}}],"line":63},"21":{"loc":{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},"type":"if","locations":[{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},{"start":{"line":71,"column":8},"end":{"line":73,"column":9}}],"line":71},"22":{"loc":{"start":{"line":75,"column":8},"end":{"line":77,"column":9}},"type":"if","locations":[{"start":{"line":75,"column":8},"end":{"line":77,"column":9}},{"start":{"line":75,"column":8},"end":{"line":77,"column":9}}],"line":75},"23":{"loc":{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},"type":"if","locations":[{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},{"start":{"line":79,"column":8},"end":{"line":81,"column":9}}],"line":79},"24":{"loc":{"start":{"line":79,"column":12},"end":{"line":79,"column":200}},"type":"binary-expr","locations":[{"start":{"line":79,"column":12},"end":{"line":79,"column":104}},{"start":{"line":79,"column":108},"end":{"line":79,"column":200}}],"line":79},"25":{"loc":{"start":{"line":79,"column":14},"end":{"line":79,"column":103}},"type":"cond-expr","locations":[{"start":{"line":79,"column":73},"end":{"line":79,"column":79}},{"start":{"line":79,"column":82},"end":{"line":79,"column":103}}],"line":79},"26":{"loc":{"start":{"line":79,"column":14},"end":{"line":79,"column":70}},"type":"binary-expr","locations":[{"start":{"line":79,"column":14},"end":{"line":79,"column":39}},{"start":{"line":79,"column":43},"end":{"line":79,"column":70}}],"line":79},"27":{"loc":{"start":{"line":79,"column":110},"end":{"line":79,"column":199}},"type":"cond-expr","locations":[{"start":{"line":79,"column":169},"end":{"line":79,"column":175}},{"start":{"line":79,"column":178},"end":{"line":79,"column":199}}],"line":79},"28":{"loc":{"start":{"line":79,"column":110},"end":{"line":79,"column":166}},"type":"binary-expr","locations":[{"start":{"line":79,"column":110},"end":{"line":79,"column":135}},{"start":{"line":79,"column":139},"end":{"line":79,"column":166}}],"line":79},"29":{"loc":{"start":{"line":86,"column":8},"end":{"line":88,"column":9}},"type":"if","locations":[{"start":{"line":86,"column":8},"end":{"line":88,"column":9}},{"start":{"line":86,"column":8},"end":{"line":88,"column":9}}],"line":86}},"s":{"0":8,"1":8,"2":9,"3":8,"4":8,"5":34,"6":34,"7":34,"8":1,"9":33,"10":33,"11":34,"12":34,"13":34,"14":32,"15":2,"16":2,"17":12,"18":5,"19":7,"20":2,"21":5,"22":3,"23":3,"24":13,"25":3,"26":10,"27":2,"28":8,"29":6,"30":9,"31":9,"32":0,"33":9,"34":9,"35":9,"36":9,"37":9,"38":9,"39":14,"40":0,"41":14,"42":14,"43":10,"44":4,"45":4,"46":2,"47":2,"48":2,"49":1,"50":1,"51":1,"52":320,"53":320,"54":320,"55":320,"56":320},"f":{"0":9,"1":34,"2":12,"3":13,"4":9,"5":14,"6":320},"b":{"0":[0],"1":[1,33],"2":[33,33,23],"3":[19,14],"4":[33,33],"5":[32,2],"6":[2,0],"7":[2,2],"8":[2,0],"9":[2,2],"10":[5,7],"11":[2,5],"12":[3,2],"13":[3,10],"14":[2,8],"15":[6,2],"16":[0,9],"17":[9,9],"18":[0,9],"19":[9,9],"20":[9,6],"21":[0,14],"22":[10,4],"23":[2,2],"24":[4,3],"25":[0,4],"26":[4,4],"27":[0,3],"28":[3,3],"29":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/AbstractFederationApplicationService.ts"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\n\nimport { FederatedUser } from '../domain/FederatedUser';\nimport type { IFederationBridge } from '../domain/IFederationBridge';\nimport type { RocketChatFileAdapter } from '../infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatSettingsAdapter } from '../infrastructure/rocket-chat/adapters/Settings';\nimport type { RocketChatUserAdapter } from '../infrastructure/rocket-chat/adapters/User';\n\nexport abstract class AbstractFederationApplicationService {\n\tprotected internalHomeServerDomain: string;\n\n\tconstructor(\n\t\tprotected bridge: IFederationBridge,\n\t\tprotected internalUserAdapter: RocketChatUserAdapter,\n\t\tprotected internalFileAdapter: RocketChatFileAdapter,\n\t\tprotected internalSettingsAdapter: RocketChatSettingsAdapter,\n\t) {\n\t\tthis.internalHomeServerDomain = this.internalSettingsAdapter.getHomeServerDomain();\n\t}\n\n\tprotected async createFederatedUserInternallyOnly(\n\t\texternalUserId: string,\n\t\tusername: string,\n\t\texistsOnlyOnProxyServer = false,\n\t\tprovidedName?: string,\n\t): Promise<void> {\n\t\tconst internalUser = await this.internalUserAdapter.getInternalUserByUsername(username);\n\t\tconst externalUserProfileInformation = await this.bridge.getUserProfileInformation(externalUserId);\n\t\tlet federatedUser;\n\t\tif (internalUser) {\n\t\t\tfederatedUser = FederatedUser.createWithInternalReference(externalUserId, existsOnlyOnProxyServer, internalUser);\n\t\t} else {\n\t\t\tconst name = externalUserProfileInformation?.displayName || providedName || username;\n\t\t\tfederatedUser = FederatedUser.createInstance(externalUserId, {\n\t\t\t\tname,\n\t\t\t\tusername,\n\t\t\t\texistsOnlyOnProxyServer,\n\t\t\t});\n\t\t}\n\t\tawait this.internalUserAdapter.createFederatedUser(federatedUser);\n\t\tconst insertedUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalUserId);\n\t\tif (!insertedUser) {\n\t\t\treturn;\n\t\t}\n\t\tawait this.updateUserAvatarInternally(insertedUser, externalUserProfileInformation?.avatarUrl);\n\t\tawait this.updateUserDisplayNameInternally(insertedUser, externalUserProfileInformation?.displayName);\n\t}\n\n\tprotected async updateUserAvatarInternally(federatedUser: FederatedUser, avatarUrl?: string): Promise<void> {\n\t\tif (!avatarUrl) {\n\t\t\treturn;\n\t\t}\n\t\tif (!federatedUser.isRemote()) {\n\t\t\treturn;\n\t\t}\n\t\tif (federatedUser.shouldUpdateFederationAvatar(avatarUrl)) {\n\t\t\tawait this.internalUserAdapter.setAvatar(\n\t\t\t\tfederatedUser,\n\t\t\t\tawait this.bridge.convertMatrixUrlToHttp(federatedUser.getExternalId(), avatarUrl),\n\t\t\t);\n\t\t\tawait this.internalUserAdapter.updateFederationAvatar(federatedUser.getInternalId(), avatarUrl);\n\t\t}\n\t}\n\n\tprotected async updateUserDisplayNameInternally(federatedUser: FederatedUser, displayName?: string): Promise<void> {\n\t\tif (!displayName) {\n\t\t\treturn;\n\t\t}\n\t\tif (!federatedUser.isRemote()) {\n\t\t\treturn;\n\t\t}\n\t\tif (federatedUser.shouldUpdateDisplayName(displayName)) {\n\t\t\tawait this.internalUserAdapter.updateRealName(federatedUser.getInternalReference(), displayName);\n\t\t}\n\t}\n\n\tprotected async createFederatedUserIncludingHomeserverUsingLocalInformation(internalInviterId: string): Promise<string> {\n\t\tconst internalUser = await this.internalUserAdapter.getInternalUserById(internalInviterId);\n\t\tif (!internalUser || !internalUser?.username) {\n\t\t\tthrow new Error(`Could not find user id for ${internalInviterId}`);\n\t\t}\n\t\tconst name = internalUser.name || internalUser.username;\n\t\tconst externalInviterId = await this.bridge.createUser(internalUser.username, name, this.internalHomeServerDomain);\n\t\tconst existsOnlyOnProxyServer = true;\n\t\tawait this.createFederatedUserInternallyOnly(externalInviterId, internalUser.username, existsOnlyOnProxyServer, name);\n\t\tawait this.updateUserAvatarExternally(\n\t\t\tinternalUser,\n\t\t\t(await this.internalUserAdapter.getFederatedUserByExternalId(externalInviterId)) as FederatedUser,\n\t\t);\n\n\t\treturn externalInviterId;\n\t}\n\n\tprotected async updateUserAvatarExternally(internalUser: IUser, externalInviter: FederatedUser): Promise<void> {\n\t\tif (!internalUser.username) {\n\t\t\treturn;\n\t\t}\n\t\tconst buffer = await this.internalFileAdapter.getBufferForAvatarFile(internalUser.username);\n\t\tif (!buffer) {\n\t\t\treturn;\n\t\t}\n\t\tconst avatarFileRecord = await this.internalFileAdapter.getFileMetadataForAvatarFile(internalUser.username);\n\t\tif (!avatarFileRecord?.type || !avatarFileRecord?.name) {\n\t\t\treturn;\n\t\t}\n\t\tconst externalFileUri = await this.bridge.uploadContent(externalInviter.getExternalId(), buffer, {\n\t\t\ttype: avatarFileRecord.type,\n\t\t\tname: avatarFileRecord.name,\n\t\t});\n\t\tif (!externalFileUri) {\n\t\t\treturn;\n\t\t}\n\t\tawait this.internalUserAdapter.updateFederationAvatar(internalUser._id, externalFileUri);\n\t\tawait this.bridge.setUserAvatar(externalInviter.getExternalId(), externalFileUri);\n\t}\n}\n"],"names":["AbstractFederationApplicationService","createFederatedUserInternallyOnly","externalUserId","username","existsOnlyOnProxyServer","providedName","internalUser","internalUserAdapter","getInternalUserByUsername","externalUserProfileInformation","bridge","getUserProfileInformation","federatedUser","FederatedUser","createWithInternalReference","name","displayName","createInstance","createFederatedUser","insertedUser","getFederatedUserByExternalId","updateUserAvatarInternally","avatarUrl","updateUserDisplayNameInternally","isRemote","shouldUpdateFederationAvatar","setAvatar","convertMatrixUrlToHttp","getExternalId","updateFederationAvatar","getInternalId","shouldUpdateDisplayName","updateRealName","getInternalReference","createFederatedUserIncludingHomeserverUsingLocalInformation","internalInviterId","getInternalUserById","Error","externalInviterId","createUser","internalHomeServerDomain","updateUserAvatarExternally","externalInviter","buffer","internalFileAdapter","getBufferForAvatarFile","avatarFileRecord","getFileMetadataForAvatarFile","type","externalFileUri","uploadContent","_id","setUserAvatar","constructor","internalSettingsAdapter","getHomeServerDomain"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/AbstractFederationApplicationService.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6e6c523ac4b62fdba0ee28a9c1e51a4edc63e59c","contentHash":"9e14a1e2e9e88f824a5d933a39b40f4b79c8f2a40534123e79585aa825848efa"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/room/sender/input/RoomInputDto.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/room/sender/input/RoomInputDto.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":22},"end":{"line":6,"column":135}},"3":{"start":{"line":7,"column":0},"end":{"line":43,"column":3}},"4":{"start":{"line":8,"column":4},"end":{"line":15,"column":7}},"5":{"start":{"line":9,"column":8},"end":{"line":11,"column":11}},"6":{"start":{"line":10,"column":12},"end":{"line":10,"column":108}},"7":{"start":{"line":12,"column":8},"end":{"line":14,"column":11}},"8":{"start":{"line":13,"column":12},"end":{"line":13,"column":119}},"9":{"start":{"line":16,"column":4},"end":{"line":42,"column":7}},"10":{"start":{"line":17,"column":8},"end":{"line":24,"column":11}},"11":{"start":{"line":18,"column":12},"end":{"line":23,"column":71}},"12":{"start":{"line":18,"column":34},"end":{"line":23,"column":18}},"13":{"start":{"line":25,"column":8},"end":{"line":41,"column":11}},"14":{"start":{"line":26,"column":12},"end":{"line":40,"column":15}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":65},"end":{"line":7,"column":66}},"loc":{"start":{"line":7,"column":69},"end":{"line":43,"column":1}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":8,"column":48},"end":{"line":8,"column":49}},"loc":{"start":{"line":8,"column":52},"end":{"line":15,"column":5}},"line":8},"2":{"name":"(anonymous_2)","decl":{"start":{"line":9,"column":110},"end":{"line":9,"column":111}},"loc":{"start":{"line":9,"column":114},"end":{"line":11,"column":9}},"line":9},"3":{"name":"(anonymous_3)","decl":{"start":{"line":12,"column":102},"end":{"line":12,"column":103}},"loc":{"start":{"line":12,"column":106},"end":{"line":14,"column":9}},"line":12},"4":{"name":"(anonymous_4)","decl":{"start":{"line":16,"column":49},"end":{"line":16,"column":50}},"loc":{"start":{"line":16,"column":53},"end":{"line":42,"column":5}},"line":16},"5":{"name":"(anonymous_5)","decl":{"start":{"line":17,"column":112},"end":{"line":17,"column":113}},"loc":{"start":{"line":17,"column":116},"end":{"line":24,"column":9}},"line":17},"6":{"name":"(anonymous_6)","decl":{"start":{"line":18,"column":30},"end":{"line":18,"column":31}},"loc":{"start":{"line":18,"column":34},"end":{"line":23,"column":18}},"line":18},"7":{"name":"(anonymous_7)","decl":{"start":{"line":25,"column":74},"end":{"line":25,"column":75}},"loc":{"start":{"line":25,"column":78},"end":{"line":41,"column":9}},"line":25}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1},"f":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/room/sender/input/RoomInputDto.spec.ts"],"sourcesContent":["import { expect } from 'chai';\n\nimport {\n\tFederationJoinExternalPublicRoomInputDto,\n\tisAValidExternalRoomIdFormat,\n} from '../../../../../../../../../server/local-services/federation/application/room/sender/input/RoomInputDto';\n\ndescribe('FederationEE - Application - InputDto - RoomInputDto', () => {\n\tdescribe('#isAValidExternalRoomIdFormat()', () => {\n\t\tit('should return false if the provided value is not in a valid matrix external format for room ids', () => {\n\t\t\texpect(isAValidExternalRoomIdFormat('invalidFormat')).to.be.false;\n\t\t});\n\n\t\tit('should return true if the provided value is a valid matrix external format for room ids', () => {\n\t\t\texpect(isAValidExternalRoomIdFormat('!invalidFormat:server.com')).to.be.true;\n\t\t});\n\t});\n\n\tdescribe('FederationJoinPublicRoomInputDto', () => {\n\t\tit('should throw an error if the provided value is not in a valid matrix external format for room ids', () => {\n\t\t\texpect(\n\t\t\t\t() =>\n\t\t\t\t\tnew FederationJoinExternalPublicRoomInputDto({\n\t\t\t\t\t\texternalRoomId: 'invalidFormat',\n\t\t\t\t\t\texternalRoomHomeServerName: 'server.com',\n\t\t\t\t\t\tinternalUserId: 'internalUserId',\n\t\t\t\t\t\tnormalizedRoomId: 'normalizedRoomId',\n\t\t\t\t\t}),\n\t\t\t).to.throw(Error, 'Invalid external room id format');\n\t\t});\n\n\t\tit('should NOT throw any error and should return the proper dto', () => {\n\t\t\texpect(\n\t\t\t\tnew FederationJoinExternalPublicRoomInputDto({\n\t\t\t\t\texternalRoomId: '!roomId:server.com',\n\t\t\t\t\texternalRoomHomeServerName: 'server.com',\n\t\t\t\t\tinternalUserId: 'internalUserId',\n\t\t\t\t\tnormalizedRoomId: 'normalizedRoomId',\n\t\t\t\t\troomName: 'roomName',\n\t\t\t\t\tpageToken: 'pageToken',\n\t\t\t\t}),\n\t\t\t).to.be.eql({\n\t\t\t\texternalRoomId: '!roomId:server.com',\n\t\t\t\texternalRoomHomeServerName: 'server.com',\n\t\t\t\tinternalUserId: 'internalUserId',\n\t\t\t\tnormalizedRoomId: 'normalizedRoomId',\n\t\t\t\troomName: 'roomName',\n\t\t\t\tpageToken: 'pageToken',\n\t\t\t});\n\t\t});\n\t});\n});\n"],"names":["describe","it","expect","isAValidExternalRoomIdFormat","to","be","false","true","FederationJoinExternalPublicRoomInputDto","externalRoomId","externalRoomHomeServerName","internalUserId","normalizedRoomId","throw","Error","roomName","pageToken","eql"],"mappings":";;;;sBAAuB;8BAKhB;AAEPA,SAAS,wDAAwD;IAChEA,SAAS,mCAAmC;QAC3CC,GAAG,mGAAmG;YACrGC,IAAAA,YAAM,EAACC,IAAAA,0CAA4B,EAAC,kBAAkBC,EAAE,CAACC,EAAE,CAACC,KAAK;QAClE;QAEAL,GAAG,2FAA2F;YAC7FC,IAAAA,YAAM,EAACC,IAAAA,0CAA4B,EAAC,8BAA8BC,EAAE,CAACC,EAAE,CAACE,IAAI;QAC7E;IACD;IAEAP,SAAS,oCAAoC;QAC5CC,GAAG,qGAAqG;YACvGC,IAAAA,YAAM,EACL,IACC,IAAIM,sDAAwC,CAAC;oBAC5CC,gBAAgB;oBAChBC,4BAA4B;oBAC5BC,gBAAgB;oBAChBC,kBAAkB;gBACnB,IACAR,EAAE,CAACS,KAAK,CAACC,OAAO;QACnB;QAEAb,GAAG,+DAA+D;YACjEC,IAAAA,YAAM,EACL,IAAIM,sDAAwC,CAAC;gBAC5CC,gBAAgB;gBAChBC,4BAA4B;gBAC5BC,gBAAgB;gBAChBC,kBAAkB;gBAClBG,UAAU;gBACVC,WAAW;YACZ,IACCZ,EAAE,CAACC,EAAE,CAACY,GAAG,CAAC;gBACXR,gBAAgB;gBAChBC,4BAA4B;gBAC5BC,gBAAgB;gBAChBC,kBAAkB;gBAClBG,UAAU;gBACVC,WAAW;YACZ;QACD;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/room/sender/input/RoomInputDto.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2d16efb4d9d82b1e88c400beb9355be46205e6e2","contentHash":"cb5f26ad1d4392180808c0782fb73cbcd41af80522039c3a7b951dc5ec09bb4e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/input/RoomInputDto.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/input/RoomInputDto.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":24,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":56}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":56}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":51}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":44}},"8":{"start":{"line":25,"column":27},"end":{"line":30,"column":1}},"9":{"start":{"line":27,"column":8},"end":{"line":27,"column":27}},"10":{"start":{"line":28,"column":8},"end":{"line":28,"column":35}},"11":{"start":{"line":31,"column":37},"end":{"line":31,"column":146}},"12":{"start":{"line":31,"column":55},"end":{"line":31,"column":146}},"13":{"start":{"line":32,"column":42},"end":{"line":41,"column":1}},"14":{"start":{"line":34,"column":8},"end":{"line":37,"column":11}},"15":{"start":{"line":38,"column":8},"end":{"line":38,"column":37}},"16":{"start":{"line":39,"column":8},"end":{"line":39,"column":33}},"17":{"start":{"line":42,"column":47},"end":{"line":57,"column":1}},"18":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"19":{"start":{"line":45,"column":12},"end":{"line":45,"column":63}},"20":{"start":{"line":49,"column":8},"end":{"line":49,"column":52}},"21":{"start":{"line":50,"column":8},"end":{"line":50,"column":45}},"22":{"start":{"line":51,"column":8},"end":{"line":51,"column":45}},"23":{"start":{"line":52,"column":8},"end":{"line":52,"column":49}},"24":{"start":{"line":53,"column":8},"end":{"line":53,"column":69}},"25":{"start":{"line":54,"column":8},"end":{"line":54,"column":33}},"26":{"start":{"line":55,"column":8},"end":{"line":55,"column":35}},"27":{"start":{"line":58,"column":47},"end":{"line":63,"column":1}},"28":{"start":{"line":60,"column":8},"end":{"line":60,"column":45}},"29":{"start":{"line":61,"column":8},"end":{"line":61,"column":45}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":46},"end":{"line":12,"column":47}},"loc":{"start":{"line":12,"column":57},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":46},"end":{"line":15,"column":47}},"loc":{"start":{"line":15,"column":57},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":41},"end":{"line":18,"column":42}},"loc":{"start":{"line":18,"column":52},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":34},"end":{"line":21,"column":35}},"loc":{"start":{"line":21,"column":45},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":26,"column":4},"end":{"line":26,"column":5}},"loc":{"start":{"line":26,"column":37},"end":{"line":29,"column":5}},"line":26},"6":{"name":"(anonymous_6)","decl":{"start":{"line":31,"column":37},"end":{"line":31,"column":38}},"loc":{"start":{"line":31,"column":55},"end":{"line":31,"column":146}},"line":31},"7":{"name":"(anonymous_7)","decl":{"start":{"line":33,"column":4},"end":{"line":33,"column":5}},"loc":{"start":{"line":33,"column":59},"end":{"line":40,"column":5}},"line":33},"8":{"name":"(anonymous_8)","decl":{"start":{"line":43,"column":4},"end":{"line":43,"column":5}},"loc":{"start":{"line":43,"column":43},"end":{"line":47,"column":5}},"line":43},"9":{"name":"(anonymous_9)","decl":{"start":{"line":48,"column":4},"end":{"line":48,"column":5}},"loc":{"start":{"line":48,"column":118},"end":{"line":56,"column":5}},"line":48},"10":{"name":"(anonymous_10)","decl":{"start":{"line":59,"column":4},"end":{"line":59,"column":5}},"loc":{"start":{"line":59,"column":51},"end":{"line":62,"column":5}},"line":59}},"branchMap":{"0":{"loc":{"start":{"line":31,"column":63},"end":{"line":31,"column":145}},"type":"binary-expr","locations":[{"start":{"line":31,"column":63},"end":{"line":31,"column":77}},{"start":{"line":31,"column":81},"end":{"line":31,"column":113}},{"start":{"line":31,"column":117},"end":{"line":31,"column":145}}],"line":31},"1":{"loc":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"type":"if","locations":[{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},{"start":{"line":44,"column":8},"end":{"line":46,"column":9}}],"line":44}},"s":{"0":1,"1":1,"2":4,"3":1,"4":4,"5":0,"6":0,"7":2,"8":1,"9":0,"10":0,"11":1,"12":6,"13":1,"14":0,"15":0,"16":0,"17":1,"18":4,"19":1,"20":4,"21":3,"22":3,"23":3,"24":3,"25":3,"26":3,"27":1,"28":0,"29":0},"f":{"0":1,"1":4,"2":0,"3":0,"4":2,"5":0,"6":6,"7":0,"8":4,"9":4,"10":0},"b":{"0":[6,6,4],"1":[1,3]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/input/RoomInputDto.ts"],"sourcesContent":["interface IFederationPagination {\n\tcount?: number;\n\tpageToken?: string;\n}\n\ninterface IFederationRoomSearchPublicRoomsInputDto extends IFederationPagination {\n\tserverName?: string;\n\troomName?: string;\n}\n\ninterface IFederationRoomJoinExternalPublicRoomInputDto {\n\texternalRoomId: string;\n\tinternalUserId: string;\n\tnormalizedRoomId: string;\n\texternalRoomHomeServerName: string;\n\troomName?: string;\n\tpageToken?: string;\n}\n\ninterface IFederationRoomJoinInternalPublicRoomInputDto {\n\tinternalRoomId: string;\n\tinternalUserId: string;\n}\n\nclass FederationPagination {\n\tconstructor({ count, pageToken }: IFederationPagination) {\n\t\tthis.count = count;\n\t\tthis.pageToken = pageToken;\n\t}\n\n\tcount?: number;\n\n\tpageToken?: string;\n}\n\nexport const isAValidExternalRoomIdFormat = (externalRoomId: string): boolean =>\n\tBoolean(externalRoomId && externalRoomId.charAt(0) === '!' && externalRoomId.includes(':'));\n\nexport class FederationSearchPublicRoomsInputDto extends FederationPagination {\n\tconstructor({ serverName, roomName, count, pageToken }: IFederationRoomSearchPublicRoomsInputDto) {\n\t\tsuper({ count, pageToken });\n\t\tthis.serverName = serverName;\n\t\tthis.roomName = roomName;\n\t}\n\n\tserverName?: string;\n\n\troomName?: string;\n}\n\nexport class FederationJoinExternalPublicRoomInputDto {\n\tconstructor({\n\t\texternalRoomId,\n\t\tinternalUserId,\n\t\tnormalizedRoomId,\n\t\texternalRoomHomeServerName,\n\t\troomName,\n\t\tpageToken,\n\t}: IFederationRoomJoinExternalPublicRoomInputDto) {\n\t\tthis.validateExternalRoomId(externalRoomId);\n\t\tthis.externalRoomId = externalRoomId;\n\t\tthis.internalUserId = internalUserId;\n\t\tthis.normalizedRoomId = normalizedRoomId;\n\t\tthis.externalRoomHomeServerName = externalRoomHomeServerName;\n\t\tthis.roomName = roomName;\n\t\tthis.pageToken = pageToken;\n\t}\n\n\texternalRoomId: string;\n\n\tnormalizedRoomId: string;\n\n\texternalRoomHomeServerName: string;\n\n\tinternalUserId: string;\n\n\troomName?: string;\n\n\tpageToken?: string;\n\n\tprivate validateExternalRoomId(externalRoomId: string): void {\n\t\tif (!isAValidExternalRoomIdFormat(externalRoomId)) {\n\t\t\tthrow new Error('Invalid external room id format');\n\t\t}\n\t}\n}\n\nexport class FederationJoinInternalPublicRoomInputDto {\n\tconstructor({ internalRoomId, internalUserId }: IFederationRoomJoinInternalPublicRoomInputDto) {\n\t\tthis.internalRoomId = internalRoomId;\n\t\tthis.internalUserId = internalUserId;\n\t}\n\n\tinternalRoomId: string;\n\n\tinternalUserId: string;\n}\n"],"names":["FederationJoinExternalPublicRoomInputDto","FederationJoinInternalPublicRoomInputDto","FederationSearchPublicRoomsInputDto","isAValidExternalRoomIdFormat","FederationPagination","constructor","count","pageToken","externalRoomId","Boolean","charAt","includes","serverName","roomName","validateExternalRoomId","Error","internalUserId","normalizedRoomId","externalRoomHomeServerName","internalRoomId"],"mappings":";;;;;;;;;;;IAkDaA,wCAAwC;eAAxCA;;IAqCAC,wCAAwC;eAAxCA;;IAjDAC,mCAAmC;eAAnCA;;IAHAC,4BAA4B;eAA5BA;;;AAXb,IAAA,AAAMC,uBAAN,MAAMA;IACLC,YAAY,EAAEC,KAAK,EAAEC,SAAS,EAAyB,CAAE;QACxD,IAAI,CAACD,KAAK,GAAGA;QACb,IAAI,CAACC,SAAS,GAAGA;IAClB;AAKD;AAEO,MAAMJ,+BAA+B,CAACK,iBAC5CC,QAAQD,kBAAkBA,eAAeE,MAAM,CAAC,OAAO,OAAOF,eAAeG,QAAQ,CAAC;AAEhF,IAAA,AAAMT,sCAAN,MAAMA,4CAA4CE;IACxDC,YAAY,EAAEO,UAAU,EAAEC,QAAQ,EAAEP,KAAK,EAAEC,SAAS,EAA4C,CAAE;QACjG,KAAK,CAAC;YAAED;YAAOC;QAAU;QACzB,IAAI,CAACK,UAAU,GAAGA;QAClB,IAAI,CAACC,QAAQ,GAAGA;IACjB;AAKD;AAEO,IAAA,AAAMb,2CAAN,MAAMA;IA8BJc,uBAAuBN,cAAsB,EAAQ;QAC5D,IAAI,CAACL,6BAA6BK,iBAAiB;YAClD,MAAM,IAAIO,MAAM;QACjB;IACD;IAjCAV,YAAY,EACXG,cAAc,EACdQ,cAAc,EACdC,gBAAgB,EAChBC,0BAA0B,EAC1BL,QAAQ,EACRN,SAAS,EACsC,CAAE;QACjD,IAAI,CAACO,sBAAsB,CAACN;QAC5B,IAAI,CAACA,cAAc,GAAGA;QACtB,IAAI,CAACQ,cAAc,GAAGA;QACtB,IAAI,CAACC,gBAAgB,GAAGA;QACxB,IAAI,CAACC,0BAA0B,GAAGA;QAClC,IAAI,CAACL,QAAQ,GAAGA;QAChB,IAAI,CAACN,SAAS,GAAGA;IAClB;AAmBD;AAEO,IAAA,AAAMN,2CAAN,MAAMA;IACZI,YAAY,EAAEc,cAAc,EAAEH,cAAc,EAAiD,CAAE;QAC9F,IAAI,CAACG,cAAc,GAAGA;QACtB,IAAI,CAACH,cAAc,GAAGA;IACvB;AAKD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/input/RoomInputDto.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a58ab93a183b3569a8ea500d3a9ef95612f975bf","contentHash":"b13d5b1dcfe9b123ddd17dabdf305ea9d6339d66d70fef5a411ba3465cc8797e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/room/sender/RoomServiceSender.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/room/sender/RoomServiceSender.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":15},"end":{"line":5,"column":67}},"2":{"start":{"line":6,"column":14},"end":{"line":6,"column":29}},"3":{"start":{"line":7,"column":34},"end":{"line":7,"column":81}},"4":{"start":{"line":8,"column":29},"end":{"line":8,"column":71}},"5":{"start":{"line":10,"column":4},"end":{"line":12,"column":6}},"6":{"start":{"line":14,"column":28},"end":{"line":23,"column":2}},"7":{"start":{"line":18,"column":16},"end":{"line":18,"column":35}},"8":{"start":{"line":24,"column":28},"end":{"line":33,"column":2}},"9":{"start":{"line":28,"column":16},"end":{"line":28,"column":35}},"10":{"start":{"line":34,"column":40},"end":{"line":43,"column":2}},"11":{"start":{"line":38,"column":16},"end":{"line":38,"column":35}},"12":{"start":{"line":44,"column":0},"end":{"line":1140,"column":3}},"13":{"start":{"line":46,"column":24},"end":{"line":55,"column":5}},"14":{"start":{"line":56,"column":24},"end":{"line":67,"column":5}},"15":{"start":{"line":68,"column":28},"end":{"line":72,"column":5}},"16":{"start":{"line":73,"column":27},"end":{"line":73,"column":29}},"17":{"start":{"line":74,"column":19},"end":{"line":84,"column":5}},"18":{"start":{"line":85,"column":24},"end":{"line":87,"column":5}},"19":{"start":{"line":88,"column":32},"end":{"line":91,"column":5}},"20":{"start":{"line":92,"column":25},"end":{"line":94,"column":5}},"21":{"start":{"line":95,"column":21},"end":{"line":101,"column":5}},"22":{"start":{"line":102,"column":4},"end":{"line":104,"column":7}},"23":{"start":{"line":103,"column":8},"end":{"line":103,"column":165}},"24":{"start":{"line":105,"column":4},"end":{"line":138,"column":7}},"25":{"start":{"line":106,"column":8},"end":{"line":106,"column":57}},"26":{"start":{"line":107,"column":8},"end":{"line":107,"column":64}},"27":{"start":{"line":108,"column":8},"end":{"line":108,"column":48}},"28":{"start":{"line":109,"column":8},"end":{"line":109,"column":57}},"29":{"start":{"line":110,"column":8},"end":{"line":110,"column":57}},"30":{"start":{"line":111,"column":8},"end":{"line":111,"column":42}},"31":{"start":{"line":112,"column":8},"end":{"line":112,"column":48}},"32":{"start":{"line":113,"column":8},"end":{"line":113,"column":48}},"33":{"start":{"line":114,"column":8},"end":{"line":114,"column":57}},"34":{"start":{"line":115,"column":8},"end":{"line":115,"column":48}},"35":{"start":{"line":116,"column":8},"end":{"line":116,"column":48}},"36":{"start":{"line":117,"column":8},"end":{"line":117,"column":63}},"37":{"start":{"line":118,"column":8},"end":{"line":118,"column":44}},"38":{"start":{"line":119,"column":8},"end":{"line":119,"column":54}},"39":{"start":{"line":120,"column":8},"end":{"line":120,"column":57}},"40":{"start":{"line":121,"column":8},"end":{"line":121,"column":51}},"41":{"start":{"line":122,"column":8},"end":{"line":122,"column":38}},"42":{"start":{"line":123,"column":8},"end":{"line":123,"column":43}},"43":{"start":{"line":124,"column":8},"end":{"line":124,"column":47}},"44":{"start":{"line":125,"column":8},"end":{"line":125,"column":34}},"45":{"start":{"line":126,"column":8},"end":{"line":126,"column":34}},"46":{"start":{"line":127,"column":8},"end":{"line":127,"column":36}},"47":{"start":{"line":128,"column":8},"end":{"line":128,"column":32}},"48":{"start":{"line":129,"column":8},"end":{"line":129,"column":49}},"49":{"start":{"line":130,"column":8},"end":{"line":130,"column":32}},"50":{"start":{"line":131,"column":8},"end":{"line":131,"column":41}},"51":{"start":{"line":132,"column":8},"end":{"line":132,"column":35}},"52":{"start":{"line":133,"column":8},"end":{"line":133,"column":40}},"53":{"start":{"line":134,"column":8},"end":{"line":134,"column":52}},"54":{"start":{"line":135,"column":8},"end":{"line":135,"column":76}},"55":{"start":{"line":136,"column":8},"end":{"line":136,"column":62}},"56":{"start":{"line":137,"column":8},"end":{"line":137,"column":81}},"57":{"start":{"line":139,"column":4},"end":{"line":364,"column":7}},"58":{"start":{"line":140,"column":21},"end":{"line":144,"column":10}},"59":{"start":{"line":145,"column":21},"end":{"line":145,"column":140}},"60":{"start":{"line":146,"column":8},"end":{"line":156,"column":11}},"61":{"start":{"line":147,"column":12},"end":{"line":147,"column":78}},"62":{"start":{"line":148,"column":12},"end":{"line":148,"column":78}},"63":{"start":{"line":149,"column":12},"end":{"line":149,"column":74}},"64":{"start":{"line":150,"column":12},"end":{"line":150,"column":68}},"65":{"start":{"line":151,"column":12},"end":{"line":153,"column":15}},"66":{"start":{"line":154,"column":12},"end":{"line":154,"column":68}},"67":{"start":{"line":155,"column":12},"end":{"line":155,"column":82}},"68":{"start":{"line":157,"column":8},"end":{"line":177,"column":11}},"69":{"start":{"line":158,"column":12},"end":{"line":158,"column":83}},"70":{"start":{"line":159,"column":12},"end":{"line":159,"column":68}},"71":{"start":{"line":160,"column":12},"end":{"line":160,"column":74}},"72":{"start":{"line":161,"column":12},"end":{"line":164,"column":15}},"73":{"start":{"line":165,"column":12},"end":{"line":165,"column":68}},"74":{"start":{"line":166,"column":12},"end":{"line":166,"column":60}},"75":{"start":{"line":167,"column":12},"end":{"line":169,"column":15}},"76":{"start":{"line":170,"column":28},"end":{"line":174,"column":14}},"77":{"start":{"line":175,"column":12},"end":{"line":175,"column":106}},"78":{"start":{"line":176,"column":12},"end":{"line":176,"column":94}},"79":{"start":{"line":178,"column":8},"end":{"line":188,"column":11}},"80":{"start":{"line":179,"column":12},"end":{"line":179,"column":73}},"81":{"start":{"line":180,"column":12},"end":{"line":183,"column":15}},"82":{"start":{"line":184,"column":12},"end":{"line":187,"column":87}},"83":{"start":{"line":189,"column":8},"end":{"line":197,"column":11}},"84":{"start":{"line":190,"column":12},"end":{"line":190,"column":68}},"85":{"start":{"line":191,"column":12},"end":{"line":191,"column":64}},"86":{"start":{"line":192,"column":12},"end":{"line":196,"column":84}},"87":{"start":{"line":198,"column":8},"end":{"line":217,"column":11}},"88":{"start":{"line":199,"column":12},"end":{"line":199,"column":68}},"89":{"start":{"line":200,"column":12},"end":{"line":200,"column":74}},"90":{"start":{"line":201,"column":12},"end":{"line":206,"column":15}},"91":{"start":{"line":207,"column":12},"end":{"line":207,"column":83}},"92":{"start":{"line":208,"column":12},"end":{"line":208,"column":68}},"93":{"start":{"line":209,"column":12},"end":{"line":209,"column":57}},"94":{"start":{"line":210,"column":12},"end":{"line":214,"column":15}},"95":{"start":{"line":215,"column":12},"end":{"line":215,"column":135}},"96":{"start":{"line":216,"column":12},"end":{"line":216,"column":126}},"97":{"start":{"line":218,"column":8},"end":{"line":227,"column":11}},"98":{"start":{"line":219,"column":12},"end":{"line":219,"column":68}},"99":{"start":{"line":220,"column":12},"end":{"line":220,"column":74}},"100":{"start":{"line":221,"column":12},"end":{"line":221,"column":68}},"101":{"start":{"line":222,"column":12},"end":{"line":225,"column":15}},"102":{"start":{"line":226,"column":12},"end":{"line":226,"column":82}},"103":{"start":{"line":228,"column":8},"end":{"line":244,"column":11}},"104":{"start":{"line":229,"column":12},"end":{"line":229,"column":68}},"105":{"start":{"line":230,"column":12},"end":{"line":230,"column":89}},"106":{"start":{"line":231,"column":12},"end":{"line":231,"column":74}},"107":{"start":{"line":232,"column":12},"end":{"line":232,"column":68}},"108":{"start":{"line":233,"column":12},"end":{"line":233,"column":66}},"109":{"start":{"line":234,"column":12},"end":{"line":237,"column":15}},"110":{"start":{"line":238,"column":28},"end":{"line":242,"column":14}},"111":{"start":{"line":243,"column":12},"end":{"line":243,"column":94}},"112":{"start":{"line":245,"column":8},"end":{"line":261,"column":11}},"113":{"start":{"line":246,"column":12},"end":{"line":246,"column":68}},"114":{"start":{"line":247,"column":12},"end":{"line":247,"column":89}},"115":{"start":{"line":248,"column":12},"end":{"line":248,"column":74}},"116":{"start":{"line":249,"column":12},"end":{"line":249,"column":68}},"117":{"start":{"line":250,"column":12},"end":{"line":250,"column":69}},"118":{"start":{"line":251,"column":12},"end":{"line":254,"column":15}},"119":{"start":{"line":255,"column":28},"end":{"line":259,"column":14}},"120":{"start":{"line":260,"column":12},"end":{"line":260,"column":94}},"121":{"start":{"line":262,"column":8},"end":{"line":270,"column":11}},"122":{"start":{"line":263,"column":12},"end":{"line":263,"column":68}},"123":{"start":{"line":264,"column":12},"end":{"line":264,"column":79}},"124":{"start":{"line":265,"column":12},"end":{"line":265,"column":68}},"125":{"start":{"line":266,"column":12},"end":{"line":269,"column":110}},"126":{"start":{"line":271,"column":8},"end":{"line":284,"column":11}},"127":{"start":{"line":272,"column":12},"end":{"line":272,"column":68}},"128":{"start":{"line":273,"column":12},"end":{"line":273,"column":74}},"129":{"start":{"line":274,"column":12},"end":{"line":274,"column":68}},"130":{"start":{"line":275,"column":12},"end":{"line":275,"column":66}},"131":{"start":{"line":276,"column":12},"end":{"line":276,"column":65}},"132":{"start":{"line":277,"column":12},"end":{"line":282,"column":15}},"133":{"start":{"line":283,"column":12},"end":{"line":283,"column":135}},"134":{"start":{"line":285,"column":8},"end":{"line":298,"column":11}},"135":{"start":{"line":286,"column":12},"end":{"line":286,"column":68}},"136":{"start":{"line":287,"column":12},"end":{"line":287,"column":74}},"137":{"start":{"line":288,"column":12},"end":{"line":288,"column":68}},"138":{"start":{"line":289,"column":12},"end":{"line":289,"column":66}},"139":{"start":{"line":290,"column":12},"end":{"line":290,"column":58}},"140":{"start":{"line":291,"column":12},"end":{"line":296,"column":15}},"141":{"start":{"line":297,"column":12},"end":{"line":297,"column":68}},"142":{"start":{"line":299,"column":8},"end":{"line":311,"column":11}},"143":{"start":{"line":300,"column":12},"end":{"line":300,"column":68}},"144":{"start":{"line":301,"column":12},"end":{"line":301,"column":74}},"145":{"start":{"line":302,"column":12},"end":{"line":302,"column":68}},"146":{"start":{"line":303,"column":12},"end":{"line":303,"column":69}},"147":{"start":{"line":304,"column":12},"end":{"line":309,"column":15}},"148":{"start":{"line":310,"column":12},"end":{"line":310,"column":68}},"149":{"start":{"line":312,"column":8},"end":{"line":328,"column":11}},"150":{"start":{"line":313,"column":28},"end":{"line":317,"column":14}},"151":{"start":{"line":318,"column":12},"end":{"line":318,"column":68}},"152":{"start":{"line":319,"column":12},"end":{"line":319,"column":77}},"153":{"start":{"line":320,"column":12},"end":{"line":320,"column":68}},"154":{"start":{"line":321,"column":12},"end":{"line":326,"column":15}},"155":{"start":{"line":327,"column":12},"end":{"line":327,"column":142}},"156":{"start":{"line":329,"column":8},"end":{"line":345,"column":11}},"157":{"start":{"line":330,"column":28},"end":{"line":334,"column":14}},"158":{"start":{"line":335,"column":12},"end":{"line":335,"column":66}},"159":{"start":{"line":336,"column":12},"end":{"line":336,"column":68}},"160":{"start":{"line":337,"column":12},"end":{"line":337,"column":77}},"161":{"start":{"line":338,"column":12},"end":{"line":338,"column":68}},"162":{"start":{"line":339,"column":12},"end":{"line":343,"column":15}},"163":{"start":{"line":344,"column":12},"end":{"line":344,"column":116}},"164":{"start":{"line":346,"column":8},"end":{"line":363,"column":11}},"165":{"start":{"line":347,"column":28},"end":{"line":351,"column":14}},"166":{"start":{"line":352,"column":12},"end":{"line":352,"column":69}},"167":{"start":{"line":353,"column":12},"end":{"line":353,"column":68}},"168":{"start":{"line":354,"column":12},"end":{"line":354,"column":77}},"169":{"start":{"line":355,"column":12},"end":{"line":355,"column":68}},"170":{"start":{"line":356,"column":12},"end":{"line":361,"column":15}},"171":{"start":{"line":362,"column":12},"end":{"line":362,"column":66}},"172":{"start":{"line":365,"column":4},"end":{"line":581,"column":7}},"173":{"start":{"line":366,"column":30},"end":{"line":370,"column":10}},"174":{"start":{"line":371,"column":21},"end":{"line":371,"column":149}},"175":{"start":{"line":372,"column":28},"end":{"line":381,"column":9}},"176":{"start":{"line":382,"column":8},"end":{"line":391,"column":11}},"177":{"start":{"line":383,"column":46},"end":{"line":383,"column":99}},"178":{"start":{"line":384,"column":12},"end":{"line":384,"column":73}},"179":{"start":{"line":385,"column":12},"end":{"line":389,"column":15}},"180":{"start":{"line":390,"column":12},"end":{"line":390,"column":76}},"181":{"start":{"line":392,"column":8},"end":{"line":402,"column":11}},"182":{"start":{"line":393,"column":46},"end":{"line":393,"column":99}},"183":{"start":{"line":394,"column":12},"end":{"line":394,"column":77}},"184":{"start":{"line":395,"column":12},"end":{"line":395,"column":73}},"185":{"start":{"line":396,"column":12},"end":{"line":400,"column":15}},"186":{"start":{"line":401,"column":12},"end":{"line":401,"column":76}},"187":{"start":{"line":403,"column":8},"end":{"line":416,"column":11}},"188":{"start":{"line":404,"column":46},"end":{"line":404,"column":99}},"189":{"start":{"line":405,"column":12},"end":{"line":407,"column":15}},"190":{"start":{"line":406,"column":35},"end":{"line":406,"column":48}},"191":{"start":{"line":408,"column":12},"end":{"line":408,"column":68}},"192":{"start":{"line":409,"column":12},"end":{"line":409,"column":66}},"193":{"start":{"line":410,"column":12},"end":{"line":414,"column":84}},"194":{"start":{"line":415,"column":12},"end":{"line":415,"column":76}},"195":{"start":{"line":417,"column":8},"end":{"line":432,"column":11}},"196":{"start":{"line":418,"column":46},"end":{"line":418,"column":99}},"197":{"start":{"line":419,"column":12},"end":{"line":421,"column":15}},"198":{"start":{"line":420,"column":35},"end":{"line":420,"column":48}},"199":{"start":{"line":422,"column":12},"end":{"line":422,"column":68}},"200":{"start":{"line":423,"column":12},"end":{"line":425,"column":15}},"201":{"start":{"line":426,"column":12},"end":{"line":430,"column":15}},"202":{"start":{"line":431,"column":12},"end":{"line":431,"column":101}},"203":{"start":{"line":433,"column":8},"end":{"line":448,"column":11}},"204":{"start":{"line":434,"column":46},"end":{"line":434,"column":99}},"205":{"start":{"line":435,"column":12},"end":{"line":437,"column":15}},"206":{"start":{"line":436,"column":35},"end":{"line":436,"column":48}},"207":{"start":{"line":438,"column":12},"end":{"line":438,"column":68}},"208":{"start":{"line":439,"column":12},"end":{"line":441,"column":15}},"209":{"start":{"line":442,"column":12},"end":{"line":446,"column":15}},"210":{"start":{"line":447,"column":12},"end":{"line":447,"column":101}},"211":{"start":{"line":449,"column":8},"end":{"line":460,"column":11}},"212":{"start":{"line":450,"column":46},"end":{"line":450,"column":99}},"213":{"start":{"line":451,"column":12},"end":{"line":451,"column":77}},"214":{"start":{"line":452,"column":12},"end":{"line":452,"column":68}},"215":{"start":{"line":453,"column":12},"end":{"line":453,"column":66}},"216":{"start":{"line":454,"column":12},"end":{"line":458,"column":15}},"217":{"start":{"line":459,"column":12},"end":{"line":459,"column":101}},"218":{"start":{"line":461,"column":8},"end":{"line":480,"column":11}},"219":{"start":{"line":462,"column":30},"end":{"line":462,"column":87}},"220":{"start":{"line":463,"column":35},"end":{"line":463,"column":97}},"221":{"start":{"line":464,"column":12},"end":{"line":464,"column":79}},"222":{"start":{"line":465,"column":12},"end":{"line":465,"column":76}},"223":{"start":{"line":466,"column":12},"end":{"line":469,"column":15}},"224":{"start":{"line":470,"column":12},"end":{"line":470,"column":77}},"225":{"start":{"line":471,"column":12},"end":{"line":471,"column":60}},"226":{"start":{"line":472,"column":28},"end":{"line":476,"column":14}},"227":{"start":{"line":477,"column":12},"end":{"line":477,"column":101}},"228":{"start":{"line":478,"column":12},"end":{"line":478,"column":91}},"229":{"start":{"line":479,"column":12},"end":{"line":479,"column":98}},"230":{"start":{"line":481,"column":8},"end":{"line":493,"column":11}},"231":{"start":{"line":482,"column":12},"end":{"line":482,"column":79}},"232":{"start":{"line":483,"column":12},"end":{"line":483,"column":76}},"233":{"start":{"line":484,"column":12},"end":{"line":487,"column":15}},"234":{"start":{"line":488,"column":12},"end":{"line":488,"column":77}},"235":{"start":{"line":489,"column":12},"end":{"line":489,"column":60}},"236":{"start":{"line":490,"column":12},"end":{"line":490,"column":72}},"237":{"start":{"line":491,"column":12},"end":{"line":491,"column":85}},"238":{"start":{"line":492,"column":12},"end":{"line":492,"column":77}},"239":{"start":{"line":494,"column":8},"end":{"line":510,"column":11}},"240":{"start":{"line":495,"column":12},"end":{"line":499,"column":16}},"241":{"start":{"line":500,"column":12},"end":{"line":500,"column":79}},"242":{"start":{"line":501,"column":12},"end":{"line":501,"column":76}},"243":{"start":{"line":502,"column":12},"end":{"line":505,"column":15}},"244":{"start":{"line":506,"column":12},"end":{"line":506,"column":60}},"245":{"start":{"line":507,"column":12},"end":{"line":507,"column":72}},"246":{"start":{"line":508,"column":12},"end":{"line":508,"column":85}},"247":{"start":{"line":509,"column":12},"end":{"line":509,"column":77}},"248":{"start":{"line":511,"column":8},"end":{"line":527,"column":11}},"249":{"start":{"line":512,"column":44},"end":{"line":512,"column":49}},"250":{"start":{"line":513,"column":12},"end":{"line":517,"column":16}},"251":{"start":{"line":518,"column":12},"end":{"line":518,"column":79}},"252":{"start":{"line":519,"column":12},"end":{"line":519,"column":76}},"253":{"start":{"line":520,"column":12},"end":{"line":523,"column":15}},"254":{"start":{"line":524,"column":12},"end":{"line":524,"column":60}},"255":{"start":{"line":525,"column":12},"end":{"line":525,"column":72}},"256":{"start":{"line":526,"column":12},"end":{"line":526,"column":85}},"257":{"start":{"line":528,"column":8},"end":{"line":546,"column":11}},"258":{"start":{"line":529,"column":44},"end":{"line":529,"column":49}},"259":{"start":{"line":530,"column":31},"end":{"line":535,"column":14}},"260":{"start":{"line":536,"column":12},"end":{"line":536,"column":74}},"261":{"start":{"line":537,"column":12},"end":{"line":537,"column":79}},"262":{"start":{"line":538,"column":12},"end":{"line":538,"column":76}},"263":{"start":{"line":539,"column":12},"end":{"line":542,"column":15}},"264":{"start":{"line":543,"column":12},"end":{"line":543,"column":60}},"265":{"start":{"line":544,"column":12},"end":{"line":544,"column":100}},"266":{"start":{"line":545,"column":12},"end":{"line":545,"column":129}},"267":{"start":{"line":547,"column":8},"end":{"line":562,"column":11}},"268":{"start":{"line":548,"column":44},"end":{"line":548,"column":49}},"269":{"start":{"line":549,"column":12},"end":{"line":551,"column":16}},"270":{"start":{"line":552,"column":12},"end":{"line":552,"column":79}},"271":{"start":{"line":553,"column":12},"end":{"line":553,"column":76}},"272":{"start":{"line":554,"column":12},"end":{"line":557,"column":15}},"273":{"start":{"line":558,"column":12},"end":{"line":558,"column":60}},"274":{"start":{"line":559,"column":12},"end":{"line":559,"column":72}},"275":{"start":{"line":560,"column":12},"end":{"line":560,"column":85}},"276":{"start":{"line":561,"column":12},"end":{"line":561,"column":77}},"277":{"start":{"line":563,"column":8},"end":{"line":580,"column":11}},"278":{"start":{"line":564,"column":44},"end":{"line":564,"column":49}},"279":{"start":{"line":565,"column":25},"end":{"line":568,"column":14}},"280":{"start":{"line":569,"column":12},"end":{"line":569,"column":68}},"281":{"start":{"line":570,"column":12},"end":{"line":570,"column":79}},"282":{"start":{"line":571,"column":12},"end":{"line":571,"column":76}},"283":{"start":{"line":572,"column":12},"end":{"line":575,"column":15}},"284":{"start":{"line":576,"column":12},"end":{"line":576,"column":60}},"285":{"start":{"line":577,"column":12},"end":{"line":577,"column":72}},"286":{"start":{"line":578,"column":12},"end":{"line":578,"column":85}},"287":{"start":{"line":579,"column":12},"end":{"line":579,"column":124}},"288":{"start":{"line":582,"column":4},"end":{"line":782,"column":7}},"289":{"start":{"line":583,"column":21},"end":{"line":587,"column":10}},"290":{"start":{"line":588,"column":21},"end":{"line":588,"column":140}},"291":{"start":{"line":589,"column":8},"end":{"line":596,"column":11}},"292":{"start":{"line":590,"column":12},"end":{"line":590,"column":64}},"293":{"start":{"line":591,"column":12},"end":{"line":595,"column":96}},"294":{"start":{"line":597,"column":8},"end":{"line":608,"column":11}},"295":{"start":{"line":598,"column":12},"end":{"line":598,"column":78}},"296":{"start":{"line":599,"column":12},"end":{"line":599,"column":78}},"297":{"start":{"line":600,"column":12},"end":{"line":600,"column":74}},"298":{"start":{"line":601,"column":12},"end":{"line":601,"column":68}},"299":{"start":{"line":602,"column":12},"end":{"line":605,"column":15}},"300":{"start":{"line":606,"column":12},"end":{"line":606,"column":68}},"301":{"start":{"line":607,"column":12},"end":{"line":607,"column":82}},"302":{"start":{"line":609,"column":8},"end":{"line":620,"column":11}},"303":{"start":{"line":610,"column":12},"end":{"line":610,"column":73}},"304":{"start":{"line":611,"column":12},"end":{"line":611,"column":68}},"305":{"start":{"line":612,"column":12},"end":{"line":615,"column":15}},"306":{"start":{"line":616,"column":12},"end":{"line":619,"column":87}},"307":{"start":{"line":621,"column":8},"end":{"line":632,"column":11}},"308":{"start":{"line":622,"column":12},"end":{"line":622,"column":73}},"309":{"start":{"line":623,"column":12},"end":{"line":623,"column":68}},"310":{"start":{"line":624,"column":12},"end":{"line":627,"column":15}},"311":{"start":{"line":628,"column":12},"end":{"line":631,"column":91}},"312":{"start":{"line":633,"column":8},"end":{"line":642,"column":11}},"313":{"start":{"line":634,"column":12},"end":{"line":634,"column":68}},"314":{"start":{"line":635,"column":12},"end":{"line":635,"column":74}},"315":{"start":{"line":636,"column":12},"end":{"line":636,"column":68}},"316":{"start":{"line":637,"column":12},"end":{"line":640,"column":15}},"317":{"start":{"line":641,"column":12},"end":{"line":641,"column":82}},"318":{"start":{"line":643,"column":8},"end":{"line":659,"column":11}},"319":{"start":{"line":644,"column":12},"end":{"line":644,"column":68}},"320":{"start":{"line":645,"column":12},"end":{"line":645,"column":89}},"321":{"start":{"line":646,"column":12},"end":{"line":646,"column":74}},"322":{"start":{"line":647,"column":12},"end":{"line":647,"column":68}},"323":{"start":{"line":648,"column":12},"end":{"line":648,"column":66}},"324":{"start":{"line":649,"column":12},"end":{"line":652,"column":15}},"325":{"start":{"line":653,"column":28},"end":{"line":657,"column":14}},"326":{"start":{"line":658,"column":12},"end":{"line":658,"column":94}},"327":{"start":{"line":660,"column":8},"end":{"line":676,"column":11}},"328":{"start":{"line":661,"column":12},"end":{"line":661,"column":68}},"329":{"start":{"line":662,"column":12},"end":{"line":662,"column":89}},"330":{"start":{"line":663,"column":12},"end":{"line":663,"column":74}},"331":{"start":{"line":664,"column":12},"end":{"line":664,"column":68}},"332":{"start":{"line":665,"column":12},"end":{"line":665,"column":69}},"333":{"start":{"line":666,"column":12},"end":{"line":669,"column":15}},"334":{"start":{"line":670,"column":28},"end":{"line":674,"column":14}},"335":{"start":{"line":675,"column":12},"end":{"line":675,"column":94}},"336":{"start":{"line":677,"column":8},"end":{"line":685,"column":11}},"337":{"start":{"line":678,"column":12},"end":{"line":678,"column":68}},"338":{"start":{"line":679,"column":12},"end":{"line":679,"column":79}},"339":{"start":{"line":680,"column":12},"end":{"line":680,"column":68}},"340":{"start":{"line":681,"column":12},"end":{"line":684,"column":110}},"341":{"start":{"line":686,"column":8},"end":{"line":699,"column":11}},"342":{"start":{"line":687,"column":12},"end":{"line":687,"column":68}},"343":{"start":{"line":688,"column":12},"end":{"line":688,"column":74}},"344":{"start":{"line":689,"column":12},"end":{"line":689,"column":68}},"345":{"start":{"line":690,"column":12},"end":{"line":690,"column":66}},"346":{"start":{"line":691,"column":12},"end":{"line":691,"column":65}},"347":{"start":{"line":692,"column":12},"end":{"line":697,"column":15}},"348":{"start":{"line":698,"column":12},"end":{"line":698,"column":135}},"349":{"start":{"line":700,"column":8},"end":{"line":713,"column":11}},"350":{"start":{"line":701,"column":12},"end":{"line":701,"column":68}},"351":{"start":{"line":702,"column":12},"end":{"line":702,"column":74}},"352":{"start":{"line":703,"column":12},"end":{"line":703,"column":68}},"353":{"start":{"line":704,"column":12},"end":{"line":704,"column":66}},"354":{"start":{"line":705,"column":12},"end":{"line":705,"column":58}},"355":{"start":{"line":706,"column":12},"end":{"line":711,"column":15}},"356":{"start":{"line":712,"column":12},"end":{"line":712,"column":68}},"357":{"start":{"line":714,"column":8},"end":{"line":726,"column":11}},"358":{"start":{"line":715,"column":12},"end":{"line":715,"column":68}},"359":{"start":{"line":716,"column":12},"end":{"line":716,"column":74}},"360":{"start":{"line":717,"column":12},"end":{"line":717,"column":68}},"361":{"start":{"line":718,"column":12},"end":{"line":718,"column":69}},"362":{"start":{"line":719,"column":12},"end":{"line":724,"column":15}},"363":{"start":{"line":725,"column":12},"end":{"line":725,"column":68}},"364":{"start":{"line":727,"column":8},"end":{"line":745,"column":11}},"365":{"start":{"line":728,"column":28},"end":{"line":732,"column":14}},"366":{"start":{"line":733,"column":12},"end":{"line":733,"column":73}},"367":{"start":{"line":734,"column":12},"end":{"line":734,"column":77}},"368":{"start":{"line":735,"column":12},"end":{"line":735,"column":68}},"369":{"start":{"line":736,"column":12},"end":{"line":736,"column":69}},"370":{"start":{"line":737,"column":12},"end":{"line":742,"column":15}},"371":{"start":{"line":743,"column":12},"end":{"line":743,"column":66}},"372":{"start":{"line":744,"column":12},"end":{"line":744,"column":70}},"373":{"start":{"line":746,"column":8},"end":{"line":764,"column":11}},"374":{"start":{"line":747,"column":28},"end":{"line":751,"column":14}},"375":{"start":{"line":752,"column":12},"end":{"line":752,"column":73}},"376":{"start":{"line":753,"column":12},"end":{"line":753,"column":77}},"377":{"start":{"line":754,"column":12},"end":{"line":754,"column":68}},"378":{"start":{"line":755,"column":12},"end":{"line":755,"column":66}},"379":{"start":{"line":756,"column":12},"end":{"line":761,"column":15}},"380":{"start":{"line":762,"column":12},"end":{"line":762,"column":116}},"381":{"start":{"line":763,"column":12},"end":{"line":763,"column":70}},"382":{"start":{"line":765,"column":8},"end":{"line":781,"column":11}},"383":{"start":{"line":766,"column":28},"end":{"line":770,"column":14}},"384":{"start":{"line":771,"column":12},"end":{"line":771,"column":68}},"385":{"start":{"line":772,"column":12},"end":{"line":772,"column":77}},"386":{"start":{"line":773,"column":12},"end":{"line":773,"column":68}},"387":{"start":{"line":774,"column":12},"end":{"line":779,"column":15}},"388":{"start":{"line":780,"column":12},"end":{"line":780,"column":142}},"389":{"start":{"line":783,"column":4},"end":{"line":1001,"column":7}},"390":{"start":{"line":784,"column":8},"end":{"line":787,"column":11}},"391":{"start":{"line":785,"column":12},"end":{"line":785,"column":63}},"392":{"start":{"line":786,"column":12},"end":{"line":786,"column":112}},"393":{"start":{"line":788,"column":8},"end":{"line":799,"column":11}},"394":{"start":{"line":789,"column":12},"end":{"line":789,"column":62}},"395":{"start":{"line":790,"column":12},"end":{"line":792,"column":15}},"396":{"start":{"line":793,"column":12},"end":{"line":798,"column":27}},"397":{"start":{"line":800,"column":8},"end":{"line":809,"column":11}},"398":{"start":{"line":801,"column":12},"end":{"line":801,"column":62}},"399":{"start":{"line":802,"column":12},"end":{"line":802,"column":48}},"400":{"start":{"line":803,"column":12},"end":{"line":808,"column":27}},"401":{"start":{"line":810,"column":8},"end":{"line":863,"column":11}},"402":{"start":{"line":811,"column":12},"end":{"line":811,"column":62}},"403":{"start":{"line":812,"column":12},"end":{"line":812,"column":87}},"404":{"start":{"line":813,"column":12},"end":{"line":835,"column":15}},"405":{"start":{"line":836,"column":27},"end":{"line":836,"column":62}},"406":{"start":{"line":837,"column":12},"end":{"line":862,"column":15}},"407":{"start":{"line":864,"column":8},"end":{"line":908,"column":11}},"408":{"start":{"line":865,"column":12},"end":{"line":865,"column":62}},"409":{"start":{"line":866,"column":12},"end":{"line":866,"column":87}},"410":{"start":{"line":867,"column":12},"end":{"line":889,"column":15}},"411":{"start":{"line":890,"column":27},"end":{"line":890,"column":62}},"412":{"start":{"line":891,"column":12},"end":{"line":907,"column":15}},"413":{"start":{"line":909,"column":8},"end":{"line":953,"column":11}},"414":{"start":{"line":910,"column":12},"end":{"line":910,"column":62}},"415":{"start":{"line":911,"column":12},"end":{"line":911,"column":87}},"416":{"start":{"line":912,"column":12},"end":{"line":934,"column":15}},"417":{"start":{"line":935,"column":27},"end":{"line":935,"column":62}},"418":{"start":{"line":936,"column":12},"end":{"line":952,"column":15}},"419":{"start":{"line":954,"column":8},"end":{"line":1000,"column":11}},"420":{"start":{"line":955,"column":12},"end":{"line":955,"column":62}},"421":{"start":{"line":956,"column":12},"end":{"line":956,"column":87}},"422":{"start":{"line":957,"column":12},"end":{"line":979,"column":15}},"423":{"start":{"line":980,"column":27},"end":{"line":982,"column":14}},"424":{"start":{"line":983,"column":12},"end":{"line":999,"column":15}},"425":{"start":{"line":1002,"column":4},"end":{"line":1139,"column":7}},"426":{"start":{"line":1003,"column":8},"end":{"line":1006,"column":11}},"427":{"start":{"line":1004,"column":12},"end":{"line":1004,"column":63}},"428":{"start":{"line":1005,"column":12},"end":{"line":1005,"column":125}},"429":{"start":{"line":1007,"column":8},"end":{"line":1020,"column":11}},"430":{"start":{"line":1008,"column":12},"end":{"line":1008,"column":62}},"431":{"start":{"line":1009,"column":35},"end":{"line":1009,"column":51}},"432":{"start":{"line":1010,"column":35},"end":{"line":1010,"column":51}},"433":{"start":{"line":1011,"column":29},"end":{"line":1011,"column":39}},"434":{"start":{"line":1012,"column":30},"end":{"line":1012,"column":41}},"435":{"start":{"line":1013,"column":12},"end":{"line":1013,"column":110}},"436":{"start":{"line":1014,"column":12},"end":{"line":1019,"column":16}},"437":{"start":{"line":1021,"column":8},"end":{"line":1138,"column":11}},"438":{"start":{"line":1022,"column":25},"end":{"line":1026,"column":14}},"439":{"start":{"line":1027,"column":25},"end":{"line":1027,"column":144}},"440":{"start":{"line":1028,"column":12},"end":{"line":1031,"column":15}},"441":{"start":{"line":1029,"column":16},"end":{"line":1029,"column":67}},"442":{"start":{"line":1030,"column":16},"end":{"line":1030,"column":121}},"443":{"start":{"line":1032,"column":12},"end":{"line":1037,"column":15}},"444":{"start":{"line":1033,"column":16},"end":{"line":1033,"column":66}},"445":{"start":{"line":1034,"column":16},"end":{"line":1034,"column":72}},"446":{"start":{"line":1035,"column":16},"end":{"line":1035,"column":63}},"447":{"start":{"line":1036,"column":16},"end":{"line":1036,"column":113}},"448":{"start":{"line":1038,"column":12},"end":{"line":1045,"column":15}},"449":{"start":{"line":1039,"column":16},"end":{"line":1039,"column":66}},"450":{"start":{"line":1040,"column":16},"end":{"line":1040,"column":72}},"451":{"start":{"line":1041,"column":28},"end":{"line":1041,"column":118}},"452":{"start":{"line":1042,"column":16},"end":{"line":1042,"column":80}},"453":{"start":{"line":1043,"column":16},"end":{"line":1043,"column":57}},"454":{"start":{"line":1044,"column":16},"end":{"line":1044,"column":58}},"455":{"start":{"line":1046,"column":12},"end":{"line":1060,"column":15}},"456":{"start":{"line":1047,"column":16},"end":{"line":1047,"column":66}},"457":{"start":{"line":1048,"column":16},"end":{"line":1048,"column":91}},"458":{"start":{"line":1049,"column":16},"end":{"line":1052,"column":19}},"459":{"start":{"line":1053,"column":16},"end":{"line":1053,"column":72}},"460":{"start":{"line":1054,"column":28},"end":{"line":1054,"column":118}},"461":{"start":{"line":1055,"column":16},"end":{"line":1055,"column":80}},"462":{"start":{"line":1056,"column":16},"end":{"line":1058,"column":19}},"463":{"start":{"line":1059,"column":16},"end":{"line":1059,"column":79}},"464":{"start":{"line":1061,"column":12},"end":{"line":1071,"column":15}},"465":{"start":{"line":1062,"column":16},"end":{"line":1062,"column":66}},"466":{"start":{"line":1063,"column":16},"end":{"line":1063,"column":77}},"467":{"start":{"line":1064,"column":16},"end":{"line":1067,"column":19}},"468":{"start":{"line":1068,"column":16},"end":{"line":1070,"column":88}},"469":{"start":{"line":1072,"column":12},"end":{"line":1090,"column":15}},"470":{"start":{"line":1073,"column":16},"end":{"line":1073,"column":66}},"471":{"start":{"line":1074,"column":16},"end":{"line":1074,"column":72}},"472":{"start":{"line":1075,"column":16},"end":{"line":1078,"column":19}},"473":{"start":{"line":1079,"column":16},"end":{"line":1085,"column":19}},"474":{"start":{"line":1086,"column":16},"end":{"line":1089,"column":85}},"475":{"start":{"line":1091,"column":12},"end":{"line":1103,"column":15}},"476":{"start":{"line":1092,"column":16},"end":{"line":1092,"column":66}},"477":{"start":{"line":1093,"column":16},"end":{"line":1093,"column":72}},"478":{"start":{"line":1094,"column":16},"end":{"line":1097,"column":19}},"479":{"start":{"line":1098,"column":16},"end":{"line":1098,"column":51}},"480":{"start":{"line":1099,"column":16},"end":{"line":1102,"column":85}},"481":{"start":{"line":1104,"column":12},"end":{"line":1124,"column":15}},"482":{"start":{"line":1105,"column":16},"end":{"line":1105,"column":66}},"483":{"start":{"line":1106,"column":16},"end":{"line":1106,"column":91}},"484":{"start":{"line":1107,"column":16},"end":{"line":1107,"column":72}},"485":{"start":{"line":1108,"column":16},"end":{"line":1111,"column":19}},"486":{"start":{"line":1112,"column":16},"end":{"line":1119,"column":19}},"487":{"start":{"line":1120,"column":16},"end":{"line":1123,"column":128}},"488":{"start":{"line":1125,"column":12},"end":{"line":1137,"column":15}},"489":{"start":{"line":1126,"column":16},"end":{"line":1126,"column":66}},"490":{"start":{"line":1127,"column":16},"end":{"line":1127,"column":72}},"491":{"start":{"line":1128,"column":16},"end":{"line":1128,"column":80}},"492":{"start":{"line":1129,"column":16},"end":{"line":1133,"column":19}},"493":{"start":{"line":1134,"column":16},"end":{"line":1136,"column":31}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":33}},"loc":{"start":{"line":9,"column":39},"end":{"line":13,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":17,"column":12},"end":{"line":17,"column":13}},"loc":{"start":{"line":17,"column":26},"end":{"line":19,"column":13}},"line":17},"2":{"name":"(anonymous_2)","decl":{"start":{"line":27,"column":12},"end":{"line":27,"column":13}},"loc":{"start":{"line":27,"column":26},"end":{"line":29,"column":13}},"line":27},"3":{"name":"(anonymous_3)","decl":{"start":{"line":37,"column":12},"end":{"line":37,"column":13}},"loc":{"start":{"line":37,"column":26},"end":{"line":39,"column":13}},"line":37},"4":{"name":"(anonymous_4)","decl":{"start":{"line":44,"column":69},"end":{"line":44,"column":70}},"loc":{"start":{"line":44,"column":73},"end":{"line":1140,"column":1}},"line":44},"5":{"name":"(anonymous_5)","decl":{"start":{"line":102,"column":15},"end":{"line":102,"column":16}},"loc":{"start":{"line":102,"column":19},"end":{"line":104,"column":5}},"line":102},"6":{"name":"(anonymous_6)","decl":{"start":{"line":105,"column":14},"end":{"line":105,"column":15}},"loc":{"start":{"line":105,"column":18},"end":{"line":138,"column":5}},"line":105},"7":{"name":"(anonymous_7)","decl":{"start":{"line":139,"column":33},"end":{"line":139,"column":34}},"loc":{"start":{"line":139,"column":37},"end":{"line":364,"column":5}},"line":139},"8":{"name":"(anonymous_8)","decl":{"start":{"line":146,"column":76},"end":{"line":146,"column":77}},"loc":{"start":{"line":146,"column":86},"end":{"line":156,"column":9}},"line":146},"9":{"name":"(anonymous_9)","decl":{"start":{"line":157,"column":98},"end":{"line":157,"column":99}},"loc":{"start":{"line":157,"column":108},"end":{"line":177,"column":9}},"line":157},"10":{"name":"(anonymous_10)","decl":{"start":{"line":178,"column":70},"end":{"line":178,"column":71}},"loc":{"start":{"line":178,"column":80},"end":{"line":188,"column":9}},"line":178},"11":{"name":"(anonymous_11)","decl":{"start":{"line":189,"column":73},"end":{"line":189,"column":74}},"loc":{"start":{"line":189,"column":83},"end":{"line":197,"column":9}},"line":189},"12":{"name":"(anonymous_12)","decl":{"start":{"line":198,"column":84},"end":{"line":198,"column":85}},"loc":{"start":{"line":198,"column":94},"end":{"line":217,"column":9}},"line":198},"13":{"name":"(anonymous_13)","decl":{"start":{"line":218,"column":76},"end":{"line":218,"column":77}},"loc":{"start":{"line":218,"column":86},"end":{"line":227,"column":9}},"line":218},"14":{"name":"(anonymous_14)","decl":{"start":{"line":228,"column":140},"end":{"line":228,"column":141}},"loc":{"start":{"line":228,"column":150},"end":{"line":244,"column":9}},"line":228},"15":{"name":"(anonymous_15)","decl":{"start":{"line":245,"column":151},"end":{"line":245,"column":152}},"loc":{"start":{"line":245,"column":161},"end":{"line":261,"column":9}},"line":245},"16":{"name":"(anonymous_16)","decl":{"start":{"line":262,"column":70},"end":{"line":262,"column":71}},"loc":{"start":{"line":262,"column":80},"end":{"line":270,"column":9}},"line":262},"17":{"name":"(anonymous_17)","decl":{"start":{"line":271,"column":141},"end":{"line":271,"column":142}},"loc":{"start":{"line":271,"column":151},"end":{"line":284,"column":9}},"line":271},"18":{"name":"(anonymous_18)","decl":{"start":{"line":285,"column":140},"end":{"line":285,"column":141}},"loc":{"start":{"line":285,"column":150},"end":{"line":298,"column":9}},"line":285},"19":{"name":"(anonymous_19)","decl":{"start":{"line":299,"column":111},"end":{"line":299,"column":112}},"loc":{"start":{"line":299,"column":121},"end":{"line":311,"column":9}},"line":299},"20":{"name":"(anonymous_20)","decl":{"start":{"line":312,"column":64},"end":{"line":312,"column":65}},"loc":{"start":{"line":312,"column":74},"end":{"line":328,"column":9}},"line":312},"21":{"name":"(anonymous_21)","decl":{"start":{"line":329,"column":91},"end":{"line":329,"column":92}},"loc":{"start":{"line":329,"column":101},"end":{"line":345,"column":9}},"line":329},"22":{"name":"(anonymous_22)","decl":{"start":{"line":346,"column":99},"end":{"line":346,"column":100}},"loc":{"start":{"line":346,"column":109},"end":{"line":363,"column":9}},"line":346},"23":{"name":"(anonymous_23)","decl":{"start":{"line":365,"column":40},"end":{"line":365,"column":41}},"loc":{"start":{"line":365,"column":44},"end":{"line":581,"column":5}},"line":365},"24":{"name":"(anonymous_24)","decl":{"start":{"line":382,"column":103},"end":{"line":382,"column":104}},"loc":{"start":{"line":382,"column":113},"end":{"line":391,"column":9}},"line":382},"25":{"name":"(anonymous_25)","decl":{"start":{"line":392,"column":109},"end":{"line":392,"column":110}},"loc":{"start":{"line":392,"column":119},"end":{"line":402,"column":9}},"line":392},"26":{"name":"(anonymous_26)","decl":{"start":{"line":403,"column":127},"end":{"line":403,"column":128}},"loc":{"start":{"line":403,"column":137},"end":{"line":416,"column":9}},"line":403},"27":{"name":"(anonymous_27)","decl":{"start":{"line":406,"column":31},"end":{"line":406,"column":32}},"loc":{"start":{"line":406,"column":35},"end":{"line":406,"column":48}},"line":406},"28":{"name":"(anonymous_28)","decl":{"start":{"line":417,"column":96},"end":{"line":417,"column":97}},"loc":{"start":{"line":417,"column":106},"end":{"line":432,"column":9}},"line":417},"29":{"name":"(anonymous_29)","decl":{"start":{"line":420,"column":31},"end":{"line":420,"column":32}},"loc":{"start":{"line":420,"column":35},"end":{"line":420,"column":48}},"line":420},"30":{"name":"(anonymous_30)","decl":{"start":{"line":433,"column":100},"end":{"line":433,"column":101}},"loc":{"start":{"line":433,"column":110},"end":{"line":448,"column":9}},"line":433},"31":{"name":"(anonymous_31)","decl":{"start":{"line":436,"column":31},"end":{"line":436,"column":32}},"loc":{"start":{"line":436,"column":35},"end":{"line":436,"column":48}},"line":436},"32":{"name":"(anonymous_32)","decl":{"start":{"line":449,"column":104},"end":{"line":449,"column":105}},"loc":{"start":{"line":449,"column":114},"end":{"line":460,"column":9}},"line":449},"33":{"name":"(anonymous_33)","decl":{"start":{"line":461,"column":71},"end":{"line":461,"column":72}},"loc":{"start":{"line":461,"column":81},"end":{"line":480,"column":9}},"line":461},"34":{"name":"(anonymous_34)","decl":{"start":{"line":481,"column":88},"end":{"line":481,"column":89}},"loc":{"start":{"line":481,"column":98},"end":{"line":493,"column":9}},"line":481},"35":{"name":"(anonymous_35)","decl":{"start":{"line":494,"column":110},"end":{"line":494,"column":111}},"loc":{"start":{"line":494,"column":120},"end":{"line":510,"column":9}},"line":494},"36":{"name":"(anonymous_36)","decl":{"start":{"line":511,"column":113},"end":{"line":511,"column":114}},"loc":{"start":{"line":511,"column":123},"end":{"line":527,"column":9}},"line":511},"37":{"name":"(anonymous_37)","decl":{"start":{"line":528,"column":82},"end":{"line":528,"column":83}},"loc":{"start":{"line":528,"column":92},"end":{"line":546,"column":9}},"line":528},"38":{"name":"(anonymous_38)","decl":{"start":{"line":547,"column":116},"end":{"line":547,"column":117}},"loc":{"start":{"line":547,"column":126},"end":{"line":562,"column":9}},"line":547},"39":{"name":"(anonymous_39)","decl":{"start":{"line":563,"column":88},"end":{"line":563,"column":89}},"loc":{"start":{"line":563,"column":98},"end":{"line":580,"column":9}},"line":563},"40":{"name":"(anonymous_40)","decl":{"start":{"line":582,"column":39},"end":{"line":582,"column":40}},"loc":{"start":{"line":582,"column":43},"end":{"line":782,"column":5}},"line":582},"41":{"name":"(anonymous_41)","decl":{"start":{"line":589,"column":64},"end":{"line":589,"column":65}},"loc":{"start":{"line":589,"column":74},"end":{"line":596,"column":9}},"line":589},"42":{"name":"(anonymous_42)","decl":{"start":{"line":597,"column":76},"end":{"line":597,"column":77}},"loc":{"start":{"line":597,"column":86},"end":{"line":608,"column":9}},"line":597},"43":{"name":"(anonymous_43)","decl":{"start":{"line":609,"column":109},"end":{"line":609,"column":110}},"loc":{"start":{"line":609,"column":119},"end":{"line":620,"column":9}},"line":609},"44":{"name":"(anonymous_44)","decl":{"start":{"line":621,"column":143},"end":{"line":621,"column":144}},"loc":{"start":{"line":621,"column":153},"end":{"line":632,"column":9}},"line":621},"45":{"name":"(anonymous_45)","decl":{"start":{"line":633,"column":76},"end":{"line":633,"column":77}},"loc":{"start":{"line":633,"column":86},"end":{"line":642,"column":9}},"line":633},"46":{"name":"(anonymous_46)","decl":{"start":{"line":643,"column":140},"end":{"line":643,"column":141}},"loc":{"start":{"line":643,"column":150},"end":{"line":659,"column":9}},"line":643},"47":{"name":"(anonymous_47)","decl":{"start":{"line":660,"column":151},"end":{"line":660,"column":152}},"loc":{"start":{"line":660,"column":161},"end":{"line":676,"column":9}},"line":660},"48":{"name":"(anonymous_48)","decl":{"start":{"line":677,"column":70},"end":{"line":677,"column":71}},"loc":{"start":{"line":677,"column":80},"end":{"line":685,"column":9}},"line":677},"49":{"name":"(anonymous_49)","decl":{"start":{"line":686,"column":141},"end":{"line":686,"column":142}},"loc":{"start":{"line":686,"column":151},"end":{"line":699,"column":9}},"line":686},"50":{"name":"(anonymous_50)","decl":{"start":{"line":700,"column":140},"end":{"line":700,"column":141}},"loc":{"start":{"line":700,"column":150},"end":{"line":713,"column":9}},"line":700},"51":{"name":"(anonymous_51)","decl":{"start":{"line":714,"column":111},"end":{"line":714,"column":112}},"loc":{"start":{"line":714,"column":121},"end":{"line":726,"column":9}},"line":714},"52":{"name":"(anonymous_52)","decl":{"start":{"line":727,"column":132},"end":{"line":727,"column":133}},"loc":{"start":{"line":727,"column":142},"end":{"line":745,"column":9}},"line":727},"53":{"name":"(anonymous_53)","decl":{"start":{"line":746,"column":89},"end":{"line":746,"column":90}},"loc":{"start":{"line":746,"column":99},"end":{"line":764,"column":9}},"line":746},"54":{"name":"(anonymous_54)","decl":{"start":{"line":765,"column":95},"end":{"line":765,"column":96}},"loc":{"start":{"line":765,"column":105},"end":{"line":781,"column":9}},"line":765},"55":{"name":"(anonymous_55)","decl":{"start":{"line":783,"column":37},"end":{"line":783,"column":38}},"loc":{"start":{"line":783,"column":41},"end":{"line":1001,"column":5}},"line":783},"56":{"name":"(anonymous_56)","decl":{"start":{"line":784,"column":66},"end":{"line":784,"column":67}},"loc":{"start":{"line":784,"column":76},"end":{"line":787,"column":9}},"line":784},"57":{"name":"(anonymous_57)","decl":{"start":{"line":788,"column":87},"end":{"line":788,"column":88}},"loc":{"start":{"line":788,"column":97},"end":{"line":799,"column":9}},"line":788},"58":{"name":"(anonymous_58)","decl":{"start":{"line":800,"column":127},"end":{"line":800,"column":128}},"loc":{"start":{"line":800,"column":137},"end":{"line":809,"column":9}},"line":800},"59":{"name":"(anonymous_59)","decl":{"start":{"line":810,"column":67},"end":{"line":810,"column":68}},"loc":{"start":{"line":810,"column":77},"end":{"line":863,"column":9}},"line":810},"60":{"name":"(anonymous_60)","decl":{"start":{"line":864,"column":120},"end":{"line":864,"column":121}},"loc":{"start":{"line":864,"column":130},"end":{"line":908,"column":9}},"line":864},"61":{"name":"(anonymous_61)","decl":{"start":{"line":909,"column":197},"end":{"line":909,"column":198}},"loc":{"start":{"line":909,"column":207},"end":{"line":953,"column":9}},"line":909},"62":{"name":"(anonymous_62)","decl":{"start":{"line":954,"column":109},"end":{"line":954,"column":110}},"loc":{"start":{"line":954,"column":119},"end":{"line":1000,"column":9}},"line":954},"63":{"name":"(anonymous_63)","decl":{"start":{"line":1002,"column":50},"end":{"line":1002,"column":51}},"loc":{"start":{"line":1002,"column":54},"end":{"line":1139,"column":5}},"line":1002},"64":{"name":"(anonymous_64)","decl":{"start":{"line":1003,"column":66},"end":{"line":1003,"column":67}},"loc":{"start":{"line":1003,"column":76},"end":{"line":1006,"column":9}},"line":1003},"65":{"name":"(anonymous_65)","decl":{"start":{"line":1007,"column":52},"end":{"line":1007,"column":53}},"loc":{"start":{"line":1007,"column":62},"end":{"line":1020,"column":9}},"line":1007},"66":{"name":"(anonymous_66)","decl":{"start":{"line":1021,"column":46},"end":{"line":1021,"column":47}},"loc":{"start":{"line":1021,"column":50},"end":{"line":1138,"column":9}},"line":1021},"67":{"name":"(anonymous_67)","decl":{"start":{"line":1028,"column":70},"end":{"line":1028,"column":71}},"loc":{"start":{"line":1028,"column":80},"end":{"line":1031,"column":13}},"line":1028},"68":{"name":"(anonymous_68)","decl":{"start":{"line":1032,"column":76},"end":{"line":1032,"column":77}},"loc":{"start":{"line":1032,"column":86},"end":{"line":1037,"column":13}},"line":1032},"69":{"name":"(anonymous_69)","decl":{"start":{"line":1038,"column":74},"end":{"line":1038,"column":75}},"loc":{"start":{"line":1038,"column":84},"end":{"line":1045,"column":13}},"line":1038},"70":{"name":"(anonymous_70)","decl":{"start":{"line":1046,"column":71},"end":{"line":1046,"column":72}},"loc":{"start":{"line":1046,"column":81},"end":{"line":1060,"column":13}},"line":1046},"71":{"name":"(anonymous_71)","decl":{"start":{"line":1061,"column":96},"end":{"line":1061,"column":97}},"loc":{"start":{"line":1061,"column":106},"end":{"line":1071,"column":13}},"line":1061},"72":{"name":"(anonymous_72)","decl":{"start":{"line":1072,"column":95},"end":{"line":1072,"column":96}},"loc":{"start":{"line":1072,"column":105},"end":{"line":1090,"column":13}},"line":1072},"73":{"name":"(anonymous_73)","decl":{"start":{"line":1091,"column":136},"end":{"line":1091,"column":137}},"loc":{"start":{"line":1091,"column":146},"end":{"line":1103,"column":13}},"line":1091},"74":{"name":"(anonymous_74)","decl":{"start":{"line":1104,"column":144},"end":{"line":1104,"column":145}},"loc":{"start":{"line":1104,"column":154},"end":{"line":1124,"column":13}},"line":1104},"75":{"name":"(anonymous_75)","decl":{"start":{"line":1125,"column":58},"end":{"line":1125,"column":59}},"loc":{"start":{"line":1125,"column":68},"end":{"line":1137,"column":13}},"line":1125}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":11},"end":{"line":12,"column":5}},"type":"cond-expr","locations":[{"start":{"line":10,"column":35},"end":{"line":10,"column":38}},{"start":{"line":10,"column":41},"end":{"line":12,"column":5}}],"line":10},"1":{"loc":{"start":{"line":10,"column":11},"end":{"line":10,"column":32}},"type":"binary-expr","locations":[{"start":{"line":10,"column":11},"end":{"line":10,"column":14}},{"start":{"line":10,"column":18},"end":{"line":10,"column":32}}],"line":10}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":2,"6":1,"7":4,"8":1,"9":18,"10":1,"11":10,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":60,"24":1,"25":60,"26":60,"27":60,"28":60,"29":60,"30":60,"31":60,"32":60,"33":60,"34":60,"35":60,"36":60,"37":60,"38":60,"39":60,"40":60,"41":60,"42":60,"43":60,"44":60,"45":60,"46":60,"47":60,"48":60,"49":60,"50":60,"51":60,"52":60,"53":60,"54":60,"55":60,"56":60,"57":1,"58":1,"59":1,"60":1,"61":1,"62":1,"63":1,"64":1,"65":1,"66":1,"67":1,"68":1,"69":1,"70":1,"71":1,"72":1,"73":1,"74":1,"75":1,"76":1,"77":1,"78":1,"79":1,"80":1,"81":1,"82":1,"83":1,"84":1,"85":1,"86":1,"87":1,"88":1,"89":1,"90":1,"91":1,"92":1,"93":1,"94":1,"95":1,"96":1,"97":1,"98":1,"99":1,"100":1,"101":1,"102":1,"103":1,"104":1,"105":1,"106":1,"107":1,"108":1,"109":1,"110":1,"111":1,"112":1,"113":1,"114":1,"115":1,"116":1,"117":1,"118":1,"119":1,"120":1,"121":1,"122":1,"123":1,"124":1,"125":1,"126":1,"127":1,"128":1,"129":1,"130":1,"131":1,"132":1,"133":1,"134":1,"135":1,"136":1,"137":1,"138":1,"139":1,"140":1,"141":1,"142":1,"143":1,"144":1,"145":1,"146":1,"147":1,"148":1,"149":1,"150":1,"151":1,"152":1,"153":1,"154":1,"155":1,"156":1,"157":1,"158":1,"159":1,"160":1,"161":1,"162":1,"163":1,"164":1,"165":1,"166":1,"167":1,"168":1,"169":1,"170":1,"171":1,"172":1,"173":1,"174":1,"175":1,"176":1,"177":1,"178":1,"179":1,"180":1,"181":1,"182":1,"183":1,"184":1,"185":1,"186":1,"187":1,"188":1,"189":1,"190":2,"191":1,"192":1,"193":1,"194":1,"195":1,"196":1,"197":1,"198":1,"199":1,"200":1,"201":1,"202":1,"203":1,"204":1,"205":1,"206":1,"207":1,"208":1,"209":1,"210":1,"211":1,"212":1,"213":1,"214":1,"215":1,"216":1,"217":1,"218":1,"219":1,"220":1,"221":1,"222":1,"223":1,"224":1,"225":1,"226":1,"227":1,"228":1,"229":1,"230":1,"231":1,"232":1,"233":1,"234":1,"235":1,"236":1,"237":1,"238":1,"239":1,"240":1,"241":1,"242":1,"243":1,"244":1,"245":1,"246":1,"247":1,"248":1,"249":1,"250":1,"251":1,"252":1,"253":1,"254":1,"255":1,"256":1,"257":1,"258":1,"259":1,"260":1,"261":1,"262":1,"263":1,"264":1,"265":1,"266":1,"267":1,"268":1,"269":1,"270":1,"271":1,"272":1,"273":1,"274":1,"275":1,"276":1,"277":1,"278":1,"279":1,"280":1,"281":1,"282":1,"283":1,"284":1,"285":1,"286":1,"287":1,"288":1,"289":1,"290":1,"291":1,"292":1,"293":1,"294":1,"295":1,"296":1,"297":1,"298":1,"299":1,"300":1,"301":1,"302":1,"303":1,"304":1,"305":1,"306":1,"307":1,"308":1,"309":1,"310":1,"311":1,"312":1,"313":1,"314":1,"315":1,"316":1,"317":1,"318":1,"319":1,"320":1,"321":1,"322":1,"323":1,"324":1,"325":1,"326":1,"327":1,"328":1,"329":1,"330":1,"331":1,"332":1,"333":1,"334":1,"335":1,"336":1,"337":1,"338":1,"339":1,"340":1,"341":1,"342":1,"343":1,"344":1,"345":1,"346":1,"347":1,"348":1,"349":1,"350":1,"351":1,"352":1,"353":1,"354":1,"355":1,"356":1,"357":1,"358":1,"359":1,"360":1,"361":1,"362":1,"363":1,"364":1,"365":1,"366":1,"367":1,"368":1,"369":1,"370":1,"371":1,"372":1,"373":1,"374":1,"375":1,"376":1,"377":1,"378":1,"379":1,"380":1,"381":1,"382":1,"383":1,"384":1,"385":1,"386":1,"387":1,"388":1,"389":1,"390":1,"391":1,"392":1,"393":1,"394":1,"395":1,"396":1,"397":1,"398":1,"399":1,"400":1,"401":1,"402":1,"403":1,"404":1,"405":1,"406":1,"407":1,"408":1,"409":1,"410":1,"411":1,"412":1,"413":1,"414":1,"415":1,"416":1,"417":1,"418":1,"419":1,"420":1,"421":1,"422":1,"423":1,"424":1,"425":1,"426":1,"427":1,"428":1,"429":1,"430":1,"431":1,"432":1,"433":1,"434":1,"435":1,"436":1,"437":1,"438":1,"439":1,"440":1,"441":1,"442":1,"443":1,"444":1,"445":1,"446":1,"447":1,"448":1,"449":1,"450":1,"451":1,"452":1,"453":1,"454":1,"455":1,"456":1,"457":1,"458":1,"459":1,"460":1,"461":1,"462":1,"463":1,"464":1,"465":1,"466":1,"467":1,"468":1,"469":1,"470":1,"471":1,"472":1,"473":1,"474":1,"475":1,"476":1,"477":1,"478":1,"479":1,"480":1,"481":1,"482":1,"483":1,"484":1,"485":1,"486":1,"487":1,"488":1,"489":1,"490":1,"491":1,"492":1,"493":1},"f":{"0":2,"1":4,"2":18,"3":10,"4":1,"5":60,"6":60,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":2,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1,"61":1,"62":1,"63":1,"64":1,"65":1,"66":1,"67":1,"68":1,"69":1,"70":1,"71":1,"72":1,"73":1,"74":1,"75":1},"b":{"0":[0,2],"1":[2,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/room/sender/RoomServiceSender.spec.ts"],"sourcesContent":["import { RoomType } from '@rocket.chat/apps-engine/definition/rooms';\nimport { expect } from 'chai';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\nconst { FederatedRoomEE } = proxyquire.noCallThru().load('../../../../../../../../server/local-services/federation/domain/FederatedRoom', {\n\tmongodb: {\n\t\t'ObjectId': class ObjectId {\n\t\t\ttoHexString(): string {\n\t\t\t\treturn 'hexString';\n\t\t\t}\n\t\t},\n\t\t'@global': true,\n\t},\n});\nconst { FederatedUserEE } = proxyquire.noCallThru().load('../../../../../../../../server/local-services/federation/domain/FederatedUser', {\n\tmongodb: {\n\t\t'ObjectId': class ObjectId {\n\t\t\ttoHexString(): string {\n\t\t\t\treturn 'hexString';\n\t\t\t}\n\t\t},\n\t\t'@global': true,\n\t},\n});\nconst { FederationRoomServiceSender } = proxyquire\n\t.noCallThru()\n\t.load('../../../../../../../../server/local-services/federation/application/room/sender/RoomServiceSender', {\n\t\tmongodb: {\n\t\t\t'ObjectId': class ObjectId {\n\t\t\t\ttoHexString(): string {\n\t\t\t\t\treturn 'hexString';\n\t\t\t\t}\n\t\t\t},\n\t\t\t'@global': true,\n\t\t},\n\t});\n\ndescribe('FederationEE - Application - FederationRoomServiceSender', () => {\n\tlet service: typeof FederationRoomServiceSender;\n\tconst roomAdapter = {\n\t\tgetFederatedRoomByInternalId: sinon.stub(),\n\t\tupdateFederatedRoomByInternalRoomId: sinon.stub(),\n\t\tgetInternalRoomById: sinon.stub(),\n\t\tgetInternalRoomRolesByUserId: sinon.stub(),\n\t\tisUserAlreadyJoined: sinon.stub(),\n\t\tgetFederatedRoomByExternalId: sinon.stub(),\n\t\tcreateFederatedRoom: sinon.stub(),\n\t\taddUserToRoom: sinon.stub(),\n\t};\n\tconst userAdapter = {\n\t\tgetFederatedUserByExternalId: sinon.stub(),\n\t\tgetFederatedUserByInternalId: sinon.stub(),\n\t\tcreateFederatedUser: sinon.stub(),\n\t\tgetInternalUserById: sinon.stub(),\n\t\tgetFederatedUserByInternalUsername: sinon.stub(),\n\t\tcreateLocalUser: sinon.stub(),\n\t\tgetInternalUserByUsername: sinon.stub(),\n\t\tupdateFederationAvatar: sinon.stub(),\n\t\tsetAvatar: sinon.stub(),\n\t\tupdateRealName: sinon.stub(),\n\t};\n\tconst settingsAdapter = {\n\t\tgetHomeServerDomain: sinon.stub().returns('localDomain'),\n\t\tisFederationEnabled: sinon.stub(),\n\t\tgetMaximumSizeOfUsersWhenJoiningPublicRooms: sinon.stub(),\n\t};\n\tconst messageAdapter = {};\n\tconst bridge = {\n\t\tsearchPublicRooms: sinon.stub(),\n\t\tgetUserProfileInformation: sinon.stub().resolves({}),\n\t\textractHomeserverOrigin: sinon.stub(),\n\t\tcreateUser: sinon.stub(),\n\t\tinviteToRoom: sinon.stub(),\n\t\tcreateRoom: sinon.stub(),\n\t\tjoinRoom: sinon.stub(),\n\t\tconvertMatrixUrlToHttp: sinon.stub().returns('toHttpUrl'),\n\t\tgetRoomData: sinon.stub(),\n\t};\n\tconst fileAdapter = {\n\t\tgetBufferForAvatarFile: sinon.stub().resolves(undefined),\n\t};\n\tconst notificationAdapter = {\n\t\tsubscribeToUserTypingEventsOnFederatedRoomId: sinon.stub(),\n\t\tbroadcastUserTypingOnRoom: sinon.stub(),\n\t};\n\tconst queueAdapter = {\n\t\tenqueueJob: sinon.stub(),\n\t};\n\tconst invitees = [\n\t\t{\n\t\t\tinviteeUsernameOnly: 'marcos.defendi',\n\t\t\tnormalizedInviteeId: 'marcos.defendi:matrix.com',\n\t\t\trawInviteeId: '@marcos.defendi:matrix.com',\n\t\t},\n\t];\n\n\tbeforeEach(() => {\n\t\tservice = new FederationRoomServiceSender(\n\t\t\troomAdapter as any,\n\t\t\tuserAdapter as any,\n\t\t\tfileAdapter as any,\n\t\t\tsettingsAdapter as any,\n\t\t\tmessageAdapter as any,\n\t\t\tnotificationAdapter as any,\n\t\t\tqueueAdapter as any,\n\t\t\tbridge as any,\n\t\t);\n\t});\n\n\tafterEach(() => {\n\t\troomAdapter.getFederatedRoomByInternalId.reset();\n\t\troomAdapter.updateFederatedRoomByInternalRoomId.reset();\n\t\troomAdapter.getInternalRoomById.reset();\n\t\troomAdapter.getFederatedRoomByExternalId.reset();\n\t\troomAdapter.getInternalRoomRolesByUserId.reset();\n\t\troomAdapter.addUserToRoom.reset();\n\t\troomAdapter.createFederatedRoom.reset();\n\t\troomAdapter.isUserAlreadyJoined.reset();\n\t\tuserAdapter.getFederatedUserByInternalId.reset();\n\t\tuserAdapter.getInternalUserById.reset();\n\t\tuserAdapter.createFederatedUser.reset();\n\t\tuserAdapter.getFederatedUserByInternalUsername.reset();\n\t\tuserAdapter.createLocalUser.reset();\n\t\tuserAdapter.getInternalUserByUsername.reset();\n\t\tuserAdapter.getFederatedUserByExternalId.reset();\n\t\tuserAdapter.updateFederationAvatar.reset();\n\t\tuserAdapter.setAvatar.reset();\n\t\tuserAdapter.updateRealName.reset();\n\t\tbridge.extractHomeserverOrigin.reset();\n\t\tbridge.createUser.reset();\n\t\tbridge.createRoom.reset();\n\t\tbridge.inviteToRoom.reset();\n\t\tbridge.joinRoom.reset();\n\t\tbridge.getUserProfileInformation.reset();\n\t\tbridge.joinRoom.reset();\n\t\tbridge.searchPublicRooms.reset();\n\t\tbridge.getRoomData.reset();\n\t\tqueueAdapter.enqueueJob.reset();\n\t\tsettingsAdapter.isFederationEnabled.reset();\n\t\tsettingsAdapter.getMaximumSizeOfUsersWhenJoiningPublicRooms.reset();\n\t\tnotificationAdapter.broadcastUserTypingOnRoom.reset();\n\t\tnotificationAdapter.subscribeToUserTypingEventsOnFederatedRoomId.reset();\n\t});\n\n\tdescribe('#onRoomCreated()', () => {\n\t\tconst user = FederatedUserEE.createInstance('externalInviterId', {\n\t\t\tname: 'normalizedInviterId',\n\t\t\tusername: 'normalizedInviterId',\n\t\t\texistsOnlyOnProxyServer: true,\n\t\t});\n\t\tconst room = FederatedRoomEE.createInstance('externalRoomId', 'normalizedRoomId', user, RoomType.CHANNEL, 'externalRoomName');\n\n\t\tit('should NOT create the inviter user if the user already exists', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.onCall(0).resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalId.onCall(1).resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tawait service.onRoomCreated({ invitees } as any);\n\n\t\t\texpect(bridge.createUser.called).to.be.false;\n\t\t\texpect(userAdapter.createFederatedUser.called).to.be.false;\n\t\t});\n\n\t\tit('should create the inviter user both externally and internally if it does not exists', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.onCall(0).resolves(undefined);\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\tuserAdapter.getInternalUserById.resolves({ username: 'username', name: 'name' } as any);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.createUser.resolves('externalInviterId');\n\t\t\tawait service.onRoomCreated({ invitees } as any);\n\n\t\t\tconst inviter = FederatedUserEE.createInstance('externalInviterId', {\n\t\t\t\tname: 'name',\n\t\t\t\tusername: 'username',\n\t\t\t\texistsOnlyOnProxyServer: true,\n\t\t\t});\n\t\t\texpect(bridge.createUser.calledWith('username', 'name', 'localDomain')).to.be.true;\n\t\t\texpect(userAdapter.createFederatedUser.calledWith(inviter)).to.be.true;\n\t\t});\n\n\t\tit('should throw an error if the inviter user was not found', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(undefined);\n\t\t\tuserAdapter.getInternalUserById.resolves({ username: 'username', name: 'name' } as any);\n\n\t\t\tawait expect(service.onRoomCreated({ invitees, internalInviterId: 'internalInviterId' } as any)).to.be.rejectedWith(\n\t\t\t\t'User with internalId internalInviterId not found',\n\t\t\t);\n\t\t});\n\n\t\tit('should throw an error if the internal room does not exists', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\troomAdapter.getInternalRoomById.resolves(undefined);\n\t\t\tawait expect(\n\t\t\t\tservice.onRoomCreated({ invitees, internalInviterId: 'internalInviterId', internalRoomId: 'internalRoomId' } as any),\n\t\t\t).to.be.rejectedWith('Room with internalId internalRoomId not found');\n\t\t});\n\n\t\tit('should create the room in the proxy home server and update it locally', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getInternalRoomById.resolves({ name: 'name', t: RoomType.CHANNEL, topic: 'topic', _id: '_id' } as any);\n\t\t\troomAdapter.getFederatedRoomByInternalId.onCall(0).resolves(undefined);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.createRoom.resolves('externalRoomId');\n\t\t\tawait service.onRoomCreated({ invitees, internalInviterId: 'internalInviterId', internalRoomId: 'internalRoomId' } as any);\n\n\t\t\texpect(bridge.createRoom.calledWith(user.getExternalId(), RoomType.CHANNEL, 'name', 'topic')).to.be.true;\n\t\t\texpect(roomAdapter.updateFederatedRoomByInternalRoomId.calledWith('_id', 'externalRoomId')).to.be.true;\n\t\t});\n\n\t\tit('should NOT create the invitee user if the user already exists', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tawait service.onRoomCreated({ internalInviterId: 'internalInviterId', invitees } as any);\n\n\t\t\texpect(userAdapter.createFederatedUser.called).to.be.false;\n\t\t});\n\n\t\tit('should create the invitee user internally if it does not exists (using the username only if it is from the proxy home server)', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.onCall(0).resolves(undefined);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.extractHomeserverOrigin.returns('localDomain');\n\n\t\t\tawait service.onRoomCreated({ internalInviterId: 'internalInviterId', invitees } as any);\n\n\t\t\tconst invitee = FederatedUserEE.createInstance(invitees[0].rawInviteeId, {\n\t\t\t\tname: invitees[0].inviteeUsernameOnly,\n\t\t\t\tusername: invitees[0].inviteeUsernameOnly,\n\t\t\t\texistsOnlyOnProxyServer: true,\n\t\t\t});\n\n\t\t\texpect(userAdapter.createFederatedUser.calledWith(invitee)).to.be.true;\n\t\t});\n\n\t\tit('should create the invitee user internally if it does not exists (using the normalized invite id if it is NOT from the proxy home server)', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.onCall(0).resolves(undefined);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.extractHomeserverOrigin.returns('externalDomain');\n\n\t\t\tawait service.onRoomCreated({ internalInviterId: 'internalInviterId', invitees } as any);\n\n\t\t\tconst invitee = FederatedUserEE.createInstance(invitees[0].rawInviteeId, {\n\t\t\t\tname: invitees[0].normalizedInviteeId,\n\t\t\t\tusername: invitees[0].normalizedInviteeId,\n\t\t\t\texistsOnlyOnProxyServer: false,\n\t\t\t});\n\n\t\t\texpect(userAdapter.createFederatedUser.calledWith(invitee)).to.be.true;\n\t\t});\n\n\t\tit('should throw an error if the invitee user was not found', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(undefined);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\n\t\t\tawait expect(service.onRoomCreated({ invitees, internalInviterId: 'internalInviterId' } as any)).to.be.rejectedWith(\n\t\t\t\t`User with internalUsername ${invitees[0].normalizedInviteeId} not found`,\n\t\t\t);\n\t\t});\n\n\t\tit('should create the invitee user on the proxy home server if the invitee is from the same home server AND it does not exists yet', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.extractHomeserverOrigin.returns('localDomain');\n\t\t\tbridge.getUserProfileInformation.resolves(undefined);\n\n\t\t\tawait service.onRoomCreated({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t\t...invitees[0],\n\t\t\t} as any);\n\n\t\t\texpect(bridge.createUser.calledWith(invitees[0].inviteeUsernameOnly, user.getName(), 'localDomain')).to.be.true;\n\t\t});\n\n\t\tit('should NOT create the invitee user on the proxy home server if the invitee is from the same home server but it already exists', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.extractHomeserverOrigin.returns('localDomain');\n\t\t\tbridge.getUserProfileInformation.resolves({});\n\n\t\t\tawait service.onRoomCreated({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t\t...invitees[0],\n\t\t\t} as any);\n\n\t\t\texpect(bridge.createUser.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT create the invitee user on the proxy home server if its not from the same home server', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.extractHomeserverOrigin.returns('externalDomain');\n\n\t\t\tawait service.onRoomCreated({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t\t...invitees[0],\n\t\t\t} as any);\n\n\t\t\texpect(bridge.createUser.called).to.be.false;\n\t\t});\n\n\t\tit('should always invite the invitee user to the room', async () => {\n\t\t\tconst invitee = FederatedUserEE.createInstance('externalInviteeId', {\n\t\t\t\tname: 'normalizedInviteeId',\n\t\t\t\tusername: 'normalizedInviteeId',\n\t\t\t\texistsOnlyOnProxyServer: true,\n\t\t\t});\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(invitee);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\n\t\t\tawait service.onRoomCreated({\n\t\t\t\tinvitees,\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t\t...invitees[0],\n\t\t\t} as any);\n\n\t\t\texpect(bridge.inviteToRoom.calledWith(room.getExternalId(), user.getExternalId(), invitee.getExternalId())).to.be.true;\n\t\t});\n\n\t\tit('should automatically join the invitee if he/she is from the proxy homeserver', async () => {\n\t\t\tconst invitee = FederatedUserEE.createInstance('externalInviteeId', {\n\t\t\t\tname: 'normalizedInviteeId',\n\t\t\t\tusername: 'normalizedInviteeId',\n\t\t\t\texistsOnlyOnProxyServer: true,\n\t\t\t});\n\t\t\tbridge.extractHomeserverOrigin.returns('localDomain');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(invitee);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\n\t\t\tawait service.onRoomCreated({ invitees, internalRoomId: 'internalRoomId', ...invitees[0] } as any);\n\n\t\t\texpect(bridge.joinRoom.calledWith(room.getExternalId(), invitee.getExternalId())).to.be.true;\n\t\t});\n\n\t\tit('should NOT automatically join the invitee if he/she is NOT from the proxy homeserver', async () => {\n\t\t\tconst invitee = FederatedUserEE.createInstance('externalInviteeId', {\n\t\t\t\tname: 'normalizedInviteeId',\n\t\t\t\tusername: 'normalizedInviteeId',\n\t\t\t\texistsOnlyOnProxyServer: true,\n\t\t\t});\n\t\t\tbridge.extractHomeserverOrigin.returns('externalDomain');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(invitee);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\n\t\t\tawait service.onRoomCreated({ invitees, internalRoomId: 'internalRoomId', ...invitees[0], ahahha: 'ahha' } as any);\n\n\t\t\texpect(bridge.joinRoom.called).to.be.false;\n\t\t});\n\t});\n\n\tdescribe('#beforeAddUserToARoom()', () => {\n\t\tconst federatedUser = FederatedUserEE.createInstance('externalInviteeId', {\n\t\t\tname: 'normalizedInviteeId',\n\t\t\tusername: 'normalizedInviteeId',\n\t\t\texistsOnlyOnProxyServer: false,\n\t\t});\n\t\tconst room = FederatedRoomEE.createInstance('externalRoomId', 'normalizedRoomId', federatedUser, RoomType.CHANNEL, 'externalRoomName');\n\t\tconst validParams = {\n\t\t\tinvitees: [\n\t\t\t\t...invitees,\n\t\t\t\t{\n\t\t\t\t\tinviteeUsernameOnly: 'marcos.defendiNotToBeInvited',\n\t\t\t\t\tnormalizedInviteeId: 'marcos.defendi:matrix.comNotToBeInvited',\n\t\t\t\t\trawInviteeId: '@marcos.defendi:matrix.comNotToBeInvited',\n\t\t\t\t},\n\t\t\t],\n\t\t} as any;\n\n\t\tit('should not create the invitee locally if the inviter was provided but it does not exists', async () => {\n\t\t\tconst createUsersLocallyOnlySpy = sinon.spy(service, 'createUsersLocallyOnly');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(undefined);\n\n\t\t\tawait service.beforeAddUserToARoom({\n\t\t\t\t...validParams,\n\t\t\t\tinternalInviter: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t});\n\t\t\texpect(createUsersLocallyOnlySpy.called).to.be.false;\n\t\t});\n\n\t\tit('should not create the invitee locally if the inviter was provided but the room does not exists', async () => {\n\t\t\tconst createUsersLocallyOnlySpy = sinon.spy(service, 'createUsersLocallyOnly');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(federatedUser);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(undefined);\n\n\t\t\tawait service.beforeAddUserToARoom({\n\t\t\t\t...validParams,\n\t\t\t\tinternalInviter: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t});\n\t\t\texpect(createUsersLocallyOnlySpy.called).to.be.false;\n\t\t});\n\n\t\tit('should throw an error if the inviter was provided and he/she is not neither owner, moderator or the room creator', async () => {\n\t\t\tconst createUsersLocallyOnlySpy = sinon.spy(service, 'createUsersLocallyOnly');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves({ getInternalId: () => 'differentId' });\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\troomAdapter.getInternalRoomRolesByUserId.resolves([]);\n\n\t\t\tawait expect(\n\t\t\t\tservice.beforeAddUserToARoom({\n\t\t\t\t\t...validParams,\n\t\t\t\t\tinternalInviter: 'internalInviterId',\n\t\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t\t}),\n\t\t\t).to.be.rejectedWith('You are not allowed to add users to this room');\n\t\t\texpect(createUsersLocallyOnlySpy.called).to.be.false;\n\t\t});\n\n\t\tit('should create the user locally if the inviter was provided and he/she is an owner', async () => {\n\t\t\tconst createUsersLocallyOnlySpy = sinon.spy(service, 'createUsersLocallyOnly');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves({ getInternalId: () => 'differentId' });\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\troomAdapter.getInternalRoomRolesByUserId.resolves(['owner']);\n\n\t\t\tawait service.beforeAddUserToARoom({\n\t\t\t\t...validParams,\n\t\t\t\tinternalInviter: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t});\n\n\t\t\texpect(createUsersLocallyOnlySpy.calledWith(validParams.invitees)).to.be.true;\n\t\t});\n\n\t\tit('should create the user locally if the inviter was provided and he/she is an moderator', async () => {\n\t\t\tconst createUsersLocallyOnlySpy = sinon.spy(service, 'createUsersLocallyOnly');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves({ getInternalId: () => 'differentId' });\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\troomAdapter.getInternalRoomRolesByUserId.resolves(['moderator']);\n\n\t\t\tawait service.beforeAddUserToARoom({\n\t\t\t\t...validParams,\n\t\t\t\tinternalInviter: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t});\n\n\t\t\texpect(createUsersLocallyOnlySpy.calledWith(validParams.invitees)).to.be.true;\n\t\t});\n\n\t\tit('should create the user locally if the inviter was provided and he/she is the room creator', async () => {\n\t\t\tconst createUsersLocallyOnlySpy = sinon.spy(service, 'createUsersLocallyOnly');\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(federatedUser);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\troomAdapter.getInternalRoomRolesByUserId.resolves([]);\n\n\t\t\tawait service.beforeAddUserToARoom({\n\t\t\t\t...validParams,\n\t\t\t\tinternalInviter: 'internalInviterId',\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t});\n\n\t\t\texpect(createUsersLocallyOnlySpy.calledWith(validParams.invitees)).to.be.true;\n\t\t});\n\n\t\tit('should create the invitee locally for each external user', async () => {\n\t\t\tconst avatarSpy = sinon.spy(service, 'updateUserAvatarInternally');\n\t\t\tconst displayNameSpy = sinon.spy(service, 'updateUserDisplayNameInternally');\n\n\t\t\tbridge.extractHomeserverOrigin.onCall(0).returns('externalDomain');\n\t\t\tbridge.extractHomeserverOrigin.onCall(1).returns('localDomain');\n\t\t\tbridge.getUserProfileInformation.resolves({ avatarUrl: 'avatarUrl', displayName: 'displayName' });\n\t\t\tuserAdapter.getFederatedUserByExternalId.resolves(federatedUser);\n\n\t\t\tawait service.beforeAddUserToARoom(validParams);\n\n\t\t\tconst invitee = FederatedUserEE.createLocalInstanceOnly({\n\t\t\t\tname: 'displayName',\n\t\t\t\tusername: invitees[0].normalizedInviteeId,\n\t\t\t\texistsOnlyOnProxyServer: false,\n\t\t\t});\n\n\t\t\texpect(userAdapter.createLocalUser.calledOnceWithExactly(invitee)).to.be.true;\n\t\t\texpect(avatarSpy.calledWith(federatedUser, 'avatarUrl')).to.be.true;\n\t\t\texpect(displayNameSpy.calledWith(federatedUser, 'displayName')).to.be.true;\n\t\t});\n\n\t\tit('should NOT update the avatar nor the display name if both does not exists', async () => {\n\t\t\tbridge.extractHomeserverOrigin.onCall(0).returns('externalDomain');\n\t\t\tbridge.extractHomeserverOrigin.onCall(1).returns('localDomain');\n\t\t\tbridge.getUserProfileInformation.resolves({ avatarUrl: '', displayName: '' });\n\t\t\tuserAdapter.getFederatedUserByExternalId.resolves(federatedUser);\n\n\t\t\tawait service.beforeAddUserToARoom(validParams);\n\n\t\t\texpect(userAdapter.setAvatar.called).to.be.false;\n\t\t\texpect(userAdapter.updateFederationAvatar.called).to.be.false;\n\t\t\texpect(userAdapter.updateRealName.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT update the avatar url nor the display name if the user is from the local home server', async () => {\n\t\t\tuserAdapter.getFederatedUserByExternalId.resolves(\n\t\t\t\tFederatedUserEE.createInstance('externalInviterId', {\n\t\t\t\t\tname: 'normalizedInviterId',\n\t\t\t\t\tusername: 'normalizedInviterId',\n\t\t\t\t\texistsOnlyOnProxyServer: true,\n\t\t\t\t}),\n\t\t\t);\n\t\t\tbridge.extractHomeserverOrigin.onCall(0).returns('externalDomain');\n\t\t\tbridge.extractHomeserverOrigin.onCall(1).returns('localDomain');\n\t\t\tbridge.getUserProfileInformation.resolves({ avatarUrl: 'avatarUrl', displayName: 'displayName' });\n\n\t\t\tawait service.beforeAddUserToARoom(validParams);\n\n\t\t\texpect(userAdapter.setAvatar.called).to.be.false;\n\t\t\texpect(userAdapter.updateFederationAvatar.called).to.be.false;\n\t\t\texpect(userAdapter.updateRealName.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT update the avatar url if the url received in the event is equal to the one already used', async () => {\n\t\t\tconst existsOnlyOnProxyServer = false;\n\t\t\tuserAdapter.getFederatedUserByExternalId.resolves(\n\t\t\t\tFederatedUserEE.createWithInternalReference('externalInviterId', existsOnlyOnProxyServer, {\n\t\t\t\t\tfederation: {\n\t\t\t\t\t\tavatarUrl: 'avatarUrl',\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t);\n\t\t\tbridge.extractHomeserverOrigin.onCall(0).returns('externalDomain');\n\t\t\tbridge.extractHomeserverOrigin.onCall(1).returns('localDomain');\n\t\t\tbridge.getUserProfileInformation.resolves({ avatarUrl: 'avatarUrl', displayName: 'displayName' });\n\n\t\t\tawait service.beforeAddUserToARoom(validParams);\n\n\t\t\texpect(userAdapter.setAvatar.called).to.be.false;\n\t\t\texpect(userAdapter.updateFederationAvatar.called).to.be.false;\n\t\t});\n\n\t\tit('should call the functions to update the avatar internally correctly', async () => {\n\t\t\tconst existsOnlyOnProxyServer = false;\n\t\t\tconst userAvatar = FederatedUserEE.createWithInternalReference('externalInviterId', existsOnlyOnProxyServer, {\n\t\t\t\tfederation: {\n\t\t\t\t\tavatarUrl: 'currentAvatarUrl',\n\t\t\t\t},\n\t\t\t\t_id: 'userId',\n\t\t\t});\n\t\t\tuserAdapter.getFederatedUserByExternalId.resolves(userAvatar);\n\t\t\tbridge.extractHomeserverOrigin.onCall(0).returns('externalDomain');\n\t\t\tbridge.extractHomeserverOrigin.onCall(1).returns('localDomain');\n\t\t\tbridge.getUserProfileInformation.resolves({ avatarUrl: 'avatarUrl', displayName: 'displayName' });\n\n\t\t\tawait service.beforeAddUserToARoom(validParams);\n\n\t\t\texpect(userAdapter.setAvatar.calledWith(userAvatar, 'toHttpUrl')).to.be.true;\n\t\t\texpect(userAdapter.updateFederationAvatar.calledWith(userAvatar.getInternalId(), 'avatarUrl')).to.be.true;\n\t\t});\n\n\t\tit('should NOT update the display name if the name received in the event is equal to the one already used', async () => {\n\t\t\tconst existsOnlyOnProxyServer = false;\n\t\t\tuserAdapter.getFederatedUserByExternalId.resolves(\n\t\t\t\tFederatedUserEE.createWithInternalReference('externalInviterId', existsOnlyOnProxyServer, {\n\t\t\t\t\tname: 'displayName',\n\t\t\t\t}),\n\t\t\t);\n\t\t\tbridge.extractHomeserverOrigin.onCall(0).returns('externalDomain');\n\t\t\tbridge.extractHomeserverOrigin.onCall(1).returns('localDomain');\n\t\t\tbridge.getUserProfileInformation.resolves({ avatarUrl: '', displayName: 'displayName' });\n\n\t\t\tawait service.beforeAddUserToARoom(validParams);\n\n\t\t\texpect(userAdapter.setAvatar.called).to.be.false;\n\t\t\texpect(userAdapter.updateFederationAvatar.called).to.be.false;\n\t\t\texpect(userAdapter.updateRealName.called).to.be.false;\n\t\t});\n\n\t\tit('should call the functions to update the display name internally correctly', async () => {\n\t\t\tconst existsOnlyOnProxyServer = false;\n\t\t\tconst user = FederatedUserEE.createWithInternalReference('externalInviterId', existsOnlyOnProxyServer, {\n\t\t\t\t_id: 'userId',\n\t\t\t\tname: 'currentName',\n\t\t\t});\n\t\t\tuserAdapter.getFederatedUserByExternalId.resolves(user);\n\t\t\tbridge.extractHomeserverOrigin.onCall(0).returns('externalDomain');\n\t\t\tbridge.extractHomeserverOrigin.onCall(1).returns('localDomain');\n\t\t\tbridge.getUserProfileInformation.resolves({ avatarUrl: '', displayName: 'displayName' });\n\n\t\t\tawait service.beforeAddUserToARoom(validParams);\n\n\t\t\texpect(userAdapter.setAvatar.called).to.be.false;\n\t\t\texpect(userAdapter.updateFederationAvatar.called).to.be.false;\n\t\t\texpect(userAdapter.updateRealName.calledWith(user.getInternalReference(), 'displayName')).to.be.true;\n\t\t});\n\t});\n\n\tdescribe('#onUsersAddedToARoom()', () => {\n\t\tconst user = FederatedUserEE.createInstance('externalInviterId', {\n\t\t\tname: 'normalizedInviterId',\n\t\t\tusername: 'normalizedInviterId',\n\t\t\texistsOnlyOnProxyServer: true,\n\t\t});\n\t\tconst room = FederatedRoomEE.createInstance('externalRoomId', 'normalizedRoomId', user, RoomType.CHANNEL, 'externalRoomName');\n\n\t\tit('should throw an error if the room does not exists', async () => {\n\t\t\troomAdapter.getInternalRoomById.resolves(undefined);\n\t\t\tawait expect(\n\t\t\t\tservice.onUsersAddedToARoom({ invitees, internalInviterId: 'internalInviterId', internalRoomId: 'internalRoomId' } as any),\n\t\t\t).to.be.rejectedWith('Could not find the room to invite. RoomId: internalRoomId');\n\t\t});\n\n\t\tit('should NOT create the inviter user if the user already exists', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.onCall(0).resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalId.onCall(1).resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tawait service.onUsersAddedToARoom({ internalInviterId: 'internalInviterId', invitees } as any);\n\n\t\t\texpect(bridge.createUser.called).to.be.false;\n\t\t\texpect(userAdapter.createFederatedUser.called).to.be.false;\n\t\t});\n\n\t\tit('should throw an error if the inviter user was not found and the user is not joining by himself', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(undefined);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tuserAdapter.getInternalUserById.resolves({ username: 'username', name: 'name' } as any);\n\n\t\t\tawait expect(service.onUsersAddedToARoom({ invitees, internalInviterId: 'internalInviterId' } as any)).to.be.rejectedWith(\n\t\t\t\t'User with internalId internalInviterId not found',\n\t\t\t);\n\t\t});\n\n\t\tit('should NOT throw an error if the inviter user was not found but the user is joining by himself (which means there is no inviter)', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(undefined);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tuserAdapter.getInternalUserById.resolves({ username: 'username', name: 'name' } as any);\n\n\t\t\tawait expect(service.onUsersAddedToARoom({ invitees, internalInviterId: '' } as any)).not.to.be.rejectedWith(\n\t\t\t\t'User with internalId internalInviterId not found',\n\t\t\t);\n\t\t});\n\n\t\tit('should NOT create the invitee user if the user already exists', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tawait service.onUsersAddedToARoom({ internalInviterId: 'internalInviterId', invitees } as any);\n\n\t\t\texpect(userAdapter.createFederatedUser.called).to.be.false;\n\t\t});\n\n\t\tit('should create the invitee user internally if it does not exists (using the username only if it is from the proxy home server)', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.onCall(0).resolves(undefined);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.extractHomeserverOrigin.returns('localDomain');\n\n\t\t\tawait service.onUsersAddedToARoom({ internalInviterId: 'internalInviterId', invitees } as any);\n\n\t\t\tconst invitee = FederatedUserEE.createInstance(invitees[0].rawInviteeId, {\n\t\t\t\tname: invitees[0].inviteeUsernameOnly,\n\t\t\t\tusername: invitees[0].inviteeUsernameOnly,\n\t\t\t\texistsOnlyOnProxyServer: true,\n\t\t\t});\n\n\t\t\texpect(userAdapter.createFederatedUser.calledWith(invitee)).to.be.true;\n\t\t});\n\n\t\tit('should create the invitee user internally if it does not exists (using the normalized invite id if it is NOT from the proxy home server)', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.onCall(0).resolves(undefined);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.extractHomeserverOrigin.returns('externalDomain');\n\n\t\t\tawait service.onUsersAddedToARoom({ internalInviterId: 'internalInviterId', invitees } as any);\n\n\t\t\tconst invitee = FederatedUserEE.createInstance(invitees[0].rawInviteeId, {\n\t\t\t\tname: invitees[0].normalizedInviteeId,\n\t\t\t\tusername: invitees[0].normalizedInviteeId,\n\t\t\t\texistsOnlyOnProxyServer: false,\n\t\t\t});\n\n\t\t\texpect(userAdapter.createFederatedUser.calledWith(invitee)).to.be.true;\n\t\t});\n\n\t\tit('should throw an error if the invitee user was not found', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(undefined);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\n\t\t\tawait expect(service.onUsersAddedToARoom({ invitees, internalInviterId: 'internalInviterId' } as any)).to.be.rejectedWith(\n\t\t\t\t`User with internalUsername ${invitees[0].normalizedInviteeId} not found`,\n\t\t\t);\n\t\t});\n\n\t\tit('should create the invitee user on the proxy home server if the invitee is from the same home server AND it does not exists yet', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.extractHomeserverOrigin.returns('localDomain');\n\t\t\tbridge.getUserProfileInformation.resolves(undefined);\n\n\t\t\tawait service.onUsersAddedToARoom({\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinvitees,\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t\t...invitees[0],\n\t\t\t} as any);\n\n\t\t\texpect(bridge.createUser.calledWith(invitees[0].inviteeUsernameOnly, user.getName(), 'localDomain')).to.be.true;\n\t\t});\n\n\t\tit('should NOT create the invitee user on the proxy home server if the invitee is from the same home server but it already exists', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.extractHomeserverOrigin.returns('localDomain');\n\t\t\tbridge.getUserProfileInformation.resolves({});\n\n\t\t\tawait service.onUsersAddedToARoom({\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinvitees,\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t\t...invitees[0],\n\t\t\t} as any);\n\n\t\t\texpect(bridge.createUser.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT create the invitee user on the proxy home server if its not from the same home server', async () => {\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(user);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.extractHomeserverOrigin.returns('externalDomain');\n\n\t\t\tawait service.onUsersAddedToARoom({\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinvitees,\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t\t...invitees[0],\n\t\t\t} as any);\n\n\t\t\texpect(bridge.createUser.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT auto-join the user to the room if the user is auto-joining the room but he is NOT from the same homeserver', async () => {\n\t\t\tconst invitee = FederatedUserEE.createInstance('externalInviteeId', {\n\t\t\t\tname: 'normalizedInviteeId',\n\t\t\t\tusername: 'normalizedInviteeId',\n\t\t\t\texistsOnlyOnProxyServer: true,\n\t\t\t});\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(undefined);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(invitee);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.extractHomeserverOrigin.returns('externalDomain');\n\n\t\t\tawait service.onUsersAddedToARoom({\n\t\t\t\tinternalInviterId: '',\n\t\t\t\tinvitees,\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t\t...invitees[0],\n\t\t\t} as any);\n\n\t\t\texpect(bridge.joinRoom.called).to.be.false;\n\t\t\texpect(bridge.inviteToRoom.called).to.be.false;\n\t\t});\n\n\t\tit('should auto-join the user to the room if the user is auto-joining the room', async () => {\n\t\t\tconst invitee = FederatedUserEE.createInstance('externalInviteeId', {\n\t\t\t\tname: 'normalizedInviteeId',\n\t\t\t\tusername: 'normalizedInviteeId',\n\t\t\t\texistsOnlyOnProxyServer: true,\n\t\t\t});\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(undefined);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(invitee);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\t\t\tbridge.extractHomeserverOrigin.returns('localDomain');\n\n\t\t\tawait service.onUsersAddedToARoom({\n\t\t\t\tinternalInviterId: '',\n\t\t\t\tinvitees,\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t\t...invitees[0],\n\t\t\t} as any);\n\n\t\t\texpect(bridge.joinRoom.calledWith(room.getExternalId(), invitee.getExternalId())).to.be.true;\n\t\t\texpect(bridge.inviteToRoom.called).to.be.false;\n\t\t});\n\n\t\tit('should invite the user to the user only if the user is NOT auto-joining the room', async () => {\n\t\t\tconst invitee = FederatedUserEE.createInstance('externalInviteeId', {\n\t\t\t\tname: 'normalizedInviteeId',\n\t\t\t\tusername: 'normalizedInviteeId',\n\t\t\t\texistsOnlyOnProxyServer: true,\n\t\t\t});\n\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\tuserAdapter.getFederatedUserByInternalUsername.resolves(invitee);\n\t\t\troomAdapter.getFederatedRoomByInternalId.resolves(room);\n\n\t\t\tawait service.onUsersAddedToARoom({\n\t\t\t\tinternalInviterId: 'internalInviterId',\n\t\t\t\tinvitees,\n\t\t\t\tinternalRoomId: 'internalRoomId',\n\t\t\t\t...invitees[0],\n\t\t\t} as any);\n\n\t\t\texpect(bridge.inviteToRoom.calledWith(room.getExternalId(), user.getExternalId(), invitee.getExternalId())).to.be.true;\n\t\t});\n\t});\n\n\tdescribe('#searchPublicRooms()', () => {\n\t\tit('should throw an error if the federation is disabled', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(false);\n\t\t\tawait expect(service.searchPublicRooms({} as any)).to.be.rejectedWith('Federation is disabled');\n\t\t});\n\n\t\tit('should call the bridge search public rooms with the provided server name', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\tawait service.searchPublicRooms({ serverName: 'serverName' } as any);\n\t\t\texpect(\n\t\t\t\tbridge.searchPublicRooms.calledWith({\n\t\t\t\t\tserverName: 'serverName',\n\t\t\t\t\troomName: undefined,\n\t\t\t\t\tlimit: undefined,\n\t\t\t\t\tpageToken: undefined,\n\t\t\t\t}),\n\t\t\t).to.be.true;\n\t\t});\n\n\t\tit('should call the bridge search public rooms with the proxy home server name when the server name was not provided', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\tawait service.searchPublicRooms({} as any);\n\t\t\texpect(\n\t\t\t\tbridge.searchPublicRooms.calledWith({\n\t\t\t\t\tserverName: 'localDomain',\n\t\t\t\t\troomName: undefined,\n\t\t\t\t\tlimit: undefined,\n\t\t\t\t\tpageToken: undefined,\n\t\t\t\t}),\n\t\t\t).to.be.true;\n\t\t});\n\n\t\tit('should return the Matrix public rooms for the server', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\tsettingsAdapter.getMaximumSizeOfUsersWhenJoiningPublicRooms.returns('100');\n\t\t\tbridge.searchPublicRooms.resolves({\n\t\t\t\tchunk: [\n\t\t\t\t\t{\n\t\t\t\t\t\troom_id: 'externalRoomId',\n\t\t\t\t\t\tname: 'externalRoomName',\n\t\t\t\t\t\tnum_joined_members: 1,\n\t\t\t\t\t\ttopic: 'externalRoomTopic',\n\t\t\t\t\t\tcanonical_alias: 'externalRoomAlias',\n\t\t\t\t\t\tjoin_rule: 'public',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\troom_id: 'externalRoomId2',\n\t\t\t\t\t\tname: 'externalRoomName2',\n\t\t\t\t\t\tnum_joined_members: 1,\n\t\t\t\t\t\ttopic: 'externalRoomTopic2',\n\t\t\t\t\t\tcanonical_alias: 'externalRoomAlias2',\n\t\t\t\t\t\tjoin_rule: 'public',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tnext_batch: 'next_batch',\n\t\t\t\tprev_batch: 'prev_batch',\n\t\t\t\ttotal_room_count_estimate: 10000,\n\t\t\t});\n\t\t\tconst result = await service.searchPublicRooms({} as any);\n\n\t\t\texpect(result).to.be.eql({\n\t\t\t\trooms: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'externalRoomId',\n\t\t\t\t\t\tname: 'externalRoomName',\n\t\t\t\t\t\tjoinedMembers: 1,\n\t\t\t\t\t\ttopic: 'externalRoomTopic',\n\t\t\t\t\t\tcanonicalAlias: 'externalRoomAlias',\n\t\t\t\t\t\tcanJoin: true,\n\t\t\t\t\t\tpageToken: undefined,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'externalRoomId2',\n\t\t\t\t\t\tname: 'externalRoomName2',\n\t\t\t\t\t\tjoinedMembers: 1,\n\t\t\t\t\t\ttopic: 'externalRoomTopic2',\n\t\t\t\t\t\tcanonicalAlias: 'externalRoomAlias2',\n\t\t\t\t\t\tcanJoin: true,\n\t\t\t\t\t\tpageToken: undefined,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tcount: 2,\n\t\t\t\ttotal: 10000,\n\t\t\t\tnextPageToken: 'next_batch',\n\t\t\t\tprevPageToken: 'prev_batch',\n\t\t\t});\n\t\t});\n\n\t\tit('should return the Matrix public rooms for the server filtering all the rooms that is not possible to join', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\tsettingsAdapter.getMaximumSizeOfUsersWhenJoiningPublicRooms.returns('100');\n\t\t\tbridge.searchPublicRooms.resolves({\n\t\t\t\tchunk: [\n\t\t\t\t\t{\n\t\t\t\t\t\troom_id: 'externalRoomId',\n\t\t\t\t\t\tname: 'externalRoomName',\n\t\t\t\t\t\tnum_joined_members: 1,\n\t\t\t\t\t\ttopic: 'externalRoomTopic',\n\t\t\t\t\t\tcanonical_alias: 'externalRoomAlias',\n\t\t\t\t\t\tjoin_rule: 'public',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\troom_id: 'externalRoomId2',\n\t\t\t\t\t\tname: 'externalRoomName2',\n\t\t\t\t\t\tnum_joined_members: 1,\n\t\t\t\t\t\ttopic: 'externalRoomTopic2',\n\t\t\t\t\t\tcanonical_alias: 'externalRoomAlias2',\n\t\t\t\t\t\tjoin_rule: 'knock',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tnext_batch: 'next_batch',\n\t\t\t\tprev_batch: 'prev_batch',\n\t\t\t\ttotal_room_count_estimate: 10000,\n\t\t\t});\n\t\t\tconst result = await service.searchPublicRooms({} as any);\n\n\t\t\texpect(result).to.be.eql({\n\t\t\t\trooms: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'externalRoomId',\n\t\t\t\t\t\tname: 'externalRoomName',\n\t\t\t\t\t\tjoinedMembers: 1,\n\t\t\t\t\t\ttopic: 'externalRoomTopic',\n\t\t\t\t\t\tcanonicalAlias: 'externalRoomAlias',\n\t\t\t\t\t\tcanJoin: true,\n\t\t\t\t\t\tpageToken: undefined,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tcount: 2,\n\t\t\t\ttotal: 10000,\n\t\t\t\tnextPageToken: 'next_batch',\n\t\t\t\tprevPageToken: 'prev_batch',\n\t\t\t});\n\t\t});\n\n\t\tit('should return the Matrix public rooms for the server filtering all the rooms that is not possible to join (all of the as canJoin = false, since they have more users than the allowed)', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\tsettingsAdapter.getMaximumSizeOfUsersWhenJoiningPublicRooms.returns('100');\n\t\t\tbridge.searchPublicRooms.resolves({\n\t\t\t\tchunk: [\n\t\t\t\t\t{\n\t\t\t\t\t\troom_id: 'externalRoomId',\n\t\t\t\t\t\tname: 'externalRoomName',\n\t\t\t\t\t\tnum_joined_members: 101,\n\t\t\t\t\t\ttopic: 'externalRoomTopic',\n\t\t\t\t\t\tcanonical_alias: 'externalRoomAlias',\n\t\t\t\t\t\tjoin_rule: 'public',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\troom_id: 'externalRoomId2',\n\t\t\t\t\t\tname: 'externalRoomName2',\n\t\t\t\t\t\tnum_joined_members: 4000,\n\t\t\t\t\t\ttopic: 'externalRoomTopic2',\n\t\t\t\t\t\tcanonical_alias: 'externalRoomAlias2',\n\t\t\t\t\t\tjoin_rule: 'knock',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tnext_batch: 'next_batch',\n\t\t\t\tprev_batch: 'prev_batch',\n\t\t\t\ttotal_room_count_estimate: 10000,\n\t\t\t});\n\t\t\tconst result = await service.searchPublicRooms({} as any);\n\n\t\t\texpect(result).to.be.eql({\n\t\t\t\trooms: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'externalRoomId',\n\t\t\t\t\t\tname: 'externalRoomName',\n\t\t\t\t\t\tjoinedMembers: 101,\n\t\t\t\t\t\ttopic: 'externalRoomTopic',\n\t\t\t\t\t\tcanonicalAlias: 'externalRoomAlias',\n\t\t\t\t\t\tcanJoin: false,\n\t\t\t\t\t\tpageToken: undefined,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tcount: 2,\n\t\t\t\ttotal: 10000,\n\t\t\t\tnextPageToken: 'next_batch',\n\t\t\t\tprevPageToken: 'prev_batch',\n\t\t\t});\n\t\t});\n\n\t\tit('should return the Matrix public rooms for the server including a valid pageToken for each room', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\tsettingsAdapter.getMaximumSizeOfUsersWhenJoiningPublicRooms.returns('100');\n\t\t\tbridge.searchPublicRooms.resolves({\n\t\t\t\tchunk: [\n\t\t\t\t\t{\n\t\t\t\t\t\troom_id: 'externalRoomId',\n\t\t\t\t\t\tname: 'externalRoomName',\n\t\t\t\t\t\tnum_joined_members: 101,\n\t\t\t\t\t\ttopic: 'externalRoomTopic',\n\t\t\t\t\t\tcanonical_alias: 'externalRoomAlias',\n\t\t\t\t\t\tjoin_rule: 'public',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\troom_id: 'externalRoomId2',\n\t\t\t\t\t\tname: 'externalRoomName2',\n\t\t\t\t\t\tnum_joined_members: 4000,\n\t\t\t\t\t\ttopic: 'externalRoomTopic2',\n\t\t\t\t\t\tcanonical_alias: 'externalRoomAlias2',\n\t\t\t\t\t\tjoin_rule: 'knock',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tnext_batch: 'next_batch',\n\t\t\t\tprev_batch: 'prev_batch',\n\t\t\t\ttotal_room_count_estimate: 10000,\n\t\t\t});\n\t\t\tconst result = await service.searchPublicRooms({ pageToken: 'pageToken' } as any);\n\n\t\t\texpect(result).to.be.eql({\n\t\t\t\trooms: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'externalRoomId',\n\t\t\t\t\t\tname: 'externalRoomName',\n\t\t\t\t\t\tjoinedMembers: 101,\n\t\t\t\t\t\ttopic: 'externalRoomTopic',\n\t\t\t\t\t\tcanonicalAlias: 'externalRoomAlias',\n\t\t\t\t\t\tcanJoin: false,\n\t\t\t\t\t\tpageToken: 'pageToken',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tcount: 2,\n\t\t\t\ttotal: 10000,\n\t\t\t\tnextPageToken: 'next_batch',\n\t\t\t\tprevPageToken: 'prev_batch',\n\t\t\t});\n\t\t});\n\t});\n\n\tdescribe('#scheduleJoinExternalPublicRoom()', () => {\n\t\tit('should throw an error if the federation is disabled', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(false);\n\t\t\tawait expect(service.scheduleJoinExternalPublicRoom({} as any)).to.be.rejectedWith('Federation is disabled');\n\t\t});\n\n\t\tit('should enqueue a job to join the room', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\tconst internalUserId = 'internalUserId';\n\t\t\tconst externalRoomId = 'externalRoomId';\n\t\t\tconst roomName = 'roomName';\n\t\t\tconst pageToken = 'pageToken';\n\t\t\tawait service.scheduleJoinExternalPublicRoom(internalUserId, externalRoomId, roomName, pageToken);\n\n\t\t\texpect(\n\t\t\t\tqueueAdapter.enqueueJob.calledOnceWithExactly('federation-enterprise.joinExternalPublicRoom', {\n\t\t\t\t\tinternalUserId,\n\t\t\t\t\texternalRoomId,\n\t\t\t\t\troomName,\n\t\t\t\t\tpageToken,\n\t\t\t\t}),\n\t\t\t);\n\t\t});\n\n\t\tdescribe('#joinExternalPublicRoom()', () => {\n\t\t\tconst user = FederatedUserEE.createInstance('externalInviterId', {\n\t\t\t\tname: 'normalizedInviterId',\n\t\t\t\tusername: 'normalizedInviterId',\n\t\t\t\texistsOnlyOnProxyServer: true,\n\t\t\t});\n\t\t\tconst room = FederatedRoomEE.createInstance('externalRoomId', 'normalizedRoomId', user, RoomType.CHANNEL, 'externalRoomName');\n\n\t\t\tit('should throw an error if the federation is disabled', async () => {\n\t\t\t\tsettingsAdapter.isFederationEnabled.returns(false);\n\t\t\t\tawait expect(service.joinExternalPublicRoom({} as any)).to.be.rejectedWith('Federation is disabled');\n\t\t\t});\n\n\t\t\tit('should throw an error if the user already joined the room', async () => {\n\t\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\t\troomAdapter.getFederatedRoomByExternalId.resolves(room);\n\t\t\t\troomAdapter.isUserAlreadyJoined.resolves(true);\n\t\t\t\tawait expect(service.joinExternalPublicRoom({} as any)).to.be.rejectedWith('already-joined');\n\t\t\t});\n\n\t\t\tit('should NOT create an external user if it already exists', async () => {\n\t\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\t\tconst spy = sinon.spy(service, 'createFederatedUserIncludingHomeserverUsingLocalInformation');\n\t\t\t\tsinon.stub(service, 'isRoomSizeAllowed').returns(true);\n\n\t\t\t\tawait service.joinExternalPublicRoom({} as any);\n\n\t\t\t\texpect(spy.called).to.be.false;\n\t\t\t});\n\n\t\t\tit('should create an external user if it does not exists', async () => {\n\t\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\t\tuserAdapter.getFederatedUserByInternalId.onFirstCall().resolves(undefined);\n\t\t\t\tuserAdapter.getInternalUserById.resolves({ _id: 'id', username: 'username' });\n\t\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\t\tconst spy = sinon.spy(service, 'createFederatedUserIncludingHomeserverUsingLocalInformation');\n\t\t\t\tsinon.stub(service, 'isRoomSizeAllowed').returns(true);\n\n\t\t\t\tawait service.joinExternalPublicRoom({ internalUserId: 'internalUserId' } as any);\n\n\t\t\t\texpect(spy.calledWith('internalUserId')).to.be.true;\n\t\t\t});\n\n\t\t\tit('should throw an error if the federated user was not found even after creation', async () => {\n\t\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(undefined);\n\t\t\t\tuserAdapter.getInternalUserById.resolves({ _id: 'id', username: 'username' });\n\n\t\t\t\tawait expect(service.joinExternalPublicRoom({ internalUserId: 'internalUserId' } as any)).to.be.rejectedWith(\n\t\t\t\t\t'User with internalId internalUserId not found',\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tit('should throw an error if the room the user is trying to join does not exists', async () => {\n\t\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\t\tuserAdapter.getInternalUserById.resolves({ _id: 'id', username: 'username' });\n\t\t\t\tbridge.searchPublicRooms.resolves({ chunk: [{ room_id: 'differentId' }] });\n\n\t\t\t\tawait expect(\n\t\t\t\t\tservice.joinExternalPublicRoom({ internalUserId: 'internalUserId', externalRoomId: 'externalRoomId' } as any),\n\t\t\t\t).to.be.rejectedWith(\"Cannot find the room you're trying to join\");\n\t\t\t});\n\n\t\t\tit('should throw an error if the room the user is trying to join does not exists due to the server was not able to search', async () => {\n\t\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\t\tuserAdapter.getInternalUserById.resolves({ _id: 'id', username: 'username' });\n\t\t\t\tbridge.searchPublicRooms.rejects();\n\n\t\t\t\tawait expect(\n\t\t\t\t\tservice.joinExternalPublicRoom({ internalUserId: 'internalUserId', externalRoomId: 'externalRoomId' } as any),\n\t\t\t\t).to.be.rejectedWith(\"Cannot find the room you're trying to join\");\n\t\t\t});\n\n\t\t\tit('should throw an error if the room the user is trying to join contains more users (its bigger) than the allowed by the setting', async () => {\n\t\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\t\tsettingsAdapter.getMaximumSizeOfUsersWhenJoiningPublicRooms.returns('100');\n\t\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\t\tuserAdapter.getInternalUserById.resolves({ _id: 'id', username: 'username' });\n\t\t\t\tbridge.searchPublicRooms.resolves({ chunk: [{ room_id: 'externalRoomId', num_joined_members: 101 }] });\n\n\t\t\t\tawait expect(\n\t\t\t\t\tservice.joinExternalPublicRoom({ internalUserId: 'internalUserId', externalRoomId: 'externalRoomId' } as any),\n\t\t\t\t).to.be.rejectedWith(\"Can't join a room bigger than the admin of your workspace has set as the maximum size\");\n\t\t\t});\n\n\t\t\tit('should join the user to the remote room', async () => {\n\t\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\t\tuserAdapter.getFederatedUserByInternalId.resolves(user);\n\t\t\t\tsinon.stub(service, 'isRoomSizeAllowed').returns(true);\n\n\t\t\t\tawait service.joinExternalPublicRoom({\n\t\t\t\t\texternalRoomId: 'externalRoomId',\n\t\t\t\t\tinternalUserId: 'internalUserId',\n\t\t\t\t\texternalRoomHomeServerName: 'externalRoomHomeServerName',\n\t\t\t\t} as any);\n\n\t\t\t\texpect(bridge.joinRoom.calledWith('externalRoomId', user.getExternalId(), ['externalRoomHomeServerName'])).to.be.true;\n\t\t\t});\n\t\t});\n\t});\n});\n"],"names":["FederatedRoomEE","proxyquire","noCallThru","load","mongodb","ObjectId","toHexString","FederatedUserEE","FederationRoomServiceSender","describe","service","roomAdapter","getFederatedRoomByInternalId","sinon","stub","updateFederatedRoomByInternalRoomId","getInternalRoomById","getInternalRoomRolesByUserId","isUserAlreadyJoined","getFederatedRoomByExternalId","createFederatedRoom","addUserToRoom","userAdapter","getFederatedUserByExternalId","getFederatedUserByInternalId","createFederatedUser","getInternalUserById","getFederatedUserByInternalUsername","createLocalUser","getInternalUserByUsername","updateFederationAvatar","setAvatar","updateRealName","settingsAdapter","getHomeServerDomain","returns","isFederationEnabled","getMaximumSizeOfUsersWhenJoiningPublicRooms","messageAdapter","bridge","searchPublicRooms","getUserProfileInformation","resolves","extractHomeserverOrigin","createUser","inviteToRoom","createRoom","joinRoom","convertMatrixUrlToHttp","getRoomData","fileAdapter","getBufferForAvatarFile","undefined","notificationAdapter","subscribeToUserTypingEventsOnFederatedRoomId","broadcastUserTypingOnRoom","queueAdapter","enqueueJob","invitees","inviteeUsernameOnly","normalizedInviteeId","rawInviteeId","beforeEach","afterEach","reset","user","createInstance","name","username","existsOnlyOnProxyServer","room","RoomType","CHANNEL","it","onCall","onRoomCreated","expect","called","to","be","false","inviter","calledWith","true","internalInviterId","rejectedWith","internalRoomId","t","topic","_id","getExternalId","invitee","getName","ahahha","federatedUser","validParams","createUsersLocallyOnlySpy","spy","beforeAddUserToARoom","internalInviter","getInternalId","avatarSpy","displayNameSpy","avatarUrl","displayName","createLocalInstanceOnly","calledOnceWithExactly","createWithInternalReference","federation","userAvatar","getInternalReference","onUsersAddedToARoom","not","serverName","roomName","limit","pageToken","chunk","room_id","num_joined_members","canonical_alias","join_rule","next_batch","prev_batch","total_room_count_estimate","result","eql","rooms","id","joinedMembers","canonicalAlias","canJoin","count","total","nextPageToken","prevPageToken","scheduleJoinExternalPublicRoom","internalUserId","externalRoomId","joinExternalPublicRoom","onFirstCall","rejects","externalRoomHomeServerName"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/room/sender/RoomServiceSender.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e7f5e579953b31284047502982dc75566e082888","contentHash":"d7cda1ec008297ad4bbff51f81fda16d139af467af73df65b7ff0518a9db412c"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/RoomServiceSender.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/RoomServiceSender.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":43}},"3":{"start":{"line":11,"column":29},"end":{"line":11,"column":141}},"4":{"start":{"line":12,"column":36},"end":{"line":12,"column":160}},"5":{"start":{"line":13,"column":23},"end":{"line":13,"column":63}},"6":{"start":{"line":14,"column":48},"end":{"line":14,"column":103}},"7":{"start":{"line":15,"column":34},"end":{"line":208,"column":1}},"8":{"start":{"line":17,"column":64},"end":{"line":17,"column":83}},"9":{"start":{"line":18,"column":8},"end":{"line":21,"column":11}},"10":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"11":{"start":{"line":23,"column":12},"end":{"line":23,"column":19}},"12":{"start":{"line":25,"column":8},"end":{"line":25,"column":93}},"13":{"start":{"line":28,"column":67},"end":{"line":28,"column":94}},"14":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"15":{"start":{"line":30,"column":12},"end":{"line":30,"column":19}},"16":{"start":{"line":32,"column":8},"end":{"line":46,"column":9}},"17":{"start":{"line":33,"column":34},"end":{"line":33,"column":114}},"18":{"start":{"line":34,"column":12},"end":{"line":36,"column":13}},"19":{"start":{"line":35,"column":16},"end":{"line":35,"column":23}},"20":{"start":{"line":37,"column":34},"end":{"line":37,"column":109}},"21":{"start":{"line":38,"column":12},"end":{"line":40,"column":13}},"22":{"start":{"line":39,"column":16},"end":{"line":39,"column":23}},"23":{"start":{"line":41,"column":40},"end":{"line":41,"column":161}},"24":{"start":{"line":42,"column":38},"end":{"line":42,"column":291}},"25":{"start":{"line":43,"column":12},"end":{"line":45,"column":13}},"26":{"start":{"line":44,"column":16},"end":{"line":44,"column":81}},"27":{"start":{"line":47,"column":8},"end":{"line":47,"column":52}},"28":{"start":{"line":50,"column":27},"end":{"line":50,"column":198}},"29":{"start":{"line":50,"column":51},"end":{"line":50,"column":197}},"30":{"start":{"line":51,"column":30},"end":{"line":51,"column":202}},"31":{"start":{"line":51,"column":54},"end":{"line":51,"column":201}},"32":{"start":{"line":52,"column":8},"end":{"line":63,"column":9}},"33":{"start":{"line":56,"column":12},"end":{"line":62,"column":15}},"34":{"start":{"line":66,"column":101},"end":{"line":66,"column":129}},"35":{"start":{"line":67,"column":8},"end":{"line":69,"column":9}},"36":{"start":{"line":68,"column":12},"end":{"line":68,"column":19}},"37":{"start":{"line":70,"column":8},"end":{"line":70,"column":93}},"38":{"start":{"line":73,"column":8},"end":{"line":75,"column":9}},"39":{"start":{"line":74,"column":12},"end":{"line":74,"column":54}},"40":{"start":{"line":76,"column":59},"end":{"line":76,"column":77}},"41":{"start":{"line":77,"column":22},"end":{"line":82,"column":10}},"42":{"start":{"line":83,"column":8},"end":{"line":83,"column":160}},"43":{"start":{"line":86,"column":8},"end":{"line":88,"column":9}},"44":{"start":{"line":87,"column":12},"end":{"line":87,"column":54}},"45":{"start":{"line":89,"column":8},"end":{"line":94,"column":11}},"46":{"start":{"line":97,"column":8},"end":{"line":99,"column":9}},"47":{"start":{"line":98,"column":12},"end":{"line":98,"column":54}},"48":{"start":{"line":100,"column":100},"end":{"line":100,"column":130}},"49":{"start":{"line":101,"column":21},"end":{"line":101,"column":96}},"50":{"start":{"line":102,"column":8},"end":{"line":107,"column":9}},"51":{"start":{"line":103,"column":34},"end":{"line":103,"column":122}},"52":{"start":{"line":104,"column":12},"end":{"line":106,"column":13}},"53":{"start":{"line":105,"column":16},"end":{"line":105,"column":50}},"54":{"start":{"line":108,"column":21},"end":{"line":108,"column":96}},"55":{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},"56":{"start":{"line":110,"column":12},"end":{"line":110,"column":99}},"57":{"start":{"line":112,"column":30},"end":{"line":112,"column":105}},"58":{"start":{"line":113,"column":8},"end":{"line":115,"column":9}},"59":{"start":{"line":114,"column":12},"end":{"line":114,"column":80}},"60":{"start":{"line":116,"column":8},"end":{"line":118,"column":9}},"61":{"start":{"line":117,"column":12},"end":{"line":117,"column":117}},"62":{"start":{"line":119,"column":8},"end":{"line":121,"column":11}},"63":{"start":{"line":124,"column":8},"end":{"line":138,"column":9}},"64":{"start":{"line":125,"column":26},"end":{"line":130,"column":14}},"65":{"start":{"line":131,"column":25},"end":{"line":131,"column":82}},"66":{"start":{"line":131,"column":50},"end":{"line":131,"column":81}},"67":{"start":{"line":132,"column":12},"end":{"line":134,"column":13}},"68":{"start":{"line":133,"column":16},"end":{"line":133,"column":78}},"69":{"start":{"line":135,"column":12},"end":{"line":135,"column":138}},"70":{"start":{"line":137,"column":12},"end":{"line":137,"column":74}},"71":{"start":{"line":141,"column":54},"end":{"line":141,"column":73}},"72":{"start":{"line":142,"column":28},"end":{"line":142,"column":106}},"73":{"start":{"line":143,"column":8},"end":{"line":145,"column":9}},"74":{"start":{"line":144,"column":12},"end":{"line":144,"column":102}},"75":{"start":{"line":146,"column":37},"end":{"line":146,"column":130}},"76":{"start":{"line":147,"column":8},"end":{"line":149,"column":9}},"77":{"start":{"line":148,"column":12},"end":{"line":148,"column":83}},"78":{"start":{"line":150,"column":38},"end":{"line":150,"column":113}},"79":{"start":{"line":151,"column":8},"end":{"line":153,"column":9}},"80":{"start":{"line":152,"column":12},"end":{"line":152,"column":19}},"81":{"start":{"line":154,"column":29},"end":{"line":154,"column":95}},"82":{"start":{"line":155,"column":8},"end":{"line":157,"column":9}},"83":{"start":{"line":156,"column":12},"end":{"line":156,"column":80}},"84":{"start":{"line":158,"column":25},"end":{"line":158,"column":64}},"85":{"start":{"line":159,"column":31},"end":{"line":159,"column":143}},"86":{"start":{"line":160,"column":8},"end":{"line":160,"column":109}},"87":{"start":{"line":163,"column":110},"end":{"line":163,"column":129}},"88":{"start":{"line":164,"column":34},"end":{"line":164,"column":61}},"89":{"start":{"line":165,"column":47},"end":{"line":165,"column":188}},"90":{"start":{"line":166,"column":8},"end":{"line":168,"column":9}},"91":{"start":{"line":167,"column":12},"end":{"line":167,"column":19}},"92":{"start":{"line":169,"column":30},"end":{"line":169,"column":105}},"93":{"start":{"line":170,"column":8},"end":{"line":172,"column":9}},"94":{"start":{"line":171,"column":12},"end":{"line":171,"column":92}},"95":{"start":{"line":173,"column":37},"end":{"line":173,"column":115}},"96":{"start":{"line":174,"column":8},"end":{"line":176,"column":9}},"97":{"start":{"line":175,"column":12},"end":{"line":175,"column":83}},"98":{"start":{"line":177,"column":25},"end":{"line":177,"column":99}},"99":{"start":{"line":178,"column":28},"end":{"line":178,"column":103}},"100":{"start":{"line":179,"column":8},"end":{"line":182,"column":9}},"101":{"start":{"line":180,"column":44},"end":{"line":180,"column":74}},"102":{"start":{"line":181,"column":12},"end":{"line":181,"column":106}},"103":{"start":{"line":183,"column":37},"end":{"line":183,"column":127}},"104":{"start":{"line":184,"column":8},"end":{"line":186,"column":9}},"105":{"start":{"line":185,"column":12},"end":{"line":185,"column":80}},"106":{"start":{"line":187,"column":8},"end":{"line":192,"column":9}},"107":{"start":{"line":188,"column":28},"end":{"line":188,"column":109}},"108":{"start":{"line":189,"column":12},"end":{"line":191,"column":13}},"109":{"start":{"line":190,"column":16},"end":{"line":190,"column":179}},"110":{"start":{"line":193,"column":8},"end":{"line":196,"column":9}},"111":{"start":{"line":194,"column":12},"end":{"line":194,"column":108}},"112":{"start":{"line":195,"column":12},"end":{"line":195,"column":19}},"113":{"start":{"line":197,"column":8},"end":{"line":199,"column":9}},"114":{"start":{"line":198,"column":12},"end":{"line":198,"column":83}},"115":{"start":{"line":200,"column":8},"end":{"line":200,"column":146}},"116":{"start":{"line":201,"column":8},"end":{"line":203,"column":9}},"117":{"start":{"line":202,"column":12},"end":{"line":202,"column":108}},"118":{"start":{"line":206,"column":8},"end":{"line":206,"column":479}},"119":{"start":{"line":209,"column":17},"end":{"line":232,"column":1}},"120":{"start":{"line":212,"column":8},"end":{"line":230,"column":10}},"121":{"start":{"line":213,"column":102},"end":{"line":213,"column":185}},"122":{"start":{"line":213,"column":200},"end":{"line":221,"column":17}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":16,"column":4},"end":{"line":16,"column":5}},"loc":{"start":{"line":16,"column":45},"end":{"line":26,"column":5}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":27,"column":4},"end":{"line":27,"column":5}},"loc":{"start":{"line":27,"column":60},"end":{"line":48,"column":5}},"line":27},"3":{"name":"(anonymous_3)","decl":{"start":{"line":49,"column":4},"end":{"line":49,"column":5}},"loc":{"start":{"line":49,"column":84},"end":{"line":64,"column":5}},"line":49},"4":{"name":"(anonymous_4)","decl":{"start":{"line":50,"column":43},"end":{"line":50,"column":44}},"loc":{"start":{"line":50,"column":51},"end":{"line":50,"column":197}},"line":50},"5":{"name":"(anonymous_5)","decl":{"start":{"line":51,"column":46},"end":{"line":51,"column":47}},"loc":{"start":{"line":51,"column":54},"end":{"line":51,"column":201}},"line":51},"6":{"name":"(anonymous_6)","decl":{"start":{"line":65,"column":4},"end":{"line":65,"column":5}},"loc":{"start":{"line":65,"column":60},"end":{"line":71,"column":5}},"line":65},"7":{"name":"(anonymous_7)","decl":{"start":{"line":72,"column":4},"end":{"line":72,"column":5}},"loc":{"start":{"line":72,"column":48},"end":{"line":84,"column":5}},"line":72},"8":{"name":"(anonymous_8)","decl":{"start":{"line":85,"column":4},"end":{"line":85,"column":5}},"loc":{"start":{"line":85,"column":94},"end":{"line":95,"column":5}},"line":85},"9":{"name":"(anonymous_9)","decl":{"start":{"line":96,"column":4},"end":{"line":96,"column":5}},"loc":{"start":{"line":96,"column":65},"end":{"line":122,"column":5}},"line":96},"10":{"name":"(anonymous_10)","decl":{"start":{"line":123,"column":4},"end":{"line":123,"column":5}},"loc":{"start":{"line":123,"column":77},"end":{"line":139,"column":5}},"line":123},"11":{"name":"(anonymous_11)","decl":{"start":{"line":131,"column":42},"end":{"line":131,"column":43}},"loc":{"start":{"line":131,"column":50},"end":{"line":131,"column":81}},"line":131},"12":{"name":"(anonymous_12)","decl":{"start":{"line":140,"column":4},"end":{"line":140,"column":5}},"loc":{"start":{"line":140,"column":50},"end":{"line":161,"column":5}},"line":140},"13":{"name":"(anonymous_13)","decl":{"start":{"line":162,"column":4},"end":{"line":162,"column":5}},"loc":{"start":{"line":162,"column":58},"end":{"line":204,"column":5}},"line":162},"14":{"name":"(anonymous_14)","decl":{"start":{"line":205,"column":4},"end":{"line":205,"column":5}},"loc":{"start":{"line":205,"column":186},"end":{"line":207,"column":5}},"line":205},"15":{"name":"(anonymous_15)","decl":{"start":{"line":210,"column":4},"end":{"line":210,"column":5}},"loc":{"start":{"line":210,"column":75},"end":{"line":231,"column":5}},"line":210},"16":{"name":"(anonymous_16)","decl":{"start":{"line":213,"column":94},"end":{"line":213,"column":95}},"loc":{"start":{"line":213,"column":102},"end":{"line":213,"column":185}},"line":213},"17":{"name":"(anonymous_17)","decl":{"start":{"line":213,"column":191},"end":{"line":213,"column":192}},"loc":{"start":{"line":213,"column":200},"end":{"line":221,"column":17}},"line":213}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"type":"if","locations":[{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},{"start":{"line":22,"column":8},"end":{"line":24,"column":9}}],"line":22},"1":{"loc":{"start":{"line":28,"column":16},"end":{"line":28,"column":29}},"type":"default-arg","locations":[{"start":{"line":28,"column":27},"end":{"line":28,"column":29}}],"line":28},"2":{"loc":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"type":"if","locations":[{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},{"start":{"line":29,"column":8},"end":{"line":31,"column":9}}],"line":29},"3":{"loc":{"start":{"line":32,"column":8},"end":{"line":46,"column":9}},"type":"if","locations":[{"start":{"line":32,"column":8},"end":{"line":46,"column":9}},{"start":{"line":32,"column":8},"end":{"line":46,"column":9}}],"line":32},"4":{"loc":{"start":{"line":34,"column":12},"end":{"line":36,"column":13}},"type":"if","locations":[{"start":{"line":34,"column":12},"end":{"line":36,"column":13}},{"start":{"line":34,"column":12},"end":{"line":36,"column":13}}],"line":34},"5":{"loc":{"start":{"line":38,"column":12},"end":{"line":40,"column":13}},"type":"if","locations":[{"start":{"line":38,"column":12},"end":{"line":40,"column":13}},{"start":{"line":38,"column":12},"end":{"line":40,"column":13}}],"line":38},"6":{"loc":{"start":{"line":42,"column":38},"end":{"line":42,"column":291}},"type":"binary-expr","locations":[{"start":{"line":42,"column":38},"end":{"line":42,"column":130}},{"start":{"line":42,"column":134},"end":{"line":42,"column":230}},{"start":{"line":42,"column":234},"end":{"line":42,"column":291}}],"line":42},"7":{"loc":{"start":{"line":43,"column":12},"end":{"line":45,"column":13}},"type":"if","locations":[{"start":{"line":43,"column":12},"end":{"line":45,"column":13}},{"start":{"line":43,"column":12},"end":{"line":45,"column":13}}],"line":43},"8":{"loc":{"start":{"line":67,"column":8},"end":{"line":69,"column":9}},"type":"if","locations":[{"start":{"line":67,"column":8},"end":{"line":69,"column":9}},{"start":{"line":67,"column":8},"end":{"line":69,"column":9}}],"line":67},"9":{"loc":{"start":{"line":73,"column":8},"end":{"line":75,"column":9}},"type":"if","locations":[{"start":{"line":73,"column":8},"end":{"line":75,"column":9}},{"start":{"line":73,"column":8},"end":{"line":75,"column":9}}],"line":73},"10":{"loc":{"start":{"line":78,"column":24},"end":{"line":78,"column":67}},"type":"binary-expr","locations":[{"start":{"line":78,"column":24},"end":{"line":78,"column":34}},{"start":{"line":78,"column":38},"end":{"line":78,"column":67}}],"line":78},"11":{"loc":{"start":{"line":83,"column":65},"end":{"line":83,"column":146}},"type":"binary-expr","locations":[{"start":{"line":83,"column":65},"end":{"line":83,"column":139}},{"start":{"line":83,"column":143},"end":{"line":83,"column":146}}],"line":83},"12":{"loc":{"start":{"line":86,"column":8},"end":{"line":88,"column":9}},"type":"if","locations":[{"start":{"line":86,"column":8},"end":{"line":88,"column":9}},{"start":{"line":86,"column":8},"end":{"line":88,"column":9}}],"line":86},"13":{"loc":{"start":{"line":97,"column":8},"end":{"line":99,"column":9}},"type":"if","locations":[{"start":{"line":97,"column":8},"end":{"line":99,"column":9}},{"start":{"line":97,"column":8},"end":{"line":99,"column":9}}],"line":97},"14":{"loc":{"start":{"line":102,"column":8},"end":{"line":107,"column":9}},"type":"if","locations":[{"start":{"line":102,"column":8},"end":{"line":107,"column":9}},{"start":{"line":102,"column":8},"end":{"line":107,"column":9}}],"line":102},"15":{"loc":{"start":{"line":104,"column":12},"end":{"line":106,"column":13}},"type":"if","locations":[{"start":{"line":104,"column":12},"end":{"line":106,"column":13}},{"start":{"line":104,"column":12},"end":{"line":106,"column":13}}],"line":104},"16":{"loc":{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},"type":"if","locations":[{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},{"start":{"line":109,"column":8},"end":{"line":111,"column":9}}],"line":109},"17":{"loc":{"start":{"line":113,"column":8},"end":{"line":115,"column":9}},"type":"if","locations":[{"start":{"line":113,"column":8},"end":{"line":115,"column":9}},{"start":{"line":113,"column":8},"end":{"line":115,"column":9}}],"line":113},"18":{"loc":{"start":{"line":116,"column":8},"end":{"line":118,"column":9}},"type":"if","locations":[{"start":{"line":116,"column":8},"end":{"line":118,"column":9}},{"start":{"line":116,"column":8},"end":{"line":118,"column":9}}],"line":116},"19":{"loc":{"start":{"line":132,"column":12},"end":{"line":134,"column":13}},"type":"if","locations":[{"start":{"line":132,"column":12},"end":{"line":134,"column":13}},{"start":{"line":132,"column":12},"end":{"line":134,"column":13}}],"line":132},"20":{"loc":{"start":{"line":135,"column":55},"end":{"line":135,"column":136}},"type":"binary-expr","locations":[{"start":{"line":135,"column":55},"end":{"line":135,"column":129}},{"start":{"line":135,"column":133},"end":{"line":135,"column":136}}],"line":135},"21":{"loc":{"start":{"line":143,"column":8},"end":{"line":145,"column":9}},"type":"if","locations":[{"start":{"line":143,"column":8},"end":{"line":145,"column":9}},{"start":{"line":143,"column":8},"end":{"line":145,"column":9}}],"line":143},"22":{"loc":{"start":{"line":146,"column":37},"end":{"line":146,"column":130}},"type":"binary-expr","locations":[{"start":{"line":146,"column":37},"end":{"line":146,"column":48}},{"start":{"line":146,"column":52},"end":{"line":146,"column":130}}],"line":146},"23":{"loc":{"start":{"line":147,"column":8},"end":{"line":149,"column":9}},"type":"if","locations":[{"start":{"line":147,"column":8},"end":{"line":149,"column":9}},{"start":{"line":147,"column":8},"end":{"line":149,"column":9}}],"line":147},"24":{"loc":{"start":{"line":151,"column":8},"end":{"line":153,"column":9}},"type":"if","locations":[{"start":{"line":151,"column":8},"end":{"line":153,"column":9}},{"start":{"line":151,"column":8},"end":{"line":153,"column":9}}],"line":151},"25":{"loc":{"start":{"line":155,"column":8},"end":{"line":157,"column":9}},"type":"if","locations":[{"start":{"line":155,"column":8},"end":{"line":157,"column":9}},{"start":{"line":155,"column":8},"end":{"line":157,"column":9}}],"line":155},"26":{"loc":{"start":{"line":155,"column":12},"end":{"line":155,"column":47}},"type":"binary-expr","locations":[{"start":{"line":155,"column":12},"end":{"line":155,"column":25}},{"start":{"line":155,"column":29},"end":{"line":155,"column":47}}],"line":155},"27":{"loc":{"start":{"line":158,"column":25},"end":{"line":158,"column":64}},"type":"binary-expr","locations":[{"start":{"line":158,"column":25},"end":{"line":158,"column":43}},{"start":{"line":158,"column":47},"end":{"line":158,"column":64}}],"line":158},"28":{"loc":{"start":{"line":166,"column":8},"end":{"line":168,"column":9}},"type":"if","locations":[{"start":{"line":166,"column":8},"end":{"line":168,"column":9}},{"start":{"line":166,"column":8},"end":{"line":168,"column":9}}],"line":166},"29":{"loc":{"start":{"line":166,"column":12},"end":{"line":166,"column":64}},"type":"binary-expr","locations":[{"start":{"line":166,"column":12},"end":{"line":166,"column":29}},{"start":{"line":166,"column":33},"end":{"line":166,"column":64}}],"line":166},"30":{"loc":{"start":{"line":170,"column":8},"end":{"line":172,"column":9}},"type":"if","locations":[{"start":{"line":170,"column":8},"end":{"line":172,"column":9}},{"start":{"line":170,"column":8},"end":{"line":172,"column":9}}],"line":170},"31":{"loc":{"start":{"line":174,"column":8},"end":{"line":176,"column":9}},"type":"if","locations":[{"start":{"line":174,"column":8},"end":{"line":176,"column":9}},{"start":{"line":174,"column":8},"end":{"line":176,"column":9}}],"line":174},"32":{"loc":{"start":{"line":174,"column":12},"end":{"line":174,"column":55}},"type":"binary-expr","locations":[{"start":{"line":174,"column":12},"end":{"line":174,"column":33}},{"start":{"line":174,"column":37},"end":{"line":174,"column":55}}],"line":174},"33":{"loc":{"start":{"line":177,"column":25},"end":{"line":177,"column":99}},"type":"cond-expr","locations":[{"start":{"line":177,"column":58},"end":{"line":177,"column":77}},{"start":{"line":177,"column":80},"end":{"line":177,"column":99}}],"line":177},"34":{"loc":{"start":{"line":179,"column":8},"end":{"line":182,"column":9}},"type":"if","locations":[{"start":{"line":179,"column":8},"end":{"line":182,"column":9}},{"start":{"line":179,"column":8},"end":{"line":182,"column":9}}],"line":179},"35":{"loc":{"start":{"line":183,"column":37},"end":{"line":183,"column":127}},"type":"binary-expr","locations":[{"start":{"line":183,"column":37},"end":{"line":183,"column":48}},{"start":{"line":183,"column":52},"end":{"line":183,"column":127}}],"line":183},"36":{"loc":{"start":{"line":184,"column":8},"end":{"line":186,"column":9}},"type":"if","locations":[{"start":{"line":184,"column":8},"end":{"line":186,"column":9}},{"start":{"line":184,"column":8},"end":{"line":186,"column":9}}],"line":184},"37":{"loc":{"start":{"line":187,"column":8},"end":{"line":192,"column":9}},"type":"if","locations":[{"start":{"line":187,"column":8},"end":{"line":192,"column":9}},{"start":{"line":187,"column":8},"end":{"line":192,"column":9}}],"line":187},"38":{"loc":{"start":{"line":189,"column":12},"end":{"line":191,"column":13}},"type":"if","locations":[{"start":{"line":189,"column":12},"end":{"line":191,"column":13}},{"start":{"line":189,"column":12},"end":{"line":191,"column":13}}],"line":189},"39":{"loc":{"start":{"line":190,"column":66},"end":{"line":190,"column":146}},"type":"binary-expr","locations":[{"start":{"line":190,"column":66},"end":{"line":190,"column":96}},{"start":{"line":190,"column":100},"end":{"line":190,"column":134}},{"start":{"line":190,"column":138},"end":{"line":190,"column":146}}],"line":190},"40":{"loc":{"start":{"line":193,"column":8},"end":{"line":196,"column":9}},"type":"if","locations":[{"start":{"line":193,"column":8},"end":{"line":196,"column":9}},{"start":{"line":193,"column":8},"end":{"line":196,"column":9}}],"line":193},"41":{"loc":{"start":{"line":193,"column":12},"end":{"line":193,"column":54}},"type":"binary-expr","locations":[{"start":{"line":193,"column":12},"end":{"line":193,"column":33}},{"start":{"line":193,"column":37},"end":{"line":193,"column":54}}],"line":193},"42":{"loc":{"start":{"line":197,"column":8},"end":{"line":199,"column":9}},"type":"if","locations":[{"start":{"line":197,"column":8},"end":{"line":199,"column":9}},{"start":{"line":197,"column":8},"end":{"line":199,"column":9}}],"line":197},"43":{"loc":{"start":{"line":201,"column":8},"end":{"line":203,"column":9}},"type":"if","locations":[{"start":{"line":201,"column":8},"end":{"line":203,"column":9}},{"start":{"line":201,"column":8},"end":{"line":203,"column":9}}],"line":201},"44":{"loc":{"start":{"line":213,"column":20},"end":{"line":213,"column":85}},"type":"binary-expr","locations":[{"start":{"line":213,"column":21},"end":{"line":213,"column":78}},{"start":{"line":213,"column":83},"end":{"line":213,"column":85}}],"line":213},"45":{"loc":{"start":{"line":213,"column":21},"end":{"line":213,"column":78}},"type":"cond-expr","locations":[{"start":{"line":213,"column":58},"end":{"line":213,"column":64}},{"start":{"line":213,"column":67},"end":{"line":213,"column":78}}],"line":213},"46":{"loc":{"start":{"line":213,"column":21},"end":{"line":213,"column":55}},"type":"binary-expr","locations":[{"start":{"line":213,"column":21},"end":{"line":213,"column":35}},{"start":{"line":213,"column":39},"end":{"line":213,"column":55}}],"line":213},"47":{"loc":{"start":{"line":213,"column":102},"end":{"line":213,"column":185}},"type":"binary-expr","locations":[{"start":{"line":213,"column":102},"end":{"line":213,"column":116}},{"start":{"line":213,"column":120},"end":{"line":213,"column":185}}],"line":213},"48":{"loc":{"start":{"line":222,"column":19},"end":{"line":222,"column":167}},"type":"binary-expr","locations":[{"start":{"line":222,"column":20},"end":{"line":222,"column":161}},{"start":{"line":222,"column":166},"end":{"line":222,"column":167}}],"line":222},"49":{"loc":{"start":{"line":222,"column":20},"end":{"line":222,"column":161}},"type":"cond-expr","locations":[{"start":{"line":222,"column":57},"end":{"line":222,"column":63}},{"start":{"line":222,"column":66},"end":{"line":222,"column":161}}],"line":222},"50":{"loc":{"start":{"line":222,"column":20},"end":{"line":222,"column":54}},"type":"binary-expr","locations":[{"start":{"line":222,"column":20},"end":{"line":222,"column":34}},{"start":{"line":222,"column":38},"end":{"line":222,"column":54}}],"line":222},"51":{"loc":{"start":{"line":222,"column":66},"end":{"line":222,"column":161}},"type":"cond-expr","locations":[{"start":{"line":222,"column":133},"end":{"line":222,"column":139}},{"start":{"line":222,"column":142},"end":{"line":222,"column":161}}],"line":222},"52":{"loc":{"start":{"line":222,"column":66},"end":{"line":222,"column":130}},"type":"binary-expr","locations":[{"start":{"line":222,"column":66},"end":{"line":222,"column":103}},{"start":{"line":222,"column":107},"end":{"line":222,"column":130}}],"line":222},"53":{"loc":{"start":{"line":223,"column":19},"end":{"line":223,"column":103}},"type":"binary-expr","locations":[{"start":{"line":223,"column":20},"end":{"line":223,"column":97}},{"start":{"line":223,"column":102},"end":{"line":223,"column":103}}],"line":223},"54":{"loc":{"start":{"line":223,"column":20},"end":{"line":223,"column":97}},"type":"cond-expr","locations":[{"start":{"line":223,"column":57},"end":{"line":223,"column":63}},{"start":{"line":223,"column":66},"end":{"line":223,"column":97}}],"line":223},"55":{"loc":{"start":{"line":223,"column":20},"end":{"line":223,"column":54}},"type":"binary-expr","locations":[{"start":{"line":223,"column":20},"end":{"line":223,"column":34}},{"start":{"line":223,"column":38},"end":{"line":223,"column":54}}],"line":223},"56":{"loc":{"start":{"line":224,"column":15},"end":{"line":226,"column":18}},"type":"cond-expr","locations":[{"start":{"line":224,"column":82},"end":{"line":226,"column":13}},{"start":{"line":226,"column":16},"end":{"line":226,"column":18}}],"line":224},"57":{"loc":{"start":{"line":224,"column":16},"end":{"line":224,"column":78}},"type":"cond-expr","locations":[{"start":{"line":224,"column":53},"end":{"line":224,"column":59}},{"start":{"line":224,"column":62},"end":{"line":224,"column":78}}],"line":224},"58":{"loc":{"start":{"line":224,"column":16},"end":{"line":224,"column":50}},"type":"binary-expr","locations":[{"start":{"line":224,"column":16},"end":{"line":224,"column":30}},{"start":{"line":224,"column":34},"end":{"line":224,"column":50}}],"line":224},"59":{"loc":{"start":{"line":227,"column":15},"end":{"line":229,"column":18}},"type":"cond-expr","locations":[{"start":{"line":227,"column":82},"end":{"line":229,"column":13}},{"start":{"line":229,"column":16},"end":{"line":229,"column":18}}],"line":227},"60":{"loc":{"start":{"line":227,"column":16},"end":{"line":227,"column":78}},"type":"cond-expr","locations":[{"start":{"line":227,"column":53},"end":{"line":227,"column":59}},{"start":{"line":227,"column":62},"end":{"line":227,"column":78}}],"line":227},"61":{"loc":{"start":{"line":227,"column":16},"end":{"line":227,"column":50}},"type":"binary-expr","locations":[{"start":{"line":227,"column":16},"end":{"line":227,"column":30}},{"start":{"line":227,"column":34},"end":{"line":227,"column":50}}],"line":227}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":15,"9":15,"10":13,"11":0,"12":13,"13":13,"14":13,"15":0,"16":13,"17":6,"18":6,"19":1,"20":5,"21":5,"22":1,"23":4,"24":4,"25":4,"26":1,"27":10,"28":27,"29":27,"30":27,"31":27,"32":27,"33":27,"34":14,"35":14,"36":0,"37":14,"38":7,"39":1,"40":6,"41":6,"42":6,"43":2,"44":1,"45":1,"46":9,"47":1,"48":8,"49":8,"50":8,"51":1,"52":1,"53":1,"54":7,"55":7,"56":2,"57":7,"58":7,"59":1,"60":6,"61":1,"62":3,"63":3,"64":3,"65":2,"66":2,"67":2,"68":1,"69":1,"70":2,"71":15,"72":15,"73":15,"74":2,"75":15,"76":15,"77":1,"78":14,"79":14,"80":12,"81":2,"82":2,"83":1,"84":1,"85":1,"86":1,"87":27,"88":27,"89":27,"90":27,"91":5,"92":22,"93":22,"94":1,"95":21,"96":21,"97":1,"98":20,"99":20,"100":20,"101":6,"102":6,"103":20,"104":20,"105":2,"106":18,"107":8,"108":8,"109":6,"110":18,"111":1,"112":1,"113":17,"114":0,"115":17,"116":17,"117":7,"118":60,"119":1,"120":6,"121":8,"122":5},"f":{"0":1,"1":15,"2":13,"3":27,"4":27,"5":27,"6":14,"7":7,"8":2,"9":9,"10":3,"11":2,"12":15,"13":27,"14":60,"15":6,"16":8,"17":5},"b":{"0":[0,13],"1":[0],"2":[0,13],"3":[6,7],"4":[1,5],"5":[1,4],"6":[4,3,2],"7":[1,3],"8":[0,14],"9":[1,6],"10":[6,5],"11":[6,2],"12":[1,1],"13":[1,8],"14":[1,7],"15":[1,0],"16":[2,5],"17":[1,6],"18":[1,3],"19":[1,1],"20":[1,0],"21":[2,13],"22":[15,2],"23":[1,14],"24":[12,2],"25":[1,1],"26":[2,1],"27":[1,1],"28":[5,22],"29":[27,7],"30":[1,21],"31":[1,20],"32":[21,2],"33":[8,12],"34":[6,14],"35":[20,6],"36":[2,18],"37":[8,10],"38":[6,2],"39":[6,0,0],"40":[1,17],"41":[18,1],"42":[0,17],"43":[7,10],"44":[6,2],"45":[2,4],"46":[6,6],"47":[8,8],"48":[6,2],"49":[2,4],"50":[6,6],"51":[0,4],"52":[4,4],"53":[6,2],"54":[2,4],"55":[6,6],"56":[4,2],"57":[2,4],"58":[6,6],"59":[4,2],"60":[2,4],"61":[6,6]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/RoomServiceSender.ts"],"sourcesContent":["import type { FederationPaginatedResult, IFederationPublicRooms } from '@rocket.chat/rest-typings';\n\nimport { MatrixRoomJoinRules } from '../../../../../../../server/services/federation/infrastructure/matrix/definitions/MatrixRoomJoinRules';\nimport type { RocketChatFileAdapter } from '../../../../../../../server/services/federation/infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatMessageAdapter } from '../../../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Message';\nimport type { RocketChatNotificationAdapter } from '../../../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Notification';\nimport type { RocketChatSettingsAdapter } from '../../../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Settings';\nimport { ROCKET_CHAT_FEDERATION_ROLES } from '../../../../../../../server/services/federation/infrastructure/rocket-chat/definitions/FederatedRoomInternalRoles';\nimport { FederatedUserEE } from '../../../domain/FederatedUser';\nimport type { IFederationBridgeEE, IFederationPublicRoomsResult } from '../../../domain/IFederationBridge';\nimport type { RocketChatQueueAdapterEE } from '../../../infrastructure/rocket-chat/adapters/Queue';\nimport type { RocketChatRoomAdapterEE } from '../../../infrastructure/rocket-chat/adapters/Room';\nimport type { RocketChatUserAdapterEE } from '../../../infrastructure/rocket-chat/adapters/User';\nimport { AbstractFederationApplicationServiceEE } from '../../AbstractFederationApplicationServiceEE';\nimport type { FederationJoinExternalPublicRoomInputDto, FederationSearchPublicRoomsInputDto } from './input/RoomInputDto';\nimport type {\n\tFederationBeforeAddUserToARoomDto,\n\tFederationOnRoomCreationDto,\n\tFederationOnUsersAddedToARoomDto,\n\tFederationRoomInviteUserDto,\n\tFederationSetupRoomDto,\n\tIFederationInviteeDto,\n} from './input/RoomSenderDto';\n\nexport class FederationRoomServiceSender extends AbstractFederationApplicationServiceEE {\n\tconstructor(\n\t\tprotected internalRoomAdapter: RocketChatRoomAdapterEE,\n\t\tprotected internalUserAdapter: RocketChatUserAdapterEE,\n\t\tprotected internalFileAdapter: RocketChatFileAdapter,\n\t\tprotected internalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tprotected internalMessageAdapter: RocketChatMessageAdapter,\n\t\tprotected internalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tprotected internalQueueAdapter: RocketChatQueueAdapterEE,\n\t\tprotected bridge: IFederationBridgeEE,\n\t) {\n\t\tsuper(bridge, internalUserAdapter, internalFileAdapter, internalSettingsAdapter);\n\t}\n\n\tpublic async onRoomCreated(roomOnCreationInput: FederationOnRoomCreationDto): Promise<void> {\n\t\tconst { internalInviterId, internalRoomId, invitees } = roomOnCreationInput;\n\t\tawait this.setupFederatedRoom({ internalInviterId, internalRoomId });\n\n\t\tif (invitees.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.inviteLocalThenExternalUsers(invitees, internalInviterId, internalRoomId);\n\t}\n\n\tpublic async beforeAddUserToARoom(dmBeforeAddUserToARoomInput: FederationBeforeAddUserToARoomDto): Promise<void> {\n\t\tconst { invitees = [], internalInviter, internalRoomId } = dmBeforeAddUserToARoomInput;\n\t\tif (invitees.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tif (internalInviter) {\n\t\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalInviter._id);\n\t\t\tif (!federatedUser) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\t\tif (!federatedRoom) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst userRolesInThisRoom = await this.internalRoomAdapter.getInternalRoomRolesByUserId(\n\t\t\t\tfederatedRoom.getInternalId(),\n\t\t\t\tfederatedUser.getInternalId(),\n\t\t\t);\n\t\t\tconst canAddUserToARoom =\n\t\t\t\tuserRolesInThisRoom.includes(ROCKET_CHAT_FEDERATION_ROLES.OWNER) ||\n\t\t\t\tuserRolesInThisRoom.includes(ROCKET_CHAT_FEDERATION_ROLES.MODERATOR) ||\n\t\t\t\tfederatedRoom.isTheCreator(federatedUser.getInternalId());\n\t\t\tif (!canAddUserToARoom) {\n\t\t\t\tthrow new Error('You are not allowed to add users to this room');\n\t\t\t}\n\t\t}\n\n\t\tawait this.createUsersLocallyOnly(invitees);\n\t}\n\n\tprivate async inviteLocalThenExternalUsers(\n\t\tinvitees: IFederationInviteeDto[],\n\t\tinternalInviterId: string,\n\t\tinternalRoomId: string,\n\t): Promise<void> {\n\t\tconst localUsers = invitees.filter((user) =>\n\t\t\tFederatedUserEE.isOriginalFromTheProxyServer(this.bridge.extractHomeserverOrigin(user.rawInviteeId), this.internalHomeServerDomain),\n\t\t);\n\n\t\tconst externalUsers = invitees.filter(\n\t\t\t(user) =>\n\t\t\t\t!FederatedUserEE.isOriginalFromTheProxyServer(\n\t\t\t\t\tthis.bridge.extractHomeserverOrigin(user.rawInviteeId),\n\t\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t\t),\n\t\t);\n\n\t\tfor await (const user of [...localUsers, ...externalUsers]) {\n\t\t\tawait this.inviteUserToAFederatedRoom({\n\t\t\t\tinternalInviterId,\n\t\t\t\tinternalRoomId,\n\t\t\t\tinviteeUsernameOnly: user.inviteeUsernameOnly,\n\t\t\t\tnormalizedInviteeId: user.normalizedInviteeId,\n\t\t\t\trawInviteeId: user.rawInviteeId,\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic async onUsersAddedToARoom(roomOnUsersAddedToARoomInput: FederationOnUsersAddedToARoomDto): Promise<void> {\n\t\tconst { internalInviterId, internalRoomId, invitees, inviteComesFromAnExternalHomeServer } = roomOnUsersAddedToARoomInput;\n\n\t\tif (inviteComesFromAnExternalHomeServer) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.inviteLocalThenExternalUsers(invitees, internalInviterId, internalRoomId);\n\t}\n\n\tpublic async searchPublicRooms(roomSearchInputDto: FederationSearchPublicRoomsInputDto): Promise<\n\t\tFederationPaginatedResult<{\n\t\t\trooms: IFederationPublicRooms[];\n\t\t}>\n\t> {\n\t\tif (!this.internalSettingsAdapter.isFederationEnabled()) {\n\t\t\tthrow new Error('Federation is disabled');\n\t\t}\n\n\t\tconst { serverName, roomName, count, pageToken } = roomSearchInputDto;\n\t\tconst rooms = await this.bridge.searchPublicRooms({\n\t\t\tserverName: serverName || this.internalHomeServerDomain,\n\t\t\troomName,\n\t\t\tlimit: count,\n\t\t\tpageToken,\n\t\t});\n\n\t\treturn RoomMapper.toSearchPublicRoomsDto(\n\t\t\trooms,\n\t\t\tparseInt(this.internalSettingsAdapter.getMaximumSizeOfUsersWhenJoiningPublicRooms() || '0'),\n\t\t\tpageToken,\n\t\t);\n\t}\n\n\tpublic async scheduleJoinExternalPublicRoom(\n\t\tinternalUserId: string,\n\t\texternalRoomId: string,\n\t\troomName?: string,\n\t\tpageToken?: string,\n\t): Promise<void> {\n\t\tif (!this.internalSettingsAdapter.isFederationEnabled()) {\n\t\t\tthrow new Error('Federation is disabled');\n\t\t}\n\t\tawait this.internalQueueAdapter.enqueueJob('federation-enterprise.joinExternalPublicRoom', {\n\t\t\tinternalUserId,\n\t\t\texternalRoomId,\n\t\t\troomName,\n\t\t\tpageToken,\n\t\t});\n\t}\n\n\tpublic async joinExternalPublicRoom(joinExternalPublicRoomInputDto: FederationJoinExternalPublicRoomInputDto): Promise<void> {\n\t\tif (!this.internalSettingsAdapter.isFederationEnabled()) {\n\t\t\tthrow new Error('Federation is disabled');\n\t\t}\n\n\t\tconst { externalRoomId, internalUserId, externalRoomHomeServerName, roomName, pageToken } = joinExternalPublicRoomInputDto;\n\t\tconst room = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (room) {\n\t\t\tconst alreadyJoined = await this.internalRoomAdapter.isUserAlreadyJoined(room.getInternalId(), internalUserId);\n\t\t\tif (alreadyJoined) {\n\t\t\t\tthrow new Error('already-joined');\n\t\t\t}\n\t\t}\n\n\t\tconst user = await this.internalUserAdapter.getFederatedUserByInternalId(internalUserId);\n\t\tif (!user) {\n\t\t\tawait this.createFederatedUserIncludingHomeserverUsingLocalInformation(internalUserId);\n\t\t}\n\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalUserId);\n\t\tif (!federatedUser) {\n\t\t\tthrow new Error(`User with internalId ${internalUserId} not found`);\n\t\t}\n\t\tif (!(await this.isRoomSizeAllowed(externalRoomId, externalRoomHomeServerName, roomName, pageToken))) {\n\t\t\tthrow new Error(\"Can't join a room bigger than the admin of your workspace has set as the maximum size\");\n\t\t}\n\n\t\tawait this.bridge.joinRoom(externalRoomId, federatedUser.getExternalId(), [externalRoomHomeServerName]);\n\t}\n\n\tprivate async isRoomSizeAllowed(externalRoomId: string, serverName: string, roomName?: string, pageToken?: string): Promise<boolean> {\n\t\ttry {\n\t\t\tconst rooms = await this.bridge.searchPublicRooms({\n\t\t\t\tserverName,\n\t\t\t\tlimit: 50,\n\t\t\t\troomName,\n\t\t\t\tpageToken,\n\t\t\t});\n\n\t\t\tconst room = rooms.chunk.find((room) => room.room_id === externalRoomId);\n\t\t\tif (!room) {\n\t\t\t\tthrow new Error(\"Cannot find the room you're trying to join\");\n\t\t\t}\n\t\t\treturn room.num_joined_members <= parseInt(this.internalSettingsAdapter.getMaximumSizeOfUsersWhenJoiningPublicRooms() || '0');\n\t\t} catch (error) {\n\t\t\tthrow new Error(\"Cannot find the room you're trying to join\");\n\t\t}\n\t}\n\n\tprivate async setupFederatedRoom(roomInviteUserInput: FederationSetupRoomDto): Promise<void> {\n\t\tconst { internalInviterId, internalRoomId } = roomInviteUserInput;\n\t\tconst inviterUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalInviterId);\n\t\tif (!inviterUser) {\n\t\t\tawait this.createFederatedUserIncludingHomeserverUsingLocalInformation(internalInviterId);\n\t\t}\n\n\t\tconst federatedInviterUser = inviterUser || (await this.internalUserAdapter.getFederatedUserByInternalId(internalInviterId));\n\t\tif (!federatedInviterUser) {\n\t\t\tthrow new Error(`User with internalId ${internalInviterId} not found`);\n\t\t}\n\n\t\tconst internalFederatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\tif (internalFederatedRoom) {\n\t\t\treturn;\n\t\t}\n\t\tconst internalRoom = await this.internalRoomAdapter.getInternalRoomById(internalRoomId);\n\t\tif (!internalRoom || !internalRoom.name) {\n\t\t\tthrow new Error(`Room with internalId ${internalRoomId} not found`);\n\t\t}\n\t\tconst roomName = internalRoom.fname || internalRoom.name;\n\t\tconst externalRoomId = await this.bridge.createRoom(federatedInviterUser.getExternalId(), internalRoom.t, roomName, internalRoom.topic);\n\n\t\tawait this.internalRoomAdapter.updateFederatedRoomByInternalRoomId(internalRoom._id, externalRoomId);\n\t}\n\n\tprivate async inviteUserToAFederatedRoom(roomInviteUserInput: FederationRoomInviteUserDto): Promise<void> {\n\t\tconst { internalInviterId, internalRoomId, normalizedInviteeId, inviteeUsernameOnly, rawInviteeId } = roomInviteUserInput;\n\t\tconst isUserAutoJoining = Boolean(!internalInviterId);\n\n\t\tconst isInviteeFromTheSameHomeServer = FederatedUserEE.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(rawInviteeId),\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\n\t\tif (isUserAutoJoining && !isInviteeFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\tthrow new Error(`Could not find the room to invite. RoomId: ${internalRoomId}`);\n\t\t}\n\n\t\tconst federatedInviterUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalInviterId);\n\t\tif (!federatedInviterUser && !isUserAutoJoining) {\n\t\t\tthrow new Error(`User with internalId ${internalInviterId} not found`);\n\t\t}\n\n\t\tconst username = isInviteeFromTheSameHomeServer ? inviteeUsernameOnly : normalizedInviteeId;\n\t\tconst inviteeUser = await this.internalUserAdapter.getFederatedUserByInternalUsername(username);\n\t\tif (!inviteeUser) {\n\t\t\tconst existsOnlyOnProxyServer = isInviteeFromTheSameHomeServer;\n\t\t\tawait this.createFederatedUserInternallyOnly(rawInviteeId, username, existsOnlyOnProxyServer);\n\t\t}\n\n\t\tconst federatedInviteeUser = inviteeUser || (await this.internalUserAdapter.getFederatedUserByInternalUsername(username));\n\t\tif (!federatedInviteeUser) {\n\t\t\tthrow new Error(`User with internalUsername ${username} not found`);\n\t\t}\n\n\t\tif (isInviteeFromTheSameHomeServer) {\n\t\t\tconst profile = await this.bridge.getUserProfileInformation(federatedInviteeUser.getExternalId());\n\t\t\tif (!profile) {\n\t\t\t\tawait this.bridge.createUser(\n\t\t\t\t\tinviteeUsernameOnly,\n\t\t\t\t\tfederatedInviteeUser.getName() || federatedInviteeUser.getUsername() || username,\n\t\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (!federatedInviterUser && isUserAutoJoining) {\n\t\t\tawait this.bridge.joinRoom(federatedRoom.getExternalId(), federatedInviteeUser.getExternalId());\n\t\t\treturn;\n\t\t}\n\n\t\tif (!federatedInviterUser) {\n\t\t\tthrow new Error(`User with internalId ${internalInviterId} not found`);\n\t\t}\n\n\t\tawait this.bridge.inviteToRoom(\n\t\t\tfederatedRoom.getExternalId(),\n\t\t\tfederatedInviterUser.getExternalId(),\n\t\t\tfederatedInviteeUser.getExternalId(),\n\t\t);\n\t\tif (isInviteeFromTheSameHomeServer) {\n\t\t\tawait this.bridge.joinRoom(federatedRoom.getExternalId(), federatedInviteeUser.getExternalId());\n\t\t}\n\t}\n}\n\nclass RoomMapper {\n\tpublic static toSearchPublicRoomsDto(\n\t\trooms: IFederationPublicRoomsResult,\n\t\tmaxSizeOfUsersAllowed: number,\n\t\tpageToken?: string,\n\t): FederationPaginatedResult<{\n\t\trooms: IFederationPublicRooms[];\n\t}> {\n\t\treturn {\n\t\t\trooms: (rooms?.chunk || [])\n\t\t\t\t.filter((room) => room.join_rule && room.join_rule !== MatrixRoomJoinRules.KNOCK)\n\t\t\t\t.map((room) => ({\n\t\t\t\t\tid: room.room_id,\n\t\t\t\t\tname: room.name,\n\t\t\t\t\tcanJoin: room.num_joined_members <= maxSizeOfUsersAllowed,\n\t\t\t\t\tcanonicalAlias: room.canonical_alias,\n\t\t\t\t\tjoinedMembers: room.num_joined_members,\n\t\t\t\t\ttopic: room.topic,\n\t\t\t\t\tpageToken,\n\t\t\t\t})),\n\t\t\tcount: rooms?.chunk?.length || 0,\n\t\t\ttotal: rooms?.total_room_count_estimate || 0,\n\t\t\t...(rooms?.next_batch ? { nextPageToken: rooms.next_batch } : {}),\n\t\t\t...(rooms?.prev_batch ? { prevPageToken: rooms.prev_batch } : {}),\n\t\t};\n\t}\n}\n"],"names":["FederationRoomServiceSender","AbstractFederationApplicationServiceEE","onRoomCreated","roomOnCreationInput","internalInviterId","internalRoomId","invitees","setupFederatedRoom","length","inviteLocalThenExternalUsers","beforeAddUserToARoom","dmBeforeAddUserToARoomInput","internalInviter","federatedUser","internalUserAdapter","getFederatedUserByInternalId","_id","federatedRoom","internalRoomAdapter","getFederatedRoomByInternalId","userRolesInThisRoom","getInternalRoomRolesByUserId","getInternalId","canAddUserToARoom","includes","ROCKET_CHAT_FEDERATION_ROLES","OWNER","MODERATOR","isTheCreator","Error","createUsersLocallyOnly","localUsers","filter","user","FederatedUserEE","isOriginalFromTheProxyServer","bridge","extractHomeserverOrigin","rawInviteeId","internalHomeServerDomain","externalUsers","inviteUserToAFederatedRoom","inviteeUsernameOnly","normalizedInviteeId","onUsersAddedToARoom","roomOnUsersAddedToARoomInput","inviteComesFromAnExternalHomeServer","searchPublicRooms","roomSearchInputDto","internalSettingsAdapter","isFederationEnabled","serverName","roomName","count","pageToken","rooms","limit","RoomMapper","toSearchPublicRoomsDto","parseInt","getMaximumSizeOfUsersWhenJoiningPublicRooms","scheduleJoinExternalPublicRoom","internalUserId","externalRoomId","internalQueueAdapter","enqueueJob","joinExternalPublicRoom","joinExternalPublicRoomInputDto","externalRoomHomeServerName","room","getFederatedRoomByExternalId","alreadyJoined","isUserAlreadyJoined","createFederatedUserIncludingHomeserverUsingLocalInformation","isRoomSizeAllowed","joinRoom","getExternalId","chunk","find","room_id","num_joined_members","error","roomInviteUserInput","inviterUser","federatedInviterUser","internalFederatedRoom","internalRoom","getInternalRoomById","name","fname","createRoom","t","topic","updateFederatedRoomByInternalRoomId","isUserAutoJoining","Boolean","isInviteeFromTheSameHomeServer","username","inviteeUser","getFederatedUserByInternalUsername","existsOnlyOnProxyServer","createFederatedUserInternallyOnly","federatedInviteeUser","profile","getUserProfileInformation","createUser","getName","getUsername","inviteToRoom","constructor","internalFileAdapter","internalMessageAdapter","internalNotificationAdapter","maxSizeOfUsersAllowed","join_rule","MatrixRoomJoinRules","KNOCK","map","id","canJoin","canonicalAlias","canonical_alias","joinedMembers","total","total_room_count_estimate","next_batch","nextPageToken","prev_batch","prevPageToken"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/RoomServiceSender.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2666edf11f7b8b74bcb8ec2518a473509352c217","contentHash":"e19622989ec7f4e288a8583cf336be310bd0f40be59ca82db2603974dc92582b"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixRoomJoinRules.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixRoomJoinRules.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":35}},"3":{"start":{"line":11,"column":40},"end":{"line":16,"column":5}},"4":{"start":{"line":12,"column":4},"end":{"line":12,"column":43}},"5":{"start":{"line":13,"column":4},"end":{"line":13,"column":45}},"6":{"start":{"line":14,"column":4},"end":{"line":14,"column":43}},"7":{"start":{"line":15,"column":4},"end":{"line":15,"column":31}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":40},"end":{"line":11,"column":41}},"loc":{"start":{"line":11,"column":70},"end":{"line":16,"column":1}},"line":11}},"branchMap":{},"s":{"0":3,"1":3,"2":40,"3":3,"4":3,"5":3,"6":3,"7":3},"f":{"0":40,"1":3},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixRoomJoinRules.ts"],"sourcesContent":["export enum MatrixRoomJoinRules {\n\tJOIN = 'public',\n\tINVITE = 'invite',\n\tKNOCK = 'knock',\n}\n"],"names":["MatrixRoomJoinRules"],"mappings":";;;;+BAAYA;;;eAAAA;;;AAAL,IAAA,AAAKA,6CAAAA;;;;WAAAA","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixRoomJoinRules.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"75521e74e943b5ef5c644aff02c0c32ce595ad6d","contentHash":"b5e2b867fee87bf7da0d845535c34ae3cfbdeaceec07294f13dac5d785832155"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/definitions/FederatedRoomInternalRoles.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/definitions/FederatedRoomInternalRoles.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":44}},"3":{"start":{"line":11,"column":49},"end":{"line":15,"column":5}},"4":{"start":{"line":12,"column":4},"end":{"line":12,"column":60}},"5":{"start":{"line":13,"column":4},"end":{"line":13,"column":52}},"6":{"start":{"line":14,"column":4},"end":{"line":14,"column":40}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":49},"end":{"line":11,"column":50}},"loc":{"start":{"line":11,"column":88},"end":{"line":15,"column":1}},"line":11}},"branchMap":{},"s":{"0":4,"1":4,"2":109,"3":4,"4":4,"5":4,"6":4},"f":{"0":109,"1":4},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/definitions/FederatedRoomInternalRoles.ts"],"sourcesContent":["export enum ROCKET_CHAT_FEDERATION_ROLES {\n\tMODERATOR = 'moderator',\n\tOWNER = 'owner',\n}\n"],"names":["ROCKET_CHAT_FEDERATION_ROLES"],"mappings":";;;;+BAAYA;;;eAAAA;;;AAAL,IAAA,AAAKA,sDAAAA;;;WAAAA","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/definitions/FederatedRoomInternalRoles.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ee5f4bb8782b27aeb561d6cf591af9175ae90b97","contentHash":"abda79ebce87e6337bb6c0d7b2a4922b1159c7f44191f5f8a287dfc45474b753"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/UserService.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/UserService.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":34},"end":{"line":6,"column":81}},"3":{"start":{"line":7,"column":29},"end":{"line":7,"column":71}},"4":{"start":{"line":9,"column":4},"end":{"line":11,"column":6}},"5":{"start":{"line":13,"column":36},"end":{"line":22,"column":2}},"6":{"start":{"line":17,"column":16},"end":{"line":17,"column":35}},"7":{"start":{"line":23,"column":0},"end":{"line":177,"column":3}},"8":{"start":{"line":25,"column":24},"end":{"line":31,"column":5}},"9":{"start":{"line":32,"column":24},"end":{"line":42,"column":5}},"10":{"start":{"line":43,"column":28},"end":{"line":46,"column":5}},"11":{"start":{"line":47,"column":19},"end":{"line":54,"column":5}},"12":{"start":{"line":55,"column":24},"end":{"line":57,"column":5}},"13":{"start":{"line":58,"column":4},"end":{"line":60,"column":7}},"14":{"start":{"line":59,"column":8},"end":{"line":59,"column":97}},"15":{"start":{"line":61,"column":4},"end":{"line":83,"column":7}},"16":{"start":{"line":62,"column":8},"end":{"line":62,"column":57}},"17":{"start":{"line":63,"column":8},"end":{"line":63,"column":48}},"18":{"start":{"line":64,"column":8},"end":{"line":64,"column":42}},"19":{"start":{"line":65,"column":8},"end":{"line":65,"column":57}},"20":{"start":{"line":66,"column":8},"end":{"line":66,"column":48}},"21":{"start":{"line":67,"column":8},"end":{"line":67,"column":57}},"22":{"start":{"line":68,"column":8},"end":{"line":68,"column":57}},"23":{"start":{"line":69,"column":8},"end":{"line":69,"column":48}},"24":{"start":{"line":70,"column":8},"end":{"line":70,"column":63}},"25":{"start":{"line":71,"column":8},"end":{"line":71,"column":48}},"26":{"start":{"line":72,"column":8},"end":{"line":72,"column":54}},"27":{"start":{"line":73,"column":8},"end":{"line":73,"column":59}},"28":{"start":{"line":74,"column":8},"end":{"line":74,"column":75}},"29":{"start":{"line":75,"column":8},"end":{"line":75,"column":80}},"30":{"start":{"line":76,"column":8},"end":{"line":76,"column":52}},"31":{"start":{"line":77,"column":8},"end":{"line":77,"column":34}},"32":{"start":{"line":78,"column":8},"end":{"line":78,"column":32}},"33":{"start":{"line":79,"column":8},"end":{"line":79,"column":49}},"34":{"start":{"line":80,"column":8},"end":{"line":80,"column":35}},"35":{"start":{"line":81,"column":8},"end":{"line":81,"column":41}},"36":{"start":{"line":82,"column":8},"end":{"line":82,"column":51}},"37":{"start":{"line":84,"column":4},"end":{"line":129,"column":7}},"38":{"start":{"line":85,"column":8},"end":{"line":88,"column":11}},"39":{"start":{"line":86,"column":12},"end":{"line":86,"column":63}},"40":{"start":{"line":87,"column":12},"end":{"line":87,"column":133}},"41":{"start":{"line":89,"column":8},"end":{"line":128,"column":11}},"42":{"start":{"line":90,"column":12},"end":{"line":90,"column":62}},"43":{"start":{"line":91,"column":12},"end":{"line":94,"column":15}},"44":{"start":{"line":95,"column":27},"end":{"line":95,"column":83}},"45":{"start":{"line":96,"column":12},"end":{"line":127,"column":15}},"46":{"start":{"line":130,"column":4},"end":{"line":153,"column":7}},"47":{"start":{"line":131,"column":8},"end":{"line":134,"column":11}},"48":{"start":{"line":132,"column":12},"end":{"line":132,"column":63}},"49":{"start":{"line":133,"column":12},"end":{"line":133,"column":160}},"50":{"start":{"line":135,"column":8},"end":{"line":138,"column":11}},"51":{"start":{"line":136,"column":12},"end":{"line":136,"column":62}},"52":{"start":{"line":137,"column":12},"end":{"line":137,"column":162}},"53":{"start":{"line":139,"column":8},"end":{"line":146,"column":11}},"54":{"start":{"line":140,"column":12},"end":{"line":140,"column":62}},"55":{"start":{"line":141,"column":12},"end":{"line":141,"column":48}},"56":{"start":{"line":142,"column":12},"end":{"line":142,"column":96}},"57":{"start":{"line":143,"column":12},"end":{"line":145,"column":27}},"58":{"start":{"line":147,"column":8},"end":{"line":152,"column":11}},"59":{"start":{"line":148,"column":12},"end":{"line":148,"column":62}},"60":{"start":{"line":149,"column":12},"end":{"line":149,"column":48}},"61":{"start":{"line":150,"column":12},"end":{"line":150,"column":96}},"62":{"start":{"line":151,"column":12},"end":{"line":151,"column":144}},"63":{"start":{"line":154,"column":4},"end":{"line":176,"column":7}},"64":{"start":{"line":155,"column":8},"end":{"line":158,"column":11}},"65":{"start":{"line":156,"column":12},"end":{"line":156,"column":63}},"66":{"start":{"line":157,"column":12},"end":{"line":157,"column":163}},"67":{"start":{"line":159,"column":8},"end":{"line":162,"column":11}},"68":{"start":{"line":160,"column":12},"end":{"line":160,"column":62}},"69":{"start":{"line":161,"column":12},"end":{"line":161,"column":169}},"70":{"start":{"line":163,"column":8},"end":{"line":167,"column":11}},"71":{"start":{"line":164,"column":12},"end":{"line":164,"column":62}},"72":{"start":{"line":165,"column":12},"end":{"line":165,"column":68}},"73":{"start":{"line":166,"column":12},"end":{"line":166,"column":157}},"74":{"start":{"line":168,"column":8},"end":{"line":175,"column":11}},"75":{"start":{"line":169,"column":12},"end":{"line":169,"column":62}},"76":{"start":{"line":170,"column":12},"end":{"line":172,"column":15}},"77":{"start":{"line":173,"column":12},"end":{"line":173,"column":99}},"78":{"start":{"line":174,"column":12},"end":{"line":174,"column":149}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":8,"column":9},"end":{"line":8,"column":33}},"loc":{"start":{"line":8,"column":39},"end":{"line":12,"column":1}},"line":8},"1":{"name":"(anonymous_1)","decl":{"start":{"line":16,"column":12},"end":{"line":16,"column":13}},"loc":{"start":{"line":16,"column":26},"end":{"line":18,"column":13}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":23,"column":65},"end":{"line":23,"column":66}},"loc":{"start":{"line":23,"column":69},"end":{"line":177,"column":1}},"line":23},"3":{"name":"(anonymous_3)","decl":{"start":{"line":58,"column":15},"end":{"line":58,"column":16}},"loc":{"start":{"line":58,"column":19},"end":{"line":60,"column":5}},"line":58},"4":{"name":"(anonymous_4)","decl":{"start":{"line":61,"column":14},"end":{"line":61,"column":15}},"loc":{"start":{"line":61,"column":18},"end":{"line":83,"column":5}},"line":61},"5":{"name":"(anonymous_5)","decl":{"start":{"line":84,"column":58},"end":{"line":84,"column":59}},"loc":{"start":{"line":84,"column":62},"end":{"line":129,"column":5}},"line":84},"6":{"name":"(anonymous_6)","decl":{"start":{"line":85,"column":66},"end":{"line":85,"column":67}},"loc":{"start":{"line":85,"column":76},"end":{"line":88,"column":9}},"line":85},"7":{"name":"(anonymous_7)","decl":{"start":{"line":89,"column":97},"end":{"line":89,"column":98}},"loc":{"start":{"line":89,"column":107},"end":{"line":128,"column":9}},"line":89},"8":{"name":"(anonymous_8)","decl":{"start":{"line":130,"column":57},"end":{"line":130,"column":58}},"loc":{"start":{"line":130,"column":61},"end":{"line":153,"column":5}},"line":130},"9":{"name":"(anonymous_9)","decl":{"start":{"line":131,"column":66},"end":{"line":131,"column":67}},"loc":{"start":{"line":131,"column":76},"end":{"line":134,"column":9}},"line":131},"10":{"name":"(anonymous_10)","decl":{"start":{"line":135,"column":72},"end":{"line":135,"column":73}},"loc":{"start":{"line":135,"column":82},"end":{"line":138,"column":9}},"line":135},"11":{"name":"(anonymous_11)","decl":{"start":{"line":139,"column":69},"end":{"line":139,"column":70}},"loc":{"start":{"line":139,"column":79},"end":{"line":146,"column":9}},"line":139},"12":{"name":"(anonymous_12)","decl":{"start":{"line":147,"column":62},"end":{"line":147,"column":63}},"loc":{"start":{"line":147,"column":72},"end":{"line":152,"column":9}},"line":147},"13":{"name":"(anonymous_13)","decl":{"start":{"line":154,"column":60},"end":{"line":154,"column":61}},"loc":{"start":{"line":154,"column":64},"end":{"line":176,"column":5}},"line":154},"14":{"name":"(anonymous_14)","decl":{"start":{"line":155,"column":66},"end":{"line":155,"column":67}},"loc":{"start":{"line":155,"column":76},"end":{"line":158,"column":9}},"line":155},"15":{"name":"(anonymous_15)","decl":{"start":{"line":159,"column":75},"end":{"line":159,"column":76}},"loc":{"start":{"line":159,"column":85},"end":{"line":162,"column":9}},"line":159},"16":{"name":"(anonymous_16)","decl":{"start":{"line":163,"column":68},"end":{"line":163,"column":69}},"loc":{"start":{"line":163,"column":78},"end":{"line":167,"column":9}},"line":163},"17":{"name":"(anonymous_17)","decl":{"start":{"line":168,"column":65},"end":{"line":168,"column":66}},"loc":{"start":{"line":168,"column":75},"end":{"line":175,"column":9}},"line":168}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":11},"end":{"line":11,"column":5}},"type":"cond-expr","locations":[{"start":{"line":9,"column":35},"end":{"line":9,"column":38}},{"start":{"line":9,"column":41},"end":{"line":11,"column":5}}],"line":9},"1":{"loc":{"start":{"line":9,"column":11},"end":{"line":9,"column":32}},"type":"binary-expr","locations":[{"start":{"line":9,"column":11},"end":{"line":9,"column":14}},{"start":{"line":9,"column":18},"end":{"line":9,"column":32}}],"line":9}},"s":{"0":1,"1":1,"2":1,"3":1,"4":2,"5":1,"6":0,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":10,"15":1,"16":10,"17":10,"18":10,"19":10,"20":10,"21":10,"22":10,"23":10,"24":10,"25":10,"26":10,"27":10,"28":10,"29":10,"30":10,"31":10,"32":10,"33":10,"34":10,"35":10,"36":10,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1,"61":1,"62":1,"63":1,"64":1,"65":1,"66":1,"67":1,"68":1,"69":1,"70":1,"71":1,"72":1,"73":1,"74":1,"75":1,"76":1,"77":1,"78":1},"f":{"0":2,"1":0,"2":1,"3":10,"4":10,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1},"b":{"0":[0,2],"1":[2,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/UserService.spec.ts"],"sourcesContent":["import { expect } from 'chai';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\nconst { FederationUserServiceEE } = proxyquire\n\t.noCallThru()\n\t.load('../../../../../../server/local-services/federation/application/UserService', {\n\t\tmongodb: {\n\t\t\t'ObjectId': class ObjectId {\n\t\t\t\ttoHexString(): string {\n\t\t\t\t\treturn 'hexString';\n\t\t\t\t}\n\t\t\t},\n\t\t\t'@global': true,\n\t\t},\n\t});\n\ndescribe('FederationEE - Application - FederationUserServiceEE', () => {\n\tlet service: typeof FederationUserServiceEE;\n\tconst roomAdapter = {\n\t\tgetFederatedRoomByExternalId: sinon.stub(),\n\t\tcreateFederatedRoom: sinon.stub(),\n\t\taddUserToRoom: sinon.stub(),\n\t\tgetFederatedRoomByInternalId: sinon.stub(),\n\t\tisUserAlreadyJoined: sinon.stub(),\n\t};\n\tconst userAdapter = {\n\t\tgetFederatedUserByExternalId: sinon.stub(),\n\t\tgetFederatedUserByInternalId: sinon.stub(),\n\t\tgetInternalUserById: sinon.stub(),\n\t\tgetFederatedUserByInternalUsername: sinon.stub(),\n\t\tcreateFederatedUser: sinon.stub(),\n\t\tgetInternalUserByUsername: sinon.stub(),\n\t\tgetSearchedServerNamesByUserId: sinon.stub(),\n\t\taddServerNameToSearchedServerNamesListByUserId: sinon.stub(),\n\t\tremoveServerNameFromSearchedServerNamesListByUserId: sinon.stub(),\n\t};\n\tconst settingsAdapter = {\n\t\tgetHomeServerDomain: sinon.stub().returns('localDomain'),\n\t\tisFederationEnabled: sinon.stub(),\n\t};\n\tconst bridge = {\n\t\tcreateUser: sinon.stub(),\n\t\tjoinRoom: sinon.stub(),\n\t\tgetRoomData: sinon.stub(),\n\t\tgetUserProfileInformation: sinon.stub(),\n\t\textractHomeserverOrigin: sinon.stub(),\n\t\tsearchPublicRooms: sinon.stub(),\n\t};\n\tconst fileAdapter = {\n\t\tgetBufferForAvatarFile: sinon.stub(),\n\t};\n\n\tbeforeEach(() => {\n\t\tservice = new FederationUserServiceEE(settingsAdapter as any, fileAdapter as any, userAdapter as any, bridge as any);\n\t});\n\n\tafterEach(() => {\n\t\troomAdapter.getFederatedRoomByExternalId.reset();\n\t\troomAdapter.createFederatedRoom.reset();\n\t\troomAdapter.addUserToRoom.reset();\n\t\troomAdapter.getFederatedRoomByInternalId.reset();\n\t\troomAdapter.isUserAlreadyJoined.reset();\n\t\tuserAdapter.getFederatedUserByExternalId.reset();\n\t\tuserAdapter.getFederatedUserByInternalId.reset();\n\t\tuserAdapter.getInternalUserById.reset();\n\t\tuserAdapter.getFederatedUserByInternalUsername.reset();\n\t\tuserAdapter.createFederatedUser.reset();\n\t\tuserAdapter.getInternalUserByUsername.reset();\n\t\tuserAdapter.getSearchedServerNamesByUserId.reset();\n\t\tuserAdapter.addServerNameToSearchedServerNamesListByUserId.reset();\n\t\tuserAdapter.removeServerNameFromSearchedServerNamesListByUserId.reset();\n\t\tsettingsAdapter.isFederationEnabled.reset();\n\t\tbridge.createUser.reset();\n\t\tbridge.joinRoom.reset();\n\t\tbridge.getUserProfileInformation.reset();\n\t\tbridge.getRoomData.reset();\n\t\tbridge.searchPublicRooms.reset();\n\t\tfileAdapter.getBufferForAvatarFile.reset();\n\t});\n\n\tdescribe('#getSearchedServerNamesByInternalUserId()', () => {\n\t\tit('should throw an error if the federation is disabled', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(false);\n\t\t\tawait expect(service.getSearchedServerNamesByInternalUserId({} as any)).to.be.rejectedWith('Federation is disabled');\n\t\t});\n\n\t\tit('should return the Matrix default public rooms + the ones already saved by the user', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\tuserAdapter.getSearchedServerNamesByUserId.resolves(['server1.com', 'server2.com']);\n\t\t\tconst result = await service.getSearchedServerNamesByInternalUserId({} as any);\n\n\t\t\texpect(result).to.be.eql([\n\t\t\t\t{\n\t\t\t\t\tname: 'localDomain',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tlocal: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'matrix.org',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tlocal: false,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'gitter.im',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tlocal: false,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'libera.chat',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tlocal: false,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'server1.com',\n\t\t\t\t\tdefault: false,\n\t\t\t\t\tlocal: false,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'server2.com',\n\t\t\t\t\tdefault: false,\n\t\t\t\t\tlocal: false,\n\t\t\t\t},\n\t\t\t]);\n\t\t});\n\t});\n\n\tdescribe('#addSearchedServerNameByInternalUserId()', () => {\n\t\tit('should throw an error if the federation is disabled', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(false);\n\t\t\tawait expect(service.addSearchedServerNameByInternalUserId('internalUserId', 'serverName')).to.be.rejectedWith(\n\t\t\t\t'Federation is disabled',\n\t\t\t);\n\t\t});\n\n\t\tit('should throw an error when trying to add a default server', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\tawait expect(service.addSearchedServerNameByInternalUserId('internalUserId', 'matrix.org')).to.be.rejectedWith(\n\t\t\t\t'already-a-default-server',\n\t\t\t);\n\t\t});\n\n\t\tit('should call the bridge to check if the server is valid', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\tbridge.searchPublicRooms.resolves();\n\t\t\tawait service.addSearchedServerNameByInternalUserId('internalUserId', 'serverName');\n\t\t\texpect(bridge.searchPublicRooms.calledWith({ serverName: 'serverName' })).to.be.true;\n\t\t});\n\n\t\tit('should call the function to add the server name', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\tbridge.searchPublicRooms.resolves();\n\t\t\tawait service.addSearchedServerNameByInternalUserId('internalUserId', 'serverName');\n\t\t\texpect(userAdapter.addServerNameToSearchedServerNamesListByUserId.calledWith('internalUserId', 'serverName')).to.be.true;\n\t\t});\n\t});\n\n\tdescribe('#removeSearchedServerNameByInternalUserId()', () => {\n\t\tit('should throw an error if the federation is disabled', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(false);\n\t\t\tawait expect(service.removeSearchedServerNameByInternalUserId('internalUserId', 'serverName')).to.be.rejectedWith(\n\t\t\t\t'Federation is disabled',\n\t\t\t);\n\t\t});\n\n\t\tit('should throw an error when trying to remove a default server', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\tawait expect(service.removeSearchedServerNameByInternalUserId('internalUserId', 'matrix.org')).to.be.rejectedWith(\n\t\t\t\t'cannot-remove-default-server',\n\t\t\t);\n\t\t});\n\n\t\tit('should throw an error when the server does not exists', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\tuserAdapter.getSearchedServerNamesByUserId.resolves([]);\n\t\t\tawait expect(service.removeSearchedServerNameByInternalUserId('internalUserId', 'serverName')).to.be.rejectedWith('server-not-found');\n\t\t});\n\n\t\tit('should call the function to remove the server name', async () => {\n\t\t\tsettingsAdapter.isFederationEnabled.returns(true);\n\t\t\tuserAdapter.getSearchedServerNamesByUserId.resolves(['serverName']);\n\t\t\tawait service.removeSearchedServerNameByInternalUserId('internalUserId', 'serverName');\n\t\t\texpect(userAdapter.removeServerNameFromSearchedServerNamesListByUserId.calledWith('internalUserId', 'serverName')).to.be.true;\n\t\t});\n\t});\n});\n"],"names":["FederationUserServiceEE","proxyquire","noCallThru","load","mongodb","ObjectId","toHexString","describe","service","roomAdapter","getFederatedRoomByExternalId","sinon","stub","createFederatedRoom","addUserToRoom","getFederatedRoomByInternalId","isUserAlreadyJoined","userAdapter","getFederatedUserByExternalId","getFederatedUserByInternalId","getInternalUserById","getFederatedUserByInternalUsername","createFederatedUser","getInternalUserByUsername","getSearchedServerNamesByUserId","addServerNameToSearchedServerNamesListByUserId","removeServerNameFromSearchedServerNamesListByUserId","settingsAdapter","getHomeServerDomain","returns","isFederationEnabled","bridge","createUser","joinRoom","getRoomData","getUserProfileInformation","extractHomeserverOrigin","searchPublicRooms","fileAdapter","getBufferForAvatarFile","beforeEach","afterEach","reset","it","expect","getSearchedServerNamesByInternalUserId","to","be","rejectedWith","resolves","result","eql","name","default","local","addSearchedServerNameByInternalUserId","calledWith","serverName","true","removeSearchedServerNameByInternalUserId"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/application/UserService.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"49dd27349c0a39a1d48e8cdb86aa478453074b0e","contentHash":"39bd9e9f412caa6d0127a80ca09c878f5f77a5e431f592d74fb58095a235c740"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/UserService.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/UserService.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":39}},"3":{"start":{"line":11,"column":48},"end":{"line":11,"column":99}},"4":{"start":{"line":12,"column":24},"end":{"line":28,"column":1}},"5":{"start":{"line":29,"column":30},"end":{"line":80,"column":1}},"6":{"start":{"line":31,"column":8},"end":{"line":33,"column":9}},"7":{"start":{"line":32,"column":12},"end":{"line":32,"column":54}},"8":{"start":{"line":34,"column":38},"end":{"line":34,"column":115}},"9":{"start":{"line":35,"column":8},"end":{"line":42,"column":10}},"10":{"start":{"line":37,"column":52},"end":{"line":41,"column":17}},"11":{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},"12":{"start":{"line":46,"column":12},"end":{"line":46,"column":54}},"13":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"14":{"start":{"line":48,"column":49},"end":{"line":48,"column":75}},"15":{"start":{"line":49,"column":12},"end":{"line":49,"column":56}},"16":{"start":{"line":51,"column":8},"end":{"line":53,"column":11}},"17":{"start":{"line":54,"column":8},"end":{"line":54,"column":114}},"18":{"start":{"line":57,"column":8},"end":{"line":59,"column":9}},"19":{"start":{"line":58,"column":12},"end":{"line":58,"column":54}},"20":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"21":{"start":{"line":60,"column":49},"end":{"line":60,"column":75}},"22":{"start":{"line":61,"column":12},"end":{"line":61,"column":60}},"23":{"start":{"line":63,"column":38},"end":{"line":63,"column":115}},"24":{"start":{"line":64,"column":8},"end":{"line":66,"column":9}},"25":{"start":{"line":65,"column":12},"end":{"line":65,"column":48}},"26":{"start":{"line":67,"column":8},"end":{"line":67,"column":119}},"27":{"start":{"line":70,"column":8},"end":{"line":70,"column":263}},"28":{"start":{"line":71,"column":8},"end":{"line":78,"column":10}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":30,"column":4},"end":{"line":30,"column":5}},"loc":{"start":{"line":30,"column":65},"end":{"line":43,"column":5}},"line":30},"2":{"name":"(anonymous_2)","decl":{"start":{"line":37,"column":41},"end":{"line":37,"column":42}},"loc":{"start":{"line":37,"column":52},"end":{"line":41,"column":17}},"line":37},"3":{"name":"(anonymous_3)","decl":{"start":{"line":44,"column":4},"end":{"line":44,"column":5}},"loc":{"start":{"line":44,"column":76},"end":{"line":55,"column":5}},"line":44},"4":{"name":"(anonymous_4)","decl":{"start":{"line":48,"column":39},"end":{"line":48,"column":40}},"loc":{"start":{"line":48,"column":49},"end":{"line":48,"column":75}},"line":48},"5":{"name":"(anonymous_5)","decl":{"start":{"line":56,"column":4},"end":{"line":56,"column":5}},"loc":{"start":{"line":56,"column":79},"end":{"line":68,"column":5}},"line":56},"6":{"name":"(anonymous_6)","decl":{"start":{"line":60,"column":39},"end":{"line":60,"column":40}},"loc":{"start":{"line":60,"column":49},"end":{"line":60,"column":75}},"line":60},"7":{"name":"(anonymous_7)","decl":{"start":{"line":69,"column":4},"end":{"line":69,"column":5}},"loc":{"start":{"line":69,"column":90},"end":{"line":79,"column":5}},"line":69}},"branchMap":{"0":{"loc":{"start":{"line":31,"column":8},"end":{"line":33,"column":9}},"type":"if","locations":[{"start":{"line":31,"column":8},"end":{"line":33,"column":9}},{"start":{"line":31,"column":8},"end":{"line":33,"column":9}}],"line":31},"1":{"loc":{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},{"start":{"line":45,"column":8},"end":{"line":47,"column":9}}],"line":45},"2":{"loc":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"type":"if","locations":[{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},{"start":{"line":48,"column":8},"end":{"line":50,"column":9}}],"line":48},"3":{"loc":{"start":{"line":57,"column":8},"end":{"line":59,"column":9}},"type":"if","locations":[{"start":{"line":57,"column":8},"end":{"line":59,"column":9}},{"start":{"line":57,"column":8},"end":{"line":59,"column":9}}],"line":57},"4":{"loc":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"type":"if","locations":[{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},{"start":{"line":60,"column":8},"end":{"line":62,"column":9}}],"line":60},"5":{"loc":{"start":{"line":64,"column":8},"end":{"line":66,"column":9}},"type":"if","locations":[{"start":{"line":64,"column":8},"end":{"line":66,"column":9}},{"start":{"line":64,"column":8},"end":{"line":66,"column":9}}],"line":64}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":1,"8":1,"9":1,"10":2,"11":4,"12":1,"13":3,"14":10,"15":1,"16":2,"17":2,"18":4,"19":1,"20":3,"21":10,"22":1,"23":2,"24":2,"25":1,"26":1,"27":10,"28":10},"f":{"0":1,"1":2,"2":2,"3":4,"4":10,"5":4,"6":10,"7":10},"b":{"0":[1,1],"1":[1,3],"2":[1,2],"3":[1,3],"4":[1,2],"5":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/UserService.ts"],"sourcesContent":["import type { RocketChatFileAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatSettingsAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Settings';\nimport type { IFederationBridgeEE } from '../domain/IFederationBridge';\nimport type { RocketChatUserAdapterEE } from '../infrastructure/rocket-chat/adapters/User';\nimport { AbstractFederationApplicationServiceEE } from './AbstractFederationApplicationServiceEE';\n\nconst DEFAULT_SERVERS = [\n\t{\n\t\tname: 'matrix.org',\n\t\tdefault: true,\n\t\tlocal: false,\n\t},\n\t{\n\t\tname: 'gitter.im',\n\t\tdefault: true,\n\t\tlocal: false,\n\t},\n\t{\n\t\tname: 'libera.chat',\n\t\tdefault: true,\n\t\tlocal: false,\n\t},\n];\n\nexport class FederationUserServiceEE extends AbstractFederationApplicationServiceEE {\n\tprivate readonly availableServers: { name: string; default: boolean; local: boolean }[];\n\n\tconstructor(\n\t\tprotected readonly internalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tprotected readonly internalFileAdapter: RocketChatFileAdapter,\n\t\tprotected readonly internalUserAdapter: RocketChatUserAdapterEE,\n\t\tprotected readonly bridge: IFederationBridgeEE,\n\t) {\n\t\tsuper(bridge, internalUserAdapter, internalFileAdapter, internalSettingsAdapter);\n\t\tthis.availableServers = [\n\t\t\t{\n\t\t\t\tname: this.internalHomeServerDomain,\n\t\t\t\tdefault: true,\n\t\t\t\tlocal: true,\n\t\t\t},\n\t\t\t...DEFAULT_SERVERS,\n\t\t];\n\t}\n\n\tpublic async getSearchedServerNamesByInternalUserId(\n\t\tinternalUserId: string,\n\t): Promise<{ name: string; default: boolean; local: boolean }[]> {\n\t\tif (!this.internalSettingsAdapter.isFederationEnabled()) {\n\t\t\tthrow new Error('Federation is disabled');\n\t\t}\n\n\t\tconst searchedServersByUser = await this.internalUserAdapter.getSearchedServerNamesByUserId(internalUserId);\n\n\t\treturn [...this.availableServers, ...searchedServersByUser.map((server) => ({ name: server, default: false, local: false }))];\n\t}\n\n\tpublic async addSearchedServerNameByInternalUserId(internalUserId: string, serverName: string): Promise<void> {\n\t\tif (!this.internalSettingsAdapter.isFederationEnabled()) {\n\t\t\tthrow new Error('Federation is disabled');\n\t\t}\n\n\t\tif (this.availableServers.some((server) => server.name === serverName)) {\n\t\t\tthrow new Error('already-a-default-server');\n\t\t}\n\n\t\tawait this.bridge.searchPublicRooms({\n\t\t\tserverName,\n\t\t});\n\n\t\tawait this.internalUserAdapter.addServerNameToSearchedServerNamesListByUserId(internalUserId, serverName);\n\t}\n\n\tpublic async removeSearchedServerNameByInternalUserId(internalUserId: string, serverName: string): Promise<void> {\n\t\tif (!this.internalSettingsAdapter.isFederationEnabled()) {\n\t\t\tthrow new Error('Federation is disabled');\n\t\t}\n\n\t\tif (this.availableServers.some((server) => server.name === serverName)) {\n\t\t\tthrow new Error('cannot-remove-default-server');\n\t\t}\n\n\t\tconst searchedServersByUser = await this.internalUserAdapter.getSearchedServerNamesByUserId(internalUserId);\n\t\tif (!searchedServersByUser.includes(serverName)) {\n\t\t\tthrow new Error('server-not-found');\n\t\t}\n\n\t\tawait this.internalUserAdapter.removeServerNameFromSearchedServerNamesListByUserId(internalUserId, serverName);\n\t}\n}\n"],"names":["FederationUserServiceEE","DEFAULT_SERVERS","name","default","local","AbstractFederationApplicationServiceEE","getSearchedServerNamesByInternalUserId","internalUserId","internalSettingsAdapter","isFederationEnabled","Error","searchedServersByUser","internalUserAdapter","getSearchedServerNamesByUserId","availableServers","map","server","addSearchedServerNameByInternalUserId","serverName","some","bridge","searchPublicRooms","addServerNameToSearchedServerNamesListByUserId","removeSearchedServerNameByInternalUserId","includes","removeServerNameFromSearchedServerNamesListByUserId","constructor","internalFileAdapter","internalHomeServerDomain"],"mappings":";;;;+BAwBaA;;;eAAAA;;;wDApB0C;AAEvD,MAAMC,kBAAkB;IACvB;QACCC,MAAM;QACNC,SAAS;QACTC,OAAO;IACR;IACA;QACCF,MAAM;QACNC,SAAS;QACTC,OAAO;IACR;IACA;QACCF,MAAM;QACNC,SAAS;QACTC,OAAO;IACR;CACA;AAEM,IAAA,AAAMJ,0BAAN,MAAMA,gCAAgCK,8EAAsC;IAoBlF,MAAaC,uCACZC,cAAsB,EAC0C;QAChE,IAAI,CAAC,IAAI,CAACC,uBAAuB,CAACC,mBAAmB,IAAI;YACxD,MAAM,IAAIC,MAAM;QACjB;QAEA,MAAMC,wBAAwB,MAAM,IAAI,CAACC,mBAAmB,CAACC,8BAA8B,CAACN;QAE5F,OAAO;eAAI,IAAI,CAACO,gBAAgB;eAAKH,sBAAsBI,GAAG,CAAC,CAACC,SAAY,CAAA;oBAAEd,MAAMc;oBAAQb,SAAS;oBAAOC,OAAO;gBAAM,CAAA;SAAI;IAC9H;IAEA,MAAaa,sCAAsCV,cAAsB,EAAEW,UAAkB,EAAiB;QAC7G,IAAI,CAAC,IAAI,CAACV,uBAAuB,CAACC,mBAAmB,IAAI;YACxD,MAAM,IAAIC,MAAM;QACjB;QAEA,IAAI,IAAI,CAACI,gBAAgB,CAACK,IAAI,CAAC,CAACH,SAAWA,OAAOd,IAAI,KAAKgB,aAAa;YACvE,MAAM,IAAIR,MAAM;QACjB;QAEA,MAAM,IAAI,CAACU,MAAM,CAACC,iBAAiB,CAAC;YACnCH;QACD;QAEA,MAAM,IAAI,CAACN,mBAAmB,CAACU,8CAA8C,CAACf,gBAAgBW;IAC/F;IAEA,MAAaK,yCAAyChB,cAAsB,EAAEW,UAAkB,EAAiB;QAChH,IAAI,CAAC,IAAI,CAACV,uBAAuB,CAACC,mBAAmB,IAAI;YACxD,MAAM,IAAIC,MAAM;QACjB;QAEA,IAAI,IAAI,CAACI,gBAAgB,CAACK,IAAI,CAAC,CAACH,SAAWA,OAAOd,IAAI,KAAKgB,aAAa;YACvE,MAAM,IAAIR,MAAM;QACjB;QAEA,MAAMC,wBAAwB,MAAM,IAAI,CAACC,mBAAmB,CAACC,8BAA8B,CAACN;QAC5F,IAAI,CAACI,sBAAsBa,QAAQ,CAACN,aAAa;YAChD,MAAM,IAAIR,MAAM;QACjB;QAEA,MAAM,IAAI,CAACE,mBAAmB,CAACa,mDAAmD,CAAClB,gBAAgBW;IACpG;IA5DAQ,YACC,AAAmBlB,uBAAkD,EACrE,AAAmBmB,mBAA0C,EAC7D,AAAmBf,mBAA4C,EAC/D,AAAmBQ,MAA2B,CAC7C;QACD,KAAK,CAACA,QAAQR,qBAAqBe,qBAAqBnB,+BALrCA,0BAAAA,8BACAmB,sBAAAA,0BACAf,sBAAAA,0BACAQ,SAAAA;QAGnB,IAAI,CAACN,gBAAgB,GAAG;YACvB;gBACCZ,MAAM,IAAI,CAAC0B,wBAAwB;gBACnCzB,SAAS;gBACTC,OAAO;YACR;eACGH;SACH;IACF;AA8CD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/UserService.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"135f5a91633e41f69074ea62d60016ef16c147f3","contentHash":"02b89eef8340bf2f98161faa8bd0986f6feb6c3615a99fa101bd20f9d5e42534"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/infrastructure/rocket-chat/converters/RoomSender.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/infrastructure/rocket-chat/converters/RoomSender.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":23},"end":{"line":6,"column":134}},"3":{"start":{"line":7,"column":20},"end":{"line":7,"column":136}},"4":{"start":{"line":8,"column":0},"end":{"line":220,"column":3}},"5":{"start":{"line":9,"column":22},"end":{"line":9,"column":50}},"6":{"start":{"line":10,"column":4},"end":{"line":22,"column":7}},"7":{"start":{"line":11,"column":8},"end":{"line":13,"column":11}},"8":{"start":{"line":12,"column":12},"end":{"line":12,"column":190}},"9":{"start":{"line":14,"column":8},"end":{"line":21,"column":11}},"10":{"start":{"line":15,"column":27},"end":{"line":15,"column":124}},"11":{"start":{"line":16,"column":12},"end":{"line":16,"column":99}},"12":{"start":{"line":17,"column":12},"end":{"line":17,"column":75}},"13":{"start":{"line":18,"column":12},"end":{"line":18,"column":88}},"14":{"start":{"line":19,"column":12},"end":{"line":19,"column":81}},"15":{"start":{"line":20,"column":12},"end":{"line":20,"column":74}},"16":{"start":{"line":23,"column":4},"end":{"line":32,"column":7}},"17":{"start":{"line":24,"column":8},"end":{"line":26,"column":11}},"18":{"start":{"line":25,"column":12},"end":{"line":25,"column":169}},"19":{"start":{"line":27,"column":8},"end":{"line":31,"column":11}},"20":{"start":{"line":28,"column":27},"end":{"line":28,"column":108}},"21":{"start":{"line":29,"column":12},"end":{"line":29,"column":75}},"22":{"start":{"line":30,"column":12},"end":{"line":30,"column":81}},"23":{"start":{"line":33,"column":4},"end":{"line":55,"column":7}},"24":{"start":{"line":34,"column":8},"end":{"line":38,"column":11}},"25":{"start":{"line":35,"column":12},"end":{"line":37,"column":87}},"26":{"start":{"line":39,"column":8},"end":{"line":54,"column":11}},"27":{"start":{"line":41,"column":27},"end":{"line":44,"column":24}},"28":{"start":{"line":45,"column":12},"end":{"line":45,"column":75}},"29":{"start":{"line":46,"column":12},"end":{"line":46,"column":81}},"30":{"start":{"line":47,"column":12},"end":{"line":53,"column":15}},"31":{"start":{"line":56,"column":4},"end":{"line":87,"column":7}},"32":{"start":{"line":57,"column":8},"end":{"line":72,"column":11}},"33":{"start":{"line":59,"column":27},"end":{"line":62,"column":24}},"34":{"start":{"line":63,"column":12},"end":{"line":63,"column":75}},"35":{"start":{"line":64,"column":12},"end":{"line":64,"column":81}},"36":{"start":{"line":65,"column":12},"end":{"line":71,"column":15}},"37":{"start":{"line":73,"column":8},"end":{"line":79,"column":11}},"38":{"start":{"line":74,"column":27},"end":{"line":77,"column":24}},"39":{"start":{"line":78,"column":12},"end":{"line":78,"column":92}},"40":{"start":{"line":80,"column":8},"end":{"line":86,"column":11}},"41":{"start":{"line":81,"column":27},"end":{"line":84,"column":28}},"42":{"start":{"line":85,"column":12},"end":{"line":85,"column":93}},"43":{"start":{"line":88,"column":4},"end":{"line":129,"column":7}},"44":{"start":{"line":89,"column":8},"end":{"line":114,"column":11}},"45":{"start":{"line":91,"column":27},"end":{"line":101,"column":24}},"46":{"start":{"line":102,"column":12},"end":{"line":113,"column":15}},"47":{"start":{"line":115,"column":8},"end":{"line":121,"column":11}},"48":{"start":{"line":116,"column":27},"end":{"line":119,"column":24}},"49":{"start":{"line":120,"column":12},"end":{"line":120,"column":92}},"50":{"start":{"line":122,"column":8},"end":{"line":128,"column":11}},"51":{"start":{"line":123,"column":27},"end":{"line":126,"column":28}},"52":{"start":{"line":127,"column":12},"end":{"line":127,"column":93}},"53":{"start":{"line":130,"column":4},"end":{"line":152,"column":7}},"54":{"start":{"line":131,"column":8},"end":{"line":151,"column":11}},"55":{"start":{"line":133,"column":27},"end":{"line":143,"column":24}},"56":{"start":{"line":144,"column":12},"end":{"line":150,"column":15}},"57":{"start":{"line":153,"column":4},"end":{"line":178,"column":7}},"58":{"start":{"line":154,"column":8},"end":{"line":177,"column":11}},"59":{"start":{"line":156,"column":27},"end":{"line":168,"column":24}},"60":{"start":{"line":169,"column":12},"end":{"line":169,"column":75}},"61":{"start":{"line":170,"column":12},"end":{"line":176,"column":15}},"62":{"start":{"line":179,"column":4},"end":{"line":205,"column":7}},"63":{"start":{"line":180,"column":8},"end":{"line":204,"column":11}},"64":{"start":{"line":181,"column":27},"end":{"line":191,"column":14}},"65":{"start":{"line":192,"column":12},"end":{"line":192,"column":81}},"66":{"start":{"line":193,"column":12},"end":{"line":203,"column":15}},"67":{"start":{"line":206,"column":4},"end":{"line":219,"column":7}},"68":{"start":{"line":207,"column":8},"end":{"line":211,"column":11}},"69":{"start":{"line":208,"column":27},"end":{"line":208,"column":146}},"70":{"start":{"line":209,"column":12},"end":{"line":209,"column":95}},"71":{"start":{"line":210,"column":12},"end":{"line":210,"column":85}},"72":{"start":{"line":212,"column":8},"end":{"line":218,"column":11}},"73":{"start":{"line":213,"column":27},"end":{"line":213,"column":146}},"74":{"start":{"line":214,"column":12},"end":{"line":214,"column":95}},"75":{"start":{"line":215,"column":12},"end":{"line":215,"column":85}},"76":{"start":{"line":216,"column":12},"end":{"line":216,"column":83}},"77":{"start":{"line":217,"column":12},"end":{"line":217,"column":91}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":8,"column":85},"end":{"line":8,"column":86}},"loc":{"start":{"line":8,"column":89},"end":{"line":220,"column":1}},"line":8},"1":{"name":"(anonymous_1)","decl":{"start":{"line":10,"column":39},"end":{"line":10,"column":40}},"loc":{"start":{"line":10,"column":43},"end":{"line":22,"column":5}},"line":10},"2":{"name":"(anonymous_2)","decl":{"start":{"line":11,"column":71},"end":{"line":11,"column":72}},"loc":{"start":{"line":11,"column":75},"end":{"line":13,"column":9}},"line":11},"3":{"name":"(anonymous_3)","decl":{"start":{"line":14,"column":163},"end":{"line":14,"column":164}},"loc":{"start":{"line":14,"column":167},"end":{"line":21,"column":9}},"line":14},"4":{"name":"(anonymous_4)","decl":{"start":{"line":23,"column":34},"end":{"line":23,"column":35}},"loc":{"start":{"line":23,"column":38},"end":{"line":32,"column":5}},"line":23},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":66},"end":{"line":24,"column":67}},"loc":{"start":{"line":24,"column":70},"end":{"line":26,"column":9}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":88},"end":{"line":27,"column":89}},"loc":{"start":{"line":27,"column":92},"end":{"line":31,"column":9}},"line":27},"7":{"name":"(anonymous_7)","decl":{"start":{"line":33,"column":39},"end":{"line":33,"column":40}},"loc":{"start":{"line":33,"column":43},"end":{"line":55,"column":5}},"line":33},"8":{"name":"(anonymous_8)","decl":{"start":{"line":34,"column":71},"end":{"line":34,"column":72}},"loc":{"start":{"line":34,"column":75},"end":{"line":38,"column":9}},"line":34},"9":{"name":"(anonymous_9)","decl":{"start":{"line":39,"column":88},"end":{"line":39,"column":89}},"loc":{"start":{"line":39,"column":92},"end":{"line":54,"column":9}},"line":39},"10":{"name":"(anonymous_10)","decl":{"start":{"line":56,"column":44},"end":{"line":56,"column":45}},"loc":{"start":{"line":56,"column":48},"end":{"line":87,"column":5}},"line":56},"11":{"name":"(anonymous_11)","decl":{"start":{"line":57,"column":88},"end":{"line":57,"column":89}},"loc":{"start":{"line":57,"column":92},"end":{"line":72,"column":9}},"line":57},"12":{"name":"(anonymous_12)","decl":{"start":{"line":73,"column":136},"end":{"line":73,"column":137}},"loc":{"start":{"line":73,"column":140},"end":{"line":79,"column":9}},"line":73},"13":{"name":"(anonymous_13)","decl":{"start":{"line":80,"column":137},"end":{"line":80,"column":138}},"loc":{"start":{"line":80,"column":141},"end":{"line":86,"column":9}},"line":80},"14":{"name":"(anonymous_14)","decl":{"start":{"line":88,"column":47},"end":{"line":88,"column":48}},"loc":{"start":{"line":88,"column":51},"end":{"line":129,"column":5}},"line":88},"15":{"name":"(anonymous_15)","decl":{"start":{"line":89,"column":88},"end":{"line":89,"column":89}},"loc":{"start":{"line":89,"column":92},"end":{"line":114,"column":9}},"line":89},"16":{"name":"(anonymous_16)","decl":{"start":{"line":115,"column":136},"end":{"line":115,"column":137}},"loc":{"start":{"line":115,"column":140},"end":{"line":121,"column":9}},"line":115},"17":{"name":"(anonymous_17)","decl":{"start":{"line":122,"column":137},"end":{"line":122,"column":138}},"loc":{"start":{"line":122,"column":141},"end":{"line":128,"column":9}},"line":122},"18":{"name":"(anonymous_18)","decl":{"start":{"line":130,"column":51},"end":{"line":130,"column":52}},"loc":{"start":{"line":130,"column":55},"end":{"line":152,"column":5}},"line":130},"19":{"name":"(anonymous_19)","decl":{"start":{"line":131,"column":88},"end":{"line":131,"column":89}},"loc":{"start":{"line":131,"column":92},"end":{"line":151,"column":9}},"line":131},"20":{"name":"(anonymous_20)","decl":{"start":{"line":153,"column":45},"end":{"line":153,"column":46}},"loc":{"start":{"line":153,"column":49},"end":{"line":178,"column":5}},"line":153},"21":{"name":"(anonymous_21)","decl":{"start":{"line":154,"column":51},"end":{"line":154,"column":52}},"loc":{"start":{"line":154,"column":55},"end":{"line":177,"column":9}},"line":154},"22":{"name":"(anonymous_22)","decl":{"start":{"line":179,"column":44},"end":{"line":179,"column":45}},"loc":{"start":{"line":179,"column":48},"end":{"line":205,"column":5}},"line":179},"23":{"name":"(anonymous_23)","decl":{"start":{"line":180,"column":51},"end":{"line":180,"column":52}},"loc":{"start":{"line":180,"column":55},"end":{"line":204,"column":9}},"line":180},"24":{"name":"(anonymous_24)","decl":{"start":{"line":206,"column":47},"end":{"line":206,"column":48}},"loc":{"start":{"line":206,"column":51},"end":{"line":219,"column":5}},"line":206},"25":{"name":"(anonymous_25)","decl":{"start":{"line":207,"column":139},"end":{"line":207,"column":140}},"loc":{"start":{"line":207,"column":143},"end":{"line":211,"column":9}},"line":207},"26":{"name":"(anonymous_26)","decl":{"start":{"line":212,"column":46},"end":{"line":212,"column":47}},"loc":{"start":{"line":212,"column":50},"end":{"line":218,"column":9}},"line":212}},"branchMap":{"0":{"loc":{"start":{"line":50,"column":41},"end":{"line":50,"column":173}},"type":"cond-expr","locations":[{"start":{"line":50,"column":130},"end":{"line":50,"column":136}},{"start":{"line":50,"column":139},"end":{"line":50,"column":173}}],"line":50},"1":{"loc":{"start":{"line":50,"column":41},"end":{"line":50,"column":127}},"type":"binary-expr","locations":[{"start":{"line":50,"column":41},"end":{"line":50,"column":95}},{"start":{"line":50,"column":99},"end":{"line":50,"column":127}}],"line":50},"2":{"loc":{"start":{"line":68,"column":41},"end":{"line":68,"column":173}},"type":"cond-expr","locations":[{"start":{"line":68,"column":130},"end":{"line":68,"column":136}},{"start":{"line":68,"column":139},"end":{"line":68,"column":173}}],"line":68},"3":{"loc":{"start":{"line":68,"column":41},"end":{"line":68,"column":127}},"type":"binary-expr","locations":[{"start":{"line":68,"column":41},"end":{"line":68,"column":95}},{"start":{"line":68,"column":99},"end":{"line":68,"column":127}}],"line":68},"4":{"loc":{"start":{"line":105,"column":41},"end":{"line":105,"column":173}},"type":"cond-expr","locations":[{"start":{"line":105,"column":130},"end":{"line":105,"column":136}},{"start":{"line":105,"column":139},"end":{"line":105,"column":173}}],"line":105},"5":{"loc":{"start":{"line":105,"column":41},"end":{"line":105,"column":127}},"type":"binary-expr","locations":[{"start":{"line":105,"column":41},"end":{"line":105,"column":95}},{"start":{"line":105,"column":99},"end":{"line":105,"column":127}}],"line":105},"6":{"loc":{"start":{"line":147,"column":41},"end":{"line":147,"column":173}},"type":"cond-expr","locations":[{"start":{"line":147,"column":130},"end":{"line":147,"column":136}},{"start":{"line":147,"column":139},"end":{"line":147,"column":173}}],"line":147},"7":{"loc":{"start":{"line":147,"column":41},"end":{"line":147,"column":127}},"type":"binary-expr","locations":[{"start":{"line":147,"column":41},"end":{"line":147,"column":95}},{"start":{"line":147,"column":99},"end":{"line":147,"column":127}}],"line":147},"8":{"loc":{"start":{"line":173,"column":41},"end":{"line":173,"column":173}},"type":"cond-expr","locations":[{"start":{"line":173,"column":130},"end":{"line":173,"column":136}},{"start":{"line":173,"column":139},"end":{"line":173,"column":173}}],"line":173},"9":{"loc":{"start":{"line":173,"column":41},"end":{"line":173,"column":127}},"type":"binary-expr","locations":[{"start":{"line":173,"column":41},"end":{"line":173,"column":95}},{"start":{"line":173,"column":99},"end":{"line":173,"column":127}}],"line":173}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1,"61":1,"62":1,"63":1,"64":1,"65":1,"66":1,"67":1,"68":1,"69":1,"70":1,"71":1,"72":1,"73":1,"74":1,"75":1,"76":1,"77":1},"f":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1},"b":{"0":[0,1],"1":[1,1],"2":[0,1],"3":[1,1],"4":[0,1],"5":[1,1],"6":[0,1],"7":[1,1],"8":[0,1],"9":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/infrastructure/rocket-chat/converters/RoomSender.spec.ts"],"sourcesContent":["import { expect } from 'chai';\n\nimport {\n\tFederationRoomInviteUserDto,\n\tFederationOnRoomCreationDto,\n\tFederationSetupRoomDto,\n} from '../../../../../../../../server/local-services/federation/application/room/sender/input/RoomSenderDto';\nimport { FederationRoomSenderConverterEE } from '../../../../../../../../server/local-services/federation/infrastructure/rocket-chat/converters/RoomSender';\n\ndescribe('FederationEE - Infrastructure - Matrix - FederationRoomSenderConverterEE', () => {\n\tconst inviteeId = '@marcos.defendi:matrix.org';\n\n\tdescribe('#toRoomInviteUserDto()', () => {\n\t\tit('should return an instance of FederationRoomInviteUserDto', () => {\n\t\t\texpect(FederationRoomSenderConverterEE.toRoomInviteUserDto('inviterId', 'roomId', inviteeId)).to.be.instanceOf(\n\t\t\t\tFederationRoomInviteUserDto,\n\t\t\t);\n\t\t});\n\n\t\tit('should return the basic user  properties correctly (normalizedInviteeId without any \"@\" and inviteeUsernameOnly only the part before the \":\") if any', () => {\n\t\t\tconst result = FederationRoomSenderConverterEE.toRoomInviteUserDto('inviterId', 'roomId', inviteeId);\n\t\t\texpect(result.normalizedInviteeId).to.be.equal('marcos.defendi:matrix.org');\n\t\t\texpect(result.internalRoomId).to.be.equal('roomId');\n\t\t\texpect(result.inviteeUsernameOnly).to.be.equal('marcos.defendi');\n\t\t\texpect(result.internalInviterId).to.be.equal('inviterId');\n\t\t\texpect(result.rawInviteeId).to.be.equal(inviteeId);\n\t\t});\n\t});\n\n\tdescribe('#toSetupRoomDto()', () => {\n\t\tit('should return an instance of FederationSetupRoomDto', () => {\n\t\t\texpect(FederationRoomSenderConverterEE.toSetupRoomDto('inviterId', 'roomId')).to.be.instanceOf(FederationSetupRoomDto);\n\t\t});\n\n\t\tit('should return the invitees without the owner and with normalized invitees', () => {\n\t\t\tconst result = FederationRoomSenderConverterEE.toSetupRoomDto('inviterId', 'roomId');\n\n\t\t\texpect(result.internalRoomId).to.be.equal('roomId');\n\t\t\texpect(result.internalInviterId).to.be.equal('inviterId');\n\t\t});\n\t});\n\n\tdescribe('#toOnRoomCreationDto()', () => {\n\t\tit('should return an instance of FederationRoomInviteUserDto', () => {\n\t\t\texpect(\n\t\t\t\tFederationRoomSenderConverterEE.toOnRoomCreationDto('inviterId', 'username', 'roomId', ['username1'], 'domain'),\n\t\t\t).to.be.instanceOf(FederationOnRoomCreationDto);\n\t\t});\n\n\t\tit('should return the invitees without the owner and with normalized invitees', () => {\n\t\t\tconst result = FederationRoomSenderConverterEE.toOnRoomCreationDto(\n\t\t\t\t'inviterId',\n\t\t\t\t'username',\n\t\t\t\t'roomId',\n\t\t\t\t[inviteeId, 'username'],\n\t\t\t\t'domain',\n\t\t\t);\n\t\t\texpect(result.internalRoomId).to.be.equal('roomId');\n\t\t\texpect(result.internalInviterId).to.be.equal('inviterId');\n\t\t\texpect(result.invitees).to.be.eql([\n\t\t\t\t{\n\t\t\t\t\tnormalizedInviteeId: inviteeId.replace('@', ''),\n\t\t\t\t\tinviteeUsernameOnly: inviteeId.split(':')[0]?.replace('@', ''),\n\t\t\t\t\trawInviteeId: `@${inviteeId.replace('@', '')}`,\n\t\t\t\t},\n\t\t\t]);\n\t\t});\n\t});\n\n\tdescribe('#toOnAddedUsersToARoomDto()', () => {\n\t\tit('should return the invitees without the owner and with normalized invitees', () => {\n\t\t\tconst result = FederationRoomSenderConverterEE.toOnAddedUsersToARoomDto(\n\t\t\t\t'inviterId',\n\t\t\t\t'username',\n\t\t\t\t'roomId',\n\t\t\t\t[inviteeId, 'username'],\n\t\t\t\t'domain',\n\t\t\t);\n\t\t\texpect(result.internalRoomId).to.be.equal('roomId');\n\t\t\texpect(result.internalInviterId).to.be.equal('inviterId');\n\t\t\texpect(result.invitees).to.be.eql([\n\t\t\t\t{\n\t\t\t\t\tnormalizedInviteeId: inviteeId.replace('@', ''),\n\t\t\t\t\tinviteeUsernameOnly: inviteeId.split(':')[0]?.replace('@', ''),\n\t\t\t\t\trawInviteeId: `@${inviteeId.replace('@', '')}`,\n\t\t\t\t},\n\t\t\t]);\n\t\t});\n\n\t\tit('should return the inviteComesFromAnExternalHomeServer property as true when the invite comes from an external home server', () => {\n\t\t\tconst result = FederationRoomSenderConverterEE.toOnAddedUsersToARoomDto(\n\t\t\t\t'inviterId',\n\t\t\t\t'username:matrix.org',\n\t\t\t\t'roomId',\n\t\t\t\t[inviteeId, 'username'],\n\t\t\t\t'domain',\n\t\t\t);\n\t\t\texpect(result.inviteComesFromAnExternalHomeServer).to.be.equal(true);\n\t\t});\n\n\t\tit('should return the inviteComesFromAnExternalHomeServer property as false when the invite comes from an external home server', () => {\n\t\t\tconst result = FederationRoomSenderConverterEE.toOnAddedUsersToARoomDto(\n\t\t\t\t'inviterId',\n\t\t\t\t'username:matrix.org',\n\t\t\t\t'roomId',\n\t\t\t\t[inviteeId, 'username'],\n\t\t\t\t'matrix.org',\n\t\t\t);\n\t\t\texpect(result.inviteComesFromAnExternalHomeServer).to.be.equal(false);\n\t\t});\n\t});\n\n\tdescribe('#toOnDirectMessageCreatedDto()', () => {\n\t\tit('should return the invitees without the owner and with normalized invitees', () => {\n\t\t\tconst result = FederationRoomSenderConverterEE.toOnDirectMessageCreatedDto(\n\t\t\t\t'inviterId',\n\t\t\t\t'roomId',\n\t\t\t\t[inviteeId, { _id: 'inviterId', username: 'username' } as any, { _id: '_id', username: 'usernameToBeInvited' } as any],\n\t\t\t\t'domain',\n\t\t\t);\n\n\t\t\texpect(result.invitees).to.be.eql([\n\t\t\t\t{\n\t\t\t\t\tnormalizedInviteeId: inviteeId.replace('@', ''),\n\t\t\t\t\tinviteeUsernameOnly: inviteeId.split(':')[0]?.replace('@', ''),\n\t\t\t\t\trawInviteeId: `@${inviteeId.replace('@', '')}`,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tnormalizedInviteeId: 'usernameToBeInvited:domain',\n\t\t\t\t\tinviteeUsernameOnly: 'usernameToBeInvited',\n\t\t\t\t\trawInviteeId: '@usernameToBeInvited:domain',\n\t\t\t\t},\n\t\t\t]);\n\t\t});\n\n\t\tit('should return the inviteComesFromAnExternalHomeServer property as true when the invite comes from an external home server', () => {\n\t\t\tconst result = FederationRoomSenderConverterEE.toOnDirectMessageCreatedDto(\n\t\t\t\t'@inviterId:matrix.org',\n\t\t\t\t'roomId',\n\t\t\t\t[inviteeId, 'username'],\n\t\t\t\t'domain',\n\t\t\t);\n\t\t\texpect(result.inviteComesFromAnExternalHomeServer).to.be.equal(true);\n\t\t});\n\n\t\tit('should return the inviteComesFromAnExternalHomeServer property as false when the invite comes from an external home server', () => {\n\t\t\tconst result = FederationRoomSenderConverterEE.toOnDirectMessageCreatedDto(\n\t\t\t\t'inviterId',\n\t\t\t\t'roomId',\n\t\t\t\t[inviteeId, 'username'],\n\t\t\t\t'matrix.org',\n\t\t\t);\n\t\t\texpect(result.inviteComesFromAnExternalHomeServer).to.be.equal(false);\n\t\t});\n\t});\n\n\tdescribe('#toBeforeDirectMessageCreatedDto()', () => {\n\t\tit('should return the invitees without the owner and with normalized invitees', () => {\n\t\t\tconst result = FederationRoomSenderConverterEE.toBeforeDirectMessageCreatedDto(\n\t\t\t\t[inviteeId, { _id: 'inviterId', username: 'username' } as any, { _id: '_id', username: 'usernameToBeInvited' } as any],\n\t\t\t\t'domain',\n\t\t\t);\n\n\t\t\texpect(result.invitees).to.be.eql([\n\t\t\t\t{\n\t\t\t\t\tnormalizedInviteeId: inviteeId.replace('@', ''),\n\t\t\t\t\tinviteeUsernameOnly: inviteeId.split(':')[0]?.replace('@', ''),\n\t\t\t\t\trawInviteeId: `@${inviteeId.replace('@', '')}`,\n\t\t\t\t},\n\t\t\t]);\n\t\t});\n\t});\n\n\tdescribe('#toBeforeAddUserToARoomDto()', () => {\n\t\tit('should return the invitees correctly', () => {\n\t\t\tconst result = FederationRoomSenderConverterEE.toBeforeAddUserToARoomDto(\n\t\t\t\t[inviteeId, { _id: 'inviterId', username: 'username' } as any, { _id: '_id', username: 'usernameToBeInvited' } as any],\n\t\t\t\t{ _id: 'roomId' } as any,\n\t\t\t\t'domain',\n\t\t\t);\n\n\t\t\texpect(result.internalRoomId).to.be.equal('roomId');\n\t\t\texpect(result.invitees).to.be.eql([\n\t\t\t\t{\n\t\t\t\t\tnormalizedInviteeId: inviteeId.replace('@', ''),\n\t\t\t\t\tinviteeUsernameOnly: inviteeId.split(':')[0]?.replace('@', ''),\n\t\t\t\t\trawInviteeId: `@${inviteeId.replace('@', '')}`,\n\t\t\t\t},\n\t\t\t]);\n\t\t});\n\t});\n\n\tdescribe('#toCreateDirectMessageDto()', () => {\n\t\tit('should return the invitees correctly', () => {\n\t\t\tconst result = FederationRoomSenderConverterEE.toCreateDirectMessageDto('inviterId', [\n\t\t\t\tinviteeId,\n\t\t\t\t{ _id: 'inviterId', username: 'username' } as any,\n\t\t\t\t{ _id: '_id', username: 'usernameToBeInvited' } as any,\n\t\t\t]);\n\n\t\t\texpect(result.internalInviterId).to.be.equal('inviterId');\n\t\t\texpect(result.invitees).to.be.eql([\n\t\t\t\tinviteeId,\n\t\t\t\t{ _id: 'inviterId', username: 'username' },\n\t\t\t\t{ _id: '_id', username: 'usernameToBeInvited' },\n\t\t\t]);\n\t\t});\n\t});\n\n\tdescribe('#toJoinExternalPublicRoomDto()', () => {\n\t\tit('should return the basic room properties correctly (normalizedRoomId without any \"!\" and only the part before the \":\") if any', () => {\n\t\t\tconst result = FederationRoomSenderConverterEE.toJoinExternalPublicRoomDto('internalUserId', '!externalRoomId:server.com');\n\t\t\texpect(result.externalRoomId).to.be.equal('!externalRoomId:server.com');\n\t\t\texpect(result.normalizedRoomId).to.be.equal('externalRoomId');\n\t\t});\n\n\t\tit('should return the dto correctly', () => {\n\t\t\tconst result = FederationRoomSenderConverterEE.toJoinExternalPublicRoomDto('internalUserId', '!externalRoomId:server.com');\n\n\t\t\texpect(result.externalRoomId).to.be.equal('!externalRoomId:server.com');\n\t\t\texpect(result.normalizedRoomId).to.be.equal('externalRoomId');\n\t\t\texpect(result.internalUserId).to.be.equal('internalUserId');\n\t\t\texpect(result.externalRoomHomeServerName).to.be.equal('server.com');\n\t\t});\n\t});\n});\n"],"names":["describe","inviteeId","it","expect","FederationRoomSenderConverterEE","toRoomInviteUserDto","to","be","instanceOf","FederationRoomInviteUserDto","result","normalizedInviteeId","equal","internalRoomId","inviteeUsernameOnly","internalInviterId","rawInviteeId","toSetupRoomDto","FederationSetupRoomDto","toOnRoomCreationDto","FederationOnRoomCreationDto","invitees","eql","replace","split","toOnAddedUsersToARoomDto","inviteComesFromAnExternalHomeServer","toOnDirectMessageCreatedDto","_id","username","toBeforeDirectMessageCreatedDto","toBeforeAddUserToARoomDto","toCreateDirectMessageDto","toJoinExternalPublicRoomDto","externalRoomId","normalizedRoomId","internalUserId","externalRoomHomeServerName"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/infrastructure/rocket-chat/converters/RoomSender.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8954ddda7625f8787b3eb3d3c361869e99531914","contentHash":"d01d17c7a528d54f5f5169d9a245da751dad15d11b8a974cdd58693916b7b4bf"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/input/RoomSenderDto.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/input/RoomSenderDto.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":36,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":49}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":60}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":48}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":56}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":43}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":48}},"10":{"start":{"line":31,"column":8},"end":{"line":31,"column":43}},"11":{"start":{"line":34,"column":8},"end":{"line":34,"column":38}},"12":{"start":{"line":37,"column":27},"end":{"line":41,"column":1}},"13":{"start":{"line":39,"column":8},"end":{"line":39,"column":51}},"14":{"start":{"line":42,"column":34},"end":{"line":52,"column":1}},"15":{"start":{"line":44,"column":8},"end":{"line":46,"column":11}},"16":{"start":{"line":47,"column":8},"end":{"line":47,"column":45}},"17":{"start":{"line":48,"column":8},"end":{"line":48,"column":55}},"18":{"start":{"line":49,"column":8},"end":{"line":49,"column":55}},"19":{"start":{"line":50,"column":8},"end":{"line":50,"column":41}},"20":{"start":{"line":53,"column":34},"end":{"line":61,"column":1}},"21":{"start":{"line":55,"column":8},"end":{"line":57,"column":11}},"22":{"start":{"line":58,"column":8},"end":{"line":58,"column":45}},"23":{"start":{"line":59,"column":8},"end":{"line":59,"column":33}},"24":{"start":{"line":62,"column":47},"end":{"line":71,"column":1}},"25":{"start":{"line":64,"column":8},"end":{"line":66,"column":11}},"26":{"start":{"line":67,"column":8},"end":{"line":67,"column":45}},"27":{"start":{"line":68,"column":8},"end":{"line":68,"column":33}},"28":{"start":{"line":69,"column":8},"end":{"line":69,"column":87}},"29":{"start":{"line":72,"column":39},"end":{"line":79,"column":1}},"30":{"start":{"line":74,"column":8},"end":{"line":76,"column":11}},"31":{"start":{"line":77,"column":8},"end":{"line":77,"column":33}},"32":{"start":{"line":80,"column":51},"end":{"line":84,"column":1}},"33":{"start":{"line":82,"column":8},"end":{"line":82,"column":33}},"34":{"start":{"line":85,"column":40},"end":{"line":93,"column":1}},"35":{"start":{"line":87,"column":8},"end":{"line":89,"column":11}},"36":{"start":{"line":90,"column":8},"end":{"line":90,"column":45}},"37":{"start":{"line":91,"column":8},"end":{"line":91,"column":47}},"38":{"start":{"line":94,"column":39},"end":{"line":103,"column":1}},"39":{"start":{"line":96,"column":8},"end":{"line":100,"column":11}},"40":{"start":{"line":101,"column":8},"end":{"line":101,"column":87}},"41":{"start":{"line":104,"column":29},"end":{"line":111,"column":1}},"42":{"start":{"line":106,"column":8},"end":{"line":108,"column":11}},"43":{"start":{"line":109,"column":8},"end":{"line":109,"column":45}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":39},"end":{"line":12,"column":40}},"loc":{"start":{"line":12,"column":50},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":50},"end":{"line":15,"column":51}},"loc":{"start":{"line":15,"column":61},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":38},"end":{"line":18,"column":39}},"loc":{"start":{"line":18,"column":49},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":46},"end":{"line":21,"column":47}},"loc":{"start":{"line":21,"column":57},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":33},"end":{"line":24,"column":34}},"loc":{"start":{"line":24,"column":44},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":38},"end":{"line":27,"column":39}},"loc":{"start":{"line":27,"column":49},"end":{"line":29,"column":5}},"line":27},"7":{"name":"(anonymous_7)","decl":{"start":{"line":30,"column":33},"end":{"line":30,"column":34}},"loc":{"start":{"line":30,"column":44},"end":{"line":32,"column":5}},"line":30},"8":{"name":"(anonymous_8)","decl":{"start":{"line":33,"column":28},"end":{"line":33,"column":29}},"loc":{"start":{"line":33,"column":39},"end":{"line":35,"column":5}},"line":33},"9":{"name":"(anonymous_9)","decl":{"start":{"line":38,"column":4},"end":{"line":38,"column":5}},"loc":{"start":{"line":38,"column":38},"end":{"line":40,"column":5}},"line":38},"10":{"name":"(anonymous_10)","decl":{"start":{"line":43,"column":4},"end":{"line":43,"column":5}},"loc":{"start":{"line":43,"column":110},"end":{"line":51,"column":5}},"line":43},"11":{"name":"(anonymous_11)","decl":{"start":{"line":54,"column":4},"end":{"line":54,"column":5}},"loc":{"start":{"line":54,"column":64},"end":{"line":60,"column":5}},"line":54},"12":{"name":"(anonymous_12)","decl":{"start":{"line":63,"column":4},"end":{"line":63,"column":5}},"loc":{"start":{"line":63,"column":101},"end":{"line":70,"column":5}},"line":63},"13":{"name":"(anonymous_13)","decl":{"start":{"line":73,"column":4},"end":{"line":73,"column":5}},"loc":{"start":{"line":73,"column":48},"end":{"line":78,"column":5}},"line":73},"14":{"name":"(anonymous_14)","decl":{"start":{"line":81,"column":4},"end":{"line":81,"column":5}},"loc":{"start":{"line":81,"column":29},"end":{"line":83,"column":5}},"line":81},"15":{"name":"(anonymous_15)","decl":{"start":{"line":86,"column":4},"end":{"line":86,"column":5}},"loc":{"start":{"line":86,"column":62},"end":{"line":92,"column":5}},"line":86},"16":{"name":"(anonymous_16)","decl":{"start":{"line":95,"column":4},"end":{"line":95,"column":5}},"loc":{"start":{"line":95,"column":101},"end":{"line":102,"column":5}},"line":95},"17":{"name":"(anonymous_17)","decl":{"start":{"line":105,"column":4},"end":{"line":105,"column":5}},"loc":{"start":{"line":105,"column":54},"end":{"line":110,"column":5}},"line":105}},"branchMap":{},"s":{"0":1,"1":1,"2":8,"3":1,"4":1,"5":2,"6":1,"7":3,"8":3,"9":3,"10":3,"11":3,"12":1,"13":13,"14":1,"15":2,"16":2,"17":2,"18":2,"19":2,"20":1,"21":5,"22":5,"23":5,"24":1,"25":3,"26":3,"27":3,"28":3,"29":1,"30":1,"31":1,"32":1,"33":3,"34":1,"35":1,"36":1,"37":1,"38":1,"39":3,"40":3,"41":1,"42":2,"43":2},"f":{"0":1,"1":1,"2":2,"3":1,"4":3,"5":3,"6":3,"7":3,"8":3,"9":13,"10":2,"11":5,"12":3,"13":1,"14":3,"15":1,"16":3,"17":2},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/input/RoomSenderDto.ts"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\n\ninterface IFederationInviterDto {\n\tinternalInviterId: string;\n}\n\ninterface IFederationRoomInviteUserDto extends IFederationInviterDto {\n\trawInviteeId: string;\n\tnormalizedInviteeId: string;\n\tinviteeUsernameOnly: string;\n\tinternalRoomId: string;\n}\n\nexport interface IFederationInviteeDto {\n\trawInviteeId: string;\n\tnormalizedInviteeId: string;\n\tinviteeUsernameOnly: string;\n}\n\ninterface IFederationOnRoomCreationDto extends IFederationInviterDto {\n\tinternalRoomId: string;\n\tinvitees: IFederationInviteeDto[];\n}\n\ninterface IFederationOnDirectMessageCreationDto extends IFederationInviterDto {\n\tinternalRoomId: string;\n\tinvitees: IFederationInviteeDto[];\n\tinviteComesFromAnExternalHomeServer: boolean;\n}\n\ninterface IFederationCreateDirectMessageDto extends IFederationInviterDto {\n\tinvitees: string[];\n}\n\ntype IFederationBeforeAddUserToARoomDto = IFederationOnRoomCreationDto & {\n\tinternalInviter?: IUser;\n};\n\ninterface IFederationOnUserAddedToARoomDto extends IFederationOnRoomCreationDto {\n\tinviteComesFromAnExternalHomeServer: boolean;\n}\n\nclass FederationInviterDto {\n\tconstructor({ internalInviterId }: IFederationInviterDto) {\n\t\tthis.internalInviterId = internalInviterId;\n\t}\n\n\tinternalInviterId: string;\n}\n\nexport class FederationRoomInviteUserDto extends FederationInviterDto {\n\tconstructor({ internalInviterId, internalRoomId, inviteeUsernameOnly, normalizedInviteeId, rawInviteeId }: IFederationRoomInviteUserDto) {\n\t\tsuper({ internalInviterId });\n\t\tthis.internalRoomId = internalRoomId;\n\t\tthis.inviteeUsernameOnly = inviteeUsernameOnly;\n\t\tthis.normalizedInviteeId = normalizedInviteeId;\n\t\tthis.rawInviteeId = rawInviteeId;\n\t}\n\n\tinternalRoomId: string;\n\n\trawInviteeId: string;\n\n\tnormalizedInviteeId: string;\n\n\tinviteeUsernameOnly: string;\n}\n\nexport class FederationOnRoomCreationDto extends FederationInviterDto {\n\tconstructor({ internalInviterId, internalRoomId, invitees }: IFederationOnRoomCreationDto) {\n\t\tsuper({ internalInviterId });\n\t\tthis.internalRoomId = internalRoomId;\n\t\tthis.invitees = invitees;\n\t}\n\n\tinternalRoomId: string;\n\n\tinvitees: IFederationInviteeDto[];\n}\n\nexport class FederationOnDirectMessageRoomCreationDto extends FederationInviterDto {\n\tconstructor({ internalInviterId, internalRoomId, invitees, inviteComesFromAnExternalHomeServer }: IFederationOnDirectMessageCreationDto) {\n\t\tsuper({ internalInviterId });\n\t\tthis.internalRoomId = internalRoomId;\n\t\tthis.invitees = invitees;\n\t\tthis.inviteComesFromAnExternalHomeServer = inviteComesFromAnExternalHomeServer;\n\t}\n\n\tinternalRoomId: string;\n\n\tinvitees: IFederationInviteeDto[];\n\n\tinviteComesFromAnExternalHomeServer: boolean;\n}\n\nexport class FederationCreateDirectMessageDto extends FederationInviterDto {\n\tconstructor({ internalInviterId, invitees }: IFederationCreateDirectMessageDto) {\n\t\tsuper({ internalInviterId });\n\t\tthis.invitees = invitees;\n\t}\n\n\tinvitees: string[];\n}\n\nexport class FederationBeforeDirectMessageRoomCreationDto {\n\tconstructor({ invitees }: Record<string, IFederationInviteeDto[]>) {\n\t\tthis.invitees = invitees;\n\t}\n\n\tinvitees: IFederationInviteeDto[];\n}\n\nexport class FederationBeforeAddUserToARoomDto extends FederationBeforeDirectMessageRoomCreationDto {\n\tconstructor({ invitees, internalRoomId, internalInviter }: Omit<IFederationBeforeAddUserToARoomDto, 'internalInviterId'>) {\n\t\tsuper({ invitees });\n\t\tthis.internalRoomId = internalRoomId;\n\t\tthis.internalInviter = internalInviter;\n\t}\n\n\tinternalRoomId: string;\n\n\tinternalInviter?: IUser;\n}\n\nexport class FederationOnUsersAddedToARoomDto extends FederationOnRoomCreationDto {\n\tconstructor({ internalInviterId, internalRoomId, invitees, inviteComesFromAnExternalHomeServer }: IFederationOnUserAddedToARoomDto) {\n\t\tsuper({ internalInviterId, internalRoomId, invitees });\n\t\tthis.inviteComesFromAnExternalHomeServer = inviteComesFromAnExternalHomeServer;\n\t}\n\n\tinviteComesFromAnExternalHomeServer: boolean;\n}\n\nexport class FederationSetupRoomDto extends FederationInviterDto {\n\tconstructor({ internalInviterId, internalRoomId }: IFederationInviterDto & { internalRoomId: string }) {\n\t\tsuper({ internalInviterId });\n\t\tthis.internalRoomId = internalRoomId;\n\t}\n\n\tinternalRoomId: string;\n}\n"],"names":["FederationBeforeAddUserToARoomDto","FederationBeforeDirectMessageRoomCreationDto","FederationCreateDirectMessageDto","FederationOnDirectMessageRoomCreationDto","FederationOnRoomCreationDto","FederationOnUsersAddedToARoomDto","FederationRoomInviteUserDto","FederationSetupRoomDto","FederationInviterDto","constructor","internalInviterId","internalRoomId","inviteeUsernameOnly","normalizedInviteeId","rawInviteeId","invitees","inviteComesFromAnExternalHomeServer","internalInviter"],"mappings":";;;;;;;;;;;IAgHaA,iCAAiC;eAAjCA;;IARAC,4CAA4C;eAA5CA;;IATAC,gCAAgC;eAAhCA;;IAfAC,wCAAwC;eAAxCA;;IAZAC,2BAA2B;eAA3BA;;IAwDAC,gCAAgC;eAAhCA;;IA1EAC,2BAA2B;eAA3BA;;IAmFAC,sBAAsB;eAAtBA;;;AA3Fb,IAAA,AAAMC,uBAAN,MAAMA;IACLC,YAAY,EAAEC,iBAAiB,EAAyB,CAAE;QACzD,IAAI,CAACA,iBAAiB,GAAGA;IAC1B;AAGD;AAEO,IAAA,AAAMJ,8BAAN,MAAMA,oCAAoCE;IAChDC,YAAY,EAAEC,iBAAiB,EAAEC,cAAc,EAAEC,mBAAmB,EAAEC,mBAAmB,EAAEC,YAAY,EAAgC,CAAE;QACxI,KAAK,CAAC;YAAEJ;QAAkB;QAC1B,IAAI,CAACC,cAAc,GAAGA;QACtB,IAAI,CAACC,mBAAmB,GAAGA;QAC3B,IAAI,CAACC,mBAAmB,GAAGA;QAC3B,IAAI,CAACC,YAAY,GAAGA;IACrB;AASD;AAEO,IAAA,AAAMV,8BAAN,MAAMA,oCAAoCI;IAChDC,YAAY,EAAEC,iBAAiB,EAAEC,cAAc,EAAEI,QAAQ,EAAgC,CAAE;QAC1F,KAAK,CAAC;YAAEL;QAAkB;QAC1B,IAAI,CAACC,cAAc,GAAGA;QACtB,IAAI,CAACI,QAAQ,GAAGA;IACjB;AAKD;AAEO,IAAA,AAAMZ,2CAAN,MAAMA,iDAAiDK;IAC7DC,YAAY,EAAEC,iBAAiB,EAAEC,cAAc,EAAEI,QAAQ,EAAEC,mCAAmC,EAAyC,CAAE;QACxI,KAAK,CAAC;YAAEN;QAAkB;QAC1B,IAAI,CAACC,cAAc,GAAGA;QACtB,IAAI,CAACI,QAAQ,GAAGA;QAChB,IAAI,CAACC,mCAAmC,GAAGA;IAC5C;AAOD;AAEO,IAAA,AAAMd,mCAAN,MAAMA,yCAAyCM;IACrDC,YAAY,EAAEC,iBAAiB,EAAEK,QAAQ,EAAqC,CAAE;QAC/E,KAAK,CAAC;YAAEL;QAAkB;QAC1B,IAAI,CAACK,QAAQ,GAAGA;IACjB;AAGD;AAEO,IAAA,AAAMd,+CAAN,MAAMA;IACZQ,YAAY,EAAEM,QAAQ,EAA2C,CAAE;QAClE,IAAI,CAACA,QAAQ,GAAGA;IACjB;AAGD;AAEO,IAAA,AAAMf,oCAAN,MAAMA,0CAA0CC;IACtDQ,YAAY,EAAEM,QAAQ,EAAEJ,cAAc,EAAEM,eAAe,EAAiE,CAAE;QACzH,KAAK,CAAC;YAAEF;QAAS;QACjB,IAAI,CAACJ,cAAc,GAAGA;QACtB,IAAI,CAACM,eAAe,GAAGA;IACxB;AAKD;AAEO,IAAA,AAAMZ,mCAAN,MAAMA,yCAAyCD;IACrDK,YAAY,EAAEC,iBAAiB,EAAEC,cAAc,EAAEI,QAAQ,EAAEC,mCAAmC,EAAoC,CAAE;QACnI,KAAK,CAAC;YAAEN;YAAmBC;YAAgBI;QAAS;QACpD,IAAI,CAACC,mCAAmC,GAAGA;IAC5C;AAGD;AAEO,IAAA,AAAMT,yBAAN,MAAMA,+BAA+BC;IAC3CC,YAAY,EAAEC,iBAAiB,EAAEC,cAAc,EAAsD,CAAE;QACtG,KAAK,CAAC;YAAED;QAAkB;QAC1B,IAAI,CAACC,cAAc,GAAGA;IACvB;AAGD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/application/room/sender/input/RoomSenderDto.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4bc42a0720ac1d0befa835c28b941a6e292d3313","contentHash":"23ee08c1194f675e3850386e8fd24e38cc0e8acff46a0354b0525841fc145a81"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/rocket-chat/converters/RoomSender.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/rocket-chat/converters/RoomSender.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":47}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":22},"end":{"line":12,"column":131}},"5":{"start":{"line":13,"column":22},"end":{"line":13,"column":84}},"6":{"start":{"line":14,"column":23},"end":{"line":14,"column":86}},"7":{"start":{"line":15,"column":33},"end":{"line":17,"column":1}},"8":{"start":{"line":16,"column":4},"end":{"line":16,"column":134}},"9":{"start":{"line":18,"column":25},"end":{"line":18,"column":63}},"10":{"start":{"line":18,"column":36},"end":{"line":18,"column":63}},"11":{"start":{"line":19,"column":26},"end":{"line":25,"column":1}},"12":{"start":{"line":20,"column":4},"end":{"line":24,"column":12}},"13":{"start":{"line":20,"column":75},"end":{"line":20,"column":138}},"14":{"start":{"line":20,"column":164},"end":{"line":24,"column":9}},"15":{"start":{"line":26,"column":28},"end":{"line":30,"column":1}},"16":{"start":{"line":27,"column":4},"end":{"line":29,"column":23}},"17":{"start":{"line":28,"column":8},"end":{"line":28,"column":128}},"18":{"start":{"line":31,"column":36},"end":{"line":38,"column":1}},"19":{"start":{"line":32,"column":51},"end":{"line":32,"column":105}},"20":{"start":{"line":32,"column":78},"end":{"line":32,"column":104}},"21":{"start":{"line":33,"column":34},"end":{"line":33,"column":204}},"22":{"start":{"line":33,"column":86},"end":{"line":33,"column":203}},"23":{"start":{"line":34,"column":4},"end":{"line":37,"column":6}},"24":{"start":{"line":39,"column":29},"end":{"line":41,"column":1}},"25":{"start":{"line":40,"column":4},"end":{"line":40,"column":100}},"26":{"start":{"line":40,"column":60},"end":{"line":40,"column":82}},"27":{"start":{"line":42,"column":39},"end":{"line":44,"column":6}},"28":{"start":{"line":42,"column":60},"end":{"line":44,"column":6}},"29":{"start":{"line":43,"column":8},"end":{"line":43,"column":77}},"30":{"start":{"line":45,"column":41},"end":{"line":45,"column":153}},"31":{"start":{"line":45,"column":68},"end":{"line":45,"column":153}},"32":{"start":{"line":45,"column":119},"end":{"line":45,"column":152}},"33":{"start":{"line":46,"column":38},"end":{"line":138,"column":1}},"34":{"start":{"line":48,"column":36},"end":{"line":48,"column":123}},"35":{"start":{"line":49,"column":36},"end":{"line":49,"column":118}},"36":{"start":{"line":50,"column":8},"end":{"line":56,"column":11}},"37":{"start":{"line":59,"column":8},"end":{"line":62,"column":11}},"38":{"start":{"line":65,"column":31},"end":{"line":65,"column":114}},"39":{"start":{"line":66,"column":22},"end":{"line":66,"column":77}},"40":{"start":{"line":67,"column":8},"end":{"line":71,"column":11}},"41":{"start":{"line":74,"column":41},"end":{"line":74,"column":78}},"42":{"start":{"line":75,"column":34},"end":{"line":75,"column":239}},"43":{"start":{"line":76,"column":31},"end":{"line":76,"column":114}},"44":{"start":{"line":77,"column":22},"end":{"line":77,"column":77}},"45":{"start":{"line":78,"column":8},"end":{"line":83,"column":11}},"46":{"start":{"line":86,"column":31},"end":{"line":86,"column":98}},"47":{"start":{"line":87,"column":45},"end":{"line":87,"column":109}},"48":{"start":{"line":88,"column":45},"end":{"line":88,"column":150}},"49":{"start":{"line":88,"column":101},"end":{"line":88,"column":149}},"50":{"start":{"line":89,"column":40},"end":{"line":92,"column":9}},"51":{"start":{"line":93,"column":34},"end":{"line":93,"column":117}},"52":{"start":{"line":94,"column":8},"end":{"line":99,"column":11}},"53":{"start":{"line":102,"column":25},"end":{"line":102,"column":61}},"54":{"start":{"line":103,"column":33},"end":{"line":103,"column":62}},"55":{"start":{"line":104,"column":8},"end":{"line":106,"column":11}},"56":{"start":{"line":109,"column":29},"end":{"line":109,"column":123}},"57":{"start":{"line":110,"column":8},"end":{"line":114,"column":11}},"58":{"start":{"line":117,"column":8},"end":{"line":120,"column":11}},"59":{"start":{"line":123,"column":8},"end":{"line":130,"column":11}},"60":{"start":{"line":133,"column":8},"end":{"line":136,"column":11}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":33},"end":{"line":15,"column":34}},"loc":{"start":{"line":15,"column":62},"end":{"line":17,"column":1}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":18,"column":25},"end":{"line":18,"column":26}},"loc":{"start":{"line":18,"column":36},"end":{"line":18,"column":63}},"line":18},"3":{"name":"(anonymous_3)","decl":{"start":{"line":19,"column":26},"end":{"line":19,"column":27}},"loc":{"start":{"line":19,"column":76},"end":{"line":25,"column":1}},"line":19},"4":{"name":"(anonymous_4)","decl":{"start":{"line":20,"column":56},"end":{"line":20,"column":57}},"loc":{"start":{"line":20,"column":75},"end":{"line":20,"column":138}},"line":20},"5":{"name":"(anonymous_5)","decl":{"start":{"line":20,"column":144},"end":{"line":20,"column":145}},"loc":{"start":{"line":20,"column":164},"end":{"line":24,"column":9}},"line":20},"6":{"name":"(anonymous_6)","decl":{"start":{"line":26,"column":28},"end":{"line":26,"column":29}},"loc":{"start":{"line":26,"column":48},"end":{"line":30,"column":1}},"line":26},"7":{"name":"(anonymous_7)","decl":{"start":{"line":27,"column":32},"end":{"line":27,"column":33}},"loc":{"start":{"line":27,"column":43},"end":{"line":29,"column":5}},"line":27},"8":{"name":"(anonymous_8)","decl":{"start":{"line":31,"column":36},"end":{"line":31,"column":37}},"loc":{"start":{"line":31,"column":48},"end":{"line":38,"column":1}},"line":31},"9":{"name":"(anonymous_9)","decl":{"start":{"line":32,"column":67},"end":{"line":32,"column":68}},"loc":{"start":{"line":32,"column":78},"end":{"line":32,"column":104}},"line":32},"10":{"name":"(anonymous_10)","decl":{"start":{"line":33,"column":75},"end":{"line":33,"column":76}},"loc":{"start":{"line":33,"column":86},"end":{"line":33,"column":203}},"line":33},"11":{"name":"(anonymous_11)","decl":{"start":{"line":39,"column":29},"end":{"line":39,"column":30}},"loc":{"start":{"line":39,"column":41},"end":{"line":41,"column":1}},"line":39},"12":{"name":"(anonymous_12)","decl":{"start":{"line":40,"column":49},"end":{"line":40,"column":50}},"loc":{"start":{"line":40,"column":60},"end":{"line":40,"column":82}},"line":40},"13":{"name":"(anonymous_13)","decl":{"start":{"line":42,"column":39},"end":{"line":42,"column":40}},"loc":{"start":{"line":42,"column":60},"end":{"line":44,"column":6}},"line":42},"14":{"name":"(anonymous_14)","decl":{"start":{"line":42,"column":92},"end":{"line":42,"column":93}},"loc":{"start":{"line":42,"column":103},"end":{"line":44,"column":5}},"line":42},"15":{"name":"(anonymous_15)","decl":{"start":{"line":45,"column":41},"end":{"line":45,"column":42}},"loc":{"start":{"line":45,"column":68},"end":{"line":45,"column":153}},"line":45},"16":{"name":"(anonymous_16)","decl":{"start":{"line":45,"column":100},"end":{"line":45,"column":101}},"loc":{"start":{"line":45,"column":119},"end":{"line":45,"column":152}},"line":45},"17":{"name":"(anonymous_17)","decl":{"start":{"line":47,"column":4},"end":{"line":47,"column":5}},"loc":{"start":{"line":47,"column":85},"end":{"line":57,"column":5}},"line":47},"18":{"name":"(anonymous_18)","decl":{"start":{"line":58,"column":4},"end":{"line":58,"column":5}},"loc":{"start":{"line":58,"column":61},"end":{"line":63,"column":5}},"line":58},"19":{"name":"(anonymous_19)","decl":{"start":{"line":64,"column":4},"end":{"line":64,"column":5}},"loc":{"start":{"line":64,"column":139},"end":{"line":72,"column":5}},"line":64},"20":{"name":"(anonymous_20)","decl":{"start":{"line":73,"column":4},"end":{"line":73,"column":5}},"loc":{"start":{"line":73,"column":136},"end":{"line":84,"column":5}},"line":73},"21":{"name":"(anonymous_21)","decl":{"start":{"line":85,"column":4},"end":{"line":85,"column":5}},"loc":{"start":{"line":85,"column":114},"end":{"line":100,"column":5}},"line":85},"22":{"name":"(anonymous_22)","decl":{"start":{"line":88,"column":89},"end":{"line":88,"column":90}},"loc":{"start":{"line":88,"column":101},"end":{"line":88,"column":149}},"line":88},"23":{"name":"(anonymous_23)","decl":{"start":{"line":101,"column":4},"end":{"line":101,"column":5}},"loc":{"start":{"line":101,"column":74},"end":{"line":107,"column":5}},"line":101},"24":{"name":"(anonymous_24)","decl":{"start":{"line":108,"column":4},"end":{"line":108,"column":5}},"loc":{"start":{"line":108,"column":99},"end":{"line":115,"column":5}},"line":108},"25":{"name":"(anonymous_25)","decl":{"start":{"line":116,"column":4},"end":{"line":116,"column":5}},"loc":{"start":{"line":116,"column":65},"end":{"line":121,"column":5}},"line":116},"26":{"name":"(anonymous_26)","decl":{"start":{"line":122,"column":4},"end":{"line":122,"column":5}},"loc":{"start":{"line":122,"column":92},"end":{"line":131,"column":5}},"line":122},"27":{"name":"(anonymous_27)","decl":{"start":{"line":132,"column":4},"end":{"line":132,"column":5}},"loc":{"start":{"line":132,"column":71},"end":{"line":137,"column":5}},"line":132}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":11},"end":{"line":16,"column":133}},"type":"cond-expr","locations":[{"start":{"line":16,"column":90},"end":{"line":16,"column":98}},{"start":{"line":16,"column":101},"end":{"line":16,"column":133}}],"line":16},"1":{"loc":{"start":{"line":16,"column":12},"end":{"line":16,"column":86}},"type":"cond-expr","locations":[{"start":{"line":16,"column":55},"end":{"line":16,"column":61}},{"start":{"line":16,"column":64},"end":{"line":16,"column":86}}],"line":16},"2":{"loc":{"start":{"line":16,"column":12},"end":{"line":16,"column":52}},"type":"binary-expr","locations":[{"start":{"line":16,"column":12},"end":{"line":16,"column":29}},{"start":{"line":16,"column":33},"end":{"line":16,"column":52}}],"line":16},"3":{"loc":{"start":{"line":28,"column":15},"end":{"line":28,"column":127}},"type":"cond-expr","locations":[{"start":{"line":28,"column":43},"end":{"line":28,"column":117}},{"start":{"line":28,"column":120},"end":{"line":28,"column":127}}],"line":28},"4":{"loc":{"start":{"line":28,"column":43},"end":{"line":28,"column":117}},"type":"binary-expr","locations":[{"start":{"line":28,"column":44},"end":{"line":28,"column":110}},{"start":{"line":28,"column":115},"end":{"line":28,"column":117}}],"line":28},"5":{"loc":{"start":{"line":28,"column":44},"end":{"line":28,"column":110}},"type":"cond-expr","locations":[{"start":{"line":28,"column":85},"end":{"line":28,"column":91}},{"start":{"line":28,"column":94},"end":{"line":28,"column":110}}],"line":28},"6":{"loc":{"start":{"line":28,"column":44},"end":{"line":28,"column":82}},"type":"binary-expr","locations":[{"start":{"line":28,"column":44},"end":{"line":28,"column":60}},{"start":{"line":28,"column":64},"end":{"line":28,"column":82}}],"line":28},"7":{"loc":{"start":{"line":33,"column":86},"end":{"line":33,"column":203}},"type":"binary-expr","locations":[{"start":{"line":33,"column":86},"end":{"line":33,"column":128}},{"start":{"line":33,"column":132},"end":{"line":33,"column":203}}],"line":33},"8":{"loc":{"start":{"line":33,"column":180},"end":{"line":33,"column":202}},"type":"binary-expr","locations":[{"start":{"line":33,"column":180},"end":{"line":33,"column":196}},{"start":{"line":33,"column":200},"end":{"line":33,"column":202}}],"line":33},"9":{"loc":{"start":{"line":40,"column":60},"end":{"line":40,"column":82}},"type":"binary-expr","locations":[{"start":{"line":40,"column":60},"end":{"line":40,"column":76}},{"start":{"line":40,"column":80},"end":{"line":40,"column":82}}],"line":40},"10":{"loc":{"start":{"line":43,"column":15},"end":{"line":43,"column":76}},"type":"cond-expr","locations":[{"start":{"line":43,"column":43},"end":{"line":43,"column":66}},{"start":{"line":43,"column":69},"end":{"line":43,"column":76}}],"line":43},"11":{"loc":{"start":{"line":75,"column":34},"end":{"line":75,"column":239}},"type":"binary-expr","locations":[{"start":{"line":75,"column":34},"end":{"line":75,"column":106}},{"start":{"line":75,"column":110},"end":{"line":75,"column":218}},{"start":{"line":75,"column":222},"end":{"line":75,"column":239}}],"line":75},"12":{"loc":{"start":{"line":93,"column":34},"end":{"line":93,"column":117}},"type":"binary-expr","locations":[{"start":{"line":93,"column":34},"end":{"line":93,"column":96}},{"start":{"line":93,"column":100},"end":{"line":93,"column":117}}],"line":93}},"s":{"0":1,"1":1,"2":17,"3":1,"4":1,"5":1,"6":1,"7":1,"8":15,"9":1,"10":50,"11":1,"12":10,"13":15,"14":15,"15":1,"16":8,"17":13,"18":1,"19":5,"20":12,"21":5,"22":5,"23":5,"24":1,"25":3,"26":1,"27":1,"28":3,"29":7,"30":1,"31":5,"32":9,"33":1,"34":2,"35":2,"36":2,"37":2,"38":2,"39":2,"40":2,"41":3,"42":3,"43":3,"44":3,"45":3,"46":3,"47":3,"48":3,"49":1,"50":3,"51":3,"52":3,"53":2,"54":2,"55":2,"56":1,"57":1,"58":1,"59":2,"60":0},"f":{"0":17,"1":15,"2":50,"3":10,"4":15,"5":15,"6":8,"7":13,"8":5,"9":12,"10":5,"11":3,"12":1,"13":3,"14":7,"15":5,"16":9,"17":2,"18":2,"19":2,"20":3,"21":3,"22":1,"23":2,"24":1,"25":1,"26":2,"27":0},"b":{"0":[9,6],"1":[0,15],"2":[15,15],"3":[0,13],"4":[0,0],"5":[0,0],"6":[0,0],"7":[5,5],"8":[5,0],"9":[1,0],"10":[2,5],"11":[3,2,1],"12":[3,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/rocket-chat/converters/RoomSender.ts"],"sourcesContent":["import type { IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isUserFederated } from '@rocket.chat/core-typings';\n\nimport {\n\tconvertExternalRoomIdToInternalRoomIdFormat,\n\textractServerNameFromExternalIdentifier,\n\tformatExternalUserIdToInternalUsernameFormat,\n\tisAnExternalIdentifierFormat,\n\tisAnExternalUserIdFormat,\n\tremoveExternalSpecificCharsFromExternalIdentifier,\n} from '../../../../../../../server/services/federation/infrastructure/matrix/converters/room/RoomReceiver';\nimport {\n\tFederationJoinExternalPublicRoomInputDto,\n\tFederationJoinInternalPublicRoomInputDto,\n} from '../../../application/room/sender/input/RoomInputDto';\nimport {\n\tFederationBeforeAddUserToARoomDto,\n\tFederationBeforeDirectMessageRoomCreationDto,\n\tFederationCreateDirectMessageDto,\n\tFederationOnDirectMessageRoomCreationDto,\n\tFederationOnRoomCreationDto,\n\tFederationOnUsersAddedToARoomDto,\n\tFederationRoomInviteUserDto,\n\tFederationSetupRoomDto,\n} from '../../../application/room/sender/input/RoomSenderDto';\nimport type { IFederationInviteeDto } from '../../../application/room/sender/input/RoomSenderDto';\n\nconst ensureUserHasAHomeServer = (username: string, localHomeServer: string): string => {\n\treturn username?.includes(':') ? username : `${username}:${localHomeServer}`;\n};\n\nconst isAnExistentUser = (invitee: IUser | string): boolean => typeof invitee !== 'string';\n\nconst normalizeInvitees = (externalInviteesUsername: string[], homeServerDomainName: string): IFederationInviteeDto[] => {\n\treturn externalInviteesUsername\n\t\t.filter(Boolean)\n\t\t.map((inviteeUsername) => ensureUserHasAHomeServer(inviteeUsername, homeServerDomainName))\n\t\t.map((inviteeUsername) => ({\n\t\t\tnormalizedInviteeId: removeExternalSpecificCharsFromExternalIdentifier(inviteeUsername),\n\t\t\tinviteeUsernameOnly: formatExternalUserIdToInternalUsernameFormat(inviteeUsername),\n\t\t\trawInviteeId: `@${removeExternalSpecificCharsFromExternalIdentifier(inviteeUsername)}`,\n\t\t}));\n};\n\nconst getInviteesUsername = (externalInvitees: (IUser | string)[]): string[] => {\n\treturn externalInvitees\n\t\t.map((invitee) => {\n\t\t\treturn isAnExistentUser(invitee) ? (invitee as IUser)?.username || '' : (invitee as string);\n\t\t})\n\t\t.filter(Boolean);\n};\n\nconst getExternalUsersToBeInvited = (invitees: (IUser | string)[]): (IUser | string)[] => {\n\tconst externalAndNonExistentInviteesUsername = invitees.filter((invitee: IUser | string) => !isAnExistentUser(invitee));\n\tconst externalExistentUsers = invitees\n\t\t.filter(isAnExistentUser)\n\t\t.filter((invitee) => isUserFederated(invitee as IUser) || isAnExternalIdentifierFormat((invitee as IUser).username || ''));\n\n\treturn [...externalAndNonExistentInviteesUsername, ...externalExistentUsers];\n};\n\nconst getInternalUsernames = (invitees: (IUser | string)[]): string[] => {\n\treturn invitees\n\t\t.filter(isAnExistentUser)\n\t\t.map((invitee) => (invitee as IUser).username || '')\n\t\t.filter(Boolean);\n};\n\nconst getAllUsersExceptOwnerByUserId = (invitees: (IUser | string)[], ownerId: string): (IUser | string)[] =>\n\tinvitees.filter(Boolean).filter((invitee) => {\n\t\treturn isAnExistentUser(invitee) ? (invitee as IUser)._id !== ownerId : invitee;\n\t});\n\nconst getAllUsersExceptOwnerByUsername = (invitees: string[], ownerUsername: string): string[] =>\n\tinvitees.filter(Boolean).filter((inviteeUsername) => inviteeUsername !== ownerUsername);\n\nexport class FederationRoomSenderConverterEE {\n\tpublic static toRoomInviteUserDto(\n\t\tinternalInviterId: string,\n\t\tinternalRoomId: string,\n\t\texternalInviteeId: string,\n\t): FederationRoomInviteUserDto {\n\t\tconst normalizedInviteeId = removeExternalSpecificCharsFromExternalIdentifier(externalInviteeId);\n\t\tconst inviteeUsernameOnly = formatExternalUserIdToInternalUsernameFormat(externalInviteeId);\n\n\t\treturn new FederationRoomInviteUserDto({\n\t\t\tinternalInviterId,\n\t\t\tinternalRoomId,\n\t\t\trawInviteeId: externalInviteeId,\n\t\t\tnormalizedInviteeId,\n\t\t\tinviteeUsernameOnly,\n\t\t});\n\t}\n\n\tpublic static toSetupRoomDto(internalInviterId: string, internalRoomId: string): FederationSetupRoomDto {\n\t\treturn new FederationSetupRoomDto({\n\t\t\tinternalInviterId,\n\t\t\tinternalRoomId,\n\t\t});\n\t}\n\n\tpublic static toOnRoomCreationDto(\n\t\tinternalInviterId: string,\n\t\tinternalInviterUsername: string,\n\t\tinternalRoomId: string,\n\t\texternalInviteesUsername: string[],\n\t\thomeServerDomainName: string,\n\t): FederationOnRoomCreationDto {\n\t\tconst allExceptOwner = getAllUsersExceptOwnerByUsername(externalInviteesUsername, internalInviterUsername);\n\t\tconst users = normalizeInvitees(allExceptOwner, homeServerDomainName);\n\n\t\treturn new FederationOnRoomCreationDto({\n\t\t\tinternalInviterId,\n\t\t\tinternalRoomId,\n\t\t\tinvitees: users,\n\t\t});\n\t}\n\n\tpublic static toOnAddedUsersToARoomDto(\n\t\tinternalInviterId: string,\n\t\tinternalInviterUsername: string,\n\t\tinternalRoomId: string,\n\t\texternalInvitees: IUser[] | string[],\n\t\thomeServerDomainName: string,\n\t): FederationOnUsersAddedToARoomDto {\n\t\tconst externalInviteesUsername: string[] = getInviteesUsername(externalInvitees);\n\t\tconst externalInviterId =\n\t\t\tisAnExternalIdentifierFormat(internalInviterUsername) &&\n\t\t\textractServerNameFromExternalIdentifier(internalInviterUsername) !== homeServerDomainName &&\n\t\t\tinternalInviterId;\n\n\t\tconst allExceptOwner = getAllUsersExceptOwnerByUsername(externalInviteesUsername, internalInviterUsername);\n\t\tconst users = normalizeInvitees(allExceptOwner, homeServerDomainName);\n\n\t\treturn new FederationOnUsersAddedToARoomDto({\n\t\t\tinternalInviterId,\n\t\t\tinternalRoomId,\n\t\t\tinvitees: users,\n\t\t\tinviteComesFromAnExternalHomeServer: Boolean(externalInviterId),\n\t\t});\n\t}\n\n\tpublic static toOnDirectMessageCreatedDto(\n\t\tinternalInviterId: string,\n\t\tinternalRoomId: string,\n\t\texternalInvitees: (IUser | string)[],\n\t\thomeServerDomainName: string,\n\t): FederationOnDirectMessageRoomCreationDto {\n\t\tconst allExceptOwner = getAllUsersExceptOwnerByUserId(externalInvitees, internalInviterId);\n\t\tconst externalUsernamesToBeInvited: string[] = getInviteesUsername(getExternalUsersToBeInvited(allExceptOwner));\n\t\tconst internalUsernamesToBeInvited: string[] = getInternalUsernames(allExceptOwner).filter(\n\t\t\t(internal) => !externalUsernamesToBeInvited.includes(internal),\n\t\t);\n\t\tconst allUsernamesToBeInvited: string[] = [...externalUsernamesToBeInvited, ...internalUsernamesToBeInvited];\n\n\t\tconst externalInviterId = isAnExternalUserIdFormat(internalInviterId) && internalInviterId;\n\n\t\treturn new FederationOnDirectMessageRoomCreationDto({\n\t\t\tinternalInviterId,\n\t\t\tinternalRoomId,\n\t\t\tinvitees: normalizeInvitees(allUsernamesToBeInvited, homeServerDomainName),\n\t\t\tinviteComesFromAnExternalHomeServer: Boolean(externalInviterId),\n\t\t});\n\t}\n\n\tpublic static toBeforeDirectMessageCreatedDto(\n\t\tmembers: (IUser | string)[],\n\t\thomeServerDomainName: string,\n\t): FederationBeforeDirectMessageRoomCreationDto {\n\t\tconst invitees = getExternalUsersToBeInvited(members);\n\t\tconst inviteesUsername = getInviteesUsername(invitees);\n\n\t\treturn new FederationBeforeDirectMessageRoomCreationDto({\n\t\t\tinvitees: normalizeInvitees(inviteesUsername, homeServerDomainName),\n\t\t});\n\t}\n\n\tpublic static toBeforeAddUserToARoomDto(\n\t\tmembers: (IUser | string)[],\n\t\tinternalRoom: IRoom,\n\t\thomeServerDomainName: string,\n\t\tinternalInviter?: IUser,\n\t): FederationBeforeAddUserToARoomDto {\n\t\tconst { invitees } = FederationRoomSenderConverterEE.toBeforeDirectMessageCreatedDto(members, homeServerDomainName);\n\n\t\treturn new FederationBeforeAddUserToARoomDto({\n\t\t\tinternalRoomId: internalRoom._id,\n\t\t\tinvitees,\n\t\t\tinternalInviter,\n\t\t});\n\t}\n\n\tpublic static toCreateDirectMessageDto(internalInviterId: string, invitees: string[]): FederationCreateDirectMessageDto {\n\t\treturn new FederationCreateDirectMessageDto({\n\t\t\tinternalInviterId,\n\t\t\tinvitees,\n\t\t});\n\t}\n\n\tpublic static toJoinExternalPublicRoomDto(\n\t\tinternalUserId: string,\n\t\texternalRoomId: string,\n\t\troomName?: string,\n\t\tpageToken?: string,\n\t): FederationJoinExternalPublicRoomInputDto {\n\t\treturn new FederationJoinExternalPublicRoomInputDto({\n\t\t\texternalRoomId,\n\t\t\tinternalUserId,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalRoomId),\n\t\t\texternalRoomHomeServerName: extractServerNameFromExternalIdentifier(externalRoomId),\n\t\t\troomName,\n\t\t\tpageToken,\n\t\t});\n\t}\n\n\tpublic static toJoinInternalPublicRoomDto(internalUserId: string, internalRoomId: string): FederationJoinInternalPublicRoomInputDto {\n\t\treturn new FederationJoinInternalPublicRoomInputDto({\n\t\t\tinternalRoomId,\n\t\t\tinternalUserId,\n\t\t});\n\t}\n}\n"],"names":["FederationRoomSenderConverterEE","ensureUserHasAHomeServer","username","localHomeServer","includes","isAnExistentUser","invitee","normalizeInvitees","externalInviteesUsername","homeServerDomainName","filter","Boolean","map","inviteeUsername","normalizedInviteeId","removeExternalSpecificCharsFromExternalIdentifier","inviteeUsernameOnly","formatExternalUserIdToInternalUsernameFormat","rawInviteeId","getInviteesUsername","externalInvitees","getExternalUsersToBeInvited","invitees","externalAndNonExistentInviteesUsername","externalExistentUsers","isUserFederated","isAnExternalIdentifierFormat","getInternalUsernames","getAllUsersExceptOwnerByUserId","ownerId","_id","getAllUsersExceptOwnerByUsername","ownerUsername","toRoomInviteUserDto","internalInviterId","internalRoomId","externalInviteeId","FederationRoomInviteUserDto","toSetupRoomDto","FederationSetupRoomDto","toOnRoomCreationDto","internalInviterUsername","allExceptOwner","users","FederationOnRoomCreationDto","toOnAddedUsersToARoomDto","externalInviterId","extractServerNameFromExternalIdentifier","FederationOnUsersAddedToARoomDto","inviteComesFromAnExternalHomeServer","toOnDirectMessageCreatedDto","externalUsernamesToBeInvited","internalUsernamesToBeInvited","internal","allUsernamesToBeInvited","isAnExternalUserIdFormat","FederationOnDirectMessageRoomCreationDto","toBeforeDirectMessageCreatedDto","members","inviteesUsername","FederationBeforeDirectMessageRoomCreationDto","toBeforeAddUserToARoomDto","internalRoom","internalInviter","FederationBeforeAddUserToARoomDto","toCreateDirectMessageDto","FederationCreateDirectMessageDto","toJoinExternalPublicRoomDto","internalUserId","externalRoomId","roomName","pageToken","FederationJoinExternalPublicRoomInputDto","normalizedRoomId","convertExternalRoomIdToInternalRoomIdFormat","externalRoomHomeServerName","toJoinInternalPublicRoomDto","FederationJoinInternalPublicRoomInputDto"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/rocket-chat/converters/RoomSender.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7408640f99cc7ee99a4bf53b8b06303a963c3d2c","contentHash":"1b0c4aab095be8e36dd0b81d32b603f082523f22c0cec7d7ca04f182acb864a9"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/RoomReceiver.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/RoomReceiver.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":33,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":43}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":59}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":55}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":60}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":44}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":40}},"10":{"start":{"line":31,"column":8},"end":{"line":31,"column":65}},"11":{"start":{"line":34,"column":15},"end":{"line":34,"column":67}},"12":{"start":{"line":35,"column":25},"end":{"line":35,"column":86}},"13":{"start":{"line":36,"column":27},"end":{"line":36,"column":74}},"14":{"start":{"line":37,"column":36},"end":{"line":37,"column":106}},"15":{"start":{"line":38,"column":25},"end":{"line":38,"column":69}},"16":{"start":{"line":39,"column":27},"end":{"line":39,"column":73}},"17":{"start":{"line":40,"column":29},"end":{"line":40,"column":77}},"18":{"start":{"line":41,"column":31},"end":{"line":41,"column":88}},"19":{"start":{"line":42,"column":58},"end":{"line":44,"column":1}},"20":{"start":{"line":43,"column":4},"end":{"line":43,"column":79}},"21":{"start":{"line":45,"column":53},"end":{"line":48,"column":1}},"22":{"start":{"line":47,"column":4},"end":{"line":47,"column":156}},"23":{"start":{"line":49,"column":37},"end":{"line":49,"column":75}},"24":{"start":{"line":49,"column":51},"end":{"line":49,"column":75}},"25":{"start":{"line":50,"column":33},"end":{"line":50,"column":103}},"26":{"start":{"line":50,"column":43},"end":{"line":50,"column":103}},"27":{"start":{"line":51,"column":48},"end":{"line":54,"column":1}},"28":{"start":{"line":52,"column":21},"end":{"line":52,"column":42}},"29":{"start":{"line":53,"column":4},"end":{"line":53,"column":50}},"30":{"start":{"line":55,"column":52},"end":{"line":59,"column":1}},"31":{"start":{"line":56,"column":31},"end":{"line":56,"column":57}},"32":{"start":{"line":57,"column":19},"end":{"line":57,"column":22}},"33":{"start":{"line":58,"column":4},"end":{"line":58,"column":122}},"34":{"start":{"line":60,"column":23},"end":{"line":63,"column":1}},"35":{"start":{"line":61,"column":33},"end":{"line":61,"column":104}},"36":{"start":{"line":62,"column":4},"end":{"line":62,"column":113}},"37":{"start":{"line":64,"column":50},"end":{"line":73,"column":1}},"38":{"start":{"line":65,"column":4},"end":{"line":67,"column":5}},"39":{"start":{"line":66,"column":8},"end":{"line":66,"column":46}},"40":{"start":{"line":68,"column":20},"end":{"line":71,"column":5}},"41":{"start":{"line":72,"column":4},"end":{"line":72,"column":62}},"42":{"start":{"line":74,"column":53},"end":{"line":85,"column":1}},"43":{"start":{"line":76,"column":4},"end":{"line":78,"column":5}},"44":{"start":{"line":77,"column":8},"end":{"line":77,"column":18}},"45":{"start":{"line":79,"column":29},"end":{"line":79,"column":338}},"46":{"start":{"line":79,"column":77},"end":{"line":79,"column":147}},"47":{"start":{"line":80,"column":4},"end":{"line":84,"column":6}},"48":{"start":{"line":86,"column":55},"end":{"line":97,"column":1}},"49":{"start":{"line":88,"column":4},"end":{"line":90,"column":5}},"50":{"start":{"line":89,"column":8},"end":{"line":89,"column":18}},"51":{"start":{"line":91,"column":33},"end":{"line":91,"column":353}},"52":{"start":{"line":91,"column":81},"end":{"line":91,"column":157}},"53":{"start":{"line":92,"column":4},"end":{"line":96,"column":6}},"54":{"start":{"line":98,"column":49},"end":{"line":114,"column":1}},"55":{"start":{"line":99,"column":20},"end":{"line":103,"column":5}},"56":{"start":{"line":104,"column":4},"end":{"line":106,"column":5}},"57":{"start":{"line":105,"column":8},"end":{"line":105,"column":35}},"58":{"start":{"line":107,"column":4},"end":{"line":109,"column":5}},"59":{"start":{"line":108,"column":8},"end":{"line":108,"column":15}},"60":{"start":{"line":110,"column":4},"end":{"line":112,"column":5}},"61":{"start":{"line":111,"column":8},"end":{"line":111,"column":82}},"62":{"start":{"line":113,"column":4},"end":{"line":113,"column":74}},"63":{"start":{"line":115,"column":37},"end":{"line":115,"column":110}},"64":{"start":{"line":115,"column":75},"end":{"line":115,"column":110}},"65":{"start":{"line":116,"column":49},"end":{"line":130,"column":33}},"66":{"start":{"line":116,"column":117},"end":{"line":130,"column":33}},"67":{"start":{"line":116,"column":173},"end":{"line":116,"column":237}},"68":{"start":{"line":117,"column":37},"end":{"line":117,"column":179}},"69":{"start":{"line":118,"column":8},"end":{"line":128,"column":10}},"70":{"start":{"line":129,"column":8},"end":{"line":129,"column":51}},"71":{"start":{"line":131,"column":42},"end":{"line":198,"column":1}},"72":{"start":{"line":132,"column":47},"end":{"line":196,"column":10}},"73":{"start":{"line":133,"column":34},"end":{"line":133,"column":67}},"74":{"start":{"line":134,"column":35},"end":{"line":134,"column":69}},"75":{"start":{"line":135,"column":46},"end":{"line":135,"column":106}},"76":{"start":{"line":136,"column":45},"end":{"line":136,"column":104}},"77":{"start":{"line":137,"column":39},"end":{"line":137,"column":135}},"78":{"start":{"line":138,"column":37},"end":{"line":138,"column":132}},"79":{"start":{"line":139,"column":38},"end":{"line":139,"column":69}},"80":{"start":{"line":140,"column":35},"end":{"line":140,"column":75}},"81":{"start":{"line":141,"column":37},"end":{"line":141,"column":75}},"82":{"start":{"line":142,"column":8},"end":{"line":155,"column":9}},"83":{"start":{"line":143,"column":12},"end":{"line":153,"column":14}},"84":{"start":{"line":154,"column":12},"end":{"line":154,"column":46}},"85":{"start":{"line":156,"column":8},"end":{"line":158,"column":9}},"86":{"start":{"line":157,"column":12},"end":{"line":157,"column":46}},"87":{"start":{"line":159,"column":8},"end":{"line":175,"column":9}},"88":{"start":{"line":160,"column":12},"end":{"line":173,"column":14}},"89":{"start":{"line":174,"column":12},"end":{"line":174,"column":46}},"90":{"start":{"line":176,"column":8},"end":{"line":194,"column":10}},"91":{"start":{"line":195,"column":8},"end":{"line":195,"column":42}},"92":{"start":{"line":197,"column":4},"end":{"line":197,"column":127}},"93":{"start":{"line":199,"column":33},"end":{"line":210,"column":1}},"94":{"start":{"line":201,"column":34},"end":{"line":201,"column":297}},"95":{"start":{"line":201,"column":136},"end":{"line":201,"column":201}},"96":{"start":{"line":202,"column":4},"end":{"line":208,"column":5}},"97":{"start":{"line":203,"column":8},"end":{"line":207,"column":16}},"98":{"start":{"line":203,"column":63},"end":{"line":207,"column":13}},"99":{"start":{"line":209,"column":4},"end":{"line":209,"column":14}},"100":{"start":{"line":211,"column":35},"end":{"line":217,"column":1}},"101":{"start":{"line":213,"column":4},"end":{"line":215,"column":5}},"102":{"start":{"line":214,"column":8},"end":{"line":214,"column":18}},"103":{"start":{"line":216,"column":4},"end":{"line":216,"column":234}},"104":{"start":{"line":218,"column":34},"end":{"line":375,"column":1}},"105":{"start":{"line":221,"column":8},"end":{"line":231,"column":11}},"106":{"start":{"line":235,"column":8},"end":{"line":256,"column":11}},"107":{"start":{"line":260,"column":34},"end":{"line":260,"column":396}},"108":{"start":{"line":261,"column":8},"end":{"line":278,"column":11}},"109":{"start":{"line":282,"column":8},"end":{"line":291,"column":11}},"110":{"start":{"line":295,"column":8},"end":{"line":297,"column":9}},"111":{"start":{"line":296,"column":12},"end":{"line":296,"column":63}},"112":{"start":{"line":298,"column":8},"end":{"line":300,"column":9}},"113":{"start":{"line":299,"column":12},"end":{"line":299,"column":73}},"114":{"start":{"line":301,"column":8},"end":{"line":303,"column":9}},"115":{"start":{"line":302,"column":12},"end":{"line":302,"column":69}},"116":{"start":{"line":304,"column":34},"end":{"line":304,"column":396}},"117":{"start":{"line":305,"column":8},"end":{"line":325,"column":11}},"118":{"start":{"line":329,"column":8},"end":{"line":334,"column":11}},"119":{"start":{"line":338,"column":8},"end":{"line":344,"column":11}},"120":{"start":{"line":348,"column":8},"end":{"line":354,"column":11}},"121":{"start":{"line":357,"column":8},"end":{"line":363,"column":11}},"122":{"start":{"line":367,"column":8},"end":{"line":373,"column":11}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":33},"end":{"line":12,"column":34}},"loc":{"start":{"line":12,"column":44},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":49},"end":{"line":15,"column":50}},"loc":{"start":{"line":15,"column":60},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":45},"end":{"line":18,"column":46}},"loc":{"start":{"line":18,"column":56},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":50},"end":{"line":21,"column":51}},"loc":{"start":{"line":21,"column":61},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":34},"end":{"line":24,"column":35}},"loc":{"start":{"line":24,"column":45},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":30},"end":{"line":27,"column":31}},"loc":{"start":{"line":27,"column":41},"end":{"line":29,"column":5}},"line":27},"7":{"name":"(anonymous_7)","decl":{"start":{"line":30,"column":55},"end":{"line":30,"column":56}},"loc":{"start":{"line":30,"column":66},"end":{"line":32,"column":5}},"line":30},"8":{"name":"(anonymous_8)","decl":{"start":{"line":42,"column":58},"end":{"line":42,"column":59}},"loc":{"start":{"line":42,"column":83},"end":{"line":44,"column":1}},"line":42},"9":{"name":"(anonymous_9)","decl":{"start":{"line":45,"column":53},"end":{"line":45,"column":54}},"loc":{"start":{"line":45,"column":74},"end":{"line":48,"column":1}},"line":45},"10":{"name":"(anonymous_10)","decl":{"start":{"line":49,"column":37},"end":{"line":49,"column":38}},"loc":{"start":{"line":49,"column":51},"end":{"line":49,"column":75}},"line":49},"11":{"name":"(anonymous_11)","decl":{"start":{"line":50,"column":33},"end":{"line":50,"column":34}},"loc":{"start":{"line":50,"column":43},"end":{"line":50,"column":103}},"line":50},"12":{"name":"(anonymous_12)","decl":{"start":{"line":51,"column":48},"end":{"line":51,"column":49}},"loc":{"start":{"line":51,"column":67},"end":{"line":54,"column":1}},"line":51},"13":{"name":"(anonymous_13)","decl":{"start":{"line":55,"column":52},"end":{"line":55,"column":53}},"loc":{"start":{"line":55,"column":73},"end":{"line":59,"column":1}},"line":55},"14":{"name":"(anonymous_14)","decl":{"start":{"line":60,"column":23},"end":{"line":60,"column":24}},"loc":{"start":{"line":60,"column":59},"end":{"line":63,"column":1}},"line":60},"15":{"name":"(anonymous_15)","decl":{"start":{"line":64,"column":50},"end":{"line":64,"column":51}},"loc":{"start":{"line":64,"column":96},"end":{"line":73,"column":1}},"line":64},"16":{"name":"(anonymous_16)","decl":{"start":{"line":74,"column":53},"end":{"line":74,"column":54}},"loc":{"start":{"line":74,"column":71},"end":{"line":85,"column":1}},"line":74},"17":{"name":"(anonymous_17)","decl":{"start":{"line":79,"column":63},"end":{"line":79,"column":64}},"loc":{"start":{"line":79,"column":77},"end":{"line":79,"column":147}},"line":79},"18":{"name":"(anonymous_18)","decl":{"start":{"line":86,"column":55},"end":{"line":86,"column":56}},"loc":{"start":{"line":86,"column":101},"end":{"line":97,"column":1}},"line":86},"19":{"name":"(anonymous_19)","decl":{"start":{"line":91,"column":67},"end":{"line":91,"column":68}},"loc":{"start":{"line":91,"column":81},"end":{"line":91,"column":157}},"line":91},"20":{"name":"(anonymous_20)","decl":{"start":{"line":98,"column":49},"end":{"line":98,"column":50}},"loc":{"start":{"line":98,"column":63},"end":{"line":114,"column":1}},"line":98},"21":{"name":"(anonymous_21)","decl":{"start":{"line":115,"column":37},"end":{"line":115,"column":38}},"loc":{"start":{"line":115,"column":75},"end":{"line":115,"column":110}},"line":115},"22":{"name":"(anonymous_22)","decl":{"start":{"line":116,"column":49},"end":{"line":116,"column":50}},"loc":{"start":{"line":116,"column":117},"end":{"line":130,"column":33}},"line":116},"23":{"name":"(anonymous_23)","decl":{"start":{"line":116,"column":155},"end":{"line":116,"column":156}},"loc":{"start":{"line":116,"column":173},"end":{"line":116,"column":237}},"line":116},"24":{"name":"(anonymous_24)","decl":{"start":{"line":116,"column":246},"end":{"line":116,"column":247}},"loc":{"start":{"line":116,"column":301},"end":{"line":130,"column":5}},"line":116},"25":{"name":"(anonymous_25)","decl":{"start":{"line":131,"column":42},"end":{"line":131,"column":43}},"loc":{"start":{"line":131,"column":93},"end":{"line":198,"column":1}},"line":131},"26":{"name":"(anonymous_26)","decl":{"start":{"line":132,"column":86},"end":{"line":132,"column":87}},"loc":{"start":{"line":132,"column":132},"end":{"line":196,"column":5}},"line":132},"27":{"name":"(anonymous_27)","decl":{"start":{"line":199,"column":33},"end":{"line":199,"column":34}},"loc":{"start":{"line":199,"column":51},"end":{"line":210,"column":1}},"line":199},"28":{"name":"(anonymous_28)","decl":{"start":{"line":201,"column":122},"end":{"line":201,"column":123}},"loc":{"start":{"line":201,"column":136},"end":{"line":201,"column":201}},"line":201},"29":{"name":"(anonymous_29)","decl":{"start":{"line":203,"column":41},"end":{"line":203,"column":42}},"loc":{"start":{"line":203,"column":63},"end":{"line":207,"column":13}},"line":203},"30":{"name":"(anonymous_30)","decl":{"start":{"line":211,"column":35},"end":{"line":211,"column":36}},"loc":{"start":{"line":211,"column":52},"end":{"line":217,"column":1}},"line":211},"31":{"name":"(anonymous_31)","decl":{"start":{"line":219,"column":4},"end":{"line":219,"column":5}},"loc":{"start":{"line":219,"column":42},"end":{"line":232,"column":5}},"line":219},"32":{"name":"(anonymous_32)","decl":{"start":{"line":233,"column":4},"end":{"line":233,"column":5}},"loc":{"start":{"line":233,"column":70},"end":{"line":257,"column":5}},"line":233},"33":{"name":"(anonymous_33)","decl":{"start":{"line":258,"column":4},"end":{"line":258,"column":5}},"loc":{"start":{"line":258,"column":47},"end":{"line":279,"column":5}},"line":258},"34":{"name":"(anonymous_34)","decl":{"start":{"line":280,"column":4},"end":{"line":280,"column":5}},"loc":{"start":{"line":280,"column":47},"end":{"line":292,"column":5}},"line":280},"35":{"name":"(anonymous_35)","decl":{"start":{"line":293,"column":4},"end":{"line":293,"column":5}},"loc":{"start":{"line":293,"column":51},"end":{"line":326,"column":5}},"line":293},"36":{"name":"(anonymous_36)","decl":{"start":{"line":327,"column":4},"end":{"line":327,"column":5}},"loc":{"start":{"line":327,"column":51},"end":{"line":335,"column":5}},"line":327},"37":{"name":"(anonymous_37)","decl":{"start":{"line":336,"column":4},"end":{"line":336,"column":5}},"loc":{"start":{"line":336,"column":46},"end":{"line":345,"column":5}},"line":336},"38":{"name":"(anonymous_38)","decl":{"start":{"line":346,"column":4},"end":{"line":346,"column":5}},"loc":{"start":{"line":346,"column":47},"end":{"line":355,"column":5}},"line":346},"39":{"name":"(anonymous_39)","decl":{"start":{"line":356,"column":4},"end":{"line":356,"column":5}},"loc":{"start":{"line":356,"column":47},"end":{"line":364,"column":5}},"line":356},"40":{"name":"(anonymous_40)","decl":{"start":{"line":365,"column":4},"end":{"line":365,"column":5}},"loc":{"start":{"line":365,"column":58},"end":{"line":374,"column":5}},"line":365}},"branchMap":{"0":{"loc":{"start":{"line":42,"column":59},"end":{"line":42,"column":80}},"type":"default-arg","locations":[{"start":{"line":42,"column":78},"end":{"line":42,"column":80}}],"line":42},"1":{"loc":{"start":{"line":45,"column":54},"end":{"line":45,"column":71}},"type":"default-arg","locations":[{"start":{"line":45,"column":69},"end":{"line":45,"column":71}}],"line":45},"2":{"loc":{"start":{"line":47,"column":11},"end":{"line":47,"column":155}},"type":"cond-expr","locations":[{"start":{"line":47,"column":109},"end":{"line":47,"column":115}},{"start":{"line":47,"column":118},"end":{"line":47,"column":155}}],"line":47},"3":{"loc":{"start":{"line":47,"column":11},"end":{"line":47,"column":106}},"type":"binary-expr","locations":[{"start":{"line":47,"column":11},"end":{"line":47,"column":71}},{"start":{"line":47,"column":75},"end":{"line":47,"column":106}}],"line":47},"4":{"loc":{"start":{"line":50,"column":43},"end":{"line":50,"column":103}},"type":"binary-expr","locations":[{"start":{"line":50,"column":43},"end":{"line":50,"column":79}},{"start":{"line":50,"column":83},"end":{"line":50,"column":103}}],"line":50},"5":{"loc":{"start":{"line":51,"column":49},"end":{"line":51,"column":64}},"type":"default-arg","locations":[{"start":{"line":51,"column":62},"end":{"line":51,"column":64}}],"line":51},"6":{"loc":{"start":{"line":53,"column":11},"end":{"line":53,"column":49}},"type":"cond-expr","locations":[{"start":{"line":53,"column":33},"end":{"line":53,"column":44}},{"start":{"line":53,"column":47},"end":{"line":53,"column":49}}],"line":53},"7":{"loc":{"start":{"line":55,"column":53},"end":{"line":55,"column":70}},"type":"default-arg","locations":[{"start":{"line":55,"column":68},"end":{"line":55,"column":70}}],"line":55},"8":{"loc":{"start":{"line":58,"column":11},"end":{"line":58,"column":121}},"type":"cond-expr","locations":[{"start":{"line":58,"column":74},"end":{"line":58,"column":80}},{"start":{"line":58,"column":83},"end":{"line":58,"column":121}}],"line":58},"9":{"loc":{"start":{"line":58,"column":11},"end":{"line":58,"column":71}},"type":"binary-expr","locations":[{"start":{"line":58,"column":11},"end":{"line":58,"column":38}},{"start":{"line":58,"column":42},"end":{"line":58,"column":71}}],"line":58},"10":{"loc":{"start":{"line":60,"column":24},"end":{"line":60,"column":38}},"type":"default-arg","locations":[{"start":{"line":60,"column":36},"end":{"line":60,"column":38}}],"line":60},"11":{"loc":{"start":{"line":62,"column":11},"end":{"line":62,"column":112}},"type":"cond-expr","locations":[{"start":{"line":62,"column":34},"end":{"line":62,"column":72}},{"start":{"line":62,"column":75},"end":{"line":62,"column":112}}],"line":62},"12":{"loc":{"start":{"line":64,"column":67},"end":{"line":64,"column":93}},"type":"default-arg","locations":[{"start":{"line":64,"column":88},"end":{"line":64,"column":93}}],"line":64},"13":{"loc":{"start":{"line":65,"column":4},"end":{"line":67,"column":5}},"type":"if","locations":[{"start":{"line":65,"column":4},"end":{"line":67,"column":5}},{"start":{"line":65,"column":4},"end":{"line":67,"column":5}}],"line":65},"14":{"loc":{"start":{"line":72,"column":11},"end":{"line":72,"column":61}},"type":"binary-expr","locations":[{"start":{"line":72,"column":11},"end":{"line":72,"column":34}},{"start":{"line":72,"column":38},"end":{"line":72,"column":61}}],"line":72},"15":{"loc":{"start":{"line":74,"column":54},"end":{"line":74,"column":68}},"type":"default-arg","locations":[{"start":{"line":74,"column":66},"end":{"line":74,"column":68}}],"line":74},"16":{"loc":{"start":{"line":76,"column":4},"end":{"line":78,"column":5}},"type":"if","locations":[{"start":{"line":76,"column":4},"end":{"line":78,"column":5}},{"start":{"line":76,"column":4},"end":{"line":78,"column":5}}],"line":76},"17":{"loc":{"start":{"line":79,"column":29},"end":{"line":79,"column":338}},"type":"cond-expr","locations":[{"start":{"line":79,"column":191},"end":{"line":79,"column":197}},{"start":{"line":79,"column":200},"end":{"line":79,"column":338}}],"line":79},"18":{"loc":{"start":{"line":79,"column":29},"end":{"line":79,"column":188}},"type":"binary-expr","locations":[{"start":{"line":79,"column":29},"end":{"line":79,"column":158}},{"start":{"line":79,"column":162},"end":{"line":79,"column":188}}],"line":79},"19":{"loc":{"start":{"line":79,"column":200},"end":{"line":79,"column":338}},"type":"cond-expr","locations":[{"start":{"line":79,"column":301},"end":{"line":79,"column":307}},{"start":{"line":79,"column":310},"end":{"line":79,"column":338}}],"line":79},"20":{"loc":{"start":{"line":79,"column":200},"end":{"line":79,"column":298}},"type":"binary-expr","locations":[{"start":{"line":79,"column":200},"end":{"line":79,"column":260}},{"start":{"line":79,"column":264},"end":{"line":79,"column":298}}],"line":79},"21":{"loc":{"start":{"line":81,"column":11},"end":{"line":83,"column":14}},"type":"cond-expr","locations":[{"start":{"line":81,"column":30},"end":{"line":83,"column":9}},{"start":{"line":83,"column":12},"end":{"line":83,"column":14}}],"line":81},"22":{"loc":{"start":{"line":86,"column":56},"end":{"line":86,"column":70}},"type":"default-arg","locations":[{"start":{"line":86,"column":68},"end":{"line":86,"column":70}}],"line":86},"23":{"loc":{"start":{"line":86,"column":72},"end":{"line":86,"column":98}},"type":"default-arg","locations":[{"start":{"line":86,"column":93},"end":{"line":86,"column":98}}],"line":86},"24":{"loc":{"start":{"line":88,"column":4},"end":{"line":90,"column":5}},"type":"if","locations":[{"start":{"line":88,"column":4},"end":{"line":90,"column":5}},{"start":{"line":88,"column":4},"end":{"line":90,"column":5}}],"line":88},"25":{"loc":{"start":{"line":91,"column":33},"end":{"line":91,"column":353}},"type":"cond-expr","locations":[{"start":{"line":91,"column":201},"end":{"line":91,"column":207}},{"start":{"line":91,"column":210},"end":{"line":91,"column":353}}],"line":91},"26":{"loc":{"start":{"line":91,"column":33},"end":{"line":91,"column":198}},"type":"binary-expr","locations":[{"start":{"line":91,"column":33},"end":{"line":91,"column":168}},{"start":{"line":91,"column":172},"end":{"line":91,"column":198}}],"line":91},"27":{"loc":{"start":{"line":91,"column":210},"end":{"line":91,"column":353}},"type":"cond-expr","locations":[{"start":{"line":91,"column":311},"end":{"line":91,"column":317}},{"start":{"line":91,"column":320},"end":{"line":91,"column":353}}],"line":91},"28":{"loc":{"start":{"line":91,"column":210},"end":{"line":91,"column":308}},"type":"binary-expr","locations":[{"start":{"line":91,"column":210},"end":{"line":91,"column":270}},{"start":{"line":91,"column":274},"end":{"line":91,"column":308}}],"line":91},"29":{"loc":{"start":{"line":93,"column":11},"end":{"line":95,"column":14}},"type":"cond-expr","locations":[{"start":{"line":93,"column":34},"end":{"line":95,"column":9}},{"start":{"line":95,"column":12},"end":{"line":95,"column":14}}],"line":93},"30":{"loc":{"start":{"line":104,"column":4},"end":{"line":106,"column":5}},"type":"if","locations":[{"start":{"line":104,"column":4},"end":{"line":106,"column":5}},{"start":{"line":104,"column":4},"end":{"line":106,"column":5}}],"line":104},"31":{"loc":{"start":{"line":107,"column":4},"end":{"line":109,"column":5}},"type":"if","locations":[{"start":{"line":107,"column":4},"end":{"line":109,"column":5}},{"start":{"line":107,"column":4},"end":{"line":109,"column":5}}],"line":107},"32":{"loc":{"start":{"line":110,"column":4},"end":{"line":112,"column":5}},"type":"if","locations":[{"start":{"line":110,"column":4},"end":{"line":112,"column":5}},{"start":{"line":110,"column":4},"end":{"line":112,"column":5}}],"line":110},"33":{"loc":{"start":{"line":110,"column":8},"end":{"line":110,"column":130}},"type":"binary-expr","locations":[{"start":{"line":110,"column":8},"end":{"line":110,"column":64}},{"start":{"line":110,"column":68},"end":{"line":110,"column":130}}],"line":110},"34":{"loc":{"start":{"line":118,"column":62},"end":{"line":128,"column":9}},"type":"cond-expr","locations":[{"start":{"line":118,"column":85},"end":{"line":123,"column":9}},{"start":{"line":123,"column":12},"end":{"line":128,"column":9}}],"line":118},"35":{"loc":{"start":{"line":131,"column":43},"end":{"line":131,"column":65}},"type":"default-arg","locations":[{"start":{"line":131,"column":63},"end":{"line":131,"column":65}}],"line":131},"36":{"loc":{"start":{"line":131,"column":67},"end":{"line":131,"column":90}},"type":"default-arg","locations":[{"start":{"line":131,"column":88},"end":{"line":131,"column":90}}],"line":131},"37":{"loc":{"start":{"line":142,"column":8},"end":{"line":155,"column":9}},"type":"if","locations":[{"start":{"line":142,"column":8},"end":{"line":155,"column":9}},{"start":{"line":142,"column":8},"end":{"line":155,"column":9}}],"line":142},"38":{"loc":{"start":{"line":143,"column":57},"end":{"line":153,"column":13}},"type":"cond-expr","locations":[{"start":{"line":143,"column":82},"end":{"line":148,"column":13}},{"start":{"line":148,"column":16},"end":{"line":153,"column":13}}],"line":143},"39":{"loc":{"start":{"line":156,"column":8},"end":{"line":158,"column":9}},"type":"if","locations":[{"start":{"line":156,"column":8},"end":{"line":158,"column":9}},{"start":{"line":156,"column":8},"end":{"line":158,"column":9}}],"line":156},"40":{"loc":{"start":{"line":159,"column":8},"end":{"line":175,"column":9}},"type":"if","locations":[{"start":{"line":159,"column":8},"end":{"line":175,"column":9}},{"start":{"line":159,"column":8},"end":{"line":175,"column":9}}],"line":159},"41":{"loc":{"start":{"line":161,"column":19},"end":{"line":166,"column":22}},"type":"cond-expr","locations":[{"start":{"line":161,"column":51},"end":{"line":166,"column":17}},{"start":{"line":166,"column":20},"end":{"line":166,"column":22}}],"line":161},"42":{"loc":{"start":{"line":167,"column":19},"end":{"line":172,"column":22}},"type":"cond-expr","locations":[{"start":{"line":167,"column":50},"end":{"line":172,"column":17}},{"start":{"line":172,"column":20},"end":{"line":172,"column":22}}],"line":167},"43":{"loc":{"start":{"line":176,"column":53},"end":{"line":194,"column":9}},"type":"cond-expr","locations":[{"start":{"line":176,"column":76},"end":{"line":185,"column":9}},{"start":{"line":185,"column":12},"end":{"line":194,"column":9}}],"line":176},"44":{"loc":{"start":{"line":199,"column":34},"end":{"line":199,"column":48}},"type":"default-arg","locations":[{"start":{"line":199,"column":46},"end":{"line":199,"column":48}}],"line":199},"45":{"loc":{"start":{"line":201,"column":34},"end":{"line":201,"column":297}},"type":"cond-expr","locations":[{"start":{"line":201,"column":79},"end":{"line":201,"column":85}},{"start":{"line":201,"column":88},"end":{"line":201,"column":297}}],"line":201},"46":{"loc":{"start":{"line":201,"column":34},"end":{"line":201,"column":76}},"type":"binary-expr","locations":[{"start":{"line":201,"column":34},"end":{"line":201,"column":52}},{"start":{"line":201,"column":56},"end":{"line":201,"column":76}}],"line":201},"47":{"loc":{"start":{"line":201,"column":88},"end":{"line":201,"column":297}},"type":"cond-expr","locations":[{"start":{"line":201,"column":245},"end":{"line":201,"column":251}},{"start":{"line":201,"column":254},"end":{"line":201,"column":297}}],"line":201},"48":{"loc":{"start":{"line":201,"column":88},"end":{"line":201,"column":242}},"type":"binary-expr","locations":[{"start":{"line":201,"column":88},"end":{"line":201,"column":212}},{"start":{"line":201,"column":216},"end":{"line":201,"column":242}}],"line":201},"49":{"loc":{"start":{"line":202,"column":4},"end":{"line":208,"column":5}},"type":"if","locations":[{"start":{"line":202,"column":4},"end":{"line":208,"column":5}},{"start":{"line":202,"column":4},"end":{"line":208,"column":5}}],"line":202},"50":{"loc":{"start":{"line":213,"column":4},"end":{"line":215,"column":5}},"type":"if","locations":[{"start":{"line":213,"column":4},"end":{"line":215,"column":5}},{"start":{"line":213,"column":4},"end":{"line":215,"column":5}}],"line":213},"51":{"loc":{"start":{"line":213,"column":8},"end":{"line":213,"column":197}},"type":"binary-expr","locations":[{"start":{"line":213,"column":8},"end":{"line":213,"column":40}},{"start":{"line":213,"column":44},"end":{"line":213,"column":197}}],"line":213},"52":{"loc":{"start":{"line":213,"column":46},"end":{"line":213,"column":196}},"type":"cond-expr","locations":[{"start":{"line":213,"column":146},"end":{"line":213,"column":152}},{"start":{"line":213,"column":155},"end":{"line":213,"column":196}}],"line":213},"53":{"loc":{"start":{"line":213,"column":46},"end":{"line":213,"column":143}},"type":"binary-expr","locations":[{"start":{"line":213,"column":46},"end":{"line":213,"column":105}},{"start":{"line":213,"column":109},"end":{"line":213,"column":143}}],"line":213},"54":{"loc":{"start":{"line":216,"column":36},"end":{"line":216,"column":232}},"type":"binary-expr","locations":[{"start":{"line":216,"column":36},"end":{"line":216,"column":67}},{"start":{"line":216,"column":72},"end":{"line":216,"column":225}},{"start":{"line":216,"column":230},"end":{"line":216,"column":232}}],"line":216},"55":{"loc":{"start":{"line":216,"column":72},"end":{"line":216,"column":225}},"type":"cond-expr","locations":[{"start":{"line":216,"column":174},"end":{"line":216,"column":180}},{"start":{"line":216,"column":183},"end":{"line":216,"column":225}}],"line":216},"56":{"loc":{"start":{"line":216,"column":72},"end":{"line":216,"column":171}},"type":"binary-expr","locations":[{"start":{"line":216,"column":72},"end":{"line":216,"column":132}},{"start":{"line":216,"column":136},"end":{"line":216,"column":171}}],"line":216},"57":{"loc":{"start":{"line":225,"column":60},"end":{"line":225,"column":247}},"type":"binary-expr","locations":[{"start":{"line":225,"column":60},"end":{"line":225,"column":91}},{"start":{"line":225,"column":96},"end":{"line":225,"column":246}}],"line":225},"58":{"loc":{"start":{"line":225,"column":96},"end":{"line":225,"column":246}},"type":"cond-expr","locations":[{"start":{"line":225,"column":196},"end":{"line":225,"column":202}},{"start":{"line":225,"column":205},"end":{"line":225,"column":246}}],"line":225},"59":{"loc":{"start":{"line":225,"column":96},"end":{"line":225,"column":193}},"type":"binary-expr","locations":[{"start":{"line":225,"column":96},"end":{"line":225,"column":155}},{"start":{"line":225,"column":159},"end":{"line":225,"column":193}}],"line":225},"60":{"loc":{"start":{"line":226,"column":62},"end":{"line":226,"column":252}},"type":"binary-expr","locations":[{"start":{"line":226,"column":62},"end":{"line":226,"column":93}},{"start":{"line":226,"column":98},"end":{"line":226,"column":251}}],"line":226},"61":{"loc":{"start":{"line":226,"column":98},"end":{"line":226,"column":251}},"type":"cond-expr","locations":[{"start":{"line":226,"column":200},"end":{"line":226,"column":206}},{"start":{"line":226,"column":209},"end":{"line":226,"column":251}}],"line":226},"62":{"loc":{"start":{"line":226,"column":98},"end":{"line":226,"column":197}},"type":"binary-expr","locations":[{"start":{"line":226,"column":98},"end":{"line":226,"column":158}},{"start":{"line":226,"column":162},"end":{"line":226,"column":197}}],"line":226},"63":{"loc":{"start":{"line":229,"column":49},"end":{"line":229,"column":227}},"type":"binary-expr","locations":[{"start":{"line":229,"column":50},"end":{"line":229,"column":217}},{"start":{"line":229,"column":222},"end":{"line":229,"column":227}}],"line":229},"64":{"loc":{"start":{"line":229,"column":50},"end":{"line":229,"column":217}},"type":"cond-expr","locations":[{"start":{"line":229,"column":147},"end":{"line":229,"column":153}},{"start":{"line":229,"column":156},"end":{"line":229,"column":217}}],"line":229},"65":{"loc":{"start":{"line":229,"column":50},"end":{"line":229,"column":144}},"type":"binary-expr","locations":[{"start":{"line":229,"column":50},"end":{"line":229,"column":107}},{"start":{"line":229,"column":111},"end":{"line":229,"column":144}}],"line":229},"66":{"loc":{"start":{"line":230,"column":28},"end":{"line":230,"column":174}},"type":"cond-expr","locations":[{"start":{"line":230,"column":127},"end":{"line":230,"column":133}},{"start":{"line":230,"column":136},"end":{"line":230,"column":174}}],"line":230},"67":{"loc":{"start":{"line":230,"column":28},"end":{"line":230,"column":124}},"type":"binary-expr","locations":[{"start":{"line":230,"column":28},"end":{"line":230,"column":86}},{"start":{"line":230,"column":90},"end":{"line":230,"column":124}}],"line":230},"68":{"loc":{"start":{"line":239,"column":60},"end":{"line":239,"column":247}},"type":"binary-expr","locations":[{"start":{"line":239,"column":60},"end":{"line":239,"column":91}},{"start":{"line":239,"column":96},"end":{"line":239,"column":246}}],"line":239},"69":{"loc":{"start":{"line":239,"column":96},"end":{"line":239,"column":246}},"type":"cond-expr","locations":[{"start":{"line":239,"column":196},"end":{"line":239,"column":202}},{"start":{"line":239,"column":205},"end":{"line":239,"column":246}}],"line":239},"70":{"loc":{"start":{"line":239,"column":96},"end":{"line":239,"column":193}},"type":"binary-expr","locations":[{"start":{"line":239,"column":96},"end":{"line":239,"column":155}},{"start":{"line":239,"column":159},"end":{"line":239,"column":193}}],"line":239},"71":{"loc":{"start":{"line":240,"column":62},"end":{"line":240,"column":252}},"type":"binary-expr","locations":[{"start":{"line":240,"column":62},"end":{"line":240,"column":93}},{"start":{"line":240,"column":98},"end":{"line":240,"column":251}}],"line":240},"72":{"loc":{"start":{"line":240,"column":98},"end":{"line":240,"column":251}},"type":"cond-expr","locations":[{"start":{"line":240,"column":200},"end":{"line":240,"column":206}},{"start":{"line":240,"column":209},"end":{"line":240,"column":251}}],"line":240},"73":{"loc":{"start":{"line":240,"column":98},"end":{"line":240,"column":197}},"type":"binary-expr","locations":[{"start":{"line":240,"column":98},"end":{"line":240,"column":158}},{"start":{"line":240,"column":162},"end":{"line":240,"column":197}}],"line":240},"74":{"loc":{"start":{"line":240,"column":254},"end":{"line":240,"column":392}},"type":"cond-expr","locations":[{"start":{"line":240,"column":351},"end":{"line":240,"column":357}},{"start":{"line":240,"column":360},"end":{"line":240,"column":392}}],"line":240},"75":{"loc":{"start":{"line":240,"column":254},"end":{"line":240,"column":348}},"type":"binary-expr","locations":[{"start":{"line":240,"column":254},"end":{"line":240,"column":311}},{"start":{"line":240,"column":315},"end":{"line":240,"column":348}}],"line":240},"76":{"loc":{"start":{"line":248,"column":20},"end":{"line":248,"column":162}},"type":"cond-expr","locations":[{"start":{"line":248,"column":119},"end":{"line":248,"column":125}},{"start":{"line":248,"column":128},"end":{"line":248,"column":162}}],"line":248},"77":{"loc":{"start":{"line":248,"column":20},"end":{"line":248,"column":116}},"type":"binary-expr","locations":[{"start":{"line":248,"column":20},"end":{"line":248,"column":78}},{"start":{"line":248,"column":82},"end":{"line":248,"column":116}}],"line":248},"78":{"loc":{"start":{"line":250,"column":27},"end":{"line":250,"column":169}},"type":"cond-expr","locations":[{"start":{"line":250,"column":126},"end":{"line":250,"column":132}},{"start":{"line":250,"column":135},"end":{"line":250,"column":169}}],"line":250},"79":{"loc":{"start":{"line":250,"column":27},"end":{"line":250,"column":123}},"type":"binary-expr","locations":[{"start":{"line":250,"column":27},"end":{"line":250,"column":85}},{"start":{"line":250,"column":89},"end":{"line":250,"column":123}}],"line":250},"80":{"loc":{"start":{"line":251,"column":29},"end":{"line":251,"column":172}},"type":"cond-expr","locations":[{"start":{"line":251,"column":128},"end":{"line":251,"column":134}},{"start":{"line":251,"column":137},"end":{"line":251,"column":172}}],"line":251},"81":{"loc":{"start":{"line":251,"column":29},"end":{"line":251,"column":125}},"type":"binary-expr","locations":[{"start":{"line":251,"column":29},"end":{"line":251,"column":87}},{"start":{"line":251,"column":91},"end":{"line":251,"column":125}}],"line":251},"82":{"loc":{"start":{"line":253,"column":15},"end":{"line":255,"column":18}},"type":"cond-expr","locations":[{"start":{"line":253,"column":161},"end":{"line":255,"column":13}},{"start":{"line":255,"column":16},"end":{"line":255,"column":18}}],"line":253},"83":{"loc":{"start":{"line":253,"column":16},"end":{"line":253,"column":157}},"type":"cond-expr","locations":[{"start":{"line":253,"column":115},"end":{"line":253,"column":121}},{"start":{"line":253,"column":124},"end":{"line":253,"column":157}}],"line":253},"84":{"loc":{"start":{"line":253,"column":16},"end":{"line":253,"column":112}},"type":"binary-expr","locations":[{"start":{"line":253,"column":16},"end":{"line":253,"column":74}},{"start":{"line":253,"column":78},"end":{"line":253,"column":112}}],"line":253},"85":{"loc":{"start":{"line":260,"column":43},"end":{"line":260,"column":339}},"type":"cond-expr","locations":[{"start":{"line":260,"column":140},"end":{"line":260,"column":146}},{"start":{"line":260,"column":149},"end":{"line":260,"column":339}}],"line":260},"86":{"loc":{"start":{"line":260,"column":43},"end":{"line":260,"column":137}},"type":"binary-expr","locations":[{"start":{"line":260,"column":43},"end":{"line":260,"column":100}},{"start":{"line":260,"column":104},"end":{"line":260,"column":137}}],"line":260},"87":{"loc":{"start":{"line":260,"column":149},"end":{"line":260,"column":339}},"type":"cond-expr","locations":[{"start":{"line":260,"column":287},"end":{"line":260,"column":293}},{"start":{"line":260,"column":296},"end":{"line":260,"column":339}}],"line":260},"88":{"loc":{"start":{"line":260,"column":149},"end":{"line":260,"column":284}},"type":"binary-expr","locations":[{"start":{"line":260,"column":149},"end":{"line":260,"column":235}},{"start":{"line":260,"column":239},"end":{"line":260,"column":284}}],"line":260},"89":{"loc":{"start":{"line":267,"column":35},"end":{"line":267,"column":77}},"type":"binary-expr","locations":[{"start":{"line":267,"column":35},"end":{"line":267,"column":71}},{"start":{"line":267,"column":75},"end":{"line":267,"column":77}}],"line":267},"90":{"loc":{"start":{"line":269,"column":15},"end":{"line":277,"column":13}},"type":"cond-expr","locations":[{"start":{"line":269,"column":35},"end":{"line":275,"column":13}},{"start":{"line":275,"column":16},"end":{"line":277,"column":13}}],"line":269},"91":{"loc":{"start":{"line":271,"column":33},"end":{"line":271,"column":343}},"type":"binary-expr","locations":[{"start":{"line":271,"column":34},"end":{"line":271,"column":336}},{"start":{"line":271,"column":341},"end":{"line":271,"column":343}}],"line":271},"92":{"loc":{"start":{"line":271,"column":34},"end":{"line":271,"column":336}},"type":"cond-expr","locations":[{"start":{"line":271,"column":133},"end":{"line":271,"column":139}},{"start":{"line":271,"column":142},"end":{"line":271,"column":336}}],"line":271},"93":{"loc":{"start":{"line":271,"column":34},"end":{"line":271,"column":130}},"type":"binary-expr","locations":[{"start":{"line":271,"column":34},"end":{"line":271,"column":92}},{"start":{"line":271,"column":96},"end":{"line":271,"column":130}}],"line":271},"94":{"loc":{"start":{"line":271,"column":142},"end":{"line":271,"column":336}},"type":"cond-expr","locations":[{"start":{"line":271,"column":283},"end":{"line":271,"column":289}},{"start":{"line":271,"column":292},"end":{"line":271,"column":336}}],"line":271},"95":{"loc":{"start":{"line":271,"column":142},"end":{"line":271,"column":280}},"type":"binary-expr","locations":[{"start":{"line":271,"column":142},"end":{"line":271,"column":230}},{"start":{"line":271,"column":234},"end":{"line":271,"column":280}}],"line":271},"96":{"loc":{"start":{"line":272,"column":36},"end":{"line":272,"column":545}},"type":"binary-expr","locations":[{"start":{"line":272,"column":37},"end":{"line":272,"column":538}},{"start":{"line":272,"column":543},"end":{"line":272,"column":545}}],"line":272},"97":{"loc":{"start":{"line":272,"column":37},"end":{"line":272,"column":538}},"type":"cond-expr","locations":[{"start":{"line":272,"column":136},"end":{"line":272,"column":142}},{"start":{"line":272,"column":145},"end":{"line":272,"column":538}}],"line":272},"98":{"loc":{"start":{"line":272,"column":37},"end":{"line":272,"column":133}},"type":"binary-expr","locations":[{"start":{"line":272,"column":37},"end":{"line":272,"column":95}},{"start":{"line":272,"column":99},"end":{"line":272,"column":133}}],"line":272},"99":{"loc":{"start":{"line":272,"column":145},"end":{"line":272,"column":538}},"type":"cond-expr","locations":[{"start":{"line":272,"column":286},"end":{"line":272,"column":292}},{"start":{"line":272,"column":295},"end":{"line":272,"column":538}}],"line":272},"100":{"loc":{"start":{"line":272,"column":145},"end":{"line":272,"column":283}},"type":"binary-expr","locations":[{"start":{"line":272,"column":145},"end":{"line":272,"column":233}},{"start":{"line":272,"column":237},"end":{"line":272,"column":283}}],"line":272},"101":{"loc":{"start":{"line":272,"column":295},"end":{"line":272,"column":538}},"type":"cond-expr","locations":[{"start":{"line":272,"column":473},"end":{"line":272,"column":479}},{"start":{"line":272,"column":482},"end":{"line":272,"column":538}}],"line":272},"102":{"loc":{"start":{"line":272,"column":295},"end":{"line":272,"column":470}},"type":"binary-expr","locations":[{"start":{"line":272,"column":295},"end":{"line":272,"column":408}},{"start":{"line":272,"column":412},"end":{"line":272,"column":470}}],"line":272},"103":{"loc":{"start":{"line":274,"column":32},"end":{"line":274,"column":863}},"type":"cond-expr","locations":[{"start":{"line":274,"column":347},"end":{"line":274,"column":851}},{"start":{"line":274,"column":854},"end":{"line":274,"column":863}}],"line":274},"104":{"loc":{"start":{"line":274,"column":34},"end":{"line":274,"column":343}},"type":"cond-expr","locations":[{"start":{"line":274,"column":133},"end":{"line":274,"column":139}},{"start":{"line":274,"column":142},"end":{"line":274,"column":343}}],"line":274},"105":{"loc":{"start":{"line":274,"column":34},"end":{"line":274,"column":130}},"type":"binary-expr","locations":[{"start":{"line":274,"column":34},"end":{"line":274,"column":92}},{"start":{"line":274,"column":96},"end":{"line":274,"column":130}}],"line":274},"106":{"loc":{"start":{"line":274,"column":142},"end":{"line":274,"column":343}},"type":"cond-expr","locations":[{"start":{"line":274,"column":283},"end":{"line":274,"column":289}},{"start":{"line":274,"column":292},"end":{"line":274,"column":343}}],"line":274},"107":{"loc":{"start":{"line":274,"column":142},"end":{"line":274,"column":280}},"type":"binary-expr","locations":[{"start":{"line":274,"column":142},"end":{"line":274,"column":230}},{"start":{"line":274,"column":234},"end":{"line":274,"column":280}}],"line":274},"108":{"loc":{"start":{"line":274,"column":347},"end":{"line":274,"column":851}},"type":"cond-expr","locations":[{"start":{"line":274,"column":446},"end":{"line":274,"column":452}},{"start":{"line":274,"column":455},"end":{"line":274,"column":851}}],"line":274},"109":{"loc":{"start":{"line":274,"column":347},"end":{"line":274,"column":443}},"type":"binary-expr","locations":[{"start":{"line":274,"column":347},"end":{"line":274,"column":405}},{"start":{"line":274,"column":409},"end":{"line":274,"column":443}}],"line":274},"110":{"loc":{"start":{"line":274,"column":455},"end":{"line":274,"column":851}},"type":"cond-expr","locations":[{"start":{"line":274,"column":596},"end":{"line":274,"column":602}},{"start":{"line":274,"column":605},"end":{"line":274,"column":851}}],"line":274},"111":{"loc":{"start":{"line":274,"column":455},"end":{"line":274,"column":593}},"type":"binary-expr","locations":[{"start":{"line":274,"column":455},"end":{"line":274,"column":543}},{"start":{"line":274,"column":547},"end":{"line":274,"column":593}}],"line":274},"112":{"loc":{"start":{"line":274,"column":605},"end":{"line":274,"column":851}},"type":"cond-expr","locations":[{"start":{"line":274,"column":785},"end":{"line":274,"column":791}},{"start":{"line":274,"column":794},"end":{"line":274,"column":851}}],"line":274},"113":{"loc":{"start":{"line":274,"column":605},"end":{"line":274,"column":782}},"type":"binary-expr","locations":[{"start":{"line":274,"column":605},"end":{"line":274,"column":719}},{"start":{"line":274,"column":723},"end":{"line":274,"column":782}}],"line":274},"114":{"loc":{"start":{"line":276,"column":32},"end":{"line":276,"column":536}},"type":"cond-expr","locations":[{"start":{"line":276,"column":131},"end":{"line":276,"column":137}},{"start":{"line":276,"column":140},"end":{"line":276,"column":536}}],"line":276},"115":{"loc":{"start":{"line":276,"column":32},"end":{"line":276,"column":128}},"type":"binary-expr","locations":[{"start":{"line":276,"column":32},"end":{"line":276,"column":90}},{"start":{"line":276,"column":94},"end":{"line":276,"column":128}}],"line":276},"116":{"loc":{"start":{"line":276,"column":140},"end":{"line":276,"column":536}},"type":"cond-expr","locations":[{"start":{"line":276,"column":281},"end":{"line":276,"column":287}},{"start":{"line":276,"column":290},"end":{"line":276,"column":536}}],"line":276},"117":{"loc":{"start":{"line":276,"column":140},"end":{"line":276,"column":278}},"type":"binary-expr","locations":[{"start":{"line":276,"column":140},"end":{"line":276,"column":228}},{"start":{"line":276,"column":232},"end":{"line":276,"column":278}}],"line":276},"118":{"loc":{"start":{"line":276,"column":290},"end":{"line":276,"column":536}},"type":"cond-expr","locations":[{"start":{"line":276,"column":470},"end":{"line":276,"column":476}},{"start":{"line":276,"column":479},"end":{"line":276,"column":536}}],"line":276},"119":{"loc":{"start":{"line":276,"column":290},"end":{"line":276,"column":467}},"type":"binary-expr","locations":[{"start":{"line":276,"column":290},"end":{"line":276,"column":404}},{"start":{"line":276,"column":408},"end":{"line":276,"column":467}}],"line":276},"120":{"loc":{"start":{"line":288,"column":38},"end":{"line":288,"column":245}},"type":"binary-expr","locations":[{"start":{"line":288,"column":39},"end":{"line":288,"column":238}},{"start":{"line":288,"column":243},"end":{"line":288,"column":245}}],"line":288},"121":{"loc":{"start":{"line":288,"column":39},"end":{"line":288,"column":238}},"type":"cond-expr","locations":[{"start":{"line":288,"column":179},"end":{"line":288,"column":185}},{"start":{"line":288,"column":188},"end":{"line":288,"column":238}}],"line":288},"122":{"loc":{"start":{"line":288,"column":39},"end":{"line":288,"column":176}},"type":"binary-expr","locations":[{"start":{"line":288,"column":39},"end":{"line":288,"column":126}},{"start":{"line":288,"column":130},"end":{"line":288,"column":176}}],"line":288},"123":{"loc":{"start":{"line":289,"column":27},"end":{"line":289,"column":219}},"type":"cond-expr","locations":[{"start":{"line":289,"column":169},"end":{"line":289,"column":175}},{"start":{"line":289,"column":178},"end":{"line":289,"column":219}}],"line":289},"124":{"loc":{"start":{"line":289,"column":27},"end":{"line":289,"column":166}},"type":"binary-expr","locations":[{"start":{"line":289,"column":27},"end":{"line":289,"column":115}},{"start":{"line":289,"column":119},"end":{"line":289,"column":166}}],"line":289},"125":{"loc":{"start":{"line":290,"column":24},"end":{"line":290,"column":213}},"type":"cond-expr","locations":[{"start":{"line":290,"column":161},"end":{"line":290,"column":167}},{"start":{"line":290,"column":170},"end":{"line":290,"column":213}}],"line":290},"126":{"loc":{"start":{"line":290,"column":24},"end":{"line":290,"column":158}},"type":"binary-expr","locations":[{"start":{"line":290,"column":24},"end":{"line":290,"column":109}},{"start":{"line":290,"column":113},"end":{"line":290,"column":158}}],"line":290},"127":{"loc":{"start":{"line":295,"column":8},"end":{"line":297,"column":9}},"type":"if","locations":[{"start":{"line":295,"column":8},"end":{"line":297,"column":9}},{"start":{"line":295,"column":8},"end":{"line":297,"column":9}}],"line":295},"128":{"loc":{"start":{"line":298,"column":8},"end":{"line":300,"column":9}},"type":"if","locations":[{"start":{"line":298,"column":8},"end":{"line":300,"column":9}},{"start":{"line":298,"column":8},"end":{"line":300,"column":9}}],"line":298},"129":{"loc":{"start":{"line":298,"column":14},"end":{"line":298,"column":171}},"type":"cond-expr","locations":[{"start":{"line":298,"column":126},"end":{"line":298,"column":132}},{"start":{"line":298,"column":135},"end":{"line":298,"column":171}}],"line":298},"130":{"loc":{"start":{"line":298,"column":14},"end":{"line":298,"column":123}},"type":"binary-expr","locations":[{"start":{"line":298,"column":14},"end":{"line":298,"column":81}},{"start":{"line":298,"column":85},"end":{"line":298,"column":123}}],"line":298},"131":{"loc":{"start":{"line":301,"column":8},"end":{"line":303,"column":9}},"type":"if","locations":[{"start":{"line":301,"column":8},"end":{"line":303,"column":9}},{"start":{"line":301,"column":8},"end":{"line":303,"column":9}}],"line":301},"132":{"loc":{"start":{"line":301,"column":14},"end":{"line":301,"column":170}},"type":"cond-expr","locations":[{"start":{"line":301,"column":128},"end":{"line":301,"column":134}},{"start":{"line":301,"column":137},"end":{"line":301,"column":170}}],"line":301},"133":{"loc":{"start":{"line":301,"column":14},"end":{"line":301,"column":125}},"type":"binary-expr","locations":[{"start":{"line":301,"column":14},"end":{"line":301,"column":82}},{"start":{"line":301,"column":86},"end":{"line":301,"column":125}}],"line":301},"134":{"loc":{"start":{"line":304,"column":43},"end":{"line":304,"column":339}},"type":"cond-expr","locations":[{"start":{"line":304,"column":140},"end":{"line":304,"column":146}},{"start":{"line":304,"column":149},"end":{"line":304,"column":339}}],"line":304},"135":{"loc":{"start":{"line":304,"column":43},"end":{"line":304,"column":137}},"type":"binary-expr","locations":[{"start":{"line":304,"column":43},"end":{"line":304,"column":100}},{"start":{"line":304,"column":104},"end":{"line":304,"column":137}}],"line":304},"136":{"loc":{"start":{"line":304,"column":149},"end":{"line":304,"column":339}},"type":"cond-expr","locations":[{"start":{"line":304,"column":287},"end":{"line":304,"column":293}},{"start":{"line":304,"column":296},"end":{"line":304,"column":339}}],"line":304},"137":{"loc":{"start":{"line":304,"column":149},"end":{"line":304,"column":284}},"type":"binary-expr","locations":[{"start":{"line":304,"column":149},"end":{"line":304,"column":235}},{"start":{"line":304,"column":239},"end":{"line":304,"column":284}}],"line":304},"138":{"loc":{"start":{"line":316,"column":15},"end":{"line":324,"column":13}},"type":"cond-expr","locations":[{"start":{"line":316,"column":35},"end":{"line":322,"column":13}},{"start":{"line":322,"column":16},"end":{"line":324,"column":13}}],"line":316},"139":{"loc":{"start":{"line":318,"column":33},"end":{"line":318,"column":343}},"type":"binary-expr","locations":[{"start":{"line":318,"column":34},"end":{"line":318,"column":336}},{"start":{"line":318,"column":341},"end":{"line":318,"column":343}}],"line":318},"140":{"loc":{"start":{"line":318,"column":34},"end":{"line":318,"column":336}},"type":"cond-expr","locations":[{"start":{"line":318,"column":133},"end":{"line":318,"column":139}},{"start":{"line":318,"column":142},"end":{"line":318,"column":336}}],"line":318},"141":{"loc":{"start":{"line":318,"column":34},"end":{"line":318,"column":130}},"type":"binary-expr","locations":[{"start":{"line":318,"column":34},"end":{"line":318,"column":92}},{"start":{"line":318,"column":96},"end":{"line":318,"column":130}}],"line":318},"142":{"loc":{"start":{"line":318,"column":142},"end":{"line":318,"column":336}},"type":"cond-expr","locations":[{"start":{"line":318,"column":283},"end":{"line":318,"column":289}},{"start":{"line":318,"column":292},"end":{"line":318,"column":336}}],"line":318},"143":{"loc":{"start":{"line":318,"column":142},"end":{"line":318,"column":280}},"type":"binary-expr","locations":[{"start":{"line":318,"column":142},"end":{"line":318,"column":230}},{"start":{"line":318,"column":234},"end":{"line":318,"column":280}}],"line":318},"144":{"loc":{"start":{"line":319,"column":36},"end":{"line":319,"column":545}},"type":"binary-expr","locations":[{"start":{"line":319,"column":37},"end":{"line":319,"column":538}},{"start":{"line":319,"column":543},"end":{"line":319,"column":545}}],"line":319},"145":{"loc":{"start":{"line":319,"column":37},"end":{"line":319,"column":538}},"type":"cond-expr","locations":[{"start":{"line":319,"column":136},"end":{"line":319,"column":142}},{"start":{"line":319,"column":145},"end":{"line":319,"column":538}}],"line":319},"146":{"loc":{"start":{"line":319,"column":37},"end":{"line":319,"column":133}},"type":"binary-expr","locations":[{"start":{"line":319,"column":37},"end":{"line":319,"column":95}},{"start":{"line":319,"column":99},"end":{"line":319,"column":133}}],"line":319},"147":{"loc":{"start":{"line":319,"column":145},"end":{"line":319,"column":538}},"type":"cond-expr","locations":[{"start":{"line":319,"column":286},"end":{"line":319,"column":292}},{"start":{"line":319,"column":295},"end":{"line":319,"column":538}}],"line":319},"148":{"loc":{"start":{"line":319,"column":145},"end":{"line":319,"column":283}},"type":"binary-expr","locations":[{"start":{"line":319,"column":145},"end":{"line":319,"column":233}},{"start":{"line":319,"column":237},"end":{"line":319,"column":283}}],"line":319},"149":{"loc":{"start":{"line":319,"column":295},"end":{"line":319,"column":538}},"type":"cond-expr","locations":[{"start":{"line":319,"column":473},"end":{"line":319,"column":479}},{"start":{"line":319,"column":482},"end":{"line":319,"column":538}}],"line":319},"150":{"loc":{"start":{"line":319,"column":295},"end":{"line":319,"column":470}},"type":"binary-expr","locations":[{"start":{"line":319,"column":295},"end":{"line":319,"column":408}},{"start":{"line":319,"column":412},"end":{"line":319,"column":470}}],"line":319},"151":{"loc":{"start":{"line":321,"column":32},"end":{"line":321,"column":863}},"type":"cond-expr","locations":[{"start":{"line":321,"column":347},"end":{"line":321,"column":851}},{"start":{"line":321,"column":854},"end":{"line":321,"column":863}}],"line":321},"152":{"loc":{"start":{"line":321,"column":34},"end":{"line":321,"column":343}},"type":"cond-expr","locations":[{"start":{"line":321,"column":133},"end":{"line":321,"column":139}},{"start":{"line":321,"column":142},"end":{"line":321,"column":343}}],"line":321},"153":{"loc":{"start":{"line":321,"column":34},"end":{"line":321,"column":130}},"type":"binary-expr","locations":[{"start":{"line":321,"column":34},"end":{"line":321,"column":92}},{"start":{"line":321,"column":96},"end":{"line":321,"column":130}}],"line":321},"154":{"loc":{"start":{"line":321,"column":142},"end":{"line":321,"column":343}},"type":"cond-expr","locations":[{"start":{"line":321,"column":283},"end":{"line":321,"column":289}},{"start":{"line":321,"column":292},"end":{"line":321,"column":343}}],"line":321},"155":{"loc":{"start":{"line":321,"column":142},"end":{"line":321,"column":280}},"type":"binary-expr","locations":[{"start":{"line":321,"column":142},"end":{"line":321,"column":230}},{"start":{"line":321,"column":234},"end":{"line":321,"column":280}}],"line":321},"156":{"loc":{"start":{"line":321,"column":347},"end":{"line":321,"column":851}},"type":"cond-expr","locations":[{"start":{"line":321,"column":446},"end":{"line":321,"column":452}},{"start":{"line":321,"column":455},"end":{"line":321,"column":851}}],"line":321},"157":{"loc":{"start":{"line":321,"column":347},"end":{"line":321,"column":443}},"type":"binary-expr","locations":[{"start":{"line":321,"column":347},"end":{"line":321,"column":405}},{"start":{"line":321,"column":409},"end":{"line":321,"column":443}}],"line":321},"158":{"loc":{"start":{"line":321,"column":455},"end":{"line":321,"column":851}},"type":"cond-expr","locations":[{"start":{"line":321,"column":596},"end":{"line":321,"column":602}},{"start":{"line":321,"column":605},"end":{"line":321,"column":851}}],"line":321},"159":{"loc":{"start":{"line":321,"column":455},"end":{"line":321,"column":593}},"type":"binary-expr","locations":[{"start":{"line":321,"column":455},"end":{"line":321,"column":543}},{"start":{"line":321,"column":547},"end":{"line":321,"column":593}}],"line":321},"160":{"loc":{"start":{"line":321,"column":605},"end":{"line":321,"column":851}},"type":"cond-expr","locations":[{"start":{"line":321,"column":785},"end":{"line":321,"column":791}},{"start":{"line":321,"column":794},"end":{"line":321,"column":851}}],"line":321},"161":{"loc":{"start":{"line":321,"column":605},"end":{"line":321,"column":782}},"type":"binary-expr","locations":[{"start":{"line":321,"column":605},"end":{"line":321,"column":719}},{"start":{"line":321,"column":723},"end":{"line":321,"column":782}}],"line":321},"162":{"loc":{"start":{"line":323,"column":32},"end":{"line":323,"column":536}},"type":"cond-expr","locations":[{"start":{"line":323,"column":131},"end":{"line":323,"column":137}},{"start":{"line":323,"column":140},"end":{"line":323,"column":536}}],"line":323},"163":{"loc":{"start":{"line":323,"column":32},"end":{"line":323,"column":128}},"type":"binary-expr","locations":[{"start":{"line":323,"column":32},"end":{"line":323,"column":90}},{"start":{"line":323,"column":94},"end":{"line":323,"column":128}}],"line":323},"164":{"loc":{"start":{"line":323,"column":140},"end":{"line":323,"column":536}},"type":"cond-expr","locations":[{"start":{"line":323,"column":281},"end":{"line":323,"column":287}},{"start":{"line":323,"column":290},"end":{"line":323,"column":536}}],"line":323},"165":{"loc":{"start":{"line":323,"column":140},"end":{"line":323,"column":278}},"type":"binary-expr","locations":[{"start":{"line":323,"column":140},"end":{"line":323,"column":228}},{"start":{"line":323,"column":232},"end":{"line":323,"column":278}}],"line":323},"166":{"loc":{"start":{"line":323,"column":290},"end":{"line":323,"column":536}},"type":"cond-expr","locations":[{"start":{"line":323,"column":470},"end":{"line":323,"column":476}},{"start":{"line":323,"column":479},"end":{"line":323,"column":536}}],"line":323},"167":{"loc":{"start":{"line":323,"column":290},"end":{"line":323,"column":467}},"type":"binary-expr","locations":[{"start":{"line":323,"column":290},"end":{"line":323,"column":404}},{"start":{"line":323,"column":408},"end":{"line":323,"column":467}}],"line":323},"168":{"loc":{"start":{"line":333,"column":64},"end":{"line":333,"column":202}},"type":"cond-expr","locations":[{"start":{"line":333,"column":161},"end":{"line":333,"column":167}},{"start":{"line":333,"column":170},"end":{"line":333,"column":202}}],"line":333},"169":{"loc":{"start":{"line":333,"column":64},"end":{"line":333,"column":158}},"type":"binary-expr","locations":[{"start":{"line":333,"column":64},"end":{"line":333,"column":121}},{"start":{"line":333,"column":125},"end":{"line":333,"column":158}}],"line":333},"170":{"loc":{"start":{"line":343,"column":82},"end":{"line":343,"column":215}},"type":"cond-expr","locations":[{"start":{"line":343,"column":179},"end":{"line":343,"column":185}},{"start":{"line":343,"column":188},"end":{"line":343,"column":215}}],"line":343},"171":{"loc":{"start":{"line":343,"column":82},"end":{"line":343,"column":176}},"type":"binary-expr","locations":[{"start":{"line":343,"column":82},"end":{"line":343,"column":139}},{"start":{"line":343,"column":143},"end":{"line":343,"column":176}}],"line":343},"172":{"loc":{"start":{"line":353,"column":23},"end":{"line":353,"column":157}},"type":"cond-expr","locations":[{"start":{"line":353,"column":120},"end":{"line":353,"column":126}},{"start":{"line":353,"column":129},"end":{"line":353,"column":157}}],"line":353},"173":{"loc":{"start":{"line":353,"column":23},"end":{"line":353,"column":117}},"type":"binary-expr","locations":[{"start":{"line":353,"column":23},"end":{"line":353,"column":80}},{"start":{"line":353,"column":84},"end":{"line":353,"column":117}}],"line":353},"174":{"loc":{"start":{"line":372,"column":66},"end":{"line":372,"column":200}},"type":"cond-expr","locations":[{"start":{"line":372,"column":163},"end":{"line":372,"column":169}},{"start":{"line":372,"column":172},"end":{"line":372,"column":200}}],"line":372},"175":{"loc":{"start":{"line":372,"column":66},"end":{"line":372,"column":160}},"type":"binary-expr","locations":[{"start":{"line":372,"column":66},"end":{"line":372,"column":123}},{"start":{"line":372,"column":127},"end":{"line":372,"column":160}}],"line":372},"176":{"loc":{"start":{"line":372,"column":202},"end":{"line":372,"column":364}},"type":"binary-expr","locations":[{"start":{"line":372,"column":203},"end":{"line":372,"column":357}},{"start":{"line":372,"column":362},"end":{"line":372,"column":364}}],"line":372},"177":{"loc":{"start":{"line":372,"column":203},"end":{"line":372,"column":357}},"type":"cond-expr","locations":[{"start":{"line":372,"column":315},"end":{"line":372,"column":321}},{"start":{"line":372,"column":324},"end":{"line":372,"column":357}}],"line":372},"178":{"loc":{"start":{"line":372,"column":203},"end":{"line":372,"column":312}},"type":"binary-expr","locations":[{"start":{"line":372,"column":203},"end":{"line":372,"column":270}},{"start":{"line":372,"column":274},"end":{"line":372,"column":312}}],"line":372}},"s":{"0":2,"1":2,"2":14,"3":2,"4":90,"5":4,"6":4,"7":17,"8":8,"9":3,"10":33,"11":2,"12":2,"13":2,"14":2,"15":2,"16":2,"17":2,"18":2,"19":2,"20":121,"21":2,"22":57,"23":2,"24":11,"25":2,"26":3,"27":2,"28":23,"29":23,"30":2,"31":91,"32":91,"33":91,"34":2,"35":19,"36":19,"37":2,"38":12,"39":1,"40":11,"41":11,"42":2,"43":27,"44":18,"45":9,"46":9,"47":9,"48":2,"49":27,"50":18,"51":9,"52":13,"53":9,"54":2,"55":21,"56":21,"57":15,"58":6,"59":2,"60":4,"61":1,"62":3,"63":2,"64":9,"65":2,"66":13,"67":9,"68":3,"69":3,"70":3,"71":2,"72":13,"73":9,"74":9,"75":9,"76":9,"77":9,"78":9,"79":9,"80":9,"81":9,"82":9,"83":2,"84":2,"85":7,"86":1,"87":6,"88":3,"89":3,"90":3,"91":3,"92":13,"93":2,"94":3,"95":3,"96":3,"97":2,"98":2,"99":1,"100":2,"101":4,"102":1,"103":3,"104":2,"105":8,"106":19,"107":14,"108":14,"109":6,"110":15,"111":1,"112":14,"113":1,"114":13,"115":1,"116":12,"117":12,"118":5,"119":4,"120":3,"121":3,"122":13},"f":{"0":2,"1":90,"2":4,"3":4,"4":17,"5":8,"6":3,"7":33,"8":121,"9":57,"10":11,"11":3,"12":23,"13":91,"14":19,"15":12,"16":27,"17":9,"18":27,"19":13,"20":21,"21":9,"22":13,"23":9,"24":3,"25":13,"26":9,"27":3,"28":3,"29":2,"30":4,"31":8,"32":19,"33":14,"34":6,"35":15,"36":5,"37":4,"38":3,"39":3,"40":13},"b":{"0":[49],"1":[22],"2":[0,57],"3":[57,57],"4":[3,1],"5":[0],"6":[13,10],"7":[45],"8":[0,91],"9":[91,91],"10":[10],"11":[18,1],"12":[5],"13":[1,11],"14":[11,2],"15":[18],"16":[18,9],"17":[5,4],"18":[9,9],"19":[0,4],"20":[4,4],"21":[4,5],"22":[18],"23":[23],"24":[18,9],"25":[2,7],"26":[9,9],"27":[0,7],"28":[7,7],"29":[7,2],"30":[15,6],"31":[2,4],"32":[1,3],"33":[4,2],"34":[1,2],"35":[2],"36":[0],"37":[2,7],"38":[1,1],"39":[1,6],"40":[3,3],"41":[3,0],"42":[2,1],"43":[2,1],"44":[0],"45":[0,3],"46":[3,3],"47":[1,2],"48":[3,3],"49":[2,1],"50":[1,3],"51":[4,2],"52":[1,1],"53":[2,2],"54":[3,1,0],"55":[0,1],"56":[1,1],"57":[8,7],"58":[5,2],"59":[7,7],"60":[8,7],"61":[5,2],"62":[7,7],"63":[8,6],"64":[6,2],"65":[8,8],"66":[6,2],"67":[8,8],"68":[19,16],"69":[13,3],"70":[16,16],"71":[19,16],"72":[13,3],"73":[16,16],"74":[11,8],"75":[19,19],"76":[11,8],"77":[19,19],"78":[11,8],"79":[19,19],"80":[11,8],"81":[19,19],"82":[4,15],"83":[11,8],"84":[19,19],"85":[0,14],"86":[14,14],"87":[4,10],"88":[14,14],"89":[14,8],"90":[6,8],"91":[6,4],"92":[0,6],"93":[6,6],"94":[0,6],"95":[6,6],"96":[6,4],"97":[0,6],"98":[6,6],"99":[0,6],"100":[6,6],"101":[4,2],"102":[6,6],"103":[5,1],"104":[0,6],"105":[6,6],"106":[0,6],"107":[6,6],"108":[0,5],"109":[5,5],"110":[0,5],"111":[5,5],"112":[4,1],"113":[5,5],"114":[0,8],"115":[8,8],"116":[4,4],"117":[8,8],"118":[0,4],"119":[4,4],"120":[6,2],"121":[0,6],"122":[6,6],"123":[0,6],"124":[6,6],"125":[0,6],"126":[6,6],"127":[1,14],"128":[1,13],"129":[1,13],"130":[14,14],"131":[1,12],"132":[0,13],"133":[13,13],"134":[0,12],"135":[12,12],"136":[4,8],"137":[12,12],"138":[6,6],"139":[6,4],"140":[0,6],"141":[6,6],"142":[0,6],"143":[6,6],"144":[6,4],"145":[0,6],"146":[6,6],"147":[0,6],"148":[6,6],"149":[4,2],"150":[6,6],"151":[5,1],"152":[0,6],"153":[6,6],"154":[0,6],"155":[6,6],"156":[0,5],"157":[5,5],"158":[0,5],"159":[5,5],"160":[4,1],"161":[5,5],"162":[0,6],"163":[6,6],"164":[4,2],"165":[6,6],"166":[0,2],"167":[2,2],"168":[2,3],"169":[5,5],"170":[2,2],"171":[4,4],"172":[2,1],"173":[3,3],"174":[2,11],"175":[13,13],"176":[13,2],"177":[2,11],"178":[13,13]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/RoomReceiver.ts"],"sourcesContent":["import { RoomType } from '@rocket.chat/apps-engine/definition/rooms';\n\nimport {\n\tFederationRoomChangeJoinRulesDto,\n\tFederationRoomChangeMembershipDto,\n\tFederationRoomChangeNameDto,\n\tFederationRoomChangeTopicDto,\n\tFederationRoomCreateInputDto,\n\tFederationRoomEditExternalMessageDto,\n\tFederationRoomReceiveExternalFileMessageDto,\n\tFederationRoomReceiveExternalMessageDto,\n\tFederationRoomRedactEventDto,\n\tFederationRoomRoomChangePowerLevelsEventDto,\n} from '../../../../application/room/input/RoomReceiverDto';\nimport type { IExternalRolesChangesToApplyInputDto } from '../../../../application/room/input/RoomReceiverDto';\nimport { EVENT_ORIGIN } from '../../../../domain/IFederationBridge';\nimport { ROCKET_CHAT_FEDERATION_ROLES } from '../../../rocket-chat/definitions/FederatedRoomInternalRoles';\nimport type { AbstractMatrixEvent } from '../../definitions/AbstractMatrixEvent';\nimport { MatrixEventType } from '../../definitions/MatrixEventType';\nimport { MATRIX_POWER_LEVELS } from '../../definitions/MatrixPowerLevels';\nimport { MatrixRoomJoinRules } from '../../definitions/MatrixRoomJoinRules';\nimport type { MatrixEventRoomCreated } from '../../definitions/events/RoomCreated';\nimport type { MatrixEventRoomRedacted } from '../../definitions/events/RoomEventRedacted';\nimport type { MatrixEventRoomJoinRulesChanged } from '../../definitions/events/RoomJoinRulesChanged';\nimport type { MatrixEventRoomMembershipChanged } from '../../definitions/events/RoomMembershipChanged';\nimport { RoomMembershipChangedEventType } from '../../definitions/events/RoomMembershipChanged';\nimport type { MatrixEventRoomMessageSent } from '../../definitions/events/RoomMessageSent';\nimport type { MatrixEventRoomNameChanged } from '../../definitions/events/RoomNameChanged';\nimport type {\n\tIMatrixEventContentRoomPowerLevelsChanged,\n\tMatrixEventRoomRoomPowerLevelsChanged,\n} from '../../definitions/events/RoomPowerLevelsChanged';\nimport type { MatrixEventRoomTopicChanged } from '../../definitions/events/RoomTopicChanged';\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const removeExternalSpecificCharsFromExternalIdentifier = (matrixIdentifier = ''): string => {\n\treturn matrixIdentifier.replace('@', '').replace('!', '').replace('#', '');\n};\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const formatExternalUserIdToInternalUsernameFormat = (matrixUserId = ''): string => {\n\treturn matrixUserId.split(':')[0]?.replace('@', '');\n};\n\nexport const isAnExternalIdentifierFormat = (identifier: string): boolean => identifier.includes(':');\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const isAnExternalUserIdFormat = (userId: string): boolean => isAnExternalIdentifierFormat(userId) && userId.includes('@');\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const extractServerNameFromExternalIdentifier = (identifier = ''): string => {\n\tconst splitted = identifier.split(':');\n\n\treturn splitted.length > 1 ? splitted[1] : '';\n};\n\nexport const convertExternalRoomIdToInternalRoomIdFormat = (matrixRoomId = ''): string => {\n\tconst prefixedRoomIdOnly = matrixRoomId.split(':')[0];\n\tconst prefix = '!';\n\n\treturn prefixedRoomIdOnly?.replace(prefix, '');\n};\n\nconst getEventOrigin = (inviterId = '', homeServerDomain: string): EVENT_ORIGIN => {\n\tconst fromADifferentServer = extractServerNameFromExternalIdentifier(inviterId) !== homeServerDomain;\n\n\treturn fromADifferentServer ? EVENT_ORIGIN.REMOTE : EVENT_ORIGIN.LOCAL;\n};\n\nconst convertExternalJoinRuleToInternalRoomType = (matrixJoinRule: MatrixRoomJoinRules, matrixRoomIsDirect = false): RoomType => {\n\tif (matrixRoomIsDirect) {\n\t\treturn RoomType.DIRECT_MESSAGE;\n\t}\n\tconst mapping: Record<string, RoomType> = {\n\t\t[MatrixRoomJoinRules.JOIN]: RoomType.CHANNEL,\n\t\t[MatrixRoomJoinRules.INVITE]: RoomType.PRIVATE_GROUP,\n\t};\n\n\treturn mapping[matrixJoinRule] || RoomType.CHANNEL;\n};\n\nconst tryToExtractExternalRoomNameFromTheRoomState = (roomState: AbstractMatrixEvent[] = []): { externalRoomName?: string } => {\n\tif (roomState.length === 0) {\n\t\treturn {};\n\t}\n\tconst externalRoomName = (\n\t\troomState.find((stateEvent) => stateEvent.type === MatrixEventType.ROOM_NAME_CHANGED) as MatrixEventRoomNameChanged\n\t)?.content?.name;\n\n\treturn {\n\t\t...(externalRoomName ? { externalRoomName: removeExternalSpecificCharsFromExternalIdentifier(externalRoomName) } : {}),\n\t};\n};\n\nconst tryToExtractAndConvertRoomTypeFromTheRoomState = (\n\troomState: AbstractMatrixEvent[] = [],\n\tmatrixRoomIsDirect = false,\n): { roomType?: RoomType } => {\n\tif (roomState.length === 0) {\n\t\treturn {};\n\t}\n\tconst externalRoomJoinRule = (\n\t\troomState.find((stateEvent) => stateEvent.type === MatrixEventType.ROOM_JOIN_RULES_CHANGED) as MatrixEventRoomJoinRulesChanged\n\t)?.content?.join_rule;\n\n\treturn {\n\t\t...(externalRoomJoinRule ? { roomType: convertExternalJoinRuleToInternalRoomType(externalRoomJoinRule, matrixRoomIsDirect) } : {}),\n\t};\n};\n\nconst convertNumericalPowerLevelToInternalRole = (powerLevel: number): ROCKET_CHAT_FEDERATION_ROLES | undefined => {\n\tconst mapping: Record<number, ROCKET_CHAT_FEDERATION_ROLES | undefined> = {\n\t\t[MATRIX_POWER_LEVELS.USER]: undefined,\n\t\t[MATRIX_POWER_LEVELS.MODERATOR]: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR,\n\t\t[MATRIX_POWER_LEVELS.ADMIN]: ROCKET_CHAT_FEDERATION_ROLES.OWNER,\n\t};\n\n\tif (mapping[powerLevel]) {\n\t\treturn mapping[powerLevel];\n\t}\n\n\tif (powerLevel <= MATRIX_POWER_LEVELS.USER) {\n\t\treturn;\n\t}\n\tif (powerLevel > MATRIX_POWER_LEVELS.USER && powerLevel <= MATRIX_POWER_LEVELS.MODERATOR) {\n\t\treturn ROCKET_CHAT_FEDERATION_ROLES.MODERATOR;\n\t}\n\treturn ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n};\n\nconst onlyRolesAddedToDefaultUsers = (previousRolesState: { [key: string]: number }, externalUserId: string): boolean =>\n\t!previousRolesState[externalUserId];\n\nconst verifyIfNewRolesWereAddedForDefaultUsers = (\n\tcurrentRolesState: { [key: string]: number },\n\tpreviousRolesState: { [key: string]: number },\n\tchangesAlreadyMadeToRoles: IExternalRolesChangesToApplyInputDto,\n): IExternalRolesChangesToApplyInputDto =>\n\tObject.keys(currentRolesState)\n\t\t.filter((externalUserId) => onlyRolesAddedToDefaultUsers(previousRolesState, externalUserId))\n\t\t.reduce((externalRolesChangesForDefaultUsers, externalUserId) => {\n\t\t\tconst isCurrentRoleAnOwner =\n\t\t\t\tconvertNumericalPowerLevelToInternalRole(currentRolesState[externalUserId]) === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n\t\t\texternalRolesChangesForDefaultUsers[externalUserId] = isCurrentRoleAnOwner\n\t\t\t\t? [{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER }]\n\t\t\t\t: [{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR }];\n\t\t\treturn externalRolesChangesForDefaultUsers;\n\t\t}, changesAlreadyMadeToRoles);\n\nconst createExternalRolesChangesActions = (\n\tcurrentRolesState: { [key: string]: number } = {},\n\tpreviousRolesState: { [key: string]: number } = {},\n): IExternalRolesChangesToApplyInputDto => {\n\tconst changesInRolesBasedOnPreviousState = Object.keys(previousRolesState).reduce((externalRolesChangesByUser, externalUserId) => {\n\t\tconst currentPowerLevel = currentRolesState[externalUserId];\n\t\tconst previousPowerLevel = previousRolesState[externalUserId];\n\t\tconst convertedPreviousExternalRole = convertNumericalPowerLevelToInternalRole(previousPowerLevel);\n\t\tconst convertedCurrentExternalRole = convertNumericalPowerLevelToInternalRole(currentPowerLevel);\n\t\tconst wasPreviousRoleAnOwner = convertedPreviousExternalRole === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n\t\tconst isCurrentRoleAnOwner = convertedCurrentExternalRole === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n\t\tconst isCurrentRoleADefault = currentPowerLevel === undefined;\n\t\tconst isStillTheSameRole = currentPowerLevel === previousPowerLevel;\n\t\tconst isDowngradingTheRole = currentPowerLevel < previousPowerLevel;\n\t\tif (isCurrentRoleADefault) {\n\t\t\texternalRolesChangesByUser[externalUserId] = wasPreviousRoleAnOwner\n\t\t\t\t? [{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER }]\n\t\t\t\t: [{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR }];\n\t\t\treturn externalRolesChangesByUser;\n\t\t}\n\t\tif (isStillTheSameRole) {\n\t\t\treturn externalRolesChangesByUser;\n\t\t}\n\t\tif (isDowngradingTheRole) {\n\t\t\texternalRolesChangesByUser[externalUserId] = [\n\t\t\t\t...(convertedPreviousExternalRole ? [{ action: 'remove', role: convertedPreviousExternalRole }] : []),\n\t\t\t\t...(convertedCurrentExternalRole ? [{ action: 'add', role: convertedCurrentExternalRole }] : []),\n\t\t\t];\n\t\t\treturn externalRolesChangesByUser;\n\t\t}\n\t\texternalRolesChangesByUser[externalUserId] = isCurrentRoleAnOwner\n\t\t\t? [\n\t\t\t\t\t{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER },\n\t\t\t\t\t{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR },\n\t\t\t\t]\n\t\t\t: [\n\t\t\t\t\t{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR },\n\t\t\t\t\t{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER },\n\t\t\t\t];\n\n\t\treturn externalRolesChangesByUser;\n\t}, {} as IExternalRolesChangesToApplyInputDto);\n\n\treturn verifyIfNewRolesWereAddedForDefaultUsers(currentRolesState, previousRolesState, changesInRolesBasedOnPreviousState);\n};\n\nconst getInviteesFromRoomState = (\n\troomState: AbstractMatrixEvent[] = [],\n): {\n\texternalInviteeId: string;\n\tnormalizedInviteeId: string;\n\tinviteeUsernameOnly: string;\n}[] => {\n\tconst inviteesFromRoomState = (\n\t\troomState?.find((stateEvent) => stateEvent.type === MatrixEventType.ROOM_CREATED) as MatrixEventRoomCreated\n\t)?.content.inviteesExternalIds;\n\tif (inviteesFromRoomState) {\n\t\treturn inviteesFromRoomState.map((inviteeExternalId) => ({\n\t\t\texternalInviteeId: inviteeExternalId,\n\t\t\tnormalizedInviteeId: removeExternalSpecificCharsFromExternalIdentifier(inviteeExternalId),\n\t\t\tinviteeUsernameOnly: formatExternalUserIdToInternalUsernameFormat(inviteeExternalId),\n\t\t}));\n\t}\n\treturn [];\n};\n\nconst extractAllInviteeIdsWhenDM = (\n\texternalEvent: MatrixEventRoomMembershipChanged,\n): {\n\texternalInviteeId: string;\n\tnormalizedInviteeId: string;\n\tinviteeUsernameOnly: string;\n}[] => {\n\tif (!externalEvent.invite_room_state && !externalEvent.unsigned?.invite_room_state) {\n\t\treturn [];\n\t}\n\n\treturn getInviteesFromRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state || []);\n};\n\nexport class MatrixRoomReceiverConverter {\n\tpublic static toRoomCreateDto(externalEvent: MatrixEventRoomCreated): FederationRoomCreateInputDto {\n\t\treturn new FederationRoomCreateInputDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\t...tryToExtractExternalRoomNameFromTheRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state),\n\t\t\t...tryToExtractAndConvertRoomTypeFromTheRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state),\n\t\t\texternalInviterId: externalEvent.sender,\n\t\t\tnormalizedInviterId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\twasInternallyProgramaticallyCreated: externalEvent.content?.was_internally_programatically_created || false,\n\t\t\tinternalRoomId: externalEvent.content?.internalRoomId,\n\t\t});\n\t}\n\n\tpublic static toChangeRoomMembershipDto(\n\t\texternalEvent: MatrixEventRoomMembershipChanged,\n\t\thomeServerDomain: string,\n\t): FederationRoomChangeMembershipDto {\n\t\treturn new FederationRoomChangeMembershipDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\t...tryToExtractExternalRoomNameFromTheRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state),\n\t\t\t...tryToExtractAndConvertRoomTypeFromTheRoomState(\n\t\t\t\texternalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state,\n\t\t\t\texternalEvent.content?.is_direct,\n\t\t\t),\n\t\t\texternalInviterId: externalEvent.sender,\n\t\t\tnormalizedInviterId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\texternalInviteeId: externalEvent.state_key,\n\t\t\tnormalizedInviteeId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.state_key),\n\t\t\tinviteeUsernameOnly: formatExternalUserIdToInternalUsernameFormat(externalEvent.state_key),\n\t\t\tinviterUsernameOnly: formatExternalUserIdToInternalUsernameFormat(externalEvent.sender),\n\t\t\teventOrigin: getEventOrigin(externalEvent.sender, homeServerDomain),\n\t\t\tleave: externalEvent.content?.membership === RoomMembershipChangedEventType.LEAVE,\n\t\t\tuserProfile: {\n\t\t\t\tavatarUrl: externalEvent.content?.avatar_url,\n\t\t\t\tdisplayName: externalEvent.content?.displayname,\n\t\t\t},\n\t\t\t...(externalEvent.content?.is_direct ? { allInviteesExternalIdsWhenDM: extractAllInviteeIdsWhenDM(externalEvent) } : {}),\n\t\t});\n\t}\n\n\tpublic static toSendRoomMessageDto(externalEvent: MatrixEventRoomMessageSent): FederationRoomReceiveExternalMessageDto {\n\t\tconst isThreadedMessage = Boolean(externalEvent.content?.['m.relates_to']?.rel_type === MatrixEventType.MESSAGE_ON_THREAD);\n\n\t\treturn new FederationRoomReceiveExternalMessageDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\texternalFormattedText: externalEvent.content.formatted_body || '',\n\t\t\trawMessage: externalEvent.content.body,\n\t\t\t...(isThreadedMessage\n\t\t\t\t? {\n\t\t\t\t\t\tthread: {\n\t\t\t\t\t\t\trootEventId: externalEvent.content?.['m.relates_to']?.event_id || '',\n\t\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id || '',\n\t\t\t\t\t\t},\n\t\t\t\t\t\treplyToEventId: !externalEvent.content?.['m.relates_to']?.is_falling_back\n\t\t\t\t\t\t\t? externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t}\n\t\t\t\t: {\n\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id,\n\t\t\t\t\t}),\n\t\t});\n\t}\n\n\tpublic static toEditRoomMessageDto(externalEvent: MatrixEventRoomMessageSent): FederationRoomEditExternalMessageDto {\n\t\treturn new FederationRoomEditExternalMessageDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\tnewExternalFormattedText: externalEvent.content['m.new_content']?.formatted_body || '',\n\t\t\tnewRawMessage: externalEvent.content['m.new_content']?.body as string,\n\t\t\teditsEvent: externalEvent.content['m.relates_to']?.event_id as string,\n\t\t});\n\t}\n\n\tpublic static toSendRoomFileMessageDto(externalEvent: MatrixEventRoomMessageSent): FederationRoomReceiveExternalFileMessageDto {\n\t\tif (!externalEvent.content.url) {\n\t\t\tthrow new Error('Missing url in the file message');\n\t\t}\n\t\tif (!externalEvent.content.info?.mimetype) {\n\t\t\tthrow new Error('Missing mimetype in the file message info');\n\t\t}\n\t\tif (!externalEvent.content.info?.size) {\n\t\t\tthrow new Error('Missing size in the file message info');\n\t\t}\n\t\tconst isThreadedMessage = Boolean(externalEvent.content?.['m.relates_to']?.rel_type === MatrixEventType.MESSAGE_ON_THREAD);\n\n\t\treturn new FederationRoomReceiveExternalFileMessageDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\tfilename: externalEvent.content.body,\n\t\t\turl: externalEvent.content.url,\n\t\t\tmimetype: externalEvent.content.info.mimetype,\n\t\t\tsize: externalEvent.content.info.size,\n\t\t\tmessageText: externalEvent.content.body,\n\t\t\t...(isThreadedMessage\n\t\t\t\t? {\n\t\t\t\t\t\tthread: {\n\t\t\t\t\t\t\trootEventId: externalEvent.content?.['m.relates_to']?.event_id || '',\n\t\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id || '',\n\t\t\t\t\t\t},\n\t\t\t\t\t\treplyToEventId: !externalEvent.content?.['m.relates_to']?.is_falling_back\n\t\t\t\t\t\t\t? externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t}\n\t\t\t\t: {\n\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id,\n\t\t\t\t\t}),\n\t\t});\n\t}\n\n\tpublic static toRoomChangeJoinRulesDto(externalEvent: MatrixEventRoomJoinRulesChanged): FederationRoomChangeJoinRulesDto {\n\t\treturn new FederationRoomChangeJoinRulesDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\troomType: convertExternalJoinRuleToInternalRoomType(externalEvent.content?.join_rule),\n\t\t});\n\t}\n\n\tpublic static toRoomChangeNameDto(externalEvent: MatrixEventRoomNameChanged): FederationRoomChangeNameDto {\n\t\treturn new FederationRoomChangeNameDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedRoomName: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.content?.name),\n\t\t});\n\t}\n\n\tpublic static toRoomChangeTopicDto(externalEvent: MatrixEventRoomTopicChanged): FederationRoomChangeTopicDto {\n\t\treturn new FederationRoomChangeTopicDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\troomTopic: externalEvent.content?.topic,\n\t\t});\n\t}\n\n\tpublic static toRoomRedactEventDto(externalEvent: MatrixEventRoomRedacted): FederationRoomRedactEventDto {\n\t\treturn new FederationRoomRedactEventDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tredactsEvent: externalEvent.redacts as string,\n\t\t});\n\t}\n\n\tpublic static toRoomChangePowerLevelsEventDto(\n\t\texternalEvent: MatrixEventRoomRoomPowerLevelsChanged,\n\t): FederationRoomRoomChangePowerLevelsEventDto {\n\t\treturn new FederationRoomRoomChangePowerLevelsEventDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\troleChangesToApply: createExternalRolesChangesActions(\n\t\t\t\texternalEvent.content?.users,\n\t\t\t\t(externalEvent.prev_content as IMatrixEventContentRoomPowerLevelsChanged)?.users || {},\n\t\t\t),\n\t\t});\n\t}\n}\n"],"names":["MatrixRoomReceiverConverter","convertExternalRoomIdToInternalRoomIdFormat","extractServerNameFromExternalIdentifier","formatExternalUserIdToInternalUsernameFormat","isAnExternalIdentifierFormat","isAnExternalUserIdFormat","removeExternalSpecificCharsFromExternalIdentifier","matrixIdentifier","replace","matrixUserId","split","identifier","includes","userId","splitted","length","matrixRoomId","prefixedRoomIdOnly","prefix","getEventOrigin","inviterId","homeServerDomain","fromADifferentServer","EVENT_ORIGIN","REMOTE","LOCAL","convertExternalJoinRuleToInternalRoomType","matrixJoinRule","matrixRoomIsDirect","RoomType","DIRECT_MESSAGE","mapping","MatrixRoomJoinRules","JOIN","CHANNEL","INVITE","PRIVATE_GROUP","tryToExtractExternalRoomNameFromTheRoomState","roomState","externalRoomName","find","stateEvent","type","MatrixEventType","ROOM_NAME_CHANGED","content","name","tryToExtractAndConvertRoomTypeFromTheRoomState","externalRoomJoinRule","ROOM_JOIN_RULES_CHANGED","join_rule","roomType","convertNumericalPowerLevelToInternalRole","powerLevel","MATRIX_POWER_LEVELS","USER","undefined","MODERATOR","ROCKET_CHAT_FEDERATION_ROLES","ADMIN","OWNER","onlyRolesAddedToDefaultUsers","previousRolesState","externalUserId","verifyIfNewRolesWereAddedForDefaultUsers","currentRolesState","changesAlreadyMadeToRoles","Object","keys","filter","reduce","externalRolesChangesForDefaultUsers","isCurrentRoleAnOwner","action","role","createExternalRolesChangesActions","changesInRolesBasedOnPreviousState","externalRolesChangesByUser","currentPowerLevel","previousPowerLevel","convertedPreviousExternalRole","convertedCurrentExternalRole","wasPreviousRoleAnOwner","isCurrentRoleADefault","isStillTheSameRole","isDowngradingTheRole","getInviteesFromRoomState","inviteesFromRoomState","ROOM_CREATED","inviteesExternalIds","map","inviteeExternalId","externalInviteeId","normalizedInviteeId","inviteeUsernameOnly","extractAllInviteeIdsWhenDM","externalEvent","invite_room_state","unsigned","toRoomCreateDto","FederationRoomCreateInputDto","externalEventId","event_id","externalRoomId","room_id","normalizedRoomId","externalInviterId","sender","normalizedInviterId","wasInternallyProgramaticallyCreated","was_internally_programatically_created","internalRoomId","toChangeRoomMembershipDto","FederationRoomChangeMembershipDto","is_direct","state_key","inviterUsernameOnly","eventOrigin","leave","membership","RoomMembershipChangedEventType","LEAVE","userProfile","avatarUrl","avatar_url","displayName","displayname","allInviteesExternalIdsWhenDM","toSendRoomMessageDto","isThreadedMessage","Boolean","rel_type","MESSAGE_ON_THREAD","FederationRoomReceiveExternalMessageDto","externalSenderId","normalizedSenderId","externalFormattedText","formatted_body","rawMessage","body","thread","rootEventId","replyToEventId","is_falling_back","toEditRoomMessageDto","FederationRoomEditExternalMessageDto","newExternalFormattedText","newRawMessage","editsEvent","toSendRoomFileMessageDto","url","Error","info","mimetype","size","FederationRoomReceiveExternalFileMessageDto","filename","messageText","toRoomChangeJoinRulesDto","FederationRoomChangeJoinRulesDto","toRoomChangeNameDto","FederationRoomChangeNameDto","normalizedRoomName","toRoomChangeTopicDto","FederationRoomChangeTopicDto","roomTopic","topic","toRoomRedactEventDto","FederationRoomRedactEventDto","redactsEvent","redacts","toRoomChangePowerLevelsEventDto","FederationRoomRoomChangePowerLevelsEventDto","roleChangesToApply","users","prev_content"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/RoomReceiver.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7f56b5a567075d4fa3597637b4b1d8653d858026","contentHash":"a1c603654014b4554a83b6f6c263f93e1b1f41d046232db11135ea68c8ab686e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/RoomReceiverDto.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/RoomReceiverDto.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":45,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":42}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":48}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":49}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":43}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":44}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":44}},"10":{"start":{"line":31,"column":8},"end":{"line":31,"column":52}},"11":{"start":{"line":34,"column":8},"end":{"line":34,"column":59}},"12":{"start":{"line":37,"column":8},"end":{"line":37,"column":55}},"13":{"start":{"line":40,"column":8},"end":{"line":40,"column":44}},"14":{"start":{"line":43,"column":8},"end":{"line":43,"column":59}},"15":{"start":{"line":46,"column":24},"end":{"line":50,"column":1}},"16":{"start":{"line":48,"column":8},"end":{"line":48,"column":47}},"17":{"start":{"line":51,"column":33},"end":{"line":59,"column":1}},"18":{"start":{"line":53,"column":8},"end":{"line":55,"column":11}},"19":{"start":{"line":56,"column":8},"end":{"line":56,"column":45}},"20":{"start":{"line":57,"column":8},"end":{"line":57,"column":49}},"21":{"start":{"line":60,"column":35},"end":{"line":74,"column":1}},"22":{"start":{"line":62,"column":8},"end":{"line":66,"column":11}},"23":{"start":{"line":67,"column":8},"end":{"line":67,"column":51}},"24":{"start":{"line":68,"column":8},"end":{"line":68,"column":55}},"25":{"start":{"line":69,"column":8},"end":{"line":69,"column":87}},"26":{"start":{"line":70,"column":8},"end":{"line":70,"column":33}},"27":{"start":{"line":71,"column":8},"end":{"line":71,"column":49}},"28":{"start":{"line":72,"column":8},"end":{"line":72,"column":45}},"29":{"start":{"line":75,"column":40},"end":{"line":95,"column":1}},"30":{"start":{"line":77,"column":8},"end":{"line":81,"column":11}},"31":{"start":{"line":82,"column":8},"end":{"line":82,"column":51}},"32":{"start":{"line":83,"column":8},"end":{"line":83,"column":55}},"33":{"start":{"line":84,"column":8},"end":{"line":84,"column":51}},"34":{"start":{"line":85,"column":8},"end":{"line":85,"column":55}},"35":{"start":{"line":86,"column":8},"end":{"line":86,"column":55}},"36":{"start":{"line":87,"column":8},"end":{"line":87,"column":55}},"37":{"start":{"line":88,"column":8},"end":{"line":88,"column":39}},"38":{"start":{"line":89,"column":8},"end":{"line":89,"column":27}},"39":{"start":{"line":90,"column":8},"end":{"line":90,"column":33}},"40":{"start":{"line":91,"column":8},"end":{"line":91,"column":49}},"41":{"start":{"line":92,"column":8},"end":{"line":92,"column":39}},"42":{"start":{"line":93,"column":8},"end":{"line":93,"column":73}},"43":{"start":{"line":96,"column":29},"end":{"line":106,"column":1}},"44":{"start":{"line":98,"column":8},"end":{"line":102,"column":11}},"45":{"start":{"line":103,"column":8},"end":{"line":103,"column":49}},"46":{"start":{"line":104,"column":8},"end":{"line":104,"column":53}},"47":{"start":{"line":107,"column":46},"end":{"line":121,"column":1}},"48":{"start":{"line":109,"column":8},"end":{"line":112,"column":11}},"49":{"start":{"line":113,"column":8},"end":{"line":113,"column":49}},"50":{"start":{"line":114,"column":8},"end":{"line":114,"column":53}},"51":{"start":{"line":115,"column":8},"end":{"line":115,"column":59}},"52":{"start":{"line":116,"column":8},"end":{"line":116,"column":37}},"53":{"start":{"line":117,"column":8},"end":{"line":117,"column":45}},"54":{"start":{"line":118,"column":8},"end":{"line":118,"column":47}},"55":{"start":{"line":119,"column":8},"end":{"line":119,"column":29}},"56":{"start":{"line":122,"column":43},"end":{"line":135,"column":1}},"57":{"start":{"line":124,"column":8},"end":{"line":128,"column":11}},"58":{"start":{"line":129,"column":8},"end":{"line":129,"column":49}},"59":{"start":{"line":130,"column":8},"end":{"line":130,"column":53}},"60":{"start":{"line":131,"column":8},"end":{"line":131,"column":43}},"61":{"start":{"line":132,"column":8},"end":{"line":132,"column":65}},"62":{"start":{"line":133,"column":8},"end":{"line":133,"column":37}},"63":{"start":{"line":136,"column":36},"end":{"line":144,"column":1}},"64":{"start":{"line":138,"column":8},"end":{"line":138,"column":33}},"65":{"start":{"line":139,"column":8},"end":{"line":139,"column":33}},"66":{"start":{"line":140,"column":8},"end":{"line":140,"column":25}},"67":{"start":{"line":141,"column":8},"end":{"line":141,"column":39}},"68":{"start":{"line":142,"column":8},"end":{"line":142,"column":23}},"69":{"start":{"line":145,"column":50},"end":{"line":164,"column":1}},"70":{"start":{"line":147,"column":8},"end":{"line":151,"column":11}},"71":{"start":{"line":152,"column":8},"end":{"line":152,"column":49}},"72":{"start":{"line":153,"column":8},"end":{"line":153,"column":53}},"73":{"start":{"line":154,"column":8},"end":{"line":154,"column":45}},"74":{"start":{"line":155,"column":8},"end":{"line":161,"column":11}},"75":{"start":{"line":162,"column":8},"end":{"line":162,"column":29}},"76":{"start":{"line":165,"column":39},"end":{"line":174,"column":1}},"77":{"start":{"line":167,"column":8},"end":{"line":171,"column":11}},"78":{"start":{"line":172,"column":8},"end":{"line":172,"column":33}},"79":{"start":{"line":175,"column":34},"end":{"line":185,"column":1}},"80":{"start":{"line":177,"column":8},"end":{"line":181,"column":11}},"81":{"start":{"line":182,"column":8},"end":{"line":182,"column":53}},"82":{"start":{"line":183,"column":8},"end":{"line":183,"column":49}},"83":{"start":{"line":186,"column":35},"end":{"line":196,"column":1}},"84":{"start":{"line":188,"column":8},"end":{"line":192,"column":11}},"85":{"start":{"line":193,"column":8},"end":{"line":193,"column":35}},"86":{"start":{"line":194,"column":8},"end":{"line":194,"column":49}},"87":{"start":{"line":197,"column":35},"end":{"line":207,"column":1}},"88":{"start":{"line":199,"column":8},"end":{"line":203,"column":11}},"89":{"start":{"line":204,"column":8},"end":{"line":204,"column":41}},"90":{"start":{"line":205,"column":8},"end":{"line":205,"column":49}},"91":{"start":{"line":208,"column":50},"end":{"line":218,"column":1}},"92":{"start":{"line":210,"column":8},"end":{"line":214,"column":11}},"93":{"start":{"line":215,"column":8},"end":{"line":215,"column":53}},"94":{"start":{"line":216,"column":8},"end":{"line":216,"column":49}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":32},"end":{"line":12,"column":33}},"loc":{"start":{"line":12,"column":43},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":38},"end":{"line":15,"column":39}},"loc":{"start":{"line":15,"column":49},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":39},"end":{"line":18,"column":40}},"loc":{"start":{"line":18,"column":50},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":33},"end":{"line":21,"column":34}},"loc":{"start":{"line":21,"column":44},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":34},"end":{"line":24,"column":35}},"loc":{"start":{"line":24,"column":45},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":34},"end":{"line":27,"column":35}},"loc":{"start":{"line":27,"column":45},"end":{"line":29,"column":5}},"line":27},"7":{"name":"(anonymous_7)","decl":{"start":{"line":30,"column":42},"end":{"line":30,"column":43}},"loc":{"start":{"line":30,"column":53},"end":{"line":32,"column":5}},"line":30},"8":{"name":"(anonymous_8)","decl":{"start":{"line":33,"column":49},"end":{"line":33,"column":50}},"loc":{"start":{"line":33,"column":60},"end":{"line":35,"column":5}},"line":33},"9":{"name":"(anonymous_9)","decl":{"start":{"line":36,"column":45},"end":{"line":36,"column":46}},"loc":{"start":{"line":36,"column":56},"end":{"line":38,"column":5}},"line":36},"10":{"name":"(anonymous_10)","decl":{"start":{"line":39,"column":34},"end":{"line":39,"column":35}},"loc":{"start":{"line":39,"column":45},"end":{"line":41,"column":5}},"line":39},"11":{"name":"(anonymous_11)","decl":{"start":{"line":42,"column":49},"end":{"line":42,"column":50}},"loc":{"start":{"line":42,"column":60},"end":{"line":44,"column":5}},"line":42},"12":{"name":"(anonymous_12)","decl":{"start":{"line":47,"column":4},"end":{"line":47,"column":5}},"loc":{"start":{"line":47,"column":36},"end":{"line":49,"column":5}},"line":47},"13":{"name":"(anonymous_13)","decl":{"start":{"line":52,"column":4},"end":{"line":52,"column":5}},"loc":{"start":{"line":52,"column":70},"end":{"line":58,"column":5}},"line":52},"14":{"name":"(anonymous_14)","decl":{"start":{"line":61,"column":4},"end":{"line":61,"column":5}},"loc":{"start":{"line":61,"column":191},"end":{"line":73,"column":5}},"line":61},"15":{"name":"(anonymous_15)","decl":{"start":{"line":76,"column":4},"end":{"line":76,"column":5}},"loc":{"start":{"line":76,"column":288},"end":{"line":94,"column":5}},"line":76},"16":{"name":"(anonymous_16)","decl":{"start":{"line":97,"column":4},"end":{"line":97,"column":5}},"loc":{"start":{"line":97,"column":108},"end":{"line":105,"column":5}},"line":97},"17":{"name":"(anonymous_17)","decl":{"start":{"line":108,"column":4},"end":{"line":108,"column":5}},"loc":{"start":{"line":108,"column":167},"end":{"line":120,"column":5}},"line":108},"18":{"name":"(anonymous_18)","decl":{"start":{"line":123,"column":4},"end":{"line":123,"column":5}},"loc":{"start":{"line":123,"column":161},"end":{"line":134,"column":5}},"line":123},"19":{"name":"(anonymous_19)","decl":{"start":{"line":137,"column":4},"end":{"line":137,"column":5}},"loc":{"start":{"line":137,"column":63},"end":{"line":143,"column":5}},"line":137},"20":{"name":"(anonymous_20)","decl":{"start":{"line":146,"column":4},"end":{"line":146,"column":5}},"loc":{"start":{"line":146,"column":176},"end":{"line":163,"column":5}},"line":146},"21":{"name":"(anonymous_21)","decl":{"start":{"line":166,"column":4},"end":{"line":166,"column":5}},"loc":{"start":{"line":166,"column":80},"end":{"line":173,"column":5}},"line":166},"22":{"name":"(anonymous_22)","decl":{"start":{"line":176,"column":4},"end":{"line":176,"column":5}},"loc":{"start":{"line":176,"column":108},"end":{"line":184,"column":5}},"line":176},"23":{"name":"(anonymous_23)","decl":{"start":{"line":187,"column":4},"end":{"line":187,"column":5}},"loc":{"start":{"line":187,"column":99},"end":{"line":195,"column":5}},"line":187},"24":{"name":"(anonymous_24)","decl":{"start":{"line":198,"column":4},"end":{"line":198,"column":5}},"loc":{"start":{"line":198,"column":102},"end":{"line":206,"column":5}},"line":198},"25":{"name":"(anonymous_25)","decl":{"start":{"line":209,"column":4},"end":{"line":209,"column":5}},"loc":{"start":{"line":209,"column":108},"end":{"line":217,"column":5}},"line":209}},"branchMap":{"0":{"loc":{"start":{"line":76,"column":252},"end":{"line":76,"column":285}},"type":"default-arg","locations":[{"start":{"line":76,"column":283},"end":{"line":76,"column":285}}],"line":76}},"s":{"0":2,"1":2,"2":22,"3":2,"4":2,"5":6,"6":20,"7":5,"8":4,"9":9,"10":7,"11":12,"12":15,"13":4,"14":14,"15":2,"16":89,"17":2,"18":89,"19":89,"20":89,"21":2,"22":8,"23":8,"24":8,"25":8,"26":8,"27":8,"28":8,"29":2,"30":19,"31":19,"32":19,"33":19,"34":19,"35":19,"36":19,"37":19,"38":19,"39":19,"40":19,"41":19,"42":19,"43":2,"44":32,"45":32,"46":32,"47":2,"48":14,"49":14,"50":14,"51":14,"52":14,"53":14,"54":14,"55":14,"56":2,"57":6,"58":6,"59":6,"60":6,"61":6,"62":6,"63":2,"64":12,"65":12,"66":12,"67":12,"68":12,"69":2,"70":12,"71":12,"72":12,"73":12,"74":12,"75":12,"76":2,"77":5,"78":5,"79":2,"80":4,"81":4,"82":4,"83":2,"84":3,"85":3,"86":3,"87":2,"88":3,"89":3,"90":3,"91":2,"92":13,"93":13,"94":13},"f":{"0":2,"1":2,"2":6,"3":20,"4":5,"5":4,"6":9,"7":7,"8":12,"9":15,"10":4,"11":14,"12":89,"13":89,"14":8,"15":19,"16":32,"17":14,"18":6,"19":12,"20":12,"21":5,"22":4,"23":3,"24":3,"25":13},"b":{"0":[15]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/RoomReceiverDto.ts"],"sourcesContent":["import type { RoomType } from '@rocket.chat/apps-engine/definition/rooms';\n\nimport type { EVENT_ORIGIN } from '../../../domain/IFederationBridge';\nimport type { ROCKET_CHAT_FEDERATION_ROLES } from '../../../infrastructure/rocket-chat/definitions/FederatedRoomInternalRoles';\n\ninterface IFederationBaseInputDto {\n\texternalEventId: string;\n}\n\nexport interface IFederationReceiverBaseRoomInputDto extends IFederationBaseInputDto {\n\texternalRoomId: string;\n\tnormalizedRoomId: string;\n}\n\ninterface IFederationCreateInputDto extends IFederationReceiverBaseRoomInputDto {\n\texternalInviterId: string;\n\tnormalizedInviterId: string;\n\texternalRoomName?: string;\n\troomType?: RoomType;\n\twasInternallyProgramaticallyCreated?: boolean;\n\tinternalRoomId?: string;\n}\n\ninterface IFederationChangeMembershipInputDto extends IFederationReceiverBaseRoomInputDto {\n\texternalInviterId: string;\n\tnormalizedInviterId: string;\n\texternalInviteeId: string;\n\tnormalizedInviteeId: string;\n\tinviteeUsernameOnly: string;\n\tinviterUsernameOnly: string;\n\teventOrigin: EVENT_ORIGIN;\n\tleave?: boolean;\n\troomType?: RoomType;\n\texternalRoomName?: string;\n\tuserProfile?: {\n\t\tavatarUrl?: string;\n\t\tdisplayName?: string;\n\t};\n\tallInviteesExternalIdsWhenDM?: {\n\t\texternalInviteeId: string;\n\t\tnormalizedInviteeId: string;\n\t\tinviteeUsernameOnly: string;\n\t}[];\n}\n\ninterface IFederationThread {\n\trootEventId: string;\n\treplyToEventId: string;\n}\n\ninterface IFederationSendInternalMessageInputDto extends IFederationReceiverBaseRoomInputDto {\n\texternalSenderId: string;\n\tnormalizedSenderId: string;\n\trawMessage: string;\n\texternalFormattedText: string;\n\treplyToEventId?: string;\n\tthread?: IFederationThread;\n}\n\ninterface IFederationRoomChangeJoinRulesDtoInputDto extends IFederationReceiverBaseRoomInputDto {\n\troomType: RoomType;\n}\n\ninterface IFederationRoomNameChangeInputDto extends IFederationReceiverBaseRoomInputDto {\n\tnormalizedRoomName: string;\n\texternalSenderId: string;\n}\n\ninterface IFederationRoomTopicChangeInputDto extends IFederationReceiverBaseRoomInputDto {\n\troomTopic: string;\n\texternalSenderId: string;\n}\n\ninterface IFederationRoomRedactEventInputDto extends IFederationReceiverBaseRoomInputDto {\n\tredactsEvent: string;\n\texternalSenderId: string;\n}\n\ninterface IFederationRoomChangePowerLevelsInputDto extends IFederationReceiverBaseRoomInputDto {\n\troleChangesToApply: IExternalRolesChangesToApplyInputDto;\n\texternalSenderId: string;\n}\n\ninterface IFederationSendInternalMessageBaseInputDto extends IFederationReceiverBaseRoomInputDto {\n\texternalSenderId: string;\n\tnormalizedSenderId: string;\n}\n\nabstract class FederationBaseDto {\n\tconstructor({ externalEventId }: { externalEventId: string }) {\n\t\tthis.externalEventId = externalEventId;\n\t}\n\n\texternalEventId: string;\n}\n\nexport class FederationBaseRoomInputDto extends FederationBaseDto {\n\tconstructor({ externalRoomId, normalizedRoomId, externalEventId }: IFederationReceiverBaseRoomInputDto) {\n\t\tsuper({ externalEventId });\n\t\tthis.externalRoomId = externalRoomId;\n\t\tthis.normalizedRoomId = normalizedRoomId;\n\t}\n\n\texternalRoomId: string;\n\n\tnormalizedRoomId: string;\n}\n\nexport class FederationRoomCreateInputDto extends FederationBaseRoomInputDto {\n\tconstructor({\n\t\texternalRoomId,\n\t\tnormalizedRoomId,\n\t\texternalInviterId,\n\t\tnormalizedInviterId,\n\t\twasInternallyProgramaticallyCreated,\n\t\troomType,\n\t\texternalRoomName,\n\t\tinternalRoomId,\n\t\texternalEventId,\n\t}: IFederationCreateInputDto) {\n\t\tsuper({ externalRoomId, normalizedRoomId, externalEventId });\n\t\tthis.externalInviterId = externalInviterId;\n\t\tthis.normalizedInviterId = normalizedInviterId;\n\t\tthis.wasInternallyProgramaticallyCreated = wasInternallyProgramaticallyCreated;\n\t\tthis.roomType = roomType;\n\t\tthis.externalRoomName = externalRoomName;\n\t\tthis.internalRoomId = internalRoomId;\n\t}\n\n\texternalInviterId: string;\n\n\tnormalizedInviterId: string;\n\n\twasInternallyProgramaticallyCreated?: boolean;\n\n\tinternalRoomId?: string;\n\n\texternalRoomName?: string;\n\n\troomType?: RoomType;\n}\n\nexport class FederationRoomChangeMembershipDto extends FederationBaseRoomInputDto {\n\tconstructor({\n\t\texternalRoomId,\n\t\tnormalizedRoomId,\n\t\texternalInviterId,\n\t\tnormalizedInviterId,\n\t\texternalInviteeId,\n\t\tnormalizedInviteeId,\n\t\tinviteeUsernameOnly,\n\t\tinviterUsernameOnly,\n\t\teventOrigin,\n\t\tleave,\n\t\troomType,\n\t\texternalRoomName,\n\t\texternalEventId,\n\t\tuserProfile,\n\t\tallInviteesExternalIdsWhenDM = [],\n\t}: IFederationChangeMembershipInputDto) {\n\t\tsuper({ externalRoomId, normalizedRoomId, externalEventId });\n\t\tthis.externalInviterId = externalInviterId;\n\t\tthis.normalizedInviterId = normalizedInviterId;\n\t\tthis.externalInviteeId = externalInviteeId;\n\t\tthis.normalizedInviteeId = normalizedInviteeId;\n\t\tthis.inviteeUsernameOnly = inviteeUsernameOnly;\n\t\tthis.inviterUsernameOnly = inviterUsernameOnly;\n\t\tthis.eventOrigin = eventOrigin;\n\t\tthis.leave = leave;\n\t\tthis.roomType = roomType;\n\t\tthis.externalRoomName = externalRoomName;\n\t\tthis.userProfile = userProfile;\n\t\tthis.allInviteesExternalIdsWhenDM = allInviteesExternalIdsWhenDM;\n\t}\n\n\texternalInviterId: string;\n\n\tnormalizedInviterId: string;\n\n\tinviterUsernameOnly: string;\n\n\texternalInviteeId: string;\n\n\tnormalizedInviteeId: string;\n\n\tinviteeUsernameOnly: string;\n\n\teventOrigin: EVENT_ORIGIN;\n\n\troomType?: RoomType;\n\n\tleave?: boolean;\n\n\texternalRoomName?: string;\n\n\tallInviteesExternalIdsWhenDM?: {\n\t\texternalInviteeId: string;\n\t\tnormalizedInviteeId: string;\n\t\tinviteeUsernameOnly: string;\n\t}[];\n\n\tuserProfile?: { avatarUrl?: string; displayName?: string };\n}\n\nclass ExternalMessageBaseDto extends FederationBaseRoomInputDto {\n\tconstructor({ externalRoomId, normalizedRoomId, externalSenderId, normalizedSenderId, externalEventId }: Record<string, any>) {\n\t\tsuper({ externalRoomId, normalizedRoomId, externalEventId });\n\t\tthis.externalSenderId = externalSenderId;\n\t\tthis.normalizedSenderId = normalizedSenderId;\n\t}\n\n\texternalSenderId: string;\n\n\tnormalizedSenderId: string;\n}\n\nexport class FederationRoomReceiveExternalMessageDto extends ExternalMessageBaseDto {\n\tconstructor({\n\t\texternalRoomId,\n\t\tnormalizedRoomId,\n\t\texternalSenderId,\n\t\tnormalizedSenderId,\n\t\texternalFormattedText,\n\t\trawMessage,\n\t\texternalEventId,\n\t\treplyToEventId,\n\t\tthread,\n\t}: IFederationSendInternalMessageInputDto) {\n\t\tsuper({ externalRoomId, normalizedRoomId });\n\t\tthis.externalSenderId = externalSenderId;\n\t\tthis.normalizedSenderId = normalizedSenderId;\n\t\tthis.externalFormattedText = externalFormattedText;\n\t\tthis.rawMessage = rawMessage;\n\t\tthis.replyToEventId = replyToEventId;\n\t\tthis.externalEventId = externalEventId;\n\t\tthis.thread = thread;\n\t}\n\n\texternalSenderId: string;\n\n\tnormalizedSenderId: string;\n\n\texternalFormattedText: string;\n\n\trawMessage: string;\n\n\treplyToEventId?: string;\n\n\tthread?: {\n\t\trootEventId: string;\n\t\treplyToEventId: string;\n\t};\n}\n\nexport class FederationRoomEditExternalMessageDto extends ExternalMessageBaseDto {\n\tconstructor({\n\t\texternalRoomId,\n\t\tnormalizedRoomId,\n\t\texternalSenderId,\n\t\tnormalizedSenderId,\n\t\tnewRawMessage,\n\t\tnewExternalFormattedText,\n\t\teditsEvent,\n\t\texternalEventId,\n\t}: IFederationSendInternalMessageBaseInputDto & {\n\t\tnewRawMessage: string;\n\t\tnewExternalFormattedText: string;\n\t\teditsEvent: string;\n\t}) {\n\t\tsuper({ externalRoomId, normalizedRoomId, externalEventId });\n\t\tthis.externalSenderId = externalSenderId;\n\t\tthis.normalizedSenderId = normalizedSenderId;\n\t\tthis.newRawMessage = newRawMessage;\n\t\tthis.newExternalFormattedText = newExternalFormattedText;\n\t\tthis.editsEvent = editsEvent;\n\t}\n\n\texternalSenderId: string;\n\n\tnormalizedSenderId: string;\n\n\tnewExternalFormattedText: string;\n\n\tnewRawMessage: string;\n\n\teditsEvent: string;\n}\n\ninterface IFederationFileMessageInputDto {\n\tfilename: string;\n\tmimetype: string;\n\tsize: number;\n\tmessageText: string;\n\turl: string;\n\treplyToEventId?: string;\n\tthread?: {\n\t\trootEventId: string;\n\t\treplyToEventId: string;\n\t};\n}\n\nclass FederationFileMessageInputDto {\n\tconstructor({ filename, mimetype, size, messageText, url }: IFederationFileMessageInputDto) {\n\t\tthis.filename = filename;\n\t\tthis.mimetype = mimetype;\n\t\tthis.size = size;\n\t\tthis.messageText = messageText;\n\t\tthis.url = url;\n\t}\n\n\tfilename: string;\n\n\tmimetype: string;\n\n\tsize: number;\n\n\tmessageText: string;\n\n\turl: string;\n}\n\nexport class FederationRoomReceiveExternalFileMessageDto extends ExternalMessageBaseDto {\n\tconstructor({\n\t\texternalRoomId,\n\t\tnormalizedRoomId,\n\t\texternalSenderId,\n\t\tnormalizedSenderId,\n\t\tfilename,\n\t\tmimetype,\n\t\tsize,\n\t\tmessageText,\n\t\turl,\n\t\texternalEventId,\n\t\treplyToEventId,\n\t\tthread,\n\t}: IFederationSendInternalMessageBaseInputDto & IFederationFileMessageInputDto) {\n\t\tsuper({ externalRoomId, normalizedRoomId, externalEventId });\n\t\tthis.externalSenderId = externalSenderId;\n\t\tthis.normalizedSenderId = normalizedSenderId;\n\t\tthis.replyToEventId = replyToEventId;\n\t\tthis.messageBody = new FederationFileMessageInputDto({ filename, mimetype, size, messageText, url });\n\t\tthis.thread = thread;\n\t}\n\n\texternalSenderId: string;\n\n\tnormalizedSenderId: string;\n\n\tmessageBody: FederationFileMessageInputDto;\n\n\treplyToEventId?: string;\n\n\tthread?: IFederationThread;\n}\n\nexport class FederationRoomChangeJoinRulesDto extends FederationBaseRoomInputDto {\n\tconstructor({ externalRoomId, normalizedRoomId, roomType, externalEventId }: IFederationRoomChangeJoinRulesDtoInputDto) {\n\t\tsuper({ externalRoomId, normalizedRoomId, externalEventId });\n\t\tthis.roomType = roomType;\n\t}\n\n\troomType: RoomType;\n}\n\nexport class FederationRoomChangeNameDto extends FederationBaseRoomInputDto {\n\tconstructor({\n\t\texternalRoomId,\n\t\tnormalizedRoomId,\n\t\tnormalizedRoomName,\n\t\texternalSenderId,\n\t\texternalEventId,\n\t}: IFederationRoomNameChangeInputDto) {\n\t\tsuper({ externalRoomId, normalizedRoomId, externalEventId });\n\t\tthis.normalizedRoomName = normalizedRoomName;\n\t\tthis.externalSenderId = externalSenderId;\n\t}\n\n\tnormalizedRoomName: string;\n\n\texternalSenderId: string;\n}\n\nexport class FederationRoomChangeTopicDto extends FederationBaseRoomInputDto {\n\tconstructor({ externalRoomId, normalizedRoomId, roomTopic, externalSenderId, externalEventId }: IFederationRoomTopicChangeInputDto) {\n\t\tsuper({ externalRoomId, normalizedRoomId, externalEventId });\n\t\tthis.roomTopic = roomTopic;\n\t\tthis.externalSenderId = externalSenderId;\n\t}\n\n\troomTopic: string;\n\n\texternalSenderId: string;\n}\n\nexport class FederationRoomRedactEventDto extends FederationBaseRoomInputDto {\n\tconstructor({ externalRoomId, normalizedRoomId, externalEventId, redactsEvent, externalSenderId }: IFederationRoomRedactEventInputDto) {\n\t\tsuper({ externalRoomId, normalizedRoomId, externalEventId });\n\t\tthis.redactsEvent = redactsEvent;\n\t\tthis.externalSenderId = externalSenderId;\n\t}\n\n\tredactsEvent: string;\n\n\texternalSenderId: string;\n}\n\nexport interface IExternalRolesChangesToApplyInputDto {\n\t[key: string]: { action: string; role: ROCKET_CHAT_FEDERATION_ROLES }[];\n}\nexport class FederationRoomRoomChangePowerLevelsEventDto extends FederationBaseRoomInputDto {\n\tconstructor({\n\t\texternalRoomId,\n\t\tnormalizedRoomId,\n\t\texternalEventId,\n\t\troleChangesToApply,\n\t\texternalSenderId,\n\t}: IFederationRoomChangePowerLevelsInputDto) {\n\t\tsuper({ externalRoomId, normalizedRoomId, externalEventId });\n\t\tthis.roleChangesToApply = roleChangesToApply;\n\t\tthis.externalSenderId = externalSenderId;\n\t}\n\n\troleChangesToApply: IExternalRolesChangesToApplyInputDto;\n\n\texternalSenderId: string;\n}\n"],"names":["FederationBaseRoomInputDto","FederationRoomChangeJoinRulesDto","FederationRoomChangeMembershipDto","FederationRoomChangeNameDto","FederationRoomChangeTopicDto","FederationRoomCreateInputDto","FederationRoomEditExternalMessageDto","FederationRoomReceiveExternalFileMessageDto","FederationRoomReceiveExternalMessageDto","FederationRoomRedactEventDto","FederationRoomRoomChangePowerLevelsEventDto","FederationBaseDto","constructor","externalEventId","externalRoomId","normalizedRoomId","externalInviterId","normalizedInviterId","wasInternallyProgramaticallyCreated","roomType","externalRoomName","internalRoomId","externalInviteeId","normalizedInviteeId","inviteeUsernameOnly","inviterUsernameOnly","eventOrigin","leave","userProfile","allInviteesExternalIdsWhenDM","ExternalMessageBaseDto","externalSenderId","normalizedSenderId","externalFormattedText","rawMessage","replyToEventId","thread","newRawMessage","newExternalFormattedText","editsEvent","FederationFileMessageInputDto","filename","mimetype","size","messageText","url","messageBody","normalizedRoomName","roomTopic","redactsEvent","roleChangesToApply"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/RoomReceiverDto.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"1c3527ee0cb325b9a0a48969d23bfbc058b83598","contentHash":"73f5ac749abb26083bc21a721c4e576b1268559889fabf8892bc0177dddc4351"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/domain/IFederationBridge.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/domain/IFederationBridge.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":28}},"3":{"start":{"line":11,"column":33},"end":{"line":15,"column":5}},"4":{"start":{"line":12,"column":4},"end":{"line":12,"column":36}},"5":{"start":{"line":13,"column":4},"end":{"line":13,"column":38}},"6":{"start":{"line":14,"column":4},"end":{"line":14,"column":24}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":33},"end":{"line":11,"column":34}},"loc":{"start":{"line":11,"column":56},"end":{"line":15,"column":1}},"line":11}},"branchMap":{},"s":{"0":2,"1":2,"2":112,"3":2,"4":2,"5":2,"6":2},"f":{"0":112,"1":2},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/domain/IFederationBridge.ts"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\n\nexport interface IExternalUserProfileInformation {\n\tdisplayName: string;\n\tavatarUrl?: string;\n}\n\nexport enum EVENT_ORIGIN {\n\tLOCAL = 'LOCAL',\n\tREMOTE = 'REMOTE',\n}\n\ninterface IRegistrationFileNamespaceRule {\n\texclusive: boolean;\n\tregex: string;\n}\n\ninterface IRegistrationFileNamespaces {\n\tusers: IRegistrationFileNamespaceRule[];\n\trooms: IRegistrationFileNamespaceRule[];\n\taliases: IRegistrationFileNamespaceRule[];\n}\n\nexport interface IFederationBridgeRegistrationFile {\n\tid: string;\n\thomeserverToken: string;\n\tapplicationServiceToken: string;\n\tbridgeUrl: string;\n\tbotName: string;\n\tlistenTo: IRegistrationFileNamespaces;\n\tenableEphemeralEvents: boolean;\n}\n\nexport interface IFederationBridge {\n\tstart(): Promise<void>;\n\tstop(): Promise<void>;\n\tgetUserProfileInformation(externalUserId: string): Promise<IExternalUserProfileInformation | undefined>;\n\tjoinRoom(externalRoomId: string, externalUserId: string, viaServers?: string[]): Promise<void>;\n\tcreateDirectMessageRoom(externalCreatorId: string, inviteesExternalIds: string[], extraData?: Record<string, any>): Promise<string>;\n\tinviteToRoom(externalRoomId: string, externalInviterId: string, externalInviteeId: string): Promise<void>;\n\tsendMessage(externalRoomId: string, externalSenderId: string, message: IMessage): Promise<string>;\n\tsendThreadMessage(externalRoomId: string, externalSenderId: string, message: IMessage, relatesToEventId: string): Promise<string>;\n\tsendMessageFileToThread(\n\t\texternalRoomId: string,\n\t\texternaSenderId: string,\n\t\tcontent: Buffer,\n\t\tfileDetails: { filename: string; fileSize: number; mimeType: string; metadata?: { width?: number; height?: number; format?: string } },\n\t\trelatesToEventId: string,\n\t): Promise<string>;\n\tsendThreadReplyToMessage(\n\t\texternalRoomId: string,\n\t\texternalUserId: string,\n\t\teventToReplyTo: string,\n\t\teventOriginalSender: string,\n\t\tmessage: string,\n\t\trelatesToEventId: string,\n\t): Promise<string>;\n\tsendReplyMessageFileToThread(\n\t\texternalRoomId: string,\n\t\texternaSenderId: string,\n\t\tcontent: Buffer,\n\t\tfileDetails: { filename: string; fileSize: number; mimeType: string; metadata?: { width?: number; height?: number; format?: string } },\n\t\teventToReplyTo: string,\n\t\trelatesToEventId: string,\n\t): Promise<string>;\n\tcreateUser(username: string, name: string, domain: string, avatarUrl?: string): Promise<string>;\n\tisUserIdFromTheSameHomeserver(externalUserId: string, domain: string): boolean;\n\textractHomeserverOrigin(externalUserId: string): string;\n\tisRoomFromTheSameHomeserver(externalRoomId: string, domain: string): boolean;\n\tleaveRoom(externalRoomId: string, externalUserId: string): Promise<void>;\n\tkickUserFromRoom(externalRoomId: string, externalUserId: string, externalOwnerId: string): Promise<void>;\n\tlogFederationStartupInfo(info?: string): void;\n\tsetUserAvatar(externalUserId: string, avatarUrl: string): Promise<void>;\n\tgetReadStreamForFileFromUrl(externaUserId: string, fileUrl: string): Promise<ReadableStream>;\n\tredactEvent(externalRoomId: string, externalUserId: string, externalEventId: string): Promise<void>;\n\tupdateMessage(externalRoomId: string, externalUserId: string, externalEventId: string, newMessageText: string): Promise<void>;\n\tsendMessageReaction(externalRoomId: string, externalUserId: string, externalEventId: string, reaction: string): Promise<string>;\n\tsendMessageFileToRoom(\n\t\texternalRoomId: string,\n\t\texternaSenderId: string,\n\t\tcontent: Buffer,\n\t\tfileDetails: { filename: string; fileSize: number; mimeType: string; metadata?: { width?: number; height?: number; format?: string } },\n\t): Promise<string>;\n\tuploadContent(externalSenderId: string, content: Buffer, options?: { name?: string; type?: string }): Promise<string | undefined>;\n\tconvertMatrixUrlToHttp(externalUserId: string, matrixUrl: string): Promise<string>;\n\tsendReplyToMessage(\n\t\texternalRoomId: string,\n\t\texternalUserId: string,\n\t\teventToReplyTo: string,\n\t\teventOriginalSender: string,\n\t\tmessage: string,\n\t): Promise<string>;\n\tsendReplyMessageFileToRoom(\n\t\texternalRoomId: string,\n\t\texternaSenderId: string,\n\t\tcontent: Buffer,\n\t\tfileDetails: { filename: string; fileSize: number; mimeType: string; metadata?: { width?: number; height?: number; format?: string } },\n\t\teventToReplyTo: string,\n\t): Promise<string>;\n\tnotifyUserTyping(externalRoomId: string, externalUserId: string, isTyping: boolean): Promise<void>;\n\tsetUserDisplayName(externalUserId: string, displayName: string): Promise<void>;\n\tsetRoomPowerLevels(externalRoomId: string, externalOwnerId: string, externalUserId: string, powerLevels: number): Promise<void>;\n\tgetRoomHistoricalJoinEvents(externalRoomId: string, externalUserId: string, excludingUserIds?: string[]): Promise<any[]>;\n\tgetRoomName(externalRoomId: string, externalUserId: string): Promise<string | undefined>;\n\tgetRoomTopic(externalRoomId: string, externalUserId: string): Promise<string | undefined>;\n\tsetRoomName(externalRoomId: string, externalUserId: string, roomName: string): Promise<void>;\n\tsetRoomTopic(externalRoomId: string, externalUserId: string, roomTopic: string): Promise<void>;\n\tverifyInviteeIds(matrixIds: string[]): Promise<Map<string, string>>;\n\tgetRoomData(\n\t\texternalUserId: string,\n\t\texternalRoomId: string,\n\t): Promise<{ creator: { id: string; username: string }; name: string; joinedMembers: string[] } | undefined>;\n\tping(): Promise<{ durationMs: number }>;\n\tdeactivateUser(externalUserId: string): Promise<void>;\n}\n"],"names":["EVENT_ORIGIN"],"mappings":";;;;+BAOYA;;;eAAAA;;;AAAL,IAAA,AAAKA,sCAAAA;;;WAAAA","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/domain/IFederationBridge.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"64850d2b3e654be74d7b6a0e5a7b656e381fd799","contentHash":"c03a62e41796c8620406a7105376bc31360065eb803594560f14359b5eecf7c6"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixEventType.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixEventType.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":31}},"3":{"start":{"line":11,"column":36},"end":{"line":24,"column":5}},"4":{"start":{"line":12,"column":4},"end":{"line":12,"column":54}},"5":{"start":{"line":13,"column":4},"end":{"line":13,"column":65}},"6":{"start":{"line":14,"column":4},"end":{"line":14,"column":60}},"7":{"start":{"line":15,"column":4},"end":{"line":15,"column":69}},"8":{"start":{"line":16,"column":4},"end":{"line":16,"column":57}},"9":{"start":{"line":17,"column":4},"end":{"line":17,"column":73}},"10":{"start":{"line":18,"column":4},"end":{"line":18,"column":59}},"11":{"start":{"line":19,"column":4},"end":{"line":19,"column":64}},"12":{"start":{"line":20,"column":4},"end":{"line":20,"column":54}},"13":{"start":{"line":21,"column":4},"end":{"line":21,"column":54}},"14":{"start":{"line":22,"column":4},"end":{"line":22,"column":63}},"15":{"start":{"line":23,"column":4},"end":{"line":23,"column":27}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":36},"end":{"line":11,"column":37}},"loc":{"start":{"line":11,"column":62},"end":{"line":24,"column":1}},"line":11}},"branchMap":{},"s":{"0":2,"1":2,"2":90,"3":2,"4":2,"5":2,"6":2,"7":2,"8":2,"9":2,"10":2,"11":2,"12":2,"13":2,"14":2,"15":2},"f":{"0":90,"1":2},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixEventType.ts"],"sourcesContent":["export enum MatrixEventType {\n\tROOM_CREATED = 'm.room.create',\n\tROOM_MEMBERSHIP_CHANGED = 'm.room.member',\n\tROOM_MESSAGE_SENT = 'm.room.message',\n\tROOM_JOIN_RULES_CHANGED = 'm.room.join_rules',\n\tROOM_NAME_CHANGED = 'm.room.name',\n\tROOM_POWER_LEVELS_CHANGED = 'm.room.power_levels',\n\tROOM_TOPIC_CHANGED = 'm.room.topic',\n\tROOM_EVENT_REDACTED = 'm.room.redaction',\n\tMESSAGE_REACTED = 'm.reaction',\n\tMESSAGE_ON_THREAD = 'm.thread',\n\tUSER_TYPING_STATUS_CHANGED = 'm.typing',\n}\n"],"names":["MatrixEventType"],"mappings":";;;;+BAAYA;;;eAAAA;;;AAAL,IAAA,AAAKA,yCAAAA;;;;;;;;;;;;WAAAA","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixEventType.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"04cfda04d2c2b7de2348a023506db28ab5dcee60","contentHash":"49a323a307f242ce18d7d9cf76efe6c35d0eba4c29311910111f2351e1e099f0"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixPowerLevels.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixPowerLevels.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":35}},"3":{"start":{"line":11,"column":40},"end":{"line":16,"column":5}},"4":{"start":{"line":12,"column":4},"end":{"line":12,"column":66}},"5":{"start":{"line":13,"column":4},"end":{"line":13,"column":77}},"6":{"start":{"line":14,"column":4},"end":{"line":14,"column":70}},"7":{"start":{"line":15,"column":4},"end":{"line":15,"column":31}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":40},"end":{"line":11,"column":41}},"loc":{"start":{"line":11,"column":70},"end":{"line":16,"column":1}},"line":11}},"branchMap":{},"s":{"0":3,"1":3,"2":108,"3":3,"4":3,"5":3,"6":3,"7":3},"f":{"0":108,"1":3},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixPowerLevels.ts"],"sourcesContent":["export enum MATRIX_POWER_LEVELS {\n\tUSER = 0,\n\tMODERATOR = 50,\n\tADMIN = 100,\n}\n"],"names":["MATRIX_POWER_LEVELS"],"mappings":";;;;+BAAYA;;;eAAAA;;;AAAL,IAAA,AAAKA,6CAAAA;;;;WAAAA","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixPowerLevels.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6bb0337f38015c46c73b236321310bc9e9a7660b","contentHash":"7a3670613710e0b12ceac8e3e877fe667dfe7e61b5d0377f4b98045cafb19ea8"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/events/RoomMembershipChanged.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/events/RoomMembershipChanged.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":48}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":46}},"6":{"start":{"line":19,"column":29},"end":{"line":19,"column":62}},"7":{"start":{"line":20,"column":25},"end":{"line":20,"column":54}},"8":{"start":{"line":21,"column":51},"end":{"line":26,"column":5}},"9":{"start":{"line":22,"column":4},"end":{"line":22,"column":52}},"10":{"start":{"line":23,"column":4},"end":{"line":23,"column":56}},"11":{"start":{"line":24,"column":4},"end":{"line":24,"column":54}},"12":{"start":{"line":25,"column":4},"end":{"line":25,"column":42}},"13":{"start":{"line":27,"column":39},"end":{"line":31,"column":1}},"14":{"start":{"line":29,"column":8},"end":{"line":29,"column":93}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":38},"end":{"line":12,"column":39}},"loc":{"start":{"line":12,"column":49},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":36},"end":{"line":15,"column":37}},"loc":{"start":{"line":15,"column":47},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":21,"column":51},"end":{"line":21,"column":52}},"loc":{"start":{"line":21,"column":92},"end":{"line":26,"column":1}},"line":21},"4":{"name":"(anonymous_4)","decl":{"start":{"line":28,"column":4},"end":{"line":28,"column":5}},"loc":{"start":{"line":28,"column":24},"end":{"line":30,"column":5}},"line":28}},"branchMap":{},"s":{"0":2,"1":2,"2":4,"3":2,"4":0,"5":21,"6":2,"7":2,"8":2,"9":2,"10":2,"11":2,"12":2,"13":2,"14":0},"f":{"0":2,"1":0,"2":21,"3":2,"4":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/events/RoomMembershipChanged.ts"],"sourcesContent":["import type { IBaseEventContent } from '../AbstractMatrixEvent';\nimport { AbstractMatrixEvent } from '../AbstractMatrixEvent';\nimport { MatrixEventType } from '../MatrixEventType';\n\nexport enum RoomMembershipChangedEventType {\n\tJOIN = 'join',\n\tINVITE = 'invite',\n\tLEAVE = 'leave',\n}\n\ninterface IMatrixEventContentRoomMembershipChanged extends IBaseEventContent {\n\tdisplayname: string;\n\tmembership: RoomMembershipChangedEventType;\n\tis_direct?: boolean;\n\tavatar_url?: string;\n}\n\nexport class MatrixEventRoomMembershipChanged extends AbstractMatrixEvent {\n\tpublic content: IMatrixEventContentRoomMembershipChanged;\n\n\tpublic type = MatrixEventType.ROOM_MEMBERSHIP_CHANGED;\n}\n"],"names":["MatrixEventRoomMembershipChanged","RoomMembershipChangedEventType","AbstractMatrixEvent","type","MatrixEventType","ROOM_MEMBERSHIP_CHANGED"],"mappings":";;;;;;;;;;;IAiBaA,gCAAgC;eAAhCA;;IAbDC,8BAA8B;eAA9BA;;;qCAHwB;iCACJ;AAEzB,IAAA,AAAKA,wDAAAA;;;;WAAAA;;AAaL,IAAA,AAAMD,mCAAN,MAAMA,yCAAyCE,wCAAmB;;6BAGjEC,OAAOC,gCAAe,CAACC,uBAAuB;;AACtD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/events/RoomMembershipChanged.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"0e1eba754d4ee52e28f18f23fea5b8eeee6bfbba","contentHash":"ee1d7bcb0d69d09cc0bc5d42f8a8767f47e5a90ef59a1194bac91029f921a8f1"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/AbstractMatrixEvent.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/AbstractMatrixEvent.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":35}},"3":{"start":{"line":11,"column":26},"end":{"line":12,"column":1}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7}},"branchMap":{},"s":{"0":2,"1":2,"2":3,"3":2},"f":{"0":3},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/AbstractMatrixEvent.ts"],"sourcesContent":["export abstract class AbstractMatrixEvent {\n\tpublic age: number;\n\n\tpublic invite_room_state?: AbstractMatrixEvent[];\n\n\tpublic event_id: string;\n\n\tpublic origin_server_ts: number;\n\n\tpublic room_id: string;\n\n\tpublic sender: string;\n\n\tpublic state_key: string;\n\n\tpublic unsigned: { age: number; invite_room_state: AbstractMatrixEvent[] };\n\n\tpublic prev_content: IBaseEventContent;\n\n\tpublic user_id: string;\n\n\tpublic redacts?: string;\n\n\tpublic abstract content: IBaseEventContent;\n\n\tpublic abstract type: string;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface IBaseEventContent {}\n"],"names":["AbstractMatrixEvent"],"mappings":";;;;+BAAsBA;;;eAAAA;;;AAAf,IAAA,AAAeA,sBAAf,MAAeA;AA0BtB","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/AbstractMatrixEvent.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9d44f9e6a03584f994054113c8cff0690ce28904","contentHash":"59f032f15f521fabfd4088c5b1f7385eb2d2bc87a2f6ee9c5c6c1451cb61aade"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/infrastructure/rocket-chat/hooks/hooks.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/infrastructure/rocket-chat/hooks/hooks.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":34},"end":{"line":6,"column":81}},"3":{"start":{"line":7,"column":29},"end":{"line":7,"column":71}},"4":{"start":{"line":9,"column":4},"end":{"line":11,"column":6}},"5":{"start":{"line":13,"column":15},"end":{"line":13,"column":36}},"6":{"start":{"line":14,"column":46},"end":{"line":14,"column":67}},"7":{"start":{"line":15,"column":14},"end":{"line":15,"column":16}},"8":{"start":{"line":16,"column":30},"end":{"line":41,"column":2}},"9":{"start":{"line":22,"column":20},"end":{"line":22,"column":21}},"10":{"start":{"line":33,"column":16},"end":{"line":33,"column":38}},"11":{"start":{"line":34,"column":16},"end":{"line":34,"column":32}},"12":{"start":{"line":42,"column":0},"end":{"line":421,"column":3}},"13":{"start":{"line":43,"column":4},"end":{"line":46,"column":7}},"14":{"start":{"line":44,"column":8},"end":{"line":44,"column":23}},"15":{"start":{"line":45,"column":8},"end":{"line":45,"column":54}},"16":{"start":{"line":47,"column":4},"end":{"line":113,"column":7}},"17":{"start":{"line":48,"column":8},"end":{"line":53,"column":11}},"18":{"start":{"line":49,"column":25},"end":{"line":49,"column":46}},"19":{"start":{"line":50,"column":12},"end":{"line":50,"column":59}},"20":{"start":{"line":51,"column":12},"end":{"line":51,"column":55}},"21":{"start":{"line":52,"column":12},"end":{"line":52,"column":55}},"22":{"start":{"line":54,"column":8},"end":{"line":59,"column":11}},"23":{"start":{"line":55,"column":25},"end":{"line":55,"column":46}},"24":{"start":{"line":56,"column":12},"end":{"line":56,"column":59}},"25":{"start":{"line":57,"column":12},"end":{"line":57,"column":57}},"26":{"start":{"line":58,"column":12},"end":{"line":58,"column":55}},"27":{"start":{"line":60,"column":8},"end":{"line":67,"column":11}},"28":{"start":{"line":61,"column":25},"end":{"line":61,"column":46}},"29":{"start":{"line":62,"column":12},"end":{"line":62,"column":59}},"30":{"start":{"line":63,"column":12},"end":{"line":65,"column":15}},"31":{"start":{"line":66,"column":12},"end":{"line":66,"column":55}},"32":{"start":{"line":68,"column":8},"end":{"line":75,"column":11}},"33":{"start":{"line":69,"column":25},"end":{"line":69,"column":46}},"34":{"start":{"line":70,"column":12},"end":{"line":70,"column":59}},"35":{"start":{"line":71,"column":12},"end":{"line":73,"column":19}},"36":{"start":{"line":74,"column":12},"end":{"line":74,"column":55}},"37":{"start":{"line":76,"column":8},"end":{"line":85,"column":11}},"38":{"start":{"line":77,"column":25},"end":{"line":77,"column":46}},"39":{"start":{"line":78,"column":12},"end":{"line":78,"column":59}},"40":{"start":{"line":79,"column":12},"end":{"line":83,"column":15}},"41":{"start":{"line":84,"column":12},"end":{"line":84,"column":55}},"42":{"start":{"line":86,"column":8},"end":{"line":99,"column":11}},"43":{"start":{"line":87,"column":26},"end":{"line":87,"column":37}},"44":{"start":{"line":88,"column":12},"end":{"line":88,"column":64}},"45":{"start":{"line":89,"column":25},"end":{"line":89,"column":46}},"46":{"start":{"line":90,"column":12},"end":{"line":90,"column":59}},"47":{"start":{"line":92,"column":12},"end":{"line":97,"column":44}},"48":{"start":{"line":98,"column":12},"end":{"line":98,"column":55}},"49":{"start":{"line":100,"column":8},"end":{"line":112,"column":11}},"50":{"start":{"line":101,"column":25},"end":{"line":101,"column":46}},"51":{"start":{"line":102,"column":12},"end":{"line":102,"column":59}},"52":{"start":{"line":103,"column":12},"end":{"line":108,"column":15}},"53":{"start":{"line":109,"column":12},"end":{"line":111,"column":40}},"54":{"start":{"line":114,"column":4},"end":{"line":186,"column":7}},"55":{"start":{"line":115,"column":8},"end":{"line":120,"column":11}},"56":{"start":{"line":116,"column":25},"end":{"line":116,"column":46}},"57":{"start":{"line":117,"column":12},"end":{"line":117,"column":56}},"58":{"start":{"line":118,"column":12},"end":{"line":118,"column":62}},"59":{"start":{"line":119,"column":12},"end":{"line":119,"column":55}},"60":{"start":{"line":121,"column":8},"end":{"line":126,"column":11}},"61":{"start":{"line":122,"column":25},"end":{"line":122,"column":46}},"62":{"start":{"line":123,"column":12},"end":{"line":123,"column":56}},"63":{"start":{"line":124,"column":12},"end":{"line":124,"column":68}},"64":{"start":{"line":125,"column":12},"end":{"line":125,"column":55}},"65":{"start":{"line":127,"column":8},"end":{"line":134,"column":11}},"66":{"start":{"line":128,"column":25},"end":{"line":128,"column":46}},"67":{"start":{"line":129,"column":12},"end":{"line":129,"column":56}},"68":{"start":{"line":130,"column":12},"end":{"line":132,"column":15}},"69":{"start":{"line":133,"column":12},"end":{"line":133,"column":55}},"70":{"start":{"line":135,"column":8},"end":{"line":142,"column":11}},"71":{"start":{"line":136,"column":25},"end":{"line":136,"column":46}},"72":{"start":{"line":137,"column":12},"end":{"line":137,"column":56}},"73":{"start":{"line":138,"column":12},"end":{"line":140,"column":19}},"74":{"start":{"line":141,"column":12},"end":{"line":141,"column":55}},"75":{"start":{"line":143,"column":8},"end":{"line":156,"column":11}},"76":{"start":{"line":144,"column":26},"end":{"line":144,"column":37}},"77":{"start":{"line":145,"column":12},"end":{"line":145,"column":64}},"78":{"start":{"line":146,"column":25},"end":{"line":146,"column":46}},"79":{"start":{"line":147,"column":12},"end":{"line":147,"column":56}},"80":{"start":{"line":149,"column":12},"end":{"line":154,"column":44}},"81":{"start":{"line":155,"column":12},"end":{"line":155,"column":55}},"82":{"start":{"line":157,"column":8},"end":{"line":171,"column":11}},"83":{"start":{"line":158,"column":25},"end":{"line":158,"column":46}},"84":{"start":{"line":159,"column":12},"end":{"line":159,"column":56}},"85":{"start":{"line":160,"column":12},"end":{"line":165,"column":15}},"86":{"start":{"line":166,"column":12},"end":{"line":170,"column":38}},"87":{"start":{"line":172,"column":8},"end":{"line":185,"column":11}},"88":{"start":{"line":173,"column":25},"end":{"line":173,"column":46}},"89":{"start":{"line":174,"column":12},"end":{"line":174,"column":56}},"90":{"start":{"line":175,"column":12},"end":{"line":179,"column":15}},"91":{"start":{"line":180,"column":12},"end":{"line":184,"column":27}},"92":{"start":{"line":187,"column":4},"end":{"line":261,"column":7}},"93":{"start":{"line":188,"column":8},"end":{"line":193,"column":11}},"94":{"start":{"line":189,"column":25},"end":{"line":189,"column":46}},"95":{"start":{"line":190,"column":12},"end":{"line":190,"column":56}},"96":{"start":{"line":191,"column":12},"end":{"line":191,"column":60}},"97":{"start":{"line":192,"column":12},"end":{"line":192,"column":55}},"98":{"start":{"line":194,"column":8},"end":{"line":199,"column":11}},"99":{"start":{"line":195,"column":25},"end":{"line":195,"column":46}},"100":{"start":{"line":196,"column":12},"end":{"line":196,"column":56}},"101":{"start":{"line":197,"column":12},"end":{"line":197,"column":66}},"102":{"start":{"line":198,"column":12},"end":{"line":198,"column":55}},"103":{"start":{"line":200,"column":8},"end":{"line":207,"column":11}},"104":{"start":{"line":201,"column":25},"end":{"line":201,"column":46}},"105":{"start":{"line":202,"column":12},"end":{"line":202,"column":56}},"106":{"start":{"line":203,"column":12},"end":{"line":205,"column":15}},"107":{"start":{"line":206,"column":12},"end":{"line":206,"column":55}},"108":{"start":{"line":208,"column":8},"end":{"line":215,"column":11}},"109":{"start":{"line":209,"column":25},"end":{"line":209,"column":46}},"110":{"start":{"line":210,"column":12},"end":{"line":210,"column":56}},"111":{"start":{"line":211,"column":12},"end":{"line":213,"column":19}},"112":{"start":{"line":214,"column":12},"end":{"line":214,"column":55}},"113":{"start":{"line":216,"column":8},"end":{"line":227,"column":11}},"114":{"start":{"line":217,"column":25},"end":{"line":217,"column":46}},"115":{"start":{"line":218,"column":12},"end":{"line":218,"column":56}},"116":{"start":{"line":219,"column":12},"end":{"line":225,"column":15}},"117":{"start":{"line":226,"column":12},"end":{"line":226,"column":55}},"118":{"start":{"line":228,"column":8},"end":{"line":243,"column":11}},"119":{"start":{"line":229,"column":26},"end":{"line":229,"column":37}},"120":{"start":{"line":230,"column":12},"end":{"line":230,"column":64}},"121":{"start":{"line":231,"column":25},"end":{"line":231,"column":46}},"122":{"start":{"line":232,"column":12},"end":{"line":232,"column":56}},"123":{"start":{"line":234,"column":12},"end":{"line":241,"column":44}},"124":{"start":{"line":242,"column":12},"end":{"line":242,"column":55}},"125":{"start":{"line":244,"column":8},"end":{"line":260,"column":11}},"126":{"start":{"line":245,"column":25},"end":{"line":245,"column":46}},"127":{"start":{"line":246,"column":12},"end":{"line":246,"column":56}},"128":{"start":{"line":247,"column":12},"end":{"line":254,"column":15}},"129":{"start":{"line":255,"column":12},"end":{"line":259,"column":38}},"130":{"start":{"line":262,"column":4},"end":{"line":328,"column":7}},"131":{"start":{"line":263,"column":8},"end":{"line":268,"column":11}},"132":{"start":{"line":264,"column":25},"end":{"line":264,"column":46}},"133":{"start":{"line":265,"column":12},"end":{"line":265,"column":63}},"134":{"start":{"line":266,"column":12},"end":{"line":266,"column":70}},"135":{"start":{"line":267,"column":12},"end":{"line":267,"column":55}},"136":{"start":{"line":269,"column":8},"end":{"line":274,"column":11}},"137":{"start":{"line":270,"column":25},"end":{"line":270,"column":46}},"138":{"start":{"line":271,"column":12},"end":{"line":271,"column":63}},"139":{"start":{"line":272,"column":12},"end":{"line":272,"column":76}},"140":{"start":{"line":273,"column":12},"end":{"line":273,"column":55}},"141":{"start":{"line":275,"column":8},"end":{"line":282,"column":11}},"142":{"start":{"line":276,"column":25},"end":{"line":276,"column":46}},"143":{"start":{"line":277,"column":12},"end":{"line":277,"column":63}},"144":{"start":{"line":278,"column":12},"end":{"line":280,"column":15}},"145":{"start":{"line":281,"column":12},"end":{"line":281,"column":55}},"146":{"start":{"line":283,"column":8},"end":{"line":290,"column":11}},"147":{"start":{"line":284,"column":25},"end":{"line":284,"column":46}},"148":{"start":{"line":285,"column":12},"end":{"line":285,"column":63}},"149":{"start":{"line":286,"column":12},"end":{"line":288,"column":15}},"150":{"start":{"line":289,"column":12},"end":{"line":289,"column":55}},"151":{"start":{"line":291,"column":8},"end":{"line":300,"column":11}},"152":{"start":{"line":292,"column":25},"end":{"line":292,"column":46}},"153":{"start":{"line":293,"column":12},"end":{"line":293,"column":63}},"154":{"start":{"line":294,"column":12},"end":{"line":298,"column":15}},"155":{"start":{"line":299,"column":12},"end":{"line":299,"column":55}},"156":{"start":{"line":301,"column":8},"end":{"line":314,"column":11}},"157":{"start":{"line":302,"column":26},"end":{"line":302,"column":37}},"158":{"start":{"line":303,"column":12},"end":{"line":303,"column":64}},"159":{"start":{"line":304,"column":25},"end":{"line":304,"column":46}},"160":{"start":{"line":305,"column":12},"end":{"line":305,"column":63}},"161":{"start":{"line":307,"column":12},"end":{"line":312,"column":44}},"162":{"start":{"line":313,"column":12},"end":{"line":313,"column":55}},"163":{"start":{"line":315,"column":8},"end":{"line":327,"column":11}},"164":{"start":{"line":316,"column":25},"end":{"line":316,"column":46}},"165":{"start":{"line":317,"column":12},"end":{"line":317,"column":63}},"166":{"start":{"line":318,"column":12},"end":{"line":323,"column":15}},"167":{"start":{"line":324,"column":12},"end":{"line":326,"column":44}},"168":{"start":{"line":329,"column":4},"end":{"line":351,"column":7}},"169":{"start":{"line":330,"column":8},"end":{"line":335,"column":11}},"170":{"start":{"line":331,"column":25},"end":{"line":331,"column":46}},"171":{"start":{"line":332,"column":12},"end":{"line":332,"column":66}},"172":{"start":{"line":333,"column":12},"end":{"line":333,"column":71}},"173":{"start":{"line":334,"column":12},"end":{"line":334,"column":55}},"174":{"start":{"line":336,"column":8},"end":{"line":344,"column":11}},"175":{"start":{"line":337,"column":26},"end":{"line":337,"column":37}},"176":{"start":{"line":338,"column":12},"end":{"line":338,"column":64}},"177":{"start":{"line":339,"column":25},"end":{"line":339,"column":46}},"178":{"start":{"line":340,"column":12},"end":{"line":340,"column":66}},"179":{"start":{"line":342,"column":12},"end":{"line":342,"column":120}},"180":{"start":{"line":343,"column":12},"end":{"line":343,"column":55}},"181":{"start":{"line":345,"column":8},"end":{"line":350,"column":11}},"182":{"start":{"line":346,"column":25},"end":{"line":346,"column":46}},"183":{"start":{"line":347,"column":12},"end":{"line":347,"column":66}},"184":{"start":{"line":348,"column":12},"end":{"line":348,"column":73}},"185":{"start":{"line":349,"column":12},"end":{"line":349,"column":62}},"186":{"start":{"line":352,"column":4},"end":{"line":408,"column":7}},"187":{"start":{"line":353,"column":8},"end":{"line":358,"column":11}},"188":{"start":{"line":354,"column":25},"end":{"line":354,"column":46}},"189":{"start":{"line":355,"column":12},"end":{"line":355,"column":57}},"190":{"start":{"line":356,"column":12},"end":{"line":356,"column":65}},"191":{"start":{"line":357,"column":12},"end":{"line":357,"column":55}},"192":{"start":{"line":359,"column":8},"end":{"line":364,"column":11}},"193":{"start":{"line":360,"column":25},"end":{"line":360,"column":46}},"194":{"start":{"line":361,"column":12},"end":{"line":361,"column":57}},"195":{"start":{"line":362,"column":12},"end":{"line":362,"column":71}},"196":{"start":{"line":363,"column":12},"end":{"line":363,"column":55}},"197":{"start":{"line":365,"column":8},"end":{"line":372,"column":11}},"198":{"start":{"line":366,"column":25},"end":{"line":366,"column":46}},"199":{"start":{"line":367,"column":12},"end":{"line":367,"column":57}},"200":{"start":{"line":368,"column":12},"end":{"line":370,"column":15}},"201":{"start":{"line":371,"column":12},"end":{"line":371,"column":55}},"202":{"start":{"line":373,"column":8},"end":{"line":380,"column":11}},"203":{"start":{"line":374,"column":25},"end":{"line":374,"column":46}},"204":{"start":{"line":375,"column":12},"end":{"line":375,"column":57}},"205":{"start":{"line":376,"column":12},"end":{"line":378,"column":19}},"206":{"start":{"line":379,"column":12},"end":{"line":379,"column":55}},"207":{"start":{"line":381,"column":8},"end":{"line":394,"column":11}},"208":{"start":{"line":382,"column":26},"end":{"line":382,"column":37}},"209":{"start":{"line":383,"column":12},"end":{"line":383,"column":64}},"210":{"start":{"line":384,"column":25},"end":{"line":384,"column":46}},"211":{"start":{"line":385,"column":12},"end":{"line":385,"column":57}},"212":{"start":{"line":387,"column":12},"end":{"line":392,"column":44}},"213":{"start":{"line":393,"column":12},"end":{"line":393,"column":55}},"214":{"start":{"line":395,"column":8},"end":{"line":407,"column":11}},"215":{"start":{"line":396,"column":25},"end":{"line":396,"column":46}},"216":{"start":{"line":397,"column":12},"end":{"line":397,"column":57}},"217":{"start":{"line":398,"column":12},"end":{"line":403,"column":15}},"218":{"start":{"line":404,"column":12},"end":{"line":406,"column":38}},"219":{"start":{"line":409,"column":4},"end":{"line":420,"column":7}},"220":{"start":{"line":410,"column":8},"end":{"line":419,"column":11}},"221":{"start":{"line":411,"column":12},"end":{"line":411,"column":51}},"222":{"start":{"line":412,"column":12},"end":{"line":412,"column":63}},"223":{"start":{"line":413,"column":12},"end":{"line":413,"column":155}},"224":{"start":{"line":414,"column":12},"end":{"line":414,"column":153}},"225":{"start":{"line":415,"column":12},"end":{"line":415,"column":150}},"226":{"start":{"line":416,"column":12},"end":{"line":416,"column":140}},"227":{"start":{"line":417,"column":12},"end":{"line":417,"column":152}},"228":{"start":{"line":418,"column":12},"end":{"line":418,"column":158}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":8,"column":9},"end":{"line":8,"column":33}},"loc":{"start":{"line":8,"column":39},"end":{"line":12,"column":1}},"line":8},"1":{"name":"(anonymous_1)","decl":{"start":{"line":22,"column":16},"end":{"line":22,"column":17}},"loc":{"start":{"line":22,"column":20},"end":{"line":22,"column":21}},"line":22},"2":{"name":"(anonymous_2)","decl":{"start":{"line":32,"column":17},"end":{"line":32,"column":18}},"loc":{"start":{"line":32,"column":52},"end":{"line":35,"column":13}},"line":32},"3":{"name":"(anonymous_3)","decl":{"start":{"line":42,"column":63},"end":{"line":42,"column":64}},"loc":{"start":{"line":42,"column":67},"end":{"line":421,"column":1}},"line":42},"4":{"name":"(anonymous_4)","decl":{"start":{"line":43,"column":14},"end":{"line":43,"column":15}},"loc":{"start":{"line":43,"column":18},"end":{"line":46,"column":5}},"line":43},"5":{"name":"(anonymous_5)","decl":{"start":{"line":47,"column":42},"end":{"line":47,"column":43}},"loc":{"start":{"line":47,"column":46},"end":{"line":113,"column":5}},"line":47},"6":{"name":"(anonymous_6)","decl":{"start":{"line":48,"column":70},"end":{"line":48,"column":71}},"loc":{"start":{"line":48,"column":74},"end":{"line":53,"column":9}},"line":48},"7":{"name":"(anonymous_7)","decl":{"start":{"line":54,"column":84},"end":{"line":54,"column":85}},"loc":{"start":{"line":54,"column":88},"end":{"line":59,"column":9}},"line":54},"8":{"name":"(anonymous_8)","decl":{"start":{"line":60,"column":73},"end":{"line":60,"column":74}},"loc":{"start":{"line":60,"column":77},"end":{"line":67,"column":9}},"line":60},"9":{"name":"(anonymous_9)","decl":{"start":{"line":68,"column":71},"end":{"line":68,"column":72}},"loc":{"start":{"line":68,"column":75},"end":{"line":75,"column":9}},"line":68},"10":{"name":"(anonymous_10)","decl":{"start":{"line":76,"column":77},"end":{"line":76,"column":78}},"loc":{"start":{"line":76,"column":81},"end":{"line":85,"column":9}},"line":76},"11":{"name":"(anonymous_11)","decl":{"start":{"line":86,"column":80},"end":{"line":86,"column":81}},"loc":{"start":{"line":86,"column":84},"end":{"line":99,"column":9}},"line":86},"12":{"name":"(anonymous_12)","decl":{"start":{"line":100,"column":69},"end":{"line":100,"column":70}},"loc":{"start":{"line":100,"column":73},"end":{"line":112,"column":9}},"line":100},"13":{"name":"(anonymous_13)","decl":{"start":{"line":114,"column":58},"end":{"line":114,"column":59}},"loc":{"start":{"line":114,"column":62},"end":{"line":186,"column":5}},"line":114},"14":{"name":"(anonymous_14)","decl":{"start":{"line":115,"column":70},"end":{"line":115,"column":71}},"loc":{"start":{"line":115,"column":74},"end":{"line":120,"column":9}},"line":115},"15":{"name":"(anonymous_15)","decl":{"start":{"line":121,"column":84},"end":{"line":121,"column":85}},"loc":{"start":{"line":121,"column":88},"end":{"line":126,"column":9}},"line":121},"16":{"name":"(anonymous_16)","decl":{"start":{"line":127,"column":73},"end":{"line":127,"column":74}},"loc":{"start":{"line":127,"column":77},"end":{"line":134,"column":9}},"line":127},"17":{"name":"(anonymous_17)","decl":{"start":{"line":135,"column":70},"end":{"line":135,"column":71}},"loc":{"start":{"line":135,"column":74},"end":{"line":142,"column":9}},"line":135},"18":{"name":"(anonymous_18)","decl":{"start":{"line":143,"column":80},"end":{"line":143,"column":81}},"loc":{"start":{"line":143,"column":84},"end":{"line":156,"column":9}},"line":143},"19":{"name":"(anonymous_19)","decl":{"start":{"line":157,"column":69},"end":{"line":157,"column":70}},"loc":{"start":{"line":157,"column":73},"end":{"line":171,"column":9}},"line":157},"20":{"name":"(anonymous_20)","decl":{"start":{"line":172,"column":90},"end":{"line":172,"column":91}},"loc":{"start":{"line":172,"column":94},"end":{"line":185,"column":9}},"line":172},"21":{"name":"(anonymous_21)","decl":{"start":{"line":187,"column":70},"end":{"line":187,"column":71}},"loc":{"start":{"line":187,"column":74},"end":{"line":261,"column":5}},"line":187},"22":{"name":"(anonymous_22)","decl":{"start":{"line":188,"column":70},"end":{"line":188,"column":71}},"loc":{"start":{"line":188,"column":74},"end":{"line":193,"column":9}},"line":188},"23":{"name":"(anonymous_23)","decl":{"start":{"line":194,"column":84},"end":{"line":194,"column":85}},"loc":{"start":{"line":194,"column":88},"end":{"line":199,"column":9}},"line":194},"24":{"name":"(anonymous_24)","decl":{"start":{"line":200,"column":73},"end":{"line":200,"column":74}},"loc":{"start":{"line":200,"column":77},"end":{"line":207,"column":9}},"line":200},"25":{"name":"(anonymous_25)","decl":{"start":{"line":208,"column":70},"end":{"line":208,"column":71}},"loc":{"start":{"line":208,"column":74},"end":{"line":215,"column":9}},"line":208},"26":{"name":"(anonymous_26)","decl":{"start":{"line":216,"column":73},"end":{"line":216,"column":74}},"loc":{"start":{"line":216,"column":77},"end":{"line":227,"column":9}},"line":216},"27":{"name":"(anonymous_27)","decl":{"start":{"line":228,"column":80},"end":{"line":228,"column":81}},"loc":{"start":{"line":228,"column":84},"end":{"line":243,"column":9}},"line":228},"28":{"name":"(anonymous_28)","decl":{"start":{"line":244,"column":69},"end":{"line":244,"column":70}},"loc":{"start":{"line":244,"column":73},"end":{"line":260,"column":9}},"line":244},"29":{"name":"(anonymous_29)","decl":{"start":{"line":262,"column":46},"end":{"line":262,"column":47}},"loc":{"start":{"line":262,"column":50},"end":{"line":328,"column":5}},"line":262},"30":{"name":"(anonymous_30)","decl":{"start":{"line":263,"column":70},"end":{"line":263,"column":71}},"loc":{"start":{"line":263,"column":74},"end":{"line":268,"column":9}},"line":263},"31":{"name":"(anonymous_31)","decl":{"start":{"line":269,"column":84},"end":{"line":269,"column":85}},"loc":{"start":{"line":269,"column":88},"end":{"line":274,"column":9}},"line":269},"32":{"name":"(anonymous_32)","decl":{"start":{"line":275,"column":73},"end":{"line":275,"column":74}},"loc":{"start":{"line":275,"column":77},"end":{"line":282,"column":9}},"line":275},"33":{"name":"(anonymous_33)","decl":{"start":{"line":283,"column":73},"end":{"line":283,"column":74}},"loc":{"start":{"line":283,"column":77},"end":{"line":290,"column":9}},"line":283},"34":{"name":"(anonymous_34)","decl":{"start":{"line":291,"column":75},"end":{"line":291,"column":76}},"loc":{"start":{"line":291,"column":79},"end":{"line":300,"column":9}},"line":291},"35":{"name":"(anonymous_35)","decl":{"start":{"line":301,"column":80},"end":{"line":301,"column":81}},"loc":{"start":{"line":301,"column":84},"end":{"line":314,"column":9}},"line":301},"36":{"name":"(anonymous_36)","decl":{"start":{"line":315,"column":69},"end":{"line":315,"column":70}},"loc":{"start":{"line":315,"column":73},"end":{"line":327,"column":9}},"line":315},"37":{"name":"(anonymous_37)","decl":{"start":{"line":329,"column":49},"end":{"line":329,"column":50}},"loc":{"start":{"line":329,"column":53},"end":{"line":351,"column":5}},"line":329},"38":{"name":"(anonymous_38)","decl":{"start":{"line":330,"column":73},"end":{"line":330,"column":74}},"loc":{"start":{"line":330,"column":77},"end":{"line":335,"column":9}},"line":330},"39":{"name":"(anonymous_39)","decl":{"start":{"line":336,"column":80},"end":{"line":336,"column":81}},"loc":{"start":{"line":336,"column":84},"end":{"line":344,"column":9}},"line":336},"40":{"name":"(anonymous_40)","decl":{"start":{"line":345,"column":69},"end":{"line":345,"column":70}},"loc":{"start":{"line":345,"column":73},"end":{"line":350,"column":9}},"line":345},"41":{"name":"(anonymous_41)","decl":{"start":{"line":352,"column":40},"end":{"line":352,"column":41}},"loc":{"start":{"line":352,"column":44},"end":{"line":408,"column":5}},"line":352},"42":{"name":"(anonymous_42)","decl":{"start":{"line":353,"column":70},"end":{"line":353,"column":71}},"loc":{"start":{"line":353,"column":74},"end":{"line":358,"column":9}},"line":353},"43":{"name":"(anonymous_43)","decl":{"start":{"line":359,"column":84},"end":{"line":359,"column":85}},"loc":{"start":{"line":359,"column":88},"end":{"line":364,"column":9}},"line":359},"44":{"name":"(anonymous_44)","decl":{"start":{"line":365,"column":73},"end":{"line":365,"column":74}},"loc":{"start":{"line":365,"column":77},"end":{"line":372,"column":9}},"line":365},"45":{"name":"(anonymous_45)","decl":{"start":{"line":373,"column":70},"end":{"line":373,"column":71}},"loc":{"start":{"line":373,"column":74},"end":{"line":380,"column":9}},"line":373},"46":{"name":"(anonymous_46)","decl":{"start":{"line":381,"column":80},"end":{"line":381,"column":81}},"loc":{"start":{"line":381,"column":84},"end":{"line":394,"column":9}},"line":381},"47":{"name":"(anonymous_47)","decl":{"start":{"line":395,"column":69},"end":{"line":395,"column":70}},"loc":{"start":{"line":395,"column":73},"end":{"line":407,"column":9}},"line":395},"48":{"name":"(anonymous_48)","decl":{"start":{"line":409,"column":38},"end":{"line":409,"column":39}},"loc":{"start":{"line":409,"column":42},"end":{"line":420,"column":5}},"line":409},"49":{"name":"(anonymous_49)","decl":{"start":{"line":410,"column":72},"end":{"line":410,"column":73}},"loc":{"start":{"line":410,"column":76},"end":{"line":419,"column":9}},"line":410}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":11},"end":{"line":11,"column":5}},"type":"cond-expr","locations":[{"start":{"line":9,"column":35},"end":{"line":9,"column":38}},{"start":{"line":9,"column":41},"end":{"line":11,"column":5}}],"line":9},"1":{"loc":{"start":{"line":9,"column":11},"end":{"line":9,"column":32}},"type":"binary-expr","locations":[{"start":{"line":9,"column":11},"end":{"line":9,"column":14}},{"start":{"line":9,"column":18},"end":{"line":9,"column":32}}],"line":9}},"s":{"0":1,"1":1,"2":1,"3":1,"4":2,"5":1,"6":1,"7":1,"8":1,"9":0,"10":51,"11":51,"12":1,"13":1,"14":38,"15":38,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1,"61":1,"62":1,"63":1,"64":1,"65":1,"66":1,"67":1,"68":1,"69":1,"70":1,"71":1,"72":1,"73":1,"74":1,"75":1,"76":1,"77":1,"78":1,"79":1,"80":1,"81":1,"82":1,"83":1,"84":1,"85":1,"86":1,"87":1,"88":1,"89":1,"90":1,"91":1,"92":1,"93":1,"94":1,"95":1,"96":1,"97":1,"98":1,"99":1,"100":1,"101":1,"102":1,"103":1,"104":1,"105":1,"106":1,"107":1,"108":1,"109":1,"110":1,"111":1,"112":1,"113":1,"114":1,"115":1,"116":1,"117":1,"118":1,"119":1,"120":1,"121":1,"122":1,"123":1,"124":1,"125":1,"126":1,"127":1,"128":1,"129":1,"130":1,"131":1,"132":1,"133":1,"134":1,"135":1,"136":1,"137":1,"138":1,"139":1,"140":1,"141":1,"142":1,"143":1,"144":1,"145":1,"146":1,"147":1,"148":1,"149":1,"150":1,"151":1,"152":1,"153":1,"154":1,"155":1,"156":1,"157":1,"158":1,"159":1,"160":1,"161":1,"162":1,"163":1,"164":1,"165":1,"166":1,"167":1,"168":1,"169":1,"170":1,"171":1,"172":1,"173":1,"174":1,"175":1,"176":1,"177":1,"178":1,"179":1,"180":1,"181":1,"182":1,"183":1,"184":1,"185":1,"186":1,"187":1,"188":1,"189":1,"190":1,"191":1,"192":1,"193":1,"194":1,"195":1,"196":1,"197":1,"198":1,"199":1,"200":1,"201":1,"202":1,"203":1,"204":1,"205":1,"206":1,"207":1,"208":1,"209":1,"210":1,"211":1,"212":1,"213":1,"214":1,"215":1,"216":1,"217":1,"218":1,"219":1,"220":1,"221":1,"222":1,"223":1,"224":1,"225":1,"226":1,"227":1,"228":1},"f":{"0":2,"1":0,"2":51,"3":1,"4":38,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1},"b":{"0":[0,2],"1":[2,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/infrastructure/rocket-chat/hooks/hooks.spec.ts"],"sourcesContent":["import { expect } from 'chai';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\nconst remove = sinon.stub();\nconst throwIfFederationNotEnabledOrNotReady = sinon.stub();\nconst hooks: Record<string, any> = {};\n\nconst { FederationHooksEE } = proxyquire\n\t.noCallThru()\n\t.load('../../../../../../../../server/local-services/federation/infrastructure/rocket-chat/hooks', {\n\t\t'meteor/meteor': {\n\t\t\t'@global': true,\n\t\t},\n\t\t'@rocket.chat/random': {\n\t\t\t'Random': {\n\t\t\t\tid: () => 1,\n\t\t\t},\n\t\t\t'@global': true,\n\t\t},\n\t\t'../../../../../../../lib/callbacks': {\n\t\t\tcallbacks: {\n\t\t\t\tpriority: { HIGH: 'high' },\n\t\t\t\tremove,\n\t\t\t\tadd: (_name: string, callback: (...args: any[]) => void, _priority: string, _id: string) => {\n\t\t\t\t\thooks[_id] = callback;\n\t\t\t\t\treturn callback;\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t'../../../../../../../server/services/federation/utils': {\n\t\t\tthrowIfFederationNotEnabledOrNotReady,\n\t\t},\n\t});\n\ndescribe('FederationEE - Infrastructure - RocketChat - Hooks', () => {\n\tafterEach(() => {\n\t\tremove.reset();\n\t\tthrowIfFederationNotEnabledOrNotReady.reset();\n\t});\n\n\tdescribe('#onFederatedRoomCreated()', () => {\n\t\tit('should NOT execute the callback if no room was provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onFederatedRoomCreated(stub);\n\t\t\thooks['federation-v2-after-create-room']();\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if the provided room is not federated', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onFederatedRoomCreated(stub);\n\t\t\thooks['federation-v2-after-create-room']({});\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if no params were provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onFederatedRoomCreated(stub);\n\t\t\thooks['federation-v2-after-create-room']({ federated: true });\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if no owner was provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onFederatedRoomCreated(stub);\n\t\t\thooks['federation-v2-after-create-room']({ federated: true }, {});\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if no member list was provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onFederatedRoomCreated(stub);\n\t\t\thooks['federation-v2-after-create-room']({ federated: true }, { owner: 'owner' });\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if federation module was disabled', () => {\n\t\t\tconst error = new Error();\n\t\t\tthrowIfFederationNotEnabledOrNotReady.throws(error);\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onFederatedRoomCreated(stub);\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-floating-promises\n\t\t\texpect(\n\t\t\t\thooks['federation-v2-after-create-room']({ federated: true }, { owner: 'owner', originalMemberList: [] }),\n\t\t\t).to.have.rejectedWith(error);\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should execute the callback when everything is correct', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onFederatedRoomCreated(stub);\n\t\t\thooks['federation-v2-after-create-room']({ federated: true }, { owner: 'owner', originalMemberList: [] });\n\t\t\texpect(stub.calledWith({ federated: true }, 'owner', [])).to.be.true;\n\t\t});\n\t});\n\n\tdescribe('#onUsersAddedToARoom() - afterAddedToRoom', () => {\n\t\tit('should NOT execute the callback if no room was provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onUsersAddedToARoom(stub);\n\t\t\thooks['federation-v2-after-add-user-to-a-room']();\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if the provided room is not federated', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onUsersAddedToARoom(stub);\n\t\t\thooks['federation-v2-after-add-user-to-a-room']({}, {});\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if no params were provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onUsersAddedToARoom(stub);\n\t\t\thooks['federation-v2-after-add-user-to-a-room']({}, { federated: true });\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if no user was provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onUsersAddedToARoom(stub);\n\t\t\thooks['federation-v2-after-add-user-to-a-room']({}, { federated: true }, {});\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if federation module was disabled', () => {\n\t\t\tconst error = new Error();\n\t\t\tthrowIfFederationNotEnabledOrNotReady.throws(error);\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onUsersAddedToARoom(stub);\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-floating-promises\n\t\t\texpect(\n\t\t\t\thooks['federation-v2-after-add-user-to-a-room']({ user: 'user', inviter: 'inviter' }, { federated: true }),\n\t\t\t).to.have.rejectedWith(error);\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should execute the callback when everything is correct', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onUsersAddedToARoom(stub);\n\t\t\thooks['federation-v2-after-add-user-to-a-room']({ user: 'user', inviter: 'inviter' }, { federated: true });\n\t\t\texpect(stub.calledWith({ federated: true }, ['user'], 'inviter')).to.be.true;\n\t\t});\n\n\t\tit('should execute the callback even if there is no inviter (when auto-joining)', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onUsersAddedToARoom(stub);\n\t\t\thooks['federation-v2-after-add-user-to-a-room']({ user: 'user' }, { federated: true });\n\t\t\texpect(stub.calledWith({ federated: true }, ['user'])).to.be.true;\n\t\t});\n\t});\n\tdescribe('#onUsersAddedToARoom() - federation.onAddUsersToARoom', () => {\n\t\tit('should NOT execute the callback if no room was provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onUsersAddedToARoom(stub);\n\t\t\thooks['federation-v2-on-add-users-to-a-room']();\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if the provided room is not federated', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onUsersAddedToARoom(stub);\n\t\t\thooks['federation-v2-on-add-users-to-a-room']({}, {});\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if no params were provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onUsersAddedToARoom(stub);\n\t\t\thooks['federation-v2-on-add-users-to-a-room']({}, { federated: true });\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if no user was provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onUsersAddedToARoom(stub);\n\t\t\thooks['federation-v2-on-add-users-to-a-room']({}, { federated: true }, {});\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if no inviter was provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onUsersAddedToARoom(stub);\n\t\t\thooks['federation-v2-on-add-users-to-a-room']({ invitees: ['user'] }, { federated: true });\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if federation module was disabled', () => {\n\t\t\tconst error = new Error();\n\t\t\tthrowIfFederationNotEnabledOrNotReady.throws(error);\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onUsersAddedToARoom(stub);\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-floating-promises\n\t\t\texpect(\n\t\t\t\thooks['federation-v2-on-add-users-to-a-room']({ invitees: ['user'], inviter: 'inviter' }, { federated: true }),\n\t\t\t).to.have.rejectedWith(error);\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should execute the callback when everything is correct', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onUsersAddedToARoom(stub);\n\t\t\thooks['federation-v2-on-add-users-to-a-room']({ invitees: ['user'], inviter: 'inviter' }, { federated: true });\n\t\t\texpect(stub.calledWith({ federated: true }, ['user'], 'inviter')).to.be.true;\n\t\t});\n\t});\n\n\tdescribe('#onDirectMessageRoomCreated()', () => {\n\t\tit('should NOT execute the callback if no room was provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onDirectMessageRoomCreated(stub);\n\t\t\thooks['federation-v2-after-create-direct-message-room']();\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if the provided room is not federated', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onDirectMessageRoomCreated(stub);\n\t\t\thooks['federation-v2-after-create-direct-message-room']({}, {});\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if no params were provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onDirectMessageRoomCreated(stub);\n\t\t\thooks['federation-v2-after-create-direct-message-room']({ federated: true });\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if no members was provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onDirectMessageRoomCreated(stub);\n\t\t\thooks['federation-v2-after-create-direct-message-room']({ federated: true });\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if no creatorId was provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onDirectMessageRoomCreated(stub);\n\t\t\thooks['federation-v2-after-create-direct-message-room']({ federated: true }, { members: [] });\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if federation module was disabled', () => {\n\t\t\tconst error = new Error();\n\t\t\tthrowIfFederationNotEnabledOrNotReady.throws(error);\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onDirectMessageRoomCreated(stub);\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-floating-promises\n\t\t\texpect(\n\t\t\t\thooks['federation-v2-after-create-direct-message-room']({ federated: true }, { creatorId: 'creatorId', members: [] }),\n\t\t\t).to.have.rejectedWith(error);\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should execute the callback when everything is correct', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.onDirectMessageRoomCreated(stub);\n\t\t\thooks['federation-v2-after-create-direct-message-room']({ federated: true }, { creatorId: 'creatorId', members: [] });\n\t\t\texpect(stub.calledWith({ federated: true }, 'creatorId', [])).to.be.true;\n\t\t});\n\t});\n\n\tdescribe('#beforeDirectMessageRoomCreate()', () => {\n\t\tit('should NOT execute the callback if no members was provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.beforeDirectMessageRoomCreate(stub);\n\t\t\thooks['federation-v2-before-create-direct-message-room']();\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if federation module was disabled', () => {\n\t\t\tconst error = new Error();\n\t\t\tthrowIfFederationNotEnabledOrNotReady.throws(error);\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.beforeDirectMessageRoomCreate(stub);\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-floating-promises\n\t\t\texpect(hooks['federation-v2-before-create-direct-message-room']([])).to.have.rejectedWith(error);\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should execute the callback when everything is correct', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.beforeDirectMessageRoomCreate(stub);\n\t\t\thooks['federation-v2-before-create-direct-message-room']([]);\n\t\t\texpect(stub.calledWith([])).to.be.true;\n\t\t});\n\t});\n\n\tdescribe('#beforeAddUserToARoom()', () => {\n\t\tit('should NOT execute the callback if no room was provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.beforeAddUserToARoom(stub);\n\t\t\thooks['federation-v2-before-add-user-to-the-room']();\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if the provided room is not federated', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.beforeAddUserToARoom(stub);\n\t\t\thooks['federation-v2-before-add-user-to-the-room']({}, {});\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if no params were provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.beforeAddUserToARoom(stub);\n\t\t\thooks['federation-v2-before-add-user-to-the-room']({}, { federated: true });\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if no user was provided', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.beforeAddUserToARoom(stub);\n\t\t\thooks['federation-v2-before-add-user-to-the-room']({}, { federated: true }, {});\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should NOT execute the callback if federation module was disabled', () => {\n\t\t\tconst error = new Error();\n\t\t\tthrowIfFederationNotEnabledOrNotReady.throws(error);\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.beforeAddUserToARoom(stub);\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-floating-promises\n\t\t\texpect(\n\t\t\t\thooks['federation-v2-before-add-user-to-the-room']({ user: 'user', inviter: 'inviter' }, { federated: true }),\n\t\t\t).to.have.rejectedWith(error);\n\t\t\texpect(stub.called).to.be.false;\n\t\t});\n\n\t\tit('should execute the callback when everything is correct', () => {\n\t\t\tconst stub = sinon.stub();\n\t\t\tFederationHooksEE.beforeAddUserToARoom(stub);\n\t\t\thooks['federation-v2-before-add-user-to-the-room']({ user: 'user', inviter: 'inviter' }, { federated: true });\n\t\t\texpect(stub.calledWith('user', { federated: true }, 'inviter')).to.be.true;\n\t\t});\n\t});\n\n\tdescribe('#removeAllListeners()', () => {\n\t\tit('should remove the specific validation for EE environments', () => {\n\t\t\tFederationHooksEE.removeAllListeners();\n\t\t\texpect(remove.callCount).to.be.equal(6);\n\t\t\texpect(remove.getCall(0).calledWith('beforeCreateDirectRoom', 'federation-v2-before-create-direct-message-room')).to.be.equal(true);\n\t\t\texpect(remove.getCall(1).calledWith('afterCreateDirectRoom', 'federation-v2-after-create-direct-message-room')).to.be.equal(true);\n\t\t\texpect(remove.getCall(2).calledWith('federation.onAddUsersToARoom', 'federation-v2-on-add-users-to-a-room')).to.be.equal(true);\n\t\t\texpect(remove.getCall(3).calledWith('afterAddedToRoom', 'federation-v2-after-add-user-to-a-room')).to.be.equal(true);\n\t\t\texpect(remove.getCall(4).calledWith('federation.afterCreateFederatedRoom', 'federation-v2-after-create-room')).to.be.equal(true);\n\t\t\texpect(remove.getCall(5).calledWith('federation.beforeAddUserToARoom', 'federation-v2-before-add-user-to-the-room')).to.be.equal(\n\t\t\t\ttrue,\n\t\t\t);\n\t\t});\n\t});\n});\n"],"names":["remove","sinon","stub","throwIfFederationNotEnabledOrNotReady","hooks","FederationHooksEE","proxyquire","noCallThru","load","id","callbacks","priority","HIGH","add","_name","callback","_priority","_id","describe","afterEach","reset","it","onFederatedRoomCreated","expect","called","to","be","false","federated","owner","error","Error","throws","originalMemberList","have","rejectedWith","calledWith","true","onUsersAddedToARoom","user","inviter","invitees","onDirectMessageRoomCreated","members","creatorId","beforeDirectMessageRoomCreate","beforeAddUserToARoom","removeAllListeners","callCount","equal","getCall"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/infrastructure/rocket-chat/hooks/hooks.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"fcf382e1f71cf25f64218409d8f0ae306ad52d41","contentHash":"36cb35ca8d97b5250a9087220aed220260c6e849ffe581606aa0b585d1459ca6"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/rocket-chat/hooks/index.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/rocket-chat/hooks/index.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":33}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":19},"end":{"line":12,"column":64}},"5":{"start":{"line":13,"column":15},"end":{"line":13,"column":79}},"6":{"start":{"line":14,"column":24},"end":{"line":77,"column":1}},"7":{"start":{"line":16,"column":8},"end":{"line":22,"column":82}},"8":{"start":{"line":17,"column":12},"end":{"line":19,"column":13}},"9":{"start":{"line":18,"column":16},"end":{"line":18,"column":23}},"10":{"start":{"line":20,"column":12},"end":{"line":20,"column":64}},"11":{"start":{"line":21,"column":12},"end":{"line":21,"column":74}},"12":{"start":{"line":25,"column":8},"end":{"line":31,"column":87}},"13":{"start":{"line":26,"column":12},"end":{"line":28,"column":13}},"14":{"start":{"line":27,"column":16},"end":{"line":27,"column":23}},"15":{"start":{"line":29,"column":12},"end":{"line":29,"column":64}},"16":{"start":{"line":30,"column":12},"end":{"line":30,"column":66}},"17":{"start":{"line":32,"column":8},"end":{"line":40,"column":89}},"18":{"start":{"line":33,"column":12},"end":{"line":35,"column":13}},"19":{"start":{"line":34,"column":16},"end":{"line":34,"column":23}},"20":{"start":{"line":36,"column":12},"end":{"line":36,"column":64}},"21":{"start":{"line":37,"column":12},"end":{"line":39,"column":79}},"22":{"start":{"line":43,"column":8},"end":{"line":49,"column":97}},"23":{"start":{"line":44,"column":12},"end":{"line":46,"column":13}},"24":{"start":{"line":45,"column":16},"end":{"line":45,"column":23}},"25":{"start":{"line":47,"column":12},"end":{"line":47,"column":64}},"26":{"start":{"line":48,"column":12},"end":{"line":48,"column":67}},"27":{"start":{"line":52,"column":8},"end":{"line":58,"column":98}},"28":{"start":{"line":53,"column":12},"end":{"line":55,"column":13}},"29":{"start":{"line":54,"column":16},"end":{"line":54,"column":23}},"30":{"start":{"line":56,"column":12},"end":{"line":56,"column":64}},"31":{"start":{"line":57,"column":12},"end":{"line":57,"column":36}},"32":{"start":{"line":61,"column":8},"end":{"line":67,"column":92}},"33":{"start":{"line":62,"column":12},"end":{"line":64,"column":13}},"34":{"start":{"line":63,"column":16},"end":{"line":63,"column":23}},"35":{"start":{"line":65,"column":12},"end":{"line":65,"column":64}},"36":{"start":{"line":66,"column":12},"end":{"line":66,"column":62}},"37":{"start":{"line":70,"column":8},"end":{"line":70,"column":113}},"38":{"start":{"line":71,"column":8},"end":{"line":71,"column":111}},"39":{"start":{"line":72,"column":8},"end":{"line":72,"column":108}},"40":{"start":{"line":73,"column":8},"end":{"line":73,"column":98}},"41":{"start":{"line":74,"column":8},"end":{"line":74,"column":110}},"42":{"start":{"line":75,"column":8},"end":{"line":75,"column":116}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":44},"end":{"line":23,"column":5}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":72},"end":{"line":16,"column":73}},"loc":{"start":{"line":16,"column":94},"end":{"line":22,"column":9}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":24,"column":4},"end":{"line":24,"column":5}},"loc":{"start":{"line":24,"column":41},"end":{"line":41,"column":5}},"line":24},"4":{"name":"(anonymous_4)","decl":{"start":{"line":25,"column":65},"end":{"line":25,"column":66}},"loc":{"start":{"line":25,"column":87},"end":{"line":31,"column":9}},"line":25},"5":{"name":"(anonymous_5)","decl":{"start":{"line":32,"column":53},"end":{"line":32,"column":54}},"loc":{"start":{"line":32,"column":75},"end":{"line":40,"column":9}},"line":32},"6":{"name":"(anonymous_6)","decl":{"start":{"line":42,"column":4},"end":{"line":42,"column":5}},"loc":{"start":{"line":42,"column":48},"end":{"line":50,"column":5}},"line":42},"7":{"name":"(anonymous_7)","decl":{"start":{"line":43,"column":58},"end":{"line":43,"column":59}},"loc":{"start":{"line":43,"column":80},"end":{"line":49,"column":9}},"line":43},"8":{"name":"(anonymous_8)","decl":{"start":{"line":51,"column":4},"end":{"line":51,"column":5}},"loc":{"start":{"line":51,"column":51},"end":{"line":59,"column":5}},"line":51},"9":{"name":"(anonymous_9)","decl":{"start":{"line":52,"column":59},"end":{"line":52,"column":60}},"loc":{"start":{"line":52,"column":76},"end":{"line":58,"column":9}},"line":52},"10":{"name":"(anonymous_10)","decl":{"start":{"line":60,"column":4},"end":{"line":60,"column":5}},"loc":{"start":{"line":60,"column":42},"end":{"line":68,"column":5}},"line":60},"11":{"name":"(anonymous_11)","decl":{"start":{"line":61,"column":68},"end":{"line":61,"column":69}},"loc":{"start":{"line":61,"column":90},"end":{"line":67,"column":9}},"line":61},"12":{"name":"(anonymous_12)","decl":{"start":{"line":69,"column":4},"end":{"line":69,"column":5}},"loc":{"start":{"line":69,"column":32},"end":{"line":76,"column":5}},"line":69}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":12},"end":{"line":19,"column":13}},"type":"if","locations":[{"start":{"line":17,"column":12},"end":{"line":19,"column":13}},{"start":{"line":17,"column":12},"end":{"line":19,"column":13}}],"line":17},"1":{"loc":{"start":{"line":17,"column":16},"end":{"line":17,"column":123}},"type":"binary-expr","locations":[{"start":{"line":17,"column":16},"end":{"line":17,"column":21}},{"start":{"line":17,"column":25},"end":{"line":17,"column":65}},{"start":{"line":17,"column":69},"end":{"line":17,"column":76}},{"start":{"line":17,"column":80},"end":{"line":17,"column":93}},{"start":{"line":17,"column":97},"end":{"line":17,"column":123}}],"line":17},"2":{"loc":{"start":{"line":26,"column":12},"end":{"line":28,"column":13}},"type":"if","locations":[{"start":{"line":26,"column":12},"end":{"line":28,"column":13}},{"start":{"line":26,"column":12},"end":{"line":28,"column":13}}],"line":26},"3":{"loc":{"start":{"line":26,"column":16},"end":{"line":26,"column":115}},"type":"binary-expr","locations":[{"start":{"line":26,"column":16},"end":{"line":26,"column":21}},{"start":{"line":26,"column":25},"end":{"line":26,"column":65}},{"start":{"line":26,"column":69},"end":{"line":26,"column":76}},{"start":{"line":26,"column":80},"end":{"line":26,"column":96}},{"start":{"line":26,"column":100},"end":{"line":26,"column":115}}],"line":26},"4":{"loc":{"start":{"line":33,"column":12},"end":{"line":35,"column":13}},"type":"if","locations":[{"start":{"line":33,"column":12},"end":{"line":35,"column":13}},{"start":{"line":33,"column":12},"end":{"line":35,"column":13}}],"line":33},"5":{"loc":{"start":{"line":33,"column":16},"end":{"line":33,"column":92}},"type":"binary-expr","locations":[{"start":{"line":33,"column":16},"end":{"line":33,"column":21}},{"start":{"line":33,"column":25},"end":{"line":33,"column":65}},{"start":{"line":33,"column":69},"end":{"line":33,"column":76}},{"start":{"line":33,"column":80},"end":{"line":33,"column":92}}],"line":33},"6":{"loc":{"start":{"line":39,"column":15},"end":{"line":39,"column":77}},"type":"cond-expr","locations":[{"start":{"line":39,"column":54},"end":{"line":39,"column":60}},{"start":{"line":39,"column":63},"end":{"line":39,"column":77}}],"line":39},"7":{"loc":{"start":{"line":39,"column":15},"end":{"line":39,"column":51}},"type":"binary-expr","locations":[{"start":{"line":39,"column":15},"end":{"line":39,"column":30}},{"start":{"line":39,"column":34},"end":{"line":39,"column":51}}],"line":39},"8":{"loc":{"start":{"line":44,"column":12},"end":{"line":46,"column":13}},"type":"if","locations":[{"start":{"line":44,"column":12},"end":{"line":46,"column":13}},{"start":{"line":44,"column":12},"end":{"line":46,"column":13}}],"line":44},"9":{"loc":{"start":{"line":44,"column":16},"end":{"line":44,"column":74}},"type":"binary-expr","locations":[{"start":{"line":44,"column":16},"end":{"line":44,"column":21}},{"start":{"line":44,"column":25},"end":{"line":44,"column":32}},{"start":{"line":44,"column":36},"end":{"line":44,"column":53}},{"start":{"line":44,"column":57},"end":{"line":44,"column":74}}],"line":44},"10":{"loc":{"start":{"line":53,"column":12},"end":{"line":55,"column":13}},"type":"if","locations":[{"start":{"line":53,"column":12},"end":{"line":55,"column":13}},{"start":{"line":53,"column":12},"end":{"line":55,"column":13}}],"line":53},"11":{"loc":{"start":{"line":62,"column":12},"end":{"line":64,"column":13}},"type":"if","locations":[{"start":{"line":62,"column":12},"end":{"line":64,"column":13}},{"start":{"line":62,"column":12},"end":{"line":64,"column":13}}],"line":62},"12":{"loc":{"start":{"line":62,"column":16},"end":{"line":62,"column":92}},"type":"binary-expr","locations":[{"start":{"line":62,"column":16},"end":{"line":62,"column":21}},{"start":{"line":62,"column":25},"end":{"line":62,"column":65}},{"start":{"line":62,"column":69},"end":{"line":62,"column":76}},{"start":{"line":62,"column":80},"end":{"line":62,"column":92}}],"line":62}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":7,"8":7,"9":5,"10":2,"11":1,"12":14,"13":7,"14":5,"15":2,"16":1,"17":14,"18":7,"19":4,"20":3,"21":2,"22":7,"23":7,"24":5,"25":2,"26":1,"27":3,"28":3,"29":1,"30":2,"31":1,"32":6,"33":6,"34":4,"35":2,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1},"f":{"0":1,"1":7,"2":7,"3":14,"4":7,"5":7,"6":7,"7":7,"8":3,"9":3,"10":6,"11":6,"12":1},"b":{"0":[5,2],"1":[7,6,5,4,3],"2":[5,2],"3":[7,6,5,5,3],"4":[4,3],"5":[7,6,5,5],"6":[0,2],"7":[2,2],"8":[5,2],"9":[7,6,4,2],"10":[1,2],"11":[4,2],"12":[6,5,4,4]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/rocket-chat/hooks/index.ts"],"sourcesContent":["import type { IRoom, IUser, Username } from '@rocket.chat/core-typings';\nimport { isRoomFederated } from '@rocket.chat/core-typings';\n\nimport { callbacks } from '../../../../../../../lib/callbacks';\nimport { throwIfFederationNotEnabledOrNotReady } from '../../../../../../../server/services/federation/utils';\n\nexport class FederationHooksEE {\n\tpublic static onFederatedRoomCreated(callback: (room: IRoom, owner: IUser, originalMemberList: string[]) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'federation.afterCreateFederatedRoom',\n\t\t\tasync (room: IRoom, params: { owner: IUser; originalMemberList: string[] }) => {\n\t\t\t\tif (!room || !isRoomFederated(room) || !params || !params.owner || !params.originalMemberList) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\n\t\t\t\tawait callback(room, params.owner, params.originalMemberList);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-after-create-room',\n\t\t);\n\t}\n\n\tpublic static onUsersAddedToARoom(callback: (room: IRoom, addedUsers: IUser[] | Username[], inviter?: IUser) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'federation.onAddUsersToARoom',\n\t\t\tasync (params: { invitees: IUser[] | Username[]; inviter: IUser }, room: IRoom) => {\n\t\t\t\tif (!room || !isRoomFederated(room) || !params || !params.invitees || !params.inviter) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\n\t\t\t\tawait callback(room, params.invitees, params.inviter);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-on-add-users-to-a-room',\n\t\t);\n\t\tcallbacks.add(\n\t\t\t'afterAddedToRoom',\n\t\t\tasync (params: { user: IUser; inviter?: IUser }, room: IRoom) => {\n\t\t\t\tif (!room || !isRoomFederated(room) || !params || !params.user) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\n\t\t\t\tawait callback(room, [params.user], params?.inviter);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-after-add-user-to-a-room',\n\t\t);\n\t}\n\n\tpublic static onDirectMessageRoomCreated(callback: (room: IRoom, creatorId: string, memberList: IUser[]) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'afterCreateDirectRoom',\n\t\t\tasync (room: IRoom, params: { members: IUser[]; creatorId: IUser['_id'] }) => {\n\t\t\t\tif (!room || !params || !params.creatorId || !params.creatorId) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\t\t\t\tawait callback(room, params.creatorId, params.members);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-after-create-direct-message-room',\n\t\t);\n\t}\n\n\tpublic static beforeDirectMessageRoomCreate(callback: (memberList: IUser[]) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'beforeCreateDirectRoom',\n\t\t\tasync (members: IUser[]) => {\n\t\t\t\tif (!members) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\t\t\t\tawait callback(members);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-before-create-direct-message-room',\n\t\t);\n\t}\n\n\tpublic static beforeAddUserToARoom(callback: (userToBeAdded: IUser | string, room: IRoom, inviter?: IUser) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'federation.beforeAddUserToARoom',\n\t\t\tasync (params: { user: IUser | string; inviter?: IUser }, room: IRoom) => {\n\t\t\t\tif (!room || !isRoomFederated(room) || !params || !params.user) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\t\t\t\tawait callback(params.user, room, params.inviter);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-before-add-user-to-the-room',\n\t\t);\n\t}\n\n\tpublic static removeAllListeners(): void {\n\t\tcallbacks.remove('beforeCreateDirectRoom', 'federation-v2-before-create-direct-message-room');\n\t\tcallbacks.remove('afterCreateDirectRoom', 'federation-v2-after-create-direct-message-room');\n\t\tcallbacks.remove('federation.onAddUsersToARoom', 'federation-v2-on-add-users-to-a-room');\n\t\tcallbacks.remove('afterAddedToRoom', 'federation-v2-after-add-user-to-a-room');\n\t\tcallbacks.remove('federation.afterCreateFederatedRoom', 'federation-v2-after-create-room');\n\t\tcallbacks.remove('federation.beforeAddUserToARoom', 'federation-v2-before-add-user-to-the-room');\n\t}\n}\n"],"names":["FederationHooksEE","onFederatedRoomCreated","callback","callbacks","add","room","params","isRoomFederated","owner","originalMemberList","throwIfFederationNotEnabledOrNotReady","priority","HIGH","onUsersAddedToARoom","invitees","inviter","user","onDirectMessageRoomCreated","creatorId","members","beforeDirectMessageRoomCreate","beforeAddUserToARoom","removeAllListeners","remove"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/rocket-chat/hooks/index.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4dae1fdf4776a05f19073e22068ead6db58510ac","contentHash":"9e167fab1f41ce31399d703368f387e72d69e304702f2743cf76c3842b41f937"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/infrastructure/rocket-chat/slash-commands/actions.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/infrastructure/rocket-chat/slash-commands/actions.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":34},"end":{"line":6,"column":81}},"3":{"start":{"line":7,"column":29},"end":{"line":7,"column":71}},"4":{"start":{"line":9,"column":4},"end":{"line":11,"column":6}},"5":{"start":{"line":13,"column":32},"end":{"line":25,"column":2}},"6":{"start":{"line":17,"column":16},"end":{"line":21,"column":17}},"7":{"start":{"line":18,"column":20},"end":{"line":20,"column":22}},"8":{"start":{"line":26,"column":0},"end":{"line":82,"column":3}},"9":{"start":{"line":27,"column":20},"end":{"line":27,"column":41}},"10":{"start":{"line":28,"column":4},"end":{"line":81,"column":7}},"11":{"start":{"line":29,"column":30},"end":{"line":31,"column":9}},"12":{"start":{"line":30,"column":57},"end":{"line":30,"column":97}},"13":{"start":{"line":32,"column":30},"end":{"line":32,"column":38}},"14":{"start":{"line":33,"column":8},"end":{"line":35,"column":11}},"15":{"start":{"line":34,"column":12},"end":{"line":34,"column":122}},"16":{"start":{"line":36,"column":8},"end":{"line":38,"column":11}},"17":{"start":{"line":37,"column":12},"end":{"line":37,"column":117}},"18":{"start":{"line":39,"column":8},"end":{"line":41,"column":11}},"19":{"start":{"line":40,"column":12},"end":{"line":40,"column":123}},"20":{"start":{"line":42,"column":8},"end":{"line":44,"column":11}},"21":{"start":{"line":43,"column":12},"end":{"line":43,"column":123}},"22":{"start":{"line":45,"column":8},"end":{"line":51,"column":11}},"23":{"start":{"line":46,"column":12},"end":{"line":50,"column":13}},"24":{"start":{"line":47,"column":16},"end":{"line":47,"column":113}},"25":{"start":{"line":49,"column":16},"end":{"line":49,"column":95}},"26":{"start":{"line":52,"column":8},"end":{"line":58,"column":11}},"27":{"start":{"line":53,"column":12},"end":{"line":57,"column":13}},"28":{"start":{"line":54,"column":16},"end":{"line":54,"column":113}},"29":{"start":{"line":56,"column":16},"end":{"line":56,"column":95}},"30":{"start":{"line":59,"column":8},"end":{"line":65,"column":11}},"31":{"start":{"line":60,"column":12},"end":{"line":64,"column":13}},"32":{"start":{"line":61,"column":16},"end":{"line":61,"column":110}},"33":{"start":{"line":63,"column":16},"end":{"line":63,"column":95}},"34":{"start":{"line":66,"column":8},"end":{"line":72,"column":11}},"35":{"start":{"line":67,"column":12},"end":{"line":71,"column":13}},"36":{"start":{"line":68,"column":16},"end":{"line":68,"column":119}},"37":{"start":{"line":70,"column":16},"end":{"line":70,"column":95}},"38":{"start":{"line":73,"column":8},"end":{"line":80,"column":11}},"39":{"start":{"line":74,"column":12},"end":{"line":76,"column":45}},"40":{"start":{"line":77,"column":12},"end":{"line":79,"column":27}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":8,"column":9},"end":{"line":8,"column":33}},"loc":{"start":{"line":8,"column":39},"end":{"line":12,"column":1}},"line":8},"1":{"name":"(anonymous_1)","decl":{"start":{"line":16,"column":25},"end":{"line":16,"column":26}},"loc":{"start":{"line":16,"column":42},"end":{"line":22,"column":13}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":26,"column":78},"end":{"line":26,"column":79}},"loc":{"start":{"line":26,"column":82},"end":{"line":82,"column":1}},"line":26},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":39},"end":{"line":28,"column":40}},"loc":{"start":{"line":28,"column":43},"end":{"line":81,"column":5}},"line":28},"4":{"name":"(anonymous_4)","decl":{"start":{"line":30,"column":16},"end":{"line":30,"column":17}},"loc":{"start":{"line":30,"column":57},"end":{"line":30,"column":97}},"line":30},"5":{"name":"(anonymous_5)","decl":{"start":{"line":33,"column":91},"end":{"line":33,"column":92}},"loc":{"start":{"line":33,"column":101},"end":{"line":35,"column":9}},"line":33},"6":{"name":"(anonymous_6)","decl":{"start":{"line":36,"column":92},"end":{"line":36,"column":93}},"loc":{"start":{"line":36,"column":102},"end":{"line":38,"column":9}},"line":36},"7":{"name":"(anonymous_7)","decl":{"start":{"line":39,"column":67},"end":{"line":39,"column":68}},"loc":{"start":{"line":39,"column":77},"end":{"line":41,"column":9}},"line":39},"8":{"name":"(anonymous_8)","decl":{"start":{"line":42,"column":84},"end":{"line":42,"column":85}},"loc":{"start":{"line":42,"column":94},"end":{"line":44,"column":9}},"line":42},"9":{"name":"(anonymous_9)","decl":{"start":{"line":45,"column":89},"end":{"line":45,"column":90}},"loc":{"start":{"line":45,"column":99},"end":{"line":51,"column":9}},"line":45},"10":{"name":"(anonymous_10)","decl":{"start":{"line":52,"column":66},"end":{"line":52,"column":67}},"loc":{"start":{"line":52,"column":76},"end":{"line":58,"column":9}},"line":52},"11":{"name":"(anonymous_11)","decl":{"start":{"line":59,"column":66},"end":{"line":59,"column":67}},"loc":{"start":{"line":59,"column":76},"end":{"line":65,"column":9}},"line":59},"12":{"name":"(anonymous_12)","decl":{"start":{"line":66,"column":96},"end":{"line":66,"column":97}},"loc":{"start":{"line":66,"column":106},"end":{"line":72,"column":9}},"line":66},"13":{"name":"(anonymous_13)","decl":{"start":{"line":73,"column":65},"end":{"line":73,"column":66}},"loc":{"start":{"line":73,"column":75},"end":{"line":80,"column":9}},"line":73}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":11},"end":{"line":11,"column":5}},"type":"cond-expr","locations":[{"start":{"line":9,"column":35},"end":{"line":9,"column":38}},{"start":{"line":9,"column":41},"end":{"line":11,"column":5}}],"line":9},"1":{"loc":{"start":{"line":9,"column":11},"end":{"line":9,"column":32}},"type":"binary-expr","locations":[{"start":{"line":9,"column":11},"end":{"line":9,"column":14}},{"start":{"line":9,"column":18},"end":{"line":9,"column":32}}],"line":9},"2":{"loc":{"start":{"line":17,"column":16},"end":{"line":21,"column":17}},"type":"if","locations":[{"start":{"line":17,"column":16},"end":{"line":21,"column":17}},{"start":{"line":17,"column":16},"end":{"line":21,"column":17}}],"line":17}},"s":{"0":1,"1":1,"2":1,"3":1,"4":2,"5":1,"6":5,"7":0,"8":1,"9":1,"10":1,"11":1,"12":3,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":0,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":0,"38":1,"39":1,"40":1},"f":{"0":2,"1":5,"2":1,"3":1,"4":3,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1},"b":{"0":[0,2],"1":[2,2],"2":[0,5]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/infrastructure/rocket-chat/slash-commands/actions.spec.ts"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { expect } from 'chai';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\nconst { executeSlashCommand } = proxyquire\n\t.noCallThru()\n\t.load('../../../../../../../../server/local-services/federation/infrastructure/rocket-chat/slash-commands/action', {\n\t\t'@rocket.chat/models': {\n\t\t\tUsers: {\n\t\t\t\tfindOneById: async (invitee: string): Promise<IUser | undefined> => {\n\t\t\t\t\tif (invitee.includes('normalUser')) {\n\t\t\t\t\t\treturn { username: 'username' } as any;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t});\n\ndescribe('FederationEE - Infrastructure - RocketChat - Server Slash command', () => {\n\tconst command = sinon.stub();\n\n\tdescribe('#executeSlashCommand()', () => {\n\t\tconst validCommands = {\n\t\t\tdm: async (currentUserId: string, roomId: string, invitees: string[]) => command(currentUserId, roomId, invitees),\n\t\t};\n\t\tconst currentUserId = 'userId';\n\n\t\tit('should return undefined if the provided command is different of \"federation\"', async () => {\n\t\t\texpect(await executeSlashCommand('invalid-command', '', {}, validCommands)).to.be.equal(undefined);\n\t\t});\n\n\t\tit('should return undefined if the command is valid but there is no string params', async () => {\n\t\t\texpect(await executeSlashCommand('federation', '', {}, validCommands)).to.be.equal(undefined);\n\t\t});\n\n\t\tit('should return undefined if there is no currentUserId', async () => {\n\t\t\texpect(await executeSlashCommand('federation', 'params', {}, validCommands)).to.be.equal(undefined);\n\t\t});\n\n\t\tit('should return undefined if the provided command is invalid/inexistent', async () => {\n\t\t\texpect(await executeSlashCommand('federation', 'params', {}, validCommands)).to.be.equal(undefined);\n\t\t});\n\n\t\tit('should throw an error if the provided invitee is invalid (without any \":\")', async () => {\n\t\t\ttry {\n\t\t\t\tawait executeSlashCommand('federation', 'dm @user.server.com', {}, validCommands, currentUserId);\n\t\t\t} catch (e: any) {\n\t\t\t\texpect(e.message).to.be.equal('At least one user must be external');\n\t\t\t}\n\t\t});\n\n\t\tit('should throw an error if the inviter does not exist', async () => {\n\t\t\ttry {\n\t\t\t\tawait executeSlashCommand('federation', 'dm @user:server.com', {}, validCommands, currentUserId);\n\t\t\t} catch (e: any) {\n\t\t\t\texpect(e.message).to.be.equal('At least one user must be external');\n\t\t\t}\n\t\t});\n\n\t\tit('should throw an error if there is no external users', async () => {\n\t\t\ttry {\n\t\t\t\tawait executeSlashCommand('federation', 'dm @user1 @user2', {}, validCommands, currentUserId);\n\t\t\t} catch (e: any) {\n\t\t\t\texpect(e.message).to.be.equal('At least one user must be external');\n\t\t\t}\n\t\t});\n\n\t\tit('should throw an error if the LOCAL inviter is trying to invite another LOCAL user', async () => {\n\t\t\ttry {\n\t\t\t\tawait executeSlashCommand('federation', 'dm @normalUser:server.com', {}, validCommands, currentUserId);\n\t\t\t} catch (e: any) {\n\t\t\t\texpect(e.message).to.be.equal('At least one user must be external');\n\t\t\t}\n\t\t});\n\n\t\tit('should call the command function without any error', async () => {\n\t\t\tawait executeSlashCommand('federation', 'dm @external:server.com', { rid: 'roomId' }, validCommands, currentUserId);\n\t\t\texpect(command.calledWith(currentUserId, 'roomId', ['@external:server.com'])).to.be.true;\n\t\t});\n\t});\n});\n"],"names":["executeSlashCommand","proxyquire","noCallThru","load","Users","findOneById","invitee","includes","username","describe","command","sinon","stub","validCommands","dm","currentUserId","roomId","invitees","it","expect","to","be","equal","undefined","e","message","rid","calledWith","true"],"mappings":";;;;sBACuB;mEACA;8DACL;;;;;;AAElB,MAAM,EAAEA,mBAAmB,EAAE,GAAGC,mBAAU,CACxCC,UAAU,GACVC,IAAI,CAAC,6GAA6G;IAClH,uBAAuB;QACtBC,OAAO;YACNC,aAAa,OAAOC;gBACnB,IAAIA,QAAQC,QAAQ,CAAC,eAAe;oBACnC,OAAO;wBAAEC,UAAU;oBAAW;gBAC/B;YACD;QACD;IACD;AACD;AAEDC,SAAS,qEAAqE;IAC7E,MAAMC,UAAUC,cAAK,CAACC,IAAI;IAE1BH,SAAS,0BAA0B;QAClC,MAAMI,gBAAgB;YACrBC,IAAI,OAAOC,eAAuBC,QAAgBC,WAAuBP,QAAQK,eAAeC,QAAQC;QACzG;QACA,MAAMF,gBAAgB;QAEtBG,GAAG,gFAAgF;YAClFC,IAAAA,YAAM,EAAC,MAAMnB,oBAAoB,mBAAmB,IAAI,CAAC,GAAGa,gBAAgBO,EAAE,CAACC,EAAE,CAACC,KAAK,CAACC;QACzF;QAEAL,GAAG,iFAAiF;YACnFC,IAAAA,YAAM,EAAC,MAAMnB,oBAAoB,cAAc,IAAI,CAAC,GAAGa,gBAAgBO,EAAE,CAACC,EAAE,CAACC,KAAK,CAACC;QACpF;QAEAL,GAAG,wDAAwD;YAC1DC,IAAAA,YAAM,EAAC,MAAMnB,oBAAoB,cAAc,UAAU,CAAC,GAAGa,gBAAgBO,EAAE,CAACC,EAAE,CAACC,KAAK,CAACC;QAC1F;QAEAL,GAAG,yEAAyE;YAC3EC,IAAAA,YAAM,EAAC,MAAMnB,oBAAoB,cAAc,UAAU,CAAC,GAAGa,gBAAgBO,EAAE,CAACC,EAAE,CAACC,KAAK,CAACC;QAC1F;QAEAL,GAAG,8EAA8E;YAChF,IAAI;gBACH,MAAMlB,oBAAoB,cAAc,uBAAuB,CAAC,GAAGa,eAAeE;YACnF,EAAE,OAAOS,GAAQ;gBAChBL,IAAAA,YAAM,EAACK,EAAEC,OAAO,EAAEL,EAAE,CAACC,EAAE,CAACC,KAAK,CAAC;YAC/B;QACD;QAEAJ,GAAG,uDAAuD;YACzD,IAAI;gBACH,MAAMlB,oBAAoB,cAAc,uBAAuB,CAAC,GAAGa,eAAeE;YACnF,EAAE,OAAOS,GAAQ;gBAChBL,IAAAA,YAAM,EAACK,EAAEC,OAAO,EAAEL,EAAE,CAACC,EAAE,CAACC,KAAK,CAAC;YAC/B;QACD;QAEAJ,GAAG,uDAAuD;YACzD,IAAI;gBACH,MAAMlB,oBAAoB,cAAc,oBAAoB,CAAC,GAAGa,eAAeE;YAChF,EAAE,OAAOS,GAAQ;gBAChBL,IAAAA,YAAM,EAACK,EAAEC,OAAO,EAAEL,EAAE,CAACC,EAAE,CAACC,KAAK,CAAC;YAC/B;QACD;QAEAJ,GAAG,qFAAqF;YACvF,IAAI;gBACH,MAAMlB,oBAAoB,cAAc,6BAA6B,CAAC,GAAGa,eAAeE;YACzF,EAAE,OAAOS,GAAQ;gBAChBL,IAAAA,YAAM,EAACK,EAAEC,OAAO,EAAEL,EAAE,CAACC,EAAE,CAACC,KAAK,CAAC;YAC/B;QACD;QAEAJ,GAAG,sDAAsD;YACxD,MAAMlB,oBAAoB,cAAc,2BAA2B;gBAAE0B,KAAK;YAAS,GAAGb,eAAeE;YACrGI,IAAAA,YAAM,EAACT,QAAQiB,UAAU,CAACZ,eAAe,UAAU;gBAAC;aAAuB,GAAGK,EAAE,CAACC,EAAE,CAACO,IAAI;QACzF;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/tests/unit/server/federation/server/infrastructure/rocket-chat/slash-commands/actions.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"43baeefbbc9b9f4ceb512d310e6f733ba8c45506","contentHash":"7577158e277e0d845841db2b9dae22998ef716dbd64baf944bf6ed5c7ffb393b"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/rocket-chat/slash-commands/action.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/rocket-chat/slash-commands/action.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":35}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":123}},"5":{"start":{"line":13,"column":25},"end":{"line":21,"column":1}},"6":{"start":{"line":15,"column":31},"end":{"line":15,"column":78}},"7":{"start":{"line":15,"column":56},"end":{"line":15,"column":77}},"8":{"start":{"line":16,"column":20},"end":{"line":16,"column":62}},"9":{"start":{"line":17,"column":30},"end":{"line":17,"column":286}},"10":{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},"11":{"start":{"line":19,"column":8},"end":{"line":19,"column":62}},"12":{"start":{"line":22,"column":28},"end":{"line":34,"column":1}},"13":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"14":{"start":{"line":24,"column":8},"end":{"line":24,"column":15}},"15":{"start":{"line":26,"column":50},"end":{"line":26,"column":80}},"16":{"start":{"line":27,"column":4},"end":{"line":29,"column":5}},"17":{"start":{"line":28,"column":8},"end":{"line":28,"column":15}},"18":{"start":{"line":30,"column":4},"end":{"line":30,"column":67}},"19":{"start":{"line":31,"column":21},"end":{"line":31,"column":113}},"20":{"start":{"line":31,"column":62},"end":{"line":31,"column":112}},"21":{"start":{"line":32,"column":28},"end":{"line":32,"column":32}},"22":{"start":{"line":33,"column":4},"end":{"line":33,"column":61}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":25},"end":{"line":13,"column":26}},"loc":{"start":{"line":13,"column":54},"end":{"line":21,"column":1}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":45},"end":{"line":15,"column":46}},"loc":{"start":{"line":15,"column":56},"end":{"line":15,"column":77}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":22,"column":28},"end":{"line":22,"column":29}},"loc":{"start":{"line":22,"column":98},"end":{"line":34,"column":1}},"line":22},"4":{"name":"(anonymous_4)","decl":{"start":{"line":31,"column":49},"end":{"line":31,"column":50}},"loc":{"start":{"line":31,"column":62},"end":{"line":31,"column":112}},"line":31}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":30},"end":{"line":17,"column":286}},"type":"binary-expr","locations":[{"start":{"line":17,"column":30},"end":{"line":17,"column":108}},{"start":{"line":17,"column":113},"end":{"line":17,"column":285}}],"line":17},"1":{"loc":{"start":{"line":17,"column":31},"end":{"line":17,"column":98}},"type":"cond-expr","locations":[{"start":{"line":17,"column":72},"end":{"line":17,"column":78}},{"start":{"line":17,"column":81},"end":{"line":17,"column":98}}],"line":17},"2":{"loc":{"start":{"line":17,"column":31},"end":{"line":17,"column":69}},"type":"binary-expr","locations":[{"start":{"line":17,"column":31},"end":{"line":17,"column":47}},{"start":{"line":17,"column":51},"end":{"line":17,"column":69}}],"line":17},"3":{"loc":{"start":{"line":17,"column":113},"end":{"line":17,"column":285}},"type":"cond-expr","locations":[{"start":{"line":17,"column":154},"end":{"line":17,"column":160}},{"start":{"line":17,"column":163},"end":{"line":17,"column":285}}],"line":17},"4":{"loc":{"start":{"line":17,"column":113},"end":{"line":17,"column":151}},"type":"binary-expr","locations":[{"start":{"line":17,"column":113},"end":{"line":17,"column":129}},{"start":{"line":17,"column":133},"end":{"line":17,"column":151}}],"line":17},"5":{"loc":{"start":{"line":17,"column":163},"end":{"line":17,"column":285}},"type":"cond-expr","locations":[{"start":{"line":17,"column":245},"end":{"line":17,"column":251}},{"start":{"line":17,"column":254},"end":{"line":17,"column":285}}],"line":17},"6":{"loc":{"start":{"line":17,"column":163},"end":{"line":17,"column":242}},"type":"binary-expr","locations":[{"start":{"line":17,"column":163},"end":{"line":17,"column":210}},{"start":{"line":17,"column":214},"end":{"line":17,"column":242}}],"line":17},"7":{"loc":{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},"type":"if","locations":[{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},{"start":{"line":18,"column":4},"end":{"line":20,"column":5}}],"line":18},"8":{"loc":{"start":{"line":18,"column":8},"end":{"line":18,"column":49}},"type":"binary-expr","locations":[{"start":{"line":18,"column":8},"end":{"line":18,"column":27}},{"start":{"line":18,"column":31},"end":{"line":18,"column":49}}],"line":18},"9":{"loc":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"type":"if","locations":[{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},{"start":{"line":23,"column":4},"end":{"line":25,"column":5}}],"line":23},"10":{"loc":{"start":{"line":23,"column":8},"end":{"line":23,"column":57}},"type":"binary-expr","locations":[{"start":{"line":23,"column":8},"end":{"line":23,"column":40}},{"start":{"line":23,"column":44},"end":{"line":23,"column":57}}],"line":23},"11":{"loc":{"start":{"line":27,"column":4},"end":{"line":29,"column":5}},"type":"if","locations":[{"start":{"line":27,"column":4},"end":{"line":29,"column":5}},{"start":{"line":27,"column":4},"end":{"line":29,"column":5}}],"line":27},"12":{"loc":{"start":{"line":27,"column":8},"end":{"line":27,"column":44}},"type":"binary-expr","locations":[{"start":{"line":27,"column":8},"end":{"line":27,"column":22}},{"start":{"line":27,"column":26},"end":{"line":27,"column":44}}],"line":27}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":5,"7":6,"8":5,"9":5,"10":5,"11":2,"12":1,"13":9,"14":2,"15":7,"16":7,"17":2,"18":5,"19":3,"20":3,"21":3,"22":3},"f":{"0":1,"1":5,"2":6,"3":9,"4":3},"b":{"0":[5,5],"1":[5,0],"2":[5,5],"3":[5,0],"4":[5,5],"5":[0,0],"6":[0,0],"7":[2,3],"8":[5,2],"9":[2,7],"10":[9,8],"11":[2,5],"12":[7,5]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/rocket-chat/slash-commands/action.ts"],"sourcesContent":["import { Users } from '@rocket.chat/models';\n\nimport { normalizeExternalInviteeId } from '../../../../../../../server/services/federation/infrastructure/rocket-chat/slash-commands/action';\n\nconst validateInvitees = async (invitees: string[], inviterId: string): Promise<void> => {\n\tconst atLeastOneExternal = invitees.some((invitee) => invitee.includes(':'));\n\tconst inviter = await Users.findOneById(inviterId);\n\tconst isInviterExternal = inviter?.federated === true || inviter?.username?.includes(':');\n\tif (!atLeastOneExternal && !isInviterExternal) {\n\t\tthrow new Error('At least one user must be external');\n\t}\n};\n\nexport const executeSlashCommand = async (\n\tprovidedCommand: string,\n\tstringParams: string | undefined,\n\titem: Record<string, any>,\n\tcommands: Record<string, (currentUserId: string, roomId: string, invitees: string[]) => Promise<void>>,\n\tcurrentUserId?: string | null,\n): Promise<void> => {\n\tif (providedCommand !== 'federation' || !stringParams) {\n\t\treturn;\n\t}\n\tconst [command, ...externalUserIdsToInvite] = stringParams.trim().split(' ');\n\tif (!currentUserId || !commands[command]) {\n\t\treturn;\n\t}\n\n\tawait validateInvitees(externalUserIdsToInvite, currentUserId);\n\n\tconst invitees = externalUserIdsToInvite.map((rawUserId) => normalizeExternalInviteeId(rawUserId));\n\n\tconst { rid: roomId } = item;\n\n\tawait commands[command](currentUserId, roomId, invitees);\n};\n"],"names":["executeSlashCommand","validateInvitees","invitees","inviterId","inviter","atLeastOneExternal","some","invitee","includes","Users","findOneById","isInviterExternal","federated","username","Error","providedCommand","stringParams","item","commands","currentUserId","command","externalUserIdsToInvite","trim","split","map","rawUserId","normalizeExternalInviteeId","rid","roomId"],"mappings":";;;;+BAaaA;;;eAAAA;;;wBAbS;wBAEqB;AAE3C,MAAMC,mBAAmB,OAAOC,UAAoBC;QAGMC;IAFzD,MAAMC,qBAAqBH,SAASI,IAAI,CAAC,CAACC,UAAYA,QAAQC,QAAQ,CAAC;IACvE,MAAMJ,UAAU,MAAMK,aAAK,CAACC,WAAW,CAACP;IACxC,MAAMQ,oBAAoBP,CAAAA,oBAAAA,8BAAAA,QAASQ,SAAS,MAAK,SAAQR,oBAAAA,+BAAAA,oBAAAA,QAASS,QAAQ,cAAjBT,wCAAAA,kBAAmBI,QAAQ,CAAC;IACrF,IAAI,CAACH,sBAAsB,CAACM,mBAAmB;QAC9C,MAAM,IAAIG,MAAM;IACjB;AACD;AAEO,MAAMd,sBAAsB,OAClCe,iBACAC,cACAC,MACAC,UACAC;IAEA,IAAIJ,oBAAoB,gBAAgB,CAACC,cAAc;QACtD;IACD;IACA,MAAM,CAACI,SAAS,GAAGC,wBAAwB,GAAGL,aAAaM,IAAI,GAAGC,KAAK,CAAC;IACxE,IAAI,CAACJ,iBAAiB,CAACD,QAAQ,CAACE,QAAQ,EAAE;QACzC;IACD;IAEA,MAAMnB,iBAAiBoB,yBAAyBF;IAEhD,MAAMjB,WAAWmB,wBAAwBG,GAAG,CAAC,CAACC,YAAcC,IAAAA,kCAA0B,EAACD;IAEvF,MAAM,EAAEE,KAAKC,MAAM,EAAE,GAAGX;IAExB,MAAMC,QAAQ,CAACE,QAAQ,CAACD,eAAeS,QAAQ1B;AAChD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/rocket-chat/slash-commands/action.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"33c662ccf72f0f25c79a1e782f10358faf6c376f","contentHash":"dc9d876e52c5459e424a872d2a05cd3107f43b319ed7f7403413ac08e472e10a"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/slash-commands/action.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/slash-commands/action.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":35}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":42}},"6":{"start":{"line":19,"column":16},"end":{"line":19,"column":46}},"7":{"start":{"line":20,"column":35},"end":{"line":20,"column":87}},"8":{"start":{"line":20,"column":51},"end":{"line":20,"column":87}},"9":{"start":{"line":21,"column":40},"end":{"line":29,"column":1}},"10":{"start":{"line":23,"column":20},"end":{"line":23,"column":62}},"11":{"start":{"line":24,"column":30},"end":{"line":24,"column":286}},"12":{"start":{"line":25,"column":46},"end":{"line":25,"column":95}},"13":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"14":{"start":{"line":27,"column":8},"end":{"line":27,"column":73}},"15":{"start":{"line":30,"column":28},"end":{"line":43,"column":1}},"16":{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},"17":{"start":{"line":32,"column":8},"end":{"line":32,"column":15}},"18":{"start":{"line":34,"column":33},"end":{"line":34,"column":63}},"19":{"start":{"line":35,"column":24},"end":{"line":35,"column":30}},"20":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"21":{"start":{"line":37,"column":8},"end":{"line":37,"column":15}},"22":{"start":{"line":39,"column":4},"end":{"line":39,"column":68}},"23":{"start":{"line":40,"column":20},"end":{"line":40,"column":57}},"24":{"start":{"line":41,"column":28},"end":{"line":41,"column":32}},"25":{"start":{"line":42,"column":4},"end":{"line":42,"column":60}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":25},"end":{"line":12,"column":26}},"loc":{"start":{"line":12,"column":36},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":32},"end":{"line":15,"column":33}},"loc":{"start":{"line":15,"column":43},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":20,"column":35},"end":{"line":20,"column":36}},"loc":{"start":{"line":20,"column":51},"end":{"line":20,"column":87}},"line":20},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":40},"end":{"line":21,"column":41}},"loc":{"start":{"line":21,"column":73},"end":{"line":29,"column":1}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":30,"column":28},"end":{"line":30,"column":29}},"loc":{"start":{"line":30,"column":98},"end":{"line":43,"column":1}},"line":30}},"branchMap":{"0":{"loc":{"start":{"line":24,"column":30},"end":{"line":24,"column":286}},"type":"binary-expr","locations":[{"start":{"line":24,"column":30},"end":{"line":24,"column":108}},{"start":{"line":24,"column":113},"end":{"line":24,"column":285}}],"line":24},"1":{"loc":{"start":{"line":24,"column":31},"end":{"line":24,"column":98}},"type":"cond-expr","locations":[{"start":{"line":24,"column":72},"end":{"line":24,"column":78}},{"start":{"line":24,"column":81},"end":{"line":24,"column":98}}],"line":24},"2":{"loc":{"start":{"line":24,"column":31},"end":{"line":24,"column":69}},"type":"binary-expr","locations":[{"start":{"line":24,"column":31},"end":{"line":24,"column":47}},{"start":{"line":24,"column":51},"end":{"line":24,"column":69}}],"line":24},"3":{"loc":{"start":{"line":24,"column":113},"end":{"line":24,"column":285}},"type":"cond-expr","locations":[{"start":{"line":24,"column":154},"end":{"line":24,"column":160}},{"start":{"line":24,"column":163},"end":{"line":24,"column":285}}],"line":24},"4":{"loc":{"start":{"line":24,"column":113},"end":{"line":24,"column":151}},"type":"binary-expr","locations":[{"start":{"line":24,"column":113},"end":{"line":24,"column":129}},{"start":{"line":24,"column":133},"end":{"line":24,"column":151}}],"line":24},"5":{"loc":{"start":{"line":24,"column":163},"end":{"line":24,"column":285}},"type":"cond-expr","locations":[{"start":{"line":24,"column":245},"end":{"line":24,"column":251}},{"start":{"line":24,"column":254},"end":{"line":24,"column":285}}],"line":24},"6":{"loc":{"start":{"line":24,"column":163},"end":{"line":24,"column":242}},"type":"binary-expr","locations":[{"start":{"line":24,"column":163},"end":{"line":24,"column":210}},{"start":{"line":24,"column":214},"end":{"line":24,"column":242}}],"line":24},"7":{"loc":{"start":{"line":25,"column":46},"end":{"line":25,"column":95}},"type":"binary-expr","locations":[{"start":{"line":25,"column":46},"end":{"line":25,"column":73}},{"start":{"line":25,"column":77},"end":{"line":25,"column":95}}],"line":25},"8":{"loc":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"type":"if","locations":[{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},{"start":{"line":26,"column":4},"end":{"line":28,"column":5}}],"line":26},"9":{"loc":{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},"type":"if","locations":[{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},{"start":{"line":31,"column":4},"end":{"line":33,"column":5}}],"line":31},"10":{"loc":{"start":{"line":31,"column":8},"end":{"line":31,"column":57}},"type":"binary-expr","locations":[{"start":{"line":31,"column":8},"end":{"line":31,"column":40}},{"start":{"line":31,"column":44},"end":{"line":31,"column":57}}],"line":31},"11":{"loc":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},{"start":{"line":36,"column":4},"end":{"line":38,"column":5}}],"line":36},"12":{"loc":{"start":{"line":36,"column":8},"end":{"line":36,"column":44}},"type":"binary-expr","locations":[{"start":{"line":36,"column":8},"end":{"line":36,"column":22}},{"start":{"line":36,"column":26},"end":{"line":36,"column":44}}],"line":36}},"s":{"0":2,"1":2,"2":4,"3":2,"4":1,"5":4,"6":2,"7":2,"8":7,"9":2,"10":4,"11":4,"12":4,"13":4,"14":1,"15":2,"16":8,"17":2,"18":6,"19":6,"20":6,"21":2,"22":4,"23":3,"24":3,"25":3},"f":{"0":2,"1":1,"2":4,"3":7,"4":4,"5":8},"b":{"0":[4,4],"1":[4,0],"2":[4,4],"3":[4,0],"4":[4,4],"5":[0,0],"6":[0,0],"7":[4,1],"8":[1,3],"9":[2,6],"10":[8,7],"11":[2,4],"12":[6,4]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/slash-commands/action.ts"],"sourcesContent":["import { Users } from '@rocket.chat/models';\n\nexport const normalizeExternalInviteeId = (rawInviteeId: string): string => `@${rawInviteeId.replace(/@/g, '')}`;\n\nconst validateExternalInviteeIdFormat = async (rawInviteeId: string, inviterId: string): Promise<void> => {\n\tconst inviter = await Users.findOneById(inviterId);\n\tconst isInviterExternal = inviter?.federated === true || inviter?.username?.includes(':');\n\tconst localUserInvitingAnotherLocalUser = !rawInviteeId.includes(':') && !isInviterExternal;\n\tif (localUserInvitingAnotherLocalUser) {\n\t\tthrow new Error('Invalid userId format for federation command.');\n\t}\n};\n\nexport const executeSlashCommand = async (\n\tprovidedCommand: string,\n\tstringParams: string | undefined,\n\titem: Record<string, any>,\n\tcommands: Record<string, (currentUserId: string, roomId: string, invitee: string) => Promise<void>>,\n\tcurrentUserId?: string | null,\n): Promise<void> => {\n\tif (providedCommand !== 'federation' || !stringParams) {\n\t\treturn;\n\t}\n\n\tconst [command, ...params] = stringParams.trim().split(' ');\n\tconst [rawUserId] = params;\n\tif (!currentUserId || !commands[command]) {\n\t\treturn;\n\t}\n\n\tawait validateExternalInviteeIdFormat(rawUserId, currentUserId);\n\n\tconst invitee = normalizeExternalInviteeId(rawUserId);\n\n\tconst { rid: roomId } = item;\n\n\tawait commands[command](currentUserId, roomId, invitee);\n};\n"],"names":["executeSlashCommand","normalizeExternalInviteeId","rawInviteeId","replace","validateExternalInviteeIdFormat","inviterId","inviter","Users","findOneById","isInviterExternal","federated","username","includes","localUserInvitingAnotherLocalUser","Error","providedCommand","stringParams","item","commands","currentUserId","command","params","trim","split","rawUserId","invitee","rid","roomId"],"mappings":";;;;;;;;;;;IAaaA,mBAAmB;eAAnBA;;IAXAC,0BAA0B;eAA1BA;;;wBAFS;AAEf,MAAMA,6BAA6B,CAACC,eAAiC,CAAC,CAAC,EAAEA,aAAaC,OAAO,CAAC,MAAM,KAAK;AAEhH,MAAMC,kCAAkC,OAAOF,cAAsBG;QAEXC;IADzD,MAAMA,UAAU,MAAMC,aAAK,CAACC,WAAW,CAACH;IACxC,MAAMI,oBAAoBH,CAAAA,oBAAAA,8BAAAA,QAASI,SAAS,MAAK,SAAQJ,oBAAAA,+BAAAA,oBAAAA,QAASK,QAAQ,cAAjBL,wCAAAA,kBAAmBM,QAAQ,CAAC;IACrF,MAAMC,oCAAoC,CAACX,aAAaU,QAAQ,CAAC,QAAQ,CAACH;IAC1E,IAAII,mCAAmC;QACtC,MAAM,IAAIC,MAAM;IACjB;AACD;AAEO,MAAMd,sBAAsB,OAClCe,iBACAC,cACAC,MACAC,UACAC;IAEA,IAAIJ,oBAAoB,gBAAgB,CAACC,cAAc;QACtD;IACD;IAEA,MAAM,CAACI,SAAS,GAAGC,OAAO,GAAGL,aAAaM,IAAI,GAAGC,KAAK,CAAC;IACvD,MAAM,CAACC,UAAU,GAAGH;IACpB,IAAI,CAACF,iBAAiB,CAACD,QAAQ,CAACE,QAAQ,EAAE;QACzC;IACD;IAEA,MAAMhB,gCAAgCoB,WAAWL;IAEjD,MAAMM,UAAUxB,2BAA2BuB;IAE3C,MAAM,EAAEE,KAAKC,MAAM,EAAE,GAAGV;IAExB,MAAMC,QAAQ,CAACE,QAAQ,CAACD,eAAeQ,QAAQF;AAChD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/slash-commands/action.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"0fafd8bc01969d86d4e753215efa2b1c633100c9","contentHash":"4002cb8ca9da3e214c0614c125c2687aeaf96df6b8c38d874d9290d63fcac2de"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/api/server/api.helpers.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/api/server/api.helpers.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":21,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":32}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":45}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":32}},"7":{"start":{"line":22,"column":23},"end":{"line":22,"column":84}},"8":{"start":{"line":23,"column":34},"end":{"line":23,"column":90}},"9":{"start":{"line":24,"column":35},"end":{"line":26,"column":1}},"10":{"start":{"line":25,"column":4},"end":{"line":25,"column":45}},"11":{"start":{"line":27,"column":34},"end":{"line":35,"column":1}},"12":{"start":{"line":28,"column":4},"end":{"line":34,"column":113}},"13":{"start":{"line":28,"column":97},"end":{"line":34,"column":37}},"14":{"start":{"line":34,"column":91},"end":{"line":34,"column":111}},"15":{"start":{"line":36,"column":29},"end":{"line":44,"column":1}},"16":{"start":{"line":37,"column":4},"end":{"line":43,"column":158}},"17":{"start":{"line":37,"column":97},"end":{"line":43,"column":37}},"18":{"start":{"line":43,"column":91},"end":{"line":43,"column":156}},"19":{"start":{"line":46,"column":24},"end":{"line":46,"column":84}},"20":{"start":{"line":47,"column":4},"end":{"line":50,"column":5}},"21":{"start":{"line":49,"column":8},"end":{"line":49,"column":21}},"22":{"start":{"line":51,"column":4},"end":{"line":54,"column":5}},"23":{"start":{"line":53,"column":8},"end":{"line":53,"column":20}},"24":{"start":{"line":55,"column":4},"end":{"line":57,"column":5}},"25":{"start":{"line":56,"column":8},"end":{"line":56,"column":90}},"26":{"start":{"line":58,"column":4},"end":{"line":60,"column":5}},"27":{"start":{"line":59,"column":8},"end":{"line":59,"column":97}},"28":{"start":{"line":61,"column":4},"end":{"line":61,"column":17}},"29":{"start":{"line":64,"column":4},"end":{"line":66,"column":5}},"30":{"start":{"line":65,"column":8},"end":{"line":65,"column":21}},"31":{"start":{"line":67,"column":4},"end":{"line":70,"column":5}},"32":{"start":{"line":69,"column":8},"end":{"line":69,"column":20}},"33":{"start":{"line":71,"column":4},"end":{"line":79,"column":5}},"34":{"start":{"line":72,"column":8},"end":{"line":77,"column":10}},"35":{"start":{"line":78,"column":8},"end":{"line":78,"column":20}},"36":{"start":{"line":80,"column":4},"end":{"line":91,"column":5}},"37":{"start":{"line":81,"column":8},"end":{"line":89,"column":11}},"38":{"start":{"line":82,"column":30},"end":{"line":82,"column":36}},"39":{"start":{"line":84,"column":12},"end":{"line":88,"column":14}},"40":{"start":{"line":90,"column":8},"end":{"line":90,"column":20}},"41":{"start":{"line":93,"column":4},"end":{"line":93,"column":17}},"42":{"start":{"line":96,"column":24},"end":{"line":96,"column":172}},"43":{"start":{"line":97,"column":4},"end":{"line":97,"column":129}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":22},"end":{"line":12,"column":23}},"loc":{"start":{"line":12,"column":33},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":35},"end":{"line":15,"column":36}},"loc":{"start":{"line":15,"column":46},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":22},"end":{"line":18,"column":23}},"loc":{"start":{"line":18,"column":33},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":24,"column":35},"end":{"line":24,"column":36}},"loc":{"start":{"line":24,"column":57},"end":{"line":26,"column":1}},"line":24},"5":{"name":"(anonymous_5)","decl":{"start":{"line":27,"column":34},"end":{"line":27,"column":35}},"loc":{"start":{"line":27,"column":56},"end":{"line":35,"column":1}},"line":27},"6":{"name":"(anonymous_6)","decl":{"start":{"line":28,"column":90},"end":{"line":28,"column":91}},"loc":{"start":{"line":28,"column":97},"end":{"line":34,"column":37}},"line":28},"7":{"name":"(anonymous_7)","decl":{"start":{"line":34,"column":82},"end":{"line":34,"column":83}},"loc":{"start":{"line":34,"column":91},"end":{"line":34,"column":111}},"line":34},"8":{"name":"(anonymous_8)","decl":{"start":{"line":36,"column":29},"end":{"line":36,"column":30}},"loc":{"start":{"line":36,"column":51},"end":{"line":44,"column":1}},"line":36},"9":{"name":"(anonymous_9)","decl":{"start":{"line":37,"column":90},"end":{"line":37,"column":91}},"loc":{"start":{"line":37,"column":97},"end":{"line":43,"column":37}},"line":37},"10":{"name":"(anonymous_10)","decl":{"start":{"line":43,"column":82},"end":{"line":43,"column":83}},"loc":{"start":{"line":43,"column":91},"end":{"line":43,"column":156}},"line":43},"11":{"name":"checkPermissionsForInvocation","decl":{"start":{"line":45,"column":15},"end":{"line":45,"column":44}},"loc":{"start":{"line":45,"column":88},"end":{"line":62,"column":1}},"line":45},"12":{"name":"checkPermissions","decl":{"start":{"line":63,"column":9},"end":{"line":63,"column":25}},"loc":{"start":{"line":63,"column":35},"end":{"line":94,"column":1}},"line":63},"13":{"name":"(anonymous_13)","decl":{"start":{"line":81,"column":57},"end":{"line":81,"column":58}},"loc":{"start":{"line":81,"column":67},"end":{"line":89,"column":9}},"line":81},"14":{"name":"parseDeprecation","decl":{"start":{"line":95,"column":9},"end":{"line":95,"column":25}},"loc":{"start":{"line":95,"column":65},"end":{"line":98,"column":1}},"line":95}},"branchMap":{"0":{"loc":{"start":{"line":28,"column":11},"end":{"line":34,"column":112}},"type":"binary-expr","locations":[{"start":{"line":28,"column":11},"end":{"line":28,"column":49}},{"start":{"line":28,"column":53},"end":{"line":34,"column":38}},{"start":{"line":34,"column":42},"end":{"line":34,"column":112}}],"line":28},"1":{"loc":{"start":{"line":37,"column":11},"end":{"line":43,"column":157}},"type":"binary-expr","locations":[{"start":{"line":37,"column":11},"end":{"line":37,"column":49}},{"start":{"line":37,"column":53},"end":{"line":43,"column":38}},{"start":{"line":43,"column":42},"end":{"line":43,"column":157}}],"line":37},"2":{"loc":{"start":{"line":43,"column":91},"end":{"line":43,"column":156}},"type":"binary-expr","locations":[{"start":{"line":43,"column":91},"end":{"line":43,"column":116}},{"start":{"line":43,"column":120},"end":{"line":43,"column":135}},{"start":{"line":43,"column":139},"end":{"line":43,"column":156}}],"line":43},"3":{"loc":{"start":{"line":46,"column":24},"end":{"line":46,"column":84}},"type":"binary-expr","locations":[{"start":{"line":46,"column":24},"end":{"line":46,"column":57}},{"start":{"line":46,"column":61},"end":{"line":46,"column":84}}],"line":46},"4":{"loc":{"start":{"line":47,"column":4},"end":{"line":50,"column":5}},"type":"if","locations":[{"start":{"line":47,"column":4},"end":{"line":50,"column":5}},{"start":{"line":47,"column":4},"end":{"line":50,"column":5}}],"line":47},"5":{"loc":{"start":{"line":51,"column":4},"end":{"line":54,"column":5}},"type":"if","locations":[{"start":{"line":51,"column":4},"end":{"line":54,"column":5}},{"start":{"line":51,"column":4},"end":{"line":54,"column":5}}],"line":51},"6":{"loc":{"start":{"line":55,"column":4},"end":{"line":57,"column":5}},"type":"if","locations":[{"start":{"line":55,"column":4},"end":{"line":57,"column":5}},{"start":{"line":55,"column":4},"end":{"line":57,"column":5}}],"line":55},"7":{"loc":{"start":{"line":58,"column":4},"end":{"line":60,"column":5}},"type":"if","locations":[{"start":{"line":58,"column":4},"end":{"line":60,"column":5}},{"start":{"line":58,"column":4},"end":{"line":60,"column":5}}],"line":58},"8":{"loc":{"start":{"line":64,"column":4},"end":{"line":66,"column":5}},"type":"if","locations":[{"start":{"line":64,"column":4},"end":{"line":66,"column":5}},{"start":{"line":64,"column":4},"end":{"line":66,"column":5}}],"line":64},"9":{"loc":{"start":{"line":67,"column":4},"end":{"line":70,"column":5}},"type":"if","locations":[{"start":{"line":67,"column":4},"end":{"line":70,"column":5}},{"start":{"line":67,"column":4},"end":{"line":70,"column":5}}],"line":67},"10":{"loc":{"start":{"line":71,"column":4},"end":{"line":79,"column":5}},"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":79,"column":5}},{"start":{"line":71,"column":4},"end":{"line":79,"column":5}}],"line":71},"11":{"loc":{"start":{"line":80,"column":4},"end":{"line":91,"column":5}},"type":"if","locations":[{"start":{"line":80,"column":4},"end":{"line":91,"column":5}},{"start":{"line":80,"column":4},"end":{"line":91,"column":5}}],"line":80},"12":{"loc":{"start":{"line":96,"column":24},"end":{"line":96,"column":172}},"type":"cond-expr","locations":[{"start":{"line":96,"column":108},"end":{"line":96,"column":167}},{"start":{"line":96,"column":170},"end":{"line":96,"column":172}}],"line":96},"13":{"loc":{"start":{"line":96,"column":25},"end":{"line":96,"column":104}},"type":"cond-expr","locations":[{"start":{"line":96,"column":76},"end":{"line":96,"column":82}},{"start":{"line":96,"column":85},"end":{"line":96,"column":104}}],"line":96},"14":{"loc":{"start":{"line":96,"column":25},"end":{"line":96,"column":73}},"type":"binary-expr","locations":[{"start":{"line":96,"column":25},"end":{"line":96,"column":46}},{"start":{"line":96,"column":50},"end":{"line":96,"column":73}}],"line":96}},"s":{"0":2,"1":2,"2":6,"3":2,"4":1,"5":1,"6":0,"7":2,"8":2,"9":2,"10":3,"11":2,"12":2,"13":1,"14":1,"15":2,"16":6,"17":6,"18":5,"19":8,"20":8,"21":2,"22":6,"23":1,"24":5,"25":3,"26":2,"27":1,"28":1,"29":7,"30":1,"31":6,"32":3,"33":3,"34":1,"35":1,"36":2,"37":1,"38":1,"39":1,"40":1,"41":1,"42":0,"43":0},"f":{"0":2,"1":1,"2":1,"3":0,"4":3,"5":2,"6":1,"7":1,"8":6,"9":6,"10":5,"11":8,"12":7,"13":1,"14":0},"b":{"0":[2,1,1],"1":[6,5,4],"2":[5,5,4],"3":[8,3],"4":[2,6],"5":[1,5],"6":[3,2],"7":[1,1],"8":[1,6],"9":[3,3],"10":[1,2],"11":[1,1],"12":[0,0],"13":[0,0],"14":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/api/server/api.helpers.ts"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\n\nimport { hasAllPermissionAsync, hasAtLeastOnePermissionAsync } from '../../authorization/server/functions/hasPermission';\nimport { apiDeprecationLogger } from '../../lib/server/lib/deprecationWarningLogger';\n\ntype RequestMethod = 'GET' | 'POST' | 'PUT' | 'DELETE' | '*';\nexport type PermissionsPayload = {\n\t[key in RequestMethod]?: {\n\t\toperation: 'hasAll' | 'hasAny';\n\t\tpermissions: string[];\n\t};\n};\n\ntype PermissionsPayloadLight = {\n\t[key in RequestMethod]?: string[];\n};\n\ntype PermissionsRequiredKey = string[] | PermissionsPayload | PermissionsPayloadLight;\n\nconst isLegacyPermissionsPayload = (permissionsPayload: PermissionsRequiredKey): permissionsPayload is string[] => {\n\treturn Array.isArray(permissionsPayload);\n};\n\nconst isLightPermissionsPayload = (permissionsPayload: PermissionsRequiredKey): permissionsPayload is PermissionsPayloadLight => {\n\treturn (\n\t\ttypeof permissionsPayload === 'object' &&\n\t\tObject.keys(permissionsPayload).some((key) => ['GET', 'POST', 'PUT', 'DELETE', '*'].includes(key.toUpperCase())) &&\n\t\tObject.values(permissionsPayload).every((value) => Array.isArray(value))\n\t);\n};\n\nconst isPermissionsPayload = (permissionsPayload: PermissionsRequiredKey): permissionsPayload is PermissionsPayload => {\n\treturn (\n\t\ttypeof permissionsPayload === 'object' &&\n\t\tObject.keys(permissionsPayload).some((key) => ['GET', 'POST', 'PUT', 'DELETE', '*'].includes(key.toUpperCase())) &&\n\t\tObject.values(permissionsPayload).every((value) => typeof value === 'object' && value.operation && value.permissions)\n\t);\n};\n\nexport async function checkPermissionsForInvocation(\n\tuserId: IUser['_id'],\n\tpermissionsPayload: PermissionsPayload,\n\trequestMethod: RequestMethod,\n): Promise<boolean> {\n\tconst permissions = permissionsPayload[requestMethod] || permissionsPayload['*'];\n\n\tif (!permissions) {\n\t\t// how we reached here in the first place?\n\t\treturn false;\n\t}\n\n\tif (permissions.permissions.length === 0) {\n\t\t// You can pass an empty array of permissions to allow access to the method\n\t\treturn true;\n\t}\n\n\tif (permissions.operation === 'hasAll') {\n\t\treturn hasAllPermissionAsync(userId, permissions.permissions);\n\t}\n\n\tif (permissions.operation === 'hasAny') {\n\t\treturn hasAtLeastOnePermissionAsync(userId, permissions.permissions);\n\t}\n\n\treturn false;\n}\n\n// We'll assume options only contains permissionsRequired, as we don't care of the other elements\nexport function checkPermissions(options: { permissionsRequired?: PermissionsRequiredKey }) {\n\tif (!options.permissionsRequired) {\n\t\treturn false;\n\t}\n\n\tif (isPermissionsPayload(options.permissionsRequired)) {\n\t\t// No modifications needed\n\t\treturn true;\n\t}\n\n\tif (isLegacyPermissionsPayload(options.permissionsRequired)) {\n\t\toptions.permissionsRequired = {\n\t\t\t'*': {\n\t\t\t\toperation: 'hasAll',\n\t\t\t\tpermissions: options.permissionsRequired,\n\t\t\t},\n\t\t};\n\t\treturn true;\n\t}\n\n\tif (isLightPermissionsPayload(options.permissionsRequired)) {\n\t\tObject.keys(options.permissionsRequired).forEach((method) => {\n\t\t\tconst methodKey = method as RequestMethod;\n\t\t\t// @ts-expect-error -- we know the type of the value but ts refuses to infer it\n\t\t\toptions.permissionsRequired[methodKey] = {\n\t\t\t\toperation: 'hasAll',\n\t\t\t\t// @ts-expect-error -- we know the type of the value but ts refuses to infer it\n\t\t\t\tpermissions: options.permissionsRequired[methodKey],\n\t\t\t};\n\t\t});\n\t\treturn true;\n\t}\n\n\t// If reached here, options.permissionsRequired contained an invalid payload\n\treturn false;\n}\n\nexport function parseDeprecation(methodThis: any, { alternatives, version }: { version: string; alternatives?: string[] }): void {\n\tconst infoMessage = alternatives?.length ? ` Please use the alternative(s): ${alternatives.join(',')}` : '';\n\tapiDeprecationLogger.endpoint(methodThis.request.route, version, methodThis.response, infoMessage);\n}\n"],"names":["checkPermissions","checkPermissionsForInvocation","parseDeprecation","isLegacyPermissionsPayload","permissionsPayload","Array","isArray","isLightPermissionsPayload","Object","keys","some","key","includes","toUpperCase","values","every","value","isPermissionsPayload","operation","permissions","userId","requestMethod","length","hasAllPermissionAsync","hasAtLeastOnePermissionAsync","options","permissionsRequired","forEach","method","methodKey","methodThis","alternatives","version","infoMessage","join","apiDeprecationLogger","endpoint","request","route","response"],"mappings":";;;;;;;;;;;IAoEgBA,gBAAgB;eAAhBA;;IA7BMC,6BAA6B;eAA7BA;;IAkENC,gBAAgB;eAAhBA;;;+BAvGoD;0CAC/B;AAgBrC,MAAMC,6BAA6B,CAACC;IACnC,OAAOC,MAAMC,OAAO,CAACF;AACtB;AAEA,MAAMG,4BAA4B,CAACH;IAClC,OACC,OAAOA,uBAAuB,YAC9BI,OAAOC,IAAI,CAACL,oBAAoBM,IAAI,CAAC,CAACC,MAAQ;YAAC;YAAO;YAAQ;YAAO;YAAU;SAAI,CAACC,QAAQ,CAACD,IAAIE,WAAW,QAC5GL,OAAOM,MAAM,CAACV,oBAAoBW,KAAK,CAAC,CAACC,QAAUX,MAAMC,OAAO,CAACU;AAEnE;AAEA,MAAMC,uBAAuB,CAACb;IAC7B,OACC,OAAOA,uBAAuB,YAC9BI,OAAOC,IAAI,CAACL,oBAAoBM,IAAI,CAAC,CAACC,MAAQ;YAAC;YAAO;YAAQ;YAAO;YAAU;SAAI,CAACC,QAAQ,CAACD,IAAIE,WAAW,QAC5GL,OAAOM,MAAM,CAACV,oBAAoBW,KAAK,CAAC,CAACC,QAAU,OAAOA,UAAU,YAAYA,MAAME,SAAS,IAAIF,MAAMG,WAAW;AAEtH;AAEO,eAAelB,8BACrBmB,MAAoB,EACpBhB,kBAAsC,EACtCiB,aAA4B;IAE5B,MAAMF,cAAcf,kBAAkB,CAACiB,cAAc,IAAIjB,kBAAkB,CAAC,IAAI;IAEhF,IAAI,CAACe,aAAa;QACjB,0CAA0C;QAC1C,OAAO;IACR;IAEA,IAAIA,YAAYA,WAAW,CAACG,MAAM,KAAK,GAAG;QACzC,2EAA2E;QAC3E,OAAO;IACR;IAEA,IAAIH,YAAYD,SAAS,KAAK,UAAU;QACvC,OAAOK,IAAAA,oCAAqB,EAACH,QAAQD,YAAYA,WAAW;IAC7D;IAEA,IAAIA,YAAYD,SAAS,KAAK,UAAU;QACvC,OAAOM,IAAAA,2CAA4B,EAACJ,QAAQD,YAAYA,WAAW;IACpE;IAEA,OAAO;AACR;AAGO,SAASnB,iBAAiByB,OAAyD;IACzF,IAAI,CAACA,QAAQC,mBAAmB,EAAE;QACjC,OAAO;IACR;IAEA,IAAIT,qBAAqBQ,QAAQC,mBAAmB,GAAG;QACtD,0BAA0B;QAC1B,OAAO;IACR;IAEA,IAAIvB,2BAA2BsB,QAAQC,mBAAmB,GAAG;QAC5DD,QAAQC,mBAAmB,GAAG;YAC7B,KAAK;gBACJR,WAAW;gBACXC,aAAaM,QAAQC,mBAAmB;YACzC;QACD;QACA,OAAO;IACR;IAEA,IAAInB,0BAA0BkB,QAAQC,mBAAmB,GAAG;QAC3DlB,OAAOC,IAAI,CAACgB,QAAQC,mBAAmB,EAAEC,OAAO,CAAC,CAACC;YACjD,MAAMC,YAAYD;YAClB,+EAA+E;YAC/EH,QAAQC,mBAAmB,CAACG,UAAU,GAAG;gBACxCX,WAAW;gBACX,+EAA+E;gBAC/EC,aAAaM,QAAQC,mBAAmB,CAACG,UAAU;YACpD;QACD;QACA,OAAO;IACR;IAEA,4EAA4E;IAC5E,OAAO;AACR;AAEO,SAAS3B,iBAAiB4B,UAAe,EAAE,EAAEC,YAAY,EAAEC,OAAO,EAAgD;IACxH,MAAMC,cAAcF,CAAAA,yBAAAA,mCAAAA,aAAcT,MAAM,IAAG,CAAC,gCAAgC,EAAES,aAAaG,IAAI,CAAC,MAAM,GAAG;IACzGC,8CAAoB,CAACC,QAAQ,CAACN,WAAWO,OAAO,CAACC,KAAK,EAAEN,SAASF,WAAWS,QAAQ,EAAEN;AACvF","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/api/server/api.helpers.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b8841a4a3e3342533038e2fd00f5a15c85a1086f","contentHash":"f6f4f9430379517ec2e2982cdf54948c62494805cf1639a61205d421cb931890"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/authorization/server/functions/hasPermission.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/authorization/server/functions/hasPermission.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":21,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":37}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":44}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":34}},"7":{"start":{"line":22,"column":22},"end":{"line":22,"column":59}},"8":{"start":{"line":23,"column":30},"end":{"line":23,"column":138}},"9":{"start":{"line":23,"column":66},"end":{"line":23,"column":138}},"10":{"start":{"line":24,"column":27},"end":{"line":24,"column":134}},"11":{"start":{"line":24,"column":64},"end":{"line":24,"column":134}},"12":{"start":{"line":25,"column":37},"end":{"line":25,"column":152}},"13":{"start":{"line":25,"column":73},"end":{"line":25,"column":152}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":27},"end":{"line":12,"column":28}},"loc":{"start":{"line":12,"column":38},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":34},"end":{"line":15,"column":35}},"loc":{"start":{"line":15,"column":45},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":24},"end":{"line":18,"column":25}},"loc":{"start":{"line":18,"column":35},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":23,"column":30},"end":{"line":23,"column":31}},"loc":{"start":{"line":23,"column":66},"end":{"line":23,"column":138}},"line":23},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":27},"end":{"line":24,"column":28}},"loc":{"start":{"line":24,"column":64},"end":{"line":24,"column":134}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":25,"column":37},"end":{"line":25,"column":38}},"loc":{"start":{"line":25,"column":73},"end":{"line":25,"column":152}},"line":25}},"branchMap":{},"s":{"0":1,"1":1,"2":3,"3":1,"4":0,"5":0,"6":0,"7":1,"8":1,"9":0,"10":1,"11":0,"12":1,"13":0},"f":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/authorization/server/functions/hasPermission.ts"],"sourcesContent":["import { Authorization } from '@rocket.chat/core-services';\nimport type { IUser, IPermission, IRoom } from '@rocket.chat/core-typings';\n\nexport const hasAllPermissionAsync = async (\n\tuserId: IUser['_id'],\n\tpermissions: IPermission['_id'][],\n\tscope?: IRoom['_id'],\n): Promise<boolean> => Authorization.hasAllPermission(userId, permissions, scope);\nexport const hasPermissionAsync = async (userId: IUser['_id'], permissionId: IPermission['_id'], scope?: IRoom['_id']): Promise<boolean> =>\n\tAuthorization.hasPermission(userId, permissionId, scope);\nexport const hasAtLeastOnePermissionAsync = async (\n\tuserId: IUser['_id'],\n\tpermissions: IPermission['_id'][],\n\tscope?: IRoom['_id'],\n): Promise<boolean> => Authorization.hasAtLeastOnePermission(userId, permissions, scope);\n"],"names":["hasAllPermissionAsync","hasAtLeastOnePermissionAsync","hasPermissionAsync","userId","permissions","scope","Authorization","hasAllPermission","permissionId","hasPermission","hasAtLeastOnePermission"],"mappings":";;;;;;;;;;;IAGaA,qBAAqB;eAArBA;;IAOAC,4BAA4B;eAA5BA;;IAFAC,kBAAkB;eAAlBA;;;8BARiB;AAGvB,MAAMF,wBAAwB,OACpCG,QACAC,aACAC,QACsBC,2BAAa,CAACC,gBAAgB,CAACJ,QAAQC,aAAaC;AACpE,MAAMH,qBAAqB,OAAOC,QAAsBK,cAAkCH,QAChGC,2BAAa,CAACG,aAAa,CAACN,QAAQK,cAAcH;AAC5C,MAAMJ,+BAA+B,OAC3CE,QACAC,aACAC,QACsBC,2BAAa,CAACI,uBAAuB,CAACP,QAAQC,aAAaC","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/authorization/server/functions/hasPermission.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6e3f64694c17cc56b5c800d5b5df930188f55be9","contentHash":"662c5b168a5c4727f5a52e13a84fb50a1add806b0e1b6578c74b4bd2add529e4"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/api/server/lib/isValidQuery.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/api/server/lib/isValidQuery.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":28}},"3":{"start":{"line":11,"column":20},"end":{"line":11,"column":43}},"4":{"start":{"line":12,"column":21},"end":{"line":21,"column":2}},"5":{"start":{"line":13,"column":4},"end":{"line":13,"column":29}},"6":{"start":{"line":14,"column":4},"end":{"line":16,"column":5}},"7":{"start":{"line":15,"column":8},"end":{"line":15,"column":51}},"8":{"start":{"line":18,"column":4},"end":{"line":18,"column":68}},"9":{"start":{"line":22,"column":20},"end":{"line":53,"column":1}},"10":{"start":{"line":23,"column":4},"end":{"line":52,"column":7}},"11":{"start":{"line":24,"column":21},"end":{"line":24,"column":54}},"12":{"start":{"line":25,"column":8},"end":{"line":35,"column":9}},"13":{"start":{"line":26,"column":12},"end":{"line":29,"column":13}},"14":{"start":{"line":27,"column":16},"end":{"line":27,"column":71}},"15":{"start":{"line":28,"column":16},"end":{"line":28,"column":29}},"16":{"start":{"line":30,"column":12},"end":{"line":33,"column":13}},"17":{"start":{"line":31,"column":16},"end":{"line":31,"column":96}},"18":{"start":{"line":32,"column":16},"end":{"line":32,"column":29}},"19":{"start":{"line":34,"column":12},"end":{"line":34,"column":90}},"20":{"start":{"line":34,"column":36},"end":{"line":34,"column":88}},"21":{"start":{"line":36,"column":8},"end":{"line":47,"column":9}},"22":{"start":{"line":37,"column":12},"end":{"line":39,"column":13}},"23":{"start":{"line":38,"column":16},"end":{"line":38,"column":75}},"24":{"start":{"line":40,"column":12},"end":{"line":42,"column":13}},"25":{"start":{"line":41,"column":16},"end":{"line":41,"column":28}},"26":{"start":{"line":43,"column":12},"end":{"line":43,"column":45}},"27":{"start":{"line":45,"column":12},"end":{"line":45,"column":67}},"28":{"start":{"line":46,"column":12},"end":{"line":46,"column":25}},"29":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"30":{"start":{"line":49,"column":12},"end":{"line":49,"column":82}},"31":{"start":{"line":51,"column":8},"end":{"line":51,"column":20}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":35},"end":{"line":12,"column":36}},"loc":{"start":{"line":12,"column":82},"end":{"line":19,"column":1}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":22,"column":20},"end":{"line":22,"column":21}},"loc":{"start":{"line":22,"column":80},"end":{"line":53,"column":1}},"line":22},"3":{"name":"(anonymous_3)","decl":{"start":{"line":23,"column":78},"end":{"line":23,"column":79}},"loc":{"start":{"line":23,"column":94},"end":{"line":52,"column":5}},"line":23},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":31},"end":{"line":34,"column":32}},"loc":{"start":{"line":34,"column":36},"end":{"line":34,"column":88}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":36,"column":36},"end":{"line":36,"column":37}},"loc":{"start":{"line":36,"column":56},"end":{"line":44,"column":9}},"line":36}},"branchMap":{"0":{"loc":{"start":{"line":14,"column":4},"end":{"line":16,"column":5}},"type":"if","locations":[{"start":{"line":14,"column":4},"end":{"line":16,"column":5}},{"start":{"line":14,"column":4},"end":{"line":16,"column":5}}],"line":14},"1":{"loc":{"start":{"line":22,"column":66},"end":{"line":22,"column":77}},"type":"default-arg","locations":[{"start":{"line":22,"column":75},"end":{"line":22,"column":77}}],"line":22},"2":{"loc":{"start":{"line":24,"column":21},"end":{"line":24,"column":54}},"type":"cond-expr","locations":[{"start":{"line":24,"column":30},"end":{"line":24,"column":48}},{"start":{"line":24,"column":51},"end":{"line":24,"column":54}}],"line":24},"3":{"loc":{"start":{"line":25,"column":8},"end":{"line":35,"column":9}},"type":"if","locations":[{"start":{"line":25,"column":8},"end":{"line":35,"column":9}},{"start":{"line":25,"column":8},"end":{"line":35,"column":9}}],"line":25},"4":{"loc":{"start":{"line":25,"column":12},"end":{"line":25,"column":49}},"type":"binary-expr","locations":[{"start":{"line":25,"column":12},"end":{"line":25,"column":25}},{"start":{"line":25,"column":29},"end":{"line":25,"column":49}}],"line":25},"5":{"loc":{"start":{"line":26,"column":12},"end":{"line":29,"column":13}},"type":"if","locations":[{"start":{"line":26,"column":12},"end":{"line":29,"column":13}},{"start":{"line":26,"column":12},"end":{"line":29,"column":13}}],"line":26},"6":{"loc":{"start":{"line":30,"column":12},"end":{"line":33,"column":13}},"type":"if","locations":[{"start":{"line":30,"column":12},"end":{"line":33,"column":13}},{"start":{"line":30,"column":12},"end":{"line":33,"column":13}}],"line":30},"7":{"loc":{"start":{"line":36,"column":8},"end":{"line":47,"column":9}},"type":"if","locations":[{"start":{"line":36,"column":8},"end":{"line":47,"column":9}},{"start":{"line":36,"column":8},"end":{"line":47,"column":9}}],"line":36},"8":{"loc":{"start":{"line":37,"column":12},"end":{"line":39,"column":13}},"type":"if","locations":[{"start":{"line":37,"column":12},"end":{"line":39,"column":13}},{"start":{"line":37,"column":12},"end":{"line":39,"column":13}}],"line":37},"9":{"loc":{"start":{"line":40,"column":12},"end":{"line":42,"column":13}},"type":"if","locations":[{"start":{"line":40,"column":12},"end":{"line":42,"column":13}},{"start":{"line":40,"column":12},"end":{"line":42,"column":13}}],"line":40},"10":{"loc":{"start":{"line":40,"column":16},"end":{"line":40,"column":82}},"type":"binary-expr","locations":[{"start":{"line":40,"column":16},"end":{"line":40,"column":46}},{"start":{"line":40,"column":50},"end":{"line":40,"column":82}}],"line":40},"11":{"loc":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"type":"if","locations":[{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},{"start":{"line":48,"column":8},"end":{"line":50,"column":9}}],"line":48}},"s":{"0":1,"1":1,"2":28,"3":1,"4":1,"5":15,"6":15,"7":0,"8":15,"9":1,"10":28,"11":36,"12":36,"13":6,"14":2,"15":2,"16":4,"17":0,"18":0,"19":4,"20":5,"21":30,"22":72,"23":12,"24":60,"25":2,"26":58,"27":6,"28":6,"29":24,"30":8,"31":16},"f":{"0":28,"1":15,"2":28,"3":36,"4":5,"5":72},"b":{"0":[0,15],"1":[20],"2":[14,22],"3":[6,30],"4":[36,22],"5":[2,4],"6":[0,4],"7":[6,24],"8":[12,60],"9":[2,58],"10":[60,2],"11":[8,16]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/api/server/lib/isValidQuery.ts"],"sourcesContent":["import { removeDangerousProps } from './cleanQuery';\n\ntype Query = { [k: string]: any };\n\nexport const isValidQuery: {\n\t(query: Query, allowedAttributes: string[], allowedOperations: string[]): boolean;\n\terrors: string[];\n} = Object.assign(\n\t(query: Query, allowedAttributes: string[], allowedOperations: string[]): boolean => {\n\t\tisValidQuery.errors = [];\n\t\tif (!(query instanceof Object)) {\n\t\t\tthrow new Error('query must be an object');\n\t\t}\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-use-before-define\n\t\treturn verifyQuery(query, allowedAttributes, allowedOperations);\n\t},\n\t{\n\t\terrors: [],\n\t},\n);\n\nconst verifyQuery = (query: Query, allowedAttributes: string[], allowedOperations: string[], parent = ''): boolean => {\n\treturn Object.entries(removeDangerousProps(query)).every(([key, value]) => {\n\t\tconst path = parent ? `${parent}.${key}` : key;\n\t\tif (parent === '' && path.startsWith('$')) {\n\t\t\tif (!allowedOperations.includes(path)) {\n\t\t\t\tisValidQuery.errors.push(`Invalid operation: ${path}`);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (!Array.isArray(value)) {\n\t\t\t\tisValidQuery.errors.push(`Invalid parameter for operation: ${path} : ${value}`);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn value.every((v) => verifyQuery(v, allowedAttributes, allowedOperations));\n\t\t}\n\n\t\tif (\n\t\t\t!allowedAttributes.some((allowedAttribute) => {\n\t\t\t\tif (allowedAttribute.endsWith('.*')) {\n\t\t\t\t\treturn path.startsWith(allowedAttribute.replace('.*', ''));\n\t\t\t\t}\n\t\t\t\tif (allowedAttribute.endsWith('*') && !allowedAttribute.endsWith('.*')) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn path === allowedAttribute;\n\t\t\t})\n\t\t) {\n\t\t\tisValidQuery.errors.push(`Invalid attribute: ${path}`);\n\t\t\treturn false;\n\t\t}\n\n\t\tif (value instanceof Object) {\n\t\t\treturn verifyQuery(value, allowedAttributes, allowedOperations, path);\n\t\t}\n\t\treturn true;\n\t});\n};\n"],"names":["isValidQuery","Object","assign","query","allowedAttributes","allowedOperations","errors","Error","verifyQuery","parent","entries","removeDangerousProps","every","key","value","path","startsWith","includes","push","Array","isArray","v","some","allowedAttribute","endsWith","replace"],"mappings":";;;;+BAIaA;;;eAAAA;;;4BAJwB;AAI9B,MAAMA,eAGTC,OAAOC,MAAM,CAChB,CAACC,OAAcC,mBAA6BC;IAC3CL,aAAaM,MAAM,GAAG,EAAE;IACxB,IAAI,CAAEH,CAAAA,iBAAiBF,MAAK,GAAI;QAC/B,MAAM,IAAIM,MAAM;IACjB;IAEA,mEAAmE;IACnE,OAAOC,YAAYL,OAAOC,mBAAmBC;AAC9C,GACA;IACCC,QAAQ,EAAE;AACX;AAGD,MAAME,cAAc,CAACL,OAAcC,mBAA6BC,mBAA6BI,SAAS,EAAE;IACvG,OAAOR,OAAOS,OAAO,CAACC,IAAAA,gCAAoB,EAACR,QAAQS,KAAK,CAAC,CAAC,CAACC,KAAKC,MAAM;QACrE,MAAMC,OAAON,SAAS,GAAGA,OAAO,CAAC,EAAEI,KAAK,GAAGA;QAC3C,IAAIJ,WAAW,MAAMM,KAAKC,UAAU,CAAC,MAAM;YAC1C,IAAI,CAACX,kBAAkBY,QAAQ,CAACF,OAAO;gBACtCf,aAAaM,MAAM,CAACY,IAAI,CAAC,CAAC,mBAAmB,EAAEH,MAAM;gBACrD,OAAO;YACR;YACA,IAAI,CAACI,MAAMC,OAAO,CAACN,QAAQ;gBAC1Bd,aAAaM,MAAM,CAACY,IAAI,CAAC,CAAC,iCAAiC,EAAEH,KAAK,GAAG,EAAED,OAAO;gBAC9E,OAAO;YACR;YACA,OAAOA,MAAMF,KAAK,CAAC,CAACS,IAAMb,YAAYa,GAAGjB,mBAAmBC;QAC7D;QAEA,IACC,CAACD,kBAAkBkB,IAAI,CAAC,CAACC;YACxB,IAAIA,iBAAiBC,QAAQ,CAAC,OAAO;gBACpC,OAAOT,KAAKC,UAAU,CAACO,iBAAiBE,OAAO,CAAC,MAAM;YACvD;YACA,IAAIF,iBAAiBC,QAAQ,CAAC,QAAQ,CAACD,iBAAiBC,QAAQ,CAAC,OAAO;gBACvE,OAAO;YACR;YACA,OAAOT,SAASQ;QACjB,IACC;YACDvB,aAAaM,MAAM,CAACY,IAAI,CAAC,CAAC,mBAAmB,EAAEH,MAAM;YACrD,OAAO;QACR;QAEA,IAAID,iBAAiBb,QAAQ;YAC5B,OAAOO,YAAYM,OAAOV,mBAAmBC,mBAAmBU;QACjE;QACA,OAAO;IACR;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/api/server/lib/isValidQuery.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"1a30f2b526c2fb41c5c3d1569ef75438ab6ef86d","contentHash":"9d7aa69c4e5e8a537759b5ade81861689530f1534e1febe2cd7fe3305c9505b5"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/api/server/lib/cleanQuery.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/api/server/lib/cleanQuery.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":21}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":36}},"6":{"start":{"line":19,"column":17},"end":{"line":23,"column":1}},"7":{"start":{"line":24,"column":29},"end":{"line":32,"column":1}},"8":{"start":{"line":25,"column":18},"end":{"line":25,"column":37}},"9":{"start":{"line":26,"column":4},"end":{"line":30,"column":5}},"10":{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},"11":{"start":{"line":28,"column":12},"end":{"line":28,"column":32}},"12":{"start":{"line":31,"column":4},"end":{"line":31,"column":17}},"13":{"start":{"line":34,"column":23},"end":{"line":34,"column":46}},"14":{"start":{"line":35,"column":4},"end":{"line":43,"column":5}},"15":{"start":{"line":36,"column":8},"end":{"line":42,"column":9}},"16":{"start":{"line":37,"column":12},"end":{"line":41,"column":13}},"17":{"start":{"line":38,"column":16},"end":{"line":38,"column":39}},"18":{"start":{"line":40,"column":16},"end":{"line":40,"column":50}},"19":{"start":{"line":44,"column":4},"end":{"line":44,"column":22}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":11},"end":{"line":12,"column":12}},"loc":{"start":{"line":12,"column":22},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":26},"end":{"line":15,"column":27}},"loc":{"start":{"line":15,"column":37},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":24,"column":29},"end":{"line":24,"column":30}},"loc":{"start":{"line":24,"column":34},"end":{"line":32,"column":1}},"line":24},"4":{"name":"clean","decl":{"start":{"line":33,"column":9},"end":{"line":33,"column":14}},"loc":{"start":{"line":33,"column":34},"end":{"line":45,"column":1}},"line":33}},"branchMap":{"0":{"loc":{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},"type":"if","locations":[{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},{"start":{"line":27,"column":8},"end":{"line":29,"column":9}}],"line":27},"1":{"loc":{"start":{"line":27,"column":12},"end":{"line":27,"column":60}},"type":"binary-expr","locations":[{"start":{"line":27,"column":12},"end":{"line":27,"column":33}},{"start":{"line":27,"column":37},"end":{"line":27,"column":60}}],"line":27},"2":{"loc":{"start":{"line":33,"column":18},"end":{"line":33,"column":32}},"type":"default-arg","locations":[{"start":{"line":33,"column":30},"end":{"line":33,"column":32}}],"line":33},"3":{"loc":{"start":{"line":35,"column":4},"end":{"line":43,"column":5}},"type":"if","locations":[{"start":{"line":35,"column":4},"end":{"line":43,"column":5}},{"start":{"line":35,"column":4},"end":{"line":43,"column":5}}],"line":35},"4":{"loc":{"start":{"line":37,"column":12},"end":{"line":41,"column":13}},"type":"if","locations":[{"start":{"line":37,"column":12},"end":{"line":41,"column":13}},{"start":{"line":37,"column":12},"end":{"line":41,"column":13}}],"line":37},"5":{"loc":{"start":{"line":37,"column":16},"end":{"line":37,"column":63}},"type":"binary-expr","locations":[{"start":{"line":37,"column":16},"end":{"line":37,"column":35}},{"start":{"line":37,"column":39},"end":{"line":37,"column":63}}],"line":37}},"s":{"0":1,"1":1,"2":2,"3":1,"4":0,"5":28,"6":1,"7":1,"8":28,"9":28,"10":39,"11":39,"12":28,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},"f":{"0":1,"1":0,"2":28,"3":28,"4":0},"b":{"0":[39,0],"1":[39,39],"2":[0],"3":[0,0],"4":[0,0],"5":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/api/server/lib/cleanQuery.ts"],"sourcesContent":["type Query = { [k: string]: any };\n\nconst denyList = ['constructor', '__proto__', 'prototype'];\n\nexport const removeDangerousProps = (v: Query): Query => {\n\tconst query = Object.create(null);\n\tfor (const key in v) {\n\t\tif (v.hasOwnProperty(key) && !denyList.includes(key)) {\n\t\t\tquery[key] = v[key];\n\t\t}\n\t}\n\n\treturn query;\n};\n/* @deprecated */\nexport function clean(v: Query, allowList: string[] = []): Query {\n\tconst typedParam = removeDangerousProps(v);\n\tif (v instanceof Object) {\n\t\tfor (const key in typedParam) {\n\t\t\tif (key.startsWith('$') && !allowList.includes(key)) {\n\t\t\t\tdelete typedParam[key];\n\t\t\t} else {\n\t\t\t\tclean(typedParam[key], allowList);\n\t\t\t}\n\t\t}\n\t}\n\treturn typedParam;\n}\n"],"names":["clean","removeDangerousProps","denyList","v","query","Object","create","key","hasOwnProperty","includes","allowList","typedParam","startsWith"],"mappings":";;;;;;;;;;;IAegBA,KAAK;eAALA;;IAXHC,oBAAoB;eAApBA;;;AAFb,MAAMC,WAAW;IAAC;IAAe;IAAa;CAAY;AAEnD,MAAMD,uBAAuB,CAACE;IACpC,MAAMC,QAAQC,OAAOC,MAAM,CAAC;IAC5B,IAAK,MAAMC,OAAOJ,EAAG;QACpB,IAAIA,EAAEK,cAAc,CAACD,QAAQ,CAACL,SAASO,QAAQ,CAACF,MAAM;YACrDH,KAAK,CAACG,IAAI,GAAGJ,CAAC,CAACI,IAAI;QACpB;IACD;IAEA,OAAOH;AACR;AAEO,SAASJ,MAAMG,CAAQ,EAAEO,YAAsB,EAAE;IACvD,MAAMC,aAAaV,qBAAqBE;IACxC,IAAIA,aAAaE,QAAQ;QACxB,IAAK,MAAME,OAAOI,WAAY;YAC7B,IAAIJ,IAAIK,UAAU,CAAC,QAAQ,CAACF,UAAUD,QAAQ,CAACF,MAAM;gBACpD,OAAOI,UAAU,CAACJ,IAAI;YACvB,OAAO;gBACNP,MAAMW,UAAU,CAACJ,IAAI,EAAEG;YACxB;QACD;IACD;IACA,OAAOC;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/api/server/lib/cleanQuery.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"916adb8442e6b4f8c61518cba7332dda897131b0","contentHash":"d57438bc9e253943970b8d9b7f3201959c27e1f5acc8ba94fbe86a167ba71f3e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/e2e/server/functions/resetRoomKey.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/e2e/server/functions/resetRoomKey.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":21,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":27}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":35}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":28}},"7":{"start":{"line":22,"column":16},"end":{"line":22,"column":46}},"8":{"start":{"line":23,"column":24},"end":{"line":23,"column":73}},"9":{"start":{"line":26,"column":17},"end":{"line":30,"column":6}},"10":{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},"11":{"start":{"line":32,"column":8},"end":{"line":32,"column":48}},"12":{"start":{"line":34,"column":4},"end":{"line":36,"column":5}},"13":{"start":{"line":35,"column":8},"end":{"line":35,"column":50}},"14":{"start":{"line":37,"column":17},"end":{"line":41,"column":6}},"15":{"start":{"line":42,"column":4},"end":{"line":44,"column":5}},"16":{"start":{"line":43,"column":8},"end":{"line":43,"column":48}},"17":{"start":{"line":45,"column":4},"end":{"line":47,"column":5}},"18":{"start":{"line":46,"column":8},"end":{"line":46,"column":52}},"19":{"start":{"line":49,"column":23},"end":{"line":49,"column":25}},"20":{"start":{"line":50,"column":22},"end":{"line":50,"column":24}},"21":{"start":{"line":51,"column":21},"end":{"line":51,"column":23}},"22":{"start":{"line":52,"column":4},"end":{"line":112,"column":5}},"23":{"start":{"line":69,"column":21},"end":{"line":69,"column":60}},"24":{"start":{"line":70,"column":8},"end":{"line":70,"column":35}},"25":{"start":{"line":71,"column":8},"end":{"line":71,"column":26}},"26":{"start":{"line":72,"column":8},"end":{"line":72,"column":40}},"27":{"start":{"line":73,"column":26},"end":{"line":79,"column":9}},"28":{"start":{"line":80,"column":8},"end":{"line":94,"column":11}},"29":{"start":{"line":95,"column":8},"end":{"line":108,"column":9}},"30":{"start":{"line":97,"column":12},"end":{"line":102,"column":15}},"31":{"start":{"line":104,"column":12},"end":{"line":107,"column":15}},"32":{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},"33":{"start":{"line":110,"column":12},"end":{"line":110,"column":56}},"34":{"start":{"line":113,"column":4},"end":{"line":115,"column":5}},"35":{"start":{"line":114,"column":8},"end":{"line":114,"column":52}},"36":{"start":{"line":118,"column":23},"end":{"line":118,"column":110}},"37":{"start":{"line":120,"column":19},"end":{"line":120,"column":101}},"38":{"start":{"line":121,"column":4},"end":{"line":123,"column":5}},"39":{"start":{"line":122,"column":8},"end":{"line":122,"column":76}},"40":{"start":{"line":124,"column":4},"end":{"line":126,"column":5}},"41":{"start":{"line":125,"column":8},"end":{"line":125,"column":72}},"42":{"start":{"line":129,"column":4},"end":{"line":131,"column":5}},"43":{"start":{"line":130,"column":8},"end":{"line":130,"column":23}},"44":{"start":{"line":134,"column":4},"end":{"line":136,"column":7}},"45":{"start":{"line":137,"column":4},"end":{"line":139,"column":7}},"46":{"start":{"line":138,"column":8},"end":{"line":138,"column":67}},"47":{"start":{"line":140,"column":4},"end":{"line":140,"column":26}},"48":{"start":{"line":141,"column":4},"end":{"line":141,"column":25}},"49":{"start":{"line":144,"column":4},"end":{"line":146,"column":5}},"50":{"start":{"line":145,"column":8},"end":{"line":145,"column":15}},"51":{"start":{"line":147,"column":4},"end":{"line":155,"column":5}},"52":{"start":{"line":148,"column":8},"end":{"line":154,"column":10}},"53":{"start":{"line":156,"column":23},"end":{"line":156,"column":88}},"54":{"start":{"line":156,"column":56},"end":{"line":156,"column":87}},"55":{"start":{"line":157,"column":4},"end":{"line":161,"column":7}},"56":{"start":{"line":162,"column":4},"end":{"line":162,"column":35}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":17},"end":{"line":12,"column":18}},"loc":{"start":{"line":12,"column":28},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":25},"end":{"line":15,"column":26}},"loc":{"start":{"line":15,"column":36},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":18},"end":{"line":18,"column":19}},"loc":{"start":{"line":18,"column":29},"end":{"line":20,"column":5}},"line":18},"4":{"name":"resetRoomKey","decl":{"start":{"line":24,"column":15},"end":{"line":24,"column":27}},"loc":{"start":{"line":24,"column":70},"end":{"line":127,"column":1}},"line":24},"5":{"name":"pushToLimit","decl":{"start":{"line":128,"column":9},"end":{"line":128,"column":20}},"loc":{"start":{"line":128,"column":44},"end":{"line":132,"column":1}},"line":128},"6":{"name":"writeAndNotify","decl":{"start":{"line":133,"column":15},"end":{"line":133,"column":29}},"loc":{"start":{"line":133,"column":53},"end":{"line":142,"column":1}},"line":133},"7":{"name":"(anonymous_7)","decl":{"start":{"line":137,"column":23},"end":{"line":137,"column":24}},"loc":{"start":{"line":137,"column":30},"end":{"line":139,"column":5}},"line":137},"8":{"name":"replicateMongoSlice","decl":{"start":{"line":143,"column":9},"end":{"line":143,"column":28}},"loc":{"start":{"line":143,"column":41},"end":{"line":163,"column":1}},"line":143},"9":{"name":"(anonymous_9)","decl":{"start":{"line":156,"column":48},"end":{"line":156,"column":49}},"loc":{"start":{"line":156,"column":56},"end":{"line":156,"column":87}},"line":156}},"branchMap":{"0":{"loc":{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},"type":"if","locations":[{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},{"start":{"line":31,"column":4},"end":{"line":33,"column":5}}],"line":31},"1":{"loc":{"start":{"line":34,"column":4},"end":{"line":36,"column":5}},"type":"if","locations":[{"start":{"line":34,"column":4},"end":{"line":36,"column":5}},{"start":{"line":34,"column":4},"end":{"line":36,"column":5}}],"line":34},"2":{"loc":{"start":{"line":34,"column":8},"end":{"line":34,"column":196}},"type":"binary-expr","locations":[{"start":{"line":34,"column":8},"end":{"line":34,"column":99}},{"start":{"line":34,"column":103},"end":{"line":34,"column":196}}],"line":34},"3":{"loc":{"start":{"line":34,"column":10},"end":{"line":34,"column":98}},"type":"cond-expr","locations":[{"start":{"line":34,"column":68},"end":{"line":34,"column":74}},{"start":{"line":34,"column":77},"end":{"line":34,"column":98}}],"line":34},"4":{"loc":{"start":{"line":34,"column":10},"end":{"line":34,"column":65}},"type":"binary-expr","locations":[{"start":{"line":34,"column":10},"end":{"line":34,"column":41}},{"start":{"line":34,"column":45},"end":{"line":34,"column":65}}],"line":34},"5":{"loc":{"start":{"line":34,"column":105},"end":{"line":34,"column":195}},"type":"cond-expr","locations":[{"start":{"line":34,"column":165},"end":{"line":34,"column":171}},{"start":{"line":34,"column":174},"end":{"line":34,"column":195}}],"line":34},"6":{"loc":{"start":{"line":34,"column":105},"end":{"line":34,"column":162}},"type":"binary-expr","locations":[{"start":{"line":34,"column":105},"end":{"line":34,"column":137}},{"start":{"line":34,"column":141},"end":{"line":34,"column":162}}],"line":34},"7":{"loc":{"start":{"line":42,"column":4},"end":{"line":44,"column":5}},"type":"if","locations":[{"start":{"line":42,"column":4},"end":{"line":44,"column":5}},{"start":{"line":42,"column":4},"end":{"line":44,"column":5}}],"line":42},"8":{"loc":{"start":{"line":45,"column":4},"end":{"line":47,"column":5}},"type":"if","locations":[{"start":{"line":45,"column":4},"end":{"line":47,"column":5}},{"start":{"line":45,"column":4},"end":{"line":47,"column":5}}],"line":45},"9":{"loc":{"start":{"line":75,"column":19},"end":{"line":77,"column":17}},"type":"binary-expr","locations":[{"start":{"line":75,"column":19},"end":{"line":75,"column":23}},{"start":{"line":75,"column":27},"end":{"line":77,"column":17}}],"line":75},"10":{"loc":{"start":{"line":91,"column":23},"end":{"line":91,"column":70}},"type":"binary-expr","locations":[{"start":{"line":91,"column":23},"end":{"line":91,"column":57}},{"start":{"line":91,"column":61},"end":{"line":91,"column":70}}],"line":91},"11":{"loc":{"start":{"line":95,"column":8},"end":{"line":108,"column":9}},"type":"if","locations":[{"start":{"line":95,"column":8},"end":{"line":108,"column":9}},{"start":{"line":95,"column":8},"end":{"line":108,"column":9}}],"line":95},"12":{"loc":{"start":{"line":99,"column":19},"end":{"line":101,"column":17}},"type":"binary-expr","locations":[{"start":{"line":99,"column":19},"end":{"line":99,"column":23}},{"start":{"line":99,"column":27},"end":{"line":101,"column":17}}],"line":99},"13":{"loc":{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},"type":"if","locations":[{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},{"start":{"line":109,"column":8},"end":{"line":111,"column":9}}],"line":109},"14":{"loc":{"start":{"line":113,"column":4},"end":{"line":115,"column":5}},"type":"if","locations":[{"start":{"line":113,"column":4},"end":{"line":115,"column":5}},{"start":{"line":113,"column":4},"end":{"line":115,"column":5}}],"line":113},"15":{"loc":{"start":{"line":121,"column":4},"end":{"line":123,"column":5}},"type":"if","locations":[{"start":{"line":121,"column":4},"end":{"line":123,"column":5}},{"start":{"line":121,"column":4},"end":{"line":123,"column":5}}],"line":121},"16":{"loc":{"start":{"line":124,"column":4},"end":{"line":126,"column":5}},"type":"if","locations":[{"start":{"line":124,"column":4},"end":{"line":126,"column":5}},{"start":{"line":124,"column":4},"end":{"line":126,"column":5}}],"line":124},"17":{"loc":{"start":{"line":128,"column":32},"end":{"line":128,"column":42}},"type":"default-arg","locations":[{"start":{"line":128,"column":40},"end":{"line":128,"column":42}}],"line":128},"18":{"loc":{"start":{"line":129,"column":4},"end":{"line":131,"column":5}},"type":"if","locations":[{"start":{"line":129,"column":4},"end":{"line":131,"column":5}},{"start":{"line":129,"column":4},"end":{"line":131,"column":5}}],"line":129},"19":{"loc":{"start":{"line":144,"column":4},"end":{"line":146,"column":5}},"type":"if","locations":[{"start":{"line":144,"column":4},"end":{"line":146,"column":5}},{"start":{"line":144,"column":4},"end":{"line":146,"column":5}}],"line":144},"20":{"loc":{"start":{"line":147,"column":4},"end":{"line":155,"column":5}},"type":"if","locations":[{"start":{"line":147,"column":4},"end":{"line":155,"column":5}},{"start":{"line":147,"column":4},"end":{"line":155,"column":5}}],"line":147}},"s":{"0":1,"1":1,"2":3,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":8,"10":8,"11":1,"12":7,"13":3,"14":4,"15":4,"16":1,"17":3,"18":1,"19":2,"20":2,"21":2,"22":2,"23":160,"24":160,"25":160,"26":160,"27":160,"28":160,"29":160,"30":160,"31":160,"32":160,"33":1,"34":2,"35":2,"36":2,"37":2,"38":2,"39":2,"40":2,"41":2,"42":163,"43":62,"44":3,"45":3,"46":160,"47":3,"48":3,"49":164,"50":71,"51":93,"52":53,"53":40,"54":188,"55":40,"56":40},"f":{"0":1,"1":1,"2":1,"3":1,"4":8,"5":163,"6":3,"7":160,"8":164,"9":188},"b":{"0":[1,7],"1":[3,4],"2":[7,5],"3":[1,6],"4":[7,7],"5":[0,5],"6":[5,5],"7":[1,3],"8":[1,2],"9":[160,90],"10":[160,90],"11":[160,0],"12":[160,90],"13":[1,159],"14":[2,0],"15":[2,0],"16":[2,0],"17":[160],"18":[62,101],"19":[71,93],"20":[53,40]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/e2e/server/functions/resetRoomKey.ts"],"sourcesContent":["import type { ISubscription, IUser, IRoom } from '@rocket.chat/core-typings';\nimport { Rooms, Subscriptions, Users } from '@rocket.chat/models';\nimport type { AnyBulkWriteOperation } from 'mongodb';\n\nimport { notifyOnRoomChanged, notifyOnSubscriptionChanged } from '../../../lib/server/lib/notifyListener';\n\nexport async function resetRoomKey(roomId: string, userId: string, newRoomKey: string, newRoomKeyId: string) {\n\tconst user = await Users.findOneById<Pick<IUser, 'e2e'>>(userId, { projection: { e2e: 1 } });\n\tif (!user) {\n\t\tthrow new Error('error-user-not-found');\n\t}\n\n\tif (!user.e2e?.private_key || !user.e2e?.public_key) {\n\t\tthrow new Error('error-user-has-no-keys');\n\t}\n\n\tconst room = await Rooms.findOneById<Pick<IRoom, 'e2eKeyId'>>(roomId, { projection: { e2eKeyId: 1 } });\n\tif (!room) {\n\t\tthrow new Error('error-room-not-found');\n\t}\n\n\tif (!room.e2eKeyId) {\n\t\tthrow new Error('error-room-not-encrypted');\n\t}\n\n\t// We will update the subs of everyone who has a key for the room. For the ones that don't have, we will do nothing\n\tconst notifySubs = [];\n\tconst updateOps: AnyBulkWriteOperation<ISubscription>[] = [];\n\tconst e2eQueue: IRoom['usersWaitingForE2EKeys'] = [];\n\n\tfor await (const sub of Subscriptions.find({\n\t\trid: roomId,\n\t\t$or: [{ E2EKey: { $exists: true } }, { E2ESuggestedKey: { $exists: true } }],\n\t})) {\n\t\t// This replicates the oldRoomKeys array modifications allowing us to have the changes locally without finding them again\n\t\t// which allows for quicker notifying\n\t\tconst keys = replicateMongoSlice(room.e2eKeyId, sub);\n\t\tdelete sub.E2ESuggestedKey;\n\t\tdelete sub.E2EKey;\n\t\tdelete sub.suggestedOldRoomKeys;\n\n\t\tconst updateSet = {\n\t\t\t$set: {\n\t\t\t\t...(keys && { oldRoomKeys: keys }),\n\t\t\t},\n\t\t};\n\t\tupdateOps.push({\n\t\t\tupdateOne: {\n\t\t\t\tfilter: { _id: sub._id },\n\t\t\t\tupdate: {\n\t\t\t\t\t$unset: { E2EKey: 1, E2ESuggestedKey: 1, suggestedOldRoomKeys: 1 },\n\t\t\t\t\t...(Object.keys(updateSet.$set).length && updateSet),\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tif (userId !== sub.u._id) {\n\t\t\t// Avoid notifying requesting user as notify will happen at the end\n\t\t\tnotifySubs.push({\n\t\t\t\t...sub,\n\t\t\t\t...(keys && { oldRoomKeys: keys }),\n\t\t\t});\n\n\t\t\t// This is for allowing the key distribution process to start inmediately\n\t\t\tpushToLimit(e2eQueue, { userId: sub.u._id, ts: new Date() });\n\t\t}\n\n\t\tif (updateOps.length >= 100) {\n\t\t\tawait writeAndNotify(updateOps, notifySubs);\n\t\t}\n\t}\n\n\tif (updateOps.length > 0) {\n\t\tawait writeAndNotify(updateOps, notifySubs);\n\t}\n\n\t// after the old keys have been moved to the new prop, store room key on room + the e2e queue so key can be exchanged\n\t// todo move to model method\n\tconst roomResult = await Rooms.resetRoomKeyAndSetE2EEQueueByRoomId(roomId, newRoomKeyId, e2eQueue);\n\t// And set the new key to the user that called the func\n\tconst result = await Subscriptions.setE2EKeyByUserIdAndRoomId(userId, roomId, newRoomKey);\n\n\tif (result.value) {\n\t\tvoid notifyOnSubscriptionChanged(result.value);\n\t}\n\tif (roomResult.value) {\n\t\tvoid notifyOnRoomChanged(roomResult.value);\n\t}\n}\n\nexport function pushToLimit(\n\tarr: NonNullable<IRoom['usersWaitingForE2EKeys']>,\n\titem: NonNullable<IRoom['usersWaitingForE2EKeys']>[number],\n\tlimit = 50,\n) {\n\tif (arr.length < limit) {\n\t\tarr.push(item);\n\t}\n}\n\nasync function writeAndNotify(updateOps: AnyBulkWriteOperation<ISubscription>[], notifySubs: ISubscription[]) {\n\tawait Subscriptions.col.bulkWrite([...updateOps]);\n\tnotifySubs.forEach((sub) => {\n\t\tvoid notifyOnSubscriptionChanged(sub);\n\t});\n\tnotifySubs.length = 0;\n\tupdateOps.length = 0;\n}\n\nexport function replicateMongoSlice(keyId: string, sub: ISubscription) {\n\tif (!sub.E2EKey) {\n\t\treturn;\n\t}\n\n\tif (!sub.oldRoomKeys) {\n\t\treturn [{ e2eKeyId: keyId, ts: new Date(), E2EKey: sub.E2EKey }];\n\t}\n\n\tconst sortedKeys = sub.oldRoomKeys.toSorted((a, b) => b.ts.getTime() - a.ts.getTime());\n\tsortedKeys.unshift({ e2eKeyId: keyId, ts: new Date(), E2EKey: sub.E2EKey });\n\n\treturn sortedKeys.slice(0, 10);\n}\n"],"names":["pushToLimit","replicateMongoSlice","resetRoomKey","roomId","userId","newRoomKey","newRoomKeyId","user","Users","findOneById","projection","e2e","Error","private_key","public_key","room","Rooms","e2eKeyId","notifySubs","updateOps","e2eQueue","sub","Subscriptions","find","rid","$or","E2EKey","$exists","E2ESuggestedKey","keys","suggestedOldRoomKeys","updateSet","$set","oldRoomKeys","push","updateOne","filter","_id","update","$unset","Object","length","u","ts","Date","writeAndNotify","roomResult","resetRoomKeyAndSetE2EEQueueByRoomId","result","setE2EKeyByUserIdAndRoomId","value","notifyOnSubscriptionChanged","notifyOnRoomChanged","arr","item","limit","col","bulkWrite","forEach","keyId","sortedKeys","toSorted","a","b","getTime","unshift","slice"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/e2e/server/functions/resetRoomKey.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"86a424e27fb0372a86b6c7b4f9dab4af0d2a1374","contentHash":"84f681f87b6c6d39126411d1b434a176d4a1bdd76b3f1532791f221102ad81f6"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/e2e/server/methods/updateGroupKey.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/e2e/server/methods/updateGroupKey.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":30}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":40}},"5":{"start":{"line":13,"column":34},"end":{"line":13,"column":93}},"6":{"start":{"line":14,"column":24},"end":{"line":14,"column":73}},"7":{"start":{"line":17,"column":18},"end":{"line":17,"column":89}},"8":{"start":{"line":18,"column":4},"end":{"line":43,"column":5}},"9":{"start":{"line":20,"column":8},"end":{"line":37,"column":9}},"10":{"start":{"line":21,"column":43},"end":{"line":21,"column":101}},"11":{"start":{"line":27,"column":38},"end":{"line":29,"column":14}},"12":{"start":{"line":30,"column":12},"end":{"line":32,"column":13}},"13":{"start":{"line":31,"column":16},"end":{"line":31,"column":85}},"14":{"start":{"line":33,"column":12},"end":{"line":35,"column":13}},"15":{"start":{"line":34,"column":16},"end":{"line":34,"column":77}},"16":{"start":{"line":36,"column":12},"end":{"line":36,"column":19}},"17":{"start":{"line":39,"column":26},"end":{"line":39,"column":92}},"18":{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},"19":{"start":{"line":41,"column":12},"end":{"line":41,"column":73}},"20":{"start":{"line":45,"column":0},"end":{"line":56,"column":3}},"21":{"start":{"line":47,"column":23},"end":{"line":47,"column":46}},"22":{"start":{"line":48,"column":8},"end":{"line":52,"column":9}},"23":{"start":{"line":49,"column":12},"end":{"line":51,"column":15}},"24":{"start":{"line":53,"column":8},"end":{"line":53,"column":96}},"25":{"start":{"line":54,"column":8},"end":{"line":54,"column":53}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"updateGroupKey","decl":{"start":{"line":15,"column":15},"end":{"line":15,"column":29}},"loc":{"start":{"line":15,"column":59},"end":{"line":44,"column":1}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":46,"column":4},"end":{"line":46,"column":5}},"loc":{"start":{"line":46,"column":47},"end":{"line":55,"column":5}},"line":46}},"branchMap":{"0":{"loc":{"start":{"line":18,"column":4},"end":{"line":43,"column":5}},"type":"if","locations":[{"start":{"line":18,"column":4},"end":{"line":43,"column":5}},{"start":{"line":18,"column":4},"end":{"line":43,"column":5}}],"line":18},"1":{"loc":{"start":{"line":20,"column":8},"end":{"line":37,"column":9}},"type":"if","locations":[{"start":{"line":20,"column":8},"end":{"line":37,"column":9}},{"start":{"line":20,"column":8},"end":{"line":37,"column":9}}],"line":20},"2":{"loc":{"start":{"line":30,"column":12},"end":{"line":32,"column":13}},"type":"if","locations":[{"start":{"line":30,"column":12},"end":{"line":32,"column":13}},{"start":{"line":30,"column":12},"end":{"line":32,"column":13}}],"line":30},"3":{"loc":{"start":{"line":33,"column":12},"end":{"line":35,"column":13}},"type":"if","locations":[{"start":{"line":33,"column":12},"end":{"line":35,"column":13}},{"start":{"line":33,"column":12},"end":{"line":35,"column":13}}],"line":33},"4":{"loc":{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},"type":"if","locations":[{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},{"start":{"line":40,"column":8},"end":{"line":42,"column":9}}],"line":40},"5":{"loc":{"start":{"line":48,"column":8},"end":{"line":52,"column":9}},"type":"if","locations":[{"start":{"line":48,"column":8},"end":{"line":52,"column":9}},{"start":{"line":48,"column":8},"end":{"line":52,"column":9}}],"line":48}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":3,"8":3,"9":2,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":0,"22":0,"23":0,"24":0,"25":0},"f":{"0":1,"1":3,"2":0},"b":{"0":[2,1],"1":[1,1],"2":[1,0],"3":[1,0],"4":[1,0],"5":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/e2e/server/methods/updateGroupKey.ts"],"sourcesContent":["import type { ServerMethods } from '@rocket.chat/ddp-client';\nimport { Subscriptions, Rooms } from '@rocket.chat/models';\nimport { Meteor } from 'meteor/meteor';\n\nimport { methodDeprecationLogger } from '../../../lib/server/lib/deprecationWarningLogger';\nimport {\n\tnotifyOnSubscriptionChangedById,\n\tnotifyOnSubscriptionChanged,\n\tnotifyOnRoomChangedById,\n} from '../../../lib/server/lib/notifyListener';\n\ndeclare module '@rocket.chat/ddp-client' {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface ServerMethods {\n\t\t'e2e.updateGroupKey'(rid: string, uid: string, key: string): Promise<void>;\n\t}\n}\n\nexport async function updateGroupKey(rid: string, uid: string, key: string, callerUserId: string) {\n\t// I have a subscription to this room\n\tconst mySub = await Subscriptions.findOneByRoomIdAndUserId(rid, callerUserId);\n\n\tif (mySub) {\n\t\t// Setting the key to myself, can set directly to the final field\n\t\tif (callerUserId === uid) {\n\t\t\tconst setGroupE2EKeyResponse = await Subscriptions.setGroupE2EKey(mySub._id, key);\n\t\t\t// Case: I create an encrypted room before setting up my keys, and I reset the e2e keys\n\t\t\t// Next login, I'll create the keys for the room, and set them here.\n\t\t\t// However as I reset my keys, I'm on the `usersWaitingForKeys` queue\n\t\t\t// So I need to remove myself from the queue and notify the time i reach here\n\t\t\t// This way, I can provide the keys to other users\n\t\t\tconst { modifiedCount } = await Rooms.removeUsersFromE2EEQueueByRoomId(mySub.rid, [callerUserId]);\n\t\t\tif (setGroupE2EKeyResponse.modifiedCount) {\n\t\t\t\tvoid notifyOnSubscriptionChangedById(mySub._id);\n\t\t\t}\n\t\t\tif (modifiedCount) {\n\t\t\t\tvoid notifyOnRoomChangedById(mySub.rid);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// uid also has subscription to this room\n\t\tconst { value } = await Subscriptions.setGroupE2ESuggestedKey(uid, rid, key);\n\t\tif (value) {\n\t\t\tvoid notifyOnSubscriptionChanged(value);\n\t\t}\n\t}\n}\n\nMeteor.methods<ServerMethods>({\n\tasync 'e2e.updateGroupKey'(rid, uid, key) {\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'e2e.acceptSuggestedGroupKey' });\n\t\t}\n\n\t\tmethodDeprecationLogger.method('e2e.updateGroupKey', '8.0.0');\n\t\treturn updateGroupKey(rid, uid, key, userId);\n\t},\n});\n"],"names":["updateGroupKey","rid","uid","key","callerUserId","mySub","Subscriptions","findOneByRoomIdAndUserId","setGroupE2EKeyResponse","setGroupE2EKey","_id","modifiedCount","Rooms","removeUsersFromE2EEQueueByRoomId","notifyOnSubscriptionChangedById","notifyOnRoomChangedById","value","setGroupE2ESuggestedKey","notifyOnSubscriptionChanged","Meteor","methods","userId","Error","method","methodDeprecationLogger"],"mappings":";;;;+BAkBsBA;;;eAAAA;;;wBAjBe;wBACd;0CAEiB;gCAKjC;AASA,eAAeA,eAAeC,GAAW,EAAEC,GAAW,EAAEC,GAAW,EAAEC,YAAoB;IAC/F,qCAAqC;IACrC,MAAMC,QAAQ,MAAMC,qBAAa,CAACC,wBAAwB,CAACN,KAAKG;IAEhE,IAAIC,OAAO;QACV,iEAAiE;QACjE,IAAID,iBAAiBF,KAAK;YACzB,MAAMM,yBAAyB,MAAMF,qBAAa,CAACG,cAAc,CAACJ,MAAMK,GAAG,EAAEP;YAC7E,uFAAuF;YACvF,oEAAoE;YACpE,qEAAqE;YACrE,6EAA6E;YAC7E,kDAAkD;YAClD,MAAM,EAAEQ,aAAa,EAAE,GAAG,MAAMC,aAAK,CAACC,gCAAgC,CAACR,MAAMJ,GAAG,EAAE;gBAACG;aAAa;YAChG,IAAII,uBAAuBG,aAAa,EAAE;gBACzC,KAAKG,IAAAA,+CAA+B,EAACT,MAAMK,GAAG;YAC/C;YACA,IAAIC,eAAe;gBAClB,KAAKI,IAAAA,uCAAuB,EAACV,MAAMJ,GAAG;YACvC;YACA;QACD;QAEA,yCAAyC;QACzC,MAAM,EAAEe,KAAK,EAAE,GAAG,MAAMV,qBAAa,CAACW,uBAAuB,CAACf,KAAKD,KAAKE;QACxE,IAAIa,OAAO;YACV,KAAKE,IAAAA,2CAA2B,EAACF;QAClC;IACD;AACD;AAEAG,cAAM,CAACC,OAAO,CAAgB;IAC7B,MAAM,sBAAqBnB,GAAG,EAAEC,GAAG,EAAEC,GAAG;QACvC,MAAMkB,SAASF,cAAM,CAACE,MAAM;QAC5B,IAAI,CAACA,QAAQ;YACZ,MAAM,IAAIF,cAAM,CAACG,KAAK,CAAC,sBAAsB,gBAAgB;gBAAEC,QAAQ;YAA8B;QACtG;QAEAC,iDAAuB,CAACD,MAAM,CAAC,sBAAsB;QACrD,OAAOvB,eAAeC,KAAKC,KAAKC,KAAKkB;IACtC;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/e2e/server/methods/updateGroupKey.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ed82c407eda2f83ac3d85fd675f3aa71ab478bf8","contentHash":"ba9467ac402d6fe586f7192904b68244b77338901b168b182de67d0f71db807e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/emoji/client/helpers.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/emoji/client/helpers.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":39,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":31}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":31}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":34}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":33}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":37}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":32}},"10":{"start":{"line":31,"column":8},"end":{"line":31,"column":32}},"11":{"start":{"line":34,"column":8},"end":{"line":34,"column":36}},"12":{"start":{"line":37,"column":8},"end":{"line":37,"column":28}},"13":{"start":{"line":40,"column":23},"end":{"line":40,"column":61}},"14":{"start":{"line":41,"column":13},"end":{"line":41,"column":29}},"15":{"start":{"line":42,"column":24},"end":{"line":42,"column":32}},"16":{"start":{"line":43,"column":27},"end":{"line":54,"column":1}},"17":{"start":{"line":44,"column":23},"end":{"line":44,"column":42}},"18":{"start":{"line":45,"column":29},"end":{"line":52,"column":11}},"19":{"start":{"line":45,"column":57},"end":{"line":52,"column":9}},"20":{"start":{"line":53,"column":4},"end":{"line":53,"column":28}},"21":{"start":{"line":55,"column":24},"end":{"line":83,"column":1}},"22":{"start":{"line":56,"column":22},"end":{"line":56,"column":24}},"23":{"start":{"line":57,"column":26},"end":{"line":57,"column":60}},"24":{"start":{"line":58,"column":4},"end":{"line":81,"column":7}},"25":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"26":{"start":{"line":61,"column":12},"end":{"line":61,"column":19}},"27":{"start":{"line":63,"column":22},"end":{"line":63,"column":68}},"28":{"start":{"line":64,"column":8},"end":{"line":80,"column":9}},"29":{"start":{"line":64,"column":20},"end":{"line":64,"column":21}},"30":{"start":{"line":65,"column":28},"end":{"line":65,"column":70}},"31":{"start":{"line":66,"column":25},"end":{"line":66,"column":130}},"32":{"start":{"line":67,"column":34},"end":{"line":67,"column":55}},"33":{"start":{"line":68,"column":12},"end":{"line":71,"column":13}},"34":{"start":{"line":69,"column":16},"end":{"line":69,"column":79}},"35":{"start":{"line":70,"column":16},"end":{"line":70,"column":23}},"36":{"start":{"line":72,"column":26},"end":{"line":72,"column":66}},"37":{"start":{"line":73,"column":12},"end":{"line":75,"column":13}},"38":{"start":{"line":74,"column":16},"end":{"line":74,"column":25}},"39":{"start":{"line":76,"column":12},"end":{"line":79,"column":15}},"40":{"start":{"line":82,"column":4},"end":{"line":82,"column":21}},"41":{"start":{"line":84,"column":26},"end":{"line":99,"column":1}},"42":{"start":{"line":85,"column":25},"end":{"line":85,"column":27}},"43":{"start":{"line":86,"column":4},"end":{"line":94,"column":5}},"44":{"start":{"line":87,"column":8},"end":{"line":93,"column":9}},"45":{"start":{"line":88,"column":12},"end":{"line":92,"column":13}},"46":{"start":{"line":89,"column":16},"end":{"line":89,"column":102}},"47":{"start":{"line":91,"column":16},"end":{"line":91,"column":85}},"48":{"start":{"line":95,"column":27},"end":{"line":95,"column":97}},"49":{"start":{"line":95,"column":64},"end":{"line":95,"column":96}},"50":{"start":{"line":96,"column":27},"end":{"line":96,"column":70}},"51":{"start":{"line":97,"column":4},"end":{"line":97,"column":40}},"52":{"start":{"line":98,"column":4},"end":{"line":98,"column":26}},"53":{"start":{"line":100,"column":30},"end":{"line":141,"column":1}},"54":{"start":{"line":101,"column":19},"end":{"line":101,"column":21}},"55":{"start":{"line":102,"column":25},"end":{"line":102,"column":104}},"56":{"start":{"line":103,"column":4},"end":{"line":139,"column":5}},"57":{"start":{"line":104,"column":8},"end":{"line":106,"column":9}},"58":{"start":{"line":105,"column":12},"end":{"line":105,"column":21}},"59":{"start":{"line":107,"column":8},"end":{"line":138,"column":9}},"60":{"start":{"line":108,"column":32},"end":{"line":108,"column":56}},"61":{"start":{"line":109,"column":54},"end":{"line":109,"column":65}},"62":{"start":{"line":110,"column":23},"end":{"line":110,"column":25}},"63":{"start":{"line":111,"column":12},"end":{"line":111,"column":48}},"64":{"start":{"line":112,"column":26},"end":{"line":112,"column":103}},"65":{"start":{"line":113,"column":12},"end":{"line":115,"column":13}},"66":{"start":{"line":114,"column":16},"end":{"line":114,"column":44}},"67":{"start":{"line":116,"column":29},"end":{"line":116,"column":34}},"68":{"start":{"line":117,"column":12},"end":{"line":126,"column":13}},"69":{"start":{"line":118,"column":16},"end":{"line":125,"column":17}},"70":{"start":{"line":119,"column":37},"end":{"line":119,"column":92}},"71":{"start":{"line":120,"column":43},"end":{"line":120,"column":107}},"72":{"start":{"line":121,"column":20},"end":{"line":124,"column":21}},"73":{"start":{"line":122,"column":24},"end":{"line":122,"column":42}},"74":{"start":{"line":123,"column":24},"end":{"line":123,"column":30}},"75":{"start":{"line":127,"column":12},"end":{"line":137,"column":13}},"76":{"start":{"line":128,"column":38},"end":{"line":128,"column":59}},"77":{"start":{"line":129,"column":16},"end":{"line":132,"column":17}},"78":{"start":{"line":130,"column":20},"end":{"line":130,"column":83}},"79":{"start":{"line":131,"column":20},"end":{"line":131,"column":26}},"80":{"start":{"line":133,"column":16},"end":{"line":136,"column":19}},"81":{"start":{"line":140,"column":4},"end":{"line":140,"column":18}},"82":{"start":{"line":142,"column":25},"end":{"line":150,"column":1}},"83":{"start":{"line":143,"column":19},"end":{"line":143,"column":48}},"84":{"start":{"line":144,"column":16},"end":{"line":144,"column":44}},"85":{"start":{"line":145,"column":4},"end":{"line":147,"column":5}},"86":{"start":{"line":146,"column":8},"end":{"line":146,"column":15}},"87":{"start":{"line":148,"column":4},"end":{"line":148,"column":32}},"88":{"start":{"line":149,"column":4},"end":{"line":149,"column":100}},"89":{"start":{"line":151,"column":21},"end":{"line":156,"column":1}},"90":{"start":{"line":152,"column":26},"end":{"line":152,"column":74}},"91":{"start":{"line":153,"column":4},"end":{"line":155,"column":7}},"92":{"start":{"line":154,"column":8},"end":{"line":154,"column":70}},"93":{"start":{"line":157,"column":29},"end":{"line":163,"column":1}},"94":{"start":{"line":158,"column":26},"end":{"line":158,"column":74}},"95":{"start":{"line":159,"column":16},"end":{"line":159,"column":47}},"96":{"start":{"line":160,"column":4},"end":{"line":162,"column":5}},"97":{"start":{"line":161,"column":8},"end":{"line":161,"column":38}},"98":{"start":{"line":164,"column":23},"end":{"line":169,"column":1}},"99":{"start":{"line":166,"column":29},"end":{"line":166,"column":172}},"100":{"start":{"line":167,"column":25},"end":{"line":167,"column":62}},"101":{"start":{"line":168,"column":4},"end":{"line":168,"column":102}},"102":{"start":{"line":170,"column":25},"end":{"line":177,"column":1}},"103":{"start":{"line":171,"column":4},"end":{"line":176,"column":7}},"104":{"start":{"line":172,"column":8},"end":{"line":175,"column":10}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":21},"end":{"line":12,"column":22}},"loc":{"start":{"line":12,"column":32},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":21},"end":{"line":15,"column":22}},"loc":{"start":{"line":15,"column":32},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":24},"end":{"line":18,"column":25}},"loc":{"start":{"line":18,"column":35},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":23},"end":{"line":21,"column":24}},"loc":{"start":{"line":21,"column":34},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":27},"end":{"line":24,"column":28}},"loc":{"start":{"line":24,"column":38},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":22},"end":{"line":27,"column":23}},"loc":{"start":{"line":27,"column":33},"end":{"line":29,"column":5}},"line":27},"7":{"name":"(anonymous_7)","decl":{"start":{"line":30,"column":22},"end":{"line":30,"column":23}},"loc":{"start":{"line":30,"column":33},"end":{"line":32,"column":5}},"line":30},"8":{"name":"(anonymous_8)","decl":{"start":{"line":33,"column":26},"end":{"line":33,"column":27}},"loc":{"start":{"line":33,"column":37},"end":{"line":35,"column":5}},"line":33},"9":{"name":"(anonymous_9)","decl":{"start":{"line":36,"column":18},"end":{"line":36,"column":19}},"loc":{"start":{"line":36,"column":29},"end":{"line":38,"column":5}},"line":36},"10":{"name":"(anonymous_10)","decl":{"start":{"line":43,"column":27},"end":{"line":43,"column":28}},"loc":{"start":{"line":43,"column":90},"end":{"line":54,"column":1}},"line":43},"11":{"name":"(anonymous_11)","decl":{"start":{"line":45,"column":44},"end":{"line":45,"column":45}},"loc":{"start":{"line":45,"column":57},"end":{"line":52,"column":9}},"line":45},"12":{"name":"(anonymous_12)","decl":{"start":{"line":55,"column":24},"end":{"line":55,"column":25}},"loc":{"start":{"line":55,"column":79},"end":{"line":83,"column":1}},"line":55},"13":{"name":"(anonymous_13)","decl":{"start":{"line":58,"column":26},"end":{"line":58,"column":27}},"loc":{"start":{"line":58,"column":42},"end":{"line":81,"column":5}},"line":58},"14":{"name":"(anonymous_14)","decl":{"start":{"line":84,"column":26},"end":{"line":84,"column":27}},"loc":{"start":{"line":84,"column":30},"end":{"line":99,"column":1}},"line":84},"15":{"name":"(anonymous_15)","decl":{"start":{"line":95,"column":52},"end":{"line":95,"column":53}},"loc":{"start":{"line":95,"column":64},"end":{"line":95,"column":96}},"line":95},"16":{"name":"(anonymous_16)","decl":{"start":{"line":100,"column":30},"end":{"line":100,"column":31}},"loc":{"start":{"line":100,"column":87},"end":{"line":141,"column":1}},"line":100},"17":{"name":"(anonymous_17)","decl":{"start":{"line":142,"column":25},"end":{"line":142,"column":26}},"loc":{"start":{"line":142,"column":65},"end":{"line":150,"column":1}},"line":142},"18":{"name":"(anonymous_18)","decl":{"start":{"line":151,"column":21},"end":{"line":151,"column":22}},"loc":{"start":{"line":151,"column":35},"end":{"line":156,"column":1}},"line":151},"19":{"name":"(anonymous_19)","decl":{"start":{"line":153,"column":79},"end":{"line":153,"column":80}},"loc":{"start":{"line":153,"column":89},"end":{"line":155,"column":5}},"line":153},"20":{"name":"(anonymous_20)","decl":{"start":{"line":157,"column":29},"end":{"line":157,"column":30}},"loc":{"start":{"line":157,"column":55},"end":{"line":163,"column":1}},"line":157},"21":{"name":"(anonymous_21)","decl":{"start":{"line":164,"column":23},"end":{"line":164,"column":24}},"loc":{"start":{"line":164,"column":36},"end":{"line":169,"column":1}},"line":164},"22":{"name":"(anonymous_22)","decl":{"start":{"line":170,"column":25},"end":{"line":170,"column":26}},"loc":{"start":{"line":170,"column":42},"end":{"line":177,"column":1}},"line":170},"23":{"name":"(anonymous_23)","decl":{"start":{"line":171,"column":91},"end":{"line":171,"column":92}},"loc":{"start":{"line":171,"column":108},"end":{"line":176,"column":5}},"line":171}},"branchMap":{"0":{"loc":{"start":{"line":50,"column":23},"end":{"line":50,"column":81}},"type":"cond-expr","locations":[{"start":{"line":50,"column":58},"end":{"line":50,"column":74}},{"start":{"line":50,"column":77},"end":{"line":50,"column":81}}],"line":50},"1":{"loc":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"type":"if","locations":[{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},{"start":{"line":60,"column":8},"end":{"line":62,"column":9}}],"line":60},"2":{"loc":{"start":{"line":60,"column":14},"end":{"line":60,"column":184}},"type":"cond-expr","locations":[{"start":{"line":60,"column":135},"end":{"line":60,"column":141}},{"start":{"line":60,"column":144},"end":{"line":60,"column":184}}],"line":60},"3":{"loc":{"start":{"line":60,"column":14},"end":{"line":60,"column":132}},"type":"binary-expr","locations":[{"start":{"line":60,"column":14},"end":{"line":60,"column":87}},{"start":{"line":60,"column":91},"end":{"line":60,"column":132}}],"line":60},"4":{"loc":{"start":{"line":66,"column":25},"end":{"line":66,"column":130}},"type":"cond-expr","locations":[{"start":{"line":66,"column":105},"end":{"line":66,"column":125}},{"start":{"line":66,"column":128},"end":{"line":66,"column":130}}],"line":66},"5":{"loc":{"start":{"line":66,"column":25},"end":{"line":66,"column":102}},"type":"binary-expr","locations":[{"start":{"line":66,"column":25},"end":{"line":66,"column":35}},{"start":{"line":66,"column":39},"end":{"line":66,"column":53}},{"start":{"line":66,"column":57},"end":{"line":66,"column":102}}],"line":66},"6":{"loc":{"start":{"line":68,"column":12},"end":{"line":71,"column":13}},"type":"if","locations":[{"start":{"line":68,"column":12},"end":{"line":71,"column":13}},{"start":{"line":68,"column":12},"end":{"line":71,"column":13}}],"line":68},"7":{"loc":{"start":{"line":73,"column":12},"end":{"line":75,"column":13}},"type":"if","locations":[{"start":{"line":73,"column":12},"end":{"line":75,"column":13}},{"start":{"line":73,"column":12},"end":{"line":75,"column":13}}],"line":73},"8":{"loc":{"start":{"line":87,"column":8},"end":{"line":93,"column":9}},"type":"if","locations":[{"start":{"line":87,"column":8},"end":{"line":93,"column":9}},{"start":{"line":87,"column":8},"end":{"line":93,"column":9}}],"line":87},"9":{"loc":{"start":{"line":88,"column":12},"end":{"line":92,"column":13}},"type":"if","locations":[{"start":{"line":88,"column":12},"end":{"line":92,"column":13}},{"start":{"line":88,"column":12},"end":{"line":92,"column":13}}],"line":88},"10":{"loc":{"start":{"line":104,"column":8},"end":{"line":106,"column":9}},"type":"if","locations":[{"start":{"line":104,"column":8},"end":{"line":106,"column":9}},{"start":{"line":104,"column":8},"end":{"line":106,"column":9}}],"line":104},"11":{"loc":{"start":{"line":107,"column":8},"end":{"line":138,"column":9}},"type":"if","locations":[{"start":{"line":107,"column":8},"end":{"line":138,"column":9}},{"start":{"line":107,"column":8},"end":{"line":138,"column":9}}],"line":107},"12":{"loc":{"start":{"line":109,"column":34},"end":{"line":109,"column":49}},"type":"default-arg","locations":[{"start":{"line":109,"column":47},"end":{"line":109,"column":49}}],"line":109},"13":{"loc":{"start":{"line":112,"column":26},"end":{"line":112,"column":103}},"type":"cond-expr","locations":[{"start":{"line":112,"column":56},"end":{"line":112,"column":87}},{"start":{"line":112,"column":90},"end":{"line":112,"column":103}}],"line":112},"14":{"loc":{"start":{"line":113,"column":12},"end":{"line":115,"column":13}},"type":"if","locations":[{"start":{"line":113,"column":12},"end":{"line":115,"column":13}},{"start":{"line":113,"column":12},"end":{"line":115,"column":13}}],"line":113},"15":{"loc":{"start":{"line":113,"column":16},"end":{"line":113,"column":100}},"type":"binary-expr","locations":[{"start":{"line":113,"column":16},"end":{"line":113,"column":30}},{"start":{"line":113,"column":34},"end":{"line":113,"column":100}}],"line":113},"16":{"loc":{"start":{"line":118,"column":16},"end":{"line":125,"column":17}},"type":"if","locations":[{"start":{"line":118,"column":16},"end":{"line":125,"column":17}},{"start":{"line":118,"column":16},"end":{"line":125,"column":17}}],"line":118},"17":{"loc":{"start":{"line":120,"column":43},"end":{"line":120,"column":107}},"type":"cond-expr","locations":[{"start":{"line":120,"column":65},"end":{"line":120,"column":99}},{"start":{"line":120,"column":102},"end":{"line":120,"column":107}}],"line":120},"18":{"loc":{"start":{"line":121,"column":20},"end":{"line":124,"column":21}},"type":"if","locations":[{"start":{"line":121,"column":20},"end":{"line":124,"column":21}},{"start":{"line":121,"column":20},"end":{"line":124,"column":21}}],"line":121},"19":{"loc":{"start":{"line":121,"column":24},"end":{"line":121,"column":161}},"type":"binary-expr","locations":[{"start":{"line":121,"column":24},"end":{"line":121,"column":56}},{"start":{"line":121,"column":61},"end":{"line":121,"column":160}}],"line":121},"20":{"loc":{"start":{"line":121,"column":61},"end":{"line":121,"column":160}},"type":"cond-expr","locations":[{"start":{"line":121,"column":116},"end":{"line":121,"column":122}},{"start":{"line":121,"column":125},"end":{"line":121,"column":160}}],"line":121},"21":{"loc":{"start":{"line":121,"column":61},"end":{"line":121,"column":113}},"type":"binary-expr","locations":[{"start":{"line":121,"column":61},"end":{"line":121,"column":84}},{"start":{"line":121,"column":88},"end":{"line":121,"column":113}}],"line":121},"22":{"loc":{"start":{"line":127,"column":12},"end":{"line":137,"column":13}},"type":"if","locations":[{"start":{"line":127,"column":12},"end":{"line":137,"column":13}},{"start":{"line":127,"column":12},"end":{"line":137,"column":13}}],"line":127},"23":{"loc":{"start":{"line":129,"column":16},"end":{"line":132,"column":17}},"type":"if","locations":[{"start":{"line":129,"column":16},"end":{"line":132,"column":17}},{"start":{"line":129,"column":16},"end":{"line":132,"column":17}}],"line":129},"24":{"loc":{"start":{"line":145,"column":4},"end":{"line":147,"column":5}},"type":"if","locations":[{"start":{"line":145,"column":4},"end":{"line":147,"column":5}},{"start":{"line":145,"column":4},"end":{"line":147,"column":5}}],"line":145},"25":{"loc":{"start":{"line":149,"column":4},"end":{"line":149,"column":99}},"type":"cond-expr","locations":[{"start":{"line":149,"column":61},"end":{"line":149,"column":67}},{"start":{"line":149,"column":70},"end":{"line":149,"column":99}}],"line":149},"26":{"loc":{"start":{"line":149,"column":4},"end":{"line":149,"column":58}},"type":"binary-expr","locations":[{"start":{"line":149,"column":4},"end":{"line":149,"column":28}},{"start":{"line":149,"column":32},"end":{"line":149,"column":58}}],"line":149},"27":{"loc":{"start":{"line":153,"column":4},"end":{"line":155,"column":6}},"type":"cond-expr","locations":[{"start":{"line":153,"column":51},"end":{"line":153,"column":57}},{"start":{"line":153,"column":60},"end":{"line":155,"column":6}}],"line":153},"28":{"loc":{"start":{"line":153,"column":4},"end":{"line":153,"column":48}},"type":"binary-expr","locations":[{"start":{"line":153,"column":4},"end":{"line":153,"column":23}},{"start":{"line":153,"column":27},"end":{"line":153,"column":48}}],"line":153},"29":{"loc":{"start":{"line":154,"column":8},"end":{"line":154,"column":69}},"type":"binary-expr","locations":[{"start":{"line":154,"column":8},"end":{"line":154,"column":39}},{"start":{"line":154,"column":43},"end":{"line":154,"column":69}}],"line":154},"30":{"loc":{"start":{"line":160,"column":4},"end":{"line":162,"column":5}},"type":"if","locations":[{"start":{"line":160,"column":4},"end":{"line":162,"column":5}},{"start":{"line":160,"column":4},"end":{"line":162,"column":5}}],"line":160},"31":{"loc":{"start":{"line":166,"column":29},"end":{"line":166,"column":172}},"type":"cond-expr","locations":[{"start":{"line":166,"column":129},"end":{"line":166,"column":135}},{"start":{"line":166,"column":138},"end":{"line":166,"column":172}}],"line":166},"32":{"loc":{"start":{"line":166,"column":29},"end":{"line":166,"column":126}},"type":"binary-expr","locations":[{"start":{"line":166,"column":29},"end":{"line":166,"column":90}},{"start":{"line":166,"column":94},"end":{"line":166,"column":126}}],"line":166},"33":{"loc":{"start":{"line":168,"column":11},"end":{"line":168,"column":101}},"type":"cond-expr","locations":[{"start":{"line":168,"column":62},"end":{"line":168,"column":68}},{"start":{"line":168,"column":71},"end":{"line":168,"column":101}}],"line":168},"34":{"loc":{"start":{"line":168,"column":11},"end":{"line":168,"column":59}},"type":"binary-expr","locations":[{"start":{"line":168,"column":11},"end":{"line":168,"column":32}},{"start":{"line":168,"column":36},"end":{"line":168,"column":59}}],"line":168},"35":{"loc":{"start":{"line":171,"column":11},"end":{"line":176,"column":6}},"type":"cond-expr","locations":[{"start":{"line":171,"column":64},"end":{"line":171,"column":70}},{"start":{"line":171,"column":73},"end":{"line":176,"column":6}}],"line":171},"36":{"loc":{"start":{"line":171,"column":11},"end":{"line":171,"column":61}},"type":"binary-expr","locations":[{"start":{"line":171,"column":11},"end":{"line":171,"column":33}},{"start":{"line":171,"column":37},"end":{"line":171,"column":61}}],"line":171}},"s":{"0":1,"1":1,"2":9,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":2,"11":2,"12":1,"13":1,"14":1,"15":1,"16":1,"17":0,"18":0,"19":0,"20":0,"21":1,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":1,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":1,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":1,"83":2,"84":2,"85":2,"86":1,"87":1,"88":1,"89":1,"90":1,"91":1,"92":2,"93":1,"94":2,"95":2,"96":2,"97":1,"98":1,"99":0,"100":0,"101":0,"102":1,"103":0,"104":0},"f":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":2,"8":2,"9":1,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":2,"18":1,"19":2,"20":2,"21":0,"22":0,"23":0},"b":{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[1,1],"25":[1,0],"26":[1,1],"27":[0,1],"28":[1,1],"29":[2,2],"30":[1,1],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/emoji/client/helpers.ts"],"sourcesContent":["import { escapeRegExp } from '@rocket.chat/string-helpers';\n\nimport type { EmojiCategory, EmojiItem } from '.';\nimport { emoji } from './lib';\n\nexport const CUSTOM_CATEGORY = 'rocket';\n\nexport const createPickerEmojis = (\n\tcustomItemsLimit: number,\n\tactualTone: number,\n\trecentEmojis: string[],\n\tsetRecentEmojis: (emojis: string[]) => void,\n) => {\n\tconst categories = getCategoriesList();\n\n\tconst mappedCategories = categories.map((category) => ({\n\t\tkey: category.key,\n\t\ti18n: category.i18n,\n\t\temojis: {\n\t\t\tlist: createEmojiList(category.key, actualTone, recentEmojis, setRecentEmojis),\n\t\t\tlimit: category.key === CUSTOM_CATEGORY ? customItemsLimit : null,\n\t\t},\n\t}));\n\n\treturn mappedCategories;\n};\n\nexport const createEmojiList = (\n\tcategory: string,\n\tactualTone: number | null,\n\trecentEmojis: string[],\n\tsetRecentEmojis: (emojis: string[]) => void,\n) => {\n\tconst emojiList: EmojiItem[] = [];\n\tconst emojiPackages = Object.values(emoji.packages);\n\n\temojiPackages.forEach((emojiPackage) => {\n\t\tif (!emojiPackage.emojisByCategory?.[category]) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst total = emojiPackage.emojisByCategory[category].length;\n\n\t\tfor (let i = 0; i < total; i++) {\n\t\t\tconst current = emojiPackage.emojisByCategory[category][i];\n\n\t\t\tconst tone = actualTone && actualTone > 0 && emojiPackage.toneList.hasOwnProperty(current) ? `_tone${actualTone}` : '';\n\n\t\t\tconst emojiToRender = `:${current}${tone}:`;\n\n\t\t\tif (!emoji.list[emojiToRender]) {\n\t\t\t\tremoveFromRecent(emojiToRender, recentEmojis, setRecentEmojis);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst image = emojiPackage.renderPicker(emojiToRender);\n\t\t\tif (!image) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\temojiList.push({ emoji: current, image });\n\t\t}\n\t});\n\n\treturn emojiList;\n};\n\nexport const getCategoriesList = () => {\n\tlet categoriesList: EmojiCategory[] = [];\n\n\tfor (const emojiPackage of Object.values(emoji.packages)) {\n\t\tif (emojiPackage.emojiCategories) {\n\t\t\tif (typeof emojiPackage.categoryIndex !== 'undefined') {\n\t\t\t\tcategoriesList.splice(emojiPackage.categoryIndex, 0, ...emojiPackage.emojiCategories);\n\t\t\t} else {\n\t\t\t\tcategoriesList = categoriesList.concat(emojiPackage.emojiCategories);\n\t\t\t}\n\t\t}\n\t}\n\n\tconst rocketPosition = categoriesList.findIndex((category) => category.key === CUSTOM_CATEGORY);\n\tconst rocketCategory = categoriesList.splice(rocketPosition, 1)[0];\n\tcategoriesList.push(rocketCategory);\n\n\treturn categoriesList;\n};\n\nexport const getEmojisBySearchTerm = (\n\tsearchTerm: string,\n\tactualTone: number,\n\trecentEmojis: string[],\n\tsetRecentEmojis: (emojis: string[]) => void,\n) => {\n\tconst emojis = [];\n\tconst searchRegExp = new RegExp(escapeRegExp(searchTerm.replace(/:/g, '')), 'i');\n\n\tfor (let current in emoji.list) {\n\t\tif (!emoji.list.hasOwnProperty(current)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (searchRegExp.test(current)) {\n\t\t\tconst emojiObject = emoji.list[current];\n\t\t\tconst { emojiPackage, shortnames = [] } = emojiObject;\n\t\t\tlet tone = '';\n\t\t\tcurrent = current.replace(/:/g, '');\n\t\t\tconst alias = shortnames[0] !== undefined ? shortnames[0].replace(/:/g, '') : shortnames[0];\n\n\t\t\tif (actualTone > 0 && emoji.packages[emojiPackage].toneList.hasOwnProperty(current)) {\n\t\t\t\ttone = `_tone${actualTone}`;\n\t\t\t}\n\n\t\t\tlet emojiFound = false;\n\n\t\t\tfor (const key in emoji.packages[emojiPackage].emojisByCategory) {\n\t\t\t\tif (emoji.packages[emojiPackage].emojisByCategory.hasOwnProperty(key)) {\n\t\t\t\t\tconst contents = emoji.packages[emojiPackage].emojisByCategory[key];\n\t\t\t\t\tconst searchValArray = alias !== undefined ? alias.replace(/:/g, '').split('_') : alias;\n\t\t\t\t\tif (contents.indexOf(current) !== -1 || searchValArray?.includes(searchTerm)) {\n\t\t\t\t\t\temojiFound = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (emojiFound) {\n\t\t\t\tconst emojiToRender = `:${current}${tone}:`;\n\n\t\t\t\tif (!emoji.list[emojiToRender]) {\n\t\t\t\t\tremoveFromRecent(emojiToRender, recentEmojis, setRecentEmojis);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\temojis.push({ emoji: current, image: emoji.packages[emojiPackage].renderPicker(emojiToRender) });\n\t\t\t}\n\t\t}\n\t}\n\n\treturn emojis;\n};\n\nexport const removeFromRecent = (emoji: string, recentEmojis: string[], setRecentEmojis?: (emojis: string[]) => void) => {\n\tconst _emoji = emoji.replace(/(^:|:$)/g, '');\n\tconst pos = recentEmojis.indexOf(_emoji as never);\n\n\tif (pos === -1) {\n\t\treturn;\n\t}\n\trecentEmojis.splice(pos, 1);\n\tsetRecentEmojis?.(recentEmojis);\n};\n\nexport const updateRecent = (recentList: string[]) => {\n\tconst recentPkgList: string[] = emoji.packages.base.emojisByCategory.recent;\n\trecentList?.forEach((_emoji) => {\n\t\t!recentPkgList.includes(_emoji) && recentPkgList.push(_emoji);\n\t});\n};\n\nexport const replaceEmojiInRecent = ({ oldEmoji, newEmoji }: { oldEmoji: string; newEmoji: string }) => {\n\tconst recentPkgList: string[] = emoji.packages.base.emojisByCategory.recent;\n\tconst pos = recentPkgList.indexOf(oldEmoji);\n\n\tif (pos !== -1) {\n\t\trecentPkgList[pos] = newEmoji;\n\t}\n};\n\nconst getEmojiRender = (emojiName: string) => {\n\tconst emojiPackageName = emoji.list[emojiName]?.emojiPackage;\n\tconst emojiPackage = emoji.packages[emojiPackageName];\n\treturn emojiPackage?.render(emojiName);\n};\n\nexport const getFrequentEmoji = (frequentEmoji: string[]) => {\n\treturn frequentEmoji?.map((frequentEmoji) => {\n\t\treturn { emoji: frequentEmoji, image: getEmojiRender(`:${frequentEmoji}:`) };\n\t});\n};\n"],"names":["CUSTOM_CATEGORY","createEmojiList","createPickerEmojis","getCategoriesList","getEmojisBySearchTerm","getFrequentEmoji","removeFromRecent","replaceEmojiInRecent","updateRecent","customItemsLimit","actualTone","recentEmojis","setRecentEmojis","categories","mappedCategories","map","category","key","i18n","emojis","list","limit","emojiList","emojiPackages","Object","values","emoji","packages","forEach","emojiPackage","emojisByCategory","total","length","i","current","tone","toneList","hasOwnProperty","emojiToRender","image","renderPicker","push","categoriesList","emojiCategories","categoryIndex","splice","concat","rocketPosition","findIndex","rocketCategory","searchTerm","searchRegExp","RegExp","escapeRegExp","replace","test","emojiObject","shortnames","alias","undefined","emojiFound","contents","searchValArray","split","indexOf","includes","_emoji","pos","recentList","recentPkgList","base","recent","oldEmoji","newEmoji","getEmojiRender","emojiName","emojiPackageName","render","frequentEmoji"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/emoji/client/helpers.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4a77606cd07d9b9b29a96b387770ece302f139cf","contentHash":"7847ac253345dd06ebbde9efce65f06f03849d119d82574fe73f4fe915e572b7"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/emoji/client/lib.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/emoji/client/lib.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":21}},"3":{"start":{"line":11,"column":32},"end":{"line":11,"column":77}},"4":{"start":{"line":13,"column":4},"end":{"line":15,"column":6}},"5":{"start":{"line":17,"column":14},"end":{"line":43,"column":1}},"6":{"start":{"line":34,"column":39},"end":{"line":34,"column":77}},"7":{"start":{"line":35,"column":16},"end":{"line":37,"column":17}},"8":{"start":{"line":36,"column":20},"end":{"line":36,"column":27}},"9":{"start":{"line":38,"column":16},"end":{"line":38,"column":213}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":12,"column":9},"end":{"line":12,"column":33}},"loc":{"start":{"line":12,"column":39},"end":{"line":16,"column":1}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":32,"column":12},"end":{"line":32,"column":13}},"loc":{"start":{"line":32,"column":41},"end":{"line":39,"column":13}},"line":32}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":11},"end":{"line":15,"column":5}},"type":"cond-expr","locations":[{"start":{"line":13,"column":35},"end":{"line":13,"column":38}},{"start":{"line":13,"column":41},"end":{"line":15,"column":5}}],"line":13},"1":{"loc":{"start":{"line":13,"column":11},"end":{"line":13,"column":32}},"type":"binary-expr","locations":[{"start":{"line":13,"column":11},"end":{"line":13,"column":14}},{"start":{"line":13,"column":18},"end":{"line":13,"column":32}}],"line":13},"2":{"loc":{"start":{"line":35,"column":16},"end":{"line":37,"column":17}},"type":"if","locations":[{"start":{"line":35,"column":16},"end":{"line":37,"column":17}},{"start":{"line":35,"column":16},"end":{"line":37,"column":17}}],"line":35},"3":{"loc":{"start":{"line":38,"column":23},"end":{"line":38,"column":212}},"type":"cond-expr","locations":[{"start":{"line":38,"column":145},"end":{"line":38,"column":151}},{"start":{"line":38,"column":154},"end":{"line":38,"column":212}}],"line":38},"4":{"loc":{"start":{"line":38,"column":23},"end":{"line":38,"column":142}},"type":"binary-expr","locations":[{"start":{"line":38,"column":23},"end":{"line":38,"column":97}},{"start":{"line":38,"column":101},"end":{"line":38,"column":142}}],"line":38}},"s":{"0":1,"1":1,"2":23,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0},"f":{"0":23,"1":1,"2":0},"b":{"0":[0,1],"1":[1,1],"2":[0,0],"3":[0,0],"4":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/emoji/client/lib.ts"],"sourcesContent":["import emojione from 'emojione';\n\nimport type { EmojiPackages } from '../lib/rocketchat';\n\nexport const emoji: EmojiPackages = {\n\tpackages: {\n\t\tbase: {\n\t\t\temojiCategories: [{ key: 'recent', i18n: 'Frequently_Used' }],\n\t\t\tcategoryIndex: 0,\n\t\t\temojisByCategory: {\n\t\t\t\trecent: [],\n\t\t\t},\n\t\t\ttoneList: {},\n\t\t\trender: emojione.toImage,\n\t\t\trenderPicker(emojiToRender) {\n\t\t\t\tconst correctPackage = emoji.list[emojiToRender].emojiPackage;\n\t\t\t\tif (!correctPackage) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treturn emoji.packages[correctPackage]?.renderPicker(emojiToRender);\n\t\t\t},\n\t\t},\n\t},\n\tlist: {},\n};\n"],"names":["emoji","packages","base","emojiCategories","key","i18n","categoryIndex","emojisByCategory","recent","toneList","render","emojione","toImage","renderPicker","emojiToRender","correctPackage","list","emojiPackage"],"mappings":";;;;+BAIaA;;;eAAAA;;;iEAJQ;;;;;;AAId,MAAMA,QAAuB;IACnCC,UAAU;QACTC,MAAM;YACLC,iBAAiB;gBAAC;oBAAEC,KAAK;oBAAUC,MAAM;gBAAkB;aAAE;YAC7DC,eAAe;YACfC,kBAAkB;gBACjBC,QAAQ,EAAE;YACX;YACAC,UAAU,CAAC;YACXC,QAAQC,iBAAQ,CAACC,OAAO;YACxBC,cAAaC,aAAa;oBAMlBd;gBALP,MAAMe,iBAAiBf,MAAMgB,IAAI,CAACF,cAAc,CAACG,YAAY;gBAC7D,IAAI,CAACF,gBAAgB;oBACpB;gBACD;gBAEA,QAAOf,iCAAAA,MAAMC,QAAQ,CAACc,eAAe,cAA9Bf,qDAAAA,+BAAgCa,YAAY,CAACC;YACrD;QACD;IACD;IACAE,MAAM,CAAC;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/emoji/client/lib.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"dd345c07de4af69fd6cfcc4f58d1451724c0a537","contentHash":"e9a7ac13ba841013f29c0d6cf101d70053dd24d02abc4aa08fe6edbe9535b632"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/MessageConverter.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/MessageConverter.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":32}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":29},"end":{"line":12,"column":71}},"5":{"start":{"line":13,"column":23},"end":{"line":13,"column":80}},"6":{"start":{"line":14,"column":25},"end":{"line":14,"column":53}},"7":{"start":{"line":16,"column":4},"end":{"line":18,"column":6}},"8":{"start":{"line":20,"column":23},"end":{"line":229,"column":1}},"9":{"start":{"line":22,"column":8},"end":{"line":22,"column":23}},"10":{"start":{"line":23,"column":8},"end":{"line":23,"column":43}},"11":{"start":{"line":24,"column":8},"end":{"line":24,"column":39}},"12":{"start":{"line":25,"column":8},"end":{"line":27,"column":9}},"13":{"start":{"line":26,"column":12},"end":{"line":26,"column":54}},"14":{"start":{"line":30,"column":8},"end":{"line":37,"column":9}},"15":{"start":{"line":31,"column":12},"end":{"line":36,"column":13}},"16":{"start":{"line":32,"column":16},"end":{"line":32,"column":68}},"17":{"start":{"line":34,"column":16},"end":{"line":34,"column":82}},"18":{"start":{"line":35,"column":16},"end":{"line":35,"column":38}},"19":{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},"20":{"start":{"line":41,"column":12},"end":{"line":41,"column":66}},"21":{"start":{"line":43,"column":24},"end":{"line":43,"column":70}},"22":{"start":{"line":44,"column":8},"end":{"line":47,"column":9}},"23":{"start":{"line":45,"column":12},"end":{"line":45,"column":72}},"24":{"start":{"line":46,"column":12},"end":{"line":46,"column":61}},"25":{"start":{"line":48,"column":20},"end":{"line":48,"column":66}},"26":{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},"27":{"start":{"line":50,"column":12},"end":{"line":50,"column":61}},"28":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"29":{"start":{"line":53,"column":12},"end":{"line":53,"column":32}},"30":{"start":{"line":55,"column":23},"end":{"line":55,"column":72}},"31":{"start":{"line":56,"column":8},"end":{"line":61,"column":9}},"32":{"start":{"line":57,"column":12},"end":{"line":57,"column":80}},"33":{"start":{"line":59,"column":12},"end":{"line":59,"column":109}},"34":{"start":{"line":60,"column":12},"end":{"line":60,"column":34}},"35":{"start":{"line":64,"column":8},"end":{"line":64,"column":46}},"36":{"start":{"line":65,"column":8},"end":{"line":65,"column":20}},"37":{"start":{"line":69,"column":25},"end":{"line":69,"column":81}},"38":{"start":{"line":70,"column":25},"end":{"line":70,"column":81}},"39":{"start":{"line":71,"column":8},"end":{"line":101,"column":10}},"40":{"start":{"line":104,"column":29},"end":{"line":104,"column":36}},"41":{"start":{"line":105,"column":8},"end":{"line":107,"column":9}},"42":{"start":{"line":106,"column":12},"end":{"line":106,"column":19}},"43":{"start":{"line":108,"column":23},"end":{"line":108,"column":25}},"44":{"start":{"line":109,"column":8},"end":{"line":120,"column":9}},"45":{"start":{"line":110,"column":34},"end":{"line":110,"column":84}},"46":{"start":{"line":111,"column":12},"end":{"line":114,"column":13}},"47":{"start":{"line":112,"column":16},"end":{"line":112,"column":75}},"48":{"start":{"line":113,"column":16},"end":{"line":113,"column":25}},"49":{"start":{"line":115,"column":12},"end":{"line":115,"column":93}},"50":{"start":{"line":116,"column":12},"end":{"line":119,"column":15}},"51":{"start":{"line":121,"column":8},"end":{"line":121,"column":22}},"52":{"start":{"line":124,"column":29},"end":{"line":124,"column":36}},"53":{"start":{"line":125,"column":8},"end":{"line":127,"column":9}},"54":{"start":{"line":126,"column":12},"end":{"line":126,"column":29}},"55":{"start":{"line":128,"column":23},"end":{"line":128,"column":25}},"56":{"start":{"line":129,"column":8},"end":{"line":154,"column":9}},"57":{"start":{"line":130,"column":12},"end":{"line":136,"column":13}},"58":{"start":{"line":131,"column":16},"end":{"line":134,"column":19}},"59":{"start":{"line":135,"column":16},"end":{"line":135,"column":25}},"60":{"start":{"line":138,"column":25},"end":{"line":138,"column":80}},"61":{"start":{"line":139,"column":25},"end":{"line":139,"column":69}},"62":{"start":{"line":140,"column":12},"end":{"line":143,"column":13}},"63":{"start":{"line":141,"column":16},"end":{"line":141,"column":75}},"64":{"start":{"line":142,"column":16},"end":{"line":142,"column":25}},"65":{"start":{"line":144,"column":12},"end":{"line":147,"column":13}},"66":{"start":{"line":145,"column":16},"end":{"line":145,"column":45}},"67":{"start":{"line":146,"column":16},"end":{"line":146,"column":81}},"68":{"start":{"line":148,"column":12},"end":{"line":148,"column":102}},"69":{"start":{"line":149,"column":12},"end":{"line":153,"column":15}},"70":{"start":{"line":155,"column":8},"end":{"line":155,"column":22}},"71":{"start":{"line":158,"column":26},"end":{"line":158,"column":28}},"72":{"start":{"line":159,"column":8},"end":{"line":180,"column":9}},"73":{"start":{"line":160,"column":12},"end":{"line":162,"column":13}},"74":{"start":{"line":161,"column":16},"end":{"line":161,"column":25}},"75":{"start":{"line":163,"column":30},"end":{"line":163,"column":53}},"76":{"start":{"line":164,"column":12},"end":{"line":166,"column":13}},"77":{"start":{"line":165,"column":16},"end":{"line":165,"column":25}},"78":{"start":{"line":167,"column":29},"end":{"line":170,"column":13}},"79":{"start":{"line":171,"column":12},"end":{"line":176,"column":13}},"80":{"start":{"line":172,"column":33},"end":{"line":172,"column":81}},"81":{"start":{"line":173,"column":16},"end":{"line":175,"column":17}},"82":{"start":{"line":174,"column":20},"end":{"line":174,"column":54}},"83":{"start":{"line":177,"column":12},"end":{"line":179,"column":13}},"84":{"start":{"line":178,"column":16},"end":{"line":178,"column":43}},"85":{"start":{"line":181,"column":8},"end":{"line":183,"column":9}},"86":{"start":{"line":182,"column":12},"end":{"line":182,"column":29}},"87":{"start":{"line":186,"column":23},"end":{"line":186,"column":25}},"88":{"start":{"line":187,"column":8},"end":{"line":192,"column":9}},"89":{"start":{"line":188,"column":27},"end":{"line":188,"column":73}},"90":{"start":{"line":189,"column":12},"end":{"line":191,"column":13}},"91":{"start":{"line":190,"column":16},"end":{"line":190,"column":36}},"92":{"start":{"line":193,"column":8},"end":{"line":193,"column":22}},"93":{"start":{"line":197,"column":21},"end":{"line":197,"column":69}},"94":{"start":{"line":198,"column":20},"end":{"line":198,"column":66}},"95":{"start":{"line":199,"column":8},"end":{"line":204,"column":9}},"96":{"start":{"line":200,"column":12},"end":{"line":203,"column":14}},"97":{"start":{"line":206,"column":25},"end":{"line":208,"column":10}},"98":{"start":{"line":209,"column":21},"end":{"line":213,"column":10}},"99":{"start":{"line":214,"column":8},"end":{"line":221,"column":9}},"100":{"start":{"line":215,"column":12},"end":{"line":215,"column":52}},"101":{"start":{"line":216,"column":12},"end":{"line":216,"column":57}},"102":{"start":{"line":217,"column":12},"end":{"line":220,"column":14}},"103":{"start":{"line":224,"column":8},"end":{"line":224,"column":25}},"104":{"start":{"line":227,"column":8},"end":{"line":227,"column":39}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":15,"column":9},"end":{"line":15,"column":33}},"loc":{"start":{"line":15,"column":39},"end":{"line":19,"column":1}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":21,"column":4},"end":{"line":21,"column":5}},"loc":{"start":{"line":21,"column":71},"end":{"line":28,"column":5}},"line":21},"3":{"name":"(anonymous_3)","decl":{"start":{"line":29,"column":4},"end":{"line":29,"column":5}},"loc":{"start":{"line":29,"column":30},"end":{"line":38,"column":5}},"line":29},"4":{"name":"(anonymous_4)","decl":{"start":{"line":39,"column":4},"end":{"line":39,"column":5}},"loc":{"start":{"line":39,"column":30},"end":{"line":62,"column":5}},"line":39},"5":{"name":"(anonymous_5)","decl":{"start":{"line":63,"column":4},"end":{"line":63,"column":5}},"loc":{"start":{"line":63,"column":32},"end":{"line":66,"column":5}},"line":63},"6":{"name":"(anonymous_6)","decl":{"start":{"line":67,"column":4},"end":{"line":67,"column":5}},"loc":{"start":{"line":67,"column":49},"end":{"line":102,"column":5}},"line":67},"7":{"name":"(anonymous_7)","decl":{"start":{"line":103,"column":4},"end":{"line":103,"column":5}},"loc":{"start":{"line":103,"column":42},"end":{"line":122,"column":5}},"line":103},"8":{"name":"(anonymous_8)","decl":{"start":{"line":123,"column":4},"end":{"line":123,"column":5}},"loc":{"start":{"line":123,"column":42},"end":{"line":156,"column":5}},"line":123},"9":{"name":"(anonymous_9)","decl":{"start":{"line":157,"column":4},"end":{"line":157,"column":5}},"loc":{"start":{"line":157,"column":53},"end":{"line":184,"column":5}},"line":157},"10":{"name":"(anonymous_10)","decl":{"start":{"line":185,"column":4},"end":{"line":185,"column":5}},"loc":{"start":{"line":185,"column":41},"end":{"line":194,"column":5}},"line":185},"11":{"name":"(anonymous_11)","decl":{"start":{"line":195,"column":4},"end":{"line":195,"column":5}},"loc":{"start":{"line":195,"column":44},"end":{"line":222,"column":5}},"line":195},"12":{"name":"(anonymous_12)","decl":{"start":{"line":223,"column":4},"end":{"line":223,"column":5}},"loc":{"start":{"line":223,"column":18},"end":{"line":225,"column":5}},"line":223},"13":{"name":"(anonymous_13)","decl":{"start":{"line":226,"column":4},"end":{"line":226,"column":5}},"loc":{"start":{"line":226,"column":24},"end":{"line":228,"column":5}},"line":226}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":11},"end":{"line":18,"column":5}},"type":"cond-expr","locations":[{"start":{"line":16,"column":35},"end":{"line":16,"column":38}},{"start":{"line":16,"column":41},"end":{"line":18,"column":5}}],"line":16},"1":{"loc":{"start":{"line":16,"column":11},"end":{"line":16,"column":32}},"type":"binary-expr","locations":[{"start":{"line":16,"column":11},"end":{"line":16,"column":14}},{"start":{"line":16,"column":18},"end":{"line":16,"column":32}}],"line":16},"2":{"loc":{"start":{"line":21,"column":22},"end":{"line":21,"column":69}},"type":"default-arg","locations":[{"start":{"line":21,"column":67},"end":{"line":21,"column":69}}],"line":21},"3":{"loc":{"start":{"line":25,"column":8},"end":{"line":27,"column":9}},"type":"if","locations":[{"start":{"line":25,"column":8},"end":{"line":27,"column":9}},{"start":{"line":25,"column":8},"end":{"line":27,"column":9}}],"line":25},"4":{"loc":{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},"type":"if","locations":[{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},{"start":{"line":40,"column":8},"end":{"line":42,"column":9}}],"line":40},"5":{"loc":{"start":{"line":40,"column":12},"end":{"line":40,"column":38}},"type":"binary-expr","locations":[{"start":{"line":40,"column":12},"end":{"line":40,"column":20}},{"start":{"line":40,"column":24},"end":{"line":40,"column":38}}],"line":40},"6":{"loc":{"start":{"line":44,"column":8},"end":{"line":47,"column":9}},"type":"if","locations":[{"start":{"line":44,"column":8},"end":{"line":47,"column":9}},{"start":{"line":44,"column":8},"end":{"line":47,"column":9}}],"line":44},"7":{"loc":{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},"type":"if","locations":[{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},{"start":{"line":49,"column":8},"end":{"line":51,"column":9}}],"line":49},"8":{"loc":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"type":"if","locations":[{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},{"start":{"line":52,"column":8},"end":{"line":54,"column":9}}],"line":52},"9":{"loc":{"start":{"line":69,"column":25},"end":{"line":69,"column":81}},"type":"binary-expr","locations":[{"start":{"line":69,"column":25},"end":{"line":69,"column":38}},{"start":{"line":69,"column":42},"end":{"line":69,"column":81}}],"line":69},"10":{"loc":{"start":{"line":70,"column":25},"end":{"line":70,"column":81}},"type":"binary-expr","locations":[{"start":{"line":70,"column":25},"end":{"line":70,"column":38}},{"start":{"line":70,"column":42},"end":{"line":70,"column":81}}],"line":70},"11":{"loc":{"start":{"line":79,"column":15},"end":{"line":79,"column":34}},"type":"binary-expr","locations":[{"start":{"line":79,"column":15},"end":{"line":79,"column":21}},{"start":{"line":79,"column":25},"end":{"line":79,"column":34}}],"line":79},"12":{"loc":{"start":{"line":84,"column":21},"end":{"line":84,"column":83}},"type":"binary-expr","locations":[{"start":{"line":84,"column":21},"end":{"line":84,"column":33}},{"start":{"line":84,"column":37},"end":{"line":84,"column":83}}],"line":84},"13":{"loc":{"start":{"line":86,"column":22},"end":{"line":86,"column":103}},"type":"binary-expr","locations":[{"start":{"line":86,"column":22},"end":{"line":86,"column":35}},{"start":{"line":86,"column":40},"end":{"line":86,"column":89}},{"start":{"line":86,"column":93},"end":{"line":86,"column":102}}],"line":86},"14":{"loc":{"start":{"line":95,"column":15},"end":{"line":97,"column":18}},"type":"cond-expr","locations":[{"start":{"line":95,"column":26},"end":{"line":97,"column":13}},{"start":{"line":97,"column":16},"end":{"line":97,"column":18}}],"line":95},"15":{"loc":{"start":{"line":98,"column":15},"end":{"line":100,"column":18}},"type":"cond-expr","locations":[{"start":{"line":98,"column":32},"end":{"line":100,"column":13}},{"start":{"line":100,"column":16},"end":{"line":100,"column":18}}],"line":98},"16":{"loc":{"start":{"line":105,"column":8},"end":{"line":107,"column":9}},"type":"if","locations":[{"start":{"line":105,"column":8},"end":{"line":107,"column":9}},{"start":{"line":105,"column":8},"end":{"line":107,"column":9}}],"line":105},"17":{"loc":{"start":{"line":110,"column":34},"end":{"line":110,"column":84}},"type":"binary-expr","locations":[{"start":{"line":110,"column":34},"end":{"line":110,"column":78}},{"start":{"line":110,"column":82},"end":{"line":110,"column":84}}],"line":110},"18":{"loc":{"start":{"line":111,"column":12},"end":{"line":114,"column":13}},"type":"if","locations":[{"start":{"line":111,"column":12},"end":{"line":114,"column":13}},{"start":{"line":111,"column":12},"end":{"line":114,"column":13}}],"line":111},"19":{"loc":{"start":{"line":111,"column":16},"end":{"line":111,"column":29}},"type":"binary-expr","locations":[{"start":{"line":111,"column":16},"end":{"line":111,"column":20}},{"start":{"line":111,"column":24},"end":{"line":111,"column":29}}],"line":111},"20":{"loc":{"start":{"line":125,"column":8},"end":{"line":127,"column":9}},"type":"if","locations":[{"start":{"line":125,"column":8},"end":{"line":127,"column":9}},{"start":{"line":125,"column":8},"end":{"line":127,"column":9}}],"line":125},"21":{"loc":{"start":{"line":130,"column":12},"end":{"line":136,"column":13}},"type":"if","locations":[{"start":{"line":130,"column":12},"end":{"line":136,"column":13}},{"start":{"line":130,"column":12},"end":{"line":136,"column":13}}],"line":130},"22":{"loc":{"start":{"line":130,"column":16},"end":{"line":130,"column":57}},"type":"binary-expr","locations":[{"start":{"line":130,"column":16},"end":{"line":130,"column":34}},{"start":{"line":130,"column":38},"end":{"line":130,"column":57}}],"line":130},"23":{"loc":{"start":{"line":140,"column":12},"end":{"line":143,"column":13}},"type":"if","locations":[{"start":{"line":140,"column":12},"end":{"line":143,"column":13}},{"start":{"line":140,"column":12},"end":{"line":143,"column":13}}],"line":140},"24":{"loc":{"start":{"line":144,"column":12},"end":{"line":147,"column":13}},"type":"if","locations":[{"start":{"line":144,"column":12},"end":{"line":147,"column":13}},{"start":{"line":144,"column":12},"end":{"line":147,"column":13}}],"line":144},"25":{"loc":{"start":{"line":160,"column":12},"end":{"line":162,"column":13}},"type":"if","locations":[{"start":{"line":160,"column":12},"end":{"line":162,"column":13}},{"start":{"line":160,"column":12},"end":{"line":162,"column":13}}],"line":160},"26":{"loc":{"start":{"line":164,"column":12},"end":{"line":166,"column":13}},"type":"if","locations":[{"start":{"line":164,"column":12},"end":{"line":166,"column":13}},{"start":{"line":164,"column":12},"end":{"line":166,"column":13}}],"line":164},"27":{"loc":{"start":{"line":173,"column":16},"end":{"line":175,"column":17}},"type":"if","locations":[{"start":{"line":173,"column":16},"end":{"line":175,"column":17}},{"start":{"line":173,"column":16},"end":{"line":175,"column":17}}],"line":173},"28":{"loc":{"start":{"line":173,"column":20},"end":{"line":173,"column":70}},"type":"binary-expr","locations":[{"start":{"line":173,"column":20},"end":{"line":173,"column":28}},{"start":{"line":173,"column":32},"end":{"line":173,"column":70}}],"line":173},"29":{"loc":{"start":{"line":177,"column":12},"end":{"line":179,"column":13}},"type":"if","locations":[{"start":{"line":177,"column":12},"end":{"line":179,"column":13}},{"start":{"line":177,"column":12},"end":{"line":179,"column":13}}],"line":177},"30":{"loc":{"start":{"line":181,"column":8},"end":{"line":183,"column":9}},"type":"if","locations":[{"start":{"line":181,"column":8},"end":{"line":183,"column":9}},{"start":{"line":181,"column":8},"end":{"line":183,"column":9}}],"line":181},"31":{"loc":{"start":{"line":189,"column":12},"end":{"line":191,"column":13}},"type":"if","locations":[{"start":{"line":189,"column":12},"end":{"line":191,"column":13}},{"start":{"line":189,"column":12},"end":{"line":191,"column":13}}],"line":189},"32":{"loc":{"start":{"line":189,"column":16},"end":{"line":189,"column":50}},"type":"binary-expr","locations":[{"start":{"line":189,"column":16},"end":{"line":189,"column":22}},{"start":{"line":189,"column":26},"end":{"line":189,"column":50}}],"line":189},"33":{"loc":{"start":{"line":199,"column":8},"end":{"line":204,"column":9}},"type":"if","locations":[{"start":{"line":199,"column":8},"end":{"line":204,"column":9}},{"start":{"line":199,"column":8},"end":{"line":204,"column":9}}],"line":199},"34":{"loc":{"start":{"line":199,"column":12},"end":{"line":199,"column":23}},"type":"binary-expr","locations":[{"start":{"line":199,"column":12},"end":{"line":199,"column":16}},{"start":{"line":199,"column":20},"end":{"line":199,"column":23}}],"line":199},"35":{"loc":{"start":{"line":214,"column":8},"end":{"line":221,"column":9}},"type":"if","locations":[{"start":{"line":214,"column":8},"end":{"line":221,"column":9}},{"start":{"line":214,"column":8},"end":{"line":221,"column":9}}],"line":214},"36":{"loc":{"start":{"line":214,"column":12},"end":{"line":214,"column":65}},"type":"cond-expr","locations":[{"start":{"line":214,"column":47},"end":{"line":214,"column":53}},{"start":{"line":214,"column":56},"end":{"line":214,"column":65}}],"line":214},"37":{"loc":{"start":{"line":214,"column":12},"end":{"line":214,"column":44}},"type":"binary-expr","locations":[{"start":{"line":214,"column":12},"end":{"line":214,"column":25}},{"start":{"line":214,"column":29},"end":{"line":214,"column":44}}],"line":214}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":6,"10":6,"11":6,"12":6,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":2,"20":1,"21":1,"22":1,"23":0,"24":0,"25":1,"26":1,"27":0,"28":1,"29":1,"30":1,"31":1,"32":1,"33":0,"34":0,"35":4,"36":3,"37":2,"38":2,"39":2,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":6,"104":8},"f":{"0":1,"1":1,"2":6,"3":0,"4":2,"5":4,"6":2,"7":0,"8":0,"9":0,"10":0,"11":0,"12":6,"13":8},"b":{"0":[0,1],"1":[1,1],"2":[1],"3":[0,6],"4":[1,1],"5":[2,1],"6":[0,1],"7":[0,1],"8":[1,0],"9":[2,0],"10":[2,0],"11":[2,2],"12":[2,0],"13":[2,0,0],"14":[0,2],"15":[0,2],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/MessageConverter.ts"],"sourcesContent":["import type { IImportMessageRecord, IMessage as IDBMessage, IImportMessage, IImportMessageReaction } from '@rocket.chat/core-typings';\nimport { Rooms } from '@rocket.chat/models';\nimport limax from 'limax';\n\nimport { insertMessage } from '../../../../lib/server/functions/insertMessage';\nimport type { IConversionCallbacks } from '../../definitions/IConversionCallbacks';\nimport type { UserIdentification, MentionedChannel } from './ConverterCache';\nimport { RecordConverter } from './RecordConverter';\n\nexport type MessageConversionCallbacks = IConversionCallbacks & { afterImportAllMessagesFn?: (roomIds: string[]) => Promise<void> };\n\ntype MessageObject = Record<string, any>;\n\ntype MentionedUser = {\n\t_id: string;\n\tusername: string;\n\tname?: string;\n};\n\ntype IMessageReaction = {\n\tname: string;\n\tusernames: string[];\n};\n\ntype IMessageReactions = Record<string, IMessageReaction>;\n\nexport class MessageConverter extends RecordConverter<IImportMessageRecord> {\n\tprivate rids: string[] = [];\n\n\tasync convertData({ afterImportAllMessagesFn, ...callbacks }: MessageConversionCallbacks = {}): Promise<void> {\n\t\tthis.rids = [];\n\t\tawait super.convertData(callbacks);\n\n\t\tawait this.resetLastMessages();\n\t\tif (afterImportAllMessagesFn) {\n\t\t\tawait afterImportAllMessagesFn(this.rids);\n\t\t}\n\t}\n\n\tprotected async resetLastMessages(): Promise<void> {\n\t\tfor await (const rid of this.rids) {\n\t\t\ttry {\n\t\t\t\tawait Rooms.resetLastMessageById(rid, null);\n\t\t\t} catch (e) {\n\t\t\t\tthis._logger.warn(`Failed to update last message of room ${rid}`);\n\t\t\t\tthis._logger.error(e);\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected async insertMessage(data: IImportMessage): Promise<void> {\n\t\tif (!data.ts || isNaN(data.ts as unknown as number)) {\n\t\t\tthrow new Error('importer-message-invalid-timestamp');\n\t\t}\n\n\t\tconst creator = await this._cache.findImportedUser(data.u._id);\n\t\tif (!creator) {\n\t\t\tthis._logger.warn(`Imported user not found: ${data.u._id}`);\n\t\t\tthrow new Error('importer-message-unknown-user');\n\t\t}\n\t\tconst rid = await this._cache.findImportedRoomId(data.rid);\n\t\tif (!rid) {\n\t\t\tthrow new Error('importer-message-unknown-room');\n\t\t}\n\t\tif (!this.rids.includes(rid)) {\n\t\t\tthis.rids.push(rid);\n\t\t}\n\n\t\tconst msgObj = await this.buildMessageObject(data, rid, creator);\n\n\t\ttry {\n\t\t\tawait insertMessage(creator, msgObj as unknown as IDBMessage, rid, true);\n\t\t} catch (e) {\n\t\t\tthis._logger.warn(`Failed to import message with timestamp ${String(msgObj.ts)} to room ${rid}`);\n\t\t\tthis._logger.error(e);\n\t\t}\n\t}\n\n\tprotected async convertRecord(record: IImportMessageRecord): Promise<boolean> {\n\t\tawait this.insertMessage(record.data);\n\t\treturn true;\n\t}\n\n\tprotected async buildMessageObject(data: IImportMessage, rid: string, creator: UserIdentification): Promise<MessageObject> {\n\t\t// Convert the mentions and channels first because these conversions can also modify the msg in the message object\n\t\tconst mentions = data.mentions && (await this.convertMessageMentions(data));\n\t\tconst channels = data.channels && (await this.convertMessageChannels(data));\n\n\t\treturn {\n\t\t\trid,\n\t\t\tu: {\n\t\t\t\t_id: creator._id,\n\t\t\t\tusername: creator.username,\n\t\t\t},\n\t\t\tmsg: data.msg,\n\t\t\tts: data.ts,\n\t\t\tt: data.t || undefined,\n\t\t\tgroupable: data.groupable,\n\t\t\ttmid: data.tmid,\n\t\t\ttlm: data.tlm,\n\t\t\ttcount: data.tcount,\n\t\t\treplies: data.replies && (await this.convertMessageReplies(data.replies)),\n\t\t\teditedAt: data.editedAt,\n\t\t\teditedBy: data.editedBy && ((await this._cache.findImportedUser(data.editedBy)) || undefined),\n\t\t\tmentions,\n\t\t\tchannels,\n\t\t\t_importFile: data._importFile,\n\t\t\turl: data.url,\n\t\t\tattachments: data.attachments,\n\t\t\tbot: data.bot,\n\t\t\temoji: data.emoji,\n\t\t\talias: data.alias,\n\t\t\t...(data._id ? { _id: data._id } : {}),\n\t\t\t...(data.reactions ? { reactions: await this.convertMessageReactions(data.reactions) } : {}),\n\t\t};\n\t}\n\n\tprotected async convertMessageChannels(message: IImportMessage): Promise<MentionedChannel[] | undefined> {\n\t\tconst { channels } = message;\n\t\tif (!channels) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst result: MentionedChannel[] = [];\n\t\tfor await (const importId of channels) {\n\t\t\tconst { name, _id } = (await this.getMentionedChannelData(importId)) || {};\n\n\t\t\tif (!_id || !name) {\n\t\t\t\tthis._logger.warn(`Mentioned room not found: ${importId}`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tmessage.msg = message.msg.replace(new RegExp(`\\#${importId}`, 'gi'), `#${name}`);\n\n\t\t\tresult.push({\n\t\t\t\t_id,\n\t\t\t\tname,\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprotected async convertMessageMentions(message: IImportMessage): Promise<MentionedUser[] | undefined> {\n\t\tconst { mentions } = message;\n\t\tif (!mentions) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst result: MentionedUser[] = [];\n\t\tfor await (const importId of mentions) {\n\t\t\tif (importId === ('all' as 'string') || importId === 'here') {\n\t\t\t\tresult.push({\n\t\t\t\t\t_id: importId,\n\t\t\t\t\tusername: importId,\n\t\t\t\t});\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Loading the name will also store the remaining data on the cache if it's missing, so this won't run two queries\n\t\t\tconst name = await this._cache.findImportedUserDisplayName(importId);\n\t\t\tconst data = await this._cache.findImportedUser(importId);\n\n\t\t\tif (!data) {\n\t\t\t\tthis._logger.warn(`Mentioned user not found: ${importId}`);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!data.username) {\n\t\t\t\tthis._logger.debug(importId);\n\t\t\t\tthrow new Error('importer-message-mentioned-username-not-found');\n\t\t\t}\n\n\t\t\tmessage.msg = message.msg.replace(new RegExp(`\\@${importId}`, 'gi'), `@${data.username}`);\n\n\t\t\tresult.push({\n\t\t\t\t_id: data._id,\n\t\t\t\tusername: data.username as 'string',\n\t\t\t\tname,\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected async convertMessageReactions(\n\t\timportedReactions: Record<string, IImportMessageReaction>,\n\t): Promise<undefined | IMessageReactions> {\n\t\tconst reactions: IMessageReactions = {};\n\n\t\tfor await (const name of Object.keys(importedReactions)) {\n\t\t\tif (!importedReactions.hasOwnProperty(name)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst { users } = importedReactions[name];\n\n\t\t\tif (!users.length) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst reaction: IMessageReaction = {\n\t\t\t\tname,\n\t\t\t\tusernames: [],\n\t\t\t};\n\n\t\t\tfor await (const importId of users) {\n\t\t\t\tconst username = await this._cache.findImportedUsername(importId);\n\t\t\t\tif (username && !reaction.usernames.includes(username)) {\n\t\t\t\t\treaction.usernames.push(username);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (reaction.usernames.length) {\n\t\t\t\treactions[name] = reaction;\n\t\t\t}\n\t\t}\n\n\t\tif (Object.keys(reactions).length > 0) {\n\t\t\treturn reactions;\n\t\t}\n\t}\n\n\tprotected async convertMessageReplies(replies: string[]): Promise<string[]> {\n\t\tconst result: string[] = [];\n\t\tfor await (const importId of replies) {\n\t\t\tconst userId = await this._cache.findImportedUserId(importId);\n\t\t\tif (userId && !result.includes(userId)) {\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected async getMentionedChannelData(importId: string): Promise<MentionedChannel | undefined> {\n\t\t// loading the name will also store the id on the cache if it's missing, so this won't run two queries\n\t\tconst name = await this._cache.findImportedRoomName(importId);\n\t\tconst _id = await this._cache.findImportedRoomId(importId);\n\n\t\tif (name && _id) {\n\t\t\treturn {\n\t\t\t\tname,\n\t\t\t\t_id,\n\t\t\t};\n\t\t}\n\n\t\t// If the importId was not found, check if we have a room with that name\n\t\tconst roomName = limax(importId.trim(), { maintainCase: true });\n\n\t\tconst room = await Rooms.findOneByNonValidatedName(roomName, { projection: { name: 1 } });\n\t\tif (room?.name) {\n\t\t\tthis._cache.addRoom(importId, room._id);\n\t\t\tthis._cache.addRoomName(importId, room.name);\n\n\t\t\treturn {\n\t\t\t\tname: room.name,\n\t\t\t\t_id: room._id,\n\t\t\t};\n\t\t}\n\t}\n\n\tprotected getDataType(): 'message' {\n\t\treturn 'message';\n\t}\n}\n"],"names":["MessageConverter","RecordConverter","convertData","afterImportAllMessagesFn","callbacks","rids","resetLastMessages","rid","Rooms","resetLastMessageById","e","_logger","warn","error","insertMessage","data","ts","isNaN","Error","creator","_cache","findImportedUser","u","_id","findImportedRoomId","includes","push","msgObj","buildMessageObject","String","convertRecord","record","mentions","convertMessageMentions","channels","convertMessageChannels","username","msg","t","undefined","groupable","tmid","tlm","tcount","replies","convertMessageReplies","editedAt","editedBy","_importFile","url","attachments","bot","emoji","alias","reactions","convertMessageReactions","message","result","importId","name","getMentionedChannelData","replace","RegExp","findImportedUserDisplayName","debug","importedReactions","Object","keys","hasOwnProperty","users","length","reaction","usernames","findImportedUsername","userId","findImportedUserId","findImportedRoomName","roomName","limax","trim","maintainCase","room","findOneByNonValidatedName","projection","addRoom","addRoomName","getDataType"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/MessageConverter.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"bee0f43d57decf20a58bf0c96f21e5791df80e2b","contentHash":"a6cc303ac9f669f9f685f6093f4792c4f936367ff9695aaaabe2f3c983964bd2"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/RecordConverter.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/RecordConverter.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":31}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":46}},"5":{"start":{"line":13,"column":16},"end":{"line":13,"column":46}},"6":{"start":{"line":14,"column":17},"end":{"line":14,"column":35}},"7":{"start":{"line":15,"column":24},"end":{"line":15,"column":51}},"8":{"start":{"line":16,"column":22},"end":{"line":194,"column":1}},"9":{"start":{"line":18,"column":23},"end":{"line":18,"column":52}},"10":{"start":{"line":19,"column":8},"end":{"line":21,"column":9}},"11":{"start":{"line":20,"column":12},"end":{"line":20,"column":19}},"12":{"start":{"line":22,"column":8},"end":{"line":22,"column":30}},"13":{"start":{"line":25,"column":8},"end":{"line":31,"column":11}},"14":{"start":{"line":34,"column":8},"end":{"line":34,"column":28}},"15":{"start":{"line":35,"column":8},"end":{"line":35,"column":35}},"16":{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},"17":{"start":{"line":37,"column":12},"end":{"line":37,"column":48}},"18":{"start":{"line":41,"column":23},"end":{"line":41,"column":57}},"19":{"start":{"line":42,"column":8},"end":{"line":44,"column":9}},"20":{"start":{"line":43,"column":12},"end":{"line":43,"column":19}},"21":{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},"22":{"start":{"line":46,"column":12},"end":{"line":46,"column":31}},"23":{"start":{"line":48,"column":8},"end":{"line":51,"column":11}},"24":{"start":{"line":54,"column":8},"end":{"line":63,"column":11}},"25":{"start":{"line":66,"column":8},"end":{"line":66,"column":34}},"26":{"start":{"line":67,"column":8},"end":{"line":67,"column":48}},"27":{"start":{"line":68,"column":8},"end":{"line":70,"column":9}},"28":{"start":{"line":69,"column":12},"end":{"line":69,"column":61}},"29":{"start":{"line":73,"column":8},"end":{"line":73,"column":27}},"30":{"start":{"line":75,"column":8},"end":{"line":79,"column":9}},"31":{"start":{"line":76,"column":12},"end":{"line":78,"column":15}},"32":{"start":{"line":82,"column":8},"end":{"line":85,"column":11}},"33":{"start":{"line":84,"column":12},"end":{"line":84,"column":126}},"34":{"start":{"line":87,"column":8},"end":{"line":94,"column":9}},"35":{"start":{"line":88,"column":12},"end":{"line":93,"column":15}},"36":{"start":{"line":97,"column":8},"end":{"line":101,"column":9}},"37":{"start":{"line":98,"column":12},"end":{"line":100,"column":13}},"38":{"start":{"line":99,"column":16},"end":{"line":99,"column":30}},"39":{"start":{"line":102,"column":8},"end":{"line":102,"column":25}},"40":{"start":{"line":105,"column":8},"end":{"line":105,"column":44}},"41":{"start":{"line":108,"column":8},"end":{"line":113,"column":11}},"42":{"start":{"line":116,"column":8},"end":{"line":121,"column":11}},"43":{"start":{"line":124,"column":8},"end":{"line":126,"column":9}},"44":{"start":{"line":125,"column":12},"end":{"line":125,"column":57}},"45":{"start":{"line":127,"column":8},"end":{"line":127,"column":55}},"46":{"start":{"line":130,"column":8},"end":{"line":132,"column":21}},"47":{"start":{"line":135,"column":8},"end":{"line":137,"column":9}},"48":{"start":{"line":136,"column":12},"end":{"line":136,"column":33}},"49":{"start":{"line":138,"column":26},"end":{"line":138,"column":62}},"50":{"start":{"line":139,"column":8},"end":{"line":144,"column":9}},"51":{"start":{"line":140,"column":12},"end":{"line":143,"column":14}},"52":{"start":{"line":145,"column":8},"end":{"line":145,"column":25}},"53":{"start":{"line":148,"column":24},"end":{"line":148,"column":52}},"54":{"start":{"line":149,"column":8},"end":{"line":149,"column":30}},"55":{"start":{"line":150,"column":8},"end":{"line":150,"column":29}},"56":{"start":{"line":151,"column":8},"end":{"line":172,"column":9}},"57":{"start":{"line":152,"column":28},"end":{"line":152,"column":34}},"58":{"start":{"line":153,"column":12},"end":{"line":155,"column":13}},"59":{"start":{"line":154,"column":16},"end":{"line":154,"column":23}},"60":{"start":{"line":156,"column":12},"end":{"line":171,"column":13}},"61":{"start":{"line":157,"column":16},"end":{"line":160,"column":17}},"62":{"start":{"line":158,"column":20},"end":{"line":158,"column":47}},"63":{"start":{"line":159,"column":20},"end":{"line":159,"column":29}},"64":{"start":{"line":161,"column":30},"end":{"line":161,"column":92}},"65":{"start":{"line":162,"column":16},"end":{"line":164,"column":17}},"66":{"start":{"line":163,"column":20},"end":{"line":163,"column":55}},"67":{"start":{"line":166,"column":16},"end":{"line":166,"column":35}},"68":{"start":{"line":167,"column":16},"end":{"line":167,"column":89}},"69":{"start":{"line":168,"column":16},"end":{"line":170,"column":17}},"70":{"start":{"line":169,"column":20},"end":{"line":169,"column":38}},"71":{"start":{"line":175,"column":8},"end":{"line":175,"column":46}},"72":{"start":{"line":178,"column":8},"end":{"line":178,"column":25}},"73":{"start":{"line":181,"column":8},"end":{"line":181,"column":30}},"74":{"start":{"line":182,"column":8},"end":{"line":182,"column":29}},"75":{"start":{"line":183,"column":8},"end":{"line":183,"column":29}},"76":{"start":{"line":184,"column":81},"end":{"line":184,"column":94}},"77":{"start":{"line":185,"column":8},"end":{"line":188,"column":10}},"78":{"start":{"line":189,"column":8},"end":{"line":189,"column":38}},"79":{"start":{"line":190,"column":8},"end":{"line":190,"column":96}},"80":{"start":{"line":191,"column":8},"end":{"line":191,"column":68}},"81":{"start":{"line":192,"column":8},"end":{"line":192,"column":27}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":17,"column":4},"end":{"line":17,"column":5}},"loc":{"start":{"line":17,"column":26},"end":{"line":23,"column":5}},"line":17},"2":{"name":"(anonymous_2)","decl":{"start":{"line":24,"column":4},"end":{"line":24,"column":5}},"loc":{"start":{"line":24,"column":34},"end":{"line":32,"column":5}},"line":24},"3":{"name":"(anonymous_3)","decl":{"start":{"line":33,"column":4},"end":{"line":33,"column":5}},"loc":{"start":{"line":33,"column":26},"end":{"line":39,"column":5}},"line":33},"4":{"name":"(anonymous_4)","decl":{"start":{"line":40,"column":4},"end":{"line":40,"column":5}},"loc":{"start":{"line":40,"column":39},"end":{"line":52,"column":5}},"line":40},"5":{"name":"(anonymous_5)","decl":{"start":{"line":53,"column":4},"end":{"line":53,"column":5}},"loc":{"start":{"line":53,"column":47},"end":{"line":64,"column":5}},"line":53},"6":{"name":"(anonymous_6)","decl":{"start":{"line":65,"column":4},"end":{"line":65,"column":5}},"loc":{"start":{"line":65,"column":37},"end":{"line":71,"column":5}},"line":65},"7":{"name":"(anonymous_7)","decl":{"start":{"line":72,"column":4},"end":{"line":72,"column":5}},"loc":{"start":{"line":72,"column":28},"end":{"line":80,"column":5}},"line":72},"8":{"name":"(anonymous_8)","decl":{"start":{"line":81,"column":4},"end":{"line":81,"column":5}},"loc":{"start":{"line":81,"column":42},"end":{"line":95,"column":5}},"line":81},"9":{"name":"(anonymous_9)","decl":{"start":{"line":82,"column":45},"end":{"line":82,"column":46}},"loc":{"start":{"line":82,"column":55},"end":{"line":85,"column":9}},"line":82},"10":{"name":"(anonymous_10)","decl":{"start":{"line":96,"column":4},"end":{"line":96,"column":5}},"loc":{"start":{"line":96,"column":28},"end":{"line":103,"column":5}},"line":96},"11":{"name":"(anonymous_11)","decl":{"start":{"line":104,"column":4},"end":{"line":104,"column":5}},"loc":{"start":{"line":104,"column":18},"end":{"line":106,"column":5}},"line":104},"12":{"name":"(anonymous_12)","decl":{"start":{"line":107,"column":4},"end":{"line":107,"column":5}},"loc":{"start":{"line":107,"column":50},"end":{"line":114,"column":5}},"line":107},"13":{"name":"(anonymous_13)","decl":{"start":{"line":115,"column":4},"end":{"line":115,"column":5}},"loc":{"start":{"line":115,"column":42},"end":{"line":122,"column":5}},"line":115},"14":{"name":"(anonymous_14)","decl":{"start":{"line":123,"column":4},"end":{"line":123,"column":5}},"loc":{"start":{"line":123,"column":40},"end":{"line":128,"column":5}},"line":123},"15":{"name":"(anonymous_15)","decl":{"start":{"line":129,"column":4},"end":{"line":129,"column":5}},"loc":{"start":{"line":129,"column":30},"end":{"line":133,"column":5}},"line":129},"16":{"name":"(anonymous_16)","decl":{"start":{"line":134,"column":4},"end":{"line":134,"column":5}},"loc":{"start":{"line":134,"column":28},"end":{"line":146,"column":5}},"line":134},"17":{"name":"(anonymous_17)","decl":{"start":{"line":147,"column":4},"end":{"line":147,"column":5}},"loc":{"start":{"line":147,"column":91},"end":{"line":173,"column":5}},"line":147},"18":{"name":"(anonymous_18)","decl":{"start":{"line":174,"column":4},"end":{"line":174,"column":5}},"loc":{"start":{"line":174,"column":38},"end":{"line":176,"column":5}},"line":174},"19":{"name":"(anonymous_19)","decl":{"start":{"line":177,"column":4},"end":{"line":177,"column":5}},"loc":{"start":{"line":177,"column":33},"end":{"line":179,"column":5}},"line":177},"20":{"name":"(anonymous_20)","decl":{"start":{"line":180,"column":4},"end":{"line":180,"column":5}},"loc":{"start":{"line":180,"column":39},"end":{"line":193,"column":5}},"line":180}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":8},"end":{"line":21,"column":9}},"type":"if","locations":[{"start":{"line":19,"column":8},"end":{"line":21,"column":9}},{"start":{"line":19,"column":8},"end":{"line":21,"column":9}}],"line":19},"1":{"loc":{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},"type":"if","locations":[{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},{"start":{"line":36,"column":8},"end":{"line":38,"column":9}}],"line":36},"2":{"loc":{"start":{"line":42,"column":8},"end":{"line":44,"column":9}},"type":"if","locations":[{"start":{"line":42,"column":8},"end":{"line":44,"column":9}},{"start":{"line":42,"column":8},"end":{"line":44,"column":9}}],"line":42},"3":{"loc":{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},{"start":{"line":45,"column":8},"end":{"line":47,"column":9}}],"line":45},"4":{"loc":{"start":{"line":68,"column":8},"end":{"line":70,"column":9}},"type":"if","locations":[{"start":{"line":68,"column":8},"end":{"line":70,"column":9}},{"start":{"line":68,"column":8},"end":{"line":70,"column":9}}],"line":68},"5":{"loc":{"start":{"line":75,"column":8},"end":{"line":79,"column":9}},"type":"if","locations":[{"start":{"line":75,"column":8},"end":{"line":79,"column":9}},{"start":{"line":75,"column":8},"end":{"line":79,"column":9}}],"line":75},"6":{"loc":{"start":{"line":75,"column":12},"end":{"line":75,"column":87}},"type":"binary-expr","locations":[{"start":{"line":75,"column":12},"end":{"line":75,"column":48}},{"start":{"line":75,"column":52},"end":{"line":75,"column":87}}],"line":75},"7":{"loc":{"start":{"line":84,"column":21},"end":{"line":84,"column":124}},"type":"cond-expr","locations":[{"start":{"line":84,"column":94},"end":{"line":84,"column":100}},{"start":{"line":84,"column":103},"end":{"line":84,"column":124}}],"line":84},"8":{"loc":{"start":{"line":84,"column":21},"end":{"line":84,"column":91}},"type":"binary-expr","locations":[{"start":{"line":84,"column":21},"end":{"line":84,"column":62}},{"start":{"line":84,"column":66},"end":{"line":84,"column":91}}],"line":84},"9":{"loc":{"start":{"line":87,"column":8},"end":{"line":94,"column":9}},"type":"if","locations":[{"start":{"line":87,"column":8},"end":{"line":94,"column":9}},{"start":{"line":87,"column":8},"end":{"line":94,"column":9}}],"line":87},"10":{"loc":{"start":{"line":87,"column":12},"end":{"line":87,"column":87}},"type":"binary-expr","locations":[{"start":{"line":87,"column":12},"end":{"line":87,"column":48}},{"start":{"line":87,"column":52},"end":{"line":87,"column":87}}],"line":87},"11":{"loc":{"start":{"line":98,"column":12},"end":{"line":100,"column":13}},"type":"if","locations":[{"start":{"line":98,"column":12},"end":{"line":100,"column":13}},{"start":{"line":98,"column":12},"end":{"line":100,"column":13}}],"line":98},"12":{"loc":{"start":{"line":107,"column":36},"end":{"line":107,"column":48}},"type":"default-arg","locations":[{"start":{"line":107,"column":46},"end":{"line":107,"column":48}}],"line":107},"13":{"loc":{"start":{"line":115,"column":28},"end":{"line":115,"column":40}},"type":"default-arg","locations":[{"start":{"line":115,"column":38},"end":{"line":115,"column":40}}],"line":115},"14":{"loc":{"start":{"line":123,"column":26},"end":{"line":123,"column":38}},"type":"default-arg","locations":[{"start":{"line":123,"column":36},"end":{"line":123,"column":38}}],"line":123},"15":{"loc":{"start":{"line":124,"column":8},"end":{"line":126,"column":9}},"type":"if","locations":[{"start":{"line":124,"column":8},"end":{"line":126,"column":9}},{"start":{"line":124,"column":8},"end":{"line":126,"column":9}}],"line":124},"16":{"loc":{"start":{"line":135,"column":8},"end":{"line":137,"column":9}},"type":"if","locations":[{"start":{"line":135,"column":8},"end":{"line":137,"column":9}},{"start":{"line":135,"column":8},"end":{"line":137,"column":9}}],"line":135},"17":{"loc":{"start":{"line":139,"column":8},"end":{"line":144,"column":9}},"type":"if","locations":[{"start":{"line":139,"column":8},"end":{"line":144,"column":9}},{"start":{"line":139,"column":8},"end":{"line":144,"column":9}}],"line":139},"18":{"loc":{"start":{"line":147,"column":25},"end":{"line":147,"column":89}},"type":"default-arg","locations":[{"start":{"line":147,"column":87},"end":{"line":147,"column":89}}],"line":147},"19":{"loc":{"start":{"line":153,"column":12},"end":{"line":155,"column":13}},"type":"if","locations":[{"start":{"line":153,"column":12},"end":{"line":155,"column":13}},{"start":{"line":153,"column":12},"end":{"line":155,"column":13}}],"line":153},"20":{"loc":{"start":{"line":157,"column":16},"end":{"line":160,"column":17}},"type":"if","locations":[{"start":{"line":157,"column":16},"end":{"line":160,"column":17}},{"start":{"line":157,"column":16},"end":{"line":160,"column":17}}],"line":157},"21":{"loc":{"start":{"line":157,"column":20},"end":{"line":157,"column":67}},"type":"binary-expr","locations":[{"start":{"line":157,"column":20},"end":{"line":157,"column":34}},{"start":{"line":157,"column":38},"end":{"line":157,"column":67}}],"line":157},"22":{"loc":{"start":{"line":161,"column":37},"end":{"line":161,"column":72}},"type":"binary-expr","locations":[{"start":{"line":161,"column":37},"end":{"line":161,"column":50}},{"start":{"line":161,"column":54},"end":{"line":161,"column":72}}],"line":161},"23":{"loc":{"start":{"line":162,"column":16},"end":{"line":164,"column":17}},"type":"if","locations":[{"start":{"line":162,"column":16},"end":{"line":164,"column":17}},{"start":{"line":162,"column":16},"end":{"line":164,"column":17}}],"line":162},"24":{"loc":{"start":{"line":162,"column":20},"end":{"line":162,"column":63}},"type":"binary-expr","locations":[{"start":{"line":162,"column":20},"end":{"line":162,"column":46}},{"start":{"line":162,"column":50},"end":{"line":162,"column":63}}],"line":162},"25":{"loc":{"start":{"line":167,"column":42},"end":{"line":167,"column":87}},"type":"cond-expr","locations":[{"start":{"line":167,"column":63},"end":{"line":167,"column":64}},{"start":{"line":167,"column":67},"end":{"line":167,"column":87}}],"line":167},"26":{"loc":{"start":{"line":168,"column":16},"end":{"line":170,"column":17}},"type":"if","locations":[{"start":{"line":168,"column":16},"end":{"line":170,"column":17}},{"start":{"line":168,"column":16},"end":{"line":170,"column":17}}],"line":168},"27":{"loc":{"start":{"line":174,"column":22},"end":{"line":174,"column":36}},"type":"default-arg","locations":[{"start":{"line":174,"column":34},"end":{"line":174,"column":36}}],"line":174},"28":{"loc":{"start":{"line":184,"column":16},"end":{"line":184,"column":36}},"type":"default-arg","locations":[{"start":{"line":184,"column":31},"end":{"line":184,"column":36}}],"line":184},"29":{"loc":{"start":{"line":184,"column":38},"end":{"line":184,"column":58}},"type":"default-arg","locations":[{"start":{"line":184,"column":53},"end":{"line":184,"column":58}}],"line":184},"30":{"loc":{"start":{"line":184,"column":81},"end":{"line":184,"column":94}},"type":"binary-expr","locations":[{"start":{"line":184,"column":81},"end":{"line":184,"column":88}},{"start":{"line":184,"column":92},"end":{"line":184,"column":94}}],"line":184},"31":{"loc":{"start":{"line":190,"column":23},"end":{"line":190,"column":95}},"type":"binary-expr","locations":[{"start":{"line":190,"column":23},"end":{"line":190,"column":29}},{"start":{"line":190,"column":33},"end":{"line":190,"column":95}}],"line":190},"32":{"loc":{"start":{"line":191,"column":22},"end":{"line":191,"column":67}},"type":"binary-expr","locations":[{"start":{"line":191,"column":22},"end":{"line":191,"column":27}},{"start":{"line":191,"column":31},"end":{"line":191,"column":67}}],"line":191}},"s":{"0":4,"1":4,"2":4,"3":4,"4":4,"5":4,"6":4,"7":4,"8":4,"9":4,"10":4,"11":2,"12":2,"13":1,"14":7,"15":7,"16":7,"17":1,"18":4,"19":4,"20":2,"21":2,"22":2,"23":2,"24":1,"25":4,"26":4,"27":4,"28":1,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":8,"37":4,"38":4,"39":4,"40":0,"41":2,"42":30,"43":32,"44":30,"45":2,"46":1,"47":30,"48":29,"49":1,"50":1,"51":0,"52":1,"53":27,"54":27,"55":27,"56":27,"57":27,"58":27,"59":0,"60":27,"61":27,"62":5,"63":5,"64":22,"65":17,"66":6,"67":5,"68":5,"69":5,"70":3,"71":27,"72":0,"73":47,"74":47,"75":47,"76":47,"77":47,"78":47,"79":47,"80":47,"81":47},"f":{"0":4,"1":4,"2":1,"3":7,"4":4,"5":1,"6":4,"7":0,"8":0,"9":0,"10":8,"11":0,"12":2,"13":30,"14":32,"15":1,"16":30,"17":27,"18":27,"19":0,"20":47},"b":{"0":[2,2],"1":[1,6],"2":[2,2],"3":[2,0],"4":[1,3],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[4,0],"12":[0],"13":[0],"14":[32],"15":[30,2],"16":[29,1],"17":[0,1],"18":[0],"19":[0,27],"20":[5,22],"21":[27,9],"22":[22,22],"23":[6,11],"24":[17,15],"25":[5,0],"26":[3,2],"27":[0],"28":[0],"29":[47],"30":[47,0],"31":[47,47],"32":[47,47]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/RecordConverter.ts"],"sourcesContent":["import type { IImportRecord } from '@rocket.chat/core-typings';\nimport { Logger } from '@rocket.chat/logger';\nimport { ImportData } from '@rocket.chat/models';\nimport { Random } from '@rocket.chat/random';\nimport { type FindCursor, ObjectId } from 'mongodb';\n\nimport type { IConversionCallbacks } from '../../definitions/IConversionCallbacks';\nimport { ConverterCache } from './ConverterCache';\n\nexport type RecordConverterOptions = {\n\tworkInMemory?: boolean;\n\tdeleteDbData?: boolean;\n};\n\nexport class RecordConverter<R extends IImportRecord, T extends RecordConverterOptions = RecordConverterOptions> {\n\tprotected _logger: Logger;\n\n\tprotected _cache: ConverterCache;\n\n\tprotected _converterOptions: RecordConverterOptions;\n\n\tprotected _options: Omit<T, keyof RecordConverterOptions>;\n\n\tprotected _records: R[];\n\n\tprotected skippedCount = 0;\n\n\tprotected failedCount = 0;\n\n\tpublic aborted = false;\n\n\tconstructor(options?: T, logger?: Logger, cache?: ConverterCache) {\n\t\tconst { workInMemory = false, deleteDbData = false, ...customOptions } = options || ({} as T);\n\t\tthis._converterOptions = {\n\t\t\tworkInMemory,\n\t\t\tdeleteDbData,\n\t\t};\n\t\tthis._options = customOptions;\n\n\t\tthis._logger = logger || new Logger(`Data Importer - ${this.constructor.name}`);\n\t\tthis._cache = cache || new ConverterCache();\n\t\tthis._records = [];\n\t}\n\n\tprivate skipMemoryRecord(_id: string): void {\n\t\tconst record = this.getMemoryRecordById(_id);\n\t\tif (!record) {\n\t\t\treturn;\n\t\t}\n\n\t\trecord.skipped = true;\n\t}\n\n\tprivate async skipDatabaseRecord(_id: string): Promise<void> {\n\t\tawait ImportData.updateOne(\n\t\t\t{\n\t\t\t\t_id,\n\t\t\t},\n\t\t\t{\n\t\t\t\t$set: {\n\t\t\t\t\tskipped: true,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\tprotected async skipRecord(_id: string): Promise<void> {\n\t\tthis.skippedCount++;\n\t\tthis.skipMemoryRecord(_id);\n\t\tif (!this._converterOptions.workInMemory) {\n\t\t\treturn this.skipDatabaseRecord(_id);\n\t\t}\n\t}\n\n\tprivate saveErrorToMemory(importId: string, error: Error): void {\n\t\tconst record = this.getMemoryRecordById(importId);\n\n\t\tif (!record) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!record.errors) {\n\t\t\trecord.errors = [];\n\t\t}\n\n\t\trecord.errors.push({\n\t\t\tmessage: error.message,\n\t\t\tstack: error.stack,\n\t\t});\n\t}\n\n\tprivate async saveErrorToDatabase(importId: string, error: Error): Promise<void> {\n\t\tawait ImportData.updateOne(\n\t\t\t{\n\t\t\t\t_id: importId,\n\t\t\t},\n\t\t\t{\n\t\t\t\t$push: {\n\t\t\t\t\terrors: {\n\t\t\t\t\t\tmessage: error.message,\n\t\t\t\t\t\tstack: error.stack,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\tprotected async saveError(importId: string, error: Error): Promise<void> {\n\t\tthis._logger.error(error);\n\t\tthis.saveErrorToMemory(importId, error);\n\n\t\tif (!this._converterOptions.workInMemory) {\n\t\t\treturn this.saveErrorToDatabase(importId, error);\n\t\t}\n\t}\n\n\tpublic async clearImportData(): Promise<void> {\n\t\tthis._records = [];\n\n\t\t// On regular import operations this data will be deleted by the importer class with one single operation for all dataTypes (aka with no filter)\n\t\tif (!this._converterOptions.workInMemory && this._converterOptions.deleteDbData) {\n\t\t\tawait ImportData.col.deleteMany({ dataType: this.getDataType() });\n\t\t}\n\t}\n\n\tpublic async clearSuccessfullyImportedData(): Promise<void> {\n\t\tthis._records = this._records.filter((record) => !record.errors?.length);\n\n\t\t// On regular import operations this data will be deleted by the importer class with one single operation for all dataTypes (aka with no filter)\n\t\tif (!this._converterOptions.workInMemory && this._converterOptions.deleteDbData) {\n\t\t\tawait ImportData.col.deleteMany({ dataType: this.getDataType(), error: { $exists: false } });\n\t\t}\n\t}\n\n\tprivate getMemoryRecordById(id: string): R | undefined {\n\t\tfor (const record of this._records) {\n\t\t\tif (record._id === id) {\n\t\t\t\treturn record;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprotected getDataType(): R['dataType'] {\n\t\tthrow new Error('Unspecified type');\n\t}\n\n\tprotected async addObjectToDatabase(data: R['data'], options: R['options'] = {}): Promise<void> {\n\t\tawait ImportData.col.insertOne({\n\t\t\t_id: new ObjectId().toHexString(),\n\t\t\tdata,\n\t\t\tdataType: this.getDataType(),\n\t\t\toptions,\n\t\t});\n\t}\n\n\tpublic addObjectToMemory(data: R['data'], options: R['options'] = {}): void {\n\t\tthis._records.push({\n\t\t\t_id: Random.id(),\n\t\t\tdata,\n\t\t\tdataType: this.getDataType(),\n\t\t\toptions,\n\t\t} as R);\n\t}\n\n\tpublic async addObject(data: R['data'], options: R['options'] = {}): Promise<void> {\n\t\tif (this._converterOptions.workInMemory) {\n\t\t\treturn this.addObjectToMemory(data, options);\n\t\t}\n\n\t\treturn this.addObjectToDatabase(data, options);\n\t}\n\n\tprotected getDatabaseDataToImport(): Promise<R[]> {\n\t\treturn (ImportData.find({ dataType: this.getDataType() }) as FindCursor<R>).toArray();\n\t}\n\n\tprotected async getDataToImport(): Promise<R[]> {\n\t\tif (this._converterOptions.workInMemory) {\n\t\t\treturn this._records;\n\t\t}\n\n\t\tconst dbRecords = await this.getDatabaseDataToImport();\n\t\tif (this._records.length) {\n\t\t\treturn [...this._records, ...dbRecords];\n\t\t}\n\n\t\treturn dbRecords;\n\t}\n\n\tprotected async iterateRecords({\n\t\tbeforeImportFn,\n\t\tafterImportFn,\n\t\tonErrorFn,\n\t\tprocessRecord,\n\t}: IConversionCallbacks & { processRecord?: (record: R) => Promise<boolean | undefined> } = {}): Promise<void> {\n\t\tconst records = await this.getDataToImport();\n\n\t\tthis.skippedCount = 0;\n\t\tthis.failedCount = 0;\n\n\t\tfor await (const record of records) {\n\t\t\tconst { _id } = record;\n\t\t\tif (this.aborted) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tif (beforeImportFn && !(await beforeImportFn(record))) {\n\t\t\t\t\tawait this.skipRecord(_id);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst isNew = await (processRecord || this.convertRecord).call(this, record);\n\n\t\t\t\tif (typeof isNew === 'boolean' && afterImportFn) {\n\t\t\t\t\tawait afterImportFn(record, isNew);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tthis.failedCount++;\n\t\t\t\tawait this.saveError(_id, e instanceof Error ? e : new Error(String(e)));\n\t\t\t\tif (onErrorFn) {\n\t\t\t\t\tawait onErrorFn();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tasync convertData(callbacks: IConversionCallbacks = {}): Promise<void> {\n\t\treturn this.iterateRecords(callbacks);\n\t}\n\n\tprotected async convertRecord(_record: R): Promise<boolean | undefined> {\n\t\treturn undefined;\n\t}\n}\n"],"names":["RecordConverter","skipMemoryRecord","_id","record","getMemoryRecordById","skipped","skipDatabaseRecord","ImportData","updateOne","$set","skipRecord","skippedCount","_converterOptions","workInMemory","saveErrorToMemory","importId","error","errors","push","message","stack","saveErrorToDatabase","$push","saveError","_logger","clearImportData","_records","deleteDbData","col","deleteMany","dataType","getDataType","clearSuccessfullyImportedData","filter","length","$exists","id","undefined","Error","addObjectToDatabase","data","options","insertOne","ObjectId","toHexString","addObjectToMemory","Random","addObject","getDatabaseDataToImport","find","toArray","getDataToImport","dbRecords","iterateRecords","beforeImportFn","afterImportFn","onErrorFn","processRecord","records","failedCount","aborted","isNew","convertRecord","call","e","String","convertData","callbacks","_record","constructor","logger","cache","customOptions","_options","Logger","name","_cache","ConverterCache"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/RecordConverter.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3f7da0f3afe73278f0ed75344b1fa4345e8db3f2","contentHash":"56f6dc200b9865d02de4b16431ef3faab7fa218f928cc94807758d00c4da3859"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/ConverterCache.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/ConverterCache.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":30}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":21},"end":{"line":163,"column":1}},"5":{"start":{"line":14,"column":22},"end":{"line":17,"column":9}},"6":{"start":{"line":18,"column":8},"end":{"line":18,"column":45}},"7":{"start":{"line":19,"column":8},"end":{"line":19,"column":21}},"8":{"start":{"line":22,"column":8},"end":{"line":22,"column":55}},"9":{"start":{"line":23,"column":8},"end":{"line":23,"column":20}},"10":{"start":{"line":26,"column":8},"end":{"line":26,"column":43}},"11":{"start":{"line":27,"column":8},"end":{"line":27,"column":19}},"12":{"start":{"line":30,"column":8},"end":{"line":30,"column":48}},"13":{"start":{"line":31,"column":8},"end":{"line":31,"column":20}},"14":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"15":{"start":{"line":35,"column":12},"end":{"line":35,"column":19}},"16":{"start":{"line":37,"column":8},"end":{"line":39,"column":9}},"17":{"start":{"line":38,"column":12},"end":{"line":38,"column":19}},"18":{"start":{"line":40,"column":8},"end":{"line":40,"column":77}},"19":{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},"20":{"start":{"line":44,"column":12},"end":{"line":44,"column":49}},"21":{"start":{"line":46,"column":24},"end":{"line":50,"column":9}},"22":{"start":{"line":51,"column":21},"end":{"line":51,"column":77}},"23":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"24":{"start":{"line":53,"column":12},"end":{"line":53,"column":52}},"25":{"start":{"line":55,"column":8},"end":{"line":55,"column":20}},"26":{"start":{"line":58,"column":8},"end":{"line":60,"column":9}},"27":{"start":{"line":59,"column":12},"end":{"line":59,"column":53}},"28":{"start":{"line":61,"column":24},"end":{"line":66,"column":9}},"29":{"start":{"line":67,"column":21},"end":{"line":67,"column":77}},"30":{"start":{"line":68,"column":8},"end":{"line":75,"column":9}},"31":{"start":{"line":69,"column":12},"end":{"line":71,"column":13}},"32":{"start":{"line":70,"column":16},"end":{"line":70,"column":49}},"33":{"start":{"line":72,"column":12},"end":{"line":74,"column":13}},"34":{"start":{"line":73,"column":16},"end":{"line":73,"column":61}},"35":{"start":{"line":78,"column":8},"end":{"line":83,"column":9}},"36":{"start":{"line":79,"column":12},"end":{"line":82,"column":14}},"37":{"start":{"line":84,"column":24},"end":{"line":89,"column":9}},"38":{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},"39":{"start":{"line":91,"column":12},"end":{"line":91,"column":49}},"40":{"start":{"line":93,"column":21},"end":{"line":93,"column":77}},"41":{"start":{"line":94,"column":8},"end":{"line":96,"column":9}},"42":{"start":{"line":95,"column":12},"end":{"line":95,"column":67}},"43":{"start":{"line":97,"column":8},"end":{"line":97,"column":20}},"44":{"start":{"line":100,"column":21},"end":{"line":100,"column":53}},"45":{"start":{"line":101,"column":8},"end":{"line":101,"column":68}},"46":{"start":{"line":104,"column":21},"end":{"line":104,"column":53}},"47":{"start":{"line":105,"column":8},"end":{"line":105,"column":73}},"48":{"start":{"line":108,"column":24},"end":{"line":114,"column":9}},"49":{"start":{"line":115,"column":8},"end":{"line":117,"column":9}},"50":{"start":{"line":116,"column":12},"end":{"line":116,"column":60}},"51":{"start":{"line":118,"column":21},"end":{"line":118,"column":162}},"52":{"start":{"line":119,"column":8},"end":{"line":127,"column":9}},"53":{"start":{"line":120,"column":12},"end":{"line":122,"column":13}},"54":{"start":{"line":121,"column":16},"end":{"line":121,"column":64}},"55":{"start":{"line":123,"column":12},"end":{"line":125,"column":13}},"56":{"start":{"line":124,"column":16},"end":{"line":124,"column":23}},"57":{"start":{"line":126,"column":12},"end":{"line":126,"column":64}},"58":{"start":{"line":130,"column":8},"end":{"line":154,"column":34}},"59":{"start":{"line":131,"column":12},"end":{"line":133,"column":13}},"60":{"start":{"line":132,"column":16},"end":{"line":132,"column":28}},"61":{"start":{"line":134,"column":12},"end":{"line":139,"column":13}},"62":{"start":{"line":135,"column":30},"end":{"line":135,"column":55}},"63":{"start":{"line":136,"column":16},"end":{"line":138,"column":17}},"64":{"start":{"line":137,"column":20},"end":{"line":137,"column":42}},"65":{"start":{"line":140,"column":24},"end":{"line":145,"column":14}},"66":{"start":{"line":146,"column":12},"end":{"line":152,"column":13}},"67":{"start":{"line":147,"column":16},"end":{"line":147,"column":58}},"68":{"start":{"line":148,"column":16},"end":{"line":150,"column":17}},"69":{"start":{"line":149,"column":20},"end":{"line":149,"column":33}},"70":{"start":{"line":151,"column":16},"end":{"line":151,"column":36}},"71":{"start":{"line":153,"column":12},"end":{"line":153,"column":25}},"72":{"start":{"line":154,"column":28},"end":{"line":154,"column":32}},"73":{"start":{"line":157,"column":8},"end":{"line":157,"column":36}},"74":{"start":{"line":159,"column":8},"end":{"line":159,"column":47}},"75":{"start":{"line":160,"column":8},"end":{"line":160,"column":36}},"76":{"start":{"line":161,"column":8},"end":{"line":161,"column":40}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":4},"end":{"line":13,"column":5}},"loc":{"start":{"line":13,"column":37},"end":{"line":20,"column":5}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":21,"column":4},"end":{"line":21,"column":5}},"loc":{"start":{"line":21,"column":39},"end":{"line":24,"column":5}},"line":21},"3":{"name":"(anonymous_3)","decl":{"start":{"line":25,"column":4},"end":{"line":25,"column":5}},"loc":{"start":{"line":25,"column":27},"end":{"line":28,"column":5}},"line":25},"4":{"name":"(anonymous_4)","decl":{"start":{"line":29,"column":4},"end":{"line":29,"column":5}},"loc":{"start":{"line":29,"column":32},"end":{"line":32,"column":5}},"line":29},"5":{"name":"(anonymous_5)","decl":{"start":{"line":33,"column":4},"end":{"line":33,"column":5}},"loc":{"start":{"line":33,"column":26},"end":{"line":41,"column":5}},"line":33},"6":{"name":"(anonymous_6)","decl":{"start":{"line":42,"column":4},"end":{"line":42,"column":5}},"loc":{"start":{"line":42,"column":39},"end":{"line":56,"column":5}},"line":42},"7":{"name":"(anonymous_7)","decl":{"start":{"line":57,"column":4},"end":{"line":57,"column":5}},"loc":{"start":{"line":57,"column":41},"end":{"line":76,"column":5}},"line":57},"8":{"name":"(anonymous_8)","decl":{"start":{"line":77,"column":4},"end":{"line":77,"column":5}},"loc":{"start":{"line":77,"column":37},"end":{"line":98,"column":5}},"line":77},"9":{"name":"(anonymous_9)","decl":{"start":{"line":99,"column":4},"end":{"line":99,"column":5}},"loc":{"start":{"line":99,"column":34},"end":{"line":102,"column":5}},"line":99},"10":{"name":"(anonymous_10)","decl":{"start":{"line":103,"column":4},"end":{"line":103,"column":5}},"loc":{"start":{"line":103,"column":36},"end":{"line":106,"column":5}},"line":103},"11":{"name":"(anonymous_11)","decl":{"start":{"line":107,"column":4},"end":{"line":107,"column":5}},"loc":{"start":{"line":107,"column":48},"end":{"line":128,"column":5}},"line":107},"12":{"name":"(anonymous_12)","decl":{"start":{"line":129,"column":4},"end":{"line":129,"column":5}},"loc":{"start":{"line":129,"column":77},"end":{"line":155,"column":5}},"line":129},"13":{"name":"(anonymous_13)","decl":{"start":{"line":130,"column":50},"end":{"line":130,"column":51}},"loc":{"start":{"line":130,"column":64},"end":{"line":154,"column":9}},"line":130},"14":{"name":"(anonymous_14)","decl":{"start":{"line":154,"column":20},"end":{"line":154,"column":21}},"loc":{"start":{"line":154,"column":28},"end":{"line":154,"column":32}},"line":154},"15":{"name":"(anonymous_15)","decl":{"start":{"line":156,"column":4},"end":{"line":156,"column":5}},"loc":{"start":{"line":156,"column":17},"end":{"line":162,"column":5}},"line":156}},"branchMap":{"0":{"loc":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"type":"if","locations":[{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},{"start":{"line":34,"column":8},"end":{"line":36,"column":9}}],"line":34},"1":{"loc":{"start":{"line":37,"column":8},"end":{"line":39,"column":9}},"type":"if","locations":[{"start":{"line":37,"column":8},"end":{"line":39,"column":9}},{"start":{"line":37,"column":8},"end":{"line":39,"column":9}}],"line":37},"2":{"loc":{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},"type":"if","locations":[{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},{"start":{"line":43,"column":8},"end":{"line":45,"column":9}}],"line":43},"3":{"loc":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"type":"if","locations":[{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},{"start":{"line":52,"column":8},"end":{"line":54,"column":9}}],"line":52},"4":{"loc":{"start":{"line":58,"column":8},"end":{"line":60,"column":9}},"type":"if","locations":[{"start":{"line":58,"column":8},"end":{"line":60,"column":9}},{"start":{"line":58,"column":8},"end":{"line":60,"column":9}}],"line":58},"5":{"loc":{"start":{"line":68,"column":8},"end":{"line":75,"column":9}},"type":"if","locations":[{"start":{"line":68,"column":8},"end":{"line":75,"column":9}},{"start":{"line":68,"column":8},"end":{"line":75,"column":9}}],"line":68},"6":{"loc":{"start":{"line":69,"column":12},"end":{"line":71,"column":13}},"type":"if","locations":[{"start":{"line":69,"column":12},"end":{"line":71,"column":13}},{"start":{"line":69,"column":12},"end":{"line":71,"column":13}}],"line":69},"7":{"loc":{"start":{"line":72,"column":12},"end":{"line":74,"column":13}},"type":"if","locations":[{"start":{"line":72,"column":12},"end":{"line":74,"column":13}},{"start":{"line":72,"column":12},"end":{"line":74,"column":13}}],"line":72},"8":{"loc":{"start":{"line":72,"column":16},"end":{"line":72,"column":69}},"type":"cond-expr","locations":[{"start":{"line":72,"column":51},"end":{"line":72,"column":57}},{"start":{"line":72,"column":60},"end":{"line":72,"column":69}}],"line":72},"9":{"loc":{"start":{"line":72,"column":16},"end":{"line":72,"column":48}},"type":"binary-expr","locations":[{"start":{"line":72,"column":16},"end":{"line":72,"column":29}},{"start":{"line":72,"column":33},"end":{"line":72,"column":48}}],"line":72},"10":{"loc":{"start":{"line":78,"column":8},"end":{"line":83,"column":9}},"type":"if","locations":[{"start":{"line":78,"column":8},"end":{"line":83,"column":9}},{"start":{"line":78,"column":8},"end":{"line":83,"column":9}}],"line":78},"11":{"loc":{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},"type":"if","locations":[{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},{"start":{"line":90,"column":8},"end":{"line":92,"column":9}}],"line":90},"12":{"loc":{"start":{"line":94,"column":8},"end":{"line":96,"column":9}},"type":"if","locations":[{"start":{"line":94,"column":8},"end":{"line":96,"column":9}},{"start":{"line":94,"column":8},"end":{"line":96,"column":9}}],"line":94},"13":{"loc":{"start":{"line":101,"column":15},"end":{"line":101,"column":67}},"type":"cond-expr","locations":[{"start":{"line":101,"column":50},"end":{"line":101,"column":56}},{"start":{"line":101,"column":59},"end":{"line":101,"column":67}}],"line":101},"14":{"loc":{"start":{"line":101,"column":15},"end":{"line":101,"column":47}},"type":"binary-expr","locations":[{"start":{"line":101,"column":15},"end":{"line":101,"column":28}},{"start":{"line":101,"column":32},"end":{"line":101,"column":47}}],"line":101},"15":{"loc":{"start":{"line":105,"column":15},"end":{"line":105,"column":72}},"type":"cond-expr","locations":[{"start":{"line":105,"column":50},"end":{"line":105,"column":56}},{"start":{"line":105,"column":59},"end":{"line":105,"column":72}}],"line":105},"16":{"loc":{"start":{"line":105,"column":15},"end":{"line":105,"column":47}},"type":"binary-expr","locations":[{"start":{"line":105,"column":15},"end":{"line":105,"column":28}},{"start":{"line":105,"column":32},"end":{"line":105,"column":47}}],"line":105},"17":{"loc":{"start":{"line":115,"column":8},"end":{"line":117,"column":9}},"type":"if","locations":[{"start":{"line":115,"column":8},"end":{"line":117,"column":9}},{"start":{"line":115,"column":8},"end":{"line":117,"column":9}}],"line":115},"18":{"loc":{"start":{"line":118,"column":21},"end":{"line":118,"column":162}},"type":"cond-expr","locations":[{"start":{"line":118,"column":49},"end":{"line":118,"column":103}},{"start":{"line":118,"column":106},"end":{"line":118,"column":162}}],"line":118},"19":{"loc":{"start":{"line":119,"column":8},"end":{"line":127,"column":9}},"type":"if","locations":[{"start":{"line":119,"column":8},"end":{"line":127,"column":9}},{"start":{"line":119,"column":8},"end":{"line":127,"column":9}}],"line":119},"20":{"loc":{"start":{"line":120,"column":12},"end":{"line":122,"column":13}},"type":"if","locations":[{"start":{"line":120,"column":12},"end":{"line":122,"column":13}},{"start":{"line":120,"column":12},"end":{"line":122,"column":13}}],"line":120},"21":{"loc":{"start":{"line":123,"column":12},"end":{"line":125,"column":13}},"type":"if","locations":[{"start":{"line":123,"column":12},"end":{"line":125,"column":13}},{"start":{"line":123,"column":12},"end":{"line":125,"column":13}}],"line":123},"22":{"loc":{"start":{"line":129,"column":53},"end":{"line":129,"column":75}},"type":"default-arg","locations":[{"start":{"line":129,"column":66},"end":{"line":129,"column":75}}],"line":129},"23":{"loc":{"start":{"line":131,"column":12},"end":{"line":133,"column":13}},"type":"if","locations":[{"start":{"line":131,"column":12},"end":{"line":133,"column":13}},{"start":{"line":131,"column":12},"end":{"line":133,"column":13}}],"line":131},"24":{"loc":{"start":{"line":134,"column":12},"end":{"line":139,"column":13}},"type":"if","locations":[{"start":{"line":134,"column":12},"end":{"line":139,"column":13}},{"start":{"line":134,"column":12},"end":{"line":139,"column":13}}],"line":134},"25":{"loc":{"start":{"line":136,"column":16},"end":{"line":138,"column":17}},"type":"if","locations":[{"start":{"line":136,"column":16},"end":{"line":138,"column":17}},{"start":{"line":136,"column":16},"end":{"line":138,"column":17}}],"line":136},"26":{"loc":{"start":{"line":146,"column":12},"end":{"line":152,"column":13}},"type":"if","locations":[{"start":{"line":146,"column":12},"end":{"line":152,"column":13}},{"start":{"line":146,"column":12},"end":{"line":152,"column":13}}],"line":146},"27":{"loc":{"start":{"line":148,"column":16},"end":{"line":150,"column":17}},"type":"if","locations":[{"start":{"line":148,"column":16},"end":{"line":150,"column":17}},{"start":{"line":148,"column":16},"end":{"line":150,"column":17}}],"line":148},"28":{"loc":{"start":{"line":148,"column":20},"end":{"line":148,"column":56}},"type":"binary-expr","locations":[{"start":{"line":148,"column":20},"end":{"line":148,"column":30}},{"start":{"line":148,"column":34},"end":{"line":148,"column":56}}],"line":148}},"s":{"0":4,"1":4,"2":47,"3":4,"4":4,"5":4,"6":4,"7":4,"8":0,"9":0,"10":7,"11":7,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":1,"20":1,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":2,"36":1,"37":1,"38":1,"39":1,"40":0,"41":0,"42":0,"43":0,"44":1,"45":1,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":2,"59":4,"60":0,"61":4,"62":4,"63":4,"64":4,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":4,"73":47,"74":47,"75":47,"76":47},"f":{"0":47,"1":4,"2":0,"3":7,"4":0,"5":0,"6":1,"7":0,"8":2,"9":1,"10":0,"11":0,"12":2,"13":4,"14":4,"15":47},"b":{"0":[0,0],"1":[0,0],"2":[1,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[1,1],"11":[1,0],"12":[0,0],"13":[0,1],"14":[1,1],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[2],"23":[0,4],"24":[4,0],"25":[4,0],"26":[0,0],"27":[0,0],"28":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/ConverterCache.ts"],"sourcesContent":["import type { IImportUser } from '@rocket.chat/core-typings';\nimport { Rooms, Users } from '@rocket.chat/models';\n\nexport type UserIdentification = {\n\t_id: string;\n\tusername: string | undefined;\n};\n\nexport type MentionedChannel = {\n\t_id: string;\n\tname: string;\n};\n\nexport class ConverterCache {\n\tprivate _userCache = new Map<string, UserIdentification>();\n\n\t// display name uses a different cache because it's only used on mentions so we don't need to load it every time we load an user\n\tprivate _userDisplayNameCache = new Map<string, string>();\n\n\tprivate _roomCache = new Map<string, string>();\n\n\tprivate _roomNameCache = new Map<string, string>();\n\n\taddUser(importId: string, _id: string, username: string | undefined): UserIdentification {\n\t\tconst cache = {\n\t\t\t_id,\n\t\t\tusername,\n\t\t};\n\n\t\tthis._userCache.set(importId, cache);\n\t\treturn cache;\n\t}\n\n\taddUserDisplayName(importId: string, name: string): string {\n\t\tthis._userDisplayNameCache.set(importId, name);\n\t\treturn name;\n\t}\n\n\taddRoom(importId: string, rid: string): string {\n\t\tthis._roomCache.set(importId, rid);\n\t\treturn rid;\n\t}\n\n\taddRoomName(importId: string, name: string): string {\n\t\tthis._roomNameCache.set(importId, name);\n\t\treturn name;\n\t}\n\n\taddUserData(userData: IImportUser): void {\n\t\tif (!userData._id) {\n\t\t\treturn;\n\t\t}\n\t\tif (!userData.importIds.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.addUser(userData.importIds[0], userData._id, userData.username);\n\t}\n\n\tasync findImportedRoomId(importId: string): Promise<string | null> {\n\t\tif (this._roomCache.has(importId)) {\n\t\t\treturn this._roomCache.get(importId) as string;\n\t\t}\n\n\t\tconst options = {\n\t\t\tprojection: {\n\t\t\t\t_id: 1,\n\t\t\t},\n\t\t};\n\n\t\tconst room = await Rooms.findOneByImportId(importId, options);\n\t\tif (room) {\n\t\t\treturn this.addRoom(importId, room._id);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tasync findImportedRoomName(importId: string): Promise<string | undefined> {\n\t\tif (this._roomNameCache.has(importId)) {\n\t\t\treturn this._roomNameCache.get(importId) as string;\n\t\t}\n\n\t\tconst options = {\n\t\t\tprojection: {\n\t\t\t\t_id: 1,\n\t\t\t\tname: 1,\n\t\t\t},\n\t\t};\n\n\t\tconst room = await Rooms.findOneByImportId(importId, options);\n\t\tif (room) {\n\t\t\tif (!this._roomCache.has(importId)) {\n\t\t\t\tthis.addRoom(importId, room._id);\n\t\t\t}\n\t\t\tif (room?.name) {\n\t\t\t\treturn this.addRoomName(importId, room.name);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync findImportedUser(importId: string): Promise<UserIdentification | null> {\n\t\tif (importId === 'rocket.cat') {\n\t\t\treturn {\n\t\t\t\t_id: 'rocket.cat',\n\t\t\t\tusername: 'rocket.cat',\n\t\t\t};\n\t\t}\n\n\t\tconst options = {\n\t\t\tprojection: {\n\t\t\t\t_id: 1,\n\t\t\t\tusername: 1,\n\t\t\t},\n\t\t};\n\n\t\tif (this._userCache.has(importId)) {\n\t\t\treturn this._userCache.get(importId) as UserIdentification;\n\t\t}\n\n\t\tconst user = await Users.findOneByImportId(importId, options);\n\t\tif (user) {\n\t\t\treturn this.addUser(importId, user._id, user.username);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tasync findImportedUserId(_id: string): Promise<string | undefined> {\n\t\tconst data = await this.findImportedUser(_id);\n\t\treturn data?._id;\n\t}\n\n\tasync findImportedUsername(_id: string): Promise<string | undefined> {\n\t\tconst data = await this.findImportedUser(_id);\n\t\treturn data?.username;\n\t}\n\n\tasync findImportedUserDisplayName(importId: string): Promise<string | undefined> {\n\t\tconst options = {\n\t\t\tprojection: {\n\t\t\t\t_id: 1,\n\t\t\t\tname: 1,\n\t\t\t\tusername: 1,\n\t\t\t},\n\t\t};\n\n\t\tif (this._userDisplayNameCache.has(importId)) {\n\t\t\treturn this._userDisplayNameCache.get(importId);\n\t\t}\n\n\t\tconst user =\n\t\t\timportId === 'rocket.cat' ? await Users.findOneById('rocket.cat', options) : await Users.findOneByImportId(importId, options);\n\t\tif (user) {\n\t\t\tif (!this._userCache.has(importId)) {\n\t\t\t\tthis.addUser(importId, user._id, user.username);\n\t\t\t}\n\n\t\t\tif (!user.name) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn this.addUserDisplayName(importId, user.name);\n\t\t}\n\t}\n\n\tasync convertImportedIdsToUsernames(importedIds: Array<string>, idToRemove: string | undefined = undefined): Promise<Array<string>> {\n\t\treturn (\n\t\t\tawait Promise.all(\n\t\t\t\timportedIds.map(async (user) => {\n\t\t\t\t\tif (user === 'rocket.cat') {\n\t\t\t\t\t\treturn user;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._userCache.has(user)) {\n\t\t\t\t\t\tconst cache = this._userCache.get(user);\n\t\t\t\t\t\tif (cache) {\n\t\t\t\t\t\t\treturn cache.username;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst obj = await Users.findOneByImportId(user, { projection: { _id: 1, username: 1 } });\n\t\t\t\t\tif (obj) {\n\t\t\t\t\t\tthis.addUser(user, obj._id, obj.username);\n\n\t\t\t\t\t\tif (idToRemove && obj._id === idToRemove) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn obj.username;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}),\n\t\t\t)\n\t\t).filter((user) => user) as string[];\n\t}\n}\n"],"names":["ConverterCache","addUser","importId","_id","username","cache","_userCache","set","addUserDisplayName","name","_userDisplayNameCache","addRoom","rid","_roomCache","addRoomName","_roomNameCache","addUserData","userData","importIds","length","findImportedRoomId","has","get","options","projection","room","Rooms","findOneByImportId","findImportedRoomName","findImportedUser","user","Users","findImportedUserId","data","findImportedUsername","findImportedUserDisplayName","findOneById","convertImportedIdsToUsernames","importedIds","idToRemove","undefined","Promise","all","map","obj","filter","Map"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/ConverterCache.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6f7fe4c55f011523ed2893cf5854e2cbf2a3bb36","contentHash":"35a340ade123a4ec448b49b3cc8bfacd77f06f11858aa18ac8edd891d932ae6b"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/RoomConverter.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/RoomConverter.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":29}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":29},"end":{"line":12,"column":71}},"5":{"start":{"line":13,"column":29},"end":{"line":13,"column":89}},"6":{"start":{"line":14,"column":26},"end":{"line":14,"column":97}},"7":{"start":{"line":15,"column":24},"end":{"line":15,"column":76}},"8":{"start":{"line":16,"column":23},"end":{"line":16,"column":78}},"9":{"start":{"line":17,"column":28},"end":{"line":17,"column":88}},"10":{"start":{"line":18,"column":25},"end":{"line":18,"column":53}},"11":{"start":{"line":20,"column":4},"end":{"line":22,"column":6}},"12":{"start":{"line":24,"column":20},"end":{"line":185,"column":1}},"13":{"start":{"line":26,"column":8},"end":{"line":26,"column":47}},"14":{"start":{"line":27,"column":8},"end":{"line":27,"column":43}},"15":{"start":{"line":30,"column":25},"end":{"line":30,"column":31}},"16":{"start":{"line":31,"column":8},"end":{"line":33,"column":9}},"17":{"start":{"line":32,"column":12},"end":{"line":32,"column":61}},"18":{"start":{"line":34,"column":8},"end":{"line":34,"column":61}},"19":{"start":{"line":34,"column":55},"end":{"line":34,"column":59}},"20":{"start":{"line":35,"column":8},"end":{"line":37,"column":10}},"21":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"22":{"start":{"line":39,"column":12},"end":{"line":39,"column":66}},"23":{"start":{"line":41,"column":29},"end":{"line":41,"column":62}},"24":{"start":{"line":42,"column":8},"end":{"line":42,"column":80}},"25":{"start":{"line":43,"column":8},"end":{"line":43,"column":29}},"26":{"start":{"line":46,"column":8},"end":{"line":50,"column":9}},"27":{"start":{"line":47,"column":12},"end":{"line":47,"column":71}},"28":{"start":{"line":49,"column":12},"end":{"line":49,"column":57}},"29":{"start":{"line":51,"column":8},"end":{"line":53,"column":9}},"30":{"start":{"line":52,"column":12},"end":{"line":52,"column":49}},"31":{"start":{"line":56,"column":8},"end":{"line":63,"column":9}},"32":{"start":{"line":57,"column":25},"end":{"line":57,"column":71}},"33":{"start":{"line":59,"column":12},"end":{"line":61,"column":13}},"34":{"start":{"line":60,"column":16},"end":{"line":60,"column":70}},"35":{"start":{"line":62,"column":12},"end":{"line":62,"column":24}},"36":{"start":{"line":64,"column":8},"end":{"line":70,"column":9}},"37":{"start":{"line":65,"column":26},"end":{"line":65,"column":85}},"38":{"start":{"line":66,"column":12},"end":{"line":68,"column":13}},"39":{"start":{"line":67,"column":16},"end":{"line":67,"column":66}},"40":{"start":{"line":69,"column":12},"end":{"line":69,"column":81}},"41":{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},"42":{"start":{"line":72,"column":12},"end":{"line":72,"column":24}},"43":{"start":{"line":75,"column":25},"end":{"line":77,"column":10}},"44":{"start":{"line":78,"column":8},"end":{"line":78,"column":69}},"45":{"start":{"line":81,"column":8},"end":{"line":81,"column":32}},"46":{"start":{"line":82,"column":8},"end":{"line":84,"column":9}},"47":{"start":{"line":83,"column":12},"end":{"line":83,"column":113}},"48":{"start":{"line":85,"column":8},"end":{"line":85,"column":52}},"49":{"start":{"line":89,"column":26},"end":{"line":89,"column":80}},"50":{"start":{"line":90,"column":24},"end":{"line":90,"column":131}},"51":{"start":{"line":91,"column":8},"end":{"line":96,"column":9}},"52":{"start":{"line":92,"column":12},"end":{"line":95,"column":13}},"53":{"start":{"line":93,"column":16},"end":{"line":93,"column":93}},"54":{"start":{"line":94,"column":16},"end":{"line":94,"column":66}},"55":{"start":{"line":98,"column":8},"end":{"line":125,"column":9}},"56":{"start":{"line":100,"column":12},"end":{"line":115,"column":13}},"57":{"start":{"line":101,"column":16},"end":{"line":101,"column":111}},"58":{"start":{"line":103,"column":16},"end":{"line":105,"column":17}},"59":{"start":{"line":104,"column":20},"end":{"line":104,"column":27}},"60":{"start":{"line":106,"column":16},"end":{"line":114,"column":17}},"61":{"start":{"line":107,"column":33},"end":{"line":107,"column":75}},"62":{"start":{"line":108,"column":20},"end":{"line":110,"column":21}},"63":{"start":{"line":109,"column":24},"end":{"line":109,"column":76}},"64":{"start":{"line":111,"column":20},"end":{"line":111,"column":132}},"65":{"start":{"line":113,"column":20},"end":{"line":113,"column":127}},"66":{"start":{"line":116,"column":12},"end":{"line":116,"column":40}},"67":{"start":{"line":118,"column":12},"end":{"line":122,"column":15}},"68":{"start":{"line":123,"column":12},"end":{"line":123,"column":34}},"69":{"start":{"line":124,"column":12},"end":{"line":124,"column":20}},"70":{"start":{"line":126,"column":8},"end":{"line":126,"column":56}},"71":{"start":{"line":130,"column":26},"end":{"line":133,"column":10}},"72":{"start":{"line":134,"column":8},"end":{"line":136,"column":9}},"73":{"start":{"line":135,"column":12},"end":{"line":135,"column":79}},"74":{"start":{"line":139,"column":20},"end":{"line":143,"column":9}},"75":{"start":{"line":144,"column":27},"end":{"line":144,"column":29}},"76":{"start":{"line":145,"column":8},"end":{"line":147,"column":9}},"77":{"start":{"line":146,"column":12},"end":{"line":146,"column":34}},"78":{"start":{"line":148,"column":8},"end":{"line":154,"column":9}},"79":{"start":{"line":149,"column":12},"end":{"line":153,"column":14}},"80":{"start":{"line":155,"column":8},"end":{"line":159,"column":9}},"81":{"start":{"line":156,"column":12},"end":{"line":158,"column":27}},"82":{"start":{"line":162,"column":8},"end":{"line":171,"column":9}},"83":{"start":{"line":163,"column":30},"end":{"line":163,"column":82}},"84":{"start":{"line":164,"column":12},"end":{"line":166,"column":13}},"85":{"start":{"line":165,"column":16},"end":{"line":165,"column":33}},"86":{"start":{"line":167,"column":12},"end":{"line":169,"column":13}},"87":{"start":{"line":168,"column":16},"end":{"line":168,"column":39}},"88":{"start":{"line":170,"column":12},"end":{"line":170,"column":64}},"89":{"start":{"line":172,"column":8},"end":{"line":179,"column":9}},"90":{"start":{"line":173,"column":12},"end":{"line":178,"column":13}},"91":{"start":{"line":174,"column":31},"end":{"line":174,"column":75}},"92":{"start":{"line":175,"column":16},"end":{"line":177,"column":17}},"93":{"start":{"line":176,"column":20},"end":{"line":176,"column":34}},"94":{"start":{"line":180,"column":8},"end":{"line":180,"column":60}},"95":{"start":{"line":183,"column":8},"end":{"line":183,"column":25}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":33}},"loc":{"start":{"line":19,"column":39},"end":{"line":23,"column":1}},"line":19},"2":{"name":"(anonymous_2)","decl":{"start":{"line":25,"column":4},"end":{"line":25,"column":5}},"loc":{"start":{"line":25,"column":59},"end":{"line":28,"column":5}},"line":25},"3":{"name":"(anonymous_3)","decl":{"start":{"line":29,"column":4},"end":{"line":29,"column":5}},"loc":{"start":{"line":29,"column":32},"end":{"line":44,"column":5}},"line":29},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":47},"end":{"line":34,"column":48}},"loc":{"start":{"line":34,"column":55},"end":{"line":34,"column":59}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":45,"column":4},"end":{"line":45,"column":5}},"loc":{"start":{"line":45,"column":66},"end":{"line":54,"column":5}},"line":45},"6":{"name":"(anonymous_6)","decl":{"start":{"line":55,"column":4},"end":{"line":55,"column":5}},"loc":{"start":{"line":55,"column":33},"end":{"line":79,"column":5}},"line":55},"7":{"name":"(anonymous_7)","decl":{"start":{"line":80,"column":4},"end":{"line":80,"column":5}},"loc":{"start":{"line":80,"column":54},"end":{"line":86,"column":5}},"line":80},"8":{"name":"(anonymous_8)","decl":{"start":{"line":87,"column":4},"end":{"line":87,"column":5}},"loc":{"start":{"line":87,"column":48},"end":{"line":127,"column":5}},"line":87},"9":{"name":"(anonymous_9)","decl":{"start":{"line":128,"column":4},"end":{"line":128,"column":5}},"loc":{"start":{"line":128,"column":31},"end":{"line":137,"column":5}},"line":128},"10":{"name":"(anonymous_10)","decl":{"start":{"line":138,"column":4},"end":{"line":138,"column":5}},"loc":{"start":{"line":138,"column":38},"end":{"line":160,"column":5}},"line":138},"11":{"name":"(anonymous_11)","decl":{"start":{"line":161,"column":4},"end":{"line":161,"column":5}},"loc":{"start":{"line":161,"column":54},"end":{"line":181,"column":5}},"line":161},"12":{"name":"(anonymous_12)","decl":{"start":{"line":182,"column":4},"end":{"line":182,"column":5}},"loc":{"start":{"line":182,"column":18},"end":{"line":184,"column":5}},"line":182}},"branchMap":{"0":{"loc":{"start":{"line":20,"column":11},"end":{"line":22,"column":5}},"type":"cond-expr","locations":[{"start":{"line":20,"column":35},"end":{"line":20,"column":38}},{"start":{"line":20,"column":41},"end":{"line":22,"column":5}}],"line":20},"1":{"loc":{"start":{"line":20,"column":11},"end":{"line":20,"column":32}},"type":"binary-expr","locations":[{"start":{"line":20,"column":11},"end":{"line":20,"column":14}},{"start":{"line":20,"column":18},"end":{"line":20,"column":32}}],"line":20},"2":{"loc":{"start":{"line":25,"column":43},"end":{"line":25,"column":57}},"type":"default-arg","locations":[{"start":{"line":25,"column":55},"end":{"line":25,"column":57}}],"line":25},"3":{"loc":{"start":{"line":31,"column":8},"end":{"line":33,"column":9}},"type":"if","locations":[{"start":{"line":31,"column":8},"end":{"line":33,"column":9}},{"start":{"line":31,"column":8},"end":{"line":33,"column":9}}],"line":31},"4":{"loc":{"start":{"line":31,"column":12},"end":{"line":31,"column":40}},"type":"binary-expr","locations":[{"start":{"line":31,"column":12},"end":{"line":31,"column":22}},{"start":{"line":31,"column":26},"end":{"line":31,"column":40}}],"line":31},"5":{"loc":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"type":"if","locations":[{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},{"start":{"line":38,"column":8},"end":{"line":40,"column":9}}],"line":38},"6":{"loc":{"start":{"line":46,"column":8},"end":{"line":50,"column":9}},"type":"if","locations":[{"start":{"line":46,"column":8},"end":{"line":50,"column":9}},{"start":{"line":46,"column":8},"end":{"line":50,"column":9}}],"line":46},"7":{"loc":{"start":{"line":51,"column":8},"end":{"line":53,"column":9}},"type":"if","locations":[{"start":{"line":51,"column":8},"end":{"line":53,"column":9}},{"start":{"line":51,"column":8},"end":{"line":53,"column":9}}],"line":51},"8":{"loc":{"start":{"line":51,"column":12},"end":{"line":51,"column":37}},"type":"binary-expr","locations":[{"start":{"line":51,"column":12},"end":{"line":51,"column":25}},{"start":{"line":51,"column":29},"end":{"line":51,"column":37}}],"line":51},"9":{"loc":{"start":{"line":56,"column":8},"end":{"line":63,"column":9}},"type":"if","locations":[{"start":{"line":56,"column":8},"end":{"line":63,"column":9}},{"start":{"line":56,"column":8},"end":{"line":63,"column":9}}],"line":56},"10":{"loc":{"start":{"line":56,"column":12},"end":{"line":56,"column":60}},"type":"binary-expr","locations":[{"start":{"line":56,"column":12},"end":{"line":56,"column":20}},{"start":{"line":56,"column":24},"end":{"line":56,"column":60}}],"line":56},"11":{"loc":{"start":{"line":59,"column":12},"end":{"line":61,"column":13}},"type":"if","locations":[{"start":{"line":59,"column":12},"end":{"line":61,"column":13}},{"start":{"line":59,"column":12},"end":{"line":61,"column":13}}],"line":59},"12":{"loc":{"start":{"line":64,"column":8},"end":{"line":70,"column":9}},"type":"if","locations":[{"start":{"line":64,"column":8},"end":{"line":70,"column":9}},{"start":{"line":64,"column":8},"end":{"line":70,"column":9}}],"line":64},"13":{"loc":{"start":{"line":66,"column":12},"end":{"line":68,"column":13}},"type":"if","locations":[{"start":{"line":66,"column":12},"end":{"line":68,"column":13}},{"start":{"line":66,"column":12},"end":{"line":68,"column":13}}],"line":66},"14":{"loc":{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},"type":"if","locations":[{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},{"start":{"line":71,"column":8},"end":{"line":73,"column":9}}],"line":71},"15":{"loc":{"start":{"line":82,"column":8},"end":{"line":84,"column":9}},"type":"if","locations":[{"start":{"line":82,"column":8},"end":{"line":84,"column":9}},{"start":{"line":82,"column":8},"end":{"line":84,"column":9}}],"line":82},"16":{"loc":{"start":{"line":82,"column":12},"end":{"line":82,"column":83}},"type":"binary-expr","locations":[{"start":{"line":82,"column":12},"end":{"line":82,"column":52}},{"start":{"line":82,"column":56},"end":{"line":82,"column":83}}],"line":82},"17":{"loc":{"start":{"line":90,"column":88},"end":{"line":90,"column":130}},"type":"cond-expr","locations":[{"start":{"line":90,"column":109},"end":{"line":90,"column":118}},{"start":{"line":90,"column":121},"end":{"line":90,"column":130}}],"line":90},"18":{"loc":{"start":{"line":91,"column":8},"end":{"line":96,"column":9}},"type":"if","locations":[{"start":{"line":91,"column":8},"end":{"line":96,"column":9}},{"start":{"line":91,"column":8},"end":{"line":96,"column":9}}],"line":91},"19":{"loc":{"start":{"line":92,"column":12},"end":{"line":95,"column":13}},"type":"if","locations":[{"start":{"line":92,"column":12},"end":{"line":95,"column":13}},{"start":{"line":92,"column":12},"end":{"line":95,"column":13}}],"line":92},"20":{"loc":{"start":{"line":100,"column":12},"end":{"line":115,"column":13}},"type":"if","locations":[{"start":{"line":100,"column":12},"end":{"line":115,"column":13}},{"start":{"line":100,"column":12},"end":{"line":115,"column":13}}],"line":100},"21":{"loc":{"start":{"line":103,"column":16},"end":{"line":105,"column":17}},"type":"if","locations":[{"start":{"line":103,"column":16},"end":{"line":105,"column":17}},{"start":{"line":103,"column":16},"end":{"line":105,"column":17}}],"line":103},"22":{"loc":{"start":{"line":106,"column":16},"end":{"line":114,"column":17}},"type":"if","locations":[{"start":{"line":106,"column":16},"end":{"line":114,"column":17}},{"start":{"line":106,"column":16},"end":{"line":114,"column":17}}],"line":106},"23":{"loc":{"start":{"line":108,"column":20},"end":{"line":110,"column":21}},"type":"if","locations":[{"start":{"line":108,"column":20},"end":{"line":110,"column":21}},{"start":{"line":108,"column":20},"end":{"line":110,"column":21}}],"line":108},"24":{"loc":{"start":{"line":134,"column":8},"end":{"line":136,"column":9}},"type":"if","locations":[{"start":{"line":134,"column":8},"end":{"line":136,"column":9}},{"start":{"line":134,"column":8},"end":{"line":136,"column":9}}],"line":134},"25":{"loc":{"start":{"line":134,"column":12},"end":{"line":134,"column":112}},"type":"cond-expr","locations":[{"start":{"line":134,"column":78},"end":{"line":134,"column":84}},{"start":{"line":134,"column":87},"end":{"line":134,"column":112}}],"line":134},"26":{"loc":{"start":{"line":134,"column":12},"end":{"line":134,"column":75}},"type":"binary-expr","locations":[{"start":{"line":134,"column":12},"end":{"line":134,"column":49}},{"start":{"line":134,"column":53},"end":{"line":134,"column":75}}],"line":134},"27":{"loc":{"start":{"line":145,"column":8},"end":{"line":147,"column":9}},"type":"if","locations":[{"start":{"line":145,"column":8},"end":{"line":147,"column":9}},{"start":{"line":145,"column":8},"end":{"line":147,"column":9}}],"line":145},"28":{"loc":{"start":{"line":148,"column":8},"end":{"line":154,"column":9}},"type":"if","locations":[{"start":{"line":148,"column":8},"end":{"line":154,"column":9}},{"start":{"line":148,"column":8},"end":{"line":154,"column":9}}],"line":148},"29":{"loc":{"start":{"line":155,"column":8},"end":{"line":159,"column":9}},"type":"if","locations":[{"start":{"line":155,"column":8},"end":{"line":159,"column":9}},{"start":{"line":155,"column":8},"end":{"line":159,"column":9}}],"line":155},"30":{"loc":{"start":{"line":155,"column":12},"end":{"line":155,"column":51}},"type":"binary-expr","locations":[{"start":{"line":155,"column":12},"end":{"line":155,"column":27}},{"start":{"line":155,"column":31},"end":{"line":155,"column":51}}],"line":155},"31":{"loc":{"start":{"line":162,"column":8},"end":{"line":171,"column":9}},"type":"if","locations":[{"start":{"line":162,"column":8},"end":{"line":171,"column":9}},{"start":{"line":162,"column":8},"end":{"line":171,"column":9}}],"line":162},"32":{"loc":{"start":{"line":164,"column":12},"end":{"line":166,"column":13}},"type":"if","locations":[{"start":{"line":164,"column":12},"end":{"line":166,"column":13}},{"start":{"line":164,"column":12},"end":{"line":166,"column":13}}],"line":164},"33":{"loc":{"start":{"line":167,"column":12},"end":{"line":169,"column":13}},"type":"if","locations":[{"start":{"line":167,"column":12},"end":{"line":169,"column":13}},{"start":{"line":167,"column":12},"end":{"line":169,"column":13}}],"line":167},"34":{"loc":{"start":{"line":172,"column":8},"end":{"line":179,"column":9}},"type":"if","locations":[{"start":{"line":172,"column":8},"end":{"line":179,"column":9}},{"start":{"line":172,"column":8},"end":{"line":179,"column":9}}],"line":172},"35":{"loc":{"start":{"line":175,"column":16},"end":{"line":177,"column":17}},"type":"if","locations":[{"start":{"line":175,"column":16},"end":{"line":177,"column":17}},{"start":{"line":175,"column":16},"end":{"line":177,"column":17}}],"line":175}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":8,"14":8,"15":6,"16":6,"17":1,"18":5,"19":5,"20":5,"21":5,"22":0,"23":5,"24":5,"25":5,"26":2,"27":1,"28":1,"29":2,"30":0,"31":3,"32":0,"33":0,"34":0,"35":0,"36":3,"37":1,"38":1,"39":0,"40":1,"41":2,"42":1,"43":1,"44":1,"45":0,"46":0,"47":0,"48":0,"49":1,"50":1,"51":1,"52":1,"53":0,"54":0,"55":1,"56":1,"57":1,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":1,"67":0,"68":0,"69":0,"70":1,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":1,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":1,"90":1,"91":1,"92":1,"93":1,"94":0,"95":8},"f":{"0":1,"1":1,"2":8,"3":6,"4":5,"5":2,"6":3,"7":0,"8":1,"9":0,"10":0,"11":1,"12":8},"b":{"0":[0,1],"1":[1,1],"2":[3],"3":[1,5],"4":[6,1],"5":[0,5],"6":[1,1],"7":[0,2],"8":[2,0],"9":[0,3],"10":[3,0],"11":[0,0],"12":[1,2],"13":[0,1],"14":[1,1],"15":[0,0],"16":[0,0],"17":[0,1],"18":[1,0],"19":[0,1],"20":[1,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,1],"32":[0,0],"33":[0,0],"34":[1,0],"35":[1,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/RoomConverter.ts"],"sourcesContent":["import type { IImportChannel, IImportChannelRecord, IRoom } from '@rocket.chat/core-typings';\nimport { Subscriptions, Rooms, Users } from '@rocket.chat/models';\nimport limax from 'limax';\n\nimport { createDirectMessage } from '../../../../../server/methods/createDirectMessage';\nimport { saveRoomSettings } from '../../../../channel-settings/server/methods/saveRoomSettings';\nimport { notifyOnSubscriptionChangedByRoomId } from '../../../../lib/server/lib/notifyListener';\nimport { createChannelMethod } from '../../../../lib/server/methods/createChannel';\nimport { createPrivateGroupMethod } from '../../../../lib/server/methods/createPrivateGroup';\nimport type { IConversionCallbacks } from '../../definitions/IConversionCallbacks';\nimport { RecordConverter } from './RecordConverter';\n\nexport class RoomConverter extends RecordConverter<IImportChannelRecord> {\n\tpublic startedByUserId: string;\n\n\tasync convertChannels(startedByUserId: string, callbacks: IConversionCallbacks = {}): Promise<void> {\n\t\tthis.startedByUserId = startedByUserId;\n\n\t\treturn this.convertData(callbacks);\n\t}\n\n\tprotected async convertRecord(record: IImportChannelRecord): Promise<boolean> {\n\t\tconst { data } = record;\n\n\t\tif (!data.name && data.t !== 'd') {\n\t\t\tthrow new Error('importer-channel-missing-name');\n\t\t}\n\n\t\tdata.importIds = data.importIds.filter((item) => item);\n\t\tdata.users = [...new Set(data.users)];\n\n\t\tif (!data.importIds.length) {\n\t\t\tthrow new Error('importer-channel-missing-import-id');\n\t\t}\n\n\t\tconst existingRoom = await this.findExistingRoom(data);\n\t\tawait this.insertOrUpdateRoom(existingRoom, data, this.startedByUserId);\n\n\t\treturn !existingRoom;\n\t}\n\n\tasync insertOrUpdateRoom(existingRoom: IRoom | null, data: IImportChannel, startedByUserId: string): Promise<void> {\n\t\tif (existingRoom) {\n\t\t\tawait this.updateRoom(existingRoom, data, startedByUserId);\n\t\t} else {\n\t\t\tawait this.insertRoom(data, startedByUserId);\n\t\t}\n\n\t\tif (data.archived && data._id) {\n\t\t\tawait this.archiveRoomById(data._id);\n\t\t}\n\t}\n\n\tasync findExistingRoom(data: IImportChannel): Promise<IRoom | null> {\n\t\tif (data._id && data._id.toUpperCase() === 'GENERAL') {\n\t\t\tconst room = await Rooms.findOneById('GENERAL', {});\n\t\t\t// Prevent the importer from trying to create a new general\n\t\t\tif (!room) {\n\t\t\t\tthrow new Error('importer-channel-general-not-found');\n\t\t\t}\n\n\t\t\treturn room;\n\t\t}\n\n\t\tif (data.t === 'd') {\n\t\t\tconst users = await this._cache.convertImportedIdsToUsernames(data.users);\n\t\t\tif (users.length !== data.users.length) {\n\t\t\t\tthrow new Error('importer-channel-missing-users');\n\t\t\t}\n\n\t\t\treturn Rooms.findDirectRoomContainingAllUsernames(users, {});\n\t\t}\n\n\t\tif (!data.name) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Imported room names always allow special chars\n\t\tconst roomName = limax(data.name.trim(), { maintainCase: true });\n\t\treturn Rooms.findOneByNonValidatedName(roomName, {});\n\t}\n\n\tasync updateRoom(room: IRoom, roomData: IImportChannel, startedByUserId: string): Promise<void> {\n\t\troomData._id = room._id;\n\n\t\tif ((roomData._id as string).toUpperCase() === 'GENERAL' && roomData.name !== room.name) {\n\t\t\tawait saveRoomSettings(startedByUserId, 'GENERAL', 'roomName', roomData.name);\n\t\t}\n\n\t\tawait this.updateRoomId(room._id, roomData);\n\t}\n\n\tasync insertRoom(roomData: IImportChannel, startedByUserId: string): Promise<void> {\n\t\t// Find the rocketchatId of the user who created this channel\n\t\tconst creatorId = await this.getRoomCreatorId(roomData, startedByUserId);\n\t\tconst members = await this._cache.convertImportedIdsToUsernames(roomData.users, roomData.t !== 'd' ? creatorId : undefined);\n\n\t\tif (roomData.t === 'd') {\n\t\t\tif (members.length < roomData.users.length) {\n\t\t\t\tthis._logger.warn(`One or more imported users not found: ${roomData.users}`);\n\t\t\t\tthrow new Error('importer-channel-missing-users');\n\t\t\t}\n\t\t}\n\n\t\t// Create the channel\n\t\ttry {\n\t\t\tlet roomInfo;\n\t\t\tif (roomData.t === 'd') {\n\t\t\t\troomInfo = await createDirectMessage(members, startedByUserId, true);\n\t\t\t} else {\n\t\t\t\tif (!roomData.name) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (roomData.t === 'p') {\n\t\t\t\t\tconst user = await Users.findOneById(creatorId);\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\tthrow new Error('importer-channel-invalid-creator');\n\t\t\t\t\t}\n\t\t\t\t\troomInfo = await createPrivateGroupMethod(user, roomData.name, members, false, {}, {});\n\t\t\t\t} else {\n\t\t\t\t\troomInfo = await createChannelMethod(creatorId, roomData.name, members, false, {}, {});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\troomData._id = roomInfo.rid;\n\t\t} catch (e) {\n\t\t\tthis._logger.warn({ msg: 'Failed to create new room', name: roomData.name, members });\n\t\t\tthis._logger.error(e);\n\t\t\tthrow e;\n\t\t}\n\n\t\tawait this.updateRoomId(roomData._id as 'string', roomData);\n\t}\n\n\tasync archiveRoomById(rid: string) {\n\t\tconst responses = await Promise.all([Rooms.archiveById(rid), Subscriptions.archiveByRoomId(rid)]);\n\n\t\tif (responses[1]?.modifiedCount) {\n\t\t\tvoid notifyOnSubscriptionChangedByRoomId(rid);\n\t\t}\n\t}\n\n\tasync updateRoomId(_id: string, roomData: IImportChannel): Promise<void> {\n\t\tconst set = {\n\t\t\tts: roomData.ts,\n\t\t\ttopic: roomData.topic,\n\t\t\tdescription: roomData.description,\n\t\t};\n\n\t\tconst roomUpdate: { $set?: Record<string, any>; $addToSet?: Record<string, any> } = {};\n\n\t\tif (Object.keys(set).length > 0) {\n\t\t\troomUpdate.$set = set;\n\t\t}\n\n\t\tif (roomData.importIds.length) {\n\t\t\troomUpdate.$addToSet = {\n\t\t\t\timportIds: {\n\t\t\t\t\t$each: roomData.importIds,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tif (roomUpdate.$set || roomUpdate.$addToSet) {\n\t\t\tawait Rooms.updateOne({ _id: roomData._id }, roomUpdate);\n\t\t}\n\t}\n\n\tasync getRoomCreatorId(roomData: IImportChannel, startedByUserId: string): Promise<string> {\n\t\tif (roomData.u) {\n\t\t\tconst creatorId = await this._cache.findImportedUserId(roomData.u._id);\n\t\t\tif (creatorId) {\n\t\t\t\treturn creatorId;\n\t\t\t}\n\n\t\t\tif (roomData.t !== 'd') {\n\t\t\t\treturn startedByUserId;\n\t\t\t}\n\n\t\t\tthrow new Error('importer-channel-invalid-creator');\n\t\t}\n\n\t\tif (roomData.t === 'd') {\n\t\t\tfor await (const member of roomData.users) {\n\t\t\t\tconst userId = await this._cache.findImportedUserId(member);\n\t\t\t\tif (userId) {\n\t\t\t\t\treturn userId;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error('importer-channel-invalid-creator');\n\t}\n\n\tprotected getDataType(): 'channel' {\n\t\treturn 'channel';\n\t}\n}\n"],"names":["RoomConverter","RecordConverter","convertChannels","startedByUserId","callbacks","convertData","convertRecord","record","data","name","t","Error","importIds","filter","item","users","Set","length","existingRoom","findExistingRoom","insertOrUpdateRoom","updateRoom","insertRoom","archived","_id","archiveRoomById","toUpperCase","room","Rooms","findOneById","_cache","convertImportedIdsToUsernames","findDirectRoomContainingAllUsernames","roomName","limax","trim","maintainCase","findOneByNonValidatedName","roomData","saveRoomSettings","updateRoomId","creatorId","getRoomCreatorId","members","undefined","_logger","warn","roomInfo","createDirectMessage","user","Users","createPrivateGroupMethod","createChannelMethod","rid","e","msg","error","responses","Promise","all","archiveById","Subscriptions","archiveByRoomId","modifiedCount","notifyOnSubscriptionChangedByRoomId","set","ts","topic","description","roomUpdate","Object","keys","$set","$addToSet","$each","updateOne","u","findImportedUserId","member","userId","getDataType"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/RoomConverter.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d2c7fbc000756137c629ca49cb9bb552bd7272e3","contentHash":"5ece4da93dfa04b6a539b033db72067bd8326613340a1d66a89ab373bc987d02"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/UserConverter.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/UserConverter.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":29}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":46}},"5":{"start":{"line":13,"column":16},"end":{"line":13,"column":46}},"6":{"start":{"line":14,"column":16},"end":{"line":14,"column":33}},"7":{"start":{"line":15,"column":22},"end":{"line":15,"column":53}},"8":{"start":{"line":16,"column":19},"end":{"line":16,"column":58}},"9":{"start":{"line":17,"column":34},"end":{"line":17,"column":102}},"10":{"start":{"line":18,"column":31},"end":{"line":18,"column":96}},"11":{"start":{"line":19,"column":26},"end":{"line":19,"column":86}},"12":{"start":{"line":20,"column":29},"end":{"line":20,"column":92}},"13":{"start":{"line":21,"column":24},"end":{"line":21,"column":76}},"14":{"start":{"line":22,"column":25},"end":{"line":22,"column":53}},"15":{"start":{"line":23,"column":20},"end":{"line":413,"column":1}},"16":{"start":{"line":25,"column":30},"end":{"line":25,"column":36}},"17":{"start":{"line":26,"column":8},"end":{"line":26,"column":61}},"18":{"start":{"line":26,"column":55},"end":{"line":26,"column":59}},"19":{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},"20":{"start":{"line":28,"column":12},"end":{"line":28,"column":72}},"21":{"start":{"line":30,"column":29},"end":{"line":30,"column":62}},"22":{"start":{"line":31,"column":8},"end":{"line":34,"column":9}},"23":{"start":{"line":32,"column":12},"end":{"line":32,"column":39}},"24":{"start":{"line":33,"column":12},"end":{"line":33,"column":19}},"25":{"start":{"line":35,"column":8},"end":{"line":38,"column":9}},"26":{"start":{"line":36,"column":12},"end":{"line":36,"column":39}},"27":{"start":{"line":37,"column":12},"end":{"line":37,"column":19}},"28":{"start":{"line":39,"column":8},"end":{"line":39,"column":58}},"29":{"start":{"line":40,"column":8},"end":{"line":40,"column":29}},"30":{"start":{"line":43,"column":8},"end":{"line":43,"column":33}},"31":{"start":{"line":44,"column":8},"end":{"line":44,"column":32}},"32":{"start":{"line":45,"column":8},"end":{"line":49,"column":9}},"33":{"start":{"line":46,"column":12},"end":{"line":46,"column":54}},"34":{"start":{"line":48,"column":12},"end":{"line":48,"column":51}},"35":{"start":{"line":50,"column":8},"end":{"line":59,"column":11}},"36":{"start":{"line":62,"column":30},"end":{"line":62,"column":39}},"37":{"start":{"line":63,"column":8},"end":{"line":84,"column":11}},"38":{"start":{"line":66,"column":33},"end":{"line":66,"column":39}},"39":{"start":{"line":67,"column":16},"end":{"line":67,"column":69}},"40":{"start":{"line":67,"column":63},"end":{"line":67,"column":67}},"41":{"start":{"line":68,"column":16},"end":{"line":70,"column":17}},"42":{"start":{"line":69,"column":20},"end":{"line":69,"column":80}},"43":{"start":{"line":71,"column":16},"end":{"line":71,"column":40}},"44":{"start":{"line":72,"column":16},"end":{"line":81,"column":17}},"45":{"start":{"line":73,"column":42},"end":{"line":75,"column":22}},"46":{"start":{"line":76,"column":20},"end":{"line":76,"column":42}},"47":{"start":{"line":77,"column":35},"end":{"line":79,"column":22}},"48":{"start":{"line":80,"column":20},"end":{"line":80,"column":67}},"49":{"start":{"line":80,"column":41},"end":{"line":80,"column":65}},"50":{"start":{"line":82,"column":16},"end":{"line":82,"column":33}},"51":{"start":{"line":85,"column":8},"end":{"line":93,"column":9}},"52":{"start":{"line":86,"column":34},"end":{"line":88,"column":14}},"53":{"start":{"line":89,"column":27},"end":{"line":91,"column":14}},"54":{"start":{"line":92,"column":12},"end":{"line":92,"column":59}},"55":{"start":{"line":92,"column":33},"end":{"line":92,"column":57}},"56":{"start":{"line":96,"column":21},"end":{"line":96,"column":25}},"57":{"start":{"line":97,"column":8},"end":{"line":111,"column":9}},"58":{"start":{"line":98,"column":12},"end":{"line":100,"column":29}},"59":{"start":{"line":101,"column":12},"end":{"line":103,"column":13}},"60":{"start":{"line":102,"column":16},"end":{"line":102,"column":53}},"61":{"start":{"line":106,"column":12},"end":{"line":106,"column":214}},"62":{"start":{"line":107,"column":31},"end":{"line":107,"column":243}},"63":{"start":{"line":108,"column":12},"end":{"line":110,"column":13}},"64":{"start":{"line":109,"column":16},"end":{"line":109,"column":99}},"65":{"start":{"line":112,"column":8},"end":{"line":112,"column":22}},"66":{"start":{"line":115,"column":8},"end":{"line":120,"column":9}},"67":{"start":{"line":116,"column":30},"end":{"line":116,"column":91}},"68":{"start":{"line":117,"column":12},"end":{"line":119,"column":13}},"69":{"start":{"line":118,"column":16},"end":{"line":118,"column":33}},"70":{"start":{"line":122,"column":8},"end":{"line":124,"column":9}},"71":{"start":{"line":123,"column":12},"end":{"line":123,"column":82}},"72":{"start":{"line":128,"column":8},"end":{"line":134,"column":9}},"73":{"start":{"line":129,"column":12},"end":{"line":133,"column":14}},"74":{"start":{"line":138,"column":8},"end":{"line":140,"column":9}},"75":{"start":{"line":139,"column":12},"end":{"line":139,"column":19}},"76":{"start":{"line":141,"column":29},"end":{"line":141,"column":72}},"77":{"start":{"line":142,"column":29},"end":{"line":142,"column":31}},"78":{"start":{"line":143,"column":8},"end":{"line":150,"column":9}},"79":{"start":{"line":145,"column":29},"end":{"line":145,"column":213}},"80":{"start":{"line":145,"column":96},"end":{"line":145,"column":116}},"81":{"start":{"line":146,"column":12},"end":{"line":149,"column":15}},"82":{"start":{"line":151,"column":8},"end":{"line":151,"column":46}},"83":{"start":{"line":154,"column":8},"end":{"line":156,"column":9}},"84":{"start":{"line":155,"column":12},"end":{"line":155,"column":19}},"85":{"start":{"line":157,"column":8},"end":{"line":168,"column":9}},"86":{"start":{"line":158,"column":12},"end":{"line":160,"column":13}},"87":{"start":{"line":159,"column":16},"end":{"line":159,"column":25}},"88":{"start":{"line":161,"column":28},"end":{"line":161,"column":57}},"89":{"start":{"line":162,"column":12},"end":{"line":167,"column":13}},"90":{"start":{"line":163,"column":16},"end":{"line":165,"column":17}},"91":{"start":{"line":164,"column":20},"end":{"line":164,"column":29}},"92":{"start":{"line":166,"column":16},"end":{"line":166,"column":80}},"93":{"start":{"line":171,"column":8},"end":{"line":173,"column":9}},"94":{"start":{"line":172,"column":12},"end":{"line":172,"column":19}},"95":{"start":{"line":174,"column":23},"end":{"line":191,"column":9}},"96":{"start":{"line":175,"column":12},"end":{"line":190,"column":13}},"97":{"start":{"line":176,"column":16},"end":{"line":178,"column":17}},"98":{"start":{"line":177,"column":20},"end":{"line":177,"column":29}},"99":{"start":{"line":179,"column":32},"end":{"line":179,"column":55}},"100":{"start":{"line":180,"column":16},"end":{"line":183,"column":17}},"101":{"start":{"line":181,"column":20},"end":{"line":181,"column":49}},"102":{"start":{"line":182,"column":20},"end":{"line":182,"column":29}},"103":{"start":{"line":184,"column":16},"end":{"line":189,"column":18}},"104":{"start":{"line":192,"column":8},"end":{"line":192,"column":54}},"105":{"start":{"line":195,"column":8},"end":{"line":203,"column":9}},"106":{"start":{"line":196,"column":27},"end":{"line":198,"column":19}},"107":{"start":{"line":196,"column":69},"end":{"line":198,"column":17}},"108":{"start":{"line":199,"column":12},"end":{"line":202,"column":15}},"109":{"start":{"line":204,"column":8},"end":{"line":221,"column":9}},"110":{"start":{"line":205,"column":12},"end":{"line":205,"column":54}},"111":{"start":{"line":206,"column":12},"end":{"line":206,"column":50}},"112":{"start":{"line":208,"column":12},"end":{"line":210,"column":13}},"113":{"start":{"line":209,"column":16},"end":{"line":209,"column":70}},"114":{"start":{"line":211,"column":27},"end":{"line":211,"column":54}},"115":{"start":{"line":212,"column":12},"end":{"line":212,"column":30}},"116":{"start":{"line":213,"column":12},"end":{"line":213,"column":41}},"117":{"start":{"line":214,"column":12},"end":{"line":220,"column":13}},"118":{"start":{"line":215,"column":37},"end":{"line":215,"column":80}},"119":{"start":{"line":216,"column":16},"end":{"line":218,"column":17}},"120":{"start":{"line":217,"column":20},"end":{"line":217,"column":65}},"121":{"start":{"line":219,"column":16},"end":{"line":219,"column":98}},"122":{"start":{"line":225,"column":24},"end":{"line":225,"column":36}},"123":{"start":{"line":226,"column":8},"end":{"line":228,"column":9}},"124":{"start":{"line":227,"column":12},"end":{"line":227,"column":19}},"125":{"start":{"line":229,"column":8},"end":{"line":229,"column":27}},"126":{"start":{"line":230,"column":8},"end":{"line":234,"column":9}},"127":{"start":{"line":231,"column":12},"end":{"line":233,"column":14}},"128":{"start":{"line":235,"column":8},"end":{"line":237,"column":9}},"129":{"start":{"line":236,"column":12},"end":{"line":236,"column":35}},"130":{"start":{"line":238,"column":27},"end":{"line":259,"column":10}},"131":{"start":{"line":260,"column":8},"end":{"line":260,"column":51}},"132":{"start":{"line":261,"column":8},"end":{"line":261,"column":51}},"133":{"start":{"line":262,"column":8},"end":{"line":262,"column":51}},"134":{"start":{"line":263,"column":8},"end":{"line":263,"column":76}},"135":{"start":{"line":264,"column":8},"end":{"line":266,"column":9}},"136":{"start":{"line":265,"column":12},"end":{"line":265,"column":35}},"137":{"start":{"line":267,"column":8},"end":{"line":271,"column":9}},"138":{"start":{"line":268,"column":12},"end":{"line":270,"column":27}},"139":{"start":{"line":272,"column":8},"end":{"line":274,"column":9}},"140":{"start":{"line":273,"column":12},"end":{"line":273,"column":70}},"141":{"start":{"line":275,"column":8},"end":{"line":281,"column":9}},"142":{"start":{"line":276,"column":12},"end":{"line":280,"column":15}},"143":{"start":{"line":282,"column":8},"end":{"line":284,"column":9}},"144":{"start":{"line":283,"column":12},"end":{"line":283,"column":117}},"145":{"start":{"line":286,"column":8},"end":{"line":290,"column":9}},"146":{"start":{"line":287,"column":12},"end":{"line":287,"column":82}},"147":{"start":{"line":288,"column":15},"end":{"line":290,"column":9}},"148":{"start":{"line":289,"column":12},"end":{"line":289,"column":75}},"149":{"start":{"line":291,"column":8},"end":{"line":295,"column":11}},"150":{"start":{"line":298,"column":8},"end":{"line":298,"column":104}},"151":{"start":{"line":301,"column":8},"end":{"line":301,"column":118}},"152":{"start":{"line":305,"column":8},"end":{"line":357,"column":10}},"153":{"start":{"line":311,"column":54},"end":{"line":314,"column":21}},"154":{"start":{"line":360,"column":8},"end":{"line":382,"column":12}},"155":{"start":{"line":362,"column":25},"end":{"line":362,"column":64}},"156":{"start":{"line":363,"column":12},"end":{"line":381,"column":14}},"157":{"start":{"line":386,"column":21},"end":{"line":386,"column":60}},"158":{"start":{"line":387,"column":8},"end":{"line":402,"column":11}},"159":{"start":{"line":405,"column":8},"end":{"line":405,"column":159}},"160":{"start":{"line":405,"column":67},"end":{"line":405,"column":82}},"161":{"start":{"line":405,"column":105},"end":{"line":405,"column":120}},"162":{"start":{"line":405,"column":142},"end":{"line":405,"column":157}},"163":{"start":{"line":408,"column":8},"end":{"line":408,"column":22}},"164":{"start":{"line":411,"column":8},"end":{"line":411,"column":82}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":24,"column":4},"end":{"line":24,"column":5}},"loc":{"start":{"line":24,"column":32},"end":{"line":41,"column":5}},"line":24},"2":{"name":"(anonymous_2)","decl":{"start":{"line":26,"column":47},"end":{"line":26,"column":48}},"loc":{"start":{"line":26,"column":55},"end":{"line":26,"column":59}},"line":26},"3":{"name":"(anonymous_3)","decl":{"start":{"line":42,"column":4},"end":{"line":42,"column":5}},"loc":{"start":{"line":42,"column":42},"end":{"line":60,"column":5}},"line":42},"4":{"name":"(anonymous_4)","decl":{"start":{"line":61,"column":4},"end":{"line":61,"column":5}},"loc":{"start":{"line":61,"column":63},"end":{"line":94,"column":5}},"line":61},"5":{"name":"(anonymous_5)","decl":{"start":{"line":65,"column":27},"end":{"line":65,"column":28}},"loc":{"start":{"line":65,"column":43},"end":{"line":83,"column":13}},"line":65},"6":{"name":"(anonymous_6)","decl":{"start":{"line":67,"column":55},"end":{"line":67,"column":56}},"loc":{"start":{"line":67,"column":63},"end":{"line":67,"column":67}},"line":67},"7":{"name":"(anonymous_7)","decl":{"start":{"line":80,"column":35},"end":{"line":80,"column":36}},"loc":{"start":{"line":80,"column":41},"end":{"line":80,"column":65}},"line":80},"8":{"name":"(anonymous_8)","decl":{"start":{"line":92,"column":27},"end":{"line":92,"column":28}},"loc":{"start":{"line":92,"column":33},"end":{"line":92,"column":57}},"line":92},"9":{"name":"(anonymous_9)","decl":{"start":{"line":95,"column":4},"end":{"line":95,"column":5}},"loc":{"start":{"line":95,"column":51},"end":{"line":113,"column":5}},"line":95},"10":{"name":"(anonymous_10)","decl":{"start":{"line":114,"column":4},"end":{"line":114,"column":5}},"loc":{"start":{"line":114,"column":33},"end":{"line":125,"column":5}},"line":114},"11":{"name":"(anonymous_11)","decl":{"start":{"line":126,"column":4},"end":{"line":126,"column":5}},"loc":{"start":{"line":126,"column":42},"end":{"line":135,"column":5}},"line":126},"12":{"name":"(anonymous_12)","decl":{"start":{"line":136,"column":4},"end":{"line":136,"column":5}},"loc":{"start":{"line":136,"column":56},"end":{"line":152,"column":5}},"line":136},"13":{"name":"(anonymous_13)","decl":{"start":{"line":145,"column":90},"end":{"line":145,"column":91}},"loc":{"start":{"line":145,"column":96},"end":{"line":145,"column":116}},"line":145},"14":{"name":"(anonymous_14)","decl":{"start":{"line":153,"column":4},"end":{"line":153,"column":5}},"loc":{"start":{"line":153,"column":42},"end":{"line":169,"column":5}},"line":153},"15":{"name":"(anonymous_15)","decl":{"start":{"line":170,"column":4},"end":{"line":170,"column":5}},"loc":{"start":{"line":170,"column":42},"end":{"line":193,"column":5}},"line":170},"16":{"name":"(anonymous_16)","decl":{"start":{"line":174,"column":23},"end":{"line":174,"column":24}},"loc":{"start":{"line":174,"column":46},"end":{"line":191,"column":9}},"line":174},"17":{"name":"(anonymous_17)","decl":{"start":{"line":194,"column":4},"end":{"line":194,"column":5}},"loc":{"start":{"line":194,"column":49},"end":{"line":222,"column":5}},"line":194},"18":{"name":"(anonymous_18)","decl":{"start":{"line":196,"column":59},"end":{"line":196,"column":60}},"loc":{"start":{"line":196,"column":69},"end":{"line":198,"column":17}},"line":196},"19":{"name":"(anonymous_19)","decl":{"start":{"line":223,"column":4},"end":{"line":223,"column":5}},"loc":{"start":{"line":223,"column":45},"end":{"line":296,"column":5}},"line":223},"20":{"name":"(anonymous_20)","decl":{"start":{"line":297,"column":4},"end":{"line":297,"column":5}},"loc":{"start":{"line":297,"column":33},"end":{"line":299,"column":5}},"line":297},"21":{"name":"(anonymous_21)","decl":{"start":{"line":300,"column":4},"end":{"line":300,"column":5}},"loc":{"start":{"line":300,"column":35},"end":{"line":302,"column":5}},"line":300},"22":{"name":"(anonymous_22)","decl":{"start":{"line":303,"column":4},"end":{"line":303,"column":5}},"loc":{"start":{"line":303,"column":39},"end":{"line":358,"column":5}},"line":303},"23":{"name":"(anonymous_23)","decl":{"start":{"line":311,"column":44},"end":{"line":311,"column":45}},"loc":{"start":{"line":311,"column":54},"end":{"line":314,"column":21}},"line":311},"24":{"name":"(anonymous_24)","decl":{"start":{"line":359,"column":4},"end":{"line":359,"column":5}},"loc":{"start":{"line":359,"column":36},"end":{"line":383,"column":5}},"line":359},"25":{"name":"(anonymous_25)","decl":{"start":{"line":360,"column":41},"end":{"line":360,"column":42}},"loc":{"start":{"line":360,"column":59},"end":{"line":382,"column":9}},"line":360},"26":{"name":"(anonymous_26)","decl":{"start":{"line":384,"column":4},"end":{"line":384,"column":5}},"loc":{"start":{"line":384,"column":31},"end":{"line":403,"column":5}},"line":384},"27":{"name":"(anonymous_27)","decl":{"start":{"line":404,"column":4},"end":{"line":404,"column":5}},"loc":{"start":{"line":404,"column":36},"end":{"line":406,"column":5}},"line":404},"28":{"name":"(anonymous_28)","decl":{"start":{"line":405,"column":62},"end":{"line":405,"column":63}},"loc":{"start":{"line":405,"column":67},"end":{"line":405,"column":82}},"line":405},"29":{"name":"(anonymous_29)","decl":{"start":{"line":405,"column":100},"end":{"line":405,"column":101}},"loc":{"start":{"line":405,"column":105},"end":{"line":405,"column":120}},"line":405},"30":{"name":"(anonymous_30)","decl":{"start":{"line":405,"column":137},"end":{"line":405,"column":138}},"loc":{"start":{"line":405,"column":142},"end":{"line":405,"column":157}},"line":405},"31":{"name":"(anonymous_31)","decl":{"start":{"line":407,"column":4},"end":{"line":407,"column":5}},"loc":{"start":{"line":407,"column":18},"end":{"line":409,"column":5}},"line":407},"32":{"name":"(anonymous_32)","decl":{"start":{"line":410,"column":4},"end":{"line":410,"column":5}},"loc":{"start":{"line":410,"column":24},"end":{"line":412,"column":5}},"line":410}},"branchMap":{"0":{"loc":{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},"type":"if","locations":[{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},{"start":{"line":27,"column":8},"end":{"line":29,"column":9}}],"line":27},"1":{"loc":{"start":{"line":27,"column":12},"end":{"line":27,"column":49}},"type":"binary-expr","locations":[{"start":{"line":27,"column":12},"end":{"line":27,"column":31}},{"start":{"line":27,"column":35},"end":{"line":27,"column":49}}],"line":27},"2":{"loc":{"start":{"line":31,"column":8},"end":{"line":34,"column":9}},"type":"if","locations":[{"start":{"line":31,"column":8},"end":{"line":34,"column":9}},{"start":{"line":31,"column":8},"end":{"line":34,"column":9}}],"line":31},"3":{"loc":{"start":{"line":31,"column":12},"end":{"line":31,"column":59}},"type":"binary-expr","locations":[{"start":{"line":31,"column":12},"end":{"line":31,"column":24}},{"start":{"line":31,"column":28},"end":{"line":31,"column":59}}],"line":31},"4":{"loc":{"start":{"line":35,"column":8},"end":{"line":38,"column":9}},"type":"if","locations":[{"start":{"line":35,"column":8},"end":{"line":38,"column":9}},{"start":{"line":35,"column":8},"end":{"line":38,"column":9}}],"line":35},"5":{"loc":{"start":{"line":35,"column":12},"end":{"line":35,"column":55}},"type":"binary-expr","locations":[{"start":{"line":35,"column":12},"end":{"line":35,"column":25}},{"start":{"line":35,"column":29},"end":{"line":35,"column":55}}],"line":35},"6":{"loc":{"start":{"line":42,"column":22},"end":{"line":42,"column":40}},"type":"default-arg","locations":[{"start":{"line":42,"column":38},"end":{"line":42,"column":40}}],"line":42},"7":{"loc":{"start":{"line":45,"column":8},"end":{"line":49,"column":9}},"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":49,"column":9}},{"start":{"line":45,"column":8},"end":{"line":49,"column":9}}],"line":45},"8":{"loc":{"start":{"line":61,"column":26},"end":{"line":61,"column":61}},"type":"default-arg","locations":[{"start":{"line":61,"column":59},"end":{"line":61,"column":61}}],"line":61},"9":{"loc":{"start":{"line":68,"column":16},"end":{"line":70,"column":17}},"type":"if","locations":[{"start":{"line":68,"column":16},"end":{"line":70,"column":17}},{"start":{"line":68,"column":16},"end":{"line":70,"column":17}}],"line":68},"10":{"loc":{"start":{"line":68,"column":20},"end":{"line":68,"column":57}},"type":"binary-expr","locations":[{"start":{"line":68,"column":20},"end":{"line":68,"column":39}},{"start":{"line":68,"column":43},"end":{"line":68,"column":57}}],"line":68},"11":{"loc":{"start":{"line":72,"column":16},"end":{"line":81,"column":17}},"type":"if","locations":[{"start":{"line":72,"column":16},"end":{"line":81,"column":17}},{"start":{"line":72,"column":16},"end":{"line":81,"column":17}}],"line":72},"12":{"loc":{"start":{"line":85,"column":8},"end":{"line":93,"column":9}},"type":"if","locations":[{"start":{"line":85,"column":8},"end":{"line":93,"column":9}},{"start":{"line":85,"column":8},"end":{"line":93,"column":9}}],"line":85},"13":{"loc":{"start":{"line":101,"column":12},"end":{"line":103,"column":13}},"type":"if","locations":[{"start":{"line":101,"column":12},"end":{"line":103,"column":13}},{"start":{"line":101,"column":12},"end":{"line":103,"column":13}}],"line":101},"14":{"loc":{"start":{"line":106,"column":21},"end":{"line":106,"column":213}},"type":"binary-expr","locations":[{"start":{"line":106,"column":22},"end":{"line":106,"column":206}},{"start":{"line":106,"column":211},"end":{"line":106,"column":213}}],"line":106},"15":{"loc":{"start":{"line":106,"column":22},"end":{"line":106,"column":206}},"type":"cond-expr","locations":[{"start":{"line":106,"column":80},"end":{"line":106,"column":86}},{"start":{"line":106,"column":89},"end":{"line":106,"column":206}}],"line":106},"16":{"loc":{"start":{"line":106,"column":22},"end":{"line":106,"column":77}},"type":"binary-expr","locations":[{"start":{"line":106,"column":22},"end":{"line":106,"column":53}},{"start":{"line":106,"column":57},"end":{"line":106,"column":77}}],"line":106},"17":{"loc":{"start":{"line":106,"column":89},"end":{"line":106,"column":206}},"type":"cond-expr","locations":[{"start":{"line":106,"column":169},"end":{"line":106,"column":175}},{"start":{"line":106,"column":178},"end":{"line":106,"column":206}}],"line":106},"18":{"loc":{"start":{"line":106,"column":89},"end":{"line":106,"column":166}},"type":"binary-expr","locations":[{"start":{"line":106,"column":89},"end":{"line":106,"column":135}},{"start":{"line":106,"column":139},"end":{"line":106,"column":166}}],"line":106},"19":{"loc":{"start":{"line":107,"column":47},"end":{"line":107,"column":242}},"type":"binary-expr","locations":[{"start":{"line":107,"column":48},"end":{"line":107,"column":236}},{"start":{"line":107,"column":241},"end":{"line":107,"column":242}}],"line":107},"20":{"loc":{"start":{"line":107,"column":48},"end":{"line":107,"column":236}},"type":"cond-expr","locations":[{"start":{"line":107,"column":108},"end":{"line":107,"column":114}},{"start":{"line":107,"column":117},"end":{"line":107,"column":236}}],"line":107},"21":{"loc":{"start":{"line":107,"column":48},"end":{"line":107,"column":105}},"type":"binary-expr","locations":[{"start":{"line":107,"column":48},"end":{"line":107,"column":80}},{"start":{"line":107,"column":84},"end":{"line":107,"column":105}}],"line":107},"22":{"loc":{"start":{"line":107,"column":117},"end":{"line":107,"column":236}},"type":"cond-expr","locations":[{"start":{"line":107,"column":200},"end":{"line":107,"column":206}},{"start":{"line":107,"column":209},"end":{"line":107,"column":236}}],"line":107},"23":{"loc":{"start":{"line":107,"column":117},"end":{"line":107,"column":197}},"type":"binary-expr","locations":[{"start":{"line":107,"column":117},"end":{"line":107,"column":165}},{"start":{"line":107,"column":169},"end":{"line":107,"column":197}}],"line":107},"24":{"loc":{"start":{"line":108,"column":12},"end":{"line":110,"column":13}},"type":"if","locations":[{"start":{"line":108,"column":12},"end":{"line":110,"column":13}},{"start":{"line":108,"column":12},"end":{"line":110,"column":13}}],"line":108},"25":{"loc":{"start":{"line":115,"column":8},"end":{"line":120,"column":9}},"type":"if","locations":[{"start":{"line":115,"column":8},"end":{"line":120,"column":9}},{"start":{"line":115,"column":8},"end":{"line":120,"column":9}}],"line":115},"26":{"loc":{"start":{"line":117,"column":12},"end":{"line":119,"column":13}},"type":"if","locations":[{"start":{"line":117,"column":12},"end":{"line":119,"column":13}},{"start":{"line":117,"column":12},"end":{"line":119,"column":13}}],"line":117},"27":{"loc":{"start":{"line":122,"column":8},"end":{"line":124,"column":9}},"type":"if","locations":[{"start":{"line":122,"column":8},"end":{"line":124,"column":9}},{"start":{"line":122,"column":8},"end":{"line":124,"column":9}}],"line":122},"28":{"loc":{"start":{"line":128,"column":8},"end":{"line":134,"column":9}},"type":"if","locations":[{"start":{"line":128,"column":8},"end":{"line":134,"column":9}},{"start":{"line":128,"column":8},"end":{"line":134,"column":9}}],"line":128},"29":{"loc":{"start":{"line":128,"column":12},"end":{"line":128,"column":135}},"type":"cond-expr","locations":[{"start":{"line":128,"column":100},"end":{"line":128,"column":106}},{"start":{"line":128,"column":109},"end":{"line":128,"column":135}}],"line":128},"30":{"loc":{"start":{"line":128,"column":12},"end":{"line":128,"column":97}},"type":"binary-expr","locations":[{"start":{"line":128,"column":12},"end":{"line":128,"column":63}},{"start":{"line":128,"column":67},"end":{"line":128,"column":97}}],"line":128},"31":{"loc":{"start":{"line":138,"column":8},"end":{"line":140,"column":9}},"type":"if","locations":[{"start":{"line":138,"column":8},"end":{"line":140,"column":9}},{"start":{"line":138,"column":8},"end":{"line":140,"column":9}}],"line":138},"32":{"loc":{"start":{"line":138,"column":14},"end":{"line":138,"column":125}},"type":"cond-expr","locations":[{"start":{"line":138,"column":93},"end":{"line":138,"column":99}},{"start":{"line":138,"column":102},"end":{"line":138,"column":125}}],"line":138},"33":{"loc":{"start":{"line":138,"column":14},"end":{"line":138,"column":90}},"type":"binary-expr","locations":[{"start":{"line":138,"column":14},"end":{"line":138,"column":59}},{"start":{"line":138,"column":63},"end":{"line":138,"column":90}}],"line":138},"34":{"loc":{"start":{"line":145,"column":29},"end":{"line":145,"column":213}},"type":"binary-expr","locations":[{"start":{"line":145,"column":29},"end":{"line":145,"column":41}},{"start":{"line":145,"column":46},"end":{"line":145,"column":203}},{"start":{"line":145,"column":208},"end":{"line":145,"column":213}}],"line":145},"35":{"loc":{"start":{"line":145,"column":46},"end":{"line":145,"column":203}},"type":"cond-expr","locations":[{"start":{"line":145,"column":165},"end":{"line":145,"column":171}},{"start":{"line":145,"column":174},"end":{"line":145,"column":203}}],"line":145},"36":{"loc":{"start":{"line":145,"column":46},"end":{"line":145,"column":162}},"type":"binary-expr","locations":[{"start":{"line":145,"column":46},"end":{"line":145,"column":127}},{"start":{"line":145,"column":131},"end":{"line":145,"column":162}}],"line":145},"37":{"loc":{"start":{"line":154,"column":8},"end":{"line":156,"column":9}},"type":"if","locations":[{"start":{"line":154,"column":8},"end":{"line":156,"column":9}},{"start":{"line":154,"column":8},"end":{"line":156,"column":9}}],"line":154},"38":{"loc":{"start":{"line":158,"column":12},"end":{"line":160,"column":13}},"type":"if","locations":[{"start":{"line":158,"column":12},"end":{"line":160,"column":13}},{"start":{"line":158,"column":12},"end":{"line":160,"column":13}}],"line":158},"39":{"loc":{"start":{"line":163,"column":16},"end":{"line":165,"column":17}},"type":"if","locations":[{"start":{"line":163,"column":16},"end":{"line":165,"column":17}},{"start":{"line":163,"column":16},"end":{"line":165,"column":17}}],"line":163},"40":{"loc":{"start":{"line":171,"column":8},"end":{"line":173,"column":9}},"type":"if","locations":[{"start":{"line":171,"column":8},"end":{"line":173,"column":9}},{"start":{"line":171,"column":8},"end":{"line":173,"column":9}}],"line":171},"41":{"loc":{"start":{"line":176,"column":16},"end":{"line":178,"column":17}},"type":"if","locations":[{"start":{"line":176,"column":16},"end":{"line":178,"column":17}},{"start":{"line":176,"column":16},"end":{"line":178,"column":17}}],"line":176},"42":{"loc":{"start":{"line":180,"column":16},"end":{"line":183,"column":17}},"type":"if","locations":[{"start":{"line":180,"column":16},"end":{"line":183,"column":17}},{"start":{"line":180,"column":16},"end":{"line":183,"column":17}}],"line":180},"43":{"loc":{"start":{"line":180,"column":20},"end":{"line":180,"column":82}},"type":"binary-expr","locations":[{"start":{"line":180,"column":20},"end":{"line":180,"column":51}},{"start":{"line":180,"column":55},"end":{"line":180,"column":82}}],"line":180},"44":{"loc":{"start":{"line":195,"column":8},"end":{"line":203,"column":9}},"type":"if","locations":[{"start":{"line":195,"column":8},"end":{"line":203,"column":9}},{"start":{"line":195,"column":8},"end":{"line":203,"column":9}}],"line":195},"45":{"loc":{"start":{"line":195,"column":12},"end":{"line":195,"column":114}},"type":"binary-expr","locations":[{"start":{"line":195,"column":12},"end":{"line":195,"column":26}},{"start":{"line":195,"column":30},"end":{"line":195,"column":114}}],"line":195},"46":{"loc":{"start":{"line":195,"column":32},"end":{"line":195,"column":113}},"type":"cond-expr","locations":[{"start":{"line":195,"column":83},"end":{"line":195,"column":89}},{"start":{"line":195,"column":92},"end":{"line":195,"column":113}}],"line":195},"47":{"loc":{"start":{"line":195,"column":32},"end":{"line":195,"column":80}},"type":"binary-expr","locations":[{"start":{"line":195,"column":32},"end":{"line":195,"column":53}},{"start":{"line":195,"column":57},"end":{"line":195,"column":80}}],"line":195},"48":{"loc":{"start":{"line":204,"column":8},"end":{"line":221,"column":9}},"type":"if","locations":[{"start":{"line":204,"column":8},"end":{"line":221,"column":9}},{"start":{"line":204,"column":8},"end":{"line":221,"column":9}}],"line":204},"49":{"loc":{"start":{"line":208,"column":12},"end":{"line":210,"column":13}},"type":"if","locations":[{"start":{"line":208,"column":12},"end":{"line":210,"column":13}},{"start":{"line":208,"column":12},"end":{"line":210,"column":13}}],"line":208},"50":{"loc":{"start":{"line":208,"column":16},"end":{"line":208,"column":43}},"type":"binary-expr","locations":[{"start":{"line":208,"column":16},"end":{"line":208,"column":26}},{"start":{"line":208,"column":30},"end":{"line":208,"column":43}}],"line":208},"51":{"loc":{"start":{"line":214,"column":12},"end":{"line":220,"column":13}},"type":"if","locations":[{"start":{"line":214,"column":12},"end":{"line":220,"column":13}},{"start":{"line":214,"column":12},"end":{"line":220,"column":13}}],"line":214},"52":{"loc":{"start":{"line":216,"column":16},"end":{"line":218,"column":17}},"type":"if","locations":[{"start":{"line":216,"column":16},"end":{"line":218,"column":17}},{"start":{"line":216,"column":16},"end":{"line":218,"column":17}}],"line":216},"53":{"loc":{"start":{"line":226,"column":8},"end":{"line":228,"column":9}},"type":"if","locations":[{"start":{"line":226,"column":8},"end":{"line":228,"column":9}},{"start":{"line":226,"column":8},"end":{"line":228,"column":9}}],"line":226},"54":{"loc":{"start":{"line":230,"column":8},"end":{"line":234,"column":9}},"type":"if","locations":[{"start":{"line":230,"column":8},"end":{"line":234,"column":9}},{"start":{"line":230,"column":8},"end":{"line":234,"column":9}}],"line":230},"55":{"loc":{"start":{"line":230,"column":12},"end":{"line":230,"column":50}},"type":"binary-expr","locations":[{"start":{"line":230,"column":12},"end":{"line":230,"column":27}},{"start":{"line":230,"column":31},"end":{"line":230,"column":50}}],"line":230},"56":{"loc":{"start":{"line":235,"column":8},"end":{"line":237,"column":9}},"type":"if","locations":[{"start":{"line":235,"column":8},"end":{"line":237,"column":9}},{"start":{"line":235,"column":8},"end":{"line":237,"column":9}}],"line":235},"57":{"loc":{"start":{"line":235,"column":12},"end":{"line":235,"column":48}},"type":"binary-expr","locations":[{"start":{"line":235,"column":12},"end":{"line":235,"column":26}},{"start":{"line":235,"column":30},"end":{"line":235,"column":48}}],"line":235},"58":{"loc":{"start":{"line":240,"column":19},"end":{"line":242,"column":17}},"type":"binary-expr","locations":[{"start":{"line":240,"column":19},"end":{"line":240,"column":33}},{"start":{"line":240,"column":37},"end":{"line":242,"column":17}}],"line":240},"59":{"loc":{"start":{"line":243,"column":19},"end":{"line":245,"column":17}},"type":"binary-expr","locations":[{"start":{"line":243,"column":19},"end":{"line":243,"column":32}},{"start":{"line":243,"column":36},"end":{"line":245,"column":17}}],"line":243},"60":{"loc":{"start":{"line":246,"column":19},"end":{"line":248,"column":17}},"type":"binary-expr","locations":[{"start":{"line":246,"column":19},"end":{"line":246,"column":38}},{"start":{"line":246,"column":42},"end":{"line":248,"column":17}}],"line":246},"61":{"loc":{"start":{"line":249,"column":19},"end":{"line":251,"column":17}},"type":"binary-expr","locations":[{"start":{"line":249,"column":19},"end":{"line":249,"column":31}},{"start":{"line":249,"column":35},"end":{"line":251,"column":17}}],"line":249},"62":{"loc":{"start":{"line":252,"column":19},"end":{"line":254,"column":17}},"type":"binary-expr","locations":[{"start":{"line":252,"column":20},"end":{"line":252,"column":137}},{"start":{"line":252,"column":142},"end":{"line":254,"column":17}}],"line":252},"63":{"loc":{"start":{"line":252,"column":20},"end":{"line":252,"column":137}},"type":"cond-expr","locations":[{"start":{"line":252,"column":105},"end":{"line":252,"column":111}},{"start":{"line":252,"column":114},"end":{"line":252,"column":137}}],"line":252},"64":{"loc":{"start":{"line":252,"column":20},"end":{"line":252,"column":102}},"type":"binary-expr","locations":[{"start":{"line":252,"column":20},"end":{"line":252,"column":69}},{"start":{"line":252,"column":73},"end":{"line":252,"column":102}}],"line":252},"65":{"loc":{"start":{"line":255,"column":19},"end":{"line":257,"column":17}},"type":"binary-expr","locations":[{"start":{"line":255,"column":19},"end":{"line":255,"column":37}},{"start":{"line":255,"column":41},"end":{"line":257,"column":17}}],"line":255},"66":{"loc":{"start":{"line":263,"column":49},"end":{"line":263,"column":74}},"type":"binary-expr","locations":[{"start":{"line":263,"column":49},"end":{"line":263,"column":68}},{"start":{"line":263,"column":72},"end":{"line":263,"column":74}}],"line":263},"67":{"loc":{"start":{"line":264,"column":8},"end":{"line":266,"column":9}},"type":"if","locations":[{"start":{"line":264,"column":8},"end":{"line":266,"column":9}},{"start":{"line":264,"column":8},"end":{"line":266,"column":9}}],"line":264},"68":{"loc":{"start":{"line":267,"column":8},"end":{"line":271,"column":9}},"type":"if","locations":[{"start":{"line":267,"column":8},"end":{"line":271,"column":9}},{"start":{"line":267,"column":8},"end":{"line":271,"column":9}}],"line":267},"69":{"loc":{"start":{"line":272,"column":8},"end":{"line":274,"column":9}},"type":"if","locations":[{"start":{"line":272,"column":8},"end":{"line":274,"column":9}},{"start":{"line":272,"column":8},"end":{"line":274,"column":9}}],"line":272},"70":{"loc":{"start":{"line":275,"column":8},"end":{"line":281,"column":9}},"type":"if","locations":[{"start":{"line":275,"column":8},"end":{"line":281,"column":9}},{"start":{"line":275,"column":8},"end":{"line":281,"column":9}}],"line":275},"71":{"loc":{"start":{"line":275,"column":12},"end":{"line":275,"column":46}},"type":"binary-expr","locations":[{"start":{"line":275,"column":12},"end":{"line":275,"column":25}},{"start":{"line":275,"column":29},"end":{"line":275,"column":46}}],"line":275},"72":{"loc":{"start":{"line":282,"column":8},"end":{"line":284,"column":9}},"type":"if","locations":[{"start":{"line":282,"column":8},"end":{"line":284,"column":9}},{"start":{"line":282,"column":8},"end":{"line":284,"column":9}}],"line":282},"73":{"loc":{"start":{"line":283,"column":73},"end":{"line":283,"column":115}},"type":"binary-expr","locations":[{"start":{"line":283,"column":73},"end":{"line":283,"column":94}},{"start":{"line":283,"column":98},"end":{"line":283,"column":115}}],"line":283},"74":{"loc":{"start":{"line":286,"column":8},"end":{"line":290,"column":9}},"type":"if","locations":[{"start":{"line":286,"column":8},"end":{"line":290,"column":9}},{"start":{"line":286,"column":8},"end":{"line":290,"column":9}}],"line":286},"75":{"loc":{"start":{"line":286,"column":12},"end":{"line":286,"column":113}},"type":"binary-expr","locations":[{"start":{"line":286,"column":12},"end":{"line":286,"column":28}},{"start":{"line":286,"column":33},"end":{"line":286,"column":112}}],"line":286},"76":{"loc":{"start":{"line":286,"column":33},"end":{"line":286,"column":112}},"type":"cond-expr","locations":[{"start":{"line":286,"column":84},"end":{"line":286,"column":90}},{"start":{"line":286,"column":93},"end":{"line":286,"column":112}}],"line":286},"77":{"loc":{"start":{"line":286,"column":33},"end":{"line":286,"column":81}},"type":"binary-expr","locations":[{"start":{"line":286,"column":33},"end":{"line":286,"column":54}},{"start":{"line":286,"column":58},"end":{"line":286,"column":81}}],"line":286},"78":{"loc":{"start":{"line":288,"column":15},"end":{"line":290,"column":9}},"type":"if","locations":[{"start":{"line":288,"column":15},"end":{"line":290,"column":9}},{"start":{"line":288,"column":15},"end":{"line":290,"column":9}}],"line":288},"79":{"loc":{"start":{"line":288,"column":19},"end":{"line":288,"column":140}},"type":"binary-expr","locations":[{"start":{"line":288,"column":19},"end":{"line":288,"column":45}},{"start":{"line":288,"column":49},"end":{"line":288,"column":140}}],"line":288},"80":{"loc":{"start":{"line":288,"column":50},"end":{"line":288,"column":129}},"type":"cond-expr","locations":[{"start":{"line":288,"column":101},"end":{"line":288,"column":107}},{"start":{"line":288,"column":110},"end":{"line":288,"column":129}}],"line":288},"81":{"loc":{"start":{"line":288,"column":50},"end":{"line":288,"column":98}},"type":"binary-expr","locations":[{"start":{"line":288,"column":50},"end":{"line":288,"column":71}},{"start":{"line":288,"column":75},"end":{"line":288,"column":98}}],"line":288},"82":{"loc":{"start":{"line":301,"column":31},"end":{"line":301,"column":50}},"type":"binary-expr","locations":[{"start":{"line":301,"column":31},"end":{"line":301,"column":44}},{"start":{"line":301,"column":48},"end":{"line":301,"column":50}}],"line":301},"83":{"loc":{"start":{"line":301,"column":53},"end":{"line":301,"column":115}},"type":"cond-expr","locations":[{"start":{"line":301,"column":78},"end":{"line":301,"column":110}},{"start":{"line":301,"column":113},"end":{"line":301,"column":115}}],"line":301},"84":{"loc":{"start":{"line":306,"column":18},"end":{"line":306,"column":41}},"type":"binary-expr","locations":[{"start":{"line":306,"column":18},"end":{"line":306,"column":31}},{"start":{"line":306,"column":35},"end":{"line":306,"column":41}}],"line":306},"85":{"loc":{"start":{"line":307,"column":15},"end":{"line":309,"column":13}},"type":"binary-expr","locations":[{"start":{"line":307,"column":15},"end":{"line":307,"column":32}},{"start":{"line":307,"column":36},"end":{"line":309,"column":13}}],"line":307},"86":{"loc":{"start":{"line":310,"column":15},"end":{"line":315,"column":13}},"type":"binary-expr","locations":[{"start":{"line":310,"column":15},"end":{"line":310,"column":37}},{"start":{"line":310,"column":41},"end":{"line":315,"column":13}}],"line":310},"87":{"loc":{"start":{"line":316,"column":15},"end":{"line":318,"column":13}},"type":"binary-expr","locations":[{"start":{"line":316,"column":15},"end":{"line":316,"column":34}},{"start":{"line":316,"column":38},"end":{"line":318,"column":13}}],"line":316},"88":{"loc":{"start":{"line":319,"column":15},"end":{"line":321,"column":13}},"type":"binary-expr","locations":[{"start":{"line":319,"column":15},"end":{"line":319,"column":28}},{"start":{"line":319,"column":32},"end":{"line":321,"column":13}}],"line":319},"89":{"loc":{"start":{"line":322,"column":15},"end":{"line":324,"column":13}},"type":"binary-expr","locations":[{"start":{"line":322,"column":15},"end":{"line":322,"column":27}},{"start":{"line":322,"column":31},"end":{"line":324,"column":13}}],"line":322},"90":{"loc":{"start":{"line":325,"column":15},"end":{"line":327,"column":13}},"type":"binary-expr","locations":[{"start":{"line":325,"column":15},"end":{"line":325,"column":33}},{"start":{"line":325,"column":37},"end":{"line":327,"column":13}}],"line":325},"91":{"loc":{"start":{"line":328,"column":15},"end":{"line":330,"column":13}},"type":"binary-expr","locations":[{"start":{"line":328,"column":15},"end":{"line":328,"column":47}},{"start":{"line":328,"column":51},"end":{"line":330,"column":13}}],"line":328},"92":{"loc":{"start":{"line":334,"column":23},"end":{"line":338,"column":21}},"type":"binary-expr","locations":[{"start":{"line":334,"column":24},"end":{"line":334,"column":43}},{"start":{"line":334,"column":47},"end":{"line":334,"column":65}},{"start":{"line":334,"column":69},"end":{"line":334,"column":107}},{"start":{"line":334,"column":112},"end":{"line":338,"column":21}}],"line":334},"93":{"loc":{"start":{"line":336,"column":60},"end":{"line":336,"column":116}},"type":"binary-expr","locations":[{"start":{"line":336,"column":60},"end":{"line":336,"column":77}},{"start":{"line":336,"column":81},"end":{"line":336,"column":116}}],"line":336},"94":{"loc":{"start":{"line":339,"column":23},"end":{"line":339,"column":46}},"type":"binary-expr","locations":[{"start":{"line":339,"column":23},"end":{"line":339,"column":40}},{"start":{"line":339,"column":44},"end":{"line":339,"column":46}}],"line":339},"95":{"loc":{"start":{"line":342,"column":15},"end":{"line":344,"column":13}},"type":"binary-expr","locations":[{"start":{"line":342,"column":16},"end":{"line":342,"column":133}},{"start":{"line":342,"column":138},"end":{"line":344,"column":13}}],"line":342},"96":{"loc":{"start":{"line":342,"column":16},"end":{"line":342,"column":133}},"type":"cond-expr","locations":[{"start":{"line":342,"column":101},"end":{"line":342,"column":107}},{"start":{"line":342,"column":110},"end":{"line":342,"column":133}}],"line":342},"97":{"loc":{"start":{"line":342,"column":16},"end":{"line":342,"column":98}},"type":"binary-expr","locations":[{"start":{"line":342,"column":16},"end":{"line":342,"column":65}},{"start":{"line":342,"column":69},"end":{"line":342,"column":98}}],"line":342},"98":{"loc":{"start":{"line":345,"column":15},"end":{"line":347,"column":13}},"type":"binary-expr","locations":[{"start":{"line":345,"column":16},"end":{"line":345,"column":139}},{"start":{"line":345,"column":144},"end":{"line":347,"column":13}}],"line":345},"99":{"loc":{"start":{"line":345,"column":16},"end":{"line":345,"column":139}},"type":"cond-expr","locations":[{"start":{"line":345,"column":104},"end":{"line":345,"column":110}},{"start":{"line":345,"column":113},"end":{"line":345,"column":139}}],"line":345},"100":{"loc":{"start":{"line":345,"column":16},"end":{"line":345,"column":101}},"type":"binary-expr","locations":[{"start":{"line":345,"column":16},"end":{"line":345,"column":67}},{"start":{"line":345,"column":71},"end":{"line":345,"column":101}}],"line":345},"101":{"loc":{"start":{"line":348,"column":15},"end":{"line":350,"column":13}},"type":"binary-expr","locations":[{"start":{"line":348,"column":15},"end":{"line":348,"column":38}},{"start":{"line":348,"column":42},"end":{"line":350,"column":13}}],"line":348},"102":{"loc":{"start":{"line":351,"column":15},"end":{"line":353,"column":13}},"type":"binary-expr","locations":[{"start":{"line":351,"column":15},"end":{"line":351,"column":45}},{"start":{"line":351,"column":49},"end":{"line":353,"column":13}}],"line":351},"103":{"loc":{"start":{"line":354,"column":15},"end":{"line":356,"column":13}},"type":"binary-expr","locations":[{"start":{"line":354,"column":15},"end":{"line":354,"column":51}},{"start":{"line":354,"column":55},"end":{"line":356,"column":13}}],"line":354},"104":{"loc":{"start":{"line":368,"column":23},"end":{"line":370,"column":17}},"type":"cond-expr","locations":[{"start":{"line":368,"column":135},"end":{"line":368,"column":149}},{"start":{"line":368,"column":152},"end":{"line":370,"column":17}}],"line":368},"105":{"loc":{"start":{"line":368,"column":24},"end":{"line":368,"column":131}},"type":"cond-expr","locations":[{"start":{"line":368,"column":100},"end":{"line":368,"column":106}},{"start":{"line":368,"column":109},"end":{"line":368,"column":131}}],"line":368},"106":{"loc":{"start":{"line":368,"column":24},"end":{"line":368,"column":97}},"type":"binary-expr","locations":[{"start":{"line":368,"column":24},"end":{"line":368,"column":67}},{"start":{"line":368,"column":71},"end":{"line":368,"column":97}}],"line":368},"107":{"loc":{"start":{"line":374,"column":23},"end":{"line":379,"column":26}},"type":"cond-expr","locations":[{"start":{"line":374,"column":54},"end":{"line":379,"column":21}},{"start":{"line":379,"column":24},"end":{"line":379,"column":26}}],"line":374},"108":{"loc":{"start":{"line":399,"column":15},"end":{"line":401,"column":18}},"type":"cond-expr","locations":[{"start":{"line":399,"column":127},"end":{"line":401,"column":13}},{"start":{"line":401,"column":16},"end":{"line":401,"column":18}}],"line":399},"109":{"loc":{"start":{"line":399,"column":16},"end":{"line":399,"column":123}},"type":"cond-expr","locations":[{"start":{"line":399,"column":92},"end":{"line":399,"column":98}},{"start":{"line":399,"column":101},"end":{"line":399,"column":123}}],"line":399},"110":{"loc":{"start":{"line":399,"column":16},"end":{"line":399,"column":89}},"type":"binary-expr","locations":[{"start":{"line":399,"column":16},"end":{"line":399,"column":59}},{"start":{"line":399,"column":63},"end":{"line":399,"column":89}}],"line":399}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":12,"17":12,"18":11,"19":12,"20":1,"21":11,"22":10,"23":1,"24":1,"25":9,"26":1,"27":1,"28":8,"29":7,"30":13,"31":13,"32":13,"33":0,"34":13,"35":13,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":5,"67":5,"68":5,"69":1,"70":4,"71":4,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":8,"106":0,"107":0,"108":0,"109":8,"110":2,"111":2,"112":6,"113":0,"114":6,"115":6,"116":6,"117":6,"118":2,"119":2,"120":1,"121":1,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":1,"151":1,"152":13,"153":2,"154":0,"155":0,"156":0,"157":1,"158":1,"159":0,"160":0,"161":0,"162":0,"163":13,"164":18},"f":{"0":1,"1":12,"2":11,"3":13,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":5,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":8,"18":0,"19":0,"20":1,"21":1,"22":13,"23":2,"24":0,"25":0,"26":1,"27":0,"28":0,"29":0,"30":0,"31":13,"32":18},"b":{"0":[1,11],"1":[12,1],"2":[1,9],"3":[10,3],"4":[1,8],"5":[9,7],"6":[8],"7":[0,13],"8":[0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[5,0],"26":[1,4],"27":[4,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,8],"45":[8,0],"46":[0,0],"47":[0,0],"48":[2,6],"49":[0,6],"50":[6,0],"51":[2,4],"52":[1,1],"53":[0,0],"54":[0,0],"55":[0,0],"56":[0,0],"57":[0,0],"58":[0,0],"59":[0,0],"60":[0,0],"61":[0,0],"62":[0,0],"63":[0,0],"64":[0,0],"65":[0,0],"66":[0,0],"67":[0,0],"68":[0,0],"69":[0,0],"70":[0,0],"71":[0,0],"72":[0,0],"73":[0,0],"74":[0,0],"75":[0,0],"76":[0,0],"77":[0,0],"78":[0,0],"79":[0,0],"80":[0,0],"81":[0,0],"82":[1,0],"83":[1,0],"84":[13,11],"85":[13,3],"86":[13,2],"87":[13,1],"88":[13,3],"89":[13,1],"90":[13,1],"91":[13,1],"92":[13,12,1,12],"93":[12,11],"94":[13,12],"95":[13,1],"96":[12,1],"97":[13,13],"98":[13,2],"99":[0,13],"100":[13,13],"101":[13,1],"102":[13,2],"103":[13,0],"104":[0,0],"105":[0,0],"106":[0,0],"107":[0,0],"108":[1,0],"109":[0,1],"110":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/UserConverter.ts"],"sourcesContent":["import type { IImportUser, IImportUserRecord, IUser, IUserEmail } from '@rocket.chat/core-typings';\nimport { Users } from '@rocket.chat/models';\nimport { Random } from '@rocket.chat/random';\nimport { SHA256 } from '@rocket.chat/sha256';\nimport { hash as bcryptHash } from 'bcrypt';\nimport { Accounts } from 'meteor/accounts-base';\n\nimport { callbacks as systemCallbacks } from '../../../../../lib/callbacks';\nimport { addUserToDefaultChannels } from '../../../../lib/server/functions/addUserToDefaultChannels';\nimport { generateUsernameSuggestion } from '../../../../lib/server/functions/getUsernameSuggestion';\nimport { saveUserIdentity } from '../../../../lib/server/functions/saveUserIdentity';\nimport { setUserActiveStatus } from '../../../../lib/server/functions/setUserActiveStatus';\nimport { notifyOnUserChange } from '../../../../lib/server/lib/notifyListener';\nimport type { IConversionCallbacks } from '../../definitions/IConversionCallbacks';\nimport { RecordConverter, type RecordConverterOptions } from './RecordConverter';\n\nexport type UserConverterOptions = {\n\tflagEmailsAsVerified?: boolean;\n\tskipExistingUsers?: boolean;\n\tskipNewUsers?: boolean;\n\tskipUserCallbacks?: boolean;\n\tskipDefaultChannels?: boolean;\n\n\tquickUserInsertion?: boolean;\n\tenableEmail2fa?: boolean;\n};\n\nexport type ConvertUsersResult = {\n\tinserted: string[];\n\tupdated: string[];\n\tskipped: number;\n\tfailed: number;\n};\n\nexport class UserConverter extends RecordConverter<IImportUserRecord, UserConverterOptions & RecordConverterOptions> {\n\tprivate insertedIds = new Set<IUser['_id']>();\n\n\tprivate updatedIds = new Set<IUser['_id']>();\n\n\tprotected async convertRecord(record: IImportUserRecord): Promise<boolean | undefined> {\n\t\tconst { data, _id } = record;\n\n\t\tdata.importIds = data.importIds.filter((item) => item);\n\n\t\tif (!data.emails.length && !data.username) {\n\t\t\tthrow new Error('importer-user-missing-email-and-username');\n\t\t}\n\n\t\tconst existingUser = await this.findExistingUser(data);\n\t\tif (existingUser && this._options.skipExistingUsers) {\n\t\t\tawait this.skipRecord(_id);\n\t\t\treturn;\n\t\t}\n\t\tif (!existingUser && this._options.skipNewUsers) {\n\t\t\tawait this.skipRecord(_id);\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.insertOrUpdateUser(existingUser, data);\n\t\treturn !existingUser;\n\t}\n\n\tasync convertData(userCallbacks: IConversionCallbacks = {}): Promise<void> {\n\t\tthis.insertedIds.clear();\n\t\tthis.updatedIds.clear();\n\n\t\tif (this._options.quickUserInsertion) {\n\t\t\tawait this.batchConversion(userCallbacks);\n\t\t} else {\n\t\t\tawait super.convertData(userCallbacks);\n\t\t}\n\n\t\tawait systemCallbacks.run('afterUserImport', {\n\t\t\tinserted: [...this.insertedIds],\n\t\t\tupdated: [...this.updatedIds],\n\t\t\tskipped: this.skippedCount,\n\t\t\tfailed: this.failedCount,\n\t\t});\n\t}\n\n\tpublic async batchConversion({ afterBatchFn, ...callbacks }: IConversionCallbacks = {}): Promise<void> {\n\t\tconst batchToInsert = new Set<IImportUser>();\n\n\t\tawait this.iterateRecords({\n\t\t\t...callbacks,\n\t\t\tprocessRecord: async (record: IImportUserRecord) => {\n\t\t\t\tconst { data } = record;\n\n\t\t\t\tdata.importIds = data.importIds.filter((item) => item);\n\n\t\t\t\tif (!data.emails.length && !data.username) {\n\t\t\t\t\tthrow new Error('importer-user-missing-email-and-username');\n\t\t\t\t}\n\n\t\t\t\tbatchToInsert.add(data);\n\n\t\t\t\tif (batchToInsert.size >= 50) {\n\t\t\t\t\tconst usersToInsert = await this.buildUserBatch([...batchToInsert]);\n\t\t\t\t\tbatchToInsert.clear();\n\n\t\t\t\t\tconst newIds = await this.insertUserBatch(usersToInsert, { afterBatchFn });\n\t\t\t\t\tnewIds.forEach((id) => this.insertedIds.add(id));\n\t\t\t\t}\n\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t});\n\n\t\tif (batchToInsert.size > 0) {\n\t\t\tconst usersToInsert = await this.buildUserBatch([...batchToInsert]);\n\t\t\tconst newIds = await this.insertUserBatch(usersToInsert, { afterBatchFn });\n\t\t\tnewIds.forEach((id) => this.insertedIds.add(id));\n\t\t}\n\t}\n\n\tprivate async insertUserBatch(users: IUser[], { afterBatchFn }: IConversionCallbacks): Promise<string[]> {\n\t\tlet newIds: string[] | null = null;\n\n\t\ttry {\n\t\t\tnewIds = Object.values((await Users.insertMany(users, { ordered: false })).insertedIds);\n\t\t\tif (afterBatchFn) {\n\t\t\t\tawait afterBatchFn(newIds.length, 0);\n\t\t\t}\n\t\t} catch (e: any) {\n\t\t\tnewIds = (e.result?.result?.insertedIds || []) as string[];\n\t\t\tconst errorCount = users.length - (e.result?.result?.nInserted || 0);\n\n\t\t\tif (afterBatchFn) {\n\t\t\t\tawait afterBatchFn(Math.min(newIds.length, users.length - errorCount), errorCount);\n\t\t\t}\n\t\t}\n\n\t\treturn newIds;\n\t}\n\n\tasync findExistingUser(data: IImportUser): Promise<IUser | undefined> {\n\t\tif (data.emails.length) {\n\t\t\tconst emailUser = await Users.findOneByEmailAddress(data.emails[0], {});\n\n\t\t\tif (emailUser) {\n\t\t\t\treturn emailUser;\n\t\t\t}\n\t\t}\n\n\t\t// If we couldn't find one by their email address, try to find an existing user by their username\n\t\tif (data.username) {\n\t\t\treturn Users.findOneByUsernameIgnoringCase(data.username, {});\n\t\t}\n\t}\n\n\taddUserImportId(updateData: Record<string, any>, userData: IImportUser): void {\n\t\tif (userData.importIds?.length) {\n\t\t\tupdateData.$addToSet = {\n\t\t\t\timportIds: {\n\t\t\t\t\t$each: userData.importIds,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t}\n\n\taddUserEmails(updateData: Record<string, any>, userData: IImportUser, existingEmails: Array<IUserEmail>): void {\n\t\tif (!userData.emails?.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst verifyEmails = Boolean(this._options.flagEmailsAsVerified);\n\t\tconst newEmailList: Array<IUserEmail> = [];\n\n\t\tfor (const email of userData.emails) {\n\t\t\tconst verified = verifyEmails || existingEmails.find((ee) => ee.address === email)?.verified || false;\n\n\t\t\tnewEmailList.push({\n\t\t\t\taddress: email,\n\t\t\t\tverified,\n\t\t\t});\n\t\t}\n\n\t\tupdateData.$set.emails = newEmailList;\n\t}\n\n\taddUserServices(updateData: Record<string, any>, userData: IImportUser): void {\n\t\tif (!userData.services) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const serviceKey in userData.services) {\n\t\t\tif (!userData.services[serviceKey]) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst service = userData.services[serviceKey];\n\n\t\t\tfor (const key in service) {\n\t\t\t\tif (!service[key]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tupdateData.$set[`services.${serviceKey}.${key}`] = service[key];\n\t\t\t}\n\t\t}\n\t}\n\n\taddCustomFields(updateData: Record<string, any>, userData: IImportUser): void {\n\t\tif (!userData.customFields) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst subset = (source: Record<string, any>, currentPath: string): void => {\n\t\t\tfor (const key in source) {\n\t\t\t\tif (!source.hasOwnProperty(key)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst keyPath = `${currentPath}.${key}`;\n\t\t\t\tif (typeof source[key] === 'object' && !Array.isArray(source[key])) {\n\t\t\t\t\tsubset(source[key], keyPath);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tupdateData.$set = {\n\t\t\t\t\t...updateData.$set,\n\t\t\t\t\t...{ [keyPath]: source[key] },\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\n\t\tsubset(userData.customFields, 'customFields');\n\t}\n\n\tasync insertOrUpdateUser(existingUser: IUser | undefined, data: IImportUser): Promise<void> {\n\t\tif (!data.username && !existingUser?.username) {\n\t\t\tconst emails = data.emails.filter(Boolean).map((email) => ({ address: email }));\n\t\t\tdata.username = await generateUsernameSuggestion({\n\t\t\t\tname: data.name,\n\t\t\t\temails,\n\t\t\t});\n\t\t}\n\n\t\tif (existingUser) {\n\t\t\tawait this.updateUser(existingUser, data);\n\t\t\tthis.updatedIds.add(existingUser._id);\n\t\t} else {\n\t\t\tif (!data.name && data.username) {\n\t\t\t\tdata.name = this.guessNameFromUsername(data.username);\n\t\t\t}\n\n\t\t\tconst userId = await this.insertUser(data);\n\t\t\tdata._id = userId;\n\t\t\tthis.insertedIds.add(userId);\n\n\t\t\tif (!this._options.skipDefaultChannels) {\n\t\t\t\tconst insertedUser = await Users.findOneById(userId, {});\n\t\t\t\tif (!insertedUser) {\n\t\t\t\t\tthrow new Error(`User not found: ${userId}`);\n\t\t\t\t}\n\n\t\t\t\tawait addUserToDefaultChannels(insertedUser, true);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync updateUser(existingUser: IUser, userData: IImportUser): Promise<void> {\n\t\tconst { _id } = existingUser;\n\t\tif (!_id) {\n\t\t\treturn;\n\t\t}\n\n\t\tuserData._id = _id;\n\n\t\tif (!userData.roles && !existingUser.roles) {\n\t\t\tuserData.roles = ['user'];\n\t\t}\n\t\tif (!userData.type && !existingUser.type) {\n\t\t\tuserData.type = 'user';\n\t\t}\n\n\t\tconst updateData: Record<string, any> = Object.assign(Object.create(null), {\n\t\t\t$set: Object.assign(Object.create(null), {\n\t\t\t\t...(userData.roles && { roles: userData.roles }),\n\t\t\t\t...(userData.type && { type: userData.type }),\n\t\t\t\t...(userData.statusText && { statusText: userData.statusText }),\n\t\t\t\t...(userData.bio && { bio: userData.bio }),\n\t\t\t\t...(userData.services?.ldap && { ldap: true }),\n\t\t\t\t...(userData.avatarUrl && { _pendingAvatarUrl: userData.avatarUrl }),\n\t\t\t}),\n\t\t});\n\n\t\tthis.addCustomFields(updateData, userData);\n\t\tthis.addUserServices(updateData, userData);\n\t\tthis.addUserImportId(updateData, userData);\n\t\tthis.addUserEmails(updateData, userData, existingUser.emails || []);\n\n\t\tif (Object.keys(updateData.$set).length === 0) {\n\t\t\tdelete updateData.$set;\n\t\t}\n\t\tif (Object.keys(updateData).length > 0) {\n\t\t\tawait Users.updateOne({ _id }, updateData);\n\t\t}\n\n\t\tif (userData.utcOffset) {\n\t\t\tawait Users.setUtcOffset(_id, userData.utcOffset);\n\t\t}\n\n\t\tif (userData.name || userData.username) {\n\t\t\tawait saveUserIdentity({ _id, name: userData.name, username: userData.username } as Parameters<typeof saveUserIdentity>[0]);\n\t\t}\n\n\t\tif (userData.importIds.length) {\n\t\t\tthis._cache.addUser(userData.importIds[0], existingUser._id, existingUser.username || userData.username);\n\t\t}\n\n\t\t// Deleted users are 'inactive' users in Rocket.Chat\n\t\tif (userData.deleted && existingUser?.active) {\n\t\t\tawait setUserActiveStatus(_id, false, true);\n\t\t} else if (userData.deleted === false && existingUser?.active === false) {\n\t\t\tawait setUserActiveStatus(_id, true);\n\t\t}\n\n\t\tvoid notifyOnUserChange({ clientAction: 'updated', id: _id, diff: updateData.$set });\n\t}\n\n\tprivate async hashPassword(password: string): Promise<string> {\n\t\treturn bcryptHash(SHA256(password), Accounts._bcryptRounds());\n\t}\n\n\tprivate generateTempPassword(userData: IImportUser): string {\n\t\treturn `${Date.now()}${userData.name || ''}${userData.emails.length ? userData.emails[0].toUpperCase() : ''}`;\n\t}\n\n\tprivate async buildNewUserObject(userData: IImportUser): Promise<Partial<IUser>> {\n\t\treturn {\n\t\t\ttype: userData.type || 'user',\n\t\t\t...(userData.username && { username: userData.username }),\n\t\t\t...(userData.emails.length && {\n\t\t\t\temails: userData.emails.map((email) => ({ address: email, verified: !!this._options.flagEmailsAsVerified })),\n\t\t\t}),\n\t\t\t...(userData.statusText && { statusText: userData.statusText }),\n\t\t\t...(userData.name && { name: userData.name }),\n\t\t\t...(userData.bio && { bio: userData.bio }),\n\t\t\t...(userData.avatarUrl && { _pendingAvatarUrl: userData.avatarUrl }),\n\t\t\t...(userData.utcOffset !== undefined && { utcOffset: userData.utcOffset }),\n\t\t\t...{\n\t\t\t\tservices: {\n\t\t\t\t\t// Add a password service if there's a password string, or if there's no service at all\n\t\t\t\t\t...((!!userData.password || !userData.services || !Object.keys(userData.services).length) && {\n\t\t\t\t\t\tpassword: { bcrypt: await this.hashPassword(userData.password || this.generateTempPassword(userData)) },\n\t\t\t\t\t}),\n\t\t\t\t\t...(userData.services || {}),\n\t\t\t\t},\n\t\t\t},\n\t\t\t...(userData.services?.ldap && { ldap: true }),\n\t\t\t...(userData.importIds?.length && { importIds: userData.importIds }),\n\t\t\t...(!!userData.customFields && { customFields: userData.customFields }),\n\t\t\t...(userData.deleted !== undefined && { active: !userData.deleted }),\n\t\t\t...(userData.voipExtension !== undefined && { freeSwitchExtension: userData.voipExtension }),\n\t\t};\n\t}\n\n\tprivate async buildUserBatch(usersData: IImportUser[]): Promise<IUser[]> {\n\t\treturn Promise.all(\n\t\t\tusersData.map(async (userData) => {\n\t\t\t\tconst user = await this.buildNewUserObject(userData);\n\t\t\t\treturn {\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t_id: Random.id(),\n\n\t\t\t\t\tstatus: 'offline',\n\t\t\t\t\t...user,\n\t\t\t\t\troles: userData.roles?.length ? userData.roles : ['user'],\n\t\t\t\t\tactive: !userData.deleted,\n\t\t\t\t\tservices: {\n\t\t\t\t\t\t...user.services,\n\t\t\t\t\t\t...(this._options.enableEmail2fa\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\temail2fa: {\n\t\t\t\t\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\t\t\t\t\tchangedAt: new Date(),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: {}),\n\t\t\t\t\t},\n\t\t\t\t} as IUser;\n\t\t\t}),\n\t\t);\n\t}\n\n\tasync insertUser(userData: IImportUser): Promise<IUser['_id']> {\n\t\tconst user = await this.buildNewUserObject(userData);\n\n\t\treturn Accounts.insertUserDoc(\n\t\t\t{\n\t\t\t\tjoinDefaultChannels: false,\n\t\t\t\tskipEmailValidation: true,\n\t\t\t\tskipAdminCheck: true,\n\t\t\t\tskipAdminEmail: true,\n\t\t\t\tskipOnCreateUserCallback: this._options.skipUserCallbacks,\n\t\t\t\tskipBeforeCreateUserCallback: this._options.skipUserCallbacks,\n\t\t\t\tskipAfterCreateUserCallback: this._options.skipUserCallbacks,\n\t\t\t\tskipDefaultAvatar: true,\n\t\t\t\tskipAppsEngineEvent: !!process.env.IMPORTER_SKIP_APPS_EVENT,\n\t\t\t},\n\t\t\t{\n\t\t\t\t...user,\n\t\t\t\t...(userData.roles?.length ? { globalRoles: userData.roles } : {}),\n\t\t\t},\n\t\t);\n\t}\n\n\tprotected guessNameFromUsername(username: string): string {\n\t\treturn username\n\t\t\t.replace(/\\W/g, ' ')\n\t\t\t.replace(/\\s(.)/g, (u) => u.toUpperCase())\n\t\t\t.replace(/^(.)/, (u) => u.toLowerCase())\n\t\t\t.replace(/^\\w/, (u) => u.toUpperCase());\n\t}\n\n\tprotected getDataType(): 'user' {\n\t\treturn 'user';\n\t}\n}\n"],"names":["UserConverter","RecordConverter","convertRecord","record","data","_id","importIds","filter","item","emails","length","username","Error","existingUser","findExistingUser","_options","skipExistingUsers","skipRecord","skipNewUsers","insertOrUpdateUser","convertData","userCallbacks","insertedIds","clear","updatedIds","quickUserInsertion","batchConversion","systemCallbacks","run","inserted","updated","skipped","skippedCount","failed","failedCount","afterBatchFn","callbacks","batchToInsert","Set","iterateRecords","processRecord","add","size","usersToInsert","buildUserBatch","newIds","insertUserBatch","forEach","id","undefined","users","Object","values","Users","insertMany","ordered","e","result","errorCount","nInserted","Math","min","emailUser","findOneByEmailAddress","findOneByUsernameIgnoringCase","addUserImportId","updateData","userData","$addToSet","$each","addUserEmails","existingEmails","verifyEmails","Boolean","flagEmailsAsVerified","newEmailList","email","verified","find","ee","address","push","$set","addUserServices","services","serviceKey","service","key","addCustomFields","customFields","subset","source","currentPath","hasOwnProperty","keyPath","Array","isArray","map","generateUsernameSuggestion","name","updateUser","guessNameFromUsername","userId","insertUser","skipDefaultChannels","insertedUser","findOneById","addUserToDefaultChannels","roles","type","assign","create","statusText","bio","ldap","avatarUrl","_pendingAvatarUrl","keys","updateOne","utcOffset","setUtcOffset","saveUserIdentity","_cache","addUser","deleted","active","setUserActiveStatus","notifyOnUserChange","clientAction","diff","hashPassword","password","bcryptHash","SHA256","Accounts","_bcryptRounds","generateTempPassword","Date","now","toUpperCase","buildNewUserObject","bcrypt","voipExtension","freeSwitchExtension","usersData","Promise","all","user","createdAt","Random","status","enableEmail2fa","email2fa","enabled","changedAt","insertUserDoc","joinDefaultChannels","skipEmailValidation","skipAdminCheck","skipAdminEmail","skipOnCreateUserCallback","skipUserCallbacks","skipBeforeCreateUserCallback","skipAfterCreateUserCallback","skipDefaultAvatar","skipAppsEngineEvent","process","env","IMPORTER_SKIP_APPS_EVENT","globalRoles","replace","u","toLowerCase","getDataType"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/importer/server/classes/converters/UserConverter.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e30ea52795adeadfdf9855f3770fc388a274b860","contentHash":"4bd98b59e654fff86930fbd7cbafa7e8f41dbce5dde1d522d78a9d0d61600a7e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/apps/disableAppsWithAddonsCallback.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/apps/disableAppsWithAddonsCallback.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":46}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":45}},"6":{"start":{"line":19,"column":19},"end":{"line":19,"column":75}},"7":{"start":{"line":20,"column":14},"end":{"line":20,"column":52}},"8":{"start":{"line":21,"column":30},"end":{"line":21,"column":84}},"9":{"start":{"line":22,"column":14},"end":{"line":22,"column":35}},"10":{"start":{"line":24,"column":4},"end":{"line":24,"column":35}},"11":{"start":{"line":24,"column":28},"end":{"line":24,"column":35}},"12":{"start":{"line":25,"column":24},"end":{"line":27,"column":6}},"13":{"start":{"line":28,"column":4},"end":{"line":28,"column":29}},"14":{"start":{"line":28,"column":22},"end":{"line":28,"column":29}},"15":{"start":{"line":29,"column":25},"end":{"line":29,"column":27}},"16":{"start":{"line":30,"column":4},"end":{"line":35,"column":8}},"17":{"start":{"line":32,"column":8},"end":{"line":32,"column":51}},"18":{"start":{"line":32,"column":44},"end":{"line":32,"column":51}},"19":{"start":{"line":33,"column":8},"end":{"line":33,"column":41}},"20":{"start":{"line":34,"column":8},"end":{"line":34,"column":201}},"21":{"start":{"line":36,"column":4},"end":{"line":36,"column":37}},"22":{"start":{"line":36,"column":30},"end":{"line":36,"column":37}},"23":{"start":{"line":37,"column":4},"end":{"line":45,"column":7}},"24":{"start":{"line":38,"column":38},"end":{"line":44,"column":13}},"25":{"start":{"line":47,"column":38},"end":{"line":50,"column":11}},"26":{"start":{"line":47,"column":45},"end":{"line":50,"column":11}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":36},"end":{"line":12,"column":37}},"loc":{"start":{"line":12,"column":47},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":35},"end":{"line":15,"column":36}},"loc":{"start":{"line":15,"column":46},"end":{"line":17,"column":5}},"line":15},"3":{"name":"_disableAppsWithAddonsCallback","decl":{"start":{"line":23,"column":15},"end":{"line":23,"column":45}},"loc":{"start":{"line":23,"column":81},"end":{"line":46,"column":1}},"line":23},"4":{"name":"(anonymous_4)","decl":{"start":{"line":30,"column":38},"end":{"line":30,"column":39}},"loc":{"start":{"line":30,"column":51},"end":{"line":35,"column":5}},"line":30},"5":{"name":"(anonymous_5)","decl":{"start":{"line":38,"column":14},"end":{"line":38,"column":15}},"loc":{"start":{"line":38,"column":38},"end":{"line":44,"column":13}},"line":38},"6":{"name":"(anonymous_6)","decl":{"start":{"line":47,"column":38},"end":{"line":47,"column":39}},"loc":{"start":{"line":47,"column":45},"end":{"line":50,"column":11}},"line":47}},"branchMap":{"0":{"loc":{"start":{"line":24,"column":4},"end":{"line":24,"column":35}},"type":"if","locations":[{"start":{"line":24,"column":4},"end":{"line":24,"column":35}},{"start":{"line":24,"column":4},"end":{"line":24,"column":35}}],"line":24},"1":{"loc":{"start":{"line":24,"column":8},"end":{"line":24,"column":26}},"type":"binary-expr","locations":[{"start":{"line":24,"column":8},"end":{"line":24,"column":17}},{"start":{"line":24,"column":21},"end":{"line":24,"column":26}}],"line":24},"2":{"loc":{"start":{"line":28,"column":4},"end":{"line":28,"column":29}},"type":"if","locations":[{"start":{"line":28,"column":4},"end":{"line":28,"column":29}},{"start":{"line":28,"column":4},"end":{"line":28,"column":29}}],"line":28},"3":{"loc":{"start":{"line":32,"column":8},"end":{"line":32,"column":51}},"type":"if","locations":[{"start":{"line":32,"column":8},"end":{"line":32,"column":51}},{"start":{"line":32,"column":8},"end":{"line":32,"column":51}}],"line":32},"4":{"loc":{"start":{"line":34,"column":15},"end":{"line":34,"column":200}},"type":"cond-expr","locations":[{"start":{"line":34,"column":111},"end":{"line":34,"column":117}},{"start":{"line":34,"column":120},"end":{"line":34,"column":200}}],"line":34},"5":{"loc":{"start":{"line":34,"column":15},"end":{"line":34,"column":108}},"type":"binary-expr","locations":[{"start":{"line":34,"column":15},"end":{"line":34,"column":72}},{"start":{"line":34,"column":76},"end":{"line":34,"column":108}}],"line":34},"6":{"loc":{"start":{"line":36,"column":4},"end":{"line":36,"column":37}},"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":36,"column":37}},{"start":{"line":36,"column":4},"end":{"line":36,"column":37}}],"line":36},"7":{"loc":{"start":{"line":40,"column":25},"end":{"line":40,"column":51}},"type":"binary-expr","locations":[{"start":{"line":40,"column":25},"end":{"line":40,"column":43}},{"start":{"line":40,"column":47},"end":{"line":40,"column":51}}],"line":40}},"s":{"0":1,"1":1,"2":2,"3":1,"4":1,"5":0,"6":1,"7":1,"8":1,"9":1,"10":6,"11":2,"12":4,"13":4,"14":0,"15":4,"16":4,"17":5,"18":3,"19":2,"20":2,"21":4,"22":2,"23":2,"24":0,"25":1,"26":0},"f":{"0":1,"1":1,"2":0,"3":6,"4":5,"5":0,"6":0},"b":{"0":[2,4],"1":[6,5],"2":[0,4],"3":[3,2],"4":[0,2],"5":[2,2],"6":[2,2],"7":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/apps/disableAppsWithAddonsCallback.ts"],"sourcesContent":["import { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport type { LicenseImp } from '@rocket.chat/license';\n\nimport { i18n } from '../../../../server/lib/i18n';\nimport { sendMessagesToAdmins } from '../../../../server/lib/sendMessagesToAdmins';\nimport { Apps } from '../../apps';\n\ntype OnModuleCallbackParameter = Parameters<Parameters<LicenseImp['onModule']>[0]>[0];\n\nexport async function _disableAppsWithAddonsCallback(\n\tdeps: { Apps: typeof Apps; sendMessagesToAdmins: typeof sendMessagesToAdmins },\n\t{ module, external, valid }: OnModuleCallbackParameter,\n) {\n\tif (!external || valid) return;\n\n\tconst enabledApps = await deps.Apps.installedApps({ enabled: true });\n\n\tif (!enabledApps) return;\n\n\tconst affectedApps: string[] = [];\n\n\tawait Promise.all(\n\t\tenabledApps.map(async (app) => {\n\t\t\tif (app.getInfo().addon !== module) return;\n\n\t\t\taffectedApps.push(app.getName());\n\n\t\t\treturn deps.Apps.getManager()?.disable(app.getID(), AppStatus.DISABLED, false);\n\t\t}),\n\t);\n\n\tif (!affectedApps.length) return;\n\n\tawait deps.sendMessagesToAdmins({\n\t\tmsgs: async ({ adminUser }) => ({\n\t\t\tmsg: i18n.t('App_has_been_disabled_addon_message', {\n\t\t\t\tlng: adminUser.language || 'en',\n\t\t\t\tcount: affectedApps.length,\n\t\t\t\tappNames: affectedApps,\n\t\t\t}),\n\t\t}),\n\t});\n}\n\nexport const disableAppsWithAddonsCallback = (ctx: OnModuleCallbackParameter) =>\n\t_disableAppsWithAddonsCallback({ Apps, sendMessagesToAdmins }, ctx);\n"],"names":["_disableAppsWithAddonsCallback","disableAppsWithAddonsCallback","deps","module","external","valid","enabledApps","Apps","installedApps","enabled","affectedApps","Promise","all","map","app","getInfo","addon","push","getName","getManager","disable","getID","AppStatus","DISABLED","length","sendMessagesToAdmins","msgs","adminUser","msg","i18n","t","lng","language","count","appNames","ctx"],"mappings":";;;;;;;;;;;IASsBA,8BAA8B;eAA9BA;;IAmCTC,6BAA6B;eAA7BA;;;2BA5Ca;sBAGL;sCACgB;sBAChB;AAId,eAAeD,+BACrBE,IAA8E,EAC9E,EAAEC,MAAM,EAAEC,QAAQ,EAAEC,KAAK,EAA6B;IAEtD,IAAI,CAACD,YAAYC,OAAO;IAExB,MAAMC,cAAc,MAAMJ,KAAKK,IAAI,CAACC,aAAa,CAAC;QAAEC,SAAS;IAAK;IAElE,IAAI,CAACH,aAAa;IAElB,MAAMI,eAAyB,EAAE;IAEjC,MAAMC,QAAQC,GAAG,CAChBN,YAAYO,GAAG,CAAC,OAAOC;YAKfZ;QAJP,IAAIY,IAAIC,OAAO,GAAGC,KAAK,KAAKb,QAAQ;QAEpCO,aAAaO,IAAI,CAACH,IAAII,OAAO;QAE7B,QAAOhB,wBAAAA,KAAKK,IAAI,CAACY,UAAU,gBAApBjB,4CAAAA,sBAAwBkB,OAAO,CAACN,IAAIO,KAAK,IAAIC,oBAAS,CAACC,QAAQ,EAAE;IACzE;IAGD,IAAI,CAACb,aAAac,MAAM,EAAE;IAE1B,MAAMtB,KAAKuB,oBAAoB,CAAC;QAC/BC,MAAM,OAAO,EAAEC,SAAS,EAAE,GAAM,CAAA;gBAC/BC,KAAKC,UAAI,CAACC,CAAC,CAAC,uCAAuC;oBAClDC,KAAKJ,UAAUK,QAAQ,IAAI;oBAC3BC,OAAOvB,aAAac,MAAM;oBAC1BU,UAAUxB;gBACX;YACD,CAAA;IACD;AACD;AAEO,MAAMT,gCAAgC,CAACkC,MAC7CnC,+BAA+B;QAAEO,MAAAA,UAAI;QAAEkB,sBAAAA,0CAAoB;IAAC,GAAGU","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/lib/apps/disableAppsWithAddonsCallback.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b7c97fb3523d3dc62439e739bc9a398f4a48f3ee","contentHash":"c3c27a99c70d71e489190ef7e098ad4e08005f500fc1e07358f04d9320b64976"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/setUsername.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/setUsername.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":21,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":28}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":27}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":41}},"7":{"start":{"line":22,"column":22},"end":{"line":22,"column":59}},"8":{"start":{"line":23,"column":16},"end":{"line":23,"column":46}},"9":{"start":{"line":24,"column":22},"end":{"line":24,"column":53}},"10":{"start":{"line":25,"column":16},"end":{"line":25,"column":40}},"11":{"start":{"line":26,"column":34},"end":{"line":26,"column":81}},"12":{"start":{"line":27,"column":19},"end":{"line":27,"column":55}},"13":{"start":{"line":28,"column":16},"end":{"line":28,"column":63}},"14":{"start":{"line":29,"column":23},"end":{"line":29,"column":87}},"15":{"start":{"line":30,"column":16},"end":{"line":30,"column":51}},"16":{"start":{"line":31,"column":13},"end":{"line":31,"column":30}},"17":{"start":{"line":32,"column":24},"end":{"line":32,"column":56}},"18":{"start":{"line":33,"column":23},"end":{"line":33,"column":49}},"19":{"start":{"line":34,"column":35},"end":{"line":34,"column":73}},"20":{"start":{"line":35,"column":36},"end":{"line":35,"column":75}},"21":{"start":{"line":36,"column":29},"end":{"line":36,"column":61}},"22":{"start":{"line":37,"column":26},"end":{"line":37,"column":55}},"23":{"start":{"line":38,"column":23},"end":{"line":38,"column":49}},"24":{"start":{"line":39,"column":26},"end":{"line":39,"column":55}},"25":{"start":{"line":41,"column":4},"end":{"line":43,"column":6}},"26":{"start":{"line":45,"column":34},"end":{"line":91,"column":1}},"27":{"start":{"line":46,"column":4},"end":{"line":50,"column":5}},"28":{"start":{"line":47,"column":8},"end":{"line":49,"column":11}},"29":{"start":{"line":51,"column":17},"end":{"line":51,"column":56}},"30":{"start":{"line":52,"column":4},"end":{"line":56,"column":5}},"31":{"start":{"line":53,"column":8},"end":{"line":55,"column":11}},"32":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"33":{"start":{"line":58,"column":8},"end":{"line":58,"column":75}},"34":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"35":{"start":{"line":61,"column":8},"end":{"line":61,"column":15}},"36":{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},"37":{"start":{"line":64,"column":8},"end":{"line":64,"column":184}},"38":{"start":{"line":66,"column":4},"end":{"line":71,"column":5}},"39":{"start":{"line":67,"column":8},"end":{"line":70,"column":11}},"40":{"start":{"line":72,"column":4},"end":{"line":79,"column":5}},"41":{"start":{"line":76,"column":8},"end":{"line":78,"column":11}},"42":{"start":{"line":80,"column":4},"end":{"line":83,"column":5}},"43":{"start":{"line":81,"column":8},"end":{"line":81,"column":99}},"44":{"start":{"line":82,"column":8},"end":{"line":82,"column":82}},"45":{"start":{"line":82,"column":31},"end":{"line":82,"column":80}},"46":{"start":{"line":84,"column":4},"end":{"line":90,"column":7}},"47":{"start":{"line":92,"column":21},"end":{"line":153,"column":1}},"48":{"start":{"line":93,"column":21},"end":{"line":93,"column":29}},"49":{"start":{"line":94,"column":4},"end":{"line":96,"column":5}},"50":{"start":{"line":95,"column":8},"end":{"line":95,"column":21}},"51":{"start":{"line":97,"column":4},"end":{"line":99,"column":5}},"52":{"start":{"line":98,"column":8},"end":{"line":98,"column":21}},"53":{"start":{"line":100,"column":17},"end":{"line":100,"column":68}},"54":{"start":{"line":102,"column":4},"end":{"line":104,"column":5}},"55":{"start":{"line":103,"column":8},"end":{"line":103,"column":20}},"56":{"start":{"line":105,"column":29},"end":{"line":105,"column":42}},"57":{"start":{"line":107,"column":4},"end":{"line":111,"column":5}},"58":{"start":{"line":108,"column":8},"end":{"line":110,"column":9}},"59":{"start":{"line":109,"column":12},"end":{"line":109,"column":25}},"60":{"start":{"line":113,"column":4},"end":{"line":121,"column":5}},"61":{"start":{"line":114,"column":8},"end":{"line":118,"column":9}},"62":{"start":{"line":115,"column":12},"end":{"line":117,"column":15}},"63":{"start":{"line":116,"column":16},"end":{"line":116,"column":69}},"64":{"start":{"line":120,"column":8},"end":{"line":120,"column":38}},"65":{"start":{"line":123,"column":4},"end":{"line":123,"column":56}},"66":{"start":{"line":124,"column":4},"end":{"line":124,"column":29}},"67":{"start":{"line":125,"column":4},"end":{"line":139,"column":5}},"68":{"start":{"line":126,"column":34},"end":{"line":126,"column":105}},"69":{"start":{"line":128,"column":26},"end":{"line":128,"column":36}},"70":{"start":{"line":129,"column":8},"end":{"line":135,"column":9}},"71":{"start":{"line":130,"column":12},"end":{"line":130,"column":52}},"72":{"start":{"line":131,"column":12},"end":{"line":134,"column":13}},"73":{"start":{"line":132,"column":16},"end":{"line":132,"column":38}},"74":{"start":{"line":133,"column":16},"end":{"line":133,"column":22}},"75":{"start":{"line":136,"column":8},"end":{"line":138,"column":9}},"76":{"start":{"line":137,"column":12},"end":{"line":137,"column":112}},"77":{"start":{"line":141,"column":4},"end":{"line":146,"column":5}},"78":{"start":{"line":142,"column":27},"end":{"line":142,"column":78}},"79":{"start":{"line":143,"column":8},"end":{"line":145,"column":9}},"80":{"start":{"line":144,"column":12},"end":{"line":144,"column":74}},"81":{"start":{"line":147,"column":4},"end":{"line":151,"column":7}},"82":{"start":{"line":152,"column":4},"end":{"line":152,"column":16}},"83":{"start":{"line":154,"column":20},"end":{"line":159,"column":2}},"84":{"start":{"line":156,"column":23},"end":{"line":156,"column":46}},"85":{"start":{"line":157,"column":8},"end":{"line":157,"column":104}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":18},"end":{"line":12,"column":19}},"loc":{"start":{"line":12,"column":29},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":17},"end":{"line":15,"column":18}},"loc":{"start":{"line":15,"column":28},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":31},"end":{"line":18,"column":32}},"loc":{"start":{"line":18,"column":42},"end":{"line":20,"column":5}},"line":18},"4":{"name":"_interop_require_default","decl":{"start":{"line":40,"column":9},"end":{"line":40,"column":33}},"loc":{"start":{"line":40,"column":39},"end":{"line":44,"column":1}},"line":40},"5":{"name":"(anonymous_5)","decl":{"start":{"line":45,"column":34},"end":{"line":45,"column":35}},"loc":{"start":{"line":45,"column":89},"end":{"line":91,"column":1}},"line":45},"6":{"name":"(anonymous_6)","decl":{"start":{"line":82,"column":21},"end":{"line":82,"column":22}},"loc":{"start":{"line":82,"column":31},"end":{"line":82,"column":80}},"line":82},"7":{"name":"(anonymous_7)","decl":{"start":{"line":92,"column":21},"end":{"line":92,"column":22}},"loc":{"start":{"line":92,"column":57},"end":{"line":153,"column":1}},"line":92},"8":{"name":"(anonymous_8)","decl":{"start":{"line":115,"column":25},"end":{"line":115,"column":26}},"loc":{"start":{"line":115,"column":29},"end":{"line":117,"column":13}},"line":115},"9":{"name":"(anonymous_9)","decl":{"start":{"line":155,"column":4},"end":{"line":155,"column":5}},"loc":{"start":{"line":155,"column":15},"end":{"line":158,"column":5}},"line":155}},"branchMap":{"0":{"loc":{"start":{"line":41,"column":11},"end":{"line":43,"column":5}},"type":"cond-expr","locations":[{"start":{"line":41,"column":35},"end":{"line":41,"column":38}},{"start":{"line":41,"column":41},"end":{"line":43,"column":5}}],"line":41},"1":{"loc":{"start":{"line":41,"column":11},"end":{"line":41,"column":32}},"type":"binary-expr","locations":[{"start":{"line":41,"column":11},"end":{"line":41,"column":14}},{"start":{"line":41,"column":18},"end":{"line":41,"column":32}}],"line":41},"2":{"loc":{"start":{"line":46,"column":4},"end":{"line":50,"column":5}},"type":"if","locations":[{"start":{"line":46,"column":4},"end":{"line":50,"column":5}},{"start":{"line":46,"column":4},"end":{"line":50,"column":5}}],"line":46},"3":{"loc":{"start":{"line":52,"column":4},"end":{"line":56,"column":5}},"type":"if","locations":[{"start":{"line":52,"column":4},"end":{"line":56,"column":5}},{"start":{"line":52,"column":4},"end":{"line":56,"column":5}}],"line":52},"4":{"loc":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"type":"if","locations":[{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},{"start":{"line":57,"column":4},"end":{"line":59,"column":5}}],"line":57},"5":{"loc":{"start":{"line":57,"column":8},"end":{"line":57,"column":78}},"type":"binary-expr","locations":[{"start":{"line":57,"column":8},"end":{"line":57,"column":21}},{"start":{"line":57,"column":25},"end":{"line":57,"column":78}}],"line":57},"6":{"loc":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"type":"if","locations":[{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},{"start":{"line":60,"column":4},"end":{"line":62,"column":5}}],"line":60},"7":{"loc":{"start":{"line":60,"column":8},"end":{"line":60,"column":109}},"type":"binary-expr","locations":[{"start":{"line":60,"column":8},"end":{"line":60,"column":34}},{"start":{"line":60,"column":38},"end":{"line":60,"column":51}},{"start":{"line":60,"column":55},"end":{"line":60,"column":109}}],"line":60},"8":{"loc":{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},"type":"if","locations":[{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},{"start":{"line":63,"column":4},"end":{"line":65,"column":5}}],"line":63},"9":{"loc":{"start":{"line":66,"column":4},"end":{"line":71,"column":5}},"type":"if","locations":[{"start":{"line":66,"column":4},"end":{"line":71,"column":5}},{"start":{"line":66,"column":4},"end":{"line":71,"column":5}}],"line":66},"10":{"loc":{"start":{"line":72,"column":4},"end":{"line":79,"column":5}},"type":"if","locations":[{"start":{"line":72,"column":4},"end":{"line":79,"column":5}},{"start":{"line":72,"column":4},"end":{"line":79,"column":5}}],"line":72},"11":{"loc":{"start":{"line":80,"column":4},"end":{"line":83,"column":5}},"type":"if","locations":[{"start":{"line":80,"column":4},"end":{"line":83,"column":5}},{"start":{"line":80,"column":4},"end":{"line":83,"column":5}}],"line":80},"12":{"loc":{"start":{"line":94,"column":4},"end":{"line":96,"column":5}},"type":"if","locations":[{"start":{"line":94,"column":4},"end":{"line":96,"column":5}},{"start":{"line":94,"column":4},"end":{"line":96,"column":5}}],"line":94},"13":{"loc":{"start":{"line":94,"column":8},"end":{"line":94,"column":28}},"type":"binary-expr","locations":[{"start":{"line":94,"column":8},"end":{"line":94,"column":15}},{"start":{"line":94,"column":19},"end":{"line":94,"column":28}}],"line":94},"14":{"loc":{"start":{"line":97,"column":4},"end":{"line":99,"column":5}},"type":"if","locations":[{"start":{"line":97,"column":4},"end":{"line":99,"column":5}},{"start":{"line":97,"column":4},"end":{"line":99,"column":5}}],"line":97},"15":{"loc":{"start":{"line":100,"column":17},"end":{"line":100,"column":68}},"type":"binary-expr","locations":[{"start":{"line":100,"column":17},"end":{"line":100,"column":25}},{"start":{"line":100,"column":29},"end":{"line":100,"column":68}}],"line":100},"16":{"loc":{"start":{"line":102,"column":4},"end":{"line":104,"column":5}},"type":"if","locations":[{"start":{"line":102,"column":4},"end":{"line":104,"column":5}},{"start":{"line":102,"column":4},"end":{"line":104,"column":5}}],"line":102},"17":{"loc":{"start":{"line":107,"column":4},"end":{"line":111,"column":5}},"type":"if","locations":[{"start":{"line":107,"column":4},"end":{"line":111,"column":5}},{"start":{"line":107,"column":4},"end":{"line":111,"column":5}}],"line":107},"18":{"loc":{"start":{"line":107,"column":8},"end":{"line":107,"column":89}},"type":"binary-expr","locations":[{"start":{"line":107,"column":8},"end":{"line":107,"column":25}},{"start":{"line":107,"column":29},"end":{"line":107,"column":89}}],"line":107},"19":{"loc":{"start":{"line":108,"column":8},"end":{"line":110,"column":9}},"type":"if","locations":[{"start":{"line":108,"column":8},"end":{"line":110,"column":9}},{"start":{"line":108,"column":8},"end":{"line":110,"column":9}}],"line":108},"20":{"loc":{"start":{"line":114,"column":8},"end":{"line":118,"column":9}},"type":"if","locations":[{"start":{"line":114,"column":8},"end":{"line":118,"column":9}},{"start":{"line":114,"column":8},"end":{"line":118,"column":9}}],"line":114},"21":{"loc":{"start":{"line":114,"column":12},"end":{"line":114,"column":123}},"type":"binary-expr","locations":[{"start":{"line":114,"column":12},"end":{"line":114,"column":29}},{"start":{"line":114,"column":33},"end":{"line":114,"column":44}},{"start":{"line":114,"column":48},"end":{"line":114,"column":70}},{"start":{"line":114,"column":74},"end":{"line":114,"column":123}}],"line":114},"22":{"loc":{"start":{"line":125,"column":4},"end":{"line":139,"column":5}},"type":"if","locations":[{"start":{"line":125,"column":4},"end":{"line":139,"column":5}},{"start":{"line":125,"column":4},"end":{"line":139,"column":5}}],"line":125},"23":{"loc":{"start":{"line":125,"column":8},"end":{"line":125,"column":87}},"type":"binary-expr","locations":[{"start":{"line":125,"column":8},"end":{"line":125,"column":25}},{"start":{"line":125,"column":29},"end":{"line":125,"column":87}}],"line":125},"24":{"loc":{"start":{"line":131,"column":12},"end":{"line":134,"column":13}},"type":"if","locations":[{"start":{"line":131,"column":12},"end":{"line":134,"column":13}},{"start":{"line":131,"column":12},"end":{"line":134,"column":13}}],"line":131},"25":{"loc":{"start":{"line":136,"column":8},"end":{"line":138,"column":9}},"type":"if","locations":[{"start":{"line":136,"column":8},"end":{"line":138,"column":9}},{"start":{"line":136,"column":8},"end":{"line":138,"column":9}}],"line":136},"26":{"loc":{"start":{"line":141,"column":4},"end":{"line":146,"column":5}},"type":"if","locations":[{"start":{"line":141,"column":4},"end":{"line":146,"column":5}},{"start":{"line":141,"column":4},"end":{"line":146,"column":5}}],"line":141},"27":{"loc":{"start":{"line":141,"column":8},"end":{"line":141,"column":45}},"type":"binary-expr","locations":[{"start":{"line":141,"column":8},"end":{"line":141,"column":25}},{"start":{"line":141,"column":29},"end":{"line":141,"column":45}}],"line":141},"28":{"loc":{"start":{"line":143,"column":8},"end":{"line":145,"column":9}},"type":"if","locations":[{"start":{"line":143,"column":8},"end":{"line":145,"column":9}},{"start":{"line":143,"column":8},"end":{"line":145,"column":9}}],"line":143},"29":{"loc":{"start":{"line":143,"column":12},"end":{"line":143,"column":82}},"type":"cond-expr","locations":[{"start":{"line":143,"column":59},"end":{"line":143,"column":65}},{"start":{"line":143,"column":68},"end":{"line":143,"column":82}}],"line":143},"30":{"loc":{"start":{"line":143,"column":12},"end":{"line":143,"column":56}},"type":"binary-expr","locations":[{"start":{"line":143,"column":12},"end":{"line":143,"column":31}},{"start":{"line":143,"column":35},"end":{"line":143,"column":56}}],"line":143},"31":{"loc":{"start":{"line":157,"column":15},"end":{"line":157,"column":103}},"type":"binary-expr","locations":[{"start":{"line":157,"column":15},"end":{"line":157,"column":22}},{"start":{"line":157,"column":26},"end":{"line":157,"column":103}}],"line":157}},"s":{"0":1,"1":1,"2":3,"3":1,"4":1,"5":0,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":6,"28":1,"29":5,"30":5,"31":1,"32":4,"33":1,"34":3,"35":0,"36":3,"37":1,"38":2,"39":1,"40":1,"41":0,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":10,"49":10,"50":1,"51":9,"52":1,"53":8,"54":8,"55":1,"56":7,"57":7,"58":7,"59":0,"60":7,"61":7,"62":0,"63":0,"64":0,"65":7,"66":7,"67":7,"68":3,"69":3,"70":3,"71":2,"72":2,"73":0,"74":0,"75":3,"76":2,"77":7,"78":1,"79":1,"80":1,"81":7,"82":7,"83":1,"84":0,"85":0},"f":{"0":1,"1":1,"2":0,"3":1,"4":1,"5":6,"6":1,"7":10,"8":0,"9":0},"b":{"0":[0,1],"1":[1,1],"2":[1,5],"3":[1,4],"4":[1,3],"5":[4,1],"6":[0,3],"7":[3,3,0],"8":[1,2],"9":[1,1],"10":[0,1],"11":[1,0],"12":[1,9],"13":[10,9],"14":[1,8],"15":[8,0],"16":[1,7],"17":[7,0],"18":[7,2],"19":[0,7],"20":[0,7],"21":[7,5,1,1],"22":[3,4],"23":[7,5],"24":[0,2],"25":[2,1],"26":[1,6],"27":[7,5],"28":[1,0],"29":[0,1],"30":[1,1],"31":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/setUsername.ts"],"sourcesContent":["import { api } from '@rocket.chat/core-services';\nimport type { IUser } from '@rocket.chat/core-typings';\nimport { Invites, Users } from '@rocket.chat/models';\nimport { Accounts } from 'meteor/accounts-base';\nimport { Meteor } from 'meteor/meteor';\nimport _ from 'underscore';\n\nimport { callbacks } from '../../../../lib/callbacks';\nimport { SystemLogger } from '../../../../server/lib/logger/system';\nimport { hasPermissionAsync } from '../../../authorization/server/functions/hasPermission';\nimport { settings } from '../../../settings/server';\nimport { RateLimiter } from '../lib';\nimport { notifyOnUserChange } from '../lib/notifyListener';\nimport { addUserToRoom } from './addUserToRoom';\nimport { checkUsernameAvailability } from './checkUsernameAvailability';\nimport { getAvatarSuggestionForUser } from './getAvatarSuggestionForUser';\nimport { joinDefaultChannels } from './joinDefaultChannels';\nimport { saveUserIdentity } from './saveUserIdentity';\nimport { setUserAvatar } from './setUserAvatar';\nimport { validateUsername } from './validateUsername';\n\nexport const setUsernameWithValidation = async (userId: string, username: string, joinDefaultChannelsSilenced?: boolean): Promise<void> => {\n\tif (!username) {\n\t\tthrow new Meteor.Error('error-invalid-username', 'Invalid username', { method: 'setUsername' });\n\t}\n\n\tconst user = await Users.findOneById(userId);\n\n\tif (!user) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setUsername' });\n\t}\n\n\tif (user.username && !settings.get('Accounts_AllowUsernameChange')) {\n\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed');\n\t}\n\n\tif (user.username === username || (user.username && user.username.toLowerCase() === username.toLowerCase())) {\n\t\treturn;\n\t}\n\n\tif (!validateUsername(username)) {\n\t\tthrow new Meteor.Error(\n\t\t\t'username-invalid',\n\t\t\t`${_.escape(username)} is not a valid username, use only letters, numbers, dots, hyphens and underscores`,\n\t\t);\n\t}\n\n\tif (!(await checkUsernameAvailability(username))) {\n\t\tthrow new Meteor.Error('error-field-unavailable', `<strong>${_.escape(username)}</strong> is already in use :(`, {\n\t\t\tmethod: 'setUsername',\n\t\t\tfield: username,\n\t\t});\n\t}\n\n\tif (!(await saveUserIdentity({ _id: user._id, username }))) {\n\t\tthrow new Meteor.Error('error-could-not-change-username', 'Could not change username', {\n\t\t\tmethod: 'setUsername',\n\t\t});\n\t}\n\n\tif (!user.username) {\n\t\tawait joinDefaultChannels(user._id, joinDefaultChannelsSilenced);\n\t\tsetImmediate(async () => callbacks.run('afterCreateUser', user));\n\t}\n\n\tvoid notifyOnUserChange({ clientAction: 'updated', id: user._id, diff: { username } });\n};\n\nexport const _setUsername = async function (userId: string, u: string, fullUser: IUser): Promise<unknown> {\n\tconst username = u.trim();\n\n\tif (!userId || !username) {\n\t\treturn false;\n\t}\n\n\tif (!validateUsername(username)) {\n\t\treturn false;\n\t}\n\n\tconst user = fullUser || (await Users.findOneById(userId));\n\t// User already has desired username, return\n\tif (user.username === username) {\n\t\treturn user;\n\t}\n\tconst previousUsername = user.username;\n\t// Check username availability or if the user already owns a different casing of the name\n\tif (!previousUsername || !(username.toLowerCase() === previousUsername.toLowerCase())) {\n\t\tif (!(await checkUsernameAvailability(username))) {\n\t\t\treturn false;\n\t\t}\n\t}\n\t// If first time setting username, send Enrollment Email\n\ttry {\n\t\tif (!previousUsername && user.emails && user.emails.length > 0 && settings.get('Accounts_Enrollment_Email')) {\n\t\t\tsetImmediate(() => {\n\t\t\t\tAccounts.sendEnrollmentEmail(user._id);\n\t\t\t});\n\t\t}\n\t} catch (e: any) {\n\t\tSystemLogger.error(e);\n\t}\n\t// Set new username*\n\tawait Users.setUsername(user._id, username);\n\tuser.username = username;\n\n\tif (!previousUsername && settings.get('Accounts_SetDefaultAvatar') === true) {\n\t\tconst avatarSuggestions = await getAvatarSuggestionForUser(user);\n\t\tlet avatarData;\n\t\tlet serviceName = 'gravatar';\n\n\t\tfor (const service of Object.keys(avatarSuggestions)) {\n\t\t\tavatarData = avatarSuggestions[service];\n\t\t\tif (service !== 'gravatar') {\n\t\t\t\tserviceName = service;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (avatarData) {\n\t\t\tawait setUserAvatar(user, avatarData.blob, avatarData.contentType, serviceName);\n\t\t}\n\t}\n\n\t// If it's the first username and the user has an invite Token, then join the invite room\n\tif (!previousUsername && user.inviteToken) {\n\t\tconst inviteData = await Invites.findOneById(user.inviteToken);\n\t\tif (inviteData?.rid) {\n\t\t\tawait addUserToRoom(inviteData.rid, user);\n\t\t}\n\t}\n\n\tvoid api.broadcast('user.nameChanged', {\n\t\t_id: user._id,\n\t\tname: user.name,\n\t\tusername: user.username,\n\t});\n\n\treturn user;\n};\n\nexport const setUsername = RateLimiter.limitFunction(_setUsername, 1, 60000, {\n\tasync 0() {\n\t\tconst userId = Meteor.userId();\n\t\treturn !userId || !(await hasPermissionAsync(userId, 'edit-other-user-info'));\n\t},\n});\n"],"names":["_setUsername","setUsername","setUsernameWithValidation","userId","username","joinDefaultChannelsSilenced","Meteor","Error","method","user","Users","findOneById","settings","get","toLowerCase","validateUsername","_","escape","checkUsernameAvailability","field","saveUserIdentity","_id","joinDefaultChannels","setImmediate","callbacks","run","notifyOnUserChange","clientAction","id","diff","u","fullUser","trim","previousUsername","emails","length","Accounts","sendEnrollmentEmail","e","SystemLogger","error","avatarSuggestions","getAvatarSuggestionForUser","avatarData","serviceName","service","Object","keys","setUserAvatar","blob","contentType","inviteToken","inviteData","Invites","rid","addUserToRoom","api","broadcast","name","RateLimiter","limitFunction","hasPermissionAsync"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/setUsername.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"383684d4b83a1091a4f186249f754bed97aaf2c4","contentHash":"5cadfb3907cfb7332923030974bf355e2bd467193067e3e7b1ae36d2e3a025a8"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/lib/notifyListener.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/lib/notifyListener.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":141,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":37}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":41}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":42}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":52}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":46}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":50}},"10":{"start":{"line":31,"column":8},"end":{"line":31,"column":49}},"11":{"start":{"line":34,"column":8},"end":{"line":34,"column":53}},"12":{"start":{"line":37,"column":8},"end":{"line":37,"column":54}},"13":{"start":{"line":40,"column":8},"end":{"line":40,"column":77}},"14":{"start":{"line":43,"column":8},"end":{"line":43,"column":68}},"15":{"start":{"line":46,"column":8},"end":{"line":46,"column":46}},"16":{"start":{"line":49,"column":8},"end":{"line":49,"column":50}},"17":{"start":{"line":52,"column":8},"end":{"line":52,"column":52}},"18":{"start":{"line":55,"column":8},"end":{"line":55,"column":53}},"19":{"start":{"line":58,"column":8},"end":{"line":58,"column":47}},"20":{"start":{"line":61,"column":8},"end":{"line":61,"column":56}},"21":{"start":{"line":64,"column":8},"end":{"line":64,"column":65}},"22":{"start":{"line":67,"column":8},"end":{"line":67,"column":37}},"23":{"start":{"line":70,"column":8},"end":{"line":70,"column":43}},"24":{"start":{"line":73,"column":8},"end":{"line":73,"column":41}},"25":{"start":{"line":76,"column":8},"end":{"line":76,"column":45}},"26":{"start":{"line":79,"column":8},"end":{"line":79,"column":35}},"27":{"start":{"line":82,"column":8},"end":{"line":82,"column":39}},"28":{"start":{"line":85,"column":8},"end":{"line":85,"column":35}},"29":{"start":{"line":88,"column":8},"end":{"line":88,"column":39}},"30":{"start":{"line":91,"column":8},"end":{"line":91,"column":43}},"31":{"start":{"line":94,"column":8},"end":{"line":94,"column":52}},"32":{"start":{"line":97,"column":8},"end":{"line":97,"column":38}},"33":{"start":{"line":100,"column":8},"end":{"line":100,"column":42}},"34":{"start":{"line":103,"column":8},"end":{"line":103,"column":43}},"35":{"start":{"line":106,"column":8},"end":{"line":106,"column":67}},"36":{"start":{"line":109,"column":8},"end":{"line":109,"column":47}},"37":{"start":{"line":112,"column":8},"end":{"line":112,"column":60}},"38":{"start":{"line":115,"column":8},"end":{"line":115,"column":51}},"39":{"start":{"line":118,"column":8},"end":{"line":118,"column":60}},"40":{"start":{"line":121,"column":8},"end":{"line":121,"column":61}},"41":{"start":{"line":124,"column":8},"end":{"line":124,"column":51}},"42":{"start":{"line":127,"column":8},"end":{"line":127,"column":62}},"43":{"start":{"line":130,"column":8},"end":{"line":130,"column":60}},"44":{"start":{"line":133,"column":8},"end":{"line":133,"column":34}},"45":{"start":{"line":136,"column":8},"end":{"line":136,"column":39}},"46":{"start":{"line":139,"column":8},"end":{"line":139,"column":38}},"47":{"start":{"line":142,"column":22},"end":{"line":142,"column":59}},"48":{"start":{"line":143,"column":16},"end":{"line":143,"column":46}},"49":{"start":{"line":144,"column":27},"end":{"line":144,"column":67}},"50":{"start":{"line":145,"column":23},"end":{"line":145,"column":63}},"51":{"start":{"line":146,"column":27},"end":{"line":146,"column":92}},"52":{"start":{"line":148,"column":4},"end":{"line":150,"column":6}},"53":{"start":{"line":153,"column":4},"end":{"line":153,"column":73}},"54":{"start":{"line":153,"column":55},"end":{"line":153,"column":72}},"55":{"start":{"line":155,"column":40},"end":{"line":164,"column":2}},"56":{"start":{"line":156,"column":29},"end":{"line":156,"column":33}},"57":{"start":{"line":157,"column":4},"end":{"line":163,"column":7}},"58":{"start":{"line":165,"column":28},"end":{"line":175,"column":2}},"59":{"start":{"line":166,"column":18},"end":{"line":168,"column":5}},"60":{"start":{"line":169,"column":4},"end":{"line":174,"column":5}},"61":{"start":{"line":170,"column":8},"end":{"line":173,"column":11}},"62":{"start":{"line":176,"column":32},"end":{"line":187,"column":2}},"63":{"start":{"line":177,"column":24},"end":{"line":179,"column":5}},"64":{"start":{"line":180,"column":18},"end":{"line":180,"column":54}},"65":{"start":{"line":181,"column":4},"end":{"line":186,"column":5}},"66":{"start":{"line":182,"column":8},"end":{"line":185,"column":11}},"67":{"start":{"line":188,"column":45},"end":{"line":196,"column":2}},"68":{"start":{"line":189,"column":18},"end":{"line":189,"column":70}},"69":{"start":{"line":190,"column":4},"end":{"line":195,"column":5}},"70":{"start":{"line":191,"column":8},"end":{"line":194,"column":11}},"71":{"start":{"line":197,"column":36},"end":{"line":207,"column":2}},"72":{"start":{"line":198,"column":18},"end":{"line":200,"column":6}},"73":{"start":{"line":201,"column":4},"end":{"line":206,"column":5}},"74":{"start":{"line":202,"column":8},"end":{"line":205,"column":11}},"75":{"start":{"line":208,"column":34},"end":{"line":220,"column":2}},"76":{"start":{"line":209,"column":4},"end":{"line":212,"column":7}},"77":{"start":{"line":213,"column":4},"end":{"line":219,"column":5}},"78":{"start":{"line":214,"column":24},"end":{"line":214,"column":89}},"79":{"start":{"line":215,"column":8},"end":{"line":217,"column":9}},"80":{"start":{"line":216,"column":12},"end":{"line":216,"column":19}},"81":{"start":{"line":218,"column":8},"end":{"line":218,"column":56}},"82":{"start":{"line":221,"column":38},"end":{"line":227,"column":2}},"83":{"start":{"line":222,"column":23},"end":{"line":222,"column":65}},"84":{"start":{"line":223,"column":4},"end":{"line":225,"column":5}},"85":{"start":{"line":224,"column":8},"end":{"line":224,"column":15}},"86":{"start":{"line":226,"column":4},"end":{"line":226,"column":63}},"87":{"start":{"line":228,"column":36},"end":{"line":238,"column":2}},"88":{"start":{"line":229,"column":17},"end":{"line":229,"column":56}},"89":{"start":{"line":230,"column":4},"end":{"line":232,"column":5}},"90":{"start":{"line":231,"column":8},"end":{"line":231,"column":15}},"91":{"start":{"line":233,"column":4},"end":{"line":237,"column":7}},"92":{"start":{"line":239,"column":28},"end":{"line":244,"column":2}},"93":{"start":{"line":240,"column":4},"end":{"line":243,"column":7}},"94":{"start":{"line":245,"column":32},"end":{"line":251,"column":2}},"95":{"start":{"line":246,"column":17},"end":{"line":246,"column":52}},"96":{"start":{"line":247,"column":4},"end":{"line":249,"column":5}},"97":{"start":{"line":248,"column":8},"end":{"line":248,"column":15}},"98":{"start":{"line":250,"column":4},"end":{"line":250,"column":49}},"99":{"start":{"line":252,"column":49},"end":{"line":258,"column":2}},"100":{"start":{"line":253,"column":4},"end":{"line":257,"column":7}},"101":{"start":{"line":259,"column":58},"end":{"line":269,"column":2}},"102":{"start":{"line":260,"column":17},"end":{"line":264,"column":6}},"103":{"start":{"line":265,"column":4},"end":{"line":267,"column":5}},"104":{"start":{"line":266,"column":8},"end":{"line":266,"column":15}},"105":{"start":{"line":268,"column":4},"end":{"line":268,"column":70}},"106":{"start":{"line":270,"column":35},"end":{"line":276,"column":2}},"107":{"start":{"line":271,"column":4},"end":{"line":275,"column":7}},"108":{"start":{"line":277,"column":39},"end":{"line":287,"column":2}},"109":{"start":{"line":278,"column":17},"end":{"line":278,"column":59}},"110":{"start":{"line":279,"column":4},"end":{"line":281,"column":5}},"111":{"start":{"line":280,"column":8},"end":{"line":280,"column":15}},"112":{"start":{"line":282,"column":4},"end":{"line":286,"column":7}},"113":{"start":{"line":288,"column":43},"end":{"line":297,"column":2}},"114":{"start":{"line":289,"column":18},"end":{"line":289,"column":55}},"115":{"start":{"line":290,"column":4},"end":{"line":296,"column":5}},"116":{"start":{"line":291,"column":8},"end":{"line":295,"column":11}},"117":{"start":{"line":298,"column":45},"end":{"line":307,"column":2}},"118":{"start":{"line":299,"column":18},"end":{"line":299,"column":63}},"119":{"start":{"line":300,"column":4},"end":{"line":306,"column":5}},"120":{"start":{"line":301,"column":8},"end":{"line":305,"column":11}},"121":{"start":{"line":308,"column":34},"end":{"line":314,"column":2}},"122":{"start":{"line":309,"column":4},"end":{"line":313,"column":7}},"123":{"start":{"line":315,"column":39},"end":{"line":326,"column":2}},"124":{"start":{"line":316,"column":18},"end":{"line":318,"column":5}},"125":{"start":{"line":319,"column":4},"end":{"line":325,"column":5}},"126":{"start":{"line":320,"column":8},"end":{"line":324,"column":11}},"127":{"start":{"line":327,"column":43},"end":{"line":337,"column":2}},"128":{"start":{"line":328,"column":20},"end":{"line":328,"column":147}},"129":{"start":{"line":329,"column":4},"end":{"line":331,"column":5}},"130":{"start":{"line":330,"column":8},"end":{"line":330,"column":15}},"131":{"start":{"line":332,"column":4},"end":{"line":336,"column":7}},"132":{"start":{"line":338,"column":45},"end":{"line":348,"column":2}},"133":{"start":{"line":339,"column":20},"end":{"line":339,"column":74}},"134":{"start":{"line":340,"column":4},"end":{"line":342,"column":5}},"135":{"start":{"line":341,"column":8},"end":{"line":341,"column":15}},"136":{"start":{"line":343,"column":4},"end":{"line":347,"column":7}},"137":{"start":{"line":349,"column":46},"end":{"line":359,"column":2}},"138":{"start":{"line":350,"column":20},"end":{"line":350,"column":71}},"139":{"start":{"line":351,"column":4},"end":{"line":353,"column":5}},"140":{"start":{"line":352,"column":8},"end":{"line":352,"column":15}},"141":{"start":{"line":354,"column":4},"end":{"line":358,"column":7}},"142":{"start":{"line":360,"column":42},"end":{"line":367,"column":2}},"143":{"start":{"line":361,"column":4},"end":{"line":366,"column":7}},"144":{"start":{"line":368,"column":46},"end":{"line":379,"column":2}},"145":{"start":{"line":369,"column":17},"end":{"line":369,"column":65}},"146":{"start":{"line":370,"column":4},"end":{"line":372,"column":5}},"147":{"start":{"line":371,"column":8},"end":{"line":371,"column":15}},"148":{"start":{"line":373,"column":4},"end":{"line":378,"column":7}},"149":{"start":{"line":380,"column":47},"end":{"line":386,"column":2}},"150":{"start":{"line":381,"column":4},"end":{"line":385,"column":7}},"151":{"start":{"line":387,"column":61},"end":{"line":402,"column":2}},"152":{"start":{"line":388,"column":18},"end":{"line":394,"column":6}},"153":{"start":{"line":395,"column":4},"end":{"line":401,"column":5}},"154":{"start":{"line":396,"column":8},"end":{"line":400,"column":11}},"155":{"start":{"line":403,"column":70},"end":{"line":418,"column":2}},"156":{"start":{"line":404,"column":18},"end":{"line":410,"column":6}},"157":{"start":{"line":411,"column":4},"end":{"line":417,"column":5}},"158":{"start":{"line":412,"column":8},"end":{"line":416,"column":11}},"159":{"start":{"line":419,"column":31},"end":{"line":424,"column":2}},"160":{"start":{"line":420,"column":4},"end":{"line":423,"column":7}},"161":{"start":{"line":425,"column":35},"end":{"line":434,"column":2}},"162":{"start":{"line":426,"column":17},"end":{"line":426,"column":130}},"163":{"start":{"line":427,"column":4},"end":{"line":429,"column":5}},"164":{"start":{"line":428,"column":8},"end":{"line":428,"column":15}},"165":{"start":{"line":430,"column":4},"end":{"line":433,"column":7}},"166":{"start":{"line":435,"column":27},"end":{"line":457,"column":2}},"167":{"start":{"line":436,"column":4},"end":{"line":442,"column":5}},"168":{"start":{"line":437,"column":8},"end":{"line":440,"column":11}},"169":{"start":{"line":441,"column":8},"end":{"line":441,"column":15}},"170":{"start":{"line":443,"column":4},"end":{"line":450,"column":5}},"171":{"start":{"line":444,"column":8},"end":{"line":448,"column":11}},"172":{"start":{"line":449,"column":8},"end":{"line":449,"column":15}},"173":{"start":{"line":451,"column":4},"end":{"line":456,"column":7}},"174":{"start":{"line":458,"column":32},"end":{"line":468,"column":2}},"175":{"start":{"line":459,"column":19},"end":{"line":459,"column":29}},"176":{"start":{"line":460,"column":4},"end":{"line":462,"column":5}},"177":{"start":{"line":461,"column":8},"end":{"line":461,"column":15}},"178":{"start":{"line":463,"column":4},"end":{"line":466,"column":5}},"179":{"start":{"line":464,"column":8},"end":{"line":464,"column":51}},"180":{"start":{"line":464,"column":28},"end":{"line":464,"column":49}},"181":{"start":{"line":465,"column":8},"end":{"line":465,"column":15}},"182":{"start":{"line":467,"column":4},"end":{"line":467,"column":38}},"183":{"start":{"line":469,"column":31},"end":{"line":479,"column":2}},"184":{"start":{"line":470,"column":17},"end":{"line":470,"column":52}},"185":{"start":{"line":471,"column":4},"end":{"line":473,"column":5}},"186":{"start":{"line":472,"column":8},"end":{"line":472,"column":15}},"187":{"start":{"line":474,"column":4},"end":{"line":478,"column":7}},"188":{"start":{"line":480,"column":26},"end":{"line":489,"column":2}},"189":{"start":{"line":481,"column":17},"end":{"line":485,"column":6}},"190":{"start":{"line":486,"column":4},"end":{"line":486,"column":65}},"191":{"start":{"line":490,"column":25},"end":{"line":492,"column":2}},"192":{"start":{"line":490,"column":60},"end":{"line":490,"column":98}},"193":{"start":{"line":494,"column":20},"end":{"line":494,"column":100}},"194":{"start":{"line":495,"column":4},"end":{"line":497,"column":5}},"195":{"start":{"line":496,"column":8},"end":{"line":496,"column":15}},"196":{"start":{"line":498,"column":4},"end":{"line":504,"column":5}},"197":{"start":{"line":499,"column":37},"end":{"line":499,"column":83}},"198":{"start":{"line":500,"column":27},"end":{"line":500,"column":107}},"199":{"start":{"line":501,"column":8},"end":{"line":503,"column":9}},"200":{"start":{"line":502,"column":12},"end":{"line":502,"column":19}},"201":{"start":{"line":505,"column":4},"end":{"line":507,"column":5}},"202":{"start":{"line":506,"column":8},"end":{"line":506,"column":15}},"203":{"start":{"line":508,"column":24},"end":{"line":508,"column":75}},"204":{"start":{"line":509,"column":4},"end":{"line":525,"column":5}},"205":{"start":{"line":511,"column":8},"end":{"line":516,"column":9}},"206":{"start":{"line":512,"column":25},"end":{"line":512,"column":63}},"207":{"start":{"line":513,"column":12},"end":{"line":515,"column":13}},"208":{"start":{"line":514,"column":16},"end":{"line":514,"column":38}},"209":{"start":{"line":517,"column":8},"end":{"line":524,"column":9}},"210":{"start":{"line":518,"column":12},"end":{"line":523,"column":13}},"211":{"start":{"line":519,"column":29},"end":{"line":519,"column":65}},"212":{"start":{"line":520,"column":16},"end":{"line":522,"column":17}},"213":{"start":{"line":521,"column":20},"end":{"line":521,"column":40}},"214":{"start":{"line":526,"column":4},"end":{"line":526,"column":19}},"215":{"start":{"line":528,"column":30},"end":{"line":539,"column":2}},"216":{"start":{"line":529,"column":20},"end":{"line":532,"column":6}},"217":{"start":{"line":533,"column":4},"end":{"line":535,"column":5}},"218":{"start":{"line":534,"column":8},"end":{"line":534,"column":15}},"219":{"start":{"line":536,"column":4},"end":{"line":538,"column":7}},"220":{"start":{"line":540,"column":36},"end":{"line":545,"column":2}},"221":{"start":{"line":541,"column":4},"end":{"line":544,"column":7}},"222":{"start":{"line":546,"column":53},"end":{"line":558,"column":2}},"223":{"start":{"line":547,"column":19},"end":{"line":551,"column":6}},"224":{"start":{"line":552,"column":4},"end":{"line":557,"column":7}},"225":{"start":{"line":553,"column":8},"end":{"line":556,"column":11}},"226":{"start":{"line":559,"column":40},"end":{"line":568,"column":2}},"227":{"start":{"line":560,"column":25},"end":{"line":560,"column":68}},"228":{"start":{"line":561,"column":4},"end":{"line":563,"column":5}},"229":{"start":{"line":562,"column":8},"end":{"line":562,"column":15}},"230":{"start":{"line":564,"column":4},"end":{"line":567,"column":7}},"231":{"start":{"line":569,"column":53},"end":{"line":579,"column":2}},"232":{"start":{"line":570,"column":19},"end":{"line":572,"column":6}},"233":{"start":{"line":573,"column":4},"end":{"line":578,"column":7}},"234":{"start":{"line":574,"column":8},"end":{"line":577,"column":11}},"235":{"start":{"line":580,"column":44},"end":{"line":590,"column":2}},"236":{"start":{"line":581,"column":19},"end":{"line":583,"column":6}},"237":{"start":{"line":584,"column":4},"end":{"line":589,"column":7}},"238":{"start":{"line":585,"column":8},"end":{"line":588,"column":11}},"239":{"start":{"line":591,"column":60},"end":{"line":601,"column":2}},"240":{"start":{"line":592,"column":19},"end":{"line":594,"column":6}},"241":{"start":{"line":595,"column":4},"end":{"line":600,"column":7}},"242":{"start":{"line":596,"column":8},"end":{"line":599,"column":11}},"243":{"start":{"line":602,"column":55},"end":{"line":612,"column":2}},"244":{"start":{"line":603,"column":19},"end":{"line":605,"column":6}},"245":{"start":{"line":606,"column":4},"end":{"line":611,"column":7}},"246":{"start":{"line":607,"column":8},"end":{"line":610,"column":11}},"247":{"start":{"line":613,"column":53},"end":{"line":623,"column":2}},"248":{"start":{"line":614,"column":19},"end":{"line":616,"column":6}},"249":{"start":{"line":617,"column":4},"end":{"line":622,"column":7}},"250":{"start":{"line":618,"column":8},"end":{"line":621,"column":11}},"251":{"start":{"line":624,"column":44},"end":{"line":634,"column":2}},"252":{"start":{"line":625,"column":19},"end":{"line":627,"column":6}},"253":{"start":{"line":628,"column":4},"end":{"line":633,"column":7}},"254":{"start":{"line":629,"column":8},"end":{"line":632,"column":11}},"255":{"start":{"line":635,"column":54},"end":{"line":645,"column":2}},"256":{"start":{"line":636,"column":19},"end":{"line":638,"column":6}},"257":{"start":{"line":639,"column":4},"end":{"line":644,"column":7}},"258":{"start":{"line":640,"column":8},"end":{"line":643,"column":11}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":27},"end":{"line":12,"column":28}},"loc":{"start":{"line":12,"column":38},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":31},"end":{"line":15,"column":32}},"loc":{"start":{"line":15,"column":42},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":32},"end":{"line":18,"column":33}},"loc":{"start":{"line":18,"column":43},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":42},"end":{"line":21,"column":43}},"loc":{"start":{"line":21,"column":53},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":36},"end":{"line":24,"column":37}},"loc":{"start":{"line":24,"column":47},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":40},"end":{"line":27,"column":41}},"loc":{"start":{"line":27,"column":51},"end":{"line":29,"column":5}},"line":27},"7":{"name":"(anonymous_7)","decl":{"start":{"line":30,"column":39},"end":{"line":30,"column":40}},"loc":{"start":{"line":30,"column":50},"end":{"line":32,"column":5}},"line":30},"8":{"name":"(anonymous_8)","decl":{"start":{"line":33,"column":43},"end":{"line":33,"column":44}},"loc":{"start":{"line":33,"column":54},"end":{"line":35,"column":5}},"line":33},"9":{"name":"(anonymous_9)","decl":{"start":{"line":36,"column":44},"end":{"line":36,"column":45}},"loc":{"start":{"line":36,"column":55},"end":{"line":38,"column":5}},"line":36},"10":{"name":"(anonymous_10)","decl":{"start":{"line":39,"column":67},"end":{"line":39,"column":68}},"loc":{"start":{"line":39,"column":78},"end":{"line":41,"column":5}},"line":39},"11":{"name":"(anonymous_11)","decl":{"start":{"line":42,"column":58},"end":{"line":42,"column":59}},"loc":{"start":{"line":42,"column":69},"end":{"line":44,"column":5}},"line":42},"12":{"name":"(anonymous_12)","decl":{"start":{"line":45,"column":36},"end":{"line":45,"column":37}},"loc":{"start":{"line":45,"column":47},"end":{"line":47,"column":5}},"line":45},"13":{"name":"(anonymous_13)","decl":{"start":{"line":48,"column":40},"end":{"line":48,"column":41}},"loc":{"start":{"line":48,"column":51},"end":{"line":50,"column":5}},"line":48},"14":{"name":"(anonymous_14)","decl":{"start":{"line":51,"column":42},"end":{"line":51,"column":43}},"loc":{"start":{"line":51,"column":53},"end":{"line":53,"column":5}},"line":51},"15":{"name":"(anonymous_15)","decl":{"start":{"line":54,"column":43},"end":{"line":54,"column":44}},"loc":{"start":{"line":54,"column":54},"end":{"line":56,"column":5}},"line":54},"16":{"name":"(anonymous_16)","decl":{"start":{"line":57,"column":37},"end":{"line":57,"column":38}},"loc":{"start":{"line":57,"column":48},"end":{"line":59,"column":5}},"line":57},"17":{"name":"(anonymous_17)","decl":{"start":{"line":60,"column":46},"end":{"line":60,"column":47}},"loc":{"start":{"line":60,"column":57},"end":{"line":62,"column":5}},"line":60},"18":{"name":"(anonymous_18)","decl":{"start":{"line":63,"column":55},"end":{"line":63,"column":56}},"loc":{"start":{"line":63,"column":66},"end":{"line":65,"column":5}},"line":63},"19":{"name":"(anonymous_19)","decl":{"start":{"line":66,"column":27},"end":{"line":66,"column":28}},"loc":{"start":{"line":66,"column":38},"end":{"line":68,"column":5}},"line":66},"20":{"name":"(anonymous_20)","decl":{"start":{"line":69,"column":33},"end":{"line":69,"column":34}},"loc":{"start":{"line":69,"column":44},"end":{"line":71,"column":5}},"line":69},"21":{"name":"(anonymous_21)","decl":{"start":{"line":72,"column":31},"end":{"line":72,"column":32}},"loc":{"start":{"line":72,"column":42},"end":{"line":74,"column":5}},"line":72},"22":{"name":"(anonymous_22)","decl":{"start":{"line":75,"column":35},"end":{"line":75,"column":36}},"loc":{"start":{"line":75,"column":46},"end":{"line":77,"column":5}},"line":75},"23":{"name":"(anonymous_23)","decl":{"start":{"line":78,"column":25},"end":{"line":78,"column":26}},"loc":{"start":{"line":78,"column":36},"end":{"line":80,"column":5}},"line":78},"24":{"name":"(anonymous_24)","decl":{"start":{"line":81,"column":29},"end":{"line":81,"column":30}},"loc":{"start":{"line":81,"column":40},"end":{"line":83,"column":5}},"line":81},"25":{"name":"(anonymous_25)","decl":{"start":{"line":84,"column":25},"end":{"line":84,"column":26}},"loc":{"start":{"line":84,"column":36},"end":{"line":86,"column":5}},"line":84},"26":{"name":"(anonymous_26)","decl":{"start":{"line":87,"column":29},"end":{"line":87,"column":30}},"loc":{"start":{"line":87,"column":40},"end":{"line":89,"column":5}},"line":87},"27":{"name":"(anonymous_27)","decl":{"start":{"line":90,"column":33},"end":{"line":90,"column":34}},"loc":{"start":{"line":90,"column":44},"end":{"line":92,"column":5}},"line":90},"28":{"name":"(anonymous_28)","decl":{"start":{"line":93,"column":42},"end":{"line":93,"column":43}},"loc":{"start":{"line":93,"column":53},"end":{"line":95,"column":5}},"line":93},"29":{"name":"(anonymous_29)","decl":{"start":{"line":96,"column":28},"end":{"line":96,"column":29}},"loc":{"start":{"line":96,"column":39},"end":{"line":98,"column":5}},"line":96},"30":{"name":"(anonymous_30)","decl":{"start":{"line":99,"column":32},"end":{"line":99,"column":33}},"loc":{"start":{"line":99,"column":43},"end":{"line":101,"column":5}},"line":99},"31":{"name":"(anonymous_31)","decl":{"start":{"line":102,"column":33},"end":{"line":102,"column":34}},"loc":{"start":{"line":102,"column":44},"end":{"line":104,"column":5}},"line":102},"32":{"name":"(anonymous_32)","decl":{"start":{"line":105,"column":57},"end":{"line":105,"column":58}},"loc":{"start":{"line":105,"column":68},"end":{"line":107,"column":5}},"line":105},"33":{"name":"(anonymous_33)","decl":{"start":{"line":108,"column":37},"end":{"line":108,"column":38}},"loc":{"start":{"line":108,"column":48},"end":{"line":110,"column":5}},"line":108},"34":{"name":"(anonymous_34)","decl":{"start":{"line":111,"column":50},"end":{"line":111,"column":51}},"loc":{"start":{"line":111,"column":61},"end":{"line":113,"column":5}},"line":111},"35":{"name":"(anonymous_35)","decl":{"start":{"line":114,"column":41},"end":{"line":114,"column":42}},"loc":{"start":{"line":114,"column":52},"end":{"line":116,"column":5}},"line":114},"36":{"name":"(anonymous_36)","decl":{"start":{"line":117,"column":50},"end":{"line":117,"column":51}},"loc":{"start":{"line":117,"column":61},"end":{"line":119,"column":5}},"line":117},"37":{"name":"(anonymous_37)","decl":{"start":{"line":120,"column":51},"end":{"line":120,"column":52}},"loc":{"start":{"line":120,"column":62},"end":{"line":122,"column":5}},"line":120},"38":{"name":"(anonymous_38)","decl":{"start":{"line":123,"column":41},"end":{"line":123,"column":42}},"loc":{"start":{"line":123,"column":52},"end":{"line":125,"column":5}},"line":123},"39":{"name":"(anonymous_39)","decl":{"start":{"line":126,"column":52},"end":{"line":126,"column":53}},"loc":{"start":{"line":126,"column":63},"end":{"line":128,"column":5}},"line":126},"40":{"name":"(anonymous_40)","decl":{"start":{"line":129,"column":50},"end":{"line":129,"column":51}},"loc":{"start":{"line":129,"column":61},"end":{"line":131,"column":5}},"line":129},"41":{"name":"(anonymous_41)","decl":{"start":{"line":132,"column":24},"end":{"line":132,"column":25}},"loc":{"start":{"line":132,"column":35},"end":{"line":134,"column":5}},"line":132},"42":{"name":"(anonymous_42)","decl":{"start":{"line":135,"column":29},"end":{"line":135,"column":30}},"loc":{"start":{"line":135,"column":40},"end":{"line":137,"column":5}},"line":135},"43":{"name":"(anonymous_43)","decl":{"start":{"line":138,"column":28},"end":{"line":138,"column":29}},"loc":{"start":{"line":138,"column":39},"end":{"line":140,"column":5}},"line":138},"44":{"name":"_interop_require_default","decl":{"start":{"line":147,"column":9},"end":{"line":147,"column":33}},"loc":{"start":{"line":147,"column":39},"end":{"line":151,"column":1}},"line":147},"45":{"name":"withDbWatcherCheck","decl":{"start":{"line":152,"column":9},"end":{"line":152,"column":27}},"loc":{"start":{"line":152,"column":32},"end":{"line":154,"column":1}},"line":152},"46":{"name":"(anonymous_46)","decl":{"start":{"line":153,"column":51},"end":{"line":153,"column":52}},"loc":{"start":{"line":153,"column":55},"end":{"line":153,"column":72}},"line":153},"47":{"name":"(anonymous_47)","decl":{"start":{"line":155,"column":59},"end":{"line":155,"column":60}},"loc":{"start":{"line":155,"column":99},"end":{"line":164,"column":1}},"line":155},"48":{"name":"(anonymous_48)","decl":{"start":{"line":165,"column":47},"end":{"line":165,"column":48}},"loc":{"start":{"line":165,"column":87},"end":{"line":175,"column":1}},"line":165},"49":{"name":"(anonymous_49)","decl":{"start":{"line":176,"column":51},"end":{"line":176,"column":52}},"loc":{"start":{"line":176,"column":90},"end":{"line":187,"column":1}},"line":176},"50":{"name":"(anonymous_50)","decl":{"start":{"line":188,"column":64},"end":{"line":188,"column":65}},"loc":{"start":{"line":188,"column":115},"end":{"line":196,"column":1}},"line":188},"51":{"name":"(anonymous_51)","decl":{"start":{"line":197,"column":55},"end":{"line":197,"column":56}},"loc":{"start":{"line":197,"column":97},"end":{"line":207,"column":1}},"line":197},"52":{"name":"(anonymous_52)","decl":{"start":{"line":208,"column":53},"end":{"line":208,"column":54}},"loc":{"start":{"line":208,"column":99},"end":{"line":220,"column":1}},"line":208},"53":{"name":"(anonymous_53)","decl":{"start":{"line":221,"column":57},"end":{"line":221,"column":58}},"loc":{"start":{"line":221,"column":96},"end":{"line":227,"column":1}},"line":221},"54":{"name":"(anonymous_54)","decl":{"start":{"line":228,"column":55},"end":{"line":228,"column":56}},"loc":{"start":{"line":228,"column":93},"end":{"line":238,"column":1}},"line":228},"55":{"name":"(anonymous_55)","decl":{"start":{"line":239,"column":47},"end":{"line":239,"column":48}},"loc":{"start":{"line":239,"column":87},"end":{"line":244,"column":1}},"line":239},"56":{"name":"(anonymous_56)","decl":{"start":{"line":245,"column":51},"end":{"line":245,"column":52}},"loc":{"start":{"line":245,"column":89},"end":{"line":251,"column":1}},"line":245},"57":{"name":"(anonymous_57)","decl":{"start":{"line":252,"column":68},"end":{"line":252,"column":69}},"loc":{"start":{"line":252,"column":111},"end":{"line":258,"column":1}},"line":252},"58":{"name":"(anonymous_58)","decl":{"start":{"line":259,"column":77},"end":{"line":259,"column":78}},"loc":{"start":{"line":259,"column":120},"end":{"line":269,"column":1}},"line":259},"59":{"name":"(anonymous_59)","decl":{"start":{"line":270,"column":54},"end":{"line":270,"column":55}},"loc":{"start":{"line":270,"column":94},"end":{"line":276,"column":1}},"line":270},"60":{"name":"(anonymous_60)","decl":{"start":{"line":277,"column":58},"end":{"line":277,"column":59}},"loc":{"start":{"line":277,"column":96},"end":{"line":287,"column":1}},"line":277},"61":{"name":"(anonymous_61)","decl":{"start":{"line":288,"column":62},"end":{"line":288,"column":63}},"loc":{"start":{"line":288,"column":100},"end":{"line":297,"column":1}},"line":288},"62":{"name":"(anonymous_62)","decl":{"start":{"line":298,"column":64},"end":{"line":298,"column":65}},"loc":{"start":{"line":298,"column":108},"end":{"line":307,"column":1}},"line":298},"63":{"name":"(anonymous_63)","decl":{"start":{"line":308,"column":53},"end":{"line":308,"column":54}},"loc":{"start":{"line":308,"column":93},"end":{"line":314,"column":1}},"line":308},"64":{"name":"(anonymous_64)","decl":{"start":{"line":315,"column":58},"end":{"line":315,"column":59}},"loc":{"start":{"line":315,"column":104},"end":{"line":326,"column":1}},"line":315},"65":{"name":"(anonymous_65)","decl":{"start":{"line":327,"column":62},"end":{"line":327,"column":63}},"loc":{"start":{"line":327,"column":106},"end":{"line":337,"column":1}},"line":327},"66":{"name":"(anonymous_66)","decl":{"start":{"line":338,"column":64},"end":{"line":338,"column":65}},"loc":{"start":{"line":338,"column":109},"end":{"line":348,"column":1}},"line":338},"67":{"name":"(anonymous_67)","decl":{"start":{"line":349,"column":65},"end":{"line":349,"column":66}},"loc":{"start":{"line":349,"column":112},"end":{"line":359,"column":1}},"line":349},"68":{"name":"(anonymous_68)","decl":{"start":{"line":360,"column":61},"end":{"line":360,"column":62}},"loc":{"start":{"line":360,"column":112},"end":{"line":367,"column":1}},"line":360},"69":{"name":"(anonymous_69)","decl":{"start":{"line":368,"column":65},"end":{"line":368,"column":66}},"loc":{"start":{"line":368,"column":114},"end":{"line":379,"column":1}},"line":368},"70":{"name":"(anonymous_70)","decl":{"start":{"line":380,"column":66},"end":{"line":380,"column":67}},"loc":{"start":{"line":380,"column":106},"end":{"line":386,"column":1}},"line":380},"71":{"name":"(anonymous_71)","decl":{"start":{"line":387,"column":80},"end":{"line":387,"column":81}},"loc":{"start":{"line":387,"column":128},"end":{"line":402,"column":1}},"line":387},"72":{"name":"(anonymous_72)","decl":{"start":{"line":403,"column":89},"end":{"line":403,"column":90}},"loc":{"start":{"line":403,"column":148},"end":{"line":418,"column":1}},"line":403},"73":{"name":"(anonymous_73)","decl":{"start":{"line":419,"column":50},"end":{"line":419,"column":51}},"loc":{"start":{"line":419,"column":93},"end":{"line":424,"column":1}},"line":419},"74":{"name":"(anonymous_74)","decl":{"start":{"line":425,"column":54},"end":{"line":425,"column":55}},"loc":{"start":{"line":425,"column":92},"end":{"line":434,"column":1}},"line":425},"75":{"name":"(anonymous_75)","decl":{"start":{"line":435,"column":46},"end":{"line":435,"column":47}},"loc":{"start":{"line":435,"column":95},"end":{"line":457,"column":1}},"line":435},"76":{"name":"(anonymous_76)","decl":{"start":{"line":458,"column":51},"end":{"line":458,"column":52}},"loc":{"start":{"line":458,"column":63},"end":{"line":468,"column":1}},"line":458},"77":{"name":"(anonymous_77)","decl":{"start":{"line":464,"column":23},"end":{"line":464,"column":24}},"loc":{"start":{"line":464,"column":28},"end":{"line":464,"column":49}},"line":464},"78":{"name":"(anonymous_78)","decl":{"start":{"line":469,"column":50},"end":{"line":469,"column":51}},"loc":{"start":{"line":469,"column":80},"end":{"line":479,"column":1}},"line":469},"79":{"name":"(anonymous_79)","decl":{"start":{"line":480,"column":44},"end":{"line":480,"column":45}},"loc":{"start":{"line":480,"column":60},"end":{"line":487,"column":1}},"line":480},"80":{"name":"(anonymous_80)","decl":{"start":{"line":490,"column":43},"end":{"line":490,"column":44}},"loc":{"start":{"line":490,"column":60},"end":{"line":490,"column":98}},"line":490},"81":{"name":"getMessageToBroadcast","decl":{"start":{"line":493,"column":15},"end":{"line":493,"column":36}},"loc":{"start":{"line":493,"column":51},"end":{"line":527,"column":1}},"line":493},"82":{"name":"(anonymous_82)","decl":{"start":{"line":528,"column":49},"end":{"line":528,"column":50}},"loc":{"start":{"line":528,"column":71},"end":{"line":539,"column":1}},"line":528},"83":{"name":"(anonymous_83)","decl":{"start":{"line":540,"column":55},"end":{"line":540,"column":56}},"loc":{"start":{"line":540,"column":103},"end":{"line":545,"column":1}},"line":540},"84":{"name":"(anonymous_84)","decl":{"start":{"line":546,"column":72},"end":{"line":546,"column":73}},"loc":{"start":{"line":546,"column":116},"end":{"line":558,"column":1}},"line":546},"85":{"name":"(anonymous_85)","decl":{"start":{"line":552,"column":24},"end":{"line":552,"column":25}},"loc":{"start":{"line":552,"column":40},"end":{"line":557,"column":5}},"line":552},"86":{"name":"(anonymous_86)","decl":{"start":{"line":559,"column":59},"end":{"line":559,"column":60}},"loc":{"start":{"line":559,"column":97},"end":{"line":568,"column":1}},"line":559},"87":{"name":"(anonymous_87)","decl":{"start":{"line":569,"column":72},"end":{"line":569,"column":73}},"loc":{"start":{"line":569,"column":162},"end":{"line":579,"column":1}},"line":569},"88":{"name":"(anonymous_88)","decl":{"start":{"line":573,"column":24},"end":{"line":573,"column":25}},"loc":{"start":{"line":573,"column":40},"end":{"line":578,"column":5}},"line":573},"89":{"name":"(anonymous_89)","decl":{"start":{"line":580,"column":63},"end":{"line":580,"column":64}},"loc":{"start":{"line":580,"column":102},"end":{"line":590,"column":1}},"line":580},"90":{"name":"(anonymous_90)","decl":{"start":{"line":584,"column":24},"end":{"line":584,"column":25}},"loc":{"start":{"line":584,"column":40},"end":{"line":589,"column":5}},"line":584},"91":{"name":"(anonymous_91)","decl":{"start":{"line":591,"column":79},"end":{"line":591,"column":80}},"loc":{"start":{"line":591,"column":118},"end":{"line":601,"column":1}},"line":591},"92":{"name":"(anonymous_92)","decl":{"start":{"line":595,"column":24},"end":{"line":595,"column":25}},"loc":{"start":{"line":595,"column":40},"end":{"line":600,"column":5}},"line":595},"93":{"name":"(anonymous_93)","decl":{"start":{"line":602,"column":74},"end":{"line":602,"column":75}},"loc":{"start":{"line":602,"column":116},"end":{"line":612,"column":1}},"line":602},"94":{"name":"(anonymous_94)","decl":{"start":{"line":606,"column":24},"end":{"line":606,"column":25}},"loc":{"start":{"line":606,"column":40},"end":{"line":611,"column":5}},"line":606},"95":{"name":"(anonymous_95)","decl":{"start":{"line":613,"column":72},"end":{"line":613,"column":73}},"loc":{"start":{"line":613,"column":114},"end":{"line":623,"column":1}},"line":613},"96":{"name":"(anonymous_96)","decl":{"start":{"line":617,"column":24},"end":{"line":617,"column":25}},"loc":{"start":{"line":617,"column":40},"end":{"line":622,"column":5}},"line":617},"97":{"name":"(anonymous_97)","decl":{"start":{"line":624,"column":63},"end":{"line":624,"column":64}},"loc":{"start":{"line":624,"column":102},"end":{"line":634,"column":1}},"line":624},"98":{"name":"(anonymous_98)","decl":{"start":{"line":628,"column":24},"end":{"line":628,"column":25}},"loc":{"start":{"line":628,"column":40},"end":{"line":633,"column":5}},"line":628},"99":{"name":"(anonymous_99)","decl":{"start":{"line":635,"column":73},"end":{"line":635,"column":74}},"loc":{"start":{"line":635,"column":118},"end":{"line":645,"column":1}},"line":635},"100":{"name":"(anonymous_100)","decl":{"start":{"line":639,"column":24},"end":{"line":639,"column":25}},"loc":{"start":{"line":639,"column":40},"end":{"line":644,"column":5}},"line":639}},"branchMap":{"0":{"loc":{"start":{"line":148,"column":11},"end":{"line":150,"column":5}},"type":"cond-expr","locations":[{"start":{"line":148,"column":35},"end":{"line":148,"column":38}},{"start":{"line":148,"column":41},"end":{"line":150,"column":5}}],"line":148},"1":{"loc":{"start":{"line":148,"column":11},"end":{"line":148,"column":32}},"type":"binary-expr","locations":[{"start":{"line":148,"column":11},"end":{"line":148,"column":14}},{"start":{"line":148,"column":18},"end":{"line":148,"column":32}}],"line":148},"2":{"loc":{"start":{"line":153,"column":11},"end":{"line":153,"column":72}},"type":"cond-expr","locations":[{"start":{"line":153,"column":46},"end":{"line":153,"column":48}},{"start":{"line":153,"column":51},"end":{"line":153,"column":72}}],"line":153},"3":{"loc":{"start":{"line":155,"column":72},"end":{"line":155,"column":96}},"type":"default-arg","locations":[{"start":{"line":155,"column":87},"end":{"line":155,"column":96}}],"line":155},"4":{"loc":{"start":{"line":165,"column":60},"end":{"line":165,"column":84}},"type":"default-arg","locations":[{"start":{"line":165,"column":75},"end":{"line":165,"column":84}}],"line":165},"5":{"loc":{"start":{"line":166,"column":18},"end":{"line":168,"column":5}},"type":"cond-expr","locations":[{"start":{"line":166,"column":40},"end":{"line":166,"column":44}},{"start":{"line":166,"column":47},"end":{"line":168,"column":5}}],"line":166},"6":{"loc":{"start":{"line":176,"column":63},"end":{"line":176,"column":87}},"type":"default-arg","locations":[{"start":{"line":176,"column":78},"end":{"line":176,"column":87}}],"line":176},"7":{"loc":{"start":{"line":177,"column":24},"end":{"line":179,"column":5}},"type":"cond-expr","locations":[{"start":{"line":177,"column":45},"end":{"line":177,"column":48}},{"start":{"line":177,"column":51},"end":{"line":179,"column":5}}],"line":177},"8":{"loc":{"start":{"line":188,"column":88},"end":{"line":188,"column":112}},"type":"default-arg","locations":[{"start":{"line":188,"column":103},"end":{"line":188,"column":112}}],"line":188},"9":{"loc":{"start":{"line":197,"column":70},"end":{"line":197,"column":94}},"type":"default-arg","locations":[{"start":{"line":197,"column":85},"end":{"line":197,"column":94}}],"line":197},"10":{"loc":{"start":{"line":208,"column":72},"end":{"line":208,"column":96}},"type":"default-arg","locations":[{"start":{"line":208,"column":87},"end":{"line":208,"column":96}}],"line":208},"11":{"loc":{"start":{"line":213,"column":4},"end":{"line":219,"column":5}},"type":"if","locations":[{"start":{"line":213,"column":4},"end":{"line":219,"column":5}},{"start":{"line":213,"column":4},"end":{"line":219,"column":5}}],"line":213},"12":{"loc":{"start":{"line":213,"column":8},"end":{"line":213,"column":63}},"type":"binary-expr","locations":[{"start":{"line":213,"column":8},"end":{"line":213,"column":39}},{"start":{"line":213,"column":43},"end":{"line":213,"column":63}}],"line":213},"13":{"loc":{"start":{"line":215,"column":8},"end":{"line":217,"column":9}},"type":"if","locations":[{"start":{"line":215,"column":8},"end":{"line":217,"column":9}},{"start":{"line":215,"column":8},"end":{"line":217,"column":9}}],"line":215},"14":{"loc":{"start":{"line":221,"column":69},"end":{"line":221,"column":93}},"type":"default-arg","locations":[{"start":{"line":221,"column":84},"end":{"line":221,"column":93}}],"line":221},"15":{"loc":{"start":{"line":223,"column":4},"end":{"line":225,"column":5}},"type":"if","locations":[{"start":{"line":223,"column":4},"end":{"line":225,"column":5}},{"start":{"line":223,"column":4},"end":{"line":225,"column":5}}],"line":223},"16":{"loc":{"start":{"line":228,"column":66},"end":{"line":228,"column":90}},"type":"default-arg","locations":[{"start":{"line":228,"column":81},"end":{"line":228,"column":90}}],"line":228},"17":{"loc":{"start":{"line":230,"column":4},"end":{"line":232,"column":5}},"type":"if","locations":[{"start":{"line":230,"column":4},"end":{"line":232,"column":5}},{"start":{"line":230,"column":4},"end":{"line":232,"column":5}}],"line":230},"18":{"loc":{"start":{"line":239,"column":60},"end":{"line":239,"column":84}},"type":"default-arg","locations":[{"start":{"line":239,"column":75},"end":{"line":239,"column":84}}],"line":239},"19":{"loc":{"start":{"line":245,"column":62},"end":{"line":245,"column":86}},"type":"default-arg","locations":[{"start":{"line":245,"column":77},"end":{"line":245,"column":86}}],"line":245},"20":{"loc":{"start":{"line":247,"column":4},"end":{"line":249,"column":5}},"type":"if","locations":[{"start":{"line":247,"column":4},"end":{"line":249,"column":5}},{"start":{"line":247,"column":4},"end":{"line":249,"column":5}}],"line":247},"21":{"loc":{"start":{"line":252,"column":84},"end":{"line":252,"column":108}},"type":"default-arg","locations":[{"start":{"line":252,"column":99},"end":{"line":252,"column":108}}],"line":252},"22":{"loc":{"start":{"line":259,"column":93},"end":{"line":259,"column":117}},"type":"default-arg","locations":[{"start":{"line":259,"column":108},"end":{"line":259,"column":117}}],"line":259},"23":{"loc":{"start":{"line":265,"column":4},"end":{"line":267,"column":5}},"type":"if","locations":[{"start":{"line":265,"column":4},"end":{"line":267,"column":5}},{"start":{"line":265,"column":4},"end":{"line":267,"column":5}}],"line":265},"24":{"loc":{"start":{"line":270,"column":67},"end":{"line":270,"column":91}},"type":"default-arg","locations":[{"start":{"line":270,"column":82},"end":{"line":270,"column":91}}],"line":270},"25":{"loc":{"start":{"line":277,"column":69},"end":{"line":277,"column":93}},"type":"default-arg","locations":[{"start":{"line":277,"column":84},"end":{"line":277,"column":93}}],"line":277},"26":{"loc":{"start":{"line":279,"column":4},"end":{"line":281,"column":5}},"type":"if","locations":[{"start":{"line":279,"column":4},"end":{"line":281,"column":5}},{"start":{"line":279,"column":4},"end":{"line":281,"column":5}}],"line":279},"27":{"loc":{"start":{"line":288,"column":73},"end":{"line":288,"column":97}},"type":"default-arg","locations":[{"start":{"line":288,"column":88},"end":{"line":288,"column":97}}],"line":288},"28":{"loc":{"start":{"line":298,"column":81},"end":{"line":298,"column":105}},"type":"default-arg","locations":[{"start":{"line":298,"column":96},"end":{"line":298,"column":105}}],"line":298},"29":{"loc":{"start":{"line":308,"column":66},"end":{"line":308,"column":90}},"type":"default-arg","locations":[{"start":{"line":308,"column":81},"end":{"line":308,"column":90}}],"line":308},"30":{"loc":{"start":{"line":315,"column":71},"end":{"line":315,"column":95}},"type":"default-arg","locations":[{"start":{"line":315,"column":86},"end":{"line":315,"column":95}}],"line":315},"31":{"loc":{"start":{"line":316,"column":18},"end":{"line":318,"column":5}},"type":"cond-expr","locations":[{"start":{"line":316,"column":40},"end":{"line":316,"column":44}},{"start":{"line":316,"column":47},"end":{"line":318,"column":5}}],"line":316},"32":{"loc":{"start":{"line":327,"column":73},"end":{"line":327,"column":97}},"type":"default-arg","locations":[{"start":{"line":327,"column":88},"end":{"line":327,"column":97}}],"line":327},"33":{"loc":{"start":{"line":328,"column":20},"end":{"line":328,"column":147}},"type":"cond-expr","locations":[{"start":{"line":328,"column":49},"end":{"line":328,"column":99}},{"start":{"line":328,"column":102},"end":{"line":328,"column":147}}],"line":328},"34":{"loc":{"start":{"line":329,"column":4},"end":{"line":331,"column":5}},"type":"if","locations":[{"start":{"line":329,"column":4},"end":{"line":331,"column":5}},{"start":{"line":329,"column":4},"end":{"line":331,"column":5}}],"line":329},"35":{"loc":{"start":{"line":338,"column":76},"end":{"line":338,"column":100}},"type":"default-arg","locations":[{"start":{"line":338,"column":91},"end":{"line":338,"column":100}}],"line":338},"36":{"loc":{"start":{"line":340,"column":4},"end":{"line":342,"column":5}},"type":"if","locations":[{"start":{"line":340,"column":4},"end":{"line":342,"column":5}},{"start":{"line":340,"column":4},"end":{"line":342,"column":5}}],"line":340},"37":{"loc":{"start":{"line":349,"column":79},"end":{"line":349,"column":103}},"type":"default-arg","locations":[{"start":{"line":349,"column":94},"end":{"line":349,"column":103}}],"line":349},"38":{"loc":{"start":{"line":351,"column":4},"end":{"line":353,"column":5}},"type":"if","locations":[{"start":{"line":351,"column":4},"end":{"line":353,"column":5}},{"start":{"line":351,"column":4},"end":{"line":353,"column":5}}],"line":351},"39":{"loc":{"start":{"line":360,"column":74},"end":{"line":360,"column":98}},"type":"default-arg","locations":[{"start":{"line":360,"column":89},"end":{"line":360,"column":98}}],"line":360},"40":{"loc":{"start":{"line":360,"column":100},"end":{"line":360,"column":109}},"type":"default-arg","locations":[{"start":{"line":360,"column":107},"end":{"line":360,"column":109}}],"line":360},"41":{"loc":{"start":{"line":368,"column":76},"end":{"line":368,"column":100}},"type":"default-arg","locations":[{"start":{"line":368,"column":91},"end":{"line":368,"column":100}}],"line":368},"42":{"loc":{"start":{"line":368,"column":102},"end":{"line":368,"column":111}},"type":"default-arg","locations":[{"start":{"line":368,"column":109},"end":{"line":368,"column":111}}],"line":368},"43":{"loc":{"start":{"line":370,"column":4},"end":{"line":372,"column":5}},"type":"if","locations":[{"start":{"line":370,"column":4},"end":{"line":372,"column":5}},{"start":{"line":370,"column":4},"end":{"line":372,"column":5}}],"line":370},"44":{"loc":{"start":{"line":380,"column":79},"end":{"line":380,"column":103}},"type":"default-arg","locations":[{"start":{"line":380,"column":94},"end":{"line":380,"column":103}}],"line":380},"45":{"loc":{"start":{"line":387,"column":101},"end":{"line":387,"column":125}},"type":"default-arg","locations":[{"start":{"line":387,"column":116},"end":{"line":387,"column":125}}],"line":387},"46":{"loc":{"start":{"line":403,"column":121},"end":{"line":403,"column":145}},"type":"default-arg","locations":[{"start":{"line":403,"column":136},"end":{"line":403,"column":145}}],"line":403},"47":{"loc":{"start":{"line":419,"column":66},"end":{"line":419,"column":90}},"type":"default-arg","locations":[{"start":{"line":419,"column":81},"end":{"line":419,"column":90}}],"line":419},"48":{"loc":{"start":{"line":425,"column":65},"end":{"line":425,"column":89}},"type":"default-arg","locations":[{"start":{"line":425,"column":80},"end":{"line":425,"column":89}}],"line":425},"49":{"loc":{"start":{"line":426,"column":17},"end":{"line":426,"column":130}},"type":"cond-expr","locations":[{"start":{"line":426,"column":46},"end":{"line":426,"column":89}},{"start":{"line":426,"column":92},"end":{"line":426,"column":130}}],"line":426},"50":{"loc":{"start":{"line":427,"column":4},"end":{"line":429,"column":5}},"type":"if","locations":[{"start":{"line":427,"column":4},"end":{"line":429,"column":5}},{"start":{"line":427,"column":4},"end":{"line":429,"column":5}}],"line":427},"51":{"loc":{"start":{"line":436,"column":4},"end":{"line":442,"column":5}},"type":"if","locations":[{"start":{"line":436,"column":4},"end":{"line":442,"column":5}},{"start":{"line":436,"column":4},"end":{"line":442,"column":5}}],"line":436},"52":{"loc":{"start":{"line":443,"column":4},"end":{"line":450,"column":5}},"type":"if","locations":[{"start":{"line":443,"column":4},"end":{"line":450,"column":5}},{"start":{"line":443,"column":4},"end":{"line":450,"column":5}}],"line":443},"53":{"loc":{"start":{"line":454,"column":15},"end":{"line":454,"column":26}},"type":"binary-expr","locations":[{"start":{"line":454,"column":15},"end":{"line":454,"column":20}},{"start":{"line":454,"column":24},"end":{"line":454,"column":26}}],"line":454},"54":{"loc":{"start":{"line":460,"column":4},"end":{"line":462,"column":5}},"type":"if","locations":[{"start":{"line":460,"column":4},"end":{"line":462,"column":5}},{"start":{"line":460,"column":4},"end":{"line":462,"column":5}}],"line":460},"55":{"loc":{"start":{"line":463,"column":4},"end":{"line":466,"column":5}},"type":"if","locations":[{"start":{"line":463,"column":4},"end":{"line":466,"column":5}},{"start":{"line":463,"column":4},"end":{"line":466,"column":5}}],"line":463},"56":{"loc":{"start":{"line":471,"column":4},"end":{"line":473,"column":5}},"type":"if","locations":[{"start":{"line":471,"column":4},"end":{"line":473,"column":5}},{"start":{"line":471,"column":4},"end":{"line":473,"column":5}}],"line":471},"57":{"loc":{"start":{"line":486,"column":11},"end":{"line":486,"column":64}},"type":"cond-expr","locations":[{"start":{"line":486,"column":46},"end":{"line":486,"column":52}},{"start":{"line":486,"column":55},"end":{"line":486,"column":64}}],"line":486},"58":{"loc":{"start":{"line":486,"column":11},"end":{"line":486,"column":43}},"type":"binary-expr","locations":[{"start":{"line":486,"column":11},"end":{"line":486,"column":24}},{"start":{"line":486,"column":28},"end":{"line":486,"column":43}}],"line":486},"59":{"loc":{"start":{"line":494,"column":20},"end":{"line":494,"column":100}},"type":"cond-expr","locations":[{"start":{"line":494,"column":55},"end":{"line":494,"column":59}},{"start":{"line":494,"column":62},"end":{"line":494,"column":100}}],"line":494},"60":{"loc":{"start":{"line":494,"column":20},"end":{"line":494,"column":52}},"type":"binary-expr","locations":[{"start":{"line":494,"column":20},"end":{"line":494,"column":33}},{"start":{"line":494,"column":37},"end":{"line":494,"column":52}}],"line":494},"61":{"loc":{"start":{"line":495,"column":4},"end":{"line":497,"column":5}},"type":"if","locations":[{"start":{"line":495,"column":4},"end":{"line":497,"column":5}},{"start":{"line":495,"column":4},"end":{"line":497,"column":5}}],"line":495},"62":{"loc":{"start":{"line":498,"column":4},"end":{"line":504,"column":5}},"type":"if","locations":[{"start":{"line":498,"column":4},"end":{"line":504,"column":5}},{"start":{"line":498,"column":4},"end":{"line":504,"column":5}}],"line":498},"63":{"loc":{"start":{"line":501,"column":8},"end":{"line":503,"column":9}},"type":"if","locations":[{"start":{"line":501,"column":8},"end":{"line":503,"column":9}},{"start":{"line":501,"column":8},"end":{"line":503,"column":9}}],"line":501},"64":{"loc":{"start":{"line":505,"column":4},"end":{"line":507,"column":5}},"type":"if","locations":[{"start":{"line":505,"column":4},"end":{"line":507,"column":5}},{"start":{"line":505,"column":4},"end":{"line":507,"column":5}}],"line":505},"65":{"loc":{"start":{"line":505,"column":8},"end":{"line":505,"column":51}},"type":"binary-expr","locations":[{"start":{"line":505,"column":8},"end":{"line":505,"column":23}},{"start":{"line":505,"column":27},"end":{"line":505,"column":51}}],"line":505},"66":{"loc":{"start":{"line":509,"column":4},"end":{"line":525,"column":5}},"type":"if","locations":[{"start":{"line":509,"column":4},"end":{"line":525,"column":5}},{"start":{"line":509,"column":4},"end":{"line":525,"column":5}}],"line":509},"67":{"loc":{"start":{"line":511,"column":8},"end":{"line":516,"column":9}},"type":"if","locations":[{"start":{"line":511,"column":8},"end":{"line":516,"column":9}},{"start":{"line":511,"column":8},"end":{"line":516,"column":9}}],"line":511},"68":{"loc":{"start":{"line":511,"column":12},"end":{"line":511,"column":96}},"type":"cond-expr","locations":[{"start":{"line":511,"column":73},"end":{"line":511,"column":79}},{"start":{"line":511,"column":82},"end":{"line":511,"column":96}}],"line":511},"69":{"loc":{"start":{"line":511,"column":12},"end":{"line":511,"column":70}},"type":"binary-expr","locations":[{"start":{"line":511,"column":12},"end":{"line":511,"column":45}},{"start":{"line":511,"column":49},"end":{"line":511,"column":70}}],"line":511},"70":{"loc":{"start":{"line":513,"column":12},"end":{"line":515,"column":13}},"type":"if","locations":[{"start":{"line":513,"column":12},"end":{"line":515,"column":13}},{"start":{"line":513,"column":12},"end":{"line":515,"column":13}}],"line":513},"71":{"loc":{"start":{"line":517,"column":8},"end":{"line":524,"column":9}},"type":"if","locations":[{"start":{"line":517,"column":8},"end":{"line":524,"column":9}},{"start":{"line":517,"column":8},"end":{"line":524,"column":9}}],"line":517},"72":{"loc":{"start":{"line":517,"column":12},"end":{"line":517,"column":127}},"type":"cond-expr","locations":[{"start":{"line":517,"column":94},"end":{"line":517,"column":100}},{"start":{"line":517,"column":103},"end":{"line":517,"column":127}}],"line":517},"73":{"loc":{"start":{"line":517,"column":12},"end":{"line":517,"column":91}},"type":"binary-expr","locations":[{"start":{"line":517,"column":12},"end":{"line":517,"column":59}},{"start":{"line":517,"column":63},"end":{"line":517,"column":91}}],"line":517},"74":{"loc":{"start":{"line":520,"column":16},"end":{"line":522,"column":17}},"type":"if","locations":[{"start":{"line":520,"column":16},"end":{"line":522,"column":17}},{"start":{"line":520,"column":16},"end":{"line":522,"column":17}}],"line":520},"75":{"loc":{"start":{"line":533,"column":4},"end":{"line":535,"column":5}},"type":"if","locations":[{"start":{"line":533,"column":4},"end":{"line":535,"column":5}},{"start":{"line":533,"column":4},"end":{"line":535,"column":5}}],"line":533},"76":{"loc":{"start":{"line":540,"column":76},"end":{"line":540,"column":100}},"type":"default-arg","locations":[{"start":{"line":540,"column":91},"end":{"line":540,"column":100}}],"line":540},"77":{"loc":{"start":{"line":546,"column":89},"end":{"line":546,"column":113}},"type":"default-arg","locations":[{"start":{"line":546,"column":104},"end":{"line":546,"column":113}}],"line":546},"78":{"loc":{"start":{"line":559,"column":70},"end":{"line":559,"column":94}},"type":"default-arg","locations":[{"start":{"line":559,"column":85},"end":{"line":559,"column":94}}],"line":559},"79":{"loc":{"start":{"line":561,"column":4},"end":{"line":563,"column":5}},"type":"if","locations":[{"start":{"line":561,"column":4},"end":{"line":563,"column":5}},{"start":{"line":561,"column":4},"end":{"line":563,"column":5}}],"line":561},"80":{"loc":{"start":{"line":569,"column":135},"end":{"line":569,"column":159}},"type":"default-arg","locations":[{"start":{"line":569,"column":150},"end":{"line":569,"column":159}}],"line":569},"81":{"loc":{"start":{"line":580,"column":75},"end":{"line":580,"column":99}},"type":"default-arg","locations":[{"start":{"line":580,"column":90},"end":{"line":580,"column":99}}],"line":580},"82":{"loc":{"start":{"line":591,"column":91},"end":{"line":591,"column":115}},"type":"default-arg","locations":[{"start":{"line":591,"column":106},"end":{"line":591,"column":115}}],"line":591},"83":{"loc":{"start":{"line":602,"column":89},"end":{"line":602,"column":113}},"type":"default-arg","locations":[{"start":{"line":602,"column":104},"end":{"line":602,"column":113}}],"line":602},"84":{"loc":{"start":{"line":613,"column":87},"end":{"line":613,"column":111}},"type":"default-arg","locations":[{"start":{"line":613,"column":102},"end":{"line":613,"column":111}}],"line":613},"85":{"loc":{"start":{"line":624,"column":75},"end":{"line":624,"column":99}},"type":"default-arg","locations":[{"start":{"line":624,"column":90},"end":{"line":624,"column":99}}],"line":624},"86":{"loc":{"start":{"line":635,"column":91},"end":{"line":635,"column":115}},"type":"default-arg","locations":[{"start":{"line":635,"column":106},"end":{"line":635,"column":115}}],"line":635}},"s":{"0":21,"1":21,"2":903,"3":21,"4":16,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":19,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":1,"45":0,"46":0,"47":21,"48":21,"49":21,"50":21,"51":21,"52":21,"53":882,"54":1,"55":21,"56":0,"57":0,"58":21,"59":0,"60":0,"61":0,"62":21,"63":0,"64":0,"65":0,"66":0,"67":21,"68":0,"69":0,"70":0,"71":21,"72":0,"73":0,"74":0,"75":21,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":21,"83":0,"84":0,"85":0,"86":0,"87":21,"88":0,"89":0,"90":0,"91":0,"92":21,"93":0,"94":21,"95":0,"96":0,"97":0,"98":0,"99":21,"100":0,"101":21,"102":0,"103":0,"104":0,"105":0,"106":21,"107":0,"108":21,"109":0,"110":0,"111":0,"112":0,"113":21,"114":0,"115":0,"116":0,"117":21,"118":0,"119":0,"120":0,"121":21,"122":0,"123":21,"124":0,"125":0,"126":0,"127":21,"128":0,"129":0,"130":0,"131":0,"132":21,"133":0,"134":0,"135":0,"136":0,"137":21,"138":0,"139":0,"140":0,"141":0,"142":21,"143":0,"144":21,"145":0,"146":0,"147":0,"148":0,"149":21,"150":0,"151":21,"152":0,"153":0,"154":0,"155":21,"156":0,"157":0,"158":0,"159":21,"160":0,"161":21,"162":0,"163":0,"164":0,"165":0,"166":21,"167":1,"168":0,"169":0,"170":1,"171":0,"172":0,"173":1,"174":21,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"182":0,"183":21,"184":0,"185":0,"186":0,"187":0,"188":21,"189":4,"190":4,"191":21,"192":19,"193":15,"194":15,"195":1,"196":14,"197":14,"198":14,"199":14,"200":7,"201":7,"202":2,"203":5,"204":5,"205":2,"206":2,"207":2,"208":2,"209":2,"210":1,"211":2,"212":2,"213":2,"214":5,"215":21,"216":2,"217":2,"218":1,"219":1,"220":21,"221":0,"222":21,"223":0,"224":0,"225":0,"226":21,"227":0,"228":0,"229":0,"230":0,"231":21,"232":0,"233":0,"234":0,"235":21,"236":0,"237":0,"238":0,"239":21,"240":0,"241":0,"242":0,"243":21,"244":0,"245":0,"246":0,"247":21,"248":0,"249":0,"250":0,"251":21,"252":0,"253":0,"254":0,"255":21,"256":0,"257":0,"258":0},"f":{"0":21,"1":16,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":19,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":1,"42":0,"43":0,"44":21,"45":882,"46":1,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":1,"76":0,"77":0,"78":0,"79":4,"80":19,"81":15,"82":2,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0},"b":{"0":[0,21],"1":[21,21],"2":[168,714],"3":[0],"4":[0],"5":[0,0],"6":[0],"7":[0,0],"8":[0],"9":[0],"10":[0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0],"15":[0,0],"16":[0],"17":[0,0],"18":[0],"19":[0],"20":[0,0],"21":[0],"22":[0],"23":[0,0],"24":[0],"25":[0],"26":[0,0],"27":[0],"28":[0],"29":[0],"30":[0],"31":[0,0],"32":[0],"33":[0,0],"34":[0,0],"35":[0],"36":[0,0],"37":[0],"38":[0,0],"39":[0],"40":[0],"41":[0],"42":[0],"43":[0,0],"44":[0],"45":[0],"46":[0],"47":[0],"48":[0],"49":[0,0],"50":[0,0],"51":[0,1],"52":[0,1],"53":[1,1],"54":[0,0],"55":[0,0],"56":[0,0],"57":[0,4],"58":[4,4],"59":[1,14],"60":[15,14],"61":[1,14],"62":[14,0],"63":[7,7],"64":[2,5],"65":[7,6],"66":[2,3],"67":[2,0],"68":[0,2],"69":[2,2],"70":[2,0],"71":[1,1],"72":[0,2],"73":[2,2],"74":[2,0],"75":[1,1],"76":[0],"77":[0],"78":[0],"79":[0,0],"80":[0],"81":[0],"82":[0],"83":[0],"84":[0],"85":[0],"86":[0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/lib/notifyListener.ts"],"sourcesContent":["import { api, dbWatchersDisabled } from '@rocket.chat/core-services';\nimport type {\n\tIRocketChatRecord,\n\tIRoom,\n\tILoginServiceConfiguration,\n\tISetting,\n\tIRole,\n\tIPermission,\n\tIIntegration,\n\tIPbxEvent,\n\tLoginServiceConfiguration as LoginServiceConfigurationData,\n\tILivechatInquiryRecord,\n\tILivechatPriority,\n\tILivechatDepartmentAgents,\n\tIEmailInbox,\n\tIIntegrationHistory,\n\tAtLeast,\n\tISubscription,\n\tISettingColor,\n\tIUser,\n\tIMessage,\n\tSettingValue,\n\tMessageTypesValues,\n} from '@rocket.chat/core-typings';\nimport {\n\tRooms,\n\tPermissions,\n\tSettings,\n\tPbxEvents,\n\tRoles,\n\tIntegrations,\n\tLoginServiceConfiguration,\n\tIntegrationHistory,\n\tSubscriptions,\n\tLivechatInquiry,\n\tLivechatDepartmentAgents,\n\tUsers,\n\tMessages,\n} from '@rocket.chat/models';\nimport mem from 'mem';\n\nimport { subscriptionFields } from '../../../../lib/publishFields';\nimport { shouldHideSystemMessage } from '../../../../server/lib/systemMessage/hideSystemMessage';\n\ntype ClientAction = 'inserted' | 'updated' | 'removed';\n\nfunction withDbWatcherCheck<T extends (...args: any[]) => Promise<void>>(fn: T): T {\n\treturn dbWatchersDisabled ? fn : ((() => Promise.resolve()) as T);\n}\n\nexport const notifyOnLivechatPriorityChanged = withDbWatcherCheck(\n\tasync (data: Pick<ILivechatPriority, 'name' | '_id'>, clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tconst { _id, ...rest } = data;\n\t\tvoid api.broadcast('watch.priorities', { clientAction, id: _id, diff: { ...rest } });\n\t},\n);\n\nexport const notifyOnRoomChanged = withDbWatcherCheck(\n\tasync <T extends IRocketChatRecord>(data: T | T[], clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tconst items = Array.isArray(data) ? data : [data];\n\t\tfor (const item of items) {\n\t\t\tvoid api.broadcast('watch.rooms', { clientAction, room: item });\n\t\t}\n\t},\n);\n\nexport const notifyOnRoomChangedById = withDbWatcherCheck(\n\tasync <T extends IRocketChatRecord>(ids: T['_id'] | T['_id'][], clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tconst eligibleIds = Array.isArray(ids) ? ids : [ids];\n\t\tconst items = Rooms.findByIds(eligibleIds);\n\t\tfor await (const item of items) {\n\t\t\tvoid api.broadcast('watch.rooms', { clientAction, room: item });\n\t\t}\n\t},\n);\n\nexport const notifyOnRoomChangedByUsernamesOrUids = withDbWatcherCheck(\n\tasync <T extends IRoom>(\n\t\tuids: T['u']['_id'][],\n\t\tusernames: T['u']['username'][],\n\t\tclientAction: ClientAction = 'updated',\n\t): Promise<void> => {\n\t\tconst items = Rooms.findByUsernamesOrUids(uids, usernames);\n\t\tfor await (const item of items) {\n\t\t\tvoid api.broadcast('watch.rooms', { clientAction, room: item });\n\t\t}\n\t},\n);\n\nexport const notifyOnRoomChangedByUserDM = withDbWatcherCheck(\n\tasync <T extends IRoom>(userId: T['u']['_id'], clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tconst items = Rooms.findDMsByUids([userId]);\n\t\tfor await (const item of items) {\n\t\t\tvoid api.broadcast('watch.rooms', { clientAction, room: item });\n\t\t}\n\t},\n);\n\nexport const notifyOnPermissionChanged = withDbWatcherCheck(\n\tasync (permission: IPermission, clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tvoid api.broadcast('permission.changed', { clientAction, data: permission });\n\n\t\tif (permission.level === 'settings' && permission.settingId) {\n\t\t\tconst setting = await Settings.findOneNotHiddenById(permission.settingId);\n\t\t\tif (!setting) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvoid notifyOnSettingChanged(setting, 'updated');\n\t\t}\n\t},\n);\n\nexport const notifyOnPermissionChangedById = withDbWatcherCheck(\n\tasync (pid: IPermission['_id'], clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tconst permission = await Permissions.findOneById(pid);\n\t\tif (!permission) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn notifyOnPermissionChanged(permission, clientAction);\n\t},\n);\n\nexport const notifyOnPbxEventChangedById = withDbWatcherCheck(\n\tasync <T extends IPbxEvent>(id: T['_id'], clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tconst item = await PbxEvents.findOneById(id);\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid api.broadcast('watch.pbxevents', { clientAction, id, data: item });\n\t},\n);\n\nexport const notifyOnRoleChanged = withDbWatcherCheck(\n\tasync <T extends IRole>(role: T, clientAction: 'removed' | 'changed' = 'changed'): Promise<void> => {\n\t\tvoid api.broadcast('watch.roles', { clientAction, role });\n\t},\n);\n\nexport const notifyOnRoleChangedById = withDbWatcherCheck(\n\tasync <T extends IRole>(id: T['_id'], clientAction: 'removed' | 'changed' = 'changed'): Promise<void> => {\n\t\tconst role = await Roles.findOneById(id);\n\t\tif (!role) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid notifyOnRoleChanged(role, clientAction);\n\t},\n);\n\nexport const notifyOnLoginServiceConfigurationChanged = withDbWatcherCheck(\n\tasync <T extends ILoginServiceConfiguration>(\n\t\tservice: Partial<T> & Pick<T, '_id'>,\n\t\tclientAction: ClientAction = 'updated',\n\t): Promise<void> => {\n\t\tvoid api.broadcast('watch.loginServiceConfiguration', {\n\t\t\tclientAction,\n\t\t\tid: service._id,\n\t\t\tdata: service,\n\t\t});\n\t},\n);\n\nexport const notifyOnLoginServiceConfigurationChangedByService = withDbWatcherCheck(\n\tasync <T extends ILoginServiceConfiguration>(service: T['service'], clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tconst item = await LoginServiceConfiguration.findOneByService<Omit<LoginServiceConfigurationData, 'secret'>>(service, {\n\t\t\tprojection: { secret: 0 },\n\t\t});\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid notifyOnLoginServiceConfigurationChanged(item, clientAction);\n\t},\n);\n\nexport const notifyOnIntegrationChanged = withDbWatcherCheck(\n\tasync <T extends IIntegration>(data: T, clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tvoid api.broadcast('watch.integrations', { clientAction, id: data._id, data });\n\t},\n);\n\nexport const notifyOnIntegrationChangedById = withDbWatcherCheck(\n\tasync <T extends IIntegration>(id: T['_id'], clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tconst item = await Integrations.findOneById(id);\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid api.broadcast('watch.integrations', { clientAction, id: item._id, data: item });\n\t},\n);\n\nexport const notifyOnIntegrationChangedByUserId = withDbWatcherCheck(\n\tasync <T extends IIntegration>(id: T['userId'], clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tconst items = Integrations.findByUserId(id);\n\n\t\tfor await (const item of items) {\n\t\t\tvoid api.broadcast('watch.integrations', { clientAction, id: item._id, data: item });\n\t\t}\n\t},\n);\n\nexport const notifyOnIntegrationChangedByChannels = withDbWatcherCheck(\n\tasync <T extends IIntegration>(channels: T['channel'], clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tconst items = Integrations.findByChannels(channels);\n\n\t\tfor await (const item of items) {\n\t\t\tvoid api.broadcast('watch.integrations', { clientAction, id: item._id, data: item });\n\t\t}\n\t},\n);\n\nexport const notifyOnEmailInboxChanged = withDbWatcherCheck(\n\tasync <T extends IEmailInbox>(\n\t\tdata: Pick<T, '_id'> | T, // TODO: improve typing\n\t\tclientAction: ClientAction = 'updated',\n\t): Promise<void> => {\n\t\tvoid api.broadcast('watch.emailInbox', { clientAction, id: data._id, data });\n\t},\n);\n\nexport const notifyOnLivechatInquiryChanged = withDbWatcherCheck(\n\tasync (\n\t\tdata: ILivechatInquiryRecord | ILivechatInquiryRecord[],\n\t\tclientAction: ClientAction = 'updated',\n\t\tdiff?: Partial<Record<keyof ILivechatInquiryRecord, unknown> & { queuedAt: unknown; takenAt: unknown }>,\n\t): Promise<void> => {\n\t\tconst items = Array.isArray(data) ? data : [data];\n\n\t\tfor (const item of items) {\n\t\t\tvoid api.broadcast('watch.inquiries', { clientAction, inquiry: item, diff });\n\t\t}\n\t},\n);\n\nexport const notifyOnLivechatInquiryChangedById = withDbWatcherCheck(\n\tasync (\n\t\tid: ILivechatInquiryRecord['_id'],\n\t\tclientAction: ClientAction = 'updated',\n\t\tdiff?: Partial<Record<keyof ILivechatInquiryRecord, unknown> & { queuedAt: unknown; takenAt: unknown }>,\n\t): Promise<void> => {\n\t\tconst inquiry = clientAction === 'removed' ? await LivechatInquiry.trashFindOneById(id) : await LivechatInquiry.findOneById(id);\n\n\t\tif (!inquiry) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid api.broadcast('watch.inquiries', { clientAction, inquiry, diff });\n\t},\n);\n\nexport const notifyOnLivechatInquiryChangedByRoom = withDbWatcherCheck(\n\tasync (\n\t\trid: ILivechatInquiryRecord['rid'],\n\t\tclientAction: ClientAction = 'updated',\n\t\tdiff?: Partial<Record<keyof ILivechatInquiryRecord, unknown> & { queuedAt: unknown; takenAt: unknown }>,\n\t): Promise<void> => {\n\t\tconst inquiry = await LivechatInquiry.findOneByRoomId(rid, {});\n\n\t\tif (!inquiry) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid api.broadcast('watch.inquiries', { clientAction, inquiry, diff });\n\t},\n);\n\nexport const notifyOnLivechatInquiryChangedByToken = withDbWatcherCheck(\n\tasync (\n\t\ttoken: ILivechatInquiryRecord['v']['token'],\n\t\tclientAction: ClientAction = 'updated',\n\t\tdiff?: Partial<Record<keyof ILivechatInquiryRecord, unknown> & { queuedAt: unknown; takenAt: unknown }>,\n\t): Promise<void> => {\n\t\tconst inquiry = await LivechatInquiry.findOneByToken(token);\n\n\t\tif (!inquiry) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid api.broadcast('watch.inquiries', { clientAction, inquiry, diff });\n\t},\n);\n\nexport const notifyOnIntegrationHistoryChanged = withDbWatcherCheck(\n\tasync <T extends IIntegrationHistory>(\n\t\tdata: AtLeast<T, '_id'>,\n\t\tclientAction: ClientAction = 'updated',\n\t\tdiff: Partial<T> = {},\n\t): Promise<void> => {\n\t\tvoid api.broadcast('watch.integrationHistory', { clientAction, id: data._id, data, diff });\n\t},\n);\n\nexport const notifyOnIntegrationHistoryChangedById = withDbWatcherCheck(\n\tasync <T extends IIntegrationHistory>(id: T['_id'], clientAction: ClientAction = 'updated', diff: Partial<T> = {}): Promise<void> => {\n\t\tconst item = await IntegrationHistory.findOneById(id);\n\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid api.broadcast('watch.integrationHistory', { clientAction, id: item._id, data: item, diff });\n\t},\n);\n\nexport const notifyOnLivechatDepartmentAgentChanged = withDbWatcherCheck(\n\tasync <T extends ILivechatDepartmentAgents>(\n\t\tdata: Partial<T> & Pick<T, '_id' | 'agentId' | 'departmentId'>,\n\t\tclientAction: ClientAction = 'updated',\n\t): Promise<void> => {\n\t\tvoid api.broadcast('watch.livechatDepartmentAgents', { clientAction, id: data._id, data });\n\t},\n);\n\nexport const notifyOnLivechatDepartmentAgentChangedByDepartmentId = withDbWatcherCheck(\n\tasync <T extends ILivechatDepartmentAgents>(\n\t\tdepartmentId: T['departmentId'],\n\t\tclientAction: 'inserted' | 'updated' = 'updated',\n\t): Promise<void> => {\n\t\tconst items = LivechatDepartmentAgents.findByDepartmentId(departmentId, { projection: { _id: 1, agentId: 1, departmentId: 1 } });\n\n\t\tfor await (const item of items) {\n\t\t\tvoid api.broadcast('watch.livechatDepartmentAgents', { clientAction, id: item._id, data: item });\n\t\t}\n\t},\n);\n\nexport const notifyOnLivechatDepartmentAgentChangedByAgentsAndDepartmentId = withDbWatcherCheck(\n\tasync <T extends ILivechatDepartmentAgents>(\n\t\tagentsIds: T['agentId'][],\n\t\tdepartmentId: T['departmentId'],\n\t\tclientAction: 'inserted' | 'updated' = 'updated',\n\t): Promise<void> => {\n\t\tconst items = LivechatDepartmentAgents.findByAgentsAndDepartmentId(agentsIds, departmentId, {\n\t\t\tprojection: { _id: 1, agentId: 1, departmentId: 1 },\n\t\t});\n\n\t\tfor await (const item of items) {\n\t\t\tvoid api.broadcast('watch.livechatDepartmentAgents', { clientAction, id: item._id, data: item });\n\t\t}\n\t},\n);\n\nexport const notifyOnSettingChanged = withDbWatcherCheck(\n\tasync (setting: ISetting & { editor?: ISettingColor['editor'] }, clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tvoid api.broadcast('watch.settings', { clientAction, setting });\n\t},\n);\n\nexport const notifyOnSettingChangedById = withDbWatcherCheck(\n\tasync (id: ISetting['_id'], clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tconst item = clientAction === 'removed' ? await Settings.trashFindOneById(id) : await Settings.findOneById(id);\n\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid api.broadcast('watch.settings', { clientAction, setting: item });\n\t},\n);\n\ntype NotifyUserChange = {\n\tid: IUser['_id'];\n\tclientAction: 'inserted' | 'removed' | 'updated';\n\tdata?: IUser;\n\tdiff?: Record<string, any>;\n\tunset?: Record<string, number>;\n};\n\nexport const notifyOnUserChange = withDbWatcherCheck(async ({ clientAction, id, data, diff, unset }: NotifyUserChange) => {\n\tif (clientAction === 'removed') {\n\t\tvoid api.broadcast('watch.users', { clientAction, id });\n\t\treturn;\n\t}\n\n\tif (clientAction === 'inserted') {\n\t\tvoid api.broadcast('watch.users', { clientAction, id, data: data! });\n\t\treturn;\n\t}\n\n\tvoid api.broadcast('watch.users', { clientAction, diff: diff!, unset: unset || {}, id });\n});\n\n/**\n * Calls the callback only if DB Watchers are disabled\n */\nexport const notifyOnUserChangeAsync = withDbWatcherCheck(async (cb: () => Promise<NotifyUserChange | NotifyUserChange[] | void>) => {\n\tconst result = await cb();\n\tif (!result) {\n\t\treturn;\n\t}\n\n\tif (Array.isArray(result)) {\n\t\tresult.forEach((n) => notifyOnUserChange(n));\n\t\treturn;\n\t}\n\n\treturn notifyOnUserChange(result);\n});\n\n// TODO this may be only useful on 'inserted'\nexport const notifyOnUserChangeById = withDbWatcherCheck(\n\tasync ({ clientAction, id }: { id: IUser['_id']; clientAction: 'inserted' | 'removed' | 'updated' }) => {\n\t\tconst user = await Users.findOneById(id);\n\t\tif (!user) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid notifyOnUserChange({ id, clientAction, data: user });\n\t},\n);\n\nconst getUserNameCached = mem(\n\tasync (userId: string): Promise<string | undefined> => {\n\t\tconst user = await Users.findOne<Pick<IUser, 'name'>>(userId, { projection: { name: 1 } });\n\t\treturn user?.name;\n\t},\n\t{ maxAge: 10000 },\n);\n\nconst getSettingCached = mem(async (setting: string): Promise<SettingValue> => Settings.getValueById(setting), { maxAge: 10000 });\n\nexport async function getMessageToBroadcast({ id, data }: { id: IMessage['_id']; data?: IMessage }): Promise<IMessage | void> {\n\tconst message = data ?? (await Messages.findOneById(id));\n\tif (!message) {\n\t\treturn;\n\t}\n\n\tif (message.t) {\n\t\tconst hiddenSystemMessages = (await getSettingCached('Hide_System_Messages')) as MessageTypesValues[];\n\t\tconst shouldHide = shouldHideSystemMessage(message.t, hiddenSystemMessages);\n\n\t\tif (shouldHide) {\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif (message._hidden || message.imported != null) {\n\t\treturn;\n\t}\n\n\tconst useRealName = (await getSettingCached('UI_Use_Real_Name')) === true;\n\tif (useRealName) {\n\t\tif (message.u?._id) {\n\t\t\tconst name = await getUserNameCached(message.u._id);\n\t\t\tif (name) {\n\t\t\t\tmessage.u.name = name;\n\t\t\t}\n\t\t}\n\n\t\tif (message.mentions?.length) {\n\t\t\tfor await (const mention of message.mentions) {\n\t\t\t\tconst name = await getUserNameCached(mention._id);\n\t\t\t\tif (name) {\n\t\t\t\t\tmention.name = name;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn message;\n}\n\nexport const notifyOnMessageChange = withDbWatcherCheck(async ({ id, data }: { id: IMessage['_id']; data?: IMessage }): Promise<void> => {\n\tconst message = await getMessageToBroadcast({ id, data });\n\tif (!message) {\n\t\treturn;\n\t}\n\tvoid api.broadcast('watch.messages', { message });\n});\n\nexport const notifyOnSubscriptionChanged = withDbWatcherCheck(\n\tasync (subscription: ISubscription, clientAction: ClientAction = 'updated'): Promise<void> => {\n\t\tvoid api.broadcast('watch.subscriptions', { clientAction, subscription });\n\t},\n);\n\nexport const notifyOnSubscriptionChangedByRoomIdAndUserId = withDbWatcherCheck(\n\tasync (\n\t\trid: ISubscription['rid'],\n\t\tuid: ISubscription['u']['_id'],\n\t\tclientAction: Exclude<ClientAction, 'removed'> = 'updated',\n\t): Promise<void> => {\n\t\tconst cursor = Subscriptions.findByUserIdAndRoomIds(uid, [rid], { projection: subscriptionFields });\n\n\t\tvoid cursor.forEach((subscription) => {\n\t\t\tvoid api.broadcast('watch.subscriptions', { clientAction, subscription });\n\t\t});\n\t},\n);\n\nexport const notifyOnSubscriptionChangedById = withDbWatcherCheck(\n\tasync (id: ISubscription['_id'], clientAction: Exclude<ClientAction, 'removed'> = 'updated'): Promise<void> => {\n\t\tconst subscription = await Subscriptions.findOneById(id);\n\t\tif (!subscription) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid api.broadcast('watch.subscriptions', { clientAction, subscription });\n\t},\n);\n\nexport const notifyOnSubscriptionChangedByUserPreferences = withDbWatcherCheck(\n\tasync (\n\t\tuid: ISubscription['u']['_id'],\n\t\tnotificationOriginField: keyof ISubscription,\n\t\toriginFieldNotEqualValue: 'user' | 'subscription',\n\t\tclientAction: Exclude<ClientAction, 'removed'> = 'updated',\n\t): Promise<void> => {\n\t\tconst cursor = Subscriptions.findByUserPreferences(uid, notificationOriginField, originFieldNotEqualValue, {\n\t\t\tprojection: subscriptionFields,\n\t\t});\n\n\t\tvoid cursor.forEach((subscription) => {\n\t\t\tvoid api.broadcast('watch.subscriptions', { clientAction, subscription });\n\t\t});\n\t},\n);\n\nexport const notifyOnSubscriptionChangedByRoomId = withDbWatcherCheck(\n\tasync (rid: ISubscription['rid'], clientAction: Exclude<ClientAction, 'removed'> = 'updated'): Promise<void> => {\n\t\tconst cursor = Subscriptions.findByRoomId(rid, { projection: subscriptionFields });\n\n\t\tvoid cursor.forEach((subscription) => {\n\t\t\tvoid api.broadcast('watch.subscriptions', { clientAction, subscription });\n\t\t});\n\t},\n);\n\nexport const notifyOnSubscriptionChangedByAutoTranslateAndUserId = withDbWatcherCheck(\n\tasync (uid: ISubscription['u']['_id'], clientAction: Exclude<ClientAction, 'removed'> = 'updated'): Promise<void> => {\n\t\tconst cursor = Subscriptions.findByAutoTranslateAndUserId(uid, true, { projection: subscriptionFields });\n\n\t\tvoid cursor.forEach((subscription) => {\n\t\t\tvoid api.broadcast('watch.subscriptions', { clientAction, subscription });\n\t\t});\n\t},\n);\n\nexport const notifyOnSubscriptionChangedByUserIdAndRoomType = withDbWatcherCheck(\n\tasync (\n\t\tuid: ISubscription['u']['_id'],\n\t\tt: ISubscription['t'],\n\t\tclientAction: Exclude<ClientAction, 'removed'> = 'updated',\n\t): Promise<void> => {\n\t\tconst cursor = Subscriptions.findByUserIdAndRoomType(uid, t, { projection: subscriptionFields });\n\n\t\tvoid cursor.forEach((subscription) => {\n\t\t\tvoid api.broadcast('watch.subscriptions', { clientAction, subscription });\n\t\t});\n\t},\n);\n\nexport const notifyOnSubscriptionChangedByNameAndRoomType = withDbWatcherCheck(\n\tasync (filter: Partial<Pick<ISubscription, 'name' | 't'>>, clientAction: Exclude<ClientAction, 'removed'> = 'updated'): Promise<void> => {\n\t\tconst cursor = Subscriptions.findByNameAndRoomType(filter, { projection: subscriptionFields });\n\n\t\tvoid cursor.forEach((subscription) => {\n\t\t\tvoid api.broadcast('watch.subscriptions', { clientAction, subscription });\n\t\t});\n\t},\n);\n\nexport const notifyOnSubscriptionChangedByUserId = withDbWatcherCheck(\n\tasync (uid: ISubscription['u']['_id'], clientAction: Exclude<ClientAction, 'removed'> = 'updated'): Promise<void> => {\n\t\tconst cursor = Subscriptions.findByUserId(uid, { projection: subscriptionFields });\n\n\t\tvoid cursor.forEach((subscription) => {\n\t\t\tvoid api.broadcast('watch.subscriptions', { clientAction, subscription });\n\t\t});\n\t},\n);\n\nexport const notifyOnSubscriptionChangedByRoomIdAndUserIds = withDbWatcherCheck(\n\tasync (\n\t\trid: ISubscription['rid'],\n\t\tuids: ISubscription['u']['_id'][],\n\t\tclientAction: Exclude<ClientAction, 'removed'> = 'updated',\n\t): Promise<void> => {\n\t\tconst cursor = Subscriptions.findByRoomIdAndUserIds(rid, uids, { projection: subscriptionFields });\n\n\t\tvoid cursor.forEach((subscription) => {\n\t\t\tvoid api.broadcast('watch.subscriptions', { clientAction, subscription });\n\t\t});\n\t},\n);\n"],"names":["getMessageToBroadcast","notifyOnEmailInboxChanged","notifyOnIntegrationChanged","notifyOnIntegrationChangedByChannels","notifyOnIntegrationChangedById","notifyOnIntegrationChangedByUserId","notifyOnIntegrationHistoryChanged","notifyOnIntegrationHistoryChangedById","notifyOnLivechatDepartmentAgentChanged","notifyOnLivechatDepartmentAgentChangedByAgentsAndDepartmentId","notifyOnLivechatDepartmentAgentChangedByDepartmentId","notifyOnLivechatInquiryChanged","notifyOnLivechatInquiryChangedById","notifyOnLivechatInquiryChangedByRoom","notifyOnLivechatInquiryChangedByToken","notifyOnLivechatPriorityChanged","notifyOnLoginServiceConfigurationChanged","notifyOnLoginServiceConfigurationChangedByService","notifyOnMessageChange","notifyOnPbxEventChangedById","notifyOnPermissionChanged","notifyOnPermissionChangedById","notifyOnRoleChanged","notifyOnRoleChangedById","notifyOnRoomChanged","notifyOnRoomChangedById","notifyOnRoomChangedByUserDM","notifyOnRoomChangedByUsernamesOrUids","notifyOnSettingChanged","notifyOnSettingChangedById","notifyOnSubscriptionChanged","notifyOnSubscriptionChangedByAutoTranslateAndUserId","notifyOnSubscriptionChangedById","notifyOnSubscriptionChangedByNameAndRoomType","notifyOnSubscriptionChangedByRoomId","notifyOnSubscriptionChangedByRoomIdAndUserId","notifyOnSubscriptionChangedByRoomIdAndUserIds","notifyOnSubscriptionChangedByUserId","notifyOnSubscriptionChangedByUserIdAndRoomType","notifyOnSubscriptionChangedByUserPreferences","notifyOnUserChange","notifyOnUserChangeAsync","notifyOnUserChangeById","withDbWatcherCheck","fn","dbWatchersDisabled","Promise","resolve","data","clientAction","_id","rest","api","broadcast","id","diff","items","Array","isArray","item","room","ids","eligibleIds","Rooms","findByIds","uids","usernames","findByUsernamesOrUids","userId","findDMsByUids","permission","level","settingId","setting","Settings","findOneNotHiddenById","pid","Permissions","findOneById","PbxEvents","role","Roles","service","LoginServiceConfiguration","findOneByService","projection","secret","Integrations","findByUserId","channels","findByChannels","inquiry","LivechatInquiry","trashFindOneById","rid","findOneByRoomId","token","findOneByToken","IntegrationHistory","departmentId","LivechatDepartmentAgents","findByDepartmentId","agentId","agentsIds","findByAgentsAndDepartmentId","unset","cb","result","forEach","n","user","Users","getUserNameCached","mem","findOne","name","maxAge","getSettingCached","getValueById","message","Messages","t","hiddenSystemMessages","shouldHide","shouldHideSystemMessage","_hidden","imported","useRealName","u","mentions","length","mention","subscription","uid","cursor","Subscriptions","findByUserIdAndRoomIds","subscriptionFields","notificationOriginField","originFieldNotEqualValue","findByUserPreferences","findByRoomId","findByAutoTranslateAndUserId","findByUserIdAndRoomType","filter","findByNameAndRoomType","findByRoomIdAndUserIds"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/lib/notifyListener.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4d7fb4d150c95d4206312bdb9fb5e904e8710bd3","contentHash":"3c5eb1800a521597dcc91061aea51d7417fe6e76c4ac38d706b8220e7d2b5e9c"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/publishFields.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/publishFields.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":26}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":34}},"6":{"start":{"line":19,"column":27},"end":{"line":66,"column":1}},"7":{"start":{"line":67,"column":19},"end":{"line":136,"column":1}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":16},"end":{"line":12,"column":17}},"loc":{"start":{"line":12,"column":27},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":24},"end":{"line":15,"column":25}},"loc":{"start":{"line":15,"column":35},"end":{"line":17,"column":5}},"line":15}},"branchMap":{},"s":{"0":2,"1":2,"2":4,"3":2,"4":0,"5":0,"6":2,"7":2},"f":{"0":2,"1":0,"2":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/publishFields.ts"],"sourcesContent":["export const subscriptionFields = {\n\tt: 1,\n\tts: 1,\n\tls: 1,\n\tlr: 1,\n\tname: 1,\n\tfname: 1,\n\trid: 1,\n\tcode: 1,\n\tf: 1,\n\tu: 1,\n\topen: 1,\n\talert: 1,\n\troles: 1,\n\tunread: 1,\n\tprid: 1,\n\tuserMentions: 1,\n\tgroupMentions: 1,\n\tarchived: 1,\n\taudioNotificationValue: 1,\n\tdesktopNotifications: 1,\n\tmobilePushNotifications: 1,\n\temailNotifications: 1,\n\tdesktopPrefOrigin: 1,\n\tmobilePrefOrigin: 1,\n\temailPrefOrigin: 1,\n\tunreadAlert: 1,\n\t_updatedAt: 1,\n\tblocked: 1,\n\tblocker: 1,\n\tautoTranslate: 1,\n\tautoTranslateLanguage: 1,\n\tdisableNotifications: 1,\n\thideUnreadStatus: 1,\n\thideMentionStatus: 1,\n\tmuteGroupMentions: 1,\n\tignored: 1,\n\tE2EKey: 1,\n\tE2ESuggestedKey: 1,\n\toldRoomKeys: 1,\n\ttunread: 1,\n\ttunreadGroup: 1,\n\ttunreadUser: 1,\n\n\t// Omnichannel fields\n\tdepartment: 1,\n\tv: 1,\n\tonHold: 1,\n} as const;\n\nexport const roomFields = {\n\t_id: 1,\n\tname: 1,\n\tfname: 1,\n\tt: 1,\n\tcl: 1,\n\tu: 1,\n\tlm: 1,\n\t// usernames: 1,\n\tteamId: 1,\n\tteamMain: 1,\n\ttopic: 1,\n\tannouncement: 1,\n\tannouncementDetails: 1,\n\tmuted: 1,\n\tunmuted: 1,\n\t_updatedAt: 1,\n\tarchived: 1,\n\tdescription: 1,\n\tdefault: 1,\n\tcustomFields: 1,\n\tlastMessage: 1,\n\tretention: 1,\n\tprid: 1,\n\tavatarETag: 1,\n\tusersCount: 1,\n\tmsgs: 1,\n\tsidepanel: 1,\n\n\t// @TODO create an API to register this fields based on room type\n\ttags: 1,\n\tsms: 1,\n\tcode: 1,\n\tjoinCodeRequired: 1,\n\topen: 1,\n\tlabel: 1,\n\tro: 1,\n\treactWhenReadOnly: 1,\n\tsysMes: 1,\n\tsentiment: 1,\n\tbroadcast: 1,\n\tencrypted: 1,\n\te2eKeyId: 1,\n\n\t// Omnichannel fields\n\tlivechatData: 1,\n\tpriorityId: 1,\n\tpriorityWeight: 1,\n\tslaId: 1,\n\testimatedWaitingTimeQueue: 1,\n\tv: 1,\n\tdepartmentId: 1,\n\tservedBy: 1,\n\tsource: 1,\n\ttranscriptRequest: 1,\n\tonHold: 1,\n\tmetrics: 1,\n\tts: 1,\n\twaitingResponse: 1,\n\tqueuedAt: 1,\n\n\t// Federation fields\n\tfederated: 1,\n\n\t// fields used by DMs\n\tusernames: 1,\n\tuids: 1,\n\n\t// Voip fields\n\tqueue: 1,\n\tcallDuration: 1,\n\tcallTotalHoldTime: 1,\n\tcallWaitingTime: 1,\n\tusersWaitingForE2EKeys: 1,\n} as const;\n"],"names":["roomFields","subscriptionFields","t","ts","ls","lr","name","fname","rid","code","f","u","open","alert","roles","unread","prid","userMentions","groupMentions","archived","audioNotificationValue","desktopNotifications","mobilePushNotifications","emailNotifications","desktopPrefOrigin","mobilePrefOrigin","emailPrefOrigin","unreadAlert","_updatedAt","blocked","blocker","autoTranslate","autoTranslateLanguage","disableNotifications","hideUnreadStatus","hideMentionStatus","muteGroupMentions","ignored","E2EKey","E2ESuggestedKey","oldRoomKeys","tunread","tunreadGroup","tunreadUser","department","v","onHold","_id","cl","lm","teamId","teamMain","topic","announcement","announcementDetails","muted","unmuted","description","default","customFields","lastMessage","retention","avatarETag","usersCount","msgs","sidepanel","tags","sms","joinCodeRequired","label","ro","reactWhenReadOnly","sysMes","sentiment","broadcast","encrypted","e2eKeyId","livechatData","priorityId","priorityWeight","slaId","estimatedWaitingTimeQueue","departmentId","servedBy","source","transcriptRequest","metrics","waitingResponse","queuedAt","federated","usernames","uids","queue","callDuration","callTotalHoldTime","callWaitingTime","usersWaitingForE2EKeys"],"mappings":";;;;;;;;;;;IAkDaA,UAAU;eAAVA;;IAlDAC,kBAAkB;eAAlBA;;;AAAN,MAAMA,qBAAqB;IACjCC,GAAG;IACHC,IAAI;IACJC,IAAI;IACJC,IAAI;IACJC,MAAM;IACNC,OAAO;IACPC,KAAK;IACLC,MAAM;IACNC,GAAG;IACHC,GAAG;IACHC,MAAM;IACNC,OAAO;IACPC,OAAO;IACPC,QAAQ;IACRC,MAAM;IACNC,cAAc;IACdC,eAAe;IACfC,UAAU;IACVC,wBAAwB;IACxBC,sBAAsB;IACtBC,yBAAyB;IACzBC,oBAAoB;IACpBC,mBAAmB;IACnBC,kBAAkB;IAClBC,iBAAiB;IACjBC,aAAa;IACbC,YAAY;IACZC,SAAS;IACTC,SAAS;IACTC,eAAe;IACfC,uBAAuB;IACvBC,sBAAsB;IACtBC,kBAAkB;IAClBC,mBAAmB;IACnBC,mBAAmB;IACnBC,SAAS;IACTC,QAAQ;IACRC,iBAAiB;IACjBC,aAAa;IACbC,SAAS;IACTC,cAAc;IACdC,aAAa;IAEb,qBAAqB;IACrBC,YAAY;IACZC,GAAG;IACHC,QAAQ;AACT;AAEO,MAAM9C,aAAa;IACzB+C,KAAK;IACLzC,MAAM;IACNC,OAAO;IACPL,GAAG;IACH8C,IAAI;IACJrC,GAAG;IACHsC,IAAI;IACJ,gBAAgB;IAChBC,QAAQ;IACRC,UAAU;IACVC,OAAO;IACPC,cAAc;IACdC,qBAAqB;IACrBC,OAAO;IACPC,SAAS;IACT5B,YAAY;IACZT,UAAU;IACVsC,aAAa;IACbC,SAAS;IACTC,cAAc;IACdC,aAAa;IACbC,WAAW;IACX7C,MAAM;IACN8C,YAAY;IACZC,YAAY;IACZC,MAAM;IACNC,WAAW;IAEX,iEAAiE;IACjEC,MAAM;IACNC,KAAK;IACL1D,MAAM;IACN2D,kBAAkB;IAClBxD,MAAM;IACNyD,OAAO;IACPC,IAAI;IACJC,mBAAmB;IACnBC,QAAQ;IACRC,WAAW;IACXC,WAAW;IACXC,WAAW;IACXC,UAAU;IAEV,qBAAqB;IACrBC,cAAc;IACdC,YAAY;IACZC,gBAAgB;IAChBC,OAAO;IACPC,2BAA2B;IAC3BpC,GAAG;IACHqC,cAAc;IACdC,UAAU;IACVC,QAAQ;IACRC,mBAAmB;IACnBvC,QAAQ;IACRwC,SAAS;IACTnF,IAAI;IACJoF,iBAAiB;IACjBC,UAAU;IAEV,oBAAoB;IACpBC,WAAW;IAEX,qBAAqB;IACrBC,WAAW;IACXC,MAAM;IAEN,cAAc;IACdC,OAAO;IACPC,cAAc;IACdC,mBAAmB;IACnBC,iBAAiB;IACjBC,wBAAwB;AACzB","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/publishFields.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"93839140d9d678389c7d797fd7f680fdd8f8d8a3","contentHash":"9883b32f4bea16f7487ece36b8d7ca229e99c15f702913f2c6c45004c6bdce17"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/systemMessage/hideSystemMessage.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/systemMessage/hideSystemMessage.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":30}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":39}},"6":{"start":{"line":19,"column":23},"end":{"line":21,"column":1}},"7":{"start":{"line":20,"column":4},"end":{"line":20,"column":74}},"8":{"start":{"line":22,"column":32},"end":{"line":27,"column":1}},"9":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"10":{"start":{"line":24,"column":8},"end":{"line":24,"column":21}},"11":{"start":{"line":26,"column":4},"end":{"line":26,"column":127}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":20},"end":{"line":12,"column":21}},"loc":{"start":{"line":12,"column":31},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":29},"end":{"line":15,"column":30}},"loc":{"start":{"line":15,"column":40},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":19,"column":23},"end":{"line":19,"column":24}},"loc":{"start":{"line":19,"column":38},"end":{"line":21,"column":1}},"line":19},"4":{"name":"(anonymous_4)","decl":{"start":{"line":22,"column":32},"end":{"line":22,"column":33}},"loc":{"start":{"line":22,"column":66},"end":{"line":27,"column":1}},"line":22}},"branchMap":{"0":{"loc":{"start":{"line":20,"column":11},"end":{"line":20,"column":73}},"type":"binary-expr","locations":[{"start":{"line":20,"column":11},"end":{"line":20,"column":39}},{"start":{"line":20,"column":43},"end":{"line":20,"column":73}}],"line":20},"1":{"loc":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"type":"if","locations":[{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},{"start":{"line":23,"column":4},"end":{"line":25,"column":5}}],"line":23},"2":{"loc":{"start":{"line":23,"column":10},"end":{"line":23,"column":104}},"type":"cond-expr","locations":[{"start":{"line":23,"column":71},"end":{"line":23,"column":77}},{"start":{"line":23,"column":80},"end":{"line":23,"column":104}}],"line":23},"3":{"loc":{"start":{"line":23,"column":10},"end":{"line":23,"column":68}},"type":"binary-expr","locations":[{"start":{"line":23,"column":10},"end":{"line":23,"column":36}},{"start":{"line":23,"column":40},"end":{"line":23,"column":68}}],"line":23},"4":{"loc":{"start":{"line":26,"column":11},"end":{"line":26,"column":126}},"type":"binary-expr","locations":[{"start":{"line":26,"column":11},"end":{"line":26,"column":50}},{"start":{"line":26,"column":54},"end":{"line":26,"column":81}},{"start":{"line":26,"column":85},"end":{"line":26,"column":126}}],"line":26}},"s":{"0":2,"1":2,"2":4,"3":2,"4":3,"5":18,"6":2,"7":5,"8":2,"9":18,"10":8,"11":10},"f":{"0":2,"1":3,"2":18,"3":5,"4":18},"b":{"0":[5,2],"1":[8,10],"2":[2,16],"3":[18,18],"4":[10,2,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/systemMessage/hideSystemMessage.ts"],"sourcesContent":["import type { MessageTypesValues } from '@rocket.chat/core-typings';\n\nexport const isMutedUnmuted = (messageType: string): boolean => {\n\treturn messageType === 'user-muted' || messageType === 'user-unmuted';\n};\n\nexport const shouldHideSystemMessage = (messageType: MessageTypesValues, hideSystemMessage?: MessageTypesValues[]): boolean => {\n\tif (!hideSystemMessage?.length) {\n\t\treturn false;\n\t}\n\n\treturn hideSystemMessage.includes(messageType) || (isMutedUnmuted(messageType) && hideSystemMessage.includes('mute_unmute'));\n};\n"],"names":["isMutedUnmuted","shouldHideSystemMessage","messageType","hideSystemMessage","length","includes"],"mappings":";;;;;;;;;;;IAEaA,cAAc;eAAdA;;IAIAC,uBAAuB;eAAvBA;;;AAJN,MAAMD,iBAAiB,CAACE;IAC9B,OAAOA,gBAAgB,gBAAgBA,gBAAgB;AACxD;AAEO,MAAMD,0BAA0B,CAACC,aAAiCC;IACxE,IAAI,EAACA,8BAAAA,wCAAAA,kBAAmBC,MAAM,GAAE;QAC/B,OAAO;IACR;IAEA,OAAOD,kBAAkBE,QAAQ,CAACH,gBAAiBF,eAAeE,gBAAgBC,kBAAkBE,QAAQ,CAAC;AAC9G","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/systemMessage/hideSystemMessage.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"28244527efbf16dc5993c1e2eb69123666ee9ecd","contentHash":"f44ce18d07b489cb2a4b63899f336fe232e2836b3775b1bf29be7cdc344427f7"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/validateUsername.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/validateUsername.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":32}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":51}},"4":{"start":{"line":12,"column":25},"end":{"line":22,"column":1}},"5":{"start":{"line":13,"column":27},"end":{"line":13,"column":77}},"6":{"start":{"line":14,"column":27},"end":{"line":14,"column":46}},"7":{"start":{"line":16,"column":4},"end":{"line":20,"column":5}},"8":{"start":{"line":17,"column":8},"end":{"line":17,"column":93}},"9":{"start":{"line":19,"column":8},"end":{"line":19,"column":40}},"10":{"start":{"line":21,"column":4},"end":{"line":21,"column":41}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":25},"end":{"line":12,"column":26}},"loc":{"start":{"line":12,"column":37},"end":{"line":22,"column":1}},"line":12}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":25},"end":{"line":17,"column":92}},"type":"cond-expr","locations":[{"start":{"line":17,"column":42},"end":{"line":17,"column":75}},{"start":{"line":17,"column":78},"end":{"line":17,"column":92}}],"line":17}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":9,"6":9,"7":9,"8":9,"9":1,"10":9},"f":{"0":1,"1":9},"b":{"0":[8,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/validateUsername.ts"],"sourcesContent":["import { settings } from '../../../settings/server';\n\nexport const validateUsername = (username: string): boolean => {\n\tconst settingsRegExp = settings.get('UTF8_User_Names_Validation');\n\tconst defaultPattern = /^[0-9a-zA-Z-_.]+$/;\n\n\tlet usernameRegExp: RegExp;\n\ttry {\n\t\tusernameRegExp = settingsRegExp ? new RegExp(`^${settingsRegExp}$`) : defaultPattern;\n\t} catch (e) {\n\t\tusernameRegExp = defaultPattern;\n\t}\n\n\treturn usernameRegExp.test(username);\n};\n"],"names":["validateUsername","username","settingsRegExp","settings","get","defaultPattern","usernameRegExp","RegExp","e","test"],"mappings":";;;;+BAEaA;;;eAAAA;;;wBAFY;AAElB,MAAMA,mBAAmB,CAACC;IAChC,MAAMC,iBAAiBC,gBAAQ,CAACC,GAAG,CAAC;IACpC,MAAMC,iBAAiB;IAEvB,IAAIC;IACJ,IAAI;QACHA,iBAAiBJ,iBAAiB,IAAIK,OAAO,CAAC,CAAC,EAAEL,eAAe,CAAC,CAAC,IAAIG;IACvE,EAAE,OAAOG,GAAG;QACXF,iBAAiBD;IAClB;IAEA,OAAOC,eAAeG,IAAI,CAACR;AAC5B","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/validateUsername.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"aae5a2fd52ea832d863a59f1c769726cea8084f5","contentHash":"2631fdbc8202f86f89316b018835ef9d7d6b5b430dd781d0dc389c02ecc5f5bc"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/lib/getHiddenSystemMessages.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/lib/getHiddenSystemMessages.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":39}},"3":{"start":{"line":11,"column":32},"end":{"line":25,"column":1}},"4":{"start":{"line":12,"column":24},"end":{"line":23,"column":10}},"5":{"start":{"line":13,"column":25},"end":{"line":18,"column":9}},"6":{"start":{"line":19,"column":8},"end":{"line":22,"column":10}},"7":{"start":{"line":24,"column":4},"end":{"line":24,"column":110}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":32},"end":{"line":11,"column":33}},"loc":{"start":{"line":11,"column":62},"end":{"line":25,"column":1}},"line":11},"2":{"name":"(anonymous_2)","decl":{"start":{"line":12,"column":52},"end":{"line":12,"column":53}},"loc":{"start":{"line":12,"column":68},"end":{"line":23,"column":5}},"line":12}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":25},"end":{"line":18,"column":9}},"type":"cond-expr","locations":[{"start":{"line":13,"column":51},"end":{"line":16,"column":9}},{"start":{"line":16,"column":12},"end":{"line":18,"column":9}}],"line":13},"1":{"loc":{"start":{"line":24,"column":11},"end":{"line":24,"column":109}},"type":"cond-expr","locations":[{"start":{"line":24,"column":84},"end":{"line":24,"column":95}},{"start":{"line":24,"column":98},"end":{"line":24,"column":109}}],"line":24},"2":{"loc":{"start":{"line":24,"column":25},"end":{"line":24,"column":80}},"type":"cond-expr","locations":[{"start":{"line":24,"column":60},"end":{"line":24,"column":66}},{"start":{"line":24,"column":69},"end":{"line":24,"column":80}}],"line":24},"3":{"loc":{"start":{"line":24,"column":25},"end":{"line":24,"column":57}},"type":"binary-expr","locations":[{"start":{"line":24,"column":25},"end":{"line":24,"column":38}},{"start":{"line":24,"column":42},"end":{"line":24,"column":57}}],"line":24}},"s":{"0":1,"1":1,"2":5,"3":1,"4":5,"5":6,"6":6,"7":5},"f":{"0":5,"1":5,"2":6},"b":{"0":[1,5],"1":[2,3],"2":[0,5],"3":[5,5]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/lib/getHiddenSystemMessages.ts"],"sourcesContent":["import type { MessageTypesValues, IRoom } from '@rocket.chat/core-typings';\n\nexport const getHiddenSystemMessages = (room: IRoom, hiddenSystemMessages: MessageTypesValues[]): MessageTypesValues[] => {\n\tconst hiddenTypes = hiddenSystemMessages.reduce((array, value): MessageTypesValues[] => {\n\t\tconst newValue: MessageTypesValues[] = value === 'mute_unmute' ? ['user-muted', 'user-unmuted'] : [value];\n\t\treturn [...array, ...newValue];\n\t}, [] as MessageTypesValues[]);\n\n\treturn Array.isArray(room?.sysMes) ? room.sysMes : hiddenTypes;\n};\n"],"names":["getHiddenSystemMessages","room","hiddenSystemMessages","hiddenTypes","reduce","array","value","newValue","Array","isArray","sysMes"],"mappings":";;;;+BAEaA;;;eAAAA;;;AAAN,MAAMA,0BAA0B,CAACC,MAAaC;IACpD,MAAMC,cAAcD,qBAAqBE,MAAM,CAAC,CAACC,OAAOC;QACvD,MAAMC,WAAiCD,UAAU,gBAAgB;YAAC;YAAc;SAAe,GAAG;YAACA;SAAM;QACzG,OAAO;eAAID;eAAUE;SAAS;IAC/B,GAAG,EAAE;IAEL,OAAOC,MAAMC,OAAO,CAACR,iBAAAA,2BAAAA,KAAMS,MAAM,IAAIT,KAAKS,MAAM,GAAGP;AACpD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/lib/getHiddenSystemMessages.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c52f2910a06af82d97ae89da9a074cb9f82428dc","contentHash":"a8ee427acc3d62de1b148c4bea0f5c08b5ee6d411369e7de1e1bab6763b54c08"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/license/server/canEnableApp.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/license/server/canEnableApp.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":29}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":28}},"6":{"start":{"line":19,"column":22},"end":{"line":19,"column":59}},"7":{"start":{"line":20,"column":17},"end":{"line":20,"column":48}},"8":{"start":{"line":21,"column":49},"end":{"line":21,"column":120}},"9":{"start":{"line":22,"column":22},"end":{"line":51,"column":1}},"10":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"11":{"start":{"line":24,"column":8},"end":{"line":24,"column":55}},"12":{"start":{"line":28,"column":4},"end":{"line":30,"column":5}},"13":{"start":{"line":29,"column":8},"end":{"line":29,"column":15}},"14":{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},"15":{"start":{"line":32,"column":8},"end":{"line":32,"column":47}},"16":{"start":{"line":34,"column":19},"end":{"line":34,"column":109}},"17":{"start":{"line":35,"column":4},"end":{"line":50,"column":5}},"18":{"start":{"line":37,"column":12},"end":{"line":39,"column":13}},"19":{"start":{"line":38,"column":16},"end":{"line":38,"column":53}},"20":{"start":{"line":40,"column":12},"end":{"line":40,"column":18}},"21":{"start":{"line":43,"column":12},"end":{"line":45,"column":13}},"22":{"start":{"line":44,"column":16},"end":{"line":44,"column":53}},"23":{"start":{"line":46,"column":12},"end":{"line":48,"column":13}},"24":{"start":{"line":47,"column":16},"end":{"line":47,"column":51}},"25":{"start":{"line":49,"column":12},"end":{"line":49,"column":18}},"26":{"start":{"line":52,"column":21},"end":{"line":55,"column":11}},"27":{"start":{"line":52,"column":34},"end":{"line":55,"column":11}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":19},"end":{"line":12,"column":20}},"loc":{"start":{"line":12,"column":30},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":18},"end":{"line":15,"column":19}},"loc":{"start":{"line":15,"column":29},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":22,"column":22},"end":{"line":22,"column":23}},"loc":{"start":{"line":22,"column":54},"end":{"line":51,"column":1}},"line":22},"4":{"name":"(anonymous_4)","decl":{"start":{"line":52,"column":21},"end":{"line":52,"column":22}},"loc":{"start":{"line":52,"column":34},"end":{"line":55,"column":11}},"line":52}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"type":"if","locations":[{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},{"start":{"line":23,"column":4},"end":{"line":25,"column":5}}],"line":23},"1":{"loc":{"start":{"line":28,"column":4},"end":{"line":30,"column":5}},"type":"if","locations":[{"start":{"line":28,"column":4},"end":{"line":30,"column":5}},{"start":{"line":28,"column":4},"end":{"line":30,"column":5}}],"line":28},"2":{"loc":{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},"type":"if","locations":[{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},{"start":{"line":31,"column":4},"end":{"line":33,"column":5}}],"line":31},"3":{"loc":{"start":{"line":31,"column":8},"end":{"line":31,"column":60}},"type":"binary-expr","locations":[{"start":{"line":31,"column":8},"end":{"line":31,"column":22}},{"start":{"line":31,"column":26},"end":{"line":31,"column":60}}],"line":31},"4":{"loc":{"start":{"line":35,"column":4},"end":{"line":50,"column":5}},"type":"switch","locations":[{"start":{"line":36,"column":8},"end":{"line":40,"column":18}},{"start":{"line":41,"column":8},"end":{"line":49,"column":18}}],"line":35},"5":{"loc":{"start":{"line":37,"column":12},"end":{"line":39,"column":13}},"type":"if","locations":[{"start":{"line":37,"column":12},"end":{"line":39,"column":13}},{"start":{"line":37,"column":12},"end":{"line":39,"column":13}}],"line":37},"6":{"loc":{"start":{"line":43,"column":12},"end":{"line":45,"column":13}},"type":"if","locations":[{"start":{"line":43,"column":12},"end":{"line":45,"column":13}},{"start":{"line":43,"column":12},"end":{"line":45,"column":13}}],"line":43},"7":{"loc":{"start":{"line":46,"column":12},"end":{"line":48,"column":13}},"type":"if","locations":[{"start":{"line":46,"column":12},"end":{"line":48,"column":13}},{"start":{"line":46,"column":12},"end":{"line":48,"column":13}}],"line":46},"8":{"loc":{"start":{"line":46,"column":16},"end":{"line":46,"column":185}},"type":"binary-expr","locations":[{"start":{"line":46,"column":17},"end":{"line":46,"column":154}},{"start":{"line":46,"column":159},"end":{"line":46,"column":185}}],"line":46},"9":{"loc":{"start":{"line":46,"column":17},"end":{"line":46,"column":154}},"type":"cond-expr","locations":[{"start":{"line":46,"column":108},"end":{"line":46,"column":114}},{"start":{"line":46,"column":117},"end":{"line":46,"column":154}}],"line":46},"10":{"loc":{"start":{"line":46,"column":17},"end":{"line":46,"column":105}},"type":"binary-expr","locations":[{"start":{"line":46,"column":17},"end":{"line":46,"column":70}},{"start":{"line":46,"column":74},"end":{"line":46,"column":105}}],"line":46}},"s":{"0":1,"1":1,"2":2,"3":1,"4":7,"5":0,"6":1,"7":1,"8":1,"9":1,"10":7,"11":1,"12":6,"13":1,"14":5,"15":1,"16":4,"17":4,"18":2,"19":1,"20":1,"21":2,"22":1,"23":1,"24":1,"25":0,"26":1,"27":0},"f":{"0":1,"1":7,"2":0,"3":7,"4":0},"b":{"0":[1,6],"1":[1,5],"2":[1,4],"3":[5,1],"4":[2,2],"5":[1,1],"6":[1,1],"7":[1,0],"8":[1,1],"9":[0,1],"10":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/license/server/canEnableApp.ts"],"sourcesContent":["import type { IAppStorageItem } from '@rocket.chat/apps-engine/server/storage';\nimport { Apps } from '@rocket.chat/core-services';\nimport type { LicenseModule } from '@rocket.chat/core-typings';\nimport { License, type LicenseImp } from '@rocket.chat/license';\n\nimport { getInstallationSourceFromAppStorageItem } from '../../../../lib/apps/getInstallationSourceFromAppStorageItem';\n\ntype _canEnableAppDependencies = {\n\tApps: typeof Apps;\n\tLicense: LicenseImp;\n};\n\nexport const _canEnableApp = async ({ Apps, License }: _canEnableAppDependencies, app: IAppStorageItem): Promise<void> => {\n\tif (!(await Apps.isInitialized())) {\n\t\tthrow new Error('apps-engine-not-initialized');\n\t}\n\n\t// Migrated apps were installed before the validation was implemented\n\t// so they're always allowed to be enabled\n\tif (app.migrated) {\n\t\treturn;\n\t}\n\n\tif (app.info.addon && !License.hasModule(app.info.addon as LicenseModule)) {\n\t\tthrow new Error('app-addon-not-valid');\n\t}\n\n\tconst source = getInstallationSourceFromAppStorageItem(app);\n\tswitch (source) {\n\t\tcase 'private':\n\t\t\tif (await License.shouldPreventAction('privateApps')) {\n\t\t\t\tthrow new Error('license-prevented');\n\t\t\t}\n\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (await License.shouldPreventAction('marketplaceApps')) {\n\t\t\t\tthrow new Error('license-prevented');\n\t\t\t}\n\n\t\t\tif (app.marketplaceInfo?.isEnterpriseOnly && !License.hasValidLicense()) {\n\t\t\t\tthrow new Error('invalid-license');\n\t\t\t}\n\n\t\t\tbreak;\n\t}\n};\n\nexport const canEnableApp = async (app: IAppStorageItem): Promise<void> => _canEnableApp({ Apps, License }, app);\n"],"names":["_canEnableApp","canEnableApp","Apps","License","app","isInitialized","Error","migrated","info","addon","hasModule","source","getInstallationSourceFromAppStorageItem","shouldPreventAction","marketplaceInfo","isEnterpriseOnly","hasValidLicense"],"mappings":";;;;;;;;;;;IAYaA,aAAa;eAAbA;;IAoCAC,YAAY;eAAZA;;;8BA/CQ;yBAEoB;yDAEe;AAOjD,MAAMD,gBAAgB,OAAO,EAAEE,IAAI,EAAEC,OAAO,EAA6B,EAAEC;IACjF,IAAI,CAAE,MAAMF,KAAKG,aAAa,IAAK;QAClC,MAAM,IAAIC,MAAM;IACjB;IAEA,qEAAqE;IACrE,0CAA0C;IAC1C,IAAIF,IAAIG,QAAQ,EAAE;QACjB;IACD;IAEA,IAAIH,IAAII,IAAI,CAACC,KAAK,IAAI,CAACN,QAAQO,SAAS,CAACN,IAAII,IAAI,CAACC,KAAK,GAAoB;QAC1E,MAAM,IAAIH,MAAM;IACjB;IAEA,MAAMK,SAASC,IAAAA,gFAAuC,EAACR;IACvD,OAAQO;QACP,KAAK;YACJ,IAAI,MAAMR,QAAQU,mBAAmB,CAAC,gBAAgB;gBACrD,MAAM,IAAIP,MAAM;YACjB;YAEA;QACD;gBAKKF;YAJJ,IAAI,MAAMD,QAAQU,mBAAmB,CAAC,oBAAoB;gBACzD,MAAM,IAAIP,MAAM;YACjB;YAEA,IAAIF,EAAAA,uBAAAA,IAAIU,eAAe,cAAnBV,2CAAAA,qBAAqBW,gBAAgB,KAAI,CAACZ,QAAQa,eAAe,IAAI;gBACxE,MAAM,IAAIV,MAAM;YACjB;YAEA;IACF;AACD;AAEO,MAAML,eAAe,OAAOG,MAAwCJ,cAAc;QAAEE,MAAAA,kBAAI;QAAEC,SAAAA,gBAAO;IAAC,GAAGC","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/license/server/canEnableApp.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"eb3acf58ba192627ec34a80080dfae853f66481d","contentHash":"a2998b57b3cef3a2f5bc8452f4d01b4edaf5a2f37785bcb9d9dd9811f61931dd"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/apps/getInstallationSourceFromAppStorageItem.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/apps/getInstallationSourceFromAppStorageItem.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":55}},"3":{"start":{"line":12,"column":4},"end":{"line":12,"column":94}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"getInstallationSourceFromAppStorageItem","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":48}},"loc":{"start":{"line":11,"column":55},"end":{"line":13,"column":1}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":11},"end":{"line":12,"column":93}},"type":"binary-expr","locations":[{"start":{"line":12,"column":11},"end":{"line":12,"column":34}},{"start":{"line":12,"column":39},"end":{"line":12,"column":92}}],"line":12},"1":{"loc":{"start":{"line":12,"column":39},"end":{"line":12,"column":92}},"type":"cond-expr","locations":[{"start":{"line":12,"column":67},"end":{"line":12,"column":80}},{"start":{"line":12,"column":83},"end":{"line":12,"column":92}}],"line":12}},"s":{"0":1,"1":1,"2":4,"3":4},"f":{"0":4,"1":4},"b":{"0":[4,0],"1":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/apps/getInstallationSourceFromAppStorageItem.ts"],"sourcesContent":["import type { IAppStorageItem } from '@rocket.chat/apps-engine/server/storage';\nimport type { LicenseAppSources } from '@rocket.chat/core-typings';\n\n/**\n * There have been reports of apps not being correctly migrated from versions prior to 6.0\n *\n * This function is a workaround to get the installation source of an app from the app storage item\n * even if the installationSource property is not set.\n */\nexport function getInstallationSourceFromAppStorageItem(item: IAppStorageItem): LicenseAppSources {\n\treturn item.installationSource || ('marketplaceInfo' in item ? 'marketplace' : 'private');\n}\n"],"names":["getInstallationSourceFromAppStorageItem","item","installationSource"],"mappings":";;;;+BASgBA;;;eAAAA;;;AAAT,SAASA,wCAAwCC,IAAqB;IAC5E,OAAOA,KAAKC,kBAAkB,IAAK,CAAA,qBAAqBD,OAAO,gBAAgB,SAAQ;AACxF","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/apps/getInstallationSourceFromAppStorageItem.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"13ea7d207c4be80280e62e9452f4989e8723d8e8","contentHash":"0984ca8a33a6d6a097b1f669e56ffe2abc2fb9c0d9e002f6c2aafcbbd851ee37"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/BusinessHourManager.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/BusinessHourManager.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":35}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":46}},"5":{"start":{"line":13,"column":30},"end":{"line":13,"column":73}},"6":{"start":{"line":14,"column":19},"end":{"line":14,"column":55}},"7":{"start":{"line":15,"column":24},"end":{"line":15,"column":73}},"8":{"start":{"line":16,"column":16},"end":{"line":16,"column":51}},"9":{"start":{"line":17,"column":16},"end":{"line":17,"column":40}},"10":{"start":{"line":18,"column":27},"end":{"line":18,"column":57}},"11":{"start":{"line":20,"column":4},"end":{"line":22,"column":6}},"12":{"start":{"line":24,"column":39},"end":{"line":24,"column":50}},"13":{"start":{"line":25,"column":31},"end":{"line":25,"column":85}},"14":{"start":{"line":26,"column":26},"end":{"line":228,"column":1}},"15":{"start":{"line":28,"column":8},"end":{"line":28,"column":48}},"16":{"start":{"line":29,"column":8},"end":{"line":29,"column":30}},"17":{"start":{"line":30,"column":8},"end":{"line":30,"column":57}},"18":{"start":{"line":31,"column":8},"end":{"line":31,"column":51}},"19":{"start":{"line":32,"column":8},"end":{"line":32,"column":52}},"20":{"start":{"line":33,"column":8},"end":{"line":33,"column":54}},"21":{"start":{"line":36,"column":8},"end":{"line":36,"column":36}},"22":{"start":{"line":37,"column":8},"end":{"line":37,"column":34}},"23":{"start":{"line":38,"column":8},"end":{"line":38,"column":31}},"24":{"start":{"line":39,"column":8},"end":{"line":39,"column":53}},"25":{"start":{"line":40,"column":8},"end":{"line":40,"column":59}},"26":{"start":{"line":43,"column":8},"end":{"line":43,"column":33}},"27":{"start":{"line":44,"column":8},"end":{"line":44,"column":34}},"28":{"start":{"line":48,"column":34},"end":{"line":48,"column":107}},"29":{"start":{"line":49,"column":8},"end":{"line":52,"column":9}},"30":{"start":{"line":51,"column":12},"end":{"line":51,"column":19}},"31":{"start":{"line":53,"column":8},"end":{"line":68,"column":9}},"32":{"start":{"line":54,"column":12},"end":{"line":56,"column":13}},"33":{"start":{"line":55,"column":16},"end":{"line":55,"column":25}},"34":{"start":{"line":58,"column":39},"end":{"line":58,"column":101}},"35":{"start":{"line":59,"column":12},"end":{"line":65,"column":13}},"36":{"start":{"line":60,"column":37},"end":{"line":60,"column":126}},"37":{"start":{"line":61,"column":16},"end":{"line":63,"column":17}},"38":{"start":{"line":62,"column":20},"end":{"line":62,"column":29}},"39":{"start":{"line":64,"column":16},"end":{"line":64,"column":78}},"40":{"start":{"line":67,"column":12},"end":{"line":67,"column":137}},"41":{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},"42":{"start":{"line":72,"column":12},"end":{"line":72,"column":24}},"43":{"start":{"line":74,"column":8},"end":{"line":74,"column":68}},"44":{"start":{"line":77,"column":8},"end":{"line":77,"column":64}},"45":{"start":{"line":80,"column":8},"end":{"line":80,"column":33}},"46":{"start":{"line":83,"column":33},"end":{"line":83,"column":113}},"47":{"start":{"line":84,"column":8},"end":{"line":86,"column":9}},"48":{"start":{"line":85,"column":12},"end":{"line":85,"column":24}},"49":{"start":{"line":87,"column":8},"end":{"line":87,"column":52}},"50":{"start":{"line":90,"column":21},"end":{"line":90,"column":118}},"51":{"start":{"line":91,"column":22},"end":{"line":91,"column":67}},"52":{"start":{"line":92,"column":8},"end":{"line":94,"column":9}},"53":{"start":{"line":93,"column":12},"end":{"line":93,"column":19}},"54":{"start":{"line":95,"column":8},"end":{"line":95,"column":58}},"55":{"start":{"line":96,"column":8},"end":{"line":96,"column":48}},"56":{"start":{"line":99,"column":33},"end":{"line":99,"column":63}},"57":{"start":{"line":100,"column":8},"end":{"line":100,"column":58}},"58":{"start":{"line":101,"column":8},"end":{"line":103,"column":9}},"59":{"start":{"line":102,"column":12},"end":{"line":102,"column":19}},"60":{"start":{"line":104,"column":8},"end":{"line":104,"column":48}},"61":{"start":{"line":107,"column":8},"end":{"line":109,"column":9}},"62":{"start":{"line":108,"column":12},"end":{"line":108,"column":79}},"63":{"start":{"line":110,"column":23},"end":{"line":110,"column":95}},"64":{"start":{"line":111,"column":8},"end":{"line":119,"column":9}},"65":{"start":{"line":112,"column":12},"end":{"line":118,"column":15}},"66":{"start":{"line":120,"column":8},"end":{"line":120,"column":22}},"67":{"start":{"line":123,"column":8},"end":{"line":125,"column":9}},"68":{"start":{"line":124,"column":12},"end":{"line":124,"column":19}},"69":{"start":{"line":126,"column":8},"end":{"line":126,"column":48}},"70":{"start":{"line":129,"column":8},"end":{"line":129,"column":210}},"71":{"start":{"line":130,"column":8},"end":{"line":130,"column":198}},"72":{"start":{"line":131,"column":8},"end":{"line":131,"column":201}},"73":{"start":{"line":132,"column":8},"end":{"line":132,"column":201}},"74":{"start":{"line":133,"column":8},"end":{"line":133,"column":201}},"75":{"start":{"line":134,"column":8},"end":{"line":134,"column":186}},"76":{"start":{"line":137,"column":8},"end":{"line":137,"column":123}},"77":{"start":{"line":138,"column":8},"end":{"line":138,"column":120}},"78":{"start":{"line":139,"column":8},"end":{"line":139,"column":119}},"79":{"start":{"line":140,"column":8},"end":{"line":140,"column":121}},"80":{"start":{"line":141,"column":8},"end":{"line":141,"column":121}},"81":{"start":{"line":142,"column":8},"end":{"line":142,"column":109}},"82":{"start":{"line":145,"column":8},"end":{"line":145,"column":36}},"83":{"start":{"line":146,"column":8},"end":{"line":146,"column":34}},"84":{"start":{"line":147,"column":28},"end":{"line":147,"column":71}},"85":{"start":{"line":148,"column":8},"end":{"line":150,"column":9}},"86":{"start":{"line":149,"column":12},"end":{"line":149,"column":19}},"87":{"start":{"line":151,"column":34},"end":{"line":151,"column":43}},"88":{"start":{"line":152,"column":8},"end":{"line":152,"column":125}},"89":{"start":{"line":152,"column":54},"end":{"line":152,"column":122}},"90":{"start":{"line":153,"column":8},"end":{"line":153,"column":128}},"91":{"start":{"line":153,"column":55},"end":{"line":153,"column":125}},"92":{"start":{"line":156,"column":8},"end":{"line":162,"column":12}},"93":{"start":{"line":157,"column":25},"end":{"line":157,"column":69}},"94":{"start":{"line":158,"column":28},"end":{"line":158,"column":84}},"95":{"start":{"line":159,"column":31},"end":{"line":159,"column":84}},"96":{"start":{"line":160,"column":12},"end":{"line":160,"column":37}},"97":{"start":{"line":161,"column":12},"end":{"line":161,"column":78}},"98":{"start":{"line":161,"column":62},"end":{"line":161,"column":76}},"99":{"start":{"line":165,"column":8},"end":{"line":165,"column":70}},"100":{"start":{"line":168,"column":8},"end":{"line":168,"column":71}},"101":{"start":{"line":171,"column":8},"end":{"line":171,"column":36}},"102":{"start":{"line":174,"column":8},"end":{"line":174,"column":92}},"103":{"start":{"line":174,"column":60},"end":{"line":174,"column":89}},"104":{"start":{"line":177,"column":8},"end":{"line":177,"column":41}},"105":{"start":{"line":180,"column":8},"end":{"line":180,"column":32}},"106":{"start":{"line":183,"column":20},"end":{"line":183,"column":66}},"107":{"start":{"line":184,"column":27},"end":{"line":184,"column":42}},"108":{"start":{"line":185,"column":36},"end":{"line":185,"column":99}},"109":{"start":{"line":186,"column":30},"end":{"line":186,"column":120}},"110":{"start":{"line":187,"column":8},"end":{"line":187,"column":60}},"111":{"start":{"line":190,"column":8},"end":{"line":190,"column":137}},"112":{"start":{"line":193,"column":36},"end":{"line":193,"column":97}},"113":{"start":{"line":194,"column":43},"end":{"line":194,"column":142}},"114":{"start":{"line":194,"column":86},"end":{"line":194,"column":141}},"115":{"start":{"line":195,"column":8},"end":{"line":197,"column":9}},"116":{"start":{"line":196,"column":12},"end":{"line":196,"column":19}},"117":{"start":{"line":198,"column":23},"end":{"line":212,"column":11}},"118":{"start":{"line":199,"column":37},"end":{"line":199,"column":80}},"119":{"start":{"line":200,"column":12},"end":{"line":202,"column":13}},"120":{"start":{"line":201,"column":16},"end":{"line":201,"column":23}},"121":{"start":{"line":203,"column":12},"end":{"line":211,"column":15}},"122":{"start":{"line":206,"column":63},"end":{"line":210,"column":21}},"123":{"start":{"line":213,"column":23},"end":{"line":213,"column":66}},"124":{"start":{"line":213,"column":42},"end":{"line":213,"column":65}},"125":{"start":{"line":214,"column":8},"end":{"line":218,"column":9}},"126":{"start":{"line":215,"column":12},"end":{"line":217,"column":15}},"127":{"start":{"line":216,"column":16},"end":{"line":216,"column":116}},"128":{"start":{"line":219,"column":8},"end":{"line":219,"column":48}},"129":{"start":{"line":222,"column":8},"end":{"line":222,"column":31}},"130":{"start":{"line":223,"column":8},"end":{"line":223,"column":32}},"131":{"start":{"line":224,"column":8},"end":{"line":224,"column":33}},"132":{"start":{"line":225,"column":8},"end":{"line":225,"column":75}},"133":{"start":{"line":226,"column":8},"end":{"line":226,"column":77}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":33}},"loc":{"start":{"line":19,"column":39},"end":{"line":23,"column":1}},"line":19},"2":{"name":"(anonymous_2)","decl":{"start":{"line":27,"column":4},"end":{"line":27,"column":5}},"loc":{"start":{"line":27,"column":25},"end":{"line":34,"column":5}},"line":27},"3":{"name":"(anonymous_3)","decl":{"start":{"line":35,"column":4},"end":{"line":35,"column":5}},"loc":{"start":{"line":35,"column":24},"end":{"line":41,"column":5}},"line":35},"4":{"name":"(anonymous_4)","decl":{"start":{"line":42,"column":4},"end":{"line":42,"column":5}},"loc":{"start":{"line":42,"column":27},"end":{"line":45,"column":5}},"line":42},"5":{"name":"(anonymous_5)","decl":{"start":{"line":46,"column":4},"end":{"line":46,"column":5}},"loc":{"start":{"line":46,"column":48},"end":{"line":69,"column":5}},"line":46},"6":{"name":"(anonymous_6)","decl":{"start":{"line":70,"column":4},"end":{"line":70,"column":5}},"loc":{"start":{"line":70,"column":49},"end":{"line":75,"column":5}},"line":70},"7":{"name":"(anonymous_7)","decl":{"start":{"line":76,"column":4},"end":{"line":76,"column":5}},"loc":{"start":{"line":76,"column":47},"end":{"line":78,"column":5}},"line":76},"8":{"name":"(anonymous_8)","decl":{"start":{"line":79,"column":4},"end":{"line":79,"column":5}},"loc":{"start":{"line":79,"column":43},"end":{"line":81,"column":5}},"line":79},"9":{"name":"(anonymous_9)","decl":{"start":{"line":82,"column":4},"end":{"line":82,"column":5}},"loc":{"start":{"line":82,"column":36},"end":{"line":88,"column":5}},"line":82},"10":{"name":"(anonymous_10)","decl":{"start":{"line":89,"column":4},"end":{"line":89,"column":5}},"loc":{"start":{"line":89,"column":45},"end":{"line":97,"column":5}},"line":89},"11":{"name":"(anonymous_11)","decl":{"start":{"line":98,"column":4},"end":{"line":98,"column":5}},"loc":{"start":{"line":98,"column":50},"end":{"line":105,"column":5}},"line":98},"12":{"name":"(anonymous_12)","decl":{"start":{"line":106,"column":4},"end":{"line":106,"column":5}},"loc":{"start":{"line":106,"column":27},"end":{"line":121,"column":5}},"line":106},"13":{"name":"(anonymous_13)","decl":{"start":{"line":122,"column":4},"end":{"line":122,"column":5}},"loc":{"start":{"line":122,"column":39},"end":{"line":127,"column":5}},"line":122},"14":{"name":"(anonymous_14)","decl":{"start":{"line":128,"column":4},"end":{"line":128,"column":5}},"loc":{"start":{"line":128,"column":21},"end":{"line":135,"column":5}},"line":128},"15":{"name":"(anonymous_15)","decl":{"start":{"line":136,"column":4},"end":{"line":136,"column":5}},"loc":{"start":{"line":136,"column":22},"end":{"line":143,"column":5}},"line":136},"16":{"name":"(anonymous_16)","decl":{"start":{"line":144,"column":4},"end":{"line":144,"column":5}},"loc":{"start":{"line":144,"column":39},"end":{"line":154,"column":5}},"line":144},"17":{"name":"(anonymous_17)","decl":{"start":{"line":152,"column":36},"end":{"line":152,"column":37}},"loc":{"start":{"line":152,"column":54},"end":{"line":152,"column":122}},"line":152},"18":{"name":"(anonymous_18)","decl":{"start":{"line":153,"column":37},"end":{"line":153,"column":38}},"loc":{"start":{"line":153,"column":55},"end":{"line":153,"column":125}},"line":153},"19":{"name":"(anonymous_19)","decl":{"start":{"line":155,"column":4},"end":{"line":155,"column":5}},"loc":{"start":{"line":155,"column":49},"end":{"line":163,"column":5}},"line":155},"20":{"name":"(anonymous_20)","decl":{"start":{"line":156,"column":36},"end":{"line":156,"column":37}},"loc":{"start":{"line":156,"column":44},"end":{"line":162,"column":9}},"line":156},"21":{"name":"(anonymous_21)","decl":{"start":{"line":161,"column":58},"end":{"line":161,"column":59}},"loc":{"start":{"line":161,"column":62},"end":{"line":161,"column":76}},"line":161},"22":{"name":"(anonymous_22)","decl":{"start":{"line":164,"column":4},"end":{"line":164,"column":5}},"loc":{"start":{"line":164,"column":43},"end":{"line":166,"column":5}},"line":164},"23":{"name":"(anonymous_23)","decl":{"start":{"line":167,"column":4},"end":{"line":167,"column":5}},"loc":{"start":{"line":167,"column":44},"end":{"line":169,"column":5}},"line":167},"24":{"name":"(anonymous_24)","decl":{"start":{"line":170,"column":4},"end":{"line":170,"column":5}},"loc":{"start":{"line":170,"column":30},"end":{"line":172,"column":5}},"line":170},"25":{"name":"(anonymous_25)","decl":{"start":{"line":173,"column":4},"end":{"line":173,"column":5}},"loc":{"start":{"line":173,"column":27},"end":{"line":175,"column":5}},"line":173},"26":{"name":"(anonymous_26)","decl":{"start":{"line":174,"column":49},"end":{"line":174,"column":50}},"loc":{"start":{"line":174,"column":60},"end":{"line":174,"column":89}},"line":174},"27":{"name":"(anonymous_27)","decl":{"start":{"line":176,"column":4},"end":{"line":176,"column":5}},"loc":{"start":{"line":176,"column":24},"end":{"line":178,"column":5}},"line":176},"28":{"name":"(anonymous_28)","decl":{"start":{"line":179,"column":4},"end":{"line":179,"column":5}},"loc":{"start":{"line":179,"column":25},"end":{"line":181,"column":5}},"line":179},"29":{"name":"(anonymous_29)","decl":{"start":{"line":182,"column":4},"end":{"line":182,"column":5}},"loc":{"start":{"line":182,"column":43},"end":{"line":188,"column":5}},"line":182},"30":{"name":"(anonymous_30)","decl":{"start":{"line":189,"column":4},"end":{"line":189,"column":5}},"loc":{"start":{"line":189,"column":46},"end":{"line":191,"column":5}},"line":189},"31":{"name":"(anonymous_31)","decl":{"start":{"line":192,"column":4},"end":{"line":192,"column":5}},"loc":{"start":{"line":192,"column":44},"end":{"line":220,"column":5}},"line":192},"32":{"name":"(anonymous_32)","decl":{"start":{"line":194,"column":70},"end":{"line":194,"column":71}},"loc":{"start":{"line":194,"column":86},"end":{"line":194,"column":141}},"line":194},"33":{"name":"(anonymous_33)","decl":{"start":{"line":198,"column":79},"end":{"line":198,"column":80}},"loc":{"start":{"line":198,"column":95},"end":{"line":212,"column":9}},"line":198},"34":{"name":"(anonymous_34)","decl":{"start":{"line":206,"column":54},"end":{"line":206,"column":55}},"loc":{"start":{"line":206,"column":63},"end":{"line":210,"column":21}},"line":206},"35":{"name":"(anonymous_35)","decl":{"start":{"line":213,"column":37},"end":{"line":213,"column":38}},"loc":{"start":{"line":213,"column":42},"end":{"line":213,"column":65}},"line":213},"36":{"name":"(anonymous_36)","decl":{"start":{"line":215,"column":27},"end":{"line":215,"column":28}},"loc":{"start":{"line":215,"column":36},"end":{"line":217,"column":13}},"line":215},"37":{"name":"(anonymous_37)","decl":{"start":{"line":221,"column":4},"end":{"line":221,"column":5}},"loc":{"start":{"line":221,"column":25},"end":{"line":227,"column":5}},"line":221}},"branchMap":{"0":{"loc":{"start":{"line":20,"column":11},"end":{"line":22,"column":5}},"type":"cond-expr","locations":[{"start":{"line":20,"column":35},"end":{"line":20,"column":38}},{"start":{"line":20,"column":41},"end":{"line":22,"column":5}}],"line":20},"1":{"loc":{"start":{"line":20,"column":11},"end":{"line":20,"column":32}},"type":"binary-expr","locations":[{"start":{"line":20,"column":11},"end":{"line":20,"column":14}},{"start":{"line":20,"column":18},"end":{"line":20,"column":32}}],"line":20},"2":{"loc":{"start":{"line":49,"column":8},"end":{"line":52,"column":9}},"type":"if","locations":[{"start":{"line":49,"column":8},"end":{"line":52,"column":9}},{"start":{"line":49,"column":8},"end":{"line":52,"column":9}}],"line":49},"3":{"loc":{"start":{"line":54,"column":12},"end":{"line":56,"column":13}},"type":"if","locations":[{"start":{"line":54,"column":12},"end":{"line":56,"column":13}},{"start":{"line":54,"column":12},"end":{"line":56,"column":13}}],"line":54},"4":{"loc":{"start":{"line":58,"column":39},"end":{"line":58,"column":101}},"type":"binary-expr","locations":[{"start":{"line":58,"column":39},"end":{"line":58,"column":68}},{"start":{"line":58,"column":72},"end":{"line":58,"column":101}}],"line":58},"5":{"loc":{"start":{"line":59,"column":12},"end":{"line":65,"column":13}},"type":"if","locations":[{"start":{"line":59,"column":12},"end":{"line":65,"column":13}},{"start":{"line":59,"column":12},"end":{"line":65,"column":13}}],"line":59},"6":{"loc":{"start":{"line":61,"column":16},"end":{"line":63,"column":17}},"type":"if","locations":[{"start":{"line":61,"column":16},"end":{"line":63,"column":17}},{"start":{"line":61,"column":16},"end":{"line":63,"column":17}}],"line":61},"7":{"loc":{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},"type":"if","locations":[{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},{"start":{"line":71,"column":8},"end":{"line":73,"column":9}}],"line":71},"8":{"loc":{"start":{"line":83,"column":58},"end":{"line":83,"column":112}},"type":"binary-expr","locations":[{"start":{"line":83,"column":58},"end":{"line":83,"column":62}},{"start":{"line":83,"column":66},"end":{"line":83,"column":112}}],"line":83},"9":{"loc":{"start":{"line":84,"column":8},"end":{"line":86,"column":9}},"type":"if","locations":[{"start":{"line":84,"column":8},"end":{"line":86,"column":9}},{"start":{"line":84,"column":8},"end":{"line":86,"column":9}}],"line":84},"10":{"loc":{"start":{"line":90,"column":46},"end":{"line":90,"column":117}},"type":"binary-expr","locations":[{"start":{"line":90,"column":46},"end":{"line":90,"column":67}},{"start":{"line":90,"column":71},"end":{"line":90,"column":117}}],"line":90},"11":{"loc":{"start":{"line":92,"column":8},"end":{"line":94,"column":9}},"type":"if","locations":[{"start":{"line":92,"column":8},"end":{"line":94,"column":9}},{"start":{"line":92,"column":8},"end":{"line":94,"column":9}}],"line":92},"12":{"loc":{"start":{"line":101,"column":8},"end":{"line":103,"column":9}},"type":"if","locations":[{"start":{"line":101,"column":8},"end":{"line":103,"column":9}},{"start":{"line":101,"column":8},"end":{"line":103,"column":9}}],"line":101},"13":{"loc":{"start":{"line":107,"column":8},"end":{"line":109,"column":9}},"type":"if","locations":[{"start":{"line":107,"column":8},"end":{"line":109,"column":9}},{"start":{"line":107,"column":8},"end":{"line":109,"column":9}}],"line":107},"14":{"loc":{"start":{"line":111,"column":8},"end":{"line":119,"column":9}},"type":"if","locations":[{"start":{"line":111,"column":8},"end":{"line":119,"column":9}},{"start":{"line":111,"column":8},"end":{"line":119,"column":9}}],"line":111},"15":{"loc":{"start":{"line":123,"column":8},"end":{"line":125,"column":9}},"type":"if","locations":[{"start":{"line":123,"column":8},"end":{"line":125,"column":9}},{"start":{"line":123,"column":8},"end":{"line":125,"column":9}}],"line":123},"16":{"loc":{"start":{"line":148,"column":8},"end":{"line":150,"column":9}},"type":"if","locations":[{"start":{"line":148,"column":8},"end":{"line":150,"column":9}},{"start":{"line":148,"column":8},"end":{"line":150,"column":9}}],"line":148},"17":{"loc":{"start":{"line":187,"column":15},"end":{"line":187,"column":59}},"type":"binary-expr","locations":[{"start":{"line":187,"column":15},"end":{"line":187,"column":42}},{"start":{"line":187,"column":46},"end":{"line":187,"column":59}}],"line":187},"18":{"loc":{"start":{"line":194,"column":86},"end":{"line":194,"column":141}},"type":"binary-expr","locations":[{"start":{"line":194,"column":86},"end":{"line":194,"column":94}},{"start":{"line":194,"column":98},"end":{"line":194,"column":141}}],"line":194},"19":{"loc":{"start":{"line":195,"column":8},"end":{"line":197,"column":9}},"type":"if","locations":[{"start":{"line":195,"column":8},"end":{"line":197,"column":9}},{"start":{"line":195,"column":8},"end":{"line":197,"column":9}}],"line":195},"20":{"loc":{"start":{"line":200,"column":12},"end":{"line":202,"column":13}},"type":"if","locations":[{"start":{"line":200,"column":12},"end":{"line":202,"column":13}},{"start":{"line":200,"column":12},"end":{"line":202,"column":13}}],"line":200},"21":{"loc":{"start":{"line":214,"column":8},"end":{"line":218,"column":9}},"type":"if","locations":[{"start":{"line":214,"column":8},"end":{"line":218,"column":9}},{"start":{"line":214,"column":8},"end":{"line":218,"column":9}}],"line":214}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":3,"16":3,"17":3,"18":3,"19":3,"20":3,"21":2,"22":2,"23":2,"24":2,"25":2,"26":1,"27":1,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":1,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":5,"107":5,"108":5,"109":5,"110":5,"111":3,"112":5,"113":5,"114":5,"115":5,"116":2,"117":3,"118":4,"119":4,"120":0,"121":4,"122":4,"123":3,"124":4,"125":3,"126":1,"127":1,"128":3,"129":2,"130":2,"131":2,"132":2,"133":2},"f":{"0":1,"1":1,"2":3,"3":2,"4":1,"5":0,"6":0,"7":0,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":5,"30":3,"31":5,"32":5,"33":4,"34":4,"35":4,"36":1,"37":2},"b":{"0":[0,1],"1":[1,1],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[5,4],"18":[5,5],"19":[2,3],"20":[0,4],"21":[1,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/BusinessHourManager.ts"],"sourcesContent":["import type { ILivechatBusinessHour, IBusinessHourTimezone } from '@rocket.chat/core-typings';\nimport { LivechatBusinessHourTypes } from '@rocket.chat/core-typings';\nimport type { AgendaCronJobs } from '@rocket.chat/cron';\nimport { LivechatBusinessHours, LivechatDepartment, Users } from '@rocket.chat/models';\nimport moment from 'moment';\n\nimport { callbacks } from '../../../../lib/callbacks';\nimport { notifyOnUserChange } from '../../../lib/server/lib/notifyListener';\nimport { settings } from '../../../settings/server';\nimport { businessHourLogger } from '../lib/logger';\nimport type { IBusinessHourBehavior, IBusinessHourType } from './AbstractBusinessHour';\nimport { closeBusinessHour } from './closeBusinessHour';\n\nconst CRON_EVERY_MIDNIGHT_EXPRESSION = '0 0 * * *';\nconst CRON_DAYLIGHT_JOB_NAME = 'livechat-business-hour-daylight-saving-time-verifier';\n\nexport class BusinessHourManager {\n\tprivate types: Map<string, IBusinessHourType> = new Map();\n\n\tprivate behavior: IBusinessHourBehavior;\n\n\tprivate cronJobs: AgendaCronJobs;\n\n\tprivate cronJobsCache: string[] = [];\n\n\tconstructor(cronJobs: AgendaCronJobs) {\n\t\tthis.cronJobs = cronJobs;\n\t\tthis.openWorkHoursCallback = this.openWorkHoursCallback.bind(this);\n\t\tthis.closeWorkHoursCallback = this.closeWorkHoursCallback.bind(this);\n\t}\n\n\tasync startManager(): Promise<void> {\n\t\tawait this.createCronJobsForWorkHours();\n\t\tthis.setupCallbacks();\n\t\tawait this.cleanupDisabledDepartmentReferences();\n\t\tawait this.behavior.onStartBusinessHours();\n\t\tvoid this.startDaylightSavingTimeVerifier();\n\t\tvoid this.registerDaylightSavingTimeCronJob();\n\t}\n\n\tasync stopManager(): Promise<void> {\n\t\tawait this.removeCronJobs();\n\t\tthis.clearCronJobsCache();\n\t\tthis.removeCallbacks();\n\t\tawait this.behavior.onDisableBusinessHours();\n\t\tawait this.cronJobs.remove(CRON_DAYLIGHT_JOB_NAME);\n\t}\n\n\tasync restartManager(): Promise<void> {\n\t\tawait this.stopManager();\n\t\tawait this.startManager();\n\t}\n\n\tasync cleanupDisabledDepartmentReferences(): Promise<void> {\n\t\t// Get business hours with departments enabled and disabled\n\t\tconst bhWithDepartments = await LivechatDepartment.getBusinessHoursWithDepartmentStatuses();\n\n\t\tif (!bhWithDepartments.length) {\n\t\t\t// If there are no bh, skip\n\t\t\treturn;\n\t\t}\n\n\t\tfor await (const { _id: businessHourId, validDepartments, invalidDepartments } of bhWithDepartments) {\n\t\t\tif (!invalidDepartments.length) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// If there are no enabled departments, close the business hour\n\t\t\tconst allDepsAreDisabled = validDepartments.length === 0 && invalidDepartments.length > 0;\n\t\t\tif (allDepsAreDisabled) {\n\t\t\t\tconst businessHour = await this.getBusinessHour(businessHourId, LivechatBusinessHourTypes.CUSTOM);\n\t\t\t\tif (!businessHour) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tawait closeBusinessHour(businessHour);\n\t\t\t}\n\n\t\t\t// Remove business hour from disabled departments\n\t\t\tawait LivechatDepartment.removeBusinessHourFromDepartmentsByIdsAndBusinessHourId(invalidDepartments, businessHourId);\n\t\t}\n\t}\n\n\tasync allowAgentChangeServiceStatus(agentId: string): Promise<boolean> {\n\t\tif (!settings.get('Livechat_enable_business_hours')) {\n\t\t\treturn true;\n\t\t}\n\t\treturn this.behavior.allowAgentChangeServiceStatus(agentId);\n\t}\n\n\tregisterBusinessHourType(businessHourType: IBusinessHourType): void {\n\t\tthis.types.set(businessHourType.name, businessHourType);\n\t}\n\n\tregisterBusinessHourBehavior(behavior: IBusinessHourBehavior): void {\n\t\tthis.behavior = behavior;\n\t}\n\n\tasync getBusinessHour(id?: string, type?: string): Promise<ILivechatBusinessHour | null> {\n\t\tconst businessHourType = this.getBusinessHourType((type as string) || LivechatBusinessHourTypes.DEFAULT);\n\t\tif (!businessHourType) {\n\t\t\treturn null;\n\t\t}\n\t\treturn businessHourType.getBusinessHour(id);\n\t}\n\n\tasync saveBusinessHour(businessHourData: ILivechatBusinessHour): Promise<void> {\n\t\tconst type = this.getBusinessHourType((businessHourData.type as string) || LivechatBusinessHourTypes.DEFAULT) as IBusinessHourType;\n\t\tconst saved = await type.saveBusinessHour(businessHourData);\n\t\tif (!settings.get('Livechat_enable_business_hours')) {\n\t\t\treturn;\n\t\t}\n\t\tawait this.behavior.afterSaveBusinessHours(saved);\n\t\tawait this.createCronJobsForWorkHours();\n\t}\n\n\tasync removeBusinessHourByIdAndType(id: string, type: string): Promise<void> {\n\t\tconst businessHourType = this.getBusinessHourType(type) as IBusinessHourType;\n\t\tawait businessHourType.removeBusinessHourById(id);\n\t\tif (!settings.get('Livechat_enable_business_hours')) {\n\t\t\treturn;\n\t\t}\n\t\tawait this.createCronJobsForWorkHours();\n\t}\n\n\tasync onLogin(agentId: string): Promise<any> {\n\t\tif (!settings.get('Livechat_enable_business_hours')) {\n\t\t\treturn this.behavior.changeAgentActiveStatus(agentId, 'available');\n\t\t}\n\n\t\tconst result = await Users.setLivechatStatusActiveBasedOnBusinessHours(agentId);\n\t\tif (result.updatedCount > 0) {\n\t\t\tvoid notifyOnUserChange({ clientAction: 'updated', id: agentId, diff: { statusLivechat: 'available ' } });\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tasync restartCronJobsIfNecessary(): Promise<void> {\n\t\tif (!settings.get('Livechat_enable_business_hours')) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.createCronJobsForWorkHours();\n\t}\n\n\tprivate setupCallbacks(): void {\n\t\tcallbacks.add(\n\t\t\t'livechat.removeAgentDepartment',\n\t\t\tthis.behavior.onRemoveAgentFromDepartment.bind(this),\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'business-hour-livechat-on-remove-agent-department',\n\t\t);\n\t\tcallbacks.add(\n\t\t\t'livechat.afterRemoveDepartment',\n\t\t\tthis.behavior.onRemoveDepartment.bind(this),\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'business-hour-livechat-after-remove-department',\n\t\t);\n\t\tcallbacks.add(\n\t\t\t'livechat.saveAgentDepartment',\n\t\t\tthis.behavior.onAddAgentToDepartment.bind(this),\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'business-hour-livechat-on-save-agent-department',\n\t\t);\n\t\tcallbacks.add(\n\t\t\t'livechat.afterDepartmentDisabled',\n\t\t\tthis.behavior.onDepartmentDisabled.bind(this),\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'business-hour-livechat-on-department-disabled',\n\t\t);\n\t\tcallbacks.add(\n\t\t\t'livechat.afterDepartmentArchived',\n\t\t\tthis.behavior.onDepartmentArchived.bind(this),\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'business-hour-livechat-on-department-archived',\n\t\t);\n\t\tcallbacks.add(\n\t\t\t'livechat.onNewAgentCreated',\n\t\t\tthis.behavior.onNewAgentCreated.bind(this),\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'business-hour-livechat-on-agent-created',\n\t\t);\n\t}\n\n\tprivate removeCallbacks(): void {\n\t\tcallbacks.remove('livechat.removeAgentDepartment', 'business-hour-livechat-on-remove-agent-department');\n\t\tcallbacks.remove('livechat.afterRemoveDepartment', 'business-hour-livechat-after-remove-department');\n\t\tcallbacks.remove('livechat.saveAgentDepartment', 'business-hour-livechat-on-save-agent-department');\n\t\tcallbacks.remove('livechat.afterDepartmentDisabled', 'business-hour-livechat-on-department-disabled');\n\t\tcallbacks.remove('livechat.afterDepartmentArchived', 'business-hour-livechat-on-department-archived');\n\t\tcallbacks.remove('livechat.onNewAgentCreated', 'business-hour-livechat-on-agent-created');\n\t}\n\n\tprivate async createCronJobsForWorkHours(): Promise<void> {\n\t\tawait this.removeCronJobs();\n\t\tthis.clearCronJobsCache();\n\t\tconst [workHours] = await this.behavior.findHoursToCreateJobs();\n\t\tif (!workHours) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { start, finish } = workHours;\n\n\t\tawait Promise.all(start.map(({ day, times }) => this.scheduleCronJob(times, day, 'open', this.openWorkHoursCallback)));\n\t\tawait Promise.all(finish.map(({ day, times }) => this.scheduleCronJob(times, day, 'close', this.closeWorkHoursCallback)));\n\t}\n\n\tprivate async scheduleCronJob(\n\t\titems: string[],\n\t\tday: string,\n\t\ttype: 'open' | 'close',\n\t\tjob: (day: string, hour: string) => void,\n\t): Promise<void> {\n\t\tawait Promise.all(\n\t\t\titems.map((hour) => {\n\t\t\t\tconst time = moment(hour, 'HH:mm').day(day);\n\t\t\t\tconst jobName = `${time.format('dddd')}/${time.format('HH:mm')}/${type}`;\n\t\t\t\tconst scheduleAt = `${time.minutes()} ${time.hours()} * * ${time.day()}`;\n\t\t\t\tthis.addToCache(jobName);\n\t\t\t\treturn this.cronJobs.add(jobName, scheduleAt, () => job(day, hour));\n\t\t\t}),\n\t\t);\n\t}\n\n\tprivate async openWorkHoursCallback(day: string, hour: string): Promise<void> {\n\t\treturn this.behavior.openBusinessHoursByDayAndHour(day, hour);\n\t}\n\n\tprivate async closeWorkHoursCallback(day: string, hour: string): Promise<void> {\n\t\treturn this.behavior.closeBusinessHoursByDayAndHour(day, hour);\n\t}\n\n\tprivate getBusinessHourType(type: string): IBusinessHourType | undefined {\n\t\treturn this.types.get(type);\n\t}\n\n\tprivate async removeCronJobs(): Promise<void> {\n\t\tawait Promise.all(this.cronJobsCache.map((jobName) => this.cronJobs.remove(jobName)));\n\t}\n\n\tprivate addToCache(jobName: string): void {\n\t\tthis.cronJobsCache.push(jobName);\n\t}\n\n\tprivate clearCronJobsCache(): void {\n\t\tthis.cronJobsCache = [];\n\t}\n\n\thasDaylightSavingTimeChanged(timezone: IBusinessHourTimezone): boolean {\n\t\tconst now = moment().utc().tz(timezone.name);\n\t\tconst currentUTC = now.format('Z');\n\t\tconst existingTimezoneUTC = moment(timezone.utc, 'Z').utc().tz(timezone.name);\n\t\tconst DSTHasChanged = !moment(currentUTC, 'Z').utc().tz(timezone.name).isSame(existingTimezoneUTC);\n\n\t\treturn currentUTC !== timezone.utc && DSTHasChanged;\n\t}\n\n\tasync registerDaylightSavingTimeCronJob(): Promise<void> {\n\t\tawait this.cronJobs.add(CRON_DAYLIGHT_JOB_NAME, CRON_EVERY_MIDNIGHT_EXPRESSION, this.startDaylightSavingTimeVerifier.bind(this));\n\t}\n\n\tasync startDaylightSavingTimeVerifier(): Promise<void> {\n\t\tconst activeBusinessHours = await LivechatBusinessHours.findActiveBusinessHours();\n\t\tconst timezonesNeedingAdjustment = activeBusinessHours.filter(\n\t\t\t({ timezone }) => timezone && this.hasDaylightSavingTimeChanged(timezone),\n\t\t);\n\t\tif (timezonesNeedingAdjustment.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = await Promise.allSettled(\n\t\t\ttimezonesNeedingAdjustment.map((businessHour) => {\n\t\t\t\tconst businessHourType = this.getBusinessHourType(businessHour.type);\n\t\t\t\tif (!businessHourType) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treturn businessHourType.saveBusinessHour({\n\t\t\t\t\t...businessHour,\n\t\t\t\t\ttimezoneName: businessHour.timezone.name,\n\t\t\t\t\tworkHours: businessHour.workHours.map((hour) => ({ ...hour, start: hour.start.time, finish: hour.finish.time })) as Record<\n\t\t\t\t\t\tstring,\n\t\t\t\t\t\tany\n\t\t\t\t\t>[],\n\t\t\t\t} as ILivechatBusinessHour & { timezoneName: string });\n\t\t\t}),\n\t\t);\n\t\tconst failed = result.filter((r) => r.status === 'rejected');\n\t\tif (failed.length > 0) {\n\t\t\tfailed.forEach((error: any) => {\n\t\t\t\tbusinessHourLogger.error('Failed to update business hours with new timezone', error.reason);\n\t\t\t});\n\t\t}\n\n\t\tawait this.createCronJobsForWorkHours();\n\t}\n}\n"],"names":["BusinessHourManager","CRON_EVERY_MIDNIGHT_EXPRESSION","CRON_DAYLIGHT_JOB_NAME","startManager","createCronJobsForWorkHours","setupCallbacks","cleanupDisabledDepartmentReferences","behavior","onStartBusinessHours","startDaylightSavingTimeVerifier","registerDaylightSavingTimeCronJob","stopManager","removeCronJobs","clearCronJobsCache","removeCallbacks","onDisableBusinessHours","cronJobs","remove","restartManager","bhWithDepartments","LivechatDepartment","getBusinessHoursWithDepartmentStatuses","length","_id","businessHourId","validDepartments","invalidDepartments","allDepsAreDisabled","businessHour","getBusinessHour","LivechatBusinessHourTypes","CUSTOM","closeBusinessHour","removeBusinessHourFromDepartmentsByIdsAndBusinessHourId","allowAgentChangeServiceStatus","agentId","settings","get","registerBusinessHourType","businessHourType","types","set","name","registerBusinessHourBehavior","id","type","getBusinessHourType","DEFAULT","saveBusinessHour","businessHourData","saved","afterSaveBusinessHours","removeBusinessHourByIdAndType","removeBusinessHourById","onLogin","changeAgentActiveStatus","result","Users","setLivechatStatusActiveBasedOnBusinessHours","updatedCount","notifyOnUserChange","clientAction","diff","statusLivechat","restartCronJobsIfNecessary","callbacks","add","onRemoveAgentFromDepartment","bind","priority","HIGH","onRemoveDepartment","onAddAgentToDepartment","onDepartmentDisabled","onDepartmentArchived","onNewAgentCreated","workHours","findHoursToCreateJobs","start","finish","Promise","all","map","day","times","scheduleCronJob","openWorkHoursCallback","closeWorkHoursCallback","items","job","hour","time","moment","jobName","format","scheduleAt","minutes","hours","addToCache","openBusinessHoursByDayAndHour","closeBusinessHoursByDayAndHour","cronJobsCache","push","hasDaylightSavingTimeChanged","timezone","now","utc","tz","currentUTC","existingTimezoneUTC","DSTHasChanged","isSame","activeBusinessHours","LivechatBusinessHours","findActiveBusinessHours","timezonesNeedingAdjustment","filter","allSettled","timezoneName","failed","r","status","forEach","error","businessHourLogger","reason","constructor","Map"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/BusinessHourManager.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e47b50ec20b9d7492afdfdfaf61b6866266040d7","contentHash":"1ed5843bf6d191b9a27d9e70849f21e3d1f881e7a6f85d5e715644607881a3e3"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/closeBusinessHour.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/closeBusinessHour.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":33}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":43}},"6":{"start":{"line":19,"column":16},"end":{"line":19,"column":46}},"7":{"start":{"line":20,"column":24},"end":{"line":20,"column":63}},"8":{"start":{"line":21,"column":16},"end":{"line":21,"column":40}},"9":{"start":{"line":22,"column":16},"end":{"line":22,"column":35}},"10":{"start":{"line":23,"column":36},"end":{"line":23,"column":75}},"11":{"start":{"line":24,"column":36},"end":{"line":33,"column":1}},"12":{"start":{"line":25,"column":4},"end":{"line":30,"column":7}},"13":{"start":{"line":31,"column":4},"end":{"line":31,"column":79}},"14":{"start":{"line":32,"column":4},"end":{"line":32,"column":66}},"15":{"start":{"line":34,"column":26},"end":{"line":37,"column":2}},"16":{"start":{"line":35,"column":21},"end":{"line":35,"column":88}},"17":{"start":{"line":36,"column":4},"end":{"line":36,"column":67}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":23},"end":{"line":12,"column":24}},"loc":{"start":{"line":12,"column":34},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":33},"end":{"line":15,"column":34}},"loc":{"start":{"line":15,"column":44},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":24,"column":36},"end":{"line":24,"column":37}},"loc":{"start":{"line":24,"column":70},"end":{"line":33,"column":1}},"line":24},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":60},"end":{"line":34,"column":61}},"loc":{"start":{"line":34,"column":82},"end":{"line":37,"column":1}},"line":34}},"branchMap":{},"s":{"0":1,"1":1,"2":2,"3":1,"4":0,"5":0,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":0,"13":0,"14":0,"15":1,"16":0,"17":0},"f":{"0":1,"1":0,"2":0,"3":0,"4":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/closeBusinessHour.ts"],"sourcesContent":["import type { ILivechatBusinessHour, IUser } from '@rocket.chat/core-typings';\nimport { Users } from '@rocket.chat/models';\nimport { makeFunction } from '@rocket.chat/patch-injection';\n\nimport { businessHourLogger } from '../lib/logger';\nimport { makeAgentsUnavailableBasedOnBusinessHour } from './Helper';\nimport { getAgentIdsForBusinessHour } from './getAgentIdsForBusinessHour';\n\nexport const closeBusinessHourByAgentIds = async (\n\tbusinessHourId: ILivechatBusinessHour['_id'],\n\tagentIds: IUser['_id'][],\n): Promise<void> => {\n\tbusinessHourLogger.debug({\n\t\tmsg: 'Closing business hour',\n\t\tbusinessHour: businessHourId,\n\t\ttotalAgents: agentIds.length,\n\t\ttop10AgentIds: agentIds.slice(0, 10),\n\t});\n\tawait Users.removeBusinessHourByAgentIds(agentIds, businessHourId);\n\n\tawait makeAgentsUnavailableBasedOnBusinessHour();\n};\n\nexport const closeBusinessHour = makeFunction(async (businessHour: Pick<ILivechatBusinessHour, '_id' | 'type'>): Promise<void> => {\n\tconst agentIds = await getAgentIdsForBusinessHour();\n\treturn closeBusinessHourByAgentIds(businessHour._id, agentIds);\n});\n"],"names":["closeBusinessHour","closeBusinessHourByAgentIds","businessHourId","agentIds","businessHourLogger","debug","msg","businessHour","totalAgents","length","top10AgentIds","slice","Users","removeBusinessHourByAgentIds","makeAgentsUnavailableBasedOnBusinessHour","makeFunction","getAgentIdsForBusinessHour","_id"],"mappings":";;;;;;;;;;;IAuBaA,iBAAiB;eAAjBA;;IAfAC,2BAA2B;eAA3BA;;;wBAPS;gCACO;wBAEM;wBACsB;4CACd;AAEpC,MAAMA,8BAA8B,OAC1CC,gBACAC;IAEAC,0BAAkB,CAACC,KAAK,CAAC;QACxBC,KAAK;QACLC,cAAcL;QACdM,aAAaL,SAASM,MAAM;QAC5BC,eAAeP,SAASQ,KAAK,CAAC,GAAG;IAClC;IACA,MAAMC,aAAK,CAACC,4BAA4B,CAACV,UAAUD;IAEnD,MAAMY,IAAAA,gDAAwC;AAC/C;AAEO,MAAMd,oBAAoBe,IAAAA,4BAAY,EAAC,OAAOR;IACpD,MAAMJ,WAAW,MAAMa,IAAAA,sDAA0B;IACjD,OAAOf,4BAA4BM,aAAaU,GAAG,EAAEd;AACtD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/closeBusinessHour.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"74435d745390f8bba0dff1300e3708361643c5c1","contentHash":"e1bd463bf6e0bd943a8baddef33e148f0cef627d2d11e2f64e1003d61a0a491c"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/logger.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/logger.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":21,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":34}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":30}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":30}},"7":{"start":{"line":22,"column":16},"end":{"line":22,"column":46}},"8":{"start":{"line":23,"column":23},"end":{"line":23,"column":67}},"9":{"start":{"line":24,"column":27},"end":{"line":24,"column":62}},"10":{"start":{"line":25,"column":23},"end":{"line":25,"column":53}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":24},"end":{"line":12,"column":25}},"loc":{"start":{"line":12,"column":35},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":20},"end":{"line":15,"column":21}},"loc":{"start":{"line":15,"column":31},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":20},"end":{"line":18,"column":21}},"loc":{"start":{"line":18,"column":31},"end":{"line":20,"column":5}},"line":18}},"branchMap":{},"s":{"0":1,"1":1,"2":3,"3":1,"4":0,"5":0,"6":0,"7":1,"8":1,"9":1,"10":1},"f":{"0":1,"1":0,"2":0,"3":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/logger.ts"],"sourcesContent":["import { Logger } from '@rocket.chat/logger';\n\nexport const callbackLogger = new Logger('[Omnichannel] Callback');\nexport const businessHourLogger = new Logger('Business Hour');\nexport const livechatLogger = new Logger('Livechat');\n"],"names":["businessHourLogger","callbackLogger","livechatLogger","Logger"],"mappings":";;;;;;;;;;;IAGaA,kBAAkB;eAAlBA;;IADAC,cAAc;eAAdA;;IAEAC,cAAc;eAAdA;;;wBAJU;AAEhB,MAAMD,iBAAiB,IAAIE,cAAM,CAAC;AAClC,MAAMH,qBAAqB,IAAIG,cAAM,CAAC;AACtC,MAAMD,iBAAiB,IAAIC,cAAM,CAAC","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/logger.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d38750c9b4d30543afc51f35490fda1585e9ee17","contentHash":"09fab6c94c30a43fc9dab75e373112212ab61ead38e88a15b0ee7b54dcfa0585"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/Helper.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/Helper.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":30,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":52}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":88}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":56}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":56}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":41}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":39}},"10":{"start":{"line":31,"column":21},"end":{"line":31,"column":57}},"11":{"start":{"line":32,"column":16},"end":{"line":32,"column":46}},"12":{"start":{"line":33,"column":30},"end":{"line":33,"column":73}},"13":{"start":{"line":34,"column":24},"end":{"line":34,"column":73}},"14":{"start":{"line":35,"column":16},"end":{"line":35,"column":40}},"15":{"start":{"line":36,"column":31},"end":{"line":36,"column":65}},"16":{"start":{"line":37,"column":45},"end":{"line":37,"column":93}},"17":{"start":{"line":39,"column":4},"end":{"line":41,"column":6}},"18":{"start":{"line":43,"column":49},"end":{"line":45,"column":1}},"19":{"start":{"line":44,"column":4},"end":{"line":44,"column":247}},"20":{"start":{"line":44,"column":126},"end":{"line":44,"column":244}},"21":{"start":{"line":44,"column":166},"end":{"line":44,"column":243}},"22":{"start":{"line":46,"column":32},"end":{"line":68,"column":1}},"23":{"start":{"line":47,"column":4},"end":{"line":47,"column":58}},"24":{"start":{"line":48,"column":24},"end":{"line":48,"column":103}},"25":{"start":{"line":49,"column":16},"end":{"line":49,"column":42}},"26":{"start":{"line":50,"column":32},"end":{"line":57,"column":6}},"27":{"start":{"line":58,"column":35},"end":{"line":58,"column":179}},"28":{"start":{"line":58,"column":162},"end":{"line":58,"column":178}},"29":{"start":{"line":59,"column":4},"end":{"line":62,"column":7}},"30":{"start":{"line":63,"column":4},"end":{"line":63,"column":88}},"31":{"start":{"line":64,"column":4},"end":{"line":66,"column":5}},"32":{"start":{"line":65,"column":8},"end":{"line":65,"column":42}},"33":{"start":{"line":67,"column":4},"end":{"line":67,"column":53}},"34":{"start":{"line":69,"column":45},"end":{"line":75,"column":1}},"35":{"start":{"line":70,"column":4},"end":{"line":74,"column":5}},"36":{"start":{"line":73,"column":8},"end":{"line":73,"column":114}},"37":{"start":{"line":77,"column":20},"end":{"line":77,"column":99}},"38":{"start":{"line":78,"column":19},"end":{"line":78,"column":147}},"39":{"start":{"line":78,"column":93},"end":{"line":78,"column":96}},"40":{"start":{"line":79,"column":4},"end":{"line":81,"column":5}},"41":{"start":{"line":80,"column":8},"end":{"line":80,"column":15}},"42":{"start":{"line":82,"column":4},"end":{"line":91,"column":12}},"43":{"start":{"line":82,"column":64},"end":{"line":91,"column":10}},"44":{"start":{"line":83,"column":12},"end":{"line":90,"column":14}},"45":{"start":{"line":94,"column":20},"end":{"line":94,"column":91}},"46":{"start":{"line":95,"column":19},"end":{"line":95,"column":143}},"47":{"start":{"line":95,"column":93},"end":{"line":95,"column":96}},"48":{"start":{"line":96,"column":4},"end":{"line":98,"column":5}},"49":{"start":{"line":97,"column":8},"end":{"line":97,"column":15}},"50":{"start":{"line":99,"column":4},"end":{"line":108,"column":12}},"51":{"start":{"line":99,"column":64},"end":{"line":108,"column":10}},"52":{"start":{"line":100,"column":12},"end":{"line":107,"column":14}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":42},"end":{"line":12,"column":43}},"loc":{"start":{"line":12,"column":53},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":41},"end":{"line":15,"column":42}},"loc":{"start":{"line":15,"column":52},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":46},"end":{"line":18,"column":47}},"loc":{"start":{"line":18,"column":57},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":46},"end":{"line":21,"column":47}},"loc":{"start":{"line":21,"column":57},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":31},"end":{"line":24,"column":32}},"loc":{"start":{"line":24,"column":42},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":29},"end":{"line":27,"column":30}},"loc":{"start":{"line":27,"column":40},"end":{"line":29,"column":5}},"line":27},"7":{"name":"_interop_require_default","decl":{"start":{"line":38,"column":9},"end":{"line":38,"column":33}},"loc":{"start":{"line":38,"column":39},"end":{"line":42,"column":1}},"line":38},"8":{"name":"(anonymous_8)","decl":{"start":{"line":43,"column":49},"end":{"line":43,"column":50}},"loc":{"start":{"line":43,"column":77},"end":{"line":45,"column":1}},"line":43},"9":{"name":"(anonymous_9)","decl":{"start":{"line":44,"column":110},"end":{"line":44,"column":111}},"loc":{"start":{"line":44,"column":126},"end":{"line":44,"column":244}},"line":44},"10":{"name":"(anonymous_10)","decl":{"start":{"line":44,"column":154},"end":{"line":44,"column":155}},"loc":{"start":{"line":44,"column":166},"end":{"line":44,"column":243}},"line":44},"11":{"name":"(anonymous_11)","decl":{"start":{"line":46,"column":32},"end":{"line":46,"column":33}},"loc":{"start":{"line":46,"column":42},"end":{"line":68,"column":1}},"line":46},"12":{"name":"(anonymous_12)","decl":{"start":{"line":58,"column":146},"end":{"line":58,"column":147}},"loc":{"start":{"line":58,"column":162},"end":{"line":58,"column":178}},"line":58},"13":{"name":"(anonymous_13)","decl":{"start":{"line":69,"column":45},"end":{"line":69,"column":46}},"loc":{"start":{"line":69,"column":55},"end":{"line":75,"column":1}},"line":69},"14":{"name":"makeAgentsUnavailableBasedOnBusinessHour","decl":{"start":{"line":76,"column":15},"end":{"line":76,"column":55}},"loc":{"start":{"line":76,"column":73},"end":{"line":92,"column":1}},"line":76},"15":{"name":"(anonymous_15)","decl":{"start":{"line":78,"column":82},"end":{"line":78,"column":83}},"loc":{"start":{"line":78,"column":93},"end":{"line":78,"column":96}},"line":78},"16":{"name":"(anonymous_16)","decl":{"start":{"line":82,"column":54},"end":{"line":82,"column":55}},"loc":{"start":{"line":82,"column":64},"end":{"line":91,"column":10}},"line":82},"17":{"name":"(anonymous_17)","decl":{"start":{"line":82,"column":76},"end":{"line":82,"column":77}},"loc":{"start":{"line":82,"column":106},"end":{"line":91,"column":9}},"line":82},"18":{"name":"makeOnlineAgentsAvailable","decl":{"start":{"line":93,"column":15},"end":{"line":93,"column":40}},"loc":{"start":{"line":93,"column":58},"end":{"line":109,"column":1}},"line":93},"19":{"name":"(anonymous_19)","decl":{"start":{"line":95,"column":82},"end":{"line":95,"column":83}},"loc":{"start":{"line":95,"column":93},"end":{"line":95,"column":96}},"line":95},"20":{"name":"(anonymous_20)","decl":{"start":{"line":99,"column":54},"end":{"line":99,"column":55}},"loc":{"start":{"line":99,"column":64},"end":{"line":108,"column":10}},"line":99},"21":{"name":"(anonymous_21)","decl":{"start":{"line":99,"column":76},"end":{"line":99,"column":77}},"loc":{"start":{"line":99,"column":106},"end":{"line":108,"column":9}},"line":99}},"branchMap":{"0":{"loc":{"start":{"line":39,"column":11},"end":{"line":41,"column":5}},"type":"cond-expr","locations":[{"start":{"line":39,"column":35},"end":{"line":39,"column":38}},{"start":{"line":39,"column":41},"end":{"line":41,"column":5}}],"line":39},"1":{"loc":{"start":{"line":39,"column":11},"end":{"line":39,"column":32}},"type":"binary-expr","locations":[{"start":{"line":39,"column":11},"end":{"line":39,"column":14}},{"start":{"line":39,"column":18},"end":{"line":39,"column":32}}],"line":39},"2":{"loc":{"start":{"line":44,"column":166},"end":{"line":44,"column":243}},"type":"binary-expr","locations":[{"start":{"line":44,"column":166},"end":{"line":44,"column":202}},{"start":{"line":44,"column":206},"end":{"line":44,"column":243}}],"line":44},"3":{"loc":{"start":{"line":64,"column":4},"end":{"line":66,"column":5}},"type":"if","locations":[{"start":{"line":64,"column":4},"end":{"line":66,"column":5}},{"start":{"line":64,"column":4},"end":{"line":66,"column":5}}],"line":64},"4":{"loc":{"start":{"line":70,"column":4},"end":{"line":74,"column":5}},"type":"if","locations":[{"start":{"line":70,"column":4},"end":{"line":74,"column":5}},{"start":{"line":70,"column":4},"end":{"line":74,"column":5}}],"line":70},"5":{"loc":{"start":{"line":76,"column":56},"end":{"line":76,"column":71}},"type":"default-arg","locations":[{"start":{"line":76,"column":67},"end":{"line":76,"column":71}}],"line":76},"6":{"loc":{"start":{"line":79,"column":4},"end":{"line":81,"column":5}},"type":"if","locations":[{"start":{"line":79,"column":4},"end":{"line":81,"column":5}},{"start":{"line":79,"column":4},"end":{"line":81,"column":5}}],"line":79},"7":{"loc":{"start":{"line":93,"column":41},"end":{"line":93,"column":56}},"type":"default-arg","locations":[{"start":{"line":93,"column":52},"end":{"line":93,"column":56}}],"line":93},"8":{"loc":{"start":{"line":96,"column":4},"end":{"line":98,"column":5}},"type":"if","locations":[{"start":{"line":96,"column":4},"end":{"line":98,"column":5}},{"start":{"line":96,"column":4},"end":{"line":98,"column":5}}],"line":96}},"s":{"0":1,"1":1,"2":6,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":0,"20":0,"21":0,"22":1,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":1,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0},"f":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":1,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0},"b":{"0":[0,1],"1":[1,1],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0],"6":[0,0],"7":[0],"8":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/Helper.ts"],"sourcesContent":["import type { ILivechatBusinessHour } from '@rocket.chat/core-typings';\nimport { ILivechatAgentStatus, LivechatBusinessHourTypes } from '@rocket.chat/core-typings';\nimport { LivechatBusinessHours, Users } from '@rocket.chat/models';\nimport moment from 'moment';\n\nimport { notifyOnUserChangeAsync } from '../../../lib/server/lib/notifyListener';\nimport { businessHourLogger } from '../lib/logger';\nimport { createDefaultBusinessHourRow } from './LivechatBusinessHours';\nimport { filterBusinessHoursThatMustBeOpened } from './filterBusinessHoursThatMustBeOpened';\n\nexport { filterBusinessHoursThatMustBeOpened };\n\nexport const filterBusinessHoursThatMustBeOpenedByDay = async (\n\tbusinessHours: ILivechatBusinessHour[],\n\tday: string, // Format: moment.format('dddd')\n): Promise<Pick<ILivechatBusinessHour, '_id' | 'type'>[]> => {\n\treturn filterBusinessHoursThatMustBeOpened(\n\t\tbusinessHours.filter((businessHour) =>\n\t\t\tbusinessHour.workHours.some((workHour) => workHour.start.utc.dayOfWeek === day || workHour.finish.utc.dayOfWeek === day),\n\t\t),\n\t);\n};\n\nexport const openBusinessHourDefault = async (): Promise<void> => {\n\tawait Users.removeBusinessHoursFromAllUsers();\n\tconst currentTime = moment(moment().format('dddd:HH:mm'), 'dddd:HH:mm');\n\tconst day = currentTime.format('dddd');\n\tconst activeBusinessHours = await LivechatBusinessHours.findDefaultActiveAndOpenBusinessHoursByDay(day, {\n\t\tprojection: {\n\t\t\tworkHours: 1,\n\t\t\ttimezone: 1,\n\t\t\ttype: 1,\n\t\t\tactive: 1,\n\t\t},\n\t});\n\n\tconst businessHoursToOpenIds = (await filterBusinessHoursThatMustBeOpened(activeBusinessHours)).map((businessHour) => businessHour._id);\n\tbusinessHourLogger.debug({ msg: 'Opening default business hours', businessHoursToOpenIds });\n\tawait Users.openAgentsBusinessHoursByBusinessHourId(businessHoursToOpenIds);\n\tif (businessHoursToOpenIds.length) {\n\t\tawait makeOnlineAgentsAvailable();\n\t}\n\tawait makeAgentsUnavailableBasedOnBusinessHour();\n};\n\nexport const createDefaultBusinessHourIfNotExists = async (): Promise<void> => {\n\tif ((await LivechatBusinessHours.col.countDocuments({ type: LivechatBusinessHourTypes.DEFAULT })) === 0) {\n\t\tawait LivechatBusinessHours.insertOne(createDefaultBusinessHourRow());\n\t}\n};\n\nexport async function makeAgentsUnavailableBasedOnBusinessHour(agentIds: string[] | null = null) {\n\tconst results = await Users.findAgentsAvailableWithoutBusinessHours(agentIds).toArray();\n\n\tconst update = await Users.updateLivechatStatusByAgentIds(\n\t\tresults.map(({ _id }) => _id),\n\t\tILivechatAgentStatus.NOT_AVAILABLE,\n\t);\n\n\tif (update.modifiedCount === 0) {\n\t\treturn;\n\t}\n\n\tvoid notifyOnUserChangeAsync(async () =>\n\t\tresults.map(({ _id, openBusinessHours }) => {\n\t\t\treturn {\n\t\t\t\tid: _id,\n\t\t\t\tclientAction: 'updated',\n\t\t\t\tdiff: {\n\t\t\t\t\tstatusLivechat: 'not-available',\n\t\t\t\t\topenBusinessHours,\n\t\t\t\t},\n\t\t\t};\n\t\t}),\n\t);\n}\n\nexport async function makeOnlineAgentsAvailable(agentIds: string[] | null = null) {\n\tconst results = await Users.findOnlineButNotAvailableAgents(agentIds).toArray();\n\n\tconst update = await Users.updateLivechatStatusByAgentIds(\n\t\tresults.map(({ _id }) => _id),\n\t\tILivechatAgentStatus.AVAILABLE,\n\t);\n\n\tif (update.modifiedCount === 0) {\n\t\treturn;\n\t}\n\n\tvoid notifyOnUserChangeAsync(async () =>\n\t\tresults.map(({ _id, openBusinessHours }) => {\n\t\t\treturn {\n\t\t\t\tid: _id,\n\t\t\t\tclientAction: 'updated',\n\t\t\t\tdiff: {\n\t\t\t\t\tstatusLivechat: 'available',\n\t\t\t\t\topenBusinessHours,\n\t\t\t\t},\n\t\t\t};\n\t\t}),\n\t);\n}\n"],"names":["createDefaultBusinessHourIfNotExists","filterBusinessHoursThatMustBeOpened","filterBusinessHoursThatMustBeOpenedByDay","makeAgentsUnavailableBasedOnBusinessHour","makeOnlineAgentsAvailable","openBusinessHourDefault","businessHours","day","filter","businessHour","workHours","some","workHour","start","utc","dayOfWeek","finish","Users","removeBusinessHoursFromAllUsers","currentTime","moment","format","activeBusinessHours","LivechatBusinessHours","findDefaultActiveAndOpenBusinessHoursByDay","projection","timezone","type","active","businessHoursToOpenIds","map","_id","businessHourLogger","debug","msg","openAgentsBusinessHoursByBusinessHourId","length","col","countDocuments","LivechatBusinessHourTypes","DEFAULT","insertOne","createDefaultBusinessHourRow","agentIds","results","findAgentsAvailableWithoutBusinessHours","toArray","update","updateLivechatStatusByAgentIds","ILivechatAgentStatus","NOT_AVAILABLE","modifiedCount","notifyOnUserChangeAsync","openBusinessHours","id","clientAction","diff","statusLivechat","findOnlineButNotAvailableAgents","AVAILABLE"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/Helper.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"78094f0e4995e871d12eb8c10368d7cb99074f2c","contentHash":"914105b4a9e169618af27abd82b48c1b3f3884d45c1d9dc4436c474e1ca83f50"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/LivechatBusinessHours.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/LivechatBusinessHours.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":44}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":38},"end":{"line":12,"column":90}},"5":{"start":{"line":13,"column":17},"end":{"line":13,"column":35}},"6":{"start":{"line":15,"column":4},"end":{"line":17,"column":6}},"7":{"start":{"line":19,"column":37},"end":{"line":71,"column":1}},"8":{"start":{"line":20,"column":17},"end":{"line":28,"column":5}},"9":{"start":{"line":29,"column":23},"end":{"line":32,"column":5}},"10":{"start":{"line":33,"column":4},"end":{"line":70,"column":6}},"11":{"start":{"line":39,"column":43},"end":{"line":65,"column":13}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":14,"column":9},"end":{"line":14,"column":33}},"loc":{"start":{"line":14,"column":39},"end":{"line":18,"column":1}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":19,"column":37},"end":{"line":19,"column":38}},"loc":{"start":{"line":19,"column":41},"end":{"line":71,"column":1}},"line":19},"3":{"name":"(anonymous_3)","decl":{"start":{"line":39,"column":28},"end":{"line":39,"column":29}},"loc":{"start":{"line":39,"column":43},"end":{"line":65,"column":13}},"line":39}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":11},"end":{"line":17,"column":5}},"type":"cond-expr","locations":[{"start":{"line":15,"column":35},"end":{"line":15,"column":38}},{"start":{"line":15,"column":41},"end":{"line":17,"column":5}}],"line":15},"1":{"loc":{"start":{"line":15,"column":11},"end":{"line":15,"column":32}},"type":"binary-expr","locations":[{"start":{"line":15,"column":11},"end":{"line":15,"column":14}},{"start":{"line":15,"column":18},"end":{"line":15,"column":32}}],"line":15}},"s":{"0":1,"1":1,"2":0,"3":1,"4":1,"5":1,"6":1,"7":1,"8":0,"9":0,"10":0,"11":0},"f":{"0":0,"1":1,"2":0,"3":0},"b":{"0":[0,1],"1":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/LivechatBusinessHours.ts"],"sourcesContent":["import type { ILivechatBusinessHour } from '@rocket.chat/core-typings';\nimport { LivechatBusinessHourTypes } from '@rocket.chat/core-typings';\nimport moment from 'moment-timezone';\nimport { ObjectId } from 'mongodb';\n\nexport const createDefaultBusinessHourRow = (): ILivechatBusinessHour => {\n\tconst days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];\n\tconst closedDays = ['Saturday', 'Sunday'];\n\treturn {\n\t\t_id: new ObjectId().toHexString(),\n\t\tname: '',\n\t\tactive: true,\n\t\ttype: LivechatBusinessHourTypes.DEFAULT,\n\t\tts: new Date(),\n\t\tworkHours: days.map((day, index) => ({\n\t\t\tday,\n\t\t\tstart: {\n\t\t\t\ttime: '08:00',\n\t\t\t\tutc: {\n\t\t\t\t\tdayOfWeek: moment(`${day}:08:00`, 'dddd:HH:mm').utc().format('dddd'),\n\t\t\t\t\ttime: moment(`${day}:08:00`, 'dddd:HH:mm').utc().format('HH:mm'),\n\t\t\t\t},\n\t\t\t\tcron: {\n\t\t\t\t\tdayOfWeek: moment(`${day}:08:00`, 'dddd:HH:mm').format('dddd'),\n\t\t\t\t\ttime: moment(`${day}:08:00`, 'dddd:HH:mm').format('HH:mm'),\n\t\t\t\t},\n\t\t\t},\n\t\t\tfinish: {\n\t\t\t\ttime: '20:00',\n\t\t\t\tutc: {\n\t\t\t\t\tdayOfWeek: moment(`${day}:20:00`, 'dddd:HH:mm').utc().format('dddd'),\n\t\t\t\t\ttime: moment(`${day}:20:00`, 'dddd:HH:mm').utc().format('HH:mm'),\n\t\t\t\t},\n\t\t\t\tcron: {\n\t\t\t\t\tdayOfWeek: moment(`${day}:20:00`, 'dddd:HH:mm').format('dddd'),\n\t\t\t\t\ttime: moment(`${day}:20:00`, 'dddd:HH:mm').format('HH:mm'),\n\t\t\t\t},\n\t\t\t},\n\t\t\tcode: index + 1,\n\t\t\topen: !closedDays.includes(day),\n\t\t})),\n\t\ttimezone: {\n\t\t\tname: moment.tz.guess(),\n\t\t\tutc: String(moment().utcOffset() / 60),\n\t\t},\n\t};\n};\n"],"names":["createDefaultBusinessHourRow","days","closedDays","_id","ObjectId","toHexString","name","active","type","LivechatBusinessHourTypes","DEFAULT","ts","Date","workHours","map","day","index","start","time","utc","dayOfWeek","moment","format","cron","finish","code","open","includes","timezone","tz","guess","String","utcOffset"],"mappings":";;;;+BAKaA;;;eAAAA;;;6BAJ6B;uEACvB;yBACM;;;;;;AAElB,MAAMA,+BAA+B;IAC3C,MAAMC,OAAO;QAAC;QAAU;QAAW;QAAa;QAAY;QAAU;QAAY;KAAS;IAC3F,MAAMC,aAAa;QAAC;QAAY;KAAS;IACzC,OAAO;QACNC,KAAK,IAAIC,iBAAQ,GAAGC,WAAW;QAC/BC,MAAM;QACNC,QAAQ;QACRC,MAAMC,sCAAyB,CAACC,OAAO;QACvCC,IAAI,IAAIC;QACRC,WAAWZ,KAAKa,GAAG,CAAC,CAACC,KAAKC,QAAW,CAAA;gBACpCD;gBACAE,OAAO;oBACNC,MAAM;oBACNC,KAAK;wBACJC,WAAWC,IAAAA,uBAAM,EAAC,GAAGN,IAAI,MAAM,CAAC,EAAE,cAAcI,GAAG,GAAGG,MAAM,CAAC;wBAC7DJ,MAAMG,IAAAA,uBAAM,EAAC,GAAGN,IAAI,MAAM,CAAC,EAAE,cAAcI,GAAG,GAAGG,MAAM,CAAC;oBACzD;oBACAC,MAAM;wBACLH,WAAWC,IAAAA,uBAAM,EAAC,GAAGN,IAAI,MAAM,CAAC,EAAE,cAAcO,MAAM,CAAC;wBACvDJ,MAAMG,IAAAA,uBAAM,EAAC,GAAGN,IAAI,MAAM,CAAC,EAAE,cAAcO,MAAM,CAAC;oBACnD;gBACD;gBACAE,QAAQ;oBACPN,MAAM;oBACNC,KAAK;wBACJC,WAAWC,IAAAA,uBAAM,EAAC,GAAGN,IAAI,MAAM,CAAC,EAAE,cAAcI,GAAG,GAAGG,MAAM,CAAC;wBAC7DJ,MAAMG,IAAAA,uBAAM,EAAC,GAAGN,IAAI,MAAM,CAAC,EAAE,cAAcI,GAAG,GAAGG,MAAM,CAAC;oBACzD;oBACAC,MAAM;wBACLH,WAAWC,IAAAA,uBAAM,EAAC,GAAGN,IAAI,MAAM,CAAC,EAAE,cAAcO,MAAM,CAAC;wBACvDJ,MAAMG,IAAAA,uBAAM,EAAC,GAAGN,IAAI,MAAM,CAAC,EAAE,cAAcO,MAAM,CAAC;oBACnD;gBACD;gBACAG,MAAMT,QAAQ;gBACdU,MAAM,CAACxB,WAAWyB,QAAQ,CAACZ;YAC5B,CAAA;QACAa,UAAU;YACTtB,MAAMe,uBAAM,CAACQ,EAAE,CAACC,KAAK;YACrBX,KAAKY,OAAOV,IAAAA,uBAAM,IAAGW,SAAS,KAAK;QACpC;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/LivechatBusinessHours.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ee05e82bcecb87a823ba5fba01b30000b30ab37b","contentHash":"af463ec9d43ce7323c802892b8d1fe8bff9a9a2a53b86ca16d962a75692f478d"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/filterBusinessHoursThatMustBeOpened.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/filterBusinessHoursThatMustBeOpened.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":51}},"3":{"start":{"line":11,"column":30},"end":{"line":11,"column":73}},"4":{"start":{"line":13,"column":4},"end":{"line":15,"column":6}},"5":{"start":{"line":17,"column":44},"end":{"line":31,"column":1}},"6":{"start":{"line":18,"column":24},"end":{"line":18,"column":109}},"7":{"start":{"line":19,"column":4},"end":{"line":30,"column":12}},"8":{"start":{"line":19,"column":48},"end":{"line":27,"column":10}},"9":{"start":{"line":19,"column":109},"end":{"line":19,"column":118}},"10":{"start":{"line":20,"column":35},"end":{"line":20,"column":131}},"11":{"start":{"line":21,"column":36},"end":{"line":21,"column":134}},"12":{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},"13":{"start":{"line":24,"column":16},"end":{"line":24,"column":47}},"14":{"start":{"line":26,"column":12},"end":{"line":26,"column":102}},"15":{"start":{"line":27,"column":33},"end":{"line":30,"column":9}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":12,"column":9},"end":{"line":12,"column":33}},"loc":{"start":{"line":12,"column":39},"end":{"line":16,"column":1}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":17,"column":44},"end":{"line":17,"column":45}},"loc":{"start":{"line":17,"column":67},"end":{"line":31,"column":1}},"line":17},"3":{"name":"(anonymous_3)","decl":{"start":{"line":19,"column":32},"end":{"line":19,"column":33}},"loc":{"start":{"line":19,"column":48},"end":{"line":27,"column":10}},"line":19},"4":{"name":"(anonymous_4)","decl":{"start":{"line":19,"column":101},"end":{"line":19,"column":102}},"loc":{"start":{"line":19,"column":109},"end":{"line":19,"column":118}},"line":19},"5":{"name":"(anonymous_5)","decl":{"start":{"line":19,"column":125},"end":{"line":19,"column":126}},"loc":{"start":{"line":19,"column":133},"end":{"line":27,"column":9}},"line":19},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":16},"end":{"line":27,"column":17}},"loc":{"start":{"line":27,"column":33},"end":{"line":30,"column":9}},"line":27}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":11},"end":{"line":15,"column":5}},"type":"cond-expr","locations":[{"start":{"line":13,"column":35},"end":{"line":13,"column":38}},{"start":{"line":13,"column":41},"end":{"line":15,"column":5}}],"line":13},"1":{"loc":{"start":{"line":13,"column":11},"end":{"line":13,"column":32}},"type":"binary-expr","locations":[{"start":{"line":13,"column":11},"end":{"line":13,"column":14}},{"start":{"line":13,"column":18},"end":{"line":13,"column":32}}],"line":13},"2":{"loc":{"start":{"line":19,"column":48},"end":{"line":27,"column":10}},"type":"binary-expr","locations":[{"start":{"line":19,"column":48},"end":{"line":19,"column":67}},{"start":{"line":19,"column":71},"end":{"line":27,"column":10}}],"line":19},"3":{"loc":{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},"type":"if","locations":[{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},{"start":{"line":23,"column":12},"end":{"line":25,"column":13}}],"line":23},"4":{"loc":{"start":{"line":26,"column":19},"end":{"line":26,"column":101}},"type":"binary-expr","locations":[{"start":{"line":26,"column":19},"end":{"line":26,"column":60}},{"start":{"line":26,"column":64},"end":{"line":26,"column":101}}],"line":26}},"s":{"0":1,"1":1,"2":0,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},"f":{"0":0,"1":1,"2":0,"3":0,"4":0,"5":0,"6":0},"b":{"0":[0,1],"1":[1,1],"2":[0,0],"3":[0,0],"4":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/filterBusinessHoursThatMustBeOpened.ts"],"sourcesContent":["import type { ILivechatBusinessHour } from '@rocket.chat/core-typings';\nimport moment from 'moment';\n\nexport const filterBusinessHoursThatMustBeOpened = async (\n\tbusinessHours: ILivechatBusinessHour[],\n): Promise<Pick<ILivechatBusinessHour, '_id' | 'type'>[]> => {\n\tconst currentTime = moment(moment().format('dddd:HH:mm:ss'), 'dddd:HH:mm:ss');\n\n\treturn businessHours\n\t\t.filter(\n\t\t\t(businessHour) =>\n\t\t\t\tbusinessHour.active &&\n\t\t\t\tbusinessHour.workHours\n\t\t\t\t\t.filter((hour) => hour.open)\n\t\t\t\t\t.some((hour) => {\n\t\t\t\t\t\tconst localTimeStart = moment(`${hour.start.cron.dayOfWeek}:${hour.start.cron.time}:00`, 'dddd:HH:mm:ss');\n\t\t\t\t\t\tconst localTimeFinish = moment(`${hour.finish.cron.dayOfWeek}:${hour.finish.cron.time}:00`, 'dddd:HH:mm:ss');\n\n\t\t\t\t\t\t// The way we create the instances sunday will be the first day of the current week not the next one, that way it will never met isBefore\n\t\t\t\t\t\tif (localTimeFinish.isBefore(localTimeStart)) {\n\t\t\t\t\t\t\tlocalTimeFinish.add(1, 'week');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn currentTime.isSameOrAfter(localTimeStart) && currentTime.isBefore(localTimeFinish);\n\t\t\t\t\t}),\n\t\t)\n\t\t.map((businessHour) => ({\n\t\t\t_id: businessHour._id,\n\t\t\ttype: businessHour.type,\n\t\t}));\n};\n"],"names":["filterBusinessHoursThatMustBeOpened","businessHours","currentTime","moment","format","filter","businessHour","active","workHours","hour","open","some","localTimeStart","start","cron","dayOfWeek","time","localTimeFinish","finish","isBefore","add","isSameOrAfter","map","_id","type"],"mappings":";;;;+BAGaA;;;eAAAA;;;+DAFM;;;;;;AAEZ,MAAMA,sCAAsC,OAClDC;IAEA,MAAMC,cAAcC,IAAAA,eAAM,EAACA,IAAAA,eAAM,IAAGC,MAAM,CAAC,kBAAkB;IAE7D,OAAOH,cACLI,MAAM,CACN,CAACC,eACAA,aAAaC,MAAM,IACnBD,aAAaE,SAAS,CACpBH,MAAM,CAAC,CAACI,OAASA,KAAKC,IAAI,EAC1BC,IAAI,CAAC,CAACF;YACN,MAAMG,iBAAiBT,IAAAA,eAAM,EAAC,GAAGM,KAAKI,KAAK,CAACC,IAAI,CAACC,SAAS,CAAC,CAAC,EAAEN,KAAKI,KAAK,CAACC,IAAI,CAACE,IAAI,CAAC,GAAG,CAAC,EAAE;YACzF,MAAMC,kBAAkBd,IAAAA,eAAM,EAAC,GAAGM,KAAKS,MAAM,CAACJ,IAAI,CAACC,SAAS,CAAC,CAAC,EAAEN,KAAKS,MAAM,CAACJ,IAAI,CAACE,IAAI,CAAC,GAAG,CAAC,EAAE;YAE5F,yIAAyI;YACzI,IAAIC,gBAAgBE,QAAQ,CAACP,iBAAiB;gBAC7CK,gBAAgBG,GAAG,CAAC,GAAG;YACxB;YAEA,OAAOlB,YAAYmB,aAAa,CAACT,mBAAmBV,YAAYiB,QAAQ,CAACF;QAC1E,IAEFK,GAAG,CAAC,CAAChB,eAAkB,CAAA;YACvBiB,KAAKjB,aAAaiB,GAAG;YACrBC,MAAMlB,aAAakB,IAAI;QACxB,CAAA;AACF","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/filterBusinessHoursThatMustBeOpened.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ed51973c4ecb8f449020c39f39d0b2d1dc6473d5","contentHash":"42ff12f2284837f73e88150363eba12f5f08aac328529008a6e9a657ae942c23"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/getAgentIdsForBusinessHour.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/getAgentIdsForBusinessHour.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":42}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":40},"end":{"line":31,"column":1}},"5":{"start":{"line":15,"column":26},"end":{"line":19,"column":37}},"6":{"start":{"line":19,"column":33},"end":{"line":19,"column":36}},"7":{"start":{"line":20,"column":35},"end":{"line":20,"column":130}},"8":{"start":{"line":21,"column":38},"end":{"line":29,"column":39}},"9":{"start":{"line":29,"column":30},"end":{"line":29,"column":38}},"10":{"start":{"line":30,"column":4},"end":{"line":30,"column":37}},"11":{"start":{"line":32,"column":63},"end":{"line":40,"column":1}},"12":{"start":{"line":33,"column":49},"end":{"line":37,"column":39}},"13":{"start":{"line":37,"column":30},"end":{"line":37,"column":38}},"14":{"start":{"line":38,"column":61},"end":{"line":38,"column":179}},"15":{"start":{"line":39,"column":4},"end":{"line":39,"column":60}},"16":{"start":{"line":41,"column":35},"end":{"line":52,"column":1}},"17":{"start":{"line":42,"column":74},"end":{"line":45,"column":6}},"18":{"start":{"line":46,"column":4},"end":{"line":51,"column":6}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":40},"end":{"line":12,"column":41}},"loc":{"start":{"line":12,"column":50},"end":{"line":31,"column":1}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":19,"column":22},"end":{"line":19,"column":23}},"loc":{"start":{"line":19,"column":33},"end":{"line":19,"column":36}},"line":19},"3":{"name":"(anonymous_3)","decl":{"start":{"line":29,"column":22},"end":{"line":29,"column":23}},"loc":{"start":{"line":29,"column":30},"end":{"line":29,"column":38}},"line":29},"4":{"name":"(anonymous_4)","decl":{"start":{"line":32,"column":63},"end":{"line":32,"column":64}},"loc":{"start":{"line":32,"column":73},"end":{"line":40,"column":1}},"line":32},"5":{"name":"(anonymous_5)","decl":{"start":{"line":37,"column":22},"end":{"line":37,"column":23}},"loc":{"start":{"line":37,"column":30},"end":{"line":37,"column":38}},"line":37},"6":{"name":"(anonymous_6)","decl":{"start":{"line":41,"column":35},"end":{"line":41,"column":36}},"loc":{"start":{"line":41,"column":45},"end":{"line":52,"column":1}},"line":41}},"branchMap":{},"s":{"0":1,"1":1,"2":0,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":1,"12":0,"13":0,"14":0,"15":0,"16":1,"17":0,"18":0},"f":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/getAgentIdsForBusinessHour.ts"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { LivechatDepartment, LivechatDepartmentAgents, Users } from '@rocket.chat/models';\n\nconst getAllAgentIdsWithoutDepartment = async (): Promise<string[]> => {\n\t// Fetch departments with agents excluding archived ones (disabled ones still can be tied to business hours)\n\t// Then find the agents that are not in any of those departments\n\n\tconst departmentIds = (await LivechatDepartment.findNotArchived({ projection: { _id: 1 } }).toArray()).map(({ _id }) => _id);\n\n\tconst agentIdsWithDepartment = await LivechatDepartmentAgents.findAllAgentsConnectedToListOfDepartments(departmentIds);\n\n\tconst agentIdsWithoutDepartment = (\n\t\tawait Users.findUsersInRolesWithQuery(\n\t\t\t'livechat-agent',\n\t\t\t{\n\t\t\t\t_id: { $nin: agentIdsWithDepartment },\n\t\t\t},\n\t\t\t{ projection: { _id: 1 } },\n\t\t).toArray()\n\t).map((user) => user._id);\n\n\treturn agentIdsWithoutDepartment;\n};\n\nconst getAllAgentIdsWithDepartmentNotConnectedToBusinessHour = async (): Promise<string[]> => {\n\tconst activeDepartmentsWithoutBusinessHour = (\n\t\tawait LivechatDepartment.findActiveDepartmentsWithoutBusinessHour({\n\t\t\tprojection: { _id: 1 },\n\t\t}).toArray()\n\t).map((dept) => dept._id);\n\n\tconst agentIdsWithDepartmentNotConnectedToBusinessHour = await LivechatDepartmentAgents.findAllAgentsConnectedToListOfDepartments(\n\t\tactiveDepartmentsWithoutBusinessHour,\n\t);\n\treturn agentIdsWithDepartmentNotConnectedToBusinessHour;\n};\n\nexport const getAgentIdsForBusinessHour = async (): Promise<IUser['_id'][]> => {\n\tconst [withoutDepartment, withDepartmentNotConnectedToBusinessHour] = await Promise.all([\n\t\tgetAllAgentIdsWithoutDepartment(),\n\t\tgetAllAgentIdsWithDepartmentNotConnectedToBusinessHour(),\n\t]);\n\n\treturn [...new Set([...withoutDepartment, ...withDepartmentNotConnectedToBusinessHour])];\n};\n"],"names":["getAgentIdsForBusinessHour","getAllAgentIdsWithoutDepartment","departmentIds","LivechatDepartment","findNotArchived","projection","_id","toArray","map","agentIdsWithDepartment","LivechatDepartmentAgents","findAllAgentsConnectedToListOfDepartments","agentIdsWithoutDepartment","Users","findUsersInRolesWithQuery","$nin","user","getAllAgentIdsWithDepartmentNotConnectedToBusinessHour","activeDepartmentsWithoutBusinessHour","findActiveDepartmentsWithoutBusinessHour","dept","agentIdsWithDepartmentNotConnectedToBusinessHour","withoutDepartment","withDepartmentNotConnectedToBusinessHour","Promise","all","Set"],"mappings":";;;;+BAqCaA;;;eAAAA;;;wBApCuD;AAEpE,MAAMC,kCAAkC;IACvC,4GAA4G;IAC5G,gEAAgE;IAEhE,MAAMC,gBAAgB,AAAC,CAAA,MAAMC,0BAAkB,CAACC,eAAe,CAAC;QAAEC,YAAY;YAAEC,KAAK;QAAE;IAAE,GAAGC,OAAO,EAAC,EAAGC,GAAG,CAAC,CAAC,EAAEF,GAAG,EAAE,GAAKA;IAExH,MAAMG,yBAAyB,MAAMC,gCAAwB,CAACC,yCAAyC,CAACT;IAExG,MAAMU,4BAA4B,AACjC,CAAA,MAAMC,aAAK,CAACC,yBAAyB,CACpC,kBACA;QACCR,KAAK;YAAES,MAAMN;QAAuB;IACrC,GACA;QAAEJ,YAAY;YAAEC,KAAK;QAAE;IAAE,GACxBC,OAAO,EAAC,EACTC,GAAG,CAAC,CAACQ,OAASA,KAAKV,GAAG;IAExB,OAAOM;AACR;AAEA,MAAMK,yDAAyD;IAC9D,MAAMC,uCAAuC,AAC5C,CAAA,MAAMf,0BAAkB,CAACgB,wCAAwC,CAAC;QACjEd,YAAY;YAAEC,KAAK;QAAE;IACtB,GAAGC,OAAO,EAAC,EACVC,GAAG,CAAC,CAACY,OAASA,KAAKd,GAAG;IAExB,MAAMe,mDAAmD,MAAMX,gCAAwB,CAACC,yCAAyC,CAChIO;IAED,OAAOG;AACR;AAEO,MAAMrB,6BAA6B;IACzC,MAAM,CAACsB,mBAAmBC,yCAAyC,GAAG,MAAMC,QAAQC,GAAG,CAAC;QACvFxB;QACAgB;KACA;IAED,OAAO;WAAI,IAAIS,IAAI;eAAIJ;eAAsBC;SAAyC;KAAE;AACzF","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/business-hour/getAgentIdsForBusinessHour.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"bfb6a737d46389350c61d05a6ea573563d598649","contentHash":"357313dfc5a9d9c44d200481eced246e6703cb493618f6cb841a01e5b8f62a6e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/hooks/processRoomAbandonment.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/hooks/processRoomAbandonment.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":24,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":48}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":51}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":27}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":25}},"8":{"start":{"line":25,"column":21},"end":{"line":25,"column":57}},"9":{"start":{"line":26,"column":16},"end":{"line":26,"column":46}},"10":{"start":{"line":27,"column":30},"end":{"line":27,"column":73}},"11":{"start":{"line":28,"column":19},"end":{"line":28,"column":55}},"12":{"start":{"line":29,"column":16},"end":{"line":29,"column":51}},"13":{"start":{"line":30,"column":22},"end":{"line":30,"column":49}},"14":{"start":{"line":32,"column":4},"end":{"line":34,"column":6}},"15":{"start":{"line":36,"column":44},"end":{"line":36,"column":198}},"16":{"start":{"line":36,"column":70},"end":{"line":36,"column":198}},"17":{"start":{"line":37,"column":18},"end":{"line":50,"column":1}},"18":{"start":{"line":38,"column":4},"end":{"line":48,"column":6}},"19":{"start":{"line":49,"column":4},"end":{"line":49,"column":15}},"20":{"start":{"line":51,"column":41},"end":{"line":127,"column":1}},"21":{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},"22":{"start":{"line":53,"column":8},"end":{"line":53,"column":75}},"23":{"start":{"line":56,"column":23},"end":{"line":60,"column":13}},"24":{"start":{"line":61,"column":4},"end":{"line":71,"column":5}},"25":{"start":{"line":63,"column":29},"end":{"line":63,"column":103}},"26":{"start":{"line":64,"column":8},"end":{"line":66,"column":9}},"27":{"start":{"line":65,"column":12},"end":{"line":65,"column":79}},"28":{"start":{"line":67,"column":8},"end":{"line":67,"column":202}},"29":{"start":{"line":70,"column":8},"end":{"line":70,"column":170}},"30":{"start":{"line":73,"column":4},"end":{"line":75,"column":5}},"31":{"start":{"line":74,"column":8},"end":{"line":74,"column":75}},"32":{"start":{"line":76,"column":23},"end":{"line":76,"column":24}},"33":{"start":{"line":77,"column":30},"end":{"line":77,"column":88}},"34":{"start":{"line":78,"column":30},"end":{"line":78,"column":80}},"35":{"start":{"line":79,"column":29},"end":{"line":79,"column":124}},"36":{"start":{"line":80,"column":26},"end":{"line":80,"column":76}},"37":{"start":{"line":81,"column":4},"end":{"line":125,"column":5}},"38":{"start":{"line":81,"column":20},"end":{"line":81,"column":21}},"39":{"start":{"line":83,"column":22},"end":{"line":83,"column":58}},"40":{"start":{"line":84,"column":26},"end":{"line":84,"column":43}},"41":{"start":{"line":85,"column":8},"end":{"line":88,"column":9}},"42":{"start":{"line":86,"column":12},"end":{"line":86,"column":41}},"43":{"start":{"line":87,"column":12},"end":{"line":87,"column":21}},"44":{"start":{"line":89,"column":8},"end":{"line":92,"column":9}},"45":{"start":{"line":90,"column":12},"end":{"line":90,"column":41}},"46":{"start":{"line":91,"column":12},"end":{"line":91,"column":21}},"47":{"start":{"line":93,"column":8},"end":{"line":96,"column":9}},"48":{"start":{"line":94,"column":12},"end":{"line":94,"column":41}},"49":{"start":{"line":95,"column":12},"end":{"line":95,"column":21}},"50":{"start":{"line":97,"column":53},"end":{"line":97,"column":84}},"51":{"start":{"line":98,"column":53},"end":{"line":98,"column":85}},"52":{"start":{"line":100,"column":38},"end":{"line":103,"column":10}},"53":{"start":{"line":104,"column":36},"end":{"line":107,"column":10}},"54":{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},"55":{"start":{"line":110,"column":12},"end":{"line":110,"column":87}},"56":{"start":{"line":113,"column":8},"end":{"line":115,"column":9}},"57":{"start":{"line":114,"column":12},"end":{"line":114,"column":85}},"58":{"start":{"line":117,"column":8},"end":{"line":119,"column":9}},"59":{"start":{"line":118,"column":12},"end":{"line":118,"column":83}},"60":{"start":{"line":121,"column":8},"end":{"line":123,"column":9}},"61":{"start":{"line":122,"column":12},"end":{"line":122,"column":81}},"62":{"start":{"line":124,"column":8},"end":{"line":124,"column":37}},"63":{"start":{"line":126,"column":4},"end":{"line":126,"column":24}},"64":{"start":{"line":128,"column":20},"end":{"line":149,"column":1}},"65":{"start":{"line":130,"column":21},"end":{"line":130,"column":27}},"66":{"start":{"line":131,"column":4},"end":{"line":133,"column":5}},"67":{"start":{"line":132,"column":8},"end":{"line":132,"column":22}},"68":{"start":{"line":134,"column":26},"end":{"line":134,"column":51}},"69":{"start":{"line":135,"column":41},"end":{"line":135,"column":84}},"70":{"start":{"line":136,"column":4},"end":{"line":138,"column":5}},"71":{"start":{"line":137,"column":8},"end":{"line":137,"column":22}},"72":{"start":{"line":139,"column":4},"end":{"line":141,"column":5}},"73":{"start":{"line":140,"column":8},"end":{"line":140,"column":22}},"74":{"start":{"line":142,"column":29},"end":{"line":142,"column":126}},"75":{"start":{"line":143,"column":4},"end":{"line":145,"column":5}},"76":{"start":{"line":144,"column":8},"end":{"line":144,"column":22}},"77":{"start":{"line":146,"column":42},"end":{"line":146,"column":104}},"78":{"start":{"line":147,"column":4},"end":{"line":147,"column":107}},"79":{"start":{"line":148,"column":4},"end":{"line":148,"column":18}},"80":{"start":{"line":150,"column":0},"end":{"line":150,"column":124}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":38},"end":{"line":12,"column":39}},"loc":{"start":{"line":12,"column":49},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":41},"end":{"line":15,"column":42}},"loc":{"start":{"line":15,"column":52},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":17},"end":{"line":18,"column":18}},"loc":{"start":{"line":18,"column":28},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":15},"end":{"line":21,"column":16}},"loc":{"start":{"line":21,"column":26},"end":{"line":23,"column":5}},"line":21},"5":{"name":"_interop_require_default","decl":{"start":{"line":31,"column":9},"end":{"line":31,"column":33}},"loc":{"start":{"line":31,"column":39},"end":{"line":35,"column":1}},"line":31},"6":{"name":"(anonymous_6)","decl":{"start":{"line":36,"column":44},"end":{"line":36,"column":45}},"loc":{"start":{"line":36,"column":70},"end":{"line":36,"column":198}},"line":36},"7":{"name":"(anonymous_7)","decl":{"start":{"line":37,"column":18},"end":{"line":37,"column":19}},"loc":{"start":{"line":37,"column":30},"end":{"line":50,"column":1}},"line":37},"8":{"name":"(anonymous_8)","decl":{"start":{"line":51,"column":41},"end":{"line":51,"column":42}},"loc":{"start":{"line":51,"column":73},"end":{"line":127,"column":1}},"line":51},"9":{"name":"(anonymous_9)","decl":{"start":{"line":128,"column":20},"end":{"line":128,"column":21}},"loc":{"start":{"line":128,"column":36},"end":{"line":149,"column":1}},"line":128}},"branchMap":{"0":{"loc":{"start":{"line":32,"column":11},"end":{"line":34,"column":5}},"type":"cond-expr","locations":[{"start":{"line":32,"column":35},"end":{"line":32,"column":38}},{"start":{"line":32,"column":41},"end":{"line":34,"column":5}}],"line":32},"1":{"loc":{"start":{"line":32,"column":11},"end":{"line":32,"column":32}},"type":"binary-expr","locations":[{"start":{"line":32,"column":11},"end":{"line":32,"column":14}},{"start":{"line":32,"column":18},"end":{"line":32,"column":32}}],"line":32},"2":{"loc":{"start":{"line":36,"column":100},"end":{"line":36,"column":127}},"type":"binary-expr","locations":[{"start":{"line":36,"column":100},"end":{"line":36,"column":113}},{"start":{"line":36,"column":117},"end":{"line":36,"column":127}}],"line":36},"3":{"loc":{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},"type":"if","locations":[{"start":{"line":52,"column":4},"end":{"line":54,"column":5}},{"start":{"line":52,"column":4},"end":{"line":54,"column":5}}],"line":52},"4":{"loc":{"start":{"line":56,"column":23},"end":{"line":60,"column":13}},"type":"cond-expr","locations":[{"start":{"line":56,"column":43},"end":{"line":60,"column":6}},{"start":{"line":60,"column":9},"end":{"line":60,"column":13}}],"line":56},"5":{"loc":{"start":{"line":61,"column":4},"end":{"line":71,"column":5}},"type":"if","locations":[{"start":{"line":61,"column":4},"end":{"line":71,"column":5}},{"start":{"line":61,"column":4},"end":{"line":71,"column":5}}],"line":61},"6":{"loc":{"start":{"line":61,"column":8},"end":{"line":61,"column":89}},"type":"cond-expr","locations":[{"start":{"line":61,"column":55},"end":{"line":61,"column":61}},{"start":{"line":61,"column":64},"end":{"line":61,"column":89}}],"line":61},"7":{"loc":{"start":{"line":61,"column":8},"end":{"line":61,"column":52}},"type":"binary-expr","locations":[{"start":{"line":61,"column":8},"end":{"line":61,"column":27}},{"start":{"line":61,"column":31},"end":{"line":61,"column":52}}],"line":61},"8":{"loc":{"start":{"line":64,"column":8},"end":{"line":66,"column":9}},"type":"if","locations":[{"start":{"line":64,"column":8},"end":{"line":66,"column":9}},{"start":{"line":64,"column":8},"end":{"line":66,"column":9}}],"line":64},"9":{"loc":{"start":{"line":67,"column":21},"end":{"line":67,"column":201}},"type":"cond-expr","locations":[{"start":{"line":67,"column":155},"end":{"line":67,"column":161}},{"start":{"line":67,"column":164},"end":{"line":67,"column":201}}],"line":67},"10":{"loc":{"start":{"line":67,"column":21},"end":{"line":67,"column":152}},"type":"binary-expr","locations":[{"start":{"line":67,"column":21},"end":{"line":67,"column":132}},{"start":{"line":67,"column":136},"end":{"line":67,"column":152}}],"line":67},"11":{"loc":{"start":{"line":70,"column":21},"end":{"line":70,"column":169}},"type":"cond-expr","locations":[{"start":{"line":70,"column":122},"end":{"line":70,"column":128}},{"start":{"line":70,"column":131},"end":{"line":70,"column":169}}],"line":70},"12":{"loc":{"start":{"line":70,"column":21},"end":{"line":70,"column":119}},"type":"binary-expr","locations":[{"start":{"line":70,"column":21},"end":{"line":70,"column":98}},{"start":{"line":70,"column":102},"end":{"line":70,"column":119}}],"line":70},"13":{"loc":{"start":{"line":73,"column":4},"end":{"line":75,"column":5}},"type":"if","locations":[{"start":{"line":73,"column":4},"end":{"line":75,"column":5}},{"start":{"line":73,"column":4},"end":{"line":75,"column":5}}],"line":73},"14":{"loc":{"start":{"line":73,"column":8},"end":{"line":73,"column":54}},"type":"binary-expr","locations":[{"start":{"line":73,"column":8},"end":{"line":73,"column":19}},{"start":{"line":73,"column":23},"end":{"line":73,"column":54}}],"line":73},"15":{"loc":{"start":{"line":77,"column":59},"end":{"line":77,"column":86}},"type":"binary-expr","locations":[{"start":{"line":77,"column":59},"end":{"line":77,"column":72}},{"start":{"line":77,"column":76},"end":{"line":77,"column":86}}],"line":77},"16":{"loc":{"start":{"line":85,"column":8},"end":{"line":88,"column":9}},"type":"if","locations":[{"start":{"line":85,"column":8},"end":{"line":88,"column":9}},{"start":{"line":85,"column":8},"end":{"line":88,"column":9}}],"line":85},"17":{"loc":{"start":{"line":89,"column":8},"end":{"line":92,"column":9}},"type":"if","locations":[{"start":{"line":89,"column":8},"end":{"line":92,"column":9}},{"start":{"line":89,"column":8},"end":{"line":92,"column":9}}],"line":89},"18":{"loc":{"start":{"line":93,"column":8},"end":{"line":96,"column":9}},"type":"if","locations":[{"start":{"line":93,"column":8},"end":{"line":96,"column":9}},{"start":{"line":93,"column":8},"end":{"line":96,"column":9}}],"line":93},"19":{"loc":{"start":{"line":93,"column":12},"end":{"line":93,"column":352}},"type":"binary-expr","locations":[{"start":{"line":93,"column":12},"end":{"line":93,"column":178}},{"start":{"line":93,"column":182},"end":{"line":93,"column":352}}],"line":93},"20":{"loc":{"start":{"line":93,"column":14},"end":{"line":93,"column":177}},"type":"cond-expr","locations":[{"start":{"line":93,"column":59},"end":{"line":93,"column":65}},{"start":{"line":93,"column":68},"end":{"line":93,"column":177}}],"line":93},"21":{"loc":{"start":{"line":93,"column":14},"end":{"line":93,"column":56}},"type":"binary-expr","locations":[{"start":{"line":93,"column":14},"end":{"line":93,"column":32}},{"start":{"line":93,"column":36},"end":{"line":93,"column":56}}],"line":93},"22":{"loc":{"start":{"line":93,"column":68},"end":{"line":93,"column":177}},"type":"cond-expr","locations":[{"start":{"line":93,"column":147},"end":{"line":93,"column":153}},{"start":{"line":93,"column":156},"end":{"line":93,"column":177}}],"line":93},"23":{"loc":{"start":{"line":93,"column":68},"end":{"line":93,"column":144}},"type":"binary-expr","locations":[{"start":{"line":93,"column":68},"end":{"line":93,"column":113}},{"start":{"line":93,"column":117},"end":{"line":93,"column":144}}],"line":93},"24":{"loc":{"start":{"line":93,"column":184},"end":{"line":93,"column":351}},"type":"cond-expr","locations":[{"start":{"line":93,"column":229},"end":{"line":93,"column":235}},{"start":{"line":93,"column":238},"end":{"line":93,"column":351}}],"line":93},"25":{"loc":{"start":{"line":93,"column":184},"end":{"line":93,"column":226}},"type":"binary-expr","locations":[{"start":{"line":93,"column":184},"end":{"line":93,"column":202}},{"start":{"line":93,"column":206},"end":{"line":93,"column":226}}],"line":93},"26":{"loc":{"start":{"line":93,"column":238},"end":{"line":93,"column":351}},"type":"cond-expr","locations":[{"start":{"line":93,"column":320},"end":{"line":93,"column":326}},{"start":{"line":93,"column":329},"end":{"line":93,"column":351}}],"line":93},"27":{"loc":{"start":{"line":93,"column":238},"end":{"line":93,"column":317}},"type":"binary-expr","locations":[{"start":{"line":93,"column":238},"end":{"line":93,"column":285}},{"start":{"line":93,"column":289},"end":{"line":93,"column":317}}],"line":93},"28":{"loc":{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},"type":"if","locations":[{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},{"start":{"line":109,"column":8},"end":{"line":111,"column":9}}],"line":109},"29":{"loc":{"start":{"line":109,"column":12},"end":{"line":109,"column":111}},"type":"binary-expr","locations":[{"start":{"line":109,"column":12},"end":{"line":109,"column":61}},{"start":{"line":109,"column":65},"end":{"line":109,"column":111}}],"line":109},"30":{"loc":{"start":{"line":113,"column":8},"end":{"line":115,"column":9}},"type":"if","locations":[{"start":{"line":113,"column":8},"end":{"line":115,"column":9}},{"start":{"line":113,"column":8},"end":{"line":115,"column":9}}],"line":113},"31":{"loc":{"start":{"line":113,"column":12},"end":{"line":113,"column":112}},"type":"binary-expr","locations":[{"start":{"line":113,"column":12},"end":{"line":113,"column":61}},{"start":{"line":113,"column":65},"end":{"line":113,"column":112}}],"line":113},"32":{"loc":{"start":{"line":117,"column":8},"end":{"line":119,"column":9}},"type":"if","locations":[{"start":{"line":117,"column":8},"end":{"line":119,"column":9}},{"start":{"line":117,"column":8},"end":{"line":119,"column":9}}],"line":117},"33":{"loc":{"start":{"line":117,"column":12},"end":{"line":117,"column":110}},"type":"binary-expr","locations":[{"start":{"line":117,"column":12},"end":{"line":117,"column":60}},{"start":{"line":117,"column":64},"end":{"line":117,"column":110}}],"line":117},"34":{"loc":{"start":{"line":121,"column":8},"end":{"line":123,"column":9}},"type":"if","locations":[{"start":{"line":121,"column":8},"end":{"line":123,"column":9}},{"start":{"line":121,"column":8},"end":{"line":123,"column":9}}],"line":121},"35":{"loc":{"start":{"line":121,"column":12},"end":{"line":121,"column":111}},"type":"binary-expr","locations":[{"start":{"line":121,"column":12},"end":{"line":121,"column":60}},{"start":{"line":121,"column":64},"end":{"line":121,"column":111}}],"line":121},"36":{"loc":{"start":{"line":131,"column":4},"end":{"line":133,"column":5}},"type":"if","locations":[{"start":{"line":131,"column":4},"end":{"line":133,"column":5}},{"start":{"line":131,"column":4},"end":{"line":133,"column":5}}],"line":131},"37":{"loc":{"start":{"line":135,"column":41},"end":{"line":135,"column":84}},"type":"binary-expr","locations":[{"start":{"line":135,"column":41},"end":{"line":135,"column":57}},{"start":{"line":135,"column":61},"end":{"line":135,"column":84}}],"line":135},"38":{"loc":{"start":{"line":136,"column":4},"end":{"line":138,"column":5}},"type":"if","locations":[{"start":{"line":136,"column":4},"end":{"line":138,"column":5}},{"start":{"line":136,"column":4},"end":{"line":138,"column":5}}],"line":136},"39":{"loc":{"start":{"line":136,"column":8},"end":{"line":136,"column":55}},"type":"binary-expr","locations":[{"start":{"line":136,"column":8},"end":{"line":136,"column":22}},{"start":{"line":136,"column":26},"end":{"line":136,"column":55}}],"line":136},"40":{"loc":{"start":{"line":139,"column":4},"end":{"line":141,"column":5}},"type":"if","locations":[{"start":{"line":139,"column":4},"end":{"line":141,"column":5}},{"start":{"line":139,"column":4},"end":{"line":141,"column":5}}],"line":139},"41":{"loc":{"start":{"line":139,"column":10},"end":{"line":139,"column":92}},"type":"cond-expr","locations":[{"start":{"line":139,"column":62},"end":{"line":139,"column":68}},{"start":{"line":139,"column":71},"end":{"line":139,"column":92}}],"line":139},"42":{"loc":{"start":{"line":139,"column":10},"end":{"line":139,"column":59}},"type":"binary-expr","locations":[{"start":{"line":139,"column":10},"end":{"line":139,"column":37}},{"start":{"line":139,"column":41},"end":{"line":139,"column":59}}],"line":139},"43":{"loc":{"start":{"line":143,"column":4},"end":{"line":145,"column":5}},"type":"if","locations":[{"start":{"line":143,"column":4},"end":{"line":145,"column":5}},{"start":{"line":143,"column":4},"end":{"line":145,"column":5}}],"line":143}},"s":{"0":1,"1":1,"2":4,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":8,"17":1,"18":33,"19":33,"20":1,"21":16,"22":2,"23":14,"24":14,"25":3,"26":3,"27":1,"28":2,"29":11,"30":13,"31":3,"32":10,"33":10,"34":10,"35":10,"36":10,"37":10,"38":10,"39":26,"40":26,"41":26,"42":4,"43":4,"44":22,"45":2,"46":2,"47":20,"48":1,"49":1,"50":19,"51":19,"52":19,"53":19,"54":19,"55":16,"56":19,"57":1,"58":19,"59":1,"60":19,"61":1,"62":19,"63":10,"64":1,"65":6,"66":6,"67":1,"68":5,"69":5,"70":5,"71":2,"72":3,"73":1,"74":2,"75":2,"76":1,"77":1,"78":1,"79":1,"80":1},"f":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":8,"7":33,"8":16,"9":6},"b":{"0":[0,1],"1":[1,1],"2":[8,6],"3":[2,14],"4":[3,11],"5":[3,11],"6":[11,3],"7":[14,3],"8":[1,2],"9":[2,0],"10":[2,2],"11":[0,11],"12":[11,11],"13":[3,10],"14":[13,11],"15":[10,0],"16":[4,22],"17":[2,20],"18":[1,19],"19":[20,19],"20":[0,20],"21":[20,20],"22":[0,20],"23":[20,20],"24":[0,19],"25":[19,19],"26":[0,19],"27":[19,19],"28":[16,3],"29":[19,17],"30":[1,18],"31":[19,17],"32":[1,18],"33":[19,2],"34":[1,18],"35":[19,2],"36":[1,5],"37":[5,3],"38":[2,3],"39":[5,5],"40":[1,2],"41":[0,3],"42":[3,3],"43":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/hooks/processRoomAbandonment.ts"],"sourcesContent":["import type { IOmnichannelRoom, IMessage, IBusinessHourWorkHour, ILivechatDepartment } from '@rocket.chat/core-typings';\nimport { isOmnichannelRoom } from '@rocket.chat/core-typings';\nimport { LivechatBusinessHours, LivechatDepartment, Messages, LivechatRooms } from '@rocket.chat/models';\nimport moment from 'moment';\n\nimport { callbacks } from '../../../../lib/callbacks';\nimport { settings } from '../../../settings/server';\nimport { businessHourManager } from '../business-hour';\nimport type { CloseRoomParams } from '../lib/localTypes';\n\nexport const getSecondsWhenOfficeHoursIsDisabled = (room: IOmnichannelRoom, agentLastMessage: IMessage) =>\n\tmoment(new Date(room.closedAt || new Date())).diff(moment(new Date(agentLastMessage.ts)), 'seconds');\n\nexport const parseDays = (\n\tacc: Record<string, { start: { day: string; time: string }; finish: { day: string; time: string }; open: boolean }>,\n\tday: IBusinessHourWorkHour,\n) => {\n\tacc[day.day] = {\n\t\tstart: { day: day.start.utc.dayOfWeek, time: day.start.utc.time },\n\t\tfinish: { day: day.finish.utc.dayOfWeek, time: day.finish.utc.time },\n\t\topen: day.open,\n\t};\n\treturn acc;\n};\n\nexport const getSecondsSinceLastAgentResponse = async (room: IOmnichannelRoom, agentLastMessage: IMessage) => {\n\tif (!settings.get('Livechat_enable_business_hours')) {\n\t\treturn getSecondsWhenOfficeHoursIsDisabled(room, agentLastMessage);\n\t}\n\tlet officeDays;\n\tconst department = room.departmentId\n\t\t? await LivechatDepartment.findOneById<Pick<ILivechatDepartment, 'businessHourId'>>(room.departmentId, {\n\t\t\t\tprojection: { businessHourId: 1 },\n\t\t\t})\n\t\t: null;\n\tif (department?.businessHourId) {\n\t\tconst businessHour = await LivechatBusinessHours.findOneById(department.businessHourId);\n\t\tif (!businessHour) {\n\t\t\treturn getSecondsWhenOfficeHoursIsDisabled(room, agentLastMessage);\n\t\t}\n\n\t\tofficeDays = (await businessHourManager.getBusinessHour(businessHour._id, businessHour.type))?.workHours.reduce(parseDays, {});\n\t} else {\n\t\tofficeDays = (await businessHourManager.getBusinessHour())?.workHours.reduce(parseDays, {});\n\t}\n\n\t// Empty object we assume invalid config\n\tif (!officeDays || !Object.keys(officeDays).length) {\n\t\treturn getSecondsWhenOfficeHoursIsDisabled(room, agentLastMessage);\n\t}\n\n\tlet totalSeconds = 0;\n\tconst endOfConversation = moment.utc(new Date(room.closedAt || new Date()));\n\tconst startOfInactivity = moment.utc(new Date(agentLastMessage.ts));\n\tconst daysOfInactivity = endOfConversation.clone().startOf('day').diff(startOfInactivity.clone().startOf('day'), 'days');\n\tconst inactivityDay = moment.utc(new Date(agentLastMessage.ts));\n\n\tfor (let index = 0; index <= daysOfInactivity; index++) {\n\t\tconst today = inactivityDay.clone().format('dddd');\n\t\tconst officeDay = officeDays[today];\n\n\t\tif (!officeDay) {\n\t\t\tinactivityDay.add(1, 'days');\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!officeDay.open) {\n\t\t\tinactivityDay.add(1, 'days');\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!officeDay?.start?.time || !officeDay?.finish?.time) {\n\t\t\tinactivityDay.add(1, 'days');\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst [officeStartHour, officeStartMinute] = officeDay.start.time.split(':');\n\t\tconst [officeCloseHour, officeCloseMinute] = officeDay.finish.time.split(':');\n\t\t// We should only take in consideration the time where the office is open and the conversation was inactive\n\t\tconst todayStartOfficeHours = inactivityDay\n\t\t\t.clone()\n\t\t\t.set({ hour: parseInt(officeStartHour, 10), minute: parseInt(officeStartMinute, 10) });\n\t\tconst todayEndOfficeHours = inactivityDay.clone().set({ hour: parseInt(officeCloseHour, 10), minute: parseInt(officeCloseMinute, 10) });\n\n\t\t// 1: Room was inactive the whole day, we add the whole time BH is inactive\n\t\tif (startOfInactivity.isBefore(todayStartOfficeHours) && endOfConversation.isAfter(todayEndOfficeHours)) {\n\t\t\ttotalSeconds += todayEndOfficeHours.diff(todayStartOfficeHours, 'seconds');\n\t\t}\n\n\t\t// 2: Room was inactive before start but was closed before end of BH, we add the inactive time\n\t\tif (startOfInactivity.isBefore(todayStartOfficeHours) && endOfConversation.isBefore(todayEndOfficeHours)) {\n\t\t\ttotalSeconds += endOfConversation.diff(todayStartOfficeHours, 'seconds');\n\t\t}\n\n\t\t// 3: Room was inactive after start and ended after end of BH, we add the inactive time\n\t\tif (startOfInactivity.isAfter(todayStartOfficeHours) && endOfConversation.isAfter(todayEndOfficeHours)) {\n\t\t\ttotalSeconds += todayEndOfficeHours.diff(startOfInactivity, 'seconds');\n\t\t}\n\n\t\t// 4: Room was inactive after start and before end of BH, we add the inactive time\n\t\tif (startOfInactivity.isAfter(todayStartOfficeHours) && endOfConversation.isBefore(todayEndOfficeHours)) {\n\t\t\ttotalSeconds += endOfConversation.diff(startOfInactivity, 'seconds');\n\t\t}\n\n\t\tinactivityDay.add(1, 'days');\n\t}\n\treturn totalSeconds;\n};\n\nexport const onCloseRoom = async (params: { room: IOmnichannelRoom; options: CloseRoomParams['options'] }) => {\n\tconst { room } = params;\n\n\tif (!isOmnichannelRoom(room)) {\n\t\treturn params;\n\t}\n\n\tconst closedByAgent = room.closer !== 'visitor';\n\tconst wasTheLastMessageSentByAgent = room.lastMessage && !room.lastMessage.token;\n\tif (!closedByAgent || !wasTheLastMessageSentByAgent) {\n\t\treturn params;\n\t}\n\n\tif (!room.v?.lastMessageTs) {\n\t\treturn params;\n\t}\n\n\tconst agentLastMessage = await Messages.findAgentLastMessageByVisitorLastMessageTs(room._id, room.v.lastMessageTs);\n\tif (!agentLastMessage) {\n\t\treturn params;\n\t}\n\tconst secondsSinceLastAgentResponse = await getSecondsSinceLastAgentResponse(room, agentLastMessage);\n\tawait LivechatRooms.setVisitorInactivityInSecondsById(room._id, secondsSinceLastAgentResponse);\n\n\treturn params;\n};\n\ncallbacks.add('livechat.closeRoom', onCloseRoom, callbacks.priority.HIGH, 'process-room-abandonment');\n"],"names":["getSecondsSinceLastAgentResponse","getSecondsWhenOfficeHoursIsDisabled","onCloseRoom","parseDays","room","agentLastMessage","moment","Date","closedAt","diff","ts","acc","day","start","utc","dayOfWeek","time","finish","open","settings","get","officeDays","department","departmentId","LivechatDepartment","findOneById","projection","businessHourId","businessHour","LivechatBusinessHours","businessHourManager","getBusinessHour","_id","type","workHours","reduce","Object","keys","length","totalSeconds","endOfConversation","startOfInactivity","daysOfInactivity","clone","startOf","inactivityDay","index","officeDay","today","format","add","officeStartHour","officeStartMinute","split","officeCloseHour","officeCloseMinute","todayStartOfficeHours","set","hour","parseInt","minute","todayEndOfficeHours","isBefore","isAfter","params","isOmnichannelRoom","closedByAgent","closer","wasTheLastMessageSentByAgent","lastMessage","token","v","lastMessageTs","Messages","findAgentLastMessageByVisitorLastMessageTs","secondsSinceLastAgentResponse","LivechatRooms","setVisitorInactivityInSecondsById","callbacks","priority","HIGH"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/hooks/processRoomAbandonment.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6e044816193b07995c2fcaede2b5243fddd9a12b","contentHash":"d8342c4801ff45fc01f3ee10e5d7b8c31e93b64268020dfcd1d401b033c029c7"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/Contacts.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/Contacts.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":39,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":24}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":29}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":40}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":33}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":27}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":38}},"10":{"start":{"line":31,"column":8},"end":{"line":31,"column":29}},"11":{"start":{"line":34,"column":8},"end":{"line":34,"column":38}},"12":{"start":{"line":37,"column":8},"end":{"line":37,"column":36}},"13":{"start":{"line":40,"column":16},"end":{"line":40,"column":46}},"14":{"start":{"line":41,"column":15},"end":{"line":41,"column":38}},"15":{"start":{"line":42,"column":16},"end":{"line":42,"column":40}},"16":{"start":{"line":43,"column":19},"end":{"line":43,"column":55}},"17":{"start":{"line":44,"column":21},"end":{"line":44,"column":65}},"18":{"start":{"line":45,"column":24},"end":{"line":45,"column":73}},"19":{"start":{"line":46,"column":14},"end":{"line":46,"column":48}},"20":{"start":{"line":47,"column":17},"end":{"line":164,"column":1}},"21":{"start":{"line":49,"column":8},"end":{"line":49,"column":41}},"22":{"start":{"line":50,"column":29},"end":{"line":50,"column":55}},"23":{"start":{"line":51,"column":8},"end":{"line":64,"column":9}},"24":{"start":{"line":53,"column":25},"end":{"line":57,"column":14}},"25":{"start":{"line":58,"column":12},"end":{"line":60,"column":13}},"26":{"start":{"line":59,"column":16},"end":{"line":59,"column":140}},"27":{"start":{"line":61,"column":12},"end":{"line":63,"column":13}},"28":{"start":{"line":62,"column":16},"end":{"line":62,"column":139}},"29":{"start":{"line":66,"column":21},"end":{"line":70,"column":10}},"30":{"start":{"line":71,"column":8},"end":{"line":88,"column":9}},"31":{"start":{"line":72,"column":12},"end":{"line":72,"column":33}},"32":{"start":{"line":74,"column":12},"end":{"line":76,"column":13}},"33":{"start":{"line":75,"column":16},"end":{"line":75,"column":83}},"34":{"start":{"line":77,"column":31},"end":{"line":77,"column":35}},"35":{"start":{"line":78,"column":12},"end":{"line":87,"column":13}},"36":{"start":{"line":79,"column":16},"end":{"line":79,"column":45}},"37":{"start":{"line":81,"column":33},"end":{"line":85,"column":17}},"38":{"start":{"line":86,"column":16},"end":{"line":86,"column":92}},"39":{"start":{"line":89,"column":26},"end":{"line":89,"column":56}},"40":{"start":{"line":90,"column":29},"end":{"line":92,"column":10}},"41":{"start":{"line":93,"column":31},"end":{"line":104,"column":9}},"42":{"start":{"line":105,"column":27},"end":{"line":134,"column":9}},"43":{"start":{"line":135,"column":8},"end":{"line":137,"column":23}},"44":{"start":{"line":138,"column":27},"end":{"line":138,"column":95}},"45":{"start":{"line":139,"column":22},"end":{"line":139,"column":102}},"46":{"start":{"line":140,"column":8},"end":{"line":161,"column":9}},"47":{"start":{"line":141,"column":12},"end":{"line":160,"column":13}},"48":{"start":{"line":143,"column":37},"end":{"line":143,"column":41}},"49":{"start":{"line":144,"column":34},"end":{"line":148,"column":18}},"50":{"start":{"line":149,"column":16},"end":{"line":151,"column":17}},"51":{"start":{"line":150,"column":20},"end":{"line":150,"column":75}},"52":{"start":{"line":152,"column":16},"end":{"line":156,"column":17}},"53":{"start":{"line":153,"column":20},"end":{"line":155,"column":23}},"54":{"start":{"line":157,"column":16},"end":{"line":159,"column":17}},"55":{"start":{"line":158,"column":20},"end":{"line":158,"column":87}},"56":{"start":{"line":162,"column":8},"end":{"line":162,"column":25}},"57":{"start":{"line":168,"column":4},"end":{"line":168,"column":167}},"58":{"start":{"line":171,"column":4},"end":{"line":173,"column":5}},"59":{"start":{"line":172,"column":8},"end":{"line":172,"column":56}},"60":{"start":{"line":174,"column":24},"end":{"line":182,"column":5}},"61":{"start":{"line":183,"column":4},"end":{"line":192,"column":5}},"62":{"start":{"line":184,"column":33},"end":{"line":188,"column":10}},"63":{"start":{"line":189,"column":8},"end":{"line":191,"column":9}},"64":{"start":{"line":190,"column":12},"end":{"line":190,"column":62}},"65":{"start":{"line":193,"column":38},"end":{"line":193,"column":91}},"66":{"start":{"line":194,"column":4},"end":{"line":200,"column":7}},"67":{"start":{"line":201,"column":4},"end":{"line":201,"column":21}},"68":{"start":{"line":204,"column":113},"end":{"line":204,"column":119}},"69":{"start":{"line":205,"column":4},"end":{"line":207,"column":5}},"70":{"start":{"line":206,"column":8},"end":{"line":206,"column":53}},"71":{"start":{"line":208,"column":32},"end":{"line":208,"column":62}},"72":{"start":{"line":209,"column":25},"end":{"line":209,"column":88}},"73":{"start":{"line":210,"column":27},"end":{"line":223,"column":6}},"74":{"start":{"line":212,"column":87},"end":{"line":214,"column":13}},"75":{"start":{"line":215,"column":91},"end":{"line":217,"column":13}},"76":{"start":{"line":224,"column":4},"end":{"line":224,"column":22}},"77":{"start":{"line":227,"column":110},"end":{"line":227,"column":116}},"78":{"start":{"line":228,"column":20},"end":{"line":232,"column":6}},"79":{"start":{"line":233,"column":4},"end":{"line":235,"column":5}},"80":{"start":{"line":234,"column":8},"end":{"line":234,"column":51}},"81":{"start":{"line":236,"column":4},"end":{"line":238,"column":5}},"82":{"start":{"line":237,"column":8},"end":{"line":237,"column":53}},"83":{"start":{"line":239,"column":25},"end":{"line":239,"column":123}},"84":{"start":{"line":240,"column":27},"end":{"line":251,"column":6}},"85":{"start":{"line":242,"column":87},"end":{"line":244,"column":13}},"86":{"start":{"line":245,"column":91},"end":{"line":247,"column":13}},"87":{"start":{"line":252,"column":4},"end":{"line":252,"column":26}},"88":{"start":{"line":255,"column":48},"end":{"line":255,"column":54}},"89":{"start":{"line":256,"column":35},"end":{"line":262,"column":6}},"90":{"start":{"line":263,"column":30},"end":{"line":266,"column":6}},"91":{"start":{"line":267,"column":4},"end":{"line":272,"column":6}},"92":{"start":{"line":276,"column":55},"end":{"line":276,"column":61}},"93":{"start":{"line":277,"column":20},"end":{"line":281,"column":6}},"94":{"start":{"line":282,"column":4},"end":{"line":284,"column":5}},"95":{"start":{"line":283,"column":8},"end":{"line":283,"column":51}},"96":{"start":{"line":285,"column":24},"end":{"line":285,"column":175}},"97":{"start":{"line":285,"column":156},"end":{"line":285,"column":173}},"98":{"start":{"line":286,"column":4},"end":{"line":293,"column":5}},"99":{"start":{"line":287,"column":8},"end":{"line":292,"column":10}},"100":{"start":{"line":294,"column":20},"end":{"line":312,"column":5}},"101":{"start":{"line":313,"column":35},"end":{"line":317,"column":6}},"102":{"start":{"line":318,"column":29},"end":{"line":321,"column":6}},"103":{"start":{"line":322,"column":4},"end":{"line":327,"column":6}},"104":{"start":{"line":330,"column":4},"end":{"line":337,"column":24}},"105":{"start":{"line":340,"column":24},"end":{"line":340,"column":26}},"106":{"start":{"line":341,"column":4},"end":{"line":368,"column":5}},"107":{"start":{"line":342,"column":8},"end":{"line":349,"column":9}},"108":{"start":{"line":343,"column":12},"end":{"line":347,"column":13}},"109":{"start":{"line":344,"column":16},"end":{"line":346,"column":20}},"110":{"start":{"line":348,"column":12},"end":{"line":348,"column":21}},"111":{"start":{"line":350,"column":24},"end":{"line":350,"column":68}},"112":{"start":{"line":351,"column":8},"end":{"line":358,"column":9}},"113":{"start":{"line":352,"column":12},"end":{"line":356,"column":13}},"114":{"start":{"line":353,"column":16},"end":{"line":355,"column":20}},"115":{"start":{"line":357,"column":12},"end":{"line":357,"column":21}},"116":{"start":{"line":359,"column":8},"end":{"line":366,"column":9}},"117":{"start":{"line":360,"column":26},"end":{"line":360,"column":47}},"118":{"start":{"line":361,"column":12},"end":{"line":365,"column":13}},"119":{"start":{"line":362,"column":16},"end":{"line":364,"column":20}},"120":{"start":{"line":367,"column":8},"end":{"line":367,"column":38}},"121":{"start":{"line":369,"column":4},"end":{"line":378,"column":5}},"122":{"start":{"line":370,"column":38},"end":{"line":370,"column":84}},"123":{"start":{"line":370,"column":76},"end":{"line":370,"column":82}},"124":{"start":{"line":371,"column":8},"end":{"line":377,"column":9}},"125":{"start":{"line":372,"column":12},"end":{"line":376,"column":13}},"126":{"start":{"line":373,"column":16},"end":{"line":375,"column":20}},"127":{"start":{"line":379,"column":4},"end":{"line":379,"column":23}},"128":{"start":{"line":382,"column":31},"end":{"line":386,"column":6}},"129":{"start":{"line":387,"column":4},"end":{"line":389,"column":5}},"130":{"start":{"line":388,"column":8},"end":{"line":388,"column":59}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":14},"end":{"line":12,"column":15}},"loc":{"start":{"line":12,"column":25},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":19},"end":{"line":15,"column":20}},"loc":{"start":{"line":15,"column":30},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":30},"end":{"line":18,"column":31}},"loc":{"start":{"line":18,"column":41},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":23},"end":{"line":21,"column":24}},"loc":{"start":{"line":21,"column":34},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":17},"end":{"line":24,"column":18}},"loc":{"start":{"line":24,"column":28},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":28},"end":{"line":27,"column":29}},"loc":{"start":{"line":27,"column":39},"end":{"line":29,"column":5}},"line":27},"7":{"name":"(anonymous_7)","decl":{"start":{"line":30,"column":19},"end":{"line":30,"column":20}},"loc":{"start":{"line":30,"column":30},"end":{"line":32,"column":5}},"line":30},"8":{"name":"(anonymous_8)","decl":{"start":{"line":33,"column":28},"end":{"line":33,"column":29}},"loc":{"start":{"line":33,"column":39},"end":{"line":35,"column":5}},"line":33},"9":{"name":"(anonymous_9)","decl":{"start":{"line":36,"column":26},"end":{"line":36,"column":27}},"loc":{"start":{"line":36,"column":37},"end":{"line":38,"column":5}},"line":36},"10":{"name":"(anonymous_10)","decl":{"start":{"line":48,"column":4},"end":{"line":48,"column":5}},"loc":{"start":{"line":48,"column":108},"end":{"line":163,"column":5}},"line":48},"11":{"name":"isSingleContactEnabled","decl":{"start":{"line":165,"column":9},"end":{"line":165,"column":31}},"loc":{"start":{"line":165,"column":34},"end":{"line":169,"column":1}},"line":165},"12":{"name":"createContactFromVisitor","decl":{"start":{"line":170,"column":15},"end":{"line":170,"column":39}},"loc":{"start":{"line":170,"column":49},"end":{"line":202,"column":1}},"line":170},"13":{"name":"createContact","decl":{"start":{"line":203,"column":15},"end":{"line":203,"column":28}},"loc":{"start":{"line":203,"column":37},"end":{"line":225,"column":1}},"line":203},"14":{"name":"(anonymous_14)","decl":{"start":{"line":212,"column":75},"end":{"line":212,"column":76}},"loc":{"start":{"line":212,"column":87},"end":{"line":214,"column":13}},"line":212},"15":{"name":"(anonymous_15)","decl":{"start":{"line":215,"column":75},"end":{"line":215,"column":76}},"loc":{"start":{"line":215,"column":91},"end":{"line":217,"column":13}},"line":215},"16":{"name":"updateContact","decl":{"start":{"line":226,"column":15},"end":{"line":226,"column":28}},"loc":{"start":{"line":226,"column":37},"end":{"line":253,"column":1}},"line":226},"17":{"name":"(anonymous_17)","decl":{"start":{"line":242,"column":75},"end":{"line":242,"column":76}},"loc":{"start":{"line":242,"column":87},"end":{"line":244,"column":13}},"line":242},"18":{"name":"(anonymous_18)","decl":{"start":{"line":245,"column":75},"end":{"line":245,"column":76}},"loc":{"start":{"line":245,"column":91},"end":{"line":247,"column":13}},"line":245},"19":{"name":"getContacts","decl":{"start":{"line":254,"column":15},"end":{"line":254,"column":26}},"loc":{"start":{"line":254,"column":35},"end":{"line":273,"column":1}},"line":254},"20":{"name":"getContactHistory","decl":{"start":{"line":274,"column":15},"end":{"line":274,"column":32}},"loc":{"start":{"line":274,"column":41},"end":{"line":328,"column":1}},"line":274},"21":{"name":"(anonymous_21)","decl":{"start":{"line":285,"column":145},"end":{"line":285,"column":146}},"loc":{"start":{"line":285,"column":156},"end":{"line":285,"column":173}},"line":285},"22":{"name":"getAllowedCustomFields","decl":{"start":{"line":329,"column":15},"end":{"line":329,"column":37}},"loc":{"start":{"line":329,"column":40},"end":{"line":338,"column":1}},"line":329},"23":{"name":"validateCustomFields","decl":{"start":{"line":339,"column":9},"end":{"line":339,"column":29}},"loc":{"start":{"line":339,"column":74},"end":{"line":380,"column":1}},"line":339},"24":{"name":"(anonymous_24)","decl":{"start":{"line":370,"column":70},"end":{"line":370,"column":71}},"loc":{"start":{"line":370,"column":76},"end":{"line":370,"column":82}},"line":370},"25":{"name":"validateContactManager","decl":{"start":{"line":381,"column":15},"end":{"line":381,"column":37}},"loc":{"start":{"line":381,"column":60},"end":{"line":390,"column":1}},"line":381}},"branchMap":{"0":{"loc":{"start":{"line":48,"column":42},"end":{"line":48,"column":52}},"type":"default-arg","locations":[{"start":{"line":48,"column":50},"end":{"line":48,"column":52}}],"line":48},"1":{"loc":{"start":{"line":48,"column":71},"end":{"line":48,"column":88}},"type":"default-arg","locations":[{"start":{"line":48,"column":86},"end":{"line":48,"column":88}}],"line":48},"2":{"loc":{"start":{"line":51,"column":8},"end":{"line":64,"column":9}},"type":"if","locations":[{"start":{"line":51,"column":8},"end":{"line":64,"column":9}},{"start":{"line":51,"column":8},"end":{"line":64,"column":9}}],"line":51},"3":{"loc":{"start":{"line":51,"column":12},"end":{"line":51,"column":99}},"type":"cond-expr","locations":[{"start":{"line":51,"column":67},"end":{"line":51,"column":73}},{"start":{"line":51,"column":76},"end":{"line":51,"column":99}}],"line":51},"4":{"loc":{"start":{"line":51,"column":12},"end":{"line":51,"column":64}},"type":"binary-expr","locations":[{"start":{"line":51,"column":12},"end":{"line":51,"column":35}},{"start":{"line":51,"column":39},"end":{"line":51,"column":64}}],"line":51},"5":{"loc":{"start":{"line":58,"column":12},"end":{"line":60,"column":13}},"type":"if","locations":[{"start":{"line":58,"column":12},"end":{"line":60,"column":13}},{"start":{"line":58,"column":12},"end":{"line":60,"column":13}}],"line":58},"6":{"loc":{"start":{"line":61,"column":12},"end":{"line":63,"column":13}},"type":"if","locations":[{"start":{"line":61,"column":12},"end":{"line":63,"column":13}},{"start":{"line":61,"column":12},"end":{"line":63,"column":13}}],"line":61},"7":{"loc":{"start":{"line":61,"column":16},"end":{"line":61,"column":99}},"type":"binary-expr","locations":[{"start":{"line":61,"column":16},"end":{"line":61,"column":27}},{"start":{"line":61,"column":31},"end":{"line":61,"column":57}},{"start":{"line":61,"column":61},"end":{"line":61,"column":99}}],"line":61},"8":{"loc":{"start":{"line":71,"column":8},"end":{"line":88,"column":9}},"type":"if","locations":[{"start":{"line":71,"column":8},"end":{"line":88,"column":9}},{"start":{"line":71,"column":8},"end":{"line":88,"column":9}}],"line":71},"9":{"loc":{"start":{"line":74,"column":12},"end":{"line":76,"column":13}},"type":"if","locations":[{"start":{"line":74,"column":12},"end":{"line":76,"column":13}},{"start":{"line":74,"column":12},"end":{"line":76,"column":13}}],"line":74},"10":{"loc":{"start":{"line":78,"column":12},"end":{"line":87,"column":13}},"type":"if","locations":[{"start":{"line":78,"column":12},"end":{"line":87,"column":13}},{"start":{"line":78,"column":12},"end":{"line":87,"column":13}}],"line":78},"11":{"loc":{"start":{"line":78,"column":16},"end":{"line":78,"column":127}},"type":"binary-expr","locations":[{"start":{"line":78,"column":16},"end":{"line":78,"column":35}},{"start":{"line":78,"column":40},"end":{"line":78,"column":126}}],"line":78},"12":{"loc":{"start":{"line":95,"column":15},"end":{"line":97,"column":13}},"type":"binary-expr","locations":[{"start":{"line":95,"column":15},"end":{"line":95,"column":27}},{"start":{"line":95,"column":31},"end":{"line":97,"column":13}}],"line":95},"13":{"loc":{"start":{"line":98,"column":15},"end":{"line":100,"column":13}},"type":"binary-expr","locations":[{"start":{"line":98,"column":15},"end":{"line":98,"column":34}},{"start":{"line":98,"column":38},"end":{"line":100,"column":13}}],"line":98},"14":{"loc":{"start":{"line":101,"column":15},"end":{"line":103,"column":13}},"type":"binary-expr","locations":[{"start":{"line":101,"column":15},"end":{"line":101,"column":105}},{"start":{"line":101,"column":109},"end":{"line":103,"column":13}}],"line":101},"15":{"loc":{"start":{"line":101,"column":17},"end":{"line":101,"column":104}},"type":"cond-expr","locations":[{"start":{"line":101,"column":72},"end":{"line":101,"column":78}},{"start":{"line":101,"column":81},"end":{"line":101,"column":104}}],"line":101},"16":{"loc":{"start":{"line":101,"column":17},"end":{"line":101,"column":69}},"type":"binary-expr","locations":[{"start":{"line":101,"column":17},"end":{"line":101,"column":40}},{"start":{"line":101,"column":44},"end":{"line":101,"column":69}}],"line":101},"17":{"loc":{"start":{"line":111,"column":19},"end":{"line":117,"column":17}},"type":"binary-expr","locations":[{"start":{"line":111,"column":19},"end":{"line":111,"column":24}},{"start":{"line":111,"column":28},"end":{"line":117,"column":17}}],"line":111},"18":{"loc":{"start":{"line":118,"column":19},"end":{"line":124,"column":17}},"type":"binary-expr","locations":[{"start":{"line":118,"column":19},"end":{"line":118,"column":31}},{"start":{"line":118,"column":35},"end":{"line":124,"column":17}}],"line":118},"19":{"loc":{"start":{"line":125,"column":19},"end":{"line":129,"column":17}},"type":"binary-expr","locations":[{"start":{"line":125,"column":20},"end":{"line":125,"column":107}},{"start":{"line":125,"column":112},"end":{"line":129,"column":17}}],"line":125},"20":{"loc":{"start":{"line":125,"column":20},"end":{"line":125,"column":107}},"type":"cond-expr","locations":[{"start":{"line":125,"column":75},"end":{"line":125,"column":81}},{"start":{"line":125,"column":84},"end":{"line":125,"column":107}}],"line":125},"21":{"loc":{"start":{"line":125,"column":20},"end":{"line":125,"column":72}},"type":"binary-expr","locations":[{"start":{"line":125,"column":20},"end":{"line":125,"column":43}},{"start":{"line":125,"column":47},"end":{"line":125,"column":72}}],"line":125},"22":{"loc":{"start":{"line":131,"column":15},"end":{"line":133,"column":13}},"type":"binary-expr","locations":[{"start":{"line":131,"column":15},"end":{"line":131,"column":49}},{"start":{"line":131,"column":53},"end":{"line":133,"column":13}}],"line":131},"23":{"loc":{"start":{"line":140,"column":8},"end":{"line":161,"column":9}},"type":"if","locations":[{"start":{"line":140,"column":8},"end":{"line":161,"column":9}},{"start":{"line":140,"column":8},"end":{"line":161,"column":9}}],"line":140},"24":{"loc":{"start":{"line":140,"column":12},"end":{"line":140,"column":70}},"type":"cond-expr","locations":[{"start":{"line":140,"column":49},"end":{"line":140,"column":55}},{"start":{"line":140,"column":58},"end":{"line":140,"column":70}}],"line":140},"25":{"loc":{"start":{"line":140,"column":12},"end":{"line":140,"column":46}},"type":"binary-expr","locations":[{"start":{"line":140,"column":12},"end":{"line":140,"column":26}},{"start":{"line":140,"column":30},"end":{"line":140,"column":46}}],"line":140},"26":{"loc":{"start":{"line":149,"column":16},"end":{"line":151,"column":17}},"type":"if","locations":[{"start":{"line":149,"column":16},"end":{"line":151,"column":17}},{"start":{"line":149,"column":16},"end":{"line":151,"column":17}}],"line":149},"27":{"loc":{"start":{"line":149,"column":20},"end":{"line":149,"column":120}},"type":"cond-expr","locations":[{"start":{"line":149,"column":86},"end":{"line":149,"column":92}},{"start":{"line":149,"column":95},"end":{"line":149,"column":120}}],"line":149},"28":{"loc":{"start":{"line":149,"column":20},"end":{"line":149,"column":83}},"type":"binary-expr","locations":[{"start":{"line":149,"column":20},"end":{"line":149,"column":57}},{"start":{"line":149,"column":61},"end":{"line":149,"column":83}}],"line":149},"29":{"loc":{"start":{"line":152,"column":16},"end":{"line":156,"column":17}},"type":"if","locations":[{"start":{"line":152,"column":16},"end":{"line":156,"column":17}},{"start":{"line":152,"column":16},"end":{"line":156,"column":17}}],"line":152},"30":{"loc":{"start":{"line":152,"column":20},"end":{"line":152,"column":123}},"type":"cond-expr","locations":[{"start":{"line":152,"column":88},"end":{"line":152,"column":94}},{"start":{"line":152,"column":97},"end":{"line":152,"column":123}}],"line":152},"31":{"loc":{"start":{"line":152,"column":20},"end":{"line":152,"column":85}},"type":"binary-expr","locations":[{"start":{"line":152,"column":20},"end":{"line":152,"column":58}},{"start":{"line":152,"column":62},"end":{"line":152,"column":85}}],"line":152},"32":{"loc":{"start":{"line":157,"column":16},"end":{"line":159,"column":17}},"type":"if","locations":[{"start":{"line":157,"column":16},"end":{"line":159,"column":17}},{"start":{"line":157,"column":16},"end":{"line":159,"column":17}}],"line":157},"33":{"loc":{"start":{"line":157,"column":20},"end":{"line":157,"column":123}},"type":"cond-expr","locations":[{"start":{"line":157,"column":88},"end":{"line":157,"column":94}},{"start":{"line":157,"column":97},"end":{"line":157,"column":123}}],"line":157},"34":{"loc":{"start":{"line":157,"column":20},"end":{"line":157,"column":85}},"type":"binary-expr","locations":[{"start":{"line":157,"column":20},"end":{"line":157,"column":58}},{"start":{"line":157,"column":62},"end":{"line":157,"column":85}}],"line":157},"35":{"loc":{"start":{"line":168,"column":12},"end":{"line":168,"column":154}},"type":"cond-expr","locations":[{"start":{"line":168,"column":109},"end":{"line":168,"column":115}},{"start":{"line":168,"column":118},"end":{"line":168,"column":154}}],"line":168},"36":{"loc":{"start":{"line":168,"column":12},"end":{"line":168,"column":106}},"type":"binary-expr","locations":[{"start":{"line":168,"column":12},"end":{"line":168,"column":69}},{"start":{"line":168,"column":73},"end":{"line":168,"column":106}}],"line":168},"37":{"loc":{"start":{"line":171,"column":4},"end":{"line":173,"column":5}},"type":"if","locations":[{"start":{"line":171,"column":4},"end":{"line":173,"column":5}},{"start":{"line":171,"column":4},"end":{"line":173,"column":5}}],"line":171},"38":{"loc":{"start":{"line":175,"column":14},"end":{"line":175,"column":46}},"type":"binary-expr","locations":[{"start":{"line":175,"column":14},"end":{"line":175,"column":26}},{"start":{"line":175,"column":30},"end":{"line":175,"column":46}}],"line":175},"39":{"loc":{"start":{"line":177,"column":16},"end":{"line":177,"column":42}},"type":"binary-expr","locations":[{"start":{"line":177,"column":16},"end":{"line":177,"column":29}},{"start":{"line":177,"column":33},"end":{"line":177,"column":42}}],"line":177},"40":{"loc":{"start":{"line":183,"column":4},"end":{"line":192,"column":5}},"type":"if","locations":[{"start":{"line":183,"column":4},"end":{"line":192,"column":5}},{"start":{"line":183,"column":4},"end":{"line":192,"column":5}}],"line":183},"41":{"loc":{"start":{"line":189,"column":8},"end":{"line":191,"column":9}},"type":"if","locations":[{"start":{"line":189,"column":8},"end":{"line":191,"column":9}},{"start":{"line":189,"column":8},"end":{"line":191,"column":9}}],"line":189},"42":{"loc":{"start":{"line":204,"column":48},"end":{"line":204,"column":73}},"type":"default-arg","locations":[{"start":{"line":204,"column":71},"end":{"line":204,"column":73}}],"line":204},"43":{"loc":{"start":{"line":205,"column":4},"end":{"line":207,"column":5}},"type":"if","locations":[{"start":{"line":205,"column":4},"end":{"line":207,"column":5}},{"start":{"line":205,"column":4},"end":{"line":207,"column":5}}],"line":205},"44":{"loc":{"start":{"line":212,"column":16},"end":{"line":214,"column":15}},"type":"cond-expr","locations":[{"start":{"line":212,"column":55},"end":{"line":212,"column":61}},{"start":{"line":212,"column":64},"end":{"line":214,"column":15}}],"line":212},"45":{"loc":{"start":{"line":212,"column":16},"end":{"line":212,"column":52}},"type":"binary-expr","locations":[{"start":{"line":212,"column":16},"end":{"line":212,"column":31}},{"start":{"line":212,"column":35},"end":{"line":212,"column":52}}],"line":212},"46":{"loc":{"start":{"line":215,"column":16},"end":{"line":217,"column":15}},"type":"cond-expr","locations":[{"start":{"line":215,"column":55},"end":{"line":215,"column":61}},{"start":{"line":215,"column":64},"end":{"line":217,"column":15}}],"line":215},"47":{"loc":{"start":{"line":215,"column":16},"end":{"line":215,"column":52}},"type":"binary-expr","locations":[{"start":{"line":215,"column":16},"end":{"line":215,"column":31}},{"start":{"line":215,"column":35},"end":{"line":215,"column":52}}],"line":215},"48":{"loc":{"start":{"line":233,"column":4},"end":{"line":235,"column":5}},"type":"if","locations":[{"start":{"line":233,"column":4},"end":{"line":235,"column":5}},{"start":{"line":233,"column":4},"end":{"line":235,"column":5}}],"line":233},"49":{"loc":{"start":{"line":236,"column":4},"end":{"line":238,"column":5}},"type":"if","locations":[{"start":{"line":236,"column":4},"end":{"line":238,"column":5}},{"start":{"line":236,"column":4},"end":{"line":238,"column":5}}],"line":236},"50":{"loc":{"start":{"line":239,"column":25},"end":{"line":239,"column":123}},"type":"binary-expr","locations":[{"start":{"line":239,"column":25},"end":{"line":239,"column":45}},{"start":{"line":239,"column":49},"end":{"line":239,"column":123}}],"line":239},"51":{"loc":{"start":{"line":242,"column":16},"end":{"line":244,"column":15}},"type":"cond-expr","locations":[{"start":{"line":242,"column":55},"end":{"line":242,"column":61}},{"start":{"line":242,"column":64},"end":{"line":244,"column":15}}],"line":242},"52":{"loc":{"start":{"line":242,"column":16},"end":{"line":242,"column":52}},"type":"binary-expr","locations":[{"start":{"line":242,"column":16},"end":{"line":242,"column":31}},{"start":{"line":242,"column":35},"end":{"line":242,"column":52}}],"line":242},"53":{"loc":{"start":{"line":245,"column":16},"end":{"line":247,"column":15}},"type":"cond-expr","locations":[{"start":{"line":245,"column":55},"end":{"line":245,"column":61}},{"start":{"line":245,"column":64},"end":{"line":247,"column":15}}],"line":245},"54":{"loc":{"start":{"line":245,"column":16},"end":{"line":245,"column":52}},"type":"binary-expr","locations":[{"start":{"line":245,"column":16},"end":{"line":245,"column":31}},{"start":{"line":245,"column":35},"end":{"line":245,"column":52}}],"line":245},"55":{"loc":{"start":{"line":259,"column":14},"end":{"line":261,"column":9}},"type":"cond-expr","locations":[{"start":{"line":259,"column":49},"end":{"line":259,"column":53}},{"start":{"line":259,"column":56},"end":{"line":261,"column":9}}],"line":259},"56":{"loc":{"start":{"line":259,"column":14},"end":{"line":259,"column":46}},"type":"binary-expr","locations":[{"start":{"line":259,"column":14},"end":{"line":259,"column":27}},{"start":{"line":259,"column":31},"end":{"line":259,"column":46}}],"line":259},"57":{"loc":{"start":{"line":282,"column":4},"end":{"line":284,"column":5}},"type":"if","locations":[{"start":{"line":282,"column":4},"end":{"line":284,"column":5}},{"start":{"line":282,"column":4},"end":{"line":284,"column":5}}],"line":282},"58":{"loc":{"start":{"line":285,"column":32},"end":{"line":285,"column":174}},"type":"cond-expr","locations":[{"start":{"line":285,"column":114},"end":{"line":285,"column":120}},{"start":{"line":285,"column":123},"end":{"line":285,"column":174}}],"line":285},"59":{"loc":{"start":{"line":285,"column":32},"end":{"line":285,"column":111}},"type":"binary-expr","locations":[{"start":{"line":285,"column":32},"end":{"line":285,"column":79}},{"start":{"line":285,"column":83},"end":{"line":285,"column":111}}],"line":285},"60":{"loc":{"start":{"line":286,"column":4},"end":{"line":293,"column":5}},"type":"if","locations":[{"start":{"line":286,"column":4},"end":{"line":293,"column":5}},{"start":{"line":286,"column":4},"end":{"line":293,"column":5}}],"line":286},"61":{"loc":{"start":{"line":286,"column":10},"end":{"line":286,"column":84}},"type":"cond-expr","locations":[{"start":{"line":286,"column":59},"end":{"line":286,"column":65}},{"start":{"line":286,"column":68},"end":{"line":286,"column":84}}],"line":286},"62":{"loc":{"start":{"line":286,"column":10},"end":{"line":286,"column":56}},"type":"binary-expr","locations":[{"start":{"line":286,"column":10},"end":{"line":286,"column":30}},{"start":{"line":286,"column":34},"end":{"line":286,"column":56}}],"line":286},"63":{"loc":{"start":{"line":295,"column":14},"end":{"line":297,"column":9}},"type":"binary-expr","locations":[{"start":{"line":295,"column":14},"end":{"line":295,"column":18}},{"start":{"line":295,"column":22},"end":{"line":297,"column":9}}],"line":295},"64":{"loc":{"start":{"line":342,"column":8},"end":{"line":349,"column":9}},"type":"if","locations":[{"start":{"line":342,"column":8},"end":{"line":349,"column":9}},{"start":{"line":342,"column":8},"end":{"line":349,"column":9}}],"line":342},"65":{"loc":{"start":{"line":343,"column":12},"end":{"line":347,"column":13}},"type":"if","locations":[{"start":{"line":343,"column":12},"end":{"line":347,"column":13}},{"start":{"line":343,"column":12},"end":{"line":347,"column":13}}],"line":343},"66":{"loc":{"start":{"line":351,"column":8},"end":{"line":358,"column":9}},"type":"if","locations":[{"start":{"line":351,"column":8},"end":{"line":358,"column":9}},{"start":{"line":351,"column":8},"end":{"line":358,"column":9}}],"line":351},"67":{"loc":{"start":{"line":351,"column":12},"end":{"line":351,"column":51}},"type":"binary-expr","locations":[{"start":{"line":351,"column":12},"end":{"line":351,"column":20}},{"start":{"line":351,"column":24},"end":{"line":351,"column":51}}],"line":351},"68":{"loc":{"start":{"line":352,"column":12},"end":{"line":356,"column":13}},"type":"if","locations":[{"start":{"line":352,"column":12},"end":{"line":356,"column":13}},{"start":{"line":352,"column":12},"end":{"line":356,"column":13}}],"line":352},"69":{"loc":{"start":{"line":359,"column":8},"end":{"line":366,"column":9}},"type":"if","locations":[{"start":{"line":359,"column":8},"end":{"line":366,"column":9}},{"start":{"line":359,"column":8},"end":{"line":366,"column":9}}],"line":359},"70":{"loc":{"start":{"line":361,"column":12},"end":{"line":365,"column":13}},"type":"if","locations":[{"start":{"line":361,"column":12},"end":{"line":365,"column":13}},{"start":{"line":361,"column":12},"end":{"line":365,"column":13}}],"line":361},"71":{"loc":{"start":{"line":369,"column":4},"end":{"line":378,"column":5}},"type":"if","locations":[{"start":{"line":369,"column":4},"end":{"line":378,"column":5}},{"start":{"line":369,"column":4},"end":{"line":378,"column":5}}],"line":369},"72":{"loc":{"start":{"line":369,"column":10},"end":{"line":369,"column":90}},"type":"cond-expr","locations":[{"start":{"line":369,"column":51},"end":{"line":369,"column":57}},{"start":{"line":369,"column":60},"end":{"line":369,"column":90}}],"line":369},"73":{"loc":{"start":{"line":369,"column":10},"end":{"line":369,"column":48}},"type":"binary-expr","locations":[{"start":{"line":369,"column":10},"end":{"line":369,"column":26}},{"start":{"line":369,"column":30},"end":{"line":369,"column":48}}],"line":369},"74":{"loc":{"start":{"line":372,"column":12},"end":{"line":376,"column":13}},"type":"if","locations":[{"start":{"line":372,"column":12},"end":{"line":376,"column":13}},{"start":{"line":372,"column":12},"end":{"line":376,"column":13}}],"line":372},"75":{"loc":{"start":{"line":387,"column":4},"end":{"line":389,"column":5}},"type":"if","locations":[{"start":{"line":387,"column":4},"end":{"line":389,"column":5}},{"start":{"line":387,"column":4},"end":{"line":389,"column":5}}],"line":387}},"s":{"0":1,"1":1,"2":9,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":2,"78":2,"79":2,"80":1,"81":1,"82":0,"83":1,"84":1,"85":0,"86":0,"87":1,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":6,"106":6,"107":6,"108":4,"109":1,"110":3,"111":2,"112":2,"113":0,"114":0,"115":0,"116":2,"117":2,"118":2,"119":1,"120":1,"121":4,"122":4,"123":4,"124":4,"125":2,"126":1,"127":3,"128":2,"129":2,"130":1},"f":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":1,"8":1,"9":1,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":2,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":6,"24":4,"25":2},"b":{"0":[0],"1":[0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[1,1],"49":[0,1],"50":[1,0],"51":[1,0],"52":[1,1],"53":[1,0],"54":[1,1],"55":[0,0],"56":[0,0],"57":[0,0],"58":[0,0],"59":[0,0],"60":[0,0],"61":[0,0],"62":[0,0],"63":[0,0],"64":[4,2],"65":[1,3],"66":[0,2],"67":[2,2],"68":[0,0],"69":[2,0],"70":[1,1],"71":[4,0],"72":[4,0],"73":[4,4],"74":[1,1],"75":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/Contacts.ts"],"sourcesContent":["import type {\n\tAtLeast,\n\tILivechatContact,\n\tILivechatContactChannel,\n\tILivechatCustomField,\n\tILivechatVisitor,\n\tIOmnichannelRoom,\n\tIUser,\n} from '@rocket.chat/core-typings';\nimport type { InsertionModel } from '@rocket.chat/model-typings';\nimport {\n\tLivechatVisitors,\n\tUsers,\n\tLivechatRooms,\n\tLivechatCustomField,\n\tLivechatInquiry,\n\tRooms,\n\tSubscriptions,\n\tLivechatContacts,\n} from '@rocket.chat/models';\nimport type { PaginatedResult, VisitorSearchChatsResult } from '@rocket.chat/rest-typings';\nimport { check } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\nimport type { MatchKeysAndValues, OnlyFieldsOfType, FindOptions, Sort } from 'mongodb';\n\nimport { callbacks } from '../../../../lib/callbacks';\nimport { trim } from '../../../../lib/utils/stringUtils';\nimport {\n\tnotifyOnRoomChangedById,\n\tnotifyOnSubscriptionChangedByRoomId,\n\tnotifyOnLivechatInquiryChangedByRoom,\n} from '../../../lib/server/lib/notifyListener';\nimport { i18n } from '../../../utils/lib/i18n';\n\ntype RegisterContactProps = {\n\t_id?: string;\n\ttoken: string;\n\tname: string;\n\tusername?: string;\n\temail?: string;\n\tphone?: string;\n\tcustomFields?: Record<string, unknown | string>;\n\tcontactManager?: {\n\t\tusername: string;\n\t};\n};\n\ntype CreateContactParams = {\n\tname: string;\n\temails?: string[];\n\tphones?: string[];\n\tunknown: boolean;\n\tcustomFields?: Record<string, string | unknown>;\n\tcontactManager?: string;\n\tchannels?: ILivechatContactChannel[];\n};\n\ntype UpdateContactParams = {\n\tcontactId: string;\n\tname?: string;\n\temails?: string[];\n\tphones?: string[];\n\tcustomFields?: Record<string, unknown>;\n\tcontactManager?: string;\n\tchannels?: ILivechatContactChannel[];\n};\n\ntype GetContactsParams = {\n\tsearchText?: string;\n\tcount: number;\n\toffset: number;\n\tsort: Sort;\n};\n\ntype GetContactHistoryParams = {\n\tcontactId: string;\n\tsource?: string;\n\tcount: number;\n\toffset: number;\n\tsort: Sort;\n};\n\nexport const Contacts = {\n\tasync registerContact({\n\t\ttoken,\n\t\tname,\n\t\temail = '',\n\t\tphone,\n\t\tusername,\n\t\tcustomFields = {},\n\t\tcontactManager,\n\t}: RegisterContactProps): Promise<string> {\n\t\tcheck(token, String);\n\n\t\tconst visitorEmail = email.trim().toLowerCase();\n\n\t\tif (contactManager?.username) {\n\t\t\t// verify if the user exists with this username and has a livechat-agent role\n\t\t\tconst user = await Users.findOneByUsername(contactManager.username, { projection: { roles: 1 } });\n\t\t\tif (!user) {\n\t\t\t\tthrow new Meteor.Error('error-contact-manager-not-found', `No user found with username ${contactManager.username}`);\n\t\t\t}\n\t\t\tif (!user.roles || !Array.isArray(user.roles) || !user.roles.includes('livechat-agent')) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-contact-manager', 'The contact manager must have the role \"livechat-agent\"');\n\t\t\t}\n\t\t}\n\n\t\tlet contactId;\n\n\t\tconst user = await LivechatVisitors.getVisitorByToken(token, { projection: { _id: 1 } });\n\n\t\tif (user) {\n\t\t\tcontactId = user._id;\n\t\t} else {\n\t\t\tif (!username) {\n\t\t\t\tusername = await LivechatVisitors.getNextVisitorUsername();\n\t\t\t}\n\n\t\t\tlet existingUser = null;\n\n\t\t\tif (visitorEmail !== '' && (existingUser = await LivechatVisitors.findOneGuestByEmailAddress(visitorEmail))) {\n\t\t\t\tcontactId = existingUser._id;\n\t\t\t} else {\n\t\t\t\tconst userData = {\n\t\t\t\t\tusername,\n\t\t\t\t\tts: new Date(),\n\t\t\t\t\ttoken,\n\t\t\t\t};\n\n\t\t\t\tcontactId = (await LivechatVisitors.insertOne(userData)).insertedId;\n\t\t\t}\n\t\t}\n\n\t\tconst allowedCF = await getAllowedCustomFields();\n\t\tconst livechatData: Record<string, string> = validateCustomFields(allowedCF, customFields, { ignoreAdditionalFields: true });\n\n\t\tconst fieldsToRemove = {\n\t\t\t// if field is explicitely set to empty string, remove\n\t\t\t...(phone === '' && { phone: 1 }),\n\t\t\t...(visitorEmail === '' && { visitorEmails: 1 }),\n\t\t\t...(!contactManager?.username && { contactManager: 1 }),\n\t\t};\n\n\t\tconst updateUser: { $set: MatchKeysAndValues<ILivechatVisitor>; $unset?: OnlyFieldsOfType<ILivechatVisitor> } = {\n\t\t\t$set: {\n\t\t\t\ttoken,\n\t\t\t\tname,\n\t\t\t\tlivechatData,\n\t\t\t\t// if phone has some value, set\n\t\t\t\t...(phone && { phone: [{ phoneNumber: phone }] }),\n\t\t\t\t...(visitorEmail && { visitorEmails: [{ address: visitorEmail }] }),\n\t\t\t\t...(contactManager?.username && { contactManager: { username: contactManager.username } }),\n\t\t\t},\n\t\t\t...(Object.keys(fieldsToRemove).length && { $unset: fieldsToRemove }),\n\t\t};\n\n\t\tawait LivechatVisitors.updateOne({ _id: contactId }, updateUser);\n\n\t\tconst extraQuery = await callbacks.run('livechat.applyRoomRestrictions', {});\n\t\tconst rooms: IOmnichannelRoom[] = await LivechatRooms.findByVisitorId(contactId, {}, extraQuery).toArray();\n\n\t\tif (rooms?.length) {\n\t\t\tfor await (const room of rooms) {\n\t\t\t\tconst { _id: rid } = room;\n\n\t\t\t\tconst responses = await Promise.all([\n\t\t\t\t\tRooms.setFnameById(rid, name),\n\t\t\t\t\tLivechatInquiry.setNameByRoomId(rid, name),\n\t\t\t\t\tSubscriptions.updateDisplayNameByRoomId(rid, name),\n\t\t\t\t]);\n\n\t\t\t\tif (responses[0]?.modifiedCount) {\n\t\t\t\t\tvoid notifyOnRoomChangedById(rid);\n\t\t\t\t}\n\n\t\t\t\tif (responses[1]?.modifiedCount) {\n\t\t\t\t\tvoid notifyOnLivechatInquiryChangedByRoom(rid, 'updated', { name });\n\t\t\t\t}\n\n\t\t\t\tif (responses[2]?.modifiedCount) {\n\t\t\t\t\tvoid notifyOnSubscriptionChangedByRoomId(rid);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn contactId;\n\t},\n};\n\nexport function isSingleContactEnabled(): boolean {\n\t// The Single Contact feature is not yet available in production, but can already be partially used in test environments.\n\treturn process.env.TEST_MODE?.toUpperCase() === 'TRUE';\n}\n\nexport async function createContactFromVisitor(visitor: ILivechatVisitor): Promise<string> {\n\tif (visitor.contactId) {\n\t\tthrow new Error('error-contact-already-exists');\n\t}\n\n\tconst contactData: InsertionModel<ILivechatContact> = {\n\t\tname: visitor.name || visitor.username,\n\t\temails: visitor.visitorEmails,\n\t\tphones: visitor.phone || undefined,\n\t\tunknown: true,\n\t\tchannels: [],\n\t\tcustomFields: visitor.livechatData,\n\t\tcreatedAt: new Date(),\n\t};\n\n\tif (visitor.contactManager) {\n\t\tconst contactManagerId = await Users.findOneByUsername<Pick<IUser, '_id'>>(visitor.contactManager.username, { projection: { _id: 1 } });\n\t\tif (contactManagerId) {\n\t\t\tcontactData.contactManager = contactManagerId._id;\n\t\t}\n\t}\n\n\tconst { insertedId: contactId } = await LivechatContacts.insertOne(contactData);\n\n\tawait LivechatVisitors.updateOne({ _id: visitor._id }, { $set: { contactId } });\n\n\treturn contactId;\n}\n\nexport async function createContact(params: CreateContactParams): Promise<string> {\n\tconst { name, emails, phones, customFields: receivedCustomFields = {}, contactManager, channels, unknown } = params;\n\n\tif (contactManager) {\n\t\tawait validateContactManager(contactManager);\n\t}\n\n\tconst allowedCustomFields = await getAllowedCustomFields();\n\tconst customFields = validateCustomFields(allowedCustomFields, receivedCustomFields);\n\n\tconst { insertedId } = await LivechatContacts.insertOne({\n\t\tname,\n\t\temails: emails?.map((address) => ({ address })),\n\t\tphones: phones?.map((phoneNumber) => ({ phoneNumber })),\n\t\tcontactManager,\n\t\tchannels,\n\t\tcustomFields,\n\t\tunknown,\n\t\tcreatedAt: new Date(),\n\t});\n\n\treturn insertedId;\n}\n\nexport async function updateContact(params: UpdateContactParams): Promise<ILivechatContact> {\n\tconst { contactId, name, emails, phones, customFields: receivedCustomFields, contactManager, channels } = params;\n\n\tconst contact = await LivechatContacts.findOneById<Pick<ILivechatContact, '_id'>>(contactId, { projection: { _id: 1 } });\n\n\tif (!contact) {\n\t\tthrow new Error('error-contact-not-found');\n\t}\n\n\tif (contactManager) {\n\t\tawait validateContactManager(contactManager);\n\t}\n\n\tconst customFields = receivedCustomFields && validateCustomFields(await getAllowedCustomFields(), receivedCustomFields);\n\n\tconst updatedContact = await LivechatContacts.updateContact(contactId, {\n\t\tname,\n\t\temails: emails?.map((address) => ({ address })),\n\t\tphones: phones?.map((phoneNumber) => ({ phoneNumber })),\n\t\tcontactManager,\n\t\tchannels,\n\t\tcustomFields,\n\t});\n\n\treturn updatedContact;\n}\n\nexport async function getContacts(params: GetContactsParams): Promise<PaginatedResult<{ contacts: ILivechatContact[] }>> {\n\tconst { searchText, count, offset, sort } = params;\n\n\tconst { cursor, totalCount } = LivechatContacts.findPaginatedContacts(searchText, {\n\t\tlimit: count,\n\t\tskip: offset,\n\t\tsort: sort ?? { name: 1 },\n\t});\n\n\tconst [contacts, total] = await Promise.all([cursor.toArray(), totalCount]);\n\n\treturn {\n\t\tcontacts,\n\t\tcount,\n\t\toffset,\n\t\ttotal,\n\t};\n}\n\nexport async function getContactHistory(\n\tparams: GetContactHistoryParams,\n): Promise<PaginatedResult<{ history: VisitorSearchChatsResult[] }>> {\n\tconst { contactId, source, count, offset, sort } = params;\n\n\tconst contact = await LivechatContacts.findOneById<Pick<ILivechatContact, 'channels'>>(contactId, { projection: { channels: 1 } });\n\n\tif (!contact) {\n\t\tthrow new Error('error-contact-not-found');\n\t}\n\n\tconst visitorsIds = new Set(contact.channels?.map((channel: ILivechatContactChannel) => channel.visitorId));\n\n\tif (!visitorsIds?.size) {\n\t\treturn { history: [], count: 0, offset, total: 0 };\n\t}\n\n\tconst options: FindOptions<IOmnichannelRoom> = {\n\t\tsort: sort || { ts: -1 },\n\t\tskip: offset,\n\t\tlimit: count,\n\t\tprojection: {\n\t\t\tfname: 1,\n\t\t\tts: 1,\n\t\t\tv: 1,\n\t\t\tmsgs: 1,\n\t\t\tservedBy: 1,\n\t\t\tclosedAt: 1,\n\t\t\tclosedBy: 1,\n\t\t\tcloser: 1,\n\t\t\ttags: 1,\n\t\t\tsource: 1,\n\t\t},\n\t};\n\n\tconst { totalCount, cursor } = LivechatRooms.findPaginatedRoomsByVisitorsIdsAndSource({\n\t\tvisitorsIds: Array.from(visitorsIds),\n\t\tsource,\n\t\toptions,\n\t});\n\n\tconst [total, history] = await Promise.all([totalCount, cursor.toArray()]);\n\n\treturn {\n\t\thistory,\n\t\tcount: history.length,\n\t\toffset,\n\t\ttotal,\n\t};\n}\n\nasync function getAllowedCustomFields(): Promise<Pick<ILivechatCustomField, '_id' | 'label' | 'regexp' | 'required'>[]> {\n\treturn LivechatCustomField.findByScope(\n\t\t'visitor',\n\t\t{\n\t\t\tprojection: { _id: 1, label: 1, regexp: 1, required: 1 },\n\t\t},\n\t\tfalse,\n\t).toArray();\n}\n\nexport function validateCustomFields(\n\tallowedCustomFields: AtLeast<ILivechatCustomField, '_id' | 'label' | 'regexp' | 'required'>[],\n\tcustomFields: Record<string, string | unknown>,\n\toptions?: { ignoreAdditionalFields?: boolean },\n): Record<string, string> {\n\tconst validValues: Record<string, string> = {};\n\n\tfor (const cf of allowedCustomFields) {\n\t\tif (!customFields.hasOwnProperty(cf._id)) {\n\t\t\tif (cf.required) {\n\t\t\t\tthrow new Error(i18n.t('error-invalid-custom-field-value', { field: cf.label }));\n\t\t\t}\n\t\t\tcontinue;\n\t\t}\n\t\tconst cfValue: string = trim(customFields[cf._id]);\n\n\t\tif (!cfValue || typeof cfValue !== 'string') {\n\t\t\tif (cf.required) {\n\t\t\t\tthrow new Error(i18n.t('error-invalid-custom-field-value', { field: cf.label }));\n\t\t\t}\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (cf.regexp) {\n\t\t\tconst regex = new RegExp(cf.regexp);\n\t\t\tif (!regex.test(cfValue)) {\n\t\t\t\tthrow new Error(i18n.t('error-invalid-custom-field-value', { field: cf.label }));\n\t\t\t}\n\t\t}\n\n\t\tvalidValues[cf._id] = cfValue;\n\t}\n\n\tif (!options?.ignoreAdditionalFields) {\n\t\tconst allowedCustomFieldIds = new Set(allowedCustomFields.map((cf) => cf._id));\n\t\tfor (const key in customFields) {\n\t\t\tif (!allowedCustomFieldIds.has(key)) {\n\t\t\t\tthrow new Error(i18n.t('error-custom-field-not-allowed', { key }));\n\t\t\t}\n\t\t}\n\t}\n\n\treturn validValues;\n}\n\nexport async function validateContactManager(contactManagerUserId: string) {\n\tconst contactManagerUser = await Users.findOneAgentById<Pick<IUser, '_id'>>(contactManagerUserId, { projection: { _id: 1 } });\n\tif (!contactManagerUser) {\n\t\tthrow new Error('error-contact-manager-not-found');\n\t}\n}\n"],"names":["Contacts","createContact","createContactFromVisitor","getContactHistory","getContacts","isSingleContactEnabled","updateContact","validateContactManager","validateCustomFields","registerContact","token","name","email","phone","username","customFields","contactManager","check","String","visitorEmail","trim","toLowerCase","user","Users","findOneByUsername","projection","roles","Meteor","Error","Array","isArray","includes","contactId","LivechatVisitors","getVisitorByToken","_id","getNextVisitorUsername","existingUser","findOneGuestByEmailAddress","userData","ts","Date","insertOne","insertedId","allowedCF","getAllowedCustomFields","livechatData","ignoreAdditionalFields","fieldsToRemove","visitorEmails","updateUser","$set","phoneNumber","address","Object","keys","length","$unset","updateOne","extraQuery","callbacks","run","rooms","LivechatRooms","findByVisitorId","toArray","room","responses","rid","Promise","all","Rooms","setFnameById","LivechatInquiry","setNameByRoomId","Subscriptions","updateDisplayNameByRoomId","modifiedCount","notifyOnRoomChangedById","notifyOnLivechatInquiryChangedByRoom","notifyOnSubscriptionChangedByRoomId","process","env","TEST_MODE","toUpperCase","visitor","contactData","emails","phones","undefined","unknown","channels","createdAt","contactManagerId","LivechatContacts","params","receivedCustomFields","allowedCustomFields","map","contact","findOneById","updatedContact","searchText","count","offset","sort","cursor","totalCount","findPaginatedContacts","limit","skip","contacts","total","source","visitorsIds","Set","channel","visitorId","size","history","options","fname","v","msgs","servedBy","closedAt","closedBy","closer","tags","findPaginatedRoomsByVisitorsIdsAndSource","from","LivechatCustomField","findByScope","label","regexp","required","validValues","cf","hasOwnProperty","i18n","t","field","cfValue","regex","RegExp","test","allowedCustomFieldIds","key","has","contactManagerUserId","contactManagerUser","findOneAgentById"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/Contacts.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"180d95d5a8d99e203f6b31166c3cd00fa23a12d8","contentHash":"906903e2cab62e0b50e2d0c7061c2001821e6d6f8dea3de99abf11951500d1d6"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/stringUtils.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/stringUtils.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":48,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":26}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":21}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":21}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":28}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":19}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":21}},"10":{"start":{"line":31,"column":8},"end":{"line":31,"column":23}},"11":{"start":{"line":34,"column":8},"end":{"line":34,"column":24}},"12":{"start":{"line":37,"column":8},"end":{"line":37,"column":28}},"13":{"start":{"line":40,"column":8},"end":{"line":40,"column":25}},"14":{"start":{"line":43,"column":8},"end":{"line":43,"column":20}},"15":{"start":{"line":46,"column":8},"end":{"line":46,"column":24}},"16":{"start":{"line":49,"column":23},"end":{"line":49,"column":61}},"17":{"start":{"line":50,"column":19},"end":{"line":50,"column":39}},"18":{"start":{"line":52,"column":4},"end":{"line":52,"column":72}},"19":{"start":{"line":55,"column":4},"end":{"line":55,"column":27}},"20":{"start":{"line":55,"column":17},"end":{"line":55,"column":27}},"21":{"start":{"line":56,"column":4},"end":{"line":56,"column":26}},"22":{"start":{"line":59,"column":4},"end":{"line":59,"column":34}},"23":{"start":{"line":59,"column":21},"end":{"line":59,"column":34}},"24":{"start":{"line":60,"column":4},"end":{"line":60,"column":91}},"25":{"start":{"line":60,"column":66},"end":{"line":60,"column":91}},"26":{"start":{"line":61,"column":4},"end":{"line":61,"column":75}},"27":{"start":{"line":63,"column":19},"end":{"line":63,"column":40}},"28":{"start":{"line":64,"column":23},"end":{"line":64,"column":48}},"29":{"start":{"line":65,"column":24},"end":{"line":65,"column":50}},"30":{"start":{"line":67,"column":16},"end":{"line":67,"column":32}},"31":{"start":{"line":68,"column":4},"end":{"line":68,"column":64}},"32":{"start":{"line":68,"column":36},"end":{"line":68,"column":64}},"33":{"start":{"line":69,"column":23},"end":{"line":69,"column":55}},"34":{"start":{"line":70,"column":4},"end":{"line":70,"column":79}},"35":{"start":{"line":73,"column":16},"end":{"line":73,"column":32}},"36":{"start":{"line":74,"column":4},"end":{"line":74,"column":72}},"37":{"start":{"line":74,"column":40},"end":{"line":74,"column":72}},"38":{"start":{"line":75,"column":23},"end":{"line":75,"column":55}},"39":{"start":{"line":76,"column":4},"end":{"line":76,"column":58}},"40":{"start":{"line":79,"column":16},"end":{"line":79,"column":32}},"41":{"start":{"line":80,"column":4},"end":{"line":80,"column":74}},"42":{"start":{"line":80,"column":41},"end":{"line":80,"column":74}},"43":{"start":{"line":81,"column":23},"end":{"line":81,"column":55}},"44":{"start":{"line":82,"column":4},"end":{"line":82,"column":58}},"45":{"start":{"line":85,"column":16},"end":{"line":85,"column":32}},"46":{"start":{"line":86,"column":27},"end":{"line":86,"column":85}},"47":{"start":{"line":87,"column":4},"end":{"line":87,"column":56}},"48":{"start":{"line":90,"column":4},"end":{"line":90,"column":80}},"49":{"start":{"line":93,"column":16},"end":{"line":93,"column":32}},"50":{"start":{"line":94,"column":16},"end":{"line":94,"column":32}},"51":{"start":{"line":95,"column":16},"end":{"line":95,"column":44}},"52":{"start":{"line":96,"column":4},"end":{"line":96,"column":42}},"53":{"start":{"line":99,"column":16},"end":{"line":99,"column":32}},"54":{"start":{"line":100,"column":16},"end":{"line":100,"column":32}},"55":{"start":{"line":101,"column":16},"end":{"line":101,"column":44}},"56":{"start":{"line":102,"column":4},"end":{"line":102,"column":64}},"57":{"start":{"line":105,"column":16},"end":{"line":105,"column":32}},"58":{"start":{"line":106,"column":16},"end":{"line":106,"column":32}},"59":{"start":{"line":107,"column":16},"end":{"line":107,"column":48}},"60":{"start":{"line":108,"column":4},"end":{"line":108,"column":64}},"61":{"start":{"line":111,"column":4},"end":{"line":111,"column":79}},"62":{"start":{"line":111,"column":69},"end":{"line":111,"column":79}},"63":{"start":{"line":112,"column":19},"end":{"line":112,"column":41}},"64":{"start":{"line":113,"column":4},"end":{"line":113,"column":49}},"65":{"start":{"line":114,"column":18},"end":{"line":114,"column":35}},"66":{"start":{"line":115,"column":18},"end":{"line":115,"column":26}},"67":{"start":{"line":116,"column":21},"end":{"line":116,"column":61}},"68":{"start":{"line":117,"column":4},"end":{"line":117,"column":73}},"69":{"start":{"line":120,"column":16},"end":{"line":120,"column":32}},"70":{"start":{"line":121,"column":19},"end":{"line":121,"column":28}},"71":{"start":{"line":122,"column":17},"end":{"line":122,"column":18}},"72":{"start":{"line":123,"column":4},"end":{"line":124,"column":58}},"73":{"start":{"line":123,"column":17},"end":{"line":123,"column":30}},"74":{"start":{"line":124,"column":9},"end":{"line":124,"column":58}},"75":{"start":{"line":124,"column":32},"end":{"line":124,"column":58}},"76":{"start":{"line":125,"column":4},"end":{"line":135,"column":5}},"77":{"start":{"line":127,"column":12},"end":{"line":127,"column":41}},"78":{"start":{"line":128,"column":12},"end":{"line":128,"column":47}},"79":{"start":{"line":130,"column":12},"end":{"line":130,"column":41}},"80":{"start":{"line":131,"column":12},"end":{"line":131,"column":102}},"81":{"start":{"line":133,"column":12},"end":{"line":133,"column":41}},"82":{"start":{"line":134,"column":12},"end":{"line":134,"column":47}},"83":{"start":{"line":138,"column":4},"end":{"line":138,"column":44}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":16},"end":{"line":12,"column":17}},"loc":{"start":{"line":12,"column":27},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":11},"end":{"line":15,"column":12}},"loc":{"start":{"line":15,"column":22},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":11},"end":{"line":18,"column":12}},"loc":{"start":{"line":18,"column":22},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":18},"end":{"line":21,"column":19}},"loc":{"start":{"line":21,"column":29},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":9},"end":{"line":24,"column":10}},"loc":{"start":{"line":24,"column":20},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":11},"end":{"line":27,"column":12}},"loc":{"start":{"line":27,"column":22},"end":{"line":29,"column":5}},"line":27},"7":{"name":"(anonymous_7)","decl":{"start":{"line":30,"column":13},"end":{"line":30,"column":14}},"loc":{"start":{"line":30,"column":24},"end":{"line":32,"column":5}},"line":30},"8":{"name":"(anonymous_8)","decl":{"start":{"line":33,"column":14},"end":{"line":33,"column":15}},"loc":{"start":{"line":33,"column":25},"end":{"line":35,"column":5}},"line":33},"9":{"name":"(anonymous_9)","decl":{"start":{"line":36,"column":18},"end":{"line":36,"column":19}},"loc":{"start":{"line":36,"column":29},"end":{"line":38,"column":5}},"line":36},"10":{"name":"(anonymous_10)","decl":{"start":{"line":39,"column":15},"end":{"line":39,"column":16}},"loc":{"start":{"line":39,"column":26},"end":{"line":41,"column":5}},"line":39},"11":{"name":"(anonymous_11)","decl":{"start":{"line":42,"column":10},"end":{"line":42,"column":11}},"loc":{"start":{"line":42,"column":21},"end":{"line":44,"column":5}},"line":42},"12":{"name":"(anonymous_12)","decl":{"start":{"line":45,"column":14},"end":{"line":45,"column":15}},"loc":{"start":{"line":45,"column":25},"end":{"line":47,"column":5}},"line":45},"13":{"name":"truncate","decl":{"start":{"line":51,"column":9},"end":{"line":51,"column":17}},"loc":{"start":{"line":51,"column":31},"end":{"line":53,"column":1}},"line":51},"14":{"name":"makeString","decl":{"start":{"line":54,"column":9},"end":{"line":54,"column":19}},"loc":{"start":{"line":54,"column":28},"end":{"line":57,"column":1}},"line":54},"15":{"name":"defaultToWhiteSpace","decl":{"start":{"line":58,"column":9},"end":{"line":58,"column":28}},"loc":{"start":{"line":58,"column":41},"end":{"line":62,"column":1}},"line":58},"16":{"name":"trim","decl":{"start":{"line":66,"column":9},"end":{"line":66,"column":13}},"loc":{"start":{"line":66,"column":33},"end":{"line":71,"column":1}},"line":66},"17":{"name":"ltrim","decl":{"start":{"line":72,"column":9},"end":{"line":72,"column":14}},"loc":{"start":{"line":72,"column":34},"end":{"line":77,"column":1}},"line":72},"18":{"name":"rtrim","decl":{"start":{"line":78,"column":9},"end":{"line":78,"column":14}},"loc":{"start":{"line":78,"column":34},"end":{"line":83,"column":1}},"line":78},"19":{"name":"capitalize","decl":{"start":{"line":84,"column":9},"end":{"line":84,"column":19}},"loc":{"start":{"line":84,"column":41},"end":{"line":88,"column":1}},"line":84},"20":{"name":"stripTags","decl":{"start":{"line":89,"column":9},"end":{"line":89,"column":18}},"loc":{"start":{"line":89,"column":24},"end":{"line":91,"column":1}},"line":89},"21":{"name":"strLeft","decl":{"start":{"line":92,"column":9},"end":{"line":92,"column":16}},"loc":{"start":{"line":92,"column":29},"end":{"line":97,"column":1}},"line":92},"22":{"name":"strRight","decl":{"start":{"line":98,"column":9},"end":{"line":98,"column":17}},"loc":{"start":{"line":98,"column":30},"end":{"line":103,"column":1}},"line":98},"23":{"name":"strRightBack","decl":{"start":{"line":104,"column":9},"end":{"line":104,"column":21}},"loc":{"start":{"line":104,"column":34},"end":{"line":109,"column":1}},"line":104},"24":{"name":"numberFormat","decl":{"start":{"line":110,"column":9},"end":{"line":110,"column":21}},"loc":{"start":{"line":110,"column":48},"end":{"line":118,"column":1}},"line":110},"25":{"name":"pad","decl":{"start":{"line":119,"column":9},"end":{"line":119,"column":12}},"loc":{"start":{"line":119,"column":52},"end":{"line":136,"column":1}},"line":119},"26":{"name":"lrpad","decl":{"start":{"line":137,"column":9},"end":{"line":137,"column":14}},"loc":{"start":{"line":137,"column":36},"end":{"line":139,"column":1}},"line":137}},"branchMap":{"0":{"loc":{"start":{"line":52,"column":11},"end":{"line":52,"column":71}},"type":"cond-expr","locations":[{"start":{"line":52,"column":33},"end":{"line":52,"column":65}},{"start":{"line":52,"column":68},"end":{"line":52,"column":71}}],"line":52},"1":{"loc":{"start":{"line":55,"column":4},"end":{"line":55,"column":27}},"type":"if","locations":[{"start":{"line":55,"column":4},"end":{"line":55,"column":27}},{"start":{"line":55,"column":4},"end":{"line":55,"column":27}}],"line":55},"2":{"loc":{"start":{"line":59,"column":4},"end":{"line":59,"column":34}},"type":"if","locations":[{"start":{"line":59,"column":4},"end":{"line":59,"column":34}},{"start":{"line":59,"column":4},"end":{"line":59,"column":34}}],"line":59},"3":{"loc":{"start":{"line":60,"column":4},"end":{"line":60,"column":91}},"type":"if","locations":[{"start":{"line":60,"column":4},"end":{"line":60,"column":91}},{"start":{"line":60,"column":4},"end":{"line":60,"column":91}}],"line":60},"4":{"loc":{"start":{"line":60,"column":8},"end":{"line":60,"column":64}},"type":"binary-expr","locations":[{"start":{"line":60,"column":8},"end":{"line":60,"column":38}},{"start":{"line":60,"column":42},"end":{"line":60,"column":64}}],"line":60},"5":{"loc":{"start":{"line":68,"column":4},"end":{"line":68,"column":64}},"type":"if","locations":[{"start":{"line":68,"column":4},"end":{"line":68,"column":64}},{"start":{"line":68,"column":4},"end":{"line":68,"column":64}}],"line":68},"6":{"loc":{"start":{"line":68,"column":8},"end":{"line":68,"column":34}},"type":"binary-expr","locations":[{"start":{"line":68,"column":8},"end":{"line":68,"column":20}},{"start":{"line":68,"column":24},"end":{"line":68,"column":34}}],"line":68},"7":{"loc":{"start":{"line":74,"column":4},"end":{"line":74,"column":72}},"type":"if","locations":[{"start":{"line":74,"column":4},"end":{"line":74,"column":72}},{"start":{"line":74,"column":4},"end":{"line":74,"column":72}}],"line":74},"8":{"loc":{"start":{"line":74,"column":8},"end":{"line":74,"column":38}},"type":"binary-expr","locations":[{"start":{"line":74,"column":8},"end":{"line":74,"column":20}},{"start":{"line":74,"column":24},"end":{"line":74,"column":38}}],"line":74},"9":{"loc":{"start":{"line":80,"column":4},"end":{"line":80,"column":74}},"type":"if","locations":[{"start":{"line":80,"column":4},"end":{"line":80,"column":74}},{"start":{"line":80,"column":4},"end":{"line":80,"column":74}}],"line":80},"10":{"loc":{"start":{"line":80,"column":8},"end":{"line":80,"column":39}},"type":"binary-expr","locations":[{"start":{"line":80,"column":8},"end":{"line":80,"column":20}},{"start":{"line":80,"column":24},"end":{"line":80,"column":39}}],"line":80},"11":{"loc":{"start":{"line":86,"column":27},"end":{"line":86,"column":85}},"type":"cond-expr","locations":[{"start":{"line":86,"column":44},"end":{"line":86,"column":56}},{"start":{"line":86,"column":59},"end":{"line":86,"column":85}}],"line":86},"12":{"loc":{"start":{"line":95,"column":16},"end":{"line":95,"column":44}},"type":"cond-expr","locations":[{"start":{"line":95,"column":23},"end":{"line":95,"column":25}},{"start":{"line":95,"column":28},"end":{"line":95,"column":44}}],"line":95},"13":{"loc":{"start":{"line":96,"column":11},"end":{"line":96,"column":41}},"type":"cond-expr","locations":[{"start":{"line":96,"column":18},"end":{"line":96,"column":35}},{"start":{"line":96,"column":38},"end":{"line":96,"column":41}}],"line":96},"14":{"loc":{"start":{"line":101,"column":16},"end":{"line":101,"column":44}},"type":"cond-expr","locations":[{"start":{"line":101,"column":23},"end":{"line":101,"column":25}},{"start":{"line":101,"column":28},"end":{"line":101,"column":44}}],"line":101},"15":{"loc":{"start":{"line":102,"column":11},"end":{"line":102,"column":63}},"type":"cond-expr","locations":[{"start":{"line":102,"column":18},"end":{"line":102,"column":57}},{"start":{"line":102,"column":60},"end":{"line":102,"column":63}}],"line":102},"16":{"loc":{"start":{"line":107,"column":16},"end":{"line":107,"column":48}},"type":"cond-expr","locations":[{"start":{"line":107,"column":23},"end":{"line":107,"column":25}},{"start":{"line":107,"column":28},"end":{"line":107,"column":48}}],"line":107},"17":{"loc":{"start":{"line":108,"column":11},"end":{"line":108,"column":63}},"type":"cond-expr","locations":[{"start":{"line":108,"column":18},"end":{"line":108,"column":57}},{"start":{"line":108,"column":60},"end":{"line":108,"column":63}}],"line":108},"18":{"loc":{"start":{"line":111,"column":4},"end":{"line":111,"column":79}},"type":"if","locations":[{"start":{"line":111,"column":4},"end":{"line":111,"column":79}},{"start":{"line":111,"column":4},"end":{"line":111,"column":79}}],"line":111},"19":{"loc":{"start":{"line":111,"column":8},"end":{"line":111,"column":67}},"type":"binary-expr","locations":[{"start":{"line":111,"column":8},"end":{"line":111,"column":22}},{"start":{"line":111,"column":26},"end":{"line":111,"column":42}},{"start":{"line":111,"column":46},"end":{"line":111,"column":67}}],"line":111},"20":{"loc":{"start":{"line":113,"column":11},"end":{"line":113,"column":48}},"type":"cond-expr","locations":[{"start":{"line":113,"column":38},"end":{"line":113,"column":42}},{"start":{"line":113,"column":45},"end":{"line":113,"column":48}}],"line":113},"21":{"loc":{"start":{"line":116,"column":21},"end":{"line":116,"column":61}},"type":"cond-expr","locations":[{"start":{"line":116,"column":32},"end":{"line":116,"column":56}},{"start":{"line":116,"column":59},"end":{"line":116,"column":61}}],"line":116},"22":{"loc":{"start":{"line":116,"column":33},"end":{"line":116,"column":44}},"type":"binary-expr","locations":[{"start":{"line":116,"column":33},"end":{"line":116,"column":37}},{"start":{"line":116,"column":41},"end":{"line":116,"column":44}}],"line":116},"23":{"loc":{"start":{"line":119,"column":36},"end":{"line":119,"column":50}},"type":"default-arg","locations":[{"start":{"line":119,"column":43},"end":{"line":119,"column":50}}],"line":119},"24":{"loc":{"start":{"line":123,"column":4},"end":{"line":124,"column":58}},"type":"if","locations":[{"start":{"line":123,"column":4},"end":{"line":124,"column":58}},{"start":{"line":123,"column":4},"end":{"line":124,"column":58}}],"line":123},"25":{"loc":{"start":{"line":124,"column":9},"end":{"line":124,"column":58}},"type":"if","locations":[{"start":{"line":124,"column":9},"end":{"line":124,"column":58}},{"start":{"line":124,"column":9},"end":{"line":124,"column":58}}],"line":124},"26":{"loc":{"start":{"line":125,"column":4},"end":{"line":135,"column":5}},"type":"switch","locations":[{"start":{"line":126,"column":8},"end":{"line":128,"column":47}},{"start":{"line":129,"column":8},"end":{"line":131,"column":102}},{"start":{"line":132,"column":8},"end":{"line":134,"column":47}}],"line":125}},"s":{"0":2,"1":2,"2":24,"3":2,"4":0,"5":0,"6":451,"7":0,"8":0,"9":1305,"10":0,"11":0,"12":0,"13":0,"14":1487,"15":4,"16":2,"17":2,"18":4,"19":4999,"20":1029,"21":3970,"22":1756,"23":0,"24":1756,"25":0,"26":1756,"27":2,"28":2,"29":2,"30":1487,"31":1487,"32":1487,"33":0,"34":0,"35":451,"36":451,"37":0,"38":451,"39":451,"40":1305,"41":1305,"42":0,"43":1305,"44":1305,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0},"f":{"0":2,"1":0,"2":0,"3":451,"4":0,"5":0,"6":1305,"7":0,"8":0,"9":0,"10":0,"11":1487,"12":4,"13":4,"14":4999,"15":1756,"16":1487,"17":451,"18":1305,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0},"b":{"0":[1,3],"1":[1029,3970],"2":[0,1756],"3":[0,1756],"4":[1756,0],"5":[1487,0],"6":[1487,1487],"7":[0,451],"8":[451,0],"9":[0,1305],"10":[1305,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0],"24":[0,0],"25":[0,0],"26":[0,0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/stringUtils.ts"],"sourcesContent":["import { escapeRegExp } from '@rocket.chat/string-helpers';\nimport { sanitize } from 'dompurify';\n\nexport function truncate(str: string, length: number): string {\n\treturn str.length > length ? `${str.slice(0, length - 3)}...` : str;\n}\n\nfunction makeString(object: unknown): string {\n\tif (!object) return '';\n\treturn String(object);\n}\n\nfunction defaultToWhiteSpace(characters: unknown): string {\n\tif (!characters) return '\\\\s';\n\tif (typeof characters === 'object' && 'source' in characters) return (characters as { source: string }).source;\n\treturn `[${escapeRegExp(makeString(characters))}]`;\n}\n\nconst nativeTrim = String.prototype.trim;\nconst nativeTrimLeft = String.prototype.trimLeft;\nconst nativeTrimRight = String.prototype.trimRight;\n\nexport function trim(_str: unknown, _characters?: unknown): string {\n\tconst str = makeString(_str);\n\tif (!_characters && nativeTrim) return nativeTrim.call(str);\n\tconst characters = defaultToWhiteSpace(_characters);\n\treturn str.replace(new RegExp(`^${characters}+|${characters}+$`, 'g'), '');\n}\n\nexport function ltrim(_str: unknown, _characters: unknown): string {\n\tconst str = makeString(_str);\n\tif (!_characters && nativeTrimLeft) return nativeTrimLeft.call(str);\n\tconst characters = defaultToWhiteSpace(_characters);\n\treturn str.replace(new RegExp(`^${characters}+`), '');\n}\n\nexport function rtrim(_str: unknown, _characters: unknown): string {\n\tconst str = makeString(_str);\n\tif (!_characters && nativeTrimRight) return nativeTrimRight.call(str);\n\tconst characters = defaultToWhiteSpace(_characters);\n\treturn str.replace(new RegExp(`${characters}+$`), '');\n}\n\nexport function capitalize(_str: unknown, lowercaseRest: boolean): string {\n\tconst str = makeString(_str);\n\tconst remainingChars = !lowercaseRest ? str.slice(1) : str.slice(1).toLowerCase();\n\n\treturn str.charAt(0).toUpperCase() + remainingChars;\n}\n\nexport function stripTags(str: unknown): string {\n\treturn sanitize(makeString(str)).replace(/<\\/?[^>]+>/g, '');\n}\n\nexport function strLeft(_str: unknown, _sep: unknown): string {\n\tconst str = makeString(_str);\n\tconst sep = makeString(_sep);\n\tconst pos = !sep ? -1 : str.indexOf(sep);\n\treturn ~pos ? str.slice(0, pos) : str;\n}\n\nexport function strRight(_str: unknown, _sep: unknown): string {\n\tconst str = makeString(_str);\n\tconst sep = makeString(_sep);\n\tconst pos = !sep ? -1 : str.indexOf(sep);\n\treturn ~pos ? str.slice(pos + sep.length, str.length) : str;\n}\n\nexport function strRightBack(_str: unknown, _sep: unknown): string {\n\tconst str = makeString(_str);\n\tconst sep = makeString(_sep);\n\tconst pos = !sep ? -1 : str.lastIndexOf(sep);\n\treturn ~pos ? str.slice(pos + sep.length, str.length) : str;\n}\n\nexport function numberFormat(_number: number, dec: number, dsep?: string, tsep?: string): string {\n\tif (isNaN(_number) || _number === null || _number === undefined) return '';\n\n\tconst number = _number.toFixed(~~dec);\n\ttsep = typeof tsep === 'string' ? tsep : ',';\n\n\tconst parts = number.split('.');\n\tconst fnums = parts[0];\n\tconst decimals = parts[1] ? (dsep || '.') + parts[1] : '';\n\n\treturn fnums.replace(/(\\d)(?=(?:\\d{3})+$)/g, `$1${tsep}`) + decimals;\n}\n\nexport function pad(_str: unknown, _length: number, padStr?: string, type: 'right' | 'left' | 'both' = 'right') {\n\tconst str = makeString(_str);\n\tconst length = ~~_length;\n\n\tlet padlen = 0;\n\n\tif (!padStr) padStr = ' ';\n\telse if (padStr.length > 1) padStr = padStr.charAt(0);\n\n\tswitch (type) {\n\t\tcase 'right':\n\t\t\tpadlen = length - str.length;\n\t\t\treturn str + padStr.repeat(padlen);\n\t\tcase 'both':\n\t\t\tpadlen = length - str.length;\n\t\t\treturn padStr.repeat(Math.ceil(padlen / 2)) + str + padStr.repeat(Math.floor(padlen / 2));\n\t\tdefault: // 'left'\n\t\t\tpadlen = length - str.length;\n\t\t\treturn padStr.repeat(padlen) + str;\n\t}\n}\n\nexport function lrpad(str: unknown, length: number, padStr?: string): string {\n\treturn pad(str, length, padStr, 'both');\n}\n"],"names":["capitalize","lrpad","ltrim","numberFormat","pad","rtrim","strLeft","strRight","strRightBack","stripTags","trim","truncate","str","length","slice","makeString","object","String","defaultToWhiteSpace","characters","source","escapeRegExp","nativeTrim","prototype","nativeTrimLeft","trimLeft","nativeTrimRight","trimRight","_str","_characters","call","replace","RegExp","lowercaseRest","remainingChars","toLowerCase","charAt","toUpperCase","sanitize","_sep","sep","pos","indexOf","lastIndexOf","_number","dec","dsep","tsep","isNaN","undefined","number","toFixed","parts","split","fnums","decimals","_length","padStr","type","padlen","repeat","Math","ceil","floor"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/stringUtils.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"50d65b5a41ee0d35a188b66e4aa8f4afaa2d6a0f","contentHash":"b94e3ab15775244d2211f5e82158187da8589747b9b59c1e2babd78bed82c47e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/i18n.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/i18n.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":36,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":31}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":39}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":46}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":43}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":38}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":44}},"10":{"start":{"line":31,"column":8},"end":{"line":31,"column":20}},"11":{"start":{"line":34,"column":8},"end":{"line":34,"column":17}},"12":{"start":{"line":37,"column":31},"end":{"line":37,"column":75}},"13":{"start":{"line":38,"column":51},"end":{"line":38,"column":117}},"14":{"start":{"line":39,"column":18},"end":{"line":39,"column":56}},"15":{"start":{"line":41,"column":4},"end":{"line":43,"column":6}},"16":{"start":{"line":45,"column":13},"end":{"line":45,"column":71}},"17":{"start":{"line":46,"column":24},"end":{"line":59,"column":1}},"18":{"start":{"line":47,"column":4},"end":{"line":58,"column":6}},"19":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"20":{"start":{"line":49,"column":12},"end":{"line":49,"column":26}},"21":{"start":{"line":51,"column":8},"end":{"line":53,"column":9}},"22":{"start":{"line":52,"column":12},"end":{"line":52,"column":39}},"23":{"start":{"line":54,"column":8},"end":{"line":57,"column":11}},"24":{"start":{"line":60,"column":10},"end":{"line":60,"column":44}},"25":{"start":{"line":61,"column":37},"end":{"line":76,"column":1}},"26":{"start":{"line":62,"column":19},"end":{"line":68,"column":5}},"27":{"start":{"line":69,"column":4},"end":{"line":74,"column":5}},"28":{"start":{"line":70,"column":23},"end":{"line":70,"column":104}},"29":{"start":{"line":70,"column":72},"end":{"line":70,"column":103}},"30":{"start":{"line":71,"column":36},"end":{"line":71,"column":79}},"31":{"start":{"line":72,"column":19},"end":{"line":72,"column":94}},"32":{"start":{"line":73,"column":8},"end":{"line":73,"column":48}},"33":{"start":{"line":75,"column":4},"end":{"line":75,"column":18}},"34":{"start":{"line":77,"column":31},"end":{"line":83,"column":1}},"35":{"start":{"line":78,"column":16},"end":{"line":78,"column":52}},"36":{"start":{"line":79,"column":4},"end":{"line":82,"column":34}},"37":{"start":{"line":79,"column":79},"end":{"line":82,"column":9}},"38":{"start":{"line":84,"column":22},"end":{"line":90,"column":1}},"39":{"start":{"line":91,"column":39},"end":{"line":91,"column":65}},"40":{"start":{"line":92,"column":36},"end":{"line":92,"column":42}},"41":{"start":{"line":93,"column":32},"end":{"line":110,"column":1}},"42":{"start":{"line":94,"column":4},"end":{"line":109,"column":5}},"43":{"start":{"line":95,"column":8},"end":{"line":97,"column":9}},"44":{"start":{"line":96,"column":12},"end":{"line":96,"column":21}},"45":{"start":{"line":98,"column":8},"end":{"line":108,"column":9}},"46":{"start":{"line":99,"column":27},"end":{"line":99,"column":108}},"47":{"start":{"line":99,"column":76},"end":{"line":99,"column":107}},"48":{"start":{"line":100,"column":40},"end":{"line":100,"column":83}},"49":{"start":{"line":101,"column":23},"end":{"line":101,"column":98}},"50":{"start":{"line":102,"column":12},"end":{"line":104,"column":13}},"51":{"start":{"line":103,"column":16},"end":{"line":103,"column":25}},"52":{"start":{"line":105,"column":12},"end":{"line":107,"column":27}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":21},"end":{"line":12,"column":22}},"loc":{"start":{"line":12,"column":32},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":29},"end":{"line":15,"column":30}},"loc":{"start":{"line":15,"column":40},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":36},"end":{"line":18,"column":37}},"loc":{"start":{"line":18,"column":47},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":33},"end":{"line":21,"column":34}},"loc":{"start":{"line":21,"column":44},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":28},"end":{"line":24,"column":29}},"loc":{"start":{"line":24,"column":39},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":34},"end":{"line":27,"column":35}},"loc":{"start":{"line":27,"column":45},"end":{"line":29,"column":5}},"line":27},"7":{"name":"(anonymous_7)","decl":{"start":{"line":30,"column":10},"end":{"line":30,"column":11}},"loc":{"start":{"line":30,"column":21},"end":{"line":32,"column":5}},"line":30},"8":{"name":"(anonymous_8)","decl":{"start":{"line":33,"column":7},"end":{"line":33,"column":8}},"loc":{"start":{"line":33,"column":18},"end":{"line":35,"column":5}},"line":33},"9":{"name":"_interop_require_default","decl":{"start":{"line":40,"column":9},"end":{"line":40,"column":33}},"loc":{"start":{"line":40,"column":39},"end":{"line":44,"column":1}},"line":40},"10":{"name":"(anonymous_10)","decl":{"start":{"line":46,"column":24},"end":{"line":46,"column":25}},"loc":{"start":{"line":46,"column":36},"end":{"line":59,"column":1}},"line":46},"11":{"name":"(anonymous_11)","decl":{"start":{"line":47,"column":11},"end":{"line":47,"column":12}},"loc":{"start":{"line":47,"column":38},"end":{"line":58,"column":5}},"line":47},"12":{"name":"(anonymous_12)","decl":{"start":{"line":61,"column":37},"end":{"line":61,"column":38}},"loc":{"start":{"line":61,"column":47},"end":{"line":76,"column":1}},"line":61},"13":{"name":"(anonymous_13)","decl":{"start":{"line":70,"column":59},"end":{"line":70,"column":60}},"loc":{"start":{"line":70,"column":72},"end":{"line":70,"column":103}},"line":70},"14":{"name":"(anonymous_14)","decl":{"start":{"line":77,"column":31},"end":{"line":77,"column":32}},"loc":{"start":{"line":77,"column":58},"end":{"line":83,"column":1}},"line":77},"15":{"name":"(anonymous_15)","decl":{"start":{"line":79,"column":57},"end":{"line":79,"column":58}},"loc":{"start":{"line":79,"column":79},"end":{"line":82,"column":9}},"line":79},"16":{"name":"(anonymous_16)","decl":{"start":{"line":93,"column":32},"end":{"line":93,"column":33}},"loc":{"start":{"line":93,"column":98},"end":{"line":110,"column":1}},"line":93},"17":{"name":"(anonymous_17)","decl":{"start":{"line":99,"column":63},"end":{"line":99,"column":64}},"loc":{"start":{"line":99,"column":76},"end":{"line":99,"column":107}},"line":99}},"branchMap":{"0":{"loc":{"start":{"line":41,"column":11},"end":{"line":43,"column":5}},"type":"cond-expr","locations":[{"start":{"line":41,"column":35},"end":{"line":41,"column":38}},{"start":{"line":41,"column":41},"end":{"line":43,"column":5}}],"line":41},"1":{"loc":{"start":{"line":41,"column":11},"end":{"line":41,"column":32}},"type":"binary-expr","locations":[{"start":{"line":41,"column":11},"end":{"line":41,"column":14}},{"start":{"line":41,"column":18},"end":{"line":41,"column":32}}],"line":41},"2":{"loc":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"type":"if","locations":[{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},{"start":{"line":48,"column":8},"end":{"line":50,"column":9}}],"line":48},"3":{"loc":{"start":{"line":51,"column":8},"end":{"line":53,"column":9}},"type":"if","locations":[{"start":{"line":51,"column":8},"end":{"line":53,"column":9}},{"start":{"line":51,"column":8},"end":{"line":53,"column":9}}],"line":51},"4":{"loc":{"start":{"line":51,"column":12},"end":{"line":51,"column":79}},"type":"binary-expr","locations":[{"start":{"line":51,"column":12},"end":{"line":51,"column":48}},{"start":{"line":51,"column":52},"end":{"line":51,"column":79}}],"line":51},"5":{"loc":{"start":{"line":71,"column":36},"end":{"line":71,"column":79}},"type":"cond-expr","locations":[{"start":{"line":71,"column":45},"end":{"line":71,"column":73}},{"start":{"line":71,"column":76},"end":{"line":71,"column":79}}],"line":71},"6":{"loc":{"start":{"line":72,"column":19},"end":{"line":72,"column":94}},"type":"cond-expr","locations":[{"start":{"line":72,"column":58},"end":{"line":72,"column":64}},{"start":{"line":72,"column":67},"end":{"line":72,"column":94}}],"line":72},"7":{"loc":{"start":{"line":72,"column":19},"end":{"line":72,"column":55}},"type":"binary-expr","locations":[{"start":{"line":72,"column":19},"end":{"line":72,"column":34}},{"start":{"line":72,"column":38},"end":{"line":72,"column":55}}],"line":72},"8":{"loc":{"start":{"line":77,"column":40},"end":{"line":77,"column":55}},"type":"default-arg","locations":[{"start":{"line":77,"column":53},"end":{"line":77,"column":55}}],"line":77},"9":{"loc":{"start":{"line":79,"column":11},"end":{"line":82,"column":33}},"type":"cond-expr","locations":[{"start":{"line":79,"column":39},"end":{"line":82,"column":15}},{"start":{"line":82,"column":18},"end":{"line":82,"column":33}}],"line":79},"10":{"loc":{"start":{"line":93,"column":65},"end":{"line":93,"column":95}},"type":"default-arg","locations":[{"start":{"line":93,"column":93},"end":{"line":93,"column":95}}],"line":93},"11":{"loc":{"start":{"line":95,"column":8},"end":{"line":97,"column":9}},"type":"if","locations":[{"start":{"line":95,"column":8},"end":{"line":97,"column":9}},{"start":{"line":95,"column":8},"end":{"line":97,"column":9}}],"line":95},"12":{"loc":{"start":{"line":95,"column":12},"end":{"line":95,"column":49}},"type":"binary-expr","locations":[{"start":{"line":95,"column":12},"end":{"line":95,"column":21}},{"start":{"line":95,"column":25},"end":{"line":95,"column":49}}],"line":95},"13":{"loc":{"start":{"line":100,"column":40},"end":{"line":100,"column":83}},"type":"cond-expr","locations":[{"start":{"line":100,"column":49},"end":{"line":100,"column":77}},{"start":{"line":100,"column":80},"end":{"line":100,"column":83}}],"line":100},"14":{"loc":{"start":{"line":101,"column":23},"end":{"line":101,"column":98}},"type":"cond-expr","locations":[{"start":{"line":101,"column":62},"end":{"line":101,"column":68}},{"start":{"line":101,"column":71},"end":{"line":101,"column":98}}],"line":101},"15":{"loc":{"start":{"line":101,"column":23},"end":{"line":101,"column":59}},"type":"binary-expr","locations":[{"start":{"line":101,"column":23},"end":{"line":101,"column":38}},{"start":{"line":101,"column":42},"end":{"line":101,"column":59}}],"line":101},"16":{"loc":{"start":{"line":102,"column":12},"end":{"line":104,"column":13}},"type":"if","locations":[{"start":{"line":102,"column":12},"end":{"line":104,"column":13}},{"start":{"line":102,"column":12},"end":{"line":104,"column":13}}],"line":102},"17":{"loc":{"start":{"line":102,"column":16},"end":{"line":102,"column":54}},"type":"binary-expr","locations":[{"start":{"line":102,"column":16},"end":{"line":102,"column":26}},{"start":{"line":102,"column":30},"end":{"line":102,"column":54}}],"line":102}},"s":{"0":1,"1":1,"2":8,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":3,"11":0,"12":1,"13":1,"14":1,"15":2,"16":1,"17":1,"18":1,"19":0,"20":0,"21":0,"22":0,"23":0,"24":1,"25":1,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":1,"35":0,"36":0,"37":0,"38":1,"39":1,"40":1,"41":1,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0},"f":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":3,"8":0,"9":2,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},"b":{"0":[0,2],"1":[2,2],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0],"9":[0,0],"10":[0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/i18n.ts"],"sourcesContent":["import type { RocketchatI18nKeys } from '@rocket.chat/i18n';\nimport type { TOptions } from 'i18next';\nimport i18next from 'i18next';\nimport sprintf from 'i18next-sprintf-postprocessor';\n\nimport { isObject } from '../../../lib/utils/isObject';\n\ndeclare module 'i18next' {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface TFunction {\n\t\t(key: RocketchatI18nKeys): string;\n\t\t(key: RocketchatI18nKeys, options: TOptions): string;\n\t}\n}\n\nexport const i18n = i18next.use(sprintf);\n\nexport const addSprinfToI18n = function (t: (typeof i18n)['t']) {\n\treturn function (key: string, ...replaces: any): string {\n\t\tif (replaces[0] === undefined) {\n\t\t\treturn t(key);\n\t\t}\n\n\t\tif (isObject(replaces[0]) && !Array.isArray(replaces[0])) {\n\t\t\treturn t(key, replaces[0]);\n\t\t}\n\n\t\treturn t(key, {\n\t\t\tpostProcess: 'sprintf',\n\t\t\tsprintf: replaces,\n\t\t});\n\t};\n};\n\nexport const t = addSprinfToI18n(i18n.t.bind(i18n));\n\n/**\n * Extract the translation keys from a flat object and group them by namespace\n *\n * Example:\n *\n * ```js\n * const source = {\n *   'core.key1': 'value1',\n *   'core.key2': 'value2',\n *   'onboarding.key1': 'value1',\n *   'onboarding.key2': 'value2',\n *   'registration.key1': 'value1',\n *   'registration.key2': 'value2',\n *   'cloud.key1': 'value1',\n *   'cloud.key2': 'value2',\n *   'subscription.key1': 'value1',\n *   'subscription.key2': 'value2',\n * };\n *\n * const result = extractTranslationNamespaces(source);\n *\n * console.log(result);\n *\n * // {\n * //   core: {\n * //     key1: 'value1',\n * //     key2: 'value2'\n * //   },\n * //   onboarding: {\n * //     key1: 'value1',\n * //     key2: 'value2'\n * //   },\n * //   registration: {\n * //     key1: 'value1',\n * //     key2: 'value2'\n * //   },\n * //   cloud: {\n * //     key1: 'value1',\n * //     key2: 'value2'\n * //   },\n * //   subscription: {\n * //     key1: 'value1',\n * //     key2: 'value2'\n * //   }\n * // }\n * ```\n *\n * @param source the flat object with the translation keys\n */\nexport const extractTranslationNamespaces = (source: Record<string, string>): Record<TranslationNamespace, Record<string, string>> => {\n\tconst result: Record<TranslationNamespace, Record<string, string>> = {\n\t\tcore: {},\n\t\tonboarding: {},\n\t\tregistration: {},\n\t\tcloud: {},\n\t\tsubscription: {},\n\t};\n\n\tfor (const [key, value] of Object.entries(source)) {\n\t\tconst prefix = availableTranslationNamespaces.find((namespace) => key.startsWith(`${namespace}.`));\n\t\tconst keyWithoutNamespace = prefix ? key.slice(prefix.length + 1) : key;\n\t\tconst ns = prefix ?? defaultTranslationNamespace;\n\t\tresult[ns][keyWithoutNamespace] = value;\n\t}\n\n\treturn result;\n};\n\n/**\n * Extract only the translation keys that match the given namespaces\n *\n * @param source the flat object with the translation keys\n * @param namespaces the namespaces to extract\n */\nexport const extractTranslationKeys = (source: Record<string, string>, namespaces: string | string[] = []): { [key: string]: any } => {\n\tconst all = extractTranslationNamespaces(source);\n\treturn Array.isArray(namespaces)\n\t\t? (namespaces as TranslationNamespace[]).reduce((result, namespace) => ({ ...result, ...all[namespace] }), {})\n\t\t: all[namespaces as TranslationNamespace];\n};\n\nexport type TranslationNamespace =\n\t| (Extract<RocketchatI18nKeys, `${string}.${string}`> extends `${infer T}.${string}` ? (T extends Lowercase<T> ? T : never) : never)\n\t| 'core';\n\nconst namespacesMap: Record<TranslationNamespace, true> = {\n\tcore: true,\n\tonboarding: true,\n\tregistration: true,\n\tcloud: true,\n\tsubscription: true,\n};\n\nexport const availableTranslationNamespaces = Object.keys(namespacesMap) as TranslationNamespace[];\nexport const defaultTranslationNamespace: TranslationNamespace = 'core';\n\nexport const applyCustomTranslations = (\n\ti18n: typeof i18next,\n\tparsedCustomTranslations: Record<string, Record<string, string>>,\n\t{ namespaces, languages }: { namespaces?: string[]; languages?: string[] } = {},\n) => {\n\tfor (const [lng, translations] of Object.entries(parsedCustomTranslations)) {\n\t\tif (languages && !languages.includes(lng)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tfor (const [key, value] of Object.entries(translations)) {\n\t\t\tconst prefix = availableTranslationNamespaces.find((namespace) => key.startsWith(`${namespace}.`));\n\t\t\tconst keyWithoutNamespace = prefix ? key.slice(prefix.length + 1) : key;\n\t\t\tconst ns = prefix ?? defaultTranslationNamespace;\n\n\t\t\tif (namespaces && !namespaces.includes(ns)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ti18n.addResourceBundle(lng, ns, { [keyWithoutNamespace]: value }, true, true);\n\t\t}\n\t}\n};\n"],"names":["addSprinfToI18n","applyCustomTranslations","availableTranslationNamespaces","defaultTranslationNamespace","extractTranslationKeys","extractTranslationNamespaces","i18n","t","i18next","use","sprintf","key","replaces","undefined","isObject","Array","isArray","postProcess","bind","source","result","core","onboarding","registration","cloud","subscription","value","Object","entries","prefix","find","namespace","startsWith","keyWithoutNamespace","slice","length","ns","namespaces","all","reduce","namespacesMap","keys","parsedCustomTranslations","languages","lng","translations","includes","addResourceBundle"],"mappings":";;;;;;;;;;;IAiBaA,eAAe;eAAfA;;IAmHAC,uBAAuB;eAAvBA;;IAHAC,8BAA8B;eAA9BA;;IACAC,2BAA2B;eAA3BA;;IApBAC,sBAAsB;eAAtBA;;IAzBAC,4BAA4B;eAA5BA;;IAtEAC,IAAI;eAAJA;;IAmBAC,CAAC;eAADA;;;gEAhCO;oFACA;0BAEK;;;;;;AAUlB,MAAMD,OAAOE,gBAAO,CAACC,GAAG,CAACC,oCAAO;AAEhC,MAAMV,kBAAkB,SAAUO,CAAqB;IAC7D,OAAO,SAAUI,GAAW,EAAE,GAAGC,QAAa;QAC7C,IAAIA,QAAQ,CAAC,EAAE,KAAKC,WAAW;YAC9B,OAAON,EAAEI;QACV;QAEA,IAAIG,IAAAA,kBAAQ,EAACF,QAAQ,CAAC,EAAE,KAAK,CAACG,MAAMC,OAAO,CAACJ,QAAQ,CAAC,EAAE,GAAG;YACzD,OAAOL,EAAEI,KAAKC,QAAQ,CAAC,EAAE;QAC1B;QAEA,OAAOL,EAAEI,KAAK;YACbM,aAAa;YACbP,SAASE;QACV;IACD;AACD;AAEO,MAAML,IAAIP,gBAAgBM,KAAKC,CAAC,CAACW,IAAI,CAACZ;AAmDtC,MAAMD,+BAA+B,CAACc;IAC5C,MAAMC,SAA+D;QACpEC,MAAM,CAAC;QACPC,YAAY,CAAC;QACbC,cAAc,CAAC;QACfC,OAAO,CAAC;QACRC,cAAc,CAAC;IAChB;IAEA,KAAK,MAAM,CAACd,KAAKe,MAAM,IAAIC,OAAOC,OAAO,CAACT,QAAS;QAClD,MAAMU,SAAS3B,+BAA+B4B,IAAI,CAAC,CAACC,YAAcpB,IAAIqB,UAAU,CAAC,GAAGD,UAAU,CAAC,CAAC;QAChG,MAAME,sBAAsBJ,SAASlB,IAAIuB,KAAK,CAACL,OAAOM,MAAM,GAAG,KAAKxB;QACpE,MAAMyB,KAAKP,mBAAAA,oBAAAA,SAAU1B;QACrBiB,MAAM,CAACgB,GAAG,CAACH,oBAAoB,GAAGP;IACnC;IAEA,OAAON;AACR;AAQO,MAAMhB,yBAAyB,CAACe,QAAgCkB,aAAgC,EAAE;IACxG,MAAMC,MAAMjC,6BAA6Bc;IACzC,OAAOJ,MAAMC,OAAO,CAACqB,cAClB,AAACA,WAAsCE,MAAM,CAAC,CAACnB,QAAQW,YAAe,CAAA;YAAE,GAAGX,MAAM;YAAE,GAAGkB,GAAG,CAACP,UAAU;QAAC,CAAA,GAAI,CAAC,KAC1GO,GAAG,CAACD,WAAmC;AAC3C;AAMA,MAAMG,gBAAoD;IACzDnB,MAAM;IACNC,YAAY;IACZC,cAAc;IACdC,OAAO;IACPC,cAAc;AACf;AAEO,MAAMvB,iCAAiCyB,OAAOc,IAAI,CAACD;AACnD,MAAMrC,8BAAoD;AAE1D,MAAMF,0BAA0B,CACtCK,MACAoC,0BACA,EAAEL,UAAU,EAAEM,SAAS,EAAmD,GAAG,CAAC,CAAC;IAE/E,KAAK,MAAM,CAACC,KAAKC,aAAa,IAAIlB,OAAOC,OAAO,CAACc,0BAA2B;QAC3E,IAAIC,aAAa,CAACA,UAAUG,QAAQ,CAACF,MAAM;YAC1C;QACD;QAEA,KAAK,MAAM,CAACjC,KAAKe,MAAM,IAAIC,OAAOC,OAAO,CAACiB,cAAe;YACxD,MAAMhB,SAAS3B,+BAA+B4B,IAAI,CAAC,CAACC,YAAcpB,IAAIqB,UAAU,CAAC,GAAGD,UAAU,CAAC,CAAC;YAChG,MAAME,sBAAsBJ,SAASlB,IAAIuB,KAAK,CAACL,OAAOM,MAAM,GAAG,KAAKxB;YACpE,MAAMyB,KAAKP,mBAAAA,oBAAAA,SAAU1B;YAErB,IAAIkC,cAAc,CAACA,WAAWS,QAAQ,CAACV,KAAK;gBAC3C;YACD;YAEA9B,KAAKyC,iBAAiB,CAACH,KAAKR,IAAI;gBAAE,CAACH,oBAAoB,EAAEP;YAAM,GAAG,MAAM;QACzE;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/i18n.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2901f95831af5269a1967398d3036953ec0f0bb8","contentHash":"b900c6cfd13ac596182ee09f44163f8461c95212a11ff9ea4ce139349d61fdb8"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isObject.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isObject.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":24}},"3":{"start":{"line":12,"column":17},"end":{"line":12,"column":27}},"4":{"start":{"line":13,"column":4},"end":{"line":13,"column":61}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"isObject","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":17}},"loc":{"start":{"line":11,"column":23},"end":{"line":14,"column":1}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":11},"end":{"line":13,"column":60}},"type":"binary-expr","locations":[{"start":{"line":13,"column":11},"end":{"line":13,"column":30}},{"start":{"line":13,"column":34},"end":{"line":13,"column":51}},{"start":{"line":13,"column":55},"end":{"line":13,"column":60}}],"line":13}},"s":{"0":1,"1":1,"2":10,"3":10,"4":10},"f":{"0":10,"1":10},"b":{"0":[10,10,3]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isObject.ts"],"sourcesContent":["export function isObject(obj: unknown): obj is object {\n\tconst type = typeof obj;\n\treturn type === 'function' || (type === 'object' && !!obj);\n}\n"],"names":["isObject","obj","type"],"mappings":";;;;+BAAgBA;;;eAAAA;;;AAAT,SAASA,SAASC,GAAY;IACpC,MAAMC,OAAO,OAAOD;IACpB,OAAOC,SAAS,cAAeA,SAAS,YAAY,CAAC,CAACD;AACvD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isObject.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d01d88c39aed9eb666d5487642105c8033716371","contentHash":"11b49ad26db91c4b78ad2d103d421c19b936a0e4b8354ba47c85b3c4802db0c4"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/parseTranscriptRequest.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/parseTranscriptRequest.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":38}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":51}},"5":{"start":{"line":13,"column":31},"end":{"line":63,"column":1}},"6":{"start":{"line":15,"column":36},"end":{"line":15,"column":86}},"7":{"start":{"line":17,"column":4},"end":{"line":19,"column":5}},"8":{"start":{"line":18,"column":8},"end":{"line":18,"column":23}},"9":{"start":{"line":21,"column":23},"end":{"line":21,"column":78}},"10":{"start":{"line":22,"column":4},"end":{"line":24,"column":5}},"11":{"start":{"line":23,"column":8},"end":{"line":23,"column":23}},"12":{"start":{"line":25,"column":24},"end":{"line":29,"column":6}},"13":{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},"14":{"start":{"line":32,"column":8},"end":{"line":32,"column":23}},"15":{"start":{"line":34,"column":25},"end":{"line":34,"column":360}},"16":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"17":{"start":{"line":37,"column":8},"end":{"line":37,"column":23}},"18":{"start":{"line":39,"column":23},"end":{"line":45,"column":5}},"19":{"start":{"line":46,"column":24},"end":{"line":46,"column":172}},"20":{"start":{"line":48,"column":4},"end":{"line":50,"column":5}},"21":{"start":{"line":49,"column":8},"end":{"line":49,"column":23}},"22":{"start":{"line":51,"column":4},"end":{"line":62,"column":6}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":31},"end":{"line":13,"column":32}},"loc":{"start":{"line":13,"column":69},"end":{"line":63,"column":1}},"line":13}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":4},"end":{"line":19,"column":5}},"type":"if","locations":[{"start":{"line":17,"column":4},"end":{"line":19,"column":5}},{"start":{"line":17,"column":4},"end":{"line":19,"column":5}}],"line":17},"1":{"loc":{"start":{"line":22,"column":4},"end":{"line":24,"column":5}},"type":"if","locations":[{"start":{"line":22,"column":4},"end":{"line":24,"column":5}},{"start":{"line":22,"column":4},"end":{"line":24,"column":5}}],"line":22},"2":{"loc":{"start":{"line":25,"column":24},"end":{"line":29,"column":6}},"type":"binary-expr","locations":[{"start":{"line":25,"column":24},"end":{"line":25,"column":31}},{"start":{"line":25,"column":35},"end":{"line":29,"column":6}}],"line":25},"3":{"loc":{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},"type":"if","locations":[{"start":{"line":31,"column":4},"end":{"line":33,"column":5}},{"start":{"line":31,"column":4},"end":{"line":33,"column":5}}],"line":31},"4":{"loc":{"start":{"line":34,"column":25},"end":{"line":34,"column":360}},"type":"cond-expr","locations":[{"start":{"line":34,"column":74},"end":{"line":34,"column":80}},{"start":{"line":34,"column":83},"end":{"line":34,"column":360}}],"line":34},"5":{"loc":{"start":{"line":34,"column":25},"end":{"line":34,"column":71}},"type":"binary-expr","locations":[{"start":{"line":34,"column":25},"end":{"line":34,"column":45}},{"start":{"line":34,"column":49},"end":{"line":34,"column":71}}],"line":34},"6":{"loc":{"start":{"line":34,"column":83},"end":{"line":34,"column":360}},"type":"cond-expr","locations":[{"start":{"line":34,"column":192},"end":{"line":34,"column":198}},{"start":{"line":34,"column":201},"end":{"line":34,"column":360}}],"line":34},"7":{"loc":{"start":{"line":34,"column":83},"end":{"line":34,"column":189}},"type":"binary-expr","locations":[{"start":{"line":34,"column":83},"end":{"line":34,"column":148}},{"start":{"line":34,"column":152},"end":{"line":34,"column":189}}],"line":34},"8":{"loc":{"start":{"line":34,"column":201},"end":{"line":34,"column":360}},"type":"cond-expr","locations":[{"start":{"line":34,"column":316},"end":{"line":34,"column":322}},{"start":{"line":34,"column":325},"end":{"line":34,"column":360}}],"line":34},"9":{"loc":{"start":{"line":34,"column":201},"end":{"line":34,"column":313}},"type":"binary-expr","locations":[{"start":{"line":34,"column":201},"end":{"line":34,"column":271}},{"start":{"line":34,"column":275},"end":{"line":34,"column":313}}],"line":34},"10":{"loc":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},{"start":{"line":36,"column":4},"end":{"line":38,"column":5}}],"line":36},"11":{"loc":{"start":{"line":46,"column":24},"end":{"line":46,"column":172}},"type":"binary-expr","locations":[{"start":{"line":46,"column":24},"end":{"line":46,"column":28}},{"start":{"line":46,"column":32},"end":{"line":46,"column":45}},{"start":{"line":46,"column":49},"end":{"line":46,"column":111}},{"start":{"line":46,"column":115},"end":{"line":46,"column":172}}],"line":46},"12":{"loc":{"start":{"line":48,"column":4},"end":{"line":50,"column":5}},"type":"if","locations":[{"start":{"line":48,"column":4},"end":{"line":50,"column":5}},{"start":{"line":48,"column":4},"end":{"line":50,"column":5}}],"line":48}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":9,"7":9,"8":1,"9":8,"10":8,"11":1,"12":7,"13":7,"14":1,"15":6,"16":6,"17":2,"18":4,"19":4,"20":4,"21":1,"22":3},"f":{"0":1,"1":9},"b":{"0":[1,8],"1":[1,7],"2":[7,6],"3":[1,6],"4":[0,6],"5":[6,6],"6":[2,4],"7":[6,6],"8":[0,4],"9":[4,4],"10":[2,4],"11":[4,3,1,2],"12":[1,3]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/parseTranscriptRequest.ts"],"sourcesContent":["import type { ILivechatVisitor, IOmnichannelRoom, IUser } from '@rocket.chat/core-typings';\nimport { LivechatVisitors, Users } from '@rocket.chat/models';\n\nimport { settings } from '../../../settings/server';\nimport type { CloseRoomParams } from './localTypes';\n\nexport const parseTranscriptRequest = async (\n\troom: IOmnichannelRoom,\n\toptions: CloseRoomParams['options'],\n\tvisitor?: ILivechatVisitor,\n\tuser?: IUser,\n): Promise<CloseRoomParams['options']> => {\n\tconst visitorDecideTranscript = settings.get<boolean>('Livechat_enable_transcript');\n\t// visitor decides, no changes\n\tif (visitorDecideTranscript) {\n\t\treturn options;\n\t}\n\n\t// send always is disabled, no changes\n\tconst sendAlways = settings.get<boolean>('Livechat_transcript_send_always');\n\tif (!sendAlways) {\n\t\treturn options;\n\t}\n\n\tconst visitorData =\n\t\tvisitor ||\n\t\t(await LivechatVisitors.findOneById<Pick<ILivechatVisitor, 'visitorEmails'>>(room.v._id, { projection: { visitorEmails: 1 } }));\n\t// no visitor, no changes\n\tif (!visitorData) {\n\t\treturn options;\n\t}\n\tconst visitorEmail = visitorData?.visitorEmails?.[0]?.address;\n\t// visitor doesnt have email, no changes\n\tif (!visitorEmail) {\n\t\treturn options;\n\t}\n\n\tconst defOptions = { projection: { _id: 1, username: 1, name: 1 } };\n\tconst requestedBy =\n\t\tuser ||\n\t\t(room.servedBy && (await Users.findOneById(room.servedBy._id, defOptions))) ||\n\t\t(await Users.findOneById('rocket.cat', defOptions));\n\n\t// no user available for backing request, no changes\n\tif (!requestedBy) {\n\t\treturn options;\n\t}\n\n\treturn {\n\t\t...options,\n\t\temailTranscript: {\n\t\t\tsendToVisitor: true,\n\t\t\trequestData: {\n\t\t\t\temail: visitorEmail,\n\t\t\t\trequestedAt: new Date(),\n\t\t\t\tsubject: '',\n\t\t\t\trequestedBy,\n\t\t\t},\n\t\t},\n\t};\n};\n"],"names":["parseTranscriptRequest","room","options","visitor","user","visitorData","visitorDecideTranscript","settings","get","sendAlways","LivechatVisitors","findOneById","v","_id","projection","visitorEmails","visitorEmail","address","defOptions","username","name","requestedBy","servedBy","Users","emailTranscript","sendToVisitor","requestData","email","requestedAt","Date","subject"],"mappings":";;;;+BAMaA;;;eAAAA;;;wBAL2B;wBAEf;AAGlB,MAAMA,yBAAyB,OACrCC,MACAC,SACAC,SACAC;QAqBqBC,6BAAAA;IAnBrB,MAAMC,0BAA0BC,gBAAQ,CAACC,GAAG,CAAU;IACtD,8BAA8B;IAC9B,IAAIF,yBAAyB;QAC5B,OAAOJ;IACR;IAEA,sCAAsC;IACtC,MAAMO,aAAaF,gBAAQ,CAACC,GAAG,CAAU;IACzC,IAAI,CAACC,YAAY;QAChB,OAAOP;IACR;IAEA,MAAMG,cACLF,WACC,MAAMO,wBAAgB,CAACC,WAAW,CAA0CV,KAAKW,CAAC,CAACC,GAAG,EAAE;QAAEC,YAAY;YAAEC,eAAe;QAAE;IAAE;IAC7H,yBAAyB;IACzB,IAAI,CAACV,aAAa;QACjB,OAAOH;IACR;IACA,MAAMc,eAAeX,wBAAAA,mCAAAA,6BAAAA,YAAaU,aAAa,cAA1BV,kDAAAA,8BAAAA,0BAA4B,CAAC,EAAE,cAA/BA,kDAAAA,4BAAiCY,OAAO;IAC7D,wCAAwC;IACxC,IAAI,CAACD,cAAc;QAClB,OAAOd;IACR;IAEA,MAAMgB,aAAa;QAAEJ,YAAY;YAAED,KAAK;YAAGM,UAAU;YAAGC,MAAM;QAAE;IAAE;IAClE,MAAMC,cACLjB,QACCH,KAAKqB,QAAQ,IAAK,MAAMC,aAAK,CAACZ,WAAW,CAACV,KAAKqB,QAAQ,CAACT,GAAG,EAAEK,eAC7D,MAAMK,aAAK,CAACZ,WAAW,CAAC,cAAcO;IAExC,oDAAoD;IACpD,IAAI,CAACG,aAAa;QACjB,OAAOnB;IACR;IAEA,OAAO;QACN,GAAGA,OAAO;QACVsB,iBAAiB;YAChBC,eAAe;YACfC,aAAa;gBACZC,OAAOX;gBACPY,aAAa,IAAIC;gBACjBC,SAAS;gBACTT;YACD;QACD;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/parseTranscriptRequest.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"76326edb430770132336f846595c6ab01be7673c","contentHash":"a03b25cf18b229b3ff9314ee25136637c979bf3d06596c1ab1421fe13a2162d6"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/sendTranscript.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/sendTranscript.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":30}},"3":{"start":{"line":11,"column":22},"end":{"line":11,"column":59}},"4":{"start":{"line":12,"column":21},"end":{"line":12,"column":57}},"5":{"start":{"line":13,"column":30},"end":{"line":13,"column":102}},"6":{"start":{"line":14,"column":16},"end":{"line":14,"column":46}},"7":{"start":{"line":15,"column":16},"end":{"line":15,"column":46}},"8":{"start":{"line":16,"column":15},"end":{"line":16,"column":38}},"9":{"start":{"line":17,"column":38},"end":{"line":17,"column":90}},"10":{"start":{"line":18,"column":19},"end":{"line":18,"column":55}},"11":{"start":{"line":19,"column":14},"end":{"line":19,"column":52}},"12":{"start":{"line":20,"column":16},"end":{"line":20,"column":54}},"13":{"start":{"line":21,"column":27},"end":{"line":21,"column":91}},"14":{"start":{"line":22,"column":17},"end":{"line":22,"column":52}},"15":{"start":{"line":23,"column":22},"end":{"line":23,"column":67}},"16":{"start":{"line":24,"column":21},"end":{"line":24,"column":69}},"17":{"start":{"line":26,"column":4},"end":{"line":28,"column":6}},"18":{"start":{"line":31,"column":4},"end":{"line":31,"column":51}},"19":{"start":{"line":31,"column":39},"end":{"line":31,"column":51}},"20":{"start":{"line":32,"column":28},"end":{"line":32,"column":41}},"21":{"start":{"line":33,"column":27},"end":{"line":33,"column":40}},"22":{"start":{"line":34,"column":4},"end":{"line":36,"column":20}},"23":{"start":{"line":35,"column":8},"end":{"line":35,"column":66}},"24":{"start":{"line":39,"column":4},"end":{"line":41,"column":5}},"25":{"start":{"line":40,"column":8},"end":{"line":40,"column":19}},"26":{"start":{"line":42,"column":4},"end":{"line":46,"column":5}},"27":{"start":{"line":43,"column":8},"end":{"line":45,"column":10}},"28":{"start":{"line":47,"column":16},"end":{"line":47,"column":53}},"29":{"start":{"line":48,"column":4},"end":{"line":50,"column":5}},"30":{"start":{"line":49,"column":8},"end":{"line":49,"column":30}},"31":{"start":{"line":51,"column":17},"end":{"line":53,"column":5}},"32":{"start":{"line":54,"column":32},"end":{"line":54,"column":88}},"33":{"start":{"line":55,"column":4},"end":{"line":64,"column":5}},"34":{"start":{"line":56,"column":8},"end":{"line":63,"column":9}},"35":{"start":{"line":57,"column":23},"end":{"line":57,"column":95}},"36":{"start":{"line":58,"column":12},"end":{"line":62,"column":13}},"37":{"start":{"line":59,"column":16},"end":{"line":59,"column":57}},"38":{"start":{"line":61,"column":16},"end":{"line":61,"column":39}},"39":{"start":{"line":65,"column":4},"end":{"line":65,"column":25}},"40":{"start":{"line":66,"column":4},"end":{"line":68,"column":5}},"41":{"start":{"line":67,"column":8},"end":{"line":67,"column":31}},"42":{"start":{"line":69,"column":4},"end":{"line":69,"column":18}},"43":{"start":{"line":71,"column":15},"end":{"line":71,"column":60}},"44":{"start":{"line":73,"column":4},"end":{"line":73,"column":35}},"45":{"start":{"line":74,"column":4},"end":{"line":74,"column":37}},"46":{"start":{"line":75,"column":4},"end":{"line":75,"column":95}},"47":{"start":{"line":76,"column":17},"end":{"line":76,"column":61}},"48":{"start":{"line":77,"column":20},"end":{"line":77,"column":70}},"49":{"start":{"line":78,"column":4},"end":{"line":80,"column":5}},"50":{"start":{"line":79,"column":8},"end":{"line":79,"column":49}},"51":{"start":{"line":81,"column":25},"end":{"line":81,"column":66}},"52":{"start":{"line":82,"column":21},"end":{"line":82,"column":56}},"53":{"start":{"line":83,"column":4},"end":{"line":83,"column":74}},"54":{"start":{"line":84,"column":4},"end":{"line":86,"column":5}},"55":{"start":{"line":85,"column":8},"end":{"line":85,"column":46}},"56":{"start":{"line":88,"column":4},"end":{"line":90,"column":5}},"57":{"start":{"line":89,"column":8},"end":{"line":89,"column":46}},"58":{"start":{"line":91,"column":26},"end":{"line":91,"column":75}},"59":{"start":{"line":92,"column":31},"end":{"line":92,"column":96}},"60":{"start":{"line":93,"column":27},"end":{"line":97,"column":6}},"61":{"start":{"line":98,"column":32},"end":{"line":106,"column":5}},"62":{"start":{"line":107,"column":37},"end":{"line":111,"column":5}},"63":{"start":{"line":112,"column":21},"end":{"line":116,"column":6}},"64":{"start":{"line":117,"column":15},"end":{"line":117,"column":27}},"65":{"start":{"line":118,"column":31},"end":{"line":120,"column":14}},"66":{"start":{"line":121,"column":4},"end":{"line":183,"column":5}},"67":{"start":{"line":124,"column":8},"end":{"line":132,"column":9}},"68":{"start":{"line":125,"column":12},"end":{"line":127,"column":15}},"69":{"start":{"line":129,"column":12},"end":{"line":131,"column":15}},"70":{"start":{"line":133,"column":32},"end":{"line":133,"column":83}},"71":{"start":{"line":134,"column":28},"end":{"line":134,"column":90}},"72":{"start":{"line":135,"column":29},"end":{"line":144,"column":30}},"73":{"start":{"line":145,"column":24},"end":{"line":145,"column":26}},"74":{"start":{"line":146,"column":8},"end":{"line":175,"column":9}},"75":{"start":{"line":147,"column":12},"end":{"line":147,"column":70}},"76":{"start":{"line":148,"column":12},"end":{"line":174,"column":13}},"77":{"start":{"line":150,"column":16},"end":{"line":152,"column":17}},"78":{"start":{"line":151,"column":20},"end":{"line":151,"column":29}},"79":{"start":{"line":153,"column":16},"end":{"line":156,"column":17}},"80":{"start":{"line":154,"column":20},"end":{"line":154,"column":93}},"81":{"start":{"line":155,"column":20},"end":{"line":155,"column":29}},"82":{"start":{"line":157,"column":16},"end":{"line":160,"column":17}},"83":{"start":{"line":158,"column":20},"end":{"line":158,"column":93}},"84":{"start":{"line":159,"column":20},"end":{"line":159,"column":29}},"85":{"start":{"line":162,"column":29},"end":{"line":162,"column":170}},"86":{"start":{"line":162,"column":139},"end":{"line":162,"column":169}},"87":{"start":{"line":163,"column":16},"end":{"line":166,"column":17}},"88":{"start":{"line":164,"column":20},"end":{"line":164,"column":93}},"89":{"start":{"line":165,"column":20},"end":{"line":165,"column":29}},"90":{"start":{"line":167,"column":37},"end":{"line":167,"column":80}},"91":{"start":{"line":168,"column":16},"end":{"line":171,"column":17}},"92":{"start":{"line":169,"column":20},"end":{"line":169,"column":80}},"93":{"start":{"line":170,"column":20},"end":{"line":170,"column":29}},"94":{"start":{"line":172,"column":43},"end":{"line":172,"column":91}},"95":{"start":{"line":173,"column":16},"end":{"line":173,"column":318}},"96":{"start":{"line":176,"column":25},"end":{"line":176,"column":108}},"97":{"start":{"line":177,"column":30},"end":{"line":181,"column":3}},"98":{"start":{"line":182,"column":8},"end":{"line":182,"column":30}},"99":{"start":{"line":184,"column":4},"end":{"line":184,"column":27}},"100":{"start":{"line":185,"column":22},"end":{"line":185,"column":114}},"101":{"start":{"line":186,"column":26},"end":{"line":186,"column":28}},"102":{"start":{"line":187,"column":4},"end":{"line":191,"column":5}},"103":{"start":{"line":188,"column":8},"end":{"line":188,"column":39}},"104":{"start":{"line":190,"column":8},"end":{"line":190,"column":62}},"105":{"start":{"line":197,"column":24},"end":{"line":199,"column":6}},"106":{"start":{"line":200,"column":4},"end":{"line":206,"column":7}},"107":{"start":{"line":207,"column":4},"end":{"line":209,"column":7}},"108":{"start":{"line":208,"column":8},"end":{"line":208,"column":82}},"109":{"start":{"line":210,"column":24},"end":{"line":214,"column":5}},"110":{"start":{"line":215,"column":4},"end":{"line":227,"column":5}},"111":{"start":{"line":216,"column":20},"end":{"line":222,"column":10}},"112":{"start":{"line":223,"column":8},"end":{"line":226,"column":9}},"113":{"start":{"line":224,"column":12},"end":{"line":224,"column":35}},"114":{"start":{"line":225,"column":12},"end":{"line":225,"column":41}},"115":{"start":{"line":228,"column":4},"end":{"line":231,"column":5}},"116":{"start":{"line":229,"column":8},"end":{"line":229,"column":50}},"117":{"start":{"line":230,"column":8},"end":{"line":230,"column":69}},"118":{"start":{"line":232,"column":4},"end":{"line":234,"column":7}},"119":{"start":{"line":235,"column":4},"end":{"line":235,"column":16}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":25,"column":9},"end":{"line":25,"column":33}},"loc":{"start":{"line":25,"column":39},"end":{"line":29,"column":1}},"line":25},"2":{"name":"_getRequireWildcardCache","decl":{"start":{"line":30,"column":9},"end":{"line":30,"column":33}},"loc":{"start":{"line":30,"column":47},"end":{"line":37,"column":1}},"line":30},"3":{"name":"(anonymous_3)","decl":{"start":{"line":34,"column":39},"end":{"line":34,"column":40}},"loc":{"start":{"line":34,"column":61},"end":{"line":36,"column":5}},"line":34},"4":{"name":"_interop_require_wildcard","decl":{"start":{"line":38,"column":9},"end":{"line":38,"column":34}},"loc":{"start":{"line":38,"column":53},"end":{"line":70,"column":1}},"line":38},"5":{"name":"sendTranscript","decl":{"start":{"line":72,"column":15},"end":{"line":72,"column":29}},"loc":{"start":{"line":72,"column":68},"end":{"line":236,"column":1}},"line":72},"6":{"name":"(anonymous_6)","decl":{"start":{"line":162,"column":131},"end":{"line":162,"column":132}},"loc":{"start":{"line":162,"column":139},"end":{"line":162,"column":169}},"line":162},"7":{"name":"(anonymous_7)","decl":{"start":{"line":207,"column":17},"end":{"line":207,"column":18}},"loc":{"start":{"line":207,"column":21},"end":{"line":209,"column":5}},"line":207}},"branchMap":{"0":{"loc":{"start":{"line":26,"column":11},"end":{"line":28,"column":5}},"type":"cond-expr","locations":[{"start":{"line":26,"column":35},"end":{"line":26,"column":38}},{"start":{"line":26,"column":41},"end":{"line":28,"column":5}}],"line":26},"1":{"loc":{"start":{"line":26,"column":11},"end":{"line":26,"column":32}},"type":"binary-expr","locations":[{"start":{"line":26,"column":11},"end":{"line":26,"column":14}},{"start":{"line":26,"column":18},"end":{"line":26,"column":32}}],"line":26},"2":{"loc":{"start":{"line":31,"column":4},"end":{"line":31,"column":51}},"type":"if","locations":[{"start":{"line":31,"column":4},"end":{"line":31,"column":51}},{"start":{"line":31,"column":4},"end":{"line":31,"column":51}}],"line":31},"3":{"loc":{"start":{"line":35,"column":15},"end":{"line":35,"column":65}},"type":"cond-expr","locations":[{"start":{"line":35,"column":29},"end":{"line":35,"column":45}},{"start":{"line":35,"column":48},"end":{"line":35,"column":65}}],"line":35},"4":{"loc":{"start":{"line":39,"column":4},"end":{"line":41,"column":5}},"type":"if","locations":[{"start":{"line":39,"column":4},"end":{"line":41,"column":5}},{"start":{"line":39,"column":4},"end":{"line":41,"column":5}}],"line":39},"5":{"loc":{"start":{"line":39,"column":8},"end":{"line":39,"column":45}},"type":"binary-expr","locations":[{"start":{"line":39,"column":8},"end":{"line":39,"column":20}},{"start":{"line":39,"column":24},"end":{"line":39,"column":27}},{"start":{"line":39,"column":31},"end":{"line":39,"column":45}}],"line":39},"6":{"loc":{"start":{"line":42,"column":4},"end":{"line":46,"column":5}},"type":"if","locations":[{"start":{"line":42,"column":4},"end":{"line":46,"column":5}},{"start":{"line":42,"column":4},"end":{"line":46,"column":5}}],"line":42},"7":{"loc":{"start":{"line":42,"column":8},"end":{"line":42,"column":76}},"type":"binary-expr","locations":[{"start":{"line":42,"column":8},"end":{"line":42,"column":20}},{"start":{"line":42,"column":24},"end":{"line":42,"column":47}},{"start":{"line":42,"column":51},"end":{"line":42,"column":76}}],"line":42},"8":{"loc":{"start":{"line":48,"column":4},"end":{"line":50,"column":5}},"type":"if","locations":[{"start":{"line":48,"column":4},"end":{"line":50,"column":5}},{"start":{"line":48,"column":4},"end":{"line":50,"column":5}}],"line":48},"9":{"loc":{"start":{"line":48,"column":8},"end":{"line":48,"column":31}},"type":"binary-expr","locations":[{"start":{"line":48,"column":8},"end":{"line":48,"column":13}},{"start":{"line":48,"column":17},"end":{"line":48,"column":31}}],"line":48},"10":{"loc":{"start":{"line":54,"column":32},"end":{"line":54,"column":88}},"type":"binary-expr","locations":[{"start":{"line":54,"column":32},"end":{"line":54,"column":53}},{"start":{"line":54,"column":57},"end":{"line":54,"column":88}}],"line":54},"11":{"loc":{"start":{"line":56,"column":8},"end":{"line":63,"column":9}},"type":"if","locations":[{"start":{"line":56,"column":8},"end":{"line":63,"column":9}},{"start":{"line":56,"column":8},"end":{"line":63,"column":9}}],"line":56},"12":{"loc":{"start":{"line":56,"column":12},"end":{"line":56,"column":79}},"type":"binary-expr","locations":[{"start":{"line":56,"column":12},"end":{"line":56,"column":29}},{"start":{"line":56,"column":33},"end":{"line":56,"column":79}}],"line":56},"13":{"loc":{"start":{"line":57,"column":23},"end":{"line":57,"column":95}},"type":"cond-expr","locations":[{"start":{"line":57,"column":47},"end":{"line":57,"column":88}},{"start":{"line":57,"column":91},"end":{"line":57,"column":95}}],"line":57},"14":{"loc":{"start":{"line":58,"column":12},"end":{"line":62,"column":13}},"type":"if","locations":[{"start":{"line":58,"column":12},"end":{"line":62,"column":13}},{"start":{"line":58,"column":12},"end":{"line":62,"column":13}}],"line":58},"15":{"loc":{"start":{"line":58,"column":16},"end":{"line":58,"column":46}},"type":"binary-expr","locations":[{"start":{"line":58,"column":16},"end":{"line":58,"column":20}},{"start":{"line":58,"column":25},"end":{"line":58,"column":33}},{"start":{"line":58,"column":37},"end":{"line":58,"column":45}}],"line":58},"16":{"loc":{"start":{"line":66,"column":4},"end":{"line":68,"column":5}},"type":"if","locations":[{"start":{"line":66,"column":4},"end":{"line":68,"column":5}},{"start":{"line":66,"column":4},"end":{"line":68,"column":5}}],"line":66},"17":{"loc":{"start":{"line":77,"column":20},"end":{"line":77,"column":70}},"type":"cond-expr","locations":[{"start":{"line":77,"column":55},"end":{"line":77,"column":61}},{"start":{"line":77,"column":64},"end":{"line":77,"column":70}}],"line":77},"18":{"loc":{"start":{"line":77,"column":20},"end":{"line":77,"column":52}},"type":"binary-expr","locations":[{"start":{"line":77,"column":20},"end":{"line":77,"column":33}},{"start":{"line":77,"column":37},"end":{"line":77,"column":52}}],"line":77},"19":{"loc":{"start":{"line":78,"column":4},"end":{"line":80,"column":5}},"type":"if","locations":[{"start":{"line":78,"column":4},"end":{"line":80,"column":5}},{"start":{"line":78,"column":4},"end":{"line":80,"column":5}}],"line":78},"20":{"loc":{"start":{"line":78,"column":19},"end":{"line":78,"column":82}},"type":"cond-expr","locations":[{"start":{"line":78,"column":60},"end":{"line":78,"column":66}},{"start":{"line":78,"column":69},"end":{"line":78,"column":82}}],"line":78},"21":{"loc":{"start":{"line":78,"column":19},"end":{"line":78,"column":57}},"type":"binary-expr","locations":[{"start":{"line":78,"column":19},"end":{"line":78,"column":35}},{"start":{"line":78,"column":39},"end":{"line":78,"column":57}}],"line":78},"22":{"loc":{"start":{"line":81,"column":25},"end":{"line":81,"column":66}},"type":"binary-expr","locations":[{"start":{"line":81,"column":25},"end":{"line":81,"column":58}},{"start":{"line":81,"column":62},"end":{"line":81,"column":66}}],"line":81},"23":{"loc":{"start":{"line":84,"column":4},"end":{"line":86,"column":5}},"type":"if","locations":[{"start":{"line":84,"column":4},"end":{"line":86,"column":5}},{"start":{"line":84,"column":4},"end":{"line":86,"column":5}}],"line":84},"24":{"loc":{"start":{"line":88,"column":4},"end":{"line":90,"column":5}},"type":"if","locations":[{"start":{"line":88,"column":4},"end":{"line":90,"column":5}},{"start":{"line":88,"column":4},"end":{"line":90,"column":5}}],"line":88},"25":{"loc":{"start":{"line":112,"column":116},"end":{"line":112,"column":242}},"type":"cond-expr","locations":[{"start":{"line":112,"column":202},"end":{"line":112,"column":229}},{"start":{"line":112,"column":232},"end":{"line":112,"column":242}}],"line":112},"26":{"loc":{"start":{"line":112,"column":117},"end":{"line":112,"column":198}},"type":"cond-expr","locations":[{"start":{"line":112,"column":172},"end":{"line":112,"column":178}},{"start":{"line":112,"column":181},"end":{"line":112,"column":198}}],"line":112},"27":{"loc":{"start":{"line":112,"column":117},"end":{"line":112,"column":169}},"type":"binary-expr","locations":[{"start":{"line":112,"column":117},"end":{"line":112,"column":140}},{"start":{"line":112,"column":144},"end":{"line":112,"column":169}}],"line":112},"28":{"loc":{"start":{"line":124,"column":8},"end":{"line":132,"column":9}},"type":"if","locations":[{"start":{"line":124,"column":8},"end":{"line":132,"column":9}},{"start":{"line":124,"column":8},"end":{"line":132,"column":9}}],"line":124},"29":{"loc":{"start":{"line":129,"column":21},"end":{"line":131,"column":14}},"type":"cond-expr","locations":[{"start":{"line":129,"column":37},"end":{"line":129,"column":73}},{"start":{"line":129,"column":76},"end":{"line":131,"column":14}}],"line":129},"30":{"loc":{"start":{"line":129,"column":37},"end":{"line":129,"column":73}},"type":"binary-expr","locations":[{"start":{"line":129,"column":37},"end":{"line":129,"column":51}},{"start":{"line":129,"column":55},"end":{"line":129,"column":73}}],"line":129},"31":{"loc":{"start":{"line":134,"column":28},"end":{"line":134,"column":90}},"type":"binary-expr","locations":[{"start":{"line":134,"column":28},"end":{"line":134,"column":43}},{"start":{"line":134,"column":47},"end":{"line":134,"column":90}}],"line":134},"32":{"loc":{"start":{"line":135,"column":29},"end":{"line":144,"column":30}},"type":"cond-expr","locations":[{"start":{"line":135,"column":43},"end":{"line":144,"column":16}},{"start":{"line":144,"column":19},"end":{"line":144,"column":30}}],"line":135},"33":{"loc":{"start":{"line":135,"column":83},"end":{"line":144,"column":9}},"type":"cond-expr","locations":[{"start":{"line":135,"column":102},"end":{"line":140,"column":9}},{"start":{"line":140,"column":12},"end":{"line":144,"column":9}}],"line":135},"34":{"loc":{"start":{"line":146,"column":8},"end":{"line":175,"column":9}},"type":"if","locations":[{"start":{"line":146,"column":8},"end":{"line":175,"column":9}},{"start":{"line":146,"column":8},"end":{"line":175,"column":9}}],"line":146},"35":{"loc":{"start":{"line":146,"column":12},"end":{"line":146,"column":168}},"type":"binary-expr","locations":[{"start":{"line":146,"column":12},"end":{"line":146,"column":31}},{"start":{"line":146,"column":35},"end":{"line":146,"column":168}}],"line":146},"36":{"loc":{"start":{"line":146,"column":36},"end":{"line":146,"column":163}},"type":"cond-expr","locations":[{"start":{"line":146,"column":127},"end":{"line":146,"column":133}},{"start":{"line":146,"column":136},"end":{"line":146,"column":163}}],"line":146},"37":{"loc":{"start":{"line":146,"column":36},"end":{"line":146,"column":124}},"type":"binary-expr","locations":[{"start":{"line":146,"column":36},"end":{"line":146,"column":89}},{"start":{"line":146,"column":93},"end":{"line":146,"column":124}}],"line":146},"38":{"loc":{"start":{"line":147,"column":29},"end":{"line":147,"column":69}},"type":"binary-expr","locations":[{"start":{"line":147,"column":29},"end":{"line":147,"column":63}},{"start":{"line":147,"column":67},"end":{"line":147,"column":69}}],"line":147},"39":{"loc":{"start":{"line":150,"column":16},"end":{"line":152,"column":17}},"type":"if","locations":[{"start":{"line":150,"column":16},"end":{"line":152,"column":17}},{"start":{"line":150,"column":16},"end":{"line":152,"column":17}}],"line":150},"40":{"loc":{"start":{"line":153,"column":16},"end":{"line":156,"column":17}},"type":"if","locations":[{"start":{"line":153,"column":16},"end":{"line":156,"column":17}},{"start":{"line":153,"column":16},"end":{"line":156,"column":17}}],"line":153},"41":{"loc":{"start":{"line":154,"column":41},"end":{"line":154,"column":63}},"type":"binary-expr","locations":[{"start":{"line":154,"column":41},"end":{"line":154,"column":57}},{"start":{"line":154,"column":61},"end":{"line":154,"column":63}}],"line":154},"42":{"loc":{"start":{"line":157,"column":16},"end":{"line":160,"column":17}},"type":"if","locations":[{"start":{"line":157,"column":16},"end":{"line":160,"column":17}},{"start":{"line":157,"column":16},"end":{"line":160,"column":17}}],"line":157},"43":{"loc":{"start":{"line":157,"column":20},"end":{"line":157,"column":103}},"type":"binary-expr","locations":[{"start":{"line":157,"column":20},"end":{"line":157,"column":42}},{"start":{"line":157,"column":46},"end":{"line":157,"column":103}}],"line":157},"44":{"loc":{"start":{"line":158,"column":41},"end":{"line":158,"column":63}},"type":"binary-expr","locations":[{"start":{"line":158,"column":41},"end":{"line":158,"column":57}},{"start":{"line":158,"column":61},"end":{"line":158,"column":63}}],"line":158},"45":{"loc":{"start":{"line":162,"column":29},"end":{"line":162,"column":170}},"type":"cond-expr","locations":[{"start":{"line":162,"column":102},"end":{"line":162,"column":108}},{"start":{"line":162,"column":111},"end":{"line":162,"column":170}}],"line":162},"46":{"loc":{"start":{"line":162,"column":29},"end":{"line":162,"column":99}},"type":"binary-expr","locations":[{"start":{"line":162,"column":29},"end":{"line":162,"column":70}},{"start":{"line":162,"column":74},"end":{"line":162,"column":99}}],"line":162},"47":{"loc":{"start":{"line":163,"column":16},"end":{"line":166,"column":17}},"type":"if","locations":[{"start":{"line":163,"column":16},"end":{"line":166,"column":17}},{"start":{"line":163,"column":16},"end":{"line":166,"column":17}}],"line":163},"48":{"loc":{"start":{"line":164,"column":41},"end":{"line":164,"column":63}},"type":"binary-expr","locations":[{"start":{"line":164,"column":41},"end":{"line":164,"column":57}},{"start":{"line":164,"column":61},"end":{"line":164,"column":63}}],"line":164},"49":{"loc":{"start":{"line":168,"column":16},"end":{"line":171,"column":17}},"type":"if","locations":[{"start":{"line":168,"column":16},"end":{"line":171,"column":17}},{"start":{"line":168,"column":16},"end":{"line":171,"column":17}}],"line":168},"50":{"loc":{"start":{"line":187,"column":4},"end":{"line":191,"column":5}},"type":"if","locations":[{"start":{"line":187,"column":4},"end":{"line":191,"column":5}},{"start":{"line":187,"column":4},"end":{"line":191,"column":5}}],"line":187},"51":{"loc":{"start":{"line":197,"column":24},"end":{"line":199,"column":6}},"type":"binary-expr","locations":[{"start":{"line":197,"column":24},"end":{"line":197,"column":31}},{"start":{"line":197,"column":35},"end":{"line":197,"column":93}},{"start":{"line":197,"column":97},"end":{"line":199,"column":6}}],"line":197},"52":{"loc":{"start":{"line":215,"column":4},"end":{"line":227,"column":5}},"type":"if","locations":[{"start":{"line":215,"column":4},"end":{"line":227,"column":5}},{"start":{"line":215,"column":4},"end":{"line":227,"column":5}}],"line":215},"53":{"loc":{"start":{"line":215,"column":10},"end":{"line":215,"column":67}},"type":"cond-expr","locations":[{"start":{"line":215,"column":45},"end":{"line":215,"column":51}},{"start":{"line":215,"column":54},"end":{"line":215,"column":67}}],"line":215},"54":{"loc":{"start":{"line":215,"column":10},"end":{"line":215,"column":42}},"type":"binary-expr","locations":[{"start":{"line":215,"column":10},"end":{"line":215,"column":23}},{"start":{"line":215,"column":27},"end":{"line":215,"column":42}}],"line":215},"55":{"loc":{"start":{"line":223,"column":8},"end":{"line":226,"column":9}},"type":"if","locations":[{"start":{"line":223,"column":8},"end":{"line":226,"column":9}},{"start":{"line":223,"column":8},"end":{"line":226,"column":9}}],"line":223},"56":{"loc":{"start":{"line":228,"column":4},"end":{"line":231,"column":5}},"type":"if","locations":[{"start":{"line":228,"column":4},"end":{"line":231,"column":5}},{"start":{"line":228,"column":4},"end":{"line":231,"column":5}}],"line":228}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":2,"18":1,"19":0,"20":1,"21":1,"22":1,"23":1,"24":1,"25":0,"26":1,"27":0,"28":1,"29":1,"30":0,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":0,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":12,"45":11,"46":11,"47":11,"48":11,"49":11,"50":2,"51":9,"52":9,"53":9,"54":9,"55":2,"56":7,"57":1,"58":6,"59":6,"60":6,"61":6,"62":6,"63":6,"64":6,"65":6,"66":6,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":4,"100":4,"101":4,"102":4,"103":4,"104":0,"105":4,"106":4,"107":4,"108":4,"109":4,"110":4,"111":0,"112":0,"113":0,"114":0,"115":4,"116":0,"117":0,"118":4,"119":4},"f":{"0":1,"1":2,"2":1,"3":1,"4":1,"5":12,"6":0,"7":4},"b":{"0":[0,2],"1":[2,2],"2":[0,1],"3":[0,1],"4":[0,1],"5":[1,1,1],"6":[0,1],"7":[1,1,0],"8":[0,1],"9":[1,1],"10":[1,1],"11":[1,0],"12":[1,1],"13":[1,0],"14":[0,1],"15":[1,1,1],"16":[1,0],"17":[2,9],"18":[11,10],"19":[2,9],"20":[4,7],"21":[11,11],"22":[9,0],"23":[2,7],"24":[1,6],"25":[0,6],"26":[6,0],"27":[6,6],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[4,0],"51":[4,3,2],"52":[0,4],"53":[0,4],"54":[4,4],"55":[0,0],"56":[0,4]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/sendTranscript.ts"],"sourcesContent":["import { Message } from '@rocket.chat/core-services';\nimport {\n\ttype IUser,\n\ttype MessageTypesValues,\n\ttype IOmnichannelSystemMessage,\n\ttype ILivechatVisitor,\n\tisFileAttachment,\n\tisFileImageAttachment,\n} from '@rocket.chat/core-typings';\nimport colors from '@rocket.chat/fuselage-tokens/colors';\nimport { Logger } from '@rocket.chat/logger';\nimport { LivechatRooms, Messages, Uploads, Users } from '@rocket.chat/models';\nimport { check } from 'meteor/check';\nimport moment from 'moment-timezone';\n\nimport { callbacks } from '../../../../lib/callbacks';\nimport { i18n } from '../../../../server/lib/i18n';\nimport { FileUpload } from '../../../file-upload/server';\nimport * as Mailer from '../../../mailer/server/api';\nimport { settings } from '../../../settings/server';\nimport { MessageTypes } from '../../../ui-utils/lib/MessageTypes';\nimport { getTimezone } from '../../../utils/server/lib/getTimezone';\n\nconst logger = new Logger('Livechat-SendTranscript');\n\nexport async function sendTranscript({\n\ttoken,\n\trid,\n\temail,\n\tsubject,\n\tuser,\n}: {\n\ttoken: string;\n\trid: string;\n\temail: string;\n\tsubject?: string;\n\tuser?: Pick<IUser, '_id' | 'name' | 'username' | 'utcOffset'> | null;\n}): Promise<boolean> {\n\tcheck(rid, String);\n\tcheck(email, String);\n\tlogger.debug(`Sending conversation transcript of room ${rid} to user with token ${token}`);\n\n\tconst room = await LivechatRooms.findOneById(rid);\n\n\tconst visitor = room?.v as ILivechatVisitor;\n\tif (token !== visitor?.token) {\n\t\tthrow new Error('error-invalid-visitor');\n\t}\n\n\tconst userLanguage = settings.get<string>('Language') || 'en';\n\tconst timezone = getTimezone(user);\n\tlogger.debug(`Transcript will be sent using ${timezone} as timezone`);\n\n\tif (!room) {\n\t\tthrow new Error('error-invalid-room');\n\t}\n\n\t// allow to only user to send transcripts from their own chats\n\tif (room.t !== 'l') {\n\t\tthrow new Error('error-invalid-room');\n\t}\n\n\tconst showAgentInfo = settings.get<boolean>('Livechat_show_agent_info');\n\tconst showSystemMessages = settings.get<boolean>('Livechat_transcript_show_system_messages');\n\tconst closingMessage = await Messages.findLivechatClosingMessage(rid, { projection: { ts: 1 } });\n\tconst ignoredMessageTypes: MessageTypesValues[] = [\n\t\t'livechat_navigation_history',\n\t\t'livechat_transcript_history',\n\t\t'command',\n\t\t'livechat-close',\n\t\t'livechat-started',\n\t\t'livechat_video_call',\n\t\t'omnichannel_priority_change_history',\n\t];\n\tconst acceptableImageMimeTypes = ['image/jpeg', 'image/png', 'image/jpg'];\n\tconst messages = await Messages.findVisibleByRoomIdNotContainingTypesBeforeTs(\n\t\trid,\n\t\tignoredMessageTypes,\n\t\tclosingMessage?.ts ? new Date(closingMessage.ts) : new Date(),\n\t\tshowSystemMessages,\n\t\t{\n\t\t\tsort: { ts: 1 },\n\t\t},\n\t);\n\n\tlet html = '<div> <hr>';\n\tconst InvalidFileMessage = `<div style=\"background-color: ${colors.n100}; text-align: center; border-color: ${\n\t\tcolors.n250\n\t}; border-width: 1px; border-style: solid; border-radius: 4px; padding-top: 8px; padding-bottom: 8px; margin-top: 4px;\">${i18n.t(\n\t\t'This_attachment_is_not_supported',\n\t\t{ lng: userLanguage },\n\t)}</div>`;\n\n\tfor await (const message of messages) {\n\t\tlet author;\n\t\tif (message.u._id === visitor._id) {\n\t\t\tauthor = i18n.t('You', { lng: userLanguage });\n\t\t} else {\n\t\t\tauthor = showAgentInfo ? message.u.name || message.u.username : i18n.t('Agent', { lng: userLanguage });\n\t\t}\n\n\t\tconst isSystemMessage = MessageTypes.isSystemMessage(message);\n\t\tconst messageType = isSystemMessage && MessageTypes.getType(message);\n\n\t\tlet messageContent = messageType\n\t\t\t? `<i>${i18n.t(\n\t\t\t\t\tmessageType.message,\n\t\t\t\t\tmessageType.data\n\t\t\t\t\t\t? { ...messageType.data(message), interpolation: { escapeValue: false } }\n\t\t\t\t\t\t: { interpolation: { escapeValue: false } },\n\t\t\t\t)}</i>`\n\t\t\t: message.msg;\n\n\t\tlet filesHTML = '';\n\n\t\tif (message.attachments && message.attachments?.length > 0) {\n\t\t\tmessageContent = message.attachments[0].description || '';\n\n\t\t\tfor await (const attachment of message.attachments) {\n\t\t\t\tif (!isFileAttachment(attachment)) {\n\t\t\t\t\t// ignore other types of attachments\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (!isFileImageAttachment(attachment)) {\n\t\t\t\t\tfilesHTML += `<div>${attachment.title || ''}${InvalidFileMessage}</div>`;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (!attachment.image_type || !acceptableImageMimeTypes.includes(attachment.image_type)) {\n\t\t\t\t\tfilesHTML += `<div>${attachment.title || ''}${InvalidFileMessage}</div>`;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Image attachment can be rendered in email body\n\t\t\t\tconst file = message.files?.find((file) => file.name === attachment.title);\n\n\t\t\t\tif (!file) {\n\t\t\t\t\tfilesHTML += `<div>${attachment.title || ''}${InvalidFileMessage}</div>`;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst uploadedFile = await Uploads.findOneById(file._id);\n\n\t\t\t\tif (!uploadedFile) {\n\t\t\t\t\tfilesHTML += `<div>${file.name}${InvalidFileMessage}</div>`;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst uploadedFileBuffer = await FileUpload.getBuffer(uploadedFile);\n\t\t\t\tfilesHTML += `<div styles=\"color: ${colors.n700}; margin-top: 4px; flex-direction: \"column\";\"><p>${file.name}</p><img src=\"data:${\n\t\t\t\t\tattachment.image_type\n\t\t\t\t};base64,${uploadedFileBuffer.toString(\n\t\t\t\t\t'base64',\n\t\t\t\t)}\" style=\"width: 400px; max-height: 240px; object-fit: contain; object-position: 0;\"/></div>`;\n\t\t\t}\n\t\t}\n\n\t\tconst datetime = moment.tz(message.ts, timezone).locale(userLanguage).format('LLL');\n\t\tconst singleMessage = `\n\t\t\t<p><strong>${author}</strong>  <em>${datetime}</em></p>\n\t\t\t<p>${messageContent}</p>\n\t\t\t<p>${filesHTML}</p>\n\t\t`;\n\t\thtml += singleMessage;\n\t}\n\n\thtml = `${html}</div>`;\n\n\tconst fromEmail = settings.get<string>('From_Email').match(/\\b[A-Z0-9._%+-]+@(?:[A-Z0-9-]+\\.)+[A-Z]{2,4}\\b/i);\n\tlet emailFromRegexp = '';\n\tif (fromEmail) {\n\t\temailFromRegexp = fromEmail[0];\n\t} else {\n\t\temailFromRegexp = settings.get<string>('From_Email');\n\t}\n\n\t// Some endpoints allow the caller to pass a different `subject` via parameter.\n\t// IF subject is passed, we'll use that one and treat it as an override\n\t// IF no subject is passed, we fallback to the setting `Livechat_transcript_email_subject`\n\t// IF that is not configured, we fallback to 'Transcript of your livechat conversation', which is the default value\n\t// As subject and setting value are user input, we don't translate them\n\tconst mailSubject =\n\t\tsubject ||\n\t\tsettings.get<string>('Livechat_transcript_email_subject') ||\n\t\ti18n.t('Transcript_of_your_livechat_conversation', { lng: userLanguage });\n\n\tawait Mailer.send({\n\t\tto: email,\n\t\tfrom: emailFromRegexp,\n\t\treplyTo: emailFromRegexp,\n\t\tsubject: mailSubject,\n\t\thtml,\n\t});\n\n\tsetImmediate(() => {\n\t\tvoid callbacks.run('livechat.sendTranscript', messages, email);\n\t});\n\n\tconst requestData: IOmnichannelSystemMessage['requestData'] = {\n\t\ttype: 'user',\n\t\tvisitor,\n\t\tuser,\n\t};\n\n\tif (!user?.username) {\n\t\tconst cat = await Users.findOneById('rocket.cat', { projection: { _id: 1, username: 1, name: 1 } });\n\t\tif (cat) {\n\t\t\trequestData.user = cat;\n\t\t\trequestData.type = 'visitor';\n\t\t}\n\t}\n\n\tif (!requestData.user) {\n\t\tlogger.error('rocket.cat user not found');\n\t\tthrow new Error('No user provided and rocket.cat not found');\n\t}\n\n\tawait Message.saveSystemMessage<IOmnichannelSystemMessage>('livechat_transcript_history', room._id, '', requestData.user, {\n\t\trequestData,\n\t});\n\n\treturn true;\n}\n"],"names":["sendTranscript","logger","Logger","token","rid","email","subject","user","check","String","debug","room","LivechatRooms","findOneById","visitor","v","Error","userLanguage","settings","get","timezone","getTimezone","t","showAgentInfo","showSystemMessages","closingMessage","Messages","findLivechatClosingMessage","projection","ts","ignoredMessageTypes","acceptableImageMimeTypes","messages","findVisibleByRoomIdNotContainingTypesBeforeTs","Date","sort","html","InvalidFileMessage","colors","n100","n250","i18n","lng","message","author","u","_id","name","username","isSystemMessage","MessageTypes","messageType","getType","messageContent","data","interpolation","escapeValue","msg","filesHTML","attachments","length","description","attachment","isFileAttachment","isFileImageAttachment","title","image_type","includes","file","files","find","uploadedFile","Uploads","uploadedFileBuffer","FileUpload","getBuffer","n700","toString","datetime","moment","tz","locale","format","singleMessage","fromEmail","match","emailFromRegexp","mailSubject","Mailer","send","to","from","replyTo","setImmediate","callbacks","run","requestData","type","cat","Users","error","Message","saveSystemMessage"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/lib/sendTranscript.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"93ebc1eeed2e43cf25afa72b3c1cfa52a3dabf8d","contentHash":"89cab6a7264e7e26319559ddaf3a9fdc0fb004d6364d02e3e69f25ed5bdd5a2f"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-utils/lib/MessageTypes.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-utils/lib/MessageTypes.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":24}},"3":{"start":{"line":11,"column":19},"end":{"line":32,"column":1}},"4":{"start":{"line":13,"column":8},"end":{"line":15,"column":9}},"5":{"start":{"line":14,"column":12},"end":{"line":14,"column":107}},"6":{"start":{"line":16,"column":8},"end":{"line":18,"column":9}},"7":{"start":{"line":17,"column":12},"end":{"line":17,"column":109}},"8":{"start":{"line":19,"column":8},"end":{"line":19,"column":44}},"9":{"start":{"line":20,"column":8},"end":{"line":20,"column":23}},"10":{"start":{"line":23,"column":8},"end":{"line":23,"column":54}},"11":{"start":{"line":26,"column":21},"end":{"line":26,"column":42}},"12":{"start":{"line":27,"column":8},"end":{"line":27,"column":80}},"13":{"start":{"line":30,"column":8},"end":{"line":30,"column":31}},"14":{"start":{"line":33,"column":17},"end":{"line":33,"column":35}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":4},"end":{"line":12,"column":5}},"loc":{"start":{"line":12,"column":26},"end":{"line":21,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":22,"column":4},"end":{"line":22,"column":5}},"loc":{"start":{"line":22,"column":21},"end":{"line":24,"column":5}},"line":22},"3":{"name":"(anonymous_3)","decl":{"start":{"line":25,"column":4},"end":{"line":25,"column":5}},"loc":{"start":{"line":25,"column":29},"end":{"line":28,"column":5}},"line":25},"4":{"name":"(anonymous_4)","decl":{"start":{"line":29,"column":4},"end":{"line":29,"column":5}},"loc":{"start":{"line":29,"column":17},"end":{"line":31,"column":5}},"line":29}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":8},"end":{"line":15,"column":9}},"type":"if","locations":[{"start":{"line":13,"column":8},"end":{"line":15,"column":9}},{"start":{"line":13,"column":8},"end":{"line":15,"column":9}}],"line":13},"1":{"loc":{"start":{"line":16,"column":8},"end":{"line":18,"column":9}},"type":"if","locations":[{"start":{"line":16,"column":8},"end":{"line":18,"column":9}},{"start":{"line":16,"column":8},"end":{"line":18,"column":9}}],"line":16},"2":{"loc":{"start":{"line":23,"column":15},"end":{"line":23,"column":53}},"type":"binary-expr","locations":[{"start":{"line":23,"column":15},"end":{"line":23,"column":24}},{"start":{"line":23,"column":28},"end":{"line":23,"column":53}}],"line":23},"3":{"loc":{"start":{"line":27,"column":23},"end":{"line":27,"column":78}},"type":"cond-expr","locations":[{"start":{"line":27,"column":58},"end":{"line":27,"column":64}},{"start":{"line":27,"column":67},"end":{"line":27,"column":78}}],"line":27},"4":{"loc":{"start":{"line":27,"column":23},"end":{"line":27,"column":55}},"type":"binary-expr","locations":[{"start":{"line":27,"column":23},"end":{"line":27,"column":36}},{"start":{"line":27,"column":40},"end":{"line":27,"column":55}}],"line":27}},"s":{"0":1,"1":1,"2":0,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":1,"14":1},"f":{"0":0,"1":0,"2":0,"3":0,"4":1},"b":{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-utils/lib/MessageTypes.ts"],"sourcesContent":["import type { IMessage, MessageTypesValues } from '@rocket.chat/core-typings';\nimport type { TranslationKey } from '@rocket.chat/ui-contexts';\n\nexport type MessageType = {\n\tid: MessageTypesValues;\n\tsystem?: boolean;\n\t/* deprecated */\n\ttemplate?: (message: IMessage) => unknown;\n\tmessage: TranslationKey;\n\tdata?: (message: IMessage) => Record<string, string>;\n};\n\nclass MessageTypes {\n\tprivate types = new Map<MessageTypesValues, MessageType>();\n\n\tregisterType(options: MessageType): MessageType {\n\t\tif ('render' in options) {\n\t\t\tconsole.warn('MessageType.render is deprecated. Use MessageType.message instead.', options.id);\n\t\t}\n\t\tif ('template' in options) {\n\t\t\tconsole.warn('MessageType.template is deprecated. Use MessageType.message instead.', options.id);\n\t\t}\n\t\tthis.types.set(options.id, options);\n\t\treturn options;\n\t}\n\n\tgetType(message: Pick<IMessage, 't'>): MessageType | undefined {\n\t\treturn message.t && this.types.get(message.t);\n\t}\n\n\tisSystemMessage(message: Pick<IMessage, 't'>): boolean {\n\t\tconst type = this.getType(message);\n\t\treturn Boolean(type?.system);\n\t}\n}\n\nconst instance = new MessageTypes();\n\nexport { instance as MessageTypes };\n"],"names":["MessageTypes","instance","registerType","options","console","warn","id","types","set","getType","message","t","get","isSystemMessage","type","Boolean","system","Map"],"mappings":";;;;+BAsCqBA;;;eAAZC;;;AA1BT,IAAA,AAAMD,eAAN,MAAMA;IAGLE,aAAaC,OAAoB,EAAe;QAC/C,IAAI,YAAYA,SAAS;YACxBC,QAAQC,IAAI,CAAC,sEAAsEF,QAAQG,EAAE;QAC9F;QACA,IAAI,cAAcH,SAAS;YAC1BC,QAAQC,IAAI,CAAC,wEAAwEF,QAAQG,EAAE;QAChG;QACA,IAAI,CAACC,KAAK,CAACC,GAAG,CAACL,QAAQG,EAAE,EAAEH;QAC3B,OAAOA;IACR;IAEAM,QAAQC,OAA4B,EAA2B;QAC9D,OAAOA,QAAQC,CAAC,IAAI,IAAI,CAACJ,KAAK,CAACK,GAAG,CAACF,QAAQC,CAAC;IAC7C;IAEAE,gBAAgBH,OAA4B,EAAW;QACtD,MAAMI,OAAO,IAAI,CAACL,OAAO,CAACC;QAC1B,OAAOK,QAAQD,iBAAAA,2BAAAA,KAAME,MAAM;IAC5B;;aApBQT,QAAQ,IAAIU;;AAqBrB;AAEA,MAAMhB,WAAW,IAAID","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-utils/lib/MessageTypes.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"804ef2c2679d08dfcd4fc53f185d6e8b9ef6a012","contentHash":"cfba11a8062cc270be33533c8ea35040d8b9a611c2c18c0957596d2a076bb961"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/mailer/server/replaceVariables.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/mailer/server/replaceVariables.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":32}},"3":{"start":{"line":11,"column":25},"end":{"line":11,"column":95}},"4":{"start":{"line":11,"column":42},"end":{"line":11,"column":95}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":25},"end":{"line":11,"column":26}},"loc":{"start":{"line":11,"column":42},"end":{"line":11,"column":95}},"line":11}},"branchMap":{},"s":{"0":1,"1":1,"2":9,"3":1,"4":9},"f":{"0":9,"1":9},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/mailer/server/replaceVariables.ts"],"sourcesContent":["export const replaceVariables = (str: string, replacer: (substring: string, key: string) => string): string =>\n\tstr.replace(/\\{ *([^\\{\\} ]+)[^\\{\\}]*\\}/gim, replacer);\n"],"names":["replaceVariables","str","replacer","replace"],"mappings":";;;;+BAAaA;;;eAAAA;;;AAAN,MAAMA,mBAAmB,CAACC,KAAaC,WAC7CD,IAAIE,OAAO,CAAC,gCAAgCD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/mailer/server/replaceVariables.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b95a3e14dddd65c1b06a12092610acbc6304e1cf","contentHash":"c4a1e0226c38c85b7ec368787a12184bee00d67408e668574d0b525bb25fbef3"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/reactions/server/setReaction.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/reactions/server/setReaction.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":21,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":34}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":34}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":27}},"7":{"start":{"line":22,"column":14},"end":{"line":22,"column":42}},"8":{"start":{"line":23,"column":22},"end":{"line":23,"column":59}},"9":{"start":{"line":24,"column":16},"end":{"line":24,"column":46}},"10":{"start":{"line":25,"column":16},"end":{"line":25,"column":40}},"11":{"start":{"line":26,"column":19},"end":{"line":26,"column":52}},"12":{"start":{"line":27,"column":14},"end":{"line":27,"column":49}},"13":{"start":{"line":28,"column":16},"end":{"line":28,"column":53}},"14":{"start":{"line":29,"column":23},"end":{"line":29,"column":84}},"15":{"start":{"line":30,"column":17},"end":{"line":30,"column":46}},"16":{"start":{"line":31,"column":26},"end":{"line":31,"column":80}},"17":{"start":{"line":32,"column":24},"end":{"line":32,"column":70}},"18":{"start":{"line":33,"column":27},"end":{"line":47,"column":1}},"19":{"start":{"line":34,"column":4},"end":{"line":36,"column":5}},"20":{"start":{"line":35,"column":8},"end":{"line":35,"column":23}},"21":{"start":{"line":37,"column":16},"end":{"line":37,"column":71}},"22":{"start":{"line":39,"column":4},"end":{"line":41,"column":5}},"23":{"start":{"line":40,"column":8},"end":{"line":40,"column":23}},"24":{"start":{"line":42,"column":4},"end":{"line":42,"column":57}},"25":{"start":{"line":43,"column":4},"end":{"line":45,"column":5}},"26":{"start":{"line":44,"column":8},"end":{"line":44,"column":43}},"27":{"start":{"line":46,"column":4},"end":{"line":46,"column":19}},"28":{"start":{"line":50,"column":4},"end":{"line":50,"column":61}},"29":{"start":{"line":51,"column":4},"end":{"line":57,"column":5}},"30":{"start":{"line":52,"column":8},"end":{"line":56,"column":11}},"31":{"start":{"line":58,"column":4},"end":{"line":63,"column":5}},"32":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"33":{"start":{"line":61,"column":12},"end":{"line":61,"column":85}},"34":{"start":{"line":65,"column":4},"end":{"line":107,"column":5}},"35":{"start":{"line":66,"column":27},"end":{"line":66,"column":62}},"36":{"start":{"line":67,"column":8},"end":{"line":67,"column":61}},"37":{"start":{"line":68,"column":8},"end":{"line":79,"column":9}},"38":{"start":{"line":69,"column":12},"end":{"line":69,"column":37}},"39":{"start":{"line":70,"column":12},"end":{"line":70,"column":63}},"40":{"start":{"line":71,"column":12},"end":{"line":73,"column":13}},"41":{"start":{"line":72,"column":16},"end":{"line":72,"column":74}},"42":{"start":{"line":75,"column":12},"end":{"line":75,"column":80}},"43":{"start":{"line":76,"column":12},"end":{"line":78,"column":13}},"44":{"start":{"line":77,"column":16},"end":{"line":77,"column":91}},"45":{"start":{"line":80,"column":8},"end":{"line":85,"column":11}},"46":{"start":{"line":86,"column":8},"end":{"line":86,"column":26}},"47":{"start":{"line":88,"column":8},"end":{"line":90,"column":9}},"48":{"start":{"line":89,"column":12},"end":{"line":89,"column":35}},"49":{"start":{"line":91,"column":8},"end":{"line":95,"column":9}},"50":{"start":{"line":92,"column":12},"end":{"line":94,"column":14}},"51":{"start":{"line":96,"column":8},"end":{"line":96,"column":66}},"52":{"start":{"line":97,"column":8},"end":{"line":97,"column":76}},"53":{"start":{"line":98,"column":8},"end":{"line":100,"column":9}},"54":{"start":{"line":99,"column":12},"end":{"line":99,"column":87}},"55":{"start":{"line":101,"column":8},"end":{"line":105,"column":11}},"56":{"start":{"line":106,"column":8},"end":{"line":106,"column":25}},"57":{"start":{"line":108,"column":4},"end":{"line":108,"column":184}},"58":{"start":{"line":109,"column":4},"end":{"line":111,"column":7}},"59":{"start":{"line":115,"column":34},"end":{"line":115,"column":60}},"60":{"start":{"line":116,"column":4},"end":{"line":116,"column":44}},"61":{"start":{"line":117,"column":4},"end":{"line":121,"column":5}},"62":{"start":{"line":118,"column":8},"end":{"line":120,"column":11}},"63":{"start":{"line":122,"column":17},"end":{"line":122,"column":56}},"64":{"start":{"line":123,"column":4},"end":{"line":127,"column":5}},"65":{"start":{"line":124,"column":8},"end":{"line":126,"column":11}},"66":{"start":{"line":128,"column":20},"end":{"line":128,"column":118}},"67":{"start":{"line":129,"column":4},"end":{"line":133,"column":5}},"68":{"start":{"line":130,"column":8},"end":{"line":132,"column":11}},"69":{"start":{"line":134,"column":31},"end":{"line":134,"column":153}},"70":{"start":{"line":136,"column":4},"end":{"line":138,"column":5}},"71":{"start":{"line":137,"column":8},"end":{"line":137,"column":42}},"72":{"start":{"line":139,"column":4},"end":{"line":141,"column":5}},"73":{"start":{"line":140,"column":8},"end":{"line":140,"column":15}},"74":{"start":{"line":142,"column":17},"end":{"line":153,"column":6}},"75":{"start":{"line":154,"column":4},"end":{"line":158,"column":5}},"76":{"start":{"line":155,"column":8},"end":{"line":157,"column":11}},"77":{"start":{"line":159,"column":4},"end":{"line":163,"column":5}},"78":{"start":{"line":160,"column":8},"end":{"line":162,"column":11}},"79":{"start":{"line":164,"column":4},"end":{"line":164,"column":74}},"80":{"start":{"line":166,"column":0},"end":{"line":186,"column":3}},"81":{"start":{"line":168,"column":20},"end":{"line":168,"column":43}},"82":{"start":{"line":169,"column":8},"end":{"line":173,"column":9}},"83":{"start":{"line":170,"column":12},"end":{"line":172,"column":15}},"84":{"start":{"line":174,"column":8},"end":{"line":184,"column":9}},"85":{"start":{"line":175,"column":12},"end":{"line":175,"column":76}},"86":{"start":{"line":177,"column":12},"end":{"line":182,"column":13}},"87":{"start":{"line":178,"column":16},"end":{"line":180,"column":19}},"88":{"start":{"line":181,"column":16},"end":{"line":181,"column":29}},"89":{"start":{"line":183,"column":12},"end":{"line":183,"column":20}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":24},"end":{"line":12,"column":25}},"loc":{"start":{"line":12,"column":35},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":24},"end":{"line":15,"column":25}},"loc":{"start":{"line":15,"column":35},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":17},"end":{"line":18,"column":18}},"loc":{"start":{"line":18,"column":28},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":33,"column":27},"end":{"line":33,"column":28}},"loc":{"start":{"line":33,"column":58},"end":{"line":47,"column":1}},"line":33},"5":{"name":"setReaction","decl":{"start":{"line":48,"column":15},"end":{"line":48,"column":26}},"loc":{"start":{"line":48,"column":78},"end":{"line":112,"column":1}},"line":48},"6":{"name":"executeSetReaction","decl":{"start":{"line":113,"column":15},"end":{"line":113,"column":33}},"loc":{"start":{"line":113,"column":79},"end":{"line":165,"column":1}},"line":113},"7":{"name":"(anonymous_7)","decl":{"start":{"line":167,"column":4},"end":{"line":167,"column":5}},"loc":{"start":{"line":167,"column":57},"end":{"line":185,"column":5}},"line":167}},"branchMap":{"0":{"loc":{"start":{"line":34,"column":4},"end":{"line":36,"column":5}},"type":"if","locations":[{"start":{"line":34,"column":4},"end":{"line":36,"column":5}},{"start":{"line":34,"column":4},"end":{"line":36,"column":5}}],"line":34},"1":{"loc":{"start":{"line":39,"column":4},"end":{"line":41,"column":5}},"type":"if","locations":[{"start":{"line":39,"column":4},"end":{"line":41,"column":5}},{"start":{"line":39,"column":4},"end":{"line":41,"column":5}}],"line":39},"2":{"loc":{"start":{"line":43,"column":4},"end":{"line":45,"column":5}},"type":"if","locations":[{"start":{"line":43,"column":4},"end":{"line":45,"column":5}},{"start":{"line":43,"column":4},"end":{"line":45,"column":5}}],"line":43},"3":{"loc":{"start":{"line":51,"column":4},"end":{"line":57,"column":5}},"type":"if","locations":[{"start":{"line":51,"column":4},"end":{"line":57,"column":5}},{"start":{"line":51,"column":4},"end":{"line":57,"column":5}}],"line":51},"4":{"loc":{"start":{"line":51,"column":8},"end":{"line":51,"column":71}},"type":"binary-expr","locations":[{"start":{"line":51,"column":8},"end":{"line":51,"column":33}},{"start":{"line":51,"column":37},"end":{"line":51,"column":71}}],"line":51},"5":{"loc":{"start":{"line":58,"column":4},"end":{"line":63,"column":5}},"type":"if","locations":[{"start":{"line":58,"column":4},"end":{"line":63,"column":5}},{"start":{"line":58,"column":4},"end":{"line":63,"column":5}}],"line":58},"6":{"loc":{"start":{"line":58,"column":8},"end":{"line":58,"column":137}},"type":"binary-expr","locations":[{"start":{"line":58,"column":8},"end":{"line":58,"column":24}},{"start":{"line":58,"column":28},"end":{"line":58,"column":51}},{"start":{"line":58,"column":55},"end":{"line":58,"column":137}}],"line":58},"7":{"loc":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"type":"if","locations":[{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},{"start":{"line":60,"column":8},"end":{"line":62,"column":9}}],"line":60},"8":{"loc":{"start":{"line":60,"column":14},"end":{"line":60,"column":32}},"type":"binary-expr","locations":[{"start":{"line":60,"column":14},"end":{"line":60,"column":26}},{"start":{"line":60,"column":30},"end":{"line":60,"column":32}}],"line":60},"9":{"loc":{"start":{"line":65,"column":4},"end":{"line":107,"column":5}},"type":"if","locations":[{"start":{"line":65,"column":4},"end":{"line":107,"column":5}},{"start":{"line":65,"column":4},"end":{"line":107,"column":5}}],"line":65},"10":{"loc":{"start":{"line":68,"column":8},"end":{"line":79,"column":9}},"type":"if","locations":[{"start":{"line":68,"column":8},"end":{"line":79,"column":9}},{"start":{"line":68,"column":8},"end":{"line":79,"column":9}}],"line":68},"11":{"loc":{"start":{"line":68,"column":24},"end":{"line":68,"column":47}},"type":"binary-expr","locations":[{"start":{"line":68,"column":24},"end":{"line":68,"column":41}},{"start":{"line":68,"column":45},"end":{"line":68,"column":47}}],"line":68},"12":{"loc":{"start":{"line":71,"column":12},"end":{"line":73,"column":13}},"type":"if","locations":[{"start":{"line":71,"column":12},"end":{"line":73,"column":13}},{"start":{"line":71,"column":12},"end":{"line":73,"column":13}}],"line":71},"13":{"loc":{"start":{"line":76,"column":12},"end":{"line":78,"column":13}},"type":"if","locations":[{"start":{"line":76,"column":12},"end":{"line":78,"column":13}},{"start":{"line":76,"column":12},"end":{"line":78,"column":13}}],"line":76},"14":{"loc":{"start":{"line":88,"column":8},"end":{"line":90,"column":9}},"type":"if","locations":[{"start":{"line":88,"column":8},"end":{"line":90,"column":9}},{"start":{"line":88,"column":8},"end":{"line":90,"column":9}}],"line":88},"15":{"loc":{"start":{"line":91,"column":8},"end":{"line":95,"column":9}},"type":"if","locations":[{"start":{"line":91,"column":8},"end":{"line":95,"column":9}},{"start":{"line":91,"column":8},"end":{"line":95,"column":9}}],"line":91},"16":{"loc":{"start":{"line":98,"column":8},"end":{"line":100,"column":9}},"type":"if","locations":[{"start":{"line":98,"column":8},"end":{"line":100,"column":9}},{"start":{"line":98,"column":8},"end":{"line":100,"column":9}}],"line":98},"17":{"loc":{"start":{"line":108,"column":10},"end":{"line":108,"column":182}},"type":"cond-expr","locations":[{"start":{"line":108,"column":77},"end":{"line":108,"column":83}},{"start":{"line":108,"column":86},"end":{"line":108,"column":182}}],"line":108},"18":{"loc":{"start":{"line":108,"column":10},"end":{"line":108,"column":74}},"type":"binary-expr","locations":[{"start":{"line":108,"column":10},"end":{"line":108,"column":49}},{"start":{"line":108,"column":53},"end":{"line":108,"column":74}}],"line":108},"19":{"loc":{"start":{"line":117,"column":4},"end":{"line":121,"column":5}},"type":"if","locations":[{"start":{"line":117,"column":4},"end":{"line":121,"column":5}},{"start":{"line":117,"column":4},"end":{"line":121,"column":5}}],"line":117},"20":{"loc":{"start":{"line":117,"column":8},"end":{"line":117,"column":115}},"type":"binary-expr","locations":[{"start":{"line":117,"column":8},"end":{"line":117,"column":38}},{"start":{"line":117,"column":42},"end":{"line":117,"column":115}}],"line":117},"21":{"loc":{"start":{"line":123,"column":4},"end":{"line":127,"column":5}},"type":"if","locations":[{"start":{"line":123,"column":4},"end":{"line":127,"column":5}},{"start":{"line":123,"column":4},"end":{"line":127,"column":5}}],"line":123},"22":{"loc":{"start":{"line":128,"column":20},"end":{"line":128,"column":118}},"type":"cond-expr","locations":[{"start":{"line":128,"column":55},"end":{"line":128,"column":103}},{"start":{"line":128,"column":106},"end":{"line":128,"column":118}}],"line":128},"23":{"loc":{"start":{"line":129,"column":4},"end":{"line":133,"column":5}},"type":"if","locations":[{"start":{"line":129,"column":4},"end":{"line":133,"column":5}},{"start":{"line":129,"column":4},"end":{"line":133,"column":5}}],"line":129},"24":{"loc":{"start":{"line":134,"column":31},"end":{"line":134,"column":153}},"type":"binary-expr","locations":[{"start":{"line":134,"column":31},"end":{"line":134,"column":48}},{"start":{"line":134,"column":52},"end":{"line":134,"column":88}},{"start":{"line":134,"column":92},"end":{"line":134,"column":153}}],"line":134},"25":{"loc":{"start":{"line":136,"column":4},"end":{"line":138,"column":5}},"type":"if","locations":[{"start":{"line":136,"column":4},"end":{"line":138,"column":5}},{"start":{"line":136,"column":4},"end":{"line":138,"column":5}}],"line":136},"26":{"loc":{"start":{"line":139,"column":4},"end":{"line":141,"column":5}},"type":"if","locations":[{"start":{"line":139,"column":4},"end":{"line":141,"column":5}},{"start":{"line":139,"column":4},"end":{"line":141,"column":5}}],"line":139},"27":{"loc":{"start":{"line":154,"column":4},"end":{"line":158,"column":5}},"type":"if","locations":[{"start":{"line":154,"column":4},"end":{"line":158,"column":5}},{"start":{"line":154,"column":4},"end":{"line":158,"column":5}}],"line":154},"28":{"loc":{"start":{"line":159,"column":4},"end":{"line":163,"column":5}},"type":"if","locations":[{"start":{"line":159,"column":4},"end":{"line":163,"column":5}},{"start":{"line":159,"column":4},"end":{"line":163,"column":5}}],"line":159},"29":{"loc":{"start":{"line":169,"column":8},"end":{"line":173,"column":9}},"type":"if","locations":[{"start":{"line":169,"column":8},"end":{"line":173,"column":9}},{"start":{"line":169,"column":8},"end":{"line":173,"column":9}}],"line":169},"30":{"loc":{"start":{"line":177,"column":12},"end":{"line":182,"column":13}},"type":"if","locations":[{"start":{"line":177,"column":12},"end":{"line":182,"column":13}},{"start":{"line":177,"column":12},"end":{"line":182,"column":13}}],"line":177},"31":{"loc":{"start":{"line":177,"column":16},"end":{"line":177,"column":89}},"type":"binary-expr","locations":[{"start":{"line":177,"column":16},"end":{"line":177,"column":47}},{"start":{"line":177,"column":51},"end":{"line":177,"column":59}},{"start":{"line":177,"column":63},"end":{"line":177,"column":72}},{"start":{"line":177,"column":76},"end":{"line":177,"column":89}}],"line":177}},"s":{"0":1,"1":1,"2":3,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":12,"20":1,"21":11,"22":11,"23":1,"24":10,"25":10,"26":8,"27":10,"28":14,"29":14,"30":1,"31":13,"32":1,"33":1,"34":12,"35":7,"36":7,"37":7,"38":5,"39":5,"40":5,"41":1,"42":2,"43":2,"44":1,"45":7,"46":7,"47":5,"48":4,"49":5,"50":4,"51":5,"52":5,"53":5,"54":1,"55":5,"56":5,"57":12,"58":12,"59":9,"60":9,"61":9,"62":1,"63":8,"64":8,"65":1,"66":7,"67":7,"68":1,"69":6,"70":6,"71":4,"72":6,"73":2,"74":4,"75":4,"76":1,"77":3,"78":1,"79":2,"80":1,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0},"f":{"0":1,"1":1,"2":1,"3":1,"4":12,"5":14,"6":9,"7":0},"b":{"0":[1,11],"1":[1,10],"2":[8,2],"3":[1,13],"4":[14,1],"5":[1,12],"6":[13,1,1],"7":[1,0],"8":[1,1],"9":[7,5],"10":[5,2],"11":[7,0],"12":[1,4],"13":[1,1],"14":[4,1],"15":[4,1],"16":[1,4],"17":[12,0],"18":[12,12],"19":[1,8],"20":[9,9],"21":[1,7],"22":[6,1],"23":[1,6],"24":[6,6,6],"25":[4,2],"26":[2,4],"27":[1,3],"28":[1,2],"29":[0,0],"30":[0,0],"31":[0,0,0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/reactions/server/setReaction.ts"],"sourcesContent":["import { Apps, AppEvents } from '@rocket.chat/apps';\nimport { api, Message } from '@rocket.chat/core-services';\nimport type { IMessage, IRoom, IUser } from '@rocket.chat/core-typings';\nimport type { ServerMethods } from '@rocket.chat/ddp-client';\nimport { Messages, EmojiCustom, Rooms, Users } from '@rocket.chat/models';\nimport { Meteor } from 'meteor/meteor';\n\nimport { callbacks } from '../../../lib/callbacks';\nimport { i18n } from '../../../server/lib/i18n';\nimport { canAccessRoomAsync } from '../../authorization/server';\nimport { hasPermissionAsync } from '../../authorization/server/functions/hasPermission';\nimport { emoji } from '../../emoji/server';\nimport { isTheLastMessage } from '../../lib/server/functions/isTheLastMessage';\nimport { notifyOnMessageChange } from '../../lib/server/lib/notifyListener';\n\nexport const removeUserReaction = (message: IMessage, reaction: string, username: string) => {\n\tif (!message.reactions) {\n\t\treturn message;\n\t}\n\n\tconst idx = message.reactions[reaction].usernames.indexOf(username);\n\n\t// user not found in reaction array\n\tif (idx === -1) {\n\t\treturn message;\n\t}\n\n\tmessage.reactions[reaction].usernames.splice(idx, 1);\n\tif (!message.reactions[reaction].usernames.length) {\n\t\tdelete message.reactions[reaction];\n\t}\n\treturn message;\n};\n\nexport async function setReaction(\n\troom: Pick<IRoom, '_id' | 'muted' | 'unmuted' | 'reactWhenReadOnly' | 'ro' | 'lastMessage' | 'federated'>,\n\tuser: IUser,\n\tmessage: IMessage,\n\treaction: string,\n\tuserAlreadyReacted?: boolean,\n) {\n\tawait Message.beforeReacted(message, room);\n\n\tif (Array.isArray(room.muted) && room.muted.includes(user.username as string)) {\n\t\tthrow new Meteor.Error('error-not-allowed', i18n.t('You_have_been_muted', { lng: user.language }), {\n\t\t\trid: room._id,\n\t\t});\n\t}\n\n\tif (room.ro === true && !room.reactWhenReadOnly && !(await hasPermissionAsync(user._id, 'post-readonly', room._id))) {\n\t\t// Unless the user was manually unmuted\n\t\tif (!(room.unmuted || []).includes(user.username as string)) {\n\t\t\tthrow new Error(\"You can't send messages because the room is readonly.\");\n\t\t}\n\t}\n\n\tlet isReacted;\n\tif (userAlreadyReacted) {\n\t\tconst oldMessage = JSON.parse(JSON.stringify(message));\n\t\tremoveUserReaction(message, reaction, user.username as string);\n\t\tif (Object.keys(message.reactions || {}).length === 0) {\n\t\t\tdelete message.reactions;\n\t\t\tawait Messages.unsetReactions(message._id);\n\t\t\tif (isTheLastMessage(room, message)) {\n\t\t\t\tawait Rooms.unsetReactionsInLastMessage(room._id);\n\t\t\t}\n\t\t} else {\n\t\t\tawait Messages.setReactions(message._id, message.reactions);\n\t\t\tif (isTheLastMessage(room, message)) {\n\t\t\t\tawait Rooms.setReactionsInLastMessage(room._id, message.reactions);\n\t\t\t}\n\t\t}\n\t\tvoid callbacks.run('afterUnsetReaction', message, { user, reaction, shouldReact: false, oldMessage });\n\n\t\tisReacted = false;\n\t} else {\n\t\tif (!message.reactions) {\n\t\t\tmessage.reactions = {};\n\t\t}\n\t\tif (!message.reactions[reaction]) {\n\t\t\tmessage.reactions[reaction] = {\n\t\t\t\tusernames: [],\n\t\t\t};\n\t\t}\n\t\tmessage.reactions[reaction].usernames.push(user.username as string);\n\t\tawait Messages.setReactions(message._id, message.reactions);\n\t\tif (isTheLastMessage(room, message)) {\n\t\t\tawait Rooms.setReactionsInLastMessage(room._id, message.reactions);\n\t\t}\n\n\t\tvoid callbacks.run('afterSetReaction', message, { user, reaction, shouldReact: true });\n\n\t\tisReacted = true;\n\t}\n\n\tvoid Apps.self?.triggerEvent(AppEvents.IPostMessageReacted, message, user, reaction, isReacted);\n\n\tvoid notifyOnMessageChange({\n\t\tid: message._id,\n\t});\n}\n\nexport async function executeSetReaction(\n\tuserId: string,\n\treaction: string,\n\tmessageParam: IMessage['_id'] | IMessage,\n\tshouldReact?: boolean,\n) {\n\t// Check if the emoji is valid before proceeding\n\tconst reactionWithoutColons = reaction.replace(/:/g, '');\n\treaction = `:${reactionWithoutColons}:`;\n\n\tif (!emoji.list[reaction] && (await EmojiCustom.countByNameOrAlias(reactionWithoutColons)) === 0) {\n\t\tthrow new Meteor.Error('error-not-allowed', 'Invalid emoji provided.', {\n\t\t\tmethod: 'setReaction',\n\t\t});\n\t}\n\n\tconst user = await Users.findOneById(userId);\n\tif (!user) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setReaction' });\n\t}\n\n\tconst message = typeof messageParam === 'string' ? await Messages.findOneById(messageParam) : messageParam;\n\tif (!message) {\n\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'setReaction' });\n\t}\n\n\tconst userAlreadyReacted =\n\t\tmessage.reactions && Boolean(message.reactions[reaction]) && message.reactions[reaction].usernames.includes(user.username as string);\n\n\t// When shouldReact was not informed, toggle the reaction.\n\tif (shouldReact === undefined) {\n\t\tshouldReact = !userAlreadyReacted;\n\t}\n\n\tif (userAlreadyReacted === shouldReact) {\n\t\treturn;\n\t}\n\n\tconst room = await Rooms.findOneById<\n\t\tPick<IRoom, '_id' | 'ro' | 'muted' | 'reactWhenReadOnly' | 'lastMessage' | 't' | 'prid' | 'federated'>\n\t>(message.rid, { projection: { _id: 1, ro: 1, muted: 1, reactWhenReadOnly: 1, lastMessage: 1, t: 1, prid: 1, federated: 1 } });\n\tif (!room) {\n\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'setReaction' });\n\t}\n\n\tif (!(await canAccessRoomAsync(room, user))) {\n\t\tthrow new Meteor.Error('not-authorized', 'Not Authorized', { method: 'setReaction' });\n\t}\n\n\treturn setReaction(room, user, message, reaction, userAlreadyReacted);\n}\n\ndeclare module '@rocket.chat/ddp-client' {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface ServerMethods {\n\t\tsetReaction(reaction: string, messageId: IMessage['_id'], shouldReact?: boolean): boolean | undefined;\n\t}\n}\n\nMeteor.methods<ServerMethods>({\n\tasync setReaction(reaction, messageId, shouldReact) {\n\t\tconst uid = Meteor.userId();\n\t\tif (!uid) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setReaction' });\n\t\t}\n\n\t\ttry {\n\t\t\tawait executeSetReaction(uid, reaction, messageId, shouldReact);\n\t\t} catch (e: any) {\n\t\t\tif (e.error === 'error-not-allowed' && e.reason && e.details && e.details.rid) {\n\t\t\t\tvoid api.broadcast('notify.ephemeralMessage', uid, e.details.rid, {\n\t\t\t\t\tmsg: e.reason,\n\t\t\t\t});\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthrow e;\n\t\t}\n\t},\n});\n"],"names":["executeSetReaction","removeUserReaction","setReaction","message","reaction","username","reactions","idx","usernames","indexOf","splice","length","room","user","userAlreadyReacted","Apps","Message","beforeReacted","Array","isArray","muted","includes","Meteor","Error","i18n","t","lng","language","rid","_id","ro","reactWhenReadOnly","hasPermissionAsync","unmuted","isReacted","oldMessage","JSON","parse","stringify","Object","keys","Messages","unsetReactions","isTheLastMessage","Rooms","unsetReactionsInLastMessage","setReactions","setReactionsInLastMessage","callbacks","run","shouldReact","push","self","triggerEvent","AppEvents","IPostMessageReacted","notifyOnMessageChange","id","userId","messageParam","reactionWithoutColons","replace","emoji","list","EmojiCustom","countByNameOrAlias","method","Users","findOneById","Boolean","undefined","projection","lastMessage","prid","federated","canAccessRoomAsync","methods","messageId","uid","e","error","reason","details","api","broadcast","msg"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/reactions/server/setReaction.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e03dfc9e8dfe10ecbdddc3861a1c5d56f182e46a","contentHash":"50b832fac0218d3d8f4c1c8eabc186b7d61238d6d742eb3ab4ffde12ef313c34"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/restrictions.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/restrictions.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":56}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":40}},"6":{"start":{"line":19,"column":33},"end":{"line":27,"column":1}},"7":{"start":{"line":20,"column":31},"end":{"line":20,"column":46}},"8":{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},"9":{"start":{"line":22,"column":8},"end":{"line":22,"column":15}},"10":{"start":{"line":24,"column":4},"end":{"line":26,"column":7}},"11":{"start":{"line":25,"column":8},"end":{"line":25,"column":27}},"12":{"start":{"line":28,"column":33},"end":{"line":34,"column":1}},"13":{"start":{"line":29,"column":22},"end":{"line":29,"column":37}},"14":{"start":{"line":30,"column":4},"end":{"line":32,"column":5}},"15":{"start":{"line":31,"column":8},"end":{"line":31,"column":15}},"16":{"start":{"line":33,"column":4},"end":{"line":33,"column":57}},"17":{"start":{"line":33,"column":44},"end":{"line":33,"column":55}},"18":{"start":{"line":35,"column":21},"end":{"line":50,"column":1}},"19":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"20":{"start":{"line":37,"column":8},"end":{"line":37,"column":21}},"21":{"start":{"line":39,"column":4},"end":{"line":41,"column":5}},"22":{"start":{"line":40,"column":8},"end":{"line":40,"column":20}},"23":{"start":{"line":42,"column":25},"end":{"line":42,"column":29}},"24":{"start":{"line":43,"column":22},"end":{"line":45,"column":6}},"25":{"start":{"line":44,"column":8},"end":{"line":44,"column":46}},"26":{"start":{"line":46,"column":4},"end":{"line":48,"column":5}},"27":{"start":{"line":47,"column":8},"end":{"line":47,"column":20}},"28":{"start":{"line":49,"column":4},"end":{"line":49,"column":17}},"29":{"start":{"line":51,"column":49},"end":{"line":64,"column":1}},"30":{"start":{"line":52,"column":22},"end":{"line":52,"column":63}},"31":{"start":{"line":53,"column":22},"end":{"line":53,"column":63}},"32":{"start":{"line":54,"column":4},"end":{"line":56,"column":5}},"33":{"start":{"line":55,"column":8},"end":{"line":55,"column":21}},"34":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"35":{"start":{"line":58,"column":8},"end":{"line":58,"column":45}},"36":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"37":{"start":{"line":61,"column":8},"end":{"line":61,"column":20}},"38":{"start":{"line":63,"column":4},"end":{"line":63,"column":17}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":46},"end":{"line":12,"column":47}},"loc":{"start":{"line":12,"column":57},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":30},"end":{"line":15,"column":31}},"loc":{"start":{"line":15,"column":41},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":19,"column":33},"end":{"line":19,"column":34}},"loc":{"start":{"line":19,"column":59},"end":{"line":27,"column":1}},"line":19},"4":{"name":"(anonymous_4)","decl":{"start":{"line":24,"column":45},"end":{"line":24,"column":46}},"loc":{"start":{"line":24,"column":53},"end":{"line":26,"column":5}},"line":24},"5":{"name":"(anonymous_5)","decl":{"start":{"line":28,"column":33},"end":{"line":28,"column":34}},"loc":{"start":{"line":28,"column":59},"end":{"line":34,"column":1}},"line":28},"6":{"name":"(anonymous_6)","decl":{"start":{"line":33,"column":36},"end":{"line":33,"column":37}},"loc":{"start":{"line":33,"column":44},"end":{"line":33,"column":55}},"line":33},"7":{"name":"(anonymous_7)","decl":{"start":{"line":35,"column":21},"end":{"line":35,"column":22}},"loc":{"start":{"line":35,"column":42},"end":{"line":50,"column":1}},"line":35},"8":{"name":"(anonymous_8)","decl":{"start":{"line":43,"column":34},"end":{"line":43,"column":35}},"loc":{"start":{"line":43,"column":42},"end":{"line":45,"column":5}},"line":43},"9":{"name":"(anonymous_9)","decl":{"start":{"line":51,"column":49},"end":{"line":51,"column":50}},"loc":{"start":{"line":51,"column":98},"end":{"line":64,"column":1}},"line":51}},"branchMap":{"0":{"loc":{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},{"start":{"line":21,"column":4},"end":{"line":23,"column":5}}],"line":21},"1":{"loc":{"start":{"line":21,"column":8},"end":{"line":21,"column":57}},"type":"binary-expr","locations":[{"start":{"line":21,"column":8},"end":{"line":21,"column":27}},{"start":{"line":21,"column":31},"end":{"line":21,"column":57}}],"line":21},"2":{"loc":{"start":{"line":30,"column":4},"end":{"line":32,"column":5}},"type":"if","locations":[{"start":{"line":30,"column":4},"end":{"line":32,"column":5}},{"start":{"line":30,"column":4},"end":{"line":32,"column":5}}],"line":30},"3":{"loc":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},{"start":{"line":36,"column":4},"end":{"line":38,"column":5}}],"line":36},"4":{"loc":{"start":{"line":36,"column":8},"end":{"line":36,"column":22}},"type":"binary-expr","locations":[{"start":{"line":36,"column":8},"end":{"line":36,"column":13}},{"start":{"line":36,"column":17},"end":{"line":36,"column":22}}],"line":36},"5":{"loc":{"start":{"line":39,"column":4},"end":{"line":41,"column":5}},"type":"if","locations":[{"start":{"line":39,"column":4},"end":{"line":41,"column":5}},{"start":{"line":39,"column":4},"end":{"line":41,"column":5}}],"line":39},"6":{"loc":{"start":{"line":46,"column":4},"end":{"line":48,"column":5}},"type":"if","locations":[{"start":{"line":46,"column":4},"end":{"line":48,"column":5}},{"start":{"line":46,"column":4},"end":{"line":48,"column":5}}],"line":46},"7":{"loc":{"start":{"line":54,"column":4},"end":{"line":56,"column":5}},"type":"if","locations":[{"start":{"line":54,"column":4},"end":{"line":56,"column":5}},{"start":{"line":54,"column":4},"end":{"line":56,"column":5}}],"line":54},"8":{"loc":{"start":{"line":54,"column":8},"end":{"line":54,"column":58}},"type":"binary-expr","locations":[{"start":{"line":54,"column":8},"end":{"line":54,"column":17}},{"start":{"line":54,"column":21},"end":{"line":54,"column":25}},{"start":{"line":54,"column":29},"end":{"line":54,"column":58}}],"line":54},"9":{"loc":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"type":"if","locations":[{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},{"start":{"line":57,"column":4},"end":{"line":59,"column":5}}],"line":57},"10":{"loc":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"type":"if","locations":[{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},{"start":{"line":60,"column":4},"end":{"line":62,"column":5}}],"line":60}},"s":{"0":1,"1":1,"2":2,"3":1,"4":11,"5":0,"6":1,"7":11,"8":11,"9":6,"10":5,"11":5,"12":1,"13":11,"14":11,"15":7,"16":4,"17":4,"18":1,"19":9,"20":1,"21":8,"22":2,"23":6,"24":6,"25":6,"26":6,"27":2,"28":4,"29":1,"30":11,"31":11,"32":11,"33":2,"34":9,"35":5,"36":4,"37":4,"38":0},"f":{"0":1,"1":11,"2":0,"3":11,"4":5,"5":11,"6":4,"7":9,"8":6,"9":11},"b":{"0":[6,5],"1":[11,5],"2":[7,4],"3":[1,8],"4":[9,8],"5":[2,6],"6":[2,4],"7":[2,9],"8":[11,4,4],"9":[5,4],"10":[4,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/restrictions.ts"],"sourcesContent":["export const fileUploadMediaWhiteList = function (customWhiteList: string): string[] | undefined {\n\tconst mediaTypeWhiteList = customWhiteList;\n\n\tif (!mediaTypeWhiteList || mediaTypeWhiteList === '*') {\n\t\treturn;\n\t}\n\treturn mediaTypeWhiteList.split(',').map((item) => {\n\t\treturn item.trim();\n\t});\n};\n\nconst fileUploadMediaBlackList = function (customBlackList: string): string[] | undefined {\n\tconst blacklist = customBlackList;\n\tif (!blacklist) {\n\t\treturn;\n\t}\n\n\treturn blacklist.split(',').map((item) => item.trim());\n};\n\nconst isTypeOnList = function (type?: string, list?: string[]): boolean {\n\tif (!type || !list) {\n\t\treturn false;\n\t}\n\n\tif (list.includes(type)) {\n\t\treturn true;\n\t}\n\tconst wildCardGlob = '/*';\n\tconst wildcards = list.filter((item) => {\n\t\treturn item.indexOf(wildCardGlob) > 0;\n\t});\n\tif (wildcards.includes(type.replace(/(\\/.*)$/, wildCardGlob))) {\n\t\treturn true;\n\t}\n\n\treturn false;\n};\n\nexport const fileUploadIsValidContentTypeFromSettings = function (\n\ttype: string | undefined,\n\tcustomWhiteList: string,\n\tcustomBlackList: string,\n): boolean {\n\tconst blackList = fileUploadMediaBlackList(customBlackList);\n\tconst whiteList = fileUploadMediaWhiteList(customWhiteList);\n\n\tif (blackList && type && isTypeOnList(type, blackList)) {\n\t\treturn false;\n\t}\n\n\tif (whiteList) {\n\t\treturn isTypeOnList(type, whiteList);\n\t}\n\n\tif (!whiteList) {\n\t\treturn true;\n\t}\n\n\treturn false;\n};\n"],"names":["fileUploadIsValidContentTypeFromSettings","fileUploadMediaWhiteList","customWhiteList","mediaTypeWhiteList","split","map","item","trim","fileUploadMediaBlackList","customBlackList","blacklist","isTypeOnList","type","list","includes","wildCardGlob","wildcards","filter","indexOf","replace","blackList","whiteList"],"mappings":";;;;;;;;;;;IAuCaA,wCAAwC;eAAxCA;;IAvCAC,wBAAwB;eAAxBA;;;AAAN,MAAMA,2BAA2B,SAAUC,eAAuB;IACxE,MAAMC,qBAAqBD;IAE3B,IAAI,CAACC,sBAAsBA,uBAAuB,KAAK;QACtD;IACD;IACA,OAAOA,mBAAmBC,KAAK,CAAC,KAAKC,GAAG,CAAC,CAACC;QACzC,OAAOA,KAAKC,IAAI;IACjB;AACD;AAEA,MAAMC,2BAA2B,SAAUC,eAAuB;IACjE,MAAMC,YAAYD;IAClB,IAAI,CAACC,WAAW;QACf;IACD;IAEA,OAAOA,UAAUN,KAAK,CAAC,KAAKC,GAAG,CAAC,CAACC,OAASA,KAAKC,IAAI;AACpD;AAEA,MAAMI,eAAe,SAAUC,IAAa,EAAEC,IAAe;IAC5D,IAAI,CAACD,QAAQ,CAACC,MAAM;QACnB,OAAO;IACR;IAEA,IAAIA,KAAKC,QAAQ,CAACF,OAAO;QACxB,OAAO;IACR;IACA,MAAMG,eAAe;IACrB,MAAMC,YAAYH,KAAKI,MAAM,CAAC,CAACX;QAC9B,OAAOA,KAAKY,OAAO,CAACH,gBAAgB;IACrC;IACA,IAAIC,UAAUF,QAAQ,CAACF,KAAKO,OAAO,CAAC,WAAWJ,gBAAgB;QAC9D,OAAO;IACR;IAEA,OAAO;AACR;AAEO,MAAMf,2CAA2C,SACvDY,IAAwB,EACxBV,eAAuB,EACvBO,eAAuB;IAEvB,MAAMW,YAAYZ,yBAAyBC;IAC3C,MAAMY,YAAYpB,yBAAyBC;IAE3C,IAAIkB,aAAaR,QAAQD,aAAaC,MAAMQ,YAAY;QACvD,OAAO;IACR;IAEA,IAAIC,WAAW;QACd,OAAOV,aAAaC,MAAMS;IAC3B;IAEA,IAAI,CAACA,WAAW;QACf,OAAO;IACR;IAEA,OAAO;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/restrictions.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3372a24437d7d725190aa82f1c49c3ae1c128d3c","contentHash":"828c684cc63b56a819ad7b79818430889ddcfd5537e05d6ff53cfa5787732e39"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/messages.js":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/messages.js","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":36}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":46}},"5":{"start":{"line":13,"column":16},"end":{"line":13,"column":46}},"6":{"start":{"line":14,"column":24},"end":{"line":14,"column":51}},"7":{"start":{"line":15,"column":29},"end":{"line":15,"column":61}},"8":{"start":{"line":16,"column":27},"end":{"line":299,"column":1}},"9":{"start":{"line":18,"column":20},"end":{"line":18,"column":61}},"10":{"start":{"line":19,"column":8},"end":{"line":19,"column":40}},"11":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"12":{"start":{"line":23,"column":12},"end":{"line":23,"column":29}},"13":{"start":{"line":25,"column":44},"end":{"line":25,"column":50}},"14":{"start":{"line":26,"column":31},"end":{"line":26,"column":83}},"15":{"start":{"line":26,"column":41},"end":{"line":26,"column":83}},"16":{"start":{"line":27,"column":20},"end":{"line":48,"column":9}},"17":{"start":{"line":49,"column":8},"end":{"line":49,"column":75}},"18":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"19":{"start":{"line":53,"column":12},"end":{"line":53,"column":29}},"20":{"start":{"line":56,"column":22},"end":{"line":69,"column":10}},"21":{"start":{"line":70,"column":8},"end":{"line":70,"column":38}},"22":{"start":{"line":71,"column":20},"end":{"line":118,"column":9}},"23":{"start":{"line":89,"column":31},"end":{"line":89,"column":67}},"24":{"start":{"line":90,"column":16},"end":{"line":90,"column":35}},"25":{"start":{"line":91,"column":16},"end":{"line":91,"column":30}},"26":{"start":{"line":94,"column":37},"end":{"line":94,"column":44}},"27":{"start":{"line":95,"column":16},"end":{"line":95,"column":40}},"28":{"start":{"line":96,"column":16},"end":{"line":98,"column":17}},"29":{"start":{"line":97,"column":20},"end":{"line":97,"column":37}},"30":{"start":{"line":99,"column":16},"end":{"line":99,"column":67}},"31":{"start":{"line":102,"column":31},"end":{"line":102,"column":87}},"32":{"start":{"line":103,"column":16},"end":{"line":103,"column":43}},"33":{"start":{"line":104,"column":16},"end":{"line":104,"column":30}},"34":{"start":{"line":107,"column":16},"end":{"line":109,"column":17}},"35":{"start":{"line":108,"column":20},"end":{"line":108,"column":37}},"36":{"start":{"line":111,"column":29},"end":{"line":111,"column":174}},"37":{"start":{"line":112,"column":16},"end":{"line":112,"column":33}},"38":{"start":{"line":116,"column":8},"end":{"line":116,"column":65}},"39":{"start":{"line":119,"column":8},"end":{"line":119,"column":74}},"40":{"start":{"line":122,"column":8},"end":{"line":124,"column":9}},"41":{"start":{"line":123,"column":12},"end":{"line":123,"column":29}},"42":{"start":{"line":125,"column":21},"end":{"line":125,"column":69}},"43":{"start":{"line":126,"column":8},"end":{"line":128,"column":9}},"44":{"start":{"line":127,"column":12},"end":{"line":127,"column":69}},"45":{"start":{"line":130,"column":8},"end":{"line":145,"column":9}},"46":{"start":{"line":131,"column":25},"end":{"line":131,"column":75}},"47":{"start":{"line":132,"column":12},"end":{"line":144,"column":13}},"48":{"start":{"line":133,"column":16},"end":{"line":137,"column":18}},"49":{"start":{"line":139,"column":16},"end":{"line":143,"column":18}},"50":{"start":{"line":147,"column":8},"end":{"line":153,"column":9}},"51":{"start":{"line":148,"column":27},"end":{"line":148,"column":77}},"52":{"start":{"line":149,"column":12},"end":{"line":152,"column":14}},"53":{"start":{"line":154,"column":28},"end":{"line":154,"column":76}},"54":{"start":{"line":155,"column":27},"end":{"line":201,"column":9}},"55":{"start":{"line":202,"column":8},"end":{"line":202,"column":71}},"56":{"start":{"line":205,"column":8},"end":{"line":207,"column":9}},"57":{"start":{"line":206,"column":12},"end":{"line":206,"column":29}},"58":{"start":{"line":208,"column":8},"end":{"line":237,"column":49}},"59":{"start":{"line":208,"column":45},"end":{"line":237,"column":47}},"60":{"start":{"line":240,"column":8},"end":{"line":242,"column":9}},"61":{"start":{"line":241,"column":12},"end":{"line":241,"column":29}},"62":{"start":{"line":243,"column":20},"end":{"line":292,"column":9}},"63":{"start":{"line":266,"column":84},"end":{"line":266,"column":94}},"64":{"start":{"line":267,"column":16},"end":{"line":267,"column":46}},"65":{"start":{"line":268,"column":16},"end":{"line":268,"column":46}},"66":{"start":{"line":269,"column":16},"end":{"line":269,"column":46}},"67":{"start":{"line":270,"column":16},"end":{"line":274,"column":18}},"68":{"start":{"line":277,"column":101},"end":{"line":277,"column":111}},"69":{"start":{"line":278,"column":16},"end":{"line":278,"column":40}},"70":{"start":{"line":279,"column":16},"end":{"line":279,"column":45}},"71":{"start":{"line":280,"column":16},"end":{"line":280,"column":54}},"72":{"start":{"line":281,"column":16},"end":{"line":285,"column":18}},"73":{"start":{"line":288,"column":31},"end":{"line":288,"column":54}},"74":{"start":{"line":289,"column":16},"end":{"line":289,"column":37}},"75":{"start":{"line":290,"column":16},"end":{"line":290,"column":30}},"76":{"start":{"line":293,"column":8},"end":{"line":293,"column":128}},"77":{"start":{"line":293,"column":63},"end":{"line":293,"column":125}},"78":{"start":{"line":296,"column":8},"end":{"line":296,"column":33}},"79":{"start":{"line":297,"column":8},"end":{"line":297,"column":25}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":17,"column":4},"end":{"line":17,"column":5}},"loc":{"start":{"line":17,"column":29},"end":{"line":20,"column":5}},"line":17},"2":{"name":"(anonymous_2)","decl":{"start":{"line":21,"column":4},"end":{"line":21,"column":5}},"loc":{"start":{"line":21,"column":36},"end":{"line":50,"column":5}},"line":21},"3":{"name":"(anonymous_3)","decl":{"start":{"line":26,"column":31},"end":{"line":26,"column":32}},"loc":{"start":{"line":26,"column":41},"end":{"line":26,"column":83}},"line":26},"4":{"name":"(anonymous_4)","decl":{"start":{"line":51,"column":4},"end":{"line":51,"column":5}},"loc":{"start":{"line":51,"column":52},"end":{"line":120,"column":5}},"line":51},"5":{"name":"(anonymous_5)","decl":{"start":{"line":88,"column":18},"end":{"line":88,"column":19}},"loc":{"start":{"line":88,"column":35},"end":{"line":92,"column":13}},"line":88},"6":{"name":"(anonymous_6)","decl":{"start":{"line":93,"column":20},"end":{"line":93,"column":21}},"loc":{"start":{"line":93,"column":37},"end":{"line":100,"column":13}},"line":93},"7":{"name":"(anonymous_7)","decl":{"start":{"line":101,"column":25},"end":{"line":101,"column":26}},"loc":{"start":{"line":101,"column":42},"end":{"line":105,"column":13}},"line":101},"8":{"name":"(anonymous_8)","decl":{"start":{"line":106,"column":20},"end":{"line":106,"column":21}},"loc":{"start":{"line":106,"column":37},"end":{"line":117,"column":13}},"line":106},"9":{"name":"(anonymous_9)","decl":{"start":{"line":121,"column":4},"end":{"line":121,"column":5}},"loc":{"start":{"line":121,"column":37},"end":{"line":203,"column":5}},"line":121},"10":{"name":"(anonymous_10)","decl":{"start":{"line":204,"column":4},"end":{"line":204,"column":5}},"loc":{"start":{"line":204,"column":40},"end":{"line":238,"column":5}},"line":204},"11":{"name":"(anonymous_11)","decl":{"start":{"line":208,"column":31},"end":{"line":208,"column":32}},"loc":{"start":{"line":208,"column":45},"end":{"line":237,"column":47}},"line":208},"12":{"name":"(anonymous_12)","decl":{"start":{"line":239,"column":4},"end":{"line":239,"column":5}},"loc":{"start":{"line":239,"column":48},"end":{"line":294,"column":5}},"line":239},"13":{"name":"(anonymous_13)","decl":{"start":{"line":265,"column":20},"end":{"line":265,"column":21}},"loc":{"start":{"line":265,"column":34},"end":{"line":275,"column":13}},"line":265},"14":{"name":"(anonymous_14)","decl":{"start":{"line":276,"column":19},"end":{"line":276,"column":20}},"loc":{"start":{"line":276,"column":33},"end":{"line":286,"column":13}},"line":276},"15":{"name":"(anonymous_15)","decl":{"start":{"line":287,"column":23},"end":{"line":287,"column":24}},"loc":{"start":{"line":287,"column":37},"end":{"line":291,"column":13}},"line":287},"16":{"name":"(anonymous_16)","decl":{"start":{"line":293,"column":43},"end":{"line":293,"column":44}},"loc":{"start":{"line":293,"column":63},"end":{"line":293,"column":125}},"line":293},"17":{"name":"(anonymous_17)","decl":{"start":{"line":295,"column":4},"end":{"line":295,"column":5}},"loc":{"start":{"line":295,"column":21},"end":{"line":298,"column":5}},"line":295}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"type":"if","locations":[{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},{"start":{"line":22,"column":8},"end":{"line":24,"column":9}}],"line":22},"1":{"loc":{"start":{"line":51,"column":33},"end":{"line":51,"column":50}},"type":"default-arg","locations":[{"start":{"line":51,"column":44},"end":{"line":51,"column":50}}],"line":51},"2":{"loc":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"type":"if","locations":[{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},{"start":{"line":52,"column":8},"end":{"line":54,"column":9}}],"line":52},"3":{"loc":{"start":{"line":56,"column":22},"end":{"line":69,"column":10}},"type":"cond-expr","locations":[{"start":{"line":56,"column":102},"end":{"line":56,"column":115}},{"start":{"line":56,"column":118},"end":{"line":69,"column":10}}],"line":56},"4":{"loc":{"start":{"line":56,"column":22},"end":{"line":56,"column":99}},"type":"binary-expr","locations":[{"start":{"line":56,"column":22},"end":{"line":56,"column":71}},{"start":{"line":56,"column":75},"end":{"line":56,"column":99}}],"line":56},"5":{"loc":{"start":{"line":96,"column":16},"end":{"line":98,"column":17}},"type":"if","locations":[{"start":{"line":96,"column":16},"end":{"line":98,"column":17}},{"start":{"line":96,"column":16},"end":{"line":98,"column":17}}],"line":96},"6":{"loc":{"start":{"line":107,"column":16},"end":{"line":109,"column":17}},"type":"if","locations":[{"start":{"line":107,"column":16},"end":{"line":109,"column":17}},{"start":{"line":107,"column":16},"end":{"line":109,"column":17}}],"line":107},"7":{"loc":{"start":{"line":107,"column":20},"end":{"line":107,"column":48}},"type":"binary-expr","locations":[{"start":{"line":107,"column":20},"end":{"line":107,"column":30}},{"start":{"line":107,"column":34},"end":{"line":107,"column":48}}],"line":107},"8":{"loc":{"start":{"line":111,"column":36},"end":{"line":111,"column":173}},"type":"cond-expr","locations":[{"start":{"line":111,"column":85},"end":{"line":111,"column":126}},{"start":{"line":111,"column":129},"end":{"line":111,"column":173}}],"line":111},"9":{"loc":{"start":{"line":116,"column":15},"end":{"line":116,"column":64}},"type":"binary-expr","locations":[{"start":{"line":116,"column":15},"end":{"line":116,"column":19}},{"start":{"line":116,"column":23},"end":{"line":116,"column":64}}],"line":116},"10":{"loc":{"start":{"line":122,"column":8},"end":{"line":124,"column":9}},"type":"if","locations":[{"start":{"line":122,"column":8},"end":{"line":124,"column":9}},{"start":{"line":122,"column":8},"end":{"line":124,"column":9}}],"line":122},"11":{"loc":{"start":{"line":122,"column":12},"end":{"line":122,"column":37}},"type":"binary-expr","locations":[{"start":{"line":122,"column":12},"end":{"line":122,"column":20}},{"start":{"line":122,"column":24},"end":{"line":122,"column":37}}],"line":122},"12":{"loc":{"start":{"line":126,"column":8},"end":{"line":128,"column":9}},"type":"if","locations":[{"start":{"line":126,"column":8},"end":{"line":128,"column":9}},{"start":{"line":126,"column":8},"end":{"line":128,"column":9}}],"line":126},"13":{"loc":{"start":{"line":130,"column":8},"end":{"line":145,"column":9}},"type":"if","locations":[{"start":{"line":130,"column":8},"end":{"line":145,"column":9}},{"start":{"line":130,"column":8},"end":{"line":145,"column":9}}],"line":130},"14":{"loc":{"start":{"line":130,"column":12},"end":{"line":130,"column":47}},"type":"binary-expr","locations":[{"start":{"line":130,"column":12},"end":{"line":130,"column":26}},{"start":{"line":130,"column":30},"end":{"line":130,"column":47}}],"line":130},"15":{"loc":{"start":{"line":132,"column":12},"end":{"line":144,"column":13}},"type":"if","locations":[{"start":{"line":132,"column":12},"end":{"line":144,"column":13}},{"start":{"line":132,"column":12},"end":{"line":144,"column":13}}],"line":132},"16":{"loc":{"start":{"line":147,"column":8},"end":{"line":153,"column":9}},"type":"if","locations":[{"start":{"line":147,"column":8},"end":{"line":153,"column":9}},{"start":{"line":147,"column":8},"end":{"line":153,"column":9}}],"line":147},"17":{"loc":{"start":{"line":156,"column":17},"end":{"line":156,"column":50}},"type":"binary-expr","locations":[{"start":{"line":156,"column":17},"end":{"line":156,"column":27}},{"start":{"line":156,"column":31},"end":{"line":156,"column":50}}],"line":156},"18":{"loc":{"start":{"line":157,"column":15},"end":{"line":159,"column":13}},"type":"binary-expr","locations":[{"start":{"line":157,"column":15},"end":{"line":157,"column":36}},{"start":{"line":157,"column":40},"end":{"line":159,"column":13}}],"line":157},"19":{"loc":{"start":{"line":163,"column":16},"end":{"line":163,"column":47}},"type":"binary-expr","locations":[{"start":{"line":163,"column":16},"end":{"line":163,"column":33}},{"start":{"line":163,"column":37},"end":{"line":163,"column":47}}],"line":163},"20":{"loc":{"start":{"line":164,"column":24},"end":{"line":164,"column":55}},"type":"binary-expr","locations":[{"start":{"line":164,"column":24},"end":{"line":164,"column":41}},{"start":{"line":164,"column":45},"end":{"line":164,"column":55}}],"line":164},"21":{"loc":{"start":{"line":165,"column":15},"end":{"line":167,"column":13}},"type":"binary-expr","locations":[{"start":{"line":165,"column":15},"end":{"line":165,"column":23}},{"start":{"line":165,"column":27},"end":{"line":167,"column":13}}],"line":165},"22":{"loc":{"start":{"line":168,"column":15},"end":{"line":170,"column":13}},"type":"binary-expr","locations":[{"start":{"line":168,"column":15},"end":{"line":168,"column":36}},{"start":{"line":168,"column":40},"end":{"line":170,"column":13}}],"line":168},"23":{"loc":{"start":{"line":171,"column":15},"end":{"line":173,"column":13}},"type":"binary-expr","locations":[{"start":{"line":171,"column":15},"end":{"line":171,"column":33}},{"start":{"line":171,"column":37},"end":{"line":173,"column":13}}],"line":171},"24":{"loc":{"start":{"line":174,"column":15},"end":{"line":176,"column":13}},"type":"binary-expr","locations":[{"start":{"line":174,"column":15},"end":{"line":174,"column":37}},{"start":{"line":174,"column":41},"end":{"line":176,"column":13}}],"line":174},"25":{"loc":{"start":{"line":177,"column":15},"end":{"line":179,"column":13}},"type":"binary-expr","locations":[{"start":{"line":177,"column":15},"end":{"line":177,"column":33}},{"start":{"line":177,"column":37},"end":{"line":179,"column":13}}],"line":177},"26":{"loc":{"start":{"line":180,"column":15},"end":{"line":182,"column":13}},"type":"binary-expr","locations":[{"start":{"line":180,"column":15},"end":{"line":180,"column":40}},{"start":{"line":180,"column":44},"end":{"line":182,"column":13}}],"line":180},"27":{"loc":{"start":{"line":183,"column":15},"end":{"line":185,"column":13}},"type":"binary-expr","locations":[{"start":{"line":183,"column":15},"end":{"line":183,"column":37}},{"start":{"line":183,"column":41},"end":{"line":185,"column":13}}],"line":183},"28":{"loc":{"start":{"line":186,"column":15},"end":{"line":188,"column":13}},"type":"binary-expr","locations":[{"start":{"line":186,"column":15},"end":{"line":186,"column":26}},{"start":{"line":186,"column":30},"end":{"line":188,"column":13}}],"line":186},"29":{"loc":{"start":{"line":189,"column":15},"end":{"line":191,"column":13}},"type":"binary-expr","locations":[{"start":{"line":189,"column":15},"end":{"line":189,"column":37}},{"start":{"line":189,"column":41},"end":{"line":191,"column":13}}],"line":189},"30":{"loc":{"start":{"line":192,"column":15},"end":{"line":194,"column":13}},"type":"binary-expr","locations":[{"start":{"line":192,"column":15},"end":{"line":192,"column":37}},{"start":{"line":192,"column":41},"end":{"line":194,"column":13}}],"line":192},"31":{"loc":{"start":{"line":195,"column":15},"end":{"line":197,"column":13}},"type":"binary-expr","locations":[{"start":{"line":195,"column":15},"end":{"line":195,"column":34}},{"start":{"line":195,"column":38},"end":{"line":197,"column":13}}],"line":195},"32":{"loc":{"start":{"line":198,"column":15},"end":{"line":200,"column":13}},"type":"binary-expr","locations":[{"start":{"line":198,"column":15},"end":{"line":198,"column":33}},{"start":{"line":198,"column":37},"end":{"line":200,"column":13}}],"line":198},"33":{"loc":{"start":{"line":205,"column":8},"end":{"line":207,"column":9}},"type":"if","locations":[{"start":{"line":205,"column":8},"end":{"line":207,"column":9}},{"start":{"line":205,"column":8},"end":{"line":207,"column":9}}],"line":205},"34":{"loc":{"start":{"line":205,"column":12},"end":{"line":205,"column":77}},"type":"binary-expr","locations":[{"start":{"line":205,"column":12},"end":{"line":205,"column":46}},{"start":{"line":205,"column":50},"end":{"line":205,"column":77}}],"line":205},"35":{"loc":{"start":{"line":212,"column":20},"end":{"line":212,"column":95}},"type":"cond-expr","locations":[{"start":{"line":212,"column":43},"end":{"line":212,"column":72}},{"start":{"line":212,"column":75},"end":{"line":212,"column":95}}],"line":212},"36":{"loc":{"start":{"line":215,"column":29},"end":{"line":215,"column":83}},"type":"cond-expr","locations":[{"start":{"line":215,"column":49},"end":{"line":215,"column":71}},{"start":{"line":215,"column":74},"end":{"line":215,"column":83}}],"line":215},"37":{"loc":{"start":{"line":216,"column":29},"end":{"line":216,"column":83}},"type":"cond-expr","locations":[{"start":{"line":216,"column":49},"end":{"line":216,"column":71}},{"start":{"line":216,"column":74},"end":{"line":216,"column":83}}],"line":216},"38":{"loc":{"start":{"line":217,"column":29},"end":{"line":217,"column":83}},"type":"cond-expr","locations":[{"start":{"line":217,"column":49},"end":{"line":217,"column":71}},{"start":{"line":217,"column":74},"end":{"line":217,"column":83}}],"line":217},"39":{"loc":{"start":{"line":218,"column":23},"end":{"line":218,"column":76}},"type":"cond-expr","locations":[{"start":{"line":218,"column":42},"end":{"line":218,"column":64}},{"start":{"line":218,"column":67},"end":{"line":218,"column":76}}],"line":218},"40":{"loc":{"start":{"line":219,"column":28},"end":{"line":219,"column":80}},"type":"cond-expr","locations":[{"start":{"line":219,"column":47},"end":{"line":219,"column":68}},{"start":{"line":219,"column":71},"end":{"line":219,"column":80}}],"line":219},"41":{"loc":{"start":{"line":220,"column":37},"end":{"line":220,"column":104}},"type":"cond-expr","locations":[{"start":{"line":220,"column":56},"end":{"line":220,"column":92}},{"start":{"line":220,"column":95},"end":{"line":220,"column":104}}],"line":220},"42":{"loc":{"start":{"line":240,"column":8},"end":{"line":242,"column":9}},"type":"if","locations":[{"start":{"line":240,"column":8},"end":{"line":242,"column":9}},{"start":{"line":240,"column":8},"end":{"line":242,"column":9}}],"line":240},"43":{"loc":{"start":{"line":240,"column":12},"end":{"line":240,"column":77}},"type":"binary-expr","locations":[{"start":{"line":240,"column":12},"end":{"line":240,"column":46}},{"start":{"line":240,"column":50},"end":{"line":240,"column":77}}],"line":240}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":5,"19":1,"20":4,"21":4,"22":4,"23":4,"24":4,"25":4,"26":4,"27":4,"28":4,"29":4,"30":0,"31":4,"32":4,"33":4,"34":4,"35":0,"36":4,"37":4,"38":4,"39":4,"40":4,"41":1,"42":3,"43":3,"44":1,"45":2,"46":2,"47":2,"48":2,"49":0,"50":2,"51":0,"52":0,"53":2,"54":2,"55":2,"56":2,"57":2,"58":0,"59":0,"60":4,"61":4,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":1,"79":1},"f":{"0":1,"1":0,"2":0,"3":0,"4":5,"5":4,"6":4,"7":4,"8":4,"9":4,"10":2,"11":0,"12":4,"13":0,"14":0,"15":0,"16":0,"17":1},"b":{"0":[0,0],"1":[5],"2":[1,4],"3":[2,2],"4":[4,4],"5":[4,0],"6":[0,4],"7":[4,4],"8":[1,3],"9":[4,0],"10":[1,3],"11":[4,3],"12":[1,2],"13":[2,0],"14":[2,2],"15":[2,0],"16":[0,2],"17":[2,0],"18":[2,0],"19":[2,0],"20":[2,0],"21":[2,0],"22":[2,0],"23":[2,0],"24":[2,0],"25":[2,0],"26":[2,0],"27":[2,2],"28":[2,0],"29":[2,0],"30":[2,0],"31":[2,0],"32":[2,0],"33":[2,0],"34":[2,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[4,0],"43":[4,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/messages.js"],"sourcesContent":["import { isMessageFromVisitor } from '@rocket.chat/core-typings';\nimport { Messages, Rooms, Users } from '@rocket.chat/models';\nimport { Random } from '@rocket.chat/random';\n\nimport { cachedFunction } from './cachedFunction';\nimport { transformMappedData } from './transformMappedData';\n\nexport class AppMessagesConverter {\n\tmem = new WeakMap();\n\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tasync convertById(msgId) {\n\t\tconst msg = await Messages.findOneById(msgId);\n\n\t\treturn this.convertMessage(msg);\n\t}\n\n\tasync convertMessageRaw(msgObj) {\n\t\tif (!msgObj) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst { attachments, ...message } = msgObj;\n\t\tconst getAttachments = async () => this._convertAttachmentsToApp(attachments);\n\n\t\tconst map = {\n\t\t\tid: '_id',\n\t\t\tthreadId: 'tmid',\n\t\t\treactions: 'reactions',\n\t\t\tparseUrls: 'parseUrls',\n\t\t\ttext: 'msg',\n\t\t\tcreatedAt: 'ts',\n\t\t\tupdatedAt: '_updatedAt',\n\t\t\teditedAt: 'editedAt',\n\t\t\temoji: 'emoji',\n\t\t\tavatarUrl: 'avatar',\n\t\t\talias: 'alias',\n\t\t\tfile: 'file',\n\t\t\tcustomFields: 'customFields',\n\t\t\tgroupable: 'groupable',\n\t\t\ttoken: 'token',\n\t\t\tblocks: 'blocks',\n\t\t\troomId: 'rid',\n\t\t\teditor: 'editedBy',\n\t\t\tattachments: getAttachments,\n\t\t\tsender: 'u',\n\t\t};\n\n\t\treturn transformMappedData(message, map);\n\t}\n\n\tasync convertMessage(msgObj, cacheObj = msgObj) {\n\t\tif (!msgObj) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst cache =\n\t\t\tthis.mem.get(cacheObj) ??\n\t\t\tnew Map([\n\t\t\t\t['room', cachedFunction(this.orch.getConverters().get('rooms').convertById.bind(this.orch.getConverters().get('rooms')))],\n\t\t\t\t[\n\t\t\t\t\t'user.convertById',\n\t\t\t\t\tcachedFunction(this.orch.getConverters().get('users').convertById.bind(this.orch.getConverters().get('users'))),\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t'user.convertToApp',\n\t\t\t\t\tcachedFunction(this.orch.getConverters().get('users').convertToApp.bind(this.orch.getConverters().get('users'))),\n\t\t\t\t],\n\t\t\t]);\n\n\t\tthis.mem.set(cacheObj, cache);\n\n\t\tconst map = {\n\t\t\tid: '_id',\n\t\t\tthreadId: 'tmid',\n\t\t\treactions: 'reactions',\n\t\t\tparseUrls: 'parseUrls',\n\t\t\ttext: 'msg',\n\t\t\tcreatedAt: 'ts',\n\t\t\tupdatedAt: '_updatedAt',\n\t\t\teditedAt: 'editedAt',\n\t\t\temoji: 'emoji',\n\t\t\tavatarUrl: 'avatar',\n\t\t\talias: 'alias',\n\t\t\tfile: 'file',\n\t\t\tcustomFields: 'customFields',\n\t\t\tgroupable: 'groupable',\n\t\t\ttoken: 'token',\n\t\t\tblocks: 'blocks',\n\t\t\troom: async (message) => {\n\t\t\t\tconst result = await cache.get('room')(message.rid);\n\t\t\t\tdelete message.rid;\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\teditor: async (message) => {\n\t\t\t\tconst { editedBy } = message;\n\t\t\t\tdelete message.editedBy;\n\n\t\t\t\tif (!editedBy) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\treturn cache.get('user.convertById')(editedBy._id);\n\t\t\t},\n\t\t\tattachments: async (message) => {\n\t\t\t\tconst result = await this._convertAttachmentsToApp(message.attachments);\n\t\t\t\tdelete message.attachments;\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\tsender: async (message) => {\n\t\t\t\tif (!message.u || !message.u._id) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\t// When the message contains token, means the message is from the visitor(omnichannel)\n\t\t\t\tconst user = await (isMessageFromVisitor(msgObj)\n\t\t\t\t\t? cache.get('user.convertToApp')(message.u)\n\t\t\t\t\t: cache.get('user.convertById')(message.u._id));\n\n\t\t\t\tdelete message.u;\n\n\t\t\t\t/**\n\t\t\t\t * Old System Messages from visitor doesn't have the `token` field, to not return\n\t\t\t\t * `sender` as undefined, so we need to add this fallback here.\n\t\t\t\t */\n\n\t\t\t\treturn user || cache.get('user.convertToApp')(message.u);\n\t\t\t},\n\t\t};\n\n\t\treturn transformMappedData(msgObj, map);\n\t}\n\n\tasync convertAppMessage(message) {\n\t\tif (!message || !message.room) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst room = await Rooms.findOneById(message.room.id);\n\n\t\tif (!room) {\n\t\t\tthrow new Error('Invalid room provided on the message.');\n\t\t}\n\n\t\tlet u;\n\t\tif (message.sender && message.sender.id) {\n\t\t\tconst user = await Users.findOneById(message.sender.id);\n\n\t\t\tif (user) {\n\t\t\t\tu = {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tu = {\n\t\t\t\t\t_id: message.sender.id,\n\t\t\t\t\tusername: message.sender.username,\n\t\t\t\t\tname: message.sender.name,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tlet editedBy;\n\t\tif (message.editor) {\n\t\t\tconst editor = await Users.findOneById(message.editor.id);\n\t\t\teditedBy = {\n\t\t\t\t_id: editor._id,\n\t\t\t\tusername: editor.username,\n\t\t\t};\n\t\t}\n\n\t\tconst attachments = this._convertAppAttachments(message.attachments);\n\n\t\tconst newMessage = {\n\t\t\t_id: message.id || Random.id(),\n\t\t\t...('threadId' in message && { tmid: message.threadId }),\n\t\t\trid: room._id,\n\t\t\tu,\n\t\t\tmsg: message.text,\n\t\t\tts: message.createdAt || new Date(),\n\t\t\t_updatedAt: message.updatedAt || new Date(),\n\t\t\t...(editedBy && { editedBy }),\n\t\t\t...('editedAt' in message && { editedAt: message.editedAt }),\n\t\t\t...('emoji' in message && { emoji: message.emoji }),\n\t\t\t...('avatarUrl' in message && { avatar: message.avatarUrl }),\n\t\t\t...('alias' in message && { alias: message.alias }),\n\t\t\t...('customFields' in message && { customFields: message.customFields }),\n\t\t\t...('groupable' in message && { groupable: message.groupable }),\n\t\t\t...(attachments && { attachments }),\n\t\t\t...('reactions' in message && { reactions: message.reactions }),\n\t\t\t...('parseUrls' in message && { parseUrls: message.parseUrls }),\n\t\t\t...('blocks' in message && { blocks: message.blocks }),\n\t\t\t...('token' in message && { token: message.token }),\n\t\t};\n\n\t\treturn Object.assign(newMessage, message._unmappedProperties_);\n\t}\n\n\t_convertAppAttachments(attachments) {\n\t\tif (typeof attachments === 'undefined' || !Array.isArray(attachments)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn attachments.map((attachment) =>\n\t\t\tObject.assign(\n\t\t\t\t{\n\t\t\t\t\tcollapsed: attachment.collapsed,\n\t\t\t\t\tcolor: attachment.color,\n\t\t\t\t\ttext: attachment.text,\n\t\t\t\t\tts: attachment.timestamp ? attachment.timestamp.toJSON() : attachment.timestamp,\n\t\t\t\t\tmessage_link: attachment.timestampLink,\n\t\t\t\t\tthumb_url: attachment.thumbnailUrl,\n\t\t\t\t\tauthor_name: attachment.author ? attachment.author.name : undefined,\n\t\t\t\t\tauthor_link: attachment.author ? attachment.author.link : undefined,\n\t\t\t\t\tauthor_icon: attachment.author ? attachment.author.icon : undefined,\n\t\t\t\t\ttitle: attachment.title ? attachment.title.value : undefined,\n\t\t\t\t\ttitle_link: attachment.title ? attachment.title.link : undefined,\n\t\t\t\t\ttitle_link_download: attachment.title ? attachment.title.displayDownloadLink : undefined,\n\t\t\t\t\timage_dimensions: attachment.imageDimensions,\n\t\t\t\t\timage_preview: attachment.imagePreview,\n\t\t\t\t\timage_url: attachment.imageUrl,\n\t\t\t\t\timage_type: attachment.imageType,\n\t\t\t\t\timage_size: attachment.imageSize,\n\t\t\t\t\taudio_url: attachment.audioUrl,\n\t\t\t\t\taudio_type: attachment.audioType,\n\t\t\t\t\taudio_size: attachment.audioSize,\n\t\t\t\t\tvideo_url: attachment.videoUrl,\n\t\t\t\t\tvideo_type: attachment.videoType,\n\t\t\t\t\tvideo_size: attachment.videoSize,\n\t\t\t\t\tfields: attachment.fields,\n\t\t\t\t\tbutton_alignment: attachment.actionButtonsAlignment,\n\t\t\t\t\tactions: attachment.actions,\n\t\t\t\t\ttype: attachment.type,\n\t\t\t\t\tdescription: attachment.description,\n\t\t\t\t},\n\t\t\t\tattachment._unmappedProperties_,\n\t\t\t),\n\t\t);\n\t}\n\n\tasync _convertAttachmentsToApp(attachments) {\n\t\tif (typeof attachments === 'undefined' || !Array.isArray(attachments)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst map = {\n\t\t\tcollapsed: 'collapsed',\n\t\t\tcolor: 'color',\n\t\t\ttext: 'text',\n\t\t\ttimestampLink: 'message_link',\n\t\t\tthumbnailUrl: 'thumb_url',\n\t\t\timageDimensions: 'image_dimensions',\n\t\t\timagePreview: 'image_preview',\n\t\t\timageUrl: 'image_url',\n\t\t\timageType: 'image_type',\n\t\t\timageSize: 'image_size',\n\t\t\taudioUrl: 'audio_url',\n\t\t\taudioType: 'audio_type',\n\t\t\taudioSize: 'audio_size',\n\t\t\tvideoUrl: 'video_url',\n\t\t\tvideoType: 'video_type',\n\t\t\tvideoSize: 'video_size',\n\t\t\tfields: 'fields',\n\t\t\tactionButtonsAlignment: 'button_alignment',\n\t\t\tactions: 'actions',\n\t\t\ttype: 'type',\n\t\t\tdescription: 'description',\n\t\t\tauthor: (attachment) => {\n\t\t\t\tconst { author_name: name, author_link: link, author_icon: icon } = attachment;\n\n\t\t\t\tdelete attachment.author_name;\n\t\t\t\tdelete attachment.author_link;\n\t\t\t\tdelete attachment.author_icon;\n\n\t\t\t\treturn { name, link, icon };\n\t\t\t},\n\t\t\ttitle: (attachment) => {\n\t\t\t\tconst { title: value, title_link: link, title_link_download: displayDownloadLink } = attachment;\n\n\t\t\t\tdelete attachment.title;\n\t\t\t\tdelete attachment.title_link;\n\t\t\t\tdelete attachment.title_link_download;\n\n\t\t\t\treturn { value, link, displayDownloadLink };\n\t\t\t},\n\t\t\ttimestamp: (attachment) => {\n\t\t\t\tconst result = new Date(attachment.ts);\n\t\t\t\tdelete attachment.ts;\n\t\t\t\treturn result;\n\t\t\t},\n\t\t};\n\n\t\treturn Promise.all(attachments.map(async (attachment) => transformMappedData(attachment, map)));\n\t}\n}\n"],"names":["AppMessagesConverter","convertById","msgId","msg","Messages","findOneById","convertMessage","convertMessageRaw","msgObj","undefined","attachments","message","getAttachments","_convertAttachmentsToApp","map","id","threadId","reactions","parseUrls","text","createdAt","updatedAt","editedAt","emoji","avatarUrl","alias","file","customFields","groupable","token","blocks","roomId","editor","sender","transformMappedData","cacheObj","cache","mem","get","Map","cachedFunction","orch","getConverters","bind","convertToApp","set","room","result","rid","editedBy","_id","u","user","isMessageFromVisitor","convertAppMessage","Rooms","Error","Users","username","name","_convertAppAttachments","newMessage","Random","tmid","ts","Date","_updatedAt","avatar","Object","assign","_unmappedProperties_","Array","isArray","attachment","collapsed","color","timestamp","toJSON","message_link","timestampLink","thumb_url","thumbnailUrl","author_name","author","author_link","link","author_icon","icon","title","value","title_link","title_link_download","displayDownloadLink","image_dimensions","imageDimensions","image_preview","imagePreview","image_url","imageUrl","image_type","imageType","image_size","imageSize","audio_url","audioUrl","audio_type","audioType","audio_size","audioSize","video_url","videoUrl","video_type","videoType","video_size","videoSize","fields","button_alignment","actionButtonsAlignment","actions","type","description","Promise","all","constructor","WeakMap"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/messages.js"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"03878564c821256ceb83c488a01be43b82f72e6d","contentHash":"aca8e1ce385aa7c9ac074e2f5dcd3df2566b03266cfb829ed665906a32c313e4"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/cachedFunction.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/cachedFunction.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":30}},"3":{"start":{"line":11,"column":23},"end":{"line":22,"column":1}},"4":{"start":{"line":12,"column":18},"end":{"line":12,"column":27}},"5":{"start":{"line":13,"column":4},"end":{"line":21,"column":6}},"6":{"start":{"line":14,"column":25},"end":{"line":14,"column":45}},"7":{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},"8":{"start":{"line":16,"column":12},"end":{"line":16,"column":39}},"9":{"start":{"line":18,"column":23},"end":{"line":18,"column":34}},"10":{"start":{"line":19,"column":8},"end":{"line":19,"column":36}},"11":{"start":{"line":20,"column":8},"end":{"line":20,"column":22}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":23},"end":{"line":11,"column":24}},"loc":{"start":{"line":11,"column":29},"end":{"line":22,"column":1}},"line":11},"2":{"name":"(anonymous_2)","decl":{"start":{"line":13,"column":11},"end":{"line":13,"column":12}},"loc":{"start":{"line":13,"column":22},"end":{"line":21,"column":5}},"line":13}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},"type":"if","locations":[{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},{"start":{"line":15,"column":8},"end":{"line":17,"column":9}}],"line":15}},"s":{"0":1,"1":1,"2":6,"3":1,"4":6,"5":6,"6":8,"7":8,"8":4,"9":4,"10":4,"11":4},"f":{"0":6,"1":6,"2":8},"b":{"0":[4,4]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/cachedFunction.ts"],"sourcesContent":["export const cachedFunction = <F extends (...args: any[]) => any>(fn: F) => {\n\tconst cache = new Map<string, unknown>();\n\n\treturn ((...args) => {\n\t\tconst cacheKey = JSON.stringify(args);\n\n\t\tif (cache.has(cacheKey)) {\n\t\t\treturn cache.get(cacheKey) as ReturnType<F>;\n\t\t}\n\n\t\tconst result = fn(...args);\n\n\t\tcache.set(cacheKey, result);\n\n\t\treturn result;\n\t}) as F;\n};\n"],"names":["cachedFunction","fn","cache","Map","args","cacheKey","JSON","stringify","has","get","result","set"],"mappings":";;;;+BAAaA;;;eAAAA;;;AAAN,MAAMA,iBAAiB,CAAoCC;IACjE,MAAMC,QAAQ,IAAIC;IAElB,OAAQ,CAAC,GAAGC;QACX,MAAMC,WAAWC,KAAKC,SAAS,CAACH;QAEhC,IAAIF,MAAMM,GAAG,CAACH,WAAW;YACxB,OAAOH,MAAMO,GAAG,CAACJ;QAClB;QAEA,MAAMK,SAAST,MAAMG;QAErBF,MAAMS,GAAG,CAACN,UAAUK;QAEpB,OAAOA;IACR;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/cachedFunction.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c04556816e379a23bdbbc75609f057c85551b143","contentHash":"f41cc15e34ab604ec250c3022765b0bc3dce9e4df7b931f924c95d3661858939"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/transformMappedData.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/transformMappedData.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":35}},"3":{"start":{"line":11,"column":39},"end":{"line":11,"column":92}},"4":{"start":{"line":13,"column":4},"end":{"line":15,"column":6}},"5":{"start":{"line":17,"column":28},"end":{"line":37,"column":1}},"6":{"start":{"line":18,"column":25},"end":{"line":18,"column":60}},"7":{"start":{"line":19,"column":28},"end":{"line":19,"column":30}},"8":{"start":{"line":20,"column":4},"end":{"line":32,"column":5}},"9":{"start":{"line":21,"column":8},"end":{"line":31,"column":9}},"10":{"start":{"line":22,"column":27},"end":{"line":22,"column":51}},"11":{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},"12":{"start":{"line":24,"column":16},"end":{"line":24,"column":45}},"13":{"start":{"line":26,"column":15},"end":{"line":31,"column":9}},"14":{"start":{"line":27,"column":12},"end":{"line":29,"column":13}},"15":{"start":{"line":28,"column":16},"end":{"line":28,"column":57}},"16":{"start":{"line":30,"column":12},"end":{"line":30,"column":38}},"17":{"start":{"line":33,"column":4},"end":{"line":36,"column":6}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":12,"column":9},"end":{"line":12,"column":33}},"loc":{"start":{"line":12,"column":39},"end":{"line":16,"column":1}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":17,"column":28},"end":{"line":17,"column":29}},"loc":{"start":{"line":17,"column":47},"end":{"line":37,"column":1}},"line":17}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":11},"end":{"line":15,"column":5}},"type":"cond-expr","locations":[{"start":{"line":13,"column":35},"end":{"line":13,"column":38}},{"start":{"line":13,"column":41},"end":{"line":15,"column":5}}],"line":13},"1":{"loc":{"start":{"line":13,"column":11},"end":{"line":13,"column":32}},"type":"binary-expr","locations":[{"start":{"line":13,"column":11},"end":{"line":13,"column":14}},{"start":{"line":13,"column":18},"end":{"line":13,"column":32}}],"line":13},"2":{"loc":{"start":{"line":21,"column":8},"end":{"line":31,"column":9}},"type":"if","locations":[{"start":{"line":21,"column":8},"end":{"line":31,"column":9}},{"start":{"line":21,"column":8},"end":{"line":31,"column":9}}],"line":21},"3":{"loc":{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},"type":"if","locations":[{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},{"start":{"line":23,"column":12},"end":{"line":25,"column":13}}],"line":23},"4":{"loc":{"start":{"line":26,"column":15},"end":{"line":31,"column":9}},"type":"if","locations":[{"start":{"line":26,"column":15},"end":{"line":31,"column":9}},{"start":{"line":26,"column":15},"end":{"line":31,"column":9}}],"line":26},"5":{"loc":{"start":{"line":27,"column":12},"end":{"line":29,"column":13}},"type":"if","locations":[{"start":{"line":27,"column":12},"end":{"line":29,"column":13}},{"start":{"line":27,"column":12},"end":{"line":29,"column":13}}],"line":27}},"s":{"0":1,"1":1,"2":4,"3":1,"4":1,"5":1,"6":4,"7":4,"8":4,"9":80,"10":16,"11":16,"12":8,"13":64,"14":64,"15":21,"16":64,"17":4},"f":{"0":4,"1":1,"2":4},"b":{"0":[0,1],"1":[1,1],"2":[16,64],"3":[8,8],"4":[64,0],"5":[21,43]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/transformMappedData.ts"],"sourcesContent":["import cloneDeep from 'lodash.clonedeep';\n\n/**\n * Transforms a `data` source object to another object,\n * essentially applying a to -> from mapping provided by\n * `map`. It does not mutate the `data` object.\n *\n * It also inserts in the `transformedObject` a new property\n * called `_unmappedProperties_` which contains properties from\n * the original `data` that have not been mapped to its transformed\n * counterpart. E.g.:\n *\n * ```javascript\n * const data = { _id: 'abcde123456', size: 10 };\n * const map = Object.freeze({ id: '_id' });\n *\n * transformMappedData(data, map);\n * // { id: 'abcde123456', _unmappedProperties_: { size: 10 } }\n * ```\n *\n * In order to compute the unmapped properties, this function will\n * ignore any property on `data` that has been named on the \"from\" part\n * of the `map`, and will consider properties not mentioned as unmapped.\n *\n * You can also define the \"from\" part as a function, so you can derive a\n * new value for your property from the original `data`. This function will\n * receive a copy of the original `data` for it to calculate the value\n * for its \"to\" field. Please note that in this case `transformMappedData`\n * will not be able to determine the source field from your map, so it won't\n * ignore any field you've used to derive your new value. For that, you're\n * going to need to delete the value from the received parameter. E.g:\n *\n * ```javascript\n * const data = { _id: 'abcde123456', size: 10 };\n *\n * // It will look like the `size` property is not mapped\n * const map = {\n *     id: '_id',\n *     newSize: (data) => data.size + 10\n * };\n *\n * transformMappedData(data, map);\n * // { id: 'abcde123456', newSize: 20, _unmappedProperties_: { size: 10 } }\n *\n * // You need to explicitly remove it from the original `data`\n * const map = Object.freeze({\n *     id: '_id',\n *     newSize: (data) => {\n *         const result = data.size + 10;\n *         delete data.size;\n *         return result;\n *     }\n * });\n *\n * transformMappedData(data, map);\n * // { id: 'abcde123456', newSize: 20, _unmappedProperties_: {} }\n * ```\n *\n * @param Object data The data to be transformed\n * @param Object map The map with transformations to be applied\n *\n * @returns Object The data after transformations have been applied\n */\n\nexport const transformMappedData = async <\n\tResultType extends {\n\t\t-readonly [p in keyof MapType]: MapType[p] extends keyof DataType\n\t\t\t? DataType[MapType[p]]\n\t\t\t: MapType[p] extends (...args: any[]) => any\n\t\t\t\t? Awaited<ReturnType<MapType[p]>>\n\t\t\t\t: never;\n\t},\n\tDataType extends Record<string, any>,\n\tMapType extends { [p in string]: string | ((data: DataType) => Promise<unknown>) | ((data: DataType) => unknown) },\n\tUnmappedProperties extends {\n\t\t[p in keyof DataType as Exclude<p, MapType[keyof MapType]>]: DataType[p];\n\t},\n>(\n\tdata: DataType,\n\tmap: MapType,\n): Promise<ResultType & { _unmappedProperties_: UnmappedProperties }> => {\n\tconst originalData: DataType = cloneDeep(data);\n\tconst transformedData: Record<string, any> = {};\n\n\tfor await (const [to, from] of Object.entries(map)) {\n\t\tif (typeof from === 'function') {\n\t\t\tconst result = await from(originalData);\n\n\t\t\tif (typeof result !== 'undefined') {\n\t\t\t\ttransformedData[to] = result;\n\t\t\t}\n\t\t} else if (typeof from === 'string') {\n\t\t\tif (typeof originalData[from] !== 'undefined') {\n\t\t\t\ttransformedData[to] = originalData[from];\n\t\t\t}\n\t\t\tdelete originalData[from];\n\t\t}\n\t}\n\n\treturn {\n\t\t...(transformedData as ResultType),\n\t\t_unmappedProperties_: originalData as unknown as UnmappedProperties,\n\t};\n};\n"],"names":["transformMappedData","data","map","originalData","cloneDeep","transformedData","to","from","Object","entries","result","_unmappedProperties_"],"mappings":";;;;+BAgEaA;;;eAAAA;;;wEAhES;;;;;;AAgEf,MAAMA,sBAAsB,OAclCC,MACAC;IAEA,MAAMC,eAAyBC,IAAAA,wBAAS,EAACH;IACzC,MAAMI,kBAAuC,CAAC;IAE9C,WAAW,MAAM,CAACC,IAAIC,KAAK,IAAIC,OAAOC,OAAO,CAACP,KAAM;QACnD,IAAI,OAAOK,SAAS,YAAY;YAC/B,MAAMG,SAAS,MAAMH,KAAKJ;YAE1B,IAAI,OAAOO,WAAW,aAAa;gBAClCL,eAAe,CAACC,GAAG,GAAGI;YACvB;QACD,OAAO,IAAI,OAAOH,SAAS,UAAU;YACpC,IAAI,OAAOJ,YAAY,CAACI,KAAK,KAAK,aAAa;gBAC9CF,eAAe,CAACC,GAAG,GAAGH,YAAY,CAACI,KAAK;YACzC;YACA,OAAOJ,YAAY,CAACI,KAAK;QAC1B;IACD;IAEA,OAAO;QACN,GAAIF,eAAe;QACnBM,sBAAsBR;IACvB;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/transformMappedData.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"dc908826d902db39e9ba6e511463a19b37c75f6a","contentHash":"1cbd25f1a2ea00e091f761bbcb6ce7690e11b85579d860f05c1e60f5342ea75a"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/custom-oauth/server/transform_helpers.js":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/custom-oauth/server/transform_helpers.js","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":27,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":28}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":30}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":30}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":27}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":39}},"9":{"start":{"line":28,"column":18},"end":{"line":28,"column":56}},"10":{"start":{"line":29,"column":20},"end":{"line":116,"column":1}},"11":{"start":{"line":32,"column":8},"end":{"line":34,"column":9}},"12":{"start":{"line":33,"column":12},"end":{"line":33,"column":39}},"13":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"14":{"start":{"line":39,"column":12},"end":{"line":39,"column":35}},"15":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"16":{"start":{"line":45,"column":12},"end":{"line":45,"column":38}},"17":{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},"18":{"start":{"line":51,"column":12},"end":{"line":51,"column":43}},"19":{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},"20":{"start":{"line":56,"column":12},"end":{"line":56,"column":47}},"21":{"start":{"line":61,"column":8},"end":{"line":68,"column":9}},"22":{"start":{"line":62,"column":12},"end":{"line":66,"column":13}},"23":{"start":{"line":63,"column":16},"end":{"line":63,"column":58}},"24":{"start":{"line":65,"column":16},"end":{"line":65,"column":51}},"25":{"start":{"line":67,"column":12},"end":{"line":67,"column":49}},"26":{"start":{"line":72,"column":8},"end":{"line":75,"column":9}},"27":{"start":{"line":73,"column":12},"end":{"line":73,"column":48}},"28":{"start":{"line":74,"column":12},"end":{"line":74,"column":54}},"29":{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},"30":{"start":{"line":80,"column":12},"end":{"line":80,"column":40}},"31":{"start":{"line":85,"column":8},"end":{"line":87,"column":9}},"32":{"start":{"line":86,"column":12},"end":{"line":86,"column":39}},"33":{"start":{"line":91,"column":8},"end":{"line":94,"column":9}},"34":{"start":{"line":92,"column":12},"end":{"line":92,"column":48}},"35":{"start":{"line":93,"column":12},"end":{"line":93,"column":46}},"36":{"start":{"line":98,"column":8},"end":{"line":100,"column":9}},"37":{"start":{"line":99,"column":12},"end":{"line":99,"column":42}},"38":{"start":{"line":104,"column":8},"end":{"line":108,"column":9}},"39":{"start":{"line":105,"column":12},"end":{"line":105,"column":47}},"40":{"start":{"line":106,"column":12},"end":{"line":106,"column":58}},"41":{"start":{"line":107,"column":12},"end":{"line":107,"column":53}},"42":{"start":{"line":112,"column":8},"end":{"line":114,"column":9}},"43":{"start":{"line":113,"column":12},"end":{"line":113,"column":97}},"44":{"start":{"line":117,"column":33},"end":{"line":117,"column":40}},"45":{"start":{"line":118,"column":32},"end":{"line":129,"column":1}},"46":{"start":{"line":119,"column":4},"end":{"line":121,"column":5}},"47":{"start":{"line":120,"column":8},"end":{"line":120,"column":50}},"48":{"start":{"line":122,"column":4},"end":{"line":124,"column":5}},"49":{"start":{"line":123,"column":8},"end":{"line":123,"column":21}},"50":{"start":{"line":125,"column":4},"end":{"line":128,"column":16}},"51":{"start":{"line":125,"column":66},"end":{"line":128,"column":9}},"52":{"start":{"line":130,"column":23},"end":{"line":130,"column":130}},"53":{"start":{"line":130,"column":47},"end":{"line":130,"column":130}},"54":{"start":{"line":130,"column":92},"end":{"line":130,"column":121}},"55":{"start":{"line":132,"column":28},"end":{"line":132,"column":53}},"56":{"start":{"line":133,"column":23},"end":{"line":153,"column":1}},"57":{"start":{"line":134,"column":25},"end":{"line":134,"column":58}},"58":{"start":{"line":135,"column":4},"end":{"line":137,"column":5}},"59":{"start":{"line":136,"column":8},"end":{"line":136,"column":45}},"60":{"start":{"line":138,"column":4},"end":{"line":140,"column":5}},"61":{"start":{"line":139,"column":8},"end":{"line":139,"column":82}},"62":{"start":{"line":141,"column":34},"end":{"line":141,"column":46}},"63":{"start":{"line":142,"column":24},"end":{"line":142,"column":50}},"64":{"start":{"line":143,"column":18},"end":{"line":143,"column":41}},"65":{"start":{"line":144,"column":20},"end":{"line":144,"column":43}},"66":{"start":{"line":146,"column":4},"end":{"line":148,"column":5}},"67":{"start":{"line":147,"column":8},"end":{"line":147,"column":25}},"68":{"start":{"line":150,"column":22},"end":{"line":150,"column":29}},"69":{"start":{"line":152,"column":4},"end":{"line":152,"column":17}},"70":{"start":{"line":154,"column":28},"end":{"line":154,"column":49}},"71":{"start":{"line":155,"column":21},"end":{"line":160,"column":1}},"72":{"start":{"line":156,"column":4},"end":{"line":158,"column":5}},"73":{"start":{"line":157,"column":8},"end":{"line":157,"column":46}},"74":{"start":{"line":159,"column":4},"end":{"line":159,"column":98}},"75":{"start":{"line":159,"column":69},"end":{"line":159,"column":96}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":18},"end":{"line":12,"column":19}},"loc":{"start":{"line":12,"column":29},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":20},"end":{"line":15,"column":21}},"loc":{"start":{"line":15,"column":31},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":20},"end":{"line":18,"column":21}},"loc":{"start":{"line":18,"column":31},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":17},"end":{"line":21,"column":18}},"loc":{"start":{"line":21,"column":28},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":29},"end":{"line":24,"column":30}},"loc":{"start":{"line":24,"column":40},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":31,"column":4},"end":{"line":31,"column":5}},"loc":{"start":{"line":31,"column":19},"end":{"line":35,"column":5}},"line":31},"7":{"name":"(anonymous_7)","decl":{"start":{"line":37,"column":4},"end":{"line":37,"column":5}},"loc":{"start":{"line":37,"column":21},"end":{"line":41,"column":5}},"line":37},"8":{"name":"(anonymous_8)","decl":{"start":{"line":43,"column":4},"end":{"line":43,"column":5}},"loc":{"start":{"line":43,"column":25},"end":{"line":47,"column":5}},"line":43},"9":{"name":"(anonymous_9)","decl":{"start":{"line":49,"column":4},"end":{"line":49,"column":5}},"loc":{"start":{"line":49,"column":23},"end":{"line":53,"column":5}},"line":49},"10":{"name":"(anonymous_10)","decl":{"start":{"line":54,"column":4},"end":{"line":54,"column":5}},"loc":{"start":{"line":54,"column":27},"end":{"line":58,"column":5}},"line":54},"11":{"name":"(anonymous_11)","decl":{"start":{"line":60,"column":4},"end":{"line":60,"column":5}},"loc":{"start":{"line":60,"column":26},"end":{"line":69,"column":5}},"line":60},"12":{"name":"(anonymous_12)","decl":{"start":{"line":71,"column":4},"end":{"line":71,"column":5}},"loc":{"start":{"line":71,"column":23},"end":{"line":76,"column":5}},"line":71},"13":{"name":"(anonymous_13)","decl":{"start":{"line":78,"column":4},"end":{"line":78,"column":5}},"loc":{"start":{"line":78,"column":27},"end":{"line":82,"column":5}},"line":78},"14":{"name":"(anonymous_14)","decl":{"start":{"line":84,"column":4},"end":{"line":84,"column":5}},"loc":{"start":{"line":84,"column":24},"end":{"line":88,"column":5}},"line":84},"15":{"name":"(anonymous_15)","decl":{"start":{"line":90,"column":4},"end":{"line":90,"column":5}},"loc":{"start":{"line":90,"column":25},"end":{"line":95,"column":5}},"line":90},"16":{"name":"(anonymous_16)","decl":{"start":{"line":97,"column":4},"end":{"line":97,"column":5}},"loc":{"start":{"line":97,"column":22},"end":{"line":101,"column":5}},"line":97},"17":{"name":"(anonymous_17)","decl":{"start":{"line":103,"column":4},"end":{"line":103,"column":5}},"loc":{"start":{"line":103,"column":25},"end":{"line":109,"column":5}},"line":103},"18":{"name":"(anonymous_18)","decl":{"start":{"line":111,"column":4},"end":{"line":111,"column":5}},"loc":{"start":{"line":111,"column":22},"end":{"line":115,"column":5}},"line":111},"19":{"name":"(anonymous_19)","decl":{"start":{"line":118,"column":32},"end":{"line":118,"column":33}},"loc":{"start":{"line":118,"column":41},"end":{"line":129,"column":1}},"line":118},"20":{"name":"(anonymous_20)","decl":{"start":{"line":125,"column":40},"end":{"line":125,"column":41}},"loc":{"start":{"line":125,"column":66},"end":{"line":128,"column":9}},"line":125},"21":{"name":"(anonymous_21)","decl":{"start":{"line":130,"column":23},"end":{"line":130,"column":24}},"loc":{"start":{"line":130,"column":47},"end":{"line":130,"column":130}},"line":130},"22":{"name":"(anonymous_22)","decl":{"start":{"line":130,"column":78},"end":{"line":130,"column":79}},"loc":{"start":{"line":130,"column":92},"end":{"line":130,"column":121}},"line":130},"23":{"name":"(anonymous_23)","decl":{"start":{"line":133,"column":23},"end":{"line":133,"column":24}},"loc":{"start":{"line":133,"column":40},"end":{"line":153,"column":1}},"line":133},"24":{"name":"(anonymous_24)","decl":{"start":{"line":155,"column":21},"end":{"line":155,"column":22}},"loc":{"start":{"line":155,"column":39},"end":{"line":160,"column":1}},"line":155},"25":{"name":"(anonymous_25)","decl":{"start":{"line":159,"column":49},"end":{"line":159,"column":50}},"loc":{"start":{"line":159,"column":69},"end":{"line":159,"column":96}},"line":159}},"branchMap":{"0":{"loc":{"start":{"line":32,"column":8},"end":{"line":34,"column":9}},"type":"if","locations":[{"start":{"line":32,"column":8},"end":{"line":34,"column":9}},{"start":{"line":32,"column":8},"end":{"line":34,"column":9}}],"line":32},"1":{"loc":{"start":{"line":32,"column":12},"end":{"line":32,"column":40}},"type":"binary-expr","locations":[{"start":{"line":32,"column":12},"end":{"line":32,"column":24}},{"start":{"line":32,"column":28},"end":{"line":32,"column":40}}],"line":32},"2":{"loc":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"type":"if","locations":[{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},{"start":{"line":38,"column":8},"end":{"line":40,"column":9}}],"line":38},"3":{"loc":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"type":"if","locations":[{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},{"start":{"line":44,"column":8},"end":{"line":46,"column":9}}],"line":44},"4":{"loc":{"start":{"line":44,"column":12},"end":{"line":44,"column":39}},"type":"binary-expr","locations":[{"start":{"line":44,"column":12},"end":{"line":44,"column":23}},{"start":{"line":44,"column":27},"end":{"line":44,"column":39}}],"line":44},"5":{"loc":{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},"type":"if","locations":[{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},{"start":{"line":50,"column":8},"end":{"line":52,"column":9}}],"line":50},"6":{"loc":{"start":{"line":50,"column":12},"end":{"line":50,"column":44}},"type":"binary-expr","locations":[{"start":{"line":50,"column":12},"end":{"line":50,"column":28}},{"start":{"line":50,"column":32},"end":{"line":50,"column":44}}],"line":50},"7":{"loc":{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},"type":"if","locations":[{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},{"start":{"line":55,"column":8},"end":{"line":57,"column":9}}],"line":55},"8":{"loc":{"start":{"line":55,"column":12},"end":{"line":55,"column":48}},"type":"binary-expr","locations":[{"start":{"line":55,"column":12},"end":{"line":55,"column":32}},{"start":{"line":55,"column":36},"end":{"line":55,"column":48}}],"line":55},"9":{"loc":{"start":{"line":61,"column":8},"end":{"line":68,"column":9}},"type":"if","locations":[{"start":{"line":61,"column":8},"end":{"line":68,"column":9}},{"start":{"line":61,"column":8},"end":{"line":68,"column":9}}],"line":61},"10":{"loc":{"start":{"line":61,"column":12},"end":{"line":61,"column":65}},"type":"binary-expr","locations":[{"start":{"line":61,"column":12},"end":{"line":61,"column":25}},{"start":{"line":61,"column":29},"end":{"line":61,"column":49}},{"start":{"line":61,"column":53},"end":{"line":61,"column":65}}],"line":61},"11":{"loc":{"start":{"line":62,"column":12},"end":{"line":66,"column":13}},"type":"if","locations":[{"start":{"line":62,"column":12},"end":{"line":66,"column":13}},{"start":{"line":62,"column":12},"end":{"line":66,"column":13}}],"line":62},"12":{"loc":{"start":{"line":62,"column":16},"end":{"line":62,"column":71}},"type":"binary-expr","locations":[{"start":{"line":62,"column":16},"end":{"line":62,"column":40}},{"start":{"line":62,"column":44},"end":{"line":62,"column":71}}],"line":62},"13":{"loc":{"start":{"line":72,"column":8},"end":{"line":75,"column":9}},"type":"if","locations":[{"start":{"line":72,"column":8},"end":{"line":75,"column":9}},{"start":{"line":72,"column":8},"end":{"line":75,"column":9}}],"line":72},"14":{"loc":{"start":{"line":72,"column":12},"end":{"line":72,"column":66}},"type":"binary-expr","locations":[{"start":{"line":72,"column":12},"end":{"line":72,"column":25}},{"start":{"line":72,"column":29},"end":{"line":72,"column":50}},{"start":{"line":72,"column":54},"end":{"line":72,"column":66}}],"line":72},"15":{"loc":{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},"type":"if","locations":[{"start":{"line":79,"column":8},"end":{"line":81,"column":9}},{"start":{"line":79,"column":8},"end":{"line":81,"column":9}}],"line":79},"16":{"loc":{"start":{"line":79,"column":12},"end":{"line":79,"column":41}},"type":"binary-expr","locations":[{"start":{"line":79,"column":12},"end":{"line":79,"column":25}},{"start":{"line":79,"column":29},"end":{"line":79,"column":41}}],"line":79},"17":{"loc":{"start":{"line":85,"column":8},"end":{"line":87,"column":9}},"type":"if","locations":[{"start":{"line":85,"column":8},"end":{"line":87,"column":9}},{"start":{"line":85,"column":8},"end":{"line":87,"column":9}}],"line":85},"18":{"loc":{"start":{"line":85,"column":12},"end":{"line":85,"column":40}},"type":"binary-expr","locations":[{"start":{"line":85,"column":12},"end":{"line":85,"column":24}},{"start":{"line":85,"column":28},"end":{"line":85,"column":40}}],"line":85},"19":{"loc":{"start":{"line":91,"column":8},"end":{"line":94,"column":9}},"type":"if","locations":[{"start":{"line":91,"column":8},"end":{"line":94,"column":9}},{"start":{"line":91,"column":8},"end":{"line":94,"column":9}}],"line":91},"20":{"loc":{"start":{"line":91,"column":12},"end":{"line":91,"column":70}},"type":"binary-expr","locations":[{"start":{"line":91,"column":12},"end":{"line":91,"column":24}},{"start":{"line":91,"column":28},"end":{"line":91,"column":45}},{"start":{"line":91,"column":49},"end":{"line":91,"column":70}}],"line":91},"21":{"loc":{"start":{"line":98,"column":8},"end":{"line":100,"column":9}},"type":"if","locations":[{"start":{"line":98,"column":8},"end":{"line":100,"column":9}},{"start":{"line":98,"column":8},"end":{"line":100,"column":9}}],"line":98},"22":{"loc":{"start":{"line":98,"column":12},"end":{"line":98,"column":43}},"type":"binary-expr","locations":[{"start":{"line":98,"column":12},"end":{"line":98,"column":27}},{"start":{"line":98,"column":31},"end":{"line":98,"column":43}}],"line":98},"23":{"loc":{"start":{"line":104,"column":8},"end":{"line":108,"column":9}},"type":"if","locations":[{"start":{"line":104,"column":8},"end":{"line":108,"column":9}},{"start":{"line":104,"column":8},"end":{"line":108,"column":9}}],"line":104},"24":{"loc":{"start":{"line":104,"column":12},"end":{"line":104,"column":85}},"type":"binary-expr","locations":[{"start":{"line":104,"column":12},"end":{"line":104,"column":24}},{"start":{"line":104,"column":28},"end":{"line":104,"column":40}},{"start":{"line":104,"column":44},"end":{"line":104,"column":61}},{"start":{"line":104,"column":65},"end":{"line":104,"column":85}}],"line":104},"25":{"loc":{"start":{"line":112,"column":8},"end":{"line":114,"column":9}},"type":"if","locations":[{"start":{"line":112,"column":8},"end":{"line":114,"column":9}},{"start":{"line":112,"column":8},"end":{"line":114,"column":9}}],"line":112},"26":{"loc":{"start":{"line":112,"column":12},"end":{"line":112,"column":111}},"type":"binary-expr","locations":[{"start":{"line":112,"column":12},"end":{"line":112,"column":27}},{"start":{"line":112,"column":31},"end":{"line":112,"column":46}},{"start":{"line":112,"column":50},"end":{"line":112,"column":80}},{"start":{"line":112,"column":84},"end":{"line":112,"column":111}}],"line":112},"27":{"loc":{"start":{"line":113,"column":29},"end":{"line":113,"column":96}},"type":"cond-expr","locations":[{"start":{"line":113,"column":58},"end":{"line":113,"column":84}},{"start":{"line":113,"column":87},"end":{"line":113,"column":96}}],"line":113},"28":{"loc":{"start":{"line":119,"column":4},"end":{"line":121,"column":5}},"type":"if","locations":[{"start":{"line":119,"column":4},"end":{"line":121,"column":5}},{"start":{"line":119,"column":4},"end":{"line":121,"column":5}}],"line":119},"29":{"loc":{"start":{"line":122,"column":4},"end":{"line":124,"column":5}},"type":"if","locations":[{"start":{"line":122,"column":4},"end":{"line":124,"column":5}},{"start":{"line":122,"column":4},"end":{"line":124,"column":5}}],"line":122},"30":{"loc":{"start":{"line":130,"column":92},"end":{"line":130,"column":121}},"type":"cond-expr","locations":[{"start":{"line":130,"column":99},"end":{"line":130,"column":109}},{"start":{"line":130,"column":112},"end":{"line":130,"column":121}}],"line":130},"31":{"loc":{"start":{"line":135,"column":4},"end":{"line":137,"column":5}},"type":"if","locations":[{"start":{"line":135,"column":4},"end":{"line":137,"column":5}},{"start":{"line":135,"column":4},"end":{"line":137,"column":5}}],"line":135},"32":{"loc":{"start":{"line":138,"column":4},"end":{"line":140,"column":5}},"type":"if","locations":[{"start":{"line":138,"column":4},"end":{"line":140,"column":5}},{"start":{"line":138,"column":4},"end":{"line":140,"column":5}}],"line":138},"33":{"loc":{"start":{"line":146,"column":4},"end":{"line":148,"column":5}},"type":"if","locations":[{"start":{"line":146,"column":4},"end":{"line":148,"column":5}},{"start":{"line":146,"column":4},"end":{"line":148,"column":5}}],"line":146},"34":{"loc":{"start":{"line":156,"column":4},"end":{"line":158,"column":5}},"type":"if","locations":[{"start":{"line":156,"column":4},"end":{"line":158,"column":5}},{"start":{"line":156,"column":4},"end":{"line":158,"column":5}}],"line":156}},"s":{"0":1,"1":1,"2":5,"3":1,"4":6,"5":2,"6":3,"7":1,"8":1,"9":1,"10":1,"11":1,"12":0,"13":1,"14":0,"15":1,"16":0,"17":1,"18":0,"19":1,"20":0,"21":1,"22":0,"23":0,"24":0,"25":0,"26":1,"27":0,"28":0,"29":1,"30":0,"31":1,"32":0,"33":1,"34":0,"35":0,"36":1,"37":0,"38":1,"39":0,"40":0,"41":0,"42":1,"43":0,"44":1,"45":1,"46":11,"47":1,"48":10,"49":7,"50":3,"51":9,"52":1,"53":14,"54":24,"55":1,"56":1,"57":11,"58":11,"59":6,"60":5,"61":0,"62":5,"63":5,"64":5,"65":4,"66":4,"67":1,"68":3,"69":3,"70":1,"71":1,"72":6,"73":1,"74":5,"75":8},"f":{"0":1,"1":6,"2":2,"3":3,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":11,"20":9,"21":14,"22":24,"23":11,"24":6,"25":8},"b":{"0":[0,1],"1":[1,0],"2":[0,1],"3":[0,1],"4":[1,0],"5":[0,1],"6":[1,0],"7":[0,1],"8":[1,0],"9":[0,1],"10":[1,0,0],"11":[0,0],"12":[0,0],"13":[0,1],"14":[1,0,0],"15":[0,1],"16":[1,0],"17":[0,1],"18":[1,0],"19":[0,1],"20":[1,0,0],"21":[0,1],"22":[1,0],"23":[0,1],"24":[1,0,0,0],"25":[0,1],"26":[1,0,0,0],"27":[0,0],"28":[1,10],"29":[7,3],"30":[22,2],"31":[6,5],"32":[0,5],"33":[1,3],"34":[1,5]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/custom-oauth/server/transform_helpers.js"],"sourcesContent":["import { isObject } from '../../../lib/utils/isObject';\n\nexport const normalizers = {\n\t// Set 'id' to '_id' for any sources that provide it\n\t_id(identity) {\n\t\tif (identity._id && !identity.id) {\n\t\t\tidentity.id = identity._id;\n\t\t}\n\t},\n\n\t// Fix for Reddit\n\tredit(identity) {\n\t\tif (identity.result) {\n\t\t\treturn identity.result;\n\t\t}\n\t},\n\n\t// Fix WordPress-like identities having 'ID' instead of 'id'\n\twordpress(identity) {\n\t\tif (identity.ID && !identity.id) {\n\t\t\tidentity.id = identity.ID;\n\t\t}\n\t},\n\n\t// Fix Auth0-like identities having 'user_id' instead of 'id'\n\tuser_id(identity) {\n\t\tif (identity.user_id && !identity.id) {\n\t\t\tidentity.id = identity.user_id;\n\t\t}\n\t},\n\n\tcharacterid(identity) {\n\t\tif (identity.CharacterID && !identity.id) {\n\t\t\tidentity.id = identity.CharacterID;\n\t\t}\n\t},\n\n\t// Fix Dataporten having 'user.userid' instead of 'id'\n\tdataporten(identity) {\n\t\tif (identity.user && identity.user.userid && !identity.id) {\n\t\t\tif (identity.user.userid_sec && identity.user.userid_sec[0]) {\n\t\t\t\tidentity.id = identity.user.userid_sec[0];\n\t\t\t} else {\n\t\t\t\tidentity.id = identity.user.userid;\n\t\t\t}\n\t\t\tidentity.email = identity.user.email;\n\t\t}\n\t},\n\n\t// Fix for Xenforo [BD]API plugin for 'user.user_id; instead of 'id'\n\txenforo(identity) {\n\t\tif (identity.user && identity.user.user_id && !identity.id) {\n\t\t\tidentity.id = identity.user.user_id;\n\t\t\tidentity.email = identity.user.user_email;\n\t\t}\n\t},\n\n\t// Fix general 'phid' instead of 'id' from phabricator\n\tphabricator(identity) {\n\t\tif (identity.phid && !identity.id) {\n\t\t\tidentity.id = identity.phid;\n\t\t}\n\t},\n\n\t// Fix Keycloak-like identities having 'sub' instead of 'id'\n\tkaycloak(identity) {\n\t\tif (identity.sub && !identity.id) {\n\t\t\tidentity.id = identity.sub;\n\t\t}\n\t},\n\n\t// Fix OpenShift identities where id is in 'metadata' object\n\topenshift(identity) {\n\t\tif (!identity.id && identity.metadata && identity.metadata.uid) {\n\t\t\tidentity.id = identity.metadata.uid;\n\t\t\tidentity.name = identity.fullName;\n\t\t}\n\t},\n\n\t// Fix general 'userid' instead of 'id' from provider\n\tuserid(identity) {\n\t\tif (identity.userid && !identity.id) {\n\t\t\tidentity.id = identity.userid;\n\t\t}\n\t},\n\n\t// Fix Nextcloud provider\n\tnextcloud(identity) {\n\t\tif (!identity.id && identity.ocs && identity.ocs.data && identity.ocs.data.id) {\n\t\t\tidentity.id = identity.ocs.data.id;\n\t\t\tidentity.name = identity.ocs.data.displayname;\n\t\t\tidentity.email = identity.ocs.data.email;\n\t\t}\n\t},\n\n\t// Fix when authenticating from a meteor app with 'emails' field\n\tmeteor(identity) {\n\t\tif (!identity.email && identity.emails && Array.isArray(identity.emails) && identity.emails.length >= 1) {\n\t\t\tidentity.email = identity.emails[0].address ? identity.emails[0].address : undefined;\n\t\t}\n\t},\n};\n\nconst IDENTITY_PROPNAME_FILTER = /(\\.)/g;\nexport const renameInvalidProperties = (input) => {\n\tif (Array.isArray(input)) {\n\t\treturn input.map(renameInvalidProperties);\n\t}\n\tif (!isObject(input)) {\n\t\treturn input;\n\t}\n\n\treturn Object.entries(input).reduce(\n\t\t(result, [name, value]) => ({\n\t\t\t...result,\n\t\t\t[name.replace(IDENTITY_PROPNAME_FILTER, '_')]: renameInvalidProperties(value),\n\t\t}),\n\t\t{},\n\t);\n};\n\nexport const getNestedValue = (propertyPath, source) =>\n\tpropertyPath.split('.').reduce((prev, curr) => (prev ? prev[curr] : undefined), source);\n\n// /^(.+)@/::email\nconst REGEXP_FROM_FORMULA = /^\\/((?!\\/::).*)\\/::(.+)/;\nexport const getRegexpMatch = (formula, data) => {\n\tconst regexAndPath = REGEXP_FROM_FORMULA.exec(formula);\n\tif (!regexAndPath) {\n\t\treturn getNestedValue(formula, data);\n\t}\n\tif (regexAndPath.length !== 3) {\n\t\tthrow new Error(`expected array of length 3, got ${regexAndPath.length}`);\n\t}\n\n\tconst [, regexString, path] = regexAndPath;\n\tconst nestedValue = getNestedValue(path, data);\n\tconst regex = new RegExp(regexString);\n\tconst matches = regex.exec(nestedValue);\n\n\t// regexp does not match nested value\n\tif (!matches) {\n\t\treturn undefined;\n\t}\n\n\t// we only support regular expressions with a single capture group\n\tconst [, value] = matches;\n\n\t// this could mean we return `undefined` (e.g. when capture group is empty)\n\treturn value;\n};\n\nconst templateStringRegex = /{{((?:(?!}}).)+)}}/g;\nexport const fromTemplate = (template, data) => {\n\tif (!templateStringRegex.test(template)) {\n\t\treturn getNestedValue(template, data);\n\t}\n\n\treturn template.replace(templateStringRegex, (fullMatch, match) => getRegexpMatch(match, data));\n};\n"],"names":["fromTemplate","getNestedValue","getRegexpMatch","normalizers","renameInvalidProperties","_id","identity","id","redit","result","wordpress","ID","user_id","characterid","CharacterID","dataporten","user","userid","userid_sec","email","xenforo","user_email","phabricator","phid","kaycloak","sub","openshift","metadata","uid","name","fullName","nextcloud","ocs","data","displayname","meteor","emails","Array","isArray","length","address","undefined","IDENTITY_PROPNAME_FILTER","input","map","isObject","Object","entries","reduce","value","replace","propertyPath","source","split","prev","curr","REGEXP_FROM_FORMULA","formula","regexAndPath","exec","Error","regexString","path","nestedValue","regex","RegExp","matches","templateStringRegex","template","test","fullMatch","match"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/custom-oauth/server/transform_helpers.js"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"39678da3cb4a003722e1233ae82442051f73a03b","contentHash":"006951ab3b7221cecaf85ccc307c2042d3d541d776e4f62d2354d14c1d188c86"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/highlight-words/client/helper.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/highlight-words/client/helper.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":21,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":33}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":36}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":30}},"7":{"start":{"line":22,"column":23},"end":{"line":22,"column":61}},"8":{"start":{"line":23,"column":36},"end":{"line":23,"column":72}},"9":{"start":{"line":23,"column":53},"end":{"line":23,"column":72}},"10":{"start":{"line":24,"column":30},"end":{"line":31,"column":1}},"11":{"start":{"line":25,"column":27},"end":{"line":25,"column":55}},"12":{"start":{"line":26,"column":4},"end":{"line":30,"column":12}},"13":{"start":{"line":27,"column":29},"end":{"line":27,"column":110}},"14":{"start":{"line":28,"column":34},"end":{"line":28,"column":63}},"15":{"start":{"line":29,"column":8},"end":{"line":29,"column":53}},"16":{"start":{"line":32,"column":26},"end":{"line":32,"column":70}},"17":{"start":{"line":33,"column":26},"end":{"line":33,"column":203}},"18":{"start":{"line":33,"column":39},"end":{"line":33,"column":203}},"19":{"start":{"line":34,"column":29},"end":{"line":34,"column":240}},"20":{"start":{"line":34,"column":42},"end":{"line":34,"column":240}},"21":{"start":{"line":35,"column":23},"end":{"line":41,"column":11}},"22":{"start":{"line":35,"column":42},"end":{"line":41,"column":11}},"23":{"start":{"line":36,"column":27},"end":{"line":36,"column":69}},"24":{"start":{"line":37,"column":8},"end":{"line":39,"column":9}},"25":{"start":{"line":38,"column":12},"end":{"line":38,"column":57}},"26":{"start":{"line":40,"column":8},"end":{"line":40,"column":99}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":23},"end":{"line":12,"column":24}},"loc":{"start":{"line":12,"column":34},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":26},"end":{"line":15,"column":27}},"loc":{"start":{"line":15,"column":37},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":20},"end":{"line":18,"column":21}},"loc":{"start":{"line":18,"column":31},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":23,"column":36},"end":{"line":23,"column":37}},"loc":{"start":{"line":23,"column":53},"end":{"line":23,"column":72}},"line":23},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":30},"end":{"line":24,"column":31}},"loc":{"start":{"line":24,"column":60},"end":{"line":31,"column":1}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":26,"column":29},"end":{"line":26,"column":30}},"loc":{"start":{"line":26,"column":43},"end":{"line":30,"column":5}},"line":26},"7":{"name":"(anonymous_7)","decl":{"start":{"line":33,"column":26},"end":{"line":33,"column":27}},"loc":{"start":{"line":33,"column":39},"end":{"line":33,"column":203}},"line":33},"8":{"name":"(anonymous_8)","decl":{"start":{"line":34,"column":29},"end":{"line":34,"column":30}},"loc":{"start":{"line":34,"column":42},"end":{"line":34,"column":240}},"line":34},"9":{"name":"(anonymous_9)","decl":{"start":{"line":35,"column":23},"end":{"line":35,"column":24}},"loc":{"start":{"line":35,"column":42},"end":{"line":41,"column":11}},"line":35},"10":{"name":"(anonymous_10)","decl":{"start":{"line":35,"column":60},"end":{"line":35,"column":61}},"loc":{"start":{"line":35,"column":99},"end":{"line":41,"column":5}},"line":35}},"branchMap":{"0":{"loc":{"start":{"line":37,"column":8},"end":{"line":39,"column":9}},"type":"if","locations":[{"start":{"line":37,"column":8},"end":{"line":39,"column":9}},{"start":{"line":37,"column":8},"end":{"line":39,"column":9}}],"line":37}},"s":{"0":1,"1":1,"2":3,"3":1,"4":4,"5":4,"6":4,"7":1,"8":1,"9":4,"10":1,"11":3,"12":3,"13":4,"14":4,"15":4,"16":1,"17":1,"18":4,"19":1,"20":4,"21":1,"22":4,"23":4,"24":4,"25":1,"26":3},"f":{"0":1,"1":4,"2":4,"3":4,"4":4,"5":3,"6":4,"7":4,"8":4,"9":4,"10":4},"b":{"0":[1,3]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/highlight-words/client/helper.ts"],"sourcesContent":["import { escapeRegExp } from '@rocket.chat/string-helpers';\n\nconst checkHighlightedWordsInUrls = (msg: string, urlRegex: RegExp) => msg.match(urlRegex);\n\nconst removeHighlightedUrls = (msg: string, highlight: string, urlMatches: string[]) => {\n\tconst highlightRegex = new RegExp(highlight, 'gmi');\n\n\treturn urlMatches.reduce((msg, match) => {\n\t\tconst withTemplate = match.replace(highlightRegex, `<mark class=\"highlight-text\">${highlight}</mark>`);\n\t\tconst regexWithTemplate = new RegExp(withTemplate, 'i');\n\t\treturn msg.replace(regexWithTemplate, match);\n\t}, msg);\n};\n\nconst highlightTemplate = '$1<mark class=\"highlight-text\">$2</mark>$3';\n\nexport const getRegexHighlight = (highlight: string) =>\n\tnew RegExp(\n\t\t`(^|\\\\b|[\\\\s\\\\n\\\\r\\\\t.,،'\\\\\\\"\\\\+!?:-])(${escapeRegExp(highlight)})($|\\\\b|[\\\\s\\\\n\\\\r\\\\t.,،'\\\\\\\"\\\\+!?:-])(?![^<]*>|[^<>]*<\\\\/)`,\n\t\t'gmi',\n\t);\n\nexport const getRegexHighlightUrl = (highlight: string) =>\n\tnew RegExp(\n\t\t`https?:\\/\\/(www\\\\.)?[-a-zA-Z0-9@:%._\\\\+~#=]{2,256}\\\\.[a-z]{2,6}\\\\b([-a-zA-Z0-9@:%_\\\\+.~#?&//=]*)(${escapeRegExp(\n\t\t\thighlight,\n\t\t)})\\\\b([-a-zA-Z0-9@:%_\\\\+.~#?&//=]*)`,\n\t\t'gmi',\n\t);\n\nexport const highlightWords = (msg: string, highlights: { highlight: string; regex: RegExp; urlRegex: RegExp }[]) =>\n\thighlights.reduce((msg: string, { highlight, regex, urlRegex }: { highlight: string; regex: RegExp; urlRegex: RegExp }) => {\n\t\tconst urlMatches = checkHighlightedWordsInUrls(msg, urlRegex);\n\t\tif (!urlMatches) {\n\t\t\treturn msg.replace(regex, highlightTemplate);\n\t\t}\n\t\treturn removeHighlightedUrls(msg.replace(regex, highlightTemplate), highlight, urlMatches);\n\t}, msg);\n"],"names":["getRegexHighlight","getRegexHighlightUrl","highlightWords","checkHighlightedWordsInUrls","msg","urlRegex","match","removeHighlightedUrls","highlight","urlMatches","highlightRegex","RegExp","reduce","withTemplate","replace","regexWithTemplate","highlightTemplate","escapeRegExp","highlights","regex"],"mappings":";;;;;;;;;;;IAgBaA,iBAAiB;eAAjBA;;IAMAC,oBAAoB;eAApBA;;IAQAC,cAAc;eAAdA;;;+BA9BgB;AAE7B,MAAMC,8BAA8B,CAACC,KAAaC,WAAqBD,IAAIE,KAAK,CAACD;AAEjF,MAAME,wBAAwB,CAACH,KAAaI,WAAmBC;IAC9D,MAAMC,iBAAiB,IAAIC,OAAOH,WAAW;IAE7C,OAAOC,WAAWG,MAAM,CAAC,CAACR,KAAKE;QAC9B,MAAMO,eAAeP,MAAMQ,OAAO,CAACJ,gBAAgB,CAAC,6BAA6B,EAAEF,UAAU,OAAO,CAAC;QACrG,MAAMO,oBAAoB,IAAIJ,OAAOE,cAAc;QACnD,OAAOT,IAAIU,OAAO,CAACC,mBAAmBT;IACvC,GAAGF;AACJ;AAEA,MAAMY,oBAAoB;AAEnB,MAAMhB,oBAAoB,CAACQ,YACjC,IAAIG,OACH,CAAC,sCAAsC,EAAEM,IAAAA,2BAAY,EAACT,WAAW,2DAA2D,CAAC,EAC7H;AAGK,MAAMP,uBAAuB,CAACO,YACpC,IAAIG,OACH,CAAC,iGAAiG,EAAEM,IAAAA,2BAAY,EAC/GT,WACC,kCAAkC,CAAC,EACrC;AAGK,MAAMN,iBAAiB,CAACE,KAAac,aAC3CA,WAAWN,MAAM,CAAC,CAACR,KAAa,EAAEI,SAAS,EAAEW,KAAK,EAAEd,QAAQ,EAA0D;QACrH,MAAMI,aAAaN,4BAA4BC,KAAKC;QACpD,IAAI,CAACI,YAAY;YAChB,OAAOL,IAAIU,OAAO,CAACK,OAAOH;QAC3B;QACA,OAAOT,sBAAsBH,IAAIU,OAAO,CAACK,OAAOH,oBAAoBR,WAAWC;IAChF,GAAGL","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/highlight-words/client/helper.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"13fed6118f4285ab7a7a358c24afa89e7508aafa","contentHash":"975f8b117765a876e66233900d0ef8c680676954af559146b51e3b4dd20d37db"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/markdown.js":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/markdown.js","statementMap":{"0":{"start":{"line":5,"column":0},"end":{"line":7,"column":3}},"1":{"start":{"line":9,"column":4},"end":{"line":12,"column":7}},"2":{"start":{"line":9,"column":24},"end":{"line":12,"column":7}},"3":{"start":{"line":14,"column":0},"end":{"line":27,"column":3}},"4":{"start":{"line":16,"column":8},"end":{"line":16,"column":24}},"5":{"start":{"line":19,"column":8},"end":{"line":19,"column":45}},"6":{"start":{"line":22,"column":8},"end":{"line":22,"column":50}},"7":{"start":{"line":25,"column":8},"end":{"line":25,"column":30}},"8":{"start":{"line":28,"column":23},"end":{"line":28,"column":61}},"9":{"start":{"line":29,"column":16},"end":{"line":29,"column":40}},"10":{"start":{"line":30,"column":18},"end":{"line":30,"column":55}},"11":{"start":{"line":31,"column":14},"end":{"line":31,"column":47}},"12":{"start":{"line":32,"column":18},"end":{"line":32,"column":55}},"13":{"start":{"line":33,"column":16},"end":{"line":36,"column":1}},"14":{"start":{"line":37,"column":20},"end":{"line":89,"column":1}},"15":{"start":{"line":39,"column":24},"end":{"line":41,"column":9}},"16":{"start":{"line":42,"column":8},"end":{"line":42,"column":79}},"17":{"start":{"line":45,"column":24},"end":{"line":47,"column":9}},"18":{"start":{"line":48,"column":8},"end":{"line":48,"column":79}},"19":{"start":{"line":51,"column":24},"end":{"line":53,"column":9}},"20":{"start":{"line":54,"column":8},"end":{"line":54,"column":50}},"21":{"start":{"line":57,"column":30},"end":{"line":57,"column":32}},"22":{"start":{"line":58,"column":8},"end":{"line":70,"column":9}},"23":{"start":{"line":59,"column":12},"end":{"line":69,"column":13}},"24":{"start":{"line":60,"column":16},"end":{"line":68,"column":17}},"25":{"start":{"line":61,"column":20},"end":{"line":61,"column":92}},"26":{"start":{"line":61,"column":67},"end":{"line":61,"column":90}},"27":{"start":{"line":63,"column":20},"end":{"line":67,"column":23}},"28":{"start":{"line":73,"column":8},"end":{"line":75,"column":9}},"29":{"start":{"line":74,"column":12},"end":{"line":74,"column":77}},"30":{"start":{"line":78,"column":8},"end":{"line":80,"column":9}},"31":{"start":{"line":79,"column":12},"end":{"line":79,"column":78}},"32":{"start":{"line":81,"column":8},"end":{"line":81,"column":23}},"33":{"start":{"line":84,"column":8},"end":{"line":84,"column":40}},"34":{"start":{"line":87,"column":8},"end":{"line":87,"column":41}},"35":{"start":{"line":90,"column":17},"end":{"line":90,"column":36}},"36":{"start":{"line":91,"column":23},"end":{"line":91,"column":77}},"37":{"start":{"line":91,"column":34},"end":{"line":91,"column":77}},"38":{"start":{"line":92,"column":38},"end":{"line":101,"column":1}},"39":{"start":{"line":93,"column":25},"end":{"line":93,"column":39}},"40":{"start":{"line":94,"column":4},"end":{"line":100,"column":6}},"41":{"start":{"line":96,"column":8},"end":{"line":98,"column":9}},"42":{"start":{"line":97,"column":12},"end":{"line":97,"column":27}},"43":{"start":{"line":99,"column":8},"end":{"line":99,"column":101}},"44":{"start":{"line":102,"column":43},"end":{"line":102,"column":83}},"45":{"start":{"line":102,"column":47},"end":{"line":102,"column":83}},"46":{"start":{"line":102,"column":58},"end":{"line":102,"column":83}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":8,"column":9},"end":{"line":8,"column":16}},"loc":{"start":{"line":8,"column":30},"end":{"line":13,"column":1}},"line":8},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":14},"end":{"line":15,"column":15}},"loc":{"start":{"line":15,"column":25},"end":{"line":17,"column":5}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":18,"column":35},"end":{"line":18,"column":36}},"loc":{"start":{"line":18,"column":46},"end":{"line":20,"column":5}},"line":18},"3":{"name":"(anonymous_3)","decl":{"start":{"line":21,"column":40},"end":{"line":21,"column":41}},"loc":{"start":{"line":21,"column":51},"end":{"line":23,"column":5}},"line":21},"4":{"name":"(anonymous_4)","decl":{"start":{"line":24,"column":20},"end":{"line":24,"column":21}},"loc":{"start":{"line":24,"column":31},"end":{"line":26,"column":5}},"line":24},"5":{"name":"(anonymous_5)","decl":{"start":{"line":38,"column":4},"end":{"line":38,"column":5}},"loc":{"start":{"line":38,"column":16},"end":{"line":43,"column":5}},"line":38},"6":{"name":"(anonymous_6)","decl":{"start":{"line":44,"column":4},"end":{"line":44,"column":5}},"loc":{"start":{"line":44,"column":26},"end":{"line":49,"column":5}},"line":44},"7":{"name":"(anonymous_7)","decl":{"start":{"line":50,"column":4},"end":{"line":50,"column":5}},"loc":{"start":{"line":50,"column":36},"end":{"line":55,"column":5}},"line":50},"8":{"name":"(anonymous_8)","decl":{"start":{"line":56,"column":4},"end":{"line":56,"column":5}},"loc":{"start":{"line":56,"column":67},"end":{"line":76,"column":5}},"line":56},"9":{"name":"(anonymous_9)","decl":{"start":{"line":61,"column":63},"end":{"line":61,"column":64}},"loc":{"start":{"line":61,"column":67},"end":{"line":61,"column":90}},"line":61},"10":{"name":"(anonymous_10)","decl":{"start":{"line":77,"column":4},"end":{"line":77,"column":5}},"loc":{"start":{"line":77,"column":45},"end":{"line":82,"column":5}},"line":77},"11":{"name":"(anonymous_11)","decl":{"start":{"line":83,"column":4},"end":{"line":83,"column":5}},"loc":{"start":{"line":83,"column":18},"end":{"line":85,"column":5}},"line":83},"12":{"name":"(anonymous_12)","decl":{"start":{"line":86,"column":35},"end":{"line":86,"column":36}},"loc":{"start":{"line":86,"column":70},"end":{"line":88,"column":5}},"line":86},"13":{"name":"(anonymous_13)","decl":{"start":{"line":91,"column":23},"end":{"line":91,"column":24}},"loc":{"start":{"line":91,"column":34},"end":{"line":91,"column":77}},"line":91},"14":{"name":"(anonymous_14)","decl":{"start":{"line":92,"column":38},"end":{"line":92,"column":39}},"loc":{"start":{"line":92,"column":56},"end":{"line":101,"column":1}},"line":92},"15":{"name":"(anonymous_15)","decl":{"start":{"line":94,"column":11},"end":{"line":94,"column":12}},"loc":{"start":{"line":94,"column":47},"end":{"line":100,"column":5}},"line":94},"16":{"name":"(anonymous_16)","decl":{"start":{"line":102,"column":43},"end":{"line":102,"column":44}},"loc":{"start":{"line":102,"column":47},"end":{"line":102,"column":83}},"line":102},"17":{"name":"(anonymous_17)","decl":{"start":{"line":102,"column":47},"end":{"line":102,"column":48}},"loc":{"start":{"line":102,"column":58},"end":{"line":102,"column":83}},"line":102}},"branchMap":{"0":{"loc":{"start":{"line":56,"column":51},"end":{"line":56,"column":65}},"type":"default-arg","locations":[{"start":{"line":56,"column":61},"end":{"line":56,"column":65}}],"line":56},"1":{"loc":{"start":{"line":58,"column":8},"end":{"line":70,"column":9}},"type":"if","locations":[{"start":{"line":58,"column":8},"end":{"line":70,"column":9}},{"start":{"line":58,"column":8},"end":{"line":70,"column":9}}],"line":58},"2":{"loc":{"start":{"line":60,"column":16},"end":{"line":68,"column":17}},"type":"if","locations":[{"start":{"line":60,"column":16},"end":{"line":68,"column":17}},{"start":{"line":60,"column":16},"end":{"line":68,"column":17}}],"line":60},"3":{"loc":{"start":{"line":61,"column":67},"end":{"line":61,"column":90}},"type":"cond-expr","locations":[{"start":{"line":61,"column":77},"end":{"line":61,"column":81}},{"start":{"line":61,"column":84},"end":{"line":61,"column":90}}],"line":61},"4":{"loc":{"start":{"line":73,"column":8},"end":{"line":75,"column":9}},"type":"if","locations":[{"start":{"line":73,"column":8},"end":{"line":75,"column":9}},{"start":{"line":73,"column":8},"end":{"line":75,"column":9}}],"line":73},"5":{"loc":{"start":{"line":73,"column":12},"end":{"line":73,"column":79}},"type":"binary-expr","locations":[{"start":{"line":73,"column":12},"end":{"line":73,"column":36}},{"start":{"line":73,"column":40},"end":{"line":73,"column":79}}],"line":73},"6":{"loc":{"start":{"line":77,"column":29},"end":{"line":77,"column":43}},"type":"default-arg","locations":[{"start":{"line":77,"column":39},"end":{"line":77,"column":43}}],"line":77},"7":{"loc":{"start":{"line":78,"column":8},"end":{"line":80,"column":9}},"type":"if","locations":[{"start":{"line":78,"column":8},"end":{"line":80,"column":9}},{"start":{"line":78,"column":8},"end":{"line":80,"column":9}}],"line":78},"8":{"loc":{"start":{"line":94,"column":21},"end":{"line":94,"column":44}},"type":"default-arg","locations":[{"start":{"line":94,"column":39},"end":{"line":94,"column":44}}],"line":94},"9":{"loc":{"start":{"line":96,"column":8},"end":{"line":98,"column":9}},"type":"if","locations":[{"start":{"line":96,"column":8},"end":{"line":98,"column":9}},{"start":{"line":96,"column":8},"end":{"line":98,"column":9}}],"line":96},"10":{"loc":{"start":{"line":96,"column":14},"end":{"line":96,"column":163}},"type":"cond-expr","locations":[{"start":{"line":96,"column":55},"end":{"line":96,"column":61}},{"start":{"line":96,"column":64},"end":{"line":96,"column":163}}],"line":96},"11":{"loc":{"start":{"line":96,"column":14},"end":{"line":96,"column":52}},"type":"binary-expr","locations":[{"start":{"line":96,"column":14},"end":{"line":96,"column":30}},{"start":{"line":96,"column":34},"end":{"line":96,"column":52}}],"line":96},"12":{"loc":{"start":{"line":96,"column":64},"end":{"line":96,"column":163}},"type":"cond-expr","locations":[{"start":{"line":96,"column":134},"end":{"line":96,"column":140}},{"start":{"line":96,"column":143},"end":{"line":96,"column":163}}],"line":96},"13":{"loc":{"start":{"line":96,"column":64},"end":{"line":96,"column":131}},"type":"binary-expr","locations":[{"start":{"line":96,"column":64},"end":{"line":96,"column":103}},{"start":{"line":96,"column":107},"end":{"line":96,"column":131}}],"line":96},"14":{"loc":{"start":{"line":99,"column":15},"end":{"line":99,"column":100}},"type":"cond-expr","locations":[{"start":{"line":99,"column":33},"end":{"line":99,"column":63}},{"start":{"line":99,"column":66},"end":{"line":99,"column":100}}],"line":99}},"s":{"0":1,"1":1,"2":4,"3":1,"4":1,"5":0,"6":0,"7":0,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":254,"22":254,"23":44,"24":44,"25":44,"26":44,"27":0,"28":254,"29":0,"30":254,"31":254,"32":254,"33":0,"34":0,"35":1,"36":1,"37":0,"38":1,"39":0,"40":0,"41":0,"42":0,"43":0,"44":1,"45":0,"46":0},"f":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":254,"9":44,"10":254,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},"b":{"0":[0],"1":[44,210],"2":[44,0],"3":[44,0],"4":[0,254],"5":[254,0],"6":[254],"7":[254,0],"8":[0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/markdown.js"],"sourcesContent":["/*\n * Markdown is a named function that will parse markdown syntax\n * @param {Object} message - The message object\n */\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport { Meteor } from 'meteor/meteor';\n\nimport { filtered } from './parser/filtered/filtered';\nimport { code } from './parser/original/code';\nimport { original } from './parser/original/original';\n\nconst parsers = {\n\toriginal,\n\tfiltered,\n};\n\nclass MarkdownClass {\n\tparse(text) {\n\t\tconst message = {\n\t\t\thtml: escapeHTML(text),\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseNotEscaped(text) {\n\t\tconst message = {\n\t\t\thtml: text,\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseMessageNotEscaped(message) {\n\t\tconst options = {\n\t\t\trootUrl: Meteor.absoluteUrl(),\n\t\t};\n\n\t\treturn parsers.original(message, options);\n\t}\n\n\tmountTokensBackRecursively(message, tokenList, useHtml = true) {\n\t\tconst missingTokens = [];\n\n\t\tif (tokenList.length > 0) {\n\t\t\tfor (const { token, text, noHtml } of tokenList) {\n\t\t\t\tif (message.html.indexOf(token) >= 0) {\n\t\t\t\t\tmessage.html = message.html.replace(token, () => (useHtml ? text : noHtml)); // Uses lambda so doesn't need to escape $\n\t\t\t\t} else {\n\t\t\t\t\tmissingTokens.push({ token, text, noHtml });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// If there are tokens that were missing from the string, but the last iteration replaced at least one token, then go again\n\t\t// this is done because one of the tokens may have been hidden by another one\n\t\tif (missingTokens.length > 0 && missingTokens.length < tokenList.length) {\n\t\t\tthis.mountTokensBackRecursively(message, missingTokens, useHtml);\n\t\t}\n\t}\n\n\tmountTokensBack(message, useHtml = true) {\n\t\tif (message.tokens) {\n\t\t\tthis.mountTokensBackRecursively(message, message.tokens, useHtml);\n\t\t}\n\n\t\treturn message;\n\t}\n\n\tcode(...args) {\n\t\treturn code(...args);\n\t}\n\n\t/** @param {string} message */\n\tfilterMarkdownFromMessage(message) {\n\t\treturn parsers.filtered(message);\n\t}\n}\n\nexport const Markdown = new MarkdownClass();\n\n/** @param {string} message */\nexport const filterMarkdown = (message) => Markdown.filterMarkdownFromMessage(message);\n\nexport const createMarkdownMessageRenderer = ({ ...options }) => {\n\tconst markedParser = parsers.marked;\n\treturn (message, useMarkedParser = false) => {\n\t\tif (!message?.html?.trim()) {\n\t\t\treturn message;\n\t\t}\n\n\t\treturn useMarkedParser ? markedParser(message, options) : parsers.original(message, options);\n\t};\n};\n\nexport const createMarkdownNotificationRenderer = () => (message) => parsers.filtered(message);\n"],"names":["Markdown","createMarkdownMessageRenderer","createMarkdownNotificationRenderer","filterMarkdown","parsers","original","filtered","MarkdownClass","parse","text","message","html","escapeHTML","mountTokensBack","parseMessageNotEscaped","parseNotEscaped","options","rootUrl","Meteor","absoluteUrl","mountTokensBackRecursively","tokenList","useHtml","missingTokens","length","token","noHtml","indexOf","replace","push","tokens","code","args","filterMarkdownFromMessage","markedParser","marked","useMarkedParser","trim"],"mappings":"AAAA;;;CAGC;;;;;;;;;;;IA0EYA,QAAQ;eAARA;;IAKAC,6BAA6B;eAA7BA;;IAWAC,kCAAkC;eAAlCA;;IAbAC,cAAc;eAAdA;;;+BA5Ec;wBACJ;0BAEE;sBACJ;0BACI;AAEzB,MAAMC,UAAU;IACfC,UAAAA,kBAAQ;IACRC,UAAAA,kBAAQ;AACT;AAEA,IAAA,AAAMC,gBAAN,MAAMA;IACLC,MAAMC,IAAI,EAAE;QACX,MAAMC,UAAU;YACfC,MAAMC,IAAAA,yBAAU,EAACH;QAClB;QACA,OAAO,IAAI,CAACI,eAAe,CAAC,IAAI,CAACC,sBAAsB,CAACJ,UAAUC,IAAI;IACvE;IAEAI,gBAAgBN,IAAI,EAAE;QACrB,MAAMC,UAAU;YACfC,MAAMF;QACP;QACA,OAAO,IAAI,CAACI,eAAe,CAAC,IAAI,CAACC,sBAAsB,CAACJ,UAAUC,IAAI;IACvE;IAEAG,uBAAuBJ,OAAO,EAAE;QAC/B,MAAMM,UAAU;YACfC,SAASC,cAAM,CAACC,WAAW;QAC5B;QAEA,OAAOf,QAAQC,QAAQ,CAACK,SAASM;IAClC;IAEAI,2BAA2BV,OAAO,EAAEW,SAAS,EAAEC,UAAU,IAAI,EAAE;QAC9D,MAAMC,gBAAgB,EAAE;QAExB,IAAIF,UAAUG,MAAM,GAAG,GAAG;YACzB,KAAK,MAAM,EAAEC,KAAK,EAAEhB,IAAI,EAAEiB,MAAM,EAAE,IAAIL,UAAW;gBAChD,IAAIX,QAAQC,IAAI,CAACgB,OAAO,CAACF,UAAU,GAAG;oBACrCf,QAAQC,IAAI,GAAGD,QAAQC,IAAI,CAACiB,OAAO,CAACH,OAAO,IAAOH,UAAUb,OAAOiB,SAAU,0CAA0C;gBACxH,OAAO;oBACNH,cAAcM,IAAI,CAAC;wBAAEJ;wBAAOhB;wBAAMiB;oBAAO;gBAC1C;YACD;QACD;QAEA,2HAA2H;QAC3H,6EAA6E;QAC7E,IAAIH,cAAcC,MAAM,GAAG,KAAKD,cAAcC,MAAM,GAAGH,UAAUG,MAAM,EAAE;YACxE,IAAI,CAACJ,0BAA0B,CAACV,SAASa,eAAeD;QACzD;IACD;IAEAT,gBAAgBH,OAAO,EAAEY,UAAU,IAAI,EAAE;QACxC,IAAIZ,QAAQoB,MAAM,EAAE;YACnB,IAAI,CAACV,0BAA0B,CAACV,SAASA,QAAQoB,MAAM,EAAER;QAC1D;QAEA,OAAOZ;IACR;IAEAqB,KAAK,GAAGC,IAAI,EAAE;QACb,OAAOD,IAAAA,UAAI,KAAIC;IAChB;IAEA,4BAA4B,GAC5BC,0BAA0BvB,OAAO,EAAE;QAClC,OAAON,QAAQE,QAAQ,CAACI;IACzB;AACD;AAEO,MAAMV,WAAW,IAAIO;AAGrB,MAAMJ,iBAAiB,CAACO,UAAYV,SAASiC,yBAAyB,CAACvB;AAEvE,MAAMT,gCAAgC,CAAC,EAAE,GAAGe,SAAS;IAC3D,MAAMkB,eAAe9B,QAAQ+B,MAAM;IACnC,OAAO,CAACzB,SAAS0B,kBAAkB,KAAK;YAClC1B;QAAL,IAAI,EAACA,oBAAAA,+BAAAA,gBAAAA,QAASC,IAAI,cAAbD,oCAAAA,cAAe2B,IAAI,KAAI;YAC3B,OAAO3B;QACR;QAEA,OAAO0B,kBAAkBF,aAAaxB,SAASM,WAAWZ,QAAQC,QAAQ,CAACK,SAASM;IACrF;AACD;AAEO,MAAMd,qCAAqC,IAAM,CAACQ,UAAYN,QAAQE,QAAQ,CAACI","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/markdown.js"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"42fd6e513ac93d8343c60a02526e507c7264c344","contentHash":"5a14c8ef7b963adf2d698cb1732cc5f35d3835d54f41a1858a49ae5b2d3677bd"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/filtered/filtered.js":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/filtered/filtered.js","statementMap":{"0":{"start":{"line":6,"column":0},"end":{"line":8,"column":3}},"1":{"start":{"line":9,"column":0},"end":{"line":14,"column":3}},"2":{"start":{"line":12,"column":8},"end":{"line":12,"column":24}},"3":{"start":{"line":15,"column":17},"end":{"line":40,"column":1}},"4":{"start":{"line":18,"column":20},"end":{"line":18,"column":70}},"5":{"start":{"line":20,"column":4},"end":{"line":20,"column":42}},"6":{"start":{"line":22,"column":4},"end":{"line":22,"column":106}},"7":{"start":{"line":22,"column":71},"end":{"line":22,"column":104}},"8":{"start":{"line":24,"column":4},"end":{"line":24,"column":126}},"9":{"start":{"line":24,"column":119},"end":{"line":24,"column":124}},"10":{"start":{"line":26,"column":4},"end":{"line":26,"column":141}},"11":{"start":{"line":26,"column":134},"end":{"line":26,"column":139}},"12":{"start":{"line":28,"column":4},"end":{"line":28,"column":147}},"13":{"start":{"line":30,"column":4},"end":{"line":30,"column":101}},"14":{"start":{"line":32,"column":4},"end":{"line":32,"column":101}},"15":{"start":{"line":34,"column":4},"end":{"line":34,"column":100}},"16":{"start":{"line":36,"column":4},"end":{"line":36,"column":73}},"17":{"start":{"line":38,"column":4},"end":{"line":38,"column":49}},"18":{"start":{"line":39,"column":4},"end":{"line":39,"column":19}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":10}},"loc":{"start":{"line":11,"column":20},"end":{"line":13,"column":5}},"line":11},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":17},"end":{"line":15,"column":18}},"loc":{"start":{"line":17,"column":4},"end":{"line":40,"column":1}},"line":17},"2":{"name":"(anonymous_2)","decl":{"start":{"line":22,"column":62},"end":{"line":22,"column":63}},"loc":{"start":{"line":22,"column":71},"end":{"line":22,"column":104}},"line":22},"3":{"name":"(anonymous_3)","decl":{"start":{"line":24,"column":103},"end":{"line":24,"column":104}},"loc":{"start":{"line":24,"column":119},"end":{"line":24,"column":124}},"line":24},"4":{"name":"(anonymous_4)","decl":{"start":{"line":26,"column":118},"end":{"line":26,"column":119}},"loc":{"start":{"line":26,"column":134},"end":{"line":26,"column":139}},"line":26}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":27},"end":{"line":17,"column":1}},"type":"default-arg","locations":[{"start":{"line":15,"column":37},"end":{"line":17,"column":1}}],"line":15}},"s":{"0":2,"1":2,"2":2,"3":2,"4":79,"5":79,"6":79,"7":7,"8":79,"9":4,"10":79,"11":2,"12":79,"13":79,"14":79,"15":79,"16":79,"17":79,"18":79},"f":{"0":2,"1":79,"2":7,"3":4,"4":2},"b":{"0":[79]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/filtered/filtered.js"],"sourcesContent":["/**\n * Filter markdown tags in message\n * Use case: notifications\n * @param {string} message\n */\nexport const filtered = (\n\tmessage,\n\toptions = {\n\t\tsupportSchemesForLink: 'http,https',\n\t},\n) => {\n\tconst schemes = options.supportSchemesForLink.split(',').join('|');\n\n\t// Remove block code backticks\n\tmessage = message.replace(/```/g, '');\n\n\t// Remove inline code backticks\n\tmessage = message.replace(new RegExp(/`([^`\\r\\n]+)\\`/gm), (match) => match.substr(1, match.length - 2));\n\n\t// Filter [text](url), ![alt_text](image_url)\n\tmessage = message.replace(new RegExp(`!?\\\\[([^\\\\]]+)\\\\]\\\\((?:${schemes}):\\\\/\\\\/[^\\\\)]+\\\\)`, 'gm'), (match, title) => title);\n\n\t// Filter <http://link|Text>\n\tmessage = message.replace(\n\t\tnew RegExp(`(?:<|&lt;)(?:${schemes}):\\\\/\\\\/[^\\\\|]+\\\\|(.+?)(?=>|&gt;)(?:>|&gt;)`, 'gm'),\n\t\t(match, title) => title,\n\t);\n\n\t// Filter headings\n\tmessage = message.replace(\n\t\t/(^#{1,4}) (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm,\n\t\t'$2',\n\t);\n\n\t// Filter bold\n\tmessage = message.replace(/(^|>|[ >_~`])\\*{1,2}([^\\*\\r\\n]+)\\*{1,2}([<_~`]|\\B|\\b|$)/gm, '$1$2$3');\n\n\t// Filter italics\n\tmessage = message.replace(/(^|>|[ >*~`])\\_{1,2}([^\\_\\r\\n]+)\\_{1,2}([<*~`]|\\B|\\b|$)/gm, '$1$2$3');\n\n\t// Filter strike-through text\n\tmessage = message.replace(/(^|>|[ >_*`])\\~{1,2}([^~\\r\\n]+)\\~{1,2}([<_*`]|\\B|\\b|$)/gm, '$1$2$3');\n\n\t// Filter block quotes\n\tmessage = message.replace(/(?:>){3}\\n+([\\s\\S]*?)\\n+(?:<){3}/g, '$1');\n\n\t// Filter > quote\n\tmessage = message.replace(/^>(.*)$/gm, '$1');\n\n\treturn message;\n};\n"],"names":["filtered","message","options","supportSchemesForLink","schemes","split","join","replace","RegExp","match","substr","length","title"],"mappings":"AAAA;;;;CAIC;;;;+BACYA;;;eAAAA;;;AAAN,MAAMA,WAAW,CACvBC,SACAC,UAAU;IACTC,uBAAuB;AACxB,CAAC;IAED,MAAMC,UAAUF,QAAQC,qBAAqB,CAACE,KAAK,CAAC,KAAKC,IAAI,CAAC;IAE9D,8BAA8B;IAC9BL,UAAUA,QAAQM,OAAO,CAAC,QAAQ;IAElC,+BAA+B;IAC/BN,UAAUA,QAAQM,OAAO,CAAC,IAAIC,OAAO,qBAAqB,CAACC,QAAUA,MAAMC,MAAM,CAAC,GAAGD,MAAME,MAAM,GAAG;IAEpG,6CAA6C;IAC7CV,UAAUA,QAAQM,OAAO,CAAC,IAAIC,OAAO,CAAC,uBAAuB,EAAEJ,QAAQ,kBAAkB,CAAC,EAAE,OAAO,CAACK,OAAOG,QAAUA;IAErH,4BAA4B;IAC5BX,UAAUA,QAAQM,OAAO,CACxB,IAAIC,OAAO,CAAC,aAAa,EAAEJ,QAAQ,2CAA2C,CAAC,EAAE,OACjF,CAACK,OAAOG,QAAUA;IAGnB,kBAAkB;IAClBX,UAAUA,QAAQM,OAAO,CACxB,+GACA;IAGD,cAAc;IACdN,UAAUA,QAAQM,OAAO,CAAC,6DAA6D;IAEvF,iBAAiB;IACjBN,UAAUA,QAAQM,OAAO,CAAC,6DAA6D;IAEvF,6BAA6B;IAC7BN,UAAUA,QAAQM,OAAO,CAAC,4DAA4D;IAEtF,sBAAsB;IACtBN,UAAUA,QAAQM,OAAO,CAAC,qCAAqC;IAE/D,iBAAiB;IACjBN,UAAUA,QAAQM,OAAO,CAAC,aAAa;IAEvC,OAAON;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/filtered/filtered.js"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2cb49615c9b2f0de199a7b6831f15ae952e4f175","contentHash":"ca46aab90949ef59799291431b3f1d914e9111cbadf7a09eab651c479db2988b"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/code.js":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/code.js","statementMap":{"0":{"start":{"line":5,"column":0},"end":{"line":7,"column":3}},"1":{"start":{"line":8,"column":0},"end":{"line":13,"column":3}},"2":{"start":{"line":11,"column":8},"end":{"line":11,"column":20}},"3":{"start":{"line":14,"column":23},"end":{"line":14,"column":61}},"4":{"start":{"line":15,"column":28},"end":{"line":15,"column":76}},"5":{"start":{"line":16,"column":15},"end":{"line":16,"column":33}},"6":{"start":{"line":18,"column":4},"end":{"line":18,"column":51}},"7":{"start":{"line":18,"column":39},"end":{"line":18,"column":51}},"8":{"start":{"line":19,"column":28},"end":{"line":19,"column":41}},"9":{"start":{"line":20,"column":27},"end":{"line":20,"column":40}},"10":{"start":{"line":21,"column":4},"end":{"line":23,"column":20}},"11":{"start":{"line":22,"column":8},"end":{"line":22,"column":66}},"12":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"13":{"start":{"line":27,"column":8},"end":{"line":27,"column":19}},"14":{"start":{"line":29,"column":4},"end":{"line":33,"column":5}},"15":{"start":{"line":30,"column":8},"end":{"line":32,"column":10}},"16":{"start":{"line":34,"column":16},"end":{"line":34,"column":53}},"17":{"start":{"line":35,"column":4},"end":{"line":37,"column":5}},"18":{"start":{"line":36,"column":8},"end":{"line":36,"column":30}},"19":{"start":{"line":38,"column":17},"end":{"line":40,"column":5}},"20":{"start":{"line":41,"column":32},"end":{"line":41,"column":88}},"21":{"start":{"line":42,"column":4},"end":{"line":51,"column":5}},"22":{"start":{"line":43,"column":8},"end":{"line":50,"column":9}},"23":{"start":{"line":44,"column":23},"end":{"line":44,"column":95}},"24":{"start":{"line":45,"column":12},"end":{"line":49,"column":13}},"25":{"start":{"line":46,"column":16},"end":{"line":46,"column":57}},"26":{"start":{"line":48,"column":16},"end":{"line":48,"column":39}},"27":{"start":{"line":52,"column":4},"end":{"line":52,"column":25}},"28":{"start":{"line":53,"column":4},"end":{"line":55,"column":5}},"29":{"start":{"line":54,"column":8},"end":{"line":54,"column":31}},"30":{"start":{"line":56,"column":4},"end":{"line":56,"column":18}},"31":{"start":{"line":58,"column":19},"end":{"line":63,"column":1}},"32":{"start":{"line":60,"column":4},"end":{"line":62,"column":12}},"33":{"start":{"line":60,"column":94},"end":{"line":62,"column":10}},"34":{"start":{"line":64,"column":19},"end":{"line":108,"column":1}},"35":{"start":{"line":66,"column":18},"end":{"line":66,"column":60}},"36":{"start":{"line":67,"column":4},"end":{"line":107,"column":5}},"37":{"start":{"line":69,"column":8},"end":{"line":72,"column":9}},"38":{"start":{"line":70,"column":12},"end":{"line":70,"column":53}},"39":{"start":{"line":71,"column":12},"end":{"line":71,"column":51}},"40":{"start":{"line":74,"column":25},"end":{"line":74,"column":101}},"41":{"start":{"line":75,"column":8},"end":{"line":104,"column":9}},"42":{"start":{"line":75,"column":24},"end":{"line":75,"column":25}},"43":{"start":{"line":77,"column":25},"end":{"line":77,"column":40}},"44":{"start":{"line":78,"column":30},"end":{"line":78,"column":91}},"45":{"start":{"line":79,"column":12},"end":{"line":103,"column":13}},"46":{"start":{"line":81,"column":35},"end":{"line":81,"column":68}},"47":{"start":{"line":82,"column":29},"end":{"line":82,"column":142}},"48":{"start":{"line":83,"column":38},"end":{"line":83,"column":162}},"49":{"start":{"line":84,"column":29},"end":{"line":84,"column":104}},"50":{"start":{"line":85,"column":31},"end":{"line":95,"column":20}},"51":{"start":{"line":86,"column":20},"end":{"line":93,"column":21}},"52":{"start":{"line":87,"column":24},"end":{"line":92,"column":25}},"53":{"start":{"line":88,"column":28},"end":{"line":88,"column":54}},"54":{"start":{"line":89,"column":28},"end":{"line":89,"column":71}},"55":{"start":{"line":91,"column":28},"end":{"line":91,"column":49}},"56":{"start":{"line":94,"column":20},"end":{"line":94,"column":68}},"57":{"start":{"line":96,"column":30},"end":{"line":99,"column":18}},"58":{"start":{"line":100,"column":16},"end":{"line":100,"column":40}},"59":{"start":{"line":102,"column":16},"end":{"line":102,"column":39}},"60":{"start":{"line":106,"column":8},"end":{"line":106,"column":41}},"61":{"start":{"line":109,"column":13},"end":{"line":116,"column":1}},"62":{"start":{"line":111,"column":4},"end":{"line":114,"column":5}},"63":{"start":{"line":112,"column":8},"end":{"line":112,"column":28}},"64":{"start":{"line":113,"column":8},"end":{"line":113,"column":28}},"65":{"start":{"line":115,"column":4},"end":{"line":115,"column":19}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":10,"column":9},"end":{"line":10,"column":10}},"loc":{"start":{"line":10,"column":20},"end":{"line":12,"column":5}},"line":10},"1":{"name":"_getRequireWildcardCache","decl":{"start":{"line":17,"column":9},"end":{"line":17,"column":33}},"loc":{"start":{"line":17,"column":47},"end":{"line":24,"column":1}},"line":17},"2":{"name":"(anonymous_2)","decl":{"start":{"line":21,"column":39},"end":{"line":21,"column":40}},"loc":{"start":{"line":21,"column":61},"end":{"line":23,"column":5}},"line":21},"3":{"name":"_interop_require_wildcard","decl":{"start":{"line":25,"column":9},"end":{"line":25,"column":34}},"loc":{"start":{"line":25,"column":53},"end":{"line":57,"column":1}},"line":25},"4":{"name":"(anonymous_4)","decl":{"start":{"line":58,"column":19},"end":{"line":58,"column":20}},"loc":{"start":{"line":58,"column":30},"end":{"line":63,"column":1}},"line":58},"5":{"name":"(anonymous_5)","decl":{"start":{"line":60,"column":77},"end":{"line":60,"column":78}},"loc":{"start":{"line":60,"column":94},"end":{"line":62,"column":10}},"line":60},"6":{"name":"(anonymous_6)","decl":{"start":{"line":64,"column":19},"end":{"line":64,"column":20}},"loc":{"start":{"line":64,"column":30},"end":{"line":108,"column":1}},"line":64},"7":{"name":"(anonymous_7)","decl":{"start":{"line":85,"column":32},"end":{"line":85,"column":33}},"loc":{"start":{"line":85,"column":36},"end":{"line":95,"column":17}},"line":85},"8":{"name":"(anonymous_8)","decl":{"start":{"line":109,"column":13},"end":{"line":109,"column":14}},"loc":{"start":{"line":109,"column":24},"end":{"line":116,"column":1}},"line":109}},"branchMap":{"0":{"loc":{"start":{"line":18,"column":4},"end":{"line":18,"column":51}},"type":"if","locations":[{"start":{"line":18,"column":4},"end":{"line":18,"column":51}},{"start":{"line":18,"column":4},"end":{"line":18,"column":51}}],"line":18},"1":{"loc":{"start":{"line":22,"column":15},"end":{"line":22,"column":65}},"type":"cond-expr","locations":[{"start":{"line":22,"column":29},"end":{"line":22,"column":45}},{"start":{"line":22,"column":48},"end":{"line":22,"column":65}}],"line":22},"2":{"loc":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"type":"if","locations":[{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},{"start":{"line":26,"column":4},"end":{"line":28,"column":5}}],"line":26},"3":{"loc":{"start":{"line":26,"column":8},"end":{"line":26,"column":45}},"type":"binary-expr","locations":[{"start":{"line":26,"column":8},"end":{"line":26,"column":20}},{"start":{"line":26,"column":24},"end":{"line":26,"column":27}},{"start":{"line":26,"column":31},"end":{"line":26,"column":45}}],"line":26},"4":{"loc":{"start":{"line":29,"column":4},"end":{"line":33,"column":5}},"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":33,"column":5}},{"start":{"line":29,"column":4},"end":{"line":33,"column":5}}],"line":29},"5":{"loc":{"start":{"line":29,"column":8},"end":{"line":29,"column":76}},"type":"binary-expr","locations":[{"start":{"line":29,"column":8},"end":{"line":29,"column":20}},{"start":{"line":29,"column":24},"end":{"line":29,"column":47}},{"start":{"line":29,"column":51},"end":{"line":29,"column":76}}],"line":29},"6":{"loc":{"start":{"line":35,"column":4},"end":{"line":37,"column":5}},"type":"if","locations":[{"start":{"line":35,"column":4},"end":{"line":37,"column":5}},{"start":{"line":35,"column":4},"end":{"line":37,"column":5}}],"line":35},"7":{"loc":{"start":{"line":35,"column":8},"end":{"line":35,"column":31}},"type":"binary-expr","locations":[{"start":{"line":35,"column":8},"end":{"line":35,"column":13}},{"start":{"line":35,"column":17},"end":{"line":35,"column":31}}],"line":35},"8":{"loc":{"start":{"line":41,"column":32},"end":{"line":41,"column":88}},"type":"binary-expr","locations":[{"start":{"line":41,"column":32},"end":{"line":41,"column":53}},{"start":{"line":41,"column":57},"end":{"line":41,"column":88}}],"line":41},"9":{"loc":{"start":{"line":43,"column":8},"end":{"line":50,"column":9}},"type":"if","locations":[{"start":{"line":43,"column":8},"end":{"line":50,"column":9}},{"start":{"line":43,"column":8},"end":{"line":50,"column":9}}],"line":43},"10":{"loc":{"start":{"line":43,"column":12},"end":{"line":43,"column":79}},"type":"binary-expr","locations":[{"start":{"line":43,"column":12},"end":{"line":43,"column":29}},{"start":{"line":43,"column":33},"end":{"line":43,"column":79}}],"line":43},"11":{"loc":{"start":{"line":44,"column":23},"end":{"line":44,"column":95}},"type":"cond-expr","locations":[{"start":{"line":44,"column":47},"end":{"line":44,"column":88}},{"start":{"line":44,"column":91},"end":{"line":44,"column":95}}],"line":44},"12":{"loc":{"start":{"line":45,"column":12},"end":{"line":49,"column":13}},"type":"if","locations":[{"start":{"line":45,"column":12},"end":{"line":49,"column":13}},{"start":{"line":45,"column":12},"end":{"line":49,"column":13}}],"line":45},"13":{"loc":{"start":{"line":45,"column":16},"end":{"line":45,"column":46}},"type":"binary-expr","locations":[{"start":{"line":45,"column":16},"end":{"line":45,"column":20}},{"start":{"line":45,"column":25},"end":{"line":45,"column":33}},{"start":{"line":45,"column":37},"end":{"line":45,"column":45}}],"line":45},"14":{"loc":{"start":{"line":53,"column":4},"end":{"line":55,"column":5}},"type":"if","locations":[{"start":{"line":53,"column":4},"end":{"line":55,"column":5}},{"start":{"line":53,"column":4},"end":{"line":55,"column":5}}],"line":53},"15":{"loc":{"start":{"line":66,"column":19},"end":{"line":66,"column":52}},"type":"binary-expr","locations":[{"start":{"line":66,"column":19},"end":{"line":66,"column":46}},{"start":{"line":66,"column":50},"end":{"line":66,"column":52}}],"line":66},"16":{"loc":{"start":{"line":67,"column":4},"end":{"line":107,"column":5}},"type":"if","locations":[{"start":{"line":67,"column":4},"end":{"line":107,"column":5}},{"start":{"line":67,"column":4},"end":{"line":107,"column":5}}],"line":67},"17":{"loc":{"start":{"line":69,"column":8},"end":{"line":72,"column":9}},"type":"if","locations":[{"start":{"line":69,"column":8},"end":{"line":72,"column":9}},{"start":{"line":69,"column":8},"end":{"line":72,"column":9}}],"line":69},"18":{"loc":{"start":{"line":79,"column":12},"end":{"line":103,"column":13}},"type":"if","locations":[{"start":{"line":79,"column":12},"end":{"line":103,"column":13}},{"start":{"line":79,"column":12},"end":{"line":103,"column":13}}],"line":79},"19":{"loc":{"start":{"line":82,"column":29},"end":{"line":82,"column":142}},"type":"cond-expr","locations":[{"start":{"line":82,"column":118},"end":{"line":82,"column":137}},{"start":{"line":82,"column":140},"end":{"line":82,"column":142}}],"line":82},"20":{"loc":{"start":{"line":82,"column":29},"end":{"line":82,"column":115}},"type":"binary-expr","locations":[{"start":{"line":82,"column":29},"end":{"line":82,"column":40}},{"start":{"line":82,"column":44},"end":{"line":82,"column":115}}],"line":82},"21":{"loc":{"start":{"line":83,"column":38},"end":{"line":83,"column":162}},"type":"cond-expr","locations":[{"start":{"line":83,"column":52},"end":{"line":83,"column":113}},{"start":{"line":83,"column":116},"end":{"line":83,"column":162}}],"line":83},"22":{"loc":{"start":{"line":84,"column":29},"end":{"line":84,"column":104}},"type":"cond-expr","locations":[{"start":{"line":84,"column":42},"end":{"line":84,"column":88}},{"start":{"line":84,"column":91},"end":{"line":84,"column":104}}],"line":84},"23":{"loc":{"start":{"line":86,"column":20},"end":{"line":93,"column":21}},"type":"if","locations":[{"start":{"line":86,"column":20},"end":{"line":93,"column":21}},{"start":{"line":86,"column":20},"end":{"line":93,"column":21}}],"line":86},"24":{"loc":{"start":{"line":111,"column":4},"end":{"line":114,"column":5}},"type":"if","locations":[{"start":{"line":111,"column":4},"end":{"line":114,"column":5}},{"start":{"line":111,"column":4},"end":{"line":114,"column":5}}],"line":111},"25":{"loc":{"start":{"line":111,"column":8},"end":{"line":111,"column":107}},"type":"cond-expr","locations":[{"start":{"line":111,"column":78},"end":{"line":111,"column":84}},{"start":{"line":111,"column":87},"end":{"line":111,"column":107}}],"line":111},"26":{"loc":{"start":{"line":111,"column":8},"end":{"line":111,"column":75}},"type":"binary-expr","locations":[{"start":{"line":111,"column":8},"end":{"line":111,"column":47}},{"start":{"line":111,"column":51},"end":{"line":111,"column":75}}],"line":111}},"s":{"0":2,"1":2,"2":254,"3":2,"4":2,"5":2,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":2,"13":2,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":2,"32":254,"33":8,"34":2,"35":254,"36":254,"37":10,"38":2,"39":2,"40":10,"41":10,"42":10,"43":50,"44":50,"45":50,"46":10,"47":10,"48":10,"49":10,"50":10,"51":10,"52":1,"53":1,"54":1,"55":0,"56":9,"57":10,"58":10,"59":40,"60":10,"61":2,"62":254,"63":254,"64":254,"65":254},"f":{"0":254,"1":0,"2":0,"3":2,"4":254,"5":8,"6":254,"7":10,"8":254},"b":{"0":[0,0],"1":[0,0],"2":[2,0],"3":[2,2,2],"4":[0,0],"5":[0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0],"14":[0,0],"15":[254,244],"16":[10,244],"17":[2,8],"18":[10,40],"19":[1,9],"20":[10,6],"21":[9,1],"22":[4,6],"23":[1,9],"24":[254,0],"25":[0,254],"26":[254,254]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/code.js"],"sourcesContent":["/*\n * code() is a named function that will parse `inline code` and ```codeblock``` syntaxes\n * @param {Object} message - The message object\n */\nimport { unescapeHTML } from '@rocket.chat/string-helpers';\n\nimport hljs, { register } from '../../hljs';\nimport { addAsToken } from './token';\n\nconst inlinecode = (message) => {\n\t// Support `text`\n\tmessage.html = message.html.replace(/\\`([^`\\r\\n]+)\\`([<_*~]|\\B|\\b|$)/gm, (match, p1, p2) =>\n\t\taddAsToken(\n\t\t\tmessage,\n\t\t\t`<span class=\\\"copyonly\\\">\\`</span><span><code class=\\\"code-colors inline\\\">${p1}</code></span><span class=\\\"copyonly\\\">\\`</span>${p2}`,\n\t\t\t'inlinecode',\n\t\t\t{ noHtml: match },\n\t\t),\n\t);\n};\n\nconst codeblocks = (message) => {\n\t// Count occurencies of ```\n\tconst count = (message.html.match(/```/gm) || []).length;\n\n\tif (count) {\n\t\t// Check if we need to add a final ```\n\t\tif (count % 2 > 0) {\n\t\t\tmessage.html = `${message.html}\\n\\`\\`\\``;\n\t\t\tmessage.msg = `${message.msg}\\n\\`\\`\\``;\n\t\t}\n\n\t\t// Separate text in code blocks and non code blocks\n\t\tconst msgParts = message.html.split(/(^.*)(```(?:[a-zA-Z]+)?(?:(?:.|\\r|\\n)*?)```)(.*\\n?)$/gm);\n\n\t\tfor (let index = 0; index < msgParts.length; index++) {\n\t\t\t// Verify if this part is code\n\t\t\tconst part = msgParts[index];\n\t\t\tconst codeMatch = part.match(/^```[\\r\\n]*(.*[\\r\\n\\ ]?)[\\r\\n]*([\\s\\S]*?)```+?$/);\n\n\t\t\tif (codeMatch) {\n\t\t\t\t// Process highlight if this part is code\n\t\t\t\tconst singleLine = codeMatch[0].indexOf('\\n') === -1;\n\t\t\t\tconst lang = !singleLine && Array.from(hljs.listLanguages()).includes(codeMatch[1].trim()) ? codeMatch[1].trim() : '';\n\t\t\t\tconst emptyLanguage = lang === '' ? unescapeHTML(codeMatch[1] + codeMatch[2]) : unescapeHTML(codeMatch[2]);\n\t\t\t\tconst code = singleLine ? unescapeHTML(codeMatch[1]) : emptyLanguage;\n\n\t\t\t\tconst result = (() => {\n\t\t\t\t\tif (lang) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tregister(lang);\n\t\t\t\t\t\t\treturn hljs.highlight(lang, code);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn hljs.highlightAuto(lang + code);\n\t\t\t\t})();\n\t\t\t\tconst token = addAsToken(\n\t\t\t\t\tmessage,\n\t\t\t\t\t`<pre><code class='code-colors hljs ${result.language}'><span class='copyonly'>\\`\\`\\`<br></span>${result.value}<span class='copyonly'><br>\\`\\`\\`</span></code></pre>`,\n\t\t\t\t\t'code',\n\t\t\t\t\t{\n\t\t\t\t\t\tnoHtml: codeMatch[0],\n\t\t\t\t\t\thighlight: true,\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\tmsgParts[index] = token;\n\t\t\t} else {\n\t\t\t\tmsgParts[index] = part;\n\t\t\t}\n\t\t}\n\n\t\t// Re-mount message\n\t\tmessage.html = msgParts.join('');\n\t}\n};\n\nexport const code = (message) => {\n\tif (message.html?.trim()) {\n\t\tcodeblocks(message);\n\t\tinlinecode(message);\n\t}\n\n\treturn message;\n};\n"],"names":["code","inlinecode","message","html","replace","match","p1","p2","addAsToken","noHtml","codeblocks","count","length","msg","msgParts","split","index","part","codeMatch","singleLine","indexOf","lang","Array","from","hljs","listLanguages","includes","trim","emptyLanguage","unescapeHTML","result","register","highlight","error","console","highlightAuto","token","language","value","join"],"mappings":"AAAA;;;CAGC;;;;+BA4EYA;;;eAAAA;;;+BA3EgB;8DAEE;uBACJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE3B,MAAMC,aAAa,CAACC;IACnB,iBAAiB;IACjBA,QAAQC,IAAI,GAAGD,QAAQC,IAAI,CAACC,OAAO,CAAC,qCAAqC,CAACC,OAAOC,IAAIC,KACpFC,IAAAA,iBAAU,EACTN,SACA,CAAC,2EAA2E,EAAEI,GAAG,gDAAgD,EAAEC,IAAI,EACvI,cACA;YAAEE,QAAQJ;QAAM;AAGnB;AAEA,MAAMK,aAAa,CAACR;IACnB,2BAA2B;IAC3B,MAAMS,QAAQ,AAACT,CAAAA,QAAQC,IAAI,CAACE,KAAK,CAAC,YAAY,EAAE,AAAD,EAAGO,MAAM;IAExD,IAAID,OAAO;QACV,sCAAsC;QACtC,IAAIA,QAAQ,IAAI,GAAG;YAClBT,QAAQC,IAAI,GAAG,GAAGD,QAAQC,IAAI,CAAC,QAAQ,CAAC;YACxCD,QAAQW,GAAG,GAAG,GAAGX,QAAQW,GAAG,CAAC,QAAQ,CAAC;QACvC;QAEA,mDAAmD;QACnD,MAAMC,WAAWZ,QAAQC,IAAI,CAACY,KAAK,CAAC;QAEpC,IAAK,IAAIC,QAAQ,GAAGA,QAAQF,SAASF,MAAM,EAAEI,QAAS;YACrD,8BAA8B;YAC9B,MAAMC,OAAOH,QAAQ,CAACE,MAAM;YAC5B,MAAME,YAAYD,KAAKZ,KAAK,CAAC;YAE7B,IAAIa,WAAW;gBACd,yCAAyC;gBACzC,MAAMC,aAAaD,SAAS,CAAC,EAAE,CAACE,OAAO,CAAC,UAAU,CAAC;gBACnD,MAAMC,OAAO,CAACF,cAAcG,MAAMC,IAAI,CAACC,aAAI,CAACC,aAAa,IAAIC,QAAQ,CAACR,SAAS,CAAC,EAAE,CAACS,IAAI,MAAMT,SAAS,CAAC,EAAE,CAACS,IAAI,KAAK;gBACnH,MAAMC,gBAAgBP,SAAS,KAAKQ,IAAAA,2BAAY,EAACX,SAAS,CAAC,EAAE,GAAGA,SAAS,CAAC,EAAE,IAAIW,IAAAA,2BAAY,EAACX,SAAS,CAAC,EAAE;gBACzG,MAAMlB,OAAOmB,aAAaU,IAAAA,2BAAY,EAACX,SAAS,CAAC,EAAE,IAAIU;gBAEvD,MAAME,SAAS,AAAC,CAAA;oBACf,IAAIT,MAAM;wBACT,IAAI;4BACHU,IAAAA,cAAQ,EAACV;4BACT,OAAOG,aAAI,CAACQ,SAAS,CAACX,MAAMrB;wBAC7B,EAAE,OAAOiC,OAAO;4BACfC,QAAQD,KAAK,CAACA;wBACf;oBACD;oBACA,OAAOT,aAAI,CAACW,aAAa,CAACd,OAAOrB;gBAClC,CAAA;gBACA,MAAMoC,QAAQ5B,IAAAA,iBAAU,EACvBN,SACA,CAAC,mCAAmC,EAAE4B,OAAOO,QAAQ,CAAC,0CAA0C,EAAEP,OAAOQ,KAAK,CAAC,qDAAqD,CAAC,EACrK,QACA;oBACC7B,QAAQS,SAAS,CAAC,EAAE;oBACpBc,WAAW;gBACZ;gBAGDlB,QAAQ,CAACE,MAAM,GAAGoB;YACnB,OAAO;gBACNtB,QAAQ,CAACE,MAAM,GAAGC;YACnB;QACD;QAEA,mBAAmB;QACnBf,QAAQC,IAAI,GAAGW,SAASyB,IAAI,CAAC;IAC9B;AACD;AAEO,MAAMvC,OAAO,CAACE;QAChBA;IAAJ,KAAIA,gBAAAA,QAAQC,IAAI,cAAZD,oCAAAA,cAAcyB,IAAI,IAAI;QACzBjB,WAAWR;QACXD,WAAWC;IACZ;IAEA,OAAOA;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/code.js"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2f6e08a98b1ea16b2ab0c49f16d5c657d28dfc3e","contentHash":"71dfe4cb6726071c3fc62c0aec1de8afaf3056644a5ce5649d5dd3e79c60b4c2"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/hljs.js":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/hljs.js","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":24}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":24}},"6":{"start":{"line":19,"column":33},"end":{"line":19,"column":89}},"7":{"start":{"line":20,"column":29},"end":{"line":20,"column":91}},"8":{"start":{"line":21,"column":34},"end":{"line":21,"column":101}},"9":{"start":{"line":22,"column":32},"end":{"line":22,"column":97}},"10":{"start":{"line":24,"column":4},"end":{"line":26,"column":6}},"11":{"start":{"line":29,"column":4},"end":{"line":29,"column":51}},"12":{"start":{"line":29,"column":39},"end":{"line":29,"column":51}},"13":{"start":{"line":30,"column":28},"end":{"line":30,"column":41}},"14":{"start":{"line":31,"column":27},"end":{"line":31,"column":40}},"15":{"start":{"line":32,"column":4},"end":{"line":34,"column":20}},"16":{"start":{"line":33,"column":8},"end":{"line":33,"column":66}},"17":{"start":{"line":37,"column":4},"end":{"line":39,"column":5}},"18":{"start":{"line":38,"column":8},"end":{"line":38,"column":19}},"19":{"start":{"line":40,"column":4},"end":{"line":44,"column":5}},"20":{"start":{"line":41,"column":8},"end":{"line":43,"column":10}},"21":{"start":{"line":45,"column":16},"end":{"line":45,"column":53}},"22":{"start":{"line":46,"column":4},"end":{"line":48,"column":5}},"23":{"start":{"line":47,"column":8},"end":{"line":47,"column":30}},"24":{"start":{"line":49,"column":17},"end":{"line":51,"column":5}},"25":{"start":{"line":52,"column":32},"end":{"line":52,"column":88}},"26":{"start":{"line":53,"column":4},"end":{"line":62,"column":5}},"27":{"start":{"line":54,"column":8},"end":{"line":61,"column":9}},"28":{"start":{"line":55,"column":23},"end":{"line":55,"column":95}},"29":{"start":{"line":56,"column":12},"end":{"line":60,"column":13}},"30":{"start":{"line":57,"column":16},"end":{"line":57,"column":57}},"31":{"start":{"line":59,"column":16},"end":{"line":59,"column":39}},"32":{"start":{"line":63,"column":4},"end":{"line":63,"column":25}},"33":{"start":{"line":64,"column":4},"end":{"line":66,"column":5}},"34":{"start":{"line":65,"column":8},"end":{"line":65,"column":31}},"35":{"start":{"line":67,"column":4},"end":{"line":67,"column":18}},"36":{"start":{"line":69,"column":0},"end":{"line":69,"column":67}},"37":{"start":{"line":70,"column":0},"end":{"line":70,"column":61}},"38":{"start":{"line":71,"column":0},"end":{"line":71,"column":71}},"39":{"start":{"line":72,"column":17},"end":{"line":421,"column":1}},"40":{"start":{"line":73,"column":4},"end":{"line":420,"column":5}},"41":{"start":{"line":75,"column":12},"end":{"line":75,"column":183}},"42":{"start":{"line":75,"column":111},"end":{"line":75,"column":171}},"43":{"start":{"line":77,"column":12},"end":{"line":77,"column":185}},"44":{"start":{"line":77,"column":111},"end":{"line":77,"column":173}},"45":{"start":{"line":79,"column":12},"end":{"line":79,"column":195}},"46":{"start":{"line":79,"column":116},"end":{"line":79,"column":183}},"47":{"start":{"line":81,"column":12},"end":{"line":81,"column":201}},"48":{"start":{"line":81,"column":119},"end":{"line":81,"column":189}},"49":{"start":{"line":83,"column":12},"end":{"line":83,"column":183}},"50":{"start":{"line":83,"column":110},"end":{"line":83,"column":171}},"51":{"start":{"line":85,"column":12},"end":{"line":85,"column":189}},"52":{"start":{"line":85,"column":113},"end":{"line":85,"column":177}},"53":{"start":{"line":87,"column":12},"end":{"line":87,"column":199}},"54":{"start":{"line":87,"column":118},"end":{"line":87,"column":187}},"55":{"start":{"line":89,"column":12},"end":{"line":89,"column":191}},"56":{"start":{"line":89,"column":114},"end":{"line":89,"column":179}},"57":{"start":{"line":91,"column":12},"end":{"line":91,"column":189}},"58":{"start":{"line":91,"column":113},"end":{"line":91,"column":177}},"59":{"start":{"line":93,"column":12},"end":{"line":93,"column":193}},"60":{"start":{"line":93,"column":115},"end":{"line":93,"column":181}},"61":{"start":{"line":95,"column":12},"end":{"line":95,"column":191}},"62":{"start":{"line":95,"column":114},"end":{"line":95,"column":179}},"63":{"start":{"line":97,"column":12},"end":{"line":97,"column":197}},"64":{"start":{"line":97,"column":117},"end":{"line":97,"column":185}},"65":{"start":{"line":99,"column":12},"end":{"line":99,"column":189}},"66":{"start":{"line":99,"column":113},"end":{"line":99,"column":177}},"67":{"start":{"line":101,"column":12},"end":{"line":101,"column":189}},"68":{"start":{"line":101,"column":113},"end":{"line":101,"column":177}},"69":{"start":{"line":103,"column":12},"end":{"line":103,"column":183}},"70":{"start":{"line":103,"column":110},"end":{"line":103,"column":171}},"71":{"start":{"line":105,"column":12},"end":{"line":105,"column":189}},"72":{"start":{"line":105,"column":113},"end":{"line":105,"column":177}},"73":{"start":{"line":107,"column":12},"end":{"line":107,"column":185}},"74":{"start":{"line":107,"column":111},"end":{"line":107,"column":173}},"75":{"start":{"line":109,"column":12},"end":{"line":109,"column":187}},"76":{"start":{"line":109,"column":112},"end":{"line":109,"column":175}},"77":{"start":{"line":111,"column":12},"end":{"line":111,"column":183}},"78":{"start":{"line":111,"column":110},"end":{"line":111,"column":171}},"79":{"start":{"line":113,"column":12},"end":{"line":113,"column":195}},"80":{"start":{"line":113,"column":116},"end":{"line":113,"column":183}},"81":{"start":{"line":115,"column":12},"end":{"line":115,"column":183}},"82":{"start":{"line":115,"column":110},"end":{"line":115,"column":171}},"83":{"start":{"line":117,"column":12},"end":{"line":117,"column":195}},"84":{"start":{"line":117,"column":116},"end":{"line":117,"column":183}},"85":{"start":{"line":119,"column":12},"end":{"line":119,"column":189}},"86":{"start":{"line":119,"column":113},"end":{"line":119,"column":177}},"87":{"start":{"line":121,"column":12},"end":{"line":121,"column":187}},"88":{"start":{"line":121,"column":112},"end":{"line":121,"column":175}},"89":{"start":{"line":123,"column":12},"end":{"line":123,"column":191}},"90":{"start":{"line":123,"column":114},"end":{"line":123,"column":179}},"91":{"start":{"line":125,"column":12},"end":{"line":125,"column":201}},"92":{"start":{"line":125,"column":119},"end":{"line":125,"column":189}},"93":{"start":{"line":127,"column":12},"end":{"line":127,"column":187}},"94":{"start":{"line":127,"column":112},"end":{"line":127,"column":175}},"95":{"start":{"line":129,"column":12},"end":{"line":129,"column":201}},"96":{"start":{"line":129,"column":119},"end":{"line":129,"column":189}},"97":{"start":{"line":131,"column":12},"end":{"line":131,"column":183}},"98":{"start":{"line":131,"column":110},"end":{"line":131,"column":171}},"99":{"start":{"line":133,"column":12},"end":{"line":133,"column":183}},"100":{"start":{"line":133,"column":110},"end":{"line":133,"column":171}},"101":{"start":{"line":135,"column":12},"end":{"line":135,"column":183}},"102":{"start":{"line":135,"column":110},"end":{"line":135,"column":171}},"103":{"start":{"line":137,"column":12},"end":{"line":137,"column":187}},"104":{"start":{"line":137,"column":112},"end":{"line":137,"column":175}},"105":{"start":{"line":139,"column":12},"end":{"line":139,"column":191}},"106":{"start":{"line":139,"column":114},"end":{"line":139,"column":179}},"107":{"start":{"line":141,"column":12},"end":{"line":141,"column":181}},"108":{"start":{"line":141,"column":109},"end":{"line":141,"column":169}},"109":{"start":{"line":143,"column":12},"end":{"line":143,"column":183}},"110":{"start":{"line":143,"column":110},"end":{"line":143,"column":171}},"111":{"start":{"line":145,"column":12},"end":{"line":145,"column":183}},"112":{"start":{"line":145,"column":110},"end":{"line":145,"column":171}},"113":{"start":{"line":147,"column":12},"end":{"line":147,"column":179}},"114":{"start":{"line":147,"column":108},"end":{"line":147,"column":167}},"115":{"start":{"line":149,"column":12},"end":{"line":149,"column":185}},"116":{"start":{"line":149,"column":111},"end":{"line":149,"column":173}},"117":{"start":{"line":151,"column":12},"end":{"line":151,"column":189}},"118":{"start":{"line":151,"column":113},"end":{"line":151,"column":177}},"119":{"start":{"line":153,"column":12},"end":{"line":153,"column":185}},"120":{"start":{"line":153,"column":111},"end":{"line":153,"column":173}},"121":{"start":{"line":155,"column":12},"end":{"line":155,"column":189}},"122":{"start":{"line":155,"column":113},"end":{"line":155,"column":177}},"123":{"start":{"line":157,"column":12},"end":{"line":157,"column":183}},"124":{"start":{"line":157,"column":110},"end":{"line":157,"column":171}},"125":{"start":{"line":159,"column":12},"end":{"line":159,"column":197}},"126":{"start":{"line":159,"column":117},"end":{"line":159,"column":185}},"127":{"start":{"line":161,"column":12},"end":{"line":161,"column":183}},"128":{"start":{"line":161,"column":110},"end":{"line":161,"column":171}},"129":{"start":{"line":163,"column":12},"end":{"line":163,"column":193}},"130":{"start":{"line":163,"column":115},"end":{"line":163,"column":181}},"131":{"start":{"line":165,"column":12},"end":{"line":165,"column":183}},"132":{"start":{"line":165,"column":110},"end":{"line":165,"column":171}},"133":{"start":{"line":167,"column":12},"end":{"line":167,"column":185}},"134":{"start":{"line":167,"column":111},"end":{"line":167,"column":173}},"135":{"start":{"line":169,"column":12},"end":{"line":169,"column":185}},"136":{"start":{"line":169,"column":111},"end":{"line":169,"column":173}},"137":{"start":{"line":171,"column":12},"end":{"line":171,"column":189}},"138":{"start":{"line":171,"column":113},"end":{"line":171,"column":177}},"139":{"start":{"line":173,"column":12},"end":{"line":173,"column":183}},"140":{"start":{"line":173,"column":110},"end":{"line":173,"column":171}},"141":{"start":{"line":175,"column":12},"end":{"line":175,"column":183}},"142":{"start":{"line":175,"column":110},"end":{"line":175,"column":171}},"143":{"start":{"line":177,"column":12},"end":{"line":177,"column":189}},"144":{"start":{"line":177,"column":113},"end":{"line":177,"column":177}},"145":{"start":{"line":179,"column":12},"end":{"line":179,"column":187}},"146":{"start":{"line":179,"column":112},"end":{"line":179,"column":175}},"147":{"start":{"line":181,"column":12},"end":{"line":181,"column":183}},"148":{"start":{"line":181,"column":110},"end":{"line":181,"column":171}},"149":{"start":{"line":183,"column":12},"end":{"line":183,"column":185}},"150":{"start":{"line":183,"column":111},"end":{"line":183,"column":173}},"151":{"start":{"line":185,"column":12},"end":{"line":185,"column":191}},"152":{"start":{"line":185,"column":114},"end":{"line":185,"column":179}},"153":{"start":{"line":187,"column":12},"end":{"line":187,"column":189}},"154":{"start":{"line":187,"column":113},"end":{"line":187,"column":177}},"155":{"start":{"line":189,"column":12},"end":{"line":189,"column":185}},"156":{"start":{"line":189,"column":111},"end":{"line":189,"column":173}},"157":{"start":{"line":191,"column":12},"end":{"line":191,"column":187}},"158":{"start":{"line":191,"column":112},"end":{"line":191,"column":175}},"159":{"start":{"line":193,"column":12},"end":{"line":193,"column":187}},"160":{"start":{"line":193,"column":112},"end":{"line":193,"column":175}},"161":{"start":{"line":195,"column":12},"end":{"line":195,"column":191}},"162":{"start":{"line":195,"column":114},"end":{"line":195,"column":179}},"163":{"start":{"line":197,"column":12},"end":{"line":197,"column":185}},"164":{"start":{"line":197,"column":111},"end":{"line":197,"column":173}},"165":{"start":{"line":199,"column":12},"end":{"line":199,"column":181}},"166":{"start":{"line":199,"column":109},"end":{"line":199,"column":169}},"167":{"start":{"line":201,"column":12},"end":{"line":201,"column":185}},"168":{"start":{"line":201,"column":111},"end":{"line":201,"column":173}},"169":{"start":{"line":203,"column":12},"end":{"line":203,"column":189}},"170":{"start":{"line":203,"column":113},"end":{"line":203,"column":177}},"171":{"start":{"line":205,"column":12},"end":{"line":205,"column":189}},"172":{"start":{"line":205,"column":113},"end":{"line":205,"column":177}},"173":{"start":{"line":207,"column":12},"end":{"line":207,"column":185}},"174":{"start":{"line":207,"column":111},"end":{"line":207,"column":173}},"175":{"start":{"line":209,"column":12},"end":{"line":209,"column":197}},"176":{"start":{"line":209,"column":117},"end":{"line":209,"column":185}},"177":{"start":{"line":211,"column":12},"end":{"line":211,"column":191}},"178":{"start":{"line":211,"column":114},"end":{"line":211,"column":179}},"179":{"start":{"line":213,"column":12},"end":{"line":213,"column":185}},"180":{"start":{"line":213,"column":111},"end":{"line":213,"column":173}},"181":{"start":{"line":215,"column":12},"end":{"line":215,"column":183}},"182":{"start":{"line":215,"column":110},"end":{"line":215,"column":171}},"183":{"start":{"line":217,"column":12},"end":{"line":217,"column":193}},"184":{"start":{"line":217,"column":115},"end":{"line":217,"column":181}},"185":{"start":{"line":219,"column":12},"end":{"line":219,"column":185}},"186":{"start":{"line":219,"column":111},"end":{"line":219,"column":173}},"187":{"start":{"line":221,"column":12},"end":{"line":221,"column":181}},"188":{"start":{"line":221,"column":109},"end":{"line":221,"column":169}},"189":{"start":{"line":223,"column":12},"end":{"line":223,"column":191}},"190":{"start":{"line":223,"column":114},"end":{"line":223,"column":179}},"191":{"start":{"line":225,"column":12},"end":{"line":225,"column":183}},"192":{"start":{"line":225,"column":110},"end":{"line":225,"column":171}},"193":{"start":{"line":227,"column":12},"end":{"line":227,"column":189}},"194":{"start":{"line":227,"column":113},"end":{"line":227,"column":177}},"195":{"start":{"line":229,"column":12},"end":{"line":229,"column":185}},"196":{"start":{"line":229,"column":111},"end":{"line":229,"column":173}},"197":{"start":{"line":231,"column":12},"end":{"line":231,"column":197}},"198":{"start":{"line":231,"column":117},"end":{"line":231,"column":185}},"199":{"start":{"line":233,"column":12},"end":{"line":233,"column":195}},"200":{"start":{"line":233,"column":116},"end":{"line":233,"column":183}},"201":{"start":{"line":235,"column":12},"end":{"line":235,"column":185}},"202":{"start":{"line":235,"column":111},"end":{"line":235,"column":173}},"203":{"start":{"line":237,"column":12},"end":{"line":237,"column":187}},"204":{"start":{"line":237,"column":112},"end":{"line":237,"column":175}},"205":{"start":{"line":239,"column":12},"end":{"line":239,"column":197}},"206":{"start":{"line":239,"column":117},"end":{"line":239,"column":185}},"207":{"start":{"line":241,"column":12},"end":{"line":241,"column":189}},"208":{"start":{"line":241,"column":113},"end":{"line":241,"column":177}},"209":{"start":{"line":243,"column":12},"end":{"line":243,"column":187}},"210":{"start":{"line":243,"column":112},"end":{"line":243,"column":175}},"211":{"start":{"line":245,"column":12},"end":{"line":245,"column":185}},"212":{"start":{"line":245,"column":111},"end":{"line":245,"column":173}},"213":{"start":{"line":247,"column":12},"end":{"line":247,"column":185}},"214":{"start":{"line":247,"column":111},"end":{"line":247,"column":173}},"215":{"start":{"line":249,"column":12},"end":{"line":249,"column":185}},"216":{"start":{"line":249,"column":111},"end":{"line":249,"column":173}},"217":{"start":{"line":251,"column":12},"end":{"line":251,"column":185}},"218":{"start":{"line":251,"column":111},"end":{"line":251,"column":173}},"219":{"start":{"line":253,"column":12},"end":{"line":253,"column":205}},"220":{"start":{"line":253,"column":121},"end":{"line":253,"column":193}},"221":{"start":{"line":255,"column":12},"end":{"line":255,"column":197}},"222":{"start":{"line":255,"column":117},"end":{"line":255,"column":185}},"223":{"start":{"line":257,"column":12},"end":{"line":257,"column":185}},"224":{"start":{"line":257,"column":111},"end":{"line":257,"column":173}},"225":{"start":{"line":259,"column":12},"end":{"line":259,"column":183}},"226":{"start":{"line":259,"column":110},"end":{"line":259,"column":171}},"227":{"start":{"line":261,"column":12},"end":{"line":261,"column":183}},"228":{"start":{"line":261,"column":110},"end":{"line":261,"column":171}},"229":{"start":{"line":263,"column":12},"end":{"line":263,"column":193}},"230":{"start":{"line":263,"column":115},"end":{"line":263,"column":181}},"231":{"start":{"line":265,"column":12},"end":{"line":265,"column":193}},"232":{"start":{"line":265,"column":115},"end":{"line":265,"column":181}},"233":{"start":{"line":267,"column":12},"end":{"line":267,"column":199}},"234":{"start":{"line":267,"column":118},"end":{"line":267,"column":187}},"235":{"start":{"line":269,"column":12},"end":{"line":269,"column":189}},"236":{"start":{"line":269,"column":113},"end":{"line":269,"column":177}},"237":{"start":{"line":271,"column":12},"end":{"line":271,"column":189}},"238":{"start":{"line":271,"column":113},"end":{"line":271,"column":177}},"239":{"start":{"line":273,"column":12},"end":{"line":273,"column":183}},"240":{"start":{"line":273,"column":110},"end":{"line":273,"column":171}},"241":{"start":{"line":275,"column":12},"end":{"line":275,"column":191}},"242":{"start":{"line":275,"column":114},"end":{"line":275,"column":179}},"243":{"start":{"line":277,"column":12},"end":{"line":277,"column":191}},"244":{"start":{"line":277,"column":114},"end":{"line":277,"column":179}},"245":{"start":{"line":279,"column":12},"end":{"line":279,"column":187}},"246":{"start":{"line":279,"column":112},"end":{"line":279,"column":175}},"247":{"start":{"line":281,"column":12},"end":{"line":281,"column":185}},"248":{"start":{"line":281,"column":111},"end":{"line":281,"column":173}},"249":{"start":{"line":283,"column":12},"end":{"line":283,"column":199}},"250":{"start":{"line":283,"column":118},"end":{"line":283,"column":187}},"251":{"start":{"line":285,"column":12},"end":{"line":285,"column":189}},"252":{"start":{"line":285,"column":113},"end":{"line":285,"column":177}},"253":{"start":{"line":287,"column":12},"end":{"line":287,"column":197}},"254":{"start":{"line":287,"column":117},"end":{"line":287,"column":185}},"255":{"start":{"line":289,"column":12},"end":{"line":289,"column":185}},"256":{"start":{"line":289,"column":111},"end":{"line":289,"column":173}},"257":{"start":{"line":291,"column":12},"end":{"line":291,"column":187}},"258":{"start":{"line":291,"column":112},"end":{"line":291,"column":175}},"259":{"start":{"line":293,"column":12},"end":{"line":293,"column":189}},"260":{"start":{"line":293,"column":113},"end":{"line":293,"column":177}},"261":{"start":{"line":295,"column":12},"end":{"line":295,"column":183}},"262":{"start":{"line":295,"column":110},"end":{"line":295,"column":171}},"263":{"start":{"line":297,"column":12},"end":{"line":297,"column":185}},"264":{"start":{"line":297,"column":111},"end":{"line":297,"column":173}},"265":{"start":{"line":299,"column":12},"end":{"line":299,"column":197}},"266":{"start":{"line":299,"column":117},"end":{"line":299,"column":185}},"267":{"start":{"line":301,"column":12},"end":{"line":301,"column":187}},"268":{"start":{"line":301,"column":112},"end":{"line":301,"column":175}},"269":{"start":{"line":303,"column":12},"end":{"line":303,"column":193}},"270":{"start":{"line":303,"column":115},"end":{"line":303,"column":181}},"271":{"start":{"line":305,"column":12},"end":{"line":305,"column":191}},"272":{"start":{"line":305,"column":114},"end":{"line":305,"column":179}},"273":{"start":{"line":307,"column":12},"end":{"line":307,"column":191}},"274":{"start":{"line":307,"column":114},"end":{"line":307,"column":179}},"275":{"start":{"line":309,"column":12},"end":{"line":309,"column":181}},"276":{"start":{"line":309,"column":109},"end":{"line":309,"column":169}},"277":{"start":{"line":311,"column":12},"end":{"line":311,"column":183}},"278":{"start":{"line":311,"column":110},"end":{"line":311,"column":171}},"279":{"start":{"line":313,"column":12},"end":{"line":313,"column":185}},"280":{"start":{"line":313,"column":111},"end":{"line":313,"column":173}},"281":{"start":{"line":315,"column":12},"end":{"line":315,"column":197}},"282":{"start":{"line":315,"column":117},"end":{"line":315,"column":185}},"283":{"start":{"line":317,"column":12},"end":{"line":317,"column":197}},"284":{"start":{"line":317,"column":117},"end":{"line":317,"column":185}},"285":{"start":{"line":319,"column":12},"end":{"line":319,"column":191}},"286":{"start":{"line":319,"column":114},"end":{"line":319,"column":179}},"287":{"start":{"line":321,"column":12},"end":{"line":321,"column":189}},"288":{"start":{"line":321,"column":113},"end":{"line":321,"column":177}},"289":{"start":{"line":323,"column":12},"end":{"line":323,"column":193}},"290":{"start":{"line":323,"column":115},"end":{"line":323,"column":181}},"291":{"start":{"line":325,"column":12},"end":{"line":325,"column":189}},"292":{"start":{"line":325,"column":113},"end":{"line":325,"column":177}},"293":{"start":{"line":327,"column":12},"end":{"line":327,"column":195}},"294":{"start":{"line":327,"column":116},"end":{"line":327,"column":183}},"295":{"start":{"line":329,"column":12},"end":{"line":329,"column":189}},"296":{"start":{"line":329,"column":113},"end":{"line":329,"column":177}},"297":{"start":{"line":331,"column":12},"end":{"line":331,"column":179}},"298":{"start":{"line":331,"column":108},"end":{"line":331,"column":167}},"299":{"start":{"line":333,"column":12},"end":{"line":333,"column":183}},"300":{"start":{"line":333,"column":110},"end":{"line":333,"column":171}},"301":{"start":{"line":335,"column":12},"end":{"line":335,"column":179}},"302":{"start":{"line":335,"column":108},"end":{"line":335,"column":167}},"303":{"start":{"line":337,"column":12},"end":{"line":337,"column":183}},"304":{"start":{"line":337,"column":110},"end":{"line":337,"column":171}},"305":{"start":{"line":339,"column":12},"end":{"line":339,"column":193}},"306":{"start":{"line":339,"column":115},"end":{"line":339,"column":181}},"307":{"start":{"line":341,"column":12},"end":{"line":341,"column":183}},"308":{"start":{"line":341,"column":110},"end":{"line":341,"column":171}},"309":{"start":{"line":343,"column":12},"end":{"line":343,"column":203}},"310":{"start":{"line":343,"column":120},"end":{"line":343,"column":191}},"311":{"start":{"line":345,"column":12},"end":{"line":345,"column":185}},"312":{"start":{"line":345,"column":111},"end":{"line":345,"column":173}},"313":{"start":{"line":347,"column":12},"end":{"line":347,"column":187}},"314":{"start":{"line":347,"column":112},"end":{"line":347,"column":175}},"315":{"start":{"line":349,"column":12},"end":{"line":349,"column":189}},"316":{"start":{"line":349,"column":113},"end":{"line":349,"column":177}},"317":{"start":{"line":351,"column":12},"end":{"line":351,"column":189}},"318":{"start":{"line":351,"column":113},"end":{"line":351,"column":177}},"319":{"start":{"line":353,"column":12},"end":{"line":353,"column":185}},"320":{"start":{"line":353,"column":111},"end":{"line":353,"column":173}},"321":{"start":{"line":355,"column":12},"end":{"line":355,"column":187}},"322":{"start":{"line":355,"column":112},"end":{"line":355,"column":175}},"323":{"start":{"line":357,"column":12},"end":{"line":357,"column":187}},"324":{"start":{"line":357,"column":112},"end":{"line":357,"column":175}},"325":{"start":{"line":359,"column":12},"end":{"line":359,"column":195}},"326":{"start":{"line":359,"column":116},"end":{"line":359,"column":183}},"327":{"start":{"line":361,"column":12},"end":{"line":361,"column":183}},"328":{"start":{"line":361,"column":110},"end":{"line":361,"column":171}},"329":{"start":{"line":363,"column":12},"end":{"line":363,"column":183}},"330":{"start":{"line":363,"column":110},"end":{"line":363,"column":171}},"331":{"start":{"line":365,"column":12},"end":{"line":365,"column":183}},"332":{"start":{"line":365,"column":110},"end":{"line":365,"column":171}},"333":{"start":{"line":367,"column":12},"end":{"line":367,"column":185}},"334":{"start":{"line":367,"column":111},"end":{"line":367,"column":173}},"335":{"start":{"line":369,"column":12},"end":{"line":369,"column":187}},"336":{"start":{"line":369,"column":112},"end":{"line":369,"column":175}},"337":{"start":{"line":371,"column":12},"end":{"line":371,"column":189}},"338":{"start":{"line":371,"column":113},"end":{"line":371,"column":177}},"339":{"start":{"line":373,"column":12},"end":{"line":373,"column":189}},"340":{"start":{"line":373,"column":113},"end":{"line":373,"column":177}},"341":{"start":{"line":375,"column":12},"end":{"line":375,"column":191}},"342":{"start":{"line":375,"column":114},"end":{"line":375,"column":179}},"343":{"start":{"line":377,"column":12},"end":{"line":377,"column":187}},"344":{"start":{"line":377,"column":112},"end":{"line":377,"column":175}},"345":{"start":{"line":379,"column":12},"end":{"line":379,"column":201}},"346":{"start":{"line":379,"column":119},"end":{"line":379,"column":189}},"347":{"start":{"line":381,"column":12},"end":{"line":381,"column":185}},"348":{"start":{"line":381,"column":111},"end":{"line":381,"column":173}},"349":{"start":{"line":383,"column":12},"end":{"line":383,"column":183}},"350":{"start":{"line":383,"column":110},"end":{"line":383,"column":171}},"351":{"start":{"line":385,"column":12},"end":{"line":385,"column":183}},"352":{"start":{"line":385,"column":110},"end":{"line":385,"column":171}},"353":{"start":{"line":387,"column":12},"end":{"line":387,"column":183}},"354":{"start":{"line":387,"column":110},"end":{"line":387,"column":171}},"355":{"start":{"line":389,"column":12},"end":{"line":389,"column":189}},"356":{"start":{"line":389,"column":113},"end":{"line":389,"column":177}},"357":{"start":{"line":391,"column":12},"end":{"line":391,"column":181}},"358":{"start":{"line":391,"column":109},"end":{"line":391,"column":169}},"359":{"start":{"line":393,"column":12},"end":{"line":393,"column":185}},"360":{"start":{"line":393,"column":111},"end":{"line":393,"column":173}},"361":{"start":{"line":395,"column":12},"end":{"line":395,"column":197}},"362":{"start":{"line":395,"column":117},"end":{"line":395,"column":185}},"363":{"start":{"line":397,"column":12},"end":{"line":397,"column":185}},"364":{"start":{"line":397,"column":111},"end":{"line":397,"column":173}},"365":{"start":{"line":399,"column":12},"end":{"line":399,"column":187}},"366":{"start":{"line":399,"column":112},"end":{"line":399,"column":175}},"367":{"start":{"line":401,"column":12},"end":{"line":401,"column":193}},"368":{"start":{"line":401,"column":115},"end":{"line":401,"column":181}},"369":{"start":{"line":403,"column":12},"end":{"line":403,"column":204}},"370":{"start":{"line":403,"column":121},"end":{"line":403,"column":192}},"371":{"start":{"line":405,"column":12},"end":{"line":405,"column":191}},"372":{"start":{"line":405,"column":114},"end":{"line":405,"column":179}},"373":{"start":{"line":407,"column":12},"end":{"line":407,"column":185}},"374":{"start":{"line":407,"column":111},"end":{"line":407,"column":173}},"375":{"start":{"line":409,"column":12},"end":{"line":409,"column":183}},"376":{"start":{"line":409,"column":110},"end":{"line":409,"column":171}},"377":{"start":{"line":411,"column":12},"end":{"line":411,"column":189}},"378":{"start":{"line":411,"column":113},"end":{"line":411,"column":177}},"379":{"start":{"line":413,"column":12},"end":{"line":413,"column":181}},"380":{"start":{"line":413,"column":109},"end":{"line":413,"column":169}},"381":{"start":{"line":415,"column":12},"end":{"line":415,"column":189}},"382":{"start":{"line":415,"column":113},"end":{"line":415,"column":177}},"383":{"start":{"line":417,"column":12},"end":{"line":417,"column":189}},"384":{"start":{"line":417,"column":113},"end":{"line":417,"column":177}},"385":{"start":{"line":419,"column":12},"end":{"line":419,"column":195}},"386":{"start":{"line":419,"column":116},"end":{"line":419,"column":183}},"387":{"start":{"line":422,"column":17},"end":{"line":422,"column":35}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":13},"end":{"line":12,"column":14}},"loc":{"start":{"line":12,"column":24},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":14},"end":{"line":15,"column":15}},"loc":{"start":{"line":15,"column":25},"end":{"line":17,"column":5}},"line":15},"3":{"name":"_interop_require_default","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":33}},"loc":{"start":{"line":23,"column":39},"end":{"line":27,"column":1}},"line":23},"4":{"name":"_getRequireWildcardCache","decl":{"start":{"line":28,"column":9},"end":{"line":28,"column":33}},"loc":{"start":{"line":28,"column":47},"end":{"line":35,"column":1}},"line":28},"5":{"name":"(anonymous_5)","decl":{"start":{"line":32,"column":39},"end":{"line":32,"column":40}},"loc":{"start":{"line":32,"column":61},"end":{"line":34,"column":5}},"line":32},"6":{"name":"_interop_require_wildcard","decl":{"start":{"line":36,"column":9},"end":{"line":36,"column":34}},"loc":{"start":{"line":36,"column":53},"end":{"line":68,"column":1}},"line":36},"7":{"name":"(anonymous_7)","decl":{"start":{"line":72,"column":17},"end":{"line":72,"column":18}},"loc":{"start":{"line":72,"column":31},"end":{"line":421,"column":1}},"line":72},"8":{"name":"(anonymous_8)","decl":{"start":{"line":75,"column":93},"end":{"line":75,"column":94}},"loc":{"start":{"line":75,"column":111},"end":{"line":75,"column":171}},"line":75},"9":{"name":"(anonymous_9)","decl":{"start":{"line":77,"column":93},"end":{"line":77,"column":94}},"loc":{"start":{"line":77,"column":111},"end":{"line":77,"column":173}},"line":77},"10":{"name":"(anonymous_10)","decl":{"start":{"line":79,"column":98},"end":{"line":79,"column":99}},"loc":{"start":{"line":79,"column":116},"end":{"line":79,"column":183}},"line":79},"11":{"name":"(anonymous_11)","decl":{"start":{"line":81,"column":101},"end":{"line":81,"column":102}},"loc":{"start":{"line":81,"column":119},"end":{"line":81,"column":189}},"line":81},"12":{"name":"(anonymous_12)","decl":{"start":{"line":83,"column":92},"end":{"line":83,"column":93}},"loc":{"start":{"line":83,"column":110},"end":{"line":83,"column":171}},"line":83},"13":{"name":"(anonymous_13)","decl":{"start":{"line":85,"column":95},"end":{"line":85,"column":96}},"loc":{"start":{"line":85,"column":113},"end":{"line":85,"column":177}},"line":85},"14":{"name":"(anonymous_14)","decl":{"start":{"line":87,"column":100},"end":{"line":87,"column":101}},"loc":{"start":{"line":87,"column":118},"end":{"line":87,"column":187}},"line":87},"15":{"name":"(anonymous_15)","decl":{"start":{"line":89,"column":96},"end":{"line":89,"column":97}},"loc":{"start":{"line":89,"column":114},"end":{"line":89,"column":179}},"line":89},"16":{"name":"(anonymous_16)","decl":{"start":{"line":91,"column":95},"end":{"line":91,"column":96}},"loc":{"start":{"line":91,"column":113},"end":{"line":91,"column":177}},"line":91},"17":{"name":"(anonymous_17)","decl":{"start":{"line":93,"column":97},"end":{"line":93,"column":98}},"loc":{"start":{"line":93,"column":115},"end":{"line":93,"column":181}},"line":93},"18":{"name":"(anonymous_18)","decl":{"start":{"line":95,"column":96},"end":{"line":95,"column":97}},"loc":{"start":{"line":95,"column":114},"end":{"line":95,"column":179}},"line":95},"19":{"name":"(anonymous_19)","decl":{"start":{"line":97,"column":99},"end":{"line":97,"column":100}},"loc":{"start":{"line":97,"column":117},"end":{"line":97,"column":185}},"line":97},"20":{"name":"(anonymous_20)","decl":{"start":{"line":99,"column":95},"end":{"line":99,"column":96}},"loc":{"start":{"line":99,"column":113},"end":{"line":99,"column":177}},"line":99},"21":{"name":"(anonymous_21)","decl":{"start":{"line":101,"column":95},"end":{"line":101,"column":96}},"loc":{"start":{"line":101,"column":113},"end":{"line":101,"column":177}},"line":101},"22":{"name":"(anonymous_22)","decl":{"start":{"line":103,"column":92},"end":{"line":103,"column":93}},"loc":{"start":{"line":103,"column":110},"end":{"line":103,"column":171}},"line":103},"23":{"name":"(anonymous_23)","decl":{"start":{"line":105,"column":95},"end":{"line":105,"column":96}},"loc":{"start":{"line":105,"column":113},"end":{"line":105,"column":177}},"line":105},"24":{"name":"(anonymous_24)","decl":{"start":{"line":107,"column":93},"end":{"line":107,"column":94}},"loc":{"start":{"line":107,"column":111},"end":{"line":107,"column":173}},"line":107},"25":{"name":"(anonymous_25)","decl":{"start":{"line":109,"column":94},"end":{"line":109,"column":95}},"loc":{"start":{"line":109,"column":112},"end":{"line":109,"column":175}},"line":109},"26":{"name":"(anonymous_26)","decl":{"start":{"line":111,"column":92},"end":{"line":111,"column":93}},"loc":{"start":{"line":111,"column":110},"end":{"line":111,"column":171}},"line":111},"27":{"name":"(anonymous_27)","decl":{"start":{"line":113,"column":98},"end":{"line":113,"column":99}},"loc":{"start":{"line":113,"column":116},"end":{"line":113,"column":183}},"line":113},"28":{"name":"(anonymous_28)","decl":{"start":{"line":115,"column":92},"end":{"line":115,"column":93}},"loc":{"start":{"line":115,"column":110},"end":{"line":115,"column":171}},"line":115},"29":{"name":"(anonymous_29)","decl":{"start":{"line":117,"column":98},"end":{"line":117,"column":99}},"loc":{"start":{"line":117,"column":116},"end":{"line":117,"column":183}},"line":117},"30":{"name":"(anonymous_30)","decl":{"start":{"line":119,"column":95},"end":{"line":119,"column":96}},"loc":{"start":{"line":119,"column":113},"end":{"line":119,"column":177}},"line":119},"31":{"name":"(anonymous_31)","decl":{"start":{"line":121,"column":94},"end":{"line":121,"column":95}},"loc":{"start":{"line":121,"column":112},"end":{"line":121,"column":175}},"line":121},"32":{"name":"(anonymous_32)","decl":{"start":{"line":123,"column":96},"end":{"line":123,"column":97}},"loc":{"start":{"line":123,"column":114},"end":{"line":123,"column":179}},"line":123},"33":{"name":"(anonymous_33)","decl":{"start":{"line":125,"column":101},"end":{"line":125,"column":102}},"loc":{"start":{"line":125,"column":119},"end":{"line":125,"column":189}},"line":125},"34":{"name":"(anonymous_34)","decl":{"start":{"line":127,"column":94},"end":{"line":127,"column":95}},"loc":{"start":{"line":127,"column":112},"end":{"line":127,"column":175}},"line":127},"35":{"name":"(anonymous_35)","decl":{"start":{"line":129,"column":101},"end":{"line":129,"column":102}},"loc":{"start":{"line":129,"column":119},"end":{"line":129,"column":189}},"line":129},"36":{"name":"(anonymous_36)","decl":{"start":{"line":131,"column":92},"end":{"line":131,"column":93}},"loc":{"start":{"line":131,"column":110},"end":{"line":131,"column":171}},"line":131},"37":{"name":"(anonymous_37)","decl":{"start":{"line":133,"column":92},"end":{"line":133,"column":93}},"loc":{"start":{"line":133,"column":110},"end":{"line":133,"column":171}},"line":133},"38":{"name":"(anonymous_38)","decl":{"start":{"line":135,"column":92},"end":{"line":135,"column":93}},"loc":{"start":{"line":135,"column":110},"end":{"line":135,"column":171}},"line":135},"39":{"name":"(anonymous_39)","decl":{"start":{"line":137,"column":94},"end":{"line":137,"column":95}},"loc":{"start":{"line":137,"column":112},"end":{"line":137,"column":175}},"line":137},"40":{"name":"(anonymous_40)","decl":{"start":{"line":139,"column":96},"end":{"line":139,"column":97}},"loc":{"start":{"line":139,"column":114},"end":{"line":139,"column":179}},"line":139},"41":{"name":"(anonymous_41)","decl":{"start":{"line":141,"column":91},"end":{"line":141,"column":92}},"loc":{"start":{"line":141,"column":109},"end":{"line":141,"column":169}},"line":141},"42":{"name":"(anonymous_42)","decl":{"start":{"line":143,"column":92},"end":{"line":143,"column":93}},"loc":{"start":{"line":143,"column":110},"end":{"line":143,"column":171}},"line":143},"43":{"name":"(anonymous_43)","decl":{"start":{"line":145,"column":92},"end":{"line":145,"column":93}},"loc":{"start":{"line":145,"column":110},"end":{"line":145,"column":171}},"line":145},"44":{"name":"(anonymous_44)","decl":{"start":{"line":147,"column":90},"end":{"line":147,"column":91}},"loc":{"start":{"line":147,"column":108},"end":{"line":147,"column":167}},"line":147},"45":{"name":"(anonymous_45)","decl":{"start":{"line":149,"column":93},"end":{"line":149,"column":94}},"loc":{"start":{"line":149,"column":111},"end":{"line":149,"column":173}},"line":149},"46":{"name":"(anonymous_46)","decl":{"start":{"line":151,"column":95},"end":{"line":151,"column":96}},"loc":{"start":{"line":151,"column":113},"end":{"line":151,"column":177}},"line":151},"47":{"name":"(anonymous_47)","decl":{"start":{"line":153,"column":93},"end":{"line":153,"column":94}},"loc":{"start":{"line":153,"column":111},"end":{"line":153,"column":173}},"line":153},"48":{"name":"(anonymous_48)","decl":{"start":{"line":155,"column":95},"end":{"line":155,"column":96}},"loc":{"start":{"line":155,"column":113},"end":{"line":155,"column":177}},"line":155},"49":{"name":"(anonymous_49)","decl":{"start":{"line":157,"column":92},"end":{"line":157,"column":93}},"loc":{"start":{"line":157,"column":110},"end":{"line":157,"column":171}},"line":157},"50":{"name":"(anonymous_50)","decl":{"start":{"line":159,"column":99},"end":{"line":159,"column":100}},"loc":{"start":{"line":159,"column":117},"end":{"line":159,"column":185}},"line":159},"51":{"name":"(anonymous_51)","decl":{"start":{"line":161,"column":92},"end":{"line":161,"column":93}},"loc":{"start":{"line":161,"column":110},"end":{"line":161,"column":171}},"line":161},"52":{"name":"(anonymous_52)","decl":{"start":{"line":163,"column":97},"end":{"line":163,"column":98}},"loc":{"start":{"line":163,"column":115},"end":{"line":163,"column":181}},"line":163},"53":{"name":"(anonymous_53)","decl":{"start":{"line":165,"column":92},"end":{"line":165,"column":93}},"loc":{"start":{"line":165,"column":110},"end":{"line":165,"column":171}},"line":165},"54":{"name":"(anonymous_54)","decl":{"start":{"line":167,"column":93},"end":{"line":167,"column":94}},"loc":{"start":{"line":167,"column":111},"end":{"line":167,"column":173}},"line":167},"55":{"name":"(anonymous_55)","decl":{"start":{"line":169,"column":93},"end":{"line":169,"column":94}},"loc":{"start":{"line":169,"column":111},"end":{"line":169,"column":173}},"line":169},"56":{"name":"(anonymous_56)","decl":{"start":{"line":171,"column":95},"end":{"line":171,"column":96}},"loc":{"start":{"line":171,"column":113},"end":{"line":171,"column":177}},"line":171},"57":{"name":"(anonymous_57)","decl":{"start":{"line":173,"column":92},"end":{"line":173,"column":93}},"loc":{"start":{"line":173,"column":110},"end":{"line":173,"column":171}},"line":173},"58":{"name":"(anonymous_58)","decl":{"start":{"line":175,"column":92},"end":{"line":175,"column":93}},"loc":{"start":{"line":175,"column":110},"end":{"line":175,"column":171}},"line":175},"59":{"name":"(anonymous_59)","decl":{"start":{"line":177,"column":95},"end":{"line":177,"column":96}},"loc":{"start":{"line":177,"column":113},"end":{"line":177,"column":177}},"line":177},"60":{"name":"(anonymous_60)","decl":{"start":{"line":179,"column":94},"end":{"line":179,"column":95}},"loc":{"start":{"line":179,"column":112},"end":{"line":179,"column":175}},"line":179},"61":{"name":"(anonymous_61)","decl":{"start":{"line":181,"column":92},"end":{"line":181,"column":93}},"loc":{"start":{"line":181,"column":110},"end":{"line":181,"column":171}},"line":181},"62":{"name":"(anonymous_62)","decl":{"start":{"line":183,"column":93},"end":{"line":183,"column":94}},"loc":{"start":{"line":183,"column":111},"end":{"line":183,"column":173}},"line":183},"63":{"name":"(anonymous_63)","decl":{"start":{"line":185,"column":96},"end":{"line":185,"column":97}},"loc":{"start":{"line":185,"column":114},"end":{"line":185,"column":179}},"line":185},"64":{"name":"(anonymous_64)","decl":{"start":{"line":187,"column":95},"end":{"line":187,"column":96}},"loc":{"start":{"line":187,"column":113},"end":{"line":187,"column":177}},"line":187},"65":{"name":"(anonymous_65)","decl":{"start":{"line":189,"column":93},"end":{"line":189,"column":94}},"loc":{"start":{"line":189,"column":111},"end":{"line":189,"column":173}},"line":189},"66":{"name":"(anonymous_66)","decl":{"start":{"line":191,"column":94},"end":{"line":191,"column":95}},"loc":{"start":{"line":191,"column":112},"end":{"line":191,"column":175}},"line":191},"67":{"name":"(anonymous_67)","decl":{"start":{"line":193,"column":94},"end":{"line":193,"column":95}},"loc":{"start":{"line":193,"column":112},"end":{"line":193,"column":175}},"line":193},"68":{"name":"(anonymous_68)","decl":{"start":{"line":195,"column":96},"end":{"line":195,"column":97}},"loc":{"start":{"line":195,"column":114},"end":{"line":195,"column":179}},"line":195},"69":{"name":"(anonymous_69)","decl":{"start":{"line":197,"column":93},"end":{"line":197,"column":94}},"loc":{"start":{"line":197,"column":111},"end":{"line":197,"column":173}},"line":197},"70":{"name":"(anonymous_70)","decl":{"start":{"line":199,"column":91},"end":{"line":199,"column":92}},"loc":{"start":{"line":199,"column":109},"end":{"line":199,"column":169}},"line":199},"71":{"name":"(anonymous_71)","decl":{"start":{"line":201,"column":93},"end":{"line":201,"column":94}},"loc":{"start":{"line":201,"column":111},"end":{"line":201,"column":173}},"line":201},"72":{"name":"(anonymous_72)","decl":{"start":{"line":203,"column":95},"end":{"line":203,"column":96}},"loc":{"start":{"line":203,"column":113},"end":{"line":203,"column":177}},"line":203},"73":{"name":"(anonymous_73)","decl":{"start":{"line":205,"column":95},"end":{"line":205,"column":96}},"loc":{"start":{"line":205,"column":113},"end":{"line":205,"column":177}},"line":205},"74":{"name":"(anonymous_74)","decl":{"start":{"line":207,"column":93},"end":{"line":207,"column":94}},"loc":{"start":{"line":207,"column":111},"end":{"line":207,"column":173}},"line":207},"75":{"name":"(anonymous_75)","decl":{"start":{"line":209,"column":99},"end":{"line":209,"column":100}},"loc":{"start":{"line":209,"column":117},"end":{"line":209,"column":185}},"line":209},"76":{"name":"(anonymous_76)","decl":{"start":{"line":211,"column":96},"end":{"line":211,"column":97}},"loc":{"start":{"line":211,"column":114},"end":{"line":211,"column":179}},"line":211},"77":{"name":"(anonymous_77)","decl":{"start":{"line":213,"column":93},"end":{"line":213,"column":94}},"loc":{"start":{"line":213,"column":111},"end":{"line":213,"column":173}},"line":213},"78":{"name":"(anonymous_78)","decl":{"start":{"line":215,"column":92},"end":{"line":215,"column":93}},"loc":{"start":{"line":215,"column":110},"end":{"line":215,"column":171}},"line":215},"79":{"name":"(anonymous_79)","decl":{"start":{"line":217,"column":97},"end":{"line":217,"column":98}},"loc":{"start":{"line":217,"column":115},"end":{"line":217,"column":181}},"line":217},"80":{"name":"(anonymous_80)","decl":{"start":{"line":219,"column":93},"end":{"line":219,"column":94}},"loc":{"start":{"line":219,"column":111},"end":{"line":219,"column":173}},"line":219},"81":{"name":"(anonymous_81)","decl":{"start":{"line":221,"column":91},"end":{"line":221,"column":92}},"loc":{"start":{"line":221,"column":109},"end":{"line":221,"column":169}},"line":221},"82":{"name":"(anonymous_82)","decl":{"start":{"line":223,"column":96},"end":{"line":223,"column":97}},"loc":{"start":{"line":223,"column":114},"end":{"line":223,"column":179}},"line":223},"83":{"name":"(anonymous_83)","decl":{"start":{"line":225,"column":92},"end":{"line":225,"column":93}},"loc":{"start":{"line":225,"column":110},"end":{"line":225,"column":171}},"line":225},"84":{"name":"(anonymous_84)","decl":{"start":{"line":227,"column":95},"end":{"line":227,"column":96}},"loc":{"start":{"line":227,"column":113},"end":{"line":227,"column":177}},"line":227},"85":{"name":"(anonymous_85)","decl":{"start":{"line":229,"column":93},"end":{"line":229,"column":94}},"loc":{"start":{"line":229,"column":111},"end":{"line":229,"column":173}},"line":229},"86":{"name":"(anonymous_86)","decl":{"start":{"line":231,"column":99},"end":{"line":231,"column":100}},"loc":{"start":{"line":231,"column":117},"end":{"line":231,"column":185}},"line":231},"87":{"name":"(anonymous_87)","decl":{"start":{"line":233,"column":98},"end":{"line":233,"column":99}},"loc":{"start":{"line":233,"column":116},"end":{"line":233,"column":183}},"line":233},"88":{"name":"(anonymous_88)","decl":{"start":{"line":235,"column":93},"end":{"line":235,"column":94}},"loc":{"start":{"line":235,"column":111},"end":{"line":235,"column":173}},"line":235},"89":{"name":"(anonymous_89)","decl":{"start":{"line":237,"column":94},"end":{"line":237,"column":95}},"loc":{"start":{"line":237,"column":112},"end":{"line":237,"column":175}},"line":237},"90":{"name":"(anonymous_90)","decl":{"start":{"line":239,"column":99},"end":{"line":239,"column":100}},"loc":{"start":{"line":239,"column":117},"end":{"line":239,"column":185}},"line":239},"91":{"name":"(anonymous_91)","decl":{"start":{"line":241,"column":95},"end":{"line":241,"column":96}},"loc":{"start":{"line":241,"column":113},"end":{"line":241,"column":177}},"line":241},"92":{"name":"(anonymous_92)","decl":{"start":{"line":243,"column":94},"end":{"line":243,"column":95}},"loc":{"start":{"line":243,"column":112},"end":{"line":243,"column":175}},"line":243},"93":{"name":"(anonymous_93)","decl":{"start":{"line":245,"column":93},"end":{"line":245,"column":94}},"loc":{"start":{"line":245,"column":111},"end":{"line":245,"column":173}},"line":245},"94":{"name":"(anonymous_94)","decl":{"start":{"line":247,"column":93},"end":{"line":247,"column":94}},"loc":{"start":{"line":247,"column":111},"end":{"line":247,"column":173}},"line":247},"95":{"name":"(anonymous_95)","decl":{"start":{"line":249,"column":93},"end":{"line":249,"column":94}},"loc":{"start":{"line":249,"column":111},"end":{"line":249,"column":173}},"line":249},"96":{"name":"(anonymous_96)","decl":{"start":{"line":251,"column":93},"end":{"line":251,"column":94}},"loc":{"start":{"line":251,"column":111},"end":{"line":251,"column":173}},"line":251},"97":{"name":"(anonymous_97)","decl":{"start":{"line":253,"column":103},"end":{"line":253,"column":104}},"loc":{"start":{"line":253,"column":121},"end":{"line":253,"column":193}},"line":253},"98":{"name":"(anonymous_98)","decl":{"start":{"line":255,"column":99},"end":{"line":255,"column":100}},"loc":{"start":{"line":255,"column":117},"end":{"line":255,"column":185}},"line":255},"99":{"name":"(anonymous_99)","decl":{"start":{"line":257,"column":93},"end":{"line":257,"column":94}},"loc":{"start":{"line":257,"column":111},"end":{"line":257,"column":173}},"line":257},"100":{"name":"(anonymous_100)","decl":{"start":{"line":259,"column":92},"end":{"line":259,"column":93}},"loc":{"start":{"line":259,"column":110},"end":{"line":259,"column":171}},"line":259},"101":{"name":"(anonymous_101)","decl":{"start":{"line":261,"column":92},"end":{"line":261,"column":93}},"loc":{"start":{"line":261,"column":110},"end":{"line":261,"column":171}},"line":261},"102":{"name":"(anonymous_102)","decl":{"start":{"line":263,"column":97},"end":{"line":263,"column":98}},"loc":{"start":{"line":263,"column":115},"end":{"line":263,"column":181}},"line":263},"103":{"name":"(anonymous_103)","decl":{"start":{"line":265,"column":97},"end":{"line":265,"column":98}},"loc":{"start":{"line":265,"column":115},"end":{"line":265,"column":181}},"line":265},"104":{"name":"(anonymous_104)","decl":{"start":{"line":267,"column":100},"end":{"line":267,"column":101}},"loc":{"start":{"line":267,"column":118},"end":{"line":267,"column":187}},"line":267},"105":{"name":"(anonymous_105)","decl":{"start":{"line":269,"column":95},"end":{"line":269,"column":96}},"loc":{"start":{"line":269,"column":113},"end":{"line":269,"column":177}},"line":269},"106":{"name":"(anonymous_106)","decl":{"start":{"line":271,"column":95},"end":{"line":271,"column":96}},"loc":{"start":{"line":271,"column":113},"end":{"line":271,"column":177}},"line":271},"107":{"name":"(anonymous_107)","decl":{"start":{"line":273,"column":92},"end":{"line":273,"column":93}},"loc":{"start":{"line":273,"column":110},"end":{"line":273,"column":171}},"line":273},"108":{"name":"(anonymous_108)","decl":{"start":{"line":275,"column":96},"end":{"line":275,"column":97}},"loc":{"start":{"line":275,"column":114},"end":{"line":275,"column":179}},"line":275},"109":{"name":"(anonymous_109)","decl":{"start":{"line":277,"column":96},"end":{"line":277,"column":97}},"loc":{"start":{"line":277,"column":114},"end":{"line":277,"column":179}},"line":277},"110":{"name":"(anonymous_110)","decl":{"start":{"line":279,"column":94},"end":{"line":279,"column":95}},"loc":{"start":{"line":279,"column":112},"end":{"line":279,"column":175}},"line":279},"111":{"name":"(anonymous_111)","decl":{"start":{"line":281,"column":93},"end":{"line":281,"column":94}},"loc":{"start":{"line":281,"column":111},"end":{"line":281,"column":173}},"line":281},"112":{"name":"(anonymous_112)","decl":{"start":{"line":283,"column":100},"end":{"line":283,"column":101}},"loc":{"start":{"line":283,"column":118},"end":{"line":283,"column":187}},"line":283},"113":{"name":"(anonymous_113)","decl":{"start":{"line":285,"column":95},"end":{"line":285,"column":96}},"loc":{"start":{"line":285,"column":113},"end":{"line":285,"column":177}},"line":285},"114":{"name":"(anonymous_114)","decl":{"start":{"line":287,"column":99},"end":{"line":287,"column":100}},"loc":{"start":{"line":287,"column":117},"end":{"line":287,"column":185}},"line":287},"115":{"name":"(anonymous_115)","decl":{"start":{"line":289,"column":93},"end":{"line":289,"column":94}},"loc":{"start":{"line":289,"column":111},"end":{"line":289,"column":173}},"line":289},"116":{"name":"(anonymous_116)","decl":{"start":{"line":291,"column":94},"end":{"line":291,"column":95}},"loc":{"start":{"line":291,"column":112},"end":{"line":291,"column":175}},"line":291},"117":{"name":"(anonymous_117)","decl":{"start":{"line":293,"column":95},"end":{"line":293,"column":96}},"loc":{"start":{"line":293,"column":113},"end":{"line":293,"column":177}},"line":293},"118":{"name":"(anonymous_118)","decl":{"start":{"line":295,"column":92},"end":{"line":295,"column":93}},"loc":{"start":{"line":295,"column":110},"end":{"line":295,"column":171}},"line":295},"119":{"name":"(anonymous_119)","decl":{"start":{"line":297,"column":93},"end":{"line":297,"column":94}},"loc":{"start":{"line":297,"column":111},"end":{"line":297,"column":173}},"line":297},"120":{"name":"(anonymous_120)","decl":{"start":{"line":299,"column":99},"end":{"line":299,"column":100}},"loc":{"start":{"line":299,"column":117},"end":{"line":299,"column":185}},"line":299},"121":{"name":"(anonymous_121)","decl":{"start":{"line":301,"column":94},"end":{"line":301,"column":95}},"loc":{"start":{"line":301,"column":112},"end":{"line":301,"column":175}},"line":301},"122":{"name":"(anonymous_122)","decl":{"start":{"line":303,"column":97},"end":{"line":303,"column":98}},"loc":{"start":{"line":303,"column":115},"end":{"line":303,"column":181}},"line":303},"123":{"name":"(anonymous_123)","decl":{"start":{"line":305,"column":96},"end":{"line":305,"column":97}},"loc":{"start":{"line":305,"column":114},"end":{"line":305,"column":179}},"line":305},"124":{"name":"(anonymous_124)","decl":{"start":{"line":307,"column":96},"end":{"line":307,"column":97}},"loc":{"start":{"line":307,"column":114},"end":{"line":307,"column":179}},"line":307},"125":{"name":"(anonymous_125)","decl":{"start":{"line":309,"column":91},"end":{"line":309,"column":92}},"loc":{"start":{"line":309,"column":109},"end":{"line":309,"column":169}},"line":309},"126":{"name":"(anonymous_126)","decl":{"start":{"line":311,"column":92},"end":{"line":311,"column":93}},"loc":{"start":{"line":311,"column":110},"end":{"line":311,"column":171}},"line":311},"127":{"name":"(anonymous_127)","decl":{"start":{"line":313,"column":93},"end":{"line":313,"column":94}},"loc":{"start":{"line":313,"column":111},"end":{"line":313,"column":173}},"line":313},"128":{"name":"(anonymous_128)","decl":{"start":{"line":315,"column":99},"end":{"line":315,"column":100}},"loc":{"start":{"line":315,"column":117},"end":{"line":315,"column":185}},"line":315},"129":{"name":"(anonymous_129)","decl":{"start":{"line":317,"column":99},"end":{"line":317,"column":100}},"loc":{"start":{"line":317,"column":117},"end":{"line":317,"column":185}},"line":317},"130":{"name":"(anonymous_130)","decl":{"start":{"line":319,"column":96},"end":{"line":319,"column":97}},"loc":{"start":{"line":319,"column":114},"end":{"line":319,"column":179}},"line":319},"131":{"name":"(anonymous_131)","decl":{"start":{"line":321,"column":95},"end":{"line":321,"column":96}},"loc":{"start":{"line":321,"column":113},"end":{"line":321,"column":177}},"line":321},"132":{"name":"(anonymous_132)","decl":{"start":{"line":323,"column":97},"end":{"line":323,"column":98}},"loc":{"start":{"line":323,"column":115},"end":{"line":323,"column":181}},"line":323},"133":{"name":"(anonymous_133)","decl":{"start":{"line":325,"column":95},"end":{"line":325,"column":96}},"loc":{"start":{"line":325,"column":113},"end":{"line":325,"column":177}},"line":325},"134":{"name":"(anonymous_134)","decl":{"start":{"line":327,"column":98},"end":{"line":327,"column":99}},"loc":{"start":{"line":327,"column":116},"end":{"line":327,"column":183}},"line":327},"135":{"name":"(anonymous_135)","decl":{"start":{"line":329,"column":95},"end":{"line":329,"column":96}},"loc":{"start":{"line":329,"column":113},"end":{"line":329,"column":177}},"line":329},"136":{"name":"(anonymous_136)","decl":{"start":{"line":331,"column":90},"end":{"line":331,"column":91}},"loc":{"start":{"line":331,"column":108},"end":{"line":331,"column":167}},"line":331},"137":{"name":"(anonymous_137)","decl":{"start":{"line":333,"column":92},"end":{"line":333,"column":93}},"loc":{"start":{"line":333,"column":110},"end":{"line":333,"column":171}},"line":333},"138":{"name":"(anonymous_138)","decl":{"start":{"line":335,"column":90},"end":{"line":335,"column":91}},"loc":{"start":{"line":335,"column":108},"end":{"line":335,"column":167}},"line":335},"139":{"name":"(anonymous_139)","decl":{"start":{"line":337,"column":92},"end":{"line":337,"column":93}},"loc":{"start":{"line":337,"column":110},"end":{"line":337,"column":171}},"line":337},"140":{"name":"(anonymous_140)","decl":{"start":{"line":339,"column":97},"end":{"line":339,"column":98}},"loc":{"start":{"line":339,"column":115},"end":{"line":339,"column":181}},"line":339},"141":{"name":"(anonymous_141)","decl":{"start":{"line":341,"column":92},"end":{"line":341,"column":93}},"loc":{"start":{"line":341,"column":110},"end":{"line":341,"column":171}},"line":341},"142":{"name":"(anonymous_142)","decl":{"start":{"line":343,"column":102},"end":{"line":343,"column":103}},"loc":{"start":{"line":343,"column":120},"end":{"line":343,"column":191}},"line":343},"143":{"name":"(anonymous_143)","decl":{"start":{"line":345,"column":93},"end":{"line":345,"column":94}},"loc":{"start":{"line":345,"column":111},"end":{"line":345,"column":173}},"line":345},"144":{"name":"(anonymous_144)","decl":{"start":{"line":347,"column":94},"end":{"line":347,"column":95}},"loc":{"start":{"line":347,"column":112},"end":{"line":347,"column":175}},"line":347},"145":{"name":"(anonymous_145)","decl":{"start":{"line":349,"column":95},"end":{"line":349,"column":96}},"loc":{"start":{"line":349,"column":113},"end":{"line":349,"column":177}},"line":349},"146":{"name":"(anonymous_146)","decl":{"start":{"line":351,"column":95},"end":{"line":351,"column":96}},"loc":{"start":{"line":351,"column":113},"end":{"line":351,"column":177}},"line":351},"147":{"name":"(anonymous_147)","decl":{"start":{"line":353,"column":93},"end":{"line":353,"column":94}},"loc":{"start":{"line":353,"column":111},"end":{"line":353,"column":173}},"line":353},"148":{"name":"(anonymous_148)","decl":{"start":{"line":355,"column":94},"end":{"line":355,"column":95}},"loc":{"start":{"line":355,"column":112},"end":{"line":355,"column":175}},"line":355},"149":{"name":"(anonymous_149)","decl":{"start":{"line":357,"column":94},"end":{"line":357,"column":95}},"loc":{"start":{"line":357,"column":112},"end":{"line":357,"column":175}},"line":357},"150":{"name":"(anonymous_150)","decl":{"start":{"line":359,"column":98},"end":{"line":359,"column":99}},"loc":{"start":{"line":359,"column":116},"end":{"line":359,"column":183}},"line":359},"151":{"name":"(anonymous_151)","decl":{"start":{"line":361,"column":92},"end":{"line":361,"column":93}},"loc":{"start":{"line":361,"column":110},"end":{"line":361,"column":171}},"line":361},"152":{"name":"(anonymous_152)","decl":{"start":{"line":363,"column":92},"end":{"line":363,"column":93}},"loc":{"start":{"line":363,"column":110},"end":{"line":363,"column":171}},"line":363},"153":{"name":"(anonymous_153)","decl":{"start":{"line":365,"column":92},"end":{"line":365,"column":93}},"loc":{"start":{"line":365,"column":110},"end":{"line":365,"column":171}},"line":365},"154":{"name":"(anonymous_154)","decl":{"start":{"line":367,"column":93},"end":{"line":367,"column":94}},"loc":{"start":{"line":367,"column":111},"end":{"line":367,"column":173}},"line":367},"155":{"name":"(anonymous_155)","decl":{"start":{"line":369,"column":94},"end":{"line":369,"column":95}},"loc":{"start":{"line":369,"column":112},"end":{"line":369,"column":175}},"line":369},"156":{"name":"(anonymous_156)","decl":{"start":{"line":371,"column":95},"end":{"line":371,"column":96}},"loc":{"start":{"line":371,"column":113},"end":{"line":371,"column":177}},"line":371},"157":{"name":"(anonymous_157)","decl":{"start":{"line":373,"column":95},"end":{"line":373,"column":96}},"loc":{"start":{"line":373,"column":113},"end":{"line":373,"column":177}},"line":373},"158":{"name":"(anonymous_158)","decl":{"start":{"line":375,"column":96},"end":{"line":375,"column":97}},"loc":{"start":{"line":375,"column":114},"end":{"line":375,"column":179}},"line":375},"159":{"name":"(anonymous_159)","decl":{"start":{"line":377,"column":94},"end":{"line":377,"column":95}},"loc":{"start":{"line":377,"column":112},"end":{"line":377,"column":175}},"line":377},"160":{"name":"(anonymous_160)","decl":{"start":{"line":379,"column":101},"end":{"line":379,"column":102}},"loc":{"start":{"line":379,"column":119},"end":{"line":379,"column":189}},"line":379},"161":{"name":"(anonymous_161)","decl":{"start":{"line":381,"column":93},"end":{"line":381,"column":94}},"loc":{"start":{"line":381,"column":111},"end":{"line":381,"column":173}},"line":381},"162":{"name":"(anonymous_162)","decl":{"start":{"line":383,"column":92},"end":{"line":383,"column":93}},"loc":{"start":{"line":383,"column":110},"end":{"line":383,"column":171}},"line":383},"163":{"name":"(anonymous_163)","decl":{"start":{"line":385,"column":92},"end":{"line":385,"column":93}},"loc":{"start":{"line":385,"column":110},"end":{"line":385,"column":171}},"line":385},"164":{"name":"(anonymous_164)","decl":{"start":{"line":387,"column":92},"end":{"line":387,"column":93}},"loc":{"start":{"line":387,"column":110},"end":{"line":387,"column":171}},"line":387},"165":{"name":"(anonymous_165)","decl":{"start":{"line":389,"column":95},"end":{"line":389,"column":96}},"loc":{"start":{"line":389,"column":113},"end":{"line":389,"column":177}},"line":389},"166":{"name":"(anonymous_166)","decl":{"start":{"line":391,"column":91},"end":{"line":391,"column":92}},"loc":{"start":{"line":391,"column":109},"end":{"line":391,"column":169}},"line":391},"167":{"name":"(anonymous_167)","decl":{"start":{"line":393,"column":93},"end":{"line":393,"column":94}},"loc":{"start":{"line":393,"column":111},"end":{"line":393,"column":173}},"line":393},"168":{"name":"(anonymous_168)","decl":{"start":{"line":395,"column":99},"end":{"line":395,"column":100}},"loc":{"start":{"line":395,"column":117},"end":{"line":395,"column":185}},"line":395},"169":{"name":"(anonymous_169)","decl":{"start":{"line":397,"column":93},"end":{"line":397,"column":94}},"loc":{"start":{"line":397,"column":111},"end":{"line":397,"column":173}},"line":397},"170":{"name":"(anonymous_170)","decl":{"start":{"line":399,"column":94},"end":{"line":399,"column":95}},"loc":{"start":{"line":399,"column":112},"end":{"line":399,"column":175}},"line":399},"171":{"name":"(anonymous_171)","decl":{"start":{"line":401,"column":97},"end":{"line":401,"column":98}},"loc":{"start":{"line":401,"column":115},"end":{"line":401,"column":181}},"line":401},"172":{"name":"(anonymous_172)","decl":{"start":{"line":403,"column":103},"end":{"line":403,"column":104}},"loc":{"start":{"line":403,"column":121},"end":{"line":403,"column":192}},"line":403},"173":{"name":"(anonymous_173)","decl":{"start":{"line":405,"column":96},"end":{"line":405,"column":97}},"loc":{"start":{"line":405,"column":114},"end":{"line":405,"column":179}},"line":405},"174":{"name":"(anonymous_174)","decl":{"start":{"line":407,"column":93},"end":{"line":407,"column":94}},"loc":{"start":{"line":407,"column":111},"end":{"line":407,"column":173}},"line":407},"175":{"name":"(anonymous_175)","decl":{"start":{"line":409,"column":92},"end":{"line":409,"column":93}},"loc":{"start":{"line":409,"column":110},"end":{"line":409,"column":171}},"line":409},"176":{"name":"(anonymous_176)","decl":{"start":{"line":411,"column":95},"end":{"line":411,"column":96}},"loc":{"start":{"line":411,"column":113},"end":{"line":411,"column":177}},"line":411},"177":{"name":"(anonymous_177)","decl":{"start":{"line":413,"column":91},"end":{"line":413,"column":92}},"loc":{"start":{"line":413,"column":109},"end":{"line":413,"column":169}},"line":413},"178":{"name":"(anonymous_178)","decl":{"start":{"line":415,"column":95},"end":{"line":415,"column":96}},"loc":{"start":{"line":415,"column":113},"end":{"line":415,"column":177}},"line":415},"179":{"name":"(anonymous_179)","decl":{"start":{"line":417,"column":95},"end":{"line":417,"column":96}},"loc":{"start":{"line":417,"column":113},"end":{"line":417,"column":177}},"line":417},"180":{"name":"(anonymous_180)","decl":{"start":{"line":419,"column":98},"end":{"line":419,"column":99}},"loc":{"start":{"line":419,"column":116},"end":{"line":419,"column":183}},"line":419}},"branchMap":{"0":{"loc":{"start":{"line":24,"column":11},"end":{"line":26,"column":5}},"type":"cond-expr","locations":[{"start":{"line":24,"column":35},"end":{"line":24,"column":38}},{"start":{"line":24,"column":41},"end":{"line":26,"column":5}}],"line":24},"1":{"loc":{"start":{"line":24,"column":11},"end":{"line":24,"column":32}},"type":"binary-expr","locations":[{"start":{"line":24,"column":11},"end":{"line":24,"column":14}},{"start":{"line":24,"column":18},"end":{"line":24,"column":32}}],"line":24},"2":{"loc":{"start":{"line":29,"column":4},"end":{"line":29,"column":51}},"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":29,"column":51}},{"start":{"line":29,"column":4},"end":{"line":29,"column":51}}],"line":29},"3":{"loc":{"start":{"line":33,"column":15},"end":{"line":33,"column":65}},"type":"cond-expr","locations":[{"start":{"line":33,"column":29},"end":{"line":33,"column":45}},{"start":{"line":33,"column":48},"end":{"line":33,"column":65}}],"line":33},"4":{"loc":{"start":{"line":37,"column":4},"end":{"line":39,"column":5}},"type":"if","locations":[{"start":{"line":37,"column":4},"end":{"line":39,"column":5}},{"start":{"line":37,"column":4},"end":{"line":39,"column":5}}],"line":37},"5":{"loc":{"start":{"line":37,"column":8},"end":{"line":37,"column":45}},"type":"binary-expr","locations":[{"start":{"line":37,"column":8},"end":{"line":37,"column":20}},{"start":{"line":37,"column":24},"end":{"line":37,"column":27}},{"start":{"line":37,"column":31},"end":{"line":37,"column":45}}],"line":37},"6":{"loc":{"start":{"line":40,"column":4},"end":{"line":44,"column":5}},"type":"if","locations":[{"start":{"line":40,"column":4},"end":{"line":44,"column":5}},{"start":{"line":40,"column":4},"end":{"line":44,"column":5}}],"line":40},"7":{"loc":{"start":{"line":40,"column":8},"end":{"line":40,"column":76}},"type":"binary-expr","locations":[{"start":{"line":40,"column":8},"end":{"line":40,"column":20}},{"start":{"line":40,"column":24},"end":{"line":40,"column":47}},{"start":{"line":40,"column":51},"end":{"line":40,"column":76}}],"line":40},"8":{"loc":{"start":{"line":46,"column":4},"end":{"line":48,"column":5}},"type":"if","locations":[{"start":{"line":46,"column":4},"end":{"line":48,"column":5}},{"start":{"line":46,"column":4},"end":{"line":48,"column":5}}],"line":46},"9":{"loc":{"start":{"line":46,"column":8},"end":{"line":46,"column":31}},"type":"binary-expr","locations":[{"start":{"line":46,"column":8},"end":{"line":46,"column":13}},{"start":{"line":46,"column":17},"end":{"line":46,"column":31}}],"line":46},"10":{"loc":{"start":{"line":52,"column":32},"end":{"line":52,"column":88}},"type":"binary-expr","locations":[{"start":{"line":52,"column":32},"end":{"line":52,"column":53}},{"start":{"line":52,"column":57},"end":{"line":52,"column":88}}],"line":52},"11":{"loc":{"start":{"line":54,"column":8},"end":{"line":61,"column":9}},"type":"if","locations":[{"start":{"line":54,"column":8},"end":{"line":61,"column":9}},{"start":{"line":54,"column":8},"end":{"line":61,"column":9}}],"line":54},"12":{"loc":{"start":{"line":54,"column":12},"end":{"line":54,"column":79}},"type":"binary-expr","locations":[{"start":{"line":54,"column":12},"end":{"line":54,"column":29}},{"start":{"line":54,"column":33},"end":{"line":54,"column":79}}],"line":54},"13":{"loc":{"start":{"line":55,"column":23},"end":{"line":55,"column":95}},"type":"cond-expr","locations":[{"start":{"line":55,"column":47},"end":{"line":55,"column":88}},{"start":{"line":55,"column":91},"end":{"line":55,"column":95}}],"line":55},"14":{"loc":{"start":{"line":56,"column":12},"end":{"line":60,"column":13}},"type":"if","locations":[{"start":{"line":56,"column":12},"end":{"line":60,"column":13}},{"start":{"line":56,"column":12},"end":{"line":60,"column":13}}],"line":56},"15":{"loc":{"start":{"line":56,"column":16},"end":{"line":56,"column":46}},"type":"binary-expr","locations":[{"start":{"line":56,"column":16},"end":{"line":56,"column":20}},{"start":{"line":56,"column":25},"end":{"line":56,"column":33}},{"start":{"line":56,"column":37},"end":{"line":56,"column":45}}],"line":56},"16":{"loc":{"start":{"line":64,"column":4},"end":{"line":66,"column":5}},"type":"if","locations":[{"start":{"line":64,"column":4},"end":{"line":66,"column":5}},{"start":{"line":64,"column":4},"end":{"line":66,"column":5}}],"line":64},"17":{"loc":{"start":{"line":73,"column":4},"end":{"line":420,"column":5}},"type":"switch","locations":[{"start":{"line":74,"column":8},"end":{"line":75,"column":183}},{"start":{"line":76,"column":8},"end":{"line":77,"column":185}},{"start":{"line":78,"column":8},"end":{"line":79,"column":195}},{"start":{"line":80,"column":8},"end":{"line":81,"column":201}},{"start":{"line":82,"column":8},"end":{"line":83,"column":183}},{"start":{"line":84,"column":8},"end":{"line":85,"column":189}},{"start":{"line":86,"column":8},"end":{"line":87,"column":199}},{"start":{"line":88,"column":8},"end":{"line":89,"column":191}},{"start":{"line":90,"column":8},"end":{"line":91,"column":189}},{"start":{"line":92,"column":8},"end":{"line":93,"column":193}},{"start":{"line":94,"column":8},"end":{"line":95,"column":191}},{"start":{"line":96,"column":8},"end":{"line":97,"column":197}},{"start":{"line":98,"column":8},"end":{"line":99,"column":189}},{"start":{"line":100,"column":8},"end":{"line":101,"column":189}},{"start":{"line":102,"column":8},"end":{"line":103,"column":183}},{"start":{"line":104,"column":8},"end":{"line":105,"column":189}},{"start":{"line":106,"column":8},"end":{"line":107,"column":185}},{"start":{"line":108,"column":8},"end":{"line":109,"column":187}},{"start":{"line":110,"column":8},"end":{"line":111,"column":183}},{"start":{"line":112,"column":8},"end":{"line":113,"column":195}},{"start":{"line":114,"column":8},"end":{"line":115,"column":183}},{"start":{"line":116,"column":8},"end":{"line":117,"column":195}},{"start":{"line":118,"column":8},"end":{"line":119,"column":189}},{"start":{"line":120,"column":8},"end":{"line":121,"column":187}},{"start":{"line":122,"column":8},"end":{"line":123,"column":191}},{"start":{"line":124,"column":8},"end":{"line":125,"column":201}},{"start":{"line":126,"column":8},"end":{"line":127,"column":187}},{"start":{"line":128,"column":8},"end":{"line":129,"column":201}},{"start":{"line":130,"column":8},"end":{"line":131,"column":183}},{"start":{"line":132,"column":8},"end":{"line":133,"column":183}},{"start":{"line":134,"column":8},"end":{"line":135,"column":183}},{"start":{"line":136,"column":8},"end":{"line":137,"column":187}},{"start":{"line":138,"column":8},"end":{"line":139,"column":191}},{"start":{"line":140,"column":8},"end":{"line":141,"column":181}},{"start":{"line":142,"column":8},"end":{"line":143,"column":183}},{"start":{"line":144,"column":8},"end":{"line":145,"column":183}},{"start":{"line":146,"column":8},"end":{"line":147,"column":179}},{"start":{"line":148,"column":8},"end":{"line":149,"column":185}},{"start":{"line":150,"column":8},"end":{"line":151,"column":189}},{"start":{"line":152,"column":8},"end":{"line":153,"column":185}},{"start":{"line":154,"column":8},"end":{"line":155,"column":189}},{"start":{"line":156,"column":8},"end":{"line":157,"column":183}},{"start":{"line":158,"column":8},"end":{"line":159,"column":197}},{"start":{"line":160,"column":8},"end":{"line":161,"column":183}},{"start":{"line":162,"column":8},"end":{"line":163,"column":193}},{"start":{"line":164,"column":8},"end":{"line":165,"column":183}},{"start":{"line":166,"column":8},"end":{"line":167,"column":185}},{"start":{"line":168,"column":8},"end":{"line":169,"column":185}},{"start":{"line":170,"column":8},"end":{"line":171,"column":189}},{"start":{"line":172,"column":8},"end":{"line":173,"column":183}},{"start":{"line":174,"column":8},"end":{"line":175,"column":183}},{"start":{"line":176,"column":8},"end":{"line":177,"column":189}},{"start":{"line":178,"column":8},"end":{"line":179,"column":187}},{"start":{"line":180,"column":8},"end":{"line":181,"column":183}},{"start":{"line":182,"column":8},"end":{"line":183,"column":185}},{"start":{"line":184,"column":8},"end":{"line":185,"column":191}},{"start":{"line":186,"column":8},"end":{"line":187,"column":189}},{"start":{"line":188,"column":8},"end":{"line":189,"column":185}},{"start":{"line":190,"column":8},"end":{"line":191,"column":187}},{"start":{"line":192,"column":8},"end":{"line":193,"column":187}},{"start":{"line":194,"column":8},"end":{"line":195,"column":191}},{"start":{"line":196,"column":8},"end":{"line":197,"column":185}},{"start":{"line":198,"column":8},"end":{"line":199,"column":181}},{"start":{"line":200,"column":8},"end":{"line":201,"column":185}},{"start":{"line":202,"column":8},"end":{"line":203,"column":189}},{"start":{"line":204,"column":8},"end":{"line":205,"column":189}},{"start":{"line":206,"column":8},"end":{"line":207,"column":185}},{"start":{"line":208,"column":8},"end":{"line":209,"column":197}},{"start":{"line":210,"column":8},"end":{"line":211,"column":191}},{"start":{"line":212,"column":8},"end":{"line":213,"column":185}},{"start":{"line":214,"column":8},"end":{"line":215,"column":183}},{"start":{"line":216,"column":8},"end":{"line":217,"column":193}},{"start":{"line":218,"column":8},"end":{"line":219,"column":185}},{"start":{"line":220,"column":8},"end":{"line":221,"column":181}},{"start":{"line":222,"column":8},"end":{"line":223,"column":191}},{"start":{"line":224,"column":8},"end":{"line":225,"column":183}},{"start":{"line":226,"column":8},"end":{"line":227,"column":189}},{"start":{"line":228,"column":8},"end":{"line":229,"column":185}},{"start":{"line":230,"column":8},"end":{"line":231,"column":197}},{"start":{"line":232,"column":8},"end":{"line":233,"column":195}},{"start":{"line":234,"column":8},"end":{"line":235,"column":185}},{"start":{"line":236,"column":8},"end":{"line":237,"column":187}},{"start":{"line":238,"column":8},"end":{"line":239,"column":197}},{"start":{"line":240,"column":8},"end":{"line":241,"column":189}},{"start":{"line":242,"column":8},"end":{"line":243,"column":187}},{"start":{"line":244,"column":8},"end":{"line":245,"column":185}},{"start":{"line":246,"column":8},"end":{"line":247,"column":185}},{"start":{"line":248,"column":8},"end":{"line":249,"column":185}},{"start":{"line":250,"column":8},"end":{"line":251,"column":185}},{"start":{"line":252,"column":8},"end":{"line":253,"column":205}},{"start":{"line":254,"column":8},"end":{"line":255,"column":197}},{"start":{"line":256,"column":8},"end":{"line":257,"column":185}},{"start":{"line":258,"column":8},"end":{"line":259,"column":183}},{"start":{"line":260,"column":8},"end":{"line":261,"column":183}},{"start":{"line":262,"column":8},"end":{"line":263,"column":193}},{"start":{"line":264,"column":8},"end":{"line":265,"column":193}},{"start":{"line":266,"column":8},"end":{"line":267,"column":199}},{"start":{"line":268,"column":8},"end":{"line":269,"column":189}},{"start":{"line":270,"column":8},"end":{"line":271,"column":189}},{"start":{"line":272,"column":8},"end":{"line":273,"column":183}},{"start":{"line":274,"column":8},"end":{"line":275,"column":191}},{"start":{"line":276,"column":8},"end":{"line":277,"column":191}},{"start":{"line":278,"column":8},"end":{"line":279,"column":187}},{"start":{"line":280,"column":8},"end":{"line":281,"column":185}},{"start":{"line":282,"column":8},"end":{"line":283,"column":199}},{"start":{"line":284,"column":8},"end":{"line":285,"column":189}},{"start":{"line":286,"column":8},"end":{"line":287,"column":197}},{"start":{"line":288,"column":8},"end":{"line":289,"column":185}},{"start":{"line":290,"column":8},"end":{"line":291,"column":187}},{"start":{"line":292,"column":8},"end":{"line":293,"column":189}},{"start":{"line":294,"column":8},"end":{"line":295,"column":183}},{"start":{"line":296,"column":8},"end":{"line":297,"column":185}},{"start":{"line":298,"column":8},"end":{"line":299,"column":197}},{"start":{"line":300,"column":8},"end":{"line":301,"column":187}},{"start":{"line":302,"column":8},"end":{"line":303,"column":193}},{"start":{"line":304,"column":8},"end":{"line":305,"column":191}},{"start":{"line":306,"column":8},"end":{"line":307,"column":191}},{"start":{"line":308,"column":8},"end":{"line":309,"column":181}},{"start":{"line":310,"column":8},"end":{"line":311,"column":183}},{"start":{"line":312,"column":8},"end":{"line":313,"column":185}},{"start":{"line":314,"column":8},"end":{"line":315,"column":197}},{"start":{"line":316,"column":8},"end":{"line":317,"column":197}},{"start":{"line":318,"column":8},"end":{"line":319,"column":191}},{"start":{"line":320,"column":8},"end":{"line":321,"column":189}},{"start":{"line":322,"column":8},"end":{"line":323,"column":193}},{"start":{"line":324,"column":8},"end":{"line":325,"column":189}},{"start":{"line":326,"column":8},"end":{"line":327,"column":195}},{"start":{"line":328,"column":8},"end":{"line":329,"column":189}},{"start":{"line":330,"column":8},"end":{"line":331,"column":179}},{"start":{"line":332,"column":8},"end":{"line":333,"column":183}},{"start":{"line":334,"column":8},"end":{"line":335,"column":179}},{"start":{"line":336,"column":8},"end":{"line":337,"column":183}},{"start":{"line":338,"column":8},"end":{"line":339,"column":193}},{"start":{"line":340,"column":8},"end":{"line":341,"column":183}},{"start":{"line":342,"column":8},"end":{"line":343,"column":203}},{"start":{"line":344,"column":8},"end":{"line":345,"column":185}},{"start":{"line":346,"column":8},"end":{"line":347,"column":187}},{"start":{"line":348,"column":8},"end":{"line":349,"column":189}},{"start":{"line":350,"column":8},"end":{"line":351,"column":189}},{"start":{"line":352,"column":8},"end":{"line":353,"column":185}},{"start":{"line":354,"column":8},"end":{"line":355,"column":187}},{"start":{"line":356,"column":8},"end":{"line":357,"column":187}},{"start":{"line":358,"column":8},"end":{"line":359,"column":195}},{"start":{"line":360,"column":8},"end":{"line":361,"column":183}},{"start":{"line":362,"column":8},"end":{"line":363,"column":183}},{"start":{"line":364,"column":8},"end":{"line":365,"column":183}},{"start":{"line":366,"column":8},"end":{"line":367,"column":185}},{"start":{"line":368,"column":8},"end":{"line":369,"column":187}},{"start":{"line":370,"column":8},"end":{"line":371,"column":189}},{"start":{"line":372,"column":8},"end":{"line":373,"column":189}},{"start":{"line":374,"column":8},"end":{"line":375,"column":191}},{"start":{"line":376,"column":8},"end":{"line":377,"column":187}},{"start":{"line":378,"column":8},"end":{"line":379,"column":201}},{"start":{"line":380,"column":8},"end":{"line":381,"column":185}},{"start":{"line":382,"column":8},"end":{"line":383,"column":183}},{"start":{"line":384,"column":8},"end":{"line":385,"column":183}},{"start":{"line":386,"column":8},"end":{"line":387,"column":183}},{"start":{"line":388,"column":8},"end":{"line":389,"column":189}},{"start":{"line":390,"column":8},"end":{"line":391,"column":181}},{"start":{"line":392,"column":8},"end":{"line":393,"column":185}},{"start":{"line":394,"column":8},"end":{"line":395,"column":197}},{"start":{"line":396,"column":8},"end":{"line":397,"column":185}},{"start":{"line":398,"column":8},"end":{"line":399,"column":187}},{"start":{"line":400,"column":8},"end":{"line":401,"column":193}},{"start":{"line":402,"column":8},"end":{"line":403,"column":204}},{"start":{"line":404,"column":8},"end":{"line":405,"column":191}},{"start":{"line":406,"column":8},"end":{"line":407,"column":185}},{"start":{"line":408,"column":8},"end":{"line":409,"column":183}},{"start":{"line":410,"column":8},"end":{"line":411,"column":189}},{"start":{"line":412,"column":8},"end":{"line":413,"column":181}},{"start":{"line":414,"column":8},"end":{"line":415,"column":189}},{"start":{"line":416,"column":8},"end":{"line":417,"column":189}},{"start":{"line":418,"column":8},"end":{"line":419,"column":195}}],"line":73}},"s":{"0":2,"1":2,"2":4,"3":2,"4":16,"5":1,"6":2,"7":2,"8":2,"9":2,"10":8,"11":1,"12":0,"13":1,"14":1,"15":1,"16":1,"17":1,"18":0,"19":1,"20":0,"21":1,"22":1,"23":0,"24":1,"25":1,"26":1,"27":0,"28":0,"29":0,"30":0,"31":0,"32":1,"33":1,"34":1,"35":1,"36":2,"37":2,"38":2,"39":2,"40":1,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":0,"164":0,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"187":0,"188":0,"189":0,"190":0,"191":0,"192":0,"193":0,"194":0,"195":0,"196":0,"197":1,"198":1,"199":0,"200":0,"201":0,"202":0,"203":0,"204":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"211":0,"212":0,"213":0,"214":0,"215":0,"216":0,"217":0,"218":0,"219":0,"220":0,"221":0,"222":0,"223":0,"224":0,"225":0,"226":0,"227":0,"228":0,"229":0,"230":0,"231":0,"232":0,"233":0,"234":0,"235":0,"236":0,"237":0,"238":0,"239":0,"240":0,"241":0,"242":0,"243":0,"244":0,"245":0,"246":0,"247":0,"248":0,"249":0,"250":0,"251":0,"252":0,"253":0,"254":0,"255":0,"256":0,"257":0,"258":0,"259":0,"260":0,"261":0,"262":0,"263":0,"264":0,"265":0,"266":0,"267":0,"268":0,"269":0,"270":0,"271":0,"272":0,"273":0,"274":0,"275":0,"276":0,"277":0,"278":0,"279":0,"280":0,"281":0,"282":0,"283":0,"284":0,"285":0,"286":0,"287":0,"288":0,"289":0,"290":0,"291":0,"292":0,"293":0,"294":0,"295":0,"296":0,"297":0,"298":0,"299":0,"300":0,"301":0,"302":0,"303":0,"304":0,"305":0,"306":0,"307":0,"308":0,"309":0,"310":0,"311":0,"312":0,"313":0,"314":0,"315":0,"316":0,"317":0,"318":0,"319":0,"320":0,"321":0,"322":0,"323":0,"324":0,"325":0,"326":0,"327":0,"328":0,"329":0,"330":0,"331":0,"332":0,"333":0,"334":0,"335":0,"336":0,"337":0,"338":0,"339":0,"340":0,"341":0,"342":0,"343":0,"344":0,"345":0,"346":0,"347":0,"348":0,"349":0,"350":0,"351":0,"352":0,"353":0,"354":0,"355":0,"356":0,"357":0,"358":0,"359":0,"360":0,"361":0,"362":0,"363":0,"364":0,"365":0,"366":0,"367":0,"368":0,"369":0,"370":0,"371":0,"372":0,"373":0,"374":0,"375":0,"376":0,"377":0,"378":0,"379":0,"380":0,"381":0,"382":0,"383":0,"384":0,"385":0,"386":0,"387":2},"f":{"0":2,"1":16,"2":1,"3":8,"4":1,"5":1,"6":1,"7":1,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":1,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":0,"164":0,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0},"b":{"0":[0,8],"1":[8,8],"2":[0,1],"3":[0,1],"4":[0,1],"5":[1,1,1],"6":[0,1],"7":[1,1,1],"8":[0,1],"9":[1,1],"10":[1,1],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0,0],"16":[1,0],"17":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/hljs.js"],"sourcesContent":["import hljs from 'hljs9/lib/highlight';\nimport clean from 'hljs9/lib/languages/clean';\nimport javascript from 'hljs9/lib/languages/javascript';\nimport markdown from 'hljs9/lib/languages/markdown';\n\nhljs.registerLanguage('markdown', markdown);\nhljs.registerLanguage('clean', clean);\nhljs.registerLanguage('javascript', javascript);\n\nexport const register = async (lang) => {\n\tswitch (lang) {\n\t\tcase 'onec':\n\t\t\treturn hljs.registerLanguage('onec', (await import('hljs9/lib/languages/1c')).default);\n\t\tcase 'abnf':\n\t\t\treturn hljs.registerLanguage('abnf', (await import('hljs9/lib/languages/abnf')).default);\n\t\tcase 'accesslog':\n\t\t\treturn hljs.registerLanguage('accesslog', (await import('hljs9/lib/languages/accesslog')).default);\n\t\tcase 'actionscript':\n\t\t\treturn hljs.registerLanguage('actionscript', (await import('hljs9/lib/languages/actionscript')).default);\n\t\tcase 'ada':\n\t\t\treturn hljs.registerLanguage('ada', (await import('hljs9/lib/languages/ada')).default);\n\t\tcase 'apache':\n\t\t\treturn hljs.registerLanguage('apache', (await import('hljs9/lib/languages/apache')).default);\n\t\tcase 'applescript':\n\t\t\treturn hljs.registerLanguage('applescript', (await import('hljs9/lib/languages/applescript')).default);\n\t\tcase 'arduino':\n\t\t\treturn hljs.registerLanguage('arduino', (await import('hljs9/lib/languages/arduino')).default);\n\t\tcase 'armasm':\n\t\t\treturn hljs.registerLanguage('armasm', (await import('hljs9/lib/languages/armasm')).default);\n\t\tcase 'asciidoc':\n\t\t\treturn hljs.registerLanguage('asciidoc', (await import('hljs9/lib/languages/asciidoc')).default);\n\t\tcase 'aspectj':\n\t\t\treturn hljs.registerLanguage('aspectj', (await import('hljs9/lib/languages/aspectj')).default);\n\t\tcase 'autohotkey':\n\t\t\treturn hljs.registerLanguage('autohotkey', (await import('hljs9/lib/languages/autohotkey')).default);\n\t\tcase 'autoit':\n\t\t\treturn hljs.registerLanguage('autoit', (await import('hljs9/lib/languages/autoit')).default);\n\t\tcase 'avrasm':\n\t\t\treturn hljs.registerLanguage('avrasm', (await import('hljs9/lib/languages/avrasm')).default);\n\t\tcase 'awk':\n\t\t\treturn hljs.registerLanguage('awk', (await import('hljs9/lib/languages/awk')).default);\n\t\tcase 'axapta':\n\t\t\treturn hljs.registerLanguage('axapta', (await import('hljs9/lib/languages/axapta')).default);\n\t\tcase 'bash':\n\t\t\treturn hljs.registerLanguage('bash', (await import('hljs9/lib/languages/bash')).default);\n\t\tcase 'basic':\n\t\t\treturn hljs.registerLanguage('basic', (await import('hljs9/lib/languages/basic')).default);\n\t\tcase 'bnf':\n\t\t\treturn hljs.registerLanguage('bnf', (await import('hljs9/lib/languages/bnf')).default);\n\t\tcase 'brainfuck':\n\t\t\treturn hljs.registerLanguage('brainfuck', (await import('hljs9/lib/languages/brainfuck')).default);\n\t\tcase 'cal':\n\t\t\treturn hljs.registerLanguage('cal', (await import('hljs9/lib/languages/cal')).default);\n\t\tcase 'capnproto':\n\t\t\treturn hljs.registerLanguage('capnproto', (await import('hljs9/lib/languages/capnproto')).default);\n\t\tcase 'ceylon':\n\t\t\treturn hljs.registerLanguage('ceylon', (await import('hljs9/lib/languages/ceylon')).default);\n\t\tcase 'clean':\n\t\t\treturn hljs.registerLanguage('clean', (await import('hljs9/lib/languages/clean')).default);\n\t\tcase 'clojure':\n\t\t\treturn hljs.registerLanguage('clojure', (await import('hljs9/lib/languages/clojure')).default);\n\t\tcase 'clojure-repl':\n\t\t\treturn hljs.registerLanguage('clojure-repl', (await import('hljs9/lib/languages/clojure-repl')).default);\n\t\tcase 'cmake':\n\t\t\treturn hljs.registerLanguage('cmake', (await import('hljs9/lib/languages/cmake')).default);\n\t\tcase 'coffeescript':\n\t\t\treturn hljs.registerLanguage('coffeescript', (await import('hljs9/lib/languages/coffeescript')).default);\n\t\tcase 'coq':\n\t\t\treturn hljs.registerLanguage('coq', (await import('hljs9/lib/languages/coq')).default);\n\t\tcase 'cos':\n\t\t\treturn hljs.registerLanguage('cos', (await import('hljs9/lib/languages/cos')).default);\n\t\tcase 'cpp':\n\t\t\treturn hljs.registerLanguage('cpp', (await import('hljs9/lib/languages/cpp')).default);\n\t\tcase 'crmsh':\n\t\t\treturn hljs.registerLanguage('crmsh', (await import('hljs9/lib/languages/crmsh')).default);\n\t\tcase 'crystal':\n\t\t\treturn hljs.registerLanguage('crystal', (await import('hljs9/lib/languages/crystal')).default);\n\t\tcase 'cs':\n\t\t\treturn hljs.registerLanguage('cs', (await import('hljs9/lib/languages/cs')).default);\n\t\tcase 'csp':\n\t\t\treturn hljs.registerLanguage('csp', (await import('hljs9/lib/languages/csp')).default);\n\t\tcase 'css':\n\t\t\treturn hljs.registerLanguage('css', (await import('hljs9/lib/languages/css')).default);\n\t\tcase 'd':\n\t\t\treturn hljs.registerLanguage('d', (await import('hljs9/lib/languages/d')).default);\n\t\tcase 'dart':\n\t\t\treturn hljs.registerLanguage('dart', (await import('hljs9/lib/languages/dart')).default);\n\t\tcase 'delphi':\n\t\t\treturn hljs.registerLanguage('delphi', (await import('hljs9/lib/languages/delphi')).default);\n\t\tcase 'diff':\n\t\t\treturn hljs.registerLanguage('diff', (await import('hljs9/lib/languages/diff')).default);\n\t\tcase 'django':\n\t\t\treturn hljs.registerLanguage('django', (await import('hljs9/lib/languages/django')).default);\n\t\tcase 'dns':\n\t\t\treturn hljs.registerLanguage('dns', (await import('hljs9/lib/languages/dns')).default);\n\t\tcase 'dockerfile':\n\t\t\treturn hljs.registerLanguage('dockerfile', (await import('hljs9/lib/languages/dockerfile')).default);\n\t\tcase 'dos':\n\t\t\treturn hljs.registerLanguage('dos', (await import('hljs9/lib/languages/dos')).default);\n\t\tcase 'dsconfig':\n\t\t\treturn hljs.registerLanguage('dsconfig', (await import('hljs9/lib/languages/dsconfig')).default);\n\t\tcase 'dts':\n\t\t\treturn hljs.registerLanguage('dts', (await import('hljs9/lib/languages/dts')).default);\n\t\tcase 'dust':\n\t\t\treturn hljs.registerLanguage('dust', (await import('hljs9/lib/languages/dust')).default);\n\t\tcase 'ebnf':\n\t\t\treturn hljs.registerLanguage('ebnf', (await import('hljs9/lib/languages/ebnf')).default);\n\t\tcase 'elixir':\n\t\t\treturn hljs.registerLanguage('elixir', (await import('hljs9/lib/languages/elixir')).default);\n\t\tcase 'elm':\n\t\t\treturn hljs.registerLanguage('elm', (await import('hljs9/lib/languages/elm')).default);\n\t\tcase 'erb':\n\t\t\treturn hljs.registerLanguage('erb', (await import('hljs9/lib/languages/erb')).default);\n\t\tcase 'erlang':\n\t\t\treturn hljs.registerLanguage('erlang', (await import('hljs9/lib/languages/erlang')).default);\n\t\tcase 'excel':\n\t\t\treturn hljs.registerLanguage('excel', (await import('hljs9/lib/languages/excel')).default);\n\t\tcase 'fix':\n\t\t\treturn hljs.registerLanguage('fix', (await import('hljs9/lib/languages/fix')).default);\n\t\tcase 'flix':\n\t\t\treturn hljs.registerLanguage('flix', (await import('hljs9/lib/languages/flix')).default);\n\t\tcase 'fortran':\n\t\t\treturn hljs.registerLanguage('fortran', (await import('hljs9/lib/languages/fortran')).default);\n\t\tcase 'fsharp':\n\t\t\treturn hljs.registerLanguage('fsharp', (await import('hljs9/lib/languages/fsharp')).default);\n\t\tcase 'gams':\n\t\t\treturn hljs.registerLanguage('gams', (await import('hljs9/lib/languages/gams')).default);\n\t\tcase 'gauss':\n\t\t\treturn hljs.registerLanguage('gauss', (await import('hljs9/lib/languages/gauss')).default);\n\t\tcase 'gcode':\n\t\t\treturn hljs.registerLanguage('gcode', (await import('hljs9/lib/languages/gcode')).default);\n\t\tcase 'gherkin':\n\t\t\treturn hljs.registerLanguage('gherkin', (await import('hljs9/lib/languages/gherkin')).default);\n\t\tcase 'glsl':\n\t\t\treturn hljs.registerLanguage('glsl', (await import('hljs9/lib/languages/glsl')).default);\n\t\tcase 'go':\n\t\t\treturn hljs.registerLanguage('go', (await import('hljs9/lib/languages/go')).default);\n\t\tcase 'golo':\n\t\t\treturn hljs.registerLanguage('golo', (await import('hljs9/lib/languages/golo')).default);\n\t\tcase 'gradle':\n\t\t\treturn hljs.registerLanguage('gradle', (await import('hljs9/lib/languages/gradle')).default);\n\t\tcase 'groovy':\n\t\t\treturn hljs.registerLanguage('groovy', (await import('hljs9/lib/languages/groovy')).default);\n\t\tcase 'haml':\n\t\t\treturn hljs.registerLanguage('haml', (await import('hljs9/lib/languages/haml')).default);\n\t\tcase 'handlebars':\n\t\t\treturn hljs.registerLanguage('handlebars', (await import('hljs9/lib/languages/handlebars')).default);\n\t\tcase 'haskell':\n\t\t\treturn hljs.registerLanguage('haskell', (await import('hljs9/lib/languages/haskell')).default);\n\t\tcase 'haxe':\n\t\t\treturn hljs.registerLanguage('haxe', (await import('hljs9/lib/languages/haxe')).default);\n\t\tcase 'hsp':\n\t\t\treturn hljs.registerLanguage('hsp', (await import('hljs9/lib/languages/hsp')).default);\n\t\tcase 'htmlbars':\n\t\t\treturn hljs.registerLanguage('htmlbars', (await import('hljs9/lib/languages/htmlbars')).default);\n\t\tcase 'http':\n\t\t\treturn hljs.registerLanguage('http', (await import('hljs9/lib/languages/http')).default);\n\t\tcase 'hy':\n\t\t\treturn hljs.registerLanguage('hy', (await import('hljs9/lib/languages/hy')).default);\n\t\tcase 'inform7':\n\t\t\treturn hljs.registerLanguage('inform7', (await import('hljs9/lib/languages/inform7')).default);\n\t\tcase 'ini':\n\t\t\treturn hljs.registerLanguage('ini', (await import('hljs9/lib/languages/ini')).default);\n\t\tcase 'irpf90':\n\t\t\treturn hljs.registerLanguage('irpf90', (await import('hljs9/lib/languages/irpf90')).default);\n\t\tcase 'java':\n\t\t\treturn hljs.registerLanguage('java', (await import('hljs9/lib/languages/java')).default);\n\t\tcase 'javascript':\n\t\t\treturn hljs.registerLanguage('javascript', (await import('hljs9/lib/languages/javascript')).default);\n\t\tcase 'jboss-cli':\n\t\t\treturn hljs.registerLanguage('jboss-cli', (await import('hljs9/lib/languages/jboss-cli')).default);\n\t\tcase 'json':\n\t\t\treturn hljs.registerLanguage('json', (await import('hljs9/lib/languages/json')).default);\n\t\tcase 'julia':\n\t\t\treturn hljs.registerLanguage('julia', (await import('hljs9/lib/languages/julia')).default);\n\t\tcase 'julia-repl':\n\t\t\treturn hljs.registerLanguage('julia-repl', (await import('hljs9/lib/languages/julia-repl')).default);\n\t\tcase 'kotlin':\n\t\t\treturn hljs.registerLanguage('kotlin', (await import('hljs9/lib/languages/kotlin')).default);\n\t\tcase 'lasso':\n\t\t\treturn hljs.registerLanguage('lasso', (await import('hljs9/lib/languages/lasso')).default);\n\t\tcase 'ldif':\n\t\t\treturn hljs.registerLanguage('ldif', (await import('hljs9/lib/languages/ldif')).default);\n\t\tcase 'leaf':\n\t\t\treturn hljs.registerLanguage('leaf', (await import('hljs9/lib/languages/leaf')).default);\n\t\tcase 'less':\n\t\t\treturn hljs.registerLanguage('less', (await import('hljs9/lib/languages/less')).default);\n\t\tcase 'lisp':\n\t\t\treturn hljs.registerLanguage('lisp', (await import('hljs9/lib/languages/lisp')).default);\n\t\tcase 'livecodeserver':\n\t\t\treturn hljs.registerLanguage('livecodeserver', (await import('hljs9/lib/languages/livecodeserver')).default);\n\t\tcase 'livescript':\n\t\t\treturn hljs.registerLanguage('livescript', (await import('hljs9/lib/languages/livescript')).default);\n\t\tcase 'llvm':\n\t\t\treturn hljs.registerLanguage('llvm', (await import('hljs9/lib/languages/llvm')).default);\n\t\tcase 'lsl':\n\t\t\treturn hljs.registerLanguage('lsl', (await import('hljs9/lib/languages/lsl')).default);\n\t\tcase 'lua':\n\t\t\treturn hljs.registerLanguage('lua', (await import('hljs9/lib/languages/lua')).default);\n\t\tcase 'makefile':\n\t\t\treturn hljs.registerLanguage('makefile', (await import('hljs9/lib/languages/makefile')).default);\n\t\tcase 'markdown':\n\t\t\treturn hljs.registerLanguage('markdown', (await import('hljs9/lib/languages/markdown')).default);\n\t\tcase 'mathematica':\n\t\t\treturn hljs.registerLanguage('mathematica', (await import('hljs9/lib/languages/mathematica')).default);\n\t\tcase 'matlab':\n\t\t\treturn hljs.registerLanguage('matlab', (await import('hljs9/lib/languages/matlab')).default);\n\t\tcase 'maxima':\n\t\t\treturn hljs.registerLanguage('maxima', (await import('hljs9/lib/languages/maxima')).default);\n\t\tcase 'mel':\n\t\t\treturn hljs.registerLanguage('mel', (await import('hljs9/lib/languages/mel')).default);\n\t\tcase 'mercury':\n\t\t\treturn hljs.registerLanguage('mercury', (await import('hljs9/lib/languages/mercury')).default);\n\t\tcase 'mipsasm':\n\t\t\treturn hljs.registerLanguage('mipsasm', (await import('hljs9/lib/languages/mipsasm')).default);\n\t\tcase 'mizar':\n\t\t\treturn hljs.registerLanguage('mizar', (await import('hljs9/lib/languages/mizar')).default);\n\t\tcase 'perl':\n\t\t\treturn hljs.registerLanguage('perl', (await import('hljs9/lib/languages/perl')).default);\n\t\tcase 'mojolicious':\n\t\t\treturn hljs.registerLanguage('mojolicious', (await import('hljs9/lib/languages/mojolicious')).default);\n\t\tcase 'monkey':\n\t\t\treturn hljs.registerLanguage('monkey', (await import('hljs9/lib/languages/monkey')).default);\n\t\tcase 'moonscript':\n\t\t\treturn hljs.registerLanguage('moonscript', (await import('hljs9/lib/languages/moonscript')).default);\n\t\tcase 'n1ql':\n\t\t\treturn hljs.registerLanguage('n1ql', (await import('hljs9/lib/languages/n1ql')).default);\n\t\tcase 'nginx':\n\t\t\treturn hljs.registerLanguage('nginx', (await import('hljs9/lib/languages/nginx')).default);\n\t\tcase 'nimrod':\n\t\t\treturn hljs.registerLanguage('nimrod', (await import('hljs9/lib/languages/nimrod')).default);\n\t\tcase 'nix':\n\t\t\treturn hljs.registerLanguage('nix', (await import('hljs9/lib/languages/nix')).default);\n\t\tcase 'nsis':\n\t\t\treturn hljs.registerLanguage('nsis', (await import('hljs9/lib/languages/nsis')).default);\n\t\tcase 'objectivec':\n\t\t\treturn hljs.registerLanguage('objectivec', (await import('hljs9/lib/languages/objectivec')).default);\n\t\tcase 'ocaml':\n\t\t\treturn hljs.registerLanguage('ocaml', (await import('hljs9/lib/languages/ocaml')).default);\n\t\tcase 'openscad':\n\t\t\treturn hljs.registerLanguage('openscad', (await import('hljs9/lib/languages/openscad')).default);\n\t\tcase 'oxygene':\n\t\t\treturn hljs.registerLanguage('oxygene', (await import('hljs9/lib/languages/oxygene')).default);\n\t\tcase 'parser3':\n\t\t\treturn hljs.registerLanguage('parser3', (await import('hljs9/lib/languages/parser3')).default);\n\t\tcase 'pf':\n\t\t\treturn hljs.registerLanguage('pf', (await import('hljs9/lib/languages/pf')).default);\n\t\tcase 'php':\n\t\t\treturn hljs.registerLanguage('php', (await import('hljs9/lib/languages/php')).default);\n\t\tcase 'pony':\n\t\t\treturn hljs.registerLanguage('pony', (await import('hljs9/lib/languages/pony')).default);\n\t\tcase 'powershell':\n\t\t\treturn hljs.registerLanguage('powershell', (await import('hljs9/lib/languages/powershell')).default);\n\t\tcase 'processing':\n\t\t\treturn hljs.registerLanguage('processing', (await import('hljs9/lib/languages/processing')).default);\n\t\tcase 'profile':\n\t\t\treturn hljs.registerLanguage('profile', (await import('hljs9/lib/languages/profile')).default);\n\t\tcase 'prolog':\n\t\t\treturn hljs.registerLanguage('prolog', (await import('hljs9/lib/languages/prolog')).default);\n\t\tcase 'protobuf':\n\t\t\treturn hljs.registerLanguage('protobuf', (await import('hljs9/lib/languages/protobuf')).default);\n\t\tcase 'puppet':\n\t\t\treturn hljs.registerLanguage('puppet', (await import('hljs9/lib/languages/puppet')).default);\n\t\tcase 'purebasic':\n\t\t\treturn hljs.registerLanguage('purebasic', (await import('hljs9/lib/languages/purebasic')).default);\n\t\tcase 'python':\n\t\t\treturn hljs.registerLanguage('python', (await import('hljs9/lib/languages/python')).default);\n\t\tcase 'q':\n\t\t\treturn hljs.registerLanguage('q', (await import('hljs9/lib/languages/q')).default);\n\t\tcase 'qml':\n\t\t\treturn hljs.registerLanguage('qml', (await import('hljs9/lib/languages/qml')).default);\n\t\tcase 'r':\n\t\t\treturn hljs.registerLanguage('r', (await import('hljs9/lib/languages/r')).default);\n\t\tcase 'rib':\n\t\t\treturn hljs.registerLanguage('rib', (await import('hljs9/lib/languages/rib')).default);\n\t\tcase 'roboconf':\n\t\t\treturn hljs.registerLanguage('roboconf', (await import('hljs9/lib/languages/roboconf')).default);\n\t\tcase 'rsl':\n\t\t\treturn hljs.registerLanguage('rsl', (await import('hljs9/lib/languages/rsl')).default);\n\t\tcase 'ruleslanguage':\n\t\t\treturn hljs.registerLanguage('ruleslanguage', (await import('hljs9/lib/languages/ruleslanguage')).default);\n\t\tcase 'rust':\n\t\t\treturn hljs.registerLanguage('rust', (await import('hljs9/lib/languages/rust')).default);\n\t\tcase 'scala':\n\t\t\treturn hljs.registerLanguage('scala', (await import('hljs9/lib/languages/scala')).default);\n\t\tcase 'scheme':\n\t\t\treturn hljs.registerLanguage('scheme', (await import('hljs9/lib/languages/scheme')).default);\n\t\tcase 'scilab':\n\t\t\treturn hljs.registerLanguage('scilab', (await import('hljs9/lib/languages/scilab')).default);\n\t\tcase 'scss':\n\t\t\treturn hljs.registerLanguage('scss', (await import('hljs9/lib/languages/scss')).default);\n\t\tcase 'shell':\n\t\t\treturn hljs.registerLanguage('shell', (await import('hljs9/lib/languages/shell')).default);\n\t\tcase 'smali':\n\t\t\treturn hljs.registerLanguage('smali', (await import('hljs9/lib/languages/smali')).default);\n\t\tcase 'smalltalk':\n\t\t\treturn hljs.registerLanguage('smalltalk', (await import('hljs9/lib/languages/smalltalk')).default);\n\t\tcase 'sml':\n\t\t\treturn hljs.registerLanguage('sml', (await import('hljs9/lib/languages/sml')).default);\n\t\tcase 'sqf':\n\t\t\treturn hljs.registerLanguage('sqf', (await import('hljs9/lib/languages/sqf')).default);\n\t\tcase 'sql':\n\t\t\treturn hljs.registerLanguage('sql', (await import('hljs9/lib/languages/sql')).default);\n\t\tcase 'stan':\n\t\t\treturn hljs.registerLanguage('stan', (await import('hljs9/lib/languages/stan')).default);\n\t\tcase 'stata':\n\t\t\treturn hljs.registerLanguage('stata', (await import('hljs9/lib/languages/stata')).default);\n\t\tcase 'step21':\n\t\t\treturn hljs.registerLanguage('step21', (await import('hljs9/lib/languages/step21')).default);\n\t\tcase 'stylus':\n\t\t\treturn hljs.registerLanguage('stylus', (await import('hljs9/lib/languages/stylus')).default);\n\t\tcase 'subunit':\n\t\t\treturn hljs.registerLanguage('subunit', (await import('hljs9/lib/languages/subunit')).default);\n\t\tcase 'swift':\n\t\t\treturn hljs.registerLanguage('swift', (await import('hljs9/lib/languages/swift')).default);\n\t\tcase 'taggerscript':\n\t\t\treturn hljs.registerLanguage('taggerscript', (await import('hljs9/lib/languages/taggerscript')).default);\n\t\tcase 'yaml':\n\t\t\treturn hljs.registerLanguage('yaml', (await import('hljs9/lib/languages/yaml')).default);\n\t\tcase 'tap':\n\t\t\treturn hljs.registerLanguage('tap', (await import('hljs9/lib/languages/tap')).default);\n\t\tcase 'tcl':\n\t\t\treturn hljs.registerLanguage('tcl', (await import('hljs9/lib/languages/tcl')).default);\n\t\tcase 'tex':\n\t\t\treturn hljs.registerLanguage('tex', (await import('hljs9/lib/languages/tex')).default);\n\t\tcase 'thrift':\n\t\t\treturn hljs.registerLanguage('thrift', (await import('hljs9/lib/languages/thrift')).default);\n\t\tcase 'tp':\n\t\t\treturn hljs.registerLanguage('tp', (await import('hljs9/lib/languages/tp')).default);\n\t\tcase 'twig':\n\t\t\treturn hljs.registerLanguage('twig', (await import('hljs9/lib/languages/twig')).default);\n\t\tcase 'typescript':\n\t\t\treturn hljs.registerLanguage('typescript', (await import('hljs9/lib/languages/typescript')).default);\n\t\tcase 'vala':\n\t\t\treturn hljs.registerLanguage('vala', (await import('hljs9/lib/languages/vala')).default);\n\t\tcase 'vbnet':\n\t\t\treturn hljs.registerLanguage('vbnet', (await import('hljs9/lib/languages/vbnet')).default);\n\t\tcase 'vbscript':\n\t\t\treturn hljs.registerLanguage('vbscript', (await import('hljs9/lib/languages/vbscript')).default);\n\t\tcase 'vbscript-html':\n\t\t\treturn hljs.registerLanguage('vbscript-html(', (await import('hljs9/lib/languages/vbscript-html')).default);\n\t\tcase 'verilog':\n\t\t\treturn hljs.registerLanguage('verilog', (await import('hljs9/lib/languages/verilog')).default);\n\t\tcase 'vhdl':\n\t\t\treturn hljs.registerLanguage('vhdl', (await import('hljs9/lib/languages/vhdl')).default);\n\t\tcase 'vim':\n\t\t\treturn hljs.registerLanguage('vim', (await import('hljs9/lib/languages/vim')).default);\n\t\tcase 'x86asm':\n\t\t\treturn hljs.registerLanguage('x86asm', (await import('hljs9/lib/languages/x86asm')).default);\n\t\tcase 'xl':\n\t\t\treturn hljs.registerLanguage('xl', (await import('hljs9/lib/languages/xl')).default);\n\t\tcase 'xquery':\n\t\t\treturn hljs.registerLanguage('xquery', (await import('hljs9/lib/languages/xquery')).default);\n\t\tcase 'zephir':\n\t\t\treturn hljs.registerLanguage('zephir', (await import('hljs9/lib/languages/zephir')).default);\n\t\tdefault:\n\t\t\treturn hljs.registerLanguage('plaintext', (await import('hljs9/lib/languages/plaintext')).default);\n\t}\n};\n\nexport default hljs;\n"],"names":["register","hljs","registerLanguage","markdown","clean","javascript","lang","default"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/hljs.js"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"738ae1060348336a9065913ee916923865c6d73c","contentHash":"da2dafb226e16ae4bfdbb973836a5db539201a85579dde0527c4fb10876d9774"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/token.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/token.ts","statementMap":{"0":{"start":{"line":5,"column":0},"end":{"line":7,"column":3}},"1":{"start":{"line":9,"column":4},"end":{"line":12,"column":7}},"2":{"start":{"line":9,"column":24},"end":{"line":12,"column":7}},"3":{"start":{"line":14,"column":0},"end":{"line":24,"column":3}},"4":{"start":{"line":16,"column":8},"end":{"line":16,"column":26}},"5":{"start":{"line":19,"column":8},"end":{"line":19,"column":23}},"6":{"start":{"line":22,"column":8},"end":{"line":22,"column":37}},"7":{"start":{"line":25,"column":16},"end":{"line":25,"column":46}},"8":{"start":{"line":26,"column":19},"end":{"line":40,"column":1}},"9":{"start":{"line":27,"column":4},"end":{"line":29,"column":5}},"10":{"start":{"line":28,"column":8},"end":{"line":28,"column":28}},"11":{"start":{"line":30,"column":18},"end":{"line":30,"column":48}},"12":{"start":{"line":31,"column":4},"end":{"line":38,"column":7}},"13":{"start":{"line":39,"column":4},"end":{"line":39,"column":17}},"14":{"start":{"line":41,"column":16},"end":{"line":41,"column":64}},"15":{"start":{"line":41,"column":23},"end":{"line":41,"column":64}},"16":{"start":{"line":42,"column":30},"end":{"line":47,"column":1}},"17":{"start":{"line":44,"column":19},"end":{"line":44,"column":59}},"18":{"start":{"line":45,"column":24},"end":{"line":45,"column":176}},"19":{"start":{"line":45,"column":146},"end":{"line":45,"column":168}},"20":{"start":{"line":46,"column":4},"end":{"line":46,"column":116}},"21":{"start":{"line":46,"column":66},"end":{"line":46,"column":114}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":8,"column":9},"end":{"line":8,"column":16}},"loc":{"start":{"line":8,"column":30},"end":{"line":13,"column":1}},"line":8},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":16},"end":{"line":15,"column":17}},"loc":{"start":{"line":15,"column":27},"end":{"line":17,"column":5}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":18,"column":13},"end":{"line":18,"column":14}},"loc":{"start":{"line":18,"column":24},"end":{"line":20,"column":5}},"line":18},"3":{"name":"(anonymous_3)","decl":{"start":{"line":21,"column":27},"end":{"line":21,"column":28}},"loc":{"start":{"line":21,"column":38},"end":{"line":23,"column":5}},"line":21},"4":{"name":"(anonymous_4)","decl":{"start":{"line":26,"column":19},"end":{"line":26,"column":20}},"loc":{"start":{"line":26,"column":49},"end":{"line":40,"column":1}},"line":26},"5":{"name":"(anonymous_5)","decl":{"start":{"line":41,"column":16},"end":{"line":41,"column":17}},"loc":{"start":{"line":41,"column":23},"end":{"line":41,"column":64}},"line":41},"6":{"name":"(anonymous_6)","decl":{"start":{"line":42,"column":30},"end":{"line":42,"column":31}},"loc":{"start":{"line":42,"column":60},"end":{"line":47,"column":1}},"line":42},"7":{"name":"(anonymous_7)","decl":{"start":{"line":45,"column":133},"end":{"line":45,"column":134}},"loc":{"start":{"line":45,"column":146},"end":{"line":45,"column":168}},"line":45},"8":{"name":"(anonymous_8)","decl":{"start":{"line":46,"column":57},"end":{"line":46,"column":58}},"loc":{"start":{"line":46,"column":66},"end":{"line":46,"column":114}},"line":46}},"branchMap":{"0":{"loc":{"start":{"line":27,"column":4},"end":{"line":29,"column":5}},"type":"if","locations":[{"start":{"line":27,"column":4},"end":{"line":29,"column":5}},{"start":{"line":27,"column":4},"end":{"line":29,"column":5}}],"line":27},"1":{"loc":{"start":{"line":35,"column":11},"end":{"line":37,"column":9}},"type":"binary-expr","locations":[{"start":{"line":35,"column":11},"end":{"line":35,"column":16}},{"start":{"line":35,"column":20},"end":{"line":37,"column":9}}],"line":35},"2":{"loc":{"start":{"line":44,"column":19},"end":{"line":44,"column":59}},"type":"binary-expr","locations":[{"start":{"line":44,"column":19},"end":{"line":44,"column":53}},{"start":{"line":44,"column":57},"end":{"line":44,"column":59}}],"line":44},"3":{"loc":{"start":{"line":45,"column":24},"end":{"line":45,"column":176}},"type":"binary-expr","locations":[{"start":{"line":45,"column":25},"end":{"line":45,"column":169}},{"start":{"line":45,"column":174},"end":{"line":45,"column":176}}],"line":45},"4":{"loc":{"start":{"line":45,"column":25},"end":{"line":45,"column":169}},"type":"cond-expr","locations":[{"start":{"line":45,"column":101},"end":{"line":45,"column":107}},{"start":{"line":45,"column":110},"end":{"line":45,"column":169}}],"line":45},"5":{"loc":{"start":{"line":45,"column":25},"end":{"line":45,"column":98}},"type":"binary-expr","locations":[{"start":{"line":45,"column":25},"end":{"line":45,"column":68}},{"start":{"line":45,"column":72},"end":{"line":45,"column":98}}],"line":45},"6":{"loc":{"start":{"line":46,"column":11},"end":{"line":46,"column":115}},"type":"binary-expr","locations":[{"start":{"line":46,"column":11},"end":{"line":46,"column":35}},{"start":{"line":46,"column":39},"end":{"line":46,"column":115}}],"line":46},"7":{"loc":{"start":{"line":46,"column":66},"end":{"line":46,"column":114}},"type":"binary-expr","locations":[{"start":{"line":46,"column":66},"end":{"line":46,"column":76}},{"start":{"line":46,"column":80},"end":{"line":46,"column":114}}],"line":46}},"s":{"0":2,"1":2,"2":6,"3":2,"4":44,"5":26,"6":0,"7":2,"8":2,"9":44,"10":18,"11":44,"12":44,"13":44,"14":2,"15":26,"16":2,"17":0,"18":0,"19":0,"20":0,"21":0},"f":{"0":2,"1":44,"2":26,"3":0,"4":44,"5":26,"6":0,"7":0,"8":0},"b":{"0":[18,26],"1":[44,18],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/token.ts"],"sourcesContent":["/*\n * Markdown is a named function that will parse markdown syntax\n * @param {String} msg - The message html\n */\nimport type { IMessage, TokenType, TokenExtra } from '@rocket.chat/core-typings';\nimport { Random } from '@rocket.chat/random';\n\nexport const addAsToken = (message: IMessage, html: string, type: TokenType, extra?: TokenExtra): string => {\n\tif (!message.tokens) {\n\t\tmessage.tokens = [];\n\t}\n\tconst token = `=!=${Random.id()}=!=`;\n\tmessage.tokens.push({\n\t\ttoken,\n\t\ttype,\n\t\ttext: html,\n\t\t...(extra && { ...extra }),\n\t});\n\n\treturn token;\n};\n\nexport const isToken = (msg: string): boolean => /=!=[.a-z0-9]{17}=!=/gim.test(msg.trim());\n\nexport const validateAllowedTokens = (message: IMessage, id: string, desiredTokens: TokenType[]): boolean => {\n\tconst tokens: string[] = id.match(/=!=[.a-z0-9]{17}=!=/gim) || [];\n\tconst tokensFound = message.tokens?.filter(({ token }) => tokens.includes(token)) || [];\n\treturn tokensFound.length === 0 || tokensFound.every((token) => token.type && desiredTokens.includes(token.type));\n};\n"],"names":["addAsToken","isToken","validateAllowedTokens","message","html","type","extra","tokens","token","Random","id","push","text","msg","test","trim","desiredTokens","match","tokensFound","filter","includes","length","every"],"mappings":"AAAA;;;CAGC;;;;;;;;;;;IAIYA,UAAU;eAAVA;;IAeAC,OAAO;eAAPA;;IAEAC,qBAAqB;eAArBA;;;wBAnBU;AAEhB,MAAMF,aAAa,CAACG,SAAmBC,MAAcC,MAAiBC;IAC5E,IAAI,CAACH,QAAQI,MAAM,EAAE;QACpBJ,QAAQI,MAAM,GAAG,EAAE;IACpB;IACA,MAAMC,QAAQ,CAAC,GAAG,EAAEC,cAAM,CAACC,EAAE,GAAG,GAAG,CAAC;IACpCP,QAAQI,MAAM,CAACI,IAAI,CAAC;QACnBH;QACAH;QACAO,MAAMR;QACN,GAAIE,SAAS;YAAE,GAAGA,KAAK;QAAC,CAAC;IAC1B;IAEA,OAAOE;AACR;AAEO,MAAMP,UAAU,CAACY,MAAyB,yBAAyBC,IAAI,CAACD,IAAIE,IAAI;AAEhF,MAAMb,wBAAwB,CAACC,SAAmBO,IAAYM;QAEhDb;IADpB,MAAMI,SAAmBG,GAAGO,KAAK,CAAC,6BAA6B,EAAE;IACjE,MAAMC,cAAcf,EAAAA,kBAAAA,QAAQI,MAAM,cAAdJ,sCAAAA,gBAAgBgB,MAAM,CAAC,CAAC,EAAEX,KAAK,EAAE,GAAKD,OAAOa,QAAQ,CAACZ,YAAW,EAAE;IACvF,OAAOU,YAAYG,MAAM,KAAK,KAAKH,YAAYI,KAAK,CAAC,CAACd,QAAUA,MAAMH,IAAI,IAAIW,cAAcI,QAAQ,CAACZ,MAAMH,IAAI;AAChH","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/token.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"1daf671d4369d2a3611c4220c160b66d505d9327","contentHash":"b9b4662f3693adf5ab64dd0abbbd4df0f3ab136401e34eba38073cb8b601244d"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/original.js":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/original.js","statementMap":{"0":{"start":{"line":5,"column":0},"end":{"line":7,"column":3}},"1":{"start":{"line":8,"column":0},"end":{"line":13,"column":3}},"2":{"start":{"line":11,"column":8},"end":{"line":11,"column":24}},"3":{"start":{"line":14,"column":14},"end":{"line":14,"column":34}},"4":{"start":{"line":15,"column":18},"end":{"line":15,"column":42}},"5":{"start":{"line":16,"column":17},"end":{"line":27,"column":1}},"6":{"start":{"line":21,"column":4},"end":{"line":21,"column":39}},"7":{"start":{"line":23,"column":4},"end":{"line":23,"column":56}},"8":{"start":{"line":25,"column":4},"end":{"line":25,"column":56}},"9":{"start":{"line":26,"column":4},"end":{"line":26,"column":19}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":10,"column":9},"end":{"line":10,"column":10}},"loc":{"start":{"line":10,"column":20},"end":{"line":12,"column":5}},"line":10},"1":{"name":"(anonymous_1)","decl":{"start":{"line":16,"column":17},"end":{"line":16,"column":18}},"loc":{"start":{"line":19,"column":4},"end":{"line":27,"column":1}},"line":19}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":27},"end":{"line":19,"column":1}},"type":"default-arg","locations":[{"start":{"line":16,"column":37},"end":{"line":19,"column":1}}],"line":16}},"s":{"0":2,"1":2,"2":2,"3":2,"4":2,"5":2,"6":254,"7":254,"8":254,"9":254},"f":{"0":2,"1":254},"b":{"0":[254]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/original.js"],"sourcesContent":["/*\n * Markdown is a named function that will parse markdown syntax\n * @param {Object} message - The message object\n */\nimport { code } from './code.js';\nimport { markdown } from './markdown.js';\n\nexport const original = (\n\tmessage,\n\toptions = {\n\t\tsupportSchemesForLink: 'http,https',\n\t\theaders: true,\n\t},\n) => {\n\t// Parse markdown code\n\tmessage = code(message);\n\n\t// Parse markdown\n\tmessage = markdown(message, options);\n\n\t// Replace linebreak to br\n\tmessage.html = message.html.replace(/\\n/gm, '<br>');\n\n\treturn message;\n};\n"],"names":["original","message","options","supportSchemesForLink","headers","code","markdown","html","replace"],"mappings":"AAAA;;;CAGC;;;;+BAIYA;;;eAAAA;;;sBAHQ;0BACI;AAElB,MAAMA,WAAW,CACvBC,SACAC,UAAU;IACTC,uBAAuB;IACvBC,SAAS;AACV,CAAC;IAED,sBAAsB;IACtBH,UAAUI,IAAAA,UAAI,EAACJ;IAEf,iBAAiB;IACjBA,UAAUK,IAAAA,kBAAQ,EAACL,SAASC;IAE5B,0BAA0B;IAC1BD,QAAQM,IAAI,GAAGN,QAAQM,IAAI,CAACC,OAAO,CAAC,QAAQ;IAE5C,OAAOP;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/original.js"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"1a5887826b9f7029d52f782556dd3ed013a52c44","contentHash":"772bf14cabda52812eb86cd361ec622e8121533265e237895f86e033b3e2e9fb"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/markdown.js":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/markdown.js","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":24}},"3":{"start":{"line":11,"column":15},"end":{"line":11,"column":33}},"4":{"start":{"line":12,"column":20},"end":{"line":28,"column":1}},"5":{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},"6":{"start":{"line":15,"column":173},"end":{"line":15,"column":198}},"7":{"start":{"line":16,"column":8},"end":{"line":16,"column":21}},"8":{"start":{"line":19,"column":4},"end":{"line":21,"column":5}},"9":{"start":{"line":20,"column":8},"end":{"line":20,"column":21}},"10":{"start":{"line":22,"column":4},"end":{"line":27,"column":5}},"11":{"start":{"line":23,"column":8},"end":{"line":23,"column":21}},"12":{"start":{"line":24,"column":8},"end":{"line":24,"column":20}},"13":{"start":{"line":26,"column":8},"end":{"line":26,"column":21}},"14":{"start":{"line":29,"column":27},"end":{"line":29,"column":78}},"15":{"start":{"line":29,"column":35},"end":{"line":29,"column":78}},"16":{"start":{"line":30,"column":33},"end":{"line":33,"column":1}},"17":{"start":{"line":31,"column":26},"end":{"line":31,"column":50}},"18":{"start":{"line":32,"column":4},"end":{"line":32,"column":63}},"19":{"start":{"line":34,"column":23},"end":{"line":34,"column":228}},"20":{"start":{"line":34,"column":42},"end":{"line":34,"column":228}},"21":{"start":{"line":34,"column":82},"end":{"line":34,"column":228}},"22":{"start":{"line":35,"column":25},"end":{"line":38,"column":5}},"23":{"start":{"line":35,"column":54},"end":{"line":38,"column":5}},"24":{"start":{"line":36,"column":24},"end":{"line":36,"column":55}},"25":{"start":{"line":37,"column":8},"end":{"line":37,"column":98}},"26":{"start":{"line":37,"column":22},"end":{"line":37,"column":97}},"27":{"start":{"line":37,"column":63},"end":{"line":37,"column":96}},"28":{"start":{"line":39,"column":34},"end":{"line":45,"column":92}},"29":{"start":{"line":40,"column":4},"end":{"line":42,"column":5}},"30":{"start":{"line":41,"column":8},"end":{"line":41,"column":21}},"31":{"start":{"line":43,"column":29},"end":{"line":43,"column":61}},"32":{"start":{"line":44,"column":4},"end":{"line":44,"column":87}},"33":{"start":{"line":45,"column":13},"end":{"line":45,"column":91}},"34":{"start":{"line":46,"column":18},"end":{"line":46,"column":58}},"35":{"start":{"line":47,"column":20},"end":{"line":47,"column":60}},"36":{"start":{"line":48,"column":20},"end":{"line":54,"column":114}},"37":{"start":{"line":49,"column":4},"end":{"line":51,"column":5}},"38":{"start":{"line":50,"column":8},"end":{"line":50,"column":21}},"39":{"start":{"line":52,"column":29},"end":{"line":52,"column":61}},"40":{"start":{"line":53,"column":4},"end":{"line":53,"column":87}},"41":{"start":{"line":54,"column":7},"end":{"line":54,"column":102}},"42":{"start":{"line":55,"column":24},"end":{"line":139,"column":1}},"43":{"start":{"line":56,"column":14},"end":{"line":56,"column":26}},"44":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"45":{"start":{"line":58,"column":8},"end":{"line":58,"column":28}},"46":{"start":{"line":60,"column":20},"end":{"line":60,"column":70}},"47":{"start":{"line":61,"column":4},"end":{"line":70,"column":5}},"48":{"start":{"line":63,"column":8},"end":{"line":63,"column":145}},"49":{"start":{"line":65,"column":8},"end":{"line":65,"column":146}},"50":{"start":{"line":67,"column":8},"end":{"line":67,"column":147}},"51":{"start":{"line":69,"column":8},"end":{"line":69,"column":148}},"52":{"start":{"line":72,"column":4},"end":{"line":72,"column":25}},"53":{"start":{"line":74,"column":4},"end":{"line":74,"column":27}},"54":{"start":{"line":76,"column":4},"end":{"line":76,"column":27}},"55":{"start":{"line":81,"column":4},"end":{"line":81,"column":225}},"56":{"start":{"line":83,"column":4},"end":{"line":83,"column":148}},"57":{"start":{"line":85,"column":4},"end":{"line":85,"column":149}},"58":{"start":{"line":86,"column":4},"end":{"line":86,"column":62}},"59":{"start":{"line":88,"column":4},"end":{"line":88,"column":83}},"60":{"start":{"line":90,"column":4},"end":{"line":104,"column":7}},"61":{"start":{"line":91,"column":8},"end":{"line":93,"column":9}},"62":{"start":{"line":92,"column":12},"end":{"line":92,"column":25}},"63":{"start":{"line":94,"column":8},"end":{"line":100,"column":9}},"64":{"start":{"line":99,"column":12},"end":{"line":99,"column":25}},"65":{"start":{"line":101,"column":8},"end":{"line":101,"column":29}},"66":{"start":{"line":102,"column":23},"end":{"line":102,"column":65}},"67":{"start":{"line":103,"column":8},"end":{"line":103,"column":233}},"68":{"start":{"line":106,"column":4},"end":{"line":121,"column":7}},"69":{"start":{"line":107,"column":8},"end":{"line":109,"column":9}},"70":{"start":{"line":108,"column":12},"end":{"line":108,"column":25}},"71":{"start":{"line":110,"column":8},"end":{"line":116,"column":9}},"72":{"start":{"line":115,"column":12},"end":{"line":115,"column":25}},"73":{"start":{"line":117,"column":23},"end":{"line":117,"column":65}},"74":{"start":{"line":118,"column":8},"end":{"line":118,"column":45}},"75":{"start":{"line":119,"column":27},"end":{"line":119,"column":41}},"76":{"start":{"line":120,"column":8},"end":{"line":120,"column":167}},"77":{"start":{"line":123,"column":4},"end":{"line":137,"column":7}},"78":{"start":{"line":124,"column":8},"end":{"line":126,"column":9}},"79":{"start":{"line":125,"column":12},"end":{"line":125,"column":25}},"80":{"start":{"line":127,"column":8},"end":{"line":133,"column":9}},"81":{"start":{"line":132,"column":12},"end":{"line":132,"column":25}},"82":{"start":{"line":134,"column":8},"end":{"line":134,"column":29}},"83":{"start":{"line":135,"column":23},"end":{"line":135,"column":65}},"84":{"start":{"line":136,"column":8},"end":{"line":136,"column":153}},"85":{"start":{"line":138,"column":4},"end":{"line":138,"column":15}},"86":{"start":{"line":140,"column":17},"end":{"line":143,"column":1}},"87":{"start":{"line":141,"column":4},"end":{"line":141,"column":53}},"88":{"start":{"line":142,"column":4},"end":{"line":142,"column":19}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":20},"end":{"line":12,"column":21}},"loc":{"start":{"line":12,"column":36},"end":{"line":28,"column":1}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":164},"end":{"line":15,"column":165}},"loc":{"start":{"line":15,"column":173},"end":{"line":15,"column":198}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":29,"column":27},"end":{"line":29,"column":28}},"loc":{"start":{"line":29,"column":35},"end":{"line":29,"column":78}},"line":29},"4":{"name":"(anonymous_4)","decl":{"start":{"line":30,"column":33},"end":{"line":30,"column":34}},"loc":{"start":{"line":30,"column":47},"end":{"line":33,"column":1}},"line":30},"5":{"name":"(anonymous_5)","decl":{"start":{"line":34,"column":23},"end":{"line":34,"column":24}},"loc":{"start":{"line":34,"column":42},"end":{"line":34,"column":228}},"line":34},"6":{"name":"(anonymous_6)","decl":{"start":{"line":34,"column":42},"end":{"line":34,"column":43}},"loc":{"start":{"line":34,"column":82},"end":{"line":34,"column":228}},"line":34},"7":{"name":"(anonymous_7)","decl":{"start":{"line":35,"column":25},"end":{"line":35,"column":26}},"loc":{"start":{"line":35,"column":54},"end":{"line":38,"column":5}},"line":35},"8":{"name":"(anonymous_8)","decl":{"start":{"line":35,"column":54},"end":{"line":35,"column":55}},"loc":{"start":{"line":35,"column":73},"end":{"line":38,"column":5}},"line":35},"9":{"name":"(anonymous_9)","decl":{"start":{"line":37,"column":15},"end":{"line":37,"column":16}},"loc":{"start":{"line":37,"column":22},"end":{"line":37,"column":97}},"line":37},"10":{"name":"(anonymous_10)","decl":{"start":{"line":37,"column":52},"end":{"line":37,"column":53}},"loc":{"start":{"line":37,"column":63},"end":{"line":37,"column":96}},"line":37},"11":{"name":"(anonymous_11)","decl":{"start":{"line":39,"column":51},"end":{"line":39,"column":52}},"loc":{"start":{"line":39,"column":81},"end":{"line":45,"column":1}},"line":39},"12":{"name":"(anonymous_12)","decl":{"start":{"line":45,"column":3},"end":{"line":45,"column":4}},"loc":{"start":{"line":45,"column":13},"end":{"line":45,"column":91}},"line":45},"13":{"name":"(anonymous_13)","decl":{"start":{"line":48,"column":37},"end":{"line":48,"column":38}},"loc":{"start":{"line":48,"column":75},"end":{"line":54,"column":1}},"line":48},"14":{"name":"(anonymous_14)","decl":{"start":{"line":54,"column":3},"end":{"line":54,"column":4}},"loc":{"start":{"line":54,"column":7},"end":{"line":54,"column":102}},"line":54},"15":{"name":"(anonymous_15)","decl":{"start":{"line":55,"column":24},"end":{"line":55,"column":25}},"loc":{"start":{"line":55,"column":80},"end":{"line":139,"column":1}},"line":55},"16":{"name":"(anonymous_16)","decl":{"start":{"line":90,"column":96},"end":{"line":90,"column":97}},"loc":{"start":{"line":90,"column":117},"end":{"line":104,"column":5}},"line":90},"17":{"name":"(anonymous_17)","decl":{"start":{"line":106,"column":95},"end":{"line":106,"column":96}},"loc":{"start":{"line":106,"column":116},"end":{"line":121,"column":5}},"line":106},"18":{"name":"(anonymous_18)","decl":{"start":{"line":123,"column":114},"end":{"line":123,"column":115}},"loc":{"start":{"line":123,"column":135},"end":{"line":137,"column":5}},"line":123},"19":{"name":"(anonymous_19)","decl":{"start":{"line":140,"column":17},"end":{"line":140,"column":18}},"loc":{"start":{"line":140,"column":37},"end":{"line":143,"column":1}},"line":140}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},"type":"if","locations":[{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},{"start":{"line":15,"column":4},"end":{"line":17,"column":5}}],"line":15},"1":{"loc":{"start":{"line":15,"column":8},"end":{"line":15,"column":199}},"type":"cond-expr","locations":[{"start":{"line":15,"column":49},"end":{"line":15,"column":55}},{"start":{"line":15,"column":58},"end":{"line":15,"column":199}}],"line":15},"2":{"loc":{"start":{"line":15,"column":8},"end":{"line":15,"column":46}},"type":"binary-expr","locations":[{"start":{"line":15,"column":8},"end":{"line":15,"column":24}},{"start":{"line":15,"column":28},"end":{"line":15,"column":46}}],"line":15},"3":{"loc":{"start":{"line":15,"column":58},"end":{"line":15,"column":199}},"type":"cond-expr","locations":[{"start":{"line":15,"column":134},"end":{"line":15,"column":140}},{"start":{"line":15,"column":143},"end":{"line":15,"column":199}}],"line":15},"4":{"loc":{"start":{"line":15,"column":58},"end":{"line":15,"column":131}},"type":"binary-expr","locations":[{"start":{"line":15,"column":58},"end":{"line":15,"column":101}},{"start":{"line":15,"column":105},"end":{"line":15,"column":131}}],"line":15},"5":{"loc":{"start":{"line":19,"column":4},"end":{"line":21,"column":5}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":21,"column":5}},{"start":{"line":19,"column":4},"end":{"line":21,"column":5}}],"line":19},"6":{"loc":{"start":{"line":31,"column":26},"end":{"line":31,"column":50}},"type":"cond-expr","locations":[{"start":{"line":31,"column":45},"end":{"line":31,"column":46}},{"start":{"line":31,"column":49},"end":{"line":31,"column":50}}],"line":31},"7":{"loc":{"start":{"line":32,"column":11},"end":{"line":32,"column":62}},"type":"cond-expr","locations":[{"start":{"line":32,"column":45},"end":{"line":32,"column":58}},{"start":{"line":32,"column":61},"end":{"line":32,"column":62}}],"line":32},"8":{"loc":{"start":{"line":40,"column":4},"end":{"line":42,"column":5}},"type":"if","locations":[{"start":{"line":40,"column":4},"end":{"line":42,"column":5}},{"start":{"line":40,"column":4},"end":{"line":42,"column":5}}],"line":40},"9":{"loc":{"start":{"line":49,"column":4},"end":{"line":51,"column":5}},"type":"if","locations":[{"start":{"line":49,"column":4},"end":{"line":51,"column":5}},{"start":{"line":49,"column":4},"end":{"line":51,"column":5}}],"line":49},"10":{"loc":{"start":{"line":49,"column":8},"end":{"line":49,"column":42}},"type":"binary-expr","locations":[{"start":{"line":49,"column":8},"end":{"line":49,"column":10}},{"start":{"line":49,"column":14},"end":{"line":49,"column":16}},{"start":{"line":49,"column":20},"end":{"line":49,"column":42}}],"line":49},"11":{"loc":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"type":"if","locations":[{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},{"start":{"line":57,"column":4},"end":{"line":59,"column":5}}],"line":57},"12":{"loc":{"start":{"line":60,"column":21},"end":{"line":60,"column":48}},"type":"binary-expr","locations":[{"start":{"line":60,"column":21},"end":{"line":60,"column":42}},{"start":{"line":60,"column":46},"end":{"line":60,"column":48}}],"line":60},"13":{"loc":{"start":{"line":61,"column":4},"end":{"line":70,"column":5}},"type":"if","locations":[{"start":{"line":61,"column":4},"end":{"line":70,"column":5}},{"start":{"line":61,"column":4},"end":{"line":70,"column":5}}],"line":61},"14":{"loc":{"start":{"line":91,"column":8},"end":{"line":93,"column":9}},"type":"if","locations":[{"start":{"line":91,"column":8},"end":{"line":93,"column":9}},{"start":{"line":91,"column":8},"end":{"line":93,"column":9}}],"line":91},"15":{"loc":{"start":{"line":94,"column":8},"end":{"line":100,"column":9}},"type":"if","locations":[{"start":{"line":94,"column":8},"end":{"line":100,"column":9}},{"start":{"line":94,"column":8},"end":{"line":100,"column":9}}],"line":94},"16":{"loc":{"start":{"line":94,"column":12},"end":{"line":98,"column":10}},"type":"binary-expr","locations":[{"start":{"line":94,"column":12},"end":{"line":94,"column":38}},{"start":{"line":94,"column":42},"end":{"line":98,"column":10}}],"line":94},"17":{"loc":{"start":{"line":102,"column":23},"end":{"line":102,"column":65}},"type":"cond-expr","locations":[{"start":{"line":102,"column":52},"end":{"line":102,"column":54}},{"start":{"line":102,"column":57},"end":{"line":102,"column":65}}],"line":102},"18":{"loc":{"start":{"line":107,"column":8},"end":{"line":109,"column":9}},"type":"if","locations":[{"start":{"line":107,"column":8},"end":{"line":109,"column":9}},{"start":{"line":107,"column":8},"end":{"line":109,"column":9}}],"line":107},"19":{"loc":{"start":{"line":110,"column":8},"end":{"line":116,"column":9}},"type":"if","locations":[{"start":{"line":110,"column":8},"end":{"line":116,"column":9}},{"start":{"line":110,"column":8},"end":{"line":116,"column":9}}],"line":110},"20":{"loc":{"start":{"line":110,"column":12},"end":{"line":114,"column":10}},"type":"binary-expr","locations":[{"start":{"line":110,"column":12},"end":{"line":110,"column":38}},{"start":{"line":110,"column":42},"end":{"line":114,"column":10}}],"line":110},"21":{"loc":{"start":{"line":117,"column":23},"end":{"line":117,"column":65}},"type":"cond-expr","locations":[{"start":{"line":117,"column":52},"end":{"line":117,"column":54}},{"start":{"line":117,"column":57},"end":{"line":117,"column":65}}],"line":117},"22":{"loc":{"start":{"line":124,"column":8},"end":{"line":126,"column":9}},"type":"if","locations":[{"start":{"line":124,"column":8},"end":{"line":126,"column":9}},{"start":{"line":124,"column":8},"end":{"line":126,"column":9}}],"line":124},"23":{"loc":{"start":{"line":127,"column":8},"end":{"line":133,"column":9}},"type":"if","locations":[{"start":{"line":127,"column":8},"end":{"line":133,"column":9}},{"start":{"line":127,"column":8},"end":{"line":133,"column":9}}],"line":127},"24":{"loc":{"start":{"line":127,"column":12},"end":{"line":131,"column":10}},"type":"binary-expr","locations":[{"start":{"line":127,"column":12},"end":{"line":127,"column":38}},{"start":{"line":127,"column":42},"end":{"line":131,"column":10}}],"line":127},"25":{"loc":{"start":{"line":135,"column":23},"end":{"line":135,"column":65}},"type":"cond-expr","locations":[{"start":{"line":135,"column":52},"end":{"line":135,"column":54}},{"start":{"line":135,"column":57},"end":{"line":135,"column":65}}],"line":135}},"s":{"0":2,"1":2,"2":254,"3":2,"4":2,"5":28,"6":0,"7":0,"8":28,"9":2,"10":26,"11":26,"12":26,"13":0,"14":2,"15":52,"16":2,"17":49,"18":49,"19":2,"20":6,"21":49,"22":2,"23":4,"24":6,"25":6,"26":762,"27":56,"28":2,"29":38,"30":2,"31":36,"32":36,"33":508,"34":2,"35":2,"36":2,"37":18,"38":5,"39":13,"40":13,"41":254,"42":2,"43":254,"44":254,"45":236,"46":254,"47":254,"48":254,"49":254,"50":254,"51":254,"52":254,"53":254,"54":254,"55":254,"56":254,"57":254,"58":254,"59":254,"60":254,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":254,"69":16,"70":0,"71":16,"72":0,"73":16,"74":16,"75":16,"76":16,"77":254,"78":12,"79":2,"80":10,"81":0,"82":10,"83":10,"84":10,"85":254,"86":2,"87":254,"88":254},"f":{"0":254,"1":28,"2":0,"3":52,"4":49,"5":6,"6":49,"7":4,"8":6,"9":762,"10":56,"11":38,"12":508,"13":18,"14":254,"15":254,"16":0,"17":16,"18":12,"19":254},"b":{"0":[0,28],"1":[0,28],"2":[28,28],"3":[0,28],"4":[28,28],"5":[2,26],"6":[22,27],"7":[46,3],"8":[2,36],"9":[5,13],"10":[18,15,14],"11":[236,18],"12":[254,0],"13":[254,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,16],"19":[0,16],"20":[16,0],"21":[0,16],"22":[2,10],"23":[0,10],"24":[10,0],"25":[0,10]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/markdown.js"],"sourcesContent":["import { addAsToken, isToken, validateAllowedTokens } from './token';\n\nconst validateUrl = (url, message) => {\n\t// Don't render markdown inside links\n\tif (message?.tokens?.some((token) => url.includes(token.token))) {\n\t\treturn false;\n\t}\n\n\t// Valid urls don't contain whitespaces\n\tif (/\\s/.test(url.trim())) {\n\t\treturn false;\n\t}\n\n\ttry {\n\t\tnew URL(url);\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n};\n\nconst endsWithWhitespace = (text) => text.substring(text.length - 1).match(/\\s/);\n\nconst getParseableMarkersCount = (start, end) => {\n\tconst usableMarkers = start.length > 1 ? 2 : 1;\n\treturn end.length - usableMarkers >= 0 ? usableMarkers : 1;\n};\n\nconst getTextWrapper = (marker, tagName) => (textPrepend, wrappedText, textAppend) =>\n\t`${textPrepend}<span class=\"copyonly\">${marker}</span><${tagName}>${wrappedText}</${tagName}><span class=\"copyonly\">${marker}</span>${textAppend}`;\n\nconst getRegexReplacer = (replaceFunction, getRegex) => (marker, tagName) => {\n\tconst wrapper = getTextWrapper(marker, tagName);\n\treturn (msg) => msg.replace(getRegex(marker), (...args) => replaceFunction(wrapper, ...args));\n};\n\nconst getParserWithCustomMarker = getRegexReplacer(\n\t(wrapper, match, p1, p2, p3) => {\n\t\tif (endsWithWhitespace(p2)) {\n\t\t\treturn match;\n\t\t}\n\t\tconst finalMarkerCount = getParseableMarkersCount(p1, p3);\n\t\treturn wrapper(p1.substring(finalMarkerCount), p2, p3.substring(finalMarkerCount));\n\t},\n\t(marker) => new RegExp(`(\\\\${marker}+(?!\\\\s))([^\\\\${marker}\\\\r\\\\n]+)(\\\\${marker}+)`, 'gm'),\n);\n\nconst parseBold = getParserWithCustomMarker('*', 'strong');\n\nconst parseStrike = getParserWithCustomMarker('~', 'strike');\n\nconst parseItalic = getRegexReplacer(\n\t(wrapper, match, p1, p2, p3, p4, p5) => {\n\t\tif (p1 || p5 || endsWithWhitespace(p3)) {\n\t\t\treturn match;\n\t\t}\n\n\t\tconst finalMarkerCount = getParseableMarkersCount(p2, p4);\n\t\treturn wrapper(p2.substring(finalMarkerCount), p3, p4.substring(finalMarkerCount));\n\t},\n\t() => new RegExp('([^\\\\r\\\\n\\\\s~*_]){0,1}(\\\\_+(?!\\\\s))([^\\\\_\\\\r\\\\n]+)(\\\\_+)([^\\\\r\\\\n\\\\s]){0,1}', 'gm'),\n)('_', 'em');\n\nconst parseNotEscaped = (message, { supportSchemesForLink, headers, rootUrl }) => {\n\tlet msg = message.html;\n\tif (!message.tokens) {\n\t\tmessage.tokens = [];\n\t}\n\n\tconst schemes = (supportSchemesForLink || '').split(',').join('|');\n\n\tif (headers) {\n\t\t// Support # Text for h1\n\t\tmsg = msg.replace(\n\t\t\t/^# (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm,\n\t\t\t'<h1>$1</h1>',\n\t\t);\n\n\t\t// Support # Text for h2\n\t\tmsg = msg.replace(\n\t\t\t/^## (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm,\n\t\t\t'<h2>$1</h2>',\n\t\t);\n\n\t\t// Support # Text for h3\n\t\tmsg = msg.replace(\n\t\t\t/^### (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm,\n\t\t\t'<h3>$1</h3>',\n\t\t);\n\n\t\t// Support # Text for h4\n\t\tmsg = msg.replace(\n\t\t\t/^#### (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm,\n\t\t\t'<h4>$1</h4>',\n\t\t);\n\t}\n\n\t// Support *text* to make bold\n\tmsg = parseBold(msg);\n\n\t// Support _text_ to make italics\n\tmsg = parseItalic(msg);\n\n\t// // Support ~text~ to strike through text\n\tmsg = parseStrike(msg);\n\n\t// Support for block quote\n\t// >>>\n\t// Text\n\t// <<<\n\tmsg = msg.replace(\n\t\t/(?:&gt;){3}\\n+([\\s\\S]*?)\\n+(?:&lt;){3}/g,\n\t\t'<blockquote class=\"background-transparent-darker-before\"><span class=\"copyonly\">&gt;&gt;&gt;</span>$1<span class=\"copyonly\">&lt;&lt;&lt;</span></blockquote>',\n\t);\n\n\t// Support >Text for quote\n\tmsg = msg.replace(\n\t\t/^&gt;(.*)$/gm,\n\t\t'<blockquote class=\"background-transparent-darker-before\"><span class=\"copyonly\">&gt;</span>$1</blockquote>',\n\t);\n\n\t// Remove white-space around blockquote (prevent <br>). Because blockquote is block element.\n\tmsg = msg.replace(\n\t\t/\\s*<blockquote class=\"background-transparent-darker-before\">/gm,\n\t\t'<blockquote class=\"background-transparent-darker-before\">',\n\t);\n\tmsg = msg.replace(/<\\/blockquote>\\s*/gm, '</blockquote>');\n\n\t// Remove new-line between blockquotes.\n\tmsg = msg.replace(/<\\/blockquote>\\n<blockquote/gm, '</blockquote><blockquote');\n\n\t// Support ![alt text](http://image url)\n\tmsg = msg.replace(new RegExp(`!\\\\[([^\\\\]]+)\\\\]\\\\(((?:${schemes}):\\\\/\\\\/[^\\\\s]+)\\\\)`, 'gm'), (match, title, url) => {\n\t\tif (!validateUrl(url, message)) {\n\t\t\treturn match;\n\t\t}\n\t\tif (isToken(title) && !validateAllowedTokens(message, title, ['bold', 'italic', 'strike'])) {\n\t\t\treturn match;\n\t\t}\n\t\turl = encodeURI(url);\n\n\t\tconst target = url.indexOf(rootUrl) === 0 ? '' : '_blank';\n\t\treturn addAsToken(\n\t\t\tmessage,\n\t\t\t`<a data-title=\"${url}\" href=\"${url}\" title=\"${title}\" target=\"${target}\" rel=\"noopener noreferrer\"><div class=\"inline-image\" style=\"background-image: url(${url});\"></div></a>`,\n\t\t\t'link',\n\t\t);\n\t});\n\n\t// Support [Text](http://link)\n\tmsg = msg.replace(new RegExp(`\\\\[([^\\\\]]+)\\\\]\\\\(((?:${schemes}):\\\\/\\\\/[^\\\\s]+)\\\\)`, 'gm'), (match, title, url) => {\n\t\tif (!validateUrl(url, message)) {\n\t\t\treturn match;\n\t\t}\n\t\tif (isToken(title) && !validateAllowedTokens(message, title, ['bold', 'italic', 'strike'])) {\n\t\t\treturn match;\n\t\t}\n\t\tconst target = url.indexOf(rootUrl) === 0 ? '' : '_blank';\n\t\ttitle = title.replace(/&amp;/g, '&');\n\n\t\tconst escapedUrl = encodeURI(url);\n\n\t\treturn addAsToken(\n\t\t\tmessage,\n\t\t\t`<a data-title=\"${escapedUrl}\" href=\"${escapedUrl}\" target=\"${target}\" rel=\"noopener noreferrer\">${title}</a>`,\n\t\t\t'link',\n\t\t);\n\t});\n\n\t// Support <http://link|Text>\n\tmsg = msg.replace(new RegExp(`(?:<|&lt;)((?:${schemes}):\\\\\\/\\\\\\/[^\\\\|]+)\\\\|(.+?)(?=>|&gt;)(?:>|&gt;)`, 'gm'), (match, url, title) => {\n\t\tif (!validateUrl(url, message)) {\n\t\t\treturn match;\n\t\t}\n\t\tif (isToken(title) && !validateAllowedTokens(message, title, ['bold', 'italic', 'strike'])) {\n\t\t\treturn match;\n\t\t}\n\t\turl = encodeURI(url);\n\t\tconst target = url.indexOf(rootUrl) === 0 ? '' : '_blank';\n\t\treturn addAsToken(message, `<a data-title=\"${url}\" href=\"${url}\" target=\"${target}\" rel=\"noopener noreferrer\">${title}</a>`, 'link');\n\t});\n\treturn msg;\n};\n\nexport const markdown = (message, options) => {\n\tmessage.html = parseNotEscaped(message, options);\n\treturn message;\n};\n"],"names":["markdown","validateUrl","url","message","tokens","some","token","includes","test","trim","URL","e","endsWithWhitespace","text","substring","length","match","getParseableMarkersCount","start","end","usableMarkers","getTextWrapper","marker","tagName","textPrepend","wrappedText","textAppend","getRegexReplacer","replaceFunction","getRegex","wrapper","msg","replace","args","getParserWithCustomMarker","p1","p2","p3","finalMarkerCount","RegExp","parseBold","parseStrike","parseItalic","p4","p5","parseNotEscaped","supportSchemesForLink","headers","rootUrl","html","schemes","split","join","title","isToken","validateAllowedTokens","encodeURI","target","indexOf","addAsToken","escapedUrl","options"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/markdown/lib/parser/original/markdown.js"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6cc0bf64df9a9347b5b92f4fb110a7d4487efe7a","contentHash":"bc56f4dc40303078ba93171b38dc02c0fc2a8799193ab943c032b3c90754ee10"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/mentions/lib/MentionsParser.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/mentions/lib/MentionsParser.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":30}},"3":{"start":{"line":11,"column":23},"end":{"line":11,"column":61}},"4":{"start":{"line":12,"column":28},"end":{"line":12,"column":208}},"5":{"start":{"line":12,"column":100},"end":{"line":12,"column":208}},"6":{"start":{"line":13,"column":28},"end":{"line":13,"column":164}},"7":{"start":{"line":13,"column":62},"end":{"line":13,"column":164}},"8":{"start":{"line":14,"column":21},"end":{"line":103,"column":1}},"9":{"start":{"line":16,"column":8},"end":{"line":16,"column":109}},"10":{"start":{"line":19,"column":8},"end":{"line":19,"column":88}},"11":{"start":{"line":22,"column":8},"end":{"line":22,"column":83}},"12":{"start":{"line":22,"column":69},"end":{"line":22,"column":81}},"13":{"start":{"line":25,"column":8},"end":{"line":25,"column":86}},"14":{"start":{"line":25,"column":72},"end":{"line":25,"column":84}},"15":{"start":{"line":28,"column":18},"end":{"line":28,"column":88}},"16":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"17":{"start":{"line":30,"column":12},"end":{"line":30,"column":27}},"18":{"start":{"line":32,"column":8},"end":{"line":32,"column":57}},"19":{"start":{"line":33,"column":8},"end":{"line":33,"column":49}},"20":{"start":{"line":34,"column":8},"end":{"line":34,"column":27}},"21":{"start":{"line":35,"column":8},"end":{"line":35,"column":23}},"22":{"start":{"line":38,"column":8},"end":{"line":79,"column":15}},"23":{"start":{"line":38,"column":59},"end":{"line":79,"column":14}},"24":{"start":{"line":39,"column":35},"end":{"line":41,"column":17}},"25":{"start":{"line":42,"column":16},"end":{"line":53,"column":17}},"26":{"start":{"line":43,"column":20},"end":{"line":43,"column":57}},"27":{"start":{"line":44,"column":20},"end":{"line":44,"column":59}},"28":{"start":{"line":45,"column":23},"end":{"line":53,"column":17}},"29":{"start":{"line":46,"column":20},"end":{"line":46,"column":58}},"30":{"start":{"line":47,"column":20},"end":{"line":47,"column":59}},"31":{"start":{"line":48,"column":23},"end":{"line":53,"column":17}},"32":{"start":{"line":49,"column":20},"end":{"line":49,"column":56}},"33":{"start":{"line":50,"column":20},"end":{"line":50,"column":58}},"34":{"start":{"line":52,"column":20},"end":{"line":52,"column":58}},"35":{"start":{"line":54,"column":34},"end":{"line":54,"column":54}},"36":{"start":{"line":55,"column":16},"end":{"line":63,"column":17}},"37":{"start":{"line":56,"column":20},"end":{"line":62,"column":23}},"38":{"start":{"line":64,"column":35},"end":{"line":64,"column":107}},"39":{"start":{"line":64,"column":57},"end":{"line":64,"column":107}},"40":{"start":{"line":65,"column":35},"end":{"line":65,"column":88}},"41":{"start":{"line":65,"column":53},"end":{"line":65,"column":88}},"42":{"start":{"line":66,"column":37},"end":{"line":66,"column":104}},"43":{"start":{"line":66,"column":66},"end":{"line":66,"column":103}},"44":{"start":{"line":67,"column":30},"end":{"line":67,"column":232}},"45":{"start":{"line":68,"column":16},"end":{"line":70,"column":17}},"46":{"start":{"line":69,"column":20},"end":{"line":69,"column":33}},"47":{"start":{"line":71,"column":16},"end":{"line":78,"column":19}},"48":{"start":{"line":80,"column":8},"end":{"line":96,"column":15}},"49":{"start":{"line":80,"column":58},"end":{"line":96,"column":14}},"50":{"start":{"line":81,"column":16},"end":{"line":85,"column":17}},"51":{"start":{"line":82,"column":20},"end":{"line":82,"column":46}},"52":{"start":{"line":84,"column":20},"end":{"line":84,"column":33}},"53":{"start":{"line":86,"column":32},"end":{"line":88,"column":18}},"54":{"start":{"line":87,"column":20},"end":{"line":87,"column":44}},"55":{"start":{"line":89,"column":34},"end":{"line":89,"column":65}},"56":{"start":{"line":90,"column":16},"end":{"line":95,"column":19}},"57":{"start":{"line":97,"column":8},"end":{"line":97,"column":31}},"58":{"start":{"line":98,"column":8},"end":{"line":98,"column":54}},"59":{"start":{"line":98,"column":47},"end":{"line":98,"column":52}},"60":{"start":{"line":99,"column":8},"end":{"line":99,"column":33}},"61":{"start":{"line":99,"column":29},"end":{"line":99,"column":31}},"62":{"start":{"line":100,"column":8},"end":{"line":100,"column":41}},"63":{"start":{"line":101,"column":8},"end":{"line":101,"column":41}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":28},"end":{"line":12,"column":29}},"loc":{"start":{"line":12,"column":100},"end":{"line":12,"column":208}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":13,"column":28},"end":{"line":13,"column":29}},"loc":{"start":{"line":13,"column":62},"end":{"line":13,"column":164}},"line":13},"3":{"name":"(anonymous_3)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":27},"end":{"line":17,"column":5}},"line":15},"4":{"name":"(anonymous_4)","decl":{"start":{"line":18,"column":4},"end":{"line":18,"column":5}},"loc":{"start":{"line":18,"column":30},"end":{"line":20,"column":5}},"line":18},"5":{"name":"(anonymous_5)","decl":{"start":{"line":21,"column":4},"end":{"line":21,"column":5}},"loc":{"start":{"line":21,"column":25},"end":{"line":23,"column":5}},"line":21},"6":{"name":"(anonymous_6)","decl":{"start":{"line":22,"column":60},"end":{"line":22,"column":61}},"loc":{"start":{"line":22,"column":69},"end":{"line":22,"column":81}},"line":22},"7":{"name":"(anonymous_7)","decl":{"start":{"line":24,"column":4},"end":{"line":24,"column":5}},"loc":{"start":{"line":24,"column":28},"end":{"line":26,"column":5}},"line":24},"8":{"name":"(anonymous_8)","decl":{"start":{"line":25,"column":63},"end":{"line":25,"column":64}},"loc":{"start":{"line":25,"column":72},"end":{"line":25,"column":84}},"line":25},"9":{"name":"(anonymous_9)","decl":{"start":{"line":27,"column":4},"end":{"line":27,"column":5}},"loc":{"start":{"line":27,"column":19},"end":{"line":36,"column":5}},"line":27},"10":{"name":"(anonymous_10)","decl":{"start":{"line":37,"column":4},"end":{"line":37,"column":5}},"loc":{"start":{"line":37,"column":117},"end":{"line":102,"column":5}},"line":37},"11":{"name":"(anonymous_11)","decl":{"start":{"line":38,"column":28},"end":{"line":38,"column":29}},"loc":{"start":{"line":38,"column":59},"end":{"line":79,"column":14}},"line":38},"12":{"name":"(anonymous_12)","decl":{"start":{"line":38,"column":94},"end":{"line":38,"column":95}},"loc":{"start":{"line":38,"column":120},"end":{"line":79,"column":13}},"line":38},"13":{"name":"(anonymous_13)","decl":{"start":{"line":64,"column":35},"end":{"line":64,"column":36}},"loc":{"start":{"line":64,"column":57},"end":{"line":64,"column":107}},"line":64},"14":{"name":"(anonymous_14)","decl":{"start":{"line":65,"column":35},"end":{"line":65,"column":36}},"loc":{"start":{"line":65,"column":53},"end":{"line":65,"column":88}},"line":65},"15":{"name":"(anonymous_15)","decl":{"start":{"line":66,"column":61},"end":{"line":66,"column":62}},"loc":{"start":{"line":66,"column":66},"end":{"line":66,"column":103}},"line":66},"16":{"name":"(anonymous_16)","decl":{"start":{"line":80,"column":31},"end":{"line":80,"column":32}},"loc":{"start":{"line":80,"column":58},"end":{"line":96,"column":14}},"line":80},"17":{"name":"(anonymous_17)","decl":{"start":{"line":80,"column":119},"end":{"line":80,"column":120}},"loc":{"start":{"line":80,"column":145},"end":{"line":96,"column":13}},"line":80},"18":{"name":"(anonymous_18)","decl":{"start":{"line":81,"column":97},"end":{"line":81,"column":98}},"loc":{"start":{"line":81,"column":102},"end":{"line":83,"column":17}},"line":81},"19":{"name":"(anonymous_19)","decl":{"start":{"line":86,"column":98},"end":{"line":86,"column":99}},"loc":{"start":{"line":86,"column":110},"end":{"line":88,"column":17}},"line":86},"20":{"name":"(anonymous_20)","decl":{"start":{"line":98,"column":43},"end":{"line":98,"column":44}},"loc":{"start":{"line":98,"column":47},"end":{"line":98,"column":52}},"line":98},"21":{"name":"(anonymous_21)","decl":{"start":{"line":99,"column":25},"end":{"line":99,"column":26}},"loc":{"start":{"line":99,"column":29},"end":{"line":99,"column":31}},"line":99}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":59},"end":{"line":12,"column":69}},"type":"default-arg","locations":[{"start":{"line":12,"column":67},"end":{"line":12,"column":69}}],"line":12},"1":{"loc":{"start":{"line":12,"column":78},"end":{"line":12,"column":95}},"type":"default-arg","locations":[{"start":{"line":12,"column":85},"end":{"line":12,"column":95}}],"line":12},"2":{"loc":{"start":{"line":12,"column":161},"end":{"line":12,"column":193}},"type":"cond-expr","locations":[{"start":{"line":12,"column":169},"end":{"line":12,"column":188}},{"start":{"line":12,"column":191},"end":{"line":12,"column":193}}],"line":12},"3":{"loc":{"start":{"line":22,"column":16},"end":{"line":22,"column":54}},"type":"binary-expr","locations":[{"start":{"line":22,"column":16},"end":{"line":22,"column":48}},{"start":{"line":22,"column":52},"end":{"line":22,"column":54}}],"line":22},"4":{"loc":{"start":{"line":25,"column":16},"end":{"line":25,"column":57}},"type":"binary-expr","locations":[{"start":{"line":25,"column":16},"end":{"line":25,"column":51}},{"start":{"line":25,"column":55},"end":{"line":25,"column":57}}],"line":25},"5":{"loc":{"start":{"line":28,"column":18},"end":{"line":28,"column":88}},"type":"binary-expr","locations":[{"start":{"line":28,"column":19},"end":{"line":28,"column":81}},{"start":{"line":28,"column":86},"end":{"line":28,"column":88}}],"line":28},"6":{"loc":{"start":{"line":28,"column":19},"end":{"line":28,"column":81}},"type":"cond-expr","locations":[{"start":{"line":28,"column":60},"end":{"line":28,"column":66}},{"start":{"line":28,"column":69},"end":{"line":28,"column":81}}],"line":28},"7":{"loc":{"start":{"line":28,"column":19},"end":{"line":28,"column":57}},"type":"binary-expr","locations":[{"start":{"line":28,"column":19},"end":{"line":28,"column":35}},{"start":{"line":28,"column":39},"end":{"line":28,"column":57}}],"line":28},"8":{"loc":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"type":"if","locations":[{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},{"start":{"line":29,"column":8},"end":{"line":31,"column":9}}],"line":29},"9":{"loc":{"start":{"line":37,"column":44},"end":{"line":37,"column":78}},"type":"default-arg","locations":[{"start":{"line":37,"column":59},"end":{"line":37,"column":78}}],"line":37},"10":{"loc":{"start":{"line":37,"column":80},"end":{"line":37,"column":114}},"type":"default-arg","locations":[{"start":{"line":37,"column":95},"end":{"line":37,"column":114}}],"line":37},"11":{"loc":{"start":{"line":42,"column":16},"end":{"line":53,"column":17}},"type":"if","locations":[{"start":{"line":42,"column":16},"end":{"line":53,"column":17}},{"start":{"line":42,"column":16},"end":{"line":53,"column":17}}],"line":42},"12":{"loc":{"start":{"line":45,"column":23},"end":{"line":53,"column":17}},"type":"if","locations":[{"start":{"line":45,"column":23},"end":{"line":53,"column":17}},{"start":{"line":45,"column":23},"end":{"line":53,"column":17}}],"line":45},"13":{"loc":{"start":{"line":48,"column":23},"end":{"line":53,"column":17}},"type":"if","locations":[{"start":{"line":48,"column":23},"end":{"line":53,"column":17}},{"start":{"line":48,"column":23},"end":{"line":53,"column":17}}],"line":48},"14":{"loc":{"start":{"line":55,"column":16},"end":{"line":63,"column":17}},"type":"if","locations":[{"start":{"line":55,"column":16},"end":{"line":63,"column":17}},{"start":{"line":55,"column":16},"end":{"line":63,"column":17}}],"line":55},"15":{"loc":{"start":{"line":55,"column":20},"end":{"line":55,"column":59}},"type":"binary-expr","locations":[{"start":{"line":55,"column":20},"end":{"line":55,"column":37}},{"start":{"line":55,"column":41},"end":{"line":55,"column":59}}],"line":55},"16":{"loc":{"start":{"line":64,"column":57},"end":{"line":64,"column":107}},"type":"binary-expr","locations":[{"start":{"line":64,"column":58},"end":{"line":64,"column":63}},{"start":{"line":64,"column":67},"end":{"line":64,"column":82}},{"start":{"line":64,"column":87},"end":{"line":64,"column":107}}],"line":64},"17":{"loc":{"start":{"line":65,"column":53},"end":{"line":65,"column":88}},"type":"binary-expr","locations":[{"start":{"line":65,"column":53},"end":{"line":65,"column":68}},{"start":{"line":65,"column":72},"end":{"line":65,"column":88}}],"line":65},"18":{"loc":{"start":{"line":66,"column":38},"end":{"line":66,"column":52}},"type":"binary-expr","locations":[{"start":{"line":66,"column":38},"end":{"line":66,"column":46}},{"start":{"line":66,"column":50},"end":{"line":66,"column":52}}],"line":66},"19":{"loc":{"start":{"line":66,"column":66},"end":{"line":66,"column":103}},"type":"binary-expr","locations":[{"start":{"line":66,"column":66},"end":{"line":66,"column":67}},{"start":{"line":66,"column":72},"end":{"line":66,"column":85}},{"start":{"line":66,"column":89},"end":{"line":66,"column":102}}],"line":66},"20":{"loc":{"start":{"line":67,"column":30},"end":{"line":67,"column":232}},"type":"cond-expr","locations":[{"start":{"line":67,"column":37},"end":{"line":67,"column":87}},{"start":{"line":67,"column":90},"end":{"line":67,"column":232}}],"line":67},"21":{"loc":{"start":{"line":67,"column":37},"end":{"line":67,"column":87}},"type":"binary-expr","locations":[{"start":{"line":67,"column":37},"end":{"line":67,"column":44}},{"start":{"line":67,"column":48},"end":{"line":67,"column":87}}],"line":67},"22":{"loc":{"start":{"line":67,"column":90},"end":{"line":67,"column":232}},"type":"binary-expr","locations":[{"start":{"line":67,"column":90},"end":{"line":67,"column":100}},{"start":{"line":67,"column":104},"end":{"line":67,"column":232}}],"line":67},"23":{"loc":{"start":{"line":67,"column":135},"end":{"line":67,"column":231}},"type":"binary-expr","locations":[{"start":{"line":67,"column":136},"end":{"line":67,"column":224}},{"start":{"line":67,"column":229},"end":{"line":67,"column":231}}],"line":67},"24":{"loc":{"start":{"line":67,"column":136},"end":{"line":67,"column":224}},"type":"cond-expr","locations":[{"start":{"line":67,"column":187},"end":{"line":67,"column":202}},{"start":{"line":67,"column":205},"end":{"line":67,"column":224}}],"line":67},"25":{"loc":{"start":{"line":67,"column":136},"end":{"line":67,"column":184}},"type":"binary-expr","locations":[{"start":{"line":67,"column":136},"end":{"line":67,"column":162}},{"start":{"line":67,"column":166},"end":{"line":67,"column":184}}],"line":67},"26":{"loc":{"start":{"line":68,"column":16},"end":{"line":70,"column":17}},"type":"if","locations":[{"start":{"line":68,"column":16},"end":{"line":70,"column":17}},{"start":{"line":68,"column":16},"end":{"line":70,"column":17}}],"line":68},"27":{"loc":{"start":{"line":76,"column":26},"end":{"line":76,"column":132}},"type":"cond-expr","locations":[{"start":{"line":76,"column":113},"end":{"line":76,"column":119}},{"start":{"line":76,"column":122},"end":{"line":76,"column":132}}],"line":76},"28":{"loc":{"start":{"line":76,"column":27},"end":{"line":76,"column":98}},"type":"cond-expr","locations":[{"start":{"line":76,"column":74},"end":{"line":76,"column":80}},{"start":{"line":76,"column":83},"end":{"line":76,"column":98}}],"line":76},"29":{"loc":{"start":{"line":76,"column":27},"end":{"line":76,"column":71}},"type":"binary-expr","locations":[{"start":{"line":76,"column":27},"end":{"line":76,"column":46}},{"start":{"line":76,"column":50},"end":{"line":76,"column":71}}],"line":76},"30":{"loc":{"start":{"line":77,"column":27},"end":{"line":77,"column":63}},"type":"cond-expr","locations":[{"start":{"line":77,"column":48},"end":{"line":77,"column":55}},{"start":{"line":77,"column":58},"end":{"line":77,"column":63}}],"line":77},"31":{"loc":{"start":{"line":81,"column":16},"end":{"line":85,"column":17}},"type":"if","locations":[{"start":{"line":81,"column":16},"end":{"line":85,"column":17}},{"start":{"line":81,"column":16},"end":{"line":85,"column":17}}],"line":81},"32":{"loc":{"start":{"line":81,"column":20},"end":{"line":83,"column":19}},"type":"binary-expr","locations":[{"start":{"line":81,"column":20},"end":{"line":81,"column":25}},{"start":{"line":81,"column":29},"end":{"line":83,"column":19}}],"line":81},"33":{"loc":{"start":{"line":81,"column":31},"end":{"line":83,"column":18}},"type":"cond-expr","locations":[{"start":{"line":81,"column":74},"end":{"line":81,"column":80}},{"start":{"line":81,"column":83},"end":{"line":83,"column":18}}],"line":81},"34":{"loc":{"start":{"line":81,"column":31},"end":{"line":81,"column":71}},"type":"binary-expr","locations":[{"start":{"line":81,"column":31},"end":{"line":81,"column":48}},{"start":{"line":81,"column":52},"end":{"line":81,"column":71}}],"line":81},"35":{"loc":{"start":{"line":86,"column":32},"end":{"line":88,"column":18}},"type":"cond-expr","locations":[{"start":{"line":86,"column":75},"end":{"line":86,"column":81}},{"start":{"line":86,"column":84},"end":{"line":88,"column":18}}],"line":86},"36":{"loc":{"start":{"line":86,"column":32},"end":{"line":86,"column":72}},"type":"binary-expr","locations":[{"start":{"line":86,"column":32},"end":{"line":86,"column":49}},{"start":{"line":86,"column":53},"end":{"line":86,"column":72}}],"line":86},"37":{"loc":{"start":{"line":89,"column":34},"end":{"line":89,"column":65}},"type":"cond-expr","locations":[{"start":{"line":89,"column":44},"end":{"line":89,"column":55}},{"start":{"line":89,"column":58},"end":{"line":89,"column":65}}],"line":89},"38":{"loc":{"start":{"line":98,"column":27},"end":{"line":98,"column":53}},"type":"binary-expr","locations":[{"start":{"line":98,"column":27},"end":{"line":98,"column":38}},{"start":{"line":98,"column":43},"end":{"line":98,"column":52}}],"line":98},"39":{"loc":{"start":{"line":99,"column":18},"end":{"line":99,"column":32}},"type":"binary-expr","locations":[{"start":{"line":99,"column":18},"end":{"line":99,"column":20}},{"start":{"line":99,"column":25},"end":{"line":99,"column":31}}],"line":99}},"s":{"0":1,"1":1,"2":2198,"3":1,"4":1,"5":12,"6":1,"7":7,"8":1,"9":40,"10":28,"11":22,"12":28,"13":18,"14":20,"15":8,"16":8,"17":2,"18":6,"19":6,"20":6,"21":6,"22":4394,"23":18,"24":14,"25":14,"26":2,"27":2,"28":12,"29":0,"30":0,"31":12,"32":2,"33":2,"34":10,"35":14,"36":14,"37":2,"38":12,"39":48,"40":12,"41":38,"42":12,"43":48,"44":12,"45":12,"46":2,"47":10,"48":4394,"49":10,"50":8,"51":11,"52":1,"53":7,"54":9,"55":7,"56":7,"57":4394,"58":4394,"59":8,"60":4394,"61":0,"62":4394,"63":4394},"f":{"0":2198,"1":12,"2":7,"3":40,"4":28,"5":22,"6":28,"7":18,"8":20,"9":8,"10":4394,"11":18,"12":14,"13":48,"14":38,"15":48,"16":10,"17":8,"18":11,"19":9,"20":8,"21":0},"b":{"0":[2],"1":[0],"2":[10,2],"3":[22,3],"4":[18,3],"5":[8,2],"6":[0,8],"7":[8,8],"8":[2,6],"9":[4394],"10":[4394],"11":[2,12],"12":[0,12],"13":[2,10],"14":[2,12],"15":[14,12],"16":[48,0,48],"17":[38,0],"18":[12,0],"19":[48,48,38],"20":[0,12],"21":[0,0],"22":[12,10],"23":[10,0],"24":[6,4],"25":[10,10],"26":[2,10],"27":[0,10],"28":[0,10],"29":[10,10],"30":[6,4],"31":[1,7],"32":[8,8],"33":[0,8],"34":[8,8],"35":[0,7],"36":[7,7],"37":[7,0],"38":[4394,4394],"39":[4394,2197]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/mentions/lib/MentionsParser.ts"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\n\nexport type MentionsParserArgs = {\n\tpattern: () => string;\n\tuseRealName?: () => boolean;\n\tme?: () => string;\n\troomTemplate?: (args: { prefix: string; reference: string; mention: string; channel?: any }) => string;\n\tuserTemplate?: (args: { prefix: string; className: string; mention: string; title?: string; label: string; type?: string }) => string;\n};\n\nconst userTemplateDefault = ({\n\tprefix,\n\tclassName,\n\tmention,\n\ttitle = '',\n\tlabel,\n\ttype = 'username',\n}: {\n\tprefix: string;\n\tclassName: string;\n\tmention: string;\n\ttitle?: string;\n\tlabel?: string;\n\ttype?: string;\n}) => `${prefix}<a class=\"${className}\" data-${type}=\"${mention}\"${title ? ` title=\"${title}\"` : ''}>${label}</a>`;\n\nconst roomTemplateDefault = ({ prefix, reference, mention }: { prefix: string; reference: string; mention: string }) =>\n\t`${prefix}<a class=\"mention-link mention-link--room\" data-channel=\"${reference}\">${`#${mention}`}</a>`;\n\nexport class MentionsParser {\n\tme: () => string;\n\n\tpattern: MentionsParserArgs['pattern'];\n\n\tuserTemplate: (args: { prefix: string; className: string; mention: string; title?: string; label: string; type?: string }) => string;\n\n\troomTemplate: (args: { prefix: string; reference: string; mention: string; channel?: any }) => string;\n\n\tuseRealName: () => boolean;\n\n\tconstructor({ pattern, useRealName, me, roomTemplate = roomTemplateDefault, userTemplate = userTemplateDefault }: MentionsParserArgs) {\n\t\tthis.pattern = pattern;\n\t\tthis.useRealName = useRealName || (() => false);\n\t\tthis.me = me || (() => '');\n\t\tthis.userTemplate = userTemplate;\n\t\tthis.roomTemplate = roomTemplate;\n\t}\n\n\tget userMentionRegex() {\n\t\treturn new RegExp(`(^|\\\\s|>)@(${this.pattern()}(@(${this.pattern()}))?(:([0-9a-zA-Z-_.]+))?)`, 'gm');\n\t}\n\n\tget channelMentionRegex() {\n\t\treturn new RegExp(`(^|\\\\s|>)#(${this.pattern()}(@(${this.pattern()}))?)`, 'gm');\n\t}\n\n\treplaceUsers = (msg: string, { mentions, temp }: IMessage, me: string) =>\n\t\tmsg.replace(this.userMentionRegex, (match, prefix, mention) => {\n\t\t\tconst classNames = ['mention-link'];\n\n\t\t\tif (mention === 'all') {\n\t\t\t\tclassNames.push('mention-link--all');\n\t\t\t\tclassNames.push('mention-link--group');\n\t\t\t} else if (mention === 'here') {\n\t\t\t\tclassNames.push('mention-link--here');\n\t\t\t\tclassNames.push('mention-link--group');\n\t\t\t} else if (mention === me) {\n\t\t\t\tclassNames.push('mention-link--me');\n\t\t\t\tclassNames.push('mention-link--user');\n\t\t\t} else {\n\t\t\t\tclassNames.push('mention-link--user');\n\t\t\t}\n\n\t\t\tconst className = classNames.join(' ');\n\n\t\t\tif (mention === 'all' || mention === 'here') {\n\t\t\t\treturn this.userTemplate({ prefix, className, mention, label: mention, type: 'group' });\n\t\t\t}\n\n\t\t\tconst filterUser = ({ username, type }: { username?: string; type?: string }) => (!type || type === 'user') && username === mention;\n\t\t\tconst filterTeam = ({ name, type }: { name?: string; type?: string }) => type === 'team' && name === mention;\n\n\t\t\tconst [mentionObj] = (mentions || []).filter((m) => m && (filterUser(m) || filterTeam(m)));\n\n\t\t\tconst label = temp\n\t\t\t\t? mention && escapeHTML(mention)\n\t\t\t\t: mentionObj && escapeHTML((mentionObj.type === 'team' || this.useRealName() ? mentionObj.name : mentionObj.username) || '');\n\n\t\t\tif (!label) {\n\t\t\t\treturn match;\n\t\t\t}\n\n\t\t\treturn this.userTemplate({\n\t\t\t\tprefix,\n\t\t\t\tclassName,\n\t\t\t\tmention,\n\t\t\t\tlabel,\n\t\t\t\ttype: mentionObj?.type === 'team' ? 'team' : 'username',\n\t\t\t\ttitle: this.useRealName() ? mention : label,\n\t\t\t});\n\t\t});\n\n\treplaceChannels = (msg: string, { temp, channels }: IMessage) =>\n\t\tmsg.replace(/&#39;/g, \"'\").replace(this.channelMentionRegex, (match, prefix, mention) => {\n\t\t\tif (\n\t\t\t\t!temp &&\n\t\t\t\t!channels?.find((c) => {\n\t\t\t\t\treturn c.name === mention;\n\t\t\t\t})\n\t\t\t) {\n\t\t\t\treturn match;\n\t\t\t}\n\n\t\t\tconst channel = channels?.find(({ name }) => {\n\t\t\t\treturn name === mention;\n\t\t\t});\n\t\t\tconst reference = channel ? channel._id : mention;\n\t\t\treturn this.roomTemplate({ prefix, reference, channel, mention });\n\t\t});\n\n\tgetUserMentions(str: string) {\n\t\treturn (str.match(this.userMentionRegex) || []).map((match) => match.trim());\n\t}\n\n\tgetChannelMentions(str: string) {\n\t\treturn (str.match(this.channelMentionRegex) || []).map((match) => match.trim());\n\t}\n\n\tparse(message: IMessage) {\n\t\tlet msg = message?.html || '';\n\t\tif (!msg.trim()) {\n\t\t\treturn message;\n\t\t}\n\t\tmsg = this.replaceUsers(msg, message, this.me());\n\t\tmsg = this.replaceChannels(msg, message);\n\t\tmessage.html = msg;\n\t\treturn message;\n\t}\n}\n"],"names":["MentionsParser","userTemplateDefault","prefix","className","mention","title","label","type","roomTemplateDefault","reference","userMentionRegex","RegExp","pattern","channelMentionRegex","getUserMentions","str","match","map","trim","getChannelMentions","parse","message","msg","html","replaceUsers","me","replaceChannels","constructor","useRealName","roomTemplate","userTemplate","mentions","temp","replace","classNames","push","join","filterUser","username","filterTeam","name","mentionObj","filter","m","escapeHTML","channels","find","c","channel","_id"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/mentions/lib/MentionsParser.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a6ccf0440edc4fbb0cb25c5f7a5b20c3b9f34385","contentHash":"ae8b8436ec73588a440d73b4dc05435101a56528950b5dda7b6a94f71c37b84f"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/mentions/server/Mentions.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/mentions/server/Mentions.ts","statementMap":{"0":{"start":{"line":5,"column":0},"end":{"line":7,"column":3}},"1":{"start":{"line":8,"column":0},"end":{"line":13,"column":3}},"2":{"start":{"line":11,"column":8},"end":{"line":11,"column":30}},"3":{"start":{"line":14,"column":21},"end":{"line":14,"column":57}},"4":{"start":{"line":15,"column":24},"end":{"line":15,"column":56}},"5":{"start":{"line":16,"column":21},"end":{"line":67,"column":1}},"6":{"start":{"line":18,"column":53},"end":{"line":18,"column":60}},"7":{"start":{"line":19,"column":25},"end":{"line":19,"column":374}},"8":{"start":{"line":20,"column":28},"end":{"line":20,"column":30}},"9":{"start":{"line":21,"column":29},"end":{"line":21,"column":31}},"10":{"start":{"line":22,"column":8},"end":{"line":39,"column":9}},"11":{"start":{"line":23,"column":28},"end":{"line":23,"column":46}},"12":{"start":{"line":24,"column":12},"end":{"line":27,"column":13}},"13":{"start":{"line":25,"column":16},"end":{"line":25,"column":43}},"14":{"start":{"line":26,"column":16},"end":{"line":26,"column":25}},"15":{"start":{"line":28,"column":12},"end":{"line":34,"column":13}},"16":{"start":{"line":29,"column":16},"end":{"line":32,"column":19}},"17":{"start":{"line":33,"column":16},"end":{"line":33,"column":25}},"18":{"start":{"line":35,"column":12},"end":{"line":38,"column":15}},"19":{"start":{"line":40,"column":8},"end":{"line":43,"column":10}},"20":{"start":{"line":46,"column":37},"end":{"line":46,"column":44}},"21":{"start":{"line":47,"column":25},"end":{"line":47,"column":386}},"22":{"start":{"line":48,"column":8},"end":{"line":48,"column":71}},"23":{"start":{"line":48,"column":50},"end":{"line":48,"column":68}},"24":{"start":{"line":51,"column":28},"end":{"line":51,"column":66}},"25":{"start":{"line":52,"column":25},"end":{"line":52,"column":65}},"26":{"start":{"line":53,"column":8},"end":{"line":53,"column":39}},"27":{"start":{"line":54,"column":8},"end":{"line":54,"column":36}},"28":{"start":{"line":55,"column":8},"end":{"line":55,"column":23}},"29":{"start":{"line":58,"column":8},"end":{"line":58,"column":20}},"30":{"start":{"line":59,"column":8},"end":{"line":59,"column":48}},"31":{"start":{"line":60,"column":8},"end":{"line":60,"column":44}},"32":{"start":{"line":61,"column":8},"end":{"line":61,"column":38}},"33":{"start":{"line":62,"column":8},"end":{"line":62,"column":36}},"34":{"start":{"line":63,"column":8},"end":{"line":63,"column":66}},"35":{"start":{"line":64,"column":8},"end":{"line":65,"column":28}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":10,"column":9},"end":{"line":10,"column":10}},"loc":{"start":{"line":10,"column":20},"end":{"line":12,"column":5}},"line":10},"1":{"name":"(anonymous_1)","decl":{"start":{"line":17,"column":4},"end":{"line":17,"column":5}},"loc":{"start":{"line":17,"column":38},"end":{"line":44,"column":5}},"line":17},"2":{"name":"(anonymous_2)","decl":{"start":{"line":45,"column":4},"end":{"line":45,"column":5}},"loc":{"start":{"line":45,"column":40},"end":{"line":49,"column":5}},"line":45},"3":{"name":"(anonymous_3)","decl":{"start":{"line":48,"column":45},"end":{"line":48,"column":46}},"loc":{"start":{"line":48,"column":50},"end":{"line":48,"column":68}},"line":48},"4":{"name":"(anonymous_4)","decl":{"start":{"line":50,"column":4},"end":{"line":50,"column":5}},"loc":{"start":{"line":50,"column":27},"end":{"line":56,"column":5}},"line":50},"5":{"name":"(anonymous_5)","decl":{"start":{"line":57,"column":4},"end":{"line":57,"column":5}},"loc":{"start":{"line":57,"column":21},"end":{"line":66,"column":5}},"line":57},"6":{"name":"(anonymous_6)","decl":{"start":{"line":64,"column":74},"end":{"line":64,"column":75}},"loc":{"start":{"line":64,"column":78},"end":{"line":65,"column":26}},"line":64}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":25},"end":{"line":19,"column":374}},"type":"cond-expr","locations":[{"start":{"line":19,"column":261},"end":{"line":19,"column":346}},{"start":{"line":19,"column":349},"end":{"line":19,"column":374}}],"line":19},"1":{"loc":{"start":{"line":19,"column":25},"end":{"line":19,"column":258}},"type":"binary-expr","locations":[{"start":{"line":19,"column":25},"end":{"line":19,"column":65}},{"start":{"line":19,"column":70},"end":{"line":19,"column":155}},{"start":{"line":19,"column":160},"end":{"line":19,"column":258}}],"line":19},"2":{"loc":{"start":{"line":19,"column":70},"end":{"line":19,"column":155}},"type":"cond-expr","locations":[{"start":{"line":19,"column":119},"end":{"line":19,"column":125}},{"start":{"line":19,"column":128},"end":{"line":19,"column":155}}],"line":19},"3":{"loc":{"start":{"line":19,"column":70},"end":{"line":19,"column":116}},"type":"binary-expr","locations":[{"start":{"line":19,"column":70},"end":{"line":19,"column":90}},{"start":{"line":19,"column":94},"end":{"line":19,"column":116}}],"line":19},"4":{"loc":{"start":{"line":19,"column":161},"end":{"line":19,"column":253}},"type":"cond-expr","locations":[{"start":{"line":19,"column":210},"end":{"line":19,"column":216}},{"start":{"line":19,"column":219},"end":{"line":19,"column":253}}],"line":19},"5":{"loc":{"start":{"line":19,"column":161},"end":{"line":19,"column":207}},"type":"binary-expr","locations":[{"start":{"line":19,"column":161},"end":{"line":19,"column":181}},{"start":{"line":19,"column":185},"end":{"line":19,"column":207}}],"line":19},"6":{"loc":{"start":{"line":19,"column":261},"end":{"line":19,"column":346}},"type":"cond-expr","locations":[{"start":{"line":19,"column":310},"end":{"line":19,"column":316}},{"start":{"line":19,"column":319},"end":{"line":19,"column":346}}],"line":19},"7":{"loc":{"start":{"line":19,"column":261},"end":{"line":19,"column":307}},"type":"binary-expr","locations":[{"start":{"line":19,"column":261},"end":{"line":19,"column":281}},{"start":{"line":19,"column":285},"end":{"line":19,"column":307}}],"line":19},"8":{"loc":{"start":{"line":24,"column":12},"end":{"line":27,"column":13}},"type":"if","locations":[{"start":{"line":24,"column":12},"end":{"line":27,"column":13}},{"start":{"line":24,"column":12},"end":{"line":27,"column":13}}],"line":24},"9":{"loc":{"start":{"line":24,"column":16},"end":{"line":24,"column":55}},"type":"binary-expr","locations":[{"start":{"line":24,"column":16},"end":{"line":24,"column":33}},{"start":{"line":24,"column":37},"end":{"line":24,"column":55}}],"line":24},"10":{"loc":{"start":{"line":28,"column":12},"end":{"line":34,"column":13}},"type":"if","locations":[{"start":{"line":28,"column":12},"end":{"line":34,"column":13}},{"start":{"line":28,"column":12},"end":{"line":34,"column":13}}],"line":28},"11":{"loc":{"start":{"line":28,"column":16},"end":{"line":28,"column":105}},"type":"binary-expr","locations":[{"start":{"line":28,"column":16},"end":{"line":28,"column":40}},{"start":{"line":28,"column":44},"end":{"line":28,"column":105}}],"line":28},"12":{"loc":{"start":{"line":42,"column":15},"end":{"line":42,"column":75}},"type":"cond-expr","locations":[{"start":{"line":42,"column":37},"end":{"line":42,"column":70}},{"start":{"line":42,"column":73},"end":{"line":42,"column":75}}],"line":42},"13":{"loc":{"start":{"line":47,"column":25},"end":{"line":47,"column":386}},"type":"cond-expr","locations":[{"start":{"line":47,"column":267},"end":{"line":47,"column":355}},{"start":{"line":47,"column":358},"end":{"line":47,"column":386}}],"line":47},"14":{"loc":{"start":{"line":47,"column":25},"end":{"line":47,"column":264}},"type":"binary-expr","locations":[{"start":{"line":47,"column":25},"end":{"line":47,"column":65}},{"start":{"line":47,"column":70},"end":{"line":47,"column":158}},{"start":{"line":47,"column":163},"end":{"line":47,"column":264}}],"line":47},"15":{"loc":{"start":{"line":47,"column":70},"end":{"line":47,"column":158}},"type":"cond-expr","locations":[{"start":{"line":47,"column":119},"end":{"line":47,"column":125}},{"start":{"line":47,"column":128},"end":{"line":47,"column":158}}],"line":47},"16":{"loc":{"start":{"line":47,"column":70},"end":{"line":47,"column":116}},"type":"binary-expr","locations":[{"start":{"line":47,"column":70},"end":{"line":47,"column":90}},{"start":{"line":47,"column":94},"end":{"line":47,"column":116}}],"line":47},"17":{"loc":{"start":{"line":47,"column":164},"end":{"line":47,"column":259}},"type":"cond-expr","locations":[{"start":{"line":47,"column":213},"end":{"line":47,"column":219}},{"start":{"line":47,"column":222},"end":{"line":47,"column":259}}],"line":47},"18":{"loc":{"start":{"line":47,"column":164},"end":{"line":47,"column":210}},"type":"binary-expr","locations":[{"start":{"line":47,"column":164},"end":{"line":47,"column":184}},{"start":{"line":47,"column":188},"end":{"line":47,"column":210}}],"line":47},"19":{"loc":{"start":{"line":47,"column":267},"end":{"line":47,"column":355}},"type":"cond-expr","locations":[{"start":{"line":47,"column":316},"end":{"line":47,"column":322}},{"start":{"line":47,"column":325},"end":{"line":47,"column":355}}],"line":47},"20":{"loc":{"start":{"line":47,"column":267},"end":{"line":47,"column":313}},"type":"binary-expr","locations":[{"start":{"line":47,"column":267},"end":{"line":47,"column":287}},{"start":{"line":47,"column":291},"end":{"line":47,"column":313}}],"line":47},"21":{"loc":{"start":{"line":64,"column":40},"end":{"line":65,"column":27}},"type":"binary-expr","locations":[{"start":{"line":64,"column":40},"end":{"line":64,"column":69}},{"start":{"line":64,"column":74},"end":{"line":65,"column":26}}],"line":64}},"s":{"0":1,"1":1,"2":2197,"3":1,"4":1,"5":1,"6":9,"7":9,"8":9,"9":9,"10":9,"11":12,"12":12,"13":5,"14":5,"15":7,"16":1,"17":1,"18":6,"19":9,"20":4,"21":4,"22":4,"23":4,"24":1,"25":1,"26":1,"27":1,"28":1,"29":2197,"30":2197,"31":2197,"32":2197,"33":2197,"34":2197,"35":2197},"f":{"0":2197,"1":9,"2":4,"3":4,"4":1,"5":2197,"6":1},"b":{"0":[0,9],"1":[9,0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[5,7],"9":[12,9],"10":[1,6],"11":[7,7],"12":[4,5],"13":[0,4],"14":[4,0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[2197,2197]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/mentions/server/Mentions.ts"],"sourcesContent":["/*\n * Mentions is a named function that will process Mentions\n * @param {Object} message - The message object\n */\nimport { isE2EEMessage, type IMessage, type IRoom, type IUser } from '@rocket.chat/core-typings';\n\nimport { type MentionsParserArgs, MentionsParser } from '../lib/MentionsParser';\n\ntype MentionsServerArgs = MentionsParserArgs & {\n\tmessageMaxAll: () => number;\n\tgetChannels: (c: string[]) => Promise<Pick<IRoom, '_id' | 'name' | 'fname' | 'federated'>[]>;\n\tgetUsers: (u: string[]) => Promise<{ type: 'team' | 'user'; _id: string; username?: string; name?: string }[]>;\n\tgetUser: (u: string) => Promise<IUser | null>;\n\tgetTotalChannelMembers: (rid: string) => Promise<number>;\n\tonMaxRoomMembersExceeded: ({ sender, rid }: { sender: IMessage['u']; rid: string }) => Promise<void>;\n};\n\nexport class MentionsServer extends MentionsParser {\n\tmessageMaxAll: MentionsServerArgs['messageMaxAll'];\n\n\tgetChannels: MentionsServerArgs['getChannels'];\n\n\tgetUsers: MentionsServerArgs['getUsers'];\n\n\tgetUser: MentionsServerArgs['getUser'];\n\n\tgetTotalChannelMembers: MentionsServerArgs['getTotalChannelMembers'];\n\n\tonMaxRoomMembersExceeded: MentionsServerArgs['onMaxRoomMembersExceeded'];\n\n\tconstructor(args: MentionsServerArgs) {\n\t\tsuper(args);\n\n\t\tthis.messageMaxAll = args.messageMaxAll;\n\t\tthis.getChannels = args.getChannels;\n\t\tthis.getUsers = args.getUsers;\n\t\tthis.getUser = args.getUser;\n\t\tthis.getTotalChannelMembers = args.getTotalChannelMembers;\n\t\tthis.onMaxRoomMembersExceeded =\n\t\t\targs.onMaxRoomMembersExceeded ||\n\t\t\t(() => {\n\t\t\t\t/* do nothing */\n\t\t\t});\n\t}\n\n\tasync getUsersByMentions(message: IMessage): Promise<IMessage['mentions']> {\n\t\tconst { msg, rid, u: sender, e2eMentions }: Pick<IMessage, 'msg' | 'rid' | 'u' | 't' | 'e2eMentions'> = message;\n\n\t\tconst mentions =\n\t\t\tisE2EEMessage(message) && e2eMentions?.e2eUserMentions && e2eMentions?.e2eUserMentions.length > 0\n\t\t\t\t? e2eMentions?.e2eUserMentions\n\t\t\t\t: this.getUserMentions(msg);\n\t\tconst mentionsAll: { _id: string; username: string }[] = [];\n\t\tconst userMentions = [];\n\n\t\tfor await (const m of mentions) {\n\t\t\tconst mention = m.trim().substr(1);\n\t\t\tif (mention !== 'all' && mention !== 'here') {\n\t\t\t\tuserMentions.push(mention);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (this.messageMaxAll() > 0 && (await this.getTotalChannelMembers(rid)) > this.messageMaxAll()) {\n\t\t\t\tawait this.onMaxRoomMembersExceeded({ sender, rid });\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tmentionsAll.push({\n\t\t\t\t_id: mention,\n\t\t\t\tusername: mention,\n\t\t\t});\n\t\t}\n\n\t\treturn [...mentionsAll, ...(userMentions.length ? await this.getUsers(userMentions) : [])];\n\t}\n\n\tasync getChannelbyMentions(message: IMessage) {\n\t\tconst { msg, e2eMentions }: Pick<IMessage, 'msg' | 't' | 'e2eMentions'> = message;\n\n\t\tconst channels =\n\t\t\tisE2EEMessage(message) && e2eMentions?.e2eChannelMentions && e2eMentions?.e2eChannelMentions.length > 0\n\t\t\t\t? e2eMentions?.e2eChannelMentions\n\t\t\t\t: this.getChannelMentions(msg);\n\t\treturn this.getChannels(channels.map((c) => c.trim().substr(1)));\n\t}\n\n\tasync execute(message: IMessage) {\n\t\tconst mentionsAll = await this.getUsersByMentions(message);\n\t\tconst channels = await this.getChannelbyMentions(message);\n\n\t\tmessage.mentions = mentionsAll;\n\t\tmessage.channels = channels;\n\n\t\treturn message;\n\t}\n}\n"],"names":["MentionsServer","MentionsParser","getUsersByMentions","message","msg","rid","u","sender","e2eMentions","mentions","isE2EEMessage","e2eUserMentions","length","getUserMentions","mentionsAll","userMentions","m","mention","trim","substr","push","messageMaxAll","getTotalChannelMembers","onMaxRoomMembersExceeded","_id","username","getUsers","getChannelbyMentions","channels","e2eChannelMentions","getChannelMentions","getChannels","map","c","execute","constructor","args","getUser"],"mappings":"AAAA;;;CAGC;;;;+BAcYA;;;eAAAA;;;6BAbwD;gCAEb;AAWjD,IAAA,AAAMA,iBAAN,MAAMA,uBAAuBC,8BAAc;IA4BjD,MAAMC,mBAAmBC,OAAiB,EAAiC;QAC1E,MAAM,EAAEC,GAAG,EAAEC,GAAG,EAAEC,GAAGC,MAAM,EAAEC,WAAW,EAAE,GAA8DL;QAExG,MAAMM,WACLC,IAAAA,0BAAa,EAACP,aAAYK,wBAAAA,kCAAAA,YAAaG,eAAe,KAAIH,CAAAA,wBAAAA,kCAAAA,YAAaG,eAAe,CAACC,MAAM,IAAG,IAC7FJ,wBAAAA,kCAAAA,YAAaG,eAAe,GAC5B,IAAI,CAACE,eAAe,CAACT;QACzB,MAAMU,cAAmD,EAAE;QAC3D,MAAMC,eAAe,EAAE;QAEvB,WAAW,MAAMC,KAAKP,SAAU;YAC/B,MAAMQ,UAAUD,EAAEE,IAAI,GAAGC,MAAM,CAAC;YAChC,IAAIF,YAAY,SAASA,YAAY,QAAQ;gBAC5CF,aAAaK,IAAI,CAACH;gBAClB;YACD;YACA,IAAI,IAAI,CAACI,aAAa,KAAK,KAAK,AAAC,MAAM,IAAI,CAACC,sBAAsB,CAACjB,OAAQ,IAAI,CAACgB,aAAa,IAAI;gBAChG,MAAM,IAAI,CAACE,wBAAwB,CAAC;oBAAEhB;oBAAQF;gBAAI;gBAClD;YACD;YACAS,YAAYM,IAAI,CAAC;gBAChBI,KAAKP;gBACLQ,UAAUR;YACX;QACD;QAEA,OAAO;eAAIH;eAAiBC,aAAaH,MAAM,GAAG,MAAM,IAAI,CAACc,QAAQ,CAACX,gBAAgB,EAAE;SAAE;IAC3F;IAEA,MAAMY,qBAAqBxB,OAAiB,EAAE;QAC7C,MAAM,EAAEC,GAAG,EAAEI,WAAW,EAAE,GAAgDL;QAE1E,MAAMyB,WACLlB,IAAAA,0BAAa,EAACP,aAAYK,wBAAAA,kCAAAA,YAAaqB,kBAAkB,KAAIrB,CAAAA,wBAAAA,kCAAAA,YAAaqB,kBAAkB,CAACjB,MAAM,IAAG,IACnGJ,wBAAAA,kCAAAA,YAAaqB,kBAAkB,GAC/B,IAAI,CAACC,kBAAkB,CAAC1B;QAC5B,OAAO,IAAI,CAAC2B,WAAW,CAACH,SAASI,GAAG,CAAC,CAACC,IAAMA,EAAEf,IAAI,GAAGC,MAAM,CAAC;IAC7D;IAEA,MAAMe,QAAQ/B,OAAiB,EAAE;QAChC,MAAMW,cAAc,MAAM,IAAI,CAACZ,kBAAkB,CAACC;QAClD,MAAMyB,WAAW,MAAM,IAAI,CAACD,oBAAoB,CAACxB;QAEjDA,QAAQM,QAAQ,GAAGK;QACnBX,QAAQyB,QAAQ,GAAGA;QAEnB,OAAOzB;IACR;IA9DAgC,YAAYC,IAAwB,CAAE;QACrC,KAAK,CAACA;QAEN,IAAI,CAACf,aAAa,GAAGe,KAAKf,aAAa;QACvC,IAAI,CAACU,WAAW,GAAGK,KAAKL,WAAW;QACnC,IAAI,CAACL,QAAQ,GAAGU,KAAKV,QAAQ;QAC7B,IAAI,CAACW,OAAO,GAAGD,KAAKC,OAAO;QAC3B,IAAI,CAACf,sBAAsB,GAAGc,KAAKd,sBAAsB;QACzD,IAAI,CAACC,wBAAwB,GAC5Ba,KAAKb,wBAAwB,IAC5B,CAAA;QACA,cAAc,GACf,CAAA;IACF;AAkDD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/mentions/server/Mentions.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a24411d036c3fe501c55adcbb33c80fa9cb23969","contentHash":"91fc29310bdb95db6c28bab192f706c16bf322861b65cca507ffc038b3dd0dd8"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/statistics/server/lib/UAParserCustom.js":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/statistics/server/lib/UAParserCustom.js","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":31}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":30}},"6":{"start":{"line":19,"column":34},"end":{"line":19,"column":83}},"7":{"start":{"line":21,"column":4},"end":{"line":23,"column":6}},"8":{"start":{"line":25,"column":18},"end":{"line":47,"column":1}},"9":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"10":{"start":{"line":27,"column":8},"end":{"line":27,"column":22}},"11":{"start":{"line":29,"column":4},"end":{"line":45,"column":5}},"12":{"start":{"line":30,"column":8},"end":{"line":44,"column":9}},"13":{"start":{"line":31,"column":12},"end":{"line":31,"column":31}},"14":{"start":{"line":32,"column":15},"end":{"line":44,"column":9}},"15":{"start":{"line":33,"column":12},"end":{"line":35,"column":13}},"16":{"start":{"line":34,"column":16},"end":{"line":34,"column":33}},"17":{"start":{"line":36,"column":12},"end":{"line":36,"column":58}},"18":{"start":{"line":37,"column":15},"end":{"line":44,"column":9}},"19":{"start":{"line":38,"column":12},"end":{"line":40,"column":13}},"20":{"start":{"line":39,"column":16},"end":{"line":39,"column":33}},"21":{"start":{"line":41,"column":12},"end":{"line":41,"column":48}},"22":{"start":{"line":43,"column":12},"end":{"line":43,"column":38}},"23":{"start":{"line":46,"column":4},"end":{"line":46,"column":18}},"24":{"start":{"line":48,"column":23},"end":{"line":126,"column":1}},"25":{"start":{"line":65,"column":16},"end":{"line":67,"column":17}},"26":{"start":{"line":66,"column":20},"end":{"line":66,"column":56}},"27":{"start":{"line":68,"column":16},"end":{"line":70,"column":17}},"28":{"start":{"line":69,"column":20},"end":{"line":69,"column":52}},"29":{"start":{"line":71,"column":16},"end":{"line":71,"column":29}},"30":{"start":{"line":76,"column":8},"end":{"line":78,"column":9}},"31":{"start":{"line":77,"column":12},"end":{"line":77,"column":25}},"32":{"start":{"line":79,"column":24},"end":{"line":79,"column":56}},"33":{"start":{"line":80,"column":8},"end":{"line":80,"column":75}},"34":{"start":{"line":87,"column":8},"end":{"line":89,"column":9}},"35":{"start":{"line":88,"column":12},"end":{"line":88,"column":22}},"36":{"start":{"line":90,"column":24},"end":{"line":90,"column":56}},"37":{"start":{"line":91,"column":18},"end":{"line":98,"column":9}},"38":{"start":{"line":99,"column":8},"end":{"line":99,"column":24}},"39":{"start":{"line":100,"column":8},"end":{"line":102,"column":9}},"40":{"start":{"line":101,"column":12},"end":{"line":101,"column":23}},"41":{"start":{"line":103,"column":8},"end":{"line":123,"column":11}},"42":{"start":{"line":104,"column":31},"end":{"line":104,"column":56}},"43":{"start":{"line":105,"column":24},"end":{"line":105,"column":54}},"44":{"start":{"line":106,"column":12},"end":{"line":108,"column":13}},"45":{"start":{"line":107,"column":16},"end":{"line":107,"column":23}},"46":{"start":{"line":109,"column":26},"end":{"line":109,"column":41}},"47":{"start":{"line":110,"column":12},"end":{"line":112,"column":13}},"48":{"start":{"line":111,"column":16},"end":{"line":111,"column":23}},"49":{"start":{"line":113,"column":29},"end":{"line":113,"column":31}},"50":{"start":{"line":114,"column":12},"end":{"line":119,"column":15}},"51":{"start":{"line":115,"column":16},"end":{"line":118,"column":17}},"52":{"start":{"line":116,"column":37},"end":{"line":116,"column":52}},"53":{"start":{"line":117,"column":20},"end":{"line":117,"column":88}},"54":{"start":{"line":120,"column":25},"end":{"line":120,"column":27}},"55":{"start":{"line":121,"column":12},"end":{"line":121,"column":33}},"56":{"start":{"line":122,"column":12},"end":{"line":122,"column":39}},"57":{"start":{"line":124,"column":8},"end":{"line":124,"column":19}},"58":{"start":{"line":127,"column":24},"end":{"line":157,"column":1}},"59":{"start":{"line":130,"column":8},"end":{"line":132,"column":9}},"60":{"start":{"line":131,"column":12},"end":{"line":131,"column":25}},"61":{"start":{"line":133,"column":8},"end":{"line":133,"column":47}},"62":{"start":{"line":140,"column":8},"end":{"line":142,"column":9}},"63":{"start":{"line":141,"column":12},"end":{"line":141,"column":22}},"64":{"start":{"line":143,"column":19},"end":{"line":143,"column":52}},"65":{"start":{"line":144,"column":25},"end":{"line":144,"column":39}},"66":{"start":{"line":145,"column":34},"end":{"line":145,"column":87}},"67":{"start":{"line":146,"column":8},"end":{"line":155,"column":10}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":21},"end":{"line":12,"column":22}},"loc":{"start":{"line":12,"column":32},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":20},"end":{"line":15,"column":21}},"loc":{"start":{"line":15,"column":31},"end":{"line":17,"column":5}},"line":15},"3":{"name":"_interop_require_default","decl":{"start":{"line":20,"column":9},"end":{"line":20,"column":33}},"loc":{"start":{"line":20,"column":39},"end":{"line":24,"column":1}},"line":20},"4":{"name":"(anonymous_4)","decl":{"start":{"line":25,"column":18},"end":{"line":25,"column":19}},"loc":{"start":{"line":25,"column":36},"end":{"line":47,"column":1}},"line":25},"5":{"name":"(anonymous_5)","decl":{"start":{"line":64,"column":17},"end":{"line":64,"column":18}},"loc":{"start":{"line":64,"column":32},"end":{"line":72,"column":13}},"line":64},"6":{"name":"(anonymous_6)","decl":{"start":{"line":75,"column":4},"end":{"line":75,"column":5}},"loc":{"start":{"line":75,"column":27},"end":{"line":81,"column":5}},"line":75},"7":{"name":"(anonymous_7)","decl":{"start":{"line":86,"column":5},"end":{"line":86,"column":6}},"loc":{"start":{"line":86,"column":25},"end":{"line":125,"column":5}},"line":86},"8":{"name":"(anonymous_8)","decl":{"start":{"line":103,"column":24},"end":{"line":103,"column":25}},"loc":{"start":{"line":103,"column":42},"end":{"line":123,"column":9}},"line":103},"9":{"name":"(anonymous_9)","decl":{"start":{"line":114,"column":31},"end":{"line":114,"column":32}},"loc":{"start":{"line":114,"column":45},"end":{"line":119,"column":13}},"line":114},"10":{"name":"(anonymous_10)","decl":{"start":{"line":129,"column":4},"end":{"line":129,"column":5}},"loc":{"start":{"line":129,"column":28},"end":{"line":134,"column":5}},"line":129},"11":{"name":"(anonymous_11)","decl":{"start":{"line":139,"column":5},"end":{"line":139,"column":6}},"loc":{"start":{"line":139,"column":25},"end":{"line":156,"column":5}},"line":139}},"branchMap":{"0":{"loc":{"start":{"line":21,"column":11},"end":{"line":23,"column":5}},"type":"cond-expr","locations":[{"start":{"line":21,"column":35},"end":{"line":21,"column":38}},{"start":{"line":21,"column":41},"end":{"line":23,"column":5}}],"line":21},"1":{"loc":{"start":{"line":21,"column":11},"end":{"line":21,"column":32}},"type":"binary-expr","locations":[{"start":{"line":21,"column":11},"end":{"line":21,"column":14}},{"start":{"line":21,"column":18},"end":{"line":21,"column":32}}],"line":21},"2":{"loc":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"type":"if","locations":[{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},{"start":{"line":26,"column":4},"end":{"line":28,"column":5}}],"line":26},"3":{"loc":{"start":{"line":26,"column":10},"end":{"line":26,"column":66}},"type":"binary-expr","locations":[{"start":{"line":26,"column":10},"end":{"line":26,"column":36}},{"start":{"line":26,"column":40},"end":{"line":26,"column":66}}],"line":26},"4":{"loc":{"start":{"line":30,"column":8},"end":{"line":44,"column":9}},"type":"if","locations":[{"start":{"line":30,"column":8},"end":{"line":44,"column":9}},{"start":{"line":30,"column":8},"end":{"line":44,"column":9}}],"line":30},"5":{"loc":{"start":{"line":30,"column":12},"end":{"line":30,"column":87}},"type":"binary-expr","locations":[{"start":{"line":30,"column":12},"end":{"line":30,"column":32}},{"start":{"line":30,"column":37},"end":{"line":30,"column":62}},{"start":{"line":30,"column":66},"end":{"line":30,"column":86}}],"line":30},"6":{"loc":{"start":{"line":32,"column":15},"end":{"line":44,"column":9}},"type":"if","locations":[{"start":{"line":32,"column":15},"end":{"line":44,"column":9}},{"start":{"line":32,"column":15},"end":{"line":44,"column":9}}],"line":32},"7":{"loc":{"start":{"line":33,"column":12},"end":{"line":35,"column":13}},"type":"if","locations":[{"start":{"line":33,"column":12},"end":{"line":35,"column":13}},{"start":{"line":33,"column":12},"end":{"line":35,"column":13}}],"line":33},"8":{"loc":{"start":{"line":37,"column":15},"end":{"line":44,"column":9}},"type":"if","locations":[{"start":{"line":37,"column":15},"end":{"line":44,"column":9}},{"start":{"line":37,"column":15},"end":{"line":44,"column":9}}],"line":37},"9":{"loc":{"start":{"line":38,"column":12},"end":{"line":40,"column":13}},"type":"if","locations":[{"start":{"line":38,"column":12},"end":{"line":40,"column":13}},{"start":{"line":38,"column":12},"end":{"line":40,"column":13}}],"line":38},"10":{"loc":{"start":{"line":65,"column":16},"end":{"line":67,"column":17}},"type":"if","locations":[{"start":{"line":65,"column":16},"end":{"line":67,"column":17}},{"start":{"line":65,"column":16},"end":{"line":67,"column":17}}],"line":65},"11":{"loc":{"start":{"line":68,"column":16},"end":{"line":70,"column":17}},"type":"if","locations":[{"start":{"line":68,"column":16},"end":{"line":70,"column":17}},{"start":{"line":68,"column":16},"end":{"line":70,"column":17}}],"line":68},"12":{"loc":{"start":{"line":76,"column":8},"end":{"line":78,"column":9}},"type":"if","locations":[{"start":{"line":76,"column":8},"end":{"line":78,"column":9}},{"start":{"line":76,"column":8},"end":{"line":78,"column":9}}],"line":76},"13":{"loc":{"start":{"line":76,"column":12},"end":{"line":76,"column":53}},"type":"binary-expr","locations":[{"start":{"line":76,"column":12},"end":{"line":76,"column":21}},{"start":{"line":76,"column":25},"end":{"line":76,"column":53}}],"line":76},"14":{"loc":{"start":{"line":80,"column":15},"end":{"line":80,"column":74}},"type":"binary-expr","locations":[{"start":{"line":80,"column":15},"end":{"line":80,"column":22}},{"start":{"line":80,"column":26},"end":{"line":80,"column":36}},{"start":{"line":80,"column":40},"end":{"line":80,"column":74}}],"line":80},"15":{"loc":{"start":{"line":87,"column":8},"end":{"line":89,"column":9}},"type":"if","locations":[{"start":{"line":87,"column":8},"end":{"line":89,"column":9}},{"start":{"line":87,"column":8},"end":{"line":89,"column":9}}],"line":87},"16":{"loc":{"start":{"line":100,"column":8},"end":{"line":102,"column":9}},"type":"if","locations":[{"start":{"line":100,"column":8},"end":{"line":102,"column":9}},{"start":{"line":100,"column":8},"end":{"line":102,"column":9}}],"line":100},"17":{"loc":{"start":{"line":106,"column":12},"end":{"line":108,"column":13}},"type":"if","locations":[{"start":{"line":106,"column":12},"end":{"line":108,"column":13}},{"start":{"line":106,"column":12},"end":{"line":108,"column":13}}],"line":106},"18":{"loc":{"start":{"line":110,"column":12},"end":{"line":112,"column":13}},"type":"if","locations":[{"start":{"line":110,"column":12},"end":{"line":112,"column":13}},{"start":{"line":110,"column":12},"end":{"line":112,"column":13}}],"line":110},"19":{"loc":{"start":{"line":110,"column":16},"end":{"line":110,"column":84}},"type":"binary-expr","locations":[{"start":{"line":110,"column":16},"end":{"line":110,"column":27}},{"start":{"line":110,"column":31},"end":{"line":110,"column":57}},{"start":{"line":110,"column":61},"end":{"line":110,"column":84}}],"line":110},"20":{"loc":{"start":{"line":115,"column":16},"end":{"line":118,"column":17}},"type":"if","locations":[{"start":{"line":115,"column":16},"end":{"line":118,"column":17}},{"start":{"line":115,"column":16},"end":{"line":118,"column":17}}],"line":115},"21":{"loc":{"start":{"line":117,"column":41},"end":{"line":117,"column":87}},"type":"cond-expr","locations":[{"start":{"line":117,"column":53},"end":{"line":117,"column":79}},{"start":{"line":117,"column":82},"end":{"line":117,"column":87}}],"line":117},"22":{"loc":{"start":{"line":130,"column":8},"end":{"line":132,"column":9}},"type":"if","locations":[{"start":{"line":130,"column":8},"end":{"line":132,"column":9}},{"start":{"line":130,"column":8},"end":{"line":132,"column":9}}],"line":130},"23":{"loc":{"start":{"line":130,"column":12},"end":{"line":130,"column":53}},"type":"binary-expr","locations":[{"start":{"line":130,"column":12},"end":{"line":130,"column":21}},{"start":{"line":130,"column":25},"end":{"line":130,"column":53}}],"line":130},"24":{"loc":{"start":{"line":140,"column":8},"end":{"line":142,"column":9}},"type":"if","locations":[{"start":{"line":140,"column":8},"end":{"line":142,"column":9}},{"start":{"line":140,"column":8},"end":{"line":142,"column":9}}],"line":140},"25":{"loc":{"start":{"line":145,"column":34},"end":{"line":145,"column":87}},"type":"binary-expr","locations":[{"start":{"line":145,"column":34},"end":{"line":145,"column":81}},{"start":{"line":145,"column":85},"end":{"line":145,"column":87}}],"line":145}},"s":{"0":1,"1":1,"2":2,"3":1,"4":4,"5":4,"6":1,"7":1,"8":1,"9":4,"10":0,"11":4,"12":6,"13":0,"14":6,"15":0,"16":0,"17":0,"18":6,"19":2,"20":1,"21":2,"22":4,"23":4,"24":1,"25":2,"26":1,"27":1,"28":1,"29":0,"30":4,"31":0,"32":4,"33":4,"34":1,"35":0,"36":1,"37":1,"38":1,"39":1,"40":0,"41":1,"42":2,"43":2,"44":2,"45":0,"46":2,"47":2,"48":0,"49":2,"50":2,"51":4,"52":4,"53":4,"54":2,"55":2,"56":2,"57":1,"58":1,"59":4,"60":0,"61":4,"62":1,"63":0,"64":1,"65":1,"66":1,"67":1},"f":{"0":1,"1":4,"2":4,"3":1,"4":4,"5":2,"6":4,"7":1,"8":2,"9":4,"10":4,"11":1},"b":{"0":[0,1],"1":[1,1],"2":[0,4],"3":[4,4],"4":[0,6],"5":[6,0,0],"6":[0,6],"7":[0,0],"8":[2,4],"9":[1,1],"10":[1,1],"11":[1,0],"12":[0,4],"13":[4,4],"14":[4,4,4],"15":[0,1],"16":[0,1],"17":[0,2],"18":[0,2],"19":[2,2,2],"20":[4,0],"21":[2,2],"22":[0,4],"23":[4,4],"24":[0,1],"25":[1,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/statistics/server/lib/UAParserCustom.js"],"sourcesContent":["import UAParser from 'ua-parser-js';\n\nconst mergeDeep = (target, source) => {\n\tif (!(typeof target === 'object' && typeof source === 'object')) {\n\t\treturn target;\n\t}\n\n\tfor (const key in source) {\n\t\tif (source[key] === null && (target[key] === undefined || target[key] === null)) {\n\t\t\ttarget[key] = null;\n\t\t} else if (source[key] instanceof Array) {\n\t\t\tif (!target[key]) {\n\t\t\t\ttarget[key] = [];\n\t\t\t}\n\t\t\ttarget[key] = target[key].concat(source[key]);\n\t\t} else if (typeof source[key] === 'object') {\n\t\t\tif (!target[key]) {\n\t\t\t\ttarget[key] = {};\n\t\t\t}\n\t\t\tmergeDeep(target[key], source[key]);\n\t\t} else {\n\t\t\ttarget[key] = source[key];\n\t\t}\n\t}\n\n\treturn target;\n};\n\nexport const UAParserMobile = {\n\tappName: 'RC Mobile',\n\tdevice: 'mobile-app',\n\tuaSeparator: ';',\n\tprops: {\n\t\tos: {\n\t\t\tlist: ['name', 'version'],\n\t\t},\n\t\tapp: {\n\t\t\tlist: ['version', 'bundle'],\n\t\t\tget: (prop, value) => {\n\t\t\t\tif (prop === 'bundle') {\n\t\t\t\t\treturn value.replace(/([()])/g, '');\n\t\t\t\t}\n\n\t\t\t\tif (prop === 'version') {\n\t\t\t\t\treturn value.replace(/^v/g, '');\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t},\n\t\t},\n\t},\n\n\tisMobileApp(uaString) {\n\t\tif (!uaString || typeof uaString !== 'string') {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst splitUA = uaString.split(this.uaSeparator);\n\t\treturn splitUA && splitUA[0] && splitUA[0].trim() === this.appName;\n\t},\n\n\t/**\n\t *\n\t * @param {string} uaString\n\t * @returns { device: { type: '' }, app: { name: '', version: '' } }\n\t */\n\tuaObject(uaString) {\n\t\tif (!this.isMobileApp(uaString)) {\n\t\t\treturn {};\n\t\t}\n\n\t\tconst splitUA = uaString.split(this.uaSeparator);\n\n\t\tlet obj = {\n\t\t\tdevice: {\n\t\t\t\ttype: this.device,\n\t\t\t},\n\t\t\tapp: {\n\t\t\t\tname: splitUA[0],\n\t\t\t},\n\t\t};\n\n\t\tsplitUA.shift(); // remove first element\n\t\tif (splitUA.length === 0) {\n\t\t\treturn obj;\n\t\t}\n\n\t\tsplitUA.forEach((element, index) => {\n\t\t\tconst splitProps = element.trim().split(' ');\n\t\t\tconst key = Object.keys(this.props)[index];\n\t\t\tif (!key) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst props = this.props[key];\n\t\t\tif (!props.list || !Array.isArray(props.list) || props.list.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst subProps = {};\n\t\t\tsplitProps.forEach((value, idx) => {\n\t\t\t\tif (props.list.length > idx) {\n\t\t\t\t\tconst propName = props.list[idx];\n\t\t\t\t\tsubProps[propName] = props.get ? props.get(propName, value) : value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst prop = {};\n\t\t\tprop[key] = subProps;\n\t\t\tobj = mergeDeep(obj, prop);\n\t\t});\n\n\t\treturn obj;\n\t},\n};\n\nexport const UAParserDesktop = {\n\tdevice: 'desktop-app',\n\n\tisDesktopApp(uaString) {\n\t\tif (!uaString || typeof uaString !== 'string') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn uaString.includes(' Electron/');\n\t},\n\n\t/**\n\t *\n\t * @param {string} uaString\n\t * @returns { device: { type: '' }, os: '' || {}, app: { name: '', version: '' } }\n\t */\n\tuaObject(uaString) {\n\t\tif (!this.isDesktopApp(uaString)) {\n\t\t\treturn {};\n\t\t}\n\n\t\tconst ua = new UAParser(uaString);\n\t\tconst uaParsed = ua.getResult();\n\n\t\tconst [, name, version] = uaString.match(/(Rocket\\.Chat)\\/(\\d+(\\.\\d+)+)/) || [];\n\n\t\treturn {\n\t\t\tdevice: {\n\t\t\t\ttype: this.device,\n\t\t\t},\n\t\t\tos: uaParsed.os,\n\t\t\tapp: {\n\t\t\t\tname,\n\t\t\t\tversion,\n\t\t\t},\n\t\t};\n\t},\n};\n"],"names":["UAParserDesktop","UAParserMobile","mergeDeep","target","source","key","undefined","Array","concat","appName","device","uaSeparator","props","os","list","app","get","prop","value","replace","isMobileApp","uaString","splitUA","split","trim","uaObject","obj","type","name","shift","length","forEach","element","index","splitProps","Object","keys","isArray","subProps","idx","propName","isDesktopApp","includes","ua","UAParser","uaParsed","getResult","version","match"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/statistics/server/lib/UAParserCustom.js"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8f907fcc7bf26e85f3ab8203750ccf2165ecd4b5","contentHash":"e86731794574e18d28dc3db648e08a26c6eed043142b1e8a0c9cfde706b064ed"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/getURL.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/getURL.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":23}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":37}},"6":{"start":{"line":19,"column":23},"end":{"line":19,"column":61}},"7":{"start":{"line":20,"column":15},"end":{"line":20,"column":50}},"8":{"start":{"line":21,"column":21},"end":{"line":21,"column":62}},"9":{"start":{"line":24,"column":25},"end":{"line":24,"column":56}},"10":{"start":{"line":25,"column":20},"end":{"line":25,"column":59}},"11":{"start":{"line":27,"column":17},"end":{"line":27,"column":53}},"12":{"start":{"line":28,"column":4},"end":{"line":28,"column":46}},"13":{"start":{"line":29,"column":4},"end":{"line":32,"column":7}},"14":{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},"15":{"start":{"line":34,"column":8},"end":{"line":34,"column":34}},"16":{"start":{"line":36,"column":19},"end":{"line":36,"column":115}},"17":{"start":{"line":36,"column":67},"end":{"line":36,"column":104}},"18":{"start":{"line":37,"column":4},"end":{"line":37,"column":53}},"19":{"start":{"line":39,"column":16},"end":{"line":64,"column":1}},"20":{"start":{"line":41,"column":4},"end":{"line":43,"column":5}},"21":{"start":{"line":42,"column":8},"end":{"line":42,"column":20}},"22":{"start":{"line":44,"column":28},"end":{"line":44,"column":43}},"23":{"start":{"line":45,"column":4},"end":{"line":45,"column":17}},"24":{"start":{"line":46,"column":18},"end":{"line":46,"column":44}},"25":{"start":{"line":47,"column":20},"end":{"line":47,"column":89}},"26":{"start":{"line":48,"column":23},"end":{"line":48,"column":64}},"27":{"start":{"line":49,"column":22},"end":{"line":49,"column":93}},"28":{"start":{"line":50,"column":23},"end":{"line":50,"column":104}},"29":{"start":{"line":51,"column":22},"end":{"line":51,"column":80}},"30":{"start":{"line":52,"column":16},"end":{"line":52,"column":82}},"31":{"start":{"line":53,"column":4},"end":{"line":56,"column":5}},"32":{"start":{"line":54,"column":28},"end":{"line":54,"column":46}},"33":{"start":{"line":55,"column":8},"end":{"line":55,"column":79}},"34":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"35":{"start":{"line":58,"column":8},"end":{"line":58,"column":31}},"36":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"37":{"start":{"line":61,"column":8},"end":{"line":61,"column":105}},"38":{"start":{"line":63,"column":4},"end":{"line":63,"column":15}},"39":{"start":{"line":65,"column":30},"end":{"line":75,"column":24}},"40":{"start":{"line":66,"column":121},"end":{"line":75,"column":24}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":13},"end":{"line":12,"column":14}},"loc":{"start":{"line":12,"column":24},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":27},"end":{"line":15,"column":28}},"loc":{"start":{"line":15,"column":38},"end":{"line":17,"column":5}},"line":15},"3":{"name":"getCloudUrl","decl":{"start":{"line":22,"column":9},"end":{"line":22,"column":20}},"loc":{"start":{"line":23,"column":59},"end":{"line":38,"column":1}},"line":23},"4":{"name":"(anonymous_4)","decl":{"start":{"line":36,"column":51},"end":{"line":36,"column":52}},"loc":{"start":{"line":36,"column":67},"end":{"line":36,"column":104}},"line":36},"5":{"name":"(anonymous_5)","decl":{"start":{"line":39,"column":16},"end":{"line":39,"column":17}},"loc":{"start":{"line":40,"column":110},"end":{"line":64,"column":1}},"line":40},"6":{"name":"(anonymous_6)","decl":{"start":{"line":65,"column":30},"end":{"line":65,"column":31}},"loc":{"start":{"line":66,"column":121},"end":{"line":75,"column":24}},"line":66}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":23},"end":{"line":23,"column":39}},"type":"default-arg","locations":[{"start":{"line":23,"column":37},"end":{"line":23,"column":39}}],"line":23},"1":{"loc":{"start":{"line":23,"column":41},"end":{"line":23,"column":57}},"type":"default-arg","locations":[{"start":{"line":23,"column":55},"end":{"line":23,"column":57}}],"line":23},"2":{"loc":{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},"type":"if","locations":[{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},{"start":{"line":33,"column":4},"end":{"line":35,"column":5}}],"line":33},"3":{"loc":{"start":{"line":41,"column":4},"end":{"line":43,"column":5}},"type":"if","locations":[{"start":{"line":41,"column":4},"end":{"line":43,"column":5}},{"start":{"line":41,"column":4},"end":{"line":43,"column":5}}],"line":41},"4":{"loc":{"start":{"line":46,"column":18},"end":{"line":46,"column":44}},"type":"cond-expr","locations":[{"start":{"line":46,"column":27},"end":{"line":46,"column":39}},{"start":{"line":46,"column":42},"end":{"line":46,"column":44}}],"line":46},"5":{"loc":{"start":{"line":47,"column":67},"end":{"line":47,"column":82}},"type":"binary-expr","locations":[{"start":{"line":47,"column":67},"end":{"line":47,"column":76}},{"start":{"line":47,"column":80},"end":{"line":47,"column":82}}],"line":47},"6":{"loc":{"start":{"line":48,"column":46},"end":{"line":48,"column":63}},"type":"binary-expr","locations":[{"start":{"line":48,"column":46},"end":{"line":48,"column":57}},{"start":{"line":48,"column":61},"end":{"line":48,"column":63}}],"line":48},"7":{"loc":{"start":{"line":49,"column":69},"end":{"line":49,"column":86}},"type":"binary-expr","locations":[{"start":{"line":49,"column":69},"end":{"line":49,"column":80}},{"start":{"line":49,"column":84},"end":{"line":49,"column":86}}],"line":49},"8":{"loc":{"start":{"line":50,"column":70},"end":{"line":50,"column":97}},"type":"binary-expr","locations":[{"start":{"line":50,"column":70},"end":{"line":50,"column":91}},{"start":{"line":50,"column":95},"end":{"line":50,"column":97}}],"line":50},"9":{"loc":{"start":{"line":53,"column":4},"end":{"line":56,"column":5}},"type":"if","locations":[{"start":{"line":53,"column":4},"end":{"line":56,"column":5}},{"start":{"line":53,"column":4},"end":{"line":56,"column":5}}],"line":53},"10":{"loc":{"start":{"line":54,"column":28},"end":{"line":54,"column":46}},"type":"binary-expr","locations":[{"start":{"line":54,"column":28},"end":{"line":54,"column":40}},{"start":{"line":54,"column":44},"end":{"line":54,"column":46}}],"line":54},"11":{"loc":{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},"type":"if","locations":[{"start":{"line":57,"column":4},"end":{"line":59,"column":5}},{"start":{"line":57,"column":4},"end":{"line":59,"column":5}}],"line":57},"12":{"loc":{"start":{"line":57,"column":8},"end":{"line":57,"column":31}},"type":"binary-expr","locations":[{"start":{"line":57,"column":8},"end":{"line":57,"column":11}},{"start":{"line":57,"column":15},"end":{"line":57,"column":31}}],"line":57},"13":{"loc":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"type":"if","locations":[{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},{"start":{"line":60,"column":4},"end":{"line":62,"column":5}}],"line":60},"14":{"loc":{"start":{"line":66,"column":2},"end":{"line":66,"column":12}},"type":"default-arg","locations":[{"start":{"line":66,"column":8},"end":{"line":66,"column":12}}],"line":66},"15":{"loc":{"start":{"line":66,"column":14},"end":{"line":66,"column":26}},"type":"default-arg","locations":[{"start":{"line":66,"column":21},"end":{"line":66,"column":26}}],"line":66},"16":{"loc":{"start":{"line":66,"column":28},"end":{"line":66,"column":41}},"type":"default-arg","locations":[{"start":{"line":66,"column":36},"end":{"line":66,"column":41}}],"line":66},"17":{"loc":{"start":{"line":66,"column":43},"end":{"line":66,"column":59}},"type":"default-arg","locations":[{"start":{"line":66,"column":57},"end":{"line":66,"column":59}}],"line":66},"18":{"loc":{"start":{"line":66,"column":61},"end":{"line":66,"column":78}},"type":"default-arg","locations":[{"start":{"line":66,"column":76},"end":{"line":66,"column":78}}],"line":66}},"s":{"0":1,"1":1,"2":2,"3":1,"4":1,"5":0,"6":1,"7":1,"8":1,"9":77,"10":77,"11":77,"12":77,"13":77,"14":77,"15":66,"16":77,"17":220,"18":77,"19":1,"20":297,"21":0,"22":297,"23":297,"24":297,"25":297,"26":297,"27":297,"28":297,"29":297,"30":297,"31":297,"32":77,"33":77,"34":220,"35":66,"36":154,"37":77,"38":77,"39":1,"40":0},"f":{"0":1,"1":1,"2":0,"3":77,"4":220,"5":297,"6":0},"b":{"0":[0],"1":[0],"2":[66,11],"3":[0,297],"4":[54,243],"5":[297,0],"6":[297,297],"7":[297,132],"8":[297,187],"9":[77,220],"10":[77,77],"11":[66,154],"12":[220,110],"13":[77,77],"14":[0],"15":[0],"16":[0],"17":[0],"18":[0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/getURL.ts"],"sourcesContent":["import { escapeRegExp } from '@rocket.chat/string-helpers';\n\nimport { isURL } from '../../../lib/utils/isURL';\nimport { ltrim, rtrim, trim } from '../../../lib/utils/stringUtils';\n\nfunction getCloudUrl(\n\tpath: string,\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\t_site_url: string,\n\tcloudRoute: string,\n\tcloudParams: Record<string, string> = {},\n\tdeeplinkUrl = '',\n): string {\n\tconst cloudBaseUrl = deeplinkUrl.replace(/\\/+$/, '');\n\n\tconst siteUrl = rtrim(_site_url, '/');\n\n\t// Remove the protocol\n\tconst host = siteUrl.replace(/https?\\:\\/\\//i, '');\n\tpath = ltrim(path, '/');\n\n\tObject.assign(cloudParams, {\n\t\thost,\n\t\tpath,\n\t});\n\n\tif (siteUrl.includes('http://')) {\n\t\tcloudParams.secure = 'no';\n\t}\n\n\tconst params = Object.entries(cloudParams)\n\t\t.map(([key, value]) => `${key}=${encodeURIComponent(value)}`)\n\t\t.join('&');\n\n\treturn `${cloudBaseUrl}/${cloudRoute}?${params}`;\n}\n\nexport const _getURL = (\n\tpath: string,\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\t{ cdn, full, cloud, cloud_route, cloud_params, _cdn_prefix, _root_url_path_prefix, _site_url }: Record<string, any>,\n\tdeeplinkUrl?: string,\n): string => {\n\tif (isURL(path)) {\n\t\treturn path;\n\t}\n\n\tconst [_path, _query] = path.split('?');\n\tpath = _path;\n\tconst query = _query ? `?${_query}` : '';\n\n\tconst siteUrl = rtrim(trim(_site_url || ''), '/');\n\tconst cloudRoute = trim(cloud_route || '');\n\tconst cdnPrefix = rtrim(trim(_cdn_prefix || ''), '/');\n\tconst pathPrefix = rtrim(trim(_root_url_path_prefix || ''), '/');\n\n\tconst finalPath = ltrim(trim(path), '/');\n\n\tconst url = rtrim(`${pathPrefix}/${finalPath}`, '/') + query;\n\n\tif (cloud) {\n\t\tconst cloudParams = cloud_params || {};\n\t\treturn getCloudUrl(url, siteUrl, cloudRoute, cloudParams, deeplinkUrl);\n\t}\n\n\tif (cdn && cdnPrefix !== '') {\n\t\treturn cdnPrefix + url;\n\t}\n\n\tif (full) {\n\t\treturn siteUrl.replace(new RegExp(`${escapeRegExp(pathPrefix)}$`), '') + url;\n\t}\n\n\treturn url;\n};\n\nexport const getURLWithoutSettings = (\n\tpath: string,\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\t{\n\t\tcdn = true,\n\t\tfull = false,\n\t\tcloud = false,\n\t\tcloud_route = '',\n\t\tcloud_params = {},\n\t}: {\n\t\tcdn?: boolean;\n\t\tfull?: boolean;\n\t\tcloud?: boolean;\n\t\tcloud_route?: string;\n\t\tcloud_params?: Record<string, string>;\n\t},\n\tcdnPrefix: string,\n\tsiteUrl: string,\n\tcloudDeepLinkUrl?: string,\n): string =>\n\t_getURL(\n\t\tpath,\n\t\t{\n\t\t\tcdn,\n\t\t\tfull,\n\t\t\tcloud,\n\t\t\tcloud_route,\n\t\t\tcloud_params,\n\t\t\t_cdn_prefix: cdnPrefix,\n\t\t\t_root_url_path_prefix: __meteor_runtime_config__.ROOT_URL_PATH_PREFIX,\n\t\t\t_site_url: siteUrl,\n\t\t},\n\t\tcloudDeepLinkUrl,\n\t);\n"],"names":["_getURL","getURLWithoutSettings","getCloudUrl","path","_site_url","cloudRoute","cloudParams","deeplinkUrl","cloudBaseUrl","replace","siteUrl","rtrim","host","ltrim","Object","assign","includes","secure","params","entries","map","key","value","encodeURIComponent","join","cdn","full","cloud","cloud_route","cloud_params","_cdn_prefix","_root_url_path_prefix","isURL","_path","_query","split","query","trim","cdnPrefix","pathPrefix","finalPath","url","RegExp","escapeRegExp","cloudDeepLinkUrl","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX"],"mappings":";;;;;;;;;;;IAqCaA,OAAO;eAAPA;;IAuCAC,qBAAqB;eAArBA;;;+BA5EgB;uBAEP;6BACa;AAEnC,SAASC,YACRC,IAAY,EACZ,gEAAgE;AAChEC,SAAiB,EACjBC,UAAkB,EAClBC,cAAsC,CAAC,CAAC,EACxCC,cAAc,EAAE;IAEhB,MAAMC,eAAeD,YAAYE,OAAO,CAAC,QAAQ;IAEjD,MAAMC,UAAUC,IAAAA,kBAAK,EAACP,WAAW;IAEjC,sBAAsB;IACtB,MAAMQ,OAAOF,QAAQD,OAAO,CAAC,iBAAiB;IAC9CN,OAAOU,IAAAA,kBAAK,EAACV,MAAM;IAEnBW,OAAOC,MAAM,CAACT,aAAa;QAC1BM;QACAT;IACD;IAEA,IAAIO,QAAQM,QAAQ,CAAC,YAAY;QAChCV,YAAYW,MAAM,GAAG;IACtB;IAEA,MAAMC,SAASJ,OAAOK,OAAO,CAACb,aAC5Bc,GAAG,CAAC,CAAC,CAACC,KAAKC,MAAM,GAAK,GAAGD,IAAI,CAAC,EAAEE,mBAAmBD,QAAQ,EAC3DE,IAAI,CAAC;IAEP,OAAO,GAAGhB,aAAa,CAAC,EAAEH,WAAW,CAAC,EAAEa,QAAQ;AACjD;AAEO,MAAMlB,UAAU,CACtBG,MACA,gEAAgE;AAChE,EAAEsB,GAAG,EAAEC,IAAI,EAAEC,KAAK,EAAEC,WAAW,EAAEC,YAAY,EAAEC,WAAW,EAAEC,qBAAqB,EAAE3B,SAAS,EAAuB,EACnHG;IAEA,IAAIyB,IAAAA,YAAK,EAAC7B,OAAO;QAChB,OAAOA;IACR;IAEA,MAAM,CAAC8B,OAAOC,OAAO,GAAG/B,KAAKgC,KAAK,CAAC;IACnChC,OAAO8B;IACP,MAAMG,QAAQF,SAAS,CAAC,CAAC,EAAEA,QAAQ,GAAG;IAEtC,MAAMxB,UAAUC,IAAAA,kBAAK,EAAC0B,IAAAA,iBAAI,EAACjC,aAAa,KAAK;IAC7C,MAAMC,aAAagC,IAAAA,iBAAI,EAACT,eAAe;IACvC,MAAMU,YAAY3B,IAAAA,kBAAK,EAAC0B,IAAAA,iBAAI,EAACP,eAAe,KAAK;IACjD,MAAMS,aAAa5B,IAAAA,kBAAK,EAAC0B,IAAAA,iBAAI,EAACN,yBAAyB,KAAK;IAE5D,MAAMS,YAAY3B,IAAAA,kBAAK,EAACwB,IAAAA,iBAAI,EAAClC,OAAO;IAEpC,MAAMsC,MAAM9B,IAAAA,kBAAK,EAAC,GAAG4B,WAAW,CAAC,EAAEC,WAAW,EAAE,OAAOJ;IAEvD,IAAIT,OAAO;QACV,MAAMrB,cAAcuB,gBAAgB,CAAC;QACrC,OAAO3B,YAAYuC,KAAK/B,SAASL,YAAYC,aAAaC;IAC3D;IAEA,IAAIkB,OAAOa,cAAc,IAAI;QAC5B,OAAOA,YAAYG;IACpB;IAEA,IAAIf,MAAM;QACT,OAAOhB,QAAQD,OAAO,CAAC,IAAIiC,OAAO,GAAGC,IAAAA,2BAAY,EAACJ,YAAY,CAAC,CAAC,GAAG,MAAME;IAC1E;IAEA,OAAOA;AACR;AAEO,MAAMxC,wBAAwB,CACpCE,MACA,gEAAgE;AAChE,EACCsB,MAAM,IAAI,EACVC,OAAO,KAAK,EACZC,QAAQ,KAAK,EACbC,cAAc,EAAE,EAChBC,eAAe,CAAC,CAAC,EAOjB,EACDS,WACA5B,SACAkC,mBAEA5C,QACCG,MACA;QACCsB;QACAC;QACAC;QACAC;QACAC;QACAC,aAAaQ;QACbP,uBAAuBc,0BAA0BC,oBAAoB;QACrE1C,WAAWM;IACZ,GACAkC","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/getURL.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"90f18a7fe0115916135a2c32cf15792d768560af","contentHash":"4783ef808d678248b1780f1c7b1fb83994b9f6ef73e6f53aacfd1df73c7b5aaa"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isURL.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isURL.ts","statementMap":{"0":{"start":{"line":4,"column":0},"end":{"line":6,"column":3}},"1":{"start":{"line":7,"column":0},"end":{"line":12,"column":3}},"2":{"start":{"line":10,"column":8},"end":{"line":10,"column":21}},"3":{"start":{"line":13,"column":14},"end":{"line":13,"column":53}},"4":{"start":{"line":13,"column":21},"end":{"line":13,"column":53}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":10}},"loc":{"start":{"line":9,"column":20},"end":{"line":11,"column":5}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":14},"end":{"line":13,"column":15}},"loc":{"start":{"line":13,"column":21},"end":{"line":13,"column":53}},"line":13}},"branchMap":{},"s":{"0":2,"1":2,"2":304,"3":2,"4":304},"f":{"0":304,"1":304},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isURL.ts"],"sourcesContent":["/**\n * @todo rename it as isAbsoluteURL\n */\nexport const isURL = (str: string): boolean => /^(https?:\\/\\/|data:)/.test(str);\n"],"names":["isURL","str","test"],"mappings":"AAAA;;CAEC;;;;+BACYA;;;eAAAA;;;AAAN,MAAMA,QAAQ,CAACC,MAAyB,uBAAuBC,IAAI,CAACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isURL.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5cf50053b020ee70d9b2dc40df6270bf8155bf55","contentHash":"a105eb962ec8c49fdaab5acd0f6819a0d6a8eaaf105f0904e2b081b755b36e63"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/closeLivechatRoom.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/closeLivechatRoom.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":33}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":46}},"5":{"start":{"line":13,"column":23},"end":{"line":13,"column":87}},"6":{"start":{"line":14,"column":23},"end":{"line":14,"column":76}},"7":{"start":{"line":15,"column":24},"end":{"line":15,"column":56}},"8":{"start":{"line":16,"column":26},"end":{"line":72,"column":1}},"9":{"start":{"line":17,"column":17},"end":{"line":17,"column":64}},"10":{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},"11":{"start":{"line":19,"column":8},"end":{"line":19,"column":46}},"12":{"start":{"line":21,"column":4},"end":{"line":31,"column":5}},"13":{"start":{"line":22,"column":33},"end":{"line":26,"column":10}},"14":{"start":{"line":24,"column":16},"end":{"line":24,"column":86}},"15":{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},"16":{"start":{"line":28,"column":12},"end":{"line":28,"column":19}},"17":{"start":{"line":30,"column":8},"end":{"line":30,"column":53}},"18":{"start":{"line":32,"column":25},"end":{"line":36,"column":6}},"19":{"start":{"line":37,"column":4},"end":{"line":39,"column":5}},"20":{"start":{"line":38,"column":8},"end":{"line":38,"column":48}},"21":{"start":{"line":40,"column":20},"end":{"line":65,"column":5}},"22":{"start":{"line":66,"column":4},"end":{"line":71,"column":7}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":16,"column":26},"end":{"line":16,"column":27}},"loc":{"start":{"line":16,"column":107},"end":{"line":72,"column":1}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":23,"column":12},"end":{"line":23,"column":13}},"loc":{"start":{"line":23,"column":32},"end":{"line":25,"column":13}},"line":23}},"branchMap":{"0":{"loc":{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},"type":"if","locations":[{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},{"start":{"line":18,"column":4},"end":{"line":20,"column":5}}],"line":18},"1":{"loc":{"start":{"line":18,"column":8},"end":{"line":18,"column":59}},"type":"binary-expr","locations":[{"start":{"line":18,"column":8},"end":{"line":18,"column":13}},{"start":{"line":18,"column":17},"end":{"line":18,"column":59}}],"line":18},"2":{"loc":{"start":{"line":21,"column":4},"end":{"line":31,"column":5}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":31,"column":5}},{"start":{"line":21,"column":4},"end":{"line":31,"column":5}}],"line":21},"3":{"loc":{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},"type":"if","locations":[{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},{"start":{"line":27,"column":8},"end":{"line":29,"column":9}}],"line":27},"4":{"loc":{"start":{"line":37,"column":4},"end":{"line":39,"column":5}},"type":"if","locations":[{"start":{"line":37,"column":4},"end":{"line":39,"column":5}},{"start":{"line":37,"column":4},"end":{"line":39,"column":5}}],"line":37},"5":{"loc":{"start":{"line":37,"column":8},"end":{"line":37,"column":110}},"type":"binary-expr","locations":[{"start":{"line":37,"column":8},"end":{"line":37,"column":21}},{"start":{"line":37,"column":25},"end":{"line":37,"column":110}}],"line":37},"6":{"loc":{"start":{"line":43,"column":11},"end":{"line":47,"column":9}},"type":"binary-expr","locations":[{"start":{"line":43,"column":11},"end":{"line":43,"column":32}},{"start":{"line":43,"column":36},"end":{"line":47,"column":9}}],"line":43},"7":{"loc":{"start":{"line":48,"column":11},"end":{"line":64,"column":9}},"type":"binary-expr","locations":[{"start":{"line":48,"column":11},"end":{"line":48,"column":26}},{"start":{"line":48,"column":30},"end":{"line":64,"column":9}}],"line":48},"8":{"loc":{"start":{"line":49,"column":15},"end":{"line":63,"column":13}},"type":"cond-expr","locations":[{"start":{"line":49,"column":47},"end":{"line":59,"column":13}},{"start":{"line":59,"column":16},"end":{"line":63,"column":13}}],"line":49}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":8,"10":8,"11":2,"12":6,"13":3,"14":0,"15":3,"16":2,"17":1,"18":3,"19":3,"20":1,"21":2,"22":2},"f":{"0":1,"1":8,"2":0},"b":{"0":[2,6],"1":[8,7],"2":[3,3],"3":[2,1],"4":[1,2],"5":[3,2],"6":[2,0],"7":[2,0],"8":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/closeLivechatRoom.ts"],"sourcesContent":["import type { IUser, IRoom, IOmnichannelRoom } from '@rocket.chat/core-typings';\nimport { isOmnichannelRoom } from '@rocket.chat/core-typings';\nimport { LivechatRooms, Subscriptions } from '@rocket.chat/models';\n\nimport { hasPermissionAsync } from '../../../authorization/server/functions/hasPermission';\nimport { Livechat } from '../../../livechat/server/lib/LivechatTyped';\nimport type { CloseRoomParams } from '../../../livechat/server/lib/localTypes';\nimport { notifyOnSubscriptionChanged } from '../lib/notifyListener';\n\nexport const closeLivechatRoom = async (\n\tuser: IUser,\n\troomId: IRoom['_id'],\n\t{\n\t\tcomment,\n\t\ttags,\n\t\tgenerateTranscriptPdf,\n\t\ttranscriptEmail,\n\t}: {\n\t\tcomment?: string;\n\t\ttags?: string[];\n\t\tgenerateTranscriptPdf?: boolean;\n\t\ttranscriptEmail?:\n\t\t\t| {\n\t\t\t\t\tsendToVisitor: false;\n\t\t\t  }\n\t\t\t| {\n\t\t\t\t\tsendToVisitor: true;\n\t\t\t\t\trequestData: Pick<NonNullable<IOmnichannelRoom['transcriptRequest']>, 'email' | 'subject'>;\n\t\t\t  };\n\t},\n): Promise<void> => {\n\tconst room = await LivechatRooms.findOneById(roomId);\n\tif (!room || !isOmnichannelRoom(room)) {\n\t\tthrow new Error('error-invalid-room');\n\t}\n\n\tif (!room.open) {\n\t\tconst { deletedCount } = await Subscriptions.removeByRoomId(roomId, {\n\t\t\tasync onTrash(doc) {\n\t\t\t\tvoid notifyOnSubscriptionChanged(doc, 'removed');\n\t\t\t},\n\t\t});\n\t\tif (deletedCount) {\n\t\t\treturn;\n\t\t}\n\t\tthrow new Error('error-room-already-closed');\n\t}\n\n\tconst subscription = await Subscriptions.findOneByRoomIdAndUserId(roomId, user._id, { projection: { _id: 1 } });\n\tif (!subscription && !(await hasPermissionAsync(user._id, 'close-others-livechat-room'))) {\n\t\tthrow new Error('error-not-authorized');\n\t}\n\n\tconst options: CloseRoomParams['options'] = {\n\t\tclientAction: true,\n\t\ttags,\n\t\t...(generateTranscriptPdf && { pdfTranscript: { requestedBy: user._id } }),\n\t\t...(transcriptEmail && {\n\t\t\t...(transcriptEmail.sendToVisitor\n\t\t\t\t? {\n\t\t\t\t\t\temailTranscript: {\n\t\t\t\t\t\t\tsendToVisitor: true,\n\t\t\t\t\t\t\trequestData: {\n\t\t\t\t\t\t\t\temail: transcriptEmail.requestData.email,\n\t\t\t\t\t\t\t\tsubject: transcriptEmail.requestData.subject,\n\t\t\t\t\t\t\t\trequestedAt: new Date(),\n\t\t\t\t\t\t\t\trequestedBy: user,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t: {\n\t\t\t\t\t\temailTranscript: {\n\t\t\t\t\t\t\tsendToVisitor: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t}),\n\t};\n\n\tawait Livechat.closeRoom({\n\t\troom,\n\t\tuser,\n\t\toptions,\n\t\tcomment,\n\t});\n};\n"],"names":["closeLivechatRoom","user","roomId","comment","tags","generateTranscriptPdf","transcriptEmail","room","LivechatRooms","findOneById","isOmnichannelRoom","Error","open","deletedCount","Subscriptions","removeByRoomId","onTrash","doc","notifyOnSubscriptionChanged","subscription","findOneByRoomIdAndUserId","_id","projection","hasPermissionAsync","options","clientAction","pdfTranscript","requestedBy","sendToVisitor","emailTranscript","requestData","email","subject","requestedAt","Date","Livechat","closeRoom"],"mappings":";;;;+BASaA;;;eAAAA;;;6BARqB;wBACW;+BAEV;+BACV;gCAEmB;AAErC,MAAMA,oBAAoB,OAChCC,MACAC,QACA,EACCC,OAAO,EACPC,IAAI,EACJC,qBAAqB,EACrBC,eAAe,EAaf;IAED,MAAMC,OAAO,MAAMC,qBAAa,CAACC,WAAW,CAACP;IAC7C,IAAI,CAACK,QAAQ,CAACG,IAAAA,8BAAiB,EAACH,OAAO;QACtC,MAAM,IAAII,MAAM;IACjB;IAEA,IAAI,CAACJ,KAAKK,IAAI,EAAE;QACf,MAAM,EAAEC,YAAY,EAAE,GAAG,MAAMC,qBAAa,CAACC,cAAc,CAACb,QAAQ;YACnE,MAAMc,SAAQC,GAAG;gBAChB,KAAKC,IAAAA,2CAA2B,EAACD,KAAK;YACvC;QACD;QACA,IAAIJ,cAAc;YACjB;QACD;QACA,MAAM,IAAIF,MAAM;IACjB;IAEA,MAAMQ,eAAe,MAAML,qBAAa,CAACM,wBAAwB,CAAClB,QAAQD,KAAKoB,GAAG,EAAE;QAAEC,YAAY;YAAED,KAAK;QAAE;IAAE;IAC7G,IAAI,CAACF,gBAAgB,CAAE,MAAMI,IAAAA,iCAAkB,EAACtB,KAAKoB,GAAG,EAAE,+BAAgC;QACzF,MAAM,IAAIV,MAAM;IACjB;IAEA,MAAMa,UAAsC;QAC3CC,cAAc;QACdrB;QACA,GAAIC,yBAAyB;YAAEqB,eAAe;gBAAEC,aAAa1B,KAAKoB,GAAG;YAAC;QAAE,CAAC;QACzE,GAAIf,mBAAmB;YACtB,GAAIA,gBAAgBsB,aAAa,GAC9B;gBACAC,iBAAiB;oBAChBD,eAAe;oBACfE,aAAa;wBACZC,OAAOzB,gBAAgBwB,WAAW,CAACC,KAAK;wBACxCC,SAAS1B,gBAAgBwB,WAAW,CAACE,OAAO;wBAC5CC,aAAa,IAAIC;wBACjBP,aAAa1B;oBACd;gBACD;YACD,IACC;gBACA4B,iBAAiB;oBAChBD,eAAe;gBAChB;YACD,CAAC;QACJ,CAAC;IACF;IAEA,MAAMO,uBAAQ,CAACC,SAAS,CAAC;QACxB7B;QACAN;QACAuB;QACArB;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/closeLivechatRoom.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"48f5e918306943e495bbeb38ed21d96b801bb397","contentHash":"3a60876cd32e9c828721e56615fbc243cdba1a03403ccea5c3151de21656e20d"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/getModifiedHttpHeaders.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/getModifiedHttpHeaders.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":38}},"3":{"start":{"line":11,"column":31},"end":{"line":29,"column":1}},"4":{"start":{"line":12,"column":32},"end":{"line":14,"column":5}},"5":{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},"6":{"start":{"line":16,"column":8},"end":{"line":16,"column":59}},"7":{"start":{"line":18,"column":4},"end":{"line":27,"column":5}},"8":{"start":{"line":19,"column":24},"end":{"line":19,"column":62}},"9":{"start":{"line":20,"column":32},"end":{"line":25,"column":10}},"10":{"start":{"line":21,"column":12},"end":{"line":23,"column":13}},"11":{"start":{"line":22,"column":16},"end":{"line":22,"column":45}},"12":{"start":{"line":24,"column":12},"end":{"line":24,"column":26}},"13":{"start":{"line":26,"column":8},"end":{"line":26,"column":64}},"14":{"start":{"line":28,"column":4},"end":{"line":28,"column":31}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":31},"end":{"line":11,"column":32}},"loc":{"start":{"line":11,"column":46},"end":{"line":29,"column":1}},"line":11},"2":{"name":"(anonymous_2)","decl":{"start":{"line":20,"column":44},"end":{"line":20,"column":45}},"loc":{"start":{"line":20,"column":54},"end":{"line":25,"column":9}},"line":20}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},"type":"if","locations":[{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},{"start":{"line":15,"column":4},"end":{"line":17,"column":5}}],"line":15},"1":{"loc":{"start":{"line":18,"column":4},"end":{"line":27,"column":5}},"type":"if","locations":[{"start":{"line":18,"column":4},"end":{"line":27,"column":5}},{"start":{"line":18,"column":4},"end":{"line":27,"column":5}}],"line":18},"2":{"loc":{"start":{"line":21,"column":12},"end":{"line":23,"column":13}},"type":"if","locations":[{"start":{"line":21,"column":12},"end":{"line":23,"column":13}},{"start":{"line":21,"column":12},"end":{"line":23,"column":13}}],"line":21}},"s":{"0":1,"1":1,"2":6,"3":1,"4":6,"5":6,"6":2,"7":6,"8":3,"9":3,"10":8,"11":2,"12":6,"13":3,"14":6},"f":{"0":6,"1":6,"2":8},"b":{"0":[2,4],"1":[3,3],"2":[2,6]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/getModifiedHttpHeaders.ts"],"sourcesContent":["export const getModifiedHttpHeaders = (httpHeaders: Record<string, any>) => {\n\tconst modifiedHttpHeaders = { ...httpHeaders };\n\n\tif ('x-auth-token' in modifiedHttpHeaders) {\n\t\tmodifiedHttpHeaders['x-auth-token'] = '[redacted]';\n\t}\n\n\tif (modifiedHttpHeaders.cookie) {\n\t\tconst cookies = modifiedHttpHeaders.cookie.split('; ');\n\t\tconst modifiedCookies = cookies.map((cookie: string) => {\n\t\t\tif (cookie.startsWith('rc_token=')) {\n\t\t\t\treturn 'rc_token=[redacted]';\n\t\t\t}\n\t\t\treturn cookie;\n\t\t});\n\t\tmodifiedHttpHeaders.cookie = modifiedCookies.join('; ');\n\t}\n\n\treturn modifiedHttpHeaders;\n};\n"],"names":["getModifiedHttpHeaders","httpHeaders","modifiedHttpHeaders","cookie","cookies","split","modifiedCookies","map","startsWith","join"],"mappings":";;;;+BAAaA;;;eAAAA;;;AAAN,MAAMA,yBAAyB,CAACC;IACtC,MAAMC,sBAAsB;QAAE,GAAGD,WAAW;IAAC;IAE7C,IAAI,kBAAkBC,qBAAqB;QAC1CA,mBAAmB,CAAC,eAAe,GAAG;IACvC;IAEA,IAAIA,oBAAoBC,MAAM,EAAE;QAC/B,MAAMC,UAAUF,oBAAoBC,MAAM,CAACE,KAAK,CAAC;QACjD,MAAMC,kBAAkBF,QAAQG,GAAG,CAAC,CAACJ;YACpC,IAAIA,OAAOK,UAAU,CAAC,cAAc;gBACnC,OAAO;YACR;YACA,OAAOL;QACR;QACAD,oBAAoBC,MAAM,GAAGG,gBAAgBG,IAAI,CAAC;IACnD;IAEA,OAAOP;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/getModifiedHttpHeaders.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d8e01c44818eb9fcd1f532dccb13e444ceb36567","contentHash":"07d6a08f346ea103a83618d5b1b6e5d637d87668b781cb205555f3f4ce4bdd21"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/notifications/messageContainsHighlight.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/notifications/messageContainsHighlight.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":40}},"3":{"start":{"line":11,"column":23},"end":{"line":11,"column":61}},"4":{"start":{"line":13,"column":4},"end":{"line":15,"column":5}},"5":{"start":{"line":14,"column":8},"end":{"line":14,"column":21}},"6":{"start":{"line":16,"column":4},"end":{"line":20,"column":7}},"7":{"start":{"line":17,"column":19},"end":{"line":17,"column":62}},"8":{"start":{"line":18,"column":23},"end":{"line":18,"column":101}},"9":{"start":{"line":19,"column":8},"end":{"line":19,"column":40}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"messageContainsHighlight","decl":{"start":{"line":12,"column":9},"end":{"line":12,"column":33}},"loc":{"start":{"line":12,"column":55},"end":{"line":21,"column":1}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":27},"end":{"line":16,"column":28}},"loc":{"start":{"line":16,"column":40},"end":{"line":20,"column":5}},"line":16}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":4},"end":{"line":15,"column":5}},"type":"if","locations":[{"start":{"line":13,"column":4},"end":{"line":15,"column":5}},{"start":{"line":13,"column":4},"end":{"line":15,"column":5}}],"line":13},"1":{"loc":{"start":{"line":13,"column":8},"end":{"line":13,"column":46}},"type":"binary-expr","locations":[{"start":{"line":13,"column":8},"end":{"line":13,"column":19}},{"start":{"line":13,"column":23},"end":{"line":13,"column":46}}],"line":13}},"s":{"0":1,"1":1,"2":9,"3":1,"4":9,"5":1,"6":8,"7":10,"8":10,"9":10},"f":{"0":9,"1":9,"2":10},"b":{"0":[1,8],"1":[9,9]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/notifications/messageContainsHighlight.ts"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\n\n/**\n * Checks if a message contains a user highlight\n *\n * @param {string} message\n * @param {array|undefined} highlights\n *\n * @returns {boolean}\n */\nexport function messageContainsHighlight(message: Pick<IMessage, 'msg'>, highlights: string[] | undefined): boolean {\n\tif (!highlights || highlights.length === 0) {\n\t\treturn false;\n\t}\n\n\treturn highlights.some((highlight: string) => {\n\t\tconst hl = escapeRegExp(highlight);\n\t\tconst regexp = new RegExp(`(?<!:)\\\\b${hl}\\\\b:|:\\\\b${hl}(?!:)\\\\b|\\\\b(?<!:)${hl}(?!:)\\\\b`, 'i');\n\t\treturn regexp.test(message.msg);\n\t});\n}\n"],"names":["messageContainsHighlight","message","highlights","length","some","highlight","hl","escapeRegExp","regexp","RegExp","test","msg"],"mappings":";;;;+BAWgBA;;;eAAAA;;;+BAVa;AAUtB,SAASA,yBAAyBC,OAA8B,EAAEC,UAAgC;IACxG,IAAI,CAACA,cAAcA,WAAWC,MAAM,KAAK,GAAG;QAC3C,OAAO;IACR;IAEA,OAAOD,WAAWE,IAAI,CAAC,CAACC;QACvB,MAAMC,KAAKC,IAAAA,2BAAY,EAACF;QACxB,MAAMG,SAAS,IAAIC,OAAO,CAAC,SAAS,EAAEH,GAAG,SAAS,EAAEA,GAAG,kBAAkB,EAAEA,GAAG,QAAQ,CAAC,EAAE;QACzF,OAAOE,OAAOE,IAAI,CAACT,QAAQU,GAAG;IAC/B;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/notifications/messageContainsHighlight.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"59e94eb1b9199e56f996bb3dfa1b80be605d8dd2","contentHash":"659e93ac657d6efcd7246307fe3266793a0fd11f49c9723092d4411801c0488f"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/checkUrlForSsrf.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/checkUrlForSsrf.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":33,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":31}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":24}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":30}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":27}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":29}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":27}},"10":{"start":{"line":31,"column":8},"end":{"line":31,"column":24}},"11":{"start":{"line":34,"column":13},"end":{"line":34,"column":27}},"12":{"start":{"line":36,"column":15},"end":{"line":54,"column":1}},"13":{"start":{"line":55,"column":17},"end":{"line":65,"column":1}},"14":{"start":{"line":56,"column":4},"end":{"line":64,"column":7}},"15":{"start":{"line":57,"column":8},"end":{"line":63,"column":11}},"16":{"start":{"line":58,"column":12},"end":{"line":62,"column":13}},"17":{"start":{"line":59,"column":16},"end":{"line":59,"column":30}},"18":{"start":{"line":61,"column":16},"end":{"line":61,"column":33}},"19":{"start":{"line":66,"column":17},"end":{"line":68,"column":1}},"20":{"start":{"line":67,"column":4},"end":{"line":67,"column":89}},"21":{"start":{"line":67,"column":46},"end":{"line":67,"column":78}},"22":{"start":{"line":69,"column":20},"end":{"line":75,"column":1}},"23":{"start":{"line":70,"column":30},"end":{"line":70,"column":46}},"24":{"start":{"line":71,"column":19},"end":{"line":71,"column":31}},"25":{"start":{"line":72,"column":24},"end":{"line":72,"column":41}},"26":{"start":{"line":73,"column":17},"end":{"line":73,"column":50}},"27":{"start":{"line":74,"column":4},"end":{"line":74,"column":52}},"28":{"start":{"line":76,"column":23},"end":{"line":76,"column":73}},"29":{"start":{"line":76,"column":29},"end":{"line":76,"column":73}},"30":{"start":{"line":76,"column":50},"end":{"line":76,"column":72}},"31":{"start":{"line":77,"column":20},"end":{"line":84,"column":1}},"32":{"start":{"line":78,"column":19},"end":{"line":78,"column":32}},"33":{"start":{"line":79,"column":4},"end":{"line":79,"column":42}},"34":{"start":{"line":79,"column":29},"end":{"line":79,"column":42}},"35":{"start":{"line":80,"column":4},"end":{"line":83,"column":7}},"36":{"start":{"line":81,"column":20},"end":{"line":81,"column":33}},"37":{"start":{"line":82,"column":8},"end":{"line":82,"column":66}},"38":{"start":{"line":85,"column":22},"end":{"line":91,"column":1}},"39":{"start":{"line":86,"column":26},"end":{"line":86,"column":118}},"40":{"start":{"line":87,"column":4},"end":{"line":89,"column":5}},"41":{"start":{"line":88,"column":8},"end":{"line":88,"column":21}},"42":{"start":{"line":90,"column":4},"end":{"line":90,"column":16}},"43":{"start":{"line":92,"column":24},"end":{"line":119,"column":1}},"44":{"start":{"line":93,"column":4},"end":{"line":95,"column":5}},"45":{"start":{"line":94,"column":8},"end":{"line":94,"column":21}},"46":{"start":{"line":96,"column":24},"end":{"line":96,"column":40}},"47":{"start":{"line":97,"column":23},"end":{"line":97,"column":78}},"48":{"start":{"line":98,"column":4},"end":{"line":100,"column":5}},"49":{"start":{"line":99,"column":8},"end":{"line":99,"column":21}},"50":{"start":{"line":101,"column":4},"end":{"line":103,"column":5}},"51":{"start":{"line":102,"column":8},"end":{"line":102,"column":21}},"52":{"start":{"line":104,"column":4},"end":{"line":106,"column":5}},"53":{"start":{"line":105,"column":8},"end":{"line":105,"column":21}},"54":{"start":{"line":107,"column":4},"end":{"line":117,"column":5}},"55":{"start":{"line":108,"column":8},"end":{"line":116,"column":9}},"56":{"start":{"line":109,"column":30},"end":{"line":109,"column":56}},"57":{"start":{"line":110,"column":12},"end":{"line":112,"column":13}},"58":{"start":{"line":111,"column":16},"end":{"line":111,"column":29}},"59":{"start":{"line":114,"column":12},"end":{"line":114,"column":31}},"60":{"start":{"line":115,"column":12},"end":{"line":115,"column":25}},"61":{"start":{"line":118,"column":4},"end":{"line":118,"column":16}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":21},"end":{"line":12,"column":22}},"loc":{"start":{"line":12,"column":32},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":14},"end":{"line":15,"column":15}},"loc":{"start":{"line":15,"column":25},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":20},"end":{"line":18,"column":21}},"loc":{"start":{"line":18,"column":31},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":17},"end":{"line":21,"column":18}},"loc":{"start":{"line":21,"column":28},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":19},"end":{"line":24,"column":20}},"loc":{"start":{"line":24,"column":30},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":17},"end":{"line":27,"column":18}},"loc":{"start":{"line":27,"column":28},"end":{"line":29,"column":5}},"line":27},"7":{"name":"(anonymous_7)","decl":{"start":{"line":30,"column":14},"end":{"line":30,"column":15}},"loc":{"start":{"line":30,"column":25},"end":{"line":32,"column":5}},"line":30},"8":{"name":"(anonymous_8)","decl":{"start":{"line":55,"column":17},"end":{"line":55,"column":18}},"loc":{"start":{"line":55,"column":35},"end":{"line":65,"column":1}},"line":55},"9":{"name":"(anonymous_9)","decl":{"start":{"line":56,"column":23},"end":{"line":56,"column":24}},"loc":{"start":{"line":56,"column":42},"end":{"line":64,"column":5}},"line":56},"10":{"name":"(anonymous_10)","decl":{"start":{"line":57,"column":35},"end":{"line":57,"column":36}},"loc":{"start":{"line":57,"column":53},"end":{"line":63,"column":9}},"line":57},"11":{"name":"(anonymous_11)","decl":{"start":{"line":66,"column":17},"end":{"line":66,"column":18}},"loc":{"start":{"line":66,"column":23},"end":{"line":68,"column":1}},"line":66},"12":{"name":"(anonymous_12)","decl":{"start":{"line":67,"column":32},"end":{"line":67,"column":33}},"loc":{"start":{"line":67,"column":46},"end":{"line":67,"column":78}},"line":67},"13":{"name":"(anonymous_13)","decl":{"start":{"line":69,"column":20},"end":{"line":69,"column":21}},"loc":{"start":{"line":69,"column":33},"end":{"line":75,"column":1}},"line":69},"14":{"name":"(anonymous_14)","decl":{"start":{"line":76,"column":23},"end":{"line":76,"column":24}},"loc":{"start":{"line":76,"column":29},"end":{"line":76,"column":73}},"line":76},"15":{"name":"(anonymous_15)","decl":{"start":{"line":76,"column":41},"end":{"line":76,"column":42}},"loc":{"start":{"line":76,"column":50},"end":{"line":76,"column":72}},"line":76},"16":{"name":"(anonymous_16)","decl":{"start":{"line":77,"column":20},"end":{"line":77,"column":21}},"loc":{"start":{"line":77,"column":26},"end":{"line":84,"column":1}},"line":77},"17":{"name":"(anonymous_17)","decl":{"start":{"line":80,"column":24},"end":{"line":80,"column":25}},"loc":{"start":{"line":80,"column":33},"end":{"line":83,"column":5}},"line":80},"18":{"name":"(anonymous_18)","decl":{"start":{"line":85,"column":22},"end":{"line":85,"column":23}},"loc":{"start":{"line":85,"column":32},"end":{"line":91,"column":1}},"line":85},"19":{"name":"(anonymous_19)","decl":{"start":{"line":92,"column":24},"end":{"line":92,"column":25}},"loc":{"start":{"line":92,"column":37},"end":{"line":119,"column":1}},"line":92}},"branchMap":{"0":{"loc":{"start":{"line":58,"column":12},"end":{"line":62,"column":13}},"type":"if","locations":[{"start":{"line":58,"column":12},"end":{"line":62,"column":13}},{"start":{"line":58,"column":12},"end":{"line":62,"column":13}}],"line":58},"1":{"loc":{"start":{"line":79,"column":4},"end":{"line":79,"column":42}},"type":"if","locations":[{"start":{"line":79,"column":4},"end":{"line":79,"column":42}},{"start":{"line":79,"column":4},"end":{"line":79,"column":42}}],"line":79},"2":{"loc":{"start":{"line":82,"column":15},"end":{"line":82,"column":65}},"type":"binary-expr","locations":[{"start":{"line":82,"column":15},"end":{"line":82,"column":23}},{"start":{"line":82,"column":27},"end":{"line":82,"column":37}},{"start":{"line":82,"column":41},"end":{"line":82,"column":65}}],"line":82},"3":{"loc":{"start":{"line":87,"column":4},"end":{"line":89,"column":5}},"type":"if","locations":[{"start":{"line":87,"column":4},"end":{"line":89,"column":5}},{"start":{"line":87,"column":4},"end":{"line":89,"column":5}}],"line":87},"4":{"loc":{"start":{"line":93,"column":4},"end":{"line":95,"column":5}},"type":"if","locations":[{"start":{"line":93,"column":4},"end":{"line":95,"column":5}},{"start":{"line":93,"column":4},"end":{"line":95,"column":5}}],"line":93},"5":{"loc":{"start":{"line":93,"column":10},"end":{"line":93,"column":65}},"type":"binary-expr","locations":[{"start":{"line":93,"column":10},"end":{"line":93,"column":35}},{"start":{"line":93,"column":39},"end":{"line":93,"column":65}}],"line":93},"6":{"loc":{"start":{"line":97,"column":23},"end":{"line":97,"column":78}},"type":"cond-expr","locations":[{"start":{"line":97,"column":47},"end":{"line":97,"column":68}},{"start":{"line":97,"column":71},"end":{"line":97,"column":78}}],"line":97},"7":{"loc":{"start":{"line":98,"column":4},"end":{"line":100,"column":5}},"type":"if","locations":[{"start":{"line":98,"column":4},"end":{"line":100,"column":5}},{"start":{"line":98,"column":4},"end":{"line":100,"column":5}}],"line":98},"8":{"loc":{"start":{"line":98,"column":10},"end":{"line":98,"column":62}},"type":"binary-expr","locations":[{"start":{"line":98,"column":10},"end":{"line":98,"column":33}},{"start":{"line":98,"column":37},"end":{"line":98,"column":62}}],"line":98},"9":{"loc":{"start":{"line":101,"column":4},"end":{"line":103,"column":5}},"type":"if","locations":[{"start":{"line":101,"column":4},"end":{"line":103,"column":5}},{"start":{"line":101,"column":4},"end":{"line":103,"column":5}}],"line":101},"10":{"loc":{"start":{"line":101,"column":8},"end":{"line":101,"column":61}},"type":"binary-expr","locations":[{"start":{"line":101,"column":8},"end":{"line":101,"column":31}},{"start":{"line":101,"column":35},"end":{"line":101,"column":61}}],"line":101},"11":{"loc":{"start":{"line":104,"column":4},"end":{"line":106,"column":5}},"type":"if","locations":[{"start":{"line":104,"column":4},"end":{"line":106,"column":5}},{"start":{"line":104,"column":4},"end":{"line":106,"column":5}}],"line":104},"12":{"loc":{"start":{"line":104,"column":8},"end":{"line":104,"column":94}},"type":"binary-expr","locations":[{"start":{"line":104,"column":8},"end":{"line":104,"column":33}},{"start":{"line":104,"column":37},"end":{"line":104,"column":94}}],"line":104},"13":{"loc":{"start":{"line":107,"column":4},"end":{"line":117,"column":5}},"type":"if","locations":[{"start":{"line":107,"column":4},"end":{"line":117,"column":5}},{"start":{"line":107,"column":4},"end":{"line":117,"column":5}}],"line":107},"14":{"loc":{"start":{"line":110,"column":12},"end":{"line":112,"column":13}},"type":"if","locations":[{"start":{"line":110,"column":12},"end":{"line":112,"column":13}},{"start":{"line":110,"column":12},"end":{"line":112,"column":13}}],"line":110}},"s":{"0":1,"1":1,"2":7,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":1,"12":1,"13":1,"14":3,"15":3,"16":3,"17":0,"18":3,"19":1,"20":118,"21":472,"22":1,"23":59,"24":59,"25":59,"26":59,"27":59,"28":1,"29":5,"30":59,"31":1,"32":14,"33":14,"34":10,"35":4,"36":16,"37":16,"38":1,"39":15,"40":15,"41":4,"42":11,"43":1,"44":9,"45":1,"46":8,"47":8,"48":8,"49":2,"50":6,"51":1,"52":5,"53":1,"54":4,"55":3,"56":3,"57":3,"58":1,"59":0,"60":0,"61":3},"f":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":3,"9":3,"10":3,"11":118,"12":472,"13":59,"14":5,"15":59,"16":14,"17":16,"18":15,"19":9},"b":{"0":[0,3],"1":[10,4],"2":[16,16,16],"3":[4,11],"4":[1,8],"5":[9,5],"6":[2,6],"7":[2,6],"8":[8,6],"9":[1,5],"10":[6,2],"11":[1,4],"12":[5,4],"13":[3,1],"14":[1,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/checkUrlForSsrf.ts"],"sourcesContent":["import { lookup } from 'dns';\n\n// https://en.wikipedia.org/wiki/Reserved_IP_addresses + Alibaba Metadata IP\nconst ranges: string[] = [\n\t'0.0.0.0/8',\n\t'10.0.0.0/8',\n\t'100.64.0.0/10',\n\t'127.0.0.0/8',\n\t'169.254.0.0/16',\n\t'172.16.0.0/12',\n\t'192.0.0.0/24',\n\t'192.0.2.0/24',\n\t'192.88.99.0/24',\n\t'192.168.0.0/16',\n\t'198.18.0.0/15',\n\t'198.51.100.0/24',\n\t'203.0.113.0/24',\n\t'224.0.0.0/4',\n\t'240.0.0.0/4',\n\t'255.255.255.255',\n\t'100.100.100.200/32',\n];\n\nexport const nslookup = async (hostname: string): Promise<string> => {\n\treturn new Promise((resolve, reject) => {\n\t\tlookup(hostname, (error, address) => {\n\t\t\tif (error) {\n\t\t\t\treject(error);\n\t\t\t} else {\n\t\t\t\tresolve(address);\n\t\t\t}\n\t\t});\n\t});\n};\n\nexport const ipToLong = (ip: string): number => {\n\treturn ip.split('.').reduce((acc, octet) => (acc << 8) + parseInt(octet, 10), 0) >>> 0;\n};\n\nexport const isIpInRange = (ip: string, range: string): boolean => {\n\tconst [rangeIp, subnet] = range.split('/');\n\tconst ipLong = ipToLong(ip);\n\tconst rangeIpLong = ipToLong(rangeIp);\n\tconst mask = ~(2 ** (32 - Number(subnet)) - 1);\n\treturn (ipLong & mask) === (rangeIpLong & mask);\n};\n\nexport const isIpInAnyRange = (ip: string): boolean => ranges.some((range) => isIpInRange(ip, range));\n\nexport const isValidIPv4 = (ip: string): boolean => {\n\tconst octets = ip.split('.');\n\tif (octets.length !== 4) return false;\n\treturn octets.every((octet) => {\n\t\tconst num = Number(octet);\n\t\treturn num >= 0 && num <= 255 && octet === num.toString();\n\t});\n};\n\nexport const isValidDomain = (domain: string): boolean => {\n\tconst domainPattern = /^(?!-)(?!.*--)[A-Za-z0-9-]{1,63}(?<!-)\\.?([A-Za-z0-9-]{2,63}\\.?)*[A-Za-z]{2,63}$/;\n\tif (!domainPattern.test(domain)) {\n\t\treturn false;\n\t}\n\treturn true;\n};\n\nexport const checkUrlForSsrf = async (url: string): Promise<boolean> => {\n\tif (!(url.startsWith('http://') || url.startsWith('https://'))) {\n\t\treturn false;\n\t}\n\n\tconst [, address] = url.split('://');\n\tconst ipOrDomain = address.includes('/') ? address.split('/')[0] : address;\n\n\tif (!(isValidIPv4(ipOrDomain) || isValidDomain(ipOrDomain))) {\n\t\treturn false;\n\t}\n\n\tif (isValidIPv4(ipOrDomain) && isIpInAnyRange(ipOrDomain)) {\n\t\treturn false;\n\t}\n\n\tif (isValidDomain(ipOrDomain) && /metadata.google.internal/.test(ipOrDomain.toLowerCase())) {\n\t\treturn false;\n\t}\n\n\tif (isValidDomain(ipOrDomain)) {\n\t\ttry {\n\t\t\tconst ipAddress = await nslookup(ipOrDomain);\n\t\t\tif (isIpInAnyRange(ipAddress)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n};\n"],"names":["checkUrlForSsrf","ipToLong","isIpInAnyRange","isIpInRange","isValidDomain","isValidIPv4","nslookup","ranges","hostname","Promise","resolve","reject","lookup","error","address","ip","split","reduce","acc","octet","parseInt","range","rangeIp","subnet","ipLong","rangeIpLong","mask","Number","some","octets","length","every","num","toString","domain","domainPattern","test","url","startsWith","ipOrDomain","includes","toLowerCase","ipAddress","console","log"],"mappings":";;;;;;;;;;;IAkEaA,eAAe;eAAfA;;IA/BAC,QAAQ;eAARA;;IAYAC,cAAc;eAAdA;;IARAC,WAAW;eAAXA;;IAmBAC,aAAa;eAAbA;;IATAC,WAAW;eAAXA;;IA1BAC,QAAQ;eAARA;;;qBAvBU;AAEvB,4EAA4E;AAC5E,MAAMC,SAAmB;IACxB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACA;AAEM,MAAMD,WAAW,OAAOE;IAC9B,OAAO,IAAIC,QAAQ,CAACC,SAASC;QAC5BC,IAAAA,WAAM,EAACJ,UAAU,CAACK,OAAOC;YACxB,IAAID,OAAO;gBACVF,OAAOE;YACR,OAAO;gBACNH,QAAQI;YACT;QACD;IACD;AACD;AAEO,MAAMb,WAAW,CAACc;IACxB,OAAOA,GAAGC,KAAK,CAAC,KAAKC,MAAM,CAAC,CAACC,KAAKC,QAAU,AAACD,CAAAA,OAAO,CAAA,IAAKE,SAASD,OAAO,KAAK,OAAO;AACtF;AAEO,MAAMhB,cAAc,CAACY,IAAYM;IACvC,MAAM,CAACC,SAASC,OAAO,GAAGF,MAAML,KAAK,CAAC;IACtC,MAAMQ,SAASvB,SAASc;IACxB,MAAMU,cAAcxB,SAASqB;IAC7B,MAAMI,OAAO,CAAE,CAAA,KAAM,CAAA,KAAKC,OAAOJ,OAAM,IAAK,CAAA;IAC5C,OAAO,AAACC,CAAAA,SAASE,IAAG,MAAQD,CAAAA,cAAcC,IAAG;AAC9C;AAEO,MAAMxB,iBAAiB,CAACa,KAAwBR,OAAOqB,IAAI,CAAC,CAACP,QAAUlB,YAAYY,IAAIM;AAEvF,MAAMhB,cAAc,CAACU;IAC3B,MAAMc,SAASd,GAAGC,KAAK,CAAC;IACxB,IAAIa,OAAOC,MAAM,KAAK,GAAG,OAAO;IAChC,OAAOD,OAAOE,KAAK,CAAC,CAACZ;QACpB,MAAMa,MAAML,OAAOR;QACnB,OAAOa,OAAO,KAAKA,OAAO,OAAOb,UAAUa,IAAIC,QAAQ;IACxD;AACD;AAEO,MAAM7B,gBAAgB,CAAC8B;IAC7B,MAAMC,gBAAgB;IACtB,IAAI,CAACA,cAAcC,IAAI,CAACF,SAAS;QAChC,OAAO;IACR;IACA,OAAO;AACR;AAEO,MAAMlC,kBAAkB,OAAOqC;IACrC,IAAI,CAAEA,CAAAA,IAAIC,UAAU,CAAC,cAAcD,IAAIC,UAAU,CAAC,WAAU,GAAI;QAC/D,OAAO;IACR;IAEA,MAAM,GAAGxB,QAAQ,GAAGuB,IAAIrB,KAAK,CAAC;IAC9B,MAAMuB,aAAazB,QAAQ0B,QAAQ,CAAC,OAAO1B,QAAQE,KAAK,CAAC,IAAI,CAAC,EAAE,GAAGF;IAEnE,IAAI,CAAET,CAAAA,YAAYkC,eAAenC,cAAcmC,WAAU,GAAI;QAC5D,OAAO;IACR;IAEA,IAAIlC,YAAYkC,eAAerC,eAAeqC,aAAa;QAC1D,OAAO;IACR;IAEA,IAAInC,cAAcmC,eAAe,2BAA2BH,IAAI,CAACG,WAAWE,WAAW,KAAK;QAC3F,OAAO;IACR;IAEA,IAAIrC,cAAcmC,aAAa;QAC9B,IAAI;YACH,MAAMG,YAAY,MAAMpC,SAASiC;YACjC,IAAIrC,eAAewC,YAAY;gBAC9B,OAAO;YACR;QACD,EAAE,OAAO7B,OAAO;YACf8B,QAAQC,GAAG,CAAC/B;YACZ,OAAO;QACR;IACD;IAEA,OAAO;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/checkUrlForSsrf.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f54fc45b2cd7847d95db998b366dac44007bc941","contentHash":"d873fbdece096f90c8b6906150682cc85f4ef4d6fa1ddb498b6e0a30eb735361"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/lib/validateCustomMessageFields.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/lib/validateCustomMessageFields.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":43}},"3":{"start":{"line":11,"column":27},"end":{"line":11,"column":67}},"4":{"start":{"line":12,"column":27},"end":{"line":12,"column":67}},"5":{"start":{"line":14,"column":4},"end":{"line":16,"column":6}},"6":{"start":{"line":18,"column":12},"end":{"line":18,"column":30}},"7":{"start":{"line":19,"column":29},"end":{"line":31,"column":2}},"8":{"start":{"line":20,"column":19},"end":{"line":20,"column":50}},"9":{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},"10":{"start":{"line":22,"column":8},"end":{"line":22,"column":56}},"11":{"start":{"line":24,"column":4},"end":{"line":28,"column":7}},"12":{"start":{"line":32,"column":36},"end":{"line":43,"column":1}},"13":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"14":{"start":{"line":37,"column":8},"end":{"line":37,"column":53}},"15":{"start":{"line":39,"column":21},"end":{"line":39,"column":62}},"16":{"start":{"line":40,"column":4},"end":{"line":42,"column":5}},"17":{"start":{"line":41,"column":8},"end":{"line":41,"column":49}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":13,"column":9},"end":{"line":13,"column":33}},"loc":{"start":{"line":13,"column":39},"end":{"line":17,"column":1}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":19,"column":47},"end":{"line":19,"column":48}},"loc":{"start":{"line":19,"column":70},"end":{"line":29,"column":1}},"line":19},"3":{"name":"(anonymous_3)","decl":{"start":{"line":32,"column":36},"end":{"line":32,"column":37}},"loc":{"start":{"line":32,"column":105},"end":{"line":43,"column":1}},"line":32}},"branchMap":{"0":{"loc":{"start":{"line":14,"column":11},"end":{"line":16,"column":5}},"type":"cond-expr","locations":[{"start":{"line":14,"column":35},"end":{"line":14,"column":38}},{"start":{"line":14,"column":41},"end":{"line":16,"column":5}}],"line":14},"1":{"loc":{"start":{"line":14,"column":11},"end":{"line":14,"column":32}},"type":"binary-expr","locations":[{"start":{"line":14,"column":11},"end":{"line":14,"column":14}},{"start":{"line":14,"column":18},"end":{"line":14,"column":32}}],"line":14},"2":{"loc":{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},{"start":{"line":21,"column":4},"end":{"line":23,"column":5}}],"line":21},"3":{"loc":{"start":{"line":21,"column":8},"end":{"line":21,"column":47}},"type":"binary-expr","locations":[{"start":{"line":21,"column":8},"end":{"line":21,"column":19}},{"start":{"line":21,"column":23},"end":{"line":21,"column":47}}],"line":21},"4":{"loc":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},{"start":{"line":36,"column":4},"end":{"line":38,"column":5}}],"line":36},"5":{"loc":{"start":{"line":40,"column":4},"end":{"line":42,"column":5}},"type":"if","locations":[{"start":{"line":40,"column":4},"end":{"line":42,"column":5}},{"start":{"line":40,"column":4},"end":{"line":42,"column":5}}],"line":40}},"s":{"0":1,"1":1,"2":6,"3":1,"4":1,"5":2,"6":1,"7":1,"8":4,"9":3,"10":1,"11":2,"12":1,"13":6,"14":1,"15":5,"16":3,"17":2},"f":{"0":6,"1":2,"2":4,"3":6},"b":{"0":[1,1],"1":[2,2],"2":[1,2],"3":[3,1],"4":[1,5],"5":[2,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/lib/validateCustomMessageFields.ts"],"sourcesContent":["import Ajv from 'ajv';\nimport mem from 'mem';\n\nconst ajv = new Ajv();\n\nconst customFieldsValidate = mem(\n\t(customFieldsSetting: string) => {\n\t\tconst schema = JSON.parse(customFieldsSetting);\n\n\t\tif (schema.type && schema.type !== 'object') {\n\t\t\tthrow new Error('Invalid custom fields config');\n\t\t}\n\n\t\treturn ajv.compile({\n\t\t\t...schema,\n\t\t\ttype: 'object',\n\t\t\tadditionalProperties: false,\n\t\t});\n\t},\n\t{ maxAge: 1000 * 60 },\n);\n\nexport const validateCustomMessageFields = ({\n\tcustomFields,\n\tmessageCustomFieldsEnabled,\n\tmessageCustomFields,\n}: {\n\tcustomFields: Record<string, any>;\n\tmessageCustomFieldsEnabled: boolean;\n\tmessageCustomFields: string;\n}) => {\n\t// get the json schema for the custom fields of the message and validate it using ajv\n\t// if the validation fails, throw an error\n\t// if there are no custom fields, the message object remains unchanged\n\n\tif (messageCustomFieldsEnabled !== true) {\n\t\tthrow new Error('Custom fields not enabled');\n\t}\n\n\tconst validate = customFieldsValidate(messageCustomFields);\n\tif (!validate(customFields)) {\n\t\tthrow new Error('Invalid custom fields');\n\t}\n};\n"],"names":["validateCustomMessageFields","ajv","Ajv","customFieldsValidate","mem","customFieldsSetting","schema","JSON","parse","type","Error","compile","additionalProperties","maxAge","customFields","messageCustomFieldsEnabled","messageCustomFields","validate"],"mappings":";;;;+BAsBaA;;;eAAAA;;;4DAtBG;4DACA;;;;;;AAEhB,MAAMC,MAAM,IAAIC,YAAG;AAEnB,MAAMC,uBAAuBC,IAAAA,YAAG,EAC/B,CAACC;IACA,MAAMC,SAASC,KAAKC,KAAK,CAACH;IAE1B,IAAIC,OAAOG,IAAI,IAAIH,OAAOG,IAAI,KAAK,UAAU;QAC5C,MAAM,IAAIC,MAAM;IACjB;IAEA,OAAOT,IAAIU,OAAO,CAAC;QAClB,GAAGL,MAAM;QACTG,MAAM;QACNG,sBAAsB;IACvB;AACD,GACA;IAAEC,QAAQ,OAAO;AAAG;AAGd,MAAMb,8BAA8B,CAAC,EAC3Cc,YAAY,EACZC,0BAA0B,EAC1BC,mBAAmB,EAKnB;IACA,qFAAqF;IACrF,0CAA0C;IAC1C,sEAAsE;IAEtE,IAAID,+BAA+B,MAAM;QACxC,MAAM,IAAIL,MAAM;IACjB;IAEA,MAAMO,WAAWd,qBAAqBa;IACtC,IAAI,CAACC,SAASH,eAAe;QAC5B,MAAM,IAAIJ,MAAM;IACjB;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/lib/validateCustomMessageFields.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"1feaf51ae578c51c8a869057fbed523ab622ae8a","contentHash":"3fcb936d666d7129ecb02bbc73e0300322b2cf43a03e3ccbb7c7c3a4a10eb87f"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/validateNameChars.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/validateNameChars.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":33}},"3":{"start":{"line":11,"column":26},"end":{"line":28,"column":1}},"4":{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},"5":{"start":{"line":13,"column":8},"end":{"line":13,"column":21}},"6":{"start":{"line":15,"column":25},"end":{"line":15,"column":34}},"7":{"start":{"line":16,"column":4},"end":{"line":18,"column":5}},"8":{"start":{"line":17,"column":8},"end":{"line":17,"column":21}},"9":{"start":{"line":19,"column":4},"end":{"line":26,"column":5}},"10":{"start":{"line":20,"column":28},"end":{"line":20,"column":43}},"11":{"start":{"line":21,"column":8},"end":{"line":23,"column":9}},"12":{"start":{"line":22,"column":12},"end":{"line":22,"column":25}},"13":{"start":{"line":25,"column":8},"end":{"line":25,"column":21}},"14":{"start":{"line":27,"column":4},"end":{"line":27,"column":16}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":26},"end":{"line":11,"column":27}},"loc":{"start":{"line":11,"column":34},"end":{"line":28,"column":1}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},"type":"if","locations":[{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},{"start":{"line":12,"column":4},"end":{"line":14,"column":5}}],"line":12},"1":{"loc":{"start":{"line":16,"column":4},"end":{"line":18,"column":5}},"type":"if","locations":[{"start":{"line":16,"column":4},"end":{"line":18,"column":5}},{"start":{"line":16,"column":4},"end":{"line":18,"column":5}}],"line":16},"2":{"loc":{"start":{"line":21,"column":8},"end":{"line":23,"column":9}},"type":"if","locations":[{"start":{"line":21,"column":8},"end":{"line":23,"column":9}},{"start":{"line":21,"column":8},"end":{"line":23,"column":9}}],"line":21}},"s":{"0":1,"1":1,"2":22,"3":1,"4":22,"5":4,"6":18,"7":18,"8":6,"9":12,"10":12,"11":10,"12":5,"13":2,"14":5},"f":{"0":22,"1":22},"b":{"0":[4,18],"1":[6,12],"2":[5,5]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/validateNameChars.ts"],"sourcesContent":["export const validateNameChars = (name: string | undefined): boolean => {\n\tif (typeof name !== 'string') {\n\t\treturn false;\n\t}\n\n\tconst invalidChars = /[<>\\\\/]/;\n\tif (invalidChars.test(name)) {\n\t\treturn false;\n\t}\n\n\ttry {\n\t\tconst decodedName = decodeURI(name);\n\t\tif (invalidChars.test(decodedName)) {\n\t\t\treturn false;\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n\n\treturn true;\n};\n"],"names":["validateNameChars","name","invalidChars","test","decodedName","decodeURI","err"],"mappings":";;;;+BAAaA;;;eAAAA;;;AAAN,MAAMA,oBAAoB,CAACC;IACjC,IAAI,OAAOA,SAAS,UAAU;QAC7B,OAAO;IACR;IAEA,MAAMC,eAAe;IACrB,IAAIA,aAAaC,IAAI,CAACF,OAAO;QAC5B,OAAO;IACR;IAEA,IAAI;QACH,MAAMG,cAAcC,UAAUJ;QAC9B,IAAIC,aAAaC,IAAI,CAACC,cAAc;YACnC,OAAO;QACR;IACD,EAAE,OAAOE,KAAK;QACb,OAAO;IACR;IAEA,OAAO;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/validateNameChars.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5cb7b019b2ac86a9bf64aa55f6884753954cd8bb","contentHash":"5ff76e5c982ebce4b63bd2a9dc83296d8e626dfc64bcc8213078fdafcb3f0a35"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/hooks/sendToCRM.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/hooks/sendToCRM.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":24,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":41}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":43}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":46}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":31}},"8":{"start":{"line":25,"column":21},"end":{"line":25,"column":57}},"9":{"start":{"line":26,"column":16},"end":{"line":26,"column":46}},"10":{"start":{"line":27,"column":19},"end":{"line":27,"column":55}},"11":{"start":{"line":28,"column":16},"end":{"line":28,"column":51}},"12":{"start":{"line":29,"column":36},"end":{"line":29,"column":105}},"13":{"start":{"line":30,"column":23},"end":{"line":30,"column":54}},"14":{"start":{"line":31,"column":19},"end":{"line":31,"column":48}},"15":{"start":{"line":32,"column":23},"end":{"line":32,"column":39}},"16":{"start":{"line":33,"column":39},"end":{"line":35,"column":1}},"17":{"start":{"line":34,"column":4},"end":{"line":34,"column":36}},"18":{"start":{"line":36,"column":36},"end":{"line":38,"column":1}},"19":{"start":{"line":37,"column":4},"end":{"line":37,"column":40}},"20":{"start":{"line":39,"column":24},"end":{"line":48,"column":1}},"21":{"start":{"line":40,"column":4},"end":{"line":47,"column":5}},"22":{"start":{"line":42,"column":12},"end":{"line":42,"column":24}},"23":{"start":{"line":44,"column":12},"end":{"line":44,"column":168}},"24":{"start":{"line":46,"column":12},"end":{"line":46,"column":25}},"25":{"start":{"line":49,"column":34},"end":{"line":80,"column":1}},"26":{"start":{"line":50,"column":97},"end":{"line":50,"column":101}},"27":{"start":{"line":51,"column":4},"end":{"line":79,"column":5}},"28":{"start":{"line":54,"column":12},"end":{"line":56,"column":14}},"29":{"start":{"line":58,"column":12},"end":{"line":64,"column":14}},"30":{"start":{"line":66,"column":12},"end":{"line":69,"column":14}},"31":{"start":{"line":71,"column":12},"end":{"line":76,"column":14}},"32":{"start":{"line":78,"column":12},"end":{"line":78,"column":22}},"33":{"start":{"line":82,"column":4},"end":{"line":84,"column":5}},"34":{"start":{"line":83,"column":8},"end":{"line":83,"column":20}},"35":{"start":{"line":85,"column":21},"end":{"line":89,"column":5}},"36":{"start":{"line":90,"column":19},"end":{"line":90,"column":23}},"37":{"start":{"line":91,"column":4},"end":{"line":99,"column":5}},"38":{"start":{"line":92,"column":8},"end":{"line":96,"column":21}},"39":{"start":{"line":97,"column":11},"end":{"line":99,"column":5}},"40":{"start":{"line":98,"column":8},"end":{"line":98,"column":35}},"41":{"start":{"line":100,"column":4},"end":{"line":142,"column":5}},"42":{"start":{"line":101,"column":8},"end":{"line":141,"column":9}},"43":{"start":{"line":102,"column":12},"end":{"line":104,"column":13}},"44":{"start":{"line":103,"column":16},"end":{"line":103,"column":25}},"45":{"start":{"line":105,"column":24},"end":{"line":130,"column":13}},"46":{"start":{"line":131,"column":26},"end":{"line":131,"column":33}},"47":{"start":{"line":132,"column":12},"end":{"line":140,"column":15}},"48":{"start":{"line":143,"column":27},"end":{"line":143,"column":64}},"49":{"start":{"line":144,"column":25},"end":{"line":144,"column":64}},"50":{"start":{"line":145,"column":21},"end":{"line":145,"column":76}},"51":{"start":{"line":146,"column":4},"end":{"line":149,"column":5}},"52":{"start":{"line":147,"column":29},"end":{"line":147,"column":50}},"53":{"start":{"line":148,"column":8},"end":{"line":148,"column":80}},"54":{"start":{"line":150,"column":4},"end":{"line":150,"column":16}},"55":{"start":{"line":152,"column":0},"end":{"line":159,"column":73}},"56":{"start":{"line":153,"column":21},"end":{"line":153,"column":27}},"57":{"start":{"line":154,"column":4},"end":{"line":156,"column":5}},"58":{"start":{"line":155,"column":8},"end":{"line":155,"column":22}},"59":{"start":{"line":157,"column":4},"end":{"line":157,"column":45}},"60":{"start":{"line":158,"column":4},"end":{"line":158,"column":18}},"61":{"start":{"line":160,"column":0},"end":{"line":165,"column":73}},"62":{"start":{"line":161,"column":4},"end":{"line":163,"column":5}},"63":{"start":{"line":162,"column":8},"end":{"line":162,"column":20}},"64":{"start":{"line":164,"column":4},"end":{"line":164,"column":51}},"65":{"start":{"line":166,"column":0},"end":{"line":171,"column":73}},"66":{"start":{"line":167,"column":4},"end":{"line":169,"column":5}},"67":{"start":{"line":168,"column":8},"end":{"line":168,"column":23}},"68":{"start":{"line":170,"column":4},"end":{"line":170,"column":51}},"69":{"start":{"line":172,"column":0},"end":{"line":177,"column":74}},"70":{"start":{"line":173,"column":4},"end":{"line":175,"column":5}},"71":{"start":{"line":174,"column":8},"end":{"line":174,"column":20}},"72":{"start":{"line":176,"column":4},"end":{"line":176,"column":52}},"73":{"start":{"line":178,"column":0},"end":{"line":192,"column":86}},"74":{"start":{"line":179,"column":33},"end":{"line":179,"column":39}},"75":{"start":{"line":180,"column":4},"end":{"line":182,"column":5}},"76":{"start":{"line":181,"column":8},"end":{"line":181,"column":22}},"77":{"start":{"line":183,"column":25},"end":{"line":183,"column":69}},"78":{"start":{"line":184,"column":4},"end":{"line":186,"column":5}},"79":{"start":{"line":185,"column":8},"end":{"line":185,"column":22}},"80":{"start":{"line":187,"column":17},"end":{"line":189,"column":6}},"81":{"start":{"line":190,"column":4},"end":{"line":190,"column":54}},"82":{"start":{"line":191,"column":4},"end":{"line":191,"column":18}},"83":{"start":{"line":193,"column":0},"end":{"line":207,"column":91}},"84":{"start":{"line":194,"column":37},"end":{"line":194,"column":43}},"85":{"start":{"line":195,"column":4},"end":{"line":197,"column":5}},"86":{"start":{"line":196,"column":8},"end":{"line":196,"column":22}},"87":{"start":{"line":198,"column":25},"end":{"line":198,"column":69}},"88":{"start":{"line":199,"column":4},"end":{"line":201,"column":5}},"89":{"start":{"line":200,"column":8},"end":{"line":200,"column":22}},"90":{"start":{"line":202,"column":17},"end":{"line":204,"column":6}},"91":{"start":{"line":205,"column":4},"end":{"line":205,"column":54}},"92":{"start":{"line":206,"column":4},"end":{"line":206,"column":18}},"93":{"start":{"line":208,"column":0},"end":{"line":214,"column":72}},"94":{"start":{"line":210,"column":4},"end":{"line":212,"column":5}},"95":{"start":{"line":211,"column":8},"end":{"line":211,"column":20}},"96":{"start":{"line":213,"column":4},"end":{"line":213,"column":43}},"97":{"start":{"line":215,"column":0},"end":{"line":233,"column":70}},"98":{"start":{"line":218,"column":4},"end":{"line":220,"column":5}},"99":{"start":{"line":219,"column":8},"end":{"line":219,"column":23}},"100":{"start":{"line":221,"column":4},"end":{"line":223,"column":5}},"101":{"start":{"line":222,"column":8},"end":{"line":222,"column":23}},"102":{"start":{"line":226,"column":4},"end":{"line":228,"column":5}},"103":{"start":{"line":227,"column":8},"end":{"line":227,"column":23}},"104":{"start":{"line":229,"column":4},"end":{"line":231,"column":7}},"105":{"start":{"line":232,"column":4},"end":{"line":232,"column":19}},"106":{"start":{"line":234,"column":0},"end":{"line":239,"column":75}},"107":{"start":{"line":235,"column":4},"end":{"line":237,"column":5}},"108":{"start":{"line":236,"column":8},"end":{"line":236,"column":20}},"109":{"start":{"line":238,"column":4},"end":{"line":238,"column":49}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":31},"end":{"line":12,"column":32}},"loc":{"start":{"line":12,"column":42},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":33},"end":{"line":15,"column":34}},"loc":{"start":{"line":15,"column":44},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":36},"end":{"line":18,"column":37}},"loc":{"start":{"line":18,"column":47},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":21},"end":{"line":21,"column":22}},"loc":{"start":{"line":21,"column":32},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":33,"column":39},"end":{"line":33,"column":40}},"loc":{"start":{"line":33,"column":50},"end":{"line":35,"column":1}},"line":33},"6":{"name":"(anonymous_6)","decl":{"start":{"line":36,"column":36},"end":{"line":36,"column":37}},"loc":{"start":{"line":36,"column":47},"end":{"line":38,"column":1}},"line":36},"7":{"name":"(anonymous_7)","decl":{"start":{"line":39,"column":24},"end":{"line":39,"column":25}},"loc":{"start":{"line":39,"column":35},"end":{"line":48,"column":1}},"line":39},"8":{"name":"(anonymous_8)","decl":{"start":{"line":49,"column":34},"end":{"line":49,"column":35}},"loc":{"start":{"line":49,"column":48},"end":{"line":80,"column":1}},"line":49},"9":{"name":"sendToCRM","decl":{"start":{"line":81,"column":15},"end":{"line":81,"column":24}},"loc":{"start":{"line":81,"column":61},"end":{"line":151,"column":1}},"line":81},"10":{"name":"(anonymous_10)","decl":{"start":{"line":152,"column":47},"end":{"line":152,"column":48}},"loc":{"start":{"line":152,"column":63},"end":{"line":159,"column":1}},"line":152},"11":{"name":"(anonymous_11)","decl":{"start":{"line":160,"column":45},"end":{"line":160,"column":46}},"loc":{"start":{"line":160,"column":59},"end":{"line":165,"column":1}},"line":160},"12":{"name":"(anonymous_12)","decl":{"start":{"line":166,"column":54},"end":{"line":166,"column":55}},"loc":{"start":{"line":166,"column":81},"end":{"line":171,"column":1}},"line":166},"13":{"name":"(anonymous_13)","decl":{"start":{"line":172,"column":48},"end":{"line":172,"column":49}},"loc":{"start":{"line":172,"column":56},"end":{"line":177,"column":1}},"line":172},"14":{"name":"(anonymous_14)","decl":{"start":{"line":178,"column":61},"end":{"line":178,"column":62}},"loc":{"start":{"line":178,"column":77},"end":{"line":192,"column":1}},"line":178},"15":{"name":"(anonymous_15)","decl":{"start":{"line":193,"column":66},"end":{"line":193,"column":67}},"loc":{"start":{"line":193,"column":82},"end":{"line":207,"column":1}},"line":193},"16":{"name":"(anonymous_16)","decl":{"start":{"line":208,"column":46},"end":{"line":208,"column":47}},"loc":{"start":{"line":208,"column":60},"end":{"line":214,"column":1}},"line":208},"17":{"name":"(anonymous_17)","decl":{"start":{"line":215,"column":56},"end":{"line":215,"column":57}},"loc":{"start":{"line":215,"column":83},"end":{"line":233,"column":1}},"line":215},"18":{"name":"(anonymous_18)","decl":{"start":{"line":234,"column":49},"end":{"line":234,"column":50}},"loc":{"start":{"line":234,"column":57},"end":{"line":239,"column":1}},"line":234}},"branchMap":{"0":{"loc":{"start":{"line":40,"column":4},"end":{"line":47,"column":5}},"type":"switch","locations":[{"start":{"line":41,"column":8},"end":{"line":42,"column":24}},{"start":{"line":43,"column":8},"end":{"line":44,"column":168}},{"start":{"line":45,"column":8},"end":{"line":46,"column":25}}],"line":40},"1":{"loc":{"start":{"line":44,"column":19},"end":{"line":44,"column":167}},"type":"binary-expr","locations":[{"start":{"line":44,"column":19},"end":{"line":44,"column":83}},{"start":{"line":44,"column":87},"end":{"line":44,"column":167}}],"line":44},"2":{"loc":{"start":{"line":51,"column":4},"end":{"line":79,"column":5}},"type":"switch","locations":[{"start":{"line":52,"column":8},"end":{"line":52,"column":36}},{"start":{"line":53,"column":8},"end":{"line":56,"column":14}},{"start":{"line":57,"column":8},"end":{"line":64,"column":14}},{"start":{"line":65,"column":8},"end":{"line":69,"column":14}},{"start":{"line":70,"column":8},"end":{"line":76,"column":14}},{"start":{"line":77,"column":8},"end":{"line":78,"column":22}}],"line":51},"3":{"loc":{"start":{"line":81,"column":37},"end":{"line":81,"column":59}},"type":"default-arg","locations":[{"start":{"line":81,"column":55},"end":{"line":81,"column":59}}],"line":81},"4":{"loc":{"start":{"line":82,"column":4},"end":{"line":84,"column":5}},"type":"if","locations":[{"start":{"line":82,"column":4},"end":{"line":84,"column":5}},{"start":{"line":82,"column":4},"end":{"line":84,"column":5}}],"line":82},"5":{"loc":{"start":{"line":91,"column":4},"end":{"line":99,"column":5}},"type":"if","locations":[{"start":{"line":91,"column":4},"end":{"line":99,"column":5}},{"start":{"line":91,"column":4},"end":{"line":99,"column":5}}],"line":91},"6":{"loc":{"start":{"line":91,"column":8},"end":{"line":91,"column":63}},"type":"binary-expr","locations":[{"start":{"line":91,"column":8},"end":{"line":91,"column":44}},{"start":{"line":91,"column":48},"end":{"line":91,"column":63}}],"line":91},"7":{"loc":{"start":{"line":97,"column":11},"end":{"line":99,"column":5}},"type":"if","locations":[{"start":{"line":97,"column":11},"end":{"line":99,"column":5}},{"start":{"line":97,"column":11},"end":{"line":99,"column":5}}],"line":97},"8":{"loc":{"start":{"line":100,"column":4},"end":{"line":142,"column":5}},"type":"if","locations":[{"start":{"line":100,"column":4},"end":{"line":142,"column":5}},{"start":{"line":100,"column":4},"end":{"line":142,"column":5}}],"line":100},"9":{"loc":{"start":{"line":102,"column":12},"end":{"line":104,"column":13}},"type":"if","locations":[{"start":{"line":102,"column":12},"end":{"line":104,"column":13}},{"start":{"line":102,"column":12},"end":{"line":104,"column":13}}],"line":102},"10":{"loc":{"start":{"line":102,"column":16},"end":{"line":102,"column":56}},"type":"binary-expr","locations":[{"start":{"line":102,"column":16},"end":{"line":102,"column":25}},{"start":{"line":102,"column":29},"end":{"line":102,"column":56}}],"line":102},"11":{"loc":{"start":{"line":108,"column":21},"end":{"line":108,"column":66}},"type":"binary-expr","locations":[{"start":{"line":108,"column":21},"end":{"line":108,"column":32}},{"start":{"line":108,"column":36},"end":{"line":108,"column":66}}],"line":108},"12":{"loc":{"start":{"line":109,"column":19},"end":{"line":111,"column":22}},"type":"cond-expr","locations":[{"start":{"line":109,"column":65},"end":{"line":111,"column":17}},{"start":{"line":111,"column":20},"end":{"line":111,"column":22}}],"line":109},"13":{"loc":{"start":{"line":109,"column":19},"end":{"line":109,"column":62}},"type":"binary-expr","locations":[{"start":{"line":109,"column":19},"end":{"line":109,"column":33}},{"start":{"line":109,"column":37},"end":{"line":109,"column":62}}],"line":109},"14":{"loc":{"start":{"line":114,"column":19},"end":{"line":116,"column":17}},"type":"binary-expr","locations":[{"start":{"line":114,"column":19},"end":{"line":114,"column":61}},{"start":{"line":114,"column":65},"end":{"line":116,"column":17}}],"line":114},"15":{"loc":{"start":{"line":117,"column":19},"end":{"line":119,"column":17}},"type":"binary-expr","locations":[{"start":{"line":117,"column":19},"end":{"line":117,"column":67}},{"start":{"line":117,"column":71},"end":{"line":119,"column":17}}],"line":117},"16":{"loc":{"start":{"line":120,"column":19},"end":{"line":122,"column":17}},"type":"binary-expr","locations":[{"start":{"line":120,"column":19},"end":{"line":120,"column":58}},{"start":{"line":120,"column":62},"end":{"line":122,"column":17}}],"line":120},"17":{"loc":{"start":{"line":123,"column":19},"end":{"line":125,"column":17}},"type":"binary-expr","locations":[{"start":{"line":123,"column":19},"end":{"line":123,"column":55}},{"start":{"line":123,"column":59},"end":{"line":125,"column":17}}],"line":123},"18":{"loc":{"start":{"line":126,"column":19},"end":{"line":129,"column":17}},"type":"binary-expr","locations":[{"start":{"line":126,"column":19},"end":{"line":126,"column":31}},{"start":{"line":126,"column":35},"end":{"line":129,"column":17}}],"line":126},"19":{"loc":{"start":{"line":146,"column":4},"end":{"line":149,"column":5}},"type":"if","locations":[{"start":{"line":146,"column":4},"end":{"line":149,"column":5}},{"start":{"line":146,"column":4},"end":{"line":149,"column":5}}],"line":146},"20":{"loc":{"start":{"line":154,"column":4},"end":{"line":156,"column":5}},"type":"if","locations":[{"start":{"line":154,"column":4},"end":{"line":156,"column":5}},{"start":{"line":154,"column":4},"end":{"line":156,"column":5}}],"line":154},"21":{"loc":{"start":{"line":161,"column":4},"end":{"line":163,"column":5}},"type":"if","locations":[{"start":{"line":161,"column":4},"end":{"line":163,"column":5}},{"start":{"line":161,"column":4},"end":{"line":163,"column":5}}],"line":161},"22":{"loc":{"start":{"line":167,"column":4},"end":{"line":169,"column":5}},"type":"if","locations":[{"start":{"line":167,"column":4},"end":{"line":169,"column":5}},{"start":{"line":167,"column":4},"end":{"line":169,"column":5}}],"line":167},"23":{"loc":{"start":{"line":173,"column":4},"end":{"line":175,"column":5}},"type":"if","locations":[{"start":{"line":173,"column":4},"end":{"line":175,"column":5}},{"start":{"line":173,"column":4},"end":{"line":175,"column":5}}],"line":173},"24":{"loc":{"start":{"line":180,"column":4},"end":{"line":182,"column":5}},"type":"if","locations":[{"start":{"line":180,"column":4},"end":{"line":182,"column":5}},{"start":{"line":180,"column":4},"end":{"line":182,"column":5}}],"line":180},"25":{"loc":{"start":{"line":184,"column":4},"end":{"line":186,"column":5}},"type":"if","locations":[{"start":{"line":184,"column":4},"end":{"line":186,"column":5}},{"start":{"line":184,"column":4},"end":{"line":186,"column":5}}],"line":184},"26":{"loc":{"start":{"line":195,"column":4},"end":{"line":197,"column":5}},"type":"if","locations":[{"start":{"line":195,"column":4},"end":{"line":197,"column":5}},{"start":{"line":195,"column":4},"end":{"line":197,"column":5}}],"line":195},"27":{"loc":{"start":{"line":199,"column":4},"end":{"line":201,"column":5}},"type":"if","locations":[{"start":{"line":199,"column":4},"end":{"line":201,"column":5}},{"start":{"line":199,"column":4},"end":{"line":201,"column":5}}],"line":199},"28":{"loc":{"start":{"line":210,"column":4},"end":{"line":212,"column":5}},"type":"if","locations":[{"start":{"line":210,"column":4},"end":{"line":212,"column":5}},{"start":{"line":210,"column":4},"end":{"line":212,"column":5}}],"line":210},"29":{"loc":{"start":{"line":210,"column":8},"end":{"line":210,"column":63}},"type":"binary-expr","locations":[{"start":{"line":210,"column":8},"end":{"line":210,"column":50}},{"start":{"line":210,"column":54},"end":{"line":210,"column":63}}],"line":210},"30":{"loc":{"start":{"line":218,"column":4},"end":{"line":220,"column":5}},"type":"if","locations":[{"start":{"line":218,"column":4},"end":{"line":220,"column":5}},{"start":{"line":218,"column":4},"end":{"line":220,"column":5}}],"line":218},"31":{"loc":{"start":{"line":218,"column":8},"end":{"line":218,"column":85}},"type":"binary-expr","locations":[{"start":{"line":218,"column":8},"end":{"line":218,"column":21}},{"start":{"line":218,"column":25},"end":{"line":218,"column":85}}],"line":218},"32":{"loc":{"start":{"line":221,"column":4},"end":{"line":223,"column":5}},"type":"if","locations":[{"start":{"line":221,"column":4},"end":{"line":223,"column":5}},{"start":{"line":221,"column":4},"end":{"line":223,"column":5}}],"line":221},"33":{"loc":{"start":{"line":221,"column":8},"end":{"line":221,"column":84}},"type":"binary-expr","locations":[{"start":{"line":221,"column":8},"end":{"line":221,"column":22}},{"start":{"line":221,"column":26},"end":{"line":221,"column":84}}],"line":221},"34":{"loc":{"start":{"line":226,"column":4},"end":{"line":228,"column":5}},"type":"if","locations":[{"start":{"line":226,"column":4},"end":{"line":228,"column":5}},{"start":{"line":226,"column":4},"end":{"line":228,"column":5}}],"line":226},"35":{"loc":{"start":{"line":226,"column":8},"end":{"line":226,"column":48}},"type":"binary-expr","locations":[{"start":{"line":226,"column":8},"end":{"line":226,"column":17}},{"start":{"line":226,"column":21},"end":{"line":226,"column":48}}],"line":226},"36":{"loc":{"start":{"line":235,"column":4},"end":{"line":237,"column":5}},"type":"if","locations":[{"start":{"line":235,"column":4},"end":{"line":237,"column":5}},{"start":{"line":235,"column":4},"end":{"line":237,"column":5}}],"line":235}},"s":{"0":1,"1":1,"2":4,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":2,"18":1,"19":2,"20":1,"21":4,"22":1,"23":2,"24":1,"25":1,"26":6,"27":6,"28":2,"29":1,"30":1,"31":1,"32":1,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":1,"56":0,"57":0,"58":0,"59":0,"60":0,"61":1,"62":0,"63":0,"64":0,"65":1,"66":0,"67":0,"68":0,"69":1,"70":0,"71":0,"72":0,"73":1,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":1,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":1,"94":0,"95":0,"96":0,"97":1,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":1,"107":0,"108":0,"109":0},"f":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":2,"6":2,"7":4,"8":6,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},"b":{"0":[1,2,1],"1":[2,1],"2":[1,2,1,1,1,1],"3":[0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/hooks/sendToCRM.ts"],"sourcesContent":["import type { IOmnichannelRoom, IOmnichannelSystemMessage, IMessage } from '@rocket.chat/core-typings';\nimport { isEditedMessage, isOmnichannelRoom } from '@rocket.chat/core-typings';\nimport { LivechatRooms, Messages } from '@rocket.chat/models';\n\nimport { callbacks } from '../../../../lib/callbacks';\nimport { settings } from '../../../settings/server';\nimport { normalizeMessageFileUpload } from '../../../utils/server/functions/normalizeMessageFileUpload';\nimport { Livechat as LivechatTyped } from '../lib/LivechatTyped';\n\ntype AdditionalFields =\n\t| Record<string, unknown>\n\t| {\n\t\t\tdepartmentId: IOmnichannelRoom['departmentId'];\n\t  }\n\t| {\n\t\t\tdepartmentId: IOmnichannelRoom['departmentId'];\n\t\t\tservedBy: IOmnichannelRoom['servedBy'];\n\t  }\n\t| {\n\t\t\tdepartmentId: IOmnichannelRoom['departmentId'];\n\t\t\tservedBy: IOmnichannelRoom['servedBy'];\n\t\t\toldDepartmentId: IOmnichannelRoom['departmentId'];\n\t\t\toldServedBy: { _id: string; ts: Date; username?: string };\n\t  }\n\t| {\n\t\t\tdepartmentId: IOmnichannelRoom['departmentId'];\n\t\t\tservedBy: IOmnichannelRoom['servedBy'];\n\t\t\tclosedAt: IOmnichannelRoom['closedAt'];\n\t\t\tclosedBy: IOmnichannelRoom['closedBy'];\n\t\t\tcloser: IOmnichannelRoom['closer'];\n\t  };\n\ntype OmnichannelRoomWithExtraFields = IOmnichannelRoom & {\n\toldServedBy?: { _id: string; ts: Date; username?: string };\n\toldDepartmentId?: IOmnichannelRoom['departmentId'];\n};\n\ntype CRMActions =\n\t| 'LivechatSessionStart'\n\t| 'LivechatSessionQueued'\n\t| 'LivechatSession'\n\t| 'LivechatSessionTaken'\n\t| 'LivechatSessionForwarded'\n\t| 'LivechatEdit'\n\t| 'Message'\n\t| 'LeadCapture';\n\nconst msgNavType = 'livechat_navigation_history';\nconst msgClosingType = 'livechat-close';\n\nexport const isOmnichannelNavigationMessage = (message: IMessage): message is IOmnichannelSystemMessage => {\n\treturn message.t === msgNavType;\n};\n\nexport const isOmnichannelClosingMessage = (message: IMessage): message is IOmnichannelSystemMessage => {\n\treturn message.t === msgClosingType;\n};\n\nexport const sendMessageType = (msgType: string): boolean => {\n\tswitch (msgType) {\n\t\tcase msgClosingType:\n\t\t\treturn true;\n\t\tcase msgNavType:\n\t\t\treturn (\n\t\t\t\tsettings.get<boolean>('Livechat_Visitor_navigation_as_a_message') &&\n\t\t\t\tsettings.get<boolean>('Send_visitor_navigation_history_livechat_webhook_request')\n\t\t\t);\n\t\tdefault:\n\t\t\treturn false;\n\t}\n};\n\nexport const getAdditionalFieldsByType = (type: CRMActions, room: OmnichannelRoomWithExtraFields): AdditionalFields => {\n\tconst { departmentId, servedBy, closedAt, closedBy, closer, oldServedBy, oldDepartmentId } = room;\n\tswitch (type) {\n\t\tcase 'LivechatSessionStart':\n\t\tcase 'LivechatSessionQueued':\n\t\t\treturn { departmentId };\n\t\tcase 'LivechatSession':\n\t\t\treturn { departmentId, servedBy, closedAt, closedBy, closer };\n\t\tcase 'LivechatSessionTaken':\n\t\t\treturn { departmentId, servedBy };\n\t\tcase 'LivechatSessionForwarded':\n\t\t\treturn { departmentId, servedBy, oldDepartmentId, oldServedBy };\n\t\tdefault:\n\t\t\treturn {};\n\t}\n};\n\nasync function sendToCRM(\n\ttype: CRMActions,\n\troom: OmnichannelRoomWithExtraFields,\n\tincludeMessages: boolean | IOmnichannelSystemMessage[] = true,\n): Promise<OmnichannelRoomWithExtraFields> {\n\tif (!settings.get('Livechat_webhookUrl')) {\n\t\treturn room;\n\t}\n\n\tconst postData: Awaited<ReturnType<typeof LivechatTyped.getLivechatRoomGuestInfo>> & {\n\t\ttype: string;\n\t\tmessages: IOmnichannelSystemMessage[];\n\t} = {\n\t\t...(await LivechatTyped.getLivechatRoomGuestInfo(room)),\n\t\ttype,\n\t\tmessages: [],\n\t};\n\n\tlet messages: IOmnichannelSystemMessage[] | null = null;\n\tif (typeof includeMessages === 'boolean' && includeMessages) {\n\t\tmessages = await Messages.findVisibleByRoomId<IOmnichannelSystemMessage>(room._id, { sort: { ts: 1 } }).toArray();\n\t} else if (includeMessages instanceof Array) {\n\t\tmessages = includeMessages;\n\t}\n\n\tif (messages) {\n\t\tfor await (const message of messages) {\n\t\t\tif (message.t && !sendMessageType(message.t)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst msg = {\n\t\t\t\t_id: message._id,\n\t\t\t\tusername: message.u.username,\n\t\t\t\tmsg: message.msg || JSON.stringify(message.blocks),\n\t\t\t\t...(message.blocks && message.blocks.length > 0 ? { blocks: message.blocks } : {}),\n\t\t\t\tts: message.ts,\n\t\t\t\trid: message.rid,\n\t\t\t\t...(isEditedMessage(message) && { editedAt: message.editedAt }),\n\t\t\t\t...(message.u.username !== postData.visitor.username && { agentId: message.u._id }),\n\t\t\t\t...(isOmnichannelNavigationMessage(message) && { navigation: message.navigation }),\n\t\t\t\t...(isOmnichannelClosingMessage(message) && { closingMessage: true }),\n\t\t\t\t...(message.file && { file: message.file, attachments: message.attachments }),\n\t\t\t};\n\n\t\t\tconst { u } = message;\n\t\t\tpostData.messages.push({ ...(await normalizeMessageFileUpload({ u, ...msg })), ...{ _updatedAt: message._updatedAt } });\n\t\t}\n\t}\n\n\tconst additionalData = getAdditionalFieldsByType(type, room);\n\tconst responseData = Object.assign(postData, additionalData);\n\n\tconst response = await LivechatTyped.sendRequest(responseData);\n\n\tif (response) {\n\t\tconst responseData = await response.text();\n\t\tawait LivechatRooms.saveCRMDataByRoomId(room._id, responseData);\n\t}\n\n\treturn room;\n}\n\ncallbacks.add(\n\t'livechat.closeRoom',\n\tasync (params) => {\n\t\tconst { room } = params;\n\t\tif (!settings.get('Livechat_webhook_on_close')) {\n\t\t\treturn params;\n\t\t}\n\n\t\tawait sendToCRM('LivechatSession', room);\n\n\t\treturn params;\n\t},\n\tcallbacks.priority.MEDIUM,\n\t'livechat-send-crm-close-room',\n);\n\ncallbacks.add(\n\t'livechat.newRoom',\n\tasync (room) => {\n\t\tif (!settings.get('Livechat_webhook_on_start')) {\n\t\t\treturn room;\n\t\t}\n\n\t\treturn sendToCRM('LivechatSessionStart', room);\n\t},\n\tcallbacks.priority.MEDIUM,\n\t'livechat-send-crm-start-room',\n);\n\ncallbacks.add(\n\t'livechat.afterTakeInquiry',\n\tasync ({ inquiry, room }) => {\n\t\tif (!settings.get('Livechat_webhook_on_chat_taken')) {\n\t\t\treturn inquiry;\n\t\t}\n\n\t\treturn sendToCRM('LivechatSessionTaken', room);\n\t},\n\tcallbacks.priority.MEDIUM,\n\t'livechat-send-crm-room-taken',\n);\n\ncallbacks.add(\n\t'livechat.chatQueued',\n\t(room) => {\n\t\tif (!settings.get('Livechat_webhook_on_chat_queued')) {\n\t\t\treturn room;\n\t\t}\n\n\t\treturn sendToCRM('LivechatSessionQueued', room);\n\t},\n\tcallbacks.priority.MEDIUM,\n\t'livechat-send-crm-room-queued',\n);\n\ncallbacks.add(\n\t'livechat.afterForwardChatToAgent',\n\tasync (params) => {\n\t\tconst { rid, oldServedBy } = params;\n\t\tif (!settings.get('Livechat_webhook_on_forward')) {\n\t\t\treturn params;\n\t\t}\n\n\t\tconst originalRoom = await LivechatRooms.findOneById(rid);\n\t\tif (!originalRoom) {\n\t\t\treturn params;\n\t\t}\n\n\t\tconst room = Object.assign(originalRoom, { oldServedBy });\n\t\tawait sendToCRM('LivechatSessionForwarded', room);\n\t\treturn params;\n\t},\n\tcallbacks.priority.MEDIUM,\n\t'livechat-send-crm-room-forwarded-to-agent',\n);\n\ncallbacks.add(\n\t'livechat.afterForwardChatToDepartment',\n\tasync (params) => {\n\t\tconst { rid, oldDepartmentId } = params;\n\t\tif (!settings.get('Livechat_webhook_on_forward')) {\n\t\t\treturn params;\n\t\t}\n\n\t\tconst originalRoom = await LivechatRooms.findOneById(rid);\n\t\tif (!originalRoom) {\n\t\t\treturn params;\n\t\t}\n\n\t\tconst room = Object.assign(originalRoom, { oldDepartmentId });\n\t\tawait sendToCRM('LivechatSessionForwarded', room);\n\t\treturn params;\n\t},\n\tcallbacks.priority.MEDIUM,\n\t'livechat-send-crm-room-forwarded-to-department',\n);\n\ncallbacks.add(\n\t'livechat.saveInfo',\n\tasync (room) => {\n\t\t// Do not send to CRM if the chat is still open\n\t\tif (!isOmnichannelRoom(room) || room.open) {\n\t\t\treturn room;\n\t\t}\n\n\t\treturn sendToCRM('LivechatEdit', room);\n\t},\n\tcallbacks.priority.MEDIUM,\n\t'livechat-send-crm-save-info',\n);\n\ncallbacks.add(\n\t'afterOmnichannelSaveMessage',\n\tasync (message, { room }) => {\n\t\t// if the message has a token, it was sent from the visitor\n\t\t// if not, it was sent from the agent\n\t\tif (message.token && !settings.get('Livechat_webhook_on_visitor_message')) {\n\t\t\treturn message;\n\t\t}\n\t\tif (!message.token && !settings.get('Livechat_webhook_on_agent_message')) {\n\t\t\treturn message;\n\t\t}\n\t\t// if the message has a type means it is a special message (like the closing comment), so skips\n\t\t// unless the settings that handle with visitor navigation history are enabled\n\t\tif (message.t && !sendMessageType(message.t)) {\n\t\t\treturn message;\n\t\t}\n\n\t\tawait sendToCRM('Message', room, [message]);\n\t\treturn message;\n\t},\n\tcallbacks.priority.MEDIUM,\n\t'livechat-send-crm-message',\n);\n\ncallbacks.add(\n\t'livechat.leadCapture',\n\t(room) => {\n\t\tif (!settings.get('Livechat_webhook_on_capture')) {\n\t\t\treturn room;\n\t\t}\n\t\treturn sendToCRM('LeadCapture', room, false);\n\t},\n\tcallbacks.priority.MEDIUM,\n\t'livechat-send-crm-lead-capture',\n);\n"],"names":["getAdditionalFieldsByType","isOmnichannelClosingMessage","isOmnichannelNavigationMessage","sendMessageType","msgNavType","msgClosingType","message","t","msgType","settings","get","type","room","departmentId","servedBy","closedAt","closedBy","closer","oldServedBy","oldDepartmentId","sendToCRM","includeMessages","postData","LivechatTyped","getLivechatRoomGuestInfo","messages","Messages","findVisibleByRoomId","_id","sort","ts","toArray","Array","msg","username","u","JSON","stringify","blocks","length","rid","isEditedMessage","editedAt","visitor","agentId","navigation","closingMessage","file","attachments","push","normalizeMessageFileUpload","_updatedAt","additionalData","responseData","Object","assign","response","sendRequest","text","LivechatRooms","saveCRMDataByRoomId","callbacks","add","params","priority","MEDIUM","inquiry","originalRoom","findOneById","isOmnichannelRoom","open","token"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/hooks/sendToCRM.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4a8c96fa945e0e092d68fa694e9fcfc8d3be2fd8","contentHash":"dce9247b4d7538b895a6b7eee8297676da5458bbffdae92c5f6e05e1532997ca"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/Utils.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/Utils.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":25}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":33}},"4":{"start":{"line":12,"column":28},"end":{"line":12,"column":69}},"5":{"start":{"line":13,"column":20},"end":{"line":13,"column":63}},"6":{"start":{"line":14,"column":19},"end":{"line":14,"column":41}},"7":{"start":{"line":16,"column":4},"end":{"line":18,"column":6}},"8":{"start":{"line":20,"column":19},"end":{"line":20,"column":21}},"9":{"start":{"line":21,"column":12},"end":{"line":21,"column":17}},"10":{"start":{"line":22,"column":17},"end":{"line":22,"column":21}},"11":{"start":{"line":24,"column":23},"end":{"line":34,"column":1}},"12":{"start":{"line":35,"column":16},"end":{"line":403,"column":1}},"13":{"start":{"line":37,"column":8},"end":{"line":37,"column":21}},"14":{"start":{"line":40,"column":8},"end":{"line":40,"column":30}},"15":{"start":{"line":43,"column":8},"end":{"line":43,"column":28}},"16":{"start":{"line":46,"column":8},"end":{"line":46,"column":26}},"17":{"start":{"line":49,"column":8},"end":{"line":49,"column":27}},"18":{"start":{"line":52,"column":8},"end":{"line":52,"column":45}},"19":{"start":{"line":53,"column":8},"end":{"line":53,"column":95}},"20":{"start":{"line":53,"column":52},"end":{"line":53,"column":93}},"21":{"start":{"line":56,"column":8},"end":{"line":56,"column":28}},"22":{"start":{"line":59,"column":8},"end":{"line":59,"column":26}},"23":{"start":{"line":63,"column":8},"end":{"line":63,"column":43}},"24":{"start":{"line":64,"column":8},"end":{"line":64,"column":80}},"25":{"start":{"line":65,"column":8},"end":{"line":65,"column":74}},"26":{"start":{"line":66,"column":8},"end":{"line":66,"column":74}},"27":{"start":{"line":67,"column":8},"end":{"line":67,"column":94}},"28":{"start":{"line":68,"column":8},"end":{"line":68,"column":108}},"29":{"start":{"line":69,"column":8},"end":{"line":71,"column":9}},"30":{"start":{"line":70,"column":12},"end":{"line":70,"column":77}},"31":{"start":{"line":72,"column":8},"end":{"line":74,"column":9}},"32":{"start":{"line":73,"column":12},"end":{"line":73,"column":77}},"33":{"start":{"line":75,"column":8},"end":{"line":77,"column":9}},"34":{"start":{"line":76,"column":12},"end":{"line":76,"column":73}},"35":{"start":{"line":78,"column":8},"end":{"line":80,"column":9}},"36":{"start":{"line":79,"column":12},"end":{"line":79,"column":75}},"37":{"start":{"line":83,"column":22},"end":{"line":83,"column":40}},"38":{"start":{"line":84,"column":23},"end":{"line":84,"column":28}},"39":{"start":{"line":85,"column":8},"end":{"line":87,"column":9}},"40":{"start":{"line":85,"column":20},"end":{"line":85,"column":21}},"41":{"start":{"line":86,"column":12},"end":{"line":86,"column":72}},"42":{"start":{"line":88,"column":8},"end":{"line":88,"column":24}},"43":{"start":{"line":91,"column":8},"end":{"line":91,"column":40}},"44":{"start":{"line":94,"column":22},"end":{"line":94,"column":44}},"45":{"start":{"line":95,"column":8},"end":{"line":97,"column":9}},"46":{"start":{"line":96,"column":12},"end":{"line":96,"column":51}},"47":{"start":{"line":98,"column":8},"end":{"line":98,"column":58}},"48":{"start":{"line":99,"column":8},"end":{"line":99,"column":48}},"49":{"start":{"line":100,"column":8},"end":{"line":100,"column":32}},"50":{"start":{"line":103,"column":26},"end":{"line":103,"column":34}},"51":{"start":{"line":104,"column":8},"end":{"line":111,"column":9}},"52":{"start":{"line":105,"column":12},"end":{"line":110,"column":13}},"53":{"start":{"line":106,"column":28},"end":{"line":106,"column":45}},"54":{"start":{"line":107,"column":16},"end":{"line":109,"column":17}},"55":{"start":{"line":108,"column":20},"end":{"line":108,"column":75}},"56":{"start":{"line":112,"column":8},"end":{"line":112,"column":27}},"57":{"start":{"line":115,"column":33},"end":{"line":115,"column":101}},"58":{"start":{"line":117,"column":8},"end":{"line":117,"column":104}},"59":{"start":{"line":120,"column":8},"end":{"line":122,"column":9}},"60":{"start":{"line":121,"column":12},"end":{"line":121,"column":39}},"61":{"start":{"line":125,"column":8},"end":{"line":127,"column":9}},"62":{"start":{"line":126,"column":12},"end":{"line":126,"column":39}},"63":{"start":{"line":130,"column":8},"end":{"line":143,"column":11}},"64":{"start":{"line":131,"column":27},"end":{"line":131,"column":60}},"65":{"start":{"line":132,"column":12},"end":{"line":142,"column":15}},"66":{"start":{"line":133,"column":16},"end":{"line":136,"column":17}},"67":{"start":{"line":134,"column":20},"end":{"line":134,"column":62}},"68":{"start":{"line":135,"column":20},"end":{"line":135,"column":54}},"69":{"start":{"line":137,"column":16},"end":{"line":139,"column":17}},"70":{"start":{"line":138,"column":20},"end":{"line":138,"column":83}},"71":{"start":{"line":140,"column":34},"end":{"line":140,"column":74}},"72":{"start":{"line":141,"column":16},"end":{"line":141,"column":59}},"73":{"start":{"line":146,"column":28},"end":{"line":146,"column":33}},"74":{"start":{"line":147,"column":21},"end":{"line":147,"column":25}},"75":{"start":{"line":148,"column":26},"end":{"line":148,"column":28}},"76":{"start":{"line":149,"column":28},"end":{"line":149,"column":108}},"77":{"start":{"line":150,"column":8},"end":{"line":161,"column":9}},"78":{"start":{"line":152,"column":31},"end":{"line":152,"column":45}},"79":{"start":{"line":153,"column":34},"end":{"line":153,"column":120}},"80":{"start":{"line":154,"column":12},"end":{"line":156,"column":13}},"81":{"start":{"line":155,"column":16},"end":{"line":155,"column":67}},"82":{"start":{"line":157,"column":12},"end":{"line":157,"column":54}},"83":{"start":{"line":158,"column":12},"end":{"line":160,"column":13}},"84":{"start":{"line":159,"column":16},"end":{"line":159,"column":37}},"85":{"start":{"line":162,"column":8},"end":{"line":166,"column":10}},"86":{"start":{"line":169,"column":8},"end":{"line":171,"column":9}},"87":{"start":{"line":170,"column":12},"end":{"line":170,"column":24}},"88":{"start":{"line":172,"column":8},"end":{"line":172,"column":134}},"89":{"start":{"line":175,"column":56},"end":{"line":175,"column":70}},"90":{"start":{"line":177,"column":8},"end":{"line":183,"column":9}},"91":{"start":{"line":178,"column":12},"end":{"line":178,"column":47}},"92":{"start":{"line":180,"column":12},"end":{"line":180,"column":44}},"93":{"start":{"line":181,"column":12},"end":{"line":181,"column":29}},"94":{"start":{"line":182,"column":12},"end":{"line":182,"column":69}},"95":{"start":{"line":184,"column":26},"end":{"line":198,"column":9}},"96":{"start":{"line":199,"column":25},"end":{"line":199,"column":56}},"97":{"start":{"line":200,"column":8},"end":{"line":260,"column":9}},"98":{"start":{"line":201,"column":12},"end":{"line":203,"column":13}},"99":{"start":{"line":202,"column":16},"end":{"line":202,"column":25}},"100":{"start":{"line":204,"column":30},"end":{"line":204,"column":46}},"101":{"start":{"line":205,"column":12},"end":{"line":207,"column":13}},"102":{"start":{"line":206,"column":16},"end":{"line":206,"column":98}},"103":{"start":{"line":208,"column":12},"end":{"line":214,"column":13}},"104":{"start":{"line":209,"column":16},"end":{"line":211,"column":17}},"105":{"start":{"line":210,"column":20},"end":{"line":210,"column":74}},"106":{"start":{"line":212,"column":16},"end":{"line":212,"column":39}},"107":{"start":{"line":213,"column":16},"end":{"line":213,"column":25}},"108":{"start":{"line":215,"column":31},"end":{"line":215,"column":35}},"109":{"start":{"line":217,"column":12},"end":{"line":254,"column":13}},"110":{"start":{"line":219,"column":16},"end":{"line":221,"column":17}},"111":{"start":{"line":220,"column":20},"end":{"line":220,"column":29}},"112":{"start":{"line":222,"column":34},"end":{"line":222,"column":77}},"113":{"start":{"line":223,"column":44},"end":{"line":223,"column":53}},"114":{"start":{"line":224,"column":16},"end":{"line":233,"column":17}},"115":{"start":{"line":225,"column":20},"end":{"line":227,"column":21}},"116":{"start":{"line":226,"column":24},"end":{"line":226,"column":106}},"117":{"start":{"line":228,"column":20},"end":{"line":230,"column":21}},"118":{"start":{"line":229,"column":24},"end":{"line":229,"column":66}},"119":{"start":{"line":232,"column":20},"end":{"line":232,"column":59}},"120":{"start":{"line":234,"column":16},"end":{"line":236,"column":17}},"121":{"start":{"line":235,"column":20},"end":{"line":235,"column":68}},"122":{"start":{"line":237,"column":16},"end":{"line":239,"column":17}},"123":{"start":{"line":238,"column":20},"end":{"line":238,"column":71}},"124":{"start":{"line":240,"column":16},"end":{"line":248,"column":18}},"125":{"start":{"line":249,"column":19},"end":{"line":254,"column":13}},"126":{"start":{"line":250,"column":16},"end":{"line":252,"column":18}},"127":{"start":{"line":253,"column":16},"end":{"line":253,"column":55}},"128":{"start":{"line":255,"column":12},"end":{"line":259,"column":13}},"129":{"start":{"line":256,"column":16},"end":{"line":258,"column":17}},"130":{"start":{"line":257,"column":20},"end":{"line":257,"column":58}},"131":{"start":{"line":261,"column":8},"end":{"line":273,"column":9}},"132":{"start":{"line":262,"column":33},"end":{"line":265,"column":13}},"133":{"start":{"line":266,"column":12},"end":{"line":272,"column":13}},"134":{"start":{"line":267,"column":16},"end":{"line":267,"column":55}},"135":{"start":{"line":269,"column":16},"end":{"line":269,"column":53}},"136":{"start":{"line":270,"column":16},"end":{"line":270,"column":60}},"137":{"start":{"line":271,"column":16},"end":{"line":271,"column":56}},"138":{"start":{"line":274,"column":8},"end":{"line":274,"column":25}},"139":{"start":{"line":277,"column":23},"end":{"line":279,"column":9}},"140":{"start":{"line":280,"column":27},"end":{"line":280,"column":74}},"141":{"start":{"line":282,"column":8},"end":{"line":301,"column":9}},"142":{"start":{"line":283,"column":31},"end":{"line":283,"column":49}},"143":{"start":{"line":284,"column":12},"end":{"line":296,"column":13}},"144":{"start":{"line":285,"column":16},"end":{"line":289,"column":17}},"145":{"start":{"line":285,"column":28},"end":{"line":285,"column":29}},"146":{"start":{"line":287,"column":20},"end":{"line":287,"column":67}},"147":{"start":{"line":288,"column":20},"end":{"line":288,"column":104}},"148":{"start":{"line":290,"column":16},"end":{"line":290,"column":66}},"149":{"start":{"line":291,"column":16},"end":{"line":293,"column":17}},"150":{"start":{"line":292,"column":20},"end":{"line":292,"column":58}},"151":{"start":{"line":295,"column":16},"end":{"line":295,"column":49}},"152":{"start":{"line":297,"column":12},"end":{"line":297,"column":45}},"153":{"start":{"line":298,"column":12},"end":{"line":300,"column":13}},"154":{"start":{"line":299,"column":16},"end":{"line":299,"column":41}},"155":{"start":{"line":302,"column":32},"end":{"line":302,"column":37}},"156":{"start":{"line":303,"column":8},"end":{"line":310,"column":9}},"157":{"start":{"line":305,"column":12},"end":{"line":309,"column":13}},"158":{"start":{"line":306,"column":16},"end":{"line":306,"column":41}},"159":{"start":{"line":308,"column":16},"end":{"line":308,"column":76}},"160":{"start":{"line":311,"column":8},"end":{"line":327,"column":9}},"161":{"start":{"line":313,"column":26},"end":{"line":313,"column":68}},"162":{"start":{"line":314,"column":12},"end":{"line":320,"column":13}},"163":{"start":{"line":315,"column":16},"end":{"line":319,"column":17}},"164":{"start":{"line":316,"column":20},"end":{"line":316,"column":42}},"165":{"start":{"line":318,"column":20},"end":{"line":318,"column":42}},"166":{"start":{"line":321,"column":12},"end":{"line":326,"column":13}},"167":{"start":{"line":322,"column":16},"end":{"line":322,"column":42}},"168":{"start":{"line":323,"column":16},"end":{"line":325,"column":17}},"169":{"start":{"line":324,"column":20},"end":{"line":324,"column":43}},"170":{"start":{"line":328,"column":8},"end":{"line":330,"column":9}},"171":{"start":{"line":329,"column":12},"end":{"line":329,"column":72}},"172":{"start":{"line":331,"column":8},"end":{"line":331,"column":25}},"173":{"start":{"line":334,"column":8},"end":{"line":334,"column":54}},"174":{"start":{"line":337,"column":35},"end":{"line":337,"column":39}},"175":{"start":{"line":338,"column":8},"end":{"line":342,"column":9}},"176":{"start":{"line":340,"column":16},"end":{"line":340,"column":42}},"177":{"start":{"line":341,"column":16},"end":{"line":341,"column":22}},"178":{"start":{"line":343,"column":8},"end":{"line":343,"column":20}},"179":{"start":{"line":346,"column":28},"end":{"line":346,"column":53}},"180":{"start":{"line":347,"column":8},"end":{"line":347,"column":57}},"181":{"start":{"line":348,"column":8},"end":{"line":355,"column":9}},"182":{"start":{"line":349,"column":12},"end":{"line":351,"column":13}},"183":{"start":{"line":350,"column":16},"end":{"line":350,"column":98}},"184":{"start":{"line":352,"column":12},"end":{"line":354,"column":13}},"185":{"start":{"line":353,"column":16},"end":{"line":353,"column":124}},"186":{"start":{"line":356,"column":30},"end":{"line":356,"column":39}},"187":{"start":{"line":357,"column":8},"end":{"line":363,"column":9}},"188":{"start":{"line":358,"column":12},"end":{"line":361,"column":13}},"189":{"start":{"line":359,"column":16},"end":{"line":359,"column":89}},"190":{"start":{"line":360,"column":16},"end":{"line":360,"column":25}},"191":{"start":{"line":362,"column":12},"end":{"line":362,"column":69}},"192":{"start":{"line":364,"column":22},"end":{"line":364,"column":70}},"193":{"start":{"line":365,"column":32},"end":{"line":365,"column":89}},"194":{"start":{"line":366,"column":21},"end":{"line":366,"column":74}},"195":{"start":{"line":368,"column":8},"end":{"line":370,"column":9}},"196":{"start":{"line":369,"column":12},"end":{"line":369,"column":77}},"197":{"start":{"line":371,"column":27},"end":{"line":383,"column":9}},"198":{"start":{"line":384,"column":8},"end":{"line":386,"column":9}},"199":{"start":{"line":385,"column":12},"end":{"line":385,"column":74}},"200":{"start":{"line":387,"column":8},"end":{"line":389,"column":9}},"201":{"start":{"line":388,"column":12},"end":{"line":388,"column":51}},"202":{"start":{"line":390,"column":8},"end":{"line":396,"column":9}},"203":{"start":{"line":391,"column":12},"end":{"line":395,"column":13}},"204":{"start":{"line":392,"column":16},"end":{"line":392,"column":55}},"205":{"start":{"line":394,"column":16},"end":{"line":394,"column":66}},"206":{"start":{"line":397,"column":8},"end":{"line":400,"column":11}},"207":{"start":{"line":401,"column":8},"end":{"line":401,"column":26}},"208":{"start":{"line":404,"column":0},"end":{"line":404,"column":46}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":15,"column":9},"end":{"line":15,"column":33}},"loc":{"start":{"line":15,"column":39},"end":{"line":19,"column":1}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":36,"column":4},"end":{"line":36,"column":5}},"loc":{"start":{"line":36,"column":29},"end":{"line":38,"column":5}},"line":36},"3":{"name":"(anonymous_3)","decl":{"start":{"line":39,"column":4},"end":{"line":39,"column":5}},"loc":{"start":{"line":39,"column":32},"end":{"line":41,"column":5}},"line":39},"4":{"name":"(anonymous_4)","decl":{"start":{"line":42,"column":4},"end":{"line":42,"column":5}},"loc":{"start":{"line":42,"column":34},"end":{"line":44,"column":5}},"line":42},"5":{"name":"(anonymous_5)","decl":{"start":{"line":45,"column":4},"end":{"line":45,"column":5}},"loc":{"start":{"line":45,"column":28},"end":{"line":47,"column":5}},"line":45},"6":{"name":"(anonymous_6)","decl":{"start":{"line":48,"column":4},"end":{"line":48,"column":5}},"loc":{"start":{"line":48,"column":33},"end":{"line":50,"column":5}},"line":48},"7":{"name":"(anonymous_7)","decl":{"start":{"line":51,"column":4},"end":{"line":51,"column":5}},"loc":{"start":{"line":51,"column":51},"end":{"line":54,"column":5}},"line":51},"8":{"name":"(anonymous_8)","decl":{"start":{"line":53,"column":33},"end":{"line":53,"column":34}},"loc":{"start":{"line":53,"column":52},"end":{"line":53,"column":93}},"line":53},"9":{"name":"(anonymous_9)","decl":{"start":{"line":55,"column":4},"end":{"line":55,"column":5}},"loc":{"start":{"line":55,"column":41},"end":{"line":57,"column":5}},"line":55},"10":{"name":"(anonymous_10)","decl":{"start":{"line":58,"column":4},"end":{"line":58,"column":5}},"loc":{"start":{"line":58,"column":39},"end":{"line":60,"column":5}},"line":58},"11":{"name":"(anonymous_11)","decl":{"start":{"line":62,"column":4},"end":{"line":62,"column":5}},"loc":{"start":{"line":62,"column":45},"end":{"line":81,"column":5}},"line":62},"12":{"name":"(anonymous_12)","decl":{"start":{"line":82,"column":4},"end":{"line":82,"column":5}},"loc":{"start":{"line":82,"column":30},"end":{"line":89,"column":5}},"line":82},"13":{"name":"(anonymous_13)","decl":{"start":{"line":90,"column":4},"end":{"line":90,"column":5}},"loc":{"start":{"line":90,"column":29},"end":{"line":92,"column":5}},"line":90},"14":{"name":"(anonymous_14)","decl":{"start":{"line":93,"column":4},"end":{"line":93,"column":5}},"loc":{"start":{"line":93,"column":27},"end":{"line":101,"column":5}},"line":93},"15":{"name":"(anonymous_15)","decl":{"start":{"line":102,"column":4},"end":{"line":102,"column":5}},"loc":{"start":{"line":102,"column":44},"end":{"line":113,"column":5}},"line":102},"16":{"name":"(anonymous_16)","decl":{"start":{"line":114,"column":4},"end":{"line":114,"column":5}},"loc":{"start":{"line":114,"column":73},"end":{"line":118,"column":5}},"line":114},"17":{"name":"(anonymous_17)","decl":{"start":{"line":119,"column":4},"end":{"line":119,"column":5}},"loc":{"start":{"line":119,"column":29},"end":{"line":123,"column":5}},"line":119},"18":{"name":"(anonymous_18)","decl":{"start":{"line":124,"column":4},"end":{"line":124,"column":5}},"loc":{"start":{"line":124,"column":31},"end":{"line":128,"column":5}},"line":124},"19":{"name":"(anonymous_19)","decl":{"start":{"line":129,"column":4},"end":{"line":129,"column":5}},"loc":{"start":{"line":129,"column":72},"end":{"line":144,"column":5}},"line":129},"20":{"name":"(anonymous_20)","decl":{"start":{"line":130,"column":27},"end":{"line":130,"column":28}},"loc":{"start":{"line":130,"column":46},"end":{"line":143,"column":9}},"line":130},"21":{"name":"(anonymous_21)","decl":{"start":{"line":132,"column":45},"end":{"line":132,"column":46}},"loc":{"start":{"line":132,"column":61},"end":{"line":142,"column":13}},"line":132},"22":{"name":"(anonymous_22)","decl":{"start":{"line":145,"column":4},"end":{"line":145,"column":5}},"loc":{"start":{"line":145,"column":31},"end":{"line":167,"column":5}},"line":145},"23":{"name":"(anonymous_23)","decl":{"start":{"line":168,"column":4},"end":{"line":168,"column":5}},"loc":{"start":{"line":168,"column":31},"end":{"line":173,"column":5}},"line":168},"24":{"name":"(anonymous_24)","decl":{"start":{"line":174,"column":4},"end":{"line":174,"column":5}},"loc":{"start":{"line":174,"column":32},"end":{"line":275,"column":5}},"line":174},"25":{"name":"(anonymous_25)","decl":{"start":{"line":276,"column":4},"end":{"line":276,"column":5}},"loc":{"start":{"line":276,"column":66},"end":{"line":332,"column":5}},"line":276},"26":{"name":"(anonymous_26)","decl":{"start":{"line":333,"column":4},"end":{"line":333,"column":5}},"loc":{"start":{"line":333,"column":65},"end":{"line":335,"column":5}},"line":333},"27":{"name":"(anonymous_27)","decl":{"start":{"line":336,"column":4},"end":{"line":336,"column":5}},"loc":{"start":{"line":336,"column":35},"end":{"line":344,"column":5}},"line":336},"28":{"name":"(anonymous_28)","decl":{"start":{"line":345,"column":4},"end":{"line":345,"column":5}},"loc":{"start":{"line":345,"column":43},"end":{"line":402,"column":5}},"line":345}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":11},"end":{"line":18,"column":5}},"type":"cond-expr","locations":[{"start":{"line":16,"column":35},"end":{"line":16,"column":38}},{"start":{"line":16,"column":41},"end":{"line":18,"column":5}}],"line":16},"1":{"loc":{"start":{"line":16,"column":11},"end":{"line":16,"column":32}},"type":"binary-expr","locations":[{"start":{"line":16,"column":11},"end":{"line":16,"column":14}},{"start":{"line":16,"column":18},"end":{"line":16,"column":32}}],"line":16},"2":{"loc":{"start":{"line":69,"column":8},"end":{"line":71,"column":9}},"type":"if","locations":[{"start":{"line":69,"column":8},"end":{"line":71,"column":9}},{"start":{"line":69,"column":8},"end":{"line":71,"column":9}}],"line":69},"3":{"loc":{"start":{"line":69,"column":12},"end":{"line":69,"column":94}},"type":"binary-expr","locations":[{"start":{"line":69,"column":12},"end":{"line":69,"column":41}},{"start":{"line":69,"column":45},"end":{"line":69,"column":94}}],"line":69},"4":{"loc":{"start":{"line":72,"column":8},"end":{"line":74,"column":9}},"type":"if","locations":[{"start":{"line":72,"column":8},"end":{"line":74,"column":9}},{"start":{"line":72,"column":8},"end":{"line":74,"column":9}}],"line":72},"5":{"loc":{"start":{"line":72,"column":12},"end":{"line":72,"column":94}},"type":"binary-expr","locations":[{"start":{"line":72,"column":12},"end":{"line":72,"column":41}},{"start":{"line":72,"column":45},"end":{"line":72,"column":94}}],"line":72},"6":{"loc":{"start":{"line":75,"column":8},"end":{"line":77,"column":9}},"type":"if","locations":[{"start":{"line":75,"column":8},"end":{"line":77,"column":9}},{"start":{"line":75,"column":8},"end":{"line":77,"column":9}}],"line":75},"7":{"loc":{"start":{"line":75,"column":12},"end":{"line":75,"column":90}},"type":"binary-expr","locations":[{"start":{"line":75,"column":12},"end":{"line":75,"column":39}},{"start":{"line":75,"column":43},"end":{"line":75,"column":90}}],"line":75},"8":{"loc":{"start":{"line":78,"column":8},"end":{"line":80,"column":9}},"type":"if","locations":[{"start":{"line":78,"column":8},"end":{"line":80,"column":9}},{"start":{"line":78,"column":8},"end":{"line":80,"column":9}}],"line":78},"9":{"loc":{"start":{"line":78,"column":12},"end":{"line":78,"column":92}},"type":"binary-expr","locations":[{"start":{"line":78,"column":12},"end":{"line":78,"column":40}},{"start":{"line":78,"column":44},"end":{"line":78,"column":92}}],"line":78},"10":{"loc":{"start":{"line":95,"column":8},"end":{"line":97,"column":9}},"type":"if","locations":[{"start":{"line":95,"column":8},"end":{"line":97,"column":9}},{"start":{"line":95,"column":8},"end":{"line":97,"column":9}}],"line":95},"11":{"loc":{"start":{"line":105,"column":12},"end":{"line":110,"column":13}},"type":"if","locations":[{"start":{"line":105,"column":12},"end":{"line":110,"column":13}},{"start":{"line":105,"column":12},"end":{"line":110,"column":13}}],"line":105},"12":{"loc":{"start":{"line":115,"column":33},"end":{"line":115,"column":101}},"type":"cond-expr","locations":[{"start":{"line":115,"column":47},"end":{"line":115,"column":96}},{"start":{"line":115,"column":99},"end":{"line":115,"column":101}}],"line":115},"13":{"loc":{"start":{"line":120,"column":8},"end":{"line":122,"column":9}},"type":"if","locations":[{"start":{"line":120,"column":8},"end":{"line":122,"column":9}},{"start":{"line":120,"column":8},"end":{"line":122,"column":9}}],"line":120},"14":{"loc":{"start":{"line":120,"column":12},"end":{"line":120,"column":27}},"type":"binary-expr","locations":[{"start":{"line":120,"column":12},"end":{"line":120,"column":17}},{"start":{"line":120,"column":21},"end":{"line":120,"column":27}}],"line":120},"15":{"loc":{"start":{"line":125,"column":8},"end":{"line":127,"column":9}},"type":"if","locations":[{"start":{"line":125,"column":8},"end":{"line":127,"column":9}},{"start":{"line":125,"column":8},"end":{"line":127,"column":9}}],"line":125},"16":{"loc":{"start":{"line":133,"column":16},"end":{"line":136,"column":17}},"type":"if","locations":[{"start":{"line":133,"column":16},"end":{"line":136,"column":17}},{"start":{"line":133,"column":16},"end":{"line":136,"column":17}}],"line":133},"17":{"loc":{"start":{"line":137,"column":16},"end":{"line":139,"column":17}},"type":"if","locations":[{"start":{"line":137,"column":16},"end":{"line":139,"column":17}},{"start":{"line":137,"column":16},"end":{"line":139,"column":17}}],"line":137},"18":{"loc":{"start":{"line":150,"column":8},"end":{"line":161,"column":9}},"type":"if","locations":[{"start":{"line":150,"column":8},"end":{"line":161,"column":9}},{"start":{"line":150,"column":8},"end":{"line":161,"column":9}}],"line":150},"19":{"loc":{"start":{"line":154,"column":12},"end":{"line":156,"column":13}},"type":"if","locations":[{"start":{"line":154,"column":12},"end":{"line":156,"column":13}},{"start":{"line":154,"column":12},"end":{"line":156,"column":13}}],"line":154},"20":{"loc":{"start":{"line":154,"column":16},"end":{"line":154,"column":230}},"type":"cond-expr","locations":[{"start":{"line":154,"column":69},"end":{"line":154,"column":75}},{"start":{"line":154,"column":78},"end":{"line":154,"column":230}}],"line":154},"21":{"loc":{"start":{"line":154,"column":16},"end":{"line":154,"column":66}},"type":"binary-expr","locations":[{"start":{"line":154,"column":16},"end":{"line":154,"column":38}},{"start":{"line":154,"column":42},"end":{"line":154,"column":66}}],"line":154},"22":{"loc":{"start":{"line":154,"column":78},"end":{"line":154,"column":230}},"type":"cond-expr","locations":[{"start":{"line":154,"column":184},"end":{"line":154,"column":190}},{"start":{"line":154,"column":193},"end":{"line":154,"column":230}}],"line":154},"23":{"loc":{"start":{"line":154,"column":78},"end":{"line":154,"column":181}},"type":"binary-expr","locations":[{"start":{"line":154,"column":78},"end":{"line":154,"column":141}},{"start":{"line":154,"column":145},"end":{"line":154,"column":181}}],"line":154},"24":{"loc":{"start":{"line":158,"column":12},"end":{"line":160,"column":13}},"type":"if","locations":[{"start":{"line":158,"column":12},"end":{"line":160,"column":13}},{"start":{"line":158,"column":12},"end":{"line":160,"column":13}}],"line":158},"25":{"loc":{"start":{"line":165,"column":24},"end":{"line":165,"column":36}},"type":"binary-expr","locations":[{"start":{"line":165,"column":24},"end":{"line":165,"column":30}},{"start":{"line":165,"column":34},"end":{"line":165,"column":36}}],"line":165},"26":{"loc":{"start":{"line":169,"column":8},"end":{"line":171,"column":9}},"type":"if","locations":[{"start":{"line":169,"column":8},"end":{"line":171,"column":9}},{"start":{"line":169,"column":8},"end":{"line":171,"column":9}}],"line":169},"27":{"loc":{"start":{"line":201,"column":12},"end":{"line":203,"column":13}},"type":"if","locations":[{"start":{"line":201,"column":12},"end":{"line":203,"column":13}},{"start":{"line":201,"column":12},"end":{"line":203,"column":13}}],"line":201},"28":{"loc":{"start":{"line":205,"column":12},"end":{"line":207,"column":13}},"type":"if","locations":[{"start":{"line":205,"column":12},"end":{"line":207,"column":13}},{"start":{"line":205,"column":12},"end":{"line":207,"column":13}}],"line":205},"29":{"loc":{"start":{"line":205,"column":16},"end":{"line":205,"column":78}},"type":"binary-expr","locations":[{"start":{"line":205,"column":16},"end":{"line":205,"column":45}},{"start":{"line":205,"column":49},"end":{"line":205,"column":78}}],"line":205},"30":{"loc":{"start":{"line":208,"column":12},"end":{"line":214,"column":13}},"type":"if","locations":[{"start":{"line":208,"column":12},"end":{"line":214,"column":13}},{"start":{"line":208,"column":12},"end":{"line":214,"column":13}}],"line":208},"31":{"loc":{"start":{"line":209,"column":16},"end":{"line":211,"column":17}},"type":"if","locations":[{"start":{"line":209,"column":16},"end":{"line":211,"column":17}},{"start":{"line":209,"column":16},"end":{"line":211,"column":17}}],"line":209},"32":{"loc":{"start":{"line":217,"column":12},"end":{"line":254,"column":13}},"type":"if","locations":[{"start":{"line":217,"column":12},"end":{"line":254,"column":13}},{"start":{"line":217,"column":12},"end":{"line":254,"column":13}}],"line":217},"33":{"loc":{"start":{"line":219,"column":16},"end":{"line":221,"column":17}},"type":"if","locations":[{"start":{"line":219,"column":16},"end":{"line":221,"column":17}},{"start":{"line":219,"column":16},"end":{"line":221,"column":17}}],"line":219},"34":{"loc":{"start":{"line":219,"column":20},"end":{"line":219,"column":101}},"type":"binary-expr","locations":[{"start":{"line":219,"column":20},"end":{"line":219,"column":58}},{"start":{"line":219,"column":62},"end":{"line":219,"column":101}}],"line":219},"35":{"loc":{"start":{"line":222,"column":34},"end":{"line":222,"column":77}},"type":"binary-expr","locations":[{"start":{"line":222,"column":34},"end":{"line":222,"column":53}},{"start":{"line":222,"column":57},"end":{"line":222,"column":77}}],"line":222},"36":{"loc":{"start":{"line":224,"column":16},"end":{"line":233,"column":17}},"type":"if","locations":[{"start":{"line":224,"column":16},"end":{"line":233,"column":17}},{"start":{"line":224,"column":16},"end":{"line":233,"column":17}}],"line":224},"37":{"loc":{"start":{"line":225,"column":20},"end":{"line":227,"column":21}},"type":"if","locations":[{"start":{"line":225,"column":20},"end":{"line":227,"column":21}},{"start":{"line":225,"column":20},"end":{"line":227,"column":21}}],"line":225},"38":{"loc":{"start":{"line":234,"column":16},"end":{"line":236,"column":17}},"type":"if","locations":[{"start":{"line":234,"column":16},"end":{"line":236,"column":17}},{"start":{"line":234,"column":16},"end":{"line":236,"column":17}}],"line":234},"39":{"loc":{"start":{"line":234,"column":20},"end":{"line":234,"column":54}},"type":"binary-expr","locations":[{"start":{"line":234,"column":20},"end":{"line":234,"column":25}},{"start":{"line":234,"column":29},"end":{"line":234,"column":54}}],"line":234},"40":{"loc":{"start":{"line":237,"column":16},"end":{"line":239,"column":17}},"type":"if","locations":[{"start":{"line":237,"column":16},"end":{"line":239,"column":17}},{"start":{"line":237,"column":16},"end":{"line":239,"column":17}}],"line":237},"41":{"loc":{"start":{"line":237,"column":20},"end":{"line":237,"column":60}},"type":"binary-expr","locations":[{"start":{"line":237,"column":20},"end":{"line":237,"column":28}},{"start":{"line":237,"column":32},"end":{"line":237,"column":60}}],"line":237},"42":{"loc":{"start":{"line":242,"column":23},"end":{"line":244,"column":21}},"type":"binary-expr","locations":[{"start":{"line":242,"column":23},"end":{"line":242,"column":28}},{"start":{"line":242,"column":32},"end":{"line":244,"column":21}}],"line":242},"43":{"loc":{"start":{"line":245,"column":23},"end":{"line":247,"column":21}},"type":"binary-expr","locations":[{"start":{"line":245,"column":23},"end":{"line":245,"column":31}},{"start":{"line":245,"column":35},"end":{"line":247,"column":21}}],"line":245},"44":{"loc":{"start":{"line":249,"column":19},"end":{"line":254,"column":13}},"type":"if","locations":[{"start":{"line":249,"column":19},"end":{"line":254,"column":13}},{"start":{"line":249,"column":19},"end":{"line":254,"column":13}}],"line":249},"45":{"loc":{"start":{"line":255,"column":12},"end":{"line":259,"column":13}},"type":"if","locations":[{"start":{"line":255,"column":12},"end":{"line":259,"column":13}},{"start":{"line":255,"column":12},"end":{"line":259,"column":13}}],"line":255},"46":{"loc":{"start":{"line":256,"column":16},"end":{"line":258,"column":17}},"type":"if","locations":[{"start":{"line":256,"column":16},"end":{"line":258,"column":17}},{"start":{"line":256,"column":16},"end":{"line":258,"column":17}}],"line":256},"47":{"loc":{"start":{"line":256,"column":20},"end":{"line":256,"column":99}},"type":"binary-expr","locations":[{"start":{"line":256,"column":20},"end":{"line":256,"column":43}},{"start":{"line":256,"column":47},"end":{"line":256,"column":73}},{"start":{"line":256,"column":77},"end":{"line":256,"column":99}}],"line":256},"48":{"loc":{"start":{"line":261,"column":8},"end":{"line":273,"column":9}},"type":"if","locations":[{"start":{"line":261,"column":8},"end":{"line":273,"column":9}},{"start":{"line":261,"column":8},"end":{"line":273,"column":9}}],"line":261},"49":{"loc":{"start":{"line":266,"column":12},"end":{"line":272,"column":13}},"type":"if","locations":[{"start":{"line":266,"column":12},"end":{"line":272,"column":13}},{"start":{"line":266,"column":12},"end":{"line":272,"column":13}}],"line":266},"50":{"loc":{"start":{"line":276,"column":45},"end":{"line":276,"column":64}},"type":"default-arg","locations":[{"start":{"line":276,"column":59},"end":{"line":276,"column":64}}],"line":276},"51":{"loc":{"start":{"line":284,"column":12},"end":{"line":296,"column":13}},"type":"if","locations":[{"start":{"line":284,"column":12},"end":{"line":296,"column":13}},{"start":{"line":284,"column":12},"end":{"line":296,"column":13}}],"line":284},"52":{"loc":{"start":{"line":291,"column":16},"end":{"line":293,"column":17}},"type":"if","locations":[{"start":{"line":291,"column":16},"end":{"line":293,"column":17}},{"start":{"line":291,"column":16},"end":{"line":293,"column":17}}],"line":291},"53":{"loc":{"start":{"line":298,"column":12},"end":{"line":300,"column":13}},"type":"if","locations":[{"start":{"line":298,"column":12},"end":{"line":300,"column":13}},{"start":{"line":298,"column":12},"end":{"line":300,"column":13}}],"line":298},"54":{"loc":{"start":{"line":303,"column":8},"end":{"line":310,"column":9}},"type":"if","locations":[{"start":{"line":303,"column":8},"end":{"line":310,"column":9}},{"start":{"line":303,"column":8},"end":{"line":310,"column":9}}],"line":303},"55":{"loc":{"start":{"line":305,"column":12},"end":{"line":309,"column":13}},"type":"if","locations":[{"start":{"line":305,"column":12},"end":{"line":309,"column":13}},{"start":{"line":305,"column":12},"end":{"line":309,"column":13}}],"line":305},"56":{"loc":{"start":{"line":311,"column":8},"end":{"line":327,"column":9}},"type":"if","locations":[{"start":{"line":311,"column":8},"end":{"line":327,"column":9}},{"start":{"line":311,"column":8},"end":{"line":327,"column":9}}],"line":311},"57":{"loc":{"start":{"line":311,"column":12},"end":{"line":311,"column":57}},"type":"binary-expr","locations":[{"start":{"line":311,"column":12},"end":{"line":311,"column":25}},{"start":{"line":311,"column":29},"end":{"line":311,"column":38}},{"start":{"line":311,"column":42},"end":{"line":311,"column":57}}],"line":311},"58":{"loc":{"start":{"line":314,"column":12},"end":{"line":320,"column":13}},"type":"if","locations":[{"start":{"line":314,"column":12},"end":{"line":320,"column":13}},{"start":{"line":314,"column":12},"end":{"line":320,"column":13}}],"line":314},"59":{"loc":{"start":{"line":314,"column":16},"end":{"line":314,"column":74}},"type":"cond-expr","locations":[{"start":{"line":314,"column":53},"end":{"line":314,"column":59}},{"start":{"line":314,"column":62},"end":{"line":314,"column":74}}],"line":314},"60":{"loc":{"start":{"line":314,"column":16},"end":{"line":314,"column":50}},"type":"binary-expr","locations":[{"start":{"line":314,"column":16},"end":{"line":314,"column":30}},{"start":{"line":314,"column":34},"end":{"line":314,"column":50}}],"line":314},"61":{"loc":{"start":{"line":315,"column":16},"end":{"line":319,"column":17}},"type":"if","locations":[{"start":{"line":315,"column":16},"end":{"line":319,"column":17}},{"start":{"line":315,"column":16},"end":{"line":319,"column":17}}],"line":315},"62":{"loc":{"start":{"line":321,"column":12},"end":{"line":326,"column":13}},"type":"if","locations":[{"start":{"line":321,"column":12},"end":{"line":326,"column":13}},{"start":{"line":321,"column":12},"end":{"line":326,"column":13}}],"line":321},"63":{"loc":{"start":{"line":323,"column":16},"end":{"line":325,"column":17}},"type":"if","locations":[{"start":{"line":323,"column":16},"end":{"line":325,"column":17}},{"start":{"line":323,"column":16},"end":{"line":325,"column":17}}],"line":323},"64":{"loc":{"start":{"line":328,"column":8},"end":{"line":330,"column":9}},"type":"if","locations":[{"start":{"line":328,"column":8},"end":{"line":330,"column":9}},{"start":{"line":328,"column":8},"end":{"line":330,"column":9}}],"line":328},"65":{"loc":{"start":{"line":328,"column":12},"end":{"line":328,"column":69}},"type":"binary-expr","locations":[{"start":{"line":328,"column":12},"end":{"line":328,"column":29}},{"start":{"line":328,"column":33},"end":{"line":328,"column":69}}],"line":328},"66":{"loc":{"start":{"line":333,"column":46},"end":{"line":333,"column":63}},"type":"default-arg","locations":[{"start":{"line":333,"column":57},"end":{"line":333,"column":63}}],"line":333},"67":{"loc":{"start":{"line":338,"column":8},"end":{"line":342,"column":9}},"type":"switch","locations":[{"start":{"line":339,"column":12},"end":{"line":341,"column":22}}],"line":338},"68":{"loc":{"start":{"line":348,"column":8},"end":{"line":355,"column":9}},"type":"if","locations":[{"start":{"line":348,"column":8},"end":{"line":355,"column":9}},{"start":{"line":348,"column":8},"end":{"line":355,"column":9}}],"line":348},"69":{"loc":{"start":{"line":349,"column":12},"end":{"line":351,"column":13}},"type":"if","locations":[{"start":{"line":349,"column":12},"end":{"line":351,"column":13}},{"start":{"line":349,"column":12},"end":{"line":351,"column":13}}],"line":349},"70":{"loc":{"start":{"line":352,"column":12},"end":{"line":354,"column":13}},"type":"if","locations":[{"start":{"line":352,"column":12},"end":{"line":354,"column":13}},{"start":{"line":352,"column":12},"end":{"line":354,"column":13}}],"line":352},"71":{"loc":{"start":{"line":358,"column":12},"end":{"line":361,"column":13}},"type":"if","locations":[{"start":{"line":358,"column":12},"end":{"line":361,"column":13}},{"start":{"line":358,"column":12},"end":{"line":361,"column":13}}],"line":358},"72":{"loc":{"start":{"line":368,"column":8},"end":{"line":370,"column":9}},"type":"if","locations":[{"start":{"line":368,"column":8},"end":{"line":370,"column":9}},{"start":{"line":368,"column":8},"end":{"line":370,"column":9}}],"line":368},"73":{"loc":{"start":{"line":379,"column":22},"end":{"line":379,"column":69}},"type":"binary-expr","locations":[{"start":{"line":379,"column":22},"end":{"line":379,"column":26}},{"start":{"line":379,"column":30},"end":{"line":379,"column":49}},{"start":{"line":379,"column":53},"end":{"line":379,"column":69}}],"line":379},"74":{"loc":{"start":{"line":384,"column":8},"end":{"line":386,"column":9}},"type":"if","locations":[{"start":{"line":384,"column":8},"end":{"line":386,"column":9}},{"start":{"line":384,"column":8},"end":{"line":386,"column":9}}],"line":384},"75":{"loc":{"start":{"line":387,"column":8},"end":{"line":389,"column":9}},"type":"if","locations":[{"start":{"line":387,"column":8},"end":{"line":389,"column":9}},{"start":{"line":387,"column":8},"end":{"line":389,"column":9}}],"line":387},"76":{"loc":{"start":{"line":390,"column":8},"end":{"line":396,"column":9}},"type":"if","locations":[{"start":{"line":390,"column":8},"end":{"line":396,"column":9}},{"start":{"line":390,"column":8},"end":{"line":396,"column":9}}],"line":390},"77":{"loc":{"start":{"line":391,"column":12},"end":{"line":395,"column":13}},"type":"if","locations":[{"start":{"line":391,"column":12},"end":{"line":395,"column":13}},{"start":{"line":391,"column":12},"end":{"line":395,"column":13}}],"line":391}},"s":{"0":1,"1":1,"2":291,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":0,"14":26,"15":0,"16":13,"17":5,"18":0,"19":0,"20":0,"21":0,"22":0,"23":14,"24":14,"25":14,"26":14,"27":14,"28":14,"29":14,"30":14,"31":14,"32":14,"33":14,"34":14,"35":14,"36":14,"37":10,"38":10,"39":10,"40":10,"41":200,"42":10,"43":9,"44":9,"45":9,"46":0,"47":9,"48":9,"49":9,"50":23,"51":23,"52":113,"53":113,"54":113,"55":40,"56":23,"57":1,"58":1,"59":188,"60":0,"61":1,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":24,"74":24,"75":24,"76":24,"77":24,"78":22,"79":22,"80":22,"81":0,"82":22,"83":22,"84":20,"85":24,"86":2,"87":1,"88":1,"89":15,"90":15,"91":15,"92":0,"93":0,"94":0,"95":15,"96":15,"97":15,"98":40,"99":0,"100":40,"101":40,"102":0,"103":40,"104":1,"105":0,"106":1,"107":1,"108":39,"109":39,"110":11,"111":0,"112":11,"113":11,"114":11,"115":5,"116":0,"117":5,"118":31,"119":6,"120":11,"121":0,"122":11,"123":0,"124":11,"125":28,"126":28,"127":28,"128":39,"129":39,"130":35,"131":15,"132":15,"133":15,"134":14,"135":1,"136":1,"137":1,"138":15,"139":45,"140":45,"141":45,"142":47,"143":47,"144":3,"145":3,"146":6,"147":6,"148":3,"149":3,"150":2,"151":44,"152":47,"153":47,"154":45,"155":45,"156":45,"157":7,"158":1,"159":6,"160":45,"161":3,"162":3,"163":3,"164":3,"165":0,"166":3,"167":3,"168":3,"169":2,"170":45,"171":1,"172":45,"173":0,"174":13,"175":13,"176":0,"177":0,"178":13,"179":15,"180":15,"181":15,"182":1,"183":0,"184":1,"185":0,"186":15,"187":15,"188":62,"189":1,"190":1,"191":61,"192":15,"193":15,"194":15,"195":15,"196":2,"197":13,"198":13,"199":13,"200":13,"201":12,"202":13,"203":13,"204":2,"205":11,"206":13,"207":13,"208":1},"f":{"0":291,"1":1,"2":0,"3":26,"4":0,"5":13,"6":5,"7":0,"8":0,"9":0,"10":0,"11":14,"12":10,"13":9,"14":9,"15":23,"16":1,"17":188,"18":1,"19":0,"20":0,"21":0,"22":24,"23":2,"24":15,"25":45,"26":0,"27":13,"28":15},"b":{"0":[0,1],"1":[1,1],"2":[14,0],"3":[14,14],"4":[14,0],"5":[14,14],"6":[14,0],"7":[14,14],"8":[14,0],"9":[14,14],"10":[0,9],"11":[113,0],"12":[0,1],"13":[0,188],"14":[188,0],"15":[0,1],"16":[0,0],"17":[0,0],"18":[22,2],"19":[0,22],"20":[22,0],"21":[22,22],"22":[0,0],"23":[0,0],"24":[20,2],"25":[24,2],"26":[1,1],"27":[0,40],"28":[0,40],"29":[40,11],"30":[1,39],"31":[0,1],"32":[11,28],"33":[0,11],"34":[11,5],"35":[11,5],"36":[5,6],"37":[0,5],"38":[0,11],"39":[11,3],"40":[0,11],"41":[11,7],"42":[11,3],"43":[11,7],"44":[28,0],"45":[39,0],"46":[35,4],"47":[39,26,14],"48":[15,0],"49":[14,1],"50":[15],"51":[3,44],"52":[2,1],"53":[45,2],"54":[7,38],"55":[1,6],"56":[3,42],"57":[45,3,3],"58":[3,0],"59":[0,3],"60":[3,3],"61":[3,0],"62":[3,0],"63":[2,1],"64":[1,44],"65":[45,1],"66":[0],"67":[0],"68":[1,14],"69":[0,1],"70":[0,1],"71":[1,61],"72":[2,13],"73":[13,3,1],"74":[13,0],"75":[12,1],"76":[13,0],"77":[2,11]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/Utils.ts"],"sourcesContent":["import { EventEmitter } from 'events';\nimport zlib from 'zlib';\n\nimport type { Logger } from '@rocket.chat/logger';\n\nimport { ensureArray } from '../../../../lib/utils/arrayUtils';\nimport type { IUserDataMap, IAttributeMapping } from '../definition/IAttributeMapping';\nimport type { ISAMLGlobalSettings } from '../definition/ISAMLGlobalSettings';\nimport type { ISAMLUser } from '../definition/ISAMLUser';\nimport type { IServiceProviderOptions } from '../definition/IServiceProviderOptions';\nimport { StatusCode } from './constants';\n\nlet providerList: Array<IServiceProviderOptions> = [];\nlet debug = false;\nlet relayState: string | null = null;\nlet logger: Logger | undefined;\n\nconst globalSettings: ISAMLGlobalSettings = {\n\tgenerateUsername: false,\n\tnameOverwrite: false,\n\tmailOverwrite: false,\n\timmutableProperty: 'EMail',\n\tdefaultUserRole: 'user',\n\tuserDataFieldMap: '{\"username\":\"username\", \"email\":\"email\", \"cn\": \"name\"}',\n\tusernameNormalize: 'None',\n\tchannelsAttributeUpdate: false,\n\tincludePrivateChannelsInUpdate: false,\n};\n\nexport class SAMLUtils {\n\tpublic static events: EventEmitter;\n\n\tpublic static get isDebugging(): boolean {\n\t\treturn debug;\n\t}\n\n\tpublic static get globalSettings(): ISAMLGlobalSettings {\n\t\treturn globalSettings;\n\t}\n\n\tpublic static get serviceProviders(): Array<IServiceProviderOptions> {\n\t\treturn providerList;\n\t}\n\n\tpublic static get relayState(): string | null {\n\t\treturn relayState;\n\t}\n\n\tpublic static set relayState(value: string | null) {\n\t\trelayState = value;\n\t}\n\n\tpublic static getServiceProviderOptions(providerName: string): IServiceProviderOptions | undefined {\n\t\tthis.log(providerName, providerList);\n\n\t\treturn providerList.find((providerOptions) => providerOptions.provider === providerName);\n\t}\n\n\tpublic static setServiceProvidersList(list: Array<IServiceProviderOptions>): void {\n\t\tproviderList = list;\n\t}\n\n\tpublic static setLoggerInstance(instance: Logger): void {\n\t\tlogger = instance;\n\t}\n\n\t// TODO: Some of those should probably not be global\n\tpublic static updateGlobalSettings(samlConfigs: Record<string, any>): void {\n\t\tdebug = Boolean(samlConfigs.debug);\n\n\t\tglobalSettings.generateUsername = Boolean(samlConfigs.generateUsername);\n\t\tglobalSettings.nameOverwrite = Boolean(samlConfigs.nameOverwrite);\n\t\tglobalSettings.mailOverwrite = Boolean(samlConfigs.mailOverwrite);\n\t\tglobalSettings.channelsAttributeUpdate = Boolean(samlConfigs.channelsAttributeUpdate);\n\t\tglobalSettings.includePrivateChannelsInUpdate = Boolean(samlConfigs.includePrivateChannelsInUpdate);\n\n\t\tif (samlConfigs.immutableProperty && typeof samlConfigs.immutableProperty === 'string') {\n\t\t\tglobalSettings.immutableProperty = samlConfigs.immutableProperty;\n\t\t}\n\n\t\tif (samlConfigs.usernameNormalize && typeof samlConfigs.usernameNormalize === 'string') {\n\t\t\tglobalSettings.usernameNormalize = samlConfigs.usernameNormalize;\n\t\t}\n\n\t\tif (samlConfigs.defaultUserRole && typeof samlConfigs.defaultUserRole === 'string') {\n\t\t\tglobalSettings.defaultUserRole = samlConfigs.defaultUserRole;\n\t\t}\n\n\t\tif (samlConfigs.userDataFieldMap && typeof samlConfigs.userDataFieldMap === 'string') {\n\t\t\tglobalSettings.userDataFieldMap = samlConfigs.userDataFieldMap;\n\t\t}\n\t}\n\n\tpublic static generateUniqueID(): string {\n\t\tconst chars = 'abcdef0123456789';\n\t\tlet uniqueID = 'id-';\n\t\tfor (let i = 0; i < 20; i++) {\n\t\t\tuniqueID += chars.substr(Math.floor(Math.random() * 15), 1);\n\t\t}\n\t\treturn uniqueID;\n\t}\n\n\tpublic static generateInstant(): string {\n\t\treturn new Date().toISOString();\n\t}\n\n\tpublic static certToPEM(cert: string): string {\n\t\tconst lines = cert.match(/.{1,64}/g);\n\t\tif (!lines) {\n\t\t\tthrow new Error('Invalid Certificate');\n\t\t}\n\n\t\tlines.splice(0, 0, '-----BEGIN CERTIFICATE-----');\n\t\tlines.push('-----END CERTIFICATE-----');\n\n\t\treturn lines.join('\\n');\n\t}\n\n\tpublic static fillTemplateData(template: string, data: Record<string, string>): string {\n\t\tlet newTemplate = template;\n\n\t\tfor (const variable in data) {\n\t\t\tif (variable in data) {\n\t\t\t\tconst key = `__${variable}__`;\n\t\t\t\twhile (newTemplate.includes(key)) {\n\t\t\t\t\tnewTemplate = newTemplate.replace(key, data[variable]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn newTemplate;\n\t}\n\n\tpublic static getValidationActionRedirectPath(credentialToken: string, redirectUrl?: string): string {\n\t\tconst redirectUrlParam = redirectUrl ? `&redirectUrl=${encodeURIComponent(redirectUrl)}` : '';\n\t\t// the saml_idp_credentialToken param is needed by the mobile app\n\t\treturn `saml/${credentialToken}?saml_idp_credentialToken=${credentialToken}${redirectUrlParam}`;\n\t}\n\n\tpublic static log(obj: any, ...args: Array<any>): void {\n\t\tif (debug && logger) {\n\t\t\tlogger.debug(obj, ...args);\n\t\t}\n\t}\n\n\tpublic static error(obj: any, ...args: Array<any>): void {\n\t\tif (logger) {\n\t\t\tlogger.error(obj, ...args);\n\t\t}\n\t}\n\n\tpublic static async inflateXml(\n\t\tbase64Data: string,\n\t\tsuccessCallback: (xml: string) => Promise<void>,\n\t\terrorCallback: (err: string | object | null) => Promise<void>,\n\t): Promise<void> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst buffer = Buffer.from(base64Data, 'base64');\n\t\t\tzlib.inflateRaw(buffer, (err, decoded) => {\n\t\t\t\tif (err) {\n\t\t\t\t\tthis.log(`Error while inflating. ${err}`);\n\t\t\t\t\treturn reject(errorCallback(err));\n\t\t\t\t}\n\n\t\t\t\tif (!decoded) {\n\t\t\t\t\treturn reject(errorCallback('Failed to extract request data'));\n\t\t\t\t}\n\n\t\t\t\tconst xmlString = this.convertArrayBufferToString(decoded);\n\t\t\t\treturn resolve(successCallback(xmlString));\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic static validateStatus(doc: Document): {\n\t\tsuccess: boolean;\n\t\tmessage: string;\n\t\tstatusCode: string;\n\t} {\n\t\tlet successStatus = false;\n\t\tlet status = null;\n\t\tlet messageText = '';\n\n\t\tconst statusNodes = doc.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:protocol', 'StatusCode');\n\n\t\tif (statusNodes.length) {\n\t\t\tconst statusNode = statusNodes[0];\n\t\t\tconst statusMessage = doc.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:protocol', 'StatusMessage')[0];\n\n\t\t\tif (statusMessage?.firstChild?.textContent) {\n\t\t\t\tmessageText = statusMessage.firstChild.textContent;\n\t\t\t}\n\n\t\t\tstatus = statusNode.getAttribute('Value');\n\n\t\t\tif (status === StatusCode.success) {\n\t\t\t\tsuccessStatus = true;\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tsuccess: successStatus,\n\t\t\tmessage: messageText,\n\t\t\tstatusCode: status || '',\n\t\t};\n\t}\n\n\tpublic static normalizeCert(cert: string): string {\n\t\tif (!cert) {\n\t\t\treturn cert;\n\t\t}\n\n\t\treturn cert\n\t\t\t.replace(/-+BEGIN CERTIFICATE-+\\r?\\n?/, '')\n\t\t\t.replace(/-+END CERTIFICATE-+\\r?\\n?/, '')\n\t\t\t.replace(/\\r\\n/g, '\\n')\n\t\t\t.trim();\n\t}\n\n\tpublic static getUserDataMapping(): IUserDataMap {\n\t\tconst { userDataFieldMap, immutableProperty } = globalSettings;\n\n\t\tlet map: Record<string, any>;\n\n\t\ttry {\n\t\t\tmap = JSON.parse(userDataFieldMap);\n\t\t} catch (e) {\n\t\t\tSAMLUtils.log(userDataFieldMap);\n\t\t\tSAMLUtils.log(e);\n\t\t\tthrow new Error('Failed to parse custom user field map');\n\t\t}\n\n\t\tconst parsedMap: IUserDataMap = {\n\t\t\tattributeList: new Set(),\n\t\t\temail: {\n\t\t\t\tfieldName: 'email',\n\t\t\t},\n\t\t\tusername: {\n\t\t\t\tfieldName: 'username',\n\t\t\t},\n\t\t\tname: {\n\t\t\t\tfieldName: 'cn',\n\t\t\t},\n\t\t\tidentifier: {\n\t\t\t\ttype: '',\n\t\t\t},\n\t\t};\n\n\t\tlet identifier = immutableProperty.toLowerCase();\n\n\t\tfor (const spFieldName in map) {\n\t\t\tif (!map.hasOwnProperty(spFieldName)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst attribute = map[spFieldName];\n\t\t\tif (typeof attribute !== 'string' && typeof attribute !== 'object') {\n\t\t\t\tthrow new Error(`SAML User Map: Invalid configuration for ${spFieldName} field.`);\n\t\t\t}\n\n\t\t\tif (spFieldName === '__identifier__') {\n\t\t\t\tif (typeof attribute !== 'string') {\n\t\t\t\t\tthrow new Error('SAML User Map: Invalid identifier.');\n\t\t\t\t}\n\n\t\t\t\tidentifier = attribute;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet attributeMap: IAttributeMapping | null = null;\n\n\t\t\t// If it's a complex type, let's check what's in it\n\t\t\tif (typeof attribute === 'object') {\n\t\t\t\t// A fieldName is mandatory for complex fields. If it's missing, let's skip this one.\n\t\t\t\tif (!attribute.hasOwnProperty('fieldName') && !attribute.hasOwnProperty('fieldNames')) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst fieldName = attribute.fieldName || attribute.fieldNames;\n\t\t\t\tconst { regex, template } = attribute;\n\n\t\t\t\tif (Array.isArray(fieldName)) {\n\t\t\t\t\tif (!fieldName.length) {\n\t\t\t\t\t\tthrow new Error(`SAML User Map: Invalid configuration for ${spFieldName} field.`);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const idpFieldName of fieldName) {\n\t\t\t\t\t\tparsedMap.attributeList.add(idpFieldName);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tparsedMap.attributeList.add(fieldName);\n\t\t\t\t}\n\n\t\t\t\tif (regex && typeof regex !== 'string') {\n\t\t\t\t\tthrow new Error('SAML User Map: Invalid RegEx');\n\t\t\t\t}\n\n\t\t\t\tif (template && typeof template !== 'string') {\n\t\t\t\t\tthrow new Error('SAML User Map: Invalid Template');\n\t\t\t\t}\n\n\t\t\t\tattributeMap = {\n\t\t\t\t\tfieldName,\n\t\t\t\t\t...(regex && { regex }),\n\t\t\t\t\t...(template && { template }),\n\t\t\t\t};\n\t\t\t} else if (typeof attribute === 'string') {\n\t\t\t\tattributeMap = {\n\t\t\t\t\tfieldName: attribute,\n\t\t\t\t};\n\t\t\t\tparsedMap.attributeList.add(attribute);\n\t\t\t}\n\n\t\t\tif (attributeMap) {\n\t\t\t\tif (spFieldName === 'email' || spFieldName === 'username' || spFieldName === 'name') {\n\t\t\t\t\tparsedMap[spFieldName] = attributeMap;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (identifier) {\n\t\t\tconst defaultTypes = ['email', 'username'];\n\n\t\t\tif (defaultTypes.includes(identifier)) {\n\t\t\t\tparsedMap.identifier.type = identifier;\n\t\t\t} else {\n\t\t\t\tparsedMap.identifier.type = 'custom';\n\t\t\t\tparsedMap.identifier.attribute = identifier;\n\t\t\t\tparsedMap.attributeList.add(identifier);\n\t\t\t}\n\t\t}\n\t\treturn parsedMap;\n\t}\n\n\tpublic static getProfileValue(profile: Record<string, any>, mapping: IAttributeMapping, forceString = false): any {\n\t\tconst values: Record<string, string> = {\n\t\t\tregex: '',\n\t\t};\n\t\tconst fieldNames = ensureArray<string>(mapping.fieldName);\n\n\t\tlet mainValue;\n\t\tfor (const fieldName of fieldNames) {\n\t\t\tlet profileValue = profile[fieldName];\n\n\t\t\tif (Array.isArray(profileValue)) {\n\t\t\t\tfor (let i = 0; i < profile[fieldName].length; i++) {\n\t\t\t\t\t// Add every index to the list of possible values to be used, both first to last and from last to first\n\t\t\t\t\tvalues[`${fieldName}[${i}]`] = profileValue[i];\n\t\t\t\t\tvalues[`${fieldName}[-${Math.abs(0 - profileValue.length + i)}]`] = profileValue[i];\n\t\t\t\t}\n\t\t\t\tvalues[`${fieldName}[]`] = profileValue.join(' ');\n\t\t\t\tif (forceString) {\n\t\t\t\t\tprofileValue = profileValue.join(' ');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvalues[fieldName] = profileValue;\n\t\t\t}\n\n\t\t\tvalues[fieldName] = profileValue;\n\n\t\t\tif (!mainValue) {\n\t\t\t\tmainValue = profileValue;\n\t\t\t}\n\t\t}\n\n\t\tlet shouldRunTemplate = false;\n\t\tif (typeof mapping.template === 'string') {\n\t\t\t// unless the regex result is used on the template, we process the template first\n\t\t\tif (mapping.template.includes('__regex__')) {\n\t\t\t\tshouldRunTemplate = true;\n\t\t\t} else {\n\t\t\t\tmainValue = this.fillTemplateData(mapping.template, values);\n\t\t\t}\n\t\t}\n\n\t\tif (mapping.regex && mainValue && mainValue.match) {\n\t\t\tlet regexValue;\n\t\t\tconst match = mainValue.match(new RegExp(mapping.regex));\n\t\t\tif (match?.length) {\n\t\t\t\tif (match.length >= 2) {\n\t\t\t\t\tregexValue = match[1];\n\t\t\t\t} else {\n\t\t\t\t\tregexValue = match[0];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (regexValue) {\n\t\t\t\tvalues.regex = regexValue;\n\t\t\t\tif (!shouldRunTemplate) {\n\t\t\t\t\tmainValue = regexValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (shouldRunTemplate && typeof mapping.template === 'string') {\n\t\t\tmainValue = this.fillTemplateData(mapping.template, values);\n\t\t}\n\n\t\treturn mainValue;\n\t}\n\n\tpublic static convertArrayBufferToString(buffer: ArrayBuffer, encoding: BufferEncoding = 'utf8'): string {\n\t\treturn Buffer.from(buffer).toString(encoding);\n\t}\n\n\tpublic static normalizeUsername(name: string): string {\n\t\tconst { globalSettings } = this;\n\n\t\tswitch (globalSettings.usernameNormalize) {\n\t\t\tcase 'Lowercase':\n\t\t\t\tname = name.toLowerCase();\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn name;\n\t}\n\n\tpublic static mapProfileToUserObject(profile: Record<string, any>): ISAMLUser {\n\t\tconst userDataMap = this.getUserDataMapping();\n\t\tSAMLUtils.log('parsed userDataMap', userDataMap);\n\n\t\tif (userDataMap.identifier.type === 'custom') {\n\t\t\tif (!userDataMap.identifier.attribute) {\n\t\t\t\tthrow new Error('SAML User Data Map: invalid Identifier configuration received.');\n\t\t\t}\n\t\t\tif (!profile[userDataMap.identifier.attribute]) {\n\t\t\t\tthrow new Error(`SAML Profile did not have the expected identifier (${userDataMap.identifier.attribute}).`);\n\t\t\t}\n\t\t}\n\n\t\tconst attributeList = new Map();\n\t\tfor (const attributeName of userDataMap.attributeList) {\n\t\t\tif (profile[attributeName] === undefined) {\n\t\t\t\tthis.log(`SAML user profile is missing the attribute ${attributeName}.`);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tattributeList.set(attributeName, profile[attributeName]);\n\t\t}\n\t\tconst email = this.getProfileValue(profile, userDataMap.email);\n\t\tconst profileUsername = this.getProfileValue(profile, userDataMap.username, true);\n\t\tconst name = this.getProfileValue(profile, userDataMap.name, true);\n\n\t\t// Even if we're not using the email to identify the user, it is still mandatory because it's a mandatory information on Rocket.Chat\n\t\tif (!email) {\n\t\t\tthrow new Error('SAML Profile did not contain an email address');\n\t\t}\n\n\t\tconst userObject: ISAMLUser = {\n\t\t\tsamlLogin: {\n\t\t\t\tprovider: this.relayState,\n\t\t\t\tidp: profile.issuer,\n\t\t\t\tidpSession: profile.sessionIndex,\n\t\t\t\tnameID: profile.nameID,\n\t\t\t},\n\t\t\temailList: ensureArray<string>(email),\n\t\t\tfullName: name || profile.displayName || profile.username,\n\t\t\teppn: profile.eppn,\n\t\t\tattributeList,\n\t\t\tidentifier: userDataMap.identifier,\n\t\t};\n\n\t\tif (profileUsername) {\n\t\t\tuserObject.username = this.normalizeUsername(profileUsername);\n\t\t}\n\n\t\tif (profile.language) {\n\t\t\tuserObject.language = profile.language;\n\t\t}\n\n\t\tif (profile.channels) {\n\t\t\tif (Array.isArray(profile.channels)) {\n\t\t\t\tuserObject.channels = profile.channels;\n\t\t\t} else {\n\t\t\t\tuserObject.channels = profile.channels.split(',');\n\t\t\t}\n\t\t}\n\n\t\tthis.events.emit('mapUser', { profile, userObject });\n\n\t\treturn userObject;\n\t}\n}\n\nSAMLUtils.events = new EventEmitter();\n"],"names":["SAMLUtils","providerList","debug","relayState","logger","globalSettings","generateUsername","nameOverwrite","mailOverwrite","immutableProperty","defaultUserRole","userDataFieldMap","usernameNormalize","channelsAttributeUpdate","includePrivateChannelsInUpdate","isDebugging","serviceProviders","value","getServiceProviderOptions","providerName","log","find","providerOptions","provider","setServiceProvidersList","list","setLoggerInstance","instance","updateGlobalSettings","samlConfigs","Boolean","generateUniqueID","chars","uniqueID","i","substr","Math","floor","random","generateInstant","Date","toISOString","certToPEM","cert","lines","match","Error","splice","push","join","fillTemplateData","template","data","newTemplate","variable","key","includes","replace","getValidationActionRedirectPath","credentialToken","redirectUrl","redirectUrlParam","encodeURIComponent","obj","args","error","inflateXml","base64Data","successCallback","errorCallback","Promise","resolve","reject","buffer","Buffer","from","zlib","inflateRaw","err","decoded","xmlString","convertArrayBufferToString","validateStatus","doc","successStatus","status","messageText","statusNodes","getElementsByTagNameNS","length","statusMessage","statusNode","firstChild","textContent","getAttribute","StatusCode","success","message","statusCode","normalizeCert","trim","getUserDataMapping","map","JSON","parse","e","parsedMap","attributeList","Set","email","fieldName","username","name","identifier","type","toLowerCase","spFieldName","hasOwnProperty","attribute","attributeMap","fieldNames","regex","Array","isArray","idpFieldName","add","defaultTypes","getProfileValue","profile","mapping","forceString","values","ensureArray","mainValue","profileValue","abs","shouldRunTemplate","regexValue","RegExp","encoding","toString","normalizeUsername","mapProfileToUserObject","userDataMap","Map","attributeName","undefined","set","profileUsername","userObject","samlLogin","idp","issuer","idpSession","sessionIndex","nameID","emailList","fullName","displayName","eppn","language","channels","split","events","emit","EventEmitter"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/Utils.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"981dae5f150f59d1cee8a078edd507dfc397a312","contentHash":"b3985495d54fb604218d025c73adb31cc98ac9da88adabdcbdb2ece2d6f3993b"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/arrayUtils.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/arrayUtils.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":27}},"3":{"start":{"line":12,"column":23},"end":{"line":12,"column":25}},"4":{"start":{"line":13,"column":4},"end":{"line":13,"column":36}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"ensureArray","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":20}},"loc":{"start":{"line":11,"column":28},"end":{"line":14,"column":1}},"line":11}},"branchMap":{},"s":{"0":1,"1":1,"2":60,"3":60,"4":60},"f":{"0":60,"1":60},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/arrayUtils.ts"],"sourcesContent":["export function ensureArray<T>(param: T | Array<T>): Array<T> {\n\tconst emptyArray: Array<T> = [];\n\treturn emptyArray.concat(param);\n}\n"],"names":["ensureArray","param","emptyArray","concat"],"mappings":";;;;+BAAgBA;;;eAAAA;;;AAAT,SAASA,YAAeC,KAAmB;IACjD,MAAMC,aAAuB,EAAE;IAC/B,OAAOA,WAAWC,MAAM,CAACF;AAC1B","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/arrayUtils.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"02660eb67344111f29b25d73c7b27487419757f7","contentHash":"244b4984b7545dacd8f4e549e2bb404e672692002dfd20fc26ce28293af61836"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/constants.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/constants.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":42,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":26}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":42}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":35}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":43}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":39}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":44}},"10":{"start":{"line":31,"column":8},"end":{"line":31,"column":45}},"11":{"start":{"line":34,"column":8},"end":{"line":34,"column":50}},"12":{"start":{"line":37,"column":8},"end":{"line":37,"column":39}},"13":{"start":{"line":40,"column":8},"end":{"line":40,"column":37}},"14":{"start":{"line":43,"column":36},"end":{"line":47,"column":31}},"15":{"start":{"line":48,"column":35},"end":{"line":52,"column":22}},"16":{"start":{"line":53,"column":38},"end":{"line":56,"column":24}},"17":{"start":{"line":57,"column":37},"end":{"line":61,"column":23}},"18":{"start":{"line":62,"column":43},"end":{"line":72,"column":21}},"19":{"start":{"line":73,"column":32},"end":{"line":80,"column":20}},"20":{"start":{"line":81,"column":30},"end":{"line":81,"column":173}},"21":{"start":{"line":82,"column":32},"end":{"line":82,"column":88}},"22":{"start":{"line":83,"column":28},"end":{"line":83,"column":95}},"23":{"start":{"line":84,"column":19},"end":{"line":87,"column":1}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":16},"end":{"line":12,"column":17}},"loc":{"start":{"line":12,"column":27},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":32},"end":{"line":15,"column":33}},"loc":{"start":{"line":15,"column":43},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":25},"end":{"line":18,"column":26}},"loc":{"start":{"line":18,"column":36},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":33},"end":{"line":21,"column":34}},"loc":{"start":{"line":21,"column":44},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":29},"end":{"line":24,"column":30}},"loc":{"start":{"line":24,"column":40},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":34},"end":{"line":27,"column":35}},"loc":{"start":{"line":27,"column":45},"end":{"line":29,"column":5}},"line":27},"7":{"name":"(anonymous_7)","decl":{"start":{"line":30,"column":35},"end":{"line":30,"column":36}},"loc":{"start":{"line":30,"column":46},"end":{"line":32,"column":5}},"line":30},"8":{"name":"(anonymous_8)","decl":{"start":{"line":33,"column":40},"end":{"line":33,"column":41}},"loc":{"start":{"line":33,"column":51},"end":{"line":35,"column":5}},"line":33},"9":{"name":"(anonymous_9)","decl":{"start":{"line":36,"column":29},"end":{"line":36,"column":30}},"loc":{"start":{"line":36,"column":40},"end":{"line":38,"column":5}},"line":36},"10":{"name":"(anonymous_10)","decl":{"start":{"line":39,"column":27},"end":{"line":39,"column":28}},"loc":{"start":{"line":39,"column":38},"end":{"line":41,"column":5}},"line":39}},"branchMap":{},"s":{"0":1,"1":1,"2":10,"3":1,"4":23,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":1,"12":2,"13":0,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1},"f":{"0":1,"1":23,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":1,"9":2,"10":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/constants.ts"],"sourcesContent":["export const defaultAuthnContextTemplate = `<samlp:RequestedAuthnContext xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" Comparison=\"__authnContextComparison__\">\n  <saml:AuthnContextClassRef xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\">\n    __authnContext__\n  </saml:AuthnContextClassRef>\n</samlp:RequestedAuthnContext>`;\n\nexport const defaultAuthRequestTemplate = `<samlp:AuthnRequest xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" ID=\"__newId__\" Version=\"2.0\" IssueInstant=\"__instant__\" ProtocolBinding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" AssertionConsumerServiceURL=\"__callbackUrl__\" Destination=\"__entryPoint__\">\n  <saml:Issuer xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\">__issuer__</saml:Issuer>\n  __identifierFormatTag__\n  __authnContextTag__\n</samlp:AuthnRequest>`;\n\nexport const defaultLogoutResponseTemplate = `<samlp:LogoutResponse xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" ID=\"__inResponseToId__\" Version=\"2.0\" IssueInstant=\"__instant__\" Destination=\"__idpSLORedirectURL__\">\n  <saml:Issuer xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\">__issuer__</saml:Issuer>\n  <samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status>\n</samlp:LogoutResponse>`;\n\nexport const defaultLogoutRequestTemplate = `<samlp:LogoutRequest xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" ID=\"__newId__\" Version=\"2.0\" IssueInstant=\"__instant__\" Destination=\"__idpSLORedirectURL__\">\n  <saml:Issuer xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\">__issuer__</saml:Issuer>\n  <saml:NameID xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" NameQualifier=\"http://id.init8.net:8080/openam\" SPNameQualifier=\"__issuer__\" Format=\"__identifierFormat__\">__nameID__</saml:NameID>\n  <samlp:SessionIndex xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\">__sessionIndex__</samlp:SessionIndex>\n</samlp:LogoutRequest>`;\n\nexport const defaultMetadataCertificateTemplate = `\n    <KeyDescriptor>\n      <ds:KeyInfo>\n        <ds:X509Data>\n          <ds:X509Certificate>__certificate__</ds:X509Certificate>\n        </ds:X509Data>\n      </ds:KeyInfo>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes256-cbc\"/>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\"/>\n      <EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#tripledes-cbc\"/>\n    </KeyDescriptor>`;\n\nexport const defaultMetadataTemplate = `<?xml version=\"1.0\"?>\n<EntityDescriptor xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"urn:oasis:names:tc:SAML:2.0:metadata https://docs.oasis-open.org/security/saml/v2.0/saml-schema-metadata-2.0.xsd\" xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\" xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\" entityID=\"__issuer__\">\n  <SPSSODescriptor protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\">__certificateTag__\n    <SingleLogoutService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect\" Location=\"__sloLocation__\" ResponseLocation=\"__sloLocation__\"/>\n    <NameIDFormat>__identifierFormat__</NameIDFormat>\n    <AssertionConsumerService index=\"1\" isDefault=\"true\" Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" Location=\"__callbackUrl__\"/>\n  </SPSSODescriptor>\n</EntityDescriptor>`;\n\nexport const defaultNameIDTemplate =\n\t'<samlp:NameIDPolicy xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" Format=\"__identifierFormat__\" AllowCreate=\"true\"></samlp:NameIDPolicy>';\nexport const defaultIdentifierFormat = 'urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress';\nexport const defaultAuthnContext = 'urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport';\n\nexport const StatusCode = {\n\tsuccess: 'urn:oasis:names:tc:SAML:2.0:status:Success',\n\tresponder: 'urn:oasis:names:tc:SAML:2.0:status:Responder',\n};\n"],"names":["StatusCode","defaultAuthRequestTemplate","defaultAuthnContext","defaultAuthnContextTemplate","defaultIdentifierFormat","defaultLogoutRequestTemplate","defaultLogoutResponseTemplate","defaultMetadataCertificateTemplate","defaultMetadataTemplate","defaultNameIDTemplate","success","responder"],"mappings":";;;;;;;;;;;IAiDaA,UAAU;eAAVA;;IA3CAC,0BAA0B;eAA1BA;;IAyCAC,mBAAmB;eAAnBA;;IA/CAC,2BAA2B;eAA3BA;;IA8CAC,uBAAuB;eAAvBA;;IA7BAC,4BAA4B;eAA5BA;;IALAC,6BAA6B;eAA7BA;;IAWAC,kCAAkC;eAAlCA;;IAYAC,uBAAuB;eAAvBA;;IASAC,qBAAqB;eAArBA;;;AA5CN,MAAMN,8BAA8B,CAAC;;;;8BAId,CAAC;AAExB,MAAMF,6BAA6B,CAAC;;;;qBAItB,CAAC;AAEf,MAAMK,gCAAgC,CAAC;;;uBAGvB,CAAC;AAEjB,MAAMD,+BAA+B,CAAC;;;;sBAIvB,CAAC;AAEhB,MAAME,qCAAqC,CAAC;;;;;;;;;;oBAU/B,CAAC;AAEd,MAAMC,0BAA0B,CAAC;;;;;;;mBAOrB,CAAC;AAEb,MAAMC,wBACZ;AACM,MAAML,0BAA0B;AAChC,MAAMF,sBAAsB;AAE5B,MAAMF,aAAa;IACzBU,SAAS;IACTC,WAAW;AACZ","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/constants.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"916d8b6ff85f084dfd40b0c714b479b3cab7eff2","contentHash":"965ae1e3e16e3c5a769008782c44e9518cd6c80b3fef43dccb3bb46d2c164aaf"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/AuthorizeRequest.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/AuthorizeRequest.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":32}},"3":{"start":{"line":11,"column":15},"end":{"line":11,"column":34}},"4":{"start":{"line":12,"column":19},"end":{"line":12,"column":42}},"5":{"start":{"line":13,"column":23},"end":{"line":63,"column":1}},"6":{"start":{"line":15,"column":21},"end":{"line":15,"column":70}},"7":{"start":{"line":16,"column":24},"end":{"line":16,"column":118}},"8":{"start":{"line":17,"column":8},"end":{"line":20,"column":10}},"9":{"start":{"line":26,"column":21},"end":{"line":29,"column":9}},"10":{"start":{"line":30,"column":25},"end":{"line":30,"column":108}},"11":{"start":{"line":31,"column":8},"end":{"line":31,"column":65}},"12":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"13":{"start":{"line":35,"column":12},"end":{"line":35,"column":22}},"14":{"start":{"line":37,"column":8},"end":{"line":37,"column":95}},"15":{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},"16":{"start":{"line":41,"column":12},"end":{"line":41,"column":22}},"17":{"start":{"line":43,"column":8},"end":{"line":43,"column":101}},"18":{"start":{"line":46,"column":17},"end":{"line":46,"column":58}},"19":{"start":{"line":47,"column":24},"end":{"line":47,"column":58}},"20":{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},"21":{"start":{"line":50,"column":12},"end":{"line":50,"column":43}},"22":{"start":{"line":52,"column":8},"end":{"line":61,"column":10}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":44},"end":{"line":21,"column":5}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":25,"column":4},"end":{"line":25,"column":5}},"loc":{"start":{"line":25,"column":60},"end":{"line":32,"column":5}},"line":25},"3":{"name":"(anonymous_3)","decl":{"start":{"line":33,"column":4},"end":{"line":33,"column":5}},"loc":{"start":{"line":33,"column":63},"end":{"line":38,"column":5}},"line":33},"4":{"name":"(anonymous_4)","decl":{"start":{"line":39,"column":4},"end":{"line":39,"column":5}},"loc":{"start":{"line":39,"column":59},"end":{"line":44,"column":5}},"line":39},"5":{"name":"(anonymous_5)","decl":{"start":{"line":45,"column":4},"end":{"line":45,"column":5}},"loc":{"start":{"line":45,"column":56},"end":{"line":62,"column":5}},"line":45}},"branchMap":{"0":{"loc":{"start":{"line":30,"column":25},"end":{"line":30,"column":108}},"type":"binary-expr","locations":[{"start":{"line":30,"column":25},"end":{"line":30,"column":67}},{"start":{"line":30,"column":71},"end":{"line":30,"column":108}}],"line":30},"1":{"loc":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"type":"if","locations":[{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},{"start":{"line":34,"column":8},"end":{"line":36,"column":9}}],"line":34},"2":{"loc":{"start":{"line":37,"column":15},"end":{"line":37,"column":94}},"type":"binary-expr","locations":[{"start":{"line":37,"column":15},"end":{"line":37,"column":58}},{"start":{"line":37,"column":62},"end":{"line":37,"column":94}}],"line":37},"3":{"loc":{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},"type":"if","locations":[{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},{"start":{"line":40,"column":8},"end":{"line":42,"column":9}}],"line":40},"4":{"loc":{"start":{"line":43,"column":15},"end":{"line":43,"column":100}},"type":"binary-expr","locations":[{"start":{"line":43,"column":15},"end":{"line":43,"column":58}},{"start":{"line":43,"column":62},"end":{"line":43,"column":100}}],"line":43},"5":{"loc":{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},"type":"if","locations":[{"start":{"line":49,"column":8},"end":{"line":51,"column":9}},{"start":{"line":49,"column":8},"end":{"line":51,"column":9}}],"line":49},"6":{"loc":{"start":{"line":58,"column":30},"end":{"line":58,"column":107}},"type":"binary-expr","locations":[{"start":{"line":58,"column":30},"end":{"line":58,"column":69}},{"start":{"line":58,"column":73},"end":{"line":58,"column":107}}],"line":58},"7":{"loc":{"start":{"line":59,"column":36},"end":{"line":59,"column":92}},"type":"binary-expr","locations":[{"start":{"line":59,"column":36},"end":{"line":59,"column":81}},{"start":{"line":59,"column":85},"end":{"line":59,"column":92}}],"line":59},"8":{"loc":{"start":{"line":60,"column":26},"end":{"line":60,"column":101}},"type":"binary-expr","locations":[{"start":{"line":60,"column":26},"end":{"line":60,"column":67}},{"start":{"line":60,"column":71},"end":{"line":60,"column":101}}],"line":60}},"s":{"0":1,"1":1,"2":3,"3":1,"4":1,"5":1,"6":3,"7":3,"8":3,"9":3,"10":3,"11":3,"12":3,"13":0,"14":3,"15":3,"16":0,"17":3,"18":3,"19":3,"20":3,"21":0,"22":3},"f":{"0":3,"1":3,"2":3,"3":3,"4":3,"5":3},"b":{"0":[3,0],"1":[0,3],"2":[3,0],"3":[0,3],"4":[3,0],"5":[0,3],"6":[3,0],"7":[3,0],"8":[3,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/AuthorizeRequest.ts"],"sourcesContent":["import type { IAuthorizeRequestVariables } from '../../definition/IAuthorizeRequestVariables';\nimport type { ISAMLRequest } from '../../definition/ISAMLRequest';\nimport type { IServiceProviderOptions } from '../../definition/IServiceProviderOptions';\nimport { SAMLUtils } from '../Utils';\nimport {\n\tdefaultIdentifierFormat,\n\tdefaultAuthnContext,\n\tdefaultAuthRequestTemplate,\n\tdefaultNameIDTemplate,\n\tdefaultAuthnContextTemplate,\n} from '../constants';\n\n/*\n\tAn Authorize Request is used to show the Identity Provider login form when the user clicks on the Rocket.Chat SAML login button\n*/\nexport class AuthorizeRequest {\n\tpublic static generate(serviceProviderOptions: IServiceProviderOptions): ISAMLRequest {\n\t\tconst data = this.getDataForNewRequest(serviceProviderOptions);\n\t\tconst request = SAMLUtils.fillTemplateData(this.authorizeRequestTemplate(serviceProviderOptions), data);\n\n\t\treturn {\n\t\t\trequest,\n\t\t\tid: data.newId,\n\t\t};\n\t}\n\n\t// The AuthorizeRequest template is split into three parts\n\t// This way, users don't need to change the template when all they want to do is remove the NameID Policy or the AuthnContext.\n\t// This also ensures compatibility with providers that were configured before the templates existed.\n\tprivate static authorizeRequestTemplate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tconst data = {\n\t\t\tidentifierFormatTag: this.identifierFormatTagTemplate(serviceProviderOptions),\n\t\t\tauthnContextTag: this.authnContextTagTemplate(serviceProviderOptions),\n\t\t};\n\n\t\tconst template = serviceProviderOptions.authRequestTemplate || defaultAuthRequestTemplate;\n\t\treturn SAMLUtils.fillTemplateData(template, data);\n\t}\n\n\tprivate static identifierFormatTagTemplate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tif (!serviceProviderOptions.identifierFormat) {\n\t\t\treturn '';\n\t\t}\n\n\t\treturn serviceProviderOptions.nameIDPolicyTemplate || defaultNameIDTemplate;\n\t}\n\n\tprivate static authnContextTagTemplate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tif (!serviceProviderOptions.customAuthnContext) {\n\t\t\treturn '';\n\t\t}\n\n\t\treturn serviceProviderOptions.authnContextTemplate || defaultAuthnContextTemplate;\n\t}\n\n\tprivate static getDataForNewRequest(serviceProviderOptions: IServiceProviderOptions): IAuthorizeRequestVariables {\n\t\tlet id = `_${SAMLUtils.generateUniqueID()}`;\n\t\tconst instant = SAMLUtils.generateInstant();\n\n\t\t// Post-auth destination\n\t\tif (serviceProviderOptions.id) {\n\t\t\tid = serviceProviderOptions.id;\n\t\t}\n\n\t\treturn {\n\t\t\tnewId: id,\n\t\t\tinstant,\n\t\t\tcallbackUrl: serviceProviderOptions.callbackUrl,\n\t\t\tentryPoint: serviceProviderOptions.entryPoint,\n\t\t\tissuer: serviceProviderOptions.issuer,\n\t\t\tidentifierFormat: serviceProviderOptions.identifierFormat || defaultIdentifierFormat,\n\t\t\tauthnContextComparison: serviceProviderOptions.authnContextComparison || 'exact',\n\t\t\tauthnContext: serviceProviderOptions.customAuthnContext || defaultAuthnContext,\n\t\t};\n\t}\n}\n"],"names":["AuthorizeRequest","generate","serviceProviderOptions","data","getDataForNewRequest","request","SAMLUtils","fillTemplateData","authorizeRequestTemplate","id","newId","identifierFormatTag","identifierFormatTagTemplate","authnContextTag","authnContextTagTemplate","template","authRequestTemplate","defaultAuthRequestTemplate","identifierFormat","nameIDPolicyTemplate","defaultNameIDTemplate","customAuthnContext","authnContextTemplate","defaultAuthnContextTemplate","generateUniqueID","instant","generateInstant","callbackUrl","entryPoint","issuer","defaultIdentifierFormat","authnContextComparison","authnContext","defaultAuthnContext"],"mappings":";;;;+BAeaA;;;eAAAA;;;uBAZa;2BAOnB;AAKA,IAAA,AAAMA,mBAAN,MAAMA;IACZ,OAAcC,SAASC,sBAA+C,EAAgB;QACrF,MAAMC,OAAO,IAAI,CAACC,oBAAoB,CAACF;QACvC,MAAMG,UAAUC,gBAAS,CAACC,gBAAgB,CAAC,IAAI,CAACC,wBAAwB,CAACN,yBAAyBC;QAElG,OAAO;YACNE;YACAI,IAAIN,KAAKO,KAAK;QACf;IACD;IAEA,0DAA0D;IAC1D,8HAA8H;IAC9H,oGAAoG;IACpG,OAAeF,yBAAyBN,sBAA+C,EAAU;QAChG,MAAMC,OAAO;YACZQ,qBAAqB,IAAI,CAACC,2BAA2B,CAACV;YACtDW,iBAAiB,IAAI,CAACC,uBAAuB,CAACZ;QAC/C;QAEA,MAAMa,WAAWb,uBAAuBc,mBAAmB,IAAIC,qCAA0B;QACzF,OAAOX,gBAAS,CAACC,gBAAgB,CAACQ,UAAUZ;IAC7C;IAEA,OAAeS,4BAA4BV,sBAA+C,EAAU;QACnG,IAAI,CAACA,uBAAuBgB,gBAAgB,EAAE;YAC7C,OAAO;QACR;QAEA,OAAOhB,uBAAuBiB,oBAAoB,IAAIC,gCAAqB;IAC5E;IAEA,OAAeN,wBAAwBZ,sBAA+C,EAAU;QAC/F,IAAI,CAACA,uBAAuBmB,kBAAkB,EAAE;YAC/C,OAAO;QACR;QAEA,OAAOnB,uBAAuBoB,oBAAoB,IAAIC,sCAA2B;IAClF;IAEA,OAAenB,qBAAqBF,sBAA+C,EAA8B;QAChH,IAAIO,KAAK,CAAC,CAAC,EAAEH,gBAAS,CAACkB,gBAAgB,IAAI;QAC3C,MAAMC,UAAUnB,gBAAS,CAACoB,eAAe;QAEzC,wBAAwB;QACxB,IAAIxB,uBAAuBO,EAAE,EAAE;YAC9BA,KAAKP,uBAAuBO,EAAE;QAC/B;QAEA,OAAO;YACNC,OAAOD;YACPgB;YACAE,aAAazB,uBAAuByB,WAAW;YAC/CC,YAAY1B,uBAAuB0B,UAAU;YAC7CC,QAAQ3B,uBAAuB2B,MAAM;YACrCX,kBAAkBhB,uBAAuBgB,gBAAgB,IAAIY,kCAAuB;YACpFC,wBAAwB7B,uBAAuB6B,sBAAsB,IAAI;YACzEC,cAAc9B,uBAAuBmB,kBAAkB,IAAIY,8BAAmB;QAC/E;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/AuthorizeRequest.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d1d81253a5a67eaf68ee417439dec43abcf93369","contentHash":"57ebe6b5ae5b16ea2eba9923ac765c1f85ab79a43784d1919986aa22c5a30d74"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/LogoutRequest.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/LogoutRequest.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":29}},"3":{"start":{"line":11,"column":15},"end":{"line":11,"column":34}},"4":{"start":{"line":12,"column":19},"end":{"line":12,"column":42}},"5":{"start":{"line":13,"column":20},"end":{"line":40,"column":1}},"6":{"start":{"line":15,"column":21},"end":{"line":15,"column":92}},"7":{"start":{"line":16,"column":24},"end":{"line":16,"column":152}},"8":{"start":{"line":17,"column":8},"end":{"line":17,"column":72}},"9":{"start":{"line":18,"column":8},"end":{"line":18,"column":38}},"10":{"start":{"line":19,"column":8},"end":{"line":22,"column":10}},"11":{"start":{"line":28,"column":19},"end":{"line":28,"column":60}},"12":{"start":{"line":29,"column":24},"end":{"line":29,"column":58}},"13":{"start":{"line":30,"column":8},"end":{"line":38,"column":10}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":66},"end":{"line":23,"column":5}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":24,"column":4},"end":{"line":24,"column":5}},"loc":{"start":{"line":24,"column":78},"end":{"line":39,"column":5}},"line":24}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":58},"end":{"line":16,"column":145}},"type":"binary-expr","locations":[{"start":{"line":16,"column":58},"end":{"line":16,"column":102}},{"start":{"line":16,"column":106},"end":{"line":16,"column":145}}],"line":16},"1":{"loc":{"start":{"line":35,"column":30},"end":{"line":35,"column":107}},"type":"binary-expr","locations":[{"start":{"line":35,"column":30},"end":{"line":35,"column":69}},{"start":{"line":35,"column":73},"end":{"line":35,"column":107}}],"line":35}},"s":{"0":1,"1":1,"2":3,"3":1,"4":1,"5":1,"6":3,"7":3,"8":3,"9":3,"10":3,"11":3,"12":3,"13":3},"f":{"0":3,"1":3,"2":3},"b":{"0":[3,0],"1":[3,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/LogoutRequest.ts"],"sourcesContent":["import type { ILogoutRequestVariables } from '../../definition/ILogoutRequestVariables';\nimport type { ISAMLRequest } from '../../definition/ISAMLRequest';\nimport type { IServiceProviderOptions } from '../../definition/IServiceProviderOptions';\nimport { SAMLUtils } from '../Utils';\nimport { defaultIdentifierFormat, defaultLogoutRequestTemplate } from '../constants';\n\n/*\n\tA Logout Request is used when the user is logged out of Rocket.Chat and the Service Provider is configured to also logout from the Identity Provider.\n*/\nexport class LogoutRequest {\n\tstatic generate(serviceProviderOptions: IServiceProviderOptions, nameID: string, sessionIndex: string): ISAMLRequest {\n\t\tconst data = this.getDataForNewRequest(serviceProviderOptions, nameID, sessionIndex);\n\t\tconst request = SAMLUtils.fillTemplateData(serviceProviderOptions.logoutRequestTemplate || defaultLogoutRequestTemplate, data);\n\n\t\tSAMLUtils.log('------- SAML Logout request -----------');\n\t\tSAMLUtils.log(request);\n\n\t\treturn {\n\t\t\trequest,\n\t\t\tid: data.newId,\n\t\t};\n\t}\n\n\tstatic getDataForNewRequest(\n\t\tserviceProviderOptions: IServiceProviderOptions,\n\t\tnameID: string,\n\t\tsessionIndex: string,\n\t): ILogoutRequestVariables {\n\t\t// nameId: <nameId as submitted during SAML SSO>\n\t\t// sessionIndex: sessionIndex\n\t\t// --- NO SAMLsettings: <Meteor.setting.saml  entry for the provider you want to SLO from\n\n\t\tconst id = `_${SAMLUtils.generateUniqueID()}`;\n\t\tconst instant = SAMLUtils.generateInstant();\n\n\t\treturn {\n\t\t\tnewId: id,\n\t\t\tinstant,\n\t\t\tidpSLORedirectURL: serviceProviderOptions.idpSLORedirectURL,\n\t\t\tissuer: serviceProviderOptions.issuer,\n\t\t\tidentifierFormat: serviceProviderOptions.identifierFormat || defaultIdentifierFormat,\n\t\t\tnameID,\n\t\t\tsessionIndex,\n\t\t};\n\t}\n}\n"],"names":["LogoutRequest","generate","serviceProviderOptions","nameID","sessionIndex","data","getDataForNewRequest","request","SAMLUtils","fillTemplateData","logoutRequestTemplate","defaultLogoutRequestTemplate","log","id","newId","generateUniqueID","instant","generateInstant","idpSLORedirectURL","issuer","identifierFormat","defaultIdentifierFormat"],"mappings":";;;;+BASaA;;;eAAAA;;;uBANa;2BAC4C;AAK/D,IAAA,AAAMA,gBAAN,MAAMA;IACZ,OAAOC,SAASC,sBAA+C,EAAEC,MAAc,EAAEC,YAAoB,EAAgB;QACpH,MAAMC,OAAO,IAAI,CAACC,oBAAoB,CAACJ,wBAAwBC,QAAQC;QACvE,MAAMG,UAAUC,gBAAS,CAACC,gBAAgB,CAACP,uBAAuBQ,qBAAqB,IAAIC,uCAA4B,EAAEN;QAEzHG,gBAAS,CAACI,GAAG,CAAC;QACdJ,gBAAS,CAACI,GAAG,CAACL;QAEd,OAAO;YACNA;YACAM,IAAIR,KAAKS,KAAK;QACf;IACD;IAEA,OAAOR,qBACNJ,sBAA+C,EAC/CC,MAAc,EACdC,YAAoB,EACM;QAC1B,gDAAgD;QAChD,6BAA6B;QAC7B,yFAAyF;QAEzF,MAAMS,KAAK,CAAC,CAAC,EAAEL,gBAAS,CAACO,gBAAgB,IAAI;QAC7C,MAAMC,UAAUR,gBAAS,CAACS,eAAe;QAEzC,OAAO;YACNH,OAAOD;YACPG;YACAE,mBAAmBhB,uBAAuBgB,iBAAiB;YAC3DC,QAAQjB,uBAAuBiB,MAAM;YACrCC,kBAAkBlB,uBAAuBkB,gBAAgB,IAAIC,kCAAuB;YACpFlB;YACAC;QACD;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/LogoutRequest.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4cce717a7dddc7591e174f2e3ae9ca161558b516","contentHash":"84f2e91ddeadb5607d25337a48000cb2a3f09653acdc42d991f56edf491585a5"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/LogoutResponse.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/LogoutResponse.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":30}},"3":{"start":{"line":11,"column":15},"end":{"line":11,"column":34}},"4":{"start":{"line":12,"column":19},"end":{"line":12,"column":42}},"5":{"start":{"line":13,"column":21},"end":{"line":39,"column":1}},"6":{"start":{"line":15,"column":21},"end":{"line":15,"column":109}},"7":{"start":{"line":16,"column":25},"end":{"line":16,"column":155}},"8":{"start":{"line":17,"column":8},"end":{"line":17,"column":73}},"9":{"start":{"line":18,"column":8},"end":{"line":18,"column":39}},"10":{"start":{"line":19,"column":8},"end":{"line":23,"column":10}},"11":{"start":{"line":26,"column":19},"end":{"line":26,"column":60}},"12":{"start":{"line":27,"column":24},"end":{"line":27,"column":58}},"13":{"start":{"line":28,"column":8},"end":{"line":37,"column":10}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":82},"end":{"line":24,"column":5}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":25,"column":4},"end":{"line":25,"column":5}},"loc":{"start":{"line":25,"column":95},"end":{"line":38,"column":5}},"line":25}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":59},"end":{"line":16,"column":148}},"type":"binary-expr","locations":[{"start":{"line":16,"column":59},"end":{"line":16,"column":104}},{"start":{"line":16,"column":108},"end":{"line":16,"column":148}}],"line":16},"1":{"loc":{"start":{"line":33,"column":30},"end":{"line":33,"column":107}},"type":"binary-expr","locations":[{"start":{"line":33,"column":30},"end":{"line":33,"column":69}},{"start":{"line":33,"column":73},"end":{"line":33,"column":107}}],"line":33}},"s":{"0":1,"1":1,"2":3,"3":1,"4":1,"5":1,"6":3,"7":3,"8":3,"9":3,"10":3,"11":3,"12":3,"13":3},"f":{"0":3,"1":3,"2":3},"b":{"0":[3,0],"1":[3,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/LogoutResponse.ts"],"sourcesContent":["import type { ILogoutResponse } from '../../definition/ILogoutResponse';\nimport type { ILogoutResponseVariables } from '../../definition/ILogoutResponseVariables';\nimport type { IServiceProviderOptions } from '../../definition/IServiceProviderOptions';\nimport { SAMLUtils } from '../Utils';\nimport { defaultLogoutResponseTemplate, defaultIdentifierFormat } from '../constants';\n\n/*\n\tA Logout Response is used when the Identity Provider (IdP) sends us a Logout Request.\n*/\nexport class LogoutResponse {\n\tpublic static generate(\n\t\tserviceProviderOptions: IServiceProviderOptions,\n\t\tnameID: string,\n\t\tsessionIndex: string,\n\t\tinResponseToId: string,\n\t): ILogoutResponse {\n\t\tconst data = this.getDataForNewResponse(serviceProviderOptions, nameID, sessionIndex, inResponseToId);\n\t\tconst response = SAMLUtils.fillTemplateData(serviceProviderOptions.logoutResponseTemplate || defaultLogoutResponseTemplate, data);\n\n\t\tSAMLUtils.log('------- SAML Logout response -----------');\n\t\tSAMLUtils.log(response);\n\n\t\treturn {\n\t\t\tresponse,\n\t\t\tid: data.newId,\n\t\t\tinResponseToId: data.inResponseToId,\n\t\t};\n\t}\n\n\tprivate static getDataForNewResponse(\n\t\tserviceProviderOptions: IServiceProviderOptions,\n\t\tnameID: string,\n\t\tsessionIndex: string,\n\t\tinResponseToId: string,\n\t): ILogoutResponseVariables {\n\t\tconst id = `_${SAMLUtils.generateUniqueID()}`;\n\t\tconst instant = SAMLUtils.generateInstant();\n\n\t\treturn {\n\t\t\tnewId: id,\n\t\t\tinstant,\n\t\t\tidpSLORedirectURL: serviceProviderOptions.idpSLORedirectURL,\n\t\t\tissuer: serviceProviderOptions.issuer,\n\t\t\tidentifierFormat: serviceProviderOptions.identifierFormat || defaultIdentifierFormat,\n\t\t\tnameID,\n\t\t\tsessionIndex,\n\t\t\tinResponseToId,\n\t\t};\n\t}\n}\n"],"names":["LogoutResponse","generate","serviceProviderOptions","nameID","sessionIndex","inResponseToId","data","getDataForNewResponse","response","SAMLUtils","fillTemplateData","logoutResponseTemplate","defaultLogoutResponseTemplate","log","id","newId","generateUniqueID","instant","generateInstant","idpSLORedirectURL","issuer","identifierFormat","defaultIdentifierFormat"],"mappings":";;;;+BASaA;;;eAAAA;;;uBANa;2BAC6C;AAKhE,IAAA,AAAMA,iBAAN,MAAMA;IACZ,OAAcC,SACbC,sBAA+C,EAC/CC,MAAc,EACdC,YAAoB,EACpBC,cAAsB,EACJ;QAClB,MAAMC,OAAO,IAAI,CAACC,qBAAqB,CAACL,wBAAwBC,QAAQC,cAAcC;QACtF,MAAMG,WAAWC,gBAAS,CAACC,gBAAgB,CAACR,uBAAuBS,sBAAsB,IAAIC,wCAA6B,EAAEN;QAE5HG,gBAAS,CAACI,GAAG,CAAC;QACdJ,gBAAS,CAACI,GAAG,CAACL;QAEd,OAAO;YACNA;YACAM,IAAIR,KAAKS,KAAK;YACdV,gBAAgBC,KAAKD,cAAc;QACpC;IACD;IAEA,OAAeE,sBACdL,sBAA+C,EAC/CC,MAAc,EACdC,YAAoB,EACpBC,cAAsB,EACK;QAC3B,MAAMS,KAAK,CAAC,CAAC,EAAEL,gBAAS,CAACO,gBAAgB,IAAI;QAC7C,MAAMC,UAAUR,gBAAS,CAACS,eAAe;QAEzC,OAAO;YACNH,OAAOD;YACPG;YACAE,mBAAmBjB,uBAAuBiB,iBAAiB;YAC3DC,QAAQlB,uBAAuBkB,MAAM;YACrCC,kBAAkBnB,uBAAuBmB,gBAAgB,IAAIC,kCAAuB;YACpFnB;YACAC;YACAC;QACD;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/LogoutResponse.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"bc8eea9f65060e8ad06f73b6533cd4b896016502","contentHash":"0ae7f5af75a9efa2ecf785c8647fdbad2a3548036775be8107d37f688102d618"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/parsers/LogoutRequest.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/parsers/LogoutRequest.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":35}},"3":{"start":{"line":11,"column":30},"end":{"line":11,"column":81}},"4":{"start":{"line":12,"column":15},"end":{"line":12,"column":34}},"5":{"start":{"line":14,"column":4},"end":{"line":16,"column":6}},"6":{"start":{"line":18,"column":26},"end":{"line":54,"column":1}},"7":{"start":{"line":20,"column":8},"end":{"line":20,"column":60}},"8":{"start":{"line":21,"column":20},"end":{"line":21,"column":90}},"9":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"10":{"start":{"line":23,"column":12},"end":{"line":23,"column":44}},"11":{"start":{"line":25,"column":24},"end":{"line":25,"column":110}},"12":{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},"13":{"start":{"line":27,"column":12},"end":{"line":27,"column":48}},"14":{"start":{"line":29,"column":8},"end":{"line":49,"column":9}},"15":{"start":{"line":30,"column":32},"end":{"line":30,"column":86}},"16":{"start":{"line":31,"column":31},"end":{"line":31,"column":79}},"17":{"start":{"line":32,"column":12},"end":{"line":34,"column":13}},"18":{"start":{"line":33,"column":16},"end":{"line":33,"column":77}},"19":{"start":{"line":35,"column":31},"end":{"line":35,"column":66}},"20":{"start":{"line":36,"column":27},"end":{"line":36,"column":61}},"21":{"start":{"line":37,"column":23},"end":{"line":37,"column":49}},"22":{"start":{"line":38,"column":12},"end":{"line":42,"column":15}},"23":{"start":{"line":44,"column":12},"end":{"line":44,"column":38}},"24":{"start":{"line":45,"column":12},"end":{"line":45,"column":55}},"25":{"start":{"line":46,"column":24},"end":{"line":46,"column":107}},"26":{"start":{"line":47,"column":12},"end":{"line":47,"column":123}},"27":{"start":{"line":48,"column":12},"end":{"line":48,"column":70}},"28":{"start":{"line":52,"column":8},"end":{"line":52,"column":61}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":13,"column":9},"end":{"line":13,"column":33}},"loc":{"start":{"line":13,"column":39},"end":{"line":17,"column":1}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":19,"column":4},"end":{"line":19,"column":5}},"loc":{"start":{"line":19,"column":40},"end":{"line":50,"column":5}},"line":19},"3":{"name":"(anonymous_3)","decl":{"start":{"line":51,"column":4},"end":{"line":51,"column":5}},"loc":{"start":{"line":51,"column":39},"end":{"line":53,"column":5}},"line":51}},"branchMap":{"0":{"loc":{"start":{"line":14,"column":11},"end":{"line":16,"column":5}},"type":"cond-expr","locations":[{"start":{"line":14,"column":35},"end":{"line":14,"column":38}},{"start":{"line":14,"column":41},"end":{"line":16,"column":5}}],"line":14},"1":{"loc":{"start":{"line":14,"column":11},"end":{"line":14,"column":32}},"type":"binary-expr","locations":[{"start":{"line":14,"column":11},"end":{"line":14,"column":14}},{"start":{"line":14,"column":18},"end":{"line":14,"column":32}}],"line":14},"2":{"loc":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"type":"if","locations":[{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},{"start":{"line":22,"column":8},"end":{"line":24,"column":9}}],"line":22},"3":{"loc":{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},{"start":{"line":26,"column":8},"end":{"line":28,"column":9}}],"line":26},"4":{"loc":{"start":{"line":32,"column":12},"end":{"line":34,"column":13}},"type":"if","locations":[{"start":{"line":32,"column":12},"end":{"line":34,"column":13}},{"start":{"line":32,"column":12},"end":{"line":34,"column":13}}],"line":32},"5":{"loc":{"start":{"line":48,"column":28},"end":{"line":48,"column":62}},"type":"cond-expr","locations":[{"start":{"line":48,"column":49},"end":{"line":48,"column":50}},{"start":{"line":48,"column":53},"end":{"line":48,"column":62}}],"line":48}},"s":{"0":1,"1":1,"2":4,"3":1,"4":1,"5":1,"6":1,"7":4,"8":4,"9":4,"10":0,"11":4,"12":4,"13":2,"14":2,"15":2,"16":2,"17":2,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":4},"f":{"0":4,"1":1,"2":4,"3":4},"b":{"0":[0,1],"1":[1,1],"2":[0,4],"3":[2,2],"4":[1,1],"5":[1,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/parsers/LogoutRequest.ts"],"sourcesContent":["import xmldom from '@xmldom/xmldom';\n\nimport type { IServiceProviderOptions } from '../../definition/IServiceProviderOptions';\nimport type { ILogoutRequestValidateCallback } from '../../definition/callbacks';\nimport { SAMLUtils } from '../Utils';\n\nexport class LogoutRequestParser {\n\tserviceProviderOptions: IServiceProviderOptions;\n\n\tconstructor(serviceProviderOptions: IServiceProviderOptions) {\n\t\tthis.serviceProviderOptions = serviceProviderOptions;\n\t}\n\n\tpublic async validate(xmlString: string, callback: ILogoutRequestValidateCallback): Promise<void> {\n\t\tSAMLUtils.log(`LogoutRequest: ${xmlString}`);\n\n\t\tconst doc = new xmldom.DOMParser().parseFromString(xmlString, 'text/xml');\n\t\tif (!doc) {\n\t\t\treturn callback('No Doc Found');\n\t\t}\n\n\t\tconst request = doc.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:protocol', 'LogoutRequest')[0];\n\t\tif (!request) {\n\t\t\treturn callback('No Request Found');\n\t\t}\n\n\t\ttry {\n\t\t\tconst sessionNode = request.getElementsByTagNameNS('*', 'SessionIndex')[0];\n\t\t\tconst nameIdNode = request.getElementsByTagNameNS('*', 'NameID')[0];\n\n\t\t\tif (!nameIdNode) {\n\t\t\t\tthrow new Error('SAML Logout Request: No NameID node found');\n\t\t\t}\n\n\t\t\tconst idpSession = sessionNode.childNodes[0].nodeValue;\n\t\t\tconst nameID = nameIdNode.childNodes[0].nodeValue;\n\t\t\tconst id = request.getAttribute('ID');\n\n\t\t\treturn callback(null, { idpSession, nameID, id });\n\t\t} catch (e) {\n\t\t\tSAMLUtils.error(e);\n\t\t\tSAMLUtils.log(`Caught error: ${e}`);\n\n\t\t\tconst msg = doc.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:protocol', 'StatusMessage');\n\t\t\tSAMLUtils.log(`Unexpected msg from IDP. Does your session still exist at IDP? Idp returned: \\n ${msg}`);\n\n\t\t\treturn callback(e instanceof Error ? e : String(e), null);\n\t\t}\n\t}\n}\n"],"names":["LogoutRequestParser","validate","xmlString","callback","SAMLUtils","log","doc","xmldom","DOMParser","parseFromString","request","getElementsByTagNameNS","sessionNode","nameIdNode","Error","idpSession","childNodes","nodeValue","nameID","id","getAttribute","e","error","msg","String","constructor","serviceProviderOptions"],"mappings":";;;;+BAMaA;;;eAAAA;;;+DANM;uBAIO;;;;;;AAEnB,IAAA,AAAMA,sBAAN,MAAMA;IAOZ,MAAaC,SAASC,SAAiB,EAAEC,QAAwC,EAAiB;QACjGC,gBAAS,CAACC,GAAG,CAAC,CAAC,eAAe,EAAEH,WAAW;QAE3C,MAAMI,MAAM,IAAIC,eAAM,CAACC,SAAS,GAAGC,eAAe,CAACP,WAAW;QAC9D,IAAI,CAACI,KAAK;YACT,OAAOH,SAAS;QACjB;QAEA,MAAMO,UAAUJ,IAAIK,sBAAsB,CAAC,wCAAwC,gBAAgB,CAAC,EAAE;QACtG,IAAI,CAACD,SAAS;YACb,OAAOP,SAAS;QACjB;QAEA,IAAI;YACH,MAAMS,cAAcF,QAAQC,sBAAsB,CAAC,KAAK,eAAe,CAAC,EAAE;YAC1E,MAAME,aAAaH,QAAQC,sBAAsB,CAAC,KAAK,SAAS,CAAC,EAAE;YAEnE,IAAI,CAACE,YAAY;gBAChB,MAAM,IAAIC,MAAM;YACjB;YAEA,MAAMC,aAAaH,YAAYI,UAAU,CAAC,EAAE,CAACC,SAAS;YACtD,MAAMC,SAASL,WAAWG,UAAU,CAAC,EAAE,CAACC,SAAS;YACjD,MAAME,KAAKT,QAAQU,YAAY,CAAC;YAEhC,OAAOjB,SAAS,MAAM;gBAAEY;gBAAYG;gBAAQC;YAAG;QAChD,EAAE,OAAOE,GAAG;YACXjB,gBAAS,CAACkB,KAAK,CAACD;YAChBjB,gBAAS,CAACC,GAAG,CAAC,CAAC,cAAc,EAAEgB,GAAG;YAElC,MAAME,MAAMjB,IAAIK,sBAAsB,CAAC,wCAAwC;YAC/EP,gBAAS,CAACC,GAAG,CAAC,CAAC,gFAAgF,EAAEkB,KAAK;YAEtG,OAAOpB,SAASkB,aAAaP,QAAQO,IAAIG,OAAOH,IAAI;QACrD;IACD;IAvCAI,YAAYC,sBAA+C,CAAE;QAC5D,IAAI,CAACA,sBAAsB,GAAGA;IAC/B;AAsCD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/parsers/LogoutRequest.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"75380a50aba68a2d612ade523caa3daa166c845c","contentHash":"9534916a4d5955807eec5b0004920810e48e2d9cd06d8973596bb0568d128a46"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/parsers/LogoutResponse.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/parsers/LogoutResponse.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":36}},"3":{"start":{"line":11,"column":30},"end":{"line":11,"column":81}},"4":{"start":{"line":12,"column":15},"end":{"line":12,"column":34}},"5":{"start":{"line":14,"column":4},"end":{"line":16,"column":6}},"6":{"start":{"line":18,"column":27},"end":{"line":51,"column":1}},"7":{"start":{"line":20,"column":8},"end":{"line":20,"column":61}},"8":{"start":{"line":21,"column":20},"end":{"line":21,"column":90}},"9":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"10":{"start":{"line":23,"column":12},"end":{"line":23,"column":44}},"11":{"start":{"line":25,"column":25},"end":{"line":25,"column":112}},"12":{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},"13":{"start":{"line":27,"column":12},"end":{"line":27,"column":55}},"14":{"start":{"line":31,"column":8},"end":{"line":38,"column":9}},"15":{"start":{"line":32,"column":12},"end":{"line":32,"column":65}},"16":{"start":{"line":33,"column":12},"end":{"line":33,"column":68}},"17":{"start":{"line":35,"column":12},"end":{"line":35,"column":55}},"18":{"start":{"line":36,"column":24},"end":{"line":36,"column":107}},"19":{"start":{"line":37,"column":12},"end":{"line":37,"column":123}},"20":{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},"21":{"start":{"line":40,"column":12},"end":{"line":40,"column":66}},"22":{"start":{"line":42,"column":34},"end":{"line":42,"column":70}},"23":{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},"24":{"start":{"line":44,"column":12},"end":{"line":44,"column":72}},"25":{"start":{"line":46,"column":8},"end":{"line":46,"column":44}},"26":{"start":{"line":49,"column":8},"end":{"line":49,"column":61}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":13,"column":9},"end":{"line":13,"column":33}},"loc":{"start":{"line":13,"column":39},"end":{"line":17,"column":1}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":19,"column":4},"end":{"line":19,"column":5}},"loc":{"start":{"line":19,"column":40},"end":{"line":47,"column":5}},"line":19},"3":{"name":"(anonymous_3)","decl":{"start":{"line":48,"column":4},"end":{"line":48,"column":5}},"loc":{"start":{"line":48,"column":39},"end":{"line":50,"column":5}},"line":48}},"branchMap":{"0":{"loc":{"start":{"line":14,"column":11},"end":{"line":16,"column":5}},"type":"cond-expr","locations":[{"start":{"line":14,"column":35},"end":{"line":14,"column":38}},{"start":{"line":14,"column":41},"end":{"line":16,"column":5}}],"line":14},"1":{"loc":{"start":{"line":14,"column":11},"end":{"line":14,"column":32}},"type":"binary-expr","locations":[{"start":{"line":14,"column":11},"end":{"line":14,"column":14}},{"start":{"line":14,"column":18},"end":{"line":14,"column":32}}],"line":14},"2":{"loc":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"type":"if","locations":[{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},{"start":{"line":22,"column":8},"end":{"line":24,"column":9}}],"line":22},"3":{"loc":{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},{"start":{"line":26,"column":8},"end":{"line":28,"column":9}}],"line":26},"4":{"loc":{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},"type":"if","locations":[{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},{"start":{"line":39,"column":8},"end":{"line":41,"column":9}}],"line":39},"5":{"loc":{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},"type":"if","locations":[{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},{"start":{"line":43,"column":8},"end":{"line":45,"column":9}}],"line":43}},"s":{"0":1,"1":1,"2":6,"3":1,"4":1,"5":1,"6":1,"7":6,"8":6,"9":6,"10":0,"11":6,"12":6,"13":2,"14":4,"15":4,"16":4,"17":0,"18":0,"19":0,"20":4,"21":1,"22":3,"23":3,"24":2,"25":1,"26":6},"f":{"0":6,"1":1,"2":6,"3":6},"b":{"0":[0,1],"1":[1,1],"2":[0,6],"3":[2,4],"4":[1,3],"5":[2,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/parsers/LogoutResponse.ts"],"sourcesContent":["import xmldom from '@xmldom/xmldom';\n\nimport type { IServiceProviderOptions } from '../../definition/IServiceProviderOptions';\nimport type { ILogoutResponseValidateCallback } from '../../definition/callbacks';\nimport { SAMLUtils } from '../Utils';\n\nexport class LogoutResponseParser {\n\tserviceProviderOptions: IServiceProviderOptions;\n\n\tconstructor(serviceProviderOptions: IServiceProviderOptions) {\n\t\tthis.serviceProviderOptions = serviceProviderOptions;\n\t}\n\n\tpublic async validate(xmlString: string, callback: ILogoutResponseValidateCallback): Promise<void> {\n\t\tSAMLUtils.log(`LogoutResponse: ${xmlString}`);\n\n\t\tconst doc = new xmldom.DOMParser().parseFromString(xmlString, 'text/xml');\n\t\tif (!doc) {\n\t\t\treturn callback('No Doc Found');\n\t\t}\n\n\t\tconst response = doc.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:protocol', 'LogoutResponse')[0];\n\t\tif (!response) {\n\t\t\treturn callback('No Response Found', null);\n\t\t}\n\n\t\t// TBD. Check if this msg corresponds to one we sent\n\t\tlet inResponseTo;\n\t\ttry {\n\t\t\tinResponseTo = response.getAttribute('InResponseTo');\n\t\t\tSAMLUtils.log(`In Response to: ${inResponseTo}`);\n\t\t} catch (e) {\n\t\t\tSAMLUtils.log(`Caught error: ${e}`);\n\t\t\tconst msg = doc.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:protocol', 'StatusMessage');\n\t\t\tSAMLUtils.log(`Unexpected msg from IDP. Does your session still exist at IDP? Idp returned: \\n ${msg}`);\n\t\t}\n\n\t\tif (!inResponseTo) {\n\t\t\treturn callback('Unexpected Response from IDP', null);\n\t\t}\n\n\t\tconst statusValidateObj = SAMLUtils.validateStatus(doc);\n\t\tif (!statusValidateObj.success) {\n\t\t\treturn callback('Error. Logout not confirmed by IDP', null);\n\t\t}\n\n\t\treturn callback(null, inResponseTo);\n\t}\n}\n"],"names":["LogoutResponseParser","validate","xmlString","callback","SAMLUtils","log","doc","xmldom","DOMParser","parseFromString","response","getElementsByTagNameNS","inResponseTo","getAttribute","e","msg","statusValidateObj","validateStatus","success","constructor","serviceProviderOptions"],"mappings":";;;;+BAMaA;;;eAAAA;;;+DANM;uBAIO;;;;;;AAEnB,IAAA,AAAMA,uBAAN,MAAMA;IAOZ,MAAaC,SAASC,SAAiB,EAAEC,QAAyC,EAAiB;QAClGC,gBAAS,CAACC,GAAG,CAAC,CAAC,gBAAgB,EAAEH,WAAW;QAE5C,MAAMI,MAAM,IAAIC,eAAM,CAACC,SAAS,GAAGC,eAAe,CAACP,WAAW;QAC9D,IAAI,CAACI,KAAK;YACT,OAAOH,SAAS;QACjB;QAEA,MAAMO,WAAWJ,IAAIK,sBAAsB,CAAC,wCAAwC,iBAAiB,CAAC,EAAE;QACxG,IAAI,CAACD,UAAU;YACd,OAAOP,SAAS,qBAAqB;QACtC;QAEA,oDAAoD;QACpD,IAAIS;QACJ,IAAI;YACHA,eAAeF,SAASG,YAAY,CAAC;YACrCT,gBAAS,CAACC,GAAG,CAAC,CAAC,gBAAgB,EAAEO,cAAc;QAChD,EAAE,OAAOE,GAAG;YACXV,gBAAS,CAACC,GAAG,CAAC,CAAC,cAAc,EAAES,GAAG;YAClC,MAAMC,MAAMT,IAAIK,sBAAsB,CAAC,wCAAwC;YAC/EP,gBAAS,CAACC,GAAG,CAAC,CAAC,gFAAgF,EAAEU,KAAK;QACvG;QAEA,IAAI,CAACH,cAAc;YAClB,OAAOT,SAAS,gCAAgC;QACjD;QAEA,MAAMa,oBAAoBZ,gBAAS,CAACa,cAAc,CAACX;QACnD,IAAI,CAACU,kBAAkBE,OAAO,EAAE;YAC/B,OAAOf,SAAS,sCAAsC;QACvD;QAEA,OAAOA,SAAS,MAAMS;IACvB;IAtCAO,YAAYC,sBAA+C,CAAE;QAC5D,IAAI,CAACA,sBAAsB,GAAGA;IAC/B;AAqCD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/parsers/LogoutResponse.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5938c2b9632fa3d3b2b69fdd376c5864802e3eae","contentHash":"9c0a43853f9bf26acffedbacc85a41d10da83dc4a8d269106fe18ee94317f690"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/parsers/Response.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/parsers/Response.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":30}},"3":{"start":{"line":11,"column":30},"end":{"line":11,"column":81}},"4":{"start":{"line":12,"column":33},"end":{"line":12,"column":80}},"5":{"start":{"line":13,"column":37},"end":{"line":13,"column":88}},"6":{"start":{"line":14,"column":15},"end":{"line":14,"column":34}},"7":{"start":{"line":15,"column":19},"end":{"line":15,"column":42}},"8":{"start":{"line":17,"column":4},"end":{"line":19,"column":6}},"9":{"start":{"line":21,"column":21},"end":{"line":397,"column":1}},"10":{"start":{"line":24,"column":8},"end":{"line":24,"column":77}},"11":{"start":{"line":25,"column":20},"end":{"line":25,"column":24}},"12":{"start":{"line":26,"column":20},"end":{"line":51,"column":43}},"13":{"start":{"line":29,"column":20},"end":{"line":32,"column":21}},"14":{"start":{"line":30,"column":24},"end":{"line":30,"column":34}},"15":{"start":{"line":31,"column":24},"end":{"line":31,"column":31}},"16":{"start":{"line":33,"column":20},"end":{"line":36,"column":21}},"17":{"start":{"line":34,"column":24},"end":{"line":34,"column":45}},"18":{"start":{"line":35,"column":24},"end":{"line":35,"column":31}},"19":{"start":{"line":37,"column":20},"end":{"line":37,"column":40}},"20":{"start":{"line":40,"column":20},"end":{"line":43,"column":21}},"21":{"start":{"line":41,"column":24},"end":{"line":41,"column":34}},"22":{"start":{"line":42,"column":24},"end":{"line":42,"column":31}},"23":{"start":{"line":44,"column":20},"end":{"line":47,"column":21}},"24":{"start":{"line":45,"column":24},"end":{"line":45,"column":45}},"25":{"start":{"line":46,"column":24},"end":{"line":46,"column":31}},"26":{"start":{"line":48,"column":20},"end":{"line":48,"column":40}},"27":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"28":{"start":{"line":53,"column":12},"end":{"line":53,"column":44}},"29":{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},"30":{"start":{"line":56,"column":12},"end":{"line":56,"column":48}},"31":{"start":{"line":58,"column":29},"end":{"line":58,"column":107}},"32":{"start":{"line":59,"column":8},"end":{"line":61,"column":9}},"33":{"start":{"line":60,"column":12},"end":{"line":60,"column":60}},"34":{"start":{"line":62,"column":8},"end":{"line":64,"column":9}},"35":{"start":{"line":63,"column":12},"end":{"line":63,"column":79}},"36":{"start":{"line":65,"column":25},"end":{"line":65,"column":40}},"37":{"start":{"line":66,"column":8},"end":{"line":66,"column":45}},"38":{"start":{"line":67,"column":8},"end":{"line":67,"column":46}},"39":{"start":{"line":68,"column":34},"end":{"line":68,"column":70}},"40":{"start":{"line":69,"column":8},"end":{"line":77,"column":9}},"41":{"start":{"line":70,"column":12},"end":{"line":72,"column":13}},"42":{"start":{"line":71,"column":16},"end":{"line":71,"column":78}},"43":{"start":{"line":73,"column":12},"end":{"line":75,"column":13}},"44":{"start":{"line":74,"column":16},"end":{"line":74,"column":83}},"45":{"start":{"line":76,"column":12},"end":{"line":76,"column":98}},"46":{"start":{"line":78,"column":8},"end":{"line":78,"column":42}},"47":{"start":{"line":82,"column":8},"end":{"line":88,"column":9}},"48":{"start":{"line":83,"column":12},"end":{"line":83,"column":61}},"49":{"start":{"line":84,"column":12},"end":{"line":84,"column":48}},"50":{"start":{"line":85,"column":12},"end":{"line":85,"column":64}},"51":{"start":{"line":87,"column":12},"end":{"line":87,"column":77}},"52":{"start":{"line":89,"column":24},"end":{"line":89,"column":26}},"53":{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},"54":{"start":{"line":91,"column":12},"end":{"line":91,"column":75}},"55":{"start":{"line":93,"column":8},"end":{"line":97,"column":9}},"56":{"start":{"line":94,"column":12},"end":{"line":94,"column":47}},"57":{"start":{"line":96,"column":12},"end":{"line":96,"column":77}},"58":{"start":{"line":98,"column":8},"end":{"line":100,"column":9}},"59":{"start":{"line":99,"column":12},"end":{"line":99,"column":48}},"60":{"start":{"line":101,"column":24},"end":{"line":101,"column":50}},"61":{"start":{"line":102,"column":8},"end":{"line":115,"column":9}},"62":{"start":{"line":103,"column":27},"end":{"line":103,"column":111}},"63":{"start":{"line":104,"column":12},"end":{"line":109,"column":13}},"64":{"start":{"line":105,"column":16},"end":{"line":105,"column":52}},"65":{"start":{"line":106,"column":16},"end":{"line":108,"column":17}},"66":{"start":{"line":107,"column":20},"end":{"line":107,"column":73}},"67":{"start":{"line":110,"column":12},"end":{"line":114,"column":13}},"68":{"start":{"line":111,"column":16},"end":{"line":111,"column":56}},"69":{"start":{"line":113,"column":16},"end":{"line":113,"column":81}},"70":{"start":{"line":116,"column":8},"end":{"line":120,"column":9}},"71":{"start":{"line":117,"column":12},"end":{"line":117,"column":56}},"72":{"start":{"line":119,"column":12},"end":{"line":119,"column":77}},"73":{"start":{"line":121,"column":31},"end":{"line":121,"column":125}},"74":{"start":{"line":122,"column":8},"end":{"line":131,"column":9}},"75":{"start":{"line":123,"column":12},"end":{"line":128,"column":13}},"76":{"start":{"line":124,"column":16},"end":{"line":124,"column":83}},"77":{"start":{"line":125,"column":16},"end":{"line":125,"column":79}},"78":{"start":{"line":127,"column":16},"end":{"line":127,"column":63}},"79":{"start":{"line":130,"column":12},"end":{"line":130,"column":61}},"80":{"start":{"line":132,"column":35},"end":{"line":132,"column":133}},"81":{"start":{"line":133,"column":8},"end":{"line":137,"column":9}},"82":{"start":{"line":134,"column":12},"end":{"line":134,"column":60}},"83":{"start":{"line":136,"column":12},"end":{"line":136,"column":83}},"84":{"start":{"line":138,"column":8},"end":{"line":140,"column":9}},"85":{"start":{"line":139,"column":12},"end":{"line":139,"column":43}},"86":{"start":{"line":141,"column":28},"end":{"line":141,"column":48}},"87":{"start":{"line":142,"column":8},"end":{"line":148,"column":9}},"88":{"start":{"line":142,"column":20},"end":{"line":142,"column":21}},"89":{"start":{"line":143,"column":24},"end":{"line":143,"column":38}},"90":{"start":{"line":144,"column":12},"end":{"line":147,"column":13}},"91":{"start":{"line":145,"column":16},"end":{"line":145,"column":64}},"92":{"start":{"line":146,"column":16},"end":{"line":146,"column":36}},"93":{"start":{"line":149,"column":8},"end":{"line":152,"column":11}},"94":{"start":{"line":153,"column":8},"end":{"line":153,"column":46}},"95":{"start":{"line":156,"column":31},"end":{"line":156,"column":115}},"96":{"start":{"line":157,"column":8},"end":{"line":159,"column":9}},"97":{"start":{"line":158,"column":12},"end":{"line":158,"column":85}},"98":{"start":{"line":160,"column":8},"end":{"line":160,"column":46}},"99":{"start":{"line":161,"column":34},"end":{"line":161,"column":70}},"100":{"start":{"line":162,"column":8},"end":{"line":164,"column":9}},"101":{"start":{"line":163,"column":12},"end":{"line":163,"column":98}},"102":{"start":{"line":165,"column":8},"end":{"line":165,"column":42}},"103":{"start":{"line":167,"column":8},"end":{"line":167,"column":42}},"104":{"start":{"line":170,"column":30},"end":{"line":170,"column":115}},"105":{"start":{"line":171,"column":38},"end":{"line":171,"column":132}},"106":{"start":{"line":172,"column":8},"end":{"line":174,"column":9}},"107":{"start":{"line":173,"column":12},"end":{"line":173,"column":56}},"108":{"start":{"line":175,"column":24},"end":{"line":175,"column":40}},"109":{"start":{"line":176,"column":29},"end":{"line":176,"column":53}},"110":{"start":{"line":177,"column":21},"end":{"line":177,"column":25}},"111":{"start":{"line":178,"column":8},"end":{"line":197,"column":9}},"112":{"start":{"line":179,"column":28},"end":{"line":181,"column":13}},"113":{"start":{"line":182,"column":28},"end":{"line":182,"column":88}},"114":{"start":{"line":183,"column":12},"end":{"line":196,"column":15}},"115":{"start":{"line":184,"column":16},"end":{"line":186,"column":17}},"116":{"start":{"line":185,"column":20},"end":{"line":185,"column":48}},"117":{"start":{"line":187,"column":33},"end":{"line":187,"column":100}},"118":{"start":{"line":188,"column":16},"end":{"line":190,"column":17}},"119":{"start":{"line":189,"column":20},"end":{"line":189,"column":72}},"120":{"start":{"line":191,"column":44},"end":{"line":191,"column":129}},"121":{"start":{"line":192,"column":16},"end":{"line":194,"column":17}},"122":{"start":{"line":193,"column":20},"end":{"line":193,"column":55}},"123":{"start":{"line":195,"column":16},"end":{"line":195,"column":32}},"124":{"start":{"line":198,"column":8},"end":{"line":200,"column":9}},"125":{"start":{"line":199,"column":12},"end":{"line":199,"column":54}},"126":{"start":{"line":201,"column":8},"end":{"line":204,"column":10}},"127":{"start":{"line":207,"column":8},"end":{"line":209,"column":9}},"128":{"start":{"line":208,"column":12},"end":{"line":208,"column":19}},"129":{"start":{"line":210,"column":30},"end":{"line":210,"column":81}},"130":{"start":{"line":211,"column":28},"end":{"line":211,"column":54}},"131":{"start":{"line":212,"column":30},"end":{"line":212,"column":100}},"132":{"start":{"line":213,"column":31},"end":{"line":213,"column":102}},"133":{"start":{"line":214,"column":32},"end":{"line":214,"column":37}},"134":{"start":{"line":215,"column":8},"end":{"line":226,"column":9}},"135":{"start":{"line":216,"column":12},"end":{"line":216,"column":62}},"136":{"start":{"line":217,"column":12},"end":{"line":224,"column":13}},"137":{"start":{"line":218,"column":16},"end":{"line":221,"column":17}},"138":{"start":{"line":219,"column":20},"end":{"line":219,"column":69}},"139":{"start":{"line":220,"column":20},"end":{"line":220,"column":57}},"140":{"start":{"line":223,"column":16},"end":{"line":223,"column":41}},"141":{"start":{"line":225,"column":12},"end":{"line":225,"column":58}},"142":{"start":{"line":227,"column":8},"end":{"line":238,"column":9}},"143":{"start":{"line":228,"column":12},"end":{"line":228,"column":63}},"144":{"start":{"line":229,"column":12},"end":{"line":236,"column":13}},"145":{"start":{"line":230,"column":16},"end":{"line":233,"column":17}},"146":{"start":{"line":231,"column":20},"end":{"line":231,"column":70}},"147":{"start":{"line":232,"column":20},"end":{"line":232,"column":67}},"148":{"start":{"line":235,"column":16},"end":{"line":235,"column":41}},"149":{"start":{"line":237,"column":12},"end":{"line":237,"column":59}},"150":{"start":{"line":239,"column":8},"end":{"line":242,"column":9}},"151":{"start":{"line":240,"column":12},"end":{"line":240,"column":55}},"152":{"start":{"line":241,"column":12},"end":{"line":241,"column":61}},"153":{"start":{"line":245,"column":8},"end":{"line":245,"column":67}},"154":{"start":{"line":248,"column":8},"end":{"line":248,"column":68}},"155":{"start":{"line":251,"column":30},"end":{"line":251,"column":121}},"156":{"start":{"line":252,"column":27},"end":{"line":252,"column":74}},"157":{"start":{"line":253,"column":24},"end":{"line":253,"column":28}},"158":{"start":{"line":254,"column":8},"end":{"line":264,"column":9}},"159":{"start":{"line":255,"column":12},"end":{"line":257,"column":13}},"160":{"start":{"line":256,"column":16},"end":{"line":256,"column":25}},"161":{"start":{"line":259,"column":12},"end":{"line":262,"column":13}},"162":{"start":{"line":260,"column":16},"end":{"line":260,"column":95}},"163":{"start":{"line":261,"column":16},"end":{"line":261,"column":29}},"164":{"start":{"line":263,"column":12},"end":{"line":263,"column":29}},"165":{"start":{"line":265,"column":8},"end":{"line":268,"column":9}},"166":{"start":{"line":266,"column":12},"end":{"line":266,"column":91}},"167":{"start":{"line":267,"column":12},"end":{"line":267,"column":25}},"168":{"start":{"line":269,"column":8},"end":{"line":269,"column":60}},"169":{"start":{"line":272,"column":20},"end":{"line":272,"column":54}},"170":{"start":{"line":273,"column":8},"end":{"line":276,"column":10}},"171":{"start":{"line":274,"column":28},"end":{"line":274,"column":51}},"172":{"start":{"line":275,"column":24},"end":{"line":275,"column":69}},"173":{"start":{"line":277,"column":8},"end":{"line":277,"column":37}},"174":{"start":{"line":278,"column":23},"end":{"line":278,"column":46}},"175":{"start":{"line":279,"column":8},"end":{"line":281,"column":9}},"176":{"start":{"line":280,"column":12},"end":{"line":280,"column":55}},"177":{"start":{"line":282,"column":8},"end":{"line":282,"column":22}},"178":{"start":{"line":285,"column":24},"end":{"line":285,"column":107}},"179":{"start":{"line":286,"column":8},"end":{"line":288,"column":9}},"180":{"start":{"line":287,"column":12},"end":{"line":287,"column":48}},"181":{"start":{"line":289,"column":8},"end":{"line":289,"column":26}},"182":{"start":{"line":292,"column":22},"end":{"line":292,"column":109}},"183":{"start":{"line":293,"column":27},"end":{"line":293,"column":118}},"184":{"start":{"line":294,"column":8},"end":{"line":304,"column":9}},"185":{"start":{"line":295,"column":28},"end":{"line":297,"column":13}},"186":{"start":{"line":298,"column":12},"end":{"line":303,"column":15}},"187":{"start":{"line":299,"column":16},"end":{"line":301,"column":17}},"188":{"start":{"line":300,"column":20},"end":{"line":300,"column":48}},"189":{"start":{"line":302,"column":16},"end":{"line":302,"column":94}},"190":{"start":{"line":305,"column":8},"end":{"line":305,"column":23}},"191":{"start":{"line":308,"column":36},"end":{"line":308,"column":133}},"192":{"start":{"line":309,"column":8},"end":{"line":314,"column":9}},"193":{"start":{"line":310,"column":44},"end":{"line":310,"column":157}},"194":{"start":{"line":311,"column":12},"end":{"line":313,"column":13}},"195":{"start":{"line":312,"column":16},"end":{"line":312,"column":77}},"196":{"start":{"line":317,"column":23},"end":{"line":317,"column":33}},"197":{"start":{"line":318,"column":34},"end":{"line":318,"column":84}},"198":{"start":{"line":319,"column":20},"end":{"line":319,"column":66}},"199":{"start":{"line":320,"column":8},"end":{"line":329,"column":9}},"200":{"start":{"line":321,"column":30},"end":{"line":321,"column":63}},"201":{"start":{"line":322,"column":12},"end":{"line":324,"column":13}},"202":{"start":{"line":323,"column":16},"end":{"line":323,"column":29}},"203":{"start":{"line":325,"column":25},"end":{"line":325,"column":44}},"204":{"start":{"line":326,"column":12},"end":{"line":328,"column":13}},"205":{"start":{"line":327,"column":16},"end":{"line":327,"column":29}},"206":{"start":{"line":330,"column":8},"end":{"line":339,"column":9}},"207":{"start":{"line":331,"column":33},"end":{"line":331,"column":69}},"208":{"start":{"line":332,"column":12},"end":{"line":334,"column":13}},"209":{"start":{"line":333,"column":16},"end":{"line":333,"column":29}},"210":{"start":{"line":335,"column":25},"end":{"line":335,"column":47}},"211":{"start":{"line":336,"column":12},"end":{"line":338,"column":13}},"212":{"start":{"line":337,"column":16},"end":{"line":337,"column":29}},"213":{"start":{"line":340,"column":8},"end":{"line":340,"column":20}},"214":{"start":{"line":343,"column":27},"end":{"line":343,"column":117}},"215":{"start":{"line":344,"column":8},"end":{"line":346,"column":9}},"216":{"start":{"line":345,"column":12},"end":{"line":345,"column":73}},"217":{"start":{"line":349,"column":8},"end":{"line":349,"column":98}},"218":{"start":{"line":350,"column":27},"end":{"line":350,"column":122}},"219":{"start":{"line":351,"column":8},"end":{"line":351,"column":83}},"220":{"start":{"line":352,"column":8},"end":{"line":373,"column":9}},"221":{"start":{"line":353,"column":12},"end":{"line":370,"column":13}},"222":{"start":{"line":353,"column":24},"end":{"line":353,"column":25}},"223":{"start":{"line":354,"column":31},"end":{"line":354,"column":126}},"224":{"start":{"line":356,"column":16},"end":{"line":363,"column":17}},"225":{"start":{"line":357,"column":20},"end":{"line":357,"column":50}},"226":{"start":{"line":359,"column":20},"end":{"line":359,"column":31}},"227":{"start":{"line":360,"column":20},"end":{"line":362,"column":21}},"228":{"start":{"line":360,"column":32},"end":{"line":360,"column":33}},"229":{"start":{"line":361,"column":24},"end":{"line":361,"column":58}},"230":{"start":{"line":364,"column":28},"end":{"line":364,"column":62}},"231":{"start":{"line":365,"column":16},"end":{"line":369,"column":17}},"232":{"start":{"line":366,"column":20},"end":{"line":366,"column":104}},"233":{"start":{"line":367,"column":20},"end":{"line":367,"column":110}},"234":{"start":{"line":368,"column":20},"end":{"line":368,"column":41}},"235":{"start":{"line":372,"column":12},"end":{"line":372,"column":85}},"236":{"start":{"line":374,"column":8},"end":{"line":377,"column":9}},"237":{"start":{"line":376,"column":12},"end":{"line":376,"column":72}},"238":{"start":{"line":378,"column":8},"end":{"line":380,"column":9}},"239":{"start":{"line":379,"column":12},"end":{"line":379,"column":68}},"240":{"start":{"line":381,"column":8},"end":{"line":383,"column":9}},"241":{"start":{"line":382,"column":12},"end":{"line":382,"column":79}},"242":{"start":{"line":384,"column":8},"end":{"line":386,"column":9}},"243":{"start":{"line":385,"column":12},"end":{"line":385,"column":71}},"244":{"start":{"line":387,"column":8},"end":{"line":389,"column":9}},"245":{"start":{"line":388,"column":12},"end":{"line":388,"column":41}},"246":{"start":{"line":390,"column":8},"end":{"line":392,"column":9}},"247":{"start":{"line":391,"column":12},"end":{"line":391,"column":52}},"248":{"start":{"line":395,"column":8},"end":{"line":395,"column":61}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":33}},"loc":{"start":{"line":16,"column":39},"end":{"line":20,"column":1}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":22,"column":4},"end":{"line":22,"column":5}},"loc":{"start":{"line":22,"column":28},"end":{"line":154,"column":5}},"line":22},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":28},"end":{"line":28,"column":29}},"loc":{"start":{"line":28,"column":33},"end":{"line":38,"column":17}},"line":28},"4":{"name":"(anonymous_4)","decl":{"start":{"line":39,"column":23},"end":{"line":39,"column":24}},"loc":{"start":{"line":39,"column":28},"end":{"line":49,"column":17}},"line":39},"5":{"name":"(anonymous_5)","decl":{"start":{"line":155,"column":4},"end":{"line":155,"column":5}},"loc":{"start":{"line":155,"column":40},"end":{"line":168,"column":5}},"line":155},"6":{"name":"(anonymous_6)","decl":{"start":{"line":169,"column":4},"end":{"line":169,"column":5}},"loc":{"start":{"line":169,"column":32},"end":{"line":205,"column":5}},"line":169},"7":{"name":"(anonymous_7)","decl":{"start":{"line":183,"column":61},"end":{"line":183,"column":62}},"loc":{"start":{"line":183,"column":76},"end":{"line":196,"column":13}},"line":183},"8":{"name":"(anonymous_8)","decl":{"start":{"line":206,"column":4},"end":{"line":206,"column":5}},"loc":{"start":{"line":206,"column":51},"end":{"line":243,"column":5}},"line":206},"9":{"name":"(anonymous_9)","decl":{"start":{"line":244,"column":4},"end":{"line":244,"column":5}},"loc":{"start":{"line":244,"column":51},"end":{"line":246,"column":5}},"line":244},"10":{"name":"(anonymous_10)","decl":{"start":{"line":247,"column":4},"end":{"line":247,"column":5}},"loc":{"start":{"line":247,"column":53},"end":{"line":249,"column":5}},"line":247},"11":{"name":"(anonymous_11)","decl":{"start":{"line":250,"column":4},"end":{"line":250,"column":5}},"loc":{"start":{"line":250,"column":49},"end":{"line":270,"column":5}},"line":250},"12":{"name":"(anonymous_12)","decl":{"start":{"line":271,"column":4},"end":{"line":271,"column":5}},"loc":{"start":{"line":271,"column":44},"end":{"line":283,"column":5}},"line":271},"13":{"name":"(anonymous_13)","decl":{"start":{"line":274,"column":24},"end":{"line":274,"column":25}},"loc":{"start":{"line":274,"column":28},"end":{"line":274,"column":51}},"line":274},"14":{"name":"(anonymous_14)","decl":{"start":{"line":275,"column":20},"end":{"line":275,"column":21}},"loc":{"start":{"line":275,"column":24},"end":{"line":275,"column":69}},"line":275},"15":{"name":"(anonymous_15)","decl":{"start":{"line":284,"column":4},"end":{"line":284,"column":5}},"loc":{"start":{"line":284,"column":25},"end":{"line":290,"column":5}},"line":284},"16":{"name":"(anonymous_16)","decl":{"start":{"line":291,"column":4},"end":{"line":291,"column":5}},"loc":{"start":{"line":291,"column":26},"end":{"line":306,"column":5}},"line":291},"17":{"name":"(anonymous_17)","decl":{"start":{"line":298,"column":112},"end":{"line":298,"column":113}},"loc":{"start":{"line":298,"column":127},"end":{"line":303,"column":13}},"line":298},"18":{"name":"(anonymous_18)","decl":{"start":{"line":307,"column":4},"end":{"line":307,"column":5}},"loc":{"start":{"line":307,"column":39},"end":{"line":315,"column":5}},"line":307},"19":{"name":"(anonymous_19)","decl":{"start":{"line":316,"column":4},"end":{"line":316,"column":5}},"loc":{"start":{"line":316,"column":53},"end":{"line":341,"column":5}},"line":316},"20":{"name":"(anonymous_20)","decl":{"start":{"line":342,"column":4},"end":{"line":342,"column":5}},"loc":{"start":{"line":342,"column":43},"end":{"line":347,"column":5}},"line":342},"21":{"name":"(anonymous_21)","decl":{"start":{"line":348,"column":4},"end":{"line":348,"column":5}},"loc":{"start":{"line":348,"column":47},"end":{"line":393,"column":5}},"line":348},"22":{"name":"(anonymous_22)","decl":{"start":{"line":394,"column":4},"end":{"line":394,"column":5}},"loc":{"start":{"line":394,"column":39},"end":{"line":396,"column":5}},"line":394}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":11},"end":{"line":19,"column":5}},"type":"cond-expr","locations":[{"start":{"line":17,"column":35},"end":{"line":17,"column":38}},{"start":{"line":17,"column":41},"end":{"line":19,"column":5}}],"line":17},"1":{"loc":{"start":{"line":17,"column":11},"end":{"line":17,"column":32}},"type":"binary-expr","locations":[{"start":{"line":17,"column":11},"end":{"line":17,"column":14}},{"start":{"line":17,"column":18},"end":{"line":17,"column":32}}],"line":17},"2":{"loc":{"start":{"line":29,"column":20},"end":{"line":32,"column":21}},"type":"if","locations":[{"start":{"line":29,"column":20},"end":{"line":32,"column":21}},{"start":{"line":29,"column":20},"end":{"line":32,"column":21}}],"line":29},"3":{"loc":{"start":{"line":33,"column":20},"end":{"line":36,"column":21}},"type":"if","locations":[{"start":{"line":33,"column":20},"end":{"line":36,"column":21}},{"start":{"line":33,"column":20},"end":{"line":36,"column":21}}],"line":33},"4":{"loc":{"start":{"line":40,"column":20},"end":{"line":43,"column":21}},"type":"if","locations":[{"start":{"line":40,"column":20},"end":{"line":43,"column":21}},{"start":{"line":40,"column":20},"end":{"line":43,"column":21}}],"line":40},"5":{"loc":{"start":{"line":44,"column":20},"end":{"line":47,"column":21}},"type":"if","locations":[{"start":{"line":44,"column":20},"end":{"line":47,"column":21}},{"start":{"line":44,"column":20},"end":{"line":47,"column":21}}],"line":44},"6":{"loc":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"type":"if","locations":[{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},{"start":{"line":52,"column":8},"end":{"line":54,"column":9}}],"line":52},"7":{"loc":{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},"type":"if","locations":[{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},{"start":{"line":55,"column":8},"end":{"line":57,"column":9}}],"line":55},"8":{"loc":{"start":{"line":59,"column":8},"end":{"line":61,"column":9}},"type":"if","locations":[{"start":{"line":59,"column":8},"end":{"line":61,"column":9}},{"start":{"line":59,"column":8},"end":{"line":61,"column":9}}],"line":59},"9":{"loc":{"start":{"line":62,"column":8},"end":{"line":64,"column":9}},"type":"if","locations":[{"start":{"line":62,"column":8},"end":{"line":64,"column":9}},{"start":{"line":62,"column":8},"end":{"line":64,"column":9}}],"line":62},"10":{"loc":{"start":{"line":69,"column":8},"end":{"line":77,"column":9}},"type":"if","locations":[{"start":{"line":69,"column":8},"end":{"line":77,"column":9}},{"start":{"line":69,"column":8},"end":{"line":77,"column":9}}],"line":69},"11":{"loc":{"start":{"line":70,"column":12},"end":{"line":72,"column":13}},"type":"if","locations":[{"start":{"line":70,"column":12},"end":{"line":72,"column":13}},{"start":{"line":70,"column":12},"end":{"line":72,"column":13}}],"line":70},"12":{"loc":{"start":{"line":73,"column":12},"end":{"line":75,"column":13}},"type":"if","locations":[{"start":{"line":73,"column":12},"end":{"line":75,"column":13}},{"start":{"line":73,"column":12},"end":{"line":75,"column":13}}],"line":73},"13":{"loc":{"start":{"line":73,"column":16},"end":{"line":73,"column":109}},"type":"binary-expr","locations":[{"start":{"line":73,"column":16},"end":{"line":73,"column":80}},{"start":{"line":73,"column":84},"end":{"line":73,"column":109}}],"line":73},"14":{"loc":{"start":{"line":87,"column":28},"end":{"line":87,"column":62}},"type":"cond-expr","locations":[{"start":{"line":87,"column":49},"end":{"line":87,"column":50}},{"start":{"line":87,"column":53},"end":{"line":87,"column":62}}],"line":87},"15":{"loc":{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},"type":"if","locations":[{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},{"start":{"line":90,"column":8},"end":{"line":92,"column":9}}],"line":90},"16":{"loc":{"start":{"line":96,"column":28},"end":{"line":96,"column":62}},"type":"cond-expr","locations":[{"start":{"line":96,"column":49},"end":{"line":96,"column":50}},{"start":{"line":96,"column":53},"end":{"line":96,"column":62}}],"line":96},"17":{"loc":{"start":{"line":98,"column":8},"end":{"line":100,"column":9}},"type":"if","locations":[{"start":{"line":98,"column":8},"end":{"line":100,"column":9}},{"start":{"line":98,"column":8},"end":{"line":100,"column":9}}],"line":98},"18":{"loc":{"start":{"line":102,"column":8},"end":{"line":115,"column":9}},"type":"if","locations":[{"start":{"line":102,"column":8},"end":{"line":115,"column":9}},{"start":{"line":102,"column":8},"end":{"line":115,"column":9}}],"line":102},"19":{"loc":{"start":{"line":104,"column":12},"end":{"line":109,"column":13}},"type":"if","locations":[{"start":{"line":104,"column":12},"end":{"line":109,"column":13}},{"start":{"line":104,"column":12},"end":{"line":109,"column":13}}],"line":104},"20":{"loc":{"start":{"line":106,"column":16},"end":{"line":108,"column":17}},"type":"if","locations":[{"start":{"line":106,"column":16},"end":{"line":108,"column":17}},{"start":{"line":106,"column":16},"end":{"line":108,"column":17}}],"line":106},"21":{"loc":{"start":{"line":113,"column":32},"end":{"line":113,"column":66}},"type":"cond-expr","locations":[{"start":{"line":113,"column":53},"end":{"line":113,"column":54}},{"start":{"line":113,"column":57},"end":{"line":113,"column":66}}],"line":113},"22":{"loc":{"start":{"line":119,"column":28},"end":{"line":119,"column":62}},"type":"cond-expr","locations":[{"start":{"line":119,"column":49},"end":{"line":119,"column":50}},{"start":{"line":119,"column":53},"end":{"line":119,"column":62}}],"line":119},"23":{"loc":{"start":{"line":122,"column":8},"end":{"line":131,"column":9}},"type":"if","locations":[{"start":{"line":122,"column":8},"end":{"line":131,"column":9}},{"start":{"line":122,"column":8},"end":{"line":131,"column":9}}],"line":122},"24":{"loc":{"start":{"line":123,"column":12},"end":{"line":128,"column":13}},"type":"if","locations":[{"start":{"line":123,"column":12},"end":{"line":128,"column":13}},{"start":{"line":123,"column":12},"end":{"line":128,"column":13}}],"line":123},"25":{"loc":{"start":{"line":133,"column":8},"end":{"line":137,"column":9}},"type":"if","locations":[{"start":{"line":133,"column":8},"end":{"line":137,"column":9}},{"start":{"line":133,"column":8},"end":{"line":137,"column":9}}],"line":133},"26":{"loc":{"start":{"line":138,"column":8},"end":{"line":140,"column":9}},"type":"if","locations":[{"start":{"line":138,"column":8},"end":{"line":140,"column":9}},{"start":{"line":138,"column":8},"end":{"line":140,"column":9}}],"line":138},"27":{"loc":{"start":{"line":138,"column":12},"end":{"line":138,"column":121}},"type":"binary-expr","locations":[{"start":{"line":138,"column":12},"end":{"line":138,"column":26}},{"start":{"line":138,"column":30},"end":{"line":138,"column":44}},{"start":{"line":138,"column":48},"end":{"line":138,"column":68}},{"start":{"line":138,"column":72},"end":{"line":138,"column":121}}],"line":138},"28":{"loc":{"start":{"line":144,"column":12},"end":{"line":147,"column":13}},"type":"if","locations":[{"start":{"line":144,"column":12},"end":{"line":147,"column":13}},{"start":{"line":144,"column":12},"end":{"line":147,"column":13}}],"line":144},"29":{"loc":{"start":{"line":157,"column":8},"end":{"line":159,"column":9}},"type":"if","locations":[{"start":{"line":157,"column":8},"end":{"line":159,"column":9}},{"start":{"line":157,"column":8},"end":{"line":159,"column":9}}],"line":157},"30":{"loc":{"start":{"line":162,"column":8},"end":{"line":164,"column":9}},"type":"if","locations":[{"start":{"line":162,"column":8},"end":{"line":164,"column":9}},{"start":{"line":162,"column":8},"end":{"line":164,"column":9}}],"line":162},"31":{"loc":{"start":{"line":172,"column":8},"end":{"line":174,"column":9}},"type":"if","locations":[{"start":{"line":172,"column":8},"end":{"line":174,"column":9}},{"start":{"line":172,"column":8},"end":{"line":174,"column":9}}],"line":172},"32":{"loc":{"start":{"line":178,"column":8},"end":{"line":197,"column":9}},"type":"if","locations":[{"start":{"line":178,"column":8},"end":{"line":197,"column":9}},{"start":{"line":178,"column":8},"end":{"line":197,"column":9}}],"line":178},"33":{"loc":{"start":{"line":184,"column":16},"end":{"line":186,"column":17}},"type":"if","locations":[{"start":{"line":184,"column":16},"end":{"line":186,"column":17}},{"start":{"line":184,"column":16},"end":{"line":186,"column":17}}],"line":184},"34":{"loc":{"start":{"line":188,"column":16},"end":{"line":190,"column":17}},"type":"if","locations":[{"start":{"line":188,"column":16},"end":{"line":190,"column":17}},{"start":{"line":188,"column":16},"end":{"line":190,"column":17}}],"line":188},"35":{"loc":{"start":{"line":192,"column":16},"end":{"line":194,"column":17}},"type":"if","locations":[{"start":{"line":192,"column":16},"end":{"line":194,"column":17}},{"start":{"line":192,"column":16},"end":{"line":194,"column":17}}],"line":192},"36":{"loc":{"start":{"line":198,"column":8},"end":{"line":200,"column":9}},"type":"if","locations":[{"start":{"line":198,"column":8},"end":{"line":200,"column":9}},{"start":{"line":198,"column":8},"end":{"line":200,"column":9}}],"line":198},"37":{"loc":{"start":{"line":203,"column":17},"end":{"line":203,"column":30}},"type":"binary-expr","locations":[{"start":{"line":203,"column":17},"end":{"line":203,"column":23}},{"start":{"line":203,"column":27},"end":{"line":203,"column":30}}],"line":203},"38":{"loc":{"start":{"line":207,"column":8},"end":{"line":209,"column":9}},"type":"if","locations":[{"start":{"line":207,"column":8},"end":{"line":209,"column":9}},{"start":{"line":207,"column":8},"end":{"line":209,"column":9}}],"line":207},"39":{"loc":{"start":{"line":212,"column":30},"end":{"line":212,"column":100}},"type":"binary-expr","locations":[{"start":{"line":212,"column":30},"end":{"line":212,"column":58}},{"start":{"line":212,"column":62},"end":{"line":212,"column":85}},{"start":{"line":212,"column":89},"end":{"line":212,"column":100}}],"line":212},"40":{"loc":{"start":{"line":213,"column":31},"end":{"line":213,"column":102}},"type":"binary-expr","locations":[{"start":{"line":213,"column":31},"end":{"line":213,"column":60}},{"start":{"line":213,"column":64},"end":{"line":213,"column":87}},{"start":{"line":213,"column":91},"end":{"line":213,"column":102}}],"line":213},"41":{"loc":{"start":{"line":215,"column":8},"end":{"line":226,"column":9}},"type":"if","locations":[{"start":{"line":215,"column":8},"end":{"line":226,"column":9}},{"start":{"line":215,"column":8},"end":{"line":226,"column":9}}],"line":215},"42":{"loc":{"start":{"line":217,"column":12},"end":{"line":224,"column":13}},"type":"if","locations":[{"start":{"line":217,"column":12},"end":{"line":224,"column":13}},{"start":{"line":217,"column":12},"end":{"line":224,"column":13}}],"line":217},"43":{"loc":{"start":{"line":218,"column":16},"end":{"line":221,"column":17}},"type":"if","locations":[{"start":{"line":218,"column":16},"end":{"line":221,"column":17}},{"start":{"line":218,"column":16},"end":{"line":221,"column":17}}],"line":218},"44":{"loc":{"start":{"line":227,"column":8},"end":{"line":238,"column":9}},"type":"if","locations":[{"start":{"line":227,"column":8},"end":{"line":238,"column":9}},{"start":{"line":227,"column":8},"end":{"line":238,"column":9}}],"line":227},"45":{"loc":{"start":{"line":229,"column":12},"end":{"line":236,"column":13}},"type":"if","locations":[{"start":{"line":229,"column":12},"end":{"line":236,"column":13}},{"start":{"line":229,"column":12},"end":{"line":236,"column":13}}],"line":229},"46":{"loc":{"start":{"line":230,"column":16},"end":{"line":233,"column":17}},"type":"if","locations":[{"start":{"line":230,"column":16},"end":{"line":233,"column":17}},{"start":{"line":230,"column":16},"end":{"line":233,"column":17}}],"line":230},"47":{"loc":{"start":{"line":239,"column":8},"end":{"line":242,"column":9}},"type":"if","locations":[{"start":{"line":239,"column":8},"end":{"line":242,"column":9}},{"start":{"line":239,"column":8},"end":{"line":242,"column":9}}],"line":239},"48":{"loc":{"start":{"line":239,"column":12},"end":{"line":239,"column":45}},"type":"binary-expr","locations":[{"start":{"line":239,"column":12},"end":{"line":239,"column":23}},{"start":{"line":239,"column":27},"end":{"line":239,"column":45}}],"line":239},"49":{"loc":{"start":{"line":255,"column":12},"end":{"line":257,"column":13}},"type":"if","locations":[{"start":{"line":255,"column":12},"end":{"line":257,"column":13}},{"start":{"line":255,"column":12},"end":{"line":257,"column":13}}],"line":255},"50":{"loc":{"start":{"line":259,"column":12},"end":{"line":262,"column":13}},"type":"if","locations":[{"start":{"line":259,"column":12},"end":{"line":262,"column":13}},{"start":{"line":259,"column":12},"end":{"line":262,"column":13}}],"line":259},"51":{"loc":{"start":{"line":265,"column":8},"end":{"line":268,"column":9}},"type":"if","locations":[{"start":{"line":265,"column":8},"end":{"line":268,"column":9}},{"start":{"line":265,"column":8},"end":{"line":268,"column":9}}],"line":265},"52":{"loc":{"start":{"line":279,"column":8},"end":{"line":281,"column":9}},"type":"if","locations":[{"start":{"line":279,"column":8},"end":{"line":281,"column":9}},{"start":{"line":279,"column":8},"end":{"line":281,"column":9}}],"line":279},"53":{"loc":{"start":{"line":279,"column":12},"end":{"line":279,"column":43}},"type":"binary-expr","locations":[{"start":{"line":279,"column":12},"end":{"line":279,"column":19}},{"start":{"line":279,"column":23},"end":{"line":279,"column":43}}],"line":279},"54":{"loc":{"start":{"line":286,"column":8},"end":{"line":288,"column":9}},"type":"if","locations":[{"start":{"line":286,"column":8},"end":{"line":288,"column":9}},{"start":{"line":286,"column":8},"end":{"line":288,"column":9}}],"line":286},"55":{"loc":{"start":{"line":294,"column":8},"end":{"line":304,"column":9}},"type":"if","locations":[{"start":{"line":294,"column":8},"end":{"line":304,"column":9}},{"start":{"line":294,"column":8},"end":{"line":304,"column":9}}],"line":294},"56":{"loc":{"start":{"line":299,"column":16},"end":{"line":301,"column":17}},"type":"if","locations":[{"start":{"line":299,"column":16},"end":{"line":301,"column":17}},{"start":{"line":299,"column":16},"end":{"line":301,"column":17}}],"line":299},"57":{"loc":{"start":{"line":309,"column":8},"end":{"line":314,"column":9}},"type":"if","locations":[{"start":{"line":309,"column":8},"end":{"line":314,"column":9}},{"start":{"line":309,"column":8},"end":{"line":314,"column":9}}],"line":309},"58":{"loc":{"start":{"line":311,"column":12},"end":{"line":313,"column":13}},"type":"if","locations":[{"start":{"line":311,"column":12},"end":{"line":313,"column":13}},{"start":{"line":311,"column":12},"end":{"line":313,"column":13}}],"line":311},"59":{"loc":{"start":{"line":311,"column":16},"end":{"line":311,"column":113}},"type":"binary-expr","locations":[{"start":{"line":311,"column":16},"end":{"line":311,"column":39}},{"start":{"line":311,"column":43},"end":{"line":311,"column":113}}],"line":311},"60":{"loc":{"start":{"line":318,"column":34},"end":{"line":318,"column":84}},"type":"binary-expr","locations":[{"start":{"line":318,"column":34},"end":{"line":318,"column":79}},{"start":{"line":318,"column":83},"end":{"line":318,"column":84}}],"line":318},"61":{"loc":{"start":{"line":320,"column":8},"end":{"line":329,"column":9}},"type":"if","locations":[{"start":{"line":320,"column":8},"end":{"line":329,"column":9}},{"start":{"line":320,"column":8},"end":{"line":329,"column":9}}],"line":320},"62":{"loc":{"start":{"line":322,"column":12},"end":{"line":324,"column":13}},"type":"if","locations":[{"start":{"line":322,"column":12},"end":{"line":324,"column":13}},{"start":{"line":322,"column":12},"end":{"line":324,"column":13}}],"line":322},"63":{"loc":{"start":{"line":326,"column":12},"end":{"line":328,"column":13}},"type":"if","locations":[{"start":{"line":326,"column":12},"end":{"line":328,"column":13}},{"start":{"line":326,"column":12},"end":{"line":328,"column":13}}],"line":326},"64":{"loc":{"start":{"line":330,"column":8},"end":{"line":339,"column":9}},"type":"if","locations":[{"start":{"line":330,"column":8},"end":{"line":339,"column":9}},{"start":{"line":330,"column":8},"end":{"line":339,"column":9}}],"line":330},"65":{"loc":{"start":{"line":332,"column":12},"end":{"line":334,"column":13}},"type":"if","locations":[{"start":{"line":332,"column":12},"end":{"line":334,"column":13}},{"start":{"line":332,"column":12},"end":{"line":334,"column":13}}],"line":332},"66":{"loc":{"start":{"line":336,"column":12},"end":{"line":338,"column":13}},"type":"if","locations":[{"start":{"line":336,"column":12},"end":{"line":338,"column":13}},{"start":{"line":336,"column":12},"end":{"line":338,"column":13}}],"line":336},"67":{"loc":{"start":{"line":344,"column":8},"end":{"line":346,"column":9}},"type":"if","locations":[{"start":{"line":344,"column":8},"end":{"line":346,"column":9}},{"start":{"line":344,"column":8},"end":{"line":346,"column":9}}],"line":344},"68":{"loc":{"start":{"line":344,"column":12},"end":{"line":344,"column":83}},"type":"binary-expr","locations":[{"start":{"line":344,"column":12},"end":{"line":344,"column":22}},{"start":{"line":344,"column":26},"end":{"line":344,"column":83}}],"line":344},"69":{"loc":{"start":{"line":352,"column":8},"end":{"line":373,"column":9}},"type":"if","locations":[{"start":{"line":352,"column":8},"end":{"line":373,"column":9}},{"start":{"line":352,"column":8},"end":{"line":373,"column":9}}],"line":352},"70":{"loc":{"start":{"line":356,"column":16},"end":{"line":363,"column":17}},"type":"if","locations":[{"start":{"line":356,"column":16},"end":{"line":363,"column":17}},{"start":{"line":356,"column":16},"end":{"line":363,"column":17}}],"line":356},"71":{"loc":{"start":{"line":365,"column":16},"end":{"line":369,"column":17}},"type":"if","locations":[{"start":{"line":365,"column":16},"end":{"line":369,"column":17}},{"start":{"line":365,"column":16},"end":{"line":369,"column":17}}],"line":365},"72":{"loc":{"start":{"line":374,"column":8},"end":{"line":377,"column":9}},"type":"if","locations":[{"start":{"line":374,"column":8},"end":{"line":377,"column":9}},{"start":{"line":374,"column":8},"end":{"line":377,"column":9}}],"line":374},"73":{"loc":{"start":{"line":374,"column":12},"end":{"line":374,"column":73}},"type":"binary-expr","locations":[{"start":{"line":374,"column":12},"end":{"line":374,"column":25}},{"start":{"line":374,"column":29},"end":{"line":374,"column":73}}],"line":374},"74":{"loc":{"start":{"line":378,"column":8},"end":{"line":380,"column":9}},"type":"if","locations":[{"start":{"line":378,"column":8},"end":{"line":380,"column":9}},{"start":{"line":378,"column":8},"end":{"line":380,"column":9}}],"line":378},"75":{"loc":{"start":{"line":378,"column":12},"end":{"line":378,"column":69}},"type":"binary-expr","locations":[{"start":{"line":378,"column":12},"end":{"line":378,"column":26}},{"start":{"line":378,"column":30},"end":{"line":378,"column":69}}],"line":378},"76":{"loc":{"start":{"line":381,"column":8},"end":{"line":383,"column":9}},"type":"if","locations":[{"start":{"line":381,"column":8},"end":{"line":383,"column":9}},{"start":{"line":381,"column":8},"end":{"line":383,"column":9}}],"line":381},"77":{"loc":{"start":{"line":381,"column":12},"end":{"line":381,"column":80}},"type":"binary-expr","locations":[{"start":{"line":381,"column":12},"end":{"line":381,"column":32}},{"start":{"line":381,"column":36},"end":{"line":381,"column":80}}],"line":381},"78":{"loc":{"start":{"line":384,"column":8},"end":{"line":386,"column":9}},"type":"if","locations":[{"start":{"line":384,"column":8},"end":{"line":386,"column":9}},{"start":{"line":384,"column":8},"end":{"line":386,"column":9}}],"line":384},"79":{"loc":{"start":{"line":384,"column":12},"end":{"line":384,"column":72}},"type":"binary-expr","locations":[{"start":{"line":384,"column":12},"end":{"line":384,"column":25}},{"start":{"line":384,"column":29},"end":{"line":384,"column":72}}],"line":384},"80":{"loc":{"start":{"line":387,"column":8},"end":{"line":389,"column":9}},"type":"if","locations":[{"start":{"line":387,"column":8},"end":{"line":389,"column":9}},{"start":{"line":387,"column":8},"end":{"line":389,"column":9}}],"line":387},"81":{"loc":{"start":{"line":387,"column":12},"end":{"line":387,"column":42}},"type":"binary-expr","locations":[{"start":{"line":387,"column":12},"end":{"line":387,"column":26}},{"start":{"line":387,"column":30},"end":{"line":387,"column":42}}],"line":387},"82":{"loc":{"start":{"line":390,"column":8},"end":{"line":392,"column":9}},"type":"if","locations":[{"start":{"line":390,"column":8},"end":{"line":392,"column":9}},{"start":{"line":390,"column":8},"end":{"line":392,"column":9}}],"line":390},"83":{"loc":{"start":{"line":390,"column":12},"end":{"line":390,"column":53}},"type":"binary-expr","locations":[{"start":{"line":390,"column":12},"end":{"line":390,"column":23}},{"start":{"line":390,"column":27},"end":{"line":390,"column":53}}],"line":390}},"s":{"0":1,"1":1,"2":24,"3":1,"4":1,"5":1,"6":1,"7":1,"8":3,"9":1,"10":24,"11":24,"12":24,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":22,"21":0,"22":0,"23":22,"24":22,"25":22,"26":0,"27":24,"28":0,"29":24,"30":1,"31":23,"32":23,"33":2,"34":21,"35":0,"36":21,"37":21,"38":21,"39":21,"40":21,"41":2,"42":1,"43":1,"44":0,"45":1,"46":19,"47":19,"48":19,"49":17,"50":17,"51":8,"52":11,"53":11,"54":11,"55":11,"56":11,"57":1,"58":10,"59":10,"60":10,"61":10,"62":10,"63":10,"64":10,"65":10,"66":10,"67":10,"68":10,"69":8,"70":2,"71":2,"72":0,"73":2,"74":2,"75":2,"76":2,"77":2,"78":0,"79":0,"80":2,"81":2,"82":2,"83":0,"84":2,"85":0,"86":2,"87":2,"88":2,"89":18,"90":18,"91":0,"92":0,"93":2,"94":2,"95":2,"96":2,"97":2,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":19,"105":19,"106":19,"107":1,"108":18,"109":18,"110":18,"111":18,"112":2,"113":2,"114":2,"115":2,"116":0,"117":2,"118":2,"119":0,"120":2,"121":2,"122":2,"123":2,"124":18,"125":1,"126":17,"127":17,"128":7,"129":10,"130":10,"131":10,"132":10,"133":10,"134":10,"135":7,"136":7,"137":5,"138":3,"139":3,"140":2,"141":4,"142":7,"143":6,"144":6,"145":3,"146":2,"147":2,"148":3,"149":4,"150":5,"151":1,"152":1,"153":7,"154":6,"155":13,"156":13,"157":13,"158":13,"159":14,"160":5,"161":9,"162":0,"163":0,"164":9,"165":13,"166":4,"167":4,"168":9,"169":9,"170":9,"171":0,"172":9,"173":9,"174":9,"175":9,"176":4,"177":9,"178":11,"179":11,"180":1,"181":10,"182":10,"183":10,"184":10,"185":0,"186":0,"187":0,"188":0,"189":0,"190":10,"191":10,"192":10,"193":8,"194":8,"195":8,"196":8,"197":8,"198":8,"199":8,"200":0,"201":0,"202":0,"203":0,"204":0,"205":0,"206":8,"207":8,"208":8,"209":0,"210":8,"211":8,"212":8,"213":0,"214":2,"215":2,"216":0,"217":2,"218":2,"219":2,"220":2,"221":2,"222":2,"223":8,"224":8,"225":6,"226":2,"227":2,"228":2,"229":6,"230":8,"231":8,"232":8,"233":8,"234":8,"235":0,"236":2,"237":0,"238":2,"239":0,"240":2,"241":0,"242":2,"243":0,"244":2,"245":0,"246":2,"247":0,"248":24},"f":{"0":24,"1":3,"2":24,"3":0,"4":22,"5":2,"6":19,"7":2,"8":17,"9":7,"10":6,"11":13,"12":9,"13":0,"14":9,"15":11,"16":10,"17":0,"18":10,"19":8,"20":2,"21":2,"22":24},"b":{"0":[0,3],"1":[3,3],"2":[0,0],"3":[0,0],"4":[0,22],"5":[22,0],"6":[0,24],"7":[1,23],"8":[2,21],"9":[0,21],"10":[2,19],"11":[1,1],"12":[0,1],"13":[1,0],"14":[8,0],"15":[11,0],"16":[1,0],"17":[10,0],"18":[10,0],"19":[10,0],"20":[10,0],"21":[8,0],"22":[0,0],"23":[2,0],"24":[2,0],"25":[2,0],"26":[0,2],"27":[2,0,0,0],"28":[0,18],"29":[2,0],"30":[0,0],"31":[1,18],"32":[2,16],"33":[0,2],"34":[0,2],"35":[2,0],"36":[1,17],"37":[17,15],"38":[7,10],"39":[10,7,5],"40":[10,7,5],"41":[7,3],"42":[5,2],"43":[3,2],"44":[6,1],"45":[3,3],"46":[2,1],"47":[1,4],"48":[5,2],"49":[5,9],"50":[0,9],"51":[4,9],"52":[4,5],"53":[9,4],"54":[1,10],"55":[0,10],"56":[0,0],"57":[8,2],"58":[8,0],"59":[8,8],"60":[8,8],"61":[0,8],"62":[0,0],"63":[0,0],"64":[8,0],"65":[0,8],"66":[8,0],"67":[0,2],"68":[2,0],"69":[2,0],"70":[6,2],"71":[8,0],"72":[0,2],"73":[2,2],"74":[0,2],"75":[2,0],"76":[0,2],"77":[2,2],"78":[0,2],"79":[2,2],"80":[0,2],"81":[2,0],"82":[0,2],"83":[2,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/parsers/Response.ts"],"sourcesContent":["import xmldom from '@xmldom/xmldom';\nimport xmlCrypto from 'xml-crypto';\nimport xmlenc from 'xml-encryption';\n\nimport type { ISAMLAssertion } from '../../definition/ISAMLAssertion';\nimport type { IServiceProviderOptions } from '../../definition/IServiceProviderOptions';\nimport type { IResponseValidateCallback } from '../../definition/callbacks';\nimport { SAMLUtils } from '../Utils';\nimport { StatusCode } from '../constants';\n\ntype XmlParent = Element | Document;\n\nexport class ResponseParser {\n\tserviceProviderOptions: IServiceProviderOptions;\n\n\tconstructor(serviceProviderOptions: IServiceProviderOptions) {\n\t\tthis.serviceProviderOptions = serviceProviderOptions;\n\t}\n\n\tpublic validate(xml: string, callback: IResponseValidateCallback): void {\n\t\t// We currently use RelayState to save SAML provider\n\t\tSAMLUtils.log(`Validating response with relay state: ${xml}`);\n\n\t\tlet error: Error | null = null;\n\n\t\tconst doc = new xmldom.DOMParser({\n\t\t\terrorHandler: {\n\t\t\t\tfatalError: (e: any) => {\n\t\t\t\t\tif (e instanceof Error) {\n\t\t\t\t\t\terror = e;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof e === 'string') {\n\t\t\t\t\t\terror = new Error(e);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\terror = new Error();\n\t\t\t\t},\n\t\t\t\terror: (e: Error) => {\n\t\t\t\t\tif (e instanceof Error) {\n\t\t\t\t\t\terror = e;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof e === 'string') {\n\t\t\t\t\t\terror = new Error(e);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\terror = new Error();\n\t\t\t\t},\n\t\t\t},\n\t\t}).parseFromString(xml, 'text/xml');\n\t\tif (!doc) {\n\t\t\treturn callback('No Doc Found');\n\t\t}\n\n\t\tif (error) {\n\t\t\treturn callback(error, null, false);\n\t\t}\n\n\t\tconst allResponses = doc.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:protocol', 'Response');\n\t\tif (allResponses.length === 0) {\n\t\t\treturn this._checkLogoutResponse(doc, callback);\n\t\t}\n\n\t\tif (allResponses.length !== 1) {\n\t\t\treturn callback(new Error('Too many SAML responses'), null, false);\n\t\t}\n\t\tconst response = allResponses[0];\n\t\tSAMLUtils.log('Got response');\n\n\t\tSAMLUtils.log('Verify status');\n\t\tconst statusValidateObj = SAMLUtils.validateStatus(doc);\n\t\tif (!statusValidateObj.success) {\n\t\t\tif (!statusValidateObj.statusCode) {\n\t\t\t\treturn callback(new Error('Missing StatusCode'), null, false);\n\t\t\t}\n\n\t\t\tif (statusValidateObj.statusCode === StatusCode.responder && statusValidateObj.message) {\n\t\t\t\treturn callback(new Error(statusValidateObj.message), null, false);\n\t\t\t}\n\n\t\t\treturn callback(new Error(`Status is: ${statusValidateObj.statusCode}`), null, false);\n\t\t}\n\t\tSAMLUtils.log('Status ok');\n\n\t\tlet assertion: XmlParent;\n\t\tlet assertionData: ISAMLAssertion;\n\t\tlet issuer;\n\n\t\ttry {\n\t\t\tassertionData = this.getAssertion(response, xml);\n\t\t\tassertion = assertionData.assertion;\n\n\t\t\tthis.verifySignatures(response, assertionData, xml);\n\t\t} catch (e) {\n\t\t\treturn callback(e instanceof Error ? e : String(e), null, false);\n\t\t}\n\n\t\tconst profile: Record<string, any> = {};\n\n\t\tif (response.hasAttribute('InResponseTo')) {\n\t\t\tprofile.inResponseToId = response.getAttribute('InResponseTo');\n\t\t}\n\n\t\ttry {\n\t\t\tissuer = this.getIssuer(assertion);\n\t\t} catch (e) {\n\t\t\treturn callback(e instanceof Error ? e : String(e), null, false);\n\t\t}\n\n\t\tif (issuer) {\n\t\t\tprofile.issuer = issuer.textContent;\n\t\t}\n\n\t\tconst subject = this.getSubject(assertion);\n\t\tif (subject) {\n\t\t\tconst nameID = subject.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:assertion', 'NameID')[0];\n\t\t\tif (nameID) {\n\t\t\t\tprofile.nameID = nameID.textContent;\n\n\t\t\t\tif (nameID.hasAttribute('Format')) {\n\t\t\t\t\tprofile.nameIDFormat = nameID.getAttribute('Format');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tthis.validateSubjectConditions(subject);\n\t\t\t} catch (e) {\n\t\t\t\treturn callback(e instanceof Error ? e : String(e), null, false);\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tthis.validateAssertionConditions(assertion);\n\t\t} catch (e) {\n\t\t\treturn callback(e instanceof Error ? e : String(e), null, false);\n\t\t}\n\n\t\tconst authnStatement = assertion.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:assertion', 'AuthnStatement')[0];\n\n\t\tif (authnStatement) {\n\t\t\tif (authnStatement.hasAttribute('SessionIndex')) {\n\t\t\t\tprofile.sessionIndex = authnStatement.getAttribute('SessionIndex');\n\t\t\t\tSAMLUtils.log(`Session Index: ${profile.sessionIndex}`);\n\t\t\t} else {\n\t\t\t\tSAMLUtils.log('No Session Index Found');\n\t\t\t}\n\t\t} else {\n\t\t\tSAMLUtils.log('No AuthN Statement found');\n\t\t}\n\n\t\tconst attributeStatement = assertion.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:assertion', 'AttributeStatement')[0];\n\t\tif (attributeStatement) {\n\t\t\tthis.mapAttributes(attributeStatement, profile);\n\t\t} else {\n\t\t\tSAMLUtils.log('No Attribute Statement found in SAML response.');\n\t\t}\n\n\t\tif (!profile.email && profile.nameID && profile.nameIDFormat && profile.nameIDFormat.indexOf('emailAddress') >= 0) {\n\t\t\tprofile.email = profile.nameID;\n\t\t}\n\n\t\tconst profileKeys = Object.keys(profile);\n\t\tfor (let i = 0; i < profileKeys.length; i++) {\n\t\t\tconst key = profileKeys[i];\n\n\t\t\tif (key.match(/\\./)) {\n\t\t\t\tprofile[key.replace(/\\./g, '-')] = profile[key];\n\t\t\t\tdelete profile[key];\n\t\t\t}\n\t\t}\n\n\t\tSAMLUtils.log({ msg: 'NameID', profile });\n\t\treturn callback(null, profile, false);\n\t}\n\n\tprivate _checkLogoutResponse(doc: Document, callback: IResponseValidateCallback): void {\n\t\tconst logoutResponse = doc.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:protocol', 'LogoutResponse');\n\t\tif (!logoutResponse.length) {\n\t\t\treturn callback(new Error('Unknown SAML response message'), null, false);\n\t\t}\n\n\t\tSAMLUtils.log('Verify status');\n\t\tconst statusValidateObj = SAMLUtils.validateStatus(doc);\n\t\tif (!statusValidateObj.success) {\n\t\t\treturn callback(new Error(`Status is: ${statusValidateObj.statusCode}`), null, false);\n\t\t}\n\t\tSAMLUtils.log('Status ok');\n\n\t\t// @ToDo: Check if this situation is still used\n\t\treturn callback(null, null, true);\n\t}\n\n\tprivate getAssertion(response: Element, xml: string): ISAMLAssertion {\n\t\tconst allAssertions = response.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:assertion', 'Assertion');\n\t\tconst allEncrypedAssertions = response.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:assertion', 'EncryptedAssertion');\n\n\t\tif (allAssertions.length + allEncrypedAssertions.length > 1) {\n\t\t\tthrow new Error('Too many SAML assertions');\n\t\t}\n\n\t\tlet assertion: XmlParent = allAssertions[0];\n\t\tconst encAssertion = allEncrypedAssertions[0];\n\t\tlet newXml = null;\n\n\t\tif (typeof encAssertion !== 'undefined') {\n\t\t\tconst options = { key: this.serviceProviderOptions.privateKey };\n\t\t\tconst encData = encAssertion.getElementsByTagNameNS('*', 'EncryptedData')[0];\n\t\t\txmlenc.decrypt(encData, options, (err, result) => {\n\t\t\t\tif (err) {\n\t\t\t\t\tSAMLUtils.error(err);\n\t\t\t\t}\n\n\t\t\t\tconst document = new xmldom.DOMParser().parseFromString(result, 'text/xml');\n\t\t\t\tif (!document) {\n\t\t\t\t\tthrow new Error('Failed to decrypt SAML assertion');\n\t\t\t\t}\n\n\t\t\t\tconst decryptedAssertions = document.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:assertion', 'Assertion');\n\t\t\t\tif (decryptedAssertions.length) {\n\t\t\t\t\tassertion = decryptedAssertions[0];\n\t\t\t\t}\n\n\t\t\t\tnewXml = result;\n\t\t\t});\n\t\t}\n\n\t\tif (!assertion) {\n\t\t\tthrow new Error('Missing SAML assertion');\n\t\t}\n\n\t\treturn {\n\t\t\tassertion,\n\t\t\txml: newXml || xml,\n\t\t};\n\t}\n\n\tprivate verifySignatures(response: Element, assertionData: ISAMLAssertion, xml: string): void {\n\t\tif (!this.serviceProviderOptions.cert) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst signatureType = this.serviceProviderOptions.signatureValidationType;\n\n\t\tconst checkEither = signatureType === 'Either';\n\t\tconst checkResponse = signatureType === 'Response' || signatureType === 'All' || checkEither;\n\t\tconst checkAssertion = signatureType === 'Assertion' || signatureType === 'All' || checkEither;\n\t\tlet anyValidSignature = false;\n\n\t\tif (checkResponse) {\n\t\t\tSAMLUtils.log('Verify Document Signature');\n\t\t\tif (!this.validateResponseSignature(xml, this.serviceProviderOptions.cert, response)) {\n\t\t\t\tif (!checkEither) {\n\t\t\t\t\tSAMLUtils.log('Document Signature WRONG');\n\t\t\t\t\tthrow new Error('Invalid Signature');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tanyValidSignature = true;\n\t\t\t}\n\t\t\tSAMLUtils.log('Document Signature OK');\n\t\t}\n\n\t\tif (checkAssertion) {\n\t\t\tSAMLUtils.log('Verify Assertion Signature');\n\t\t\tif (!this.validateAssertionSignature(assertionData.xml, this.serviceProviderOptions.cert, assertionData.assertion)) {\n\t\t\t\tif (!checkEither) {\n\t\t\t\t\tSAMLUtils.log('Assertion Signature WRONG');\n\t\t\t\t\tthrow new Error('Invalid Assertion signature');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tanyValidSignature = true;\n\t\t\t}\n\t\t\tSAMLUtils.log('Assertion Signature OK');\n\t\t}\n\n\t\tif (checkEither && !anyValidSignature) {\n\t\t\tSAMLUtils.log('No Valid Signature');\n\t\t\tthrow new Error('No valid SAML Signature found');\n\t\t}\n\t}\n\n\tprivate validateResponseSignature(xml: string, cert: string, response: Element): boolean {\n\t\treturn this.validateSignatureChildren(xml, cert, response);\n\t}\n\n\tprivate validateAssertionSignature(xml: string, cert: string, assertion: XmlParent): boolean {\n\t\treturn this.validateSignatureChildren(xml, cert, assertion);\n\t}\n\n\tprivate validateSignatureChildren(xml: string, cert: string, parent: XmlParent): boolean {\n\t\tconst xpathSigQuery = \".//*[local-name(.)='Signature' and namespace-uri(.)='http://www.w3.org/2000/09/xmldsig#']\";\n\t\tconst signatures = xmlCrypto.xpath(parent, xpathSigQuery) as Array<Element>;\n\t\tlet signature = null;\n\n\t\tfor (const sign of signatures) {\n\t\t\tif (sign.parentNode !== parent) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Too many signatures\n\t\t\tif (signature) {\n\t\t\t\tSAMLUtils.log('Failed to validate SAML signature: Too Many Signatures');\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tsignature = sign;\n\t\t}\n\n\t\tif (!signature) {\n\t\t\tSAMLUtils.log('Failed to validate SAML signature: Signature not found');\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.validateSignature(xml, cert, signature);\n\t}\n\n\tprivate validateSignature(xml: string, cert: string, signature: Element): any {\n\t\tconst sig = new xmlCrypto.SignedXml();\n\n\t\tsig.keyInfoProvider = {\n\t\t\tgetKeyInfo: () => '<X509Data></X509Data>',\n\t\t\tgetKey: () => Buffer.from(SAMLUtils.certToPEM(cert)),\n\t\t};\n\n\t\tsig.loadSignature(signature);\n\n\t\tconst result = sig.checkSignature(xml);\n\t\tif (!result && sig.validationErrors) {\n\t\t\tSAMLUtils.log(sig.validationErrors);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate getIssuer(assertion: XmlParent): any {\n\t\tconst issuers = assertion.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:assertion', 'Issuer');\n\t\tif (issuers.length > 1) {\n\t\t\tthrow new Error('Too many Issuers');\n\t\t}\n\n\t\treturn issuers[0];\n\t}\n\n\tprivate getSubject(assertion: XmlParent): XmlParent {\n\t\tlet subject: XmlParent = assertion.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:assertion', 'Subject')[0];\n\t\tconst encSubject = assertion.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:assertion', 'EncryptedID')[0];\n\n\t\tif (typeof encSubject !== 'undefined') {\n\t\t\tconst options = { key: this.serviceProviderOptions.privateKey };\n\t\t\txmlenc.decrypt(encSubject.getElementsByTagNameNS('*', 'EncryptedData')[0], options, (err, result) => {\n\t\t\t\tif (err) {\n\t\t\t\t\tSAMLUtils.error(err);\n\t\t\t\t}\n\t\t\t\tsubject = new xmldom.DOMParser().parseFromString(result, 'text/xml');\n\t\t\t});\n\t\t}\n\n\t\treturn subject;\n\t}\n\n\tprivate validateSubjectConditions(subject: XmlParent): void {\n\t\tconst subjectConfirmation = subject.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:assertion', 'SubjectConfirmation')[0];\n\t\tif (subjectConfirmation) {\n\t\t\tconst subjectConfirmationData = subjectConfirmation.getElementsByTagNameNS(\n\t\t\t\t'urn:oasis:names:tc:SAML:2.0:assertion',\n\t\t\t\t'SubjectConfirmationData',\n\t\t\t)[0];\n\t\t\tif (subjectConfirmationData && !this.validateNotBeforeNotOnOrAfterAssertions(subjectConfirmationData)) {\n\t\t\t\tthrow new Error('NotBefore / NotOnOrAfter assertion failed');\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate validateNotBeforeNotOnOrAfterAssertions(element: Element): boolean {\n\t\tconst sysnow = new Date();\n\t\tconst allowedclockdrift = this.serviceProviderOptions.allowedClockDrift || 0;\n\n\t\tconst now = new Date(sysnow.getTime() + allowedclockdrift);\n\n\t\tif (element.hasAttribute('NotBefore')) {\n\t\t\tconst notBefore: string | null = element.getAttribute('NotBefore');\n\n\t\t\tif (!notBefore) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst date = new Date(notBefore);\n\t\t\tif (now < date) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (element.hasAttribute('NotOnOrAfter')) {\n\t\t\tconst notOnOrAfter: string | null = element.getAttribute('NotOnOrAfter');\n\t\t\tif (!notOnOrAfter) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst date = new Date(notOnOrAfter);\n\n\t\t\tif (now >= date) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate validateAssertionConditions(assertion: XmlParent): void {\n\t\tconst conditions = assertion.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:assertion', 'Conditions')[0];\n\t\tif (conditions && !this.validateNotBeforeNotOnOrAfterAssertions(conditions)) {\n\t\t\tthrow new Error('NotBefore / NotOnOrAfter assertion failed');\n\t\t}\n\t}\n\n\tprivate mapAttributes(attributeStatement: Element, profile: Record<string, any>): void {\n\t\tSAMLUtils.log(`Attribute Statement found in SAML response: ${attributeStatement}`);\n\t\tconst attributes = attributeStatement.getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:assertion', 'Attribute');\n\t\tSAMLUtils.log(`Attributes will be processed: ${attributes.length}`);\n\n\t\tif (attributes) {\n\t\t\tfor (let i = 0; i < attributes.length; i++) {\n\t\t\t\tconst values = attributes[i].getElementsByTagNameNS('urn:oasis:names:tc:SAML:2.0:assertion', 'AttributeValue');\n\t\t\t\tlet value;\n\t\t\t\tif (values.length === 1) {\n\t\t\t\t\tvalue = values[0].textContent;\n\t\t\t\t} else {\n\t\t\t\t\tvalue = [];\n\t\t\t\t\tfor (let j = 0; j < values.length; j++) {\n\t\t\t\t\t\tvalue.push(values[j].textContent);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst key = attributes[i].getAttribute('Name');\n\t\t\t\tif (key) {\n\t\t\t\t\tSAMLUtils.log(`Attribute:  ${attributes[i]} has ${values.length} value(s).`);\n\t\t\t\t\tSAMLUtils.log(`Adding attribute from SAML response to profile: ${key} = ${value}`);\n\t\t\t\t\tprofile[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tSAMLUtils.log('No Attributes found in SAML attribute statement.');\n\t\t}\n\n\t\tif (!profile.mail && profile['urn:oid:0.9.2342.19200300.100.1.3']) {\n\t\t\t// See http://www.incommonfederation.org/attributesummary.html for definition of attribute OIDs\n\t\t\tprofile.mail = profile['urn:oid:0.9.2342.19200300.100.1.3'];\n\t\t}\n\n\t\tif (!profile.email && profile['urn:oid:1.2.840.113549.1.9.1']) {\n\t\t\tprofile.email = profile['urn:oid:1.2.840.113549.1.9.1'];\n\t\t}\n\n\t\tif (!profile.displayName && profile['urn:oid:2.16.840.1.113730.3.1.241']) {\n\t\t\tprofile.displayName = profile['urn:oid:2.16.840.1.113730.3.1.241'];\n\t\t}\n\n\t\tif (!profile.eppn && profile['urn:oid:1.3.6.1.4.1.5923.1.1.1.6']) {\n\t\t\tprofile.eppn = profile['urn:oid:1.3.6.1.4.1.5923.1.1.1.6'];\n\t\t}\n\n\t\tif (!profile.email && profile.mail) {\n\t\t\tprofile.email = profile.mail;\n\t\t}\n\n\t\tif (!profile.cn && profile['urn:oid:2.5.4.3']) {\n\t\t\tprofile.cn = profile['urn:oid:2.5.4.3'];\n\t\t}\n\t}\n}\n"],"names":["ResponseParser","validate","xml","callback","SAMLUtils","log","error","doc","xmldom","DOMParser","errorHandler","fatalError","e","Error","parseFromString","allResponses","getElementsByTagNameNS","length","_checkLogoutResponse","response","statusValidateObj","validateStatus","success","statusCode","StatusCode","responder","message","assertion","assertionData","issuer","getAssertion","verifySignatures","String","profile","hasAttribute","inResponseToId","getAttribute","getIssuer","textContent","subject","getSubject","nameID","nameIDFormat","validateSubjectConditions","validateAssertionConditions","authnStatement","sessionIndex","attributeStatement","mapAttributes","email","indexOf","profileKeys","Object","keys","i","key","match","replace","msg","logoutResponse","allAssertions","allEncrypedAssertions","encAssertion","newXml","options","serviceProviderOptions","privateKey","encData","xmlenc","decrypt","err","result","document","decryptedAssertions","cert","signatureType","signatureValidationType","checkEither","checkResponse","checkAssertion","anyValidSignature","validateResponseSignature","validateAssertionSignature","validateSignatureChildren","parent","xpathSigQuery","signatures","xmlCrypto","xpath","signature","sign","parentNode","validateSignature","sig","SignedXml","keyInfoProvider","getKeyInfo","getKey","Buffer","from","certToPEM","loadSignature","checkSignature","validationErrors","issuers","encSubject","subjectConfirmation","subjectConfirmationData","validateNotBeforeNotOnOrAfterAssertions","element","sysnow","Date","allowedclockdrift","allowedClockDrift","now","getTime","notBefore","date","notOnOrAfter","conditions","attributes","values","value","j","push","mail","displayName","eppn","cn","constructor"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/parsers/Response.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"fc6565cdc47cae00b732cc16bca43780654cbc40","contentHash":"9b4a6985b984f2a693edb740aa6b95fbdc19076bc7868f4bb3eee49127b57f66"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/isTruthy.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/isTruthy.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":24}},"3":{"start":{"line":11,"column":17},"end":{"line":11,"column":32}},"4":{"start":{"line":11,"column":22},"end":{"line":11,"column":32}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":17},"end":{"line":11,"column":18}},"loc":{"start":{"line":11,"column":22},"end":{"line":11,"column":32}},"line":11}},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1},"f":{"0":1,"1":1},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/isTruthy.ts"],"sourcesContent":["export const isTruthy = <T>(x: T | null | undefined | 0 | false | ''): x is T => Boolean(x);\n"],"names":["isTruthy","x","Boolean"],"mappings":";;;;+BAAaA;;;eAAAA;;;AAAN,MAAMA,WAAW,CAAIC,IAAqDC,QAAQD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/isTruthy.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"600cd91af83af089485ee8df337fa7da08e0b123","contentHash":"44563a7300a1668583470b256b24315add26a9343f787b2ff87ca3355e6ad9cd"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/ServiceProviderMetadata.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/ServiceProviderMetadata.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":39}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":40}},"4":{"start":{"line":12,"column":15},"end":{"line":12,"column":34}},"5":{"start":{"line":13,"column":19},"end":{"line":13,"column":42}},"6":{"start":{"line":14,"column":30},"end":{"line":47,"column":1}},"7":{"start":{"line":16,"column":21},"end":{"line":16,"column":57}},"8":{"start":{"line":17,"column":8},"end":{"line":17,"column":102}},"9":{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},"10":{"start":{"line":21,"column":12},"end":{"line":21,"column":22}},"11":{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},"12":{"start":{"line":24,"column":12},"end":{"line":24,"column":109}},"13":{"start":{"line":26,"column":8},"end":{"line":26,"column":115}},"14":{"start":{"line":29,"column":21},"end":{"line":31,"column":9}},"15":{"start":{"line":32,"column":25},"end":{"line":32,"column":102}},"16":{"start":{"line":33,"column":8},"end":{"line":33,"column":65}},"17":{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},"18":{"start":{"line":37,"column":12},"end":{"line":37,"column":111}},"19":{"start":{"line":39,"column":8},"end":{"line":45,"column":10}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":44},"end":{"line":18,"column":5}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":19,"column":4},"end":{"line":19,"column":5}},"loc":{"start":{"line":19,"column":58},"end":{"line":27,"column":5}},"line":19},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":4},"end":{"line":28,"column":5}},"loc":{"start":{"line":28,"column":52},"end":{"line":34,"column":5}},"line":28},"4":{"name":"(anonymous_4)","decl":{"start":{"line":35,"column":4},"end":{"line":35,"column":5}},"loc":{"start":{"line":35,"column":43},"end":{"line":46,"column":5}},"line":35}},"branchMap":{"0":{"loc":{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},"type":"if","locations":[{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},{"start":{"line":20,"column":8},"end":{"line":22,"column":9}}],"line":20},"1":{"loc":{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},"type":"if","locations":[{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},{"start":{"line":23,"column":8},"end":{"line":25,"column":9}}],"line":23},"2":{"loc":{"start":{"line":26,"column":15},"end":{"line":26,"column":114}},"type":"binary-expr","locations":[{"start":{"line":26,"column":15},"end":{"line":26,"column":65}},{"start":{"line":26,"column":69},"end":{"line":26,"column":114}}],"line":26},"3":{"loc":{"start":{"line":32,"column":25},"end":{"line":32,"column":102}},"type":"binary-expr","locations":[{"start":{"line":32,"column":25},"end":{"line":32,"column":64}},{"start":{"line":32,"column":68},"end":{"line":32,"column":102}}],"line":32},"4":{"loc":{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},"type":"if","locations":[{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},{"start":{"line":36,"column":8},"end":{"line":38,"column":9}}],"line":36},"5":{"loc":{"start":{"line":42,"column":30},"end":{"line":42,"column":107}},"type":"binary-expr","locations":[{"start":{"line":42,"column":30},"end":{"line":42,"column":69}},{"start":{"line":42,"column":73},"end":{"line":42,"column":107}}],"line":42}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":2,"9":2,"10":1,"11":1,"12":0,"13":1,"14":2,"15":2,"16":2,"17":2,"18":0,"19":2},"f":{"0":1,"1":2,"2":2,"3":2,"4":2},"b":{"0":[1,1],"1":[0,1],"2":[1,1],"3":[2,2],"4":[0,2],"5":[2,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/ServiceProviderMetadata.ts"],"sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport type { IMetadataVariables } from '../../definition/IMetadataVariables';\nimport type { IServiceProviderOptions } from '../../definition/IServiceProviderOptions';\nimport { SAMLUtils } from '../Utils';\nimport { defaultIdentifierFormat, defaultMetadataCertificateTemplate, defaultMetadataTemplate } from '../constants';\n\n/*\n\tThe metadata will be available at the following url:\n\t[rocketchat-url]/_saml/metadata/[provider-name]\n*/\n\nexport class ServiceProviderMetadata {\n\tpublic static generate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tconst data = this.getData(serviceProviderOptions);\n\t\treturn SAMLUtils.fillTemplateData(this.metadataTemplate(serviceProviderOptions), data);\n\t}\n\n\tprivate static certificateTagTemplate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tif (!serviceProviderOptions.privateKey) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (!serviceProviderOptions.privateCert) {\n\t\t\tthrow new Error('Missing certificate while generating metadata for decrypting service provider');\n\t\t}\n\n\t\treturn serviceProviderOptions.metadataCertificateTemplate || defaultMetadataCertificateTemplate;\n\t}\n\n\tprivate static metadataTemplate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tconst data = {\n\t\t\tcertificateTag: this.certificateTagTemplate(serviceProviderOptions),\n\t\t};\n\n\t\tconst template = serviceProviderOptions.metadataTemplate || defaultMetadataTemplate;\n\t\treturn SAMLUtils.fillTemplateData(template, data);\n\t}\n\n\tprivate static getData(serviceProviderOptions: IServiceProviderOptions): IMetadataVariables {\n\t\tif (!serviceProviderOptions.callbackUrl) {\n\t\t\tthrow new Error('Unable to generate service provider metadata when callbackUrl option is not set');\n\t\t}\n\n\t\treturn {\n\t\t\tissuer: serviceProviderOptions.issuer,\n\t\t\tcertificate: SAMLUtils.normalizeCert(serviceProviderOptions.privateCert),\n\t\t\tidentifierFormat: serviceProviderOptions.identifierFormat || defaultIdentifierFormat,\n\t\t\tcallbackUrl: serviceProviderOptions.callbackUrl,\n\t\t\tsloLocation: `${Meteor.absoluteUrl()}_saml/logout/${serviceProviderOptions.provider}/`,\n\t\t};\n\t}\n}\n"],"names":["ServiceProviderMetadata","generate","serviceProviderOptions","data","getData","SAMLUtils","fillTemplateData","metadataTemplate","certificateTagTemplate","privateKey","privateCert","Error","metadataCertificateTemplate","defaultMetadataCertificateTemplate","certificateTag","template","defaultMetadataTemplate","callbackUrl","issuer","certificate","normalizeCert","identifierFormat","defaultIdentifierFormat","sloLocation","Meteor","absoluteUrl","provider"],"mappings":";;;;+BAYaA;;;eAAAA;;;wBAZU;uBAIG;2BAC2E;AAO9F,IAAA,AAAMA,0BAAN,MAAMA;IACZ,OAAcC,SAASC,sBAA+C,EAAU;QAC/E,MAAMC,OAAO,IAAI,CAACC,OAAO,CAACF;QAC1B,OAAOG,gBAAS,CAACC,gBAAgB,CAAC,IAAI,CAACC,gBAAgB,CAACL,yBAAyBC;IAClF;IAEA,OAAeK,uBAAuBN,sBAA+C,EAAU;QAC9F,IAAI,CAACA,uBAAuBO,UAAU,EAAE;YACvC,OAAO;QACR;QAEA,IAAI,CAACP,uBAAuBQ,WAAW,EAAE;YACxC,MAAM,IAAIC,MAAM;QACjB;QAEA,OAAOT,uBAAuBU,2BAA2B,IAAIC,6CAAkC;IAChG;IAEA,OAAeN,iBAAiBL,sBAA+C,EAAU;QACxF,MAAMC,OAAO;YACZW,gBAAgB,IAAI,CAACN,sBAAsB,CAACN;QAC7C;QAEA,MAAMa,WAAWb,uBAAuBK,gBAAgB,IAAIS,kCAAuB;QACnF,OAAOX,gBAAS,CAACC,gBAAgB,CAACS,UAAUZ;IAC7C;IAEA,OAAeC,QAAQF,sBAA+C,EAAsB;QAC3F,IAAI,CAACA,uBAAuBe,WAAW,EAAE;YACxC,MAAM,IAAIN,MAAM;QACjB;QAEA,OAAO;YACNO,QAAQhB,uBAAuBgB,MAAM;YACrCC,aAAad,gBAAS,CAACe,aAAa,CAAClB,uBAAuBQ,WAAW;YACvEW,kBAAkBnB,uBAAuBmB,gBAAgB,IAAIC,kCAAuB;YACpFL,aAAaf,uBAAuBe,WAAW;YAC/CM,aAAa,GAAGC,cAAM,CAACC,WAAW,GAAG,aAAa,EAAEvB,uBAAuBwB,QAAQ,CAAC,CAAC,CAAC;QACvF;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/ServiceProviderMetadata.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6742ff4b7052d1530d92dd93f19fadb91e0d4c87","contentHash":"a9d87f75ce56639261411a47df2cc7a17ad0c16828088b8fd72f47938e4b01b4"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/SettingsRegistry.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/SettingsRegistry.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":21,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":30}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":32}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":31}},"7":{"start":{"line":22,"column":21},"end":{"line":22,"column":57}},"8":{"start":{"line":23,"column":17},"end":{"line":23,"column":48}},"9":{"start":{"line":24,"column":20},"end":{"line":24,"column":41}},"10":{"start":{"line":25,"column":16},"end":{"line":25,"column":60}},"11":{"start":{"line":26,"column":28},"end":{"line":26,"column":69}},"12":{"start":{"line":27,"column":25},"end":{"line":27,"column":63}},"13":{"start":{"line":28,"column":26},"end":{"line":28,"column":65}},"14":{"start":{"line":29,"column":25},"end":{"line":29,"column":63}},"15":{"start":{"line":30,"column":24},"end":{"line":30,"column":33}},"16":{"start":{"line":31,"column":23},"end":{"line":31,"column":32}},"17":{"start":{"line":32,"column":31},"end":{"line":32,"column":40}},"18":{"start":{"line":33,"column":0},"end":{"line":35,"column":1}},"19":{"start":{"line":34,"column":4},"end":{"line":34,"column":104}},"20":{"start":{"line":34,"column":65},"end":{"line":34,"column":102}},"21":{"start":{"line":36,"column":0},"end":{"line":38,"column":1}},"22":{"start":{"line":37,"column":4},"end":{"line":37,"column":102}},"23":{"start":{"line":37,"column":64},"end":{"line":37,"column":100}},"24":{"start":{"line":39,"column":0},"end":{"line":41,"column":1}},"25":{"start":{"line":40,"column":4},"end":{"line":40,"column":122}},"26":{"start":{"line":40,"column":76},"end":{"line":40,"column":120}},"27":{"start":{"line":42,"column":23},"end":{"line":42,"column":61}},"28":{"start":{"line":43,"column":23},"end":{"line":43,"column":45}},"29":{"start":{"line":44,"column":25},"end":{"line":56,"column":6}},"30":{"start":{"line":44,"column":47},"end":{"line":56,"column":5}},"31":{"start":{"line":57,"column":36},"end":{"line":62,"column":99}},"32":{"start":{"line":57,"column":44},"end":{"line":62,"column":99}},"33":{"start":{"line":57,"column":52},"end":{"line":62,"column":99}},"34":{"start":{"line":62,"column":24},"end":{"line":62,"column":43}},"35":{"start":{"line":62,"column":58},"end":{"line":62,"column":98}},"36":{"start":{"line":63,"column":24},"end":{"line":71,"column":2}},"37":{"start":{"line":72,"column":23},"end":{"line":240,"column":1}},"38":{"start":{"line":76,"column":8},"end":{"line":78,"column":9}},"39":{"start":{"line":77,"column":12},"end":{"line":77,"column":49}},"40":{"start":{"line":79,"column":26},"end":{"line":79,"column":74}},"41":{"start":{"line":80,"column":8},"end":{"line":86,"column":9}},"42":{"start":{"line":81,"column":12},"end":{"line":85,"column":13}},"43":{"start":{"line":83,"column":42},"end":{"line":83,"column":154}},"44":{"start":{"line":84,"column":16},"end":{"line":84,"column":67}},"45":{"start":{"line":87,"column":8},"end":{"line":90,"column":9}},"46":{"start":{"line":89,"column":12},"end":{"line":89,"column":168}},"47":{"start":{"line":91,"column":32},"end":{"line":99,"column":67}},"48":{"start":{"line":100,"column":8},"end":{"line":103,"column":9}},"49":{"start":{"line":101,"column":12},"end":{"line":101,"column":103}},"50":{"start":{"line":102,"column":12},"end":{"line":102,"column":92}},"51":{"start":{"line":104,"column":43},"end":{"line":104,"column":99}},"52":{"start":{"line":105,"column":30},"end":{"line":105,"column":56}},"53":{"start":{"line":106,"column":41},"end":{"line":106,"column":112}},"54":{"start":{"line":107,"column":8},"end":{"line":111,"column":9}},"55":{"start":{"line":108,"column":12},"end":{"line":108,"column":116}},"56":{"start":{"line":110,"column":12},"end":{"line":110,"column":102}},"57":{"start":{"line":112,"column":30},"end":{"line":112,"column":139}},"58":{"start":{"line":113,"column":44},"end":{"line":113,"column":70}},"59":{"start":{"line":114,"column":8},"end":{"line":133,"column":9}},"60":{"start":{"line":115,"column":66},"end":{"line":115,"column":92}},"61":{"start":{"line":116,"column":36},"end":{"line":116,"column":75}},"62":{"start":{"line":117,"column":32},"end":{"line":119,"column":66}},"63":{"start":{"line":117,"column":73},"end":{"line":119,"column":65}},"64":{"start":{"line":120,"column":33},"end":{"line":127,"column":16}},"65":{"start":{"line":121,"column":16},"end":{"line":126,"column":18}},"66":{"start":{"line":128,"column":12},"end":{"line":128,"column":74}},"67":{"start":{"line":129,"column":12},"end":{"line":131,"column":13}},"68":{"start":{"line":130,"column":16},"end":{"line":130,"column":45}},"69":{"start":{"line":132,"column":12},"end":{"line":132,"column":19}},"70":{"start":{"line":134,"column":8},"end":{"line":144,"column":9}},"71":{"start":{"line":135,"column":12},"end":{"line":142,"column":13}},"72":{"start":{"line":136,"column":40},"end":{"line":136,"column":79}},"73":{"start":{"line":137,"column":36},"end":{"line":139,"column":70}},"74":{"start":{"line":137,"column":77},"end":{"line":139,"column":69}},"75":{"start":{"line":140,"column":16},"end":{"line":140,"column":78}},"76":{"start":{"line":141,"column":16},"end":{"line":141,"column":59}},"77":{"start":{"line":143,"column":12},"end":{"line":143,"column":19}},"78":{"start":{"line":145,"column":8},"end":{"line":152,"column":9}},"79":{"start":{"line":146,"column":12},"end":{"line":150,"column":13}},"80":{"start":{"line":147,"column":16},"end":{"line":147,"column":180}},"81":{"start":{"line":149,"column":16},"end":{"line":149,"column":108}},"82":{"start":{"line":151,"column":12},"end":{"line":151,"column":19}},"83":{"start":{"line":153,"column":42},"end":{"line":153,"column":96}},"84":{"start":{"line":154,"column":24},"end":{"line":154,"column":94}},"85":{"start":{"line":155,"column":8},"end":{"line":155,"column":44}},"86":{"start":{"line":156,"column":8},"end":{"line":156,"column":32}},"87":{"start":{"line":160,"column":8},"end":{"line":162,"column":9}},"88":{"start":{"line":161,"column":12},"end":{"line":161,"column":49}},"89":{"start":{"line":163,"column":25},"end":{"line":163,"column":77}},"90":{"start":{"line":164,"column":24},"end":{"line":169,"column":10}},"91":{"start":{"line":170,"column":8},"end":{"line":174,"column":9}},"92":{"start":{"line":171,"column":12},"end":{"line":171,"column":36}},"93":{"start":{"line":172,"column":12},"end":{"line":172,"column":48}},"94":{"start":{"line":173,"column":12},"end":{"line":173,"column":36}},"95":{"start":{"line":175,"column":8},"end":{"line":177,"column":9}},"96":{"start":{"line":176,"column":12},"end":{"line":176,"column":19}},"97":{"start":{"line":178,"column":24},"end":{"line":184,"column":13}},"98":{"start":{"line":178,"column":34},"end":{"line":184,"column":13}},"99":{"start":{"line":179,"column":38},"end":{"line":182,"column":17}},"100":{"start":{"line":183,"column":16},"end":{"line":183,"column":58}},"101":{"start":{"line":185,"column":31},"end":{"line":194,"column":13}},"102":{"start":{"line":185,"column":41},"end":{"line":194,"column":13}},"103":{"start":{"line":186,"column":38},"end":{"line":189,"column":17}},"104":{"start":{"line":190,"column":16},"end":{"line":193,"column":19}},"105":{"start":{"line":195,"column":28},"end":{"line":204,"column":13}},"106":{"start":{"line":195,"column":38},"end":{"line":204,"column":13}},"107":{"start":{"line":196,"column":38},"end":{"line":199,"column":17}},"108":{"start":{"line":200,"column":16},"end":{"line":203,"column":19}},"109":{"start":{"line":205,"column":29},"end":{"line":215,"column":13}},"110":{"start":{"line":205,"column":39},"end":{"line":215,"column":13}},"111":{"start":{"line":206,"column":38},"end":{"line":209,"column":17}},"112":{"start":{"line":210,"column":16},"end":{"line":214,"column":19}},"113":{"start":{"line":216,"column":8},"end":{"line":218,"column":25}},"114":{"start":{"line":221,"column":8},"end":{"line":233,"column":11}},"115":{"start":{"line":226,"column":58},"end":{"line":229,"column":21}},"116":{"start":{"line":236,"column":8},"end":{"line":236,"column":26}},"117":{"start":{"line":237,"column":8},"end":{"line":237,"column":27}},"118":{"start":{"line":238,"column":8},"end":{"line":238,"column":27}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":20},"end":{"line":12,"column":21}},"loc":{"start":{"line":12,"column":31},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":22},"end":{"line":15,"column":23}},"loc":{"start":{"line":15,"column":33},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":21},"end":{"line":18,"column":22}},"loc":{"start":{"line":18,"column":32},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":34,"column":52},"end":{"line":34,"column":53}},"loc":{"start":{"line":34,"column":65},"end":{"line":34,"column":102}},"line":34},"5":{"name":"(anonymous_5)","decl":{"start":{"line":37,"column":51},"end":{"line":37,"column":52}},"loc":{"start":{"line":37,"column":64},"end":{"line":37,"column":100}},"line":37},"6":{"name":"(anonymous_6)","decl":{"start":{"line":40,"column":63},"end":{"line":40,"column":64}},"loc":{"start":{"line":40,"column":76},"end":{"line":40,"column":120}},"line":40},"7":{"name":"(anonymous_7)","decl":{"start":{"line":44,"column":25},"end":{"line":44,"column":26}},"loc":{"start":{"line":44,"column":47},"end":{"line":56,"column":5}},"line":44},"8":{"name":"(anonymous_8)","decl":{"start":{"line":57,"column":36},"end":{"line":57,"column":37}},"loc":{"start":{"line":57,"column":44},"end":{"line":62,"column":99}},"line":57},"9":{"name":"(anonymous_9)","decl":{"start":{"line":57,"column":44},"end":{"line":57,"column":45}},"loc":{"start":{"line":57,"column":52},"end":{"line":62,"column":99}},"line":57},"10":{"name":"(anonymous_10)","decl":{"start":{"line":62,"column":17},"end":{"line":62,"column":18}},"loc":{"start":{"line":62,"column":24},"end":{"line":62,"column":43}},"line":62},"11":{"name":"(anonymous_11)","decl":{"start":{"line":62,"column":51},"end":{"line":62,"column":52}},"loc":{"start":{"line":62,"column":58},"end":{"line":62,"column":98}},"line":62},"12":{"name":"(anonymous_12)","decl":{"start":{"line":75,"column":5},"end":{"line":75,"column":6}},"loc":{"start":{"line":75,"column":72},"end":{"line":157,"column":5}},"line":75},"13":{"name":"(anonymous_13)","decl":{"start":{"line":117,"column":66},"end":{"line":117,"column":67}},"loc":{"start":{"line":117,"column":73},"end":{"line":119,"column":65}},"line":117},"14":{"name":"(anonymous_14)","decl":{"start":{"line":120,"column":34},"end":{"line":120,"column":35}},"loc":{"start":{"line":120,"column":38},"end":{"line":127,"column":13}},"line":120},"15":{"name":"(anonymous_15)","decl":{"start":{"line":137,"column":70},"end":{"line":137,"column":71}},"loc":{"start":{"line":137,"column":77},"end":{"line":139,"column":69}},"line":137},"16":{"name":"(anonymous_16)","decl":{"start":{"line":159,"column":4},"end":{"line":159,"column":5}},"loc":{"start":{"line":159,"column":47},"end":{"line":219,"column":5}},"line":159},"17":{"name":"(anonymous_17)","decl":{"start":{"line":178,"column":24},"end":{"line":178,"column":25}},"loc":{"start":{"line":178,"column":34},"end":{"line":184,"column":13}},"line":178},"18":{"name":"(anonymous_18)","decl":{"start":{"line":178,"column":34},"end":{"line":178,"column":35}},"loc":{"start":{"line":178,"column":61},"end":{"line":184,"column":13}},"line":178},"19":{"name":"(anonymous_19)","decl":{"start":{"line":185,"column":31},"end":{"line":185,"column":32}},"loc":{"start":{"line":185,"column":41},"end":{"line":194,"column":13}},"line":185},"20":{"name":"(anonymous_20)","decl":{"start":{"line":185,"column":41},"end":{"line":185,"column":42}},"loc":{"start":{"line":185,"column":56},"end":{"line":194,"column":13}},"line":185},"21":{"name":"(anonymous_21)","decl":{"start":{"line":195,"column":28},"end":{"line":195,"column":29}},"loc":{"start":{"line":195,"column":38},"end":{"line":204,"column":13}},"line":195},"22":{"name":"(anonymous_22)","decl":{"start":{"line":195,"column":38},"end":{"line":195,"column":39}},"loc":{"start":{"line":195,"column":53},"end":{"line":204,"column":13}},"line":195},"23":{"name":"(anonymous_23)","decl":{"start":{"line":205,"column":29},"end":{"line":205,"column":30}},"loc":{"start":{"line":205,"column":39},"end":{"line":215,"column":13}},"line":205},"24":{"name":"(anonymous_24)","decl":{"start":{"line":205,"column":39},"end":{"line":205,"column":40}},"loc":{"start":{"line":205,"column":54},"end":{"line":215,"column":13}},"line":205},"25":{"name":"(anonymous_25)","decl":{"start":{"line":220,"column":4},"end":{"line":220,"column":5}},"loc":{"start":{"line":220,"column":61},"end":{"line":234,"column":5}},"line":220},"26":{"name":"(anonymous_26)","decl":{"start":{"line":226,"column":43},"end":{"line":226,"column":44}},"loc":{"start":{"line":226,"column":58},"end":{"line":229,"column":21}},"line":226},"27":{"name":"(anonymous_27)","decl":{"start":{"line":235,"column":4},"end":{"line":235,"column":5}},"loc":{"start":{"line":235,"column":33},"end":{"line":239,"column":5}},"line":235}},"branchMap":{"0":{"loc":{"start":{"line":33,"column":0},"end":{"line":35,"column":1}},"type":"if","locations":[{"start":{"line":33,"column":0},"end":{"line":35,"column":1}},{"start":{"line":33,"column":0},"end":{"line":35,"column":1}}],"line":33},"1":{"loc":{"start":{"line":36,"column":0},"end":{"line":38,"column":1}},"type":"if","locations":[{"start":{"line":36,"column":0},"end":{"line":38,"column":1}},{"start":{"line":36,"column":0},"end":{"line":38,"column":1}}],"line":36},"2":{"loc":{"start":{"line":39,"column":0},"end":{"line":41,"column":1}},"type":"if","locations":[{"start":{"line":39,"column":0},"end":{"line":41,"column":1}},{"start":{"line":39,"column":0},"end":{"line":41,"column":1}}],"line":39},"3":{"loc":{"start":{"line":44,"column":31},"end":{"line":44,"column":43}},"type":"default-arg","locations":[{"start":{"line":44,"column":41},"end":{"line":44,"column":43}}],"line":44},"4":{"loc":{"start":{"line":49,"column":16},"end":{"line":49,"column":35}},"type":"binary-expr","locations":[{"start":{"line":49,"column":16},"end":{"line":49,"column":30}},{"start":{"line":49,"column":34},"end":{"line":49,"column":35}}],"line":49},"5":{"loc":{"start":{"line":53,"column":11},"end":{"line":55,"column":9}},"type":"binary-expr","locations":[{"start":{"line":53,"column":11},"end":{"line":53,"column":31}},{"start":{"line":53,"column":35},"end":{"line":55,"column":9}}],"line":53},"6":{"loc":{"start":{"line":75,"column":27},"end":{"line":75,"column":70}},"type":"default-arg","locations":[{"start":{"line":75,"column":68},"end":{"line":75,"column":70}}],"line":75},"7":{"loc":{"start":{"line":76,"column":8},"end":{"line":78,"column":9}},"type":"if","locations":[{"start":{"line":76,"column":8},"end":{"line":78,"column":9}},{"start":{"line":76,"column":8},"end":{"line":78,"column":9}}],"line":76},"8":{"loc":{"start":{"line":76,"column":12},"end":{"line":76,"column":33}},"type":"binary-expr","locations":[{"start":{"line":76,"column":12},"end":{"line":76,"column":16}},{"start":{"line":76,"column":20},"end":{"line":76,"column":33}}],"line":76},"9":{"loc":{"start":{"line":79,"column":26},"end":{"line":79,"column":74}},"type":"cond-expr","locations":[{"start":{"line":79,"column":45},"end":{"line":79,"column":66}},{"start":{"line":79,"column":69},"end":{"line":79,"column":74}}],"line":79},"10":{"loc":{"start":{"line":79,"column":26},"end":{"line":79,"column":42}},"type":"binary-expr","locations":[{"start":{"line":79,"column":26},"end":{"line":79,"column":31}},{"start":{"line":79,"column":35},"end":{"line":79,"column":42}}],"line":79},"11":{"loc":{"start":{"line":80,"column":8},"end":{"line":86,"column":9}},"type":"if","locations":[{"start":{"line":80,"column":8},"end":{"line":86,"column":9}},{"start":{"line":80,"column":8},"end":{"line":86,"column":9}}],"line":80},"12":{"loc":{"start":{"line":80,"column":12},"end":{"line":80,"column":56}},"type":"binary-expr","locations":[{"start":{"line":80,"column":12},"end":{"line":80,"column":21}},{"start":{"line":80,"column":25},"end":{"line":80,"column":56}}],"line":80},"13":{"loc":{"start":{"line":81,"column":12},"end":{"line":85,"column":13}},"type":"if","locations":[{"start":{"line":81,"column":12},"end":{"line":85,"column":13}},{"start":{"line":81,"column":12},"end":{"line":85,"column":13}}],"line":81},"14":{"loc":{"start":{"line":81,"column":16},"end":{"line":81,"column":32}},"type":"binary-expr","locations":[{"start":{"line":81,"column":16},"end":{"line":81,"column":21}},{"start":{"line":81,"column":25},"end":{"line":81,"column":32}}],"line":81},"15":{"loc":{"start":{"line":83,"column":42},"end":{"line":83,"column":154}},"type":"cond-expr","locations":[{"start":{"line":83,"column":131},"end":{"line":83,"column":150}},{"start":{"line":83,"column":153},"end":{"line":83,"column":154}}],"line":83},"16":{"loc":{"start":{"line":83,"column":42},"end":{"line":83,"column":128}},"type":"binary-expr","locations":[{"start":{"line":83,"column":42},"end":{"line":83,"column":94}},{"start":{"line":83,"column":98},"end":{"line":83,"column":128}}],"line":83},"17":{"loc":{"start":{"line":87,"column":8},"end":{"line":90,"column":9}},"type":"if","locations":[{"start":{"line":87,"column":8},"end":{"line":90,"column":9}},{"start":{"line":87,"column":8},"end":{"line":90,"column":9}}],"line":87},"18":{"loc":{"start":{"line":89,"column":38},"end":{"line":89,"column":167}},"type":"cond-expr","locations":[{"start":{"line":89,"column":139},"end":{"line":89,"column":162}},{"start":{"line":89,"column":165},"end":{"line":89,"column":167}}],"line":89},"19":{"loc":{"start":{"line":89,"column":38},"end":{"line":89,"column":136}},"type":"binary-expr","locations":[{"start":{"line":89,"column":38},"end":{"line":89,"column":98}},{"start":{"line":89,"column":102},"end":{"line":89,"column":136}}],"line":89},"20":{"loc":{"start":{"line":95,"column":20},"end":{"line":95,"column":169}},"type":"cond-expr","locations":[{"start":{"line":95,"column":59},"end":{"line":95,"column":65}},{"start":{"line":95,"column":68},"end":{"line":95,"column":169}}],"line":95},"21":{"loc":{"start":{"line":95,"column":20},"end":{"line":95,"column":56}},"type":"binary-expr","locations":[{"start":{"line":95,"column":20},"end":{"line":95,"column":35}},{"start":{"line":95,"column":39},"end":{"line":95,"column":56}}],"line":95},"22":{"loc":{"start":{"line":95,"column":68},"end":{"line":95,"column":169}},"type":"binary-expr","locations":[{"start":{"line":95,"column":69},"end":{"line":95,"column":139}},{"start":{"line":95,"column":144},"end":{"line":95,"column":169}}],"line":95},"23":{"loc":{"start":{"line":95,"column":69},"end":{"line":95,"column":139}},"type":"cond-expr","locations":[{"start":{"line":95,"column":114},"end":{"line":95,"column":120}},{"start":{"line":95,"column":123},"end":{"line":95,"column":139}}],"line":95},"24":{"loc":{"start":{"line":95,"column":69},"end":{"line":95,"column":111}},"type":"binary-expr","locations":[{"start":{"line":95,"column":69},"end":{"line":95,"column":87}},{"start":{"line":95,"column":91},"end":{"line":95,"column":111}}],"line":95},"25":{"loc":{"start":{"line":100,"column":8},"end":{"line":103,"column":9}},"type":"if","locations":[{"start":{"line":100,"column":8},"end":{"line":103,"column":9}},{"start":{"line":100,"column":8},"end":{"line":103,"column":9}}],"line":100},"26":{"loc":{"start":{"line":100,"column":12},"end":{"line":100,"column":106}},"type":"binary-expr","locations":[{"start":{"line":100,"column":12},"end":{"line":100,"column":66}},{"start":{"line":100,"column":70},"end":{"line":100,"column":106}}],"line":100},"27":{"loc":{"start":{"line":106,"column":41},"end":{"line":106,"column":112}},"type":"binary-expr","locations":[{"start":{"line":106,"column":41},"end":{"line":106,"column":54}},{"start":{"line":106,"column":58},"end":{"line":106,"column":112}}],"line":106},"28":{"loc":{"start":{"line":110,"column":12},"end":{"line":110,"column":101}},"type":"binary-expr","locations":[{"start":{"line":110,"column":12},"end":{"line":110,"column":26}},{"start":{"line":110,"column":30},"end":{"line":110,"column":101}}],"line":110},"29":{"loc":{"start":{"line":112,"column":30},"end":{"line":112,"column":139}},"type":"binary-expr","locations":[{"start":{"line":112,"column":30},"end":{"line":112,"column":76}},{"start":{"line":112,"column":80},"end":{"line":112,"column":93}},{"start":{"line":112,"column":97},"end":{"line":112,"column":139}}],"line":112},"30":{"loc":{"start":{"line":114,"column":8},"end":{"line":133,"column":9}},"type":"if","locations":[{"start":{"line":114,"column":8},"end":{"line":133,"column":9}},{"start":{"line":114,"column":8},"end":{"line":133,"column":9}}],"line":114},"31":{"loc":{"start":{"line":114,"column":12},"end":{"line":114,"column":88}},"type":"binary-expr","locations":[{"start":{"line":114,"column":12},"end":{"line":114,"column":25}},{"start":{"line":114,"column":29},"end":{"line":114,"column":88}}],"line":114},"32":{"loc":{"start":{"line":117,"column":73},"end":{"line":119,"column":65}},"type":"binary-expr","locations":[{"start":{"line":117,"column":73},"end":{"line":119,"column":31}},{"start":{"line":119,"column":35},"end":{"line":119,"column":65}}],"line":117},"33":{"loc":{"start":{"line":123,"column":23},"end":{"line":125,"column":21}},"type":"binary-expr","locations":[{"start":{"line":123,"column":23},"end":{"line":123,"column":47}},{"start":{"line":123,"column":51},"end":{"line":123,"column":105}},{"start":{"line":123,"column":109},"end":{"line":125,"column":21}}],"line":123},"34":{"loc":{"start":{"line":129,"column":12},"end":{"line":131,"column":13}},"type":"if","locations":[{"start":{"line":129,"column":12},"end":{"line":131,"column":13}},{"start":{"line":129,"column":12},"end":{"line":131,"column":13}}],"line":129},"35":{"loc":{"start":{"line":134,"column":8},"end":{"line":144,"column":9}},"type":"if","locations":[{"start":{"line":134,"column":8},"end":{"line":144,"column":9}},{"start":{"line":134,"column":8},"end":{"line":144,"column":9}}],"line":134},"36":{"loc":{"start":{"line":134,"column":12},"end":{"line":134,"column":42}},"type":"binary-expr","locations":[{"start":{"line":134,"column":12},"end":{"line":134,"column":25}},{"start":{"line":134,"column":29},"end":{"line":134,"column":42}}],"line":134},"37":{"loc":{"start":{"line":135,"column":12},"end":{"line":142,"column":13}},"type":"if","locations":[{"start":{"line":135,"column":12},"end":{"line":142,"column":13}},{"start":{"line":135,"column":12},"end":{"line":142,"column":13}}],"line":135},"38":{"loc":{"start":{"line":137,"column":77},"end":{"line":139,"column":69}},"type":"binary-expr","locations":[{"start":{"line":137,"column":77},"end":{"line":139,"column":35}},{"start":{"line":139,"column":39},"end":{"line":139,"column":69}}],"line":137},"39":{"loc":{"start":{"line":145,"column":8},"end":{"line":152,"column":9}},"type":"if","locations":[{"start":{"line":145,"column":8},"end":{"line":152,"column":9}},{"start":{"line":145,"column":8},"end":{"line":152,"column":9}}],"line":145},"40":{"loc":{"start":{"line":147,"column":97},"end":{"line":147,"column":178}},"type":"cond-expr","locations":[{"start":{"line":147,"column":150},"end":{"line":147,"column":156}},{"start":{"line":147,"column":159},"end":{"line":147,"column":178}}],"line":147},"41":{"loc":{"start":{"line":147,"column":97},"end":{"line":147,"column":147}},"type":"binary-expr","locations":[{"start":{"line":147,"column":97},"end":{"line":147,"column":119}},{"start":{"line":147,"column":123},"end":{"line":147,"column":147}}],"line":147},"42":{"loc":{"start":{"line":149,"column":16},"end":{"line":149,"column":107}},"type":"binary-expr","locations":[{"start":{"line":149,"column":16},"end":{"line":149,"column":30}},{"start":{"line":149,"column":34},"end":{"line":149,"column":107}}],"line":149},"43":{"loc":{"start":{"line":154,"column":24},"end":{"line":154,"column":94}},"type":"cond-expr","locations":[{"start":{"line":154,"column":40},"end":{"line":154,"column":66}},{"start":{"line":154,"column":69},"end":{"line":154,"column":94}}],"line":154},"44":{"loc":{"start":{"line":159,"column":24},"end":{"line":159,"column":41}},"type":"default-arg","locations":[{"start":{"line":159,"column":39},"end":{"line":159,"column":41}}],"line":159},"45":{"loc":{"start":{"line":160,"column":8},"end":{"line":162,"column":9}},"type":"if","locations":[{"start":{"line":160,"column":8},"end":{"line":162,"column":9}},{"start":{"line":160,"column":8},"end":{"line":162,"column":9}}],"line":160},"46":{"loc":{"start":{"line":160,"column":12},"end":{"line":160,"column":58}},"type":"binary-expr","locations":[{"start":{"line":160,"column":12},"end":{"line":160,"column":16}},{"start":{"line":160,"column":20},"end":{"line":160,"column":52}},{"start":{"line":160,"column":56},"end":{"line":160,"column":58}}],"line":160},"47":{"loc":{"start":{"line":163,"column":25},"end":{"line":163,"column":77}},"type":"cond-expr","locations":[{"start":{"line":163,"column":60},"end":{"line":163,"column":72}},{"start":{"line":163,"column":75},"end":{"line":163,"column":77}}],"line":163},"48":{"loc":{"start":{"line":164,"column":24},"end":{"line":169,"column":10}},"type":"cond-expr","locations":[{"start":{"line":164,"column":59},"end":{"line":166,"column":10}},{"start":{"line":166,"column":13},"end":{"line":169,"column":10}}],"line":164},"49":{"loc":{"start":{"line":170,"column":8},"end":{"line":174,"column":9}},"type":"if","locations":[{"start":{"line":170,"column":8},"end":{"line":174,"column":9}},{"start":{"line":170,"column":8},"end":{"line":174,"column":9}}],"line":170},"50":{"loc":{"start":{"line":175,"column":8},"end":{"line":177,"column":9}},"type":"if","locations":[{"start":{"line":175,"column":8},"end":{"line":177,"column":9}},{"start":{"line":175,"column":8},"end":{"line":177,"column":9}}],"line":175},"51":{"loc":{"start":{"line":178,"column":46},"end":{"line":178,"column":58}},"type":"default-arg","locations":[{"start":{"line":178,"column":56},"end":{"line":178,"column":58}}],"line":178},"52":{"loc":{"start":{"line":225,"column":15},"end":{"line":230,"column":13}},"type":"binary-expr","locations":[{"start":{"line":225,"column":16},"end":{"line":225,"column":92}},{"start":{"line":225,"column":97},"end":{"line":230,"column":13}}],"line":225},"53":{"loc":{"start":{"line":225,"column":16},"end":{"line":225,"column":92}},"type":"cond-expr","locations":[{"start":{"line":225,"column":65},"end":{"line":225,"column":71}},{"start":{"line":225,"column":74},"end":{"line":225,"column":92}}],"line":225},"54":{"loc":{"start":{"line":225,"column":16},"end":{"line":225,"column":62}},"type":"binary-expr","locations":[{"start":{"line":225,"column":16},"end":{"line":225,"column":36}},{"start":{"line":225,"column":40},"end":{"line":225,"column":62}}],"line":225}},"s":{"0":1,"1":1,"2":3,"3":1,"4":0,"5":18,"6":7,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":0,"20":0,"21":1,"22":0,"23":0,"24":1,"25":0,"26":0,"27":1,"28":1,"29":1,"30":18,"31":1,"32":1,"33":19,"34":384,"35":233,"36":1,"37":1,"38":28,"39":0,"40":28,"41":28,"42":12,"43":11,"44":11,"45":28,"46":18,"47":28,"48":28,"49":0,"50":0,"51":28,"52":28,"53":28,"54":28,"55":28,"56":1,"57":28,"58":28,"59":28,"60":3,"61":3,"62":3,"63":59,"64":3,"65":3,"66":3,"67":3,"68":3,"69":3,"70":25,"71":5,"72":5,"73":5,"74":104,"75":5,"76":5,"77":5,"78":20,"79":4,"80":4,"81":0,"82":4,"83":16,"84":16,"85":16,"86":16,"87":18,"88":0,"89":18,"90":18,"91":18,"92":11,"93":11,"94":11,"95":18,"96":0,"97":18,"98":35,"99":18,"100":18,"101":18,"102":17,"103":0,"104":0,"105":18,"106":18,"107":17,"108":17,"109":18,"110":36,"111":18,"112":18,"113":18,"114":8,"115":1,"116":18,"117":18,"118":18},"f":{"0":1,"1":0,"2":18,"3":7,"4":0,"5":0,"6":0,"7":18,"8":1,"9":19,"10":384,"11":233,"12":28,"13":59,"14":3,"15":104,"16":18,"17":35,"18":18,"19":17,"20":0,"21":18,"22":17,"23":36,"24":18,"25":8,"26":1,"27":18},"b":{"0":[0,1],"1":[0,1],"2":[0,1],"3":[0],"4":[18,18],"5":[18,0],"6":[0],"7":[0,28],"8":[28,28],"9":[17,11],"10":[28,18],"11":[12,16],"12":[28,18],"13":[11,1],"14":[12,12],"15":[0,11],"16":[11,11],"17":[18,10],"18":[17,1],"19":[18,18],"20":[26,2],"21":[28,28],"22":[2,2],"23":[0,2],"24":[2,2],"25":[0,28],"26":[28,2],"27":[28,12],"28":[1,0],"29":[28,16,5],"30":[3,25],"31":[28,12],"32":[59,56],"33":[3,3,3],"34":[3,0],"35":[5,20],"36":[25,9],"37":[5,0],"38":[104,99],"39":[4,16],"40":[0,4],"41":[4,4],"42":[0,0],"43":[5,11],"44":[0],"45":[0,18],"46":[18,18,18],"47":[18,0],"48":[18,0],"49":[11,7],"50":[0,18],"51":[0],"52":[8,1],"53":[0,8],"54":[8,8]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/SettingsRegistry.ts"],"sourcesContent":["import type { ISetting, ISettingGroup, Optional, SettingValue } from '@rocket.chat/core-typings';\nimport { isSettingEnterprise } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport type { ISettingsModel } from '@rocket.chat/model-typings';\nimport { isEqual } from 'underscore';\n\nimport { SystemLogger } from '../../../server/lib/logger/system';\nimport type { ICachedSettings } from './CachedSettings';\nimport { getSettingDefaults } from './functions/getSettingDefaults';\nimport { overrideSetting } from './functions/overrideSetting';\nimport { overwriteSetting } from './functions/overwriteSetting';\nimport { validateSetting } from './functions/validateSetting';\n\nconst blockedSettings = new Set<string>();\nconst hiddenSettings = new Set<string>();\nconst wizardRequiredSettings = new Set<string>();\n\nif (process.env.SETTINGS_BLOCKED) {\n\tprocess.env.SETTINGS_BLOCKED.split(',').forEach((settingId) => blockedSettings.add(settingId.trim()));\n}\n\nif (process.env.SETTINGS_HIDDEN) {\n\tprocess.env.SETTINGS_HIDDEN.split(',').forEach((settingId) => hiddenSettings.add(settingId.trim()));\n}\n\nif (process.env.SETTINGS_REQUIRED_ON_WIZARD) {\n\tprocess.env.SETTINGS_REQUIRED_ON_WIZARD.split(',').forEach((settingId) => wizardRequiredSettings.add(settingId.trim()));\n}\n\nconst IS_DEVELOPMENT = process.env.NODE_ENV === 'development';\n\n/*\n * @deprecated\n * please do not use event emitter to mutate values\n */\nexport const SettingsEvents = new Emitter<{\n\t'store-setting-value': [ISetting, { value: SettingValue }];\n\t'fetch-settings': ISetting[];\n\t'remove-setting-value': ISetting;\n}>();\n\nconst getGroupDefaults = (_id: string, options: ISettingAddGroupOptions = {}): ISettingGroup => ({\n\t_id,\n\ti18nLabel: _id,\n\ti18nDescription: `${_id}_Description`,\n\t...options,\n\tsorter: options.sorter || 0,\n\tblocked: blockedSettings.has(_id),\n\thidden: hiddenSettings.has(_id),\n\ttype: 'group',\n\t...(options.displayQuery && { displayQuery: JSON.stringify(options.displayQuery) }),\n});\n\ntype ISettingAddGroupOptions = Partial<ISettingGroup>;\n\ntype addSectionCallback = (this: {\n\tadd(id: string, value: SettingValue, options: ISettingAddOptions): Promise<void>;\n\twith(options: ISettingAddOptions, cb: addSectionCallback): Promise<void>;\n}) => Promise<void>;\n\ntype addGroupCallback = (this: {\n\tadd(id: string, value: SettingValue, options: ISettingAddOptions): Promise<void>;\n\tsection(section: string, cb: addSectionCallback): Promise<void>;\n\twith(options: ISettingAddOptions, cb: addGroupCallback): Promise<void>;\n}) => Promise<void>;\n\ntype ISettingAddOptions = Partial<ISetting>;\n\nconst compareSettingsIgnoringKeys =\n\t(keys: Array<keyof ISetting>) =>\n\t(a: ISetting, b: ISetting): boolean =>\n\t\t[...new Set([...Object.keys(a), ...Object.keys(b)])]\n\t\t\t.filter((key) => !keys.includes(key as keyof ISetting))\n\t\t\t.every((key) => isEqual(a[key as keyof ISetting], b[key as keyof ISetting]));\n\nexport const compareSettings = compareSettingsIgnoringKeys([\n\t'value',\n\t'ts',\n\t'createdAt',\n\t'valueSource',\n\t'packageValue',\n\t'processEnvValue',\n\t'_updatedAt',\n]);\n\nexport class SettingsRegistry {\n\tprivate model: ISettingsModel;\n\n\tprivate store: ICachedSettings;\n\n\tprivate _sorter: { [key: string]: number } = {};\n\n\tconstructor({ store, model }: { store: ICachedSettings; model: ISettingsModel }) {\n\t\tthis.store = store;\n\t\tthis.model = model;\n\t}\n\n\t/*\n\t * Add a setting\n\t */\n\tasync add(_id: string, value: SettingValue, { sorter, section, group, ...options }: ISettingAddOptions = {}): Promise<void> {\n\t\tif (!_id || value == null) {\n\t\t\tthrow new Error('Invalid arguments');\n\t\t}\n\n\t\tconst sorterKey = group && section ? `${group}_${section}` : group;\n\n\t\tif (sorterKey && this._sorter[sorterKey] == null) {\n\t\t\tif (group && section) {\n\t\t\t\tconst currentGroupValue = this._sorter[group] ?? 0;\n\t\t\t\tthis._sorter[sorterKey] = currentGroupValue * 1000;\n\t\t\t}\n\t\t}\n\n\t\tif (sorterKey) {\n\t\t\tthis._sorter[sorterKey] = this._sorter[sorterKey] ?? -1;\n\t\t}\n\n\t\tconst settingFromCode = getSettingDefaults(\n\t\t\t{\n\t\t\t\t_id,\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue,\n\t\t\t\tsorter: sorter ?? (sorterKey?.length && this._sorter[sorterKey]++),\n\t\t\t\tgroup,\n\t\t\t\tsection,\n\t\t\t\t...options,\n\t\t\t},\n\t\t\tblockedSettings,\n\t\t\thiddenSettings,\n\t\t\twizardRequiredSettings,\n\t\t);\n\n\t\tif (isSettingEnterprise(settingFromCode) && !('invalidValue' in settingFromCode)) {\n\t\t\tSystemLogger.error(`Enterprise setting ${_id} is missing the invalidValue option`);\n\t\t\tthrow new Error(`Enterprise setting ${_id} is missing the invalidValue option`);\n\t\t}\n\n\t\tconst settingFromCodeOverwritten = overwriteSetting(settingFromCode);\n\n\t\tconst settingStored = this.store.getSetting(_id);\n\n\t\tconst settingStoredOverwritten = settingStored && overwriteSetting(settingStored);\n\n\t\ttry {\n\t\t\tvalidateSetting(settingFromCode._id, settingFromCode.type, settingFromCode.value);\n\t\t} catch (e) {\n\t\t\tIS_DEVELOPMENT && SystemLogger.error(`Invalid setting code ${_id}: ${(e as Error).message}`);\n\t\t}\n\n\t\tconst isOverwritten = settingFromCode !== settingFromCodeOverwritten || (settingStored && settingStored !== settingStoredOverwritten);\n\n\t\tconst { _id: _, ...settingProps } = settingFromCodeOverwritten;\n\n\t\tif (settingStored && !compareSettings(settingStored, settingFromCodeOverwritten)) {\n\t\t\tconst { value: _value, ...settingOverwrittenProps } = settingFromCodeOverwritten;\n\n\t\t\tconst overwrittenKeys = Object.keys(settingFromCodeOverwritten);\n\t\t\tconst removedKeys = Object.keys(settingStored).filter((key) => !['_updatedAt'].includes(key) && !overwrittenKeys.includes(key));\n\n\t\t\tconst updatedProps = (() => {\n\t\t\t\treturn {\n\t\t\t\t\t...settingOverwrittenProps,\n\t\t\t\t\t...(settingStoredOverwritten &&\n\t\t\t\t\t\tsettingStored.value !== settingStoredOverwritten.value && { value: settingStoredOverwritten.value }),\n\t\t\t\t};\n\t\t\t})();\n\n\t\t\tawait this.saveUpdatedSetting(_id, updatedProps, removedKeys);\n\t\t\tif ('value' in updatedProps) {\n\t\t\t\tthis.store.set(updatedProps as ISetting);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (settingStored && isOverwritten) {\n\t\t\tif (settingStored.value !== settingFromCodeOverwritten.value) {\n\t\t\t\tconst overwrittenKeys = Object.keys(settingFromCodeOverwritten);\n\t\t\t\tconst removedKeys = Object.keys(settingStored).filter((key) => !['_updatedAt'].includes(key) && !overwrittenKeys.includes(key));\n\n\t\t\t\tawait this.saveUpdatedSetting(_id, settingProps, removedKeys);\n\t\t\t\tthis.store.set(settingFromCodeOverwritten);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (settingStored) {\n\t\t\ttry {\n\t\t\t\tvalidateSetting(settingFromCode._id, settingFromCode.type, settingStored?.value);\n\t\t\t} catch (e) {\n\t\t\t\tIS_DEVELOPMENT && SystemLogger.error(`Invalid setting stored ${_id}: ${(e as Error).message}`);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingOverwrittenDefault = overrideSetting(settingFromCode);\n\n\t\tconst setting = isOverwritten ? settingFromCodeOverwritten : settingOverwrittenDefault;\n\n\t\tawait this.model.insertOne(setting); // no need to emit unless we remove the oplog\n\n\t\tthis.store.set(setting);\n\t}\n\n\t/*\n\t * Add a setting group\n\t */\n\tasync addGroup(_id: string, cb?: addGroupCallback): Promise<void>;\n\n\t// eslint-disable-next-line no-dupe-class-members\n\tasync addGroup(_id: string, groupOptions: ISettingAddGroupOptions | addGroupCallback = {}, cb?: addGroupCallback): Promise<void> {\n\t\tif (!_id || (groupOptions instanceof Function && cb)) {\n\t\t\tthrow new Error('Invalid arguments');\n\t\t}\n\n\t\tconst callback = groupOptions instanceof Function ? groupOptions : cb;\n\n\t\tconst options =\n\t\t\tgroupOptions instanceof Function\n\t\t\t\t? getGroupDefaults(_id, { sorter: this._sorter[_id] })\n\t\t\t\t: getGroupDefaults(_id, { sorter: this._sorter[_id], ...groupOptions });\n\n\t\tif (!this.store.has(_id)) {\n\t\t\toptions.ts = new Date();\n\t\t\tawait this.model.insertOne(options as ISetting);\n\t\t\tthis.store.set(options as ISetting);\n\t\t}\n\n\t\tif (!callback) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst addWith =\n\t\t\t(preset: ISettingAddOptions) =>\n\t\t\t(id: string, value: SettingValue, options: ISettingAddOptions = {}): Promise<void> => {\n\t\t\t\tconst mergedOptions = { ...preset, ...options };\n\t\t\t\treturn this.add(id, value, mergedOptions);\n\t\t\t};\n\t\tconst sectionSetWith =\n\t\t\t(preset: ISettingAddOptions) =>\n\t\t\t(options: ISettingAddOptions, cb: addSectionCallback): Promise<void> => {\n\t\t\t\tconst mergedOptions = { ...preset, ...options };\n\t\t\t\treturn cb.call({\n\t\t\t\t\tadd: addWith(mergedOptions),\n\t\t\t\t\twith: sectionSetWith(mergedOptions),\n\t\t\t\t});\n\t\t\t};\n\t\tconst sectionWith =\n\t\t\t(preset: ISettingAddOptions) =>\n\t\t\t(section: string, cb: addSectionCallback): Promise<void> => {\n\t\t\t\tconst mergedOptions = { ...preset, section };\n\t\t\t\treturn cb.call({\n\t\t\t\t\tadd: addWith(mergedOptions),\n\t\t\t\t\twith: sectionSetWith(mergedOptions),\n\t\t\t\t});\n\t\t\t};\n\n\t\tconst groupSetWith =\n\t\t\t(preset: ISettingAddOptions) =>\n\t\t\t(options: ISettingAddOptions, cb: addGroupCallback): Promise<void> => {\n\t\t\t\tconst mergedOptions = { ...preset, ...options };\n\n\t\t\t\treturn cb.call({\n\t\t\t\t\tadd: addWith(mergedOptions),\n\t\t\t\t\tsection: sectionWith(mergedOptions),\n\t\t\t\t\twith: groupSetWith(mergedOptions),\n\t\t\t\t});\n\t\t\t};\n\n\t\treturn groupSetWith({ group: _id })({}, callback);\n\t}\n\n\tprivate async saveUpdatedSetting(\n\t\t_id: string,\n\t\tsettingProps: Omit<Optional<ISetting, 'value'>, '_id'>,\n\t\tremovedKeys?: string[],\n\t): Promise<void> {\n\t\tawait this.model.updateOne(\n\t\t\t{ _id },\n\t\t\t{\n\t\t\t\t$set: settingProps,\n\t\t\t\t...(removedKeys?.length && {\n\t\t\t\t\t$unset: removedKeys.reduce((unset, key) => ({ ...unset, [key]: 1 }), {}),\n\t\t\t\t}),\n\t\t\t},\n\t\t\t{ upsert: true },\n\t\t);\n\t}\n}\n"],"names":["SettingsEvents","SettingsRegistry","compareSettings","blockedSettings","Set","hiddenSettings","wizardRequiredSettings","process","env","SETTINGS_BLOCKED","split","forEach","settingId","add","trim","SETTINGS_HIDDEN","SETTINGS_REQUIRED_ON_WIZARD","IS_DEVELOPMENT","NODE_ENV","Emitter","getGroupDefaults","_id","options","i18nLabel","i18nDescription","sorter","blocked","has","hidden","type","displayQuery","JSON","stringify","compareSettingsIgnoringKeys","keys","a","b","Object","filter","key","includes","every","isEqual","value","section","group","Error","sorterKey","_sorter","currentGroupValue","settingFromCode","getSettingDefaults","length","isSettingEnterprise","SystemLogger","error","settingFromCodeOverwritten","overwriteSetting","settingStored","store","getSetting","settingStoredOverwritten","validateSetting","e","message","isOverwritten","_","settingProps","_value","settingOverwrittenProps","overwrittenKeys","removedKeys","updatedProps","saveUpdatedSetting","set","settingOverwrittenDefault","overrideSetting","setting","model","insertOne","addGroup","groupOptions","cb","Function","callback","ts","Date","addWith","preset","id","mergedOptions","sectionSetWith","call","with","sectionWith","groupSetWith","updateOne","$set","$unset","reduce","unset","upsert","constructor"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/SettingsRegistry.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c40aa0c8910590bf13be9dc65ff45c8ebc788efa","contentHash":"de5cce5eee8c6a3fc9942840868a793020c7bb7be862f919cb9438c15d2fcab5"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/logger/system.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/logger/system.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":28}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":21},"end":{"line":12,"column":49}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7}},"branchMap":{},"s":{"0":2,"1":2,"2":18,"3":2,"4":2},"f":{"0":18},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/logger/system.ts"],"sourcesContent":["import { Logger } from '@rocket.chat/logger';\n\nexport const SystemLogger = new Logger('System');\n"],"names":["SystemLogger","Logger"],"mappings":";;;;+BAEaA;;;eAAAA;;;wBAFU;AAEhB,MAAMA,eAAe,IAAIC,cAAM,CAAC","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/logger/system.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"123d999d53c8185be8dd90c45c227079b23ae845","contentHash":"ff1c21ba73926aeaa8706d97c2a960d7d6dbe8041175af019f8890acacb5533b"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/getSettingDefaults.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/getSettingDefaults.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":34}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":27},"end":{"line":47,"column":1}},"5":{"start":{"line":13,"column":44},"end":{"line":13,"column":51}},"6":{"start":{"line":14,"column":20},"end":{"line":14,"column":101}},"7":{"start":{"line":14,"column":80},"end":{"line":14,"column":99}},"8":{"start":{"line":16,"column":4},"end":{"line":46,"column":6}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":27},"end":{"line":12,"column":28}},"loc":{"start":{"line":12,"column":131},"end":{"line":47,"column":1}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":14,"column":67},"end":{"line":14,"column":68}},"loc":{"start":{"line":14,"column":80},"end":{"line":14,"column":99}},"line":14}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":37},"end":{"line":12,"column":64}},"type":"default-arg","locations":[{"start":{"line":12,"column":55},"end":{"line":12,"column":64}}],"line":12},"1":{"loc":{"start":{"line":12,"column":66},"end":{"line":12,"column":92}},"type":"default-arg","locations":[{"start":{"line":12,"column":83},"end":{"line":12,"column":92}}],"line":12},"2":{"loc":{"start":{"line":12,"column":94},"end":{"line":12,"column":128}},"type":"default-arg","locations":[{"start":{"line":12,"column":119},"end":{"line":12,"column":128}}],"line":12},"3":{"loc":{"start":{"line":25,"column":16},"end":{"line":25,"column":27}},"type":"binary-expr","locations":[{"start":{"line":25,"column":16},"end":{"line":25,"column":22}},{"start":{"line":25,"column":26},"end":{"line":25,"column":27}}],"line":25},"4":{"loc":{"start":{"line":28,"column":20},"end":{"line":28,"column":140}},"type":"cond-expr","locations":[{"start":{"line":28,"column":108},"end":{"line":28,"column":127}},{"start":{"line":28,"column":130},"end":{"line":28,"column":140}}],"line":28},"5":{"loc":{"start":{"line":28,"column":20},"end":{"line":28,"column":105}},"type":"binary-expr","locations":[{"start":{"line":28,"column":20},"end":{"line":28,"column":71}},{"start":{"line":28,"column":75},"end":{"line":28,"column":105}}],"line":28},"6":{"loc":{"start":{"line":30,"column":11},"end":{"line":32,"column":21}},"type":"cond-expr","locations":[{"start":{"line":30,"column":33},"end":{"line":32,"column":9}},{"start":{"line":32,"column":12},"end":{"line":32,"column":21}}],"line":30},"7":{"loc":{"start":{"line":33,"column":19},"end":{"line":33,"column":43}},"type":"binary-expr","locations":[{"start":{"line":33,"column":19},"end":{"line":33,"column":36}},{"start":{"line":33,"column":40},"end":{"line":33,"column":43}}],"line":33},"8":{"loc":{"start":{"line":34,"column":16},"end":{"line":34,"column":57}},"type":"binary-expr","locations":[{"start":{"line":34,"column":16},"end":{"line":34,"column":30}},{"start":{"line":34,"column":34},"end":{"line":34,"column":57}}],"line":34},"9":{"loc":{"start":{"line":35,"column":17},"end":{"line":35,"column":60}},"type":"binary-expr","locations":[{"start":{"line":35,"column":17},"end":{"line":35,"column":32}},{"start":{"line":35,"column":36},"end":{"line":35,"column":60}}],"line":35},"10":{"loc":{"start":{"line":36,"column":26},"end":{"line":36,"column":85}},"type":"binary-expr","locations":[{"start":{"line":36,"column":26},"end":{"line":36,"column":50}},{"start":{"line":36,"column":54},"end":{"line":36,"column":85}}],"line":36},"11":{"loc":{"start":{"line":37,"column":14},"end":{"line":37,"column":38}},"type":"binary-expr","locations":[{"start":{"line":37,"column":14},"end":{"line":37,"column":26}},{"start":{"line":37,"column":30},"end":{"line":37,"column":38}}],"line":37},"12":{"loc":{"start":{"line":38,"column":13},"end":{"line":38,"column":33}},"type":"binary-expr","locations":[{"start":{"line":38,"column":13},"end":{"line":38,"column":24}},{"start":{"line":38,"column":28},"end":{"line":38,"column":33}}],"line":38},"13":{"loc":{"start":{"line":39,"column":16},"end":{"line":39,"column":39}},"type":"binary-expr","locations":[{"start":{"line":39,"column":16},"end":{"line":39,"column":30}},{"start":{"line":39,"column":34},"end":{"line":39,"column":39}}],"line":39},"14":{"loc":{"start":{"line":40,"column":11},"end":{"line":42,"column":21}},"type":"cond-expr","locations":[{"start":{"line":40,"column":34},"end":{"line":42,"column":9}},{"start":{"line":42,"column":12},"end":{"line":42,"column":21}}],"line":40},"15":{"loc":{"start":{"line":43,"column":11},"end":{"line":45,"column":9}},"type":"binary-expr","locations":[{"start":{"line":43,"column":11},"end":{"line":43,"column":52}},{"start":{"line":43,"column":56},"end":{"line":45,"column":9}}],"line":43}},"s":{"0":1,"1":1,"2":40,"3":1,"4":1,"5":40,"6":40,"7":256,"8":40},"f":{"0":40,"1":40,"2":256},"b":{"0":[9],"1":[12],"2":[12],"3":[40,39],"4":[10,30],"5":[40,40],"6":[0,40],"7":[40,30],"8":[40,40],"9":[40,39],"10":[40,40],"11":[40,0],"12":[40,40],"13":[40,39],"14":[0,40],"15":[40,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/getSettingDefaults.ts"],"sourcesContent":["import type { ISetting, ISettingColor } from '@rocket.chat/core-typings';\nimport { isSettingColor } from '@rocket.chat/core-typings';\n\nexport const getSettingDefaults = (\n\tsetting: Partial<ISetting> & Pick<ISetting, '_id' | 'value' | 'type'>,\n\tblockedSettings: Set<string> = new Set(),\n\thiddenSettings: Set<string> = new Set(),\n\twizardRequiredSettings: Set<string> = new Set(),\n): ISetting => {\n\tconst { _id, value, sorter, ...data } = setting;\n\n\tconst options = Object.fromEntries(Object.entries(data).filter(([, value]) => value !== undefined)) as Partial<typeof data>;\n\n\treturn {\n\t\t_id,\n\t\tvalue,\n\t\tpackageValue: value,\n\t\tvalueSource: 'packageValue',\n\t\tsecret: false,\n\t\tenterprise: false,\n\t\ti18nDescription: `${_id}_Description`,\n\t\tautocomplete: true,\n\t\tsorter: sorter || 0,\n\t\tts: new Date(),\n\t\tcreatedAt: new Date(),\n\t\t_updatedAt: options._updatedAt ?? new Date(),\n\t\t...options,\n\t\t...(options.enableQuery ? { enableQuery: JSON.stringify(options.enableQuery) } : undefined),\n\t\ti18nLabel: options.i18nLabel || _id,\n\t\thidden: options.hidden || hiddenSettings.has(_id),\n\t\tblocked: options.blocked || blockedSettings.has(_id),\n\t\trequiredOnWizard: options.requiredOnWizard || wizardRequiredSettings.has(_id),\n\t\ttype: options.type || 'string',\n\t\tenv: options.env || false,\n\t\tpublic: options.public || false,\n\t\t...(options.displayQuery ? { displayQuery: JSON.stringify(options.displayQuery) } : undefined),\n\t\t...(isSettingColor(setting as ISetting) && {\n\t\t\tpackageEditor: (setting as ISettingColor).editor,\n\t\t}),\n\t};\n};\n"],"names":["getSettingDefaults","setting","blockedSettings","Set","hiddenSettings","wizardRequiredSettings","_id","value","sorter","data","options","Object","fromEntries","entries","filter","undefined","packageValue","valueSource","secret","enterprise","i18nDescription","autocomplete","ts","Date","createdAt","_updatedAt","enableQuery","JSON","stringify","i18nLabel","hidden","has","blocked","requiredOnWizard","type","env","public","displayQuery","isSettingColor","packageEditor","editor"],"mappings":";;;;+BAGaA;;;eAAAA;;;6BAFkB;AAExB,MAAMA,qBAAqB,CACjCC,SACAC,kBAA+B,IAAIC,KAAK,EACxCC,iBAA8B,IAAID,KAAK,EACvCE,yBAAsC,IAAIF,KAAK;IAE/C,MAAM,EAAEG,GAAG,EAAEC,KAAK,EAAEC,MAAM,EAAE,GAAGC,MAAM,GAAGR;IAExC,MAAMS,UAAUC,OAAOC,WAAW,CAACD,OAAOE,OAAO,CAACJ,MAAMK,MAAM,CAAC,CAAC,GAAGP,MAAM,GAAKA,UAAUQ;QAc3EL;IAZb,OAAO;QACNJ;QACAC;QACAS,cAAcT;QACdU,aAAa;QACbC,QAAQ;QACRC,YAAY;QACZC,iBAAiB,GAAGd,IAAI,YAAY,CAAC;QACrCe,cAAc;QACdb,QAAQA,UAAU;QAClBc,IAAI,IAAIC;QACRC,WAAW,IAAID;QACfE,YAAYf,CAAAA,sBAAAA,QAAQe,UAAU,cAAlBf,iCAAAA,sBAAsB,IAAIa;QACtC,GAAGb,OAAO;QACV,GAAIA,QAAQgB,WAAW,GAAG;YAAEA,aAAaC,KAAKC,SAAS,CAAClB,QAAQgB,WAAW;QAAE,IAAIX,SAAS;QAC1Fc,WAAWnB,QAAQmB,SAAS,IAAIvB;QAChCwB,QAAQpB,QAAQoB,MAAM,IAAI1B,eAAe2B,GAAG,CAACzB;QAC7C0B,SAAStB,QAAQsB,OAAO,IAAI9B,gBAAgB6B,GAAG,CAACzB;QAChD2B,kBAAkBvB,QAAQuB,gBAAgB,IAAI5B,uBAAuB0B,GAAG,CAACzB;QACzE4B,MAAMxB,QAAQwB,IAAI,IAAI;QACtBC,KAAKzB,QAAQyB,GAAG,IAAI;QACpBC,QAAQ1B,QAAQ0B,MAAM,IAAI;QAC1B,GAAI1B,QAAQ2B,YAAY,GAAG;YAAEA,cAAcV,KAAKC,SAAS,CAAClB,QAAQ2B,YAAY;QAAE,IAAItB,SAAS;QAC7F,GAAIuB,IAAAA,2BAAc,EAACrC,YAAwB;YAC1CsC,eAAe,AAACtC,QAA0BuC,MAAM;QACjD,CAAC;IACF;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/getSettingDefaults.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"21e25e335a5753e97bdddff3d439ffcdb97c75ee","contentHash":"90c1e505830cf4671a742db406e79a1fc745b06854bed14e08485ab7954b92e4"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/overrideSetting.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/overrideSetting.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":31}},"3":{"start":{"line":11,"column":27},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":24},"end":{"line":12,"column":90}},"5":{"start":{"line":12,"column":73},"end":{"line":12,"column":89}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":66},"end":{"line":12,"column":67}},"loc":{"start":{"line":12,"column":73},"end":{"line":12,"column":89}},"line":12}},"branchMap":{},"s":{"0":1,"1":1,"2":16,"3":1,"4":1,"5":16},"f":{"0":16,"1":16},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/overrideSetting.ts"],"sourcesContent":["import { overrideGenerator } from './overrideGenerator';\n\nexport const overrideSetting = overrideGenerator((key: string) => process.env[key]);\n"],"names":["overrideSetting","overrideGenerator","key","process","env"],"mappings":";;;;+BAEaA;;;eAAAA;;;mCAFqB;AAE3B,MAAMA,kBAAkBC,IAAAA,oCAAiB,EAAC,CAACC,MAAgBC,QAAQC,GAAG,CAACF,IAAI","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/overrideSetting.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6e9800982a895bead322c154e22d72fc5526b3a5","contentHash":"d090efab95b6d37108410ad71be1d19be2eb5d022c0e35d8744de7ec22528525"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/overrideGenerator.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/overrideGenerator.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":33}},"3":{"start":{"line":11,"column":22},"end":{"line":11,"column":47}},"4":{"start":{"line":12,"column":29},"end":{"line":28,"column":1}},"5":{"start":{"line":13,"column":4},"end":{"line":26,"column":5}},"6":{"start":{"line":14,"column":8},"end":{"line":18,"column":9}},"7":{"start":{"line":15,"column":12},"end":{"line":15,"column":18}},"8":{"start":{"line":16,"column":12},"end":{"line":16,"column":18}},"9":{"start":{"line":17,"column":12},"end":{"line":17,"column":107}},"10":{"start":{"line":17,"column":68},"end":{"line":17,"column":105}},"11":{"start":{"line":19,"column":8},"end":{"line":25,"column":9}},"12":{"start":{"line":20,"column":12},"end":{"line":20,"column":18}},"13":{"start":{"line":21,"column":12},"end":{"line":21,"column":18}},"14":{"start":{"line":22,"column":12},"end":{"line":24,"column":15}},"15":{"start":{"line":23,"column":16},"end":{"line":23,"column":104}},"16":{"start":{"line":23,"column":55},"end":{"line":23,"column":102}},"17":{"start":{"line":27,"column":4},"end":{"line":27,"column":19}},"18":{"start":{"line":29,"column":26},"end":{"line":49,"column":5}},"19":{"start":{"line":29,"column":32},"end":{"line":49,"column":5}},"20":{"start":{"line":30,"column":31},"end":{"line":30,"column":46}},"21":{"start":{"line":31,"column":8},"end":{"line":33,"column":9}},"22":{"start":{"line":32,"column":12},"end":{"line":32,"column":27}},"23":{"start":{"line":34,"column":8},"end":{"line":48,"column":9}},"24":{"start":{"line":35,"column":26},"end":{"line":35,"column":87}},"25":{"start":{"line":36,"column":12},"end":{"line":38,"column":13}},"26":{"start":{"line":37,"column":16},"end":{"line":37,"column":31}},"27":{"start":{"line":39,"column":12},"end":{"line":44,"column":14}},"28":{"start":{"line":46,"column":12},"end":{"line":46,"column":111}},"29":{"start":{"line":47,"column":12},"end":{"line":47,"column":27}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":29},"end":{"line":12,"column":30}},"loc":{"start":{"line":12,"column":43},"end":{"line":28,"column":1}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":17,"column":52},"end":{"line":17,"column":53}},"loc":{"start":{"line":17,"column":68},"end":{"line":17,"column":105}},"line":17},"3":{"name":"(anonymous_3)","decl":{"start":{"line":22,"column":52},"end":{"line":22,"column":53}},"loc":{"start":{"line":22,"column":68},"end":{"line":24,"column":13}},"line":22},"4":{"name":"(anonymous_4)","decl":{"start":{"line":23,"column":48},"end":{"line":23,"column":49}},"loc":{"start":{"line":23,"column":55},"end":{"line":23,"column":102}},"line":23},"5":{"name":"(anonymous_5)","decl":{"start":{"line":29,"column":26},"end":{"line":29,"column":27}},"loc":{"start":{"line":29,"column":32},"end":{"line":49,"column":5}},"line":29},"6":{"name":"(anonymous_6)","decl":{"start":{"line":29,"column":32},"end":{"line":29,"column":33}},"loc":{"start":{"line":29,"column":43},"end":{"line":49,"column":5}},"line":29}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":4},"end":{"line":26,"column":5}},"type":"if","locations":[{"start":{"line":13,"column":4},"end":{"line":26,"column":5}},{"start":{"line":13,"column":4},"end":{"line":26,"column":5}}],"line":13},"1":{"loc":{"start":{"line":13,"column":8},"end":{"line":13,"column":44}},"type":"binary-expr","locations":[{"start":{"line":13,"column":8},"end":{"line":13,"column":24}},{"start":{"line":13,"column":28},"end":{"line":13,"column":44}}],"line":13},"2":{"loc":{"start":{"line":14,"column":8},"end":{"line":18,"column":9}},"type":"if","locations":[{"start":{"line":14,"column":8},"end":{"line":18,"column":9}},{"start":{"line":14,"column":8},"end":{"line":18,"column":9}}],"line":14},"3":{"loc":{"start":{"line":17,"column":19},"end":{"line":17,"column":106}},"type":"binary-expr","locations":[{"start":{"line":17,"column":19},"end":{"line":17,"column":40}},{"start":{"line":17,"column":44},"end":{"line":17,"column":106}}],"line":17},"4":{"loc":{"start":{"line":19,"column":8},"end":{"line":25,"column":9}},"type":"if","locations":[{"start":{"line":19,"column":8},"end":{"line":25,"column":9}},{"start":{"line":19,"column":8},"end":{"line":25,"column":9}}],"line":19},"5":{"loc":{"start":{"line":22,"column":19},"end":{"line":24,"column":14}},"type":"binary-expr","locations":[{"start":{"line":22,"column":19},"end":{"line":22,"column":40}},{"start":{"line":22,"column":44},"end":{"line":24,"column":14}}],"line":22},"6":{"loc":{"start":{"line":31,"column":8},"end":{"line":33,"column":9}},"type":"if","locations":[{"start":{"line":31,"column":8},"end":{"line":33,"column":9}},{"start":{"line":31,"column":8},"end":{"line":33,"column":9}}],"line":31},"7":{"loc":{"start":{"line":31,"column":12},"end":{"line":31,"column":67}},"type":"binary-expr","locations":[{"start":{"line":31,"column":12},"end":{"line":31,"column":35}},{"start":{"line":31,"column":39},"end":{"line":31,"column":67}}],"line":31},"8":{"loc":{"start":{"line":36,"column":12},"end":{"line":38,"column":13}},"type":"if","locations":[{"start":{"line":36,"column":12},"end":{"line":38,"column":13}},{"start":{"line":36,"column":12},"end":{"line":38,"column":13}}],"line":36}},"s":{"0":1,"1":1,"2":4,"3":1,"4":1,"5":25,"6":1,"7":1,"8":1,"9":1,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":24,"18":1,"19":4,"20":58,"21":58,"22":32,"23":26,"24":26,"25":25,"26":2,"27":23,"28":1,"29":1},"f":{"0":4,"1":25,"2":0,"3":0,"4":0,"5":4,"6":58},"b":{"0":[1,24],"1":[25,1],"2":[1,0],"3":[1,0],"4":[0,0],"5":[0,0],"6":[32,26],"7":[58,58],"8":[2,23]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/overrideGenerator.ts"],"sourcesContent":["import type { ISetting, SettingValueMultiSelect, SettingValueRoomPick } from '@rocket.chat/core-typings';\n\nimport { convertValue } from './convertValue';\n\nconst compareSettingsValue = (a: ISetting['value'], b: ISetting['value'], type?: ISetting['type']): boolean => {\n\tif (Array.isArray(a) && Array.isArray(b)) {\n\t\tif (type === 'multiSelect') {\n\t\t\ta = a as SettingValueMultiSelect;\n\t\t\tb = b as SettingValueMultiSelect;\n\t\t\treturn a.length === b.length && a.every((value, index) => compareSettingsValue(value, (b as SettingValueMultiSelect)[index]));\n\t\t}\n\n\t\tif (type === 'roomPick') {\n\t\t\ta = a as SettingValueRoomPick;\n\t\t\tb = b as SettingValueRoomPick;\n\t\t\treturn (\n\t\t\t\ta.length === b.length &&\n\t\t\t\ta.every((value, index) => {\n\t\t\t\t\treturn Object.keys(value).every((key) =>\n\t\t\t\t\t\tcompareSettingsValue(\n\t\t\t\t\t\t\tvalue[key as keyof typeof value],\n\t\t\t\t\t\t\t(b as SettingValueRoomPick)[index as keyof typeof b][key as keyof typeof b],\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t}\n\treturn a === b;\n};\n\nexport const overrideGenerator =\n\t(fn: (key: string) => string | undefined) =>\n\t(setting: ISetting): ISetting => {\n\t\tconst overwriteValue = fn(setting._id);\n\t\tif (overwriteValue === null || overwriteValue === undefined) {\n\t\t\treturn setting;\n\t\t}\n\n\t\ttry {\n\t\t\tconst value = convertValue(overwriteValue, setting.type);\n\n\t\t\tif (compareSettingsValue(value, setting.value, setting.type)) {\n\t\t\t\treturn setting;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...setting,\n\t\t\t\tvalue,\n\t\t\t\tprocessEnvValue: value,\n\t\t\t\tvalueSource: 'processEnvValue',\n\t\t\t};\n\t\t} catch (error) {\n\t\t\tconsole.error(`Error converting value for setting ${setting._id} expected \"${setting.type}\" type`);\n\t\t\treturn setting;\n\t\t}\n\t};\n"],"names":["overrideGenerator","compareSettingsValue","a","b","type","Array","isArray","length","every","value","index","Object","keys","key","fn","setting","overwriteValue","_id","undefined","convertValue","processEnvValue","valueSource","error","console"],"mappings":";;;;+BA+BaA;;;eAAAA;;;8BA7BgB;AAE7B,MAAMC,uBAAuB,CAACC,GAAsBC,GAAsBC;IACzE,IAAIC,MAAMC,OAAO,CAACJ,MAAMG,MAAMC,OAAO,CAACH,IAAI;QACzC,IAAIC,SAAS,eAAe;YAC3BF,IAAIA;YACJC,IAAIA;YACJ,OAAOD,EAAEK,MAAM,KAAKJ,EAAEI,MAAM,IAAIL,EAAEM,KAAK,CAAC,CAACC,OAAOC,QAAUT,qBAAqBQ,OAAO,AAACN,CAA6B,CAACO,MAAM;QAC5H;QAEA,IAAIN,SAAS,YAAY;YACxBF,IAAIA;YACJC,IAAIA;YACJ,OACCD,EAAEK,MAAM,KAAKJ,EAAEI,MAAM,IACrBL,EAAEM,KAAK,CAAC,CAACC,OAAOC;gBACf,OAAOC,OAAOC,IAAI,CAACH,OAAOD,KAAK,CAAC,CAACK,MAChCZ,qBACCQ,KAAK,CAACI,IAA0B,EAChC,AAACV,CAA0B,CAACO,MAAwB,CAACG,IAAsB;YAG9E;QAEF;IACD;IACA,OAAOX,MAAMC;AACd;AAEO,MAAMH,oBACZ,CAACc,KACD,CAACC;QACA,MAAMC,iBAAiBF,GAAGC,QAAQE,GAAG;QACrC,IAAID,mBAAmB,QAAQA,mBAAmBE,WAAW;YAC5D,OAAOH;QACR;QAEA,IAAI;YACH,MAAMN,QAAQU,IAAAA,0BAAY,EAACH,gBAAgBD,QAAQX,IAAI;YAEvD,IAAIH,qBAAqBQ,OAAOM,QAAQN,KAAK,EAAEM,QAAQX,IAAI,GAAG;gBAC7D,OAAOW;YACR;YAEA,OAAO;gBACN,GAAGA,OAAO;gBACVN;gBACAW,iBAAiBX;gBACjBY,aAAa;YACd;QACD,EAAE,OAAOC,OAAO;YACfC,QAAQD,KAAK,CAAC,CAAC,mCAAmC,EAAEP,QAAQE,GAAG,CAAC,WAAW,EAAEF,QAAQX,IAAI,CAAC,MAAM,CAAC;YACjG,OAAOW;QACR;IACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/overrideGenerator.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"746616ee9e59667a03890f8666a82d4e76daaf86","contentHash":"b56f1dde1193c5577bcdb0ec3402b311f16ba29f5ef5a17745fb4f834016fd1b"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/convertValue.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/convertValue.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":28}},"3":{"start":{"line":11,"column":21},"end":{"line":25,"column":1}},"4":{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},"5":{"start":{"line":13,"column":8},"end":{"line":13,"column":20}},"6":{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},"7":{"start":{"line":16,"column":8},"end":{"line":16,"column":21}},"8":{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},"9":{"start":{"line":19,"column":8},"end":{"line":19,"column":31}},"10":{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},"11":{"start":{"line":22,"column":8},"end":{"line":22,"column":33}},"12":{"start":{"line":24,"column":4},"end":{"line":24,"column":17}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":21},"end":{"line":11,"column":22}},"loc":{"start":{"line":11,"column":36},"end":{"line":25,"column":1}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},"type":"if","locations":[{"start":{"line":12,"column":4},"end":{"line":14,"column":5}},{"start":{"line":12,"column":4},"end":{"line":14,"column":5}}],"line":12},"1":{"loc":{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},"type":"if","locations":[{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},{"start":{"line":15,"column":4},"end":{"line":17,"column":5}}],"line":15},"2":{"loc":{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},"type":"if","locations":[{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},{"start":{"line":18,"column":4},"end":{"line":20,"column":5}}],"line":18},"3":{"loc":{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},{"start":{"line":21,"column":4},"end":{"line":23,"column":5}}],"line":21}},"s":{"0":1,"1":1,"2":26,"3":1,"4":26,"5":1,"6":25,"7":6,"8":19,"9":6,"10":13,"11":2,"12":11},"f":{"0":26,"1":26},"b":{"0":[1,25],"1":[6,19],"2":[6,13],"3":[2,11]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/convertValue.ts"],"sourcesContent":["import type { ISetting, SettingValue } from '@rocket.chat/core-typings';\n\nexport const convertValue = (value: 'true' | 'false' | string, type: ISetting['type']): SettingValue => {\n\tif (value.toLowerCase() === 'true') {\n\t\treturn true;\n\t}\n\tif (value.toLowerCase() === 'false') {\n\t\treturn false;\n\t}\n\tif (type === 'int') {\n\t\treturn parseInt(value);\n\t}\n\tif (type === 'multiSelect') {\n\t\treturn JSON.parse(value);\n\t}\n\treturn value;\n};\n"],"names":["convertValue","value","type","toLowerCase","parseInt","JSON","parse"],"mappings":";;;;+BAEaA;;;eAAAA;;;AAAN,MAAMA,eAAe,CAACC,OAAkCC;IAC9D,IAAID,MAAME,WAAW,OAAO,QAAQ;QACnC,OAAO;IACR;IACA,IAAIF,MAAME,WAAW,OAAO,SAAS;QACpC,OAAO;IACR;IACA,IAAID,SAAS,OAAO;QACnB,OAAOE,SAASH;IACjB;IACA,IAAIC,SAAS,eAAe;QAC3B,OAAOG,KAAKC,KAAK,CAACL;IACnB;IACA,OAAOA;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/convertValue.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"81349361729228d4cbd7117408be9761b12c10ae","contentHash":"e8b7c87ecd9174bb562844c996c56b855bdfe0eb1d24cb8b24abfd1ced22ff4f"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/overwriteSetting.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/overwriteSetting.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":32}},"3":{"start":{"line":11,"column":27},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":25},"end":{"line":12,"column":114}},"5":{"start":{"line":12,"column":74},"end":{"line":12,"column":113}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":67},"end":{"line":12,"column":68}},"loc":{"start":{"line":12,"column":74},"end":{"line":12,"column":113}},"line":12}},"branchMap":{},"s":{"0":1,"1":1,"2":40,"3":1,"4":1,"5":40},"f":{"0":40,"1":40},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/overwriteSetting.ts"],"sourcesContent":["import { overrideGenerator } from './overrideGenerator';\n\nexport const overwriteSetting = overrideGenerator((key: string) => process.env[`OVERWRITE_SETTING_${key}`]);\n"],"names":["overwriteSetting","overrideGenerator","key","process","env"],"mappings":";;;;+BAEaA;;;eAAAA;;;mCAFqB;AAE3B,MAAMA,mBAAmBC,IAAAA,oCAAiB,EAAC,CAACC,MAAgBC,QAAQC,GAAG,CAAC,CAAC,kBAAkB,EAAEF,KAAK,CAAC","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/overwriteSetting.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d5ac0e5d7c4a2624ce8d844a7b10f8f97c22f0aa","contentHash":"91c9191195aa1cac2de1b6d38b3627ae5a37f9ab2dcf179bf96e3fec48ef630e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/validateSetting.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/validateSetting.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":31}},"3":{"start":{"line":11,"column":24},"end":{"line":62,"column":1}},"4":{"start":{"line":12,"column":4},"end":{"line":60,"column":5}},"5":{"start":{"line":14,"column":12},"end":{"line":16,"column":13}},"6":{"start":{"line":15,"column":16},"end":{"line":15,"column":93}},"7":{"start":{"line":17,"column":12},"end":{"line":17,"column":18}},"8":{"start":{"line":28,"column":12},"end":{"line":30,"column":13}},"9":{"start":{"line":29,"column":16},"end":{"line":29,"column":93}},"10":{"start":{"line":31,"column":12},"end":{"line":31,"column":18}},"11":{"start":{"line":33,"column":12},"end":{"line":35,"column":13}},"12":{"start":{"line":34,"column":16},"end":{"line":34,"column":93}},"13":{"start":{"line":36,"column":12},"end":{"line":36,"column":18}},"14":{"start":{"line":38,"column":12},"end":{"line":40,"column":13}},"15":{"start":{"line":39,"column":16},"end":{"line":39,"column":89}},"16":{"start":{"line":41,"column":12},"end":{"line":41,"column":18}},"17":{"start":{"line":43,"column":12},"end":{"line":45,"column":13}},"18":{"start":{"line":44,"column":16},"end":{"line":44,"column":91}},"19":{"start":{"line":46,"column":12},"end":{"line":46,"column":18}},"20":{"start":{"line":49,"column":12},"end":{"line":51,"column":13}},"21":{"start":{"line":50,"column":16},"end":{"line":50,"column":93}},"22":{"start":{"line":52,"column":12},"end":{"line":52,"column":18}},"23":{"start":{"line":54,"column":12},"end":{"line":56,"column":13}},"24":{"start":{"line":55,"column":16},"end":{"line":55,"column":90}},"25":{"start":{"line":57,"column":12},"end":{"line":57,"column":18}},"26":{"start":{"line":59,"column":12},"end":{"line":59,"column":24}},"27":{"start":{"line":61,"column":4},"end":{"line":61,"column":16}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":24},"end":{"line":11,"column":25}},"loc":{"start":{"line":11,"column":44},"end":{"line":62,"column":1}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":4},"end":{"line":60,"column":5}},"type":"switch","locations":[{"start":{"line":13,"column":8},"end":{"line":17,"column":18}},{"start":{"line":18,"column":8},"end":{"line":18,"column":22}},{"start":{"line":19,"column":8},"end":{"line":19,"column":27}},{"start":{"line":20,"column":8},"end":{"line":20,"column":24}},{"start":{"line":21,"column":8},"end":{"line":21,"column":24}},{"start":{"line":22,"column":8},"end":{"line":22,"column":21}},{"start":{"line":23,"column":8},"end":{"line":23,"column":20}},{"start":{"line":24,"column":8},"end":{"line":24,"column":20}},{"start":{"line":25,"column":8},"end":{"line":25,"column":22}},{"start":{"line":26,"column":8},"end":{"line":26,"column":24}},{"start":{"line":27,"column":8},"end":{"line":31,"column":18}},{"start":{"line":32,"column":8},"end":{"line":36,"column":18}},{"start":{"line":37,"column":8},"end":{"line":41,"column":18}},{"start":{"line":42,"column":8},"end":{"line":46,"column":18}},{"start":{"line":47,"column":8},"end":{"line":47,"column":22}},{"start":{"line":48,"column":8},"end":{"line":52,"column":18}},{"start":{"line":53,"column":8},"end":{"line":57,"column":18}},{"start":{"line":58,"column":8},"end":{"line":59,"column":24}}],"line":12},"1":{"loc":{"start":{"line":14,"column":12},"end":{"line":16,"column":13}},"type":"if","locations":[{"start":{"line":14,"column":12},"end":{"line":16,"column":13}},{"start":{"line":14,"column":12},"end":{"line":16,"column":13}}],"line":14},"2":{"loc":{"start":{"line":28,"column":12},"end":{"line":30,"column":13}},"type":"if","locations":[{"start":{"line":28,"column":12},"end":{"line":30,"column":13}},{"start":{"line":28,"column":12},"end":{"line":30,"column":13}}],"line":28},"3":{"loc":{"start":{"line":33,"column":12},"end":{"line":35,"column":13}},"type":"if","locations":[{"start":{"line":33,"column":12},"end":{"line":35,"column":13}},{"start":{"line":33,"column":12},"end":{"line":35,"column":13}}],"line":33},"4":{"loc":{"start":{"line":38,"column":12},"end":{"line":40,"column":13}},"type":"if","locations":[{"start":{"line":38,"column":12},"end":{"line":40,"column":13}},{"start":{"line":38,"column":12},"end":{"line":40,"column":13}}],"line":38},"5":{"loc":{"start":{"line":43,"column":12},"end":{"line":45,"column":13}},"type":"if","locations":[{"start":{"line":43,"column":12},"end":{"line":45,"column":13}},{"start":{"line":43,"column":12},"end":{"line":45,"column":13}}],"line":43},"6":{"loc":{"start":{"line":49,"column":12},"end":{"line":51,"column":13}},"type":"if","locations":[{"start":{"line":49,"column":12},"end":{"line":51,"column":13}},{"start":{"line":49,"column":12},"end":{"line":51,"column":13}}],"line":49},"7":{"loc":{"start":{"line":49,"column":16},"end":{"line":49,"column":70}},"type":"binary-expr","locations":[{"start":{"line":49,"column":16},"end":{"line":49,"column":41}},{"start":{"line":49,"column":45},"end":{"line":49,"column":70}}],"line":49},"8":{"loc":{"start":{"line":54,"column":12},"end":{"line":56,"column":13}},"type":"if","locations":[{"start":{"line":54,"column":12},"end":{"line":56,"column":13}},{"start":{"line":54,"column":12},"end":{"line":56,"column":13}}],"line":54}},"s":{"0":1,"1":1,"2":42,"3":1,"4":42,"5":0,"6":0,"7":0,"8":18,"9":2,"10":16,"11":8,"12":1,"13":7,"14":9,"15":1,"16":8,"17":5,"18":1,"19":4,"20":0,"21":0,"22":0,"23":2,"24":1,"25":1,"26":0,"27":36},"f":{"0":42,"1":42},"b":{"0":[0,18,18,18,18,18,18,18,18,18,18,8,9,5,0,0,2,0],"1":[0,0],"2":[2,16],"3":[1,7],"4":[1,8],"5":[1,4],"6":[0,0],"7":[0,0],"8":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/validateSetting.ts"],"sourcesContent":["import type { ISetting } from '@rocket.chat/core-typings';\n\nexport const validateSetting = <T extends ISetting>(_id: T['_id'], type: T['type'], value: T['value'] | unknown): boolean => {\n\tswitch (type) {\n\t\tcase 'asset':\n\t\t\tif (typeof value !== 'object') {\n\t\t\t\tthrow new Error(`Setting ${_id} is of type ${type} but got ${typeof value}`);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'string':\n\t\tcase 'relativeUrl':\n\t\tcase 'password':\n\t\tcase 'language':\n\t\tcase 'color':\n\t\tcase 'font':\n\t\tcase 'code':\n\t\tcase 'action':\n\t\tcase 'roomPick':\n\t\tcase 'group':\n\t\t\tif (typeof value !== 'string') {\n\t\t\t\tthrow new Error(`Setting ${_id} is of type ${type} but got ${typeof value}`);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'boolean':\n\t\t\tif (typeof value !== 'boolean') {\n\t\t\t\tthrow new Error(`Setting ${_id} is of type boolean but got ${typeof value}`);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'int':\n\t\t\tif (typeof value !== 'number') {\n\t\t\t\tthrow new Error(`Setting ${_id} is of type int but got ${typeof value}`);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'multiSelect':\n\t\t\tif (!Array.isArray(value)) {\n\t\t\t\tthrow new Error(`Setting ${_id} is of type array but got ${typeof value}`);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'select':\n\t\tcase 'lookup':\n\t\t\tif (typeof value !== 'string' && typeof value !== 'number') {\n\t\t\t\tthrow new Error(`Setting ${_id} is of type ${type} but got ${typeof value}`);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'date':\n\t\t\tif (!(value instanceof Date)) {\n\t\t\t\tthrow new Error(`Setting ${_id} is of type date but got ${typeof value}`);\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn true;\n\t}\n\n\treturn true;\n};\n"],"names":["validateSetting","_id","type","value","Error","Array","isArray","Date"],"mappings":";;;;+BAEaA;;;eAAAA;;;AAAN,MAAMA,kBAAkB,CAAqBC,KAAeC,MAAiBC;IACnF,OAAQD;QACP,KAAK;YACJ,IAAI,OAAOC,UAAU,UAAU;gBAC9B,MAAM,IAAIC,MAAM,CAAC,QAAQ,EAAEH,IAAI,YAAY,EAAEC,KAAK,SAAS,EAAE,OAAOC,OAAO;YAC5E;YACA;QACD,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;YACJ,IAAI,OAAOA,UAAU,UAAU;gBAC9B,MAAM,IAAIC,MAAM,CAAC,QAAQ,EAAEH,IAAI,YAAY,EAAEC,KAAK,SAAS,EAAE,OAAOC,OAAO;YAC5E;YACA;QACD,KAAK;YACJ,IAAI,OAAOA,UAAU,WAAW;gBAC/B,MAAM,IAAIC,MAAM,CAAC,QAAQ,EAAEH,IAAI,4BAA4B,EAAE,OAAOE,OAAO;YAC5E;YACA;QACD,KAAK;YACJ,IAAI,OAAOA,UAAU,UAAU;gBAC9B,MAAM,IAAIC,MAAM,CAAC,QAAQ,EAAEH,IAAI,wBAAwB,EAAE,OAAOE,OAAO;YACxE;YACA;QACD,KAAK;YACJ,IAAI,CAACE,MAAMC,OAAO,CAACH,QAAQ;gBAC1B,MAAM,IAAIC,MAAM,CAAC,QAAQ,EAAEH,IAAI,0BAA0B,EAAE,OAAOE,OAAO;YAC1E;YACA;QACD,KAAK;QACL,KAAK;YACJ,IAAI,OAAOA,UAAU,YAAY,OAAOA,UAAU,UAAU;gBAC3D,MAAM,IAAIC,MAAM,CAAC,QAAQ,EAAEH,IAAI,YAAY,EAAEC,KAAK,SAAS,EAAE,OAAOC,OAAO;YAC5E;YACA;QACD,KAAK;YACJ,IAAI,CAAEA,CAAAA,iBAAiBI,IAAG,GAAI;gBAC7B,MAAM,IAAIH,MAAM,CAAC,QAAQ,EAAEH,IAAI,yBAAyB,EAAE,OAAOE,OAAO;YACzE;YACA;QACD;YACC,OAAO;IACT;IAEA,OAAO;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/validateSetting.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4d262a03d7589c1a50d68cce13a93a0295e92fcd","contentHash":"4867c36e44ab49ffa97db6ce042d49dc96ead981bb25f90c5c9d3b52e487151e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/CachedSettings.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/CachedSettings.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":30}},"3":{"start":{"line":11,"column":17},"end":{"line":11,"column":48}},"4":{"start":{"line":12,"column":34},"end":{"line":12,"column":81}},"5":{"start":{"line":13,"column":16},"end":{"line":13,"column":60}},"6":{"start":{"line":15,"column":4},"end":{"line":17,"column":6}},"7":{"start":{"line":19,"column":13},"end":{"line":19,"column":76}},"8":{"start":{"line":20,"column":21},"end":{"line":275,"column":1}},"9":{"start":{"line":24,"column":8},"end":{"line":26,"column":9}},"10":{"start":{"line":25,"column":12},"end":{"line":25,"column":19}},"11":{"start":{"line":27,"column":8},"end":{"line":27,"column":26}},"12":{"start":{"line":28,"column":8},"end":{"line":28,"column":27}},"13":{"start":{"line":29,"column":8},"end":{"line":29,"column":59}},"14":{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},"15":{"start":{"line":37,"column":12},"end":{"line":37,"column":87}},"16":{"start":{"line":39,"column":8},"end":{"line":39,"column":35}},"17":{"start":{"line":46,"column":8},"end":{"line":48,"column":9}},"18":{"start":{"line":47,"column":12},"end":{"line":47,"column":87}},"19":{"start":{"line":49,"column":8},"end":{"line":49,"column":35}},"20":{"start":{"line":59,"column":8},"end":{"line":61,"column":9}},"21":{"start":{"line":60,"column":12},"end":{"line":60,"column":87}},"22":{"start":{"line":62,"column":8},"end":{"line":62,"column":127}},"23":{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},"24":{"start":{"line":72,"column":12},"end":{"line":72,"column":87}},"25":{"start":{"line":74,"column":8},"end":{"line":79,"column":15}},"26":{"start":{"line":76,"column":26},"end":{"line":76,"column":39}},"27":{"start":{"line":76,"column":63},"end":{"line":79,"column":13}},"28":{"start":{"line":89,"column":8},"end":{"line":98,"column":9}},"29":{"start":{"line":90,"column":27},"end":{"line":90,"column":36}},"30":{"start":{"line":91,"column":12},"end":{"line":94,"column":16}},"31":{"start":{"line":92,"column":16},"end":{"line":92,"column":31}},"32":{"start":{"line":93,"column":16},"end":{"line":93,"column":62}},"33":{"start":{"line":95,"column":12},"end":{"line":97,"column":14}},"34":{"start":{"line":96,"column":16},"end":{"line":96,"column":43}},"35":{"start":{"line":96,"column":37},"end":{"line":96,"column":41}},"36":{"start":{"line":99,"column":8},"end":{"line":105,"column":9}},"37":{"start":{"line":99,"column":28},"end":{"line":99,"column":46}},"38":{"start":{"line":100,"column":29},"end":{"line":103,"column":14}},"39":{"start":{"line":102,"column":16},"end":{"line":102,"column":134}},"40":{"start":{"line":104,"column":12},"end":{"line":104,"column":31}},"41":{"start":{"line":106,"column":30},"end":{"line":111,"column":15}},"42":{"start":{"line":107,"column":12},"end":{"line":110,"column":16}},"43":{"start":{"line":109,"column":16},"end":{"line":109,"column":134}},"44":{"start":{"line":112,"column":20},"end":{"line":112,"column":61}},"45":{"start":{"line":112,"column":34},"end":{"line":112,"column":60}},"46":{"start":{"line":113,"column":8},"end":{"line":115,"column":10}},"47":{"start":{"line":114,"column":12},"end":{"line":114,"column":36}},"48":{"start":{"line":114,"column":30},"end":{"line":114,"column":34}},"49":{"start":{"line":126,"column":8},"end":{"line":135,"column":9}},"50":{"start":{"line":127,"column":27},"end":{"line":127,"column":36}},"51":{"start":{"line":128,"column":12},"end":{"line":131,"column":16}},"52":{"start":{"line":129,"column":16},"end":{"line":129,"column":31}},"53":{"start":{"line":130,"column":16},"end":{"line":130,"column":56}},"54":{"start":{"line":132,"column":12},"end":{"line":134,"column":14}},"55":{"start":{"line":133,"column":16},"end":{"line":133,"column":43}},"56":{"start":{"line":133,"column":37},"end":{"line":133,"column":41}},"57":{"start":{"line":136,"column":8},"end":{"line":136,"column":147}},"58":{"start":{"line":137,"column":8},"end":{"line":137,"column":44}},"59":{"start":{"line":148,"column":8},"end":{"line":152,"column":9}},"60":{"start":{"line":150,"column":12},"end":{"line":150,"column":128}},"61":{"start":{"line":151,"column":12},"end":{"line":151,"column":33}},"62":{"start":{"line":151,"column":23},"end":{"line":151,"column":32}},"63":{"start":{"line":153,"column":8},"end":{"line":153,"column":48}},"64":{"start":{"line":164,"column":29},"end":{"line":164,"column":51}},"65":{"start":{"line":165,"column":8},"end":{"line":165,"column":78}},"66":{"start":{"line":176,"column":20},"end":{"line":181,"column":23}},"67":{"start":{"line":176,"column":35},"end":{"line":181,"column":22}},"68":{"start":{"line":177,"column":16},"end":{"line":180,"column":20}},"69":{"start":{"line":179,"column":20},"end":{"line":179,"column":138}},"70":{"start":{"line":182,"column":8},"end":{"line":184,"column":10}},"71":{"start":{"line":183,"column":12},"end":{"line":183,"column":36}},"72":{"start":{"line":183,"column":30},"end":{"line":183,"column":34}},"73":{"start":{"line":196,"column":29},"end":{"line":196,"column":51}},"74":{"start":{"line":197,"column":8},"end":{"line":197,"column":80}},"75":{"start":{"line":208,"column":8},"end":{"line":210,"column":9}},"76":{"start":{"line":209,"column":12},"end":{"line":209,"column":19}},"77":{"start":{"line":211,"column":8},"end":{"line":211,"column":43}},"78":{"start":{"line":212,"column":8},"end":{"line":222,"column":9}},"79":{"start":{"line":213,"column":12},"end":{"line":220,"column":15}},"80":{"start":{"line":215,"column":16},"end":{"line":215,"column":158}},"81":{"start":{"line":216,"column":16},"end":{"line":219,"column":19}},"82":{"start":{"line":221,"column":12},"end":{"line":221,"column":19}},"83":{"start":{"line":223,"column":8},"end":{"line":223,"column":153}},"84":{"start":{"line":224,"column":8},"end":{"line":227,"column":11}},"85":{"start":{"line":230,"column":8},"end":{"line":239,"column":9}},"86":{"start":{"line":231,"column":27},"end":{"line":231,"column":36}},"87":{"start":{"line":232,"column":12},"end":{"line":235,"column":16}},"88":{"start":{"line":233,"column":16},"end":{"line":233,"column":31}},"89":{"start":{"line":234,"column":16},"end":{"line":234,"column":65}},"90":{"start":{"line":236,"column":12},"end":{"line":238,"column":14}},"91":{"start":{"line":237,"column":16},"end":{"line":237,"column":43}},"92":{"start":{"line":237,"column":37},"end":{"line":237,"column":41}},"93":{"start":{"line":240,"column":8},"end":{"line":246,"column":11}},"94":{"start":{"line":243,"column":12},"end":{"line":245,"column":13}},"95":{"start":{"line":244,"column":16},"end":{"line":244,"column":39}},"96":{"start":{"line":247,"column":8},"end":{"line":247,"column":53}},"97":{"start":{"line":250,"column":22},"end":{"line":250,"column":31}},"98":{"start":{"line":251,"column":8},"end":{"line":259,"column":11}},"99":{"start":{"line":252,"column":12},"end":{"line":257,"column":13}},"100":{"start":{"line":253,"column":37},"end":{"line":253,"column":59}},"101":{"start":{"line":254,"column":27},"end":{"line":254,"column":93}},"102":{"start":{"line":255,"column":16},"end":{"line":255,"column":31}},"103":{"start":{"line":256,"column":16},"end":{"line":256,"column":35}},"104":{"start":{"line":258,"column":12},"end":{"line":258,"column":32}},"105":{"start":{"line":264,"column":8},"end":{"line":266,"column":9}},"106":{"start":{"line":265,"column":12},"end":{"line":265,"column":24}},"107":{"start":{"line":267,"column":8},"end":{"line":267,"column":31}},"108":{"start":{"line":270,"column":8},"end":{"line":273,"column":15}},"109":{"start":{"line":270,"column":96},"end":{"line":273,"column":13}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":14,"column":9},"end":{"line":14,"column":33}},"loc":{"start":{"line":14,"column":39},"end":{"line":18,"column":1}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":23,"column":5},"end":{"line":23,"column":6}},"loc":{"start":{"line":23,"column":19},"end":{"line":30,"column":5}},"line":23},"3":{"name":"(anonymous_3)","decl":{"start":{"line":35,"column":5},"end":{"line":35,"column":6}},"loc":{"start":{"line":35,"column":14},"end":{"line":40,"column":5}},"line":35},"4":{"name":"(anonymous_4)","decl":{"start":{"line":45,"column":5},"end":{"line":45,"column":6}},"loc":{"start":{"line":45,"column":21},"end":{"line":50,"column":5}},"line":45},"5":{"name":"(anonymous_5)","decl":{"start":{"line":57,"column":5},"end":{"line":57,"column":6}},"loc":{"start":{"line":57,"column":14},"end":{"line":63,"column":5}},"line":57},"6":{"name":"(anonymous_6)","decl":{"start":{"line":70,"column":5},"end":{"line":70,"column":6}},"loc":{"start":{"line":70,"column":22},"end":{"line":80,"column":5}},"line":70},"7":{"name":"(anonymous_7)","decl":{"start":{"line":76,"column":17},"end":{"line":76,"column":18}},"loc":{"start":{"line":76,"column":26},"end":{"line":76,"column":39}},"line":76},"8":{"name":"(anonymous_8)","decl":{"start":{"line":76,"column":45},"end":{"line":76,"column":46}},"loc":{"start":{"line":76,"column":63},"end":{"line":79,"column":13}},"line":76},"9":{"name":"(anonymous_9)","decl":{"start":{"line":88,"column":5},"end":{"line":88,"column":6}},"loc":{"start":{"line":88,"column":34},"end":{"line":116,"column":5}},"line":88},"10":{"name":"(anonymous_10)","decl":{"start":{"line":91,"column":42},"end":{"line":91,"column":43}},"loc":{"start":{"line":91,"column":46},"end":{"line":94,"column":13}},"line":91},"11":{"name":"(anonymous_11)","decl":{"start":{"line":95,"column":19},"end":{"line":95,"column":20}},"loc":{"start":{"line":95,"column":23},"end":{"line":97,"column":13}},"line":95},"12":{"name":"(anonymous_12)","decl":{"start":{"line":96,"column":31},"end":{"line":96,"column":32}},"loc":{"start":{"line":96,"column":37},"end":{"line":96,"column":41}},"line":96},"13":{"name":"(anonymous_13)","decl":{"start":{"line":99,"column":22},"end":{"line":99,"column":23}},"loc":{"start":{"line":99,"column":28},"end":{"line":99,"column":46}},"line":99},"14":{"name":"(anonymous_14)","decl":{"start":{"line":100,"column":37},"end":{"line":100,"column":38}},"loc":{"start":{"line":100,"column":43},"end":{"line":103,"column":13}},"line":100},"15":{"name":"(anonymous_15)","decl":{"start":{"line":106,"column":59},"end":{"line":106,"column":60}},"loc":{"start":{"line":106,"column":63},"end":{"line":111,"column":9}},"line":106},"16":{"name":"(anonymous_16)","decl":{"start":{"line":107,"column":29},"end":{"line":107,"column":30}},"loc":{"start":{"line":107,"column":35},"end":{"line":110,"column":13}},"line":107},"17":{"name":"(anonymous_17)","decl":{"start":{"line":112,"column":28},"end":{"line":112,"column":29}},"loc":{"start":{"line":112,"column":34},"end":{"line":112,"column":60}},"line":112},"18":{"name":"(anonymous_18)","decl":{"start":{"line":113,"column":15},"end":{"line":113,"column":16}},"loc":{"start":{"line":113,"column":19},"end":{"line":115,"column":9}},"line":113},"19":{"name":"(anonymous_19)","decl":{"start":{"line":114,"column":24},"end":{"line":114,"column":25}},"loc":{"start":{"line":114,"column":30},"end":{"line":114,"column":34}},"line":114},"20":{"name":"(anonymous_20)","decl":{"start":{"line":124,"column":5},"end":{"line":124,"column":6}},"loc":{"start":{"line":124,"column":28},"end":{"line":138,"column":5}},"line":124},"21":{"name":"(anonymous_21)","decl":{"start":{"line":128,"column":42},"end":{"line":128,"column":43}},"loc":{"start":{"line":128,"column":46},"end":{"line":131,"column":13}},"line":128},"22":{"name":"(anonymous_22)","decl":{"start":{"line":132,"column":19},"end":{"line":132,"column":20}},"loc":{"start":{"line":132,"column":23},"end":{"line":134,"column":13}},"line":132},"23":{"name":"(anonymous_23)","decl":{"start":{"line":133,"column":31},"end":{"line":133,"column":32}},"loc":{"start":{"line":133,"column":37},"end":{"line":133,"column":41}},"line":133},"24":{"name":"(anonymous_24)","decl":{"start":{"line":147,"column":5},"end":{"line":147,"column":6}},"loc":{"start":{"line":147,"column":32},"end":{"line":154,"column":5}},"line":147},"25":{"name":"(anonymous_25)","decl":{"start":{"line":151,"column":19},"end":{"line":151,"column":20}},"loc":{"start":{"line":151,"column":23},"end":{"line":151,"column":32}},"line":151},"26":{"name":"(anonymous_26)","decl":{"start":{"line":163,"column":5},"end":{"line":163,"column":6}},"loc":{"start":{"line":163,"column":35},"end":{"line":166,"column":5}},"line":163},"27":{"name":"(anonymous_27)","decl":{"start":{"line":175,"column":5},"end":{"line":175,"column":6}},"loc":{"start":{"line":175,"column":44},"end":{"line":185,"column":5}},"line":175},"28":{"name":"(anonymous_28)","decl":{"start":{"line":176,"column":29},"end":{"line":176,"column":30}},"loc":{"start":{"line":176,"column":35},"end":{"line":181,"column":22}},"line":176},"29":{"name":"(anonymous_29)","decl":{"start":{"line":176,"column":51},"end":{"line":176,"column":52}},"loc":{"start":{"line":176,"column":55},"end":{"line":181,"column":13}},"line":176},"30":{"name":"(anonymous_30)","decl":{"start":{"line":177,"column":34},"end":{"line":177,"column":35}},"loc":{"start":{"line":177,"column":40},"end":{"line":180,"column":17}},"line":177},"31":{"name":"(anonymous_31)","decl":{"start":{"line":182,"column":15},"end":{"line":182,"column":16}},"loc":{"start":{"line":182,"column":19},"end":{"line":184,"column":9}},"line":182},"32":{"name":"(anonymous_32)","decl":{"start":{"line":183,"column":24},"end":{"line":183,"column":25}},"loc":{"start":{"line":183,"column":30},"end":{"line":183,"column":34}},"line":183},"33":{"name":"(anonymous_33)","decl":{"start":{"line":195,"column":5},"end":{"line":195,"column":6}},"loc":{"start":{"line":195,"column":39},"end":{"line":198,"column":5}},"line":195},"34":{"name":"(anonymous_34)","decl":{"start":{"line":206,"column":5},"end":{"line":206,"column":6}},"loc":{"start":{"line":206,"column":17},"end":{"line":228,"column":5}},"line":206},"35":{"name":"(anonymous_35)","decl":{"start":{"line":213,"column":31},"end":{"line":213,"column":32}},"loc":{"start":{"line":213,"column":35},"end":{"line":220,"column":13}},"line":213},"36":{"name":"(anonymous_36)","decl":{"start":{"line":229,"column":23},"end":{"line":229,"column":24}},"loc":{"start":{"line":229,"column":55},"end":{"line":248,"column":5}},"line":229},"37":{"name":"(anonymous_37)","decl":{"start":{"line":232,"column":42},"end":{"line":232,"column":43}},"loc":{"start":{"line":232,"column":46},"end":{"line":235,"column":13}},"line":232},"38":{"name":"(anonymous_38)","decl":{"start":{"line":236,"column":19},"end":{"line":236,"column":20}},"loc":{"start":{"line":236,"column":23},"end":{"line":238,"column":13}},"line":236},"39":{"name":"(anonymous_39)","decl":{"start":{"line":237,"column":31},"end":{"line":237,"column":32}},"loc":{"start":{"line":237,"column":37},"end":{"line":237,"column":41}},"line":237},"40":{"name":"(anonymous_40)","decl":{"start":{"line":242,"column":18},"end":{"line":242,"column":19}},"loc":{"start":{"line":242,"column":36},"end":{"line":246,"column":9}},"line":242},"41":{"name":"(anonymous_41)","decl":{"start":{"line":249,"column":23},"end":{"line":249,"column":24}},"loc":{"start":{"line":249,"column":62},"end":{"line":260,"column":5}},"line":249},"42":{"name":"(anonymous_42)","decl":{"start":{"line":251,"column":28},"end":{"line":251,"column":29}},"loc":{"start":{"line":251,"column":44},"end":{"line":259,"column":9}},"line":251},"43":{"name":"(anonymous_43)","decl":{"start":{"line":263,"column":5},"end":{"line":263,"column":6}},"loc":{"start":{"line":263,"column":17},"end":{"line":268,"column":5}},"line":263},"44":{"name":"(anonymous_44)","decl":{"start":{"line":269,"column":4},"end":{"line":269,"column":5}},"loc":{"start":{"line":269,"column":24},"end":{"line":274,"column":5}},"line":269},"45":{"name":"(anonymous_45)","decl":{"start":{"line":270,"column":85},"end":{"line":270,"column":86}},"loc":{"start":{"line":270,"column":96},"end":{"line":273,"column":13}},"line":270}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":11},"end":{"line":17,"column":5}},"type":"cond-expr","locations":[{"start":{"line":15,"column":35},"end":{"line":15,"column":38}},{"start":{"line":15,"column":41},"end":{"line":17,"column":5}}],"line":15},"1":{"loc":{"start":{"line":15,"column":11},"end":{"line":15,"column":32}},"type":"binary-expr","locations":[{"start":{"line":15,"column":11},"end":{"line":15,"column":14}},{"start":{"line":15,"column":18},"end":{"line":15,"column":32}}],"line":15},"2":{"loc":{"start":{"line":19,"column":13},"end":{"line":19,"column":76}},"type":"binary-expr","locations":[{"start":{"line":19,"column":13},"end":{"line":19,"column":51}},{"start":{"line":19,"column":55},"end":{"line":19,"column":76}}],"line":19},"3":{"loc":{"start":{"line":24,"column":8},"end":{"line":26,"column":9}},"type":"if","locations":[{"start":{"line":24,"column":8},"end":{"line":26,"column":9}},{"start":{"line":24,"column":8},"end":{"line":26,"column":9}}],"line":24},"4":{"loc":{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},"type":"if","locations":[{"start":{"line":36,"column":8},"end":{"line":38,"column":9}},{"start":{"line":36,"column":8},"end":{"line":38,"column":9}}],"line":36},"5":{"loc":{"start":{"line":36,"column":12},"end":{"line":36,"column":31}},"type":"binary-expr","locations":[{"start":{"line":36,"column":12},"end":{"line":36,"column":23}},{"start":{"line":36,"column":27},"end":{"line":36,"column":31}}],"line":36},"6":{"loc":{"start":{"line":46,"column":8},"end":{"line":48,"column":9}},"type":"if","locations":[{"start":{"line":46,"column":8},"end":{"line":48,"column":9}},{"start":{"line":46,"column":8},"end":{"line":48,"column":9}}],"line":46},"7":{"loc":{"start":{"line":46,"column":12},"end":{"line":46,"column":31}},"type":"binary-expr","locations":[{"start":{"line":46,"column":12},"end":{"line":46,"column":23}},{"start":{"line":46,"column":27},"end":{"line":46,"column":31}}],"line":46},"8":{"loc":{"start":{"line":59,"column":8},"end":{"line":61,"column":9}},"type":"if","locations":[{"start":{"line":59,"column":8},"end":{"line":61,"column":9}},{"start":{"line":59,"column":8},"end":{"line":61,"column":9}}],"line":59},"9":{"loc":{"start":{"line":59,"column":12},"end":{"line":59,"column":31}},"type":"binary-expr","locations":[{"start":{"line":59,"column":12},"end":{"line":59,"column":23}},{"start":{"line":59,"column":27},"end":{"line":59,"column":31}}],"line":59},"10":{"loc":{"start":{"line":62,"column":15},"end":{"line":62,"column":126}},"type":"cond-expr","locations":[{"start":{"line":62,"column":96},"end":{"line":62,"column":102}},{"start":{"line":62,"column":105},"end":{"line":62,"column":126}}],"line":62},"11":{"loc":{"start":{"line":62,"column":15},"end":{"line":62,"column":93}},"type":"binary-expr","locations":[{"start":{"line":62,"column":15},"end":{"line":62,"column":63}},{"start":{"line":62,"column":67},"end":{"line":62,"column":93}}],"line":62},"12":{"loc":{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},"type":"if","locations":[{"start":{"line":71,"column":8},"end":{"line":73,"column":9}},{"start":{"line":71,"column":8},"end":{"line":73,"column":9}}],"line":71},"13":{"loc":{"start":{"line":71,"column":12},"end":{"line":71,"column":31}},"type":"binary-expr","locations":[{"start":{"line":71,"column":12},"end":{"line":71,"column":23}},{"start":{"line":71,"column":27},"end":{"line":71,"column":31}}],"line":71},"14":{"loc":{"start":{"line":89,"column":8},"end":{"line":98,"column":9}},"type":"if","locations":[{"start":{"line":89,"column":8},"end":{"line":98,"column":9}},{"start":{"line":89,"column":8},"end":{"line":98,"column":9}}],"line":89},"15":{"loc":{"start":{"line":99,"column":8},"end":{"line":105,"column":9}},"type":"if","locations":[{"start":{"line":99,"column":8},"end":{"line":105,"column":9}},{"start":{"line":99,"column":8},"end":{"line":105,"column":9}}],"line":99},"16":{"loc":{"start":{"line":102,"column":23},"end":{"line":102,"column":133}},"type":"cond-expr","locations":[{"start":{"line":102,"column":103},"end":{"line":102,"column":109}},{"start":{"line":102,"column":112},"end":{"line":102,"column":133}}],"line":102},"17":{"loc":{"start":{"line":102,"column":23},"end":{"line":102,"column":100}},"type":"binary-expr","locations":[{"start":{"line":102,"column":23},"end":{"line":102,"column":70}},{"start":{"line":102,"column":74},"end":{"line":102,"column":100}}],"line":102},"18":{"loc":{"start":{"line":109,"column":23},"end":{"line":109,"column":133}},"type":"cond-expr","locations":[{"start":{"line":109,"column":103},"end":{"line":109,"column":109}},{"start":{"line":109,"column":112},"end":{"line":109,"column":133}}],"line":109},"19":{"loc":{"start":{"line":109,"column":23},"end":{"line":109,"column":100}},"type":"binary-expr","locations":[{"start":{"line":109,"column":23},"end":{"line":109,"column":70}},{"start":{"line":109,"column":74},"end":{"line":109,"column":100}}],"line":109},"20":{"loc":{"start":{"line":126,"column":8},"end":{"line":135,"column":9}},"type":"if","locations":[{"start":{"line":126,"column":8},"end":{"line":135,"column":9}},{"start":{"line":126,"column":8},"end":{"line":135,"column":9}}],"line":126},"21":{"loc":{"start":{"line":136,"column":8},"end":{"line":136,"column":146}},"type":"binary-expr","locations":[{"start":{"line":136,"column":8},"end":{"line":136,"column":27}},{"start":{"line":136,"column":31},"end":{"line":136,"column":146}}],"line":136},"22":{"loc":{"start":{"line":136,"column":34},"end":{"line":136,"column":145}},"type":"cond-expr","locations":[{"start":{"line":136,"column":115},"end":{"line":136,"column":121}},{"start":{"line":136,"column":124},"end":{"line":136,"column":145}}],"line":136},"23":{"loc":{"start":{"line":136,"column":34},"end":{"line":136,"column":112}},"type":"binary-expr","locations":[{"start":{"line":136,"column":34},"end":{"line":136,"column":82}},{"start":{"line":136,"column":86},"end":{"line":136,"column":112}}],"line":136},"24":{"loc":{"start":{"line":148,"column":8},"end":{"line":152,"column":9}},"type":"if","locations":[{"start":{"line":148,"column":8},"end":{"line":152,"column":9}},{"start":{"line":148,"column":8},"end":{"line":152,"column":9}}],"line":148},"25":{"loc":{"start":{"line":150,"column":15},"end":{"line":150,"column":126}},"type":"cond-expr","locations":[{"start":{"line":150,"column":96},"end":{"line":150,"column":102}},{"start":{"line":150,"column":105},"end":{"line":150,"column":126}}],"line":150},"26":{"loc":{"start":{"line":150,"column":15},"end":{"line":150,"column":93}},"type":"binary-expr","locations":[{"start":{"line":150,"column":15},"end":{"line":150,"column":63}},{"start":{"line":150,"column":67},"end":{"line":150,"column":93}}],"line":150},"27":{"loc":{"start":{"line":179,"column":27},"end":{"line":179,"column":137}},"type":"cond-expr","locations":[{"start":{"line":179,"column":107},"end":{"line":179,"column":113}},{"start":{"line":179,"column":116},"end":{"line":179,"column":137}}],"line":179},"28":{"loc":{"start":{"line":179,"column":27},"end":{"line":179,"column":104}},"type":"binary-expr","locations":[{"start":{"line":179,"column":27},"end":{"line":179,"column":74}},{"start":{"line":179,"column":78},"end":{"line":179,"column":104}}],"line":179},"29":{"loc":{"start":{"line":208,"column":8},"end":{"line":210,"column":9}},"type":"if","locations":[{"start":{"line":208,"column":8},"end":{"line":210,"column":9}},{"start":{"line":208,"column":8},"end":{"line":210,"column":9}}],"line":208},"30":{"loc":{"start":{"line":208,"column":12},"end":{"line":208,"column":179}},"type":"binary-expr","locations":[{"start":{"line":208,"column":12},"end":{"line":208,"column":38}},{"start":{"line":208,"column":42},"end":{"line":208,"column":179}}],"line":208},"31":{"loc":{"start":{"line":208,"column":43},"end":{"line":208,"column":161}},"type":"cond-expr","locations":[{"start":{"line":208,"column":131},"end":{"line":208,"column":137}},{"start":{"line":208,"column":140},"end":{"line":208,"column":161}}],"line":208},"32":{"loc":{"start":{"line":208,"column":43},"end":{"line":208,"column":128}},"type":"binary-expr","locations":[{"start":{"line":208,"column":43},"end":{"line":208,"column":98}},{"start":{"line":208,"column":102},"end":{"line":208,"column":128}}],"line":208},"33":{"loc":{"start":{"line":212,"column":8},"end":{"line":222,"column":9}},"type":"if","locations":[{"start":{"line":212,"column":8},"end":{"line":222,"column":9}},{"start":{"line":212,"column":8},"end":{"line":222,"column":9}}],"line":212},"34":{"loc":{"start":{"line":215,"column":38},"end":{"line":215,"column":156}},"type":"cond-expr","locations":[{"start":{"line":215,"column":126},"end":{"line":215,"column":132}},{"start":{"line":215,"column":135},"end":{"line":215,"column":156}}],"line":215},"35":{"loc":{"start":{"line":215,"column":38},"end":{"line":215,"column":123}},"type":"binary-expr","locations":[{"start":{"line":215,"column":38},"end":{"line":215,"column":93}},{"start":{"line":215,"column":97},"end":{"line":215,"column":123}}],"line":215},"36":{"loc":{"start":{"line":218,"column":20},"end":{"line":218,"column":141}},"type":"cond-expr","locations":[{"start":{"line":218,"column":110},"end":{"line":218,"column":116}},{"start":{"line":218,"column":119},"end":{"line":218,"column":141}}],"line":218},"37":{"loc":{"start":{"line":218,"column":20},"end":{"line":218,"column":107}},"type":"binary-expr","locations":[{"start":{"line":218,"column":20},"end":{"line":218,"column":76}},{"start":{"line":218,"column":80},"end":{"line":218,"column":107}}],"line":218},"38":{"loc":{"start":{"line":223,"column":30},"end":{"line":223,"column":151}},"type":"cond-expr","locations":[{"start":{"line":223,"column":120},"end":{"line":223,"column":126}},{"start":{"line":223,"column":129},"end":{"line":223,"column":151}}],"line":223},"39":{"loc":{"start":{"line":223,"column":30},"end":{"line":223,"column":117}},"type":"binary-expr","locations":[{"start":{"line":223,"column":30},"end":{"line":223,"column":86}},{"start":{"line":223,"column":90},"end":{"line":223,"column":117}}],"line":223},"40":{"loc":{"start":{"line":226,"column":12},"end":{"line":226,"column":133}},"type":"cond-expr","locations":[{"start":{"line":226,"column":102},"end":{"line":226,"column":108}},{"start":{"line":226,"column":111},"end":{"line":226,"column":133}}],"line":226},"41":{"loc":{"start":{"line":226,"column":12},"end":{"line":226,"column":99}},"type":"binary-expr","locations":[{"start":{"line":226,"column":12},"end":{"line":226,"column":68}},{"start":{"line":226,"column":72},"end":{"line":226,"column":99}}],"line":226},"42":{"loc":{"start":{"line":230,"column":8},"end":{"line":239,"column":9}},"type":"if","locations":[{"start":{"line":230,"column":8},"end":{"line":239,"column":9}},{"start":{"line":230,"column":8},"end":{"line":239,"column":9}}],"line":230},"43":{"loc":{"start":{"line":243,"column":12},"end":{"line":245,"column":13}},"type":"if","locations":[{"start":{"line":243,"column":12},"end":{"line":245,"column":13}},{"start":{"line":243,"column":12},"end":{"line":245,"column":13}}],"line":243},"44":{"loc":{"start":{"line":252,"column":12},"end":{"line":257,"column":13}},"type":"if","locations":[{"start":{"line":252,"column":12},"end":{"line":257,"column":13}},{"start":{"line":252,"column":12},"end":{"line":257,"column":13}}],"line":252},"45":{"loc":{"start":{"line":254,"column":27},"end":{"line":254,"column":93}},"type":"binary-expr","locations":[{"start":{"line":254,"column":27},"end":{"line":254,"column":41}},{"start":{"line":254,"column":45},"end":{"line":254,"column":93}}],"line":254},"46":{"loc":{"start":{"line":264,"column":8},"end":{"line":266,"column":9}},"type":"if","locations":[{"start":{"line":264,"column":8},"end":{"line":266,"column":9}},{"start":{"line":264,"column":8},"end":{"line":266,"column":9}}],"line":264},"47":{"loc":{"start":{"line":271,"column":26},"end":{"line":271,"column":57}},"type":"cond-expr","locations":[{"start":{"line":271,"column":50},"end":{"line":271,"column":51}},{"start":{"line":271,"column":54},"end":{"line":271,"column":57}}],"line":271}},"s":{"0":1,"1":1,"2":19,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":18,"10":0,"11":18,"12":18,"13":18,"14":18,"15":0,"16":18,"17":28,"18":0,"19":28,"20":6,"21":0,"22":6,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":3,"50":1,"51":1,"52":1,"53":1,"54":1,"55":0,"56":0,"57":2,"58":2,"59":0,"60":0,"61":0,"62":0,"63":0,"64":2,"65":2,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":73,"76":34,"77":39,"78":39,"79":2,"80":2,"81":2,"82":2,"83":37,"84":37,"85":3,"86":1,"87":1,"88":1,"89":1,"90":1,"91":0,"92":0,"93":2,"94":2,"95":1,"96":2,"97":2,"98":2,"99":3,"100":2,"101":2,"102":2,"103":2,"104":3,"105":0,"106":0,"107":0,"108":19,"109":7},"f":{"0":19,"1":1,"2":18,"3":18,"4":28,"5":6,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":3,"21":1,"22":0,"23":0,"24":0,"25":0,"26":2,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":73,"35":2,"36":3,"37":1,"38":0,"39":0,"40":2,"41":2,"42":3,"43":0,"44":19,"45":7},"b":{"0":[0,1],"1":[1,1],"2":[1,1],"3":[0,18],"4":[0,18],"5":[18,0],"6":[0,28],"7":[28,0],"8":[0,6],"9":[6,0],"10":[0,6],"11":[6,6],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[1,2],"21":[2,1],"22":[0,1],"23":[1,1],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[34,39],"30":[73,43],"31":[0,43],"32":[43,43],"33":[2,37],"34":[0,2],"35":[2,2],"36":[0,2],"37":[2,2],"38":[0,37],"39":[37,37],"40":[0,37],"41":[37,37],"42":[1,2],"43":[1,1],"44":[2,1],"45":[2,1],"46":[0,0],"47":[0,7]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/CachedSettings.ts"],"sourcesContent":["import type { ISetting, SettingValue } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport _ from 'underscore';\n\nimport { SystemLogger } from '../../../server/lib/logger/system';\n\nconst warn = process.env.NODE_ENV === 'development' || process.env.TEST_MODE;\n\ntype SettingsConfig = {\n\tdebounce: number;\n};\n\ntype OverCustomSettingsConfig = Partial<SettingsConfig>;\n\nexport interface ICachedSettings {\n\t/*\n\t * @description: The settings object as ready\n\t */\n\tinitialized(): void;\n\n\thas(_id: ISetting['_id']): boolean;\n\n\tgetSetting(_id: ISetting['_id']): ISetting | undefined;\n\n\tget<T extends SettingValue = SettingValue>(_id: ISetting['_id']): T;\n\n\tgetByRegexp<T extends SettingValue = SettingValue>(_id: RegExp): [string, T][];\n\n\twatchMultiple<T extends SettingValue = SettingValue>(_id: ISetting['_id'][], callback: (settings: T[]) => void): () => void;\n\n\twatch<T extends SettingValue = SettingValue>(_id: ISetting['_id'], cb: (args: T) => void, config?: OverCustomSettingsConfig): () => void;\n\n\twatchOnce<T extends SettingValue = SettingValue>(\n\t\t_id: ISetting['_id'],\n\t\tcb: (args: T) => void,\n\t\tconfig?: OverCustomSettingsConfig,\n\t): () => void;\n\n\tchange<T extends SettingValue = SettingValue>(\n\t\t_id: ISetting['_id'],\n\t\tcallback: (args: T) => void,\n\t\tconfig?: OverCustomSettingsConfig,\n\t): () => void;\n\n\tchangeMultiple<T extends SettingValue = SettingValue>(\n\t\t_ids: ISetting['_id'][],\n\t\tcallback: (settings: T[]) => void,\n\t\tconfig?: OverCustomSettingsConfig,\n\t): () => void;\n\n\tchangeOnce<T extends SettingValue = SettingValue>(\n\t\t_id: ISetting['_id'],\n\t\tcallback: (args: T) => void,\n\t\tconfig?: OverCustomSettingsConfig,\n\t): () => void;\n\n\tset(record: ISetting): void;\n\n\tgetConfig(config?: OverCustomSettingsConfig): SettingsConfig;\n\n\twatchByRegex(regex: RegExp, cb: (...args: [string, SettingValue]) => void, config?: OverCustomSettingsConfig): () => void;\n\n\tchangeByRegex(regex: RegExp, callback: (...args: [string, SettingValue]) => void, config?: OverCustomSettingsConfig): () => void;\n\n\tonReady(cb: () => void): void;\n}\n\n/**\n * Class responsible for setting up the settings, cache and propagation changes\n * Should be agnostic to the actual settings implementation, running on meteor or standalone\n *\n * You should not instantiate this class directly, only for testing purposes\n *\n * @extends Emitter\n * @alpha\n */\nexport class CachedSettings\n\textends Emitter<\n\t\t{\n\t\t\t'*': [string, SettingValue];\n\t\t} & {\n\t\t\tready: undefined;\n\t\t\t[k: string]: SettingValue;\n\t\t}\n\t>\n\timplements ICachedSettings\n{\n\tready = false;\n\n\tstore = new Map<string, ISetting>();\n\n\t/**\n\t * The settings object as ready\n\t */\n\tinitialized(): void {\n\t\tif (this.ready) {\n\t\t\treturn;\n\t\t}\n\t\tthis.ready = true;\n\t\tthis.emit('ready');\n\t\tSystemLogger.debug('Settings initialized');\n\t}\n\n\t/**\n\t * returns if the setting is defined\n\t * @param _id - The setting id\n\t * @returns {boolean}\n\t */\n\tpublic has(_id: ISetting['_id']): boolean {\n\t\tif (!this.ready && warn) {\n\t\t\tSystemLogger.warn(`Settings not initialized yet. getting: ${_id}`);\n\t\t}\n\t\treturn this.store.has(_id);\n\t}\n\n\t/**\n\t * Gets the current Object of the setting\n\t * @param _id - The setting id\n\t * @returns {ISetting} - The current Object of the setting\n\t */\n\tpublic getSetting(_id: ISetting['_id']): ISetting | undefined {\n\t\tif (!this.ready && warn) {\n\t\t\tSystemLogger.warn(`Settings not initialized yet. getting: ${_id}`);\n\t\t}\n\t\treturn this.store.get(_id);\n\t}\n\n\t/**\n\t * Gets the current value of the setting\n\t * - In development mode if you are trying to get the value of a setting that is not defined, it will give an warning, in theory it makes sense, there no reason to do that\n\t * - The setting's value will be cached in memory so it won't call the DB every time you fetch a particular setting\n\t * @param _id - The setting id\n\t * @returns {SettingValue} - The current value of the setting\n\t */\n\tpublic get<T extends SettingValue = SettingValue>(_id: ISetting['_id']): T {\n\t\tif (!this.ready && warn) {\n\t\t\tSystemLogger.warn(`Settings not initialized yet. getting: ${_id}`);\n\t\t}\n\t\treturn this.store.get(_id)?.value as T;\n\t}\n\n\t/**\n\t * Gets the current value of the setting\n\t * - In development mode if you are trying to get the value of a setting that is not defined, it will give an warning, in theory it makes sense, there no reason to do that\n\t * @deprecated\n\t * @param _id - The setting id\n\t * @returns {SettingValue} - The current value of the setting\n\t */\n\tpublic getByRegexp<T extends SettingValue = SettingValue>(_id: RegExp): [string, T][] {\n\t\tif (!this.ready && warn) {\n\t\t\tSystemLogger.warn(`Settings not initialized yet. getting: ${_id}`);\n\t\t}\n\n\t\treturn [...this.store.entries()].filter(([key]) => _id.test(key)).map(([key, setting]) => [key, setting.value]) as [string, T][];\n\t}\n\n\t/**\n\t * Get the current value of the settings, and keep track of changes\n\t * - This callback is debounced\n\t * - The callback is not fire until the settings got initialized\n\t * @param _ids - Array of setting id\n\t * @param callback - The callback to run\n\t * @returns {() => void} - A function that can be used to cancel the observe\n\t */\n\tpublic watchMultiple<T extends SettingValue = SettingValue>(_id: ISetting['_id'][], callback: (settings: T[]) => void): () => void {\n\t\tif (!this.ready) {\n\t\t\tconst cancel = new Set<() => void>();\n\n\t\t\tcancel.add(\n\t\t\t\tthis.once('ready', (): void => {\n\t\t\t\t\tcancel.clear();\n\t\t\t\t\tcancel.add(this.watchMultiple(_id, callback));\n\t\t\t\t}),\n\t\t\t);\n\t\t\treturn (): void => {\n\t\t\t\tcancel.forEach((fn) => fn());\n\t\t\t};\n\t\t}\n\n\t\tif (_id.every((id) => this.store.has(id))) {\n\t\t\tconst settings = _id.map((id) => this.store.get(id)?.value);\n\t\t\tcallback(settings as T[]);\n\t\t}\n\t\tconst mergeFunction = _.debounce((): void => {\n\t\t\tcallback(_id.map((id) => this.store.get(id)?.value) as T[]);\n\t\t}, 100);\n\n\t\tconst fns = _id.map((id) => this.on(id, mergeFunction));\n\t\treturn (): void => {\n\t\t\tfns.forEach((fn) => fn());\n\t\t};\n\t}\n\n\t/**\n\t * Get the current value of the setting, and keep track of changes\n\t * - This callback is debounced\n\t * - The callback is not fire until the settings got initialized\n\t * @param _id - The setting id\n\t * @param callback - The callback to run\n\t * @returns {() => void} - A function that can be used to cancel the observe\n\t */\n\tpublic watch<T extends SettingValue = SettingValue>(\n\t\t_id: ISetting['_id'],\n\t\tcb: (args: T) => void,\n\t\tconfig?: OverCustomSettingsConfig,\n\t): () => void {\n\t\tif (!this.ready) {\n\t\t\tconst cancel = new Set<() => void>();\n\t\t\tcancel.add(\n\t\t\t\tthis.once('ready', (): void => {\n\t\t\t\t\tcancel.clear();\n\t\t\t\t\tcancel.add(this.watch(_id, cb, config));\n\t\t\t\t}),\n\t\t\t);\n\t\t\treturn (): void => {\n\t\t\t\tcancel.forEach((fn) => fn());\n\t\t\t};\n\t\t}\n\n\t\tthis.store.has(_id) && cb(this.store.get(_id)?.value as T);\n\t\treturn this.change(_id, cb, config);\n\t}\n\n\t/**\n\t * Get the current value of the setting, or wait until the initialized\n\t * - This is a one time run\n\t * - This callback is debounced\n\t * - The callback is not fire until the settings got initialized\n\t * @param _id - The setting id\n\t * @param callback - The callback to run\n\t * @returns {() => void} - A function that can be used to cancel the observe\n\t */\n\tpublic watchOnce<T extends SettingValue = SettingValue>(\n\t\t_id: ISetting['_id'],\n\t\tcb: (args: T) => void,\n\t\tconfig?: OverCustomSettingsConfig,\n\t): () => void {\n\t\tif (this.store.has(_id)) {\n\t\t\tcb(this.store.get(_id)?.value as T);\n\t\t\treturn (): void => undefined;\n\t\t}\n\t\treturn this.changeOnce(_id, cb, config);\n\t}\n\n\t/**\n\t * Observes the given setting by id and keep track of changes\n\t * - This callback is debounced\n\t * - The callback is not fire until the setting is changed\n\t * - The callback is not fire until all the settings get initialized\n\t * @param _id - The setting id\n\t * @param callback - The callback to run\n\t * @returns {() => void} - A function that can be used to cancel the observe\n\t */\n\tpublic change<T extends SettingValue = SettingValue>(\n\t\t_id: ISetting['_id'],\n\t\tcallback: (args: T) => void,\n\t\tconfig?: OverCustomSettingsConfig,\n\t): () => void {\n\t\tconst { debounce } = this.getConfig(config);\n\t\treturn this.on(_id, _.debounce(callback, debounce) as any);\n\t}\n\n\t/**\n\t * Observes multiple settings and keep track of changes\n\t * - This callback is debounced\n\t * - The callback is not fire until the setting is changed\n\t * - The callback is not fire until all the settings get initialized\n\t * @param _ids - Array of setting id\n\t * @param callback - The callback to run\n\t * @returns {() => void} - A function that can be used to cancel the observe\n\t */\n\tpublic changeMultiple<T extends SettingValue = SettingValue>(\n\t\t_ids: ISetting['_id'][],\n\t\tcallback: (settings: T[]) => void,\n\t\tconfig?: OverCustomSettingsConfig,\n\t): () => void {\n\t\tconst fns = _ids.map((id) =>\n\t\t\tthis.change(\n\t\t\t\tid,\n\t\t\t\t(): void => {\n\t\t\t\t\tcallback(_ids.map((id) => this.store.get(id)?.value) as T[]);\n\t\t\t\t},\n\t\t\t\tconfig,\n\t\t\t),\n\t\t);\n\t\treturn (): void => {\n\t\t\tfns.forEach((fn) => fn());\n\t\t};\n\t}\n\n\t/**\n\t * Observes the setting and fires only if there is a change. Runs only once\n\t * - This is a one time run\n\t * - This callback is debounced\n\t * - The callback is not fire until the setting is changed\n\t * - The callback is not fire until all the settings get initialized\n\t * @param _id - The setting id\n\t * @param callback - The callback to run\n\t * @returns {() => void} - A function that can be used to cancel the observe\n\t */\n\tpublic changeOnce<T extends SettingValue = SettingValue>(\n\t\t_id: ISetting['_id'],\n\t\tcallback: (args: T) => void,\n\t\tconfig?: OverCustomSettingsConfig,\n\t): () => void {\n\t\tconst { debounce } = this.getConfig(config);\n\t\treturn this.once(_id, _.debounce(callback, debounce) as any);\n\t}\n\n\t/**\n\t * Sets the value of the setting\n\t * - if the value set is the same as the current value, the change will not be fired\n\t * - if the value is set before the initialization, the emit will be queued and will be fired after initialization\n\t * @param _id - The setting id\n\t * @param value - The value to set\n\t * @returns {void}\n\t */\n\tpublic set(record: ISetting): void {\n\t\tif (this.store.has(record._id) && this.store.get(record._id)?.value === record.value) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.store.set(record._id, record);\n\t\tif (!this.ready) {\n\t\t\tthis.once('ready', () => {\n\t\t\t\tthis.emit(record._id, this.store.get(record._id)?.value);\n\t\t\t\tthis.emit('*', [record._id, this.store.get(record._id)?.value]);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tthis.emit(record._id, this.store.get(record._id)?.value);\n\t\tthis.emit('*', [record._id, this.store.get(record._id)?.value]);\n\t}\n\n\tpublic getConfig = (config?: OverCustomSettingsConfig): SettingsConfig => ({\n\t\tdebounce: process.env.TEST_MODE ? 0 : 500,\n\t\t...config,\n\t});\n\n\t/** @deprecated */\n\tpublic watchByRegex(regex: RegExp, cb: (...args: [string, SettingValue]) => void, config?: OverCustomSettingsConfig): () => void {\n\t\tif (!this.ready) {\n\t\t\tconst cancel = new Set<() => void>();\n\t\t\tcancel.add(\n\t\t\t\tthis.once('ready', (): void => {\n\t\t\t\t\tcancel.clear();\n\t\t\t\t\tcancel.add(this.watchByRegex(regex, cb, config));\n\t\t\t\t}),\n\t\t\t);\n\t\t\treturn (): void => {\n\t\t\t\tcancel.forEach((fn) => fn());\n\t\t\t};\n\t\t}\n\t\t[...this.store.entries()].forEach(([key, setting]) => {\n\t\t\tif (regex.test(key)) {\n\t\t\t\tcb(key, setting.value);\n\t\t\t}\n\t\t});\n\n\t\treturn this.changeByRegex(regex, cb, config);\n\t}\n\n\t/** @deprecated */\n\tpublic changeByRegex(regex: RegExp, callback: (...args: [string, SettingValue]) => void, config?: OverCustomSettingsConfig): () => void {\n\t\tconst store: Map<string, (...args: [string, SettingValue]) => void> = new Map();\n\t\treturn this.on('*', ([_id, value]) => {\n\t\t\tif (regex.test(_id)) {\n\t\t\t\tconst { debounce } = this.getConfig(config);\n\t\t\t\tconst cb = store.get(_id) || _.debounce(callback, debounce);\n\t\t\t\tcb(_id, value);\n\t\t\t\tstore.set(_id, cb);\n\t\t\t}\n\t\t\tregex.lastIndex = 0;\n\t\t});\n\t}\n\n\t/**\n\t * Wait until the settings get ready then run the callback\n\t */\n\tpublic onReady(cb: () => void): void {\n\t\tif (this.ready) {\n\t\t\treturn cb();\n\t\t}\n\t\tthis.once('ready', cb);\n\t}\n}\n"],"names":["CachedSettings","warn","process","env","NODE_ENV","TEST_MODE","Emitter","initialized","ready","emit","SystemLogger","debug","has","_id","store","getSetting","get","value","getByRegexp","entries","filter","key","test","map","setting","watchMultiple","callback","cancel","Set","add","once","clear","forEach","fn","every","id","settings","mergeFunction","_","debounce","fns","on","watch","cb","config","change","watchOnce","undefined","changeOnce","getConfig","changeMultiple","_ids","set","record","watchByRegex","regex","changeByRegex","Map","lastIndex","onReady"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/CachedSettings.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f22ababd229a47bd9eebc8e50d1aadfbed530a1c","contentHash":"5aa5d344c4e3bf6d6a54c0b8e92ea0ea982fba8fb902a991cd62b88185616158"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/settings.mocks.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/settings.mocks.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":24}},"3":{"start":{"line":11,"column":20},"end":{"line":111,"column":1}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":27}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":18}},"6":{"start":{"line":19,"column":8},"end":{"line":23,"column":9}},"7":{"start":{"line":20,"column":12},"end":{"line":22,"column":13}},"8":{"start":{"line":21,"column":16},"end":{"line":21,"column":100}},"9":{"start":{"line":24,"column":8},"end":{"line":24,"column":40}},"10":{"start":{"line":27,"column":8},"end":{"line":29,"column":108}},"11":{"start":{"line":29,"column":23},"end":{"line":29,"column":106}},"12":{"start":{"line":29,"column":67},"end":{"line":29,"column":105}},"13":{"start":{"line":32,"column":8},"end":{"line":32,"column":36}},"14":{"start":{"line":34,"column":8},"end":{"line":34,"column":31}},"15":{"start":{"line":35,"column":8},"end":{"line":35,"column":27}},"16":{"start":{"line":38,"column":25},"end":{"line":38,"column":44}},"17":{"start":{"line":39,"column":21},"end":{"line":44,"column":9}},"18":{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},"19":{"start":{"line":46,"column":12},"end":{"line":46,"column":53}},"20":{"start":{"line":48,"column":8},"end":{"line":52,"column":9}},"21":{"start":{"line":49,"column":12},"end":{"line":51,"column":15}},"22":{"start":{"line":50,"column":16},"end":{"line":50,"column":33}},"23":{"start":{"line":53,"column":26},"end":{"line":57,"column":9}},"24":{"start":{"line":58,"column":8},"end":{"line":60,"column":11}},"25":{"start":{"line":59,"column":12},"end":{"line":59,"column":29}},"26":{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},"27":{"start":{"line":61,"column":114},"end":{"line":61,"column":147}},"28":{"start":{"line":62,"column":12},"end":{"line":62,"column":46}},"29":{"start":{"line":64,"column":8},"end":{"line":77,"column":9}},"30":{"start":{"line":65,"column":12},"end":{"line":71,"column":27}},"31":{"start":{"line":67,"column":16},"end":{"line":67,"column":47}},"32":{"start":{"line":70,"column":16},"end":{"line":70,"column":40}},"33":{"start":{"line":73,"column":12},"end":{"line":73,"column":43}},"34":{"start":{"line":76,"column":12},"end":{"line":76,"column":36}},"35":{"start":{"line":78,"column":8},"end":{"line":78,"column":27}},"36":{"start":{"line":81,"column":8},"end":{"line":83,"column":27}},"37":{"start":{"line":84,"column":8},"end":{"line":88,"column":10}},"38":{"start":{"line":91,"column":8},"end":{"line":94,"column":11}},"39":{"start":{"line":97,"column":8},"end":{"line":103,"column":9}},"40":{"start":{"line":98,"column":12},"end":{"line":100,"column":27}},"41":{"start":{"line":99,"column":16},"end":{"line":99,"column":53}},"42":{"start":{"line":102,"column":12},"end":{"line":102,"column":49}},"43":{"start":{"line":106,"column":8},"end":{"line":106,"column":23}},"44":{"start":{"line":107,"column":8},"end":{"line":107,"column":30}},"45":{"start":{"line":108,"column":8},"end":{"line":108,"column":29}},"46":{"start":{"line":109,"column":8},"end":{"line":109,"column":29}},"47":{"start":{"line":112,"column":17},"end":{"line":112,"column":36}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":4},"end":{"line":12,"column":5}},"loc":{"start":{"line":12,"column":20},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":11},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":4},"end":{"line":18,"column":5}},"loc":{"start":{"line":18,"column":43},"end":{"line":25,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":26,"column":4},"end":{"line":26,"column":5}},"loc":{"start":{"line":26,"column":19},"end":{"line":30,"column":5}},"line":26},"5":{"name":"(anonymous_5)","decl":{"start":{"line":29,"column":15},"end":{"line":29,"column":16}},"loc":{"start":{"line":29,"column":23},"end":{"line":29,"column":106}},"line":29},"6":{"name":"(anonymous_6)","decl":{"start":{"line":29,"column":51},"end":{"line":29,"column":52}},"loc":{"start":{"line":29,"column":67},"end":{"line":29,"column":105}},"line":29},"7":{"name":"(anonymous_7)","decl":{"start":{"line":31,"column":4},"end":{"line":31,"column":5}},"loc":{"start":{"line":31,"column":19},"end":{"line":36,"column":5}},"line":31},"8":{"name":"(anonymous_8)","decl":{"start":{"line":37,"column":4},"end":{"line":37,"column":5}},"loc":{"start":{"line":37,"column":38},"end":{"line":79,"column":5}},"line":37},"9":{"name":"(anonymous_9)","decl":{"start":{"line":49,"column":47},"end":{"line":49,"column":48}},"loc":{"start":{"line":49,"column":54},"end":{"line":51,"column":13}},"line":49},"10":{"name":"(anonymous_10)","decl":{"start":{"line":58,"column":26},"end":{"line":58,"column":27}},"loc":{"start":{"line":58,"column":33},"end":{"line":60,"column":9}},"line":58},"11":{"name":"(anonymous_11)","decl":{"start":{"line":61,"column":107},"end":{"line":61,"column":108}},"loc":{"start":{"line":61,"column":114},"end":{"line":61,"column":147}},"line":61},"12":{"name":"(anonymous_12)","decl":{"start":{"line":65,"column":23},"end":{"line":65,"column":24}},"loc":{"start":{"line":65,"column":27},"end":{"line":71,"column":13}},"line":65},"13":{"name":"(anonymous_13)","decl":{"start":{"line":80,"column":4},"end":{"line":80,"column":5}},"loc":{"start":{"line":80,"column":46},"end":{"line":89,"column":5}},"line":80},"14":{"name":"(anonymous_14)","decl":{"start":{"line":90,"column":4},"end":{"line":90,"column":5}},"loc":{"start":{"line":90,"column":31},"end":{"line":104,"column":5}},"line":90},"15":{"name":"(anonymous_15)","decl":{"start":{"line":98,"column":23},"end":{"line":98,"column":24}},"loc":{"start":{"line":98,"column":27},"end":{"line":100,"column":13}},"line":98},"16":{"name":"(anonymous_16)","decl":{"start":{"line":105,"column":4},"end":{"line":105,"column":5}},"loc":{"start":{"line":105,"column":17},"end":{"line":110,"column":5}},"line":105}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":8},"end":{"line":23,"column":9}},"type":"if","locations":[{"start":{"line":19,"column":8},"end":{"line":23,"column":9}},{"start":{"line":19,"column":8},"end":{"line":23,"column":9}}],"line":19},"1":{"loc":{"start":{"line":20,"column":12},"end":{"line":22,"column":13}},"type":"if","locations":[{"start":{"line":20,"column":12},"end":{"line":22,"column":13}},{"start":{"line":20,"column":12},"end":{"line":22,"column":13}}],"line":20},"2":{"loc":{"start":{"line":21,"column":24},"end":{"line":21,"column":75}},"type":"binary-expr","locations":[{"start":{"line":21,"column":24},"end":{"line":21,"column":48}},{"start":{"line":21,"column":52},"end":{"line":21,"column":75}}],"line":21},"3":{"loc":{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":47,"column":9}},{"start":{"line":45,"column":8},"end":{"line":47,"column":9}}],"line":45},"4":{"loc":{"start":{"line":48,"column":8},"end":{"line":52,"column":9}},"type":"if","locations":[{"start":{"line":48,"column":8},"end":{"line":52,"column":9}},{"start":{"line":48,"column":8},"end":{"line":52,"column":9}}],"line":48},"5":{"loc":{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},"type":"if","locations":[{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},{"start":{"line":61,"column":8},"end":{"line":63,"column":9}}],"line":61},"6":{"loc":{"start":{"line":61,"column":12},"end":{"line":61,"column":148}},"type":"binary-expr","locations":[{"start":{"line":61,"column":12},"end":{"line":61,"column":87}},{"start":{"line":61,"column":91},"end":{"line":61,"column":148}}],"line":61},"7":{"loc":{"start":{"line":61,"column":13},"end":{"line":61,"column":77}},"type":"cond-expr","locations":[{"start":{"line":61,"column":54},"end":{"line":61,"column":60}},{"start":{"line":61,"column":63},"end":{"line":61,"column":77}}],"line":61},"8":{"loc":{"start":{"line":61,"column":13},"end":{"line":61,"column":51}},"type":"binary-expr","locations":[{"start":{"line":61,"column":13},"end":{"line":61,"column":29}},{"start":{"line":61,"column":33},"end":{"line":61,"column":51}}],"line":61},"9":{"loc":{"start":{"line":64,"column":8},"end":{"line":77,"column":9}},"type":"if","locations":[{"start":{"line":64,"column":8},"end":{"line":77,"column":9}},{"start":{"line":64,"column":8},"end":{"line":77,"column":9}}],"line":64},"10":{"loc":{"start":{"line":97,"column":8},"end":{"line":103,"column":9}},"type":"if","locations":[{"start":{"line":97,"column":8},"end":{"line":103,"column":9}},{"start":{"line":97,"column":8},"end":{"line":103,"column":9}}],"line":97}},"s":{"0":1,"1":1,"2":158,"3":1,"4":20,"5":0,"6":129,"7":0,"8":0,"9":129,"10":30,"11":129,"12":129,"13":27,"14":27,"15":27,"16":8,"17":8,"18":8,"19":0,"20":8,"21":1,"22":1,"23":8,"24":8,"25":24,"26":8,"27":8,"28":0,"29":8,"30":2,"31":1,"32":1,"33":6,"34":6,"35":8,"36":0,"37":0,"38":1,"39":1,"40":0,"41":0,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1},"f":{"0":158,"1":20,"2":0,"3":129,"4":30,"5":129,"6":129,"7":27,"8":8,"9":1,"10":24,"11":8,"12":1,"13":0,"14":1,"15":0,"16":1},"b":{"0":[0,129],"1":[0,0],"2":[0,0],"3":[0,8],"4":[1,7],"5":[0,8],"6":[8,8],"7":[0,8],"8":[8,8],"9":[2,6],"10":[0,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/settings.mocks.ts"],"sourcesContent":["import type { ISetting } from '@rocket.chat/core-typings';\n\nimport type { ICachedSettings } from '../CachedSettings';\n\ntype Dictionary = {\n\t[index: string]: any;\n};\n\nclass SettingsClass {\n\tsettings: ICachedSettings;\n\n\tprivate delay = 0;\n\n\tsetDelay(delay: number): void {\n\t\tthis.delay = delay;\n\t}\n\n\tfind(): any[] {\n\t\treturn [];\n\t}\n\n\tpublic data = new Map<string, Dictionary>();\n\n\tpublic upsertCalls = 0;\n\n\tpublic insertCalls = 0;\n\n\tprivate checkQueryMatch(key: string, data: Dictionary, queryValue: any): boolean {\n\t\tif (typeof queryValue === 'object') {\n\t\t\tif (queryValue.$exists !== undefined) {\n\t\t\t\treturn (data.hasOwnProperty(key) && data[key] !== undefined) === queryValue.$exists;\n\t\t\t}\n\t\t}\n\n\t\treturn queryValue === data[key];\n\t}\n\n\tfindOne(query: Dictionary): any {\n\t\treturn [...this.data.values()].find((data) => Object.entries(query).every(([key, value]) => this.checkQueryMatch(key, data, value)));\n\t}\n\n\tinsertOne(doc: any): void {\n\t\tthis.data.set(doc._id, doc);\n\t\t// eslint-disable-next-line @typescript-eslint/no-var-requires\n\t\tthis.settings.set(doc);\n\t\tthis.insertCalls++;\n\t}\n\n\tupdateOne(query: any, update: any, options?: any): void {\n\t\tconst existent = this.findOne(query);\n\n\t\tconst data = { ...existent, ...query, ...update, ...update.$set };\n\n\t\tif (!existent) {\n\t\t\tObject.assign(data, update.$setOnInsert);\n\t\t}\n\n\t\tif (update.$unset) {\n\t\t\tObject.keys(update.$unset).forEach((key) => {\n\t\t\t\tdelete data[key];\n\t\t\t});\n\t\t}\n\n\t\tconst modifiers = ['$set', '$setOnInsert', '$unset'];\n\n\t\tmodifiers.forEach((key) => {\n\t\t\tdelete data[key];\n\t\t});\n\n\t\tif (options?.upsert === true && !modifiers.some((key) => Object.keys(update).includes(key))) {\n\t\t\tthrow new Error('Invalid upsert');\n\t\t}\n\n\t\tif (this.delay) {\n\t\t\tsetTimeout(() => {\n\t\t\t\t// console.log(query, data);\n\t\t\t\tthis.data.set(query._id, data);\n\n\t\t\t\t// Can't import before the mock command on end of this file!\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-var-requires\n\t\t\t\tthis.settings.set(data);\n\t\t\t}, this.delay);\n\t\t} else {\n\t\t\tthis.data.set(query._id, data);\n\t\t\t// Can't import before the mock command on end of this file!\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-var-requires\n\t\t\tthis.settings.set(data);\n\t\t}\n\n\t\tthis.upsertCalls++;\n\t}\n\n\tfindOneAndUpdate({ _id }: { _id: string }, value: any, options?: any) {\n\t\tthis.updateOne({ _id }, value, options);\n\t\treturn { value: this.findOne({ _id }) };\n\t}\n\n\tupdateValueById(id: string, value: any): void {\n\t\tthis.data.set(id, { ...this.data.get(id), value });\n\t\t// Can't import before the mock command on end of this file!\n\t\t// eslint-disable-next-line @typescript-eslint/no-var-requires\n\t\tif (this.delay) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.settings.set(this.data.get(id) as ISetting);\n\t\t\t}, this.delay);\n\t\t} else {\n\t\t\tthis.settings.set(this.data.get(id) as ISetting);\n\t\t}\n\t}\n}\n\nexport const Settings = new SettingsClass();\n"],"names":["Settings","SettingsClass","setDelay","delay","find","checkQueryMatch","key","data","queryValue","$exists","undefined","hasOwnProperty","findOne","query","values","Object","entries","every","value","insertOne","doc","set","_id","settings","insertCalls","updateOne","update","options","existent","$set","assign","$setOnInsert","$unset","keys","forEach","modifiers","upsert","some","includes","Error","setTimeout","upsertCalls","findOneAndUpdate","updateValueById","id","get","Map"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/functions/settings.mocks.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2d1a43e903c503fff8403d9aa567dd479f776246","contentHash":"2cc5672ff65c8a133f6472a8644d98e2652e9ff1595254a1ab6bf0527743b967"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/mimeTypes.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/mimeTypes.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":21,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":28}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":27}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":31}},"7":{"start":{"line":22,"column":30},"end":{"line":22,"column":84}},"8":{"start":{"line":24,"column":4},"end":{"line":26,"column":6}},"9":{"start":{"line":28,"column":0},"end":{"line":28,"column":40}},"10":{"start":{"line":29,"column":0},"end":{"line":29,"column":41}},"11":{"start":{"line":30,"column":0},"end":{"line":35,"column":30}},"12":{"start":{"line":36,"column":0},"end":{"line":41,"column":33}},"13":{"start":{"line":42,"column":0},"end":{"line":47,"column":33}},"14":{"start":{"line":48,"column":21},"end":{"line":51,"column":1}},"15":{"start":{"line":49,"column":22},"end":{"line":49,"column":54}},"16":{"start":{"line":50,"column":4},"end":{"line":50,"column":73}},"17":{"start":{"line":52,"column":20},"end":{"line":61,"column":1}},"18":{"start":{"line":55,"column":22},"end":{"line":55,"column":57}},"19":{"start":{"line":56,"column":4},"end":{"line":58,"column":5}},"20":{"start":{"line":57,"column":8},"end":{"line":57,"column":24}},"21":{"start":{"line":59,"column":25},"end":{"line":59,"column":57}},"22":{"start":{"line":60,"column":4},"end":{"line":60,"column":88}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":18},"end":{"line":12,"column":19}},"loc":{"start":{"line":12,"column":29},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":17},"end":{"line":15,"column":18}},"loc":{"start":{"line":15,"column":28},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":10},"end":{"line":18,"column":11}},"loc":{"start":{"line":18,"column":21},"end":{"line":20,"column":5}},"line":18},"4":{"name":"_interop_require_default","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":33}},"loc":{"start":{"line":23,"column":39},"end":{"line":27,"column":1}},"line":23},"5":{"name":"(anonymous_5)","decl":{"start":{"line":48,"column":21},"end":{"line":48,"column":22}},"loc":{"start":{"line":48,"column":30},"end":{"line":51,"column":1}},"line":48},"6":{"name":"(anonymous_6)","decl":{"start":{"line":52,"column":20},"end":{"line":52,"column":21}},"loc":{"start":{"line":52,"column":42},"end":{"line":61,"column":1}},"line":52}},"branchMap":{"0":{"loc":{"start":{"line":24,"column":11},"end":{"line":26,"column":5}},"type":"cond-expr","locations":[{"start":{"line":24,"column":35},"end":{"line":24,"column":38}},{"start":{"line":24,"column":41},"end":{"line":26,"column":5}}],"line":24},"1":{"loc":{"start":{"line":24,"column":11},"end":{"line":24,"column":32}},"type":"binary-expr","locations":[{"start":{"line":24,"column":11},"end":{"line":24,"column":14}},{"start":{"line":24,"column":18},"end":{"line":24,"column":32}}],"line":24},"2":{"loc":{"start":{"line":50,"column":11},"end":{"line":50,"column":72}},"type":"cond-expr","locations":[{"start":{"line":50,"column":58},"end":{"line":50,"column":60}},{"start":{"line":50,"column":63},"end":{"line":50,"column":72}}],"line":50},"3":{"loc":{"start":{"line":50,"column":11},"end":{"line":50,"column":55}},"type":"binary-expr","locations":[{"start":{"line":50,"column":11},"end":{"line":50,"column":21}},{"start":{"line":50,"column":25},"end":{"line":50,"column":55}}],"line":50},"4":{"loc":{"start":{"line":56,"column":4},"end":{"line":58,"column":5}},"type":"if","locations":[{"start":{"line":56,"column":4},"end":{"line":58,"column":5}},{"start":{"line":56,"column":4},"end":{"line":58,"column":5}}],"line":56},"5":{"loc":{"start":{"line":56,"column":8},"end":{"line":56,"column":103}},"type":"binary-expr","locations":[{"start":{"line":56,"column":8},"end":{"line":56,"column":47}},{"start":{"line":56,"column":51},"end":{"line":56,"column":60}},{"start":{"line":56,"column":64},"end":{"line":56,"column":103}}],"line":56},"6":{"loc":{"start":{"line":60,"column":11},"end":{"line":60,"column":87}},"type":"cond-expr","locations":[{"start":{"line":60,"column":46},"end":{"line":60,"column":58}},{"start":{"line":60,"column":61},"end":{"line":60,"column":87}}],"line":60}},"s":{"0":1,"1":1,"2":3,"3":1,"4":2,"5":0,"6":0,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":2,"16":2,"17":1,"18":0,"19":0,"20":0,"21":0,"22":0},"f":{"0":1,"1":2,"2":0,"3":0,"4":1,"5":2,"6":0},"b":{"0":[0,1],"1":[1,1],"2":[1,1],"3":[2,1],"4":[0,0],"5":[0,0,0],"6":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/mimeTypes.ts"],"sourcesContent":["import mime from 'mime-type/with-db';\n\nmime.types.wav = 'audio/wav';\nmime.types.lst = 'text/plain';\nmime.define('image/vnd.microsoft.icon', { source: '', extensions: ['ico'] }, mime.dupAppend);\nmime.define('image/x-icon', { source: '', extensions: ['ico'] }, mime.dupOverwrite);\nmime.define('audio/aac', { source: '', extensions: ['aac'] }, mime.dupOverwrite);\n\nconst getExtension = (param: string): string => {\n\tconst extension = mime.extension(param);\n\n\treturn !extension || typeof extension === 'boolean' ? '' : extension;\n};\n\nconst getMimeType = (mimetype: string, fileName: string): string => {\n\t// If the extension from the mimetype is different from the file extension, the file\n\t// extension may be wrong so use the informed mimetype\n\tconst extension = mime.extension(mimetype);\n\tif (mimetype !== 'application/octet-stream' && extension && extension !== fileName.split('.').pop()) {\n\t\treturn mimetype;\n\t}\n\n\tconst fileMimeType = mime.lookup(fileName);\n\treturn typeof fileMimeType === 'string' ? fileMimeType : 'application/octet-stream';\n};\n\nexport { mime, getExtension, getMimeType };\n"],"names":["getExtension","getMimeType","mime","types","wav","lst","define","source","extensions","dupAppend","dupOverwrite","param","extension","mimetype","fileName","split","pop","fileMimeType","lookup"],"mappings":";;;;;;;;;;;IA0BeA,YAAY;eAAZA;;IAAcC,WAAW;eAAXA;;IAApBC,IAAI;eAAJA,eAAI;;;+DA1BI;;;;;;AAEjBA,eAAI,CAACC,KAAK,CAACC,GAAG,GAAG;AACjBF,eAAI,CAACC,KAAK,CAACE,GAAG,GAAG;AACjBH,eAAI,CAACI,MAAM,CAAC,4BAA4B;IAAEC,QAAQ;IAAIC,YAAY;QAAC;KAAM;AAAC,GAAGN,eAAI,CAACO,SAAS;AAC3FP,eAAI,CAACI,MAAM,CAAC,gBAAgB;IAAEC,QAAQ;IAAIC,YAAY;QAAC;KAAM;AAAC,GAAGN,eAAI,CAACQ,YAAY;AAClFR,eAAI,CAACI,MAAM,CAAC,aAAa;IAAEC,QAAQ;IAAIC,YAAY;QAAC;KAAM;AAAC,GAAGN,eAAI,CAACQ,YAAY;AAE/E,MAAMV,eAAe,CAACW;IACrB,MAAMC,YAAYV,eAAI,CAACU,SAAS,CAACD;IAEjC,OAAO,CAACC,aAAa,OAAOA,cAAc,YAAY,KAAKA;AAC5D;AAEA,MAAMX,cAAc,CAACY,UAAkBC;IACtC,oFAAoF;IACpF,sDAAsD;IACtD,MAAMF,YAAYV,eAAI,CAACU,SAAS,CAACC;IACjC,IAAIA,aAAa,8BAA8BD,aAAaA,cAAcE,SAASC,KAAK,CAAC,KAAKC,GAAG,IAAI;QACpG,OAAOH;IACR;IAEA,MAAMI,eAAef,eAAI,CAACgB,MAAM,CAACJ;IACjC,OAAO,OAAOG,iBAAiB,WAAWA,eAAe;AAC1D","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/mimeTypes.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e55e84ea4b789691c119d1ddb7674b160a83c9d3","contentHash":"d31050117b64b7fa62dbbaabfff287a1fb350e09bf5c248ba277c03ad3e228a9"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/roles/getMostImportantRole.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/roles/getMostImportantRole.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":36}},"3":{"start":{"line":11,"column":14},"end":{"line":22,"column":1}},"4":{"start":{"line":23,"column":30},"end":{"line":26,"column":1}},"5":{"start":{"line":28,"column":4},"end":{"line":30,"column":5}},"6":{"start":{"line":29,"column":8},"end":{"line":29,"column":25}},"7":{"start":{"line":31,"column":4},"end":{"line":31,"column":75}},"8":{"start":{"line":31,"column":27},"end":{"line":31,"column":73}},"9":{"start":{"line":32,"column":4},"end":{"line":37,"column":5}},"10":{"start":{"line":33,"column":8},"end":{"line":35,"column":9}},"11":{"start":{"line":34,"column":12},"end":{"line":34,"column":33}},"12":{"start":{"line":36,"column":8},"end":{"line":36,"column":24}},"13":{"start":{"line":38,"column":21},"end":{"line":38,"column":23}},"14":{"start":{"line":39,"column":4},"end":{"line":45,"column":5}},"15":{"start":{"line":40,"column":8},"end":{"line":44,"column":9}},"16":{"start":{"line":41,"column":12},"end":{"line":41,"column":32}},"17":{"start":{"line":42,"column":15},"end":{"line":44,"column":9}},"18":{"start":{"line":43,"column":12},"end":{"line":43,"column":41}},"19":{"start":{"line":46,"column":4},"end":{"line":50,"column":5}},"20":{"start":{"line":47,"column":8},"end":{"line":49,"column":9}},"21":{"start":{"line":48,"column":12},"end":{"line":48,"column":24}},"22":{"start":{"line":51,"column":4},"end":{"line":51,"column":21}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"getMostImportantRole","decl":{"start":{"line":27,"column":9},"end":{"line":27,"column":29}},"loc":{"start":{"line":27,"column":42},"end":{"line":52,"column":1}},"line":27},"2":{"name":"(anonymous_2)","decl":{"start":{"line":31,"column":22},"end":{"line":31,"column":23}},"loc":{"start":{"line":31,"column":27},"end":{"line":31,"column":73}},"line":31}},"branchMap":{"0":{"loc":{"start":{"line":27,"column":30},"end":{"line":27,"column":40}},"type":"default-arg","locations":[{"start":{"line":27,"column":38},"end":{"line":27,"column":40}}],"line":27},"1":{"loc":{"start":{"line":28,"column":4},"end":{"line":30,"column":5}},"type":"if","locations":[{"start":{"line":28,"column":4},"end":{"line":30,"column":5}},{"start":{"line":28,"column":4},"end":{"line":30,"column":5}}],"line":28},"2":{"loc":{"start":{"line":31,"column":27},"end":{"line":31,"column":73}},"type":"cond-expr","locations":[{"start":{"line":31,"column":63},"end":{"line":31,"column":69}},{"start":{"line":31,"column":72},"end":{"line":31,"column":73}}],"line":31},"3":{"loc":{"start":{"line":32,"column":4},"end":{"line":37,"column":5}},"type":"if","locations":[{"start":{"line":32,"column":4},"end":{"line":37,"column":5}},{"start":{"line":32,"column":4},"end":{"line":37,"column":5}}],"line":32},"4":{"loc":{"start":{"line":33,"column":8},"end":{"line":35,"column":9}},"type":"if","locations":[{"start":{"line":33,"column":8},"end":{"line":35,"column":9}},{"start":{"line":33,"column":8},"end":{"line":35,"column":9}}],"line":33},"5":{"loc":{"start":{"line":40,"column":8},"end":{"line":44,"column":9}},"type":"if","locations":[{"start":{"line":40,"column":8},"end":{"line":44,"column":9}},{"start":{"line":40,"column":8},"end":{"line":44,"column":9}}],"line":40},"6":{"loc":{"start":{"line":42,"column":15},"end":{"line":44,"column":9}},"type":"if","locations":[{"start":{"line":42,"column":15},"end":{"line":44,"column":9}},{"start":{"line":42,"column":15},"end":{"line":44,"column":9}}],"line":42},"7":{"loc":{"start":{"line":47,"column":8},"end":{"line":49,"column":9}},"type":"if","locations":[{"start":{"line":47,"column":8},"end":{"line":49,"column":9}},{"start":{"line":47,"column":8},"end":{"line":49,"column":9}}],"line":47}},"s":{"0":1,"1":1,"2":23,"3":1,"4":1,"5":23,"6":2,"7":21,"8":33,"9":21,"10":12,"11":1,"12":11,"13":9,"14":9,"15":21,"16":15,"17":6,"18":4,"19":9,"20":39,"21":9,"22":0},"f":{"0":23,"1":23,"2":33},"b":{"0":[1],"1":[2,21],"2":[2,31],"3":[12,9],"4":[1,11],"5":[15,6],"6":[4,2],"7":[9,30]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/roles/getMostImportantRole.ts"],"sourcesContent":["import type { IRole } from '@rocket.chat/core-typings';\n\ntype PriorityRoleName =\n\t| 'custom-role'\n\t| 'admin'\n\t| 'livechat-manager'\n\t| 'livechat-monitor'\n\t| 'livechat-agent'\n\t| 'user'\n\t| 'app'\n\t| 'bot'\n\t| 'guest'\n\t| 'anonymous';\n\nconst order = [\n\t'admin',\n\t'livechat-manager',\n\t'livechat-monitor',\n\t'livechat-agent',\n\t'custom-role',\n\t'user',\n\t'app',\n\t'bot',\n\t'guest',\n\t'anonymous',\n] as const;\n\nconst rolesToConsiderAsUser = ['auditor', 'auditor-log'];\n\nexport function getMostImportantRole(roles: IRole['_id'][] = []): 'no-role' | PriorityRoleName {\n\tif (!roles.length) {\n\t\treturn 'no-role';\n\t}\n\n\troles = roles.map((r) => (rolesToConsiderAsUser.includes(r) ? 'user' : r));\n\n\tif (roles.length === 1) {\n\t\tif (!(order as readonly string[]).includes(roles[0])) {\n\t\t\treturn 'custom-role';\n\t\t}\n\t\treturn roles[0] as PriorityRoleName;\n\t}\n\n\tconst newRoles: PriorityRoleName[] = [];\n\tfor (const role of roles) {\n\t\tif ((order as readonly string[]).includes(role)) {\n\t\t\tnewRoles.push(role as PriorityRoleName);\n\t\t} else if (!newRoles.includes('custom-role')) {\n\t\t\tnewRoles.push('custom-role');\n\t\t}\n\t}\n\n\tfor (const item of order) {\n\t\tif (newRoles.includes(item)) {\n\t\t\treturn item;\n\t\t}\n\t}\n\n\treturn 'no-role';\n}\n"],"names":["getMostImportantRole","order","rolesToConsiderAsUser","roles","length","map","r","includes","newRoles","role","push","item"],"mappings":";;;;+BA6BgBA;;;eAAAA;;;AAfhB,MAAMC,QAAQ;IACb;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACA;AAED,MAAMC,wBAAwB;IAAC;IAAW;CAAc;AAEjD,SAASF,qBAAqBG,QAAwB,EAAE;IAC9D,IAAI,CAACA,MAAMC,MAAM,EAAE;QAClB,OAAO;IACR;IAEAD,QAAQA,MAAME,GAAG,CAAC,CAACC,IAAOJ,sBAAsBK,QAAQ,CAACD,KAAK,SAASA;IAEvE,IAAIH,MAAMC,MAAM,KAAK,GAAG;QACvB,IAAI,CAAC,AAACH,MAA4BM,QAAQ,CAACJ,KAAK,CAAC,EAAE,GAAG;YACrD,OAAO;QACR;QACA,OAAOA,KAAK,CAAC,EAAE;IAChB;IAEA,MAAMK,WAA+B,EAAE;IACvC,KAAK,MAAMC,QAAQN,MAAO;QACzB,IAAI,AAACF,MAA4BM,QAAQ,CAACE,OAAO;YAChDD,SAASE,IAAI,CAACD;QACf,OAAO,IAAI,CAACD,SAASD,QAAQ,CAAC,gBAAgB;YAC7CC,SAASE,IAAI,CAAC;QACf;IACD;IAEA,KAAK,MAAMC,QAAQV,MAAO;QACzB,IAAIO,SAASD,QAAQ,CAACI,OAAO;YAC5B,OAAOA;QACR;IACD;IAEA,OAAO;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/roles/getMostImportantRole.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d4dff1e019bbfdb3a84da1241b82d1821bd9e2d1","contentHash":"34dc55c9b5a522e83d75306c196a52556791511ca1c43ca717123ab1cafe1cb0"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/parseCSV.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/parseCSV.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":24}},"3":{"start":{"line":12,"column":18},"end":{"line":12,"column":57}},"4":{"start":{"line":12,"column":45},"end":{"line":12,"column":56}},"5":{"start":{"line":13,"column":4},"end":{"line":15,"column":5}},"6":{"start":{"line":14,"column":8},"end":{"line":14,"column":37}},"7":{"start":{"line":16,"column":4},"end":{"line":16,"column":17}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"parseCSV","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":17}},"loc":{"start":{"line":11,"column":48},"end":{"line":17,"column":1}},"line":11},"2":{"name":"(anonymous_2)","decl":{"start":{"line":12,"column":37},"end":{"line":12,"column":38}},"loc":{"start":{"line":12,"column":45},"end":{"line":12,"column":56}},"line":12}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":23},"end":{"line":11,"column":46}},"type":"default-arg","locations":[{"start":{"line":11,"column":42},"end":{"line":11,"column":46}}],"line":11},"1":{"loc":{"start":{"line":13,"column":4},"end":{"line":15,"column":5}},"type":"if","locations":[{"start":{"line":13,"column":4},"end":{"line":15,"column":5}},{"start":{"line":13,"column":4},"end":{"line":15,"column":5}}],"line":13}},"s":{"0":1,"1":1,"2":5,"3":5,"4":12,"5":5,"6":4,"7":1},"f":{"0":5,"1":5,"2":12},"b":{"0":[4],"1":[4,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/parseCSV.ts"],"sourcesContent":["export function parseCSV(csv: string, removeEmptyItems = true): string[] {\n\tconst items = csv.split(',').map((item) => item.trim());\n\n\tif (removeEmptyItems) {\n\t\treturn items.filter(Boolean);\n\t}\n\n\treturn items;\n}\n"],"names":["parseCSV","csv","removeEmptyItems","items","split","map","item","trim","filter","Boolean"],"mappings":";;;;+BAAgBA;;;eAAAA;;;AAAT,SAASA,SAASC,GAAW,EAAEC,mBAAmB,IAAI;IAC5D,MAAMC,QAAQF,IAAIG,KAAK,CAAC,KAAKC,GAAG,CAAC,CAACC,OAASA,KAAKC,IAAI;IAEpD,IAAIL,kBAAkB;QACrB,OAAOC,MAAMK,MAAM,CAACC;IACrB;IAEA,OAAON;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/parseCSV.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a5cdcb5f9d9f0ff69cdf72e9cd77046cdb75513c","contentHash":"0788b65c793d743c357d06f985d4109fa4f0ba5a7b978251069c98baf0a88d1d"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/parseParameters.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/parseParameters.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":31}},"3":{"start":{"line":13,"column":17},"end":{"line":13,"column":51}},"4":{"start":{"line":14,"column":18},"end":{"line":14,"column":41}},"5":{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},"6":{"start":{"line":16,"column":8},"end":{"line":16,"column":37}},"7":{"start":{"line":18,"column":4},"end":{"line":18,"column":17}},"8":{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},"9":{"start":{"line":22,"column":8},"end":{"line":22,"column":18}},"10":{"start":{"line":24,"column":18},"end":{"line":24,"column":85}},"11":{"start":{"line":25,"column":15},"end":{"line":25,"column":25}},"12":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"13":{"start":{"line":27,"column":8},"end":{"line":27,"column":54}},"14":{"start":{"line":29,"column":4},"end":{"line":38,"column":7}},"15":{"start":{"line":30,"column":24},"end":{"line":36,"column":33}},"16":{"start":{"line":37,"column":8},"end":{"line":37,"column":43}},"17":{"start":{"line":40,"column":4},"end":{"line":40,"column":58}},"18":{"start":{"line":41,"column":18},"end":{"line":41,"column":56}},"19":{"start":{"line":42,"column":4},"end":{"line":48,"column":32}},"20":{"start":{"line":42,"column":29},"end":{"line":48,"column":30}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"split","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":14}},"loc":{"start":{"line":11,"column":61},"end":{"line":19,"column":1}},"line":11},"2":{"name":"parseParameters","decl":{"start":{"line":20,"column":9},"end":{"line":20,"column":24}},"loc":{"start":{"line":20,"column":71},"end":{"line":49,"column":1}},"line":20},"3":{"name":"(anonymous_3)","decl":{"start":{"line":29,"column":18},"end":{"line":29,"column":19}},"loc":{"start":{"line":29,"column":26},"end":{"line":38,"column":5}},"line":29},"4":{"name":"(anonymous_4)","decl":{"start":{"line":42,"column":21},"end":{"line":42,"column":22}},"loc":{"start":{"line":42,"column":29},"end":{"line":48,"column":30}},"line":42}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":27},"end":{"line":11,"column":59}},"type":"default-arg","locations":[{"start":{"line":11,"column":55},"end":{"line":11,"column":59}}],"line":11},"1":{"loc":{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},"type":"if","locations":[{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},{"start":{"line":15,"column":4},"end":{"line":17,"column":5}}],"line":15},"2":{"loc":{"start":{"line":20,"column":37},"end":{"line":20,"column":69}},"type":"default-arg","locations":[{"start":{"line":20,"column":65},"end":{"line":20,"column":69}}],"line":20},"3":{"loc":{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},{"start":{"line":21,"column":4},"end":{"line":23,"column":5}}],"line":21},"4":{"loc":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"type":"if","locations":[{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},{"start":{"line":26,"column":4},"end":{"line":28,"column":5}}],"line":26}},"s":{"0":1,"1":1,"2":16,"3":15,"4":15,"5":15,"6":14,"7":1,"8":16,"9":1,"10":15,"11":15,"12":15,"13":6,"14":9,"15":22,"16":22,"17":9,"18":9,"19":9,"20":23},"f":{"0":16,"1":15,"2":16,"3":22,"4":23},"b":{"0":[0],"1":[14,1],"2":[15],"3":[1,15],"4":[6,9]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/parseParameters.ts"],"sourcesContent":["function split(parameters: string, ignoreExtraUnquotedSpaces = true): string[] {\n\t// Replace \\n\\r with a single \\n\n\tconst line = parameters.replace(/\\n\\r/gm, '\\n');\n\n\tconst items = line.split(/[ \\n\\r\\t]/);\n\n\tif (ignoreExtraUnquotedSpaces) {\n\t\treturn items.filter(Boolean);\n\t}\n\n\treturn items;\n}\n\nexport function parseParameters(parameters: string, ignoreExtraUnquotedSpaces = true): string[] {\n\tif (!parameters.trim()) {\n\t\treturn [];\n\t}\n\n\tconst match = parameters.match(/(([\"'])(?:(?=(\\\\?))\\3.)*?\\2)/gs);\n\tlet line = parameters;\n\n\tif (!match) {\n\t\treturn split(line, ignoreExtraUnquotedSpaces);\n\t}\n\n\tmatch.forEach((item) => {\n\t\tconst newItem = item\n\t\t\t// Replace start quote with SSA character\n\t\t\t.replace(/(^['\"])/g, '\\u0086')\n\t\t\t// Replace end quote with ESA character\n\t\t\t.replace(/['\"]$/g, '\\u0087')\n\t\t\t// Replace spaces inside the quotes with a Punctuation Space character\n\t\t\t.replace(/ /g, '\\u2008')\n\t\t\t// Replace new lines inside the quotes with a PLD character\n\t\t\t.replace(/\\n/gm, '\\u008B')\n\t\t\t// Replace carriage returns inside the quotes with a PLU character\n\t\t\t.replace(/\\r/gm, '\\u008C')\n\t\t\t// Replace tabs inside the quotes with a VTS character\n\t\t\t.replace(/\\t/g, '\\u008A');\n\n\t\tline = line.replace(item, newItem);\n\t});\n\n\t// If two quoted parameters are not separated by a space, add one automatically\n\tline = line.replace(/\\u0087\\u0086/g, '\\u0087 \\u0086');\n\n\tconst items = split(line, ignoreExtraUnquotedSpaces);\n\n\treturn items.map((item) =>\n\t\titem\n\t\t\t// Convert back the spaces from inside quotes\n\t\t\t.replace(/\\u2008/g, ' ')\n\t\t\t// Convert back the new lines from inside quotes\n\t\t\t.replace(/\\u008B/g, '\\n')\n\t\t\t// Convert back the carriage returns from inside quotes\n\t\t\t.replace(/\\u008C/g, '\\r')\n\t\t\t// Convert back the tabs from inside quotes\n\t\t\t.replace(/\\u008A/g, '\\t')\n\t\t\t// Remove SSA and ESA characters\n\t\t\t.replace(/[\\u0086\\u0087]/g, '')\n\t\t\t// Unescape quotes\n\t\t\t.replace(/\\\\\\\"/g, '\"'),\n\t);\n}\n"],"names":["parseParameters","split","parameters","ignoreExtraUnquotedSpaces","line","replace","items","filter","Boolean","trim","match","forEach","item","newItem","map"],"mappings":";;;;+BAagBA;;;eAAAA;;;AAbhB,SAASC,MAAMC,UAAkB,EAAEC,4BAA4B,IAAI;IAClE,gCAAgC;IAChC,MAAMC,OAAOF,WAAWG,OAAO,CAAC,UAAU;IAE1C,MAAMC,QAAQF,KAAKH,KAAK,CAAC;IAEzB,IAAIE,2BAA2B;QAC9B,OAAOG,MAAMC,MAAM,CAACC;IACrB;IAEA,OAAOF;AACR;AAEO,SAASN,gBAAgBE,UAAkB,EAAEC,4BAA4B,IAAI;IACnF,IAAI,CAACD,WAAWO,IAAI,IAAI;QACvB,OAAO,EAAE;IACV;IAEA,MAAMC,QAAQR,WAAWQ,KAAK,CAAC;IAC/B,IAAIN,OAAOF;IAEX,IAAI,CAACQ,OAAO;QACX,OAAOT,MAAMG,MAAMD;IACpB;IAEAO,MAAMC,OAAO,CAAC,CAACC;QACd,MAAMC,UAAUD,IACf,yCAAyC;SACxCP,OAAO,CAAC,YAAY,SACrB,uCAAuC;SACtCA,OAAO,CAAC,UAAU,SACnB,sEAAsE;SACrEA,OAAO,CAAC,MAAM,SACf,2DAA2D;SAC1DA,OAAO,CAAC,QAAQ,SACjB,kEAAkE;SACjEA,OAAO,CAAC,QAAQ,SACjB,sDAAsD;SACrDA,OAAO,CAAC,OAAO;QAEjBD,OAAOA,KAAKC,OAAO,CAACO,MAAMC;IAC3B;IAEA,+EAA+E;IAC/ET,OAAOA,KAAKC,OAAO,CAAC,iBAAiB;IAErC,MAAMC,QAAQL,MAAMG,MAAMD;IAE1B,OAAOG,MAAMQ,GAAG,CAAC,CAACF,OACjBA,IACC,6CAA6C;SAC5CP,OAAO,CAAC,WAAW,IACpB,gDAAgD;SAC/CA,OAAO,CAAC,WAAW,KACpB,uDAAuD;SACtDA,OAAO,CAAC,WAAW,KACpB,2CAA2C;SAC1CA,OAAO,CAAC,WAAW,KACpB,gCAAgC;SAC/BA,OAAO,CAAC,mBAAmB,GAC5B,kBAAkB;SACjBA,OAAO,CAAC,SAAS;AAErB","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/parseParameters.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"22327ebd3abb3b3e2df8ee5a2492526f56cf537a","contentHash":"773bb5730e3c2dc8c952fdc232461f591bc4986ed82d6e1212592d5fb3473889"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/auth.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/auth.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":15},"end":{"line":6,"column":31}},"3":{"start":{"line":7,"column":34},"end":{"line":7,"column":81}},"4":{"start":{"line":8,"column":29},"end":{"line":8,"column":71}},"5":{"start":{"line":10,"column":4},"end":{"line":12,"column":6}},"6":{"start":{"line":14,"column":14},"end":{"line":19,"column":1}},"7":{"start":{"line":20,"column":39},"end":{"line":22,"column":2}},"8":{"start":{"line":23,"column":0},"end":{"line":94,"column":3}},"9":{"start":{"line":24,"column":21},"end":{"line":29,"column":5}},"10":{"start":{"line":30,"column":17},"end":{"line":30,"column":37}},"11":{"start":{"line":31,"column":4},"end":{"line":37,"column":7}},"12":{"start":{"line":32,"column":8},"end":{"line":32,"column":42}},"13":{"start":{"line":33,"column":8},"end":{"line":33,"column":42}},"14":{"start":{"line":34,"column":8},"end":{"line":34,"column":36}},"15":{"start":{"line":35,"column":8},"end":{"line":35,"column":28}},"16":{"start":{"line":36,"column":8},"end":{"line":36,"column":65}},"17":{"start":{"line":36,"column":51},"end":{"line":36,"column":63}},"18":{"start":{"line":38,"column":4},"end":{"line":44,"column":7}},"19":{"start":{"line":39,"column":8},"end":{"line":39,"column":61}},"20":{"start":{"line":40,"column":8},"end":{"line":40,"column":51}},"21":{"start":{"line":41,"column":8},"end":{"line":41,"column":65}},"22":{"start":{"line":42,"column":8},"end":{"line":42,"column":73}},"23":{"start":{"line":43,"column":8},"end":{"line":43,"column":62}},"24":{"start":{"line":45,"column":4},"end":{"line":58,"column":7}},"25":{"start":{"line":46,"column":8},"end":{"line":46,"column":57}},"26":{"start":{"line":47,"column":8},"end":{"line":49,"column":27}},"27":{"start":{"line":50,"column":8},"end":{"line":50,"column":51}},"28":{"start":{"line":51,"column":8},"end":{"line":51,"column":65}},"29":{"start":{"line":52,"column":8},"end":{"line":54,"column":23}},"30":{"start":{"line":55,"column":8},"end":{"line":55,"column":85}},"31":{"start":{"line":56,"column":8},"end":{"line":56,"column":76}},"32":{"start":{"line":57,"column":8},"end":{"line":57,"column":62}},"33":{"start":{"line":59,"column":4},"end":{"line":71,"column":7}},"34":{"start":{"line":60,"column":8},"end":{"line":60,"column":57}},"35":{"start":{"line":61,"column":8},"end":{"line":63,"column":27}},"36":{"start":{"line":64,"column":8},"end":{"line":64,"column":51}},"37":{"start":{"line":65,"column":8},"end":{"line":65,"column":65}},"38":{"start":{"line":66,"column":8},"end":{"line":68,"column":23}},"39":{"start":{"line":69,"column":8},"end":{"line":69,"column":76}},"40":{"start":{"line":70,"column":8},"end":{"line":70,"column":62}},"41":{"start":{"line":72,"column":4},"end":{"line":84,"column":7}},"42":{"start":{"line":73,"column":8},"end":{"line":73,"column":57}},"43":{"start":{"line":74,"column":8},"end":{"line":76,"column":27}},"44":{"start":{"line":77,"column":8},"end":{"line":77,"column":51}},"45":{"start":{"line":78,"column":8},"end":{"line":78,"column":65}},"46":{"start":{"line":79,"column":8},"end":{"line":81,"column":23}},"47":{"start":{"line":82,"column":8},"end":{"line":82,"column":76}},"48":{"start":{"line":83,"column":8},"end":{"line":83,"column":62}},"49":{"start":{"line":85,"column":4},"end":{"line":93,"column":7}},"50":{"start":{"line":86,"column":8},"end":{"line":86,"column":54}},"51":{"start":{"line":87,"column":24},"end":{"line":89,"column":9}},"52":{"start":{"line":90,"column":8},"end":{"line":90,"column":66}},"53":{"start":{"line":91,"column":8},"end":{"line":91,"column":90}},"54":{"start":{"line":92,"column":8},"end":{"line":92,"column":50}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":33}},"loc":{"start":{"line":9,"column":39},"end":{"line":13,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":23,"column":54},"end":{"line":23,"column":55}},"loc":{"start":{"line":23,"column":58},"end":{"line":94,"column":1}},"line":23},"2":{"name":"(anonymous_2)","decl":{"start":{"line":31,"column":14},"end":{"line":31,"column":15}},"loc":{"start":{"line":31,"column":18},"end":{"line":37,"column":5}},"line":31},"3":{"name":"(anonymous_3)","decl":{"start":{"line":36,"column":43},"end":{"line":36,"column":44}},"loc":{"start":{"line":36,"column":51},"end":{"line":36,"column":63}},"line":36},"4":{"name":"(anonymous_4)","decl":{"start":{"line":38,"column":66},"end":{"line":38,"column":67}},"loc":{"start":{"line":38,"column":76},"end":{"line":44,"column":5}},"line":38},"5":{"name":"(anonymous_5)","decl":{"start":{"line":45,"column":88},"end":{"line":45,"column":89}},"loc":{"start":{"line":45,"column":98},"end":{"line":58,"column":5}},"line":45},"6":{"name":"(anonymous_6)","decl":{"start":{"line":59,"column":88},"end":{"line":59,"column":89}},"loc":{"start":{"line":59,"column":98},"end":{"line":71,"column":5}},"line":59},"7":{"name":"(anonymous_7)","decl":{"start":{"line":72,"column":88},"end":{"line":72,"column":89}},"loc":{"start":{"line":72,"column":98},"end":{"line":84,"column":5}},"line":72},"8":{"name":"(anonymous_8)","decl":{"start":{"line":85,"column":65},"end":{"line":85,"column":66}},"loc":{"start":{"line":85,"column":75},"end":{"line":93,"column":5}},"line":85}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":11},"end":{"line":12,"column":5}},"type":"cond-expr","locations":[{"start":{"line":10,"column":35},"end":{"line":10,"column":38}},{"start":{"line":10,"column":41},"end":{"line":12,"column":5}}],"line":10},"1":{"loc":{"start":{"line":10,"column":11},"end":{"line":10,"column":32}},"type":"binary-expr","locations":[{"start":{"line":10,"column":11},"end":{"line":10,"column":14}},{"start":{"line":10,"column":18},"end":{"line":10,"column":32}}],"line":10}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":2,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":5,"13":5,"14":5,"15":5,"16":5,"17":10,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1},"f":{"0":2,"1":1,"2":5,"3":10,"4":1,"5":1,"6":1,"7":1,"8":1},"b":{"0":[0,2],"1":[2,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/auth.spec.ts"],"sourcesContent":["import { expect } from 'chai';\nimport { describe, it } from 'mocha';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\nconst mocks = {\n\tutils: {\n\t\tuserCanAccessAvatar: sinon.stub(),\n\t\trenderSVGLetters: sinon.stub(),\n\t},\n};\n\nconst { protectAvatarsWithFallback } = proxyquire.noCallThru().load('./auth.ts', {\n\t'../utils': mocks.utils,\n});\n\ndescribe('#protectAvatarsWithFallback()', () => {\n\tconst response = {\n\t\tsetHeader: sinon.spy(),\n\t\twriteHead: sinon.spy(),\n\t\twrite: sinon.spy(),\n\t\tend: sinon.spy(),\n\t};\n\tconst next = sinon.spy();\n\n\tafterEach(() => {\n\t\tresponse.setHeader.resetHistory();\n\t\tresponse.writeHead.resetHistory();\n\t\tresponse.end.resetHistory();\n\t\tnext.resetHistory();\n\n\t\tObject.values(mocks.utils).forEach((mock) => mock.reset());\n\t});\n\n\tit(`should write 404 to head if no url provided`, async () => {\n\t\tawait protectAvatarsWithFallback({}, response, next);\n\t\texpect(next.called).to.be.false;\n\t\texpect(response.setHeader.called).to.be.false;\n\t\texpect(response.writeHead.calledWith(404)).to.be.true;\n\t\texpect(response.end.calledOnce).to.be.true;\n\t});\n\n\tit(`should write 200 to head and write fallback to body (user avatar)`, async () => {\n\t\tmocks.utils.renderSVGLetters.returns('fallback');\n\n\t\tawait protectAvatarsWithFallback({ url: '/jon' }, response, next);\n\t\texpect(next.called).to.be.false;\n\t\texpect(response.setHeader.called).to.be.false;\n\n\t\texpect(response.writeHead.calledWith(200, { 'Content-Type': 'image/svg+xml' })).to.be.true;\n\t\texpect(mocks.utils.renderSVGLetters.calledWith('jon')).to.be.true;\n\t\texpect(response.write.calledWith('fallback')).to.be.true;\n\n\t\texpect(response.end.calledOnce).to.be.true;\n\t});\n\n\tit(`should write 200 to head and write fallback to body (user avatar)`, async () => {\n\t\tmocks.utils.renderSVGLetters.returns('fallback');\n\n\t\tawait protectAvatarsWithFallback({ url: '/jon' }, response, next);\n\t\texpect(next.called).to.be.false;\n\t\texpect(response.setHeader.called).to.be.false;\n\t\texpect(response.writeHead.calledWith(200, { 'Content-Type': 'image/svg+xml' })).to.be.true;\n\t\texpect(response.write.calledWith('fallback')).to.be.true;\n\t\texpect(response.end.calledOnce).to.be.true;\n\t});\n\n\tit(`should write 200 to head and write fallback to body (room avatar)`, async () => {\n\t\tmocks.utils.renderSVGLetters.returns('fallback');\n\n\t\tawait protectAvatarsWithFallback({ url: '/room/jon' }, response, next);\n\t\texpect(next.called).to.be.false;\n\t\texpect(response.setHeader.called).to.be.false;\n\t\texpect(response.writeHead.calledWith(200, { 'Content-Type': 'image/svg+xml' })).to.be.true;\n\t\texpect(response.write.calledWith('fallback')).to.be.true;\n\t\texpect(response.end.calledOnce).to.be.true;\n\t});\n\n\tit(`should call next if user can access avatar`, async () => {\n\t\tmocks.utils.userCanAccessAvatar.returns(true);\n\t\tconst request = { url: '/jon' };\n\n\t\tawait protectAvatarsWithFallback(request, response, next);\n\t\texpect(mocks.utils.userCanAccessAvatar.calledWith(request)).to.be.true;\n\t\texpect(next.called).to.be.true;\n\t});\n});\n"],"names":["mocks","utils","userCanAccessAvatar","sinon","stub","renderSVGLetters","protectAvatarsWithFallback","proxyquire","noCallThru","load","describe","response","setHeader","spy","writeHead","write","end","next","afterEach","resetHistory","Object","values","forEach","mock","reset","it","expect","called","to","be","false","calledWith","true","calledOnce","returns","url","request"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/auth.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d35573150f1346bbdf99cb674508bb76db44fac8","contentHash":"d4f5fca30eb944463bc9a3b6c9eb223ebc957ba5749f54bda98a5678fd3aa32c"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/auth.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/auth.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":42}},"3":{"start":{"line":11,"column":15},"end":{"line":11,"column":34}},"4":{"start":{"line":12,"column":23},"end":{"line":29,"column":1}},"5":{"start":{"line":13,"column":4},"end":{"line":17,"column":5}},"6":{"start":{"line":14,"column":8},"end":{"line":14,"column":27}},"7":{"start":{"line":15,"column":8},"end":{"line":15,"column":18}},"8":{"start":{"line":16,"column":8},"end":{"line":16,"column":15}},"9":{"start":{"line":19,"column":4},"end":{"line":23,"column":5}},"10":{"start":{"line":20,"column":8},"end":{"line":20,"column":57}},"11":{"start":{"line":22,"column":8},"end":{"line":22,"column":62}},"12":{"start":{"line":24,"column":4},"end":{"line":26,"column":7}},"13":{"start":{"line":27,"column":4},"end":{"line":27,"column":65}},"14":{"start":{"line":28,"column":4},"end":{"line":28,"column":14}},"15":{"start":{"line":30,"column":26},"end":{"line":41,"column":5}},"16":{"start":{"line":30,"column":38},"end":{"line":41,"column":5}},"17":{"start":{"line":31,"column":8},"end":{"line":39,"column":9}},"18":{"start":{"line":32,"column":12},"end":{"line":35,"column":13}},"19":{"start":{"line":33,"column":16},"end":{"line":33,"column":35}},"20":{"start":{"line":34,"column":16},"end":{"line":34,"column":23}},"21":{"start":{"line":36,"column":12},"end":{"line":36,"column":31}},"22":{"start":{"line":37,"column":12},"end":{"line":37,"column":22}},"23":{"start":{"line":38,"column":12},"end":{"line":38,"column":19}},"24":{"start":{"line":40,"column":8},"end":{"line":40,"column":22}},"25":{"start":{"line":42,"column":35},"end":{"line":42,"column":68}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":23},"end":{"line":12,"column":24}},"loc":{"start":{"line":12,"column":35},"end":{"line":29,"column":1}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":30,"column":26},"end":{"line":30,"column":27}},"loc":{"start":{"line":30,"column":38},"end":{"line":41,"column":5}},"line":30},"3":{"name":"(anonymous_3)","decl":{"start":{"line":30,"column":38},"end":{"line":30,"column":39}},"loc":{"start":{"line":30,"column":62},"end":{"line":41,"column":5}},"line":30}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":4},"end":{"line":17,"column":5}},"type":"if","locations":[{"start":{"line":13,"column":4},"end":{"line":17,"column":5}},{"start":{"line":13,"column":4},"end":{"line":17,"column":5}}],"line":13},"1":{"loc":{"start":{"line":19,"column":4},"end":{"line":23,"column":5}},"type":"if","locations":[{"start":{"line":19,"column":4},"end":{"line":23,"column":5}},{"start":{"line":19,"column":4},"end":{"line":23,"column":5}}],"line":19},"2":{"loc":{"start":{"line":20,"column":25},"end":{"line":20,"column":56}},"type":"binary-expr","locations":[{"start":{"line":20,"column":25},"end":{"line":20,"column":46}},{"start":{"line":20,"column":50},"end":{"line":20,"column":56}}],"line":20},"3":{"loc":{"start":{"line":22,"column":25},"end":{"line":22,"column":61}},"type":"binary-expr","locations":[{"start":{"line":22,"column":25},"end":{"line":22,"column":46}},{"start":{"line":22,"column":50},"end":{"line":22,"column":61}}],"line":22},"4":{"loc":{"start":{"line":31,"column":8},"end":{"line":39,"column":9}},"type":"if","locations":[{"start":{"line":31,"column":8},"end":{"line":39,"column":9}},{"start":{"line":31,"column":8},"end":{"line":39,"column":9}}],"line":31},"5":{"loc":{"start":{"line":32,"column":12},"end":{"line":35,"column":13}},"type":"if","locations":[{"start":{"line":32,"column":12},"end":{"line":35,"column":13}},{"start":{"line":32,"column":12},"end":{"line":35,"column":13}}],"line":32}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":4,"6":1,"7":1,"8":1,"9":3,"10":1,"11":2,"12":3,"13":3,"14":3,"15":1,"16":1,"17":5,"18":4,"19":4,"20":4,"21":0,"22":0,"23":0,"24":1,"25":1},"f":{"0":1,"1":4,"2":1,"3":5},"b":{"0":[1,3],"1":[1,2],"2":[1,0],"3":[2,0],"4":[4,1],"5":[4,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/auth.ts"],"sourcesContent":["import type { IncomingMessage, ServerResponse } from 'http';\n\nimport type { IIncomingMessage } from '@rocket.chat/core-typings';\nimport type { NextFunction } from 'connect';\n\nimport { userCanAccessAvatar, renderSVGLetters } from '../utils';\n\nconst renderFallback = (req: IncomingMessage, res: ServerResponse) => {\n\tif (!req.url) {\n\t\tres.writeHead(404);\n\t\tres.end();\n\t\treturn;\n\t}\n\n\tlet roomOrUsername;\n\n\tif (req.url.startsWith('/room')) {\n\t\troomOrUsername = req.url.split('/')[2] || 'Room';\n\t} else {\n\t\troomOrUsername = req.url.split('/')[1] || 'Anonymous';\n\t}\n\n\tres.writeHead(200, { 'Content-Type': 'image/svg+xml' });\n\tres.write(renderSVGLetters(roomOrUsername, 200));\n\tres.end();\n};\n\nconst getProtectAvatars = (callback?: typeof renderFallback) => async (req: IncomingMessage, res: ServerResponse, next: NextFunction) => {\n\tif (!(await userCanAccessAvatar(req as IIncomingMessage))) {\n\t\tif (callback) {\n\t\t\tcallback(req, res);\n\t\t\treturn;\n\t\t}\n\n\t\tres.writeHead(404);\n\t\tres.end();\n\t\treturn;\n\t}\n\n\treturn next();\n};\n\n// If unauthorized returns the SVG fallback (letter avatar)\nexport const protectAvatarsWithFallback = getProtectAvatars(renderFallback);\n"],"names":["protectAvatarsWithFallback","renderFallback","req","res","url","writeHead","end","roomOrUsername","startsWith","split","write","renderSVGLetters","getProtectAvatars","callback","next","userCanAccessAvatar"],"mappings":";;;;+BA2CaA;;;eAAAA;;;uBAtCyC;AAEtD,MAAMC,iBAAiB,CAACC,KAAsBC;IAC7C,IAAI,CAACD,IAAIE,GAAG,EAAE;QACbD,IAAIE,SAAS,CAAC;QACdF,IAAIG,GAAG;QACP;IACD;IAEA,IAAIC;IAEJ,IAAIL,IAAIE,GAAG,CAACI,UAAU,CAAC,UAAU;QAChCD,iBAAiBL,IAAIE,GAAG,CAACK,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI;IAC3C,OAAO;QACNF,iBAAiBL,IAAIE,GAAG,CAACK,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI;IAC3C;IAEAN,IAAIE,SAAS,CAAC,KAAK;QAAE,gBAAgB;IAAgB;IACrDF,IAAIO,KAAK,CAACC,IAAAA,uBAAgB,EAACJ,gBAAgB;IAC3CJ,IAAIG,GAAG;AACR;AAEA,MAAMM,oBAAoB,CAACC,WAAqC,OAAOX,KAAsBC,KAAqBW;QACjH,IAAI,CAAE,MAAMC,IAAAA,0BAAmB,EAACb,MAA2B;YAC1D,IAAIW,UAAU;gBACbA,SAASX,KAAKC;gBACd;YACD;YAEAA,IAAIE,SAAS,CAAC;YACdF,IAAIG,GAAG;YACP;QACD;QAEA,OAAOQ;IACR;AAGO,MAAMd,6BAA6BY,kBAAkBX","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/auth.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6408dd7cb41e56f5e3c7d236f1e10c280faa78ef","contentHash":"c92a2da32412e3b6936b1b44beda09721a0b86aaa9788eba74b7b58a6976246f"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/browserVersion.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/browserVersion.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":15},"end":{"line":6,"column":31}},"3":{"start":{"line":7,"column":34},"end":{"line":7,"column":81}},"4":{"start":{"line":8,"column":29},"end":{"line":8,"column":71}},"5":{"start":{"line":10,"column":4},"end":{"line":12,"column":6}},"6":{"start":{"line":15,"column":18},"end":{"line":19,"column":1}},"7":{"start":{"line":17,"column":8},"end":{"line":17,"column":40}},"8":{"start":{"line":17,"column":34},"end":{"line":17,"column":39}},"9":{"start":{"line":20,"column":55},"end":{"line":27,"column":2}},"10":{"start":{"line":25,"column":20},"end":{"line":25,"column":22}},"11":{"start":{"line":28,"column":0},"end":{"line":47,"column":3}},"12":{"start":{"line":29,"column":4},"end":{"line":37,"column":7}},"13":{"start":{"line":30,"column":26},"end":{"line":35,"column":9}},"14":{"start":{"line":36,"column":8},"end":{"line":36,"column":66}},"15":{"start":{"line":38,"column":4},"end":{"line":46,"column":7}},"16":{"start":{"line":39,"column":26},"end":{"line":44,"column":9}},"17":{"start":{"line":45,"column":8},"end":{"line":45,"column":65}},"18":{"start":{"line":48,"column":0},"end":{"line":88,"column":3}},"19":{"start":{"line":49,"column":4},"end":{"line":58,"column":7}},"20":{"start":{"line":50,"column":21},"end":{"line":50,"column":41}},"21":{"start":{"line":51,"column":24},"end":{"line":55,"column":9}},"22":{"start":{"line":56,"column":8},"end":{"line":56,"column":53}},"23":{"start":{"line":57,"column":8},"end":{"line":57,"column":54}},"24":{"start":{"line":59,"column":4},"end":{"line":69,"column":7}},"25":{"start":{"line":60,"column":21},"end":{"line":60,"column":41}},"26":{"start":{"line":61,"column":24},"end":{"line":66,"column":9}},"27":{"start":{"line":67,"column":8},"end":{"line":67,"column":53}},"28":{"start":{"line":68,"column":8},"end":{"line":68,"column":54}},"29":{"start":{"line":70,"column":4},"end":{"line":87,"column":7}},"30":{"start":{"line":71,"column":21},"end":{"line":71,"column":41}},"31":{"start":{"line":72,"column":24},"end":{"line":77,"column":9}},"32":{"start":{"line":78,"column":25},"end":{"line":82,"column":9}},"33":{"start":{"line":83,"column":8},"end":{"line":83,"column":59}},"34":{"start":{"line":84,"column":8},"end":{"line":84,"column":112}},"35":{"start":{"line":85,"column":8},"end":{"line":85,"column":111}},"36":{"start":{"line":86,"column":8},"end":{"line":86,"column":62}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":33}},"loc":{"start":{"line":9,"column":39},"end":{"line":13,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":16,"column":4},"end":{"line":16,"column":5}},"loc":{"start":{"line":16,"column":17},"end":{"line":18,"column":5}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":17,"column":19},"end":{"line":17,"column":20}},"loc":{"start":{"line":17,"column":34},"end":{"line":17,"column":39}},"line":17},"3":{"name":"(anonymous_3)","decl":{"start":{"line":25,"column":16},"end":{"line":25,"column":17}},"loc":{"start":{"line":25,"column":20},"end":{"line":25,"column":22}},"line":25},"4":{"name":"(anonymous_4)","decl":{"start":{"line":28,"column":43},"end":{"line":28,"column":44}},"loc":{"start":{"line":28,"column":47},"end":{"line":47,"column":1}},"line":28},"5":{"name":"(anonymous_5)","decl":{"start":{"line":29,"column":64},"end":{"line":29,"column":65}},"loc":{"start":{"line":29,"column":68},"end":{"line":37,"column":5}},"line":29},"6":{"name":"(anonymous_6)","decl":{"start":{"line":38,"column":66},"end":{"line":38,"column":67}},"loc":{"start":{"line":38,"column":70},"end":{"line":46,"column":5}},"line":38},"7":{"name":"(anonymous_7)","decl":{"start":{"line":48,"column":53},"end":{"line":48,"column":54}},"loc":{"start":{"line":48,"column":57},"end":{"line":88,"column":1}},"line":48},"8":{"name":"(anonymous_8)","decl":{"start":{"line":49,"column":90},"end":{"line":49,"column":91}},"loc":{"start":{"line":49,"column":100},"end":{"line":58,"column":5}},"line":49},"9":{"name":"(anonymous_9)","decl":{"start":{"line":59,"column":123},"end":{"line":59,"column":124}},"loc":{"start":{"line":59,"column":133},"end":{"line":69,"column":5}},"line":59},"10":{"name":"(anonymous_10)","decl":{"start":{"line":70,"column":64},"end":{"line":70,"column":65}},"loc":{"start":{"line":70,"column":74},"end":{"line":87,"column":5}},"line":70}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":11},"end":{"line":12,"column":5}},"type":"cond-expr","locations":[{"start":{"line":10,"column":35},"end":{"line":10,"column":38}},{"start":{"line":10,"column":41},"end":{"line":12,"column":5}}],"line":10},"1":{"loc":{"start":{"line":10,"column":11},"end":{"line":10,"column":32}},"type":"binary-expr","locations":[{"start":{"line":10,"column":11},"end":{"line":10,"column":14}},{"start":{"line":10,"column":18},"end":{"line":10,"column":32}}],"line":10}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":2,"6":1,"7":1,"8":3,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1},"f":{"0":2,"1":1,"2":3,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1},"b":{"0":[0,2],"1":[2,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/browserVersion.spec.ts"],"sourcesContent":["import { expect } from 'chai';\nimport { describe, it } from 'mocha';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\n// const getCookie = sinon.stub();\nclass CookiesMock {\n\tpublic get = (_key: any, value: any) => value;\n}\nconst { handleBrowserVersionCheck, isIEOlderThan11 } = proxyquire.noCallThru().load('./browserVersion', {\n\t'meteor/ostrio:cookies': {\n\t\tCookies: CookiesMock,\n\t},\n\t'../../../../app/utils/server/getURL': {\n\t\tgetURL: () => '',\n\t},\n});\n\ndescribe('#isIEOlderThan11()', () => {\n\tit('should return false if user agent is IE11', () => {\n\t\tconst userAgent = {\n\t\t\tbrowser: {\n\t\t\t\tname: 'IE',\n\t\t\t\tversion: '11.0',\n\t\t\t},\n\t\t};\n\t\texpect(isIEOlderThan11(userAgent)).to.be.false;\n\t});\n\n\tit('should return true if user agent is IE < 11', () => {\n\t\tconst userAgent = {\n\t\t\tbrowser: {\n\t\t\t\tname: 'IE',\n\t\t\t\tversion: '10.0',\n\t\t\t},\n\t\t};\n\t\texpect(isIEOlderThan11(userAgent)).to.be.true;\n\t});\n});\n\ndescribe('#handleBrowserVersionCheck()', () => {\n\tit('should call next if browser_version_check cookie is set to \"bypass\"', async () => {\n\t\tconst next = sinon.spy();\n\t\tconst request = {\n\t\t\theaders: {\n\t\t\t\tcookie: 'bypass',\n\t\t\t},\n\t\t};\n\t\thandleBrowserVersionCheck(request as any, {} as any, next);\n\n\t\texpect(next.calledOnce).to.be.true;\n\t});\n\n\tit('should call next if browser_version_check cookie is not set to \"force\" and user agent is not IE < 11', async () => {\n\t\tconst next = sinon.spy();\n\t\tconst request = {\n\t\t\theaders: {\n\t\t\t\t'cookie': 'anything',\n\t\t\t\t'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36',\n\t\t\t},\n\t\t};\n\t\thandleBrowserVersionCheck(request as any, {} as any, next);\n\n\t\texpect(next.calledOnce).to.be.true;\n\t});\n\n\tit('should respond with Browser not supported', async () => {\n\t\tconst next = sinon.spy();\n\t\tconst request = {\n\t\t\theaders: {\n\t\t\t\t'cookie': 'anything',\n\t\t\t\t'user-agent': 'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 7.0; InfoPath.3; .NET CLR 3.1.40767; Trident/6.0; en-IN)',\n\t\t\t},\n\t\t};\n\n\t\tconst response = {\n\t\t\tsetHeader: sinon.spy(),\n\t\t\twrite: sinon.spy(),\n\t\t\tend: sinon.spy(),\n\t\t};\n\t\thandleBrowserVersionCheck(request as any, response as any, next);\n\n\t\texpect(response.setHeader.calledWith('content-type', 'text/html; charset=utf-8')).to.be.true;\n\t\texpect(response.write.calledWith(sinon.match('Browser not supported'))).to.be.true;\n\t\texpect(response.end.calledOnce).to.be.true;\n\t});\n});\n"],"names":["CookiesMock","get","_key","value","handleBrowserVersionCheck","isIEOlderThan11","proxyquire","noCallThru","load","Cookies","getURL","describe","it","userAgent","browser","name","version","expect","to","be","false","true","next","sinon","spy","request","headers","cookie","calledOnce","response","setHeader","write","end","calledWith","match"],"mappings":";;;;sBAAuB;uBACM;mEACN;8DACL;;;;;;AAElB,kCAAkC;AAClC,IAAA,AAAMA,cAAN,MAAMA;;aACEC,MAAM,CAACC,MAAWC,QAAeA;;AACzC;AACA,MAAM,EAAEC,yBAAyB,EAAEC,eAAe,EAAE,GAAGC,mBAAU,CAACC,UAAU,GAAGC,IAAI,CAAC,oBAAoB;IACvG,yBAAyB;QACxBC,SAAST;IACV;IACA,uCAAuC;QACtCU,QAAQ,IAAM;IACf;AACD;AAEAC,IAAAA,eAAQ,EAAC,sBAAsB;IAC9BC,IAAAA,SAAE,EAAC,6CAA6C;QAC/C,MAAMC,YAAY;YACjBC,SAAS;gBACRC,MAAM;gBACNC,SAAS;YACV;QACD;QACAC,IAAAA,YAAM,EAACZ,gBAAgBQ,YAAYK,EAAE,CAACC,EAAE,CAACC,KAAK;IAC/C;IAEAR,IAAAA,SAAE,EAAC,+CAA+C;QACjD,MAAMC,YAAY;YACjBC,SAAS;gBACRC,MAAM;gBACNC,SAAS;YACV;QACD;QACAC,IAAAA,YAAM,EAACZ,gBAAgBQ,YAAYK,EAAE,CAACC,EAAE,CAACE,IAAI;IAC9C;AACD;AAEAV,IAAAA,eAAQ,EAAC,gCAAgC;IACxCC,IAAAA,SAAE,EAAC,uEAAuE;QACzE,MAAMU,OAAOC,cAAK,CAACC,GAAG;QACtB,MAAMC,UAAU;YACfC,SAAS;gBACRC,QAAQ;YACT;QACD;QACAvB,0BAA0BqB,SAAgB,CAAC,GAAUH;QAErDL,IAAAA,YAAM,EAACK,KAAKM,UAAU,EAAEV,EAAE,CAACC,EAAE,CAACE,IAAI;IACnC;IAEAT,IAAAA,SAAE,EAAC,wGAAwG;QAC1G,MAAMU,OAAOC,cAAK,CAACC,GAAG;QACtB,MAAMC,UAAU;YACfC,SAAS;gBACR,UAAU;gBACV,cAAc;YACf;QACD;QACAtB,0BAA0BqB,SAAgB,CAAC,GAAUH;QAErDL,IAAAA,YAAM,EAACK,KAAKM,UAAU,EAAEV,EAAE,CAACC,EAAE,CAACE,IAAI;IACnC;IAEAT,IAAAA,SAAE,EAAC,6CAA6C;QAC/C,MAAMU,OAAOC,cAAK,CAACC,GAAG;QACtB,MAAMC,UAAU;YACfC,SAAS;gBACR,UAAU;gBACV,cAAc;YACf;QACD;QAEA,MAAMG,WAAW;YAChBC,WAAWP,cAAK,CAACC,GAAG;YACpBO,OAAOR,cAAK,CAACC,GAAG;YAChBQ,KAAKT,cAAK,CAACC,GAAG;QACf;QACApB,0BAA0BqB,SAAgBI,UAAiBP;QAE3DL,IAAAA,YAAM,EAACY,SAASC,SAAS,CAACG,UAAU,CAAC,gBAAgB,6BAA6Bf,EAAE,CAACC,EAAE,CAACE,IAAI;QAC5FJ,IAAAA,YAAM,EAACY,SAASE,KAAK,CAACE,UAAU,CAACV,cAAK,CAACW,KAAK,CAAC,2BAA2BhB,EAAE,CAACC,EAAE,CAACE,IAAI;QAClFJ,IAAAA,YAAM,EAACY,SAASG,GAAG,CAACJ,UAAU,EAAEV,EAAE,CAACC,EAAE,CAACE,IAAI;IAC3C;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/browserVersion.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"820b90ccccc216a6d18e028d49833da4c1ad60e0","contentHash":"f249b10394bf2f634b1de23b758d054cd1cffa12b3d5a9625ca5d0b12406f95d"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/browserVersion.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/browserVersion.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":41}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":31}},"6":{"start":{"line":19,"column":23},"end":{"line":19,"column":55}},"7":{"start":{"line":20,"column":34},"end":{"line":20,"column":83}},"8":{"start":{"line":21,"column":16},"end":{"line":21,"column":62}},"9":{"start":{"line":23,"column":4},"end":{"line":25,"column":6}},"10":{"start":{"line":27,"column":16},"end":{"line":27,"column":44}},"11":{"start":{"line":28,"column":24},"end":{"line":33,"column":1}},"12":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"13":{"start":{"line":30,"column":8},"end":{"line":30,"column":21}},"14":{"start":{"line":32,"column":4},"end":{"line":32,"column":87}},"15":{"start":{"line":34,"column":34},"end":{"line":155,"column":1}},"16":{"start":{"line":35,"column":16},"end":{"line":35,"column":23}},"17":{"start":{"line":36,"column":32},"end":{"line":36,"column":88}},"18":{"start":{"line":37,"column":4},"end":{"line":39,"column":5}},"19":{"start":{"line":38,"column":8},"end":{"line":38,"column":22}},"20":{"start":{"line":40,"column":22},"end":{"line":40,"column":73}},"21":{"start":{"line":41,"column":4},"end":{"line":43,"column":5}},"22":{"start":{"line":42,"column":8},"end":{"line":42,"column":22}},"23":{"start":{"line":44,"column":4},"end":{"line":44,"column":62}},"24":{"start":{"line":45,"column":4},"end":{"line":153,"column":4}},"25":{"start":{"line":154,"column":4},"end":{"line":154,"column":21}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":31},"end":{"line":12,"column":32}},"loc":{"start":{"line":12,"column":42},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":21},"end":{"line":15,"column":22}},"loc":{"start":{"line":15,"column":32},"end":{"line":17,"column":5}},"line":15},"3":{"name":"_interop_require_default","decl":{"start":{"line":22,"column":9},"end":{"line":22,"column":33}},"loc":{"start":{"line":22,"column":39},"end":{"line":26,"column":1}},"line":22},"4":{"name":"(anonymous_4)","decl":{"start":{"line":28,"column":24},"end":{"line":28,"column":25}},"loc":{"start":{"line":28,"column":37},"end":{"line":33,"column":1}},"line":28},"5":{"name":"(anonymous_5)","decl":{"start":{"line":34,"column":34},"end":{"line":34,"column":35}},"loc":{"start":{"line":34,"column":56},"end":{"line":155,"column":1}},"line":34}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":11},"end":{"line":25,"column":5}},"type":"cond-expr","locations":[{"start":{"line":23,"column":35},"end":{"line":23,"column":38}},{"start":{"line":23,"column":41},"end":{"line":25,"column":5}}],"line":23},"1":{"loc":{"start":{"line":23,"column":11},"end":{"line":23,"column":32}},"type":"binary-expr","locations":[{"start":{"line":23,"column":11},"end":{"line":23,"column":14}},{"start":{"line":23,"column":18},"end":{"line":23,"column":32}}],"line":23},"2":{"loc":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},{"start":{"line":29,"column":4},"end":{"line":31,"column":5}}],"line":29},"3":{"loc":{"start":{"line":29,"column":8},"end":{"line":29,"column":173}},"type":"binary-expr","locations":[{"start":{"line":29,"column":8},"end":{"line":29,"column":87}},{"start":{"line":29,"column":91},"end":{"line":29,"column":173}}],"line":29},"4":{"loc":{"start":{"line":29,"column":10},"end":{"line":29,"column":86}},"type":"cond-expr","locations":[{"start":{"line":29,"column":55},"end":{"line":29,"column":61}},{"start":{"line":29,"column":64},"end":{"line":29,"column":86}}],"line":29},"5":{"loc":{"start":{"line":29,"column":10},"end":{"line":29,"column":52}},"type":"binary-expr","locations":[{"start":{"line":29,"column":10},"end":{"line":29,"column":28}},{"start":{"line":29,"column":32},"end":{"line":29,"column":52}}],"line":29},"6":{"loc":{"start":{"line":29,"column":93},"end":{"line":29,"column":172}},"type":"cond-expr","locations":[{"start":{"line":29,"column":138},"end":{"line":29,"column":144}},{"start":{"line":29,"column":147},"end":{"line":29,"column":172}}],"line":29},"7":{"loc":{"start":{"line":29,"column":93},"end":{"line":29,"column":135}},"type":"binary-expr","locations":[{"start":{"line":29,"column":93},"end":{"line":29,"column":111}},{"start":{"line":29,"column":115},"end":{"line":29,"column":135}}],"line":29},"8":{"loc":{"start":{"line":32,"column":11},"end":{"line":32,"column":86}},"type":"binary-expr","locations":[{"start":{"line":32,"column":11},"end":{"line":32,"column":42}},{"start":{"line":32,"column":46},"end":{"line":32,"column":86}}],"line":32},"9":{"loc":{"start":{"line":37,"column":4},"end":{"line":39,"column":5}},"type":"if","locations":[{"start":{"line":37,"column":4},"end":{"line":39,"column":5}},{"start":{"line":37,"column":4},"end":{"line":39,"column":5}}],"line":37},"10":{"loc":{"start":{"line":41,"column":4},"end":{"line":43,"column":5}},"type":"if","locations":[{"start":{"line":41,"column":4},"end":{"line":43,"column":5}},{"start":{"line":41,"column":4},"end":{"line":43,"column":5}}],"line":41},"11":{"loc":{"start":{"line":41,"column":8},"end":{"line":41,"column":70}},"type":"binary-expr","locations":[{"start":{"line":41,"column":8},"end":{"line":41,"column":39}},{"start":{"line":41,"column":43},"end":{"line":41,"column":70}}],"line":41}},"s":{"0":1,"1":1,"2":2,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":4,"13":0,"14":4,"15":1,"16":3,"17":3,"18":3,"19":1,"20":2,"21":2,"22":1,"23":1,"24":1,"25":1},"f":{"0":1,"1":1,"2":1,"3":1,"4":4,"5":3},"b":{"0":[0,1],"1":[1,1],"2":[0,4],"3":[4,4],"4":[0,4],"5":[4,4],"6":[0,4],"7":[4,4],"8":[4,3],"9":[1,2],"10":[1,1],"11":[2,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/browserVersion.ts"],"sourcesContent":["import type { IncomingMessage, ServerResponse } from 'http';\n\nimport type { IIncomingMessage } from '@rocket.chat/core-typings';\nimport type { NextFunction } from 'connect';\nimport { Cookies } from 'meteor/ostrio:cookies';\nimport parser from 'ua-parser-js';\n\nimport { getURL } from '../../../../app/utils/server/getURL';\n\nconst cookies = new Cookies();\n\nexport const isIEOlderThan11 = (userAgent: ReturnType<typeof parser>) => {\n\tif (!userAgent?.browser.name || !userAgent?.browser.version) {\n\t\treturn false;\n\t}\n\treturn userAgent.browser.name === 'IE' && parseInt(userAgent.browser.version) < 11;\n};\n\nexport const handleBrowserVersionCheck = (request: IncomingMessage, res: ServerResponse, next: NextFunction) => {\n\tconst req = request as IIncomingMessage;\n\n\tconst browserVersionCheck = cookies.get('browser_version_check', req.headers.cookie);\n\tif (browserVersionCheck === 'bypass') {\n\t\treturn next();\n\t}\n\n\tconst userAgent = parser(req.headers['user-agent']);\n\tif (browserVersionCheck !== 'force' && !isIEOlderThan11(userAgent)) {\n\t\treturn next();\n\t}\n\n\tres.setHeader('content-type', 'text/html; charset=utf-8');\n\n\tres.write(`\n\t\t<style>\n\t\t\tbody {\n\t\t\t\tmargin: 0;\n\t\t\t\tfont-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Helvetica Neue','Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Meiryo UI',Arial,sans-serif;\n\t\t\t}\n\n\t\t\t.rcx-box--text-style-headline {\n\t\t\t\tletter-spacing: 0rem;\n\t\t\t\tfont-family: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Helvetica Neue, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Meiryo UI, Arial, sans-serif;\n\t\t\t\tfont-size: 1.375rem;\n\t\t\t\tfont-weight: 400;\n\t\t\t\tline-height: 2rem;\n\t\t\t}\n\n\t\t\t.not-supported-browser {\n\t\t\t\twidth: 100%;\n\t\t\t\tmin-height: 100vh;\n\n\t\t\t\ttext-align: center;\n\n\t\t\t\tbackground-image: url(${getURL('/images/404.svg')});\n\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\tbackground-position: center;\n\t\t\t\tbackground-size: cover;\n\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\n\t\t\t\t&__404 {\n\t\t\t\t\tfont-size: 4em;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t.not-supported-browser__text {\n\t\t\t\tfont-size: 4em;\n\t\t\t\tfont-weight: bold;\n\t\t\t}\n\n\t\t\t.rcx-box--text-color-alternative {\n\t\t\t\tcolor: #ffffff;\n\t\t\t}\n\n\t\t\t.rcx-box, .rcx-box::before, .rcx-box::after {\n\t\t\t\tbox-sizing: border-box;\n\t\t\t\tmargin: 0;\n\t\t\t\tpadding: 0;\n\t\t\t\ttransition: all 230ms;\n\t\t\t\tborder-width: 0;\n\t\t\t\tborder-style: solid;\n\t\t\t\tborder-color: currentColor;\n\t\t\t\toutline: none;\n\t\t\t\t-webkit-font-smoothing: antialiased;\n\t\t\t\t-moz-osx-font-smoothing: grayscale;\n\t\t\t\tfont-variant-numeric: tabular-nums;\n\t\t\t}\n\n\t\t\t.rcx-button {\n\t\t\t\tdisplay: inline-block;\n\t\t\t\ttext-align: center;\n\t\t\t\tvertical-align: middle;\n\t\t\t\twhite-space: nowrap;\n\t\t\t\ttext-decoration: none;\n\t\t\t\tcursor: pointer;\n\t\t\t\toutline: 0;\n\t\t\t\tletter-spacing: 0rem;\n\t\t\t\tfont-family: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Helvetica Neue, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Meiryo UI, Arial, sans-serif;\n\t\t\t\tfont-size: 0.875rem;\n\t\t\t\tfont-weight: 500;\n\t\t\t\tline-height: 1.25rem;\n\t\t\t\toverflow: hidden;\n\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\tpadding: 7px 15px;\n\t\t\t\tpadding-top: 7px;\n\t\t\t\tpadding-bottom: 7px;\n\t\t\t\tpadding-block: 7px;\n\t\t\t\tpadding-left: 15px;\n\t\t\t\tpadding-right: 15px;\n\t\t\t\tpadding-inline: 15px;\n\t\t\t}\n\n\t\t\t.rcx-button--primary {\n\t\t\t\tcolor: #ffffff;\n\t\t\t\tborder-width: 0.125rem;\n\t\t\t\tborder-style: solid;\n\t\t\t\tborder-color: #1d74f5;\n\t\t\t\tborder-radius: 0.125rem;\n\t\t\t\tbackground-color: #1d74f5;\n\t\t\t\t-webkit-appearance: none;\n\t\t\t\t-moz-appearance: none;\n\t\t\t\tappearance: none;\n\t\t\t}\n\n\t\t\t.rcx-box--text-color-primary {\n\t\t\t\tcolor: #1d74f5;\n\t\t\t}\n\t\t\t.rcx-box.rcx-\\@s6mi60{margin:0.75rem !important;}.rcx-box.rcx-\\@19aubzx{margin:2rem !important;}.rcx-box.rcx-\\@1kgm1vs{-webkit-align-items:center !important;-webkit-box-align:center !important;-ms-flex-align:center !important;align-items:center !important;-webkit-box-pack:center !important;-webkit-justify-content:center !important;-ms-flex-pack:center !important;justify-content:center !important;-webkit-flex-direction:column !important;-ms-flex-direction:column !important;flex-direction:column !important;}.rcx-box.rcx-\\@1qvl0ud{display:-webkit-box !important;display:-webkit-flex !important;display:-ms-flexbox !important;display:flex !important;}\n\t\t</style>\n\n\t\t<section class=\"rcx-box not-supported-browser rcx-@1kgm1vs rcx-@1qvl0ud\">\n\t\t\t<div class=\"rcx-box\">\n\t\t\t\t<div class=\"rcx-box rcx-box--text-color-alternative not-supported-browser__text rcx-@s6mi60\">Browser not supported</div>\n\t\t\t\t<a class=\"rcx-box rcx-button rcx-button--primary\" href=\"https://rocket.chat/docs/getting-support/#supported-browser-versions\" target=\"_blank\">Check the documentation</a>\n\t\t\t\t<a class=\"rcx-box rcx-button rcx-button--primary\" href=\"#\" onclick=\"document.cookie = 'browser_version_check=bypass; path=/'; location.reload(true);\">Proceed anyway</a>\n\t\t\t</div>\n\t\t</section>\n\t`);\n\n\treturn res.end();\n};\n"],"names":["handleBrowserVersionCheck","isIEOlderThan11","cookies","Cookies","userAgent","browser","name","version","parseInt","request","res","next","req","browserVersionCheck","get","headers","cookie","parser","setHeader","write","getURL","end"],"mappings":";;;;;;;;;;;IAkBaA,yBAAyB;eAAzBA;;IAPAC,eAAe;eAAfA;;;+BAPW;mEACL;wBAEI;;;;;;AAEvB,MAAMC,UAAU,IAAIC,sBAAO;AAEpB,MAAMF,kBAAkB,CAACG;IAC/B,IAAI,EAACA,sBAAAA,gCAAAA,UAAWC,OAAO,CAACC,IAAI,KAAI,EAACF,sBAAAA,gCAAAA,UAAWC,OAAO,CAACE,OAAO,GAAE;QAC5D,OAAO;IACR;IACA,OAAOH,UAAUC,OAAO,CAACC,IAAI,KAAK,QAAQE,SAASJ,UAAUC,OAAO,CAACE,OAAO,IAAI;AACjF;AAEO,MAAMP,4BAA4B,CAACS,SAA0BC,KAAqBC;IACxF,MAAMC,MAAMH;IAEZ,MAAMI,sBAAsBX,QAAQY,GAAG,CAAC,yBAAyBF,IAAIG,OAAO,CAACC,MAAM;IACnF,IAAIH,wBAAwB,UAAU;QACrC,OAAOF;IACR;IAEA,MAAMP,YAAYa,IAAAA,mBAAM,EAACL,IAAIG,OAAO,CAAC,aAAa;IAClD,IAAIF,wBAAwB,WAAW,CAACZ,gBAAgBG,YAAY;QACnE,OAAOO;IACR;IAEAD,IAAIQ,SAAS,CAAC,gBAAgB;IAE9BR,IAAIS,KAAK,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;0BAqBc,EAAEC,IAAAA,cAAM,EAAC,mBAAmB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAuFrD,CAAC;IAED,OAAOV,IAAIW,GAAG;AACf","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/middlewares/browserVersion.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"82b854825b2c1a236f4492c0181f3e235aa04d2f","contentHash":"fc5e522328782401f2a5919a5d39bf504e372320948edcb6ee67ba8d15459077"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/room.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/room.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":15},"end":{"line":6,"column":31}},"3":{"start":{"line":7,"column":34},"end":{"line":7,"column":81}},"4":{"start":{"line":8,"column":29},"end":{"line":8,"column":71}},"5":{"start":{"line":10,"column":4},"end":{"line":12,"column":6}},"6":{"start":{"line":14,"column":14},"end":{"line":25,"column":1}},"7":{"start":{"line":26,"column":18},"end":{"line":30,"column":1}},"8":{"start":{"line":28,"column":8},"end":{"line":28,"column":40}},"9":{"start":{"line":28,"column":34},"end":{"line":28,"column":39}},"10":{"start":{"line":31,"column":23},"end":{"line":54,"column":2}},"11":{"start":{"line":55,"column":0},"end":{"line":161,"column":3}},"12":{"start":{"line":56,"column":21},"end":{"line":60,"column":5}},"13":{"start":{"line":61,"column":17},"end":{"line":61,"column":37}},"14":{"start":{"line":62,"column":4},"end":{"line":71,"column":7}},"15":{"start":{"line":63,"column":8},"end":{"line":63,"column":34}},"16":{"start":{"line":64,"column":8},"end":{"line":64,"column":44}},"17":{"start":{"line":65,"column":8},"end":{"line":65,"column":34}},"18":{"start":{"line":66,"column":8},"end":{"line":66,"column":42}},"19":{"start":{"line":67,"column":8},"end":{"line":67,"column":42}},"20":{"start":{"line":68,"column":8},"end":{"line":68,"column":36}},"21":{"start":{"line":69,"column":8},"end":{"line":69,"column":28}},"22":{"start":{"line":70,"column":8},"end":{"line":70,"column":105}},"23":{"start":{"line":70,"column":51},"end":{"line":70,"column":103}},"24":{"start":{"line":72,"column":4},"end":{"line":78,"column":7}},"25":{"start":{"line":73,"column":8},"end":{"line":73,"column":45}},"26":{"start":{"line":74,"column":8},"end":{"line":74,"column":51}},"27":{"start":{"line":75,"column":8},"end":{"line":75,"column":65}},"28":{"start":{"line":76,"column":8},"end":{"line":76,"column":65}},"29":{"start":{"line":77,"column":8},"end":{"line":77,"column":59}},"30":{"start":{"line":79,"column":4},"end":{"line":88,"column":7}},"31":{"start":{"line":80,"column":8},"end":{"line":80,"column":40}},"32":{"start":{"line":81,"column":8},"end":{"line":83,"column":27}},"33":{"start":{"line":84,"column":8},"end":{"line":84,"column":51}},"34":{"start":{"line":85,"column":8},"end":{"line":85,"column":65}},"35":{"start":{"line":86,"column":8},"end":{"line":86,"column":73}},"36":{"start":{"line":87,"column":8},"end":{"line":87,"column":62}},"37":{"start":{"line":89,"column":4},"end":{"line":105,"column":7}},"38":{"start":{"line":90,"column":24},"end":{"line":92,"column":9}},"39":{"start":{"line":93,"column":21},"end":{"line":97,"column":9}},"40":{"start":{"line":98,"column":8},"end":{"line":100,"column":11}},"41":{"start":{"line":101,"column":8},"end":{"line":101,"column":69}},"42":{"start":{"line":102,"column":8},"end":{"line":102,"column":50}},"43":{"start":{"line":103,"column":8},"end":{"line":103,"column":110}},"44":{"start":{"line":104,"column":8},"end":{"line":104,"column":108}},"45":{"start":{"line":106,"column":4},"end":{"line":126,"column":7}},"46":{"start":{"line":107,"column":24},"end":{"line":109,"column":9}},"47":{"start":{"line":110,"column":21},"end":{"line":114,"column":9}},"48":{"start":{"line":115,"column":8},"end":{"line":118,"column":11}},"49":{"start":{"line":119,"column":8},"end":{"line":121,"column":11}},"50":{"start":{"line":122,"column":8},"end":{"line":122,"column":70}},"51":{"start":{"line":123,"column":8},"end":{"line":123,"column":50}},"52":{"start":{"line":124,"column":8},"end":{"line":124,"column":110}},"53":{"start":{"line":125,"column":8},"end":{"line":125,"column":108}},"54":{"start":{"line":127,"column":4},"end":{"line":140,"column":7}},"55":{"start":{"line":128,"column":24},"end":{"line":131,"column":9}},"56":{"start":{"line":132,"column":8},"end":{"line":134,"column":11}},"57":{"start":{"line":135,"column":8},"end":{"line":135,"column":55}},"58":{"start":{"line":136,"column":8},"end":{"line":136,"column":50}},"59":{"start":{"line":137,"column":8},"end":{"line":137,"column":110}},"60":{"start":{"line":138,"column":8},"end":{"line":138,"column":73}},"61":{"start":{"line":139,"column":8},"end":{"line":139,"column":62}},"62":{"start":{"line":141,"column":4},"end":{"line":160,"column":7}},"63":{"start":{"line":142,"column":24},"end":{"line":147,"column":9}},"64":{"start":{"line":148,"column":8},"end":{"line":148,"column":54}},"65":{"start":{"line":149,"column":8},"end":{"line":151,"column":11}},"66":{"start":{"line":152,"column":8},"end":{"line":152,"column":46}},"67":{"start":{"line":153,"column":8},"end":{"line":153,"column":50}},"68":{"start":{"line":154,"column":8},"end":{"line":154,"column":110}},"69":{"start":{"line":155,"column":8},"end":{"line":159,"column":23}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":33}},"loc":{"start":{"line":9,"column":39},"end":{"line":13,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":27,"column":4},"end":{"line":27,"column":5}},"loc":{"start":{"line":27,"column":17},"end":{"line":29,"column":5}},"line":27},"2":{"name":"(anonymous_2)","decl":{"start":{"line":28,"column":19},"end":{"line":28,"column":20}},"loc":{"start":{"line":28,"column":34},"end":{"line":28,"column":39}},"line":28},"3":{"name":"(anonymous_3)","decl":{"start":{"line":55,"column":38},"end":{"line":55,"column":39}},"loc":{"start":{"line":55,"column":42},"end":{"line":161,"column":1}},"line":55},"4":{"name":"(anonymous_4)","decl":{"start":{"line":62,"column":14},"end":{"line":62,"column":15}},"loc":{"start":{"line":62,"column":18},"end":{"line":71,"column":5}},"line":62},"5":{"name":"(anonymous_5)","decl":{"start":{"line":70,"column":43},"end":{"line":70,"column":44}},"loc":{"start":{"line":70,"column":51},"end":{"line":70,"column":103}},"line":70},"6":{"name":"(anonymous_6)","decl":{"start":{"line":72,"column":72},"end":{"line":72,"column":73}},"loc":{"start":{"line":72,"column":82},"end":{"line":78,"column":5}},"line":72},"7":{"name":"(anonymous_7)","decl":{"start":{"line":79,"column":60},"end":{"line":79,"column":61}},"loc":{"start":{"line":79,"column":70},"end":{"line":88,"column":5}},"line":79},"8":{"name":"(anonymous_8)","decl":{"start":{"line":89,"column":56},"end":{"line":89,"column":57}},"loc":{"start":{"line":89,"column":66},"end":{"line":105,"column":5}},"line":89},"9":{"name":"(anonymous_9)","decl":{"start":{"line":106,"column":95},"end":{"line":106,"column":96}},"loc":{"start":{"line":106,"column":105},"end":{"line":126,"column":5}},"line":106},"10":{"name":"(anonymous_10)","decl":{"start":{"line":127,"column":75},"end":{"line":127,"column":76}},"loc":{"start":{"line":127,"column":85},"end":{"line":140,"column":5}},"line":127},"11":{"name":"(anonymous_11)","decl":{"start":{"line":141,"column":65},"end":{"line":141,"column":66}},"loc":{"start":{"line":141,"column":75},"end":{"line":160,"column":5}},"line":141}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":11},"end":{"line":12,"column":5}},"type":"cond-expr","locations":[{"start":{"line":10,"column":35},"end":{"line":10,"column":38}},{"start":{"line":10,"column":41},"end":{"line":12,"column":5}}],"line":10},"1":{"loc":{"start":{"line":10,"column":11},"end":{"line":10,"column":32}},"type":"binary-expr","locations":[{"start":{"line":10,"column":11},"end":{"line":10,"column":14}},{"start":{"line":10,"column":18},"end":{"line":10,"column":32}}],"line":10},"2":{"loc":{"start":{"line":70,"column":51},"end":{"line":70,"column":103}},"type":"cond-expr","locations":[{"start":{"line":70,"column":69},"end":{"line":70,"column":81}},{"start":{"line":70,"column":84},"end":{"line":70,"column":103}}],"line":70}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":2,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":6,"16":6,"17":6,"18":6,"19":6,"20":6,"21":6,"22":6,"23":24,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1,"61":1,"62":1,"63":1,"64":1,"65":1,"66":1,"67":1,"68":1,"69":1},"f":{"0":2,"1":1,"2":1,"3":1,"4":6,"5":24,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1},"b":{"0":[0,2],"1":[2,2],"2":[6,18]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/room.spec.ts"],"sourcesContent":["import { expect } from 'chai';\nimport { describe, it } from 'mocha';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\nconst mocks = {\n\tsettingsGet: sinon.stub(),\n\tfindOneById: sinon.stub(),\n\tutils: {\n\t\tserveSvgAvatarInRequestedFormat: sinon.spy(),\n\t\twasFallbackModified: sinon.stub(),\n\t\tsetCacheAndDispositionHeaders: sinon.spy(),\n\t\tserveAvatarFile: sinon.spy(),\n\t},\n\tavatarFindOneByRoomId: sinon.stub(),\n\tgetRoomName: sinon.stub(),\n};\n\nclass CookiesMock {\n\tpublic get = (_key: any, value: any) => value;\n}\n\nconst { roomAvatar } = proxyquire.noCallThru().load('./room', {\n\t'@rocket.chat/models': {\n\t\tRooms: {\n\t\t\tfindOneById: mocks.findOneById,\n\t\t},\n\t\tAvatars: {\n\t\t\tfindOneByRoomId: mocks.avatarFindOneByRoomId,\n\t\t},\n\t},\n\t'../../../app/settings/server': {\n\t\tsettings: {\n\t\t\tget: mocks.settingsGet,\n\t\t},\n\t},\n\t'./utils': mocks.utils,\n\t'../../lib/rooms/roomCoordinator': {\n\t\troomCoordinator: {\n\t\t\tgetRoomName: mocks.getRoomName,\n\t\t},\n\t},\n\t'meteor/ostrio:cookies': {\n\t\tCookies: CookiesMock,\n\t},\n});\n\ndescribe('#roomAvatar()', () => {\n\tconst response = {\n\t\tsetHeader: sinon.spy(),\n\t\twriteHead: sinon.spy(),\n\t\tend: sinon.spy(),\n\t};\n\tconst next = sinon.spy();\n\n\tafterEach(() => {\n\t\tmocks.settingsGet.reset();\n\t\tmocks.avatarFindOneByRoomId.reset();\n\t\tmocks.findOneById.reset();\n\n\t\tresponse.setHeader.resetHistory();\n\t\tresponse.writeHead.resetHistory();\n\t\tresponse.end.resetHistory();\n\t\tnext.resetHistory();\n\n\t\tObject.values(mocks.utils).forEach((mock) => ('reset' in mock ? mock.reset() : mock.resetHistory()));\n\t});\n\n\tit(`should do nothing if url is not in request object`, async () => {\n\t\tawait roomAvatar({}, response, next);\n\t\texpect(next.called).to.be.false;\n\t\texpect(response.setHeader.called).to.be.false;\n\t\texpect(response.writeHead.called).to.be.false;\n\t\texpect(response.end.called).to.be.false;\n\t});\n\n\tit(`should write 404 if room is not found`, async () => {\n\t\tmocks.findOneById.returns(null);\n\t\tawait roomAvatar({ url: '/' }, response, next);\n\t\texpect(next.called).to.be.false;\n\t\texpect(response.setHeader.called).to.be.false;\n\t\texpect(response.writeHead.calledWith(404)).to.be.true;\n\t\texpect(response.end.calledOnce).to.be.true;\n\t});\n\n\tit(`should serve avatar file if found`, async () => {\n\t\tconst request = { url: '/roomId' };\n\n\t\tconst file = { uploadedAt: new Date(0), type: 'image/png', size: 100 };\n\n\t\tmocks.findOneById.withArgs('roomId').returns({ _id: 'roomId' });\n\t\tmocks.avatarFindOneByRoomId.withArgs('roomId').returns(file);\n\n\t\tawait roomAvatar(request, response, next);\n\n\t\texpect(mocks.utils.setCacheAndDispositionHeaders.calledWith(request, response)).to.be.true;\n\t\texpect(mocks.utils.serveAvatarFile.calledWith(file, request, response, next)).to.be.true;\n\t});\n\n\tit(`should serve parent room avatar file if current room avatar is not found`, async () => {\n\t\tconst request = { url: '/roomId' };\n\n\t\tconst file = { uploadedAt: new Date(0), type: 'image/png', size: 100 };\n\n\t\tmocks.findOneById.withArgs('roomId').returns({ _id: 'roomId', prid: 'roomId2' });\n\t\tmocks.findOneById.withArgs('roomId2').returns({ _id: 'roomId2' });\n\t\tmocks.avatarFindOneByRoomId.withArgs('roomId2').returns(file);\n\n\t\tawait roomAvatar(request, response, next);\n\n\t\texpect(mocks.utils.setCacheAndDispositionHeaders.calledWith(request, response)).to.be.true;\n\t\texpect(mocks.utils.serveAvatarFile.calledWith(file, request, response, next)).to.be.true;\n\t});\n\n\tit(`should write 304 if fallback content is not modified`, async () => {\n\t\tconst request = { url: '/roomId', headers: {} };\n\n\t\tmocks.findOneById.withArgs('roomId').returns({ _id: 'roomId' });\n\t\tmocks.utils.wasFallbackModified.returns(false);\n\t\tawait roomAvatar(request, response, next);\n\n\t\texpect(mocks.utils.setCacheAndDispositionHeaders.calledWith(request, response)).to.be.true;\n\t\texpect(response.writeHead.calledWith(304)).to.be.true;\n\t\texpect(response.end.calledOnce).to.be.true;\n\t});\n\n\tit(`should serve svg fallback if no file found`, async () => {\n\t\tconst request = { url: '/roomId', headers: { cookie: 'userId' } };\n\n\t\tmocks.utils.wasFallbackModified.returns(true);\n\t\tmocks.findOneById.withArgs('roomId').returns({ _id: 'roomId' });\n\t\tmocks.getRoomName.returns('roomName');\n\n\t\tawait roomAvatar(request, response, next);\n\n\t\texpect(mocks.utils.setCacheAndDispositionHeaders.calledWith(request, response)).to.be.true;\n\t\texpect(mocks.utils.serveSvgAvatarInRequestedFormat.calledWith({ nameOrUsername: 'roomName', req: request, res: response })).to.be.true;\n\t});\n});\n"],"names":["mocks","settingsGet","sinon","stub","findOneById","utils","serveSvgAvatarInRequestedFormat","spy","wasFallbackModified","setCacheAndDispositionHeaders","serveAvatarFile","avatarFindOneByRoomId","getRoomName","CookiesMock","get","_key","value","roomAvatar","proxyquire","noCallThru","load","Rooms","Avatars","findOneByRoomId","settings","roomCoordinator","Cookies","describe","response","setHeader","writeHead","end","next","afterEach","reset","resetHistory","Object","values","forEach","mock","it","expect","called","to","be","false","returns","url","calledWith","true","calledOnce","request","file","uploadedAt","Date","type","size","withArgs","_id","prid","headers","cookie","nameOrUsername","req","res"],"mappings":";;;;sBAAuB;uBACM;mEACN;8DACL;;;;;;AAElB,MAAMA,QAAQ;IACbC,aAAaC,cAAK,CAACC,IAAI;IACvBC,aAAaF,cAAK,CAACC,IAAI;IACvBE,OAAO;QACNC,iCAAiCJ,cAAK,CAACK,GAAG;QAC1CC,qBAAqBN,cAAK,CAACC,IAAI;QAC/BM,+BAA+BP,cAAK,CAACK,GAAG;QACxCG,iBAAiBR,cAAK,CAACK,GAAG;IAC3B;IACAI,uBAAuBT,cAAK,CAACC,IAAI;IACjCS,aAAaV,cAAK,CAACC,IAAI;AACxB;AAEA,IAAA,AAAMU,cAAN,MAAMA;;aACEC,MAAM,CAACC,MAAWC,QAAeA;;AACzC;AAEA,MAAM,EAAEC,UAAU,EAAE,GAAGC,mBAAU,CAACC,UAAU,GAAGC,IAAI,CAAC,UAAU;IAC7D,uBAAuB;QACtBC,OAAO;YACNjB,aAAaJ,MAAMI,WAAW;QAC/B;QACAkB,SAAS;YACRC,iBAAiBvB,MAAMW,qBAAqB;QAC7C;IACD;IACA,gCAAgC;QAC/Ba,UAAU;YACTV,KAAKd,MAAMC,WAAW;QACvB;IACD;IACA,WAAWD,MAAMK,KAAK;IACtB,mCAAmC;QAClCoB,iBAAiB;YAChBb,aAAaZ,MAAMY,WAAW;QAC/B;IACD;IACA,yBAAyB;QACxBc,SAASb;IACV;AACD;AAEAc,IAAAA,eAAQ,EAAC,iBAAiB;IACzB,MAAMC,WAAW;QAChBC,WAAW3B,cAAK,CAACK,GAAG;QACpBuB,WAAW5B,cAAK,CAACK,GAAG;QACpBwB,KAAK7B,cAAK,CAACK,GAAG;IACf;IACA,MAAMyB,OAAO9B,cAAK,CAACK,GAAG;IAEtB0B,UAAU;QACTjC,MAAMC,WAAW,CAACiC,KAAK;QACvBlC,MAAMW,qBAAqB,CAACuB,KAAK;QACjClC,MAAMI,WAAW,CAAC8B,KAAK;QAEvBN,SAASC,SAAS,CAACM,YAAY;QAC/BP,SAASE,SAAS,CAACK,YAAY;QAC/BP,SAASG,GAAG,CAACI,YAAY;QACzBH,KAAKG,YAAY;QAEjBC,OAAOC,MAAM,CAACrC,MAAMK,KAAK,EAAEiC,OAAO,CAAC,CAACC,OAAU,WAAWA,OAAOA,KAAKL,KAAK,KAAKK,KAAKJ,YAAY;IACjG;IAEAK,IAAAA,SAAE,EAAC,CAAC,iDAAiD,CAAC,EAAE;QACvD,MAAMvB,WAAW,CAAC,GAAGW,UAAUI;QAC/BS,IAAAA,YAAM,EAACT,KAAKU,MAAM,EAAEC,EAAE,CAACC,EAAE,CAACC,KAAK;QAC/BJ,IAAAA,YAAM,EAACb,SAASC,SAAS,CAACa,MAAM,EAAEC,EAAE,CAACC,EAAE,CAACC,KAAK;QAC7CJ,IAAAA,YAAM,EAACb,SAASE,SAAS,CAACY,MAAM,EAAEC,EAAE,CAACC,EAAE,CAACC,KAAK;QAC7CJ,IAAAA,YAAM,EAACb,SAASG,GAAG,CAACW,MAAM,EAAEC,EAAE,CAACC,EAAE,CAACC,KAAK;IACxC;IAEAL,IAAAA,SAAE,EAAC,CAAC,qCAAqC,CAAC,EAAE;QAC3CxC,MAAMI,WAAW,CAAC0C,OAAO,CAAC;QAC1B,MAAM7B,WAAW;YAAE8B,KAAK;QAAI,GAAGnB,UAAUI;QACzCS,IAAAA,YAAM,EAACT,KAAKU,MAAM,EAAEC,EAAE,CAACC,EAAE,CAACC,KAAK;QAC/BJ,IAAAA,YAAM,EAACb,SAASC,SAAS,CAACa,MAAM,EAAEC,EAAE,CAACC,EAAE,CAACC,KAAK;QAC7CJ,IAAAA,YAAM,EAACb,SAASE,SAAS,CAACkB,UAAU,CAAC,MAAML,EAAE,CAACC,EAAE,CAACK,IAAI;QACrDR,IAAAA,YAAM,EAACb,SAASG,GAAG,CAACmB,UAAU,EAAEP,EAAE,CAACC,EAAE,CAACK,IAAI;IAC3C;IAEAT,IAAAA,SAAE,EAAC,CAAC,iCAAiC,CAAC,EAAE;QACvC,MAAMW,UAAU;YAAEJ,KAAK;QAAU;QAEjC,MAAMK,OAAO;YAAEC,YAAY,IAAIC,KAAK;YAAIC,MAAM;YAAaC,MAAM;QAAI;QAErExD,MAAMI,WAAW,CAACqD,QAAQ,CAAC,UAAUX,OAAO,CAAC;YAAEY,KAAK;QAAS;QAC7D1D,MAAMW,qBAAqB,CAAC8C,QAAQ,CAAC,UAAUX,OAAO,CAACM;QAEvD,MAAMnC,WAAWkC,SAASvB,UAAUI;QAEpCS,IAAAA,YAAM,EAACzC,MAAMK,KAAK,CAACI,6BAA6B,CAACuC,UAAU,CAACG,SAASvB,WAAWe,EAAE,CAACC,EAAE,CAACK,IAAI;QAC1FR,IAAAA,YAAM,EAACzC,MAAMK,KAAK,CAACK,eAAe,CAACsC,UAAU,CAACI,MAAMD,SAASvB,UAAUI,OAAOW,EAAE,CAACC,EAAE,CAACK,IAAI;IACzF;IAEAT,IAAAA,SAAE,EAAC,CAAC,wEAAwE,CAAC,EAAE;QAC9E,MAAMW,UAAU;YAAEJ,KAAK;QAAU;QAEjC,MAAMK,OAAO;YAAEC,YAAY,IAAIC,KAAK;YAAIC,MAAM;YAAaC,MAAM;QAAI;QAErExD,MAAMI,WAAW,CAACqD,QAAQ,CAAC,UAAUX,OAAO,CAAC;YAAEY,KAAK;YAAUC,MAAM;QAAU;QAC9E3D,MAAMI,WAAW,CAACqD,QAAQ,CAAC,WAAWX,OAAO,CAAC;YAAEY,KAAK;QAAU;QAC/D1D,MAAMW,qBAAqB,CAAC8C,QAAQ,CAAC,WAAWX,OAAO,CAACM;QAExD,MAAMnC,WAAWkC,SAASvB,UAAUI;QAEpCS,IAAAA,YAAM,EAACzC,MAAMK,KAAK,CAACI,6BAA6B,CAACuC,UAAU,CAACG,SAASvB,WAAWe,EAAE,CAACC,EAAE,CAACK,IAAI;QAC1FR,IAAAA,YAAM,EAACzC,MAAMK,KAAK,CAACK,eAAe,CAACsC,UAAU,CAACI,MAAMD,SAASvB,UAAUI,OAAOW,EAAE,CAACC,EAAE,CAACK,IAAI;IACzF;IAEAT,IAAAA,SAAE,EAAC,CAAC,oDAAoD,CAAC,EAAE;QAC1D,MAAMW,UAAU;YAAEJ,KAAK;YAAWa,SAAS,CAAC;QAAE;QAE9C5D,MAAMI,WAAW,CAACqD,QAAQ,CAAC,UAAUX,OAAO,CAAC;YAAEY,KAAK;QAAS;QAC7D1D,MAAMK,KAAK,CAACG,mBAAmB,CAACsC,OAAO,CAAC;QACxC,MAAM7B,WAAWkC,SAASvB,UAAUI;QAEpCS,IAAAA,YAAM,EAACzC,MAAMK,KAAK,CAACI,6BAA6B,CAACuC,UAAU,CAACG,SAASvB,WAAWe,EAAE,CAACC,EAAE,CAACK,IAAI;QAC1FR,IAAAA,YAAM,EAACb,SAASE,SAAS,CAACkB,UAAU,CAAC,MAAML,EAAE,CAACC,EAAE,CAACK,IAAI;QACrDR,IAAAA,YAAM,EAACb,SAASG,GAAG,CAACmB,UAAU,EAAEP,EAAE,CAACC,EAAE,CAACK,IAAI;IAC3C;IAEAT,IAAAA,SAAE,EAAC,CAAC,0CAA0C,CAAC,EAAE;QAChD,MAAMW,UAAU;YAAEJ,KAAK;YAAWa,SAAS;gBAAEC,QAAQ;YAAS;QAAE;QAEhE7D,MAAMK,KAAK,CAACG,mBAAmB,CAACsC,OAAO,CAAC;QACxC9C,MAAMI,WAAW,CAACqD,QAAQ,CAAC,UAAUX,OAAO,CAAC;YAAEY,KAAK;QAAS;QAC7D1D,MAAMY,WAAW,CAACkC,OAAO,CAAC;QAE1B,MAAM7B,WAAWkC,SAASvB,UAAUI;QAEpCS,IAAAA,YAAM,EAACzC,MAAMK,KAAK,CAACI,6BAA6B,CAACuC,UAAU,CAACG,SAASvB,WAAWe,EAAE,CAACC,EAAE,CAACK,IAAI;QAC1FR,IAAAA,YAAM,EAACzC,MAAMK,KAAK,CAACC,+BAA+B,CAAC0C,UAAU,CAAC;YAAEc,gBAAgB;YAAYC,KAAKZ;YAASa,KAAKpC;QAAS,IAAIe,EAAE,CAACC,EAAE,CAACK,IAAI;IACvI;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/room.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6a534acaac119db498e4bfec61ac448530af3079","contentHash":"beb0aa02d34aa860c29a1b6416fd17358e3a931b98f5d5ce04588bafbe9c146b"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/room.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/room.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":26}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":23},"end":{"line":12,"column":55}},"5":{"start":{"line":13,"column":25},"end":{"line":13,"column":67}},"6":{"start":{"line":14,"column":15},"end":{"line":14,"column":33}},"7":{"start":{"line":15,"column":15},"end":{"line":15,"column":43}},"8":{"start":{"line":16,"column":29},"end":{"line":30,"column":1}},"9":{"start":{"line":17,"column":17},"end":{"line":17,"column":56}},"10":{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},"11":{"start":{"line":19,"column":8},"end":{"line":19,"column":15}},"12":{"start":{"line":21,"column":17},"end":{"line":21,"column":64}},"13":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"14":{"start":{"line":24,"column":8},"end":{"line":24,"column":47}},"15":{"start":{"line":26,"column":4},"end":{"line":29,"column":6}},"16":{"start":{"line":31,"column":19},"end":{"line":60,"column":1}},"17":{"start":{"line":32,"column":16},"end":{"line":32,"column":23}},"18":{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},"19":{"start":{"line":34,"column":8},"end":{"line":34,"column":15}},"20":{"start":{"line":36,"column":19},"end":{"line":36,"column":76}},"21":{"start":{"line":37,"column":27},"end":{"line":37,"column":67}},"22":{"start":{"line":38,"column":4},"end":{"line":42,"column":5}},"23":{"start":{"line":39,"column":8},"end":{"line":39,"column":27}},"24":{"start":{"line":40,"column":8},"end":{"line":40,"column":18}},"25":{"start":{"line":41,"column":8},"end":{"line":41,"column":15}},"26":{"start":{"line":43,"column":4},"end":{"line":43,"column":56}},"27":{"start":{"line":44,"column":4},"end":{"line":47,"column":5}},"28":{"start":{"line":45,"column":8},"end":{"line":45,"column":63}},"29":{"start":{"line":46,"column":8},"end":{"line":46,"column":15}},"30":{"start":{"line":48,"column":4},"end":{"line":52,"column":5}},"31":{"start":{"line":49,"column":8},"end":{"line":49,"column":27}},"32":{"start":{"line":50,"column":8},"end":{"line":50,"column":18}},"33":{"start":{"line":51,"column":8},"end":{"line":51,"column":15}},"34":{"start":{"line":53,"column":16},"end":{"line":53,"column":78}},"35":{"start":{"line":54,"column":21},"end":{"line":54,"column":90}},"36":{"start":{"line":55,"column":4},"end":{"line":59,"column":7}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":16,"column":29},"end":{"line":16,"column":30}},"loc":{"start":{"line":16,"column":45},"end":{"line":30,"column":1}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":31,"column":19},"end":{"line":31,"column":20}},"loc":{"start":{"line":31,"column":54},"end":{"line":60,"column":1}},"line":31}},"branchMap":{"0":{"loc":{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},"type":"if","locations":[{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},{"start":{"line":18,"column":4},"end":{"line":20,"column":5}}],"line":18},"1":{"loc":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"type":"if","locations":[{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},{"start":{"line":23,"column":4},"end":{"line":25,"column":5}}],"line":23},"2":{"loc":{"start":{"line":23,"column":8},"end":{"line":23,"column":26}},"type":"binary-expr","locations":[{"start":{"line":23,"column":8},"end":{"line":23,"column":17}},{"start":{"line":23,"column":21},"end":{"line":23,"column":26}}],"line":23},"3":{"loc":{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},"type":"if","locations":[{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},{"start":{"line":33,"column":4},"end":{"line":35,"column":5}}],"line":33},"4":{"loc":{"start":{"line":37,"column":27},"end":{"line":37,"column":67}},"type":"binary-expr","locations":[{"start":{"line":37,"column":27},"end":{"line":37,"column":61}},{"start":{"line":37,"column":65},"end":{"line":37,"column":67}}],"line":37},"5":{"loc":{"start":{"line":38,"column":4},"end":{"line":42,"column":5}},"type":"if","locations":[{"start":{"line":38,"column":4},"end":{"line":42,"column":5}},{"start":{"line":38,"column":4},"end":{"line":42,"column":5}}],"line":38},"6":{"loc":{"start":{"line":44,"column":4},"end":{"line":47,"column":5}},"type":"if","locations":[{"start":{"line":44,"column":4},"end":{"line":47,"column":5}},{"start":{"line":44,"column":4},"end":{"line":47,"column":5}}],"line":44},"7":{"loc":{"start":{"line":48,"column":4},"end":{"line":52,"column":5}},"type":"if","locations":[{"start":{"line":48,"column":4},"end":{"line":52,"column":5}},{"start":{"line":48,"column":4},"end":{"line":52,"column":5}}],"line":48},"8":{"loc":{"start":{"line":53,"column":16},"end":{"line":53,"column":78}},"type":"binary-expr","locations":[{"start":{"line":53,"column":16},"end":{"line":53,"column":34}},{"start":{"line":53,"column":38},"end":{"line":53,"column":78}}],"line":53}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":6,"10":6,"11":1,"12":5,"13":5,"14":1,"15":4,"16":1,"17":6,"18":6,"19":1,"20":5,"21":5,"22":5,"23":1,"24":1,"25":1,"26":4,"27":4,"28":2,"29":2,"30":2,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1},"f":{"0":1,"1":6,"2":6},"b":{"0":[1,5],"1":[1,4],"2":[5,1],"3":[1,5],"4":[5,1],"5":[1,4],"6":[2,2],"7":[1,1],"8":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/room.ts"],"sourcesContent":["import type { IncomingMessage, ServerResponse } from 'http';\n\nimport type { IIncomingMessage, IRoom, IUpload } from '@rocket.chat/core-typings';\nimport { Avatars, Rooms } from '@rocket.chat/models';\nimport type { NextFunction } from 'connect';\nimport { Cookies } from 'meteor/ostrio:cookies';\n\nimport { roomCoordinator } from '../../lib/rooms/roomCoordinator';\nimport { serveSvgAvatarInRequestedFormat, wasFallbackModified, setCacheAndDispositionHeaders, serveAvatarFile } from './utils';\n\nconst cookie = new Cookies();\nconst getRoomAndAvatarFile = async (roomId: IRoom['_id']): Promise<{ room: IRoom; file: IUpload | null } | void> => {\n\tconst room = await Rooms.findOneById(roomId);\n\tif (!room) {\n\t\treturn;\n\t}\n\n\tconst file = await Avatars.findOneByRoomId(room._id);\n\n\t// if it is a discussion that doesn't have it's own avatar, returns the parent's room avatar\n\tif (room.prid && !file) {\n\t\treturn getRoomAndAvatarFile(room.prid);\n\t}\n\n\treturn { room, file };\n};\n\nexport const roomAvatar = async function (request: IncomingMessage, res: ServerResponse, next: NextFunction) {\n\tconst req = request as IIncomingMessage;\n\n\tif (!req.url) {\n\t\treturn;\n\t}\n\n\tconst roomId = decodeURIComponent(req.url.slice(1).replace(/\\?.*$/, ''));\n\n\tconst { room, file } = (await getRoomAndAvatarFile(roomId)) || {};\n\tif (!room) {\n\t\tres.writeHead(404);\n\t\tres.end();\n\t\treturn;\n\t}\n\n\tsetCacheAndDispositionHeaders(req, res);\n\n\tif (file) {\n\t\tvoid serveAvatarFile(file, req, res, next);\n\t\treturn;\n\t}\n\n\tif (!wasFallbackModified(req.headers['if-modified-since'])) {\n\t\tres.writeHead(304);\n\t\tres.end();\n\t\treturn;\n\t}\n\n\tconst uid = req.headers.cookie && cookie.get('rc_uid', req.headers.cookie);\n\tconst roomName = await roomCoordinator.getRoomName(room.t, room, uid);\n\n\tserveSvgAvatarInRequestedFormat({ nameOrUsername: roomName, req, res });\n};\n"],"names":["roomAvatar","cookie","Cookies","getRoomAndAvatarFile","roomId","room","Rooms","findOneById","file","Avatars","findOneByRoomId","_id","prid","request","res","next","req","url","decodeURIComponent","slice","replace","writeHead","end","setCacheAndDispositionHeaders","serveAvatarFile","wasFallbackModified","headers","uid","get","roomName","roomCoordinator","getRoomName","t","serveSvgAvatarInRequestedFormat","nameOrUsername"],"mappings":";;;;+BA2BaA;;;eAAAA;;;wBAxBkB;+BAEP;iCAEQ;uBACqF;AAErH,MAAMC,SAAS,IAAIC,sBAAO;AAC1B,MAAMC,uBAAuB,OAAOC;IACnC,MAAMC,OAAO,MAAMC,aAAK,CAACC,WAAW,CAACH;IACrC,IAAI,CAACC,MAAM;QACV;IACD;IAEA,MAAMG,OAAO,MAAMC,eAAO,CAACC,eAAe,CAACL,KAAKM,GAAG;IAEnD,4FAA4F;IAC5F,IAAIN,KAAKO,IAAI,IAAI,CAACJ,MAAM;QACvB,OAAOL,qBAAqBE,KAAKO,IAAI;IACtC;IAEA,OAAO;QAAEP;QAAMG;IAAK;AACrB;AAEO,MAAMR,aAAa,eAAgBa,OAAwB,EAAEC,GAAmB,EAAEC,IAAkB;IAC1G,MAAMC,MAAMH;IAEZ,IAAI,CAACG,IAAIC,GAAG,EAAE;QACb;IACD;IAEA,MAAMb,SAASc,mBAAmBF,IAAIC,GAAG,CAACE,KAAK,CAAC,GAAGC,OAAO,CAAC,SAAS;IAEpE,MAAM,EAAEf,IAAI,EAAEG,IAAI,EAAE,GAAG,AAAC,MAAML,qBAAqBC,WAAY,CAAC;IAChE,IAAI,CAACC,MAAM;QACVS,IAAIO,SAAS,CAAC;QACdP,IAAIQ,GAAG;QACP;IACD;IAEAC,IAAAA,oCAA6B,EAACP,KAAKF;IAEnC,IAAIN,MAAM;QACT,KAAKgB,IAAAA,sBAAe,EAAChB,MAAMQ,KAAKF,KAAKC;QACrC;IACD;IAEA,IAAI,CAACU,IAAAA,0BAAmB,EAACT,IAAIU,OAAO,CAAC,oBAAoB,GAAG;QAC3DZ,IAAIO,SAAS,CAAC;QACdP,IAAIQ,GAAG;QACP;IACD;IAEA,MAAMK,MAAMX,IAAIU,OAAO,CAACzB,MAAM,IAAIA,OAAO2B,GAAG,CAAC,UAAUZ,IAAIU,OAAO,CAACzB,MAAM;IACzE,MAAM4B,WAAW,MAAMC,gCAAe,CAACC,WAAW,CAAC1B,KAAK2B,CAAC,EAAE3B,MAAMsB;IAEjEM,IAAAA,sCAA+B,EAAC;QAAEC,gBAAgBL;QAAUb;QAAKF;IAAI;AACtE","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/room.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a2626f98e74a8bfe17a5fd935aa3c852c9a96087","contentHash":"8802239c60028f22cb3c047135143037ddadcb8eeacd219d9b2e3a3df9eeec20"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/user.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/user.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":15},"end":{"line":6,"column":31}},"3":{"start":{"line":7,"column":19},"end":{"line":7,"column":40}},"4":{"start":{"line":8,"column":34},"end":{"line":8,"column":81}},"5":{"start":{"line":9,"column":29},"end":{"line":9,"column":71}},"6":{"start":{"line":11,"column":4},"end":{"line":13,"column":6}},"7":{"start":{"line":15,"column":14},"end":{"line":26,"column":1}},"8":{"start":{"line":27,"column":33},"end":{"line":45,"column":2}},"9":{"start":{"line":46,"column":0},"end":{"line":170,"column":3}},"10":{"start":{"line":47,"column":21},"end":{"line":51,"column":5}},"11":{"start":{"line":52,"column":17},"end":{"line":52,"column":37}},"12":{"start":{"line":53,"column":4},"end":{"line":61,"column":7}},"13":{"start":{"line":54,"column":8},"end":{"line":54,"column":34}},"14":{"start":{"line":55,"column":8},"end":{"line":55,"column":42}},"15":{"start":{"line":56,"column":8},"end":{"line":56,"column":42}},"16":{"start":{"line":57,"column":8},"end":{"line":57,"column":42}},"17":{"start":{"line":58,"column":8},"end":{"line":58,"column":36}},"18":{"start":{"line":59,"column":8},"end":{"line":59,"column":28}},"19":{"start":{"line":60,"column":8},"end":{"line":60,"column":105}},"20":{"start":{"line":60,"column":51},"end":{"line":60,"column":103}},"21":{"start":{"line":62,"column":4},"end":{"line":68,"column":7}},"22":{"start":{"line":63,"column":8},"end":{"line":63,"column":55}},"23":{"start":{"line":64,"column":8},"end":{"line":64,"column":51}},"24":{"start":{"line":65,"column":8},"end":{"line":65,"column":65}},"25":{"start":{"line":66,"column":8},"end":{"line":66,"column":65}},"26":{"start":{"line":67,"column":8},"end":{"line":67,"column":59}},"27":{"start":{"line":69,"column":4},"end":{"line":77,"column":7}},"28":{"start":{"line":70,"column":8},"end":{"line":72,"column":27}},"29":{"start":{"line":73,"column":8},"end":{"line":73,"column":51}},"30":{"start":{"line":74,"column":8},"end":{"line":74,"column":65}},"31":{"start":{"line":75,"column":8},"end":{"line":75,"column":73}},"32":{"start":{"line":76,"column":8},"end":{"line":76,"column":62}},"33":{"start":{"line":78,"column":4},"end":{"line":100,"column":7}},"34":{"start":{"line":79,"column":24},"end":{"line":81,"column":9}},"35":{"start":{"line":82,"column":21},"end":{"line":82,"column":41}},"36":{"start":{"line":83,"column":36},"end":{"line":83,"column":60}},"37":{"start":{"line":84,"column":8},"end":{"line":84,"column":51}},"38":{"start":{"line":85,"column":8},"end":{"line":85,"column":52}},"39":{"start":{"line":86,"column":8},"end":{"line":91,"column":11}},"40":{"start":{"line":92,"column":8},"end":{"line":92,"column":56}},"41":{"start":{"line":93,"column":8},"end":{"line":93,"column":60}},"42":{"start":{"line":94,"column":8},"end":{"line":94,"column":82}},"43":{"start":{"line":95,"column":8},"end":{"line":95,"column":110}},"44":{"start":{"line":96,"column":8},"end":{"line":96,"column":69}},"45":{"start":{"line":97,"column":8},"end":{"line":97,"column":98}},"46":{"start":{"line":98,"column":8},"end":{"line":98,"column":99}},"47":{"start":{"line":99,"column":8},"end":{"line":99,"column":64}},"48":{"start":{"line":101,"column":4},"end":{"line":112,"column":7}},"49":{"start":{"line":102,"column":24},"end":{"line":104,"column":9}},"50":{"start":{"line":105,"column":8},"end":{"line":105,"column":60}},"51":{"start":{"line":106,"column":8},"end":{"line":106,"column":110}},"52":{"start":{"line":107,"column":8},"end":{"line":111,"column":23}},"53":{"start":{"line":113,"column":4},"end":{"line":126,"column":7}},"54":{"start":{"line":114,"column":24},"end":{"line":116,"column":9}},"55":{"start":{"line":117,"column":21},"end":{"line":121,"column":9}},"56":{"start":{"line":122,"column":8},"end":{"line":122,"column":48}},"57":{"start":{"line":123,"column":8},"end":{"line":123,"column":60}},"58":{"start":{"line":124,"column":8},"end":{"line":124,"column":110}},"59":{"start":{"line":125,"column":8},"end":{"line":125,"column":108}},"60":{"start":{"line":127,"column":4},"end":{"line":137,"column":7}},"61":{"start":{"line":128,"column":24},"end":{"line":131,"column":9}},"62":{"start":{"line":132,"column":8},"end":{"line":132,"column":55}},"63":{"start":{"line":133,"column":8},"end":{"line":133,"column":60}},"64":{"start":{"line":134,"column":8},"end":{"line":134,"column":110}},"65":{"start":{"line":135,"column":8},"end":{"line":135,"column":73}},"66":{"start":{"line":136,"column":8},"end":{"line":136,"column":62}},"67":{"start":{"line":138,"column":4},"end":{"line":151,"column":7}},"68":{"start":{"line":139,"column":24},"end":{"line":142,"column":9}},"69":{"start":{"line":143,"column":8},"end":{"line":143,"column":54}},"70":{"start":{"line":144,"column":8},"end":{"line":144,"column":60}},"71":{"start":{"line":145,"column":8},"end":{"line":145,"column":110}},"72":{"start":{"line":146,"column":8},"end":{"line":150,"column":23}},"73":{"start":{"line":152,"column":4},"end":{"line":169,"column":7}},"74":{"start":{"line":153,"column":24},"end":{"line":156,"column":9}},"75":{"start":{"line":157,"column":8},"end":{"line":157,"column":54}},"76":{"start":{"line":158,"column":8},"end":{"line":158,"column":71}},"77":{"start":{"line":159,"column":8},"end":{"line":161,"column":11}},"78":{"start":{"line":162,"column":8},"end":{"line":162,"column":60}},"79":{"start":{"line":163,"column":8},"end":{"line":163,"column":110}},"80":{"start":{"line":164,"column":8},"end":{"line":168,"column":23}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":10,"column":9},"end":{"line":10,"column":33}},"loc":{"start":{"line":10,"column":39},"end":{"line":14,"column":1}},"line":10},"1":{"name":"(anonymous_1)","decl":{"start":{"line":46,"column":48},"end":{"line":46,"column":49}},"loc":{"start":{"line":46,"column":52},"end":{"line":170,"column":1}},"line":46},"2":{"name":"(anonymous_2)","decl":{"start":{"line":53,"column":14},"end":{"line":53,"column":15}},"loc":{"start":{"line":53,"column":18},"end":{"line":61,"column":5}},"line":53},"3":{"name":"(anonymous_3)","decl":{"start":{"line":60,"column":43},"end":{"line":60,"column":44}},"loc":{"start":{"line":60,"column":51},"end":{"line":60,"column":103}},"line":60},"4":{"name":"(anonymous_4)","decl":{"start":{"line":62,"column":72},"end":{"line":62,"column":73}},"loc":{"start":{"line":62,"column":82},"end":{"line":68,"column":5}},"line":62},"5":{"name":"(anonymous_5)","decl":{"start":{"line":69,"column":67},"end":{"line":69,"column":68}},"loc":{"start":{"line":69,"column":77},"end":{"line":77,"column":5}},"line":69},"6":{"name":"(anonymous_6)","decl":{"start":{"line":78,"column":52},"end":{"line":78,"column":53}},"loc":{"start":{"line":78,"column":62},"end":{"line":100,"column":5}},"line":78},"7":{"name":"(anonymous_7)","decl":{"start":{"line":101,"column":72},"end":{"line":101,"column":73}},"loc":{"start":{"line":101,"column":82},"end":{"line":112,"column":5}},"line":101},"8":{"name":"(anonymous_8)","decl":{"start":{"line":113,"column":56},"end":{"line":113,"column":57}},"loc":{"start":{"line":113,"column":66},"end":{"line":126,"column":5}},"line":113},"9":{"name":"(anonymous_9)","decl":{"start":{"line":127,"column":74},"end":{"line":127,"column":75}},"loc":{"start":{"line":127,"column":84},"end":{"line":137,"column":5}},"line":127},"10":{"name":"(anonymous_10)","decl":{"start":{"line":138,"column":64},"end":{"line":138,"column":65}},"loc":{"start":{"line":138,"column":74},"end":{"line":151,"column":5}},"line":138},"11":{"name":"(anonymous_11)","decl":{"start":{"line":152,"column":90},"end":{"line":152,"column":91}},"loc":{"start":{"line":152,"column":100},"end":{"line":169,"column":5}},"line":152}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":11},"end":{"line":13,"column":5}},"type":"cond-expr","locations":[{"start":{"line":11,"column":35},"end":{"line":11,"column":38}},{"start":{"line":11,"column":41},"end":{"line":13,"column":5}}],"line":11},"1":{"loc":{"start":{"line":11,"column":11},"end":{"line":11,"column":32}},"type":"binary-expr","locations":[{"start":{"line":11,"column":11},"end":{"line":11,"column":14}},{"start":{"line":11,"column":18},"end":{"line":11,"column":32}}],"line":11},"2":{"loc":{"start":{"line":60,"column":51},"end":{"line":60,"column":103}},"type":"cond-expr","locations":[{"start":{"line":60,"column":69},"end":{"line":60,"column":81}},{"start":{"line":60,"column":84},"end":{"line":60,"column":103}}],"line":60}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":2,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":8,"14":8,"15":8,"16":8,"17":8,"18":8,"19":8,"20":32,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1,"61":1,"62":1,"63":1,"64":1,"65":1,"66":1,"67":1,"68":1,"69":1,"70":1,"71":1,"72":1,"73":1,"74":1,"75":1,"76":1,"77":1,"78":1,"79":1,"80":1},"f":{"0":2,"1":1,"2":8,"3":32,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1},"b":{"0":[0,2],"1":[2,2],"2":[8,24]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/user.spec.ts"],"sourcesContent":["import { expect } from 'chai';\nimport { describe, it } from 'mocha';\nimport { Headers } from 'node-fetch';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\nconst mocks = {\n\tsettingsGet: sinon.stub(),\n\tfindOneByUsernameIgnoringCase: sinon.stub(),\n\tutils: {\n\t\tserveSvgAvatarInRequestedFormat: sinon.spy(),\n\t\twasFallbackModified: sinon.stub(),\n\t\tsetCacheAndDispositionHeaders: sinon.spy(),\n\t\tserveAvatarFile: sinon.spy(),\n\t},\n\tserverFetch: sinon.stub(),\n\tavatarFindOneByName: sinon.stub(),\n};\n\nconst { userAvatarByUsername } = proxyquire.noCallThru().load('./user', {\n\t'@rocket.chat/models': {\n\t\tUsers: {\n\t\t\tfindOneByUsernameIgnoringCase: mocks.findOneByUsernameIgnoringCase,\n\t\t},\n\t\tAvatars: {\n\t\t\tfindOneByName: mocks.avatarFindOneByName,\n\t\t},\n\t},\n\t'../../../app/settings/server': {\n\t\tsettings: {\n\t\t\tget: mocks.settingsGet,\n\t\t},\n\t},\n\t'./utils': mocks.utils,\n\t'@rocket.chat/server-fetch': {\n\t\tserverFetch: mocks.serverFetch,\n\t},\n});\n\ndescribe('#userAvatarByUsername()', () => {\n\tconst response = {\n\t\tsetHeader: sinon.spy(),\n\t\twriteHead: sinon.spy(),\n\t\tend: sinon.spy(),\n\t};\n\tconst next = sinon.spy();\n\n\tafterEach(() => {\n\t\tmocks.settingsGet.reset();\n\t\tmocks.avatarFindOneByName.reset();\n\n\t\tresponse.setHeader.resetHistory();\n\t\tresponse.writeHead.resetHistory();\n\t\tresponse.end.resetHistory();\n\t\tnext.resetHistory();\n\n\t\tObject.values(mocks.utils).forEach((mock) => ('reset' in mock ? mock.reset() : mock.resetHistory()));\n\t});\n\n\tit(`should do nothing if url is not in request object`, async () => {\n\t\tawait userAvatarByUsername({}, response, next);\n\t\texpect(next.called).to.be.false;\n\t\texpect(response.setHeader.called).to.be.false;\n\t\texpect(response.writeHead.called).to.be.false;\n\t\texpect(response.end.called).to.be.false;\n\t});\n\n\tit(`should write 404 if username is not provided`, async () => {\n\t\tawait userAvatarByUsername({ url: '/' }, response, next);\n\t\texpect(next.called).to.be.false;\n\t\texpect(response.setHeader.called).to.be.false;\n\t\texpect(response.writeHead.calledWith(404)).to.be.true;\n\t\texpect(response.end.calledOnce).to.be.true;\n\t});\n\n\tit(`should call external provider`, async () => {\n\t\tconst request = { url: '/jon' };\n\n\t\tconst pipe = sinon.spy();\n\t\tconst mockResponseHeaders = new Headers();\n\t\tmockResponseHeaders.set('header1', 'true');\n\t\tmockResponseHeaders.set('header2', 'false');\n\n\t\tmocks.serverFetch.returns({\n\t\t\theaders: mockResponseHeaders,\n\t\t\tbody: { pipe },\n\t\t});\n\n\t\tmocks.settingsGet.returns('test123/{username}');\n\n\t\tawait userAvatarByUsername(request, response, next);\n\n\t\texpect(mocks.serverFetch.calledWith('test123/jon')).to.be.true;\n\t\texpect(mocks.utils.setCacheAndDispositionHeaders.calledWith(request, response)).to.be.true;\n\t\texpect(response.setHeader.calledTwice).to.be.true;\n\t\texpect(response.setHeader.getCall(0).calledWith('header1', 'true')).to.be.true;\n\t\texpect(response.setHeader.getCall(1).calledWith('header2', 'false')).to.be.true;\n\t\texpect(pipe.calledWith(response)).to.be.true;\n\t});\n\n\tit(`should serve svg if requestUsername starts with @`, async () => {\n\t\tconst request = { url: '/@jon' };\n\n\t\tawait userAvatarByUsername(request, response, next);\n\n\t\texpect(mocks.utils.setCacheAndDispositionHeaders.calledWith(request, response)).to.be.true;\n\t\texpect(mocks.utils.serveSvgAvatarInRequestedFormat.calledWith({ nameOrUsername: 'jon', req: request, res: response })).to.be.true;\n\t});\n\n\tit(`should serve avatar file if found`, async () => {\n\t\tconst request = { url: '/jon' };\n\n\t\tconst file = { uploadedAt: new Date(0), type: 'image/png', size: 100 };\n\t\tmocks.avatarFindOneByName.returns(file);\n\n\t\tawait userAvatarByUsername(request, response, next);\n\n\t\texpect(mocks.utils.setCacheAndDispositionHeaders.calledWith(request, response)).to.be.true;\n\t\texpect(mocks.utils.serveAvatarFile.calledWith(file, request, response, next)).to.be.true;\n\t});\n\n\tit(`should write 304 to head if content is not modified`, async () => {\n\t\tconst request = { url: '/jon', headers: {} };\n\n\t\tmocks.utils.wasFallbackModified.returns(false);\n\t\tawait userAvatarByUsername(request, response, next);\n\n\t\texpect(mocks.utils.setCacheAndDispositionHeaders.calledWith(request, response)).to.be.true;\n\t\texpect(response.writeHead.calledWith(304)).to.be.true;\n\t\texpect(response.end.calledOnce).to.be.true;\n\t});\n\n\tit(`should fallback to SVG if no avatar found`, async () => {\n\t\tconst request = { url: '/jon', headers: {} };\n\n\t\tmocks.utils.wasFallbackModified.returns(true);\n\t\tawait userAvatarByUsername(request, response, next);\n\n\t\texpect(mocks.utils.setCacheAndDispositionHeaders.calledWith(request, response)).to.be.true;\n\t\texpect(mocks.utils.serveSvgAvatarInRequestedFormat.calledWith({ nameOrUsername: 'jon', req: request, res: response })).to.be.true;\n\t});\n\n\tit(`should fallback to SVG with user name if UI_Use_Name_Avatar is true`, async () => {\n\t\tconst request = { url: '/jon', headers: {} };\n\n\t\tmocks.utils.wasFallbackModified.returns(true);\n\t\tmocks.settingsGet.withArgs('UI_Use_Name_Avatar').returns(true);\n\t\tmocks.findOneByUsernameIgnoringCase.returns({ name: 'Doe' });\n\n\t\tawait userAvatarByUsername(request, response, next);\n\n\t\texpect(mocks.utils.setCacheAndDispositionHeaders.calledWith(request, response)).to.be.true;\n\t\texpect(mocks.utils.serveSvgAvatarInRequestedFormat.calledWith({ nameOrUsername: 'Doe', req: request, res: response })).to.be.true;\n\t});\n});\n"],"names":["mocks","settingsGet","sinon","stub","findOneByUsernameIgnoringCase","utils","serveSvgAvatarInRequestedFormat","spy","wasFallbackModified","setCacheAndDispositionHeaders","serveAvatarFile","serverFetch","avatarFindOneByName","userAvatarByUsername","proxyquire","noCallThru","load","Users","Avatars","findOneByName","settings","get","describe","response","setHeader","writeHead","end","next","afterEach","reset","resetHistory","Object","values","forEach","mock","it","expect","called","to","be","false","url","calledWith","true","calledOnce","request","pipe","mockResponseHeaders","Headers","set","returns","headers","body","calledTwice","getCall","nameOrUsername","req","res","file","uploadedAt","Date","type","size","withArgs","name"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/user.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8a3af5fc9c98137a682e3511b4fad1efe3c8f2cf","contentHash":"d10c56df733a6852242df270c087b0e44113771c6ef745e79b57fa88eb2d21c8"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/user.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/user.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":36}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":21},"end":{"line":12,"column":57}},"5":{"start":{"line":13,"column":16},"end":{"line":13,"column":55}},"6":{"start":{"line":14,"column":15},"end":{"line":14,"column":33}},"7":{"start":{"line":15,"column":31},"end":{"line":19,"column":1}},"8":{"start":{"line":16,"column":21},"end":{"line":16,"column":109}},"9":{"start":{"line":17,"column":4},"end":{"line":17,"column":70}},"10":{"start":{"line":17,"column":43},"end":{"line":17,"column":68}},"11":{"start":{"line":18,"column":4},"end":{"line":18,"column":28}},"12":{"start":{"line":20,"column":29},"end":{"line":79,"column":1}},"13":{"start":{"line":21,"column":16},"end":{"line":21,"column":23}},"14":{"start":{"line":22,"column":4},"end":{"line":24,"column":5}},"15":{"start":{"line":23,"column":8},"end":{"line":23,"column":15}},"16":{"start":{"line":26,"column":28},"end":{"line":26,"column":85}},"17":{"start":{"line":27,"column":4},"end":{"line":31,"column":5}},"18":{"start":{"line":28,"column":8},"end":{"line":28,"column":27}},"19":{"start":{"line":29,"column":8},"end":{"line":29,"column":18}},"20":{"start":{"line":30,"column":8},"end":{"line":30,"column":15}},"21":{"start":{"line":32,"column":4},"end":{"line":32,"column":56}},"22":{"start":{"line":33,"column":32},"end":{"line":33,"column":90}},"23":{"start":{"line":34,"column":4},"end":{"line":37,"column":5}},"24":{"start":{"line":35,"column":8},"end":{"line":35,"column":79}},"25":{"start":{"line":36,"column":8},"end":{"line":36,"column":15}},"26":{"start":{"line":39,"column":4},"end":{"line":46,"column":5}},"27":{"start":{"line":40,"column":8},"end":{"line":44,"column":11}},"28":{"start":{"line":45,"column":8},"end":{"line":45,"column":15}},"29":{"start":{"line":47,"column":17},"end":{"line":47,"column":69}},"30":{"start":{"line":48,"column":4},"end":{"line":51,"column":5}},"31":{"start":{"line":49,"column":8},"end":{"line":49,"column":63}},"32":{"start":{"line":50,"column":8},"end":{"line":50,"column":15}},"33":{"start":{"line":53,"column":4},"end":{"line":57,"column":5}},"34":{"start":{"line":54,"column":8},"end":{"line":54,"column":27}},"35":{"start":{"line":55,"column":8},"end":{"line":55,"column":18}},"36":{"start":{"line":56,"column":8},"end":{"line":56,"column":15}},"37":{"start":{"line":59,"column":4},"end":{"line":73,"column":5}},"38":{"start":{"line":60,"column":21},"end":{"line":64,"column":10}},"39":{"start":{"line":65,"column":8},"end":{"line":72,"column":9}},"40":{"start":{"line":66,"column":12},"end":{"line":70,"column":15}},"41":{"start":{"line":71,"column":12},"end":{"line":71,"column":19}},"42":{"start":{"line":74,"column":4},"end":{"line":78,"column":7}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":31},"end":{"line":15,"column":32}},"loc":{"start":{"line":15,"column":75},"end":{"line":19,"column":1}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":17,"column":29},"end":{"line":17,"column":30}},"loc":{"start":{"line":17,"column":43},"end":{"line":17,"column":68}},"line":17},"3":{"name":"(anonymous_3)","decl":{"start":{"line":20,"column":29},"end":{"line":20,"column":30}},"loc":{"start":{"line":20,"column":64},"end":{"line":79,"column":1}},"line":20}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":4},"end":{"line":24,"column":5}},"type":"if","locations":[{"start":{"line":22,"column":4},"end":{"line":24,"column":5}},{"start":{"line":22,"column":4},"end":{"line":24,"column":5}}],"line":22},"1":{"loc":{"start":{"line":27,"column":4},"end":{"line":31,"column":5}},"type":"if","locations":[{"start":{"line":27,"column":4},"end":{"line":31,"column":5}},{"start":{"line":27,"column":4},"end":{"line":31,"column":5}}],"line":27},"2":{"loc":{"start":{"line":34,"column":4},"end":{"line":37,"column":5}},"type":"if","locations":[{"start":{"line":34,"column":4},"end":{"line":37,"column":5}},{"start":{"line":34,"column":4},"end":{"line":37,"column":5}}],"line":34},"3":{"loc":{"start":{"line":39,"column":4},"end":{"line":46,"column":5}},"type":"if","locations":[{"start":{"line":39,"column":4},"end":{"line":46,"column":5}},{"start":{"line":39,"column":4},"end":{"line":46,"column":5}}],"line":39},"4":{"loc":{"start":{"line":48,"column":4},"end":{"line":51,"column":5}},"type":"if","locations":[{"start":{"line":48,"column":4},"end":{"line":51,"column":5}},{"start":{"line":48,"column":4},"end":{"line":51,"column":5}}],"line":48},"5":{"loc":{"start":{"line":53,"column":4},"end":{"line":57,"column":5}},"type":"if","locations":[{"start":{"line":53,"column":4},"end":{"line":57,"column":5}},{"start":{"line":53,"column":4},"end":{"line":57,"column":5}}],"line":53},"6":{"loc":{"start":{"line":59,"column":4},"end":{"line":73,"column":5}},"type":"if","locations":[{"start":{"line":59,"column":4},"end":{"line":73,"column":5}},{"start":{"line":59,"column":4},"end":{"line":73,"column":5}}],"line":59},"7":{"loc":{"start":{"line":65,"column":8},"end":{"line":72,"column":9}},"type":"if","locations":[{"start":{"line":65,"column":8},"end":{"line":72,"column":9}},{"start":{"line":65,"column":8},"end":{"line":72,"column":9}}],"line":65},"8":{"loc":{"start":{"line":65,"column":12},"end":{"line":65,"column":65}},"type":"cond-expr","locations":[{"start":{"line":65,"column":47},"end":{"line":65,"column":53}},{"start":{"line":65,"column":56},"end":{"line":65,"column":65}}],"line":65},"9":{"loc":{"start":{"line":65,"column":12},"end":{"line":65,"column":44}},"type":"binary-expr","locations":[{"start":{"line":65,"column":12},"end":{"line":65,"column":25}},{"start":{"line":65,"column":29},"end":{"line":65,"column":44}}],"line":65}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":2,"11":1,"12":1,"13":8,"14":8,"15":1,"16":7,"17":7,"18":1,"19":1,"20":1,"21":6,"22":6,"23":6,"24":1,"25":1,"26":5,"27":1,"28":1,"29":4,"30":4,"31":1,"32":1,"33":3,"34":1,"35":1,"36":1,"37":2,"38":1,"39":1,"40":1,"41":1,"42":1},"f":{"0":1,"1":1,"2":2,"3":8},"b":{"0":[1,7],"1":[1,6],"2":[1,5],"3":[1,4],"4":[1,3],"5":[1,2],"6":[1,1],"7":[1,0],"8":[0,1],"9":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/user.ts"],"sourcesContent":["import type { IncomingMessage, ServerResponse } from 'http';\n\nimport type { IIncomingMessage } from '@rocket.chat/core-typings';\nimport { Avatars, Users } from '@rocket.chat/models';\nimport { serverFetch as fetch } from '@rocket.chat/server-fetch';\nimport type { NextFunction } from 'connect';\n\nimport { settings } from '../../../app/settings/server';\nimport { serveSvgAvatarInRequestedFormat, wasFallbackModified, setCacheAndDispositionHeaders, serveAvatarFile } from './utils';\n\nconst handleExternalProvider = async (externalProviderUrl: string, username: string, res: ServerResponse): Promise<void> => {\n\tconst response = await fetch(externalProviderUrl.replace('{username}', username));\n\tresponse.headers.forEach((value, key) => res.setHeader(key, value));\n\tresponse.body.pipe(res);\n};\n// request /avatar/@name forces returning the svg\nexport const userAvatarByUsername = async function (request: IncomingMessage, res: ServerResponse, next: NextFunction) {\n\tconst req = request as IIncomingMessage;\n\n\tif (!req.url) {\n\t\treturn;\n\t}\n\n\t// replace removes the query string\n\tconst requestUsername = decodeURIComponent(req.url.slice(1).replace(/\\?.*$/, ''));\n\tif (!requestUsername) {\n\t\tres.writeHead(404);\n\t\tres.end();\n\t\treturn;\n\t}\n\n\tsetCacheAndDispositionHeaders(req, res);\n\n\tconst externalProviderUrl = settings.get<string>('Accounts_AvatarExternalProviderUrl');\n\tif (externalProviderUrl) {\n\t\tvoid handleExternalProvider(externalProviderUrl, requestUsername, res);\n\t\treturn;\n\t}\n\n\t// if request starts with @ always return the svg letters\n\tif (requestUsername[0] === '@') {\n\t\tserveSvgAvatarInRequestedFormat({ nameOrUsername: requestUsername.slice(1), req, res });\n\t\treturn;\n\t}\n\n\tconst file = await Avatars.findOneByName(requestUsername);\n\tif (file) {\n\t\tvoid serveAvatarFile(file, req, res, next);\n\t\treturn;\n\t}\n\n\t// if still using \"letters fallback\"\n\tif (!wasFallbackModified(req.headers['if-modified-since'])) {\n\t\tres.writeHead(304);\n\t\tres.end();\n\t\treturn;\n\t}\n\n\t// Use real name for SVG letters\n\tif (settings.get('UI_Use_Name_Avatar')) {\n\t\tconst user = await Users.findOneByUsernameIgnoringCase(requestUsername, {\n\t\t\tprojection: {\n\t\t\t\tname: 1,\n\t\t\t},\n\t\t});\n\n\t\tif (user?.name) {\n\t\t\tserveSvgAvatarInRequestedFormat({ nameOrUsername: user.name, req, res });\n\t\t\treturn;\n\t\t}\n\t}\n\n\tserveSvgAvatarInRequestedFormat({ nameOrUsername: requestUsername, req, res });\n};\n"],"names":["userAvatarByUsername","handleExternalProvider","externalProviderUrl","username","res","response","fetch","replace","headers","forEach","value","key","setHeader","body","pipe","request","next","req","url","requestUsername","decodeURIComponent","slice","writeHead","end","setCacheAndDispositionHeaders","settings","get","serveSvgAvatarInRequestedFormat","nameOrUsername","file","Avatars","findOneByName","serveAvatarFile","wasFallbackModified","user","Users","findOneByUsernameIgnoringCase","projection","name"],"mappings":";;;;+BAgBaA;;;eAAAA;;;wBAbkB;6BACM;wBAGZ;uBAC4F;AAErH,MAAMC,yBAAyB,OAAOC,qBAA6BC,UAAkBC;IACpF,MAAMC,WAAW,MAAMC,IAAAA,wBAAK,EAACJ,oBAAoBK,OAAO,CAAC,cAAcJ;IACvEE,SAASG,OAAO,CAACC,OAAO,CAAC,CAACC,OAAOC,MAAQP,IAAIQ,SAAS,CAACD,KAAKD;IAC5DL,SAASQ,IAAI,CAACC,IAAI,CAACV;AACpB;AAEO,MAAMJ,uBAAuB,eAAgBe,OAAwB,EAAEX,GAAmB,EAAEY,IAAkB;IACpH,MAAMC,MAAMF;IAEZ,IAAI,CAACE,IAAIC,GAAG,EAAE;QACb;IACD;IAEA,mCAAmC;IACnC,MAAMC,kBAAkBC,mBAAmBH,IAAIC,GAAG,CAACG,KAAK,CAAC,GAAGd,OAAO,CAAC,SAAS;IAC7E,IAAI,CAACY,iBAAiB;QACrBf,IAAIkB,SAAS,CAAC;QACdlB,IAAImB,GAAG;QACP;IACD;IAEAC,IAAAA,oCAA6B,EAACP,KAAKb;IAEnC,MAAMF,sBAAsBuB,gBAAQ,CAACC,GAAG,CAAS;IACjD,IAAIxB,qBAAqB;QACxB,KAAKD,uBAAuBC,qBAAqBiB,iBAAiBf;QAClE;IACD;IAEA,yDAAyD;IACzD,IAAIe,eAAe,CAAC,EAAE,KAAK,KAAK;QAC/BQ,IAAAA,sCAA+B,EAAC;YAAEC,gBAAgBT,gBAAgBE,KAAK,CAAC;YAAIJ;YAAKb;QAAI;QACrF;IACD;IAEA,MAAMyB,OAAO,MAAMC,eAAO,CAACC,aAAa,CAACZ;IACzC,IAAIU,MAAM;QACT,KAAKG,IAAAA,sBAAe,EAACH,MAAMZ,KAAKb,KAAKY;QACrC;IACD;IAEA,oCAAoC;IACpC,IAAI,CAACiB,IAAAA,0BAAmB,EAAChB,IAAIT,OAAO,CAAC,oBAAoB,GAAG;QAC3DJ,IAAIkB,SAAS,CAAC;QACdlB,IAAImB,GAAG;QACP;IACD;IAEA,gCAAgC;IAChC,IAAIE,gBAAQ,CAACC,GAAG,CAAC,uBAAuB;QACvC,MAAMQ,OAAO,MAAMC,aAAK,CAACC,6BAA6B,CAACjB,iBAAiB;YACvEkB,YAAY;gBACXC,MAAM;YACP;QACD;QAEA,IAAIJ,iBAAAA,2BAAAA,KAAMI,IAAI,EAAE;YACfX,IAAAA,sCAA+B,EAAC;gBAAEC,gBAAgBM,KAAKI,IAAI;gBAAErB;gBAAKb;YAAI;YACtE;QACD;IACD;IAEAuB,IAAAA,sCAA+B,EAAC;QAAEC,gBAAgBT;QAAiBF;QAAKb;IAAI;AAC7E","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/user.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"48283fc74c6ce689019cb126061d036db892e552","contentHash":"f26effd3a944db5094e00836e6f9a09f25ecd2d8d7aeadfe7f0fabf9d780aa50"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/utils.spec.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/utils.spec.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":29}},"2":{"start":{"line":6,"column":15},"end":{"line":6,"column":31}},"3":{"start":{"line":7,"column":34},"end":{"line":7,"column":81}},"4":{"start":{"line":8,"column":29},"end":{"line":8,"column":71}},"5":{"start":{"line":10,"column":4},"end":{"line":12,"column":6}},"6":{"start":{"line":14,"column":18},"end":{"line":18,"column":1}},"7":{"start":{"line":16,"column":8},"end":{"line":16,"column":40}},"8":{"start":{"line":16,"column":34},"end":{"line":16,"column":39}},"9":{"start":{"line":19,"column":14},"end":{"line":23,"column":1}},"10":{"start":{"line":24,"column":220},"end":{"line":51,"column":2}},"11":{"start":{"line":29,"column":20},"end":{"line":29,"column":22}},"12":{"start":{"line":46,"column":18},"end":{"line":50,"column":9}},"13":{"start":{"line":47,"column":33},"end":{"line":49,"column":17}},"14":{"start":{"line":48,"column":33},"end":{"line":48,"column":50}},"15":{"start":{"line":52,"column":0},"end":{"line":94,"column":3}},"16":{"start":{"line":53,"column":17},"end":{"line":57,"column":5}},"17":{"start":{"line":58,"column":21},"end":{"line":62,"column":5}},"18":{"start":{"line":63,"column":17},"end":{"line":63,"column":37}},"19":{"start":{"line":64,"column":4},"end":{"line":69,"column":7}},"20":{"start":{"line":65,"column":8},"end":{"line":65,"column":42}},"21":{"start":{"line":66,"column":8},"end":{"line":66,"column":42}},"22":{"start":{"line":67,"column":8},"end":{"line":67,"column":36}},"23":{"start":{"line":68,"column":8},"end":{"line":68,"column":28}},"24":{"start":{"line":70,"column":4},"end":{"line":80,"column":7}},"25":{"start":{"line":71,"column":8},"end":{"line":75,"column":27}},"26":{"start":{"line":76,"column":8},"end":{"line":76,"column":128}},"27":{"start":{"line":77,"column":8},"end":{"line":77,"column":123}},"28":{"start":{"line":78,"column":8},"end":{"line":78,"column":73}},"29":{"start":{"line":79,"column":8},"end":{"line":79,"column":62}},"30":{"start":{"line":81,"column":4},"end":{"line":93,"column":7}},"31":{"start":{"line":82,"column":24},"end":{"line":86,"column":9}},"32":{"start":{"line":87,"column":8},"end":{"line":87,"column":55}},"33":{"start":{"line":88,"column":8},"end":{"line":88,"column":128}},"34":{"start":{"line":89,"column":8},"end":{"line":89,"column":123}},"35":{"start":{"line":90,"column":8},"end":{"line":90,"column":106}},"36":{"start":{"line":91,"column":8},"end":{"line":91,"column":108}},"37":{"start":{"line":92,"column":8},"end":{"line":92,"column":100}},"38":{"start":{"line":95,"column":0},"end":{"line":162,"column":3}},"39":{"start":{"line":96,"column":4},"end":{"line":121,"column":7}},"40":{"start":{"line":97,"column":8},"end":{"line":120,"column":11}},"41":{"start":{"line":102,"column":29},"end":{"line":106,"column":13}},"42":{"start":{"line":107,"column":12},"end":{"line":116,"column":15}},"43":{"start":{"line":117,"column":12},"end":{"line":117,"column":133}},"44":{"start":{"line":118,"column":12},"end":{"line":118,"column":118}},"45":{"start":{"line":119,"column":12},"end":{"line":119,"column":76}},"46":{"start":{"line":122,"column":4},"end":{"line":142,"column":7}},"47":{"start":{"line":123,"column":25},"end":{"line":127,"column":9}},"48":{"start":{"line":128,"column":8},"end":{"line":137,"column":11}},"49":{"start":{"line":138,"column":8},"end":{"line":138,"column":129}},"50":{"start":{"line":139,"column":8},"end":{"line":139,"column":112}},"51":{"start":{"line":140,"column":8},"end":{"line":140,"column":60}},"52":{"start":{"line":141,"column":8},"end":{"line":141,"column":62}},"53":{"start":{"line":143,"column":4},"end":{"line":161,"column":7}},"54":{"start":{"line":144,"column":25},"end":{"line":148,"column":9}},"55":{"start":{"line":149,"column":8},"end":{"line":155,"column":11}},"56":{"start":{"line":156,"column":8},"end":{"line":156,"column":129}},"57":{"start":{"line":157,"column":8},"end":{"line":157,"column":112}},"58":{"start":{"line":158,"column":8},"end":{"line":158,"column":60}},"59":{"start":{"line":159,"column":8},"end":{"line":159,"column":97}},"60":{"start":{"line":160,"column":8},"end":{"line":160,"column":62}},"61":{"start":{"line":163,"column":0},"end":{"line":190,"column":3}},"62":{"start":{"line":164,"column":4},"end":{"line":168,"column":7}},"63":{"start":{"line":165,"column":8},"end":{"line":167,"column":32}},"64":{"start":{"line":169,"column":4},"end":{"line":175,"column":7}},"65":{"start":{"line":170,"column":8},"end":{"line":174,"column":26}},"66":{"start":{"line":176,"column":4},"end":{"line":182,"column":7}},"67":{"start":{"line":177,"column":8},"end":{"line":181,"column":25}},"68":{"start":{"line":183,"column":4},"end":{"line":189,"column":7}},"69":{"start":{"line":184,"column":8},"end":{"line":188,"column":27}},"70":{"start":{"line":191,"column":0},"end":{"line":198,"column":3}},"71":{"start":{"line":192,"column":4},"end":{"line":194,"column":7}},"72":{"start":{"line":193,"column":8},"end":{"line":193,"column":66}},"73":{"start":{"line":195,"column":4},"end":{"line":197,"column":7}},"74":{"start":{"line":196,"column":8},"end":{"line":196,"column":96}},"75":{"start":{"line":199,"column":0},"end":{"line":213,"column":3}},"76":{"start":{"line":200,"column":4},"end":{"line":204,"column":7}},"77":{"start":{"line":201,"column":8},"end":{"line":201,"column":86}},"78":{"start":{"line":202,"column":8},"end":{"line":202,"column":83}},"79":{"start":{"line":203,"column":8},"end":{"line":203,"column":83}},"80":{"start":{"line":205,"column":4},"end":{"line":207,"column":7}},"81":{"start":{"line":206,"column":8},"end":{"line":206,"column":111}},"82":{"start":{"line":208,"column":4},"end":{"line":212,"column":7}},"83":{"start":{"line":209,"column":8},"end":{"line":209,"column":92}},"84":{"start":{"line":210,"column":8},"end":{"line":210,"column":89}},"85":{"start":{"line":211,"column":8},"end":{"line":211,"column":89}},"86":{"start":{"line":214,"column":0},"end":{"line":240,"column":3}},"87":{"start":{"line":215,"column":4},"end":{"line":227,"column":7}},"88":{"start":{"line":216,"column":24},"end":{"line":220,"column":9}},"89":{"start":{"line":221,"column":25},"end":{"line":223,"column":9}},"90":{"start":{"line":224,"column":8},"end":{"line":224,"column":57}},"91":{"start":{"line":225,"column":8},"end":{"line":225,"column":108}},"92":{"start":{"line":226,"column":8},"end":{"line":226,"column":101}},"93":{"start":{"line":228,"column":4},"end":{"line":239,"column":7}},"94":{"start":{"line":229,"column":24},"end":{"line":231,"column":9}},"95":{"start":{"line":232,"column":25},"end":{"line":234,"column":9}},"96":{"start":{"line":235,"column":8},"end":{"line":235,"column":39}},"97":{"start":{"line":236,"column":8},"end":{"line":236,"column":57}},"98":{"start":{"line":237,"column":8},"end":{"line":237,"column":108}},"99":{"start":{"line":238,"column":8},"end":{"line":238,"column":101}},"100":{"start":{"line":241,"column":0},"end":{"line":286,"column":3}},"101":{"start":{"line":242,"column":4},"end":{"line":245,"column":7}},"102":{"start":{"line":243,"column":8},"end":{"line":243,"column":47}},"103":{"start":{"line":244,"column":8},"end":{"line":244,"column":34}},"104":{"start":{"line":246,"column":4},"end":{"line":248,"column":7}},"105":{"start":{"line":247,"column":8},"end":{"line":247,"column":83}},"106":{"start":{"line":249,"column":4},"end":{"line":265,"column":7}},"107":{"start":{"line":250,"column":8},"end":{"line":250,"column":40}},"108":{"start":{"line":251,"column":8},"end":{"line":253,"column":11}},"109":{"start":{"line":254,"column":8},"end":{"line":259,"column":38}},"110":{"start":{"line":260,"column":8},"end":{"line":264,"column":38}},"111":{"start":{"line":266,"column":4},"end":{"line":285,"column":7}},"112":{"start":{"line":267,"column":8},"end":{"line":267,"column":44}},"113":{"start":{"line":268,"column":8},"end":{"line":268,"column":58}},"114":{"start":{"line":269,"column":8},"end":{"line":269,"column":40}},"115":{"start":{"line":270,"column":8},"end":{"line":270,"column":84}},"116":{"start":{"line":271,"column":8},"end":{"line":271,"column":103}},"117":{"start":{"line":272,"column":8},"end":{"line":276,"column":39}},"118":{"start":{"line":277,"column":8},"end":{"line":277,"column":103}},"119":{"start":{"line":278,"column":8},"end":{"line":283,"column":39}},"120":{"start":{"line":284,"column":8},"end":{"line":284,"column":103}}},"fnMap":{"0":{"name":"_interop_require_default","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":33}},"loc":{"start":{"line":9,"column":39},"end":{"line":13,"column":1}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":17},"end":{"line":17,"column":5}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":19},"end":{"line":16,"column":20}},"loc":{"start":{"line":16,"column":34},"end":{"line":16,"column":39}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":29,"column":16},"end":{"line":29,"column":17}},"loc":{"start":{"line":29,"column":20},"end":{"line":29,"column":22}},"line":29},"4":{"name":"(anonymous_4)","decl":{"start":{"line":46,"column":13},"end":{"line":46,"column":14}},"loc":{"start":{"line":46,"column":18},"end":{"line":50,"column":9}},"line":46},"5":{"name":"(anonymous_5)","decl":{"start":{"line":47,"column":22},"end":{"line":47,"column":23}},"loc":{"start":{"line":47,"column":33},"end":{"line":49,"column":17}},"line":47},"6":{"name":"(anonymous_6)","decl":{"start":{"line":48,"column":26},"end":{"line":48,"column":27}},"loc":{"start":{"line":48,"column":33},"end":{"line":48,"column":50}},"line":48},"7":{"name":"(anonymous_7)","decl":{"start":{"line":52,"column":43},"end":{"line":52,"column":44}},"loc":{"start":{"line":52,"column":47},"end":{"line":94,"column":1}},"line":52},"8":{"name":"(anonymous_8)","decl":{"start":{"line":64,"column":14},"end":{"line":64,"column":15}},"loc":{"start":{"line":64,"column":18},"end":{"line":69,"column":5}},"line":64},"9":{"name":"(anonymous_9)","decl":{"start":{"line":70,"column":72},"end":{"line":70,"column":73}},"loc":{"start":{"line":70,"column":76},"end":{"line":80,"column":5}},"line":70},"10":{"name":"(anonymous_10)","decl":{"start":{"line":81,"column":42},"end":{"line":81,"column":43}},"loc":{"start":{"line":81,"column":46},"end":{"line":93,"column":5}},"line":81},"11":{"name":"(anonymous_11)","decl":{"start":{"line":95,"column":59},"end":{"line":95,"column":60}},"loc":{"start":{"line":95,"column":63},"end":{"line":162,"column":1}},"line":95},"12":{"name":"(anonymous_12)","decl":{"start":{"line":96,"column":66},"end":{"line":96,"column":67}},"loc":{"start":{"line":96,"column":70},"end":{"line":121,"column":5}},"line":96},"13":{"name":"(anonymous_13)","decl":{"start":{"line":101,"column":18},"end":{"line":101,"column":19}},"loc":{"start":{"line":101,"column":28},"end":{"line":120,"column":9}},"line":101},"14":{"name":"(anonymous_14)","decl":{"start":{"line":122,"column":100},"end":{"line":122,"column":101}},"loc":{"start":{"line":122,"column":104},"end":{"line":142,"column":5}},"line":122},"15":{"name":"(anonymous_15)","decl":{"start":{"line":143,"column":74},"end":{"line":143,"column":75}},"loc":{"start":{"line":143,"column":78},"end":{"line":161,"column":5}},"line":143},"16":{"name":"(anonymous_16)","decl":{"start":{"line":163,"column":52},"end":{"line":163,"column":53}},"loc":{"start":{"line":163,"column":56},"end":{"line":190,"column":1}},"line":163},"17":{"name":"(anonymous_17)","decl":{"start":{"line":164,"column":70},"end":{"line":164,"column":71}},"loc":{"start":{"line":164,"column":74},"end":{"line":168,"column":5}},"line":164},"18":{"name":"(anonymous_18)","decl":{"start":{"line":169,"column":95},"end":{"line":169,"column":96}},"loc":{"start":{"line":169,"column":99},"end":{"line":175,"column":5}},"line":169},"19":{"name":"(anonymous_19)","decl":{"start":{"line":176,"column":103},"end":{"line":176,"column":104}},"loc":{"start":{"line":176,"column":107},"end":{"line":182,"column":5}},"line":176},"20":{"name":"(anonymous_20)","decl":{"start":{"line":183,"column":102},"end":{"line":183,"column":103}},"loc":{"start":{"line":183,"column":106},"end":{"line":189,"column":5}},"line":183},"21":{"name":"(anonymous_21)","decl":{"start":{"line":191,"column":47},"end":{"line":191,"column":48}},"loc":{"start":{"line":191,"column":51},"end":{"line":198,"column":1}},"line":191},"22":{"name":"(anonymous_22)","decl":{"start":{"line":192,"column":103},"end":{"line":192,"column":104}},"loc":{"start":{"line":192,"column":107},"end":{"line":194,"column":5}},"line":192},"23":{"name":"(anonymous_23)","decl":{"start":{"line":195,"column":94},"end":{"line":195,"column":95}},"loc":{"start":{"line":195,"column":98},"end":{"line":197,"column":5}},"line":195},"24":{"name":"(anonymous_24)","decl":{"start":{"line":199,"column":42},"end":{"line":199,"column":43}},"loc":{"start":{"line":199,"column":46},"end":{"line":213,"column":1}},"line":199},"25":{"name":"(anonymous_25)","decl":{"start":{"line":200,"column":72},"end":{"line":200,"column":73}},"loc":{"start":{"line":200,"column":76},"end":{"line":204,"column":5}},"line":200},"26":{"name":"(anonymous_26)","decl":{"start":{"line":205,"column":66},"end":{"line":205,"column":67}},"loc":{"start":{"line":205,"column":70},"end":{"line":207,"column":5}},"line":205},"27":{"name":"(anonymous_27)","decl":{"start":{"line":208,"column":62},"end":{"line":208,"column":63}},"loc":{"start":{"line":208,"column":66},"end":{"line":212,"column":5}},"line":208},"28":{"name":"(anonymous_28)","decl":{"start":{"line":214,"column":55},"end":{"line":214,"column":56}},"loc":{"start":{"line":214,"column":59},"end":{"line":240,"column":1}},"line":214},"29":{"name":"(anonymous_29)","decl":{"start":{"line":215,"column":87},"end":{"line":215,"column":88}},"loc":{"start":{"line":215,"column":91},"end":{"line":227,"column":5}},"line":215},"30":{"name":"(anonymous_30)","decl":{"start":{"line":228,"column":113},"end":{"line":228,"column":114}},"loc":{"start":{"line":228,"column":117},"end":{"line":239,"column":5}},"line":228},"31":{"name":"(anonymous_31)","decl":{"start":{"line":241,"column":47},"end":{"line":241,"column":48}},"loc":{"start":{"line":241,"column":57},"end":{"line":286,"column":1}},"line":241},"32":{"name":"(anonymous_32)","decl":{"start":{"line":242,"column":15},"end":{"line":242,"column":16}},"loc":{"start":{"line":242,"column":19},"end":{"line":245,"column":5}},"line":242},"33":{"name":"(anonymous_33)","decl":{"start":{"line":246,"column":80},"end":{"line":246,"column":81}},"loc":{"start":{"line":246,"column":90},"end":{"line":248,"column":5}},"line":246},"34":{"name":"(anonymous_34)","decl":{"start":{"line":249,"column":66},"end":{"line":249,"column":67}},"loc":{"start":{"line":249,"column":76},"end":{"line":265,"column":5}},"line":249},"35":{"name":"(anonymous_35)","decl":{"start":{"line":266,"column":78},"end":{"line":266,"column":79}},"loc":{"start":{"line":266,"column":88},"end":{"line":285,"column":5}},"line":266}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":11},"end":{"line":12,"column":5}},"type":"cond-expr","locations":[{"start":{"line":10,"column":35},"end":{"line":10,"column":38}},{"start":{"line":10,"column":41},"end":{"line":12,"column":5}}],"line":10},"1":{"loc":{"start":{"line":10,"column":11},"end":{"line":10,"column":32}},"type":"binary-expr","locations":[{"start":{"line":10,"column":11},"end":{"line":10,"column":14}},{"start":{"line":10,"column":18},"end":{"line":10,"column":32}}],"line":10}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":2,"6":1,"7":1,"8":4,"9":1,"10":1,"11":0,"12":3,"13":3,"14":3,"15":1,"16":1,"17":1,"18":1,"19":1,"20":2,"21":2,"22":2,"23":2,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":3,"42":3,"43":3,"44":3,"45":3,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1,"61":1,"62":1,"63":1,"64":1,"65":1,"66":1,"67":1,"68":1,"69":1,"70":1,"71":1,"72":1,"73":1,"74":1,"75":1,"76":1,"77":1,"78":1,"79":1,"80":1,"81":1,"82":1,"83":1,"84":1,"85":1,"86":1,"87":1,"88":1,"89":1,"90":1,"91":1,"92":1,"93":1,"94":1,"95":1,"96":1,"97":1,"98":1,"99":1,"100":1,"101":1,"102":3,"103":3,"104":1,"105":1,"106":1,"107":1,"108":1,"109":1,"110":1,"111":1,"112":1,"113":1,"114":1,"115":1,"116":1,"117":1,"118":1,"119":1,"120":1},"f":{"0":2,"1":1,"2":4,"3":0,"4":3,"5":3,"6":3,"7":1,"8":2,"9":1,"10":1,"11":1,"12":1,"13":3,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":3,"33":1,"34":1,"35":1},"b":{"0":[0,2],"1":[2,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/utils.spec.ts"],"sourcesContent":["import { expect } from 'chai';\nimport { describe, it } from 'mocha';\nimport proxyquire from 'proxyquire';\nimport sinon from 'sinon';\n\nclass CookiesMock {\n\tpublic get = (_key: any, value: any) => value;\n}\n\nconst mocks = {\n\tsettingsGet: sinon.stub(),\n\tfindOneByIdAndLoginToken: sinon.stub(),\n\tfileUploadGet: sinon.spy(),\n};\n\nconst {\n\tgetAvatarSizeFromRequest,\n\tMIN_SVG_AVATAR_SIZE,\n\tMAX_SVG_AVATAR_SIZE,\n\trenderSVGLetters,\n\tsetCacheAndDispositionHeaders,\n\tuserCanAccessAvatar,\n\twasFallbackModified,\n\tserveSvgAvatarInRequestedFormat,\n\tserveAvatarFile,\n} = proxyquire.noCallThru().load('./utils', {\n\t'meteor/ostrio:cookies': {\n\t\tCookies: CookiesMock,\n\t},\n\t'../../../../app/utils/server/getURL': {\n\t\tgetURL: () => '',\n\t},\n\t'@rocket.chat/models': {\n\t\tUsers: {\n\t\t\tfindOneByIdAndLoginToken: mocks.findOneByIdAndLoginToken,\n\t\t},\n\t},\n\t'../../../app/file-upload/server': {\n\t\tFileUpload: {\n\t\t\tget: mocks.fileUploadGet,\n\t\t},\n\t},\n\t'../../../app/settings/server': {\n\t\tsettings: {\n\t\t\tget: mocks.settingsGet,\n\t\t},\n\t},\n\t'sharp': () => ({ toFormat: (format: any) => ({ pipe: (res: any) => res.write(format) }) }),\n});\n\ndescribe('#serveAvatarFile()', () => {\n\tconst file = { uploadedAt: new Date(0), type: 'image/png', size: 100 };\n\tconst response = {\n\t\tsetHeader: sinon.spy(),\n\t\twriteHead: sinon.spy(),\n\t\tend: sinon.spy(),\n\t};\n\tconst next = sinon.spy();\n\n\tafterEach(() => {\n\t\tresponse.setHeader.resetHistory();\n\t\tresponse.writeHead.resetHistory();\n\t\tresponse.end.resetHistory();\n\t\tnext.resetHistory();\n\t});\n\n\tit(`should return code 304 if avatar was not modified`, () => {\n\t\tserveAvatarFile(file, { headers: { 'if-modified-since': new Date(0).toUTCString() } }, response, next);\n\t\texpect(response.setHeader.getCall(0).calledWith('Content-Security-Policy', \"default-src 'none'\")).to.be.true;\n\t\texpect(response.setHeader.getCall(1).calledWith('Last-Modified', new Date(0).toUTCString())).to.be.true;\n\t\texpect(response.writeHead.calledWith(304)).to.be.true;\n\t\texpect(response.end.calledOnce).to.be.true;\n\t});\n\n\tit('should serve avatar', () => {\n\t\tconst request = { headers: { 'if-modified-since': new Date(200000).toUTCString() } };\n\t\tserveAvatarFile(file, request, response, next);\n\t\texpect(response.setHeader.getCall(0).calledWith('Content-Security-Policy', \"default-src 'none'\")).to.be.true;\n\t\texpect(response.setHeader.getCall(1).calledWith('Last-Modified', new Date(0).toUTCString())).to.be.true;\n\t\texpect(response.setHeader.getCall(2).calledWith('Content-Type', file.type)).to.be.true;\n\t\texpect(response.setHeader.getCall(3).calledWith('Content-Length', file.size)).to.be.true;\n\t\texpect(mocks.fileUploadGet.calledWith(file, request, response, next)).to.be.true;\n\t});\n});\n\ndescribe('#serveSvgAvatarInRequestedFormat()', () => {\n\tit('should serve SVG avatar in requested format', () => {\n\t\t['png', 'jpg', 'jpeg'].forEach((format) => {\n\t\t\tconst response = {\n\t\t\t\tsetHeader: sinon.spy(),\n\t\t\t\twrite: sinon.spy(),\n\t\t\t\tend: sinon.spy(),\n\t\t\t};\n\t\t\tserveSvgAvatarInRequestedFormat({ req: { query: { format, size: 100 } }, res: response, nameOrUsername: 'name' });\n\n\t\t\texpect(response.setHeader.getCall(0).calledWith('Last-Modified', 'Thu, 01 Jan 2015 00:00:00 GMT')).to.be.true;\n\t\t\texpect(response.setHeader.getCall(1).calledWith('Content-Type', `image/${format}`)).to.be.true;\n\t\t\texpect(response.write.calledWith(format)).to.be.true;\n\t\t});\n\t});\n\tit(`should serve avatar in SVG format if requested format is not png, jpg or jpeg`, () => {\n\t\tconst response = {\n\t\t\tsetHeader: sinon.spy(),\n\t\t\twrite: sinon.spy(),\n\t\t\tend: sinon.spy(),\n\t\t};\n\t\tserveSvgAvatarInRequestedFormat({ req: { query: { format: 'anythingElse', size: 100 } }, res: response, nameOrUsername: 'name' });\n\n\t\texpect(response.setHeader.getCall(0).calledWith('Last-Modified', 'Thu, 01 Jan 2015 00:00:00 GMT')).to.be.true;\n\t\texpect(response.setHeader.getCall(1).calledWith('Content-Type', 'image/svg+xml')).to.be.true;\n\t\texpect(response.write.called).to.be.true;\n\t\texpect(response.end.calledOnce).to.be.true;\n\t});\n\tit(`should default size to 200 if not provided in query`, () => {\n\t\tconst response = {\n\t\t\tsetHeader: sinon.spy(),\n\t\t\twrite: sinon.spy(),\n\t\t\tend: sinon.spy(),\n\t\t};\n\t\tserveSvgAvatarInRequestedFormat({ req: { query: {} }, res: response, nameOrUsername: 'name' });\n\n\t\texpect(response.setHeader.getCall(0).calledWith('Last-Modified', 'Thu, 01 Jan 2015 00:00:00 GMT')).to.be.true;\n\t\texpect(response.setHeader.getCall(1).calledWith('Content-Type', 'image/svg+xml')).to.be.true;\n\t\texpect(response.write.called).to.be.true;\n\t\texpect(response.write.getCall(0).args[0]).to.include('viewBox=\"0 0 200 200\"');\n\t\texpect(response.end.calledOnce).to.be.true;\n\t});\n});\n\ndescribe('#getAvatarSizeFromRequest()', () => {\n\tit('should return undefined if size is not provided', () => {\n\t\texpect(getAvatarSizeFromRequest({ query: {} })).to.equal(undefined);\n\t});\n\tit('should return value passed in the request if it falls in the range limit', () => {\n\t\texpect(getAvatarSizeFromRequest({ query: { size: 100 } })).to.equal(100);\n\t});\n\tit(`should return ${MIN_SVG_AVATAR_SIZE} if requested size is smaller than the limit`, () => {\n\t\texpect(getAvatarSizeFromRequest({ query: { size: 2 } })).to.equal(16);\n\t});\n\tit(`should return ${MAX_SVG_AVATAR_SIZE} if requested size is bigger than the limit`, () => {\n\t\texpect(getAvatarSizeFromRequest({ query: { size: 2000 } })).to.equal(1024);\n\t});\n});\n\ndescribe('#wasFallbackModified()', () => {\n\tit('should return true if reqModifiedHeader is different from FALLBACK_LAST_MODIFIED', () => {\n\t\texpect(wasFallbackModified('')).to.equal(true);\n\t});\n\tit('should false if reqModifiedHeader is the same as FALLBACK_LAST_MODIFIED', () => {\n\t\texpect(wasFallbackModified('Thu, 01 Jan 2015 00:00:00 GMT')).to.equal(false);\n\t});\n});\n\ndescribe('#renderSvgLetters', () => {\n\tit('should show capitalized initial letter in the svg', () => {\n\t\texpect(renderSVGLetters('arthur', 16)).to.include('>\\nA\\n</text>');\n\t\texpect(renderSVGLetters('Bob', 16)).to.include('>\\nB\\n</text>');\n\t\texpect(renderSVGLetters('yan', 16)).to.include('>\\nY\\n</text>');\n\t});\n\tit('should render question mark with color #000', () => {\n\t\texpect(renderSVGLetters('?', 16)).to.include('>\\n?\\n</text>').and.to.include('fill=\"#000\"');\n\t});\n\tit('should include size in viewBox property', () => {\n\t\texpect(renderSVGLetters('arthur', 16)).to.include('viewBox=\"0 0 16 16\"');\n\t\texpect(renderSVGLetters('Bob', 32)).to.include('viewBox=\"0 0 32 32\"');\n\t\texpect(renderSVGLetters('yan', 64)).to.include('viewBox=\"0 0 64 64\"');\n\t});\n});\n\ndescribe('#setCacheAndDispositionHeaders', () => {\n\tit('should set the Cache-Control header based on the query cacheTime', () => {\n\t\tconst request = {\n\t\t\tquery: {\n\t\t\t\tcacheTime: 100,\n\t\t\t},\n\t\t};\n\n\t\tconst response = {\n\t\t\tsetHeader: sinon.spy(),\n\t\t};\n\t\tsetCacheAndDispositionHeaders(request as any, response as any);\n\t\texpect(response.setHeader.calledWith('Cache-Control', 'public, max-age=100')).to.be.true;\n\t\texpect(response.setHeader.calledWith('Content-Disposition', 'inline')).to.be.true;\n\t});\n\n\tit('should set the Cache-Control header based on the setting if the query cacheTime is not set', () => {\n\t\tconst request = {\n\t\t\tquery: {},\n\t\t};\n\n\t\tconst response = {\n\t\t\tsetHeader: sinon.spy(),\n\t\t};\n\n\t\tmocks.settingsGet.returns(100);\n\t\tsetCacheAndDispositionHeaders(request as any, response as any);\n\t\texpect(response.setHeader.calledWith('Cache-Control', 'public, max-age=100')).to.be.true;\n\t\texpect(response.setHeader.calledWith('Content-Disposition', 'inline')).to.be.true;\n\t});\n});\n\ndescribe('#userCanAccessAvatar()', async () => {\n\tbeforeEach(() => {\n\t\tmocks.findOneByIdAndLoginToken.reset();\n\t\tmocks.settingsGet.reset();\n\t});\n\tit('should return true if setting is set to not block avatars', async () => {\n\t\tawait expect(userCanAccessAvatar({})).to.eventually.equal(true);\n\t});\n\tit('should return true if user is authenticated', async () => {\n\t\tmocks.settingsGet.returns(true);\n\t\tmocks.findOneByIdAndLoginToken.returns({ _id: 'id' });\n\n\t\tawait expect(userCanAccessAvatar({ query: { rc_token: 'token', rc_uid: 'id' } })).to.eventually.equal(true);\n\t\tawait expect(userCanAccessAvatar({ headers: { cookie: 'rc_token=token; rc_uid=id' } })).to.eventually.equal(true);\n\t});\n\tit('should return false and warn if user is unauthenticated', async () => {\n\t\tconsole.warn = sinon.spy();\n\t\tmocks.findOneByIdAndLoginToken.returns(undefined);\n\t\tmocks.settingsGet.returns(true);\n\n\t\tawait expect(userCanAccessAvatar({})).to.eventually.equal(false);\n\t\texpect((console.warn as sinon.SinonSpy).calledWith(sinon.match('unauthenticated'))).to.be.true;\n\n\t\tawait expect(userCanAccessAvatar({ headers: { cookie: 'rc_token=token; rc_uid=id' } })).to.eventually.equal(false);\n\t\texpect((console.warn as sinon.SinonSpy).calledWith(sinon.match('unauthenticated'))).to.be.true;\n\n\t\tawait expect(userCanAccessAvatar({ query: { rc_token: 'token', rc_uid: 'id' } })).to.eventually.equal(false);\n\t\texpect((console.warn as sinon.SinonSpy).calledWith(sinon.match('unauthenticated'))).to.be.true;\n\t});\n});\n"],"names":["CookiesMock","get","_key","value","mocks","settingsGet","sinon","stub","findOneByIdAndLoginToken","fileUploadGet","spy","getAvatarSizeFromRequest","MIN_SVG_AVATAR_SIZE","MAX_SVG_AVATAR_SIZE","renderSVGLetters","setCacheAndDispositionHeaders","userCanAccessAvatar","wasFallbackModified","serveSvgAvatarInRequestedFormat","serveAvatarFile","proxyquire","noCallThru","load","Cookies","getURL","Users","FileUpload","settings","toFormat","format","pipe","res","write","describe","file","uploadedAt","Date","type","size","response","setHeader","writeHead","end","next","afterEach","resetHistory","it","headers","toUTCString","expect","getCall","calledWith","to","be","true","calledOnce","request","forEach","req","query","nameOrUsername","called","args","include","equal","undefined","and","cacheTime","returns","beforeEach","reset","eventually","_id","rc_token","rc_uid","cookie","console","warn","match"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/utils.spec.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"af8300e845f96b202e4070c969016d598af4b273","contentHash":"37fdaed43eafae1be2fede2003a9ed653e52bf47582d82736ba8c590b8828511"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/utils.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/utils.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":39,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":35}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":35}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":40}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":32}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":31}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":47}},"10":{"start":{"line":31,"column":8},"end":{"line":31,"column":45}},"11":{"start":{"line":34,"column":8},"end":{"line":34,"column":35}},"12":{"start":{"line":37,"column":8},"end":{"line":37,"column":35}},"13":{"start":{"line":40,"column":22},"end":{"line":40,"column":59}},"14":{"start":{"line":41,"column":16},"end":{"line":41,"column":46}},"15":{"start":{"line":42,"column":23},"end":{"line":42,"column":55}},"16":{"start":{"line":43,"column":29},"end":{"line":43,"column":71}},"17":{"start":{"line":44,"column":20},"end":{"line":44,"column":41}},"18":{"start":{"line":45,"column":16},"end":{"line":45,"column":58}},"19":{"start":{"line":46,"column":17},"end":{"line":46,"column":56}},"20":{"start":{"line":47,"column":24},"end":{"line":47,"column":72}},"21":{"start":{"line":49,"column":4},"end":{"line":51,"column":6}},"22":{"start":{"line":53,"column":31},"end":{"line":53,"column":62}},"23":{"start":{"line":54,"column":15},"end":{"line":54,"column":43}},"24":{"start":{"line":55,"column":28},"end":{"line":55,"column":32}},"25":{"start":{"line":56,"column":28},"end":{"line":56,"column":30}},"26":{"start":{"line":57,"column":24},"end":{"line":78,"column":1}},"27":{"start":{"line":59,"column":4},"end":{"line":59,"column":67}},"28":{"start":{"line":60,"column":30},"end":{"line":60,"column":62}},"29":{"start":{"line":61,"column":4},"end":{"line":66,"column":5}},"30":{"start":{"line":62,"column":8},"end":{"line":62,"column":58}},"31":{"start":{"line":63,"column":8},"end":{"line":63,"column":27}},"32":{"start":{"line":64,"column":8},"end":{"line":64,"column":18}},"33":{"start":{"line":65,"column":8},"end":{"line":65,"column":15}},"34":{"start":{"line":67,"column":4},"end":{"line":70,"column":5}},"35":{"start":{"line":69,"column":8},"end":{"line":69,"column":162}},"36":{"start":{"line":71,"column":4},"end":{"line":73,"column":5}},"37":{"start":{"line":72,"column":8},"end":{"line":72,"column":49}},"38":{"start":{"line":74,"column":4},"end":{"line":76,"column":5}},"39":{"start":{"line":75,"column":8},"end":{"line":75,"column":51}},"40":{"start":{"line":77,"column":4},"end":{"line":77,"column":56}},"41":{"start":{"line":79,"column":33},"end":{"line":85,"column":1}},"42":{"start":{"line":80,"column":24},"end":{"line":80,"column":66}},"43":{"start":{"line":81,"column":4},"end":{"line":83,"column":5}},"44":{"start":{"line":82,"column":8},"end":{"line":82,"column":15}},"45":{"start":{"line":84,"column":4},"end":{"line":84,"column":85}},"46":{"start":{"line":86,"column":40},"end":{"line":103,"column":1}},"47":{"start":{"line":87,"column":17},"end":{"line":87,"column":46}},"48":{"start":{"line":88,"column":19},"end":{"line":88,"column":57}},"49":{"start":{"line":89,"column":4},"end":{"line":89,"column":59}},"50":{"start":{"line":90,"column":23},"end":{"line":90,"column":32}},"51":{"start":{"line":91,"column":4},"end":{"line":99,"column":5}},"52":{"start":{"line":96,"column":8},"end":{"line":96,"column":57}},"53":{"start":{"line":97,"column":8},"end":{"line":97,"column":76}},"54":{"start":{"line":98,"column":8},"end":{"line":98,"column":15}},"55":{"start":{"line":100,"column":4},"end":{"line":100,"column":51}},"56":{"start":{"line":101,"column":4},"end":{"line":101,"column":22}},"57":{"start":{"line":102,"column":4},"end":{"line":102,"column":14}},"58":{"start":{"line":104,"column":28},"end":{"line":109,"column":1}},"59":{"start":{"line":105,"column":4},"end":{"line":107,"column":5}},"60":{"start":{"line":106,"column":8},"end":{"line":106,"column":20}},"61":{"start":{"line":108,"column":4},"end":{"line":108,"column":17}},"62":{"start":{"line":111,"column":31},"end":{"line":111,"column":36}},"63":{"start":{"line":112,"column":4},"end":{"line":115,"column":5}},"64":{"start":{"line":113,"column":8},"end":{"line":113,"column":54}},"65":{"start":{"line":114,"column":8},"end":{"line":114,"column":58}},"66":{"start":{"line":116,"column":4},"end":{"line":118,"column":5}},"67":{"start":{"line":117,"column":8},"end":{"line":117,"column":21}},"68":{"start":{"line":119,"column":22},"end":{"line":123,"column":6}},"69":{"start":{"line":124,"column":4},"end":{"line":124,"column":23}},"70":{"start":{"line":126,"column":34},"end":{"line":128,"column":14}},"71":{"start":{"line":127,"column":4},"end":{"line":127,"column":139}},"72":{"start":{"line":130,"column":4},"end":{"line":132,"column":5}},"73":{"start":{"line":131,"column":8},"end":{"line":131,"column":20}},"74":{"start":{"line":133,"column":28},"end":{"line":136,"column":6}},"75":{"start":{"line":137,"column":4},"end":{"line":139,"column":5}},"76":{"start":{"line":138,"column":8},"end":{"line":138,"column":36}},"77":{"start":{"line":140,"column":4},"end":{"line":140,"column":27}},"78":{"start":{"line":142,"column":23},"end":{"line":142,"column":91}},"79":{"start":{"line":142,"column":31},"end":{"line":142,"column":91}},"80":{"start":{"line":143,"column":25},"end":{"line":155,"column":1}},"81":{"start":{"line":144,"column":16},"end":{"line":144,"column":18}},"82":{"start":{"line":145,"column":19},"end":{"line":145,"column":21}},"83":{"start":{"line":146,"column":4},"end":{"line":152,"column":5}},"84":{"start":{"line":147,"column":8},"end":{"line":147,"column":23}},"85":{"start":{"line":148,"column":8},"end":{"line":148,"column":28}},"86":{"start":{"line":150,"column":8},"end":{"line":150,"column":62}},"87":{"start":{"line":151,"column":8},"end":{"line":151,"column":44}},"88":{"start":{"line":153,"column":21},"end":{"line":153,"column":35}},"89":{"start":{"line":154,"column":4},"end":{"line":154,"column":382}},"90":{"start":{"line":156,"column":21},"end":{"line":156,"column":96}},"91":{"start":{"line":156,"column":34},"end":{"line":156,"column":96}},"92":{"start":{"line":158,"column":22},"end":{"line":158,"column":55}},"93":{"start":{"line":159,"column":4},"end":{"line":159,"column":67}},"94":{"start":{"line":160,"column":4},"end":{"line":160,"column":51}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":25},"end":{"line":12,"column":26}},"loc":{"start":{"line":12,"column":36},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":25},"end":{"line":15,"column":26}},"loc":{"start":{"line":15,"column":36},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":30},"end":{"line":18,"column":31}},"loc":{"start":{"line":18,"column":41},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":22},"end":{"line":21,"column":23}},"loc":{"start":{"line":21,"column":33},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":21},"end":{"line":24,"column":22}},"loc":{"start":{"line":24,"column":32},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":37},"end":{"line":27,"column":38}},"loc":{"start":{"line":27,"column":48},"end":{"line":29,"column":5}},"line":27},"7":{"name":"(anonymous_7)","decl":{"start":{"line":30,"column":35},"end":{"line":30,"column":36}},"loc":{"start":{"line":30,"column":46},"end":{"line":32,"column":5}},"line":30},"8":{"name":"(anonymous_8)","decl":{"start":{"line":33,"column":25},"end":{"line":33,"column":26}},"loc":{"start":{"line":33,"column":36},"end":{"line":35,"column":5}},"line":33},"9":{"name":"(anonymous_9)","decl":{"start":{"line":36,"column":25},"end":{"line":36,"column":26}},"loc":{"start":{"line":36,"column":36},"end":{"line":38,"column":5}},"line":36},"10":{"name":"_interop_require_default","decl":{"start":{"line":48,"column":9},"end":{"line":48,"column":33}},"loc":{"start":{"line":48,"column":39},"end":{"line":52,"column":1}},"line":48},"11":{"name":"(anonymous_11)","decl":{"start":{"line":57,"column":24},"end":{"line":57,"column":25}},"loc":{"start":{"line":57,"column":48},"end":{"line":78,"column":1}},"line":57},"12":{"name":"(anonymous_12)","decl":{"start":{"line":79,"column":33},"end":{"line":79,"column":34}},"loc":{"start":{"line":79,"column":40},"end":{"line":85,"column":1}},"line":79},"13":{"name":"(anonymous_13)","decl":{"start":{"line":86,"column":40},"end":{"line":86,"column":41}},"loc":{"start":{"line":86,"column":72},"end":{"line":103,"column":1}},"line":86},"14":{"name":"(anonymous_14)","decl":{"start":{"line":104,"column":28},"end":{"line":104,"column":29}},"loc":{"start":{"line":104,"column":49},"end":{"line":109,"column":1}},"line":104},"15":{"name":"isUserAuthenticated","decl":{"start":{"line":110,"column":15},"end":{"line":110,"column":34}},"loc":{"start":{"line":110,"column":55},"end":{"line":125,"column":1}},"line":110},"16":{"name":"(anonymous_16)","decl":{"start":{"line":126,"column":60},"end":{"line":126,"column":61}},"loc":{"start":{"line":126,"column":64},"end":{"line":128,"column":1}},"line":126},"17":{"name":"userCanAccessAvatar","decl":{"start":{"line":129,"column":15},"end":{"line":129,"column":34}},"loc":{"start":{"line":129,"column":65},"end":{"line":141,"column":1}},"line":129},"18":{"name":"(anonymous_18)","decl":{"start":{"line":142,"column":23},"end":{"line":142,"column":24}},"loc":{"start":{"line":142,"column":31},"end":{"line":142,"column":91}},"line":142},"19":{"name":"(anonymous_19)","decl":{"start":{"line":143,"column":25},"end":{"line":143,"column":26}},"loc":{"start":{"line":143,"column":53},"end":{"line":155,"column":1}},"line":143},"20":{"name":"(anonymous_20)","decl":{"start":{"line":156,"column":21},"end":{"line":156,"column":22}},"loc":{"start":{"line":156,"column":34},"end":{"line":156,"column":96}},"line":156},"21":{"name":"setCacheAndDispositionHeaders","decl":{"start":{"line":157,"column":9},"end":{"line":157,"column":38}},"loc":{"start":{"line":157,"column":49},"end":{"line":161,"column":1}},"line":157}},"branchMap":{"0":{"loc":{"start":{"line":49,"column":11},"end":{"line":51,"column":5}},"type":"cond-expr","locations":[{"start":{"line":49,"column":35},"end":{"line":49,"column":38}},{"start":{"line":49,"column":41},"end":{"line":51,"column":5}}],"line":49},"1":{"loc":{"start":{"line":49,"column":11},"end":{"line":49,"column":32}},"type":"binary-expr","locations":[{"start":{"line":49,"column":11},"end":{"line":49,"column":14}},{"start":{"line":49,"column":18},"end":{"line":49,"column":32}}],"line":49},"2":{"loc":{"start":{"line":61,"column":4},"end":{"line":66,"column":5}},"type":"if","locations":[{"start":{"line":61,"column":4},"end":{"line":66,"column":5}},{"start":{"line":61,"column":4},"end":{"line":66,"column":5}}],"line":61},"3":{"loc":{"start":{"line":61,"column":8},"end":{"line":61,"column":171}},"type":"binary-expr","locations":[{"start":{"line":61,"column":8},"end":{"line":61,"column":25}},{"start":{"line":61,"column":29},"end":{"line":61,"column":171}}],"line":61},"4":{"loc":{"start":{"line":61,"column":52},"end":{"line":61,"column":170}},"type":"cond-expr","locations":[{"start":{"line":61,"column":131},"end":{"line":61,"column":137}},{"start":{"line":61,"column":140},"end":{"line":61,"column":170}}],"line":61},"5":{"loc":{"start":{"line":61,"column":52},"end":{"line":61,"column":128}},"type":"binary-expr","locations":[{"start":{"line":61,"column":52},"end":{"line":61,"column":97}},{"start":{"line":61,"column":101},"end":{"line":61,"column":128}}],"line":61},"6":{"loc":{"start":{"line":67,"column":4},"end":{"line":70,"column":5}},"type":"if","locations":[{"start":{"line":67,"column":4},"end":{"line":70,"column":5}},{"start":{"line":67,"column":4},"end":{"line":70,"column":5}}],"line":67},"7":{"loc":{"start":{"line":69,"column":39},"end":{"line":69,"column":160}},"type":"cond-expr","locations":[{"start":{"line":69,"column":120},"end":{"line":69,"column":126}},{"start":{"line":69,"column":129},"end":{"line":69,"column":160}}],"line":69},"8":{"loc":{"start":{"line":69,"column":39},"end":{"line":69,"column":117}},"type":"binary-expr","locations":[{"start":{"line":69,"column":39},"end":{"line":69,"column":85}},{"start":{"line":69,"column":89},"end":{"line":69,"column":117}}],"line":69},"9":{"loc":{"start":{"line":71,"column":4},"end":{"line":73,"column":5}},"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":73,"column":5}},{"start":{"line":71,"column":4},"end":{"line":73,"column":5}}],"line":71},"10":{"loc":{"start":{"line":74,"column":4},"end":{"line":76,"column":5}},"type":"if","locations":[{"start":{"line":74,"column":4},"end":{"line":76,"column":5}},{"start":{"line":74,"column":4},"end":{"line":76,"column":5}}],"line":74},"11":{"loc":{"start":{"line":80,"column":24},"end":{"line":80,"column":66}},"type":"binary-expr","locations":[{"start":{"line":80,"column":24},"end":{"line":80,"column":38}},{"start":{"line":80,"column":42},"end":{"line":80,"column":66}}],"line":80},"12":{"loc":{"start":{"line":81,"column":4},"end":{"line":83,"column":5}},"type":"if","locations":[{"start":{"line":81,"column":4},"end":{"line":83,"column":5}},{"start":{"line":81,"column":4},"end":{"line":83,"column":5}}],"line":81},"13":{"loc":{"start":{"line":91,"column":4},"end":{"line":99,"column":5}},"type":"if","locations":[{"start":{"line":91,"column":4},"end":{"line":99,"column":5}},{"start":{"line":91,"column":4},"end":{"line":99,"column":5}}],"line":91},"14":{"loc":{"start":{"line":105,"column":4},"end":{"line":107,"column":5}},"type":"if","locations":[{"start":{"line":105,"column":4},"end":{"line":107,"column":5}},{"start":{"line":105,"column":4},"end":{"line":107,"column":5}}],"line":105},"15":{"loc":{"start":{"line":105,"column":8},"end":{"line":105,"column":74}},"type":"binary-expr","locations":[{"start":{"line":105,"column":8},"end":{"line":105,"column":26}},{"start":{"line":105,"column":30},"end":{"line":105,"column":74}}],"line":105},"16":{"loc":{"start":{"line":112,"column":4},"end":{"line":115,"column":5}},"type":"if","locations":[{"start":{"line":112,"column":4},"end":{"line":115,"column":5}},{"start":{"line":112,"column":4},"end":{"line":115,"column":5}}],"line":112},"17":{"loc":{"start":{"line":112,"column":8},"end":{"line":112,"column":33}},"type":"binary-expr","locations":[{"start":{"line":112,"column":8},"end":{"line":112,"column":15}},{"start":{"line":112,"column":19},"end":{"line":112,"column":33}}],"line":112},"18":{"loc":{"start":{"line":116,"column":4},"end":{"line":118,"column":5}},"type":"if","locations":[{"start":{"line":116,"column":4},"end":{"line":118,"column":5}},{"start":{"line":116,"column":4},"end":{"line":118,"column":5}}],"line":116},"19":{"loc":{"start":{"line":116,"column":8},"end":{"line":116,"column":42}},"type":"binary-expr","locations":[{"start":{"line":116,"column":8},"end":{"line":116,"column":22}},{"start":{"line":116,"column":26},"end":{"line":116,"column":42}}],"line":116},"20":{"loc":{"start":{"line":129,"column":37},"end":{"line":129,"column":49}},"type":"default-arg","locations":[{"start":{"line":129,"column":47},"end":{"line":129,"column":49}}],"line":129},"21":{"loc":{"start":{"line":129,"column":51},"end":{"line":129,"column":61}},"type":"default-arg","locations":[{"start":{"line":129,"column":59},"end":{"line":129,"column":61}}],"line":129},"22":{"loc":{"start":{"line":130,"column":4},"end":{"line":132,"column":5}},"type":"if","locations":[{"start":{"line":130,"column":4},"end":{"line":132,"column":5}},{"start":{"line":130,"column":4},"end":{"line":132,"column":5}}],"line":130},"23":{"loc":{"start":{"line":137,"column":4},"end":{"line":139,"column":5}},"type":"if","locations":[{"start":{"line":137,"column":4},"end":{"line":139,"column":5}},{"start":{"line":137,"column":4},"end":{"line":139,"column":5}}],"line":137},"24":{"loc":{"start":{"line":143,"column":36},"end":{"line":143,"column":50}},"type":"default-arg","locations":[{"start":{"line":143,"column":47},"end":{"line":143,"column":50}}],"line":143},"25":{"loc":{"start":{"line":146,"column":4},"end":{"line":152,"column":5}},"type":"if","locations":[{"start":{"line":146,"column":4},"end":{"line":152,"column":5}},{"start":{"line":146,"column":4},"end":{"line":152,"column":5}}],"line":146},"26":{"loc":{"start":{"line":156,"column":34},"end":{"line":156,"column":96}},"type":"binary-expr","locations":[{"start":{"line":156,"column":34},"end":{"line":156,"column":43}},{"start":{"line":156,"column":47},"end":{"line":156,"column":96}}],"line":156}},"s":{"0":1,"1":1,"2":9,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":2,"28":2,"29":2,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":9,"43":9,"44":2,"45":7,"46":1,"47":5,"48":5,"49":5,"50":5,"51":5,"52":3,"53":3,"54":3,"55":2,"56":2,"57":2,"58":1,"59":2,"60":1,"61":1,"62":5,"63":5,"64":2,"65":2,"66":5,"67":1,"68":4,"69":4,"70":1,"71":1,"72":6,"73":1,"74":5,"75":5,"76":3,"77":5,"78":1,"79":11,"80":1,"81":12,"82":12,"83":12,"84":1,"85":1,"86":11,"87":11,"88":12,"89":12,"90":1,"91":2,"92":2,"93":2,"94":2},"f":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":2,"12":9,"13":5,"14":2,"15":5,"16":1,"17":6,"18":11,"19":12,"20":2,"21":2},"b":{"0":[0,1],"1":[1,1],"2":[1,1],"3":[2,2],"4":[0,2],"5":[2,2],"6":[1,0],"7":[0,1],"8":[1,1],"9":[1,0],"10":[1,0],"11":[9,7],"12":[2,7],"13":[3,2],"14":[1,1],"15":[2,1],"16":[2,3],"17":[5,3],"18":[1,4],"19":[5,4],"20":[4],"21":[4],"22":[1,5],"23":[3,2],"24":[1],"25":[1,11],"26":[2,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/utils.ts"],"sourcesContent":["import type { ServerResponse } from 'http';\n\nimport { hashLoginToken } from '@rocket.chat/account-utils';\nimport type { IIncomingMessage, IUpload } from '@rocket.chat/core-typings';\nimport { Users } from '@rocket.chat/models';\nimport type { NextFunction } from 'connect';\nimport { Cookies } from 'meteor/ostrio:cookies';\nimport sharp from 'sharp';\nimport { throttle } from 'underscore';\n\nimport { FileUpload } from '../../../app/file-upload/server';\nimport { settings } from '../../../app/settings/server';\nimport { getAvatarColor } from '../../../app/utils/lib/getAvatarColor';\n\nconst FALLBACK_LAST_MODIFIED = 'Thu, 01 Jan 2015 00:00:00 GMT';\n\nconst cookie = new Cookies();\n\nexport const MAX_SVG_AVATAR_SIZE = 1024;\nexport const MIN_SVG_AVATAR_SIZE = 16;\n\nexport const serveAvatarFile = (file: IUpload, req: IIncomingMessage, res: ServerResponse, next: NextFunction) => {\n\tres.setHeader('Content-Security-Policy', \"default-src 'none'\");\n\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\n\tif (reqModifiedHeader && reqModifiedHeader === file.uploadedAt?.toUTCString()) {\n\t\tres.setHeader('Last-Modified', reqModifiedHeader);\n\t\tres.writeHead(304);\n\t\tres.end();\n\t\treturn;\n\t}\n\n\tif (file.uploadedAt) {\n\t\tres.setHeader('Last-Modified', file.uploadedAt?.toUTCString());\n\t}\n\n\tif (file.type) {\n\t\tres.setHeader('Content-Type', file.type);\n\t}\n\n\tif (file.size) {\n\t\tres.setHeader('Content-Length', file.size);\n\t}\n\n\treturn FileUpload.get(file, req, res, next);\n};\n\nexport const getAvatarSizeFromRequest = (req: IIncomingMessage) => {\n\tconst requestSize = req.query.size && parseInt(req.query.size);\n\tif (!requestSize) {\n\t\treturn;\n\t}\n\treturn Math.min(Math.max(requestSize, MIN_SVG_AVATAR_SIZE), MAX_SVG_AVATAR_SIZE);\n};\nexport const serveSvgAvatarInRequestedFormat = ({\n\tnameOrUsername,\n\treq,\n\tres,\n}: {\n\tnameOrUsername: string;\n\treq: IIncomingMessage;\n\tres: ServerResponse;\n}) => {\n\tconst size = getAvatarSizeFromRequest(req);\n\tconst avatar = renderSVGLetters(nameOrUsername, size);\n\tres.setHeader('Last-Modified', FALLBACK_LAST_MODIFIED);\n\n\tconst { format } = req.query;\n\n\tif (['png', 'jpg', 'jpeg'].includes(format)) {\n\t\tres.setHeader('Content-Type', `image/${format}`);\n\t\tsharp(Buffer.from(avatar)).toFormat(format).pipe(res);\n\t\treturn;\n\t}\n\tres.setHeader('Content-Type', 'image/svg+xml');\n\n\tres.write(avatar);\n\tres.end();\n};\n\nexport const wasFallbackModified = (reqModifiedHeader?: string) => {\n\tif (!reqModifiedHeader || reqModifiedHeader !== FALLBACK_LAST_MODIFIED) {\n\t\treturn true;\n\t}\n\treturn false;\n};\n\nasync function isUserAuthenticated({ headers, query }: Pick<IIncomingMessage, 'headers' | 'query'>) {\n\tlet { rc_uid, rc_token } = query;\n\n\tif (!rc_uid && headers.cookie) {\n\t\trc_uid = cookie.get('rc_uid', headers.cookie);\n\t\trc_token = cookie.get('rc_token', headers.cookie);\n\t}\n\n\tif (rc_uid == null || rc_token == null) {\n\t\treturn false;\n\t}\n\n\tconst userFound = await Users.findOneByIdAndLoginToken(rc_uid, hashLoginToken(rc_token), { projection: { _id: 1 } }); // TODO memoize find\n\n\treturn !!userFound;\n}\n\nconst warnUnauthenticatedAccess = throttle(() => {\n\tconsole.warn('The server detected an unauthenticated access to an user avatar. This type of request will soon be blocked by default.');\n}, 60000 * 30); // 30 minutes\n\nexport async function userCanAccessAvatar({ headers = {}, query = {} }: IIncomingMessage) {\n\tif (!settings.get('Accounts_AvatarBlockUnauthenticatedAccess')) {\n\t\treturn true;\n\t}\n\n\tconst isAuthenticated = await isUserAuthenticated({ headers, query });\n\tif (!isAuthenticated) {\n\t\twarnUnauthenticatedAccess();\n\t}\n\n\treturn isAuthenticated;\n}\n\nconst getFirstLetter = (name: string) =>\n\tname\n\t\t.replace(/[^A-Za-z0-9]/g, '')\n\t\t.substr(0, 1)\n\t\t.toUpperCase();\n\nexport const renderSVGLetters = (username: string, viewSize = 200) => {\n\tlet color = '';\n\tlet initials = '';\n\n\tif (username === '?') {\n\t\tcolor = '#000';\n\t\tinitials = username;\n\t} else {\n\t\tcolor = getAvatarColor(username);\n\t\tinitials = getFirstLetter(username);\n\t}\n\n\tconst fontSize = viewSize / 1.6;\n\n\treturn `<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 ${viewSize} ${viewSize}\\\">\\n<rect width=\\\"100%\\\" height=\\\"100%\\\" fill=\\\"${color}\\\"/>\\n<text x=\\\"50%\\\" y=\\\"50%\\\" dy=\\\"0.36em\\\" text-anchor=\\\"middle\\\" pointer-events=\\\"none\\\" fill=\\\"#ffffff\\\" font-family=\\\"'Helvetica', 'Arial', 'Lucida Grande', 'sans-serif'\\\" font-size=\"${fontSize}\">\\n${initials}\\n</text>\\n</svg>`;\n};\n\nconst getCacheTime = (cacheTime: number) => cacheTime || settings.get('Accounts_AvatarCacheTime');\n\nexport function setCacheAndDispositionHeaders(req: IIncomingMessage, res: ServerResponse) {\n\tconst cacheTime = getCacheTime(req.query.cacheTime);\n\tres.setHeader('Cache-Control', `public, max-age=${cacheTime}`);\n\tres.setHeader('Content-Disposition', 'inline');\n}\n"],"names":["MAX_SVG_AVATAR_SIZE","MIN_SVG_AVATAR_SIZE","getAvatarSizeFromRequest","renderSVGLetters","serveAvatarFile","serveSvgAvatarInRequestedFormat","setCacheAndDispositionHeaders","userCanAccessAvatar","wasFallbackModified","FALLBACK_LAST_MODIFIED","cookie","Cookies","file","req","res","next","setHeader","reqModifiedHeader","headers","uploadedAt","toUTCString","writeHead","end","type","size","FileUpload","get","requestSize","query","parseInt","Math","min","max","nameOrUsername","avatar","format","includes","sharp","Buffer","from","toFormat","pipe","write","isUserAuthenticated","rc_uid","rc_token","userFound","Users","findOneByIdAndLoginToken","hashLoginToken","projection","_id","warnUnauthenticatedAccess","throttle","console","warn","settings","isAuthenticated","getFirstLetter","name","replace","substr","toUpperCase","username","viewSize","color","initials","getAvatarColor","fontSize","getCacheTime","cacheTime"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/routes/avatar/utils.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8d0f9108431b2df21bd8d91e203b22e3e97d7bdf","contentHash":"f4b3af66894946c22aac9990d27769c68d0b20517b53bf64fff1986192de45ff"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/getAvatarColor.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/getAvatarColor.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":30}},"3":{"start":{"line":11,"column":15},"end":{"line":18,"column":1}},"4":{"start":{"line":19,"column":23},"end":{"line":19,"column":66}},"5":{"start":{"line":19,"column":31},"end":{"line":19,"column":66}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":19,"column":23},"end":{"line":19,"column":24}},"loc":{"start":{"line":19,"column":31},"end":{"line":19,"column":66}},"line":19}},"branchMap":{},"s":{"0":1,"1":1,"2":11,"3":1,"4":1,"5":11},"f":{"0":11,"1":11},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/getAvatarColor.ts"],"sourcesContent":["const colors = ['#158D65', '#7F1B9F', '#B68D00', '#E26D0E', '#10529E', '#6C727A'];\n\nexport const getAvatarColor = (name: string): string => colors[name.length % colors.length];\n"],"names":["getAvatarColor","colors","name","length"],"mappings":";;;;+BAEaA;;;eAAAA;;;AAFb,MAAMC,SAAS;IAAC;IAAW;IAAW;IAAW;IAAW;IAAW;CAAU;AAE1E,MAAMD,iBAAiB,CAACE,OAAyBD,MAAM,CAACC,KAAKC,MAAM,GAAGF,OAAOE,MAAM,CAAC","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/utils/lib/getAvatarColor.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2897b6de2baa2e54460f3962a72d1cf9adf05034","contentHash":"216fa473de8ac56abe0c8b2beccacaa157ffb0e08425ea3af8da307aec1f2e9e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isRelativeURL.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isRelativeURL.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":29}},"3":{"start":{"line":11,"column":22},"end":{"line":11,"column":73}},"4":{"start":{"line":11,"column":29},"end":{"line":11,"column":73}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":22},"end":{"line":11,"column":23}},"loc":{"start":{"line":11,"column":29},"end":{"line":11,"column":73}},"line":11}},"branchMap":{},"s":{"0":1,"1":1,"2":7,"3":1,"4":7},"f":{"0":7,"1":7},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isRelativeURL.ts"],"sourcesContent":["export const isRelativeURL = (str: string): boolean => /^[^\\/]+\\/[^\\/].*$|^\\/[^\\/].*$/gim.test(str);\n"],"names":["isRelativeURL","str","test"],"mappings":";;;;+BAAaA;;;eAAAA;;;AAAN,MAAMA,gBAAgB,CAACC,MAAyB,mCAAmCC,IAAI,CAACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isRelativeURL.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2aa9410fc3d5f8176482f9675da0935244f5a697","contentHash":"948bb314b9f9d08c36d58b3ee8a8cc97391d5705c52a49e137881bfea52da1bb"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/secondsToHHMMSS.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/secondsToHHMMSS.ts","statementMap":{"0":{"start":{"line":4,"column":0},"end":{"line":6,"column":3}},"1":{"start":{"line":7,"column":0},"end":{"line":12,"column":3}},"2":{"start":{"line":10,"column":8},"end":{"line":10,"column":31}},"3":{"start":{"line":13,"column":24},"end":{"line":21,"column":1}},"4":{"start":{"line":14,"column":4},"end":{"line":16,"column":5}},"5":{"start":{"line":15,"column":8},"end":{"line":15,"column":30}},"6":{"start":{"line":17,"column":18},"end":{"line":17,"column":40}},"7":{"start":{"line":18,"column":20},"end":{"line":18,"column":57}},"8":{"start":{"line":19,"column":20},"end":{"line":19,"column":65}},"9":{"start":{"line":20,"column":4},"end":{"line":20,"column":128}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":10}},"loc":{"start":{"line":9,"column":20},"end":{"line":11,"column":5}},"line":9},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":24},"end":{"line":13,"column":25}},"loc":{"start":{"line":13,"column":31},"end":{"line":21,"column":1}},"line":13}},"branchMap":{"0":{"loc":{"start":{"line":14,"column":4},"end":{"line":16,"column":5}},"type":"if","locations":[{"start":{"line":14,"column":4},"end":{"line":16,"column":5}},{"start":{"line":14,"column":4},"end":{"line":16,"column":5}}],"line":14}},"s":{"0":1,"1":1,"2":63,"3":1,"4":63,"5":50,"6":63,"7":63,"8":63,"9":63},"f":{"0":63,"1":63},"b":{"0":[50,13]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/secondsToHHMMSS.ts"],"sourcesContent":["/**\n * @todo check alternatives for date/time formatting\n */\nexport const secondsToHHMMSS = (sec: number | string): string => {\n\tif (typeof sec !== 'number') {\n\t\tsec = parseFloat(sec);\n\t}\n\n\tconst hours = Math.floor(sec / 3600);\n\tconst minutes = Math.floor((sec - hours * 3600) / 60);\n\tconst seconds = Math.round(sec - hours * 3600 - minutes * 60);\n\n\treturn `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n};\n"],"names":["secondsToHHMMSS","sec","parseFloat","hours","Math","floor","minutes","seconds","round","toString","padStart"],"mappings":"AAAA;;CAEC;;;;+BACYA;;;eAAAA;;;AAAN,MAAMA,kBAAkB,CAACC;IAC/B,IAAI,OAAOA,QAAQ,UAAU;QAC5BA,MAAMC,WAAWD;IAClB;IAEA,MAAME,QAAQC,KAAKC,KAAK,CAACJ,MAAM;IAC/B,MAAMK,UAAUF,KAAKC,KAAK,CAAC,AAACJ,CAAAA,MAAME,QAAQ,IAAG,IAAK;IAClD,MAAMI,UAAUH,KAAKI,KAAK,CAACP,MAAME,QAAQ,OAAOG,UAAU;IAE1D,OAAO,GAAGH,MAAMM,QAAQ,GAAGC,QAAQ,CAAC,GAAG,KAAK,CAAC,EAAEJ,QAAQG,QAAQ,GAAGC,QAAQ,CAAC,GAAG,KAAK,CAAC,EAAEH,QAAQE,QAAQ,GAAGC,QAAQ,CAAC,GAAG,MAAM;AAC5H","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/secondsToHHMMSS.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e3a54e8ba28ac3650dbb95e5c0fcb1fd5229bd89","contentHash":"d26e76354d51f9324f5aed997ad276969b48581a8e1b8f6fc4ace806b2c57d60"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/fileUtils.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/fileUtils.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":24}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":24}},"6":{"start":{"line":19,"column":28},"end":{"line":19,"column":69}},"7":{"start":{"line":20,"column":34},"end":{"line":20,"column":81}},"8":{"start":{"line":22,"column":4},"end":{"line":24,"column":6}},"9":{"start":{"line":27,"column":4},"end":{"line":29,"column":7}},"10":{"start":{"line":32,"column":4},"end":{"line":32,"column":52}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":14},"end":{"line":12,"column":15}},"loc":{"start":{"line":12,"column":25},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":14},"end":{"line":15,"column":15}},"loc":{"start":{"line":15,"column":25},"end":{"line":17,"column":5}},"line":15},"3":{"name":"_interop_require_default","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":33}},"loc":{"start":{"line":21,"column":39},"end":{"line":25,"column":1}},"line":21},"4":{"name":"fileName","decl":{"start":{"line":26,"column":9},"end":{"line":26,"column":17}},"loc":{"start":{"line":26,"column":24},"end":{"line":30,"column":1}},"line":26},"5":{"name":"joinPath","decl":{"start":{"line":31,"column":9},"end":{"line":31,"column":17}},"loc":{"start":{"line":31,"column":30},"end":{"line":33,"column":1}},"line":31}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":11},"end":{"line":24,"column":5}},"type":"cond-expr","locations":[{"start":{"line":22,"column":35},"end":{"line":22,"column":38}},{"start":{"line":22,"column":41},"end":{"line":24,"column":5}}],"line":22},"1":{"loc":{"start":{"line":22,"column":11},"end":{"line":22,"column":32}},"type":"binary-expr","locations":[{"start":{"line":22,"column":11},"end":{"line":22,"column":14}},{"start":{"line":22,"column":18},"end":{"line":22,"column":32}}],"line":22}},"s":{"0":1,"1":1,"2":2,"3":1,"4":11,"5":6,"6":1,"7":1,"8":2,"9":17,"10":6},"f":{"0":1,"1":11,"2":6,"3":2,"4":17,"5":6},"b":{"0":[0,2],"1":[2,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/fileUtils.ts"],"sourcesContent":["import path from 'path';\n\nimport filenamify from 'filenamify';\n\nexport function fileName(name: string): string {\n\treturn filenamify(name, { replacement: '-' });\n}\n\nexport function joinPath(base: string, name: string): string {\n\treturn path.join(base, fileName(name));\n}\n"],"names":["fileName","joinPath","name","filenamify","replacement","base","path","join"],"mappings":";;;;;;;;;;;IAIgBA,QAAQ;eAARA;;IAIAC,QAAQ;eAARA;;;6DARC;mEAEM;;;;;;AAEhB,SAASD,SAASE,IAAY;IACpC,OAAOC,IAAAA,mBAAU,EAACD,MAAM;QAAEE,aAAa;IAAI;AAC5C;AAEO,SAASH,SAASI,IAAY,EAAEH,IAAY;IAClD,OAAOI,aAAI,CAACC,IAAI,CAACF,MAAML,SAASE;AACjC","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/fileUtils.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ecd8cfba93fee6cd5bf4b382a445fc2ffb24b79c","contentHash":"f2a945ac5affd187cbdc44eeadaf93f0b8ab2cd195d25b7a2663a18a80fe6ac5"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/cached.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/cached.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":24}},"3":{"start":{"line":11,"column":24},"end":{"line":11,"column":51}},"4":{"start":{"line":12,"column":17},"end":{"line":12,"column":53}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7}},"branchMap":{},"s":{"0":1,"1":1,"2":0,"3":1,"4":1},"f":{"0":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/cached.ts"],"sourcesContent":["import { CachedSettings } from './CachedSettings';\n\nexport const settings = new CachedSettings();\n"],"names":["settings","CachedSettings"],"mappings":";;;;+BAEaA;;;eAAAA;;;gCAFkB;AAExB,MAAMA,WAAW,IAAIC,8BAAc","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/settings/server/cached.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a6270f0301de9014046b44301593d701ef1b07af","contentHash":"f4fdd75c9554a40189c2ae936c47427becceb66afed066f4415f065544abaa29"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/voip-freeswitch/service.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/voip-freeswitch/service.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":37}},"3":{"start":{"line":11,"column":22},"end":{"line":11,"column":59}},"4":{"start":{"line":12,"column":20},"end":{"line":12,"column":54}},"5":{"start":{"line":13,"column":28},"end":{"line":51,"column":1}},"6":{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},"7":{"start":{"line":16,"column":12},"end":{"line":16,"column":49}},"8":{"start":{"line":18,"column":21},"end":{"line":18,"column":99}},"9":{"start":{"line":19,"column":8},"end":{"line":21,"column":9}},"10":{"start":{"line":20,"column":12},"end":{"line":20,"column":64}},"11":{"start":{"line":22,"column":21},"end":{"line":22,"column":79}},"12":{"start":{"line":23,"column":24},"end":{"line":23,"column":85}},"13":{"start":{"line":24,"column":25},"end":{"line":24,"column":79}},"14":{"start":{"line":25,"column":8},"end":{"line":30,"column":10}},"15":{"start":{"line":33,"column":24},"end":{"line":33,"column":52}},"16":{"start":{"line":34,"column":8},"end":{"line":34,"column":51}},"17":{"start":{"line":37,"column":24},"end":{"line":37,"column":52}},"18":{"start":{"line":38,"column":8},"end":{"line":38,"column":63}},"19":{"start":{"line":41,"column":24},"end":{"line":41,"column":52}},"20":{"start":{"line":42,"column":8},"end":{"line":42,"column":58}},"21":{"start":{"line":45,"column":24},"end":{"line":45,"column":52}},"22":{"start":{"line":46,"column":8},"end":{"line":46,"column":76}},"23":{"start":{"line":49,"column":8},"end":{"line":49,"column":77}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":28},"end":{"line":31,"column":5}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":32,"column":4},"end":{"line":32,"column":5}},"loc":{"start":{"line":32,"column":22},"end":{"line":35,"column":5}},"line":32},"3":{"name":"(anonymous_3)","decl":{"start":{"line":36,"column":4},"end":{"line":36,"column":5}},"loc":{"start":{"line":36,"column":32},"end":{"line":39,"column":5}},"line":36},"4":{"name":"(anonymous_4)","decl":{"start":{"line":40,"column":4},"end":{"line":40,"column":5}},"loc":{"start":{"line":40,"column":29},"end":{"line":43,"column":5}},"line":40},"5":{"name":"(anonymous_5)","decl":{"start":{"line":44,"column":4},"end":{"line":44,"column":5}},"loc":{"start":{"line":44,"column":45},"end":{"line":47,"column":5}},"line":44},"6":{"name":"(anonymous_6)","decl":{"start":{"line":48,"column":4},"end":{"line":48,"column":5}},"loc":{"start":{"line":48,"column":27},"end":{"line":50,"column":5}},"line":48}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},"type":"if","locations":[{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},{"start":{"line":15,"column":8},"end":{"line":17,"column":9}}],"line":15},"1":{"loc":{"start":{"line":15,"column":12},"end":{"line":15,"column":84}},"type":"binary-expr","locations":[{"start":{"line":15,"column":12},"end":{"line":15,"column":55}},{"start":{"line":15,"column":59},"end":{"line":15,"column":84}}],"line":15},"2":{"loc":{"start":{"line":18,"column":21},"end":{"line":18,"column":99}},"type":"binary-expr","locations":[{"start":{"line":18,"column":21},"end":{"line":18,"column":45}},{"start":{"line":18,"column":49},"end":{"line":18,"column":99}}],"line":18},"3":{"loc":{"start":{"line":19,"column":8},"end":{"line":21,"column":9}},"type":"if","locations":[{"start":{"line":19,"column":8},"end":{"line":21,"column":9}},{"start":{"line":19,"column":8},"end":{"line":21,"column":9}}],"line":19},"4":{"loc":{"start":{"line":22,"column":21},"end":{"line":22,"column":79}},"type":"binary-expr","locations":[{"start":{"line":22,"column":21},"end":{"line":22,"column":71}},{"start":{"line":22,"column":75},"end":{"line":22,"column":79}}],"line":22},"5":{"loc":{"start":{"line":23,"column":24},"end":{"line":23,"column":85}},"type":"binary-expr","locations":[{"start":{"line":23,"column":24},"end":{"line":23,"column":77}},{"start":{"line":23,"column":81},"end":{"line":23,"column":85}}],"line":23}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":1},"f":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":1},"b":{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/voip-freeswitch/service.ts"],"sourcesContent":["import { type IVoipFreeSwitchService, ServiceClassInternal } from '@rocket.chat/core-services';\nimport type { FreeSwitchExtension, ISetting, SettingValue } from '@rocket.chat/core-typings';\nimport { getDomain, getUserPassword, getExtensionList, getExtensionDetails } from '@rocket.chat/freeswitch';\n\nexport class VoipFreeSwitchService extends ServiceClassInternal implements IVoipFreeSwitchService {\n\tprotected name = 'voip-freeswitch';\n\n\tconstructor(private getSetting: <T extends SettingValue = SettingValue>(id: ISetting['_id']) => T) {\n\t\tsuper();\n\t}\n\n\tprivate getConnectionSettings(): { host: string; port: number; password: string; timeout: number } {\n\t\tif (!this.getSetting('VoIP_TeamCollab_Enabled') && !process.env.FREESWITCHIP) {\n\t\t\tthrow new Error('VoIP is disabled.');\n\t\t}\n\n\t\tconst host = process.env.FREESWITCHIP || this.getSetting<string>('VoIP_TeamCollab_FreeSwitch_Host');\n\t\tif (!host) {\n\t\t\tthrow new Error('VoIP is not properly configured.');\n\t\t}\n\n\t\tconst port = this.getSetting<number>('VoIP_TeamCollab_FreeSwitch_Port') || 8021;\n\t\tconst timeout = this.getSetting<number>('VoIP_TeamCollab_FreeSwitch_Timeout') || 3000;\n\t\tconst password = this.getSetting<string>('VoIP_TeamCollab_FreeSwitch_Password');\n\n\t\treturn {\n\t\t\thost,\n\t\t\tport,\n\t\t\tpassword,\n\t\t\ttimeout,\n\t\t};\n\t}\n\n\tasync getDomain(): Promise<string> {\n\t\tconst options = this.getConnectionSettings();\n\t\treturn getDomain(options);\n\t}\n\n\tasync getUserPassword(user: string): Promise<string> {\n\t\tconst options = this.getConnectionSettings();\n\t\treturn getUserPassword(options, user);\n\t}\n\n\tasync getExtensionList(): Promise<FreeSwitchExtension[]> {\n\t\tconst options = this.getConnectionSettings();\n\t\treturn getExtensionList(options);\n\t}\n\n\tasync getExtensionDetails(requestParams: { extension: string; group?: string }): Promise<FreeSwitchExtension> {\n\t\tconst options = this.getConnectionSettings();\n\t\treturn getExtensionDetails(options, requestParams);\n\t}\n}\n"],"names":["VoipFreeSwitchService","ServiceClassInternal","getConnectionSettings","getSetting","process","env","FREESWITCHIP","Error","host","port","timeout","password","getDomain","options","getUserPassword","user","getExtensionList","getExtensionDetails","requestParams","constructor","name"],"mappings":";;;;+BAIaA;;;eAAAA;;;8BAJqD;4BAEgB;AAE3E,IAAA,AAAMA,wBAAN,MAAMA,8BAA8BC,kCAAoB;IAOtDC,wBAA2F;QAClG,IAAI,CAAC,IAAI,CAACC,UAAU,CAAC,8BAA8B,CAACC,QAAQC,GAAG,CAACC,YAAY,EAAE;YAC7E,MAAM,IAAIC,MAAM;QACjB;QAEA,MAAMC,OAAOJ,QAAQC,GAAG,CAACC,YAAY,IAAI,IAAI,CAACH,UAAU,CAAS;QACjE,IAAI,CAACK,MAAM;YACV,MAAM,IAAID,MAAM;QACjB;QAEA,MAAME,OAAO,IAAI,CAACN,UAAU,CAAS,sCAAsC;QAC3E,MAAMO,UAAU,IAAI,CAACP,UAAU,CAAS,yCAAyC;QACjF,MAAMQ,WAAW,IAAI,CAACR,UAAU,CAAS;QAEzC,OAAO;YACNK;YACAC;YACAE;YACAD;QACD;IACD;IAEA,MAAME,YAA6B;QAClC,MAAMC,UAAU,IAAI,CAACX,qBAAqB;QAC1C,OAAOU,IAAAA,qBAAS,EAACC;IAClB;IAEA,MAAMC,gBAAgBC,IAAY,EAAmB;QACpD,MAAMF,UAAU,IAAI,CAACX,qBAAqB;QAC1C,OAAOY,IAAAA,2BAAe,EAACD,SAASE;IACjC;IAEA,MAAMC,mBAAmD;QACxD,MAAMH,UAAU,IAAI,CAACX,qBAAqB;QAC1C,OAAOc,IAAAA,4BAAgB,EAACH;IACzB;IAEA,MAAMI,oBAAoBC,aAAoD,EAAgC;QAC7G,MAAML,UAAU,IAAI,CAACX,qBAAqB;QAC1C,OAAOe,IAAAA,+BAAmB,EAACJ,SAASK;IACrC;IA5CAC,YAAY,AAAQhB,UAA6E,CAAE;QAClG,KAAK,SADcA,aAAAA,iBAFViB,OAAO;IAIjB;AA2CD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/voip-freeswitch/service.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c30bbe77b27195118789facad6a2f24e1f0d64f1","contentHash":"4f87164d1e622cccffbdfb59ce21b7ec484eaf6f83bd53cd487e3de68c85da42"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/banner/service.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/banner/service.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":29}},"3":{"start":{"line":11,"column":22},"end":{"line":11,"column":59}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":46}},"5":{"start":{"line":13,"column":14},"end":{"line":13,"column":29}},"6":{"start":{"line":14,"column":20},"end":{"line":173,"column":1}},"7":{"start":{"line":16,"column":8},"end":{"line":16,"column":53}},"8":{"start":{"line":19,"column":23},"end":{"line":19,"column":66}},"9":{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},"10":{"start":{"line":21,"column":12},"end":{"line":21,"column":25}},"11":{"start":{"line":23,"column":35},"end":{"line":23,"column":41}},"12":{"start":{"line":24,"column":25},"end":{"line":28,"column":10}},"13":{"start":{"line":29,"column":8},"end":{"line":35,"column":11}},"14":{"start":{"line":36,"column":8},"end":{"line":36,"column":20}},"15":{"start":{"line":39,"column":25},"end":{"line":39,"column":51}},"16":{"start":{"line":41,"column":8},"end":{"line":41,"column":133}},"17":{"start":{"line":42,"column":8},"end":{"line":42,"column":35}},"18":{"start":{"line":43,"column":8},"end":{"line":46,"column":11}},"19":{"start":{"line":47,"column":23},"end":{"line":47,"column":66}},"20":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"21":{"start":{"line":49,"column":12},"end":{"line":49,"column":53}},"22":{"start":{"line":51,"column":8},"end":{"line":51,"column":38}},"23":{"start":{"line":52,"column":8},"end":{"line":52,"column":22}},"24":{"start":{"line":55,"column":21},"end":{"line":59,"column":10}},"25":{"start":{"line":60,"column":26},"end":{"line":62,"column":9}},"26":{"start":{"line":63,"column":24},"end":{"line":63,"column":103}},"27":{"start":{"line":64,"column":26},"end":{"line":64,"column":53}},"28":{"start":{"line":64,"column":49},"end":{"line":64,"column":52}},"29":{"start":{"line":65,"column":23},"end":{"line":70,"column":20}},"30":{"start":{"line":71,"column":26},"end":{"line":71,"column":71}},"31":{"start":{"line":71,"column":61},"end":{"line":71,"column":69}},"32":{"start":{"line":72,"column":8},"end":{"line":82,"column":16}},"33":{"start":{"line":72,"column":40},"end":{"line":72,"column":66}},"34":{"start":{"line":72,"column":83},"end":{"line":82,"column":13}},"35":{"start":{"line":85,"column":8},"end":{"line":87,"column":9}},"36":{"start":{"line":86,"column":12},"end":{"line":86,"column":46}},"37":{"start":{"line":88,"column":23},"end":{"line":88,"column":66}},"38":{"start":{"line":89,"column":8},"end":{"line":91,"column":9}},"39":{"start":{"line":90,"column":12},"end":{"line":90,"column":48}},"40":{"start":{"line":92,"column":21},"end":{"line":96,"column":10}},"41":{"start":{"line":97,"column":8},"end":{"line":99,"column":9}},"42":{"start":{"line":98,"column":12},"end":{"line":98,"column":46}},"43":{"start":{"line":100,"column":28},"end":{"line":103,"column":9}},"44":{"start":{"line":104,"column":22},"end":{"line":104,"column":32}},"45":{"start":{"line":105,"column":20},"end":{"line":111,"column":9}},"46":{"start":{"line":112,"column":8},"end":{"line":112,"column":52}},"47":{"start":{"line":113,"column":8},"end":{"line":113,"column":20}},"48":{"start":{"line":116,"column":23},"end":{"line":116,"column":62}},"49":{"start":{"line":117,"column":8},"end":{"line":120,"column":9}},"50":{"start":{"line":118,"column":12},"end":{"line":118,"column":74}},"51":{"start":{"line":119,"column":12},"end":{"line":119,"column":24}},"52":{"start":{"line":121,"column":8},"end":{"line":121,"column":21}},"53":{"start":{"line":124,"column":23},"end":{"line":124,"column":66}},"54":{"start":{"line":125,"column":8},"end":{"line":127,"column":9}},"55":{"start":{"line":126,"column":12},"end":{"line":126,"column":25}},"56":{"start":{"line":128,"column":35},"end":{"line":128,"column":41}},"57":{"start":{"line":129,"column":26},"end":{"line":133,"column":9}},"58":{"start":{"line":134,"column":8},"end":{"line":138,"column":11}},"59":{"start":{"line":139,"column":8},"end":{"line":142,"column":11}},"60":{"start":{"line":143,"column":8},"end":{"line":143,"column":20}},"61":{"start":{"line":147,"column":8},"end":{"line":149,"column":9}},"62":{"start":{"line":148,"column":12},"end":{"line":148,"column":25}},"63":{"start":{"line":151,"column":8},"end":{"line":154,"column":9}},"64":{"start":{"line":152,"column":12},"end":{"line":152,"column":75}},"65":{"start":{"line":153,"column":12},"end":{"line":153,"column":24}},"66":{"start":{"line":155,"column":22},"end":{"line":155,"column":79}},"67":{"start":{"line":157,"column":8},"end":{"line":160,"column":9}},"68":{"start":{"line":158,"column":12},"end":{"line":158,"column":75}},"69":{"start":{"line":159,"column":12},"end":{"line":159,"column":24}},"70":{"start":{"line":161,"column":8},"end":{"line":167,"column":11}},"71":{"start":{"line":166,"column":12},"end":{"line":166,"column":78}},"72":{"start":{"line":168,"column":8},"end":{"line":168,"column":20}},"73":{"start":{"line":171,"column":8},"end":{"line":171,"column":45}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":28},"end":{"line":17,"column":5}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":18,"column":4},"end":{"line":18,"column":5}},"loc":{"start":{"line":18,"column":37},"end":{"line":37,"column":5}},"line":18},"3":{"name":"(anonymous_3)","decl":{"start":{"line":38,"column":4},"end":{"line":38,"column":5}},"loc":{"start":{"line":38,"column":22},"end":{"line":53,"column":5}},"line":38},"4":{"name":"(anonymous_4)","decl":{"start":{"line":54,"column":4},"end":{"line":54,"column":5}},"loc":{"start":{"line":54,"column":56},"end":{"line":83,"column":5}},"line":54},"5":{"name":"(anonymous_5)","decl":{"start":{"line":64,"column":38},"end":{"line":64,"column":39}},"loc":{"start":{"line":64,"column":49},"end":{"line":64,"column":52}},"line":64},"6":{"name":"(anonymous_6)","decl":{"start":{"line":71,"column":45},"end":{"line":71,"column":46}},"loc":{"start":{"line":71,"column":61},"end":{"line":71,"column":69}},"line":71},"7":{"name":"(anonymous_7)","decl":{"start":{"line":72,"column":30},"end":{"line":72,"column":31}},"loc":{"start":{"line":72,"column":40},"end":{"line":72,"column":66}},"line":72},"8":{"name":"(anonymous_8)","decl":{"start":{"line":72,"column":72},"end":{"line":72,"column":73}},"loc":{"start":{"line":72,"column":83},"end":{"line":82,"column":13}},"line":72},"9":{"name":"(anonymous_9)","decl":{"start":{"line":84,"column":4},"end":{"line":84,"column":5}},"loc":{"start":{"line":84,"column":36},"end":{"line":114,"column":5}},"line":84},"10":{"name":"(anonymous_10)","decl":{"start":{"line":115,"column":4},"end":{"line":115,"column":5}},"loc":{"start":{"line":115,"column":28},"end":{"line":122,"column":5}},"line":115},"11":{"name":"(anonymous_11)","decl":{"start":{"line":123,"column":4},"end":{"line":123,"column":5}},"loc":{"start":{"line":123,"column":37},"end":{"line":144,"column":5}},"line":123},"12":{"name":"(anonymous_12)","decl":{"start":{"line":145,"column":4},"end":{"line":145,"column":5}},"loc":{"start":{"line":145,"column":30},"end":{"line":169,"column":5}},"line":145},"13":{"name":"(anonymous_13)","decl":{"start":{"line":165,"column":19},"end":{"line":165,"column":20}},"loc":{"start":{"line":165,"column":27},"end":{"line":167,"column":9}},"line":165},"14":{"name":"(anonymous_14)","decl":{"start":{"line":170,"column":4},"end":{"line":170,"column":5}},"loc":{"start":{"line":170,"column":24},"end":{"line":172,"column":5}},"line":170}},"branchMap":{"0":{"loc":{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},"type":"if","locations":[{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},{"start":{"line":20,"column":8},"end":{"line":22,"column":9}}],"line":20},"1":{"loc":{"start":{"line":39,"column":25},"end":{"line":39,"column":51}},"type":"binary-expr","locations":[{"start":{"line":39,"column":25},"end":{"line":39,"column":32}},{"start":{"line":39,"column":36},"end":{"line":39,"column":51}}],"line":39},"2":{"loc":{"start":{"line":41,"column":25},"end":{"line":41,"column":132}},"type":"cond-expr","locations":[{"start":{"line":41,"column":101},"end":{"line":41,"column":116}},{"start":{"line":41,"column":119},"end":{"line":41,"column":132}}],"line":41},"3":{"loc":{"start":{"line":41,"column":25},"end":{"line":41,"column":98}},"type":"binary-expr","locations":[{"start":{"line":41,"column":25},"end":{"line":41,"column":68}},{"start":{"line":41,"column":72},"end":{"line":41,"column":98}}],"line":41},"4":{"loc":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"type":"if","locations":[{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},{"start":{"line":48,"column":8},"end":{"line":50,"column":9}}],"line":48},"5":{"loc":{"start":{"line":60,"column":26},"end":{"line":62,"column":9}},"type":"binary-expr","locations":[{"start":{"line":60,"column":26},"end":{"line":60,"column":30}},{"start":{"line":60,"column":34},"end":{"line":62,"column":9}}],"line":60},"6":{"loc":{"start":{"line":78,"column":28},"end":{"line":78,"column":60}},"type":"binary-expr","locations":[{"start":{"line":78,"column":28},"end":{"line":78,"column":46}},{"start":{"line":78,"column":50},"end":{"line":78,"column":60}}],"line":78},"7":{"loc":{"start":{"line":81,"column":25},"end":{"line":81,"column":68}},"type":"cond-expr","locations":[{"start":{"line":81,"column":43},"end":{"line":81,"column":51}},{"start":{"line":81,"column":54},"end":{"line":81,"column":68}}],"line":81},"8":{"loc":{"start":{"line":85,"column":8},"end":{"line":87,"column":9}},"type":"if","locations":[{"start":{"line":85,"column":8},"end":{"line":87,"column":9}},{"start":{"line":85,"column":8},"end":{"line":87,"column":9}}],"line":85},"9":{"loc":{"start":{"line":85,"column":12},"end":{"line":85,"column":32}},"type":"binary-expr","locations":[{"start":{"line":85,"column":12},"end":{"line":85,"column":19}},{"start":{"line":85,"column":23},"end":{"line":85,"column":32}}],"line":85},"10":{"loc":{"start":{"line":89,"column":8},"end":{"line":91,"column":9}},"type":"if","locations":[{"start":{"line":89,"column":8},"end":{"line":91,"column":9}},{"start":{"line":89,"column":8},"end":{"line":91,"column":9}}],"line":89},"11":{"loc":{"start":{"line":97,"column":8},"end":{"line":99,"column":9}},"type":"if","locations":[{"start":{"line":97,"column":8},"end":{"line":99,"column":9}},{"start":{"line":97,"column":8},"end":{"line":99,"column":9}}],"line":97},"12":{"loc":{"start":{"line":117,"column":8},"end":{"line":120,"column":9}},"type":"if","locations":[{"start":{"line":117,"column":8},"end":{"line":120,"column":9}},{"start":{"line":117,"column":8},"end":{"line":120,"column":9}}],"line":117},"13":{"loc":{"start":{"line":123,"column":27},"end":{"line":123,"column":35}},"type":"default-arg","locations":[{"start":{"line":123,"column":33},"end":{"line":123,"column":35}}],"line":123},"14":{"loc":{"start":{"line":125,"column":8},"end":{"line":127,"column":9}},"type":"if","locations":[{"start":{"line":125,"column":8},"end":{"line":127,"column":9}},{"start":{"line":125,"column":8},"end":{"line":127,"column":9}}],"line":125},"15":{"loc":{"start":{"line":147,"column":8},"end":{"line":149,"column":9}},"type":"if","locations":[{"start":{"line":147,"column":8},"end":{"line":149,"column":9}},{"start":{"line":147,"column":8},"end":{"line":149,"column":9}}],"line":147},"16":{"loc":{"start":{"line":151,"column":8},"end":{"line":154,"column":9}},"type":"if","locations":[{"start":{"line":151,"column":8},"end":{"line":154,"column":9}},{"start":{"line":151,"column":8},"end":{"line":154,"column":9}}],"line":151},"17":{"loc":{"start":{"line":151,"column":14},"end":{"line":151,"column":113}},"type":"cond-expr","locations":[{"start":{"line":151,"column":84},"end":{"line":151,"column":90}},{"start":{"line":151,"column":93},"end":{"line":151,"column":113}}],"line":151},"18":{"loc":{"start":{"line":151,"column":14},"end":{"line":151,"column":81}},"type":"binary-expr","locations":[{"start":{"line":151,"column":14},"end":{"line":151,"column":53}},{"start":{"line":151,"column":57},"end":{"line":151,"column":81}}],"line":151},"19":{"loc":{"start":{"line":157,"column":8},"end":{"line":160,"column":9}},"type":"if","locations":[{"start":{"line":157,"column":8},"end":{"line":160,"column":9}},{"start":{"line":157,"column":8},"end":{"line":160,"column":9}}],"line":157}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":3,"25":3,"26":3,"27":3,"28":3,"29":3,"30":3,"31":1,"32":3,"33":3,"34":2,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":4},"f":{"0":1,"1":0,"2":0,"3":0,"4":3,"5":3,"6":1,"7":3,"8":2,"9":0,"10":0,"11":0,"12":0,"13":0,"14":4},"b":{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[3,0],"6":[2,1],"7":[1,1],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/banner/service.ts"],"sourcesContent":["import { api, ServiceClassInternal } from '@rocket.chat/core-services';\nimport type { IBannerService } from '@rocket.chat/core-services';\nimport type { BannerPlatform, IBanner, IBannerDismiss, Optional, IUser } from '@rocket.chat/core-typings';\nimport { Banners, BannersDismiss, Users } from '@rocket.chat/models';\nimport { v4 as uuidv4 } from 'uuid';\n\nexport class BannerService extends ServiceClassInternal implements IBannerService {\n\tprotected name = 'banner';\n\n\tasync getById(bannerId: string): Promise<null | IBanner> {\n\t\treturn Banners.findOneById(bannerId);\n\t}\n\n\tasync discardDismissal(bannerId: string): Promise<boolean> {\n\t\tconst result = await Banners.findOneById(bannerId);\n\n\t\tif (!result) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { _id, ...banner } = result;\n\n\t\tconst snapshot = await this.create({ ...banner, snapshot: _id, active: false }); // create a snapshot\n\n\t\tawait BannersDismiss.updateMany({ bannerId }, { $set: { bannerId: snapshot._id } });\n\t\treturn true;\n\t}\n\n\tasync create(doc: Optional<IBanner, '_id' | '_updatedAt'>): Promise<IBanner> {\n\t\tconst bannerId = doc._id || uuidv4();\n\n\t\tdoc.view.appId = doc.view.appId ?? 'banner-core';\n\t\tdoc.view.viewId = bannerId;\n\n\t\tawait Banners.createOrUpdate({\n\t\t\t...doc,\n\t\t\t_id: bannerId,\n\t\t});\n\n\t\tconst banner = await Banners.findOneById(bannerId);\n\t\tif (!banner) {\n\t\t\tthrow new Error('error-creating-banner');\n\t\t}\n\n\t\tvoid this.sendToUsers(banner);\n\n\t\treturn banner;\n\t}\n\n\tasync getBannersForUser(userId: string, platform: BannerPlatform, bannerId?: string): Promise<IBanner[]> {\n\t\tconst user = await Users.findOneById<Pick<IUser, 'roles'>>(userId, {\n\t\t\tprojection: { roles: 1 },\n\t\t});\n\n\t\tconst { roles } = user || { roles: [] };\n\n\t\tconst banners = await Banners.findActiveByRoleOrId(roles, platform, bannerId).toArray();\n\n\t\tconst bannerIds = banners.map(({ _id }) => _id);\n\n\t\tconst result = await BannersDismiss.findByUserIdAndBannerId<Pick<IBannerDismiss, 'bannerId'>>(userId, bannerIds, {\n\t\t\tprojection: { bannerId: 1, _id: 0 },\n\t\t}).toArray();\n\n\t\tconst dismissed = new Set(result.map(({ bannerId }) => bannerId));\n\n\t\treturn banners\n\t\t\t.filter((banner) => !dismissed.has(banner._id))\n\t\t\t.map((banner) => ({\n\t\t\t\t...banner,\n\t\t\t\tview: {\n\t\t\t\t\t...banner.view,\n\t\t\t\t\t// All modern banners should have a viewId, but we have old banners that were created without it\n\t\t\t\t\t// such as the seatsTaken banner. In this case, we use the bannerId as the viewId\n\t\t\t\t\tviewId: banner.view.viewId || banner._id,\n\t\t\t\t},\n\t\t\t\t// add surface to legacy banners\n\t\t\t\tsurface: !banner.surface ? 'banner' : banner.surface,\n\t\t\t}));\n\t}\n\n\tasync dismiss(userId: string, bannerId: string): Promise<boolean> {\n\t\tif (!userId || !bannerId) {\n\t\t\tthrow new Error('Invalid params');\n\t\t}\n\n\t\tconst banner = await Banners.findOneById(bannerId);\n\t\tif (!banner) {\n\t\t\tthrow new Error('Banner not found');\n\t\t}\n\n\t\tconst user = await Users.findOneById<Pick<IUser, 'username' | '_id'>>(userId, {\n\t\t\tprojection: { username: 1 },\n\t\t});\n\t\tif (!user) {\n\t\t\tthrow new Error('User not found');\n\t\t}\n\n\t\tconst dismissedBy = {\n\t\t\t_id: user._id,\n\t\t\tusername: user.username,\n\t\t};\n\n\t\tconst today = new Date();\n\n\t\tconst doc = {\n\t\t\tuserId,\n\t\t\tbannerId,\n\t\t\tdismissedBy,\n\t\t\tdismissedAt: today,\n\t\t\t_updatedAt: today,\n\t\t};\n\n\t\tawait BannersDismiss.insertOne(doc);\n\n\t\treturn true;\n\t}\n\n\tasync disable(bannerId: string): Promise<boolean> {\n\t\tconst result = await Banners.disable(bannerId);\n\n\t\tif (result) {\n\t\t\tvoid api.broadcast('banner.disabled', bannerId);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tasync enable(bannerId: string, doc: Partial<Omit<IBanner, '_id'>> = {}): Promise<boolean> {\n\t\tconst result = await Banners.findOneById(bannerId);\n\n\t\tif (!result) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { _id, ...banner } = result;\n\n\t\tconst newBanner = { ...banner, ...doc, active: true };\n\n\t\tawait Banners.updateOne({ _id }, { $set: newBanner }); // reenable the banner\n\n\t\tvoid this.sendToUsers({ _id, ...newBanner });\n\n\t\treturn true;\n\t}\n\n\tasync sendToUsers(banner: IBanner): Promise<boolean> {\n\t\tif (!banner.active) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// no roles set, so it should be sent to all users\n\t\tif (!banner.roles?.length) {\n\t\t\tvoid api.broadcast('banner.enabled', banner._id);\n\t\t\treturn true;\n\t\t}\n\n\t\tconst total = await Users.countActiveUsersInRoles(banner.roles);\n\n\t\t// if more than 100 users should receive the banner, send it to all users\n\t\tif (total > 100) {\n\t\t\tvoid api.broadcast('banner.enabled', banner._id);\n\t\t\treturn true;\n\t\t}\n\n\t\tawait Users.findActiveUsersInRoles(banner.roles, { projection: { _id: 1 } }).forEach((user) => {\n\t\t\tvoid api.broadcast('banner.user', user._id, banner);\n\t\t});\n\n\t\treturn true;\n\t}\n}\n"],"names":["BannerService","ServiceClassInternal","getById","bannerId","Banners","findOneById","discardDismissal","result","_id","banner","snapshot","create","active","BannersDismiss","updateMany","$set","doc","uuidv4","view","appId","viewId","createOrUpdate","Error","sendToUsers","getBannersForUser","userId","platform","user","Users","projection","roles","banners","findActiveByRoleOrId","toArray","bannerIds","map","findByUserIdAndBannerId","dismissed","Set","filter","has","surface","dismiss","username","dismissedBy","today","Date","dismissedAt","_updatedAt","insertOne","disable","api","broadcast","enable","newBanner","updateOne","length","total","countActiveUsersInRoles","findActiveUsersInRoles","forEach","name"],"mappings":";;;;+BAMaA;;;eAAAA;;;8BAN6B;wBAGK;sBAClB;AAEtB,IAAA,AAAMA,gBAAN,MAAMA,sBAAsBC,kCAAoB;IAGtD,MAAMC,QAAQC,QAAgB,EAA2B;QACxD,OAAOC,eAAO,CAACC,WAAW,CAACF;IAC5B;IAEA,MAAMG,iBAAiBH,QAAgB,EAAoB;QAC1D,MAAMI,SAAS,MAAMH,eAAO,CAACC,WAAW,CAACF;QAEzC,IAAI,CAACI,QAAQ;YACZ,OAAO;QACR;QAEA,MAAM,EAAEC,GAAG,EAAE,GAAGC,QAAQ,GAAGF;QAE3B,MAAMG,WAAW,MAAM,IAAI,CAACC,MAAM,CAAC;YAAE,GAAGF,MAAM;YAAEC,UAAUF;YAAKI,QAAQ;QAAM,IAAI,oBAAoB;QAErG,MAAMC,sBAAc,CAACC,UAAU,CAAC;YAAEX;QAAS,GAAG;YAAEY,MAAM;gBAAEZ,UAAUO,SAASF,GAAG;YAAC;QAAE;QACjF,OAAO;IACR;IAEA,MAAMG,OAAOK,GAA4C,EAAoB;QAC5E,MAAMb,WAAWa,IAAIR,GAAG,IAAIS,IAAAA,QAAM;YAEjBD;QAAjBA,IAAIE,IAAI,CAACC,KAAK,GAAGH,CAAAA,kBAAAA,IAAIE,IAAI,CAACC,KAAK,cAAdH,6BAAAA,kBAAkB;QACnCA,IAAIE,IAAI,CAACE,MAAM,GAAGjB;QAElB,MAAMC,eAAO,CAACiB,cAAc,CAAC;YAC5B,GAAGL,GAAG;YACNR,KAAKL;QACN;QAEA,MAAMM,SAAS,MAAML,eAAO,CAACC,WAAW,CAACF;QACzC,IAAI,CAACM,QAAQ;YACZ,MAAM,IAAIa,MAAM;QACjB;QAEA,KAAK,IAAI,CAACC,WAAW,CAACd;QAEtB,OAAOA;IACR;IAEA,MAAMe,kBAAkBC,MAAc,EAAEC,QAAwB,EAAEvB,QAAiB,EAAsB;QACxG,MAAMwB,OAAO,MAAMC,aAAK,CAACvB,WAAW,CAAuBoB,QAAQ;YAClEI,YAAY;gBAAEC,OAAO;YAAE;QACxB;QAEA,MAAM,EAAEA,KAAK,EAAE,GAAGH,QAAQ;YAAEG,OAAO,EAAE;QAAC;QAEtC,MAAMC,UAAU,MAAM3B,eAAO,CAAC4B,oBAAoB,CAACF,OAAOJ,UAAUvB,UAAU8B,OAAO;QAErF,MAAMC,YAAYH,QAAQI,GAAG,CAAC,CAAC,EAAE3B,GAAG,EAAE,GAAKA;QAE3C,MAAMD,SAAS,MAAMM,sBAAc,CAACuB,uBAAuB,CAAmCX,QAAQS,WAAW;YAChHL,YAAY;gBAAE1B,UAAU;gBAAGK,KAAK;YAAE;QACnC,GAAGyB,OAAO;QAEV,MAAMI,YAAY,IAAIC,IAAI/B,OAAO4B,GAAG,CAAC,CAAC,EAAEhC,QAAQ,EAAE,GAAKA;QAEvD,OAAO4B,QACLQ,MAAM,CAAC,CAAC9B,SAAW,CAAC4B,UAAUG,GAAG,CAAC/B,OAAOD,GAAG,GAC5C2B,GAAG,CAAC,CAAC1B,SAAY,CAAA;gBACjB,GAAGA,MAAM;gBACTS,MAAM;oBACL,GAAGT,OAAOS,IAAI;oBACd,gGAAgG;oBAChG,iFAAiF;oBACjFE,QAAQX,OAAOS,IAAI,CAACE,MAAM,IAAIX,OAAOD,GAAG;gBACzC;gBACA,gCAAgC;gBAChCiC,SAAS,CAAChC,OAAOgC,OAAO,GAAG,WAAWhC,OAAOgC,OAAO;YACrD,CAAA;IACF;IAEA,MAAMC,QAAQjB,MAAc,EAAEtB,QAAgB,EAAoB;QACjE,IAAI,CAACsB,UAAU,CAACtB,UAAU;YACzB,MAAM,IAAImB,MAAM;QACjB;QAEA,MAAMb,SAAS,MAAML,eAAO,CAACC,WAAW,CAACF;QACzC,IAAI,CAACM,QAAQ;YACZ,MAAM,IAAIa,MAAM;QACjB;QAEA,MAAMK,OAAO,MAAMC,aAAK,CAACvB,WAAW,CAAkCoB,QAAQ;YAC7EI,YAAY;gBAAEc,UAAU;YAAE;QAC3B;QACA,IAAI,CAAChB,MAAM;YACV,MAAM,IAAIL,MAAM;QACjB;QAEA,MAAMsB,cAAc;YACnBpC,KAAKmB,KAAKnB,GAAG;YACbmC,UAAUhB,KAAKgB,QAAQ;QACxB;QAEA,MAAME,QAAQ,IAAIC;QAElB,MAAM9B,MAAM;YACXS;YACAtB;YACAyC;YACAG,aAAaF;YACbG,YAAYH;QACb;QAEA,MAAMhC,sBAAc,CAACoC,SAAS,CAACjC;QAE/B,OAAO;IACR;IAEA,MAAMkC,QAAQ/C,QAAgB,EAAoB;QACjD,MAAMI,SAAS,MAAMH,eAAO,CAAC8C,OAAO,CAAC/C;QAErC,IAAII,QAAQ;YACX,KAAK4C,iBAAG,CAACC,SAAS,CAAC,mBAAmBjD;YACtC,OAAO;QACR;QACA,OAAO;IACR;IAEA,MAAMkD,OAAOlD,QAAgB,EAAEa,MAAqC,CAAC,CAAC,EAAoB;QACzF,MAAMT,SAAS,MAAMH,eAAO,CAACC,WAAW,CAACF;QAEzC,IAAI,CAACI,QAAQ;YACZ,OAAO;QACR;QAEA,MAAM,EAAEC,GAAG,EAAE,GAAGC,QAAQ,GAAGF;QAE3B,MAAM+C,YAAY;YAAE,GAAG7C,MAAM;YAAE,GAAGO,GAAG;YAAEJ,QAAQ;QAAK;QAEpD,MAAMR,eAAO,CAACmD,SAAS,CAAC;YAAE/C;QAAI,GAAG;YAAEO,MAAMuC;QAAU,IAAI,sBAAsB;QAE7E,KAAK,IAAI,CAAC/B,WAAW,CAAC;YAAEf;YAAK,GAAG8C,SAAS;QAAC;QAE1C,OAAO;IACR;IAEA,MAAM/B,YAAYd,MAAe,EAAoB;YAM/CA;QALL,IAAI,CAACA,OAAOG,MAAM,EAAE;YACnB,OAAO;QACR;QAEA,kDAAkD;QAClD,IAAI,GAACH,gBAAAA,OAAOqB,KAAK,cAAZrB,oCAAAA,cAAc+C,MAAM,GAAE;YAC1B,KAAKL,iBAAG,CAACC,SAAS,CAAC,kBAAkB3C,OAAOD,GAAG;YAC/C,OAAO;QACR;QAEA,MAAMiD,QAAQ,MAAM7B,aAAK,CAAC8B,uBAAuB,CAACjD,OAAOqB,KAAK;QAE9D,yEAAyE;QACzE,IAAI2B,QAAQ,KAAK;YAChB,KAAKN,iBAAG,CAACC,SAAS,CAAC,kBAAkB3C,OAAOD,GAAG;YAC/C,OAAO;QACR;QAEA,MAAMoB,aAAK,CAAC+B,sBAAsB,CAAClD,OAAOqB,KAAK,EAAE;YAAED,YAAY;gBAAErB,KAAK;YAAE;QAAE,GAAGoD,OAAO,CAAC,CAACjC;YACrF,KAAKwB,iBAAG,CAACC,SAAS,CAAC,eAAezB,KAAKnB,GAAG,EAAEC;QAC7C;QAEA,OAAO;IACR;;6BAnKUoD,OAAO;;AAoKlB","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/banner/service.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e0f80ad87d61442fda08e5fef5b096a055372584","contentHash":"5ca0bd6df1dfe550de035686dd1dfeca94d78129bde3a7f715f58b0251f04f25"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeFederationActions.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeFederationActions.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":33}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":15},"end":{"line":12,"column":48}},"5":{"start":{"line":13,"column":24},"end":{"line":20,"column":1}},"6":{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},"7":{"start":{"line":16,"column":12},"end":{"line":16,"column":88}},"8":{"start":{"line":18,"column":8},"end":{"line":18,"column":20}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":46},"end":{"line":19,"column":5}},"line":14}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},"type":"if","locations":[{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},{"start":{"line":15,"column":8},"end":{"line":17,"column":9}}],"line":15},"1":{"loc":{"start":{"line":15,"column":12},"end":{"line":15,"column":111}},"type":"binary-expr","locations":[{"start":{"line":15,"column":12},"end":{"line":15,"column":68}},{"start":{"line":15,"column":72},"end":{"line":15,"column":111}}],"line":15},"2":{"loc":{"start":{"line":16,"column":19},"end":{"line":16,"column":87}},"type":"binary-expr","locations":[{"start":{"line":16,"column":19},"end":{"line":16,"column":52}},{"start":{"line":16,"column":56},"end":{"line":16,"column":87}}],"line":16}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":7,"7":6,"8":1},"f":{"0":1,"1":7},"b":{"0":[6,1],"1":[7,4],"2":[6,4]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeFederationActions.ts"],"sourcesContent":["import type { AtLeast } from '@rocket.chat/core-typings';\nimport { type IMessage, type IRoom, isMessageFromMatrixFederation, isRoomFederated } from '@rocket.chat/core-typings';\n\nimport { isFederationEnabled, isFederationReady } from '../../federation/utils';\n\nexport class FederationActions {\n\tpublic static shouldPerformAction(message: IMessage, room: AtLeast<IRoom, 'federated'>): boolean {\n\t\tif (isMessageFromMatrixFederation(message) || isRoomFederated(room)) {\n\t\t\treturn isFederationEnabled() && isFederationReady();\n\t\t}\n\n\t\treturn true;\n\t}\n}\n"],"names":["FederationActions","shouldPerformAction","message","room","isMessageFromMatrixFederation","isRoomFederated","isFederationEnabled","isFederationReady"],"mappings":";;;;+BAKaA;;;eAAAA;;;6BAJ6E;uBAEnC;AAEhD,IAAA,AAAMA,oBAAN,MAAMA;IACZ,OAAcC,oBAAoBC,OAAiB,EAAEC,IAAiC,EAAW;QAChG,IAAIC,IAAAA,0CAA6B,EAACF,YAAYG,IAAAA,4BAAe,EAACF,OAAO;YACpE,OAAOG,IAAAA,0BAAmB,OAAMC,IAAAA,wBAAiB;QAClD;QAEA,OAAO;IACR;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeFederationActions.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3d84d473b2409124412ebcb388c5327580f2bf2b","contentHash":"a8221bbbef23ba4bb0a5af621011faba6414bceb7dfcdfa435ae961f179d1f90"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveBadWords.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveBadWords.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":34}},"3":{"start":{"line":12,"column":4},"end":{"line":12,"column":51}},"4":{"start":{"line":12,"column":39},"end":{"line":12,"column":51}},"5":{"start":{"line":13,"column":28},"end":{"line":13,"column":41}},"6":{"start":{"line":14,"column":27},"end":{"line":14,"column":40}},"7":{"start":{"line":15,"column":4},"end":{"line":17,"column":20}},"8":{"start":{"line":16,"column":8},"end":{"line":16,"column":66}},"9":{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},"10":{"start":{"line":21,"column":8},"end":{"line":21,"column":19}},"11":{"start":{"line":23,"column":4},"end":{"line":27,"column":5}},"12":{"start":{"line":24,"column":8},"end":{"line":26,"column":10}},"13":{"start":{"line":28,"column":16},"end":{"line":28,"column":53}},"14":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"15":{"start":{"line":30,"column":8},"end":{"line":30,"column":30}},"16":{"start":{"line":32,"column":17},"end":{"line":34,"column":5}},"17":{"start":{"line":35,"column":32},"end":{"line":35,"column":88}},"18":{"start":{"line":36,"column":4},"end":{"line":45,"column":5}},"19":{"start":{"line":37,"column":8},"end":{"line":44,"column":9}},"20":{"start":{"line":38,"column":23},"end":{"line":38,"column":95}},"21":{"start":{"line":39,"column":12},"end":{"line":43,"column":13}},"22":{"start":{"line":40,"column":16},"end":{"line":40,"column":57}},"23":{"start":{"line":42,"column":16},"end":{"line":42,"column":39}},"24":{"start":{"line":46,"column":4},"end":{"line":46,"column":25}},"25":{"start":{"line":47,"column":4},"end":{"line":49,"column":5}},"26":{"start":{"line":48,"column":8},"end":{"line":48,"column":31}},"27":{"start":{"line":50,"column":4},"end":{"line":50,"column":18}},"28":{"start":{"line":52,"column":25},"end":{"line":87,"column":1}},"29":{"start":{"line":54,"column":36},"end":{"line":54,"column":131}},"30":{"start":{"line":54,"column":83},"end":{"line":54,"column":130}},"31":{"start":{"line":55,"column":24},"end":{"line":64,"column":9}},"32":{"start":{"line":56,"column":115},"end":{"line":56,"column":126}},"33":{"start":{"line":65,"column":8},"end":{"line":65,"column":44}},"34":{"start":{"line":66,"column":8},"end":{"line":68,"column":9}},"35":{"start":{"line":67,"column":12},"end":{"line":67,"column":92}},"36":{"start":{"line":67,"column":78},"end":{"line":67,"column":89}},"37":{"start":{"line":71,"column":8},"end":{"line":71,"column":29}},"38":{"start":{"line":74,"column":8},"end":{"line":76,"column":9}},"39":{"start":{"line":75,"column":12},"end":{"line":75,"column":27}},"40":{"start":{"line":77,"column":8},"end":{"line":81,"column":9}},"41":{"start":{"line":78,"column":12},"end":{"line":78,"column":59}},"42":{"start":{"line":82,"column":8},"end":{"line":82,"column":23}},"43":{"start":{"line":85,"column":8},"end":{"line":85,"column":29}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_getRequireWildcardCache","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":33}},"loc":{"start":{"line":11,"column":47},"end":{"line":18,"column":1}},"line":11},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":39},"end":{"line":15,"column":40}},"loc":{"start":{"line":15,"column":61},"end":{"line":17,"column":5}},"line":15},"3":{"name":"_interop_require_wildcard","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":34}},"loc":{"start":{"line":19,"column":53},"end":{"line":51,"column":1}},"line":19},"4":{"name":"(anonymous_4)","decl":{"start":{"line":53,"column":4},"end":{"line":53,"column":5}},"loc":{"start":{"line":53,"column":49},"end":{"line":69,"column":5}},"line":53},"5":{"name":"(anonymous_5)","decl":{"start":{"line":54,"column":65},"end":{"line":54,"column":66}},"loc":{"start":{"line":54,"column":83},"end":{"line":54,"column":130}},"line":54},"6":{"name":"(anonymous_6)","decl":{"start":{"line":56,"column":107},"end":{"line":56,"column":108}},"loc":{"start":{"line":56,"column":115},"end":{"line":56,"column":126}},"line":56},"7":{"name":"(anonymous_7)","decl":{"start":{"line":67,"column":70},"end":{"line":67,"column":71}},"loc":{"start":{"line":67,"column":78},"end":{"line":67,"column":89}},"line":67},"8":{"name":"(anonymous_8)","decl":{"start":{"line":70,"column":4},"end":{"line":70,"column":5}},"loc":{"start":{"line":70,"column":14},"end":{"line":72,"column":5}},"line":70},"9":{"name":"(anonymous_9)","decl":{"start":{"line":73,"column":4},"end":{"line":73,"column":5}},"loc":{"start":{"line":73,"column":38},"end":{"line":83,"column":5}},"line":73},"10":{"name":"(anonymous_10)","decl":{"start":{"line":84,"column":4},"end":{"line":84,"column":5}},"loc":{"start":{"line":84,"column":17},"end":{"line":86,"column":5}},"line":84}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":4},"end":{"line":12,"column":51}},"type":"if","locations":[{"start":{"line":12,"column":4},"end":{"line":12,"column":51}},{"start":{"line":12,"column":4},"end":{"line":12,"column":51}}],"line":12},"1":{"loc":{"start":{"line":16,"column":15},"end":{"line":16,"column":65}},"type":"cond-expr","locations":[{"start":{"line":16,"column":29},"end":{"line":16,"column":45}},{"start":{"line":16,"column":48},"end":{"line":16,"column":65}}],"line":16},"2":{"loc":{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},"type":"if","locations":[{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},{"start":{"line":20,"column":4},"end":{"line":22,"column":5}}],"line":20},"3":{"loc":{"start":{"line":20,"column":8},"end":{"line":20,"column":45}},"type":"binary-expr","locations":[{"start":{"line":20,"column":8},"end":{"line":20,"column":20}},{"start":{"line":20,"column":24},"end":{"line":20,"column":27}},{"start":{"line":20,"column":31},"end":{"line":20,"column":45}}],"line":20},"4":{"loc":{"start":{"line":23,"column":4},"end":{"line":27,"column":5}},"type":"if","locations":[{"start":{"line":23,"column":4},"end":{"line":27,"column":5}},{"start":{"line":23,"column":4},"end":{"line":27,"column":5}}],"line":23},"5":{"loc":{"start":{"line":23,"column":8},"end":{"line":23,"column":76}},"type":"binary-expr","locations":[{"start":{"line":23,"column":8},"end":{"line":23,"column":20}},{"start":{"line":23,"column":24},"end":{"line":23,"column":47}},{"start":{"line":23,"column":51},"end":{"line":23,"column":76}}],"line":23},"6":{"loc":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},{"start":{"line":29,"column":4},"end":{"line":31,"column":5}}],"line":29},"7":{"loc":{"start":{"line":29,"column":8},"end":{"line":29,"column":31}},"type":"binary-expr","locations":[{"start":{"line":29,"column":8},"end":{"line":29,"column":13}},{"start":{"line":29,"column":17},"end":{"line":29,"column":31}}],"line":29},"8":{"loc":{"start":{"line":35,"column":32},"end":{"line":35,"column":88}},"type":"binary-expr","locations":[{"start":{"line":35,"column":32},"end":{"line":35,"column":53}},{"start":{"line":35,"column":57},"end":{"line":35,"column":88}}],"line":35},"9":{"loc":{"start":{"line":37,"column":8},"end":{"line":44,"column":9}},"type":"if","locations":[{"start":{"line":37,"column":8},"end":{"line":44,"column":9}},{"start":{"line":37,"column":8},"end":{"line":44,"column":9}}],"line":37},"10":{"loc":{"start":{"line":37,"column":12},"end":{"line":37,"column":79}},"type":"binary-expr","locations":[{"start":{"line":37,"column":12},"end":{"line":37,"column":29}},{"start":{"line":37,"column":33},"end":{"line":37,"column":79}}],"line":37},"11":{"loc":{"start":{"line":38,"column":23},"end":{"line":38,"column":95}},"type":"cond-expr","locations":[{"start":{"line":38,"column":47},"end":{"line":38,"column":88}},{"start":{"line":38,"column":91},"end":{"line":38,"column":95}}],"line":38},"12":{"loc":{"start":{"line":39,"column":12},"end":{"line":43,"column":13}},"type":"if","locations":[{"start":{"line":39,"column":12},"end":{"line":43,"column":13}},{"start":{"line":39,"column":12},"end":{"line":43,"column":13}}],"line":39},"13":{"loc":{"start":{"line":39,"column":16},"end":{"line":39,"column":46}},"type":"binary-expr","locations":[{"start":{"line":39,"column":16},"end":{"line":39,"column":20}},{"start":{"line":39,"column":25},"end":{"line":39,"column":33}},{"start":{"line":39,"column":37},"end":{"line":39,"column":45}}],"line":39},"14":{"loc":{"start":{"line":47,"column":4},"end":{"line":49,"column":5}},"type":"if","locations":[{"start":{"line":47,"column":4},"end":{"line":49,"column":5}},{"start":{"line":47,"column":4},"end":{"line":49,"column":5}}],"line":47},"15":{"loc":{"start":{"line":56,"column":18},"end":{"line":56,"column":150}},"type":"binary-expr","locations":[{"start":{"line":56,"column":19},"end":{"line":56,"column":143}},{"start":{"line":56,"column":148},"end":{"line":56,"column":150}}],"line":56},"16":{"loc":{"start":{"line":56,"column":19},"end":{"line":56,"column":143}},"type":"cond-expr","locations":[{"start":{"line":56,"column":70},"end":{"line":56,"column":76}},{"start":{"line":56,"column":79},"end":{"line":56,"column":143}}],"line":56},"17":{"loc":{"start":{"line":56,"column":19},"end":{"line":56,"column":67}},"type":"binary-expr","locations":[{"start":{"line":56,"column":19},"end":{"line":56,"column":40}},{"start":{"line":56,"column":44},"end":{"line":56,"column":67}}],"line":56},"18":{"loc":{"start":{"line":66,"column":8},"end":{"line":68,"column":9}},"type":"if","locations":[{"start":{"line":66,"column":8},"end":{"line":68,"column":9}},{"start":{"line":66,"column":8},"end":{"line":68,"column":9}}],"line":66},"19":{"loc":{"start":{"line":66,"column":12},"end":{"line":66,"column":94}},"type":"cond-expr","locations":[{"start":{"line":66,"column":65},"end":{"line":66,"column":71}},{"start":{"line":66,"column":74},"end":{"line":66,"column":94}}],"line":66},"20":{"loc":{"start":{"line":66,"column":12},"end":{"line":66,"column":62}},"type":"binary-expr","locations":[{"start":{"line":66,"column":12},"end":{"line":66,"column":34}},{"start":{"line":66,"column":38},"end":{"line":66,"column":62}}],"line":66},"21":{"loc":{"start":{"line":74,"column":8},"end":{"line":76,"column":9}},"type":"if","locations":[{"start":{"line":74,"column":8},"end":{"line":76,"column":9}},{"start":{"line":74,"column":8},"end":{"line":76,"column":9}}],"line":74},"22":{"loc":{"start":{"line":74,"column":12},"end":{"line":74,"column":42}},"type":"binary-expr","locations":[{"start":{"line":74,"column":12},"end":{"line":74,"column":24}},{"start":{"line":74,"column":28},"end":{"line":74,"column":42}}],"line":74}},"s":{"0":1,"1":1,"2":6,"3":1,"4":0,"5":1,"6":1,"7":1,"8":4,"9":4,"10":0,"11":4,"12":0,"13":4,"14":4,"15":3,"16":1,"17":1,"18":1,"19":0,"20":0,"21":0,"22":0,"23":0,"24":1,"25":1,"26":1,"27":1,"28":1,"29":4,"30":4,"31":4,"32":1,"33":4,"34":4,"35":1,"36":1,"37":1,"38":6,"39":3,"40":3,"41":3,"42":3,"43":6},"f":{"0":6,"1":1,"2":4,"3":4,"4":4,"5":4,"6":1,"7":1,"8":1,"9":6,"10":6},"b":{"0":[0,1],"1":[0,4],"2":[0,4],"3":[4,4,4],"4":[0,4],"5":[4,4,4],"6":[3,1],"7":[4,4],"8":[1,1],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0],"14":[1,0],"15":[4,3],"16":[3,1],"17":[4,4],"18":[1,3],"19":[3,1],"20":[4,4],"21":[3,3],"22":[6,5]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveBadWords.ts"],"sourcesContent":["import { type IMessage } from '@rocket.chat/core-typings';\nimport type BadWordsFilter from 'bad-words';\n\nexport class BeforeSaveBadWords {\n\tbadWords: BadWordsFilter | null = null;\n\n\tasync configure(badWordsList?: string, goodWordsList?: string) {\n\t\tconst { default: Filter } = await import('bad-words');\n\n\t\tconst options = {\n\t\t\tlist:\n\t\t\t\tbadWordsList\n\t\t\t\t\t?.split(',')\n\t\t\t\t\t.map((word) => word.trim())\n\t\t\t\t\t.filter(Boolean) || [],\n\t\t\t// library definition does not allow optional definition\n\t\t\texclude: undefined,\n\t\t\tsplitRegex: undefined,\n\t\t\tplaceHolder: undefined,\n\t\t\tregex: undefined,\n\t\t\treplaceRegex: undefined,\n\t\t\temptyList: undefined,\n\t\t};\n\n\t\tthis.badWords = new Filter(options);\n\n\t\tif (goodWordsList?.length) {\n\t\t\tthis.badWords.removeWords(...goodWordsList.split(',').map((word) => word.trim()));\n\t\t}\n\t}\n\n\tdisable() {\n\t\tthis.badWords = null;\n\t}\n\n\tasync filterBadWords({ message }: { message: IMessage }): Promise<IMessage> {\n\t\tif (!message.msg || !this.badWords) {\n\t\t\treturn message;\n\t\t}\n\n\t\ttry {\n\t\t\tmessage.msg = this.badWords.clean(message.msg);\n\t\t} catch (error) {\n\t\t\t// ignore\n\t\t}\n\n\t\treturn message;\n\t}\n}\n"],"names":["BeforeSaveBadWords","configure","badWordsList","goodWordsList","default","Filter","options","list","split","map","word","trim","filter","Boolean","exclude","undefined","splitRegex","placeHolder","regex","replaceRegex","emptyList","badWords","length","removeWords","disable","filterBadWords","message","msg","clean","error"],"mappings":";;;;+BAGaA;;;eAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAN,IAAA,AAAMA,qBAAN,MAAMA;IAGZ,MAAMC,UAAUC,YAAqB,EAAEC,aAAsB,EAAE;QAC9D,MAAM,EAAEC,SAASC,MAAM,EAAE,GAAG,MAAM,mEAAA,QAAO;QAEzC,MAAMC,UAAU;YACfC,MACCL,CAAAA,yBAAAA,mCAAAA,aACGM,KAAK,CAAC,KACPC,GAAG,CAAC,CAACC,OAASA,KAAKC,IAAI,IACvBC,MAAM,CAACC,aAAY,EAAE;YACxB,wDAAwD;YACxDC,SAASC;YACTC,YAAYD;YACZE,aAAaF;YACbG,OAAOH;YACPI,cAAcJ;YACdK,WAAWL;QACZ;QAEA,IAAI,CAACM,QAAQ,GAAG,IAAIhB,OAAOC;QAE3B,IAAIH,0BAAAA,oCAAAA,cAAemB,MAAM,EAAE;YAC1B,IAAI,CAACD,QAAQ,CAACE,WAAW,IAAIpB,cAAcK,KAAK,CAAC,KAAKC,GAAG,CAAC,CAACC,OAASA,KAAKC,IAAI;QAC9E;IACD;IAEAa,UAAU;QACT,IAAI,CAACH,QAAQ,GAAG;IACjB;IAEA,MAAMI,eAAe,EAAEC,OAAO,EAAyB,EAAqB;QAC3E,IAAI,CAACA,QAAQC,GAAG,IAAI,CAAC,IAAI,CAACN,QAAQ,EAAE;YACnC,OAAOK;QACR;QAEA,IAAI;YACHA,QAAQC,GAAG,GAAG,IAAI,CAACN,QAAQ,CAACO,KAAK,CAACF,QAAQC,GAAG;QAC9C,EAAE,OAAOE,OAAO;QACf,SAAS;QACV;QAEA,OAAOH;IACR;;aA3CAL,WAAkC;;AA4CnC","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveBadWords.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"be6446ecef0d061240bd66043808369a58b42d7b","contentHash":"079d26e1c65c0365c9859f892c763652e7c4b94744f6b752c2c868b471082567"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveCheckMAC.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveCheckMAC.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":34}},"3":{"start":{"line":11,"column":22},"end":{"line":11,"column":59}},"4":{"start":{"line":12,"column":21},"end":{"line":12,"column":57}},"5":{"start":{"line":13,"column":25},"end":{"line":29,"column":1}},"6":{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},"7":{"start":{"line":16,"column":12},"end":{"line":16,"column":19}},"8":{"start":{"line":18,"column":8},"end":{"line":20,"column":9}},"9":{"start":{"line":19,"column":12},"end":{"line":19,"column":19}},"10":{"start":{"line":21,"column":8},"end":{"line":23,"column":9}},"11":{"start":{"line":22,"column":12},"end":{"line":22,"column":19}},"12":{"start":{"line":24,"column":31},"end":{"line":24,"column":85}},"13":{"start":{"line":25,"column":8},"end":{"line":27,"column":9}},"14":{"start":{"line":26,"column":12},"end":{"line":26,"column":75}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":44},"end":{"line":28,"column":5}},"line":14}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},"type":"if","locations":[{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},{"start":{"line":15,"column":8},"end":{"line":17,"column":9}}],"line":15},"1":{"loc":{"start":{"line":18,"column":8},"end":{"line":20,"column":9}},"type":"if","locations":[{"start":{"line":18,"column":8},"end":{"line":20,"column":9}},{"start":{"line":18,"column":8},"end":{"line":20,"column":9}}],"line":18},"2":{"loc":{"start":{"line":21,"column":8},"end":{"line":23,"column":9}},"type":"if","locations":[{"start":{"line":21,"column":8},"end":{"line":23,"column":9}},{"start":{"line":21,"column":8},"end":{"line":23,"column":9}}],"line":21},"3":{"loc":{"start":{"line":25,"column":8},"end":{"line":27,"column":9}},"type":"if","locations":[{"start":{"line":25,"column":8},"end":{"line":27,"column":9}},{"start":{"line":25,"column":8},"end":{"line":27,"column":9}}],"line":25}},"s":{"0":1,"1":1,"2":5,"3":1,"4":1,"5":1,"6":5,"7":1,"8":4,"9":1,"10":3,"11":1,"12":2,"13":2,"14":1},"f":{"0":5,"1":5},"b":{"0":[1,4],"1":[1,3],"2":[1,2],"3":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveCheckMAC.ts"],"sourcesContent":["import { MeteorError, Omnichannel } from '@rocket.chat/core-services';\nimport type { IRoom } from '@rocket.chat/core-typings';\nimport { isOmnichannelRoom, type IMessage } from '@rocket.chat/core-typings';\n\nexport class BeforeSaveCheckMAC {\n\tasync isWithinLimits({ message, room }: { message: IMessage; room: IRoom }): Promise<void> {\n\t\tif (!isOmnichannelRoom(room)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (message.token) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (message.t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst canSendMessage = await Omnichannel.isWithinMACLimit(room);\n\t\tif (!canSendMessage) {\n\t\t\tthrow new MeteorError('error-mac-limit-reached');\n\t\t}\n\t}\n}\n"],"names":["BeforeSaveCheckMAC","isWithinLimits","message","room","isOmnichannelRoom","token","t","canSendMessage","Omnichannel","isWithinMACLimit","MeteorError"],"mappings":";;;;+BAIaA;;;eAAAA;;;8BAJ4B;6BAEQ;AAE1C,IAAA,AAAMA,qBAAN,MAAMA;IACZ,MAAMC,eAAe,EAAEC,OAAO,EAAEC,IAAI,EAAsC,EAAiB;QAC1F,IAAI,CAACC,IAAAA,8BAAiB,EAACD,OAAO;YAC7B;QACD;QAEA,IAAID,QAAQG,KAAK,EAAE;YAClB;QACD;QAEA,IAAIH,QAAQI,CAAC,EAAE;YACd;QACD;QAEA,MAAMC,iBAAiB,MAAMC,yBAAW,CAACC,gBAAgB,CAACN;QAC1D,IAAI,CAACI,gBAAgB;YACpB,MAAM,IAAIG,yBAAW,CAAC;QACvB;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveCheckMAC.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"447e9d9616fca755e4d411ff9f1120409ffcbe71","contentHash":"ab79c080e9abb6ed29ba0f7307abe9bf1c61d59cc79dae87b54f3f777c1e112d"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveJumpToMessage.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveJumpToMessage.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":39}},"3":{"start":{"line":11,"column":35},"end":{"line":11,"column":83}},"4":{"start":{"line":12,"column":27},"end":{"line":12,"column":67}},"5":{"start":{"line":13,"column":21},"end":{"line":13,"column":57}},"6":{"start":{"line":14,"column":31},"end":{"line":14,"column":79}},"7":{"start":{"line":16,"column":4},"end":{"line":18,"column":6}},"8":{"start":{"line":20,"column":35},"end":{"line":30,"column":1}},"9":{"start":{"line":21,"column":4},"end":{"line":28,"column":5}},"10":{"start":{"line":22,"column":8},"end":{"line":27,"column":9}},"11":{"start":{"line":24,"column":12},"end":{"line":24,"column":220}},"12":{"start":{"line":24,"column":160},"end":{"line":24,"column":218}},"13":{"start":{"line":26,"column":12},"end":{"line":26,"column":43}},"14":{"start":{"line":29,"column":4},"end":{"line":29,"column":23}},"15":{"start":{"line":31,"column":35},"end":{"line":41,"column":1}},"16":{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},"17":{"start":{"line":34,"column":8},"end":{"line":34,"column":23}},"18":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"19":{"start":{"line":37,"column":8},"end":{"line":37,"column":35}},"20":{"start":{"line":39,"column":4},"end":{"line":39,"column":225}},"21":{"start":{"line":39,"column":165},"end":{"line":39,"column":223}},"22":{"start":{"line":40,"column":4},"end":{"line":40,"column":19}},"23":{"start":{"line":42,"column":31},"end":{"line":47,"column":1}},"24":{"start":{"line":43,"column":4},"end":{"line":45,"column":5}},"25":{"start":{"line":44,"column":8},"end":{"line":44,"column":15}},"26":{"start":{"line":46,"column":4},"end":{"line":46,"column":117}},"27":{"start":{"line":46,"column":67},"end":{"line":46,"column":115}},"28":{"start":{"line":48,"column":30},"end":{"line":120,"column":1}},"29":{"start":{"line":52,"column":8},"end":{"line":52,"column":40}},"30":{"start":{"line":54,"column":8},"end":{"line":56,"column":9}},"31":{"start":{"line":55,"column":12},"end":{"line":55,"column":27}},"32":{"start":{"line":57,"column":31},"end":{"line":71,"column":26}},"33":{"start":{"line":57,"column":59},"end":{"line":57,"column":92}},"34":{"start":{"line":58,"column":27},"end":{"line":58,"column":55}},"35":{"start":{"line":60,"column":12},"end":{"line":62,"column":13}},"36":{"start":{"line":61,"column":16},"end":{"line":61,"column":23}},"37":{"start":{"line":63,"column":35},"end":{"line":63,"column":75}},"38":{"start":{"line":64,"column":12},"end":{"line":66,"column":13}},"39":{"start":{"line":65,"column":16},"end":{"line":65,"column":23}},"40":{"start":{"line":67,"column":12},"end":{"line":70,"column":14}},"41":{"start":{"line":72,"column":21},"end":{"line":72,"column":147}},"42":{"start":{"line":72,"column":76},"end":{"line":72,"column":145}},"43":{"start":{"line":73,"column":30},"end":{"line":73,"column":100}},"44":{"start":{"line":73,"column":49},"end":{"line":73,"column":99}},"45":{"start":{"line":74,"column":22},"end":{"line":74,"column":76}},"46":{"start":{"line":74,"column":67},"end":{"line":74,"column":74}},"47":{"start":{"line":75,"column":36},"end":{"line":83,"column":11}},"48":{"start":{"line":77,"column":12},"end":{"line":79,"column":13}},"49":{"start":{"line":78,"column":16},"end":{"line":78,"column":28}},"50":{"start":{"line":80,"column":12},"end":{"line":82,"column":13}},"51":{"start":{"line":81,"column":16},"end":{"line":81,"column":28}},"52":{"start":{"line":84,"column":27},"end":{"line":84,"column":143}},"53":{"start":{"line":84,"column":136},"end":{"line":84,"column":142}},"54":{"start":{"line":85,"column":32},"end":{"line":85,"column":38}},"55":{"start":{"line":86,"column":23},"end":{"line":86,"column":25}},"56":{"start":{"line":87,"column":8},"end":{"line":104,"column":9}},"57":{"start":{"line":88,"column":12},"end":{"line":90,"column":13}},"58":{"start":{"line":89,"column":16},"end":{"line":89,"column":25}},"59":{"start":{"line":91,"column":34},"end":{"line":91,"column":126}},"60":{"start":{"line":91,"column":61},"end":{"line":91,"column":125}},"61":{"start":{"line":92,"column":12},"end":{"line":94,"column":13}},"62":{"start":{"line":93,"column":16},"end":{"line":93,"column":25}},"63":{"start":{"line":95,"column":35},"end":{"line":95,"column":93}},"64":{"start":{"line":95,"column":61},"end":{"line":95,"column":92}},"65":{"start":{"line":96,"column":12},"end":{"line":98,"column":13}},"66":{"start":{"line":97,"column":16},"end":{"line":97,"column":25}},"67":{"start":{"line":99,"column":12},"end":{"line":101,"column":13}},"68":{"start":{"line":99,"column":98},"end":{"line":99,"column":175}},"69":{"start":{"line":100,"column":16},"end":{"line":100,"column":25}},"70":{"start":{"line":102,"column":12},"end":{"line":102,"column":36}},"71":{"start":{"line":103,"column":12},"end":{"line":103,"column":164}},"72":{"start":{"line":105,"column":8},"end":{"line":111,"column":9}},"73":{"start":{"line":106,"column":39},"end":{"line":106,"column":64}},"74":{"start":{"line":107,"column":12},"end":{"line":110,"column":14}},"75":{"start":{"line":112,"column":8},"end":{"line":112,"column":23}},"76":{"start":{"line":115,"column":8},"end":{"line":115,"column":47}},"77":{"start":{"line":116,"column":8},"end":{"line":116,"column":41}},"78":{"start":{"line":117,"column":8},"end":{"line":117,"column":51}},"79":{"start":{"line":118,"column":8},"end":{"line":118,"column":57}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":15,"column":9},"end":{"line":15,"column":33}},"loc":{"start":{"line":15,"column":39},"end":{"line":19,"column":1}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":20,"column":35},"end":{"line":20,"column":36}},"loc":{"start":{"line":20,"column":77},"end":{"line":30,"column":1}},"line":20},"3":{"name":"(anonymous_3)","decl":{"start":{"line":24,"column":153},"end":{"line":24,"column":154}},"loc":{"start":{"line":24,"column":160},"end":{"line":24,"column":218}},"line":24},"4":{"name":"(anonymous_4)","decl":{"start":{"line":31,"column":35},"end":{"line":31,"column":36}},"loc":{"start":{"line":31,"column":63},"end":{"line":41,"column":1}},"line":31},"5":{"name":"(anonymous_5)","decl":{"start":{"line":39,"column":151},"end":{"line":39,"column":152}},"loc":{"start":{"line":39,"column":165},"end":{"line":39,"column":223}},"line":39},"6":{"name":"(anonymous_6)","decl":{"start":{"line":42,"column":31},"end":{"line":42,"column":32}},"loc":{"start":{"line":42,"column":42},"end":{"line":47,"column":1}},"line":42},"7":{"name":"(anonymous_7)","decl":{"start":{"line":46,"column":53},"end":{"line":46,"column":54}},"loc":{"start":{"line":46,"column":67},"end":{"line":46,"column":115}},"line":46},"8":{"name":"(anonymous_8)","decl":{"start":{"line":49,"column":4},"end":{"line":49,"column":5}},"loc":{"start":{"line":49,"column":81},"end":{"line":113,"column":5}},"line":49},"9":{"name":"(anonymous_9)","decl":{"start":{"line":57,"column":51},"end":{"line":57,"column":52}},"loc":{"start":{"line":57,"column":59},"end":{"line":57,"column":92}},"line":57},"10":{"name":"(anonymous_10)","decl":{"start":{"line":57,"column":98},"end":{"line":57,"column":99}},"loc":{"start":{"line":57,"column":106},"end":{"line":71,"column":9}},"line":57},"11":{"name":"(anonymous_11)","decl":{"start":{"line":72,"column":63},"end":{"line":72,"column":64}},"loc":{"start":{"line":72,"column":76},"end":{"line":72,"column":145}},"line":72},"12":{"name":"(anonymous_12)","decl":{"start":{"line":73,"column":42},"end":{"line":73,"column":43}},"loc":{"start":{"line":73,"column":49},"end":{"line":73,"column":99}},"line":73},"13":{"name":"(anonymous_13)","decl":{"start":{"line":74,"column":60},"end":{"line":74,"column":61}},"loc":{"start":{"line":74,"column":67},"end":{"line":74,"column":74}},"line":74},"14":{"name":"(anonymous_14)","decl":{"start":{"line":75,"column":73},"end":{"line":75,"column":74}},"loc":{"start":{"line":75,"column":87},"end":{"line":83,"column":9}},"line":75},"15":{"name":"(anonymous_15)","decl":{"start":{"line":84,"column":128},"end":{"line":84,"column":129}},"loc":{"start":{"line":84,"column":136},"end":{"line":84,"column":142}},"line":84},"16":{"name":"(anonymous_16)","decl":{"start":{"line":91,"column":54},"end":{"line":91,"column":55}},"loc":{"start":{"line":91,"column":61},"end":{"line":91,"column":125}},"line":91},"17":{"name":"(anonymous_17)","decl":{"start":{"line":95,"column":54},"end":{"line":95,"column":55}},"loc":{"start":{"line":95,"column":61},"end":{"line":95,"column":92}},"line":95},"18":{"name":"(anonymous_18)","decl":{"start":{"line":99,"column":90},"end":{"line":99,"column":91}},"loc":{"start":{"line":99,"column":98},"end":{"line":99,"column":175}},"line":99},"19":{"name":"(anonymous_19)","decl":{"start":{"line":114,"column":4},"end":{"line":114,"column":5}},"loc":{"start":{"line":114,"column":24},"end":{"line":119,"column":5}},"line":114}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":11},"end":{"line":18,"column":5}},"type":"cond-expr","locations":[{"start":{"line":16,"column":35},"end":{"line":16,"column":38}},{"start":{"line":16,"column":41},"end":{"line":18,"column":5}}],"line":16},"1":{"loc":{"start":{"line":16,"column":11},"end":{"line":16,"column":32}},"type":"binary-expr","locations":[{"start":{"line":16,"column":11},"end":{"line":16,"column":14}},{"start":{"line":16,"column":18},"end":{"line":16,"column":32}}],"line":16},"2":{"loc":{"start":{"line":20,"column":49},"end":{"line":20,"column":57}},"type":"default-arg","locations":[{"start":{"line":20,"column":56},"end":{"line":20,"column":57}}],"line":20},"3":{"loc":{"start":{"line":21,"column":4},"end":{"line":28,"column":5}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":28,"column":5}},{"start":{"line":21,"column":4},"end":{"line":28,"column":5}}],"line":21},"4":{"loc":{"start":{"line":21,"column":8},"end":{"line":21,"column":71}},"type":"binary-expr","locations":[{"start":{"line":21,"column":8},"end":{"line":21,"column":19}},{"start":{"line":21,"column":23},"end":{"line":21,"column":71}}],"line":21},"5":{"loc":{"start":{"line":22,"column":8},"end":{"line":27,"column":9}},"type":"if","locations":[{"start":{"line":22,"column":8},"end":{"line":27,"column":9}},{"start":{"line":22,"column":8},"end":{"line":27,"column":9}}],"line":22},"6":{"loc":{"start":{"line":24,"column":12},"end":{"line":24,"column":219}},"type":"cond-expr","locations":[{"start":{"line":24,"column":115},"end":{"line":24,"column":121}},{"start":{"line":24,"column":124},"end":{"line":24,"column":219}}],"line":24},"7":{"loc":{"start":{"line":24,"column":12},"end":{"line":24,"column":112}},"type":"binary-expr","locations":[{"start":{"line":24,"column":12},"end":{"line":24,"column":73}},{"start":{"line":24,"column":77},"end":{"line":24,"column":112}}],"line":24},"8":{"loc":{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},"type":"if","locations":[{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},{"start":{"line":33,"column":4},"end":{"line":35,"column":5}}],"line":33},"9":{"loc":{"start":{"line":33,"column":10},"end":{"line":33,"column":79}},"type":"cond-expr","locations":[{"start":{"line":33,"column":51},"end":{"line":33,"column":57}},{"start":{"line":33,"column":60},"end":{"line":33,"column":79}}],"line":33},"10":{"loc":{"start":{"line":33,"column":10},"end":{"line":33,"column":48}},"type":"binary-expr","locations":[{"start":{"line":33,"column":10},"end":{"line":33,"column":26}},{"start":{"line":33,"column":30},"end":{"line":33,"column":48}}],"line":33},"11":{"loc":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},{"start":{"line":36,"column":4},"end":{"line":38,"column":5}}],"line":36},"12":{"loc":{"start":{"line":36,"column":8},"end":{"line":36,"column":76}},"type":"binary-expr","locations":[{"start":{"line":36,"column":8},"end":{"line":36,"column":27}},{"start":{"line":36,"column":31},"end":{"line":36,"column":50}},{"start":{"line":36,"column":54},"end":{"line":36,"column":76}}],"line":36},"13":{"loc":{"start":{"line":39,"column":26},"end":{"line":39,"column":224}},"type":"cond-expr","locations":[{"start":{"line":39,"column":117},"end":{"line":39,"column":123}},{"start":{"line":39,"column":126},"end":{"line":39,"column":224}}],"line":39},"14":{"loc":{"start":{"line":39,"column":26},"end":{"line":39,"column":114}},"type":"binary-expr","locations":[{"start":{"line":39,"column":26},"end":{"line":39,"column":79}},{"start":{"line":39,"column":83},"end":{"line":39,"column":114}}],"line":39},"15":{"loc":{"start":{"line":43,"column":4},"end":{"line":45,"column":5}},"type":"if","locations":[{"start":{"line":43,"column":4},"end":{"line":45,"column":5}},{"start":{"line":43,"column":4},"end":{"line":45,"column":5}}],"line":43},"16":{"loc":{"start":{"line":54,"column":8},"end":{"line":56,"column":9}},"type":"if","locations":[{"start":{"line":54,"column":8},"end":{"line":56,"column":9}},{"start":{"line":54,"column":8},"end":{"line":56,"column":9}}],"line":54},"17":{"loc":{"start":{"line":54,"column":14},"end":{"line":54,"column":163}},"type":"cond-expr","locations":[{"start":{"line":54,"column":55},"end":{"line":54,"column":61}},{"start":{"line":54,"column":64},"end":{"line":54,"column":163}}],"line":54},"18":{"loc":{"start":{"line":54,"column":14},"end":{"line":54,"column":52}},"type":"binary-expr","locations":[{"start":{"line":54,"column":14},"end":{"line":54,"column":30}},{"start":{"line":54,"column":34},"end":{"line":54,"column":52}}],"line":54},"19":{"loc":{"start":{"line":54,"column":64},"end":{"line":54,"column":163}},"type":"cond-expr","locations":[{"start":{"line":54,"column":134},"end":{"line":54,"column":140}},{"start":{"line":54,"column":143},"end":{"line":54,"column":163}}],"line":54},"20":{"loc":{"start":{"line":54,"column":64},"end":{"line":54,"column":131}},"type":"binary-expr","locations":[{"start":{"line":54,"column":64},"end":{"line":54,"column":103}},{"start":{"line":54,"column":107},"end":{"line":54,"column":131}}],"line":54},"21":{"loc":{"start":{"line":60,"column":12},"end":{"line":62,"column":13}},"type":"if","locations":[{"start":{"line":60,"column":12},"end":{"line":62,"column":13}},{"start":{"line":60,"column":12},"end":{"line":62,"column":13}}],"line":60},"22":{"loc":{"start":{"line":64,"column":12},"end":{"line":66,"column":13}},"type":"if","locations":[{"start":{"line":64,"column":12},"end":{"line":66,"column":13}},{"start":{"line":64,"column":12},"end":{"line":66,"column":13}}],"line":64},"23":{"loc":{"start":{"line":72,"column":76},"end":{"line":72,"column":145}},"type":"cond-expr","locations":[{"start":{"line":72,"column":121},"end":{"line":72,"column":127}},{"start":{"line":72,"column":130},"end":{"line":72,"column":145}}],"line":72},"24":{"loc":{"start":{"line":72,"column":76},"end":{"line":72,"column":118}},"type":"binary-expr","locations":[{"start":{"line":72,"column":76},"end":{"line":72,"column":94}},{"start":{"line":72,"column":98},"end":{"line":72,"column":118}}],"line":72},"25":{"loc":{"start":{"line":75,"column":36},"end":{"line":83,"column":11}},"type":"binary-expr","locations":[{"start":{"line":75,"column":36},"end":{"line":75,"column":41}},{"start":{"line":75,"column":45},"end":{"line":83,"column":11}}],"line":75},"26":{"loc":{"start":{"line":77,"column":12},"end":{"line":79,"column":13}},"type":"if","locations":[{"start":{"line":77,"column":12},"end":{"line":79,"column":13}},{"start":{"line":77,"column":12},"end":{"line":79,"column":13}}],"line":77},"27":{"loc":{"start":{"line":77,"column":16},"end":{"line":77,"column":192}},"type":"binary-expr","locations":[{"start":{"line":77,"column":16},"end":{"line":77,"column":31}},{"start":{"line":77,"column":35},"end":{"line":77,"column":76}},{"start":{"line":77,"column":80},"end":{"line":77,"column":158}},{"start":{"line":77,"column":162},"end":{"line":77,"column":192}}],"line":77},"28":{"loc":{"start":{"line":77,"column":83},"end":{"line":77,"column":157}},"type":"cond-expr","locations":[{"start":{"line":77,"column":135},"end":{"line":77,"column":141}},{"start":{"line":77,"column":144},"end":{"line":77,"column":157}}],"line":77},"29":{"loc":{"start":{"line":77,"column":83},"end":{"line":77,"column":132}},"type":"binary-expr","locations":[{"start":{"line":77,"column":83},"end":{"line":77,"column":110}},{"start":{"line":77,"column":114},"end":{"line":77,"column":132}}],"line":77},"30":{"loc":{"start":{"line":80,"column":12},"end":{"line":82,"column":13}},"type":"if","locations":[{"start":{"line":80,"column":12},"end":{"line":82,"column":13}},{"start":{"line":80,"column":12},"end":{"line":82,"column":13}}],"line":80},"31":{"loc":{"start":{"line":80,"column":16},"end":{"line":80,"column":74}},"type":"binary-expr","locations":[{"start":{"line":80,"column":16},"end":{"line":80,"column":27}},{"start":{"line":80,"column":31},"end":{"line":80,"column":74}}],"line":80},"32":{"loc":{"start":{"line":84,"column":27},"end":{"line":84,"column":143}},"type":"cond-expr","locations":[{"start":{"line":84,"column":92},"end":{"line":84,"column":98}},{"start":{"line":84,"column":101},"end":{"line":84,"column":143}}],"line":84},"33":{"loc":{"start":{"line":84,"column":27},"end":{"line":84,"column":89}},"type":"binary-expr","locations":[{"start":{"line":84,"column":27},"end":{"line":84,"column":55}},{"start":{"line":84,"column":59},"end":{"line":84,"column":89}}],"line":84},"34":{"loc":{"start":{"line":88,"column":12},"end":{"line":90,"column":13}},"type":"if","locations":[{"start":{"line":88,"column":12},"end":{"line":90,"column":13}},{"start":{"line":88,"column":12},"end":{"line":90,"column":13}}],"line":88},"35":{"loc":{"start":{"line":91,"column":62},"end":{"line":91,"column":111}},"type":"cond-expr","locations":[{"start":{"line":91,"column":95},"end":{"line":91,"column":101}},{"start":{"line":91,"column":104},"end":{"line":91,"column":111}}],"line":91},"36":{"loc":{"start":{"line":91,"column":62},"end":{"line":91,"column":92}},"type":"binary-expr","locations":[{"start":{"line":91,"column":62},"end":{"line":91,"column":74}},{"start":{"line":91,"column":78},"end":{"line":91,"column":92}}],"line":91},"37":{"loc":{"start":{"line":92,"column":12},"end":{"line":94,"column":13}},"type":"if","locations":[{"start":{"line":92,"column":12},"end":{"line":94,"column":13}},{"start":{"line":92,"column":12},"end":{"line":94,"column":13}}],"line":92},"38":{"loc":{"start":{"line":96,"column":12},"end":{"line":98,"column":13}},"type":"if","locations":[{"start":{"line":96,"column":12},"end":{"line":98,"column":13}},{"start":{"line":96,"column":12},"end":{"line":98,"column":13}}],"line":96},"39":{"loc":{"start":{"line":99,"column":12},"end":{"line":101,"column":13}},"type":"if","locations":[{"start":{"line":99,"column":12},"end":{"line":101,"column":13}},{"start":{"line":99,"column":12},"end":{"line":101,"column":13}}],"line":99},"40":{"loc":{"start":{"line":99,"column":18},"end":{"line":99,"column":176}},"type":"cond-expr","locations":[{"start":{"line":99,"column":65},"end":{"line":99,"column":71}},{"start":{"line":99,"column":74},"end":{"line":99,"column":176}}],"line":99},"41":{"loc":{"start":{"line":99,"column":18},"end":{"line":99,"column":62}},"type":"binary-expr","locations":[{"start":{"line":99,"column":18},"end":{"line":99,"column":37}},{"start":{"line":99,"column":41},"end":{"line":99,"column":62}}],"line":99},"42":{"loc":{"start":{"line":99,"column":99},"end":{"line":99,"column":151}},"type":"cond-expr","locations":[{"start":{"line":99,"column":134},"end":{"line":99,"column":140}},{"start":{"line":99,"column":143},"end":{"line":99,"column":151}}],"line":99},"43":{"loc":{"start":{"line":99,"column":99},"end":{"line":99,"column":131}},"type":"binary-expr","locations":[{"start":{"line":99,"column":99},"end":{"line":99,"column":112}},{"start":{"line":99,"column":116},"end":{"line":99,"column":131}}],"line":99},"44":{"loc":{"start":{"line":105,"column":8},"end":{"line":111,"column":9}},"type":"if","locations":[{"start":{"line":105,"column":8},"end":{"line":111,"column":9}},{"start":{"line":105,"column":8},"end":{"line":111,"column":9}}],"line":105},"45":{"loc":{"start":{"line":106,"column":39},"end":{"line":106,"column":64}},"type":"binary-expr","locations":[{"start":{"line":106,"column":39},"end":{"line":106,"column":58}},{"start":{"line":106,"column":62},"end":{"line":106,"column":64}}],"line":106}},"s":{"0":1,"1":1,"2":16,"3":1,"4":1,"5":1,"6":1,"7":2,"8":1,"9":2,"10":2,"11":1,"12":1,"13":1,"14":2,"15":1,"16":13,"17":11,"18":2,"19":1,"20":2,"21":1,"22":2,"23":1,"24":16,"25":13,"26":3,"27":3,"28":1,"29":16,"30":16,"31":3,"32":13,"33":14,"34":13,"35":13,"36":1,"37":12,"38":12,"39":1,"40":11,"41":13,"42":11,"43":13,"44":13,"45":13,"46":13,"47":13,"48":12,"49":1,"50":11,"51":9,"52":13,"53":12,"54":13,"55":13,"56":13,"57":14,"58":1,"59":13,"60":12,"61":13,"62":2,"63":11,"64":11,"65":11,"66":3,"67":8,"68":7,"69":1,"70":7,"71":7,"72":13,"73":6,"74":6,"75":13,"76":16,"77":16,"78":16,"79":16},"f":{"0":16,"1":2,"2":2,"3":1,"4":13,"5":1,"6":16,"7":3,"8":16,"9":14,"10":13,"11":11,"12":13,"13":13,"14":12,"15":12,"16":12,"17":11,"18":7,"19":16},"b":{"0":[0,2],"1":[2,2],"2":[0],"3":[2,0],"4":[2,2],"5":[1,1],"6":[0,1],"7":[1,1],"8":[11,2],"9":[0,13],"10":[13,13],"11":[1,1],"12":[2,2,1],"13":[1,1],"14":[2,2],"15":[13,3],"16":[3,13],"17":[0,16],"18":[16,16],"19":[1,15],"20":[16,16],"21":[1,12],"22":[1,11],"23":[0,11],"24":[11,11],"25":[13,13],"26":[1,11],"27":[12,2,2,1],"28":[1,1],"29":[2,2],"30":[9,2],"31":[11,11],"32":[0,13],"33":[13,13],"34":[1,13],"35":[0,12],"36":[12,12],"37":[2,11],"38":[3,8],"39":[1,7],"40":[0,8],"41":[8,8],"42":[0,7],"43":[7,7],"44":[6,7],"45":[6,5]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveJumpToMessage.ts"],"sourcesContent":["import QueryString from 'querystring';\nimport URL from 'url';\n\nimport type { MessageAttachment, IMessage, IUser, IOmnichannelRoom, IRoom } from '@rocket.chat/core-typings';\nimport { isOmnichannelRoom, isQuoteAttachment } from '@rocket.chat/core-typings';\n\nimport { createQuoteAttachment } from '../../../../lib/createQuoteAttachment';\n\nconst recursiveRemoveAttachments = (attachments: MessageAttachment, deep = 1, quoteChainLimit: number): MessageAttachment => {\n\tif (attachments && isQuoteAttachment(attachments)) {\n\t\tif (deep < quoteChainLimit - 1) {\n\t\t\tattachments.attachments?.map((msg) => recursiveRemoveAttachments(msg, deep + 1, quoteChainLimit));\n\t\t} else {\n\t\t\tdelete attachments.attachments;\n\t\t}\n\t}\n\n\treturn attachments;\n};\n\nconst validateAttachmentDeepness = (message: IMessage, quoteChainLimit: number): IMessage => {\n\tif (!message?.attachments) {\n\t\treturn message;\n\t}\n\n\tif ((message.attachments && quoteChainLimit < 2) || isNaN(quoteChainLimit)) {\n\t\tdelete message.attachments;\n\t}\n\n\tmessage.attachments = message.attachments?.map((attachment) => recursiveRemoveAttachments(attachment, 1, quoteChainLimit));\n\n\treturn message;\n};\n\nconst removeQuoteAttachments = (message: IMessage) => {\n\tif (!message.attachments) {\n\t\treturn;\n\t}\n\tmessage.attachments = message.attachments.filter((attachment) => !isQuoteAttachment(attachment));\n};\n\ntype JumpToMessageInit = {\n\tgetMessages(messageIds: IMessage['_id'][]): Promise<IMessage[]>;\n\tgetRooms(roomIds: IRoom['_id'][]): Promise<IRoom[] | IOmnichannelRoom[] | null>;\n\tcanAccessRoom(room: IRoom, user: Pick<IUser, '_id' | 'username' | 'name' | 'language'>): Promise<boolean>;\n\tgetUserAvatarURL(user?: string): string;\n};\n\n/**\n * Transform URLs in messages into quote attachments\n */\nexport class BeforeSaveJumpToMessage {\n\tprivate getMessages: JumpToMessageInit['getMessages'];\n\n\tprivate getRooms: JumpToMessageInit['getRooms'];\n\n\tprivate canAccessRoom: JumpToMessageInit['canAccessRoom'];\n\n\tprivate getUserAvatarURL: JumpToMessageInit['getUserAvatarURL'];\n\n\tconstructor(options: JumpToMessageInit) {\n\t\tthis.getMessages = options.getMessages;\n\t\tthis.getRooms = options.getRooms;\n\t\tthis.canAccessRoom = options.canAccessRoom;\n\t\tthis.getUserAvatarURL = options.getUserAvatarURL;\n\t}\n\n\tasync createAttachmentForMessageURLs({\n\t\tmessage,\n\t\tuser: currentUser,\n\t\tconfig,\n\t}: {\n\t\tmessage: IMessage;\n\t\tuser: Pick<IUser, '_id' | 'username' | 'name' | 'language'>;\n\t\tconfig: {\n\t\t\tchainLimit: number;\n\t\t\tsiteUrl: string;\n\t\t\tuseRealName: boolean;\n\t\t};\n\t}): Promise<IMessage> {\n\t\t// Quote attachments are always rebuilt. Do not keep old ones since they may not still be linked to the message\n\t\tremoveQuoteAttachments(message);\n\n\t\t// if no message is present, or the message doesn't have any URL, skip\n\t\tif (!message?.urls?.length) {\n\t\t\treturn message;\n\t\t}\n\n\t\tconst linkedMessages = message.urls\n\t\t\t.filter((item) => item.url.includes(config.siteUrl))\n\t\t\t.map((item) => {\n\t\t\t\tconst urlObj = URL.parse(item.url);\n\n\t\t\t\t// if the URL doesn't have query params (doesn't reference message) skip\n\t\t\t\tif (!urlObj.query) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst { msg: msgId } = QueryString.parse(urlObj.query);\n\n\t\t\t\tif (typeof msgId !== 'string') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\treturn { msgId, url: item.url };\n\t\t\t})\n\t\t\t.filter(Boolean);\n\n\t\tconst msgs = await this.getMessages(linkedMessages.map((linkedMsg) => linkedMsg?.msgId) as string[]);\n\n\t\tconst validMessages = msgs.filter((msg) => validateAttachmentDeepness(msg, config.chainLimit));\n\n\t\tconst rooms = await this.getRooms(validMessages.map((msg) => msg.rid));\n\n\t\tconst roomsWithPermission =\n\t\t\trooms &&\n\t\t\t(await Promise.all(\n\t\t\t\trooms.map(async (room) => {\n\t\t\t\t\tif (!!message.token && isOmnichannelRoom(room) && !!room.v?.token && message.token === room.v.token) {\n\t\t\t\t\t\treturn room;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (currentUser && (await this.canAccessRoom(room, currentUser))) {\n\t\t\t\t\t\treturn room;\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t));\n\n\t\tconst validRooms = roomsWithPermission?.filter((room) => !!room);\n\n\t\tconst { useRealName } = config;\n\n\t\tconst quotes = [];\n\n\t\tfor (const item of message.urls) {\n\t\t\tif (!item.url.includes(config.siteUrl)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst linkedMessage = linkedMessages.find((msg) => msg?.url === item.url);\n\t\t\tif (!linkedMessage) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst messageFromUrl = validMessages.find((msg) => msg._id === linkedMessage.msgId);\n\t\t\tif (!messageFromUrl) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!validRooms?.find((room) => room?._id === messageFromUrl.rid)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\titem.ignoreParse = true;\n\n\t\t\tquotes.push(createQuoteAttachment(messageFromUrl, item.url, useRealName, this.getUserAvatarURL(messageFromUrl.u.username)));\n\t\t}\n\n\t\tif (quotes.length > 0) {\n\t\t\tconst currentAttachments = message.attachments || [];\n\t\t\tmessage.attachments = [...currentAttachments, ...quotes];\n\t\t}\n\n\t\treturn message;\n\t}\n}\n"],"names":["BeforeSaveJumpToMessage","recursiveRemoveAttachments","attachments","deep","quoteChainLimit","isQuoteAttachment","map","msg","validateAttachmentDeepness","message","isNaN","attachment","removeQuoteAttachments","filter","createAttachmentForMessageURLs","user","currentUser","config","urls","length","linkedMessages","item","url","includes","siteUrl","urlObj","URL","parse","query","msgId","QueryString","Boolean","msgs","getMessages","linkedMsg","validMessages","chainLimit","rooms","getRooms","rid","roomsWithPermission","Promise","all","room","token","isOmnichannelRoom","v","canAccessRoom","validRooms","useRealName","quotes","linkedMessage","find","messageFromUrl","_id","ignoreParse","push","createQuoteAttachment","getUserAvatarURL","u","username","currentAttachments","constructor","options"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveJumpToMessage.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f3e076fb30f8979dc2b527ac870818a7b3a16a42","contentHash":"9fd5fca593f014de61437908180958a565bad37750e54ec1c441f1839e4a534b"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/createQuoteAttachment.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/createQuoteAttachment.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":37}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":28},"end":{"line":12,"column":59}},"5":{"start":{"line":14,"column":4},"end":{"line":25,"column":6}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"createQuoteAttachment","decl":{"start":{"line":13,"column":9},"end":{"line":13,"column":30}},"loc":{"start":{"line":13,"column":81},"end":{"line":26,"column":1}},"line":13}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":11},"end":{"line":19,"column":9}},"type":"binary-expr","locations":[{"start":{"line":17,"column":11},"end":{"line":17,"column":57}},{"start":{"line":17,"column":61},"end":{"line":19,"column":9}}],"line":17},"1":{"loc":{"start":{"line":18,"column":26},"end":{"line":18,"column":96}},"type":"cond-expr","locations":[{"start":{"line":18,"column":67},"end":{"line":18,"column":73}},{"start":{"line":18,"column":76},"end":{"line":18,"column":96}}],"line":18},"2":{"loc":{"start":{"line":18,"column":26},"end":{"line":18,"column":64}},"type":"binary-expr","locations":[{"start":{"line":18,"column":26},"end":{"line":18,"column":42}},{"start":{"line":18,"column":46},"end":{"line":18,"column":64}}],"line":18},"3":{"loc":{"start":{"line":21,"column":21},"end":{"line":21,"column":130}},"type":"binary-expr","locations":[{"start":{"line":21,"column":21},"end":{"line":21,"column":34}},{"start":{"line":21,"column":38},"end":{"line":21,"column":130}}],"line":21},"4":{"loc":{"start":{"line":23,"column":21},"end":{"line":23,"column":46}},"type":"binary-expr","locations":[{"start":{"line":23,"column":21},"end":{"line":23,"column":40}},{"start":{"line":23,"column":44},"end":{"line":23,"column":46}}],"line":23}},"s":{"0":1,"1":1,"2":7,"3":1,"4":1,"5":7},"f":{"0":7,"1":7},"b":{"0":[7,0],"1":[0,0],"2":[0,0],"3":[7,7],"4":[7,6]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/createQuoteAttachment.ts"],"sourcesContent":["import { isTranslatedMessage } from '@rocket.chat/core-typings';\nimport type { ITranslatedMessage, IMessage } from '@rocket.chat/core-typings';\n\nimport { getUserDisplayName } from './getUserDisplayName';\n\nexport function createQuoteAttachment(\n\tmessage: IMessage | ITranslatedMessage,\n\tmessageLink: string,\n\tuseRealName: boolean,\n\tuserAvatarUrl: string,\n) {\n\treturn {\n\t\ttext: message.msg,\n\t\tmd: message.md,\n\t\t...(isTranslatedMessage(message) && { translations: message?.translations }),\n\t\tmessage_link: messageLink,\n\t\tauthor_name: message.alias || getUserDisplayName(message.u.name, message.u.username, useRealName),\n\t\tauthor_icon: userAvatarUrl,\n\t\tattachments: message.attachments || [],\n\t\tts: message.ts,\n\t};\n}\n"],"names":["createQuoteAttachment","message","messageLink","useRealName","userAvatarUrl","text","msg","md","isTranslatedMessage","translations","message_link","author_name","alias","getUserDisplayName","u","name","username","author_icon","attachments","ts"],"mappings":";;;;+BAKgBA;;;eAAAA;;;6BALoB;oCAGD;AAE5B,SAASA,sBACfC,OAAsC,EACtCC,WAAmB,EACnBC,WAAoB,EACpBC,aAAqB;IAErB,OAAO;QACNC,MAAMJ,QAAQK,GAAG;QACjBC,IAAIN,QAAQM,EAAE;QACd,GAAIC,IAAAA,gCAAmB,EAACP,YAAY;YAAEQ,YAAY,EAAER,oBAAAA,8BAAAA,QAASQ,YAAY;QAAC,CAAC;QAC3EC,cAAcR;QACdS,aAAaV,QAAQW,KAAK,IAAIC,IAAAA,sCAAkB,EAACZ,QAAQa,CAAC,CAACC,IAAI,EAAEd,QAAQa,CAAC,CAACE,QAAQ,EAAEb;QACrFc,aAAab;QACbc,aAAajB,QAAQiB,WAAW,IAAI,EAAE;QACtCC,IAAIlB,QAAQkB,EAAE;IACf;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/createQuoteAttachment.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"4ddce94c6f3bc73a00c70e4118224e099d1c21ea","contentHash":"57e5766dc31b9fafedca47e8a55969bb6b636b36b222a380fcbca2b91b88b513"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/getUserDisplayName.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/getUserDisplayName.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":34}},"3":{"start":{"line":11,"column":27},"end":{"line":11,"column":99}},"4":{"start":{"line":11,"column":58},"end":{"line":11,"column":99}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":27},"end":{"line":11,"column":28}},"loc":{"start":{"line":11,"column":58},"end":{"line":11,"column":99}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":11,"column":58},"end":{"line":11,"column":99}},"type":"cond-expr","locations":[{"start":{"line":11,"column":72},"end":{"line":11,"column":88}},{"start":{"line":11,"column":91},"end":{"line":11,"column":99}}],"line":11},"1":{"loc":{"start":{"line":11,"column":72},"end":{"line":11,"column":88}},"type":"binary-expr","locations":[{"start":{"line":11,"column":72},"end":{"line":11,"column":76}},{"start":{"line":11,"column":80},"end":{"line":11,"column":88}}],"line":11}},"s":{"0":1,"1":1,"2":7,"3":1,"4":7},"f":{"0":7,"1":7},"b":{"0":[7,0],"1":[7,7]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/getUserDisplayName.ts"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\n\nexport const getUserDisplayName = (name: IUser['name'], username: IUser['username'], useRealName: boolean): string | undefined =>\n\tuseRealName ? name || username : username;\n"],"names":["getUserDisplayName","name","username","useRealName"],"mappings":";;;;+BAEaA;;;eAAAA;;;AAAN,MAAMA,qBAAqB,CAACC,MAAqBC,UAA6BC,cACpFA,cAAcF,QAAQC,WAAWA","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/getUserDisplayName.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a32de8817b2dc3ab6408bd3f71f5db9a05b35698","contentHash":"3ea437717237794ce958da48d6de8a3e99aa7718ca72367209c8bddcc3c9ccef"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveMarkdownParser.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveMarkdownParser.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":40}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":23},"end":{"line":12,"column":61}},"5":{"start":{"line":13,"column":31},"end":{"line":38,"column":1}},"6":{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},"7":{"start":{"line":16,"column":12},"end":{"line":16,"column":27}},"8":{"start":{"line":18,"column":8},"end":{"line":20,"column":9}},"9":{"start":{"line":19,"column":12},"end":{"line":19,"column":27}},"10":{"start":{"line":21,"column":8},"end":{"line":31,"column":9}},"11":{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},"12":{"start":{"line":24,"column":16},"end":{"line":24,"column":76}},"13":{"start":{"line":26,"column":12},"end":{"line":28,"column":13}},"14":{"start":{"line":27,"column":16},"end":{"line":27,"column":125}},"15":{"start":{"line":30,"column":12},"end":{"line":30,"column":29}},"16":{"start":{"line":32,"column":8},"end":{"line":32,"column":23}},"17":{"start":{"line":35,"column":8},"end":{"line":35,"column":31}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":45},"end":{"line":33,"column":5}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":34,"column":4},"end":{"line":34,"column":5}},"loc":{"start":{"line":34,"column":31},"end":{"line":37,"column":5}},"line":34}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},"type":"if","locations":[{"start":{"line":15,"column":8},"end":{"line":17,"column":9}},{"start":{"line":15,"column":8},"end":{"line":17,"column":9}}],"line":15},"1":{"loc":{"start":{"line":18,"column":8},"end":{"line":20,"column":9}},"type":"if","locations":[{"start":{"line":18,"column":8},"end":{"line":20,"column":9}},{"start":{"line":18,"column":8},"end":{"line":20,"column":9}}],"line":18},"2":{"loc":{"start":{"line":18,"column":12},"end":{"line":18,"column":141}},"type":"binary-expr","locations":[{"start":{"line":18,"column":12},"end":{"line":18,"column":52}},{"start":{"line":18,"column":56},"end":{"line":18,"column":95}},{"start":{"line":18,"column":99},"end":{"line":18,"column":141}}],"line":18},"3":{"loc":{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},"type":"if","locations":[{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},{"start":{"line":23,"column":12},"end":{"line":25,"column":13}}],"line":23},"4":{"loc":{"start":{"line":26,"column":12},"end":{"line":28,"column":13}},"type":"if","locations":[{"start":{"line":26,"column":12},"end":{"line":28,"column":13}},{"start":{"line":26,"column":12},"end":{"line":28,"column":13}}],"line":26},"5":{"loc":{"start":{"line":26,"column":16},"end":{"line":26,"column":255}},"type":"cond-expr","locations":[{"start":{"line":26,"column":107},"end":{"line":26,"column":113}},{"start":{"line":26,"column":116},"end":{"line":26,"column":255}}],"line":26},"6":{"loc":{"start":{"line":26,"column":16},"end":{"line":26,"column":104}},"type":"binary-expr","locations":[{"start":{"line":26,"column":16},"end":{"line":26,"column":69}},{"start":{"line":26,"column":73},"end":{"line":26,"column":104}}],"line":26},"7":{"loc":{"start":{"line":26,"column":116},"end":{"line":26,"column":255}},"type":"cond-expr","locations":[{"start":{"line":26,"column":213},"end":{"line":26,"column":219}},{"start":{"line":26,"column":222},"end":{"line":26,"column":255}}],"line":26},"8":{"loc":{"start":{"line":26,"column":116},"end":{"line":26,"column":210}},"type":"binary-expr","locations":[{"start":{"line":26,"column":116},"end":{"line":26,"column":174}},{"start":{"line":26,"column":178},"end":{"line":26,"column":210}}],"line":26},"9":{"loc":{"start":{"line":34,"column":16},"end":{"line":34,"column":30}},"type":"default-arg","locations":[{"start":{"line":34,"column":26},"end":{"line":34,"column":30}}],"line":34}},"s":{"0":1,"1":1,"2":5,"3":1,"4":1,"5":1,"6":6,"7":1,"8":5,"9":3,"10":2,"11":2,"12":2,"13":2,"14":1,"15":0,"16":2,"17":5},"f":{"0":5,"1":6,"2":5},"b":{"0":[1,5],"1":[3,2],"2":[5,4,3],"3":[2,0],"4":[1,1],"5":[1,1],"6":[2,2],"7":[0,1],"8":[1,1],"9":[0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveMarkdownParser.ts"],"sourcesContent":["import { isE2EEMessage, isOTRMessage, isOTRAckMessage } from '@rocket.chat/core-typings';\nimport type { IMessage } from '@rocket.chat/core-typings';\nimport { parse } from '@rocket.chat/message-parser';\n\ntype ParserConfig = {\n\tcolors?: boolean;\n\temoticons?: boolean;\n\tcustomDomains?: string[];\n\tkatex?: {\n\t\tdollarSyntax: boolean;\n\t\tparenthesisSyntax: boolean;\n\t};\n};\n\nexport class BeforeSaveMarkdownParser {\n\tconstructor(private enabled: boolean = true) {\n\t\t// no op\n\t}\n\n\tasync parseMarkdown({ message, config }: { message: IMessage; config: ParserConfig }): Promise<IMessage> {\n\t\tif (!this.enabled) {\n\t\t\treturn message;\n\t\t}\n\n\t\tif (isE2EEMessage(message) || isOTRMessage(message) || isOTRAckMessage(message)) {\n\t\t\treturn message;\n\t\t}\n\n\t\ttry {\n\t\t\tif (message.msg) {\n\t\t\t\tmessage.md = parse(message.msg, config);\n\t\t\t}\n\n\t\t\tif (message.attachments?.[0]?.description) {\n\t\t\t\tmessage.attachments[0].descriptionMd = parse(message.attachments[0].description, config);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(e); // errors logged while the parser is at experimental stage\n\t\t}\n\n\t\treturn message;\n\t}\n}\n"],"names":["BeforeSaveMarkdownParser","parseMarkdown","message","config","enabled","isE2EEMessage","isOTRMessage","isOTRAckMessage","msg","md","parse","attachments","description","descriptionMd","e","console","error","constructor"],"mappings":";;;;+BAcaA;;;eAAAA;;;6BAdgD;+BAEvC;AAYf,IAAA,AAAMA,2BAAN,MAAMA;IAKZ,MAAMC,cAAc,EAAEC,OAAO,EAAEC,MAAM,EAA+C,EAAqB;QACxG,IAAI,CAAC,IAAI,CAACC,OAAO,EAAE;YAClB,OAAOF;QACR;QAEA,IAAIG,IAAAA,0BAAa,EAACH,YAAYI,IAAAA,yBAAY,EAACJ,YAAYK,IAAAA,4BAAe,EAACL,UAAU;YAChF,OAAOA;QACR;QAEA,IAAI;gBAKCA,uBAAAA;YAJJ,IAAIA,QAAQM,GAAG,EAAE;gBAChBN,QAAQO,EAAE,GAAGC,IAAAA,oBAAK,EAACR,QAAQM,GAAG,EAAEL;YACjC;YAEA,KAAID,uBAAAA,QAAQS,WAAW,cAAnBT,4CAAAA,wBAAAA,oBAAqB,CAAC,EAAE,cAAxBA,4CAAAA,sBAA0BU,WAAW,EAAE;gBAC1CV,QAAQS,WAAW,CAAC,EAAE,CAACE,aAAa,GAAGH,IAAAA,oBAAK,EAACR,QAAQS,WAAW,CAAC,EAAE,CAACC,WAAW,EAAET;YAClF;QACD,EAAE,OAAOW,GAAG;YACXC,QAAQC,KAAK,CAACF,IAAI,0DAA0D;QAC7E;QAEA,OAAOZ;IACR;IA1BAe,YAAY,AAAQb,UAAmB,IAAI,CAAE;aAAzBA,UAAAA;IACnB,QAAQ;IACT;AAyBD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveMarkdownParser.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b0636af16bede7481bd3504db4c5c0dd38caff90","contentHash":"62bc46d8b91df668736ca95b1492010bbbfaf37f69c506492bcabb8777fa7fca"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSavePreventMention.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSavePreventMention.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":40}},"3":{"start":{"line":11,"column":22},"end":{"line":11,"column":59}},"4":{"start":{"line":12,"column":14},"end":{"line":12,"column":42}},"5":{"start":{"line":13,"column":31},"end":{"line":34,"column":1}},"6":{"start":{"line":16,"column":8},"end":{"line":18,"column":9}},"7":{"start":{"line":16,"column":139},"end":{"line":16,"column":154}},"8":{"start":{"line":17,"column":12},"end":{"line":17,"column":24}},"9":{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},"10":{"start":{"line":21,"column":12},"end":{"line":21,"column":24}},"11":{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},"12":{"start":{"line":24,"column":12},"end":{"line":24,"column":24}},"13":{"start":{"line":26,"column":23},"end":{"line":28,"column":10}},"14":{"start":{"line":30,"column":8},"end":{"line":32,"column":11}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":65},"end":{"line":33,"column":5}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":128},"end":{"line":16,"column":129}},"loc":{"start":{"line":16,"column":139},"end":{"line":16,"column":154}},"line":16}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":8},"end":{"line":18,"column":9}},"type":"if","locations":[{"start":{"line":16,"column":8},"end":{"line":18,"column":9}},{"start":{"line":16,"column":8},"end":{"line":18,"column":9}}],"line":16},"1":{"loc":{"start":{"line":16,"column":14},"end":{"line":16,"column":155}},"type":"cond-expr","locations":[{"start":{"line":16,"column":96},"end":{"line":16,"column":102}},{"start":{"line":16,"column":105},"end":{"line":16,"column":155}}],"line":16},"2":{"loc":{"start":{"line":16,"column":14},"end":{"line":16,"column":93}},"type":"binary-expr","locations":[{"start":{"line":16,"column":14},"end":{"line":16,"column":61}},{"start":{"line":16,"column":65},"end":{"line":16,"column":93}}],"line":16},"3":{"loc":{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},"type":"if","locations":[{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},{"start":{"line":20,"column":8},"end":{"line":22,"column":9}}],"line":20},"4":{"loc":{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},"type":"if","locations":[{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},{"start":{"line":23,"column":8},"end":{"line":25,"column":9}}],"line":23}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":6,"7":5,"8":2,"9":4,"10":2,"11":2,"12":1,"13":1,"14":1},"f":{"0":1,"1":6,"2":5},"b":{"0":[2,4],"1":[1,5],"2":[6,6],"3":[2,2],"4":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSavePreventMention.ts"],"sourcesContent":["import { Authorization, MeteorError } from '@rocket.chat/core-services';\nimport { type IMessage, type IUser } from '@rocket.chat/core-typings';\n\nimport { i18n } from '../../../lib/i18n';\n\nexport class BeforeSavePreventMention {\n\tasync preventMention({\n\t\tmessage,\n\t\tuser,\n\t\tmention,\n\t\tpermission,\n\t}: {\n\t\tmessage: IMessage;\n\t\tuser: Pick<IUser, '_id' | 'username' | 'name' | 'language'>;\n\t\tmention: 'here' | 'all';\n\t\tpermission: string;\n\t}): Promise<boolean> {\n\t\tif (!message.mentions?.some(({ _id }) => _id === mention)) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// Check if the user has permissions to use @all in both global and room scopes.\n\t\tif (await Authorization.hasPermission(message.u._id, permission)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (await Authorization.hasPermission(message.u._id, permission, message.rid)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst action = i18n.t('Notify_all_in_this_room', { lng: user.language });\n\n\t\t// Also throw to stop propagation of 'sendMessage'.\n\t\tthrow new MeteorError('error-action-not-allowed', `Notify ${mention} in this room not allowed`, {\n\t\t\taction,\n\t\t});\n\t}\n}\n"],"names":["BeforeSavePreventMention","preventMention","message","user","mention","permission","mentions","some","_id","Authorization","hasPermission","u","rid","action","i18n","t","lng","language","MeteorError"],"mappings":";;;;+BAKaA;;;eAAAA;;;8BAL8B;sBAGtB;AAEd,IAAA,AAAMA,2BAAN,MAAMA;IACZ,MAAMC,eAAe,EACpBC,OAAO,EACPC,IAAI,EACJC,OAAO,EACPC,UAAU,EAMV,EAAoB;YACfH;QAAL,IAAI,GAACA,oBAAAA,QAAQI,QAAQ,cAAhBJ,wCAAAA,kBAAkBK,IAAI,CAAC,CAAC,EAAEC,GAAG,EAAE,GAAKA,QAAQJ,WAAU;YAC1D,OAAO;QACR;QAEA,gFAAgF;QAChF,IAAI,MAAMK,2BAAa,CAACC,aAAa,CAACR,QAAQS,CAAC,CAACH,GAAG,EAAEH,aAAa;YACjE,OAAO;QACR;QAEA,IAAI,MAAMI,2BAAa,CAACC,aAAa,CAACR,QAAQS,CAAC,CAACH,GAAG,EAAEH,YAAYH,QAAQU,GAAG,GAAG;YAC9E,OAAO;QACR;QAEA,MAAMC,SAASC,UAAI,CAACC,CAAC,CAAC,2BAA2B;YAAEC,KAAKb,KAAKc,QAAQ;QAAC;QAEtE,mDAAmD;QACnD,MAAM,IAAIC,yBAAW,CAAC,4BAA4B,CAAC,OAAO,EAAEd,QAAQ,yBAAyB,CAAC,EAAE;YAC/FS;QACD;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSavePreventMention.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f41ef5c9f2e729adf6f2ca8d4b8a16efb0b0a613","contentHash":"29ff5f5cb1ebe42f3cb0006fc7dca34ec0a325a07045b6216c7c05731e3936c5"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveSpotify.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveSpotify.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":33}},"3":{"start":{"line":11,"column":24},"end":{"line":43,"column":1}},"4":{"start":{"line":14,"column":8},"end":{"line":16,"column":9}},"5":{"start":{"line":15,"column":12},"end":{"line":15,"column":27}},"6":{"start":{"line":17,"column":21},"end":{"line":17,"column":68}},"7":{"start":{"line":18,"column":22},"end":{"line":18,"column":27}},"8":{"start":{"line":19,"column":25},"end":{"line":19,"column":87}},"9":{"start":{"line":20,"column":8},"end":{"line":37,"column":9}},"10":{"start":{"line":20,"column":24},"end":{"line":20,"column":25}},"11":{"start":{"line":21,"column":25},"end":{"line":21,"column":40}},"12":{"start":{"line":22,"column":12},"end":{"line":36,"column":13}},"13":{"start":{"line":23,"column":27},"end":{"line":23,"column":99}},"14":{"start":{"line":25,"column":16},"end":{"line":35,"column":17}},"15":{"start":{"line":26,"column":33},"end":{"line":26,"column":63}},"16":{"start":{"line":27,"column":33},"end":{"line":27,"column":78}},"17":{"start":{"line":27,"column":51},"end":{"line":27,"column":67}},"18":{"start":{"line":28,"column":32},"end":{"line":28,"column":66}},"19":{"start":{"line":29,"column":20},"end":{"line":33,"column":23}},"20":{"start":{"line":34,"column":20},"end":{"line":34,"column":35}},"21":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"22":{"start":{"line":39,"column":12},"end":{"line":39,"column":32}},"23":{"start":{"line":41,"column":8},"end":{"line":41,"column":23}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":4},"end":{"line":12,"column":5}},"loc":{"start":{"line":12,"column":43},"end":{"line":42,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":27,"column":42},"end":{"line":27,"column":43}},"loc":{"start":{"line":27,"column":51},"end":{"line":27,"column":67}},"line":27}},"branchMap":{"0":{"loc":{"start":{"line":14,"column":8},"end":{"line":16,"column":9}},"type":"if","locations":[{"start":{"line":14,"column":8},"end":{"line":16,"column":9}},{"start":{"line":14,"column":8},"end":{"line":16,"column":9}}],"line":14},"1":{"loc":{"start":{"line":14,"column":14},"end":{"line":14,"column":109}},"type":"cond-expr","locations":[{"start":{"line":14,"column":81},"end":{"line":14,"column":87}},{"start":{"line":14,"column":90},"end":{"line":14,"column":109}}],"line":14},"2":{"loc":{"start":{"line":14,"column":14},"end":{"line":14,"column":78}},"type":"binary-expr","locations":[{"start":{"line":14,"column":14},"end":{"line":14,"column":51}},{"start":{"line":14,"column":55},"end":{"line":14,"column":78}}],"line":14},"3":{"loc":{"start":{"line":17,"column":21},"end":{"line":17,"column":68}},"type":"cond-expr","locations":[{"start":{"line":17,"column":51},"end":{"line":17,"column":63}},{"start":{"line":17,"column":66},"end":{"line":17,"column":68}}],"line":17},"4":{"loc":{"start":{"line":22,"column":12},"end":{"line":36,"column":13}},"type":"if","locations":[{"start":{"line":22,"column":12},"end":{"line":36,"column":13}},{"start":{"line":22,"column":12},"end":{"line":36,"column":13}}],"line":22},"5":{"loc":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"type":"if","locations":[{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},{"start":{"line":38,"column":8},"end":{"line":40,"column":9}}],"line":38}},"s":{"0":1,"1":1,"2":6,"3":1,"4":6,"5":1,"6":5,"7":5,"8":5,"9":5,"10":5,"11":11,"12":11,"13":9,"14":9,"15":2,"16":2,"17":4,"18":2,"19":2,"20":2,"21":5,"22":2,"23":5},"f":{"0":6,"1":6,"2":4},"b":{"0":[1,5],"1":[1,5],"2":[6,6],"3":[1,4],"4":[9,2],"5":[2,3]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveSpotify.ts"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\n\n// look for spotify syntax (e.g.: spotify:track:1q6IK1l4qpYykOaWaLJkWG) on the message and add them to the urls array\nexport class BeforeSaveSpotify {\n\tasync convertSpotifyLinks({ message }: { message: IMessage }): Promise<IMessage> {\n\t\tif (!message.msg?.trim()) {\n\t\t\treturn message;\n\t\t}\n\n\t\tconst urls = Array.isArray(message.urls) ? message.urls : [];\n\n\t\tlet changed = false;\n\n\t\tconst msgParts = message.msg.split(/(```\\w*[\\n ]?[\\s\\S]*?```+?)|(`(?:[^`]+)`)/);\n\t\tfor (let index = 0; index < msgParts.length; index++) {\n\t\t\tconst part = msgParts[index];\n\n\t\t\tif (!/(?:```(\\w*)[\\n ]?([\\s\\S]*?)```+?)|(?:`(?:[^`]+)`)/.test(part)) {\n\t\t\t\tconst re = /(?:^|\\s)spotify:([^:\\s]+):([^:\\s]+)(?::([^:\\s]+))?(?::(\\S+))?(?:\\s|$)/g;\n\n\t\t\t\tlet match;\n\t\t\t\twhile ((match = re.exec(part)) != null) {\n\t\t\t\t\tconst data = match.slice(1).filter(Boolean);\n\t\t\t\t\tconst path = data.map((value) => encodeURI(value)).join('/');\n\t\t\t\t\tconst url = `https://open.spotify.com/${path}`;\n\t\t\t\t\turls.push({ url, source: `spotify:${data.join(':')}`, meta: {} });\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (changed) {\n\t\t\tmessage.urls = urls;\n\t\t}\n\n\t\treturn message;\n\t}\n}\n"],"names":["BeforeSaveSpotify","convertSpotifyLinks","message","msg","trim","urls","Array","isArray","changed","msgParts","split","index","length","part","test","re","match","exec","data","slice","filter","Boolean","path","map","value","encodeURI","join","url","push","source","meta"],"mappings":";;;;+BAGaA;;;eAAAA;;;AAAN,IAAA,AAAMA,oBAAN,MAAMA;IACZ,MAAMC,oBAAoB,EAAEC,OAAO,EAAyB,EAAqB;YAC3EA;QAAL,IAAI,GAACA,eAAAA,QAAQC,GAAG,cAAXD,mCAAAA,aAAaE,IAAI,KAAI;YACzB,OAAOF;QACR;QAEA,MAAMG,OAAOC,MAAMC,OAAO,CAACL,QAAQG,IAAI,IAAIH,QAAQG,IAAI,GAAG,EAAE;QAE5D,IAAIG,UAAU;QAEd,MAAMC,WAAWP,QAAQC,GAAG,CAACO,KAAK,CAAC;QACnC,IAAK,IAAIC,QAAQ,GAAGA,QAAQF,SAASG,MAAM,EAAED,QAAS;YACrD,MAAME,OAAOJ,QAAQ,CAACE,MAAM;YAE5B,IAAI,CAAC,oDAAoDG,IAAI,CAACD,OAAO;gBACpE,MAAME,KAAK;gBAEX,IAAIC;gBACJ,MAAO,AAACA,CAAAA,QAAQD,GAAGE,IAAI,CAACJ,KAAI,KAAM,KAAM;oBACvC,MAAMK,OAAOF,MAAMG,KAAK,CAAC,GAAGC,MAAM,CAACC;oBACnC,MAAMC,OAAOJ,KAAKK,GAAG,CAAC,CAACC,QAAUC,UAAUD,QAAQE,IAAI,CAAC;oBACxD,MAAMC,MAAM,CAAC,yBAAyB,EAAEL,MAAM;oBAC9CjB,KAAKuB,IAAI,CAAC;wBAAED;wBAAKE,QAAQ,CAAC,QAAQ,EAAEX,KAAKQ,IAAI,CAAC,MAAM;wBAAEI,MAAM,CAAC;oBAAE;oBAC/DtB,UAAU;gBACX;YACD;QACD;QAEA,IAAIA,SAAS;YACZN,QAAQG,IAAI,GAAGA;QAChB;QAEA,OAAOH;IACR;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/messages/hooks/BeforeSaveSpotify.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6a8fbffb4baf5bed951de8d83b49aa5c3c3c8da9","contentHash":"2535bbf6eb87bbfeef81722f74c1579ec7455ba767f0d5023faa282303d7fc9d"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/nps/service.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/nps/service.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":26}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":33}},"4":{"start":{"line":12,"column":22},"end":{"line":12,"column":59}},"5":{"start":{"line":13,"column":21},"end":{"line":13,"column":57}},"6":{"start":{"line":14,"column":16},"end":{"line":14,"column":46}},"7":{"start":{"line":15,"column":16},"end":{"line":15,"column":50}},"8":{"start":{"line":16,"column":22},"end":{"line":16,"column":47}},"9":{"start":{"line":17,"column":24},"end":{"line":17,"column":51}},"10":{"start":{"line":18,"column":17},"end":{"line":172,"column":1}},"11":{"start":{"line":20,"column":27},"end":{"line":20,"column":84}},"12":{"start":{"line":21,"column":8},"end":{"line":23,"column":9}},"13":{"start":{"line":22,"column":12},"end":{"line":22,"column":64}},"14":{"start":{"line":24,"column":20},"end":{"line":28,"column":10}},"15":{"start":{"line":29,"column":8},"end":{"line":35,"column":9}},"16":{"start":{"line":30,"column":12},"end":{"line":32,"column":13}},"17":{"start":{"line":31,"column":16},"end":{"line":31,"column":55}},"18":{"start":{"line":33,"column":12},"end":{"line":33,"column":99}},"19":{"start":{"line":34,"column":12},"end":{"line":34,"column":63}},"20":{"start":{"line":36,"column":56},"end":{"line":36,"column":59}},"21":{"start":{"line":37,"column":8},"end":{"line":51,"column":9}},"22":{"start":{"line":38,"column":12},"end":{"line":44,"column":15}},"23":{"start":{"line":46,"column":12},"end":{"line":49,"column":15}},"24":{"start":{"line":50,"column":12},"end":{"line":50,"column":50}},"25":{"start":{"line":52,"column":8},"end":{"line":52,"column":20}},"26":{"start":{"line":55,"column":27},"end":{"line":55,"column":84}},"27":{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},"28":{"start":{"line":57,"column":12},"end":{"line":57,"column":19}},"29":{"start":{"line":59,"column":27},"end":{"line":59,"column":75}},"30":{"start":{"line":60,"column":20},"end":{"line":60,"column":83}},"31":{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},"32":{"start":{"line":62,"column":12},"end":{"line":62,"column":19}},"33":{"start":{"line":64,"column":22},"end":{"line":64,"column":65}},"34":{"start":{"line":65,"column":28},"end":{"line":65,"column":87}},"35":{"start":{"line":67,"column":8},"end":{"line":79,"column":9}},"36":{"start":{"line":69,"column":30},"end":{"line":69,"column":116}},"37":{"start":{"line":70,"column":12},"end":{"line":73,"column":13}},"38":{"start":{"line":71,"column":16},"end":{"line":71,"column":89}},"39":{"start":{"line":72,"column":16},"end":{"line":72,"column":23}},"40":{"start":{"line":75,"column":12},"end":{"line":75,"column":72}},"41":{"start":{"line":77,"column":12},"end":{"line":77,"column":75}},"42":{"start":{"line":77,"column":27},"end":{"line":77,"column":58}},"43":{"start":{"line":78,"column":12},"end":{"line":78,"column":19}},"44":{"start":{"line":80,"column":22},"end":{"line":80,"column":32}},"45":{"start":{"line":81,"column":24},"end":{"line":99,"column":11}},"46":{"start":{"line":82,"column":30},"end":{"line":97,"column":14}},"47":{"start":{"line":98,"column":12},"end":{"line":98,"column":25}},"48":{"start":{"line":100,"column":22},"end":{"line":100,"column":45}},"49":{"start":{"line":101,"column":8},"end":{"line":115,"column":9}},"50":{"start":{"line":102,"column":28},"end":{"line":102,"column":53}},"51":{"start":{"line":102,"column":49},"end":{"line":102,"column":52}},"52":{"start":{"line":103,"column":36},"end":{"line":108,"column":19}},"53":{"start":{"line":103,"column":88},"end":{"line":108,"column":17}},"54":{"start":{"line":109,"column":28},"end":{"line":112,"column":13}},"55":{"start":{"line":113,"column":12},"end":{"line":113,"column":72}},"56":{"start":{"line":114,"column":12},"end":{"line":114,"column":61}},"57":{"start":{"line":116,"column":26},"end":{"line":116,"column":112}},"58":{"start":{"line":117,"column":8},"end":{"line":121,"column":9}},"59":{"start":{"line":119,"column":12},"end":{"line":119,"column":75}},"60":{"start":{"line":119,"column":27},"end":{"line":119,"column":58}},"61":{"start":{"line":120,"column":12},"end":{"line":120,"column":19}},"62":{"start":{"line":122,"column":8},"end":{"line":122,"column":81}},"63":{"start":{"line":125,"column":27},"end":{"line":125,"column":84}},"64":{"start":{"line":126,"column":8},"end":{"line":128,"column":9}},"65":{"start":{"line":127,"column":12},"end":{"line":127,"column":19}},"66":{"start":{"line":129,"column":8},"end":{"line":131,"column":9}},"67":{"start":{"line":130,"column":12},"end":{"line":130,"column":46}},"68":{"start":{"line":132,"column":20},"end":{"line":138,"column":10}},"69":{"start":{"line":139,"column":8},"end":{"line":141,"column":9}},"70":{"start":{"line":140,"column":12},"end":{"line":140,"column":19}},"71":{"start":{"line":142,"column":8},"end":{"line":144,"column":9}},"72":{"start":{"line":143,"column":12},"end":{"line":143,"column":54}},"73":{"start":{"line":145,"column":22},"end":{"line":145,"column":32}},"74":{"start":{"line":146,"column":8},"end":{"line":148,"column":9}},"75":{"start":{"line":147,"column":12},"end":{"line":147,"column":43}},"76":{"start":{"line":149,"column":8},"end":{"line":151,"column":9}},"77":{"start":{"line":150,"column":12},"end":{"line":150,"column":54}},"78":{"start":{"line":152,"column":27},"end":{"line":152,"column":102}},"79":{"start":{"line":153,"column":23},"end":{"line":161,"column":10}},"80":{"start":{"line":162,"column":8},"end":{"line":164,"column":9}},"81":{"start":{"line":163,"column":12},"end":{"line":163,"column":53}},"82":{"start":{"line":167,"column":8},"end":{"line":167,"column":72}},"83":{"start":{"line":170,"column":8},"end":{"line":170,"column":42}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":19,"column":4},"end":{"line":19,"column":5}},"loc":{"start":{"line":19,"column":22},"end":{"line":53,"column":5}},"line":19},"2":{"name":"(anonymous_2)","decl":{"start":{"line":54,"column":4},"end":{"line":54,"column":5}},"loc":{"start":{"line":54,"column":24},"end":{"line":123,"column":5}},"line":54},"3":{"name":"(anonymous_3)","decl":{"start":{"line":77,"column":23},"end":{"line":77,"column":24}},"loc":{"start":{"line":77,"column":27},"end":{"line":77,"column":58}},"line":77},"4":{"name":"(anonymous_4)","decl":{"start":{"line":81,"column":58},"end":{"line":81,"column":59}},"loc":{"start":{"line":81,"column":72},"end":{"line":99,"column":9}},"line":81},"5":{"name":"(anonymous_5)","decl":{"start":{"line":102,"column":38},"end":{"line":102,"column":39}},"loc":{"start":{"line":102,"column":49},"end":{"line":102,"column":52}},"line":102},"6":{"name":"(anonymous_6)","decl":{"start":{"line":103,"column":46},"end":{"line":103,"column":47}},"loc":{"start":{"line":103,"column":88},"end":{"line":108,"column":17}},"line":103},"7":{"name":"(anonymous_7)","decl":{"start":{"line":119,"column":23},"end":{"line":119,"column":24}},"loc":{"start":{"line":119,"column":27},"end":{"line":119,"column":58}},"line":119},"8":{"name":"(anonymous_8)","decl":{"start":{"line":124,"column":4},"end":{"line":124,"column":5}},"loc":{"start":{"line":124,"column":57},"end":{"line":165,"column":5}},"line":124},"9":{"name":"(anonymous_9)","decl":{"start":{"line":166,"column":4},"end":{"line":166,"column":5}},"loc":{"start":{"line":166,"column":29},"end":{"line":168,"column":5}},"line":166},"10":{"name":"(anonymous_10)","decl":{"start":{"line":169,"column":4},"end":{"line":169,"column":5}},"loc":{"start":{"line":169,"column":24},"end":{"line":171,"column":5}},"line":169}},"branchMap":{"0":{"loc":{"start":{"line":21,"column":8},"end":{"line":23,"column":9}},"type":"if","locations":[{"start":{"line":21,"column":8},"end":{"line":23,"column":9}},{"start":{"line":21,"column":8},"end":{"line":23,"column":9}}],"line":21},"1":{"loc":{"start":{"line":29,"column":8},"end":{"line":35,"column":9}},"type":"if","locations":[{"start":{"line":29,"column":8},"end":{"line":35,"column":9}},{"start":{"line":29,"column":8},"end":{"line":35,"column":9}}],"line":29},"2":{"loc":{"start":{"line":30,"column":12},"end":{"line":32,"column":13}},"type":"if","locations":[{"start":{"line":30,"column":12},"end":{"line":32,"column":13}},{"start":{"line":30,"column":12},"end":{"line":32,"column":13}}],"line":30},"3":{"loc":{"start":{"line":30,"column":16},"end":{"line":30,"column":71}},"type":"binary-expr","locations":[{"start":{"line":30,"column":16},"end":{"line":30,"column":42}},{"start":{"line":30,"column":46},"end":{"line":30,"column":71}}],"line":30},"4":{"loc":{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},"type":"if","locations":[{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},{"start":{"line":56,"column":8},"end":{"line":58,"column":9}}],"line":56},"5":{"loc":{"start":{"line":60,"column":20},"end":{"line":60,"column":83}},"type":"binary-expr","locations":[{"start":{"line":60,"column":20},"end":{"line":60,"column":30}},{"start":{"line":60,"column":34},"end":{"line":60,"column":83}}],"line":60},"6":{"loc":{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},"type":"if","locations":[{"start":{"line":61,"column":8},"end":{"line":63,"column":9}},{"start":{"line":61,"column":8},"end":{"line":63,"column":9}}],"line":61},"7":{"loc":{"start":{"line":67,"column":8},"end":{"line":79,"column":9}},"type":"if","locations":[{"start":{"line":67,"column":8},"end":{"line":79,"column":9}},{"start":{"line":67,"column":8},"end":{"line":79,"column":9}}],"line":67},"8":{"loc":{"start":{"line":70,"column":12},"end":{"line":73,"column":13}},"type":"if","locations":[{"start":{"line":70,"column":12},"end":{"line":73,"column":13}},{"start":{"line":70,"column":12},"end":{"line":73,"column":13}}],"line":70},"9":{"loc":{"start":{"line":101,"column":8},"end":{"line":115,"column":9}},"type":"if","locations":[{"start":{"line":101,"column":8},"end":{"line":115,"column":9}},{"start":{"line":101,"column":8},"end":{"line":115,"column":9}}],"line":101},"10":{"loc":{"start":{"line":117,"column":8},"end":{"line":121,"column":9}},"type":"if","locations":[{"start":{"line":117,"column":8},"end":{"line":121,"column":9}},{"start":{"line":117,"column":8},"end":{"line":121,"column":9}}],"line":117},"11":{"loc":{"start":{"line":126,"column":8},"end":{"line":128,"column":9}},"type":"if","locations":[{"start":{"line":126,"column":8},"end":{"line":128,"column":9}},{"start":{"line":126,"column":8},"end":{"line":128,"column":9}}],"line":126},"12":{"loc":{"start":{"line":129,"column":8},"end":{"line":131,"column":9}},"type":"if","locations":[{"start":{"line":129,"column":8},"end":{"line":131,"column":9}},{"start":{"line":129,"column":8},"end":{"line":131,"column":9}}],"line":129},"13":{"loc":{"start":{"line":129,"column":12},"end":{"line":129,"column":47}},"type":"binary-expr","locations":[{"start":{"line":129,"column":12},"end":{"line":129,"column":18}},{"start":{"line":129,"column":22},"end":{"line":129,"column":47}}],"line":129},"14":{"loc":{"start":{"line":139,"column":8},"end":{"line":141,"column":9}},"type":"if","locations":[{"start":{"line":139,"column":8},"end":{"line":141,"column":9}},{"start":{"line":139,"column":8},"end":{"line":141,"column":9}}],"line":139},"15":{"loc":{"start":{"line":142,"column":8},"end":{"line":144,"column":9}},"type":"if","locations":[{"start":{"line":142,"column":8},"end":{"line":144,"column":9}},{"start":{"line":142,"column":8},"end":{"line":144,"column":9}}],"line":142},"16":{"loc":{"start":{"line":146,"column":8},"end":{"line":148,"column":9}},"type":"if","locations":[{"start":{"line":146,"column":8},"end":{"line":148,"column":9}},{"start":{"line":146,"column":8},"end":{"line":148,"column":9}}],"line":146},"17":{"loc":{"start":{"line":149,"column":8},"end":{"line":151,"column":9}},"type":"if","locations":[{"start":{"line":149,"column":8},"end":{"line":151,"column":9}},{"start":{"line":149,"column":8},"end":{"line":151,"column":9}}],"line":149},"18":{"loc":{"start":{"line":162,"column":8},"end":{"line":164,"column":9}},"type":"if","locations":[{"start":{"line":162,"column":8},"end":{"line":164,"column":9}},{"start":{"line":162,"column":8},"end":{"line":164,"column":9}}],"line":162}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":5,"12":5,"13":1,"14":4,"15":4,"16":3,"17":2,"18":1,"19":1,"20":2,"21":2,"22":2,"23":1,"24":1,"25":1,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":6},"f":{"0":1,"1":5,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":6},"b":{"0":[1,4],"1":[3,1],"2":[2,1],"3":[3,2],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/nps/service.ts"],"sourcesContent":["import { createHash } from 'crypto';\n\nimport type { INPSService, NPSVotePayload, NPSCreatePayload } from '@rocket.chat/core-services';\nimport { ServiceClassInternal, Banner, NPS } from '@rocket.chat/core-services';\nimport type { INpsVote, INps } from '@rocket.chat/core-typings';\nimport { NPSStatus, INpsVoteStatus } from '@rocket.chat/core-typings';\nimport { Nps, NpsVote, Settings } from '@rocket.chat/models';\n\nimport { SystemLogger } from '../../lib/logger/system';\nimport { getBannerForAdmins, notifyAdmins } from './notification';\nimport { sendNpsResults } from './sendNpsResults';\n\nexport class NPSService extends ServiceClassInternal implements INPSService {\n\tprotected name = 'nps';\n\n\tasync create(nps: NPSCreatePayload): Promise<boolean> {\n\t\tconst npsEnabled = await Settings.getValueById('NPS_survey_enabled');\n\t\tif (!npsEnabled) {\n\t\t\tthrow new Error('Server opted-out for NPS surveys');\n\t\t}\n\n\t\tconst any = await Nps.findOne({}, { projection: { _id: 1 } });\n\t\tif (!any) {\n\t\t\tif (nps.expireAt < nps.startAt || nps.expireAt < new Date()) {\n\t\t\t\tthrow new Error('NPS already expired');\n\t\t\t}\n\t\t\tawait Banner.create(getBannerForAdmins(nps.expireAt));\n\n\t\t\tawait notifyAdmins(nps.startAt);\n\t\t}\n\n\t\tconst { npsId, startAt, expireAt, createdBy } = nps;\n\n\t\ttry {\n\t\t\tawait Nps.save({\n\t\t\t\t_id: npsId,\n\t\t\t\tstartAt,\n\t\t\t\texpireAt,\n\t\t\t\tcreatedBy,\n\t\t\t\tstatus: NPSStatus.OPEN,\n\t\t\t});\n\t\t} catch (err) {\n\t\t\tSystemLogger.error({ msg: 'Error creating NPS', err });\n\t\t\tthrow new Error('Error creating NPS');\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tasync sendResults(): Promise<void> {\n\t\tconst npsEnabled = await Settings.getValueById('NPS_survey_enabled');\n\t\tif (!npsEnabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst npsSending = await Nps.getOpenExpiredAlreadySending();\n\n\t\tconst nps = npsSending || (await Nps.getOpenExpiredAndStartSending());\n\t\tif (!nps) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst total = await NpsVote.countByNpsId(nps._id);\n\n\t\tconst votesToSend = await NpsVote.findNotSentByNpsId(nps._id).toArray();\n\n\t\t// if there is nothing to sent, check if something gone wrong\n\t\tif (votesToSend.length === 0) {\n\t\t\t// check if still has votes left to send\n\t\t\tconst totalSent = await NpsVote.countByNpsIdAndStatus(nps._id, INpsVoteStatus.SENT);\n\t\t\tif (totalSent === total) {\n\t\t\t\tawait Nps.updateStatusById(nps._id, NPSStatus.SENT);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// update old votes (sent 5 minutes ago or more) in 'sending' status back to 'new'\n\t\t\tawait NpsVote.updateOldSendingToNewByNpsId(nps._id);\n\n\t\t\t// try again in 5 minutes\n\t\t\tsetTimeout(() => NPS.sendResults(), 5 * 60 * 1000);\n\t\t\treturn;\n\t\t}\n\n\t\tconst today = new Date();\n\n\t\tconst sending = await Promise.all(\n\t\t\tvotesToSend.map(async (vote) => {\n\t\t\t\tconst { value } = await NpsVote.findOneAndUpdate(\n\t\t\t\t\t{\n\t\t\t\t\t\t_id: vote._id,\n\t\t\t\t\t\tstatus: INpsVoteStatus.NEW,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tstatus: INpsVoteStatus.SENDING,\n\t\t\t\t\t\t\tsentAt: today,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tprojection: {\n\t\t\t\t\t\t\tidentifier: 1,\n\t\t\t\t\t\t\troles: 1,\n\t\t\t\t\t\t\tscore: 1,\n\t\t\t\t\t\t\tcomment: 1,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\treturn value;\n\t\t\t}),\n\t\t);\n\n\t\tconst votes = sending.filter(Boolean) as Pick<INpsVote, '_id' | 'identifier' | 'roles' | 'score' | 'comment'>[];\n\t\tif (votes.length > 0) {\n\t\t\tconst voteIds = votes.map(({ _id }) => _id);\n\n\t\t\tconst votesWithoutIds = votes.map(({ identifier, roles, score, comment }) => ({\n\t\t\t\tidentifier,\n\t\t\t\troles,\n\t\t\t\tscore,\n\t\t\t\tcomment,\n\t\t\t}));\n\n\t\t\tconst payload = {\n\t\t\t\ttotal,\n\t\t\t\tvotes: votesWithoutIds,\n\t\t\t};\n\n\t\t\tawait sendNpsResults(nps._id, payload);\n\n\t\t\tawait NpsVote.updateVotesToSent(voteIds);\n\t\t}\n\n\t\tconst totalSent = await NpsVote.countByNpsIdAndStatus(nps._id, INpsVoteStatus.SENT);\n\t\tif (totalSent < total) {\n\t\t\t// send more in five minutes\n\t\t\tsetTimeout(() => NPS.sendResults(), 5 * 60 * 1000);\n\t\t\treturn;\n\t\t}\n\n\t\tawait Nps.updateStatusById(nps._id, NPSStatus.SENT);\n\t}\n\n\tasync vote({ userId, npsId, roles, score, comment }: NPSVotePayload): Promise<void> {\n\t\tconst npsEnabled = await Settings.getValueById('NPS_survey_enabled');\n\t\tif (!npsEnabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!npsId || typeof npsId !== 'string') {\n\t\t\tthrow new Error('Invalid NPS id');\n\t\t}\n\n\t\tconst nps = await Nps.findOneById<Pick<INps, 'status' | 'startAt' | 'expireAt'>>(npsId, {\n\t\t\tprojection: { status: 1, startAt: 1, expireAt: 1 },\n\t\t});\n\t\tif (!nps) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (nps.status !== NPSStatus.OPEN) {\n\t\t\tthrow new Error('NPS not open for votes');\n\t\t}\n\n\t\tconst today = new Date();\n\t\tif (today > nps.expireAt) {\n\t\t\tthrow new Error('NPS expired');\n\t\t}\n\n\t\tif (today < nps.startAt) {\n\t\t\tthrow new Error('NPS survey not started');\n\t\t}\n\n\t\tconst identifier = createHash('sha256').update(`${userId}${npsId}`).digest('hex');\n\n\t\tconst result = await NpsVote.save({\n\t\t\tts: new Date(),\n\t\t\tnpsId,\n\t\t\tidentifier,\n\t\t\troles,\n\t\t\tscore,\n\t\t\tcomment,\n\t\t\tstatus: INpsVoteStatus.NEW,\n\t\t});\n\t\tif (!result) {\n\t\t\tthrow new Error('Error saving NPS vote');\n\t\t}\n\t}\n\n\tasync closeOpenSurveys(): Promise<void> {\n\t\tawait Nps.closeAllByStatus(NPSStatus.OPEN);\n\t}\n}\n"],"names":["NPSService","ServiceClassInternal","create","nps","npsEnabled","Settings","getValueById","Error","any","Nps","findOne","projection","_id","expireAt","startAt","Date","Banner","getBannerForAdmins","notifyAdmins","npsId","createdBy","save","status","NPSStatus","OPEN","err","SystemLogger","error","msg","sendResults","npsSending","getOpenExpiredAlreadySending","getOpenExpiredAndStartSending","total","NpsVote","countByNpsId","votesToSend","findNotSentByNpsId","toArray","length","totalSent","countByNpsIdAndStatus","INpsVoteStatus","SENT","updateStatusById","updateOldSendingToNewByNpsId","setTimeout","NPS","today","sending","Promise","all","map","vote","value","findOneAndUpdate","NEW","$set","SENDING","sentAt","identifier","roles","score","comment","votes","filter","Boolean","voteIds","votesWithoutIds","payload","sendNpsResults","updateVotesToSent","userId","findOneById","createHash","update","digest","result","ts","closeOpenSurveys","closeAllByStatus","name"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/nps/service.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f0f465bce0f14e4af451490c3595ac0eb203c32c","contentHash":"ae4c14245ba555df5ab63d92dce4781fedaa8c7ed2f1fbbaab85ac3a1cab8ff9"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-analytics/AgentData.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-analytics/AgentData.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":33}},"3":{"start":{"line":11,"column":25},"end":{"line":11,"column":70}},"4":{"start":{"line":12,"column":24},"end":{"line":362,"column":1}},"5":{"start":{"line":14,"column":32},"end":{"line":14,"column":44}},"6":{"start":{"line":15,"column":8},"end":{"line":15,"column":72}},"7":{"start":{"line":18,"column":8},"end":{"line":27,"column":11}},"8":{"start":{"line":20,"column":12},"end":{"line":22,"column":13}},"9":{"start":{"line":21,"column":16},"end":{"line":21,"column":36}},"10":{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},"11":{"start":{"line":24,"column":16},"end":{"line":24,"column":36}},"12":{"start":{"line":26,"column":12},"end":{"line":26,"column":21}},"13":{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},"14":{"start":{"line":31,"column":12},"end":{"line":31,"column":25}},"15":{"start":{"line":33,"column":8},"end":{"line":41,"column":27}},"16":{"start":{"line":44,"column":8},"end":{"line":61,"column":9}},"17":{"start":{"line":46,"column":16},"end":{"line":46,"column":57}},"18":{"start":{"line":48,"column":16},"end":{"line":48,"column":55}},"19":{"start":{"line":50,"column":16},"end":{"line":50,"column":52}},"20":{"start":{"line":52,"column":16},"end":{"line":52,"column":61}},"21":{"start":{"line":54,"column":16},"end":{"line":54,"column":62}},"22":{"start":{"line":56,"column":16},"end":{"line":56,"column":55}},"23":{"start":{"line":58,"column":16},"end":{"line":58,"column":55}},"24":{"start":{"line":60,"column":16},"end":{"line":60,"column":50}},"25":{"start":{"line":64,"column":20},"end":{"line":64,"column":21}},"26":{"start":{"line":65,"column":35},"end":{"line":65,"column":44}},"27":{"start":{"line":66,"column":21},"end":{"line":69,"column":9}},"28":{"start":{"line":70,"column":21},"end":{"line":80,"column":9}},"29":{"start":{"line":81,"column":8},"end":{"line":88,"column":11}},"30":{"start":{"line":84,"column":12},"end":{"line":87,"column":13}},"31":{"start":{"line":85,"column":16},"end":{"line":85,"column":78}},"32":{"start":{"line":86,"column":16},"end":{"line":86,"column":24}},"33":{"start":{"line":89,"column":8},"end":{"line":96,"column":11}},"34":{"start":{"line":91,"column":31},"end":{"line":91,"column":63}},"35":{"start":{"line":92,"column":12},"end":{"line":95,"column":15}},"36":{"start":{"line":97,"column":8},"end":{"line":97,"column":42}},"37":{"start":{"line":98,"column":8},"end":{"line":98,"column":20}},"38":{"start":{"line":101,"column":35},"end":{"line":101,"column":44}},"39":{"start":{"line":102,"column":21},"end":{"line":105,"column":9}},"40":{"start":{"line":106,"column":21},"end":{"line":116,"column":9}},"41":{"start":{"line":117,"column":8},"end":{"line":133,"column":11}},"42":{"start":{"line":120,"column":12},"end":{"line":132,"column":13}},"43":{"start":{"line":121,"column":16},"end":{"line":131,"column":17}},"44":{"start":{"line":122,"column":20},"end":{"line":125,"column":23}},"45":{"start":{"line":127,"column":20},"end":{"line":130,"column":23}},"46":{"start":{"line":134,"column":8},"end":{"line":141,"column":11}},"47":{"start":{"line":136,"column":24},"end":{"line":136,"column":65}},"48":{"start":{"line":137,"column":12},"end":{"line":140,"column":15}},"49":{"start":{"line":142,"column":8},"end":{"line":142,"column":42}},"50":{"start":{"line":143,"column":8},"end":{"line":143,"column":20}},"51":{"start":{"line":146,"column":30},"end":{"line":146,"column":39}},"52":{"start":{"line":147,"column":21},"end":{"line":150,"column":9}},"53":{"start":{"line":151,"column":21},"end":{"line":161,"column":9}},"54":{"start":{"line":163,"column":28},"end":{"line":168,"column":9}},"55":{"start":{"line":169,"column":8},"end":{"line":175,"column":11}},"56":{"start":{"line":172,"column":12},"end":{"line":174,"column":13}},"57":{"start":{"line":173,"column":16},"end":{"line":173,"column":71}},"58":{"start":{"line":176,"column":8},"end":{"line":182,"column":11}},"59":{"start":{"line":178,"column":12},"end":{"line":181,"column":15}},"60":{"start":{"line":183,"column":8},"end":{"line":183,"column":42}},"61":{"start":{"line":184,"column":8},"end":{"line":184,"column":20}},"62":{"start":{"line":187,"column":33},"end":{"line":187,"column":42}},"63":{"start":{"line":188,"column":21},"end":{"line":191,"column":9}},"64":{"start":{"line":192,"column":21},"end":{"line":202,"column":9}},"65":{"start":{"line":203,"column":8},"end":{"line":219,"column":11}},"66":{"start":{"line":206,"column":12},"end":{"line":218,"column":13}},"67":{"start":{"line":207,"column":16},"end":{"line":217,"column":17}},"68":{"start":{"line":208,"column":20},"end":{"line":211,"column":23}},"69":{"start":{"line":213,"column":20},"end":{"line":216,"column":23}},"70":{"start":{"line":220,"column":8},"end":{"line":227,"column":11}},"71":{"start":{"line":222,"column":24},"end":{"line":222,"column":43}},"72":{"start":{"line":223,"column":12},"end":{"line":226,"column":15}},"73":{"start":{"line":228,"column":8},"end":{"line":228,"column":43}},"74":{"start":{"line":229,"column":8},"end":{"line":229,"column":20}},"75":{"start":{"line":232,"column":35},"end":{"line":232,"column":44}},"76":{"start":{"line":233,"column":21},"end":{"line":236,"column":9}},"77":{"start":{"line":237,"column":21},"end":{"line":247,"column":9}},"78":{"start":{"line":248,"column":8},"end":{"line":258,"column":11}},"79":{"start":{"line":251,"column":12},"end":{"line":257,"column":13}},"80":{"start":{"line":252,"column":16},"end":{"line":256,"column":17}},"81":{"start":{"line":253,"column":20},"end":{"line":253,"column":136}},"82":{"start":{"line":255,"column":20},"end":{"line":255,"column":83}},"83":{"start":{"line":259,"column":8},"end":{"line":265,"column":11}},"84":{"start":{"line":261,"column":12},"end":{"line":264,"column":15}},"85":{"start":{"line":266,"column":8},"end":{"line":266,"column":43}},"86":{"start":{"line":267,"column":8},"end":{"line":267,"column":20}},"87":{"start":{"line":270,"column":33},"end":{"line":270,"column":42}},"88":{"start":{"line":271,"column":21},"end":{"line":274,"column":9}},"89":{"start":{"line":275,"column":21},"end":{"line":285,"column":9}},"90":{"start":{"line":286,"column":8},"end":{"line":302,"column":11}},"91":{"start":{"line":289,"column":12},"end":{"line":301,"column":13}},"92":{"start":{"line":290,"column":16},"end":{"line":300,"column":17}},"93":{"start":{"line":291,"column":20},"end":{"line":294,"column":23}},"94":{"start":{"line":296,"column":20},"end":{"line":299,"column":23}},"95":{"start":{"line":303,"column":8},"end":{"line":310,"column":11}},"96":{"start":{"line":305,"column":24},"end":{"line":305,"column":43}},"97":{"start":{"line":306,"column":12},"end":{"line":309,"column":15}},"98":{"start":{"line":311,"column":8},"end":{"line":311,"column":43}},"99":{"start":{"line":312,"column":8},"end":{"line":312,"column":20}},"100":{"start":{"line":315,"column":37},"end":{"line":315,"column":46}},"101":{"start":{"line":316,"column":21},"end":{"line":319,"column":9}},"102":{"start":{"line":320,"column":21},"end":{"line":330,"column":9}},"103":{"start":{"line":331,"column":8},"end":{"line":347,"column":11}},"104":{"start":{"line":334,"column":12},"end":{"line":346,"column":13}},"105":{"start":{"line":335,"column":16},"end":{"line":345,"column":17}},"106":{"start":{"line":336,"column":20},"end":{"line":339,"column":23}},"107":{"start":{"line":341,"column":20},"end":{"line":344,"column":23}},"108":{"start":{"line":348,"column":8},"end":{"line":355,"column":11}},"109":{"start":{"line":350,"column":24},"end":{"line":350,"column":43}},"110":{"start":{"line":351,"column":12},"end":{"line":354,"column":15}},"111":{"start":{"line":356,"column":8},"end":{"line":356,"column":43}},"112":{"start":{"line":357,"column":8},"end":{"line":357,"column":20}},"113":{"start":{"line":360,"column":8},"end":{"line":360,"column":37}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":4},"end":{"line":13,"column":5}},"loc":{"start":{"line":13,"column":31},"end":{"line":16,"column":5}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":17,"column":4},"end":{"line":17,"column":5}},"loc":{"start":{"line":17,"column":35},"end":{"line":28,"column":5}},"line":17},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":18},"end":{"line":18,"column":19}},"loc":{"start":{"line":18,"column":26},"end":{"line":27,"column":9}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":29,"column":4},"end":{"line":29,"column":5}},"loc":{"start":{"line":29,"column":28},"end":{"line":42,"column":5}},"line":29},"5":{"name":"(anonymous_5)","decl":{"start":{"line":43,"column":4},"end":{"line":43,"column":5}},"loc":{"start":{"line":43,"column":32},"end":{"line":62,"column":5}},"line":43},"6":{"name":"(anonymous_6)","decl":{"start":{"line":63,"column":4},"end":{"line":63,"column":5}},"loc":{"start":{"line":63,"column":71},"end":{"line":99,"column":5}},"line":63},"7":{"name":"(anonymous_7)","decl":{"start":{"line":83,"column":35},"end":{"line":83,"column":36}},"loc":{"start":{"line":83,"column":43},"end":{"line":88,"column":9}},"line":83},"8":{"name":"(anonymous_8)","decl":{"start":{"line":89,"column":35},"end":{"line":89,"column":36}},"loc":{"start":{"line":89,"column":49},"end":{"line":96,"column":9}},"line":89},"9":{"name":"(anonymous_9)","decl":{"start":{"line":100,"column":4},"end":{"line":100,"column":5}},"loc":{"start":{"line":100,"column":69},"end":{"line":144,"column":5}},"line":100},"10":{"name":"(anonymous_10)","decl":{"start":{"line":119,"column":31},"end":{"line":119,"column":32}},"loc":{"start":{"line":119,"column":56},"end":{"line":133,"column":9}},"line":119},"11":{"name":"(anonymous_11)","decl":{"start":{"line":134,"column":35},"end":{"line":134,"column":36}},"loc":{"start":{"line":134,"column":47},"end":{"line":141,"column":9}},"line":134},"12":{"name":"(anonymous_12)","decl":{"start":{"line":145,"column":4},"end":{"line":145,"column":5}},"loc":{"start":{"line":145,"column":66},"end":{"line":185,"column":5}},"line":145},"13":{"name":"(anonymous_13)","decl":{"start":{"line":171,"column":44},"end":{"line":171,"column":45}},"loc":{"start":{"line":171,"column":66},"end":{"line":175,"column":9}},"line":171},"14":{"name":"(anonymous_14)","decl":{"start":{"line":176,"column":30},"end":{"line":176,"column":31}},"loc":{"start":{"line":176,"column":44},"end":{"line":182,"column":9}},"line":176},"15":{"name":"(anonymous_15)","decl":{"start":{"line":186,"column":4},"end":{"line":186,"column":5}},"loc":{"start":{"line":186,"column":75},"end":{"line":230,"column":5}},"line":186},"16":{"name":"(anonymous_16)","decl":{"start":{"line":205,"column":31},"end":{"line":205,"column":32}},"loc":{"start":{"line":205,"column":56},"end":{"line":219,"column":9}},"line":205},"17":{"name":"(anonymous_17)","decl":{"start":{"line":220,"column":33},"end":{"line":220,"column":34}},"loc":{"start":{"line":220,"column":45},"end":{"line":227,"column":9}},"line":220},"18":{"name":"(anonymous_18)","decl":{"start":{"line":231,"column":4},"end":{"line":231,"column":5}},"loc":{"start":{"line":231,"column":76},"end":{"line":268,"column":5}},"line":231},"19":{"name":"(anonymous_19)","decl":{"start":{"line":250,"column":31},"end":{"line":250,"column":32}},"loc":{"start":{"line":250,"column":56},"end":{"line":258,"column":9}},"line":250},"20":{"name":"(anonymous_20)","decl":{"start":{"line":259,"column":35},"end":{"line":259,"column":36}},"loc":{"start":{"line":259,"column":49},"end":{"line":265,"column":9}},"line":259},"21":{"name":"(anonymous_21)","decl":{"start":{"line":269,"column":4},"end":{"line":269,"column":5}},"loc":{"start":{"line":269,"column":69},"end":{"line":313,"column":5}},"line":269},"22":{"name":"(anonymous_22)","decl":{"start":{"line":288,"column":31},"end":{"line":288,"column":32}},"loc":{"start":{"line":288,"column":56},"end":{"line":302,"column":9}},"line":288},"23":{"name":"(anonymous_23)","decl":{"start":{"line":303,"column":33},"end":{"line":303,"column":34}},"loc":{"start":{"line":303,"column":45},"end":{"line":310,"column":9}},"line":303},"24":{"name":"(anonymous_24)","decl":{"start":{"line":314,"column":4},"end":{"line":314,"column":5}},"loc":{"start":{"line":314,"column":69},"end":{"line":358,"column":5}},"line":314},"25":{"name":"(anonymous_25)","decl":{"start":{"line":333,"column":31},"end":{"line":333,"column":32}},"loc":{"start":{"line":333,"column":56},"end":{"line":347,"column":9}},"line":333},"26":{"name":"(anonymous_26)","decl":{"start":{"line":348,"column":37},"end":{"line":348,"column":38}},"loc":{"start":{"line":348,"column":49},"end":{"line":355,"column":9}},"line":348},"27":{"name":"(anonymous_27)","decl":{"start":{"line":359,"column":4},"end":{"line":359,"column":5}},"loc":{"start":{"line":359,"column":27},"end":{"line":361,"column":5}},"line":359}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":21},"end":{"line":15,"column":70}},"type":"cond-expr","locations":[{"start":{"line":15,"column":39},"end":{"line":15,"column":62}},{"start":{"line":15,"column":65},"end":{"line":15,"column":70}}],"line":15},"1":{"loc":{"start":{"line":17,"column":22},"end":{"line":17,"column":33}},"type":"default-arg","locations":[{"start":{"line":17,"column":28},"end":{"line":17,"column":33}}],"line":17},"2":{"loc":{"start":{"line":20,"column":12},"end":{"line":22,"column":13}},"type":"if","locations":[{"start":{"line":20,"column":12},"end":{"line":22,"column":13}},{"start":{"line":20,"column":12},"end":{"line":22,"column":13}}],"line":20},"3":{"loc":{"start":{"line":21,"column":23},"end":{"line":21,"column":35}},"type":"cond-expr","locations":[{"start":{"line":21,"column":29},"end":{"line":21,"column":31}},{"start":{"line":21,"column":34},"end":{"line":21,"column":35}}],"line":21},"4":{"loc":{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},"type":"if","locations":[{"start":{"line":23,"column":12},"end":{"line":25,"column":13}},{"start":{"line":23,"column":12},"end":{"line":25,"column":13}}],"line":23},"5":{"loc":{"start":{"line":24,"column":23},"end":{"line":24,"column":35}},"type":"cond-expr","locations":[{"start":{"line":24,"column":29},"end":{"line":24,"column":30}},{"start":{"line":24,"column":33},"end":{"line":24,"column":35}}],"line":24},"6":{"loc":{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},"type":"if","locations":[{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},{"start":{"line":30,"column":8},"end":{"line":32,"column":9}}],"line":30},"7":{"loc":{"start":{"line":44,"column":8},"end":{"line":61,"column":9}},"type":"switch","locations":[{"start":{"line":45,"column":12},"end":{"line":46,"column":57}},{"start":{"line":47,"column":12},"end":{"line":48,"column":55}},{"start":{"line":49,"column":12},"end":{"line":50,"column":52}},{"start":{"line":51,"column":12},"end":{"line":52,"column":61}},{"start":{"line":53,"column":12},"end":{"line":54,"column":62}},{"start":{"line":55,"column":12},"end":{"line":56,"column":55}},{"start":{"line":57,"column":12},"end":{"line":58,"column":55}},{"start":{"line":59,"column":12},"end":{"line":60,"column":50}}],"line":44},"8":{"loc":{"start":{"line":63,"column":54},"end":{"line":63,"column":69}},"type":"default-arg","locations":[{"start":{"line":63,"column":67},"end":{"line":63,"column":69}}],"line":63},"9":{"loc":{"start":{"line":84,"column":12},"end":{"line":87,"column":13}},"type":"if","locations":[{"start":{"line":84,"column":12},"end":{"line":87,"column":13}},{"start":{"line":84,"column":12},"end":{"line":87,"column":13}}],"line":84},"10":{"loc":{"start":{"line":100,"column":52},"end":{"line":100,"column":67}},"type":"default-arg","locations":[{"start":{"line":100,"column":65},"end":{"line":100,"column":67}}],"line":100},"11":{"loc":{"start":{"line":120,"column":12},"end":{"line":132,"column":13}},"type":"if","locations":[{"start":{"line":120,"column":12},"end":{"line":132,"column":13}},{"start":{"line":120,"column":12},"end":{"line":132,"column":13}}],"line":120},"12":{"loc":{"start":{"line":120,"column":16},"end":{"line":120,"column":59}},"type":"binary-expr","locations":[{"start":{"line":120,"column":16},"end":{"line":120,"column":24}},{"start":{"line":120,"column":28},"end":{"line":120,"column":35}},{"start":{"line":120,"column":39},"end":{"line":120,"column":59}}],"line":120},"13":{"loc":{"start":{"line":121,"column":16},"end":{"line":131,"column":17}},"type":"if","locations":[{"start":{"line":121,"column":16},"end":{"line":131,"column":17}},{"start":{"line":121,"column":16},"end":{"line":131,"column":17}}],"line":121},"14":{"loc":{"start":{"line":145,"column":49},"end":{"line":145,"column":64}},"type":"default-arg","locations":[{"start":{"line":145,"column":62},"end":{"line":145,"column":64}}],"line":145},"15":{"loc":{"start":{"line":172,"column":12},"end":{"line":174,"column":13}},"type":"if","locations":[{"start":{"line":172,"column":12},"end":{"line":174,"column":13}},{"start":{"line":172,"column":12},"end":{"line":174,"column":13}}],"line":172},"16":{"loc":{"start":{"line":186,"column":58},"end":{"line":186,"column":73}},"type":"default-arg","locations":[{"start":{"line":186,"column":71},"end":{"line":186,"column":73}}],"line":186},"17":{"loc":{"start":{"line":206,"column":12},"end":{"line":218,"column":13}},"type":"if","locations":[{"start":{"line":206,"column":12},"end":{"line":218,"column":13}},{"start":{"line":206,"column":12},"end":{"line":218,"column":13}}],"line":206},"18":{"loc":{"start":{"line":206,"column":16},"end":{"line":206,"column":78}},"type":"binary-expr","locations":[{"start":{"line":206,"column":16},"end":{"line":206,"column":24}},{"start":{"line":206,"column":28},"end":{"line":206,"column":35}},{"start":{"line":206,"column":39},"end":{"line":206,"column":55}},{"start":{"line":206,"column":59},"end":{"line":206,"column":78}}],"line":206},"19":{"loc":{"start":{"line":207,"column":16},"end":{"line":217,"column":17}},"type":"if","locations":[{"start":{"line":207,"column":16},"end":{"line":217,"column":17}},{"start":{"line":207,"column":16},"end":{"line":217,"column":17}}],"line":207},"20":{"loc":{"start":{"line":231,"column":59},"end":{"line":231,"column":74}},"type":"default-arg","locations":[{"start":{"line":231,"column":72},"end":{"line":231,"column":74}}],"line":231},"21":{"loc":{"start":{"line":251,"column":12},"end":{"line":257,"column":13}},"type":"if","locations":[{"start":{"line":251,"column":12},"end":{"line":257,"column":13}},{"start":{"line":251,"column":12},"end":{"line":257,"column":13}}],"line":251},"22":{"loc":{"start":{"line":251,"column":16},"end":{"line":251,"column":78}},"type":"binary-expr","locations":[{"start":{"line":251,"column":16},"end":{"line":251,"column":24}},{"start":{"line":251,"column":28},"end":{"line":251,"column":35}},{"start":{"line":251,"column":39},"end":{"line":251,"column":55}},{"start":{"line":251,"column":59},"end":{"line":251,"column":78}}],"line":251},"23":{"loc":{"start":{"line":252,"column":16},"end":{"line":256,"column":17}},"type":"if","locations":[{"start":{"line":252,"column":16},"end":{"line":256,"column":17}},{"start":{"line":252,"column":16},"end":{"line":256,"column":17}}],"line":252},"24":{"loc":{"start":{"line":269,"column":52},"end":{"line":269,"column":67}},"type":"default-arg","locations":[{"start":{"line":269,"column":65},"end":{"line":269,"column":67}}],"line":269},"25":{"loc":{"start":{"line":289,"column":12},"end":{"line":301,"column":13}},"type":"if","locations":[{"start":{"line":289,"column":12},"end":{"line":301,"column":13}},{"start":{"line":289,"column":12},"end":{"line":301,"column":13}}],"line":289},"26":{"loc":{"start":{"line":289,"column":16},"end":{"line":289,"column":79}},"type":"binary-expr","locations":[{"start":{"line":289,"column":16},"end":{"line":289,"column":24}},{"start":{"line":289,"column":28},"end":{"line":289,"column":35}},{"start":{"line":289,"column":39},"end":{"line":289,"column":55}},{"start":{"line":289,"column":59},"end":{"line":289,"column":79}}],"line":289},"27":{"loc":{"start":{"line":290,"column":16},"end":{"line":300,"column":17}},"type":"if","locations":[{"start":{"line":290,"column":16},"end":{"line":300,"column":17}},{"start":{"line":290,"column":16},"end":{"line":300,"column":17}}],"line":290},"28":{"loc":{"start":{"line":314,"column":52},"end":{"line":314,"column":67}},"type":"default-arg","locations":[{"start":{"line":314,"column":65},"end":{"line":314,"column":67}}],"line":314},"29":{"loc":{"start":{"line":334,"column":12},"end":{"line":346,"column":13}},"type":"if","locations":[{"start":{"line":334,"column":12},"end":{"line":346,"column":13}},{"start":{"line":334,"column":12},"end":{"line":346,"column":13}}],"line":334},"30":{"loc":{"start":{"line":334,"column":16},"end":{"line":334,"column":78}},"type":"binary-expr","locations":[{"start":{"line":334,"column":16},"end":{"line":334,"column":24}},{"start":{"line":334,"column":28},"end":{"line":334,"column":35}},{"start":{"line":334,"column":39},"end":{"line":334,"column":55}},{"start":{"line":334,"column":59},"end":{"line":334,"column":78}}],"line":334},"31":{"loc":{"start":{"line":335,"column":16},"end":{"line":345,"column":17}},"type":"if","locations":[{"start":{"line":335,"column":16},"end":{"line":345,"column":17}},{"start":{"line":335,"column":16},"end":{"line":345,"column":17}}],"line":335}},"s":{"0":1,"1":1,"2":48,"3":1,"4":1,"5":16,"6":16,"7":48,"8":31,"9":6,"10":25,"11":6,"12":19,"13":3,"14":1,"15":2,"16":8,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":6,"26":6,"27":6,"28":6,"29":6,"30":7,"31":6,"32":6,"33":6,"34":5,"35":5,"36":6,"37":6,"38":7,"39":7,"40":7,"41":7,"42":9,"43":6,"44":1,"45":5,"46":7,"47":5,"48":5,"49":7,"50":7,"51":6,"52":6,"53":6,"54":6,"55":6,"56":9,"57":8,"58":6,"59":7,"60":6,"61":6,"62":7,"63":7,"64":7,"65":7,"66":8,"67":6,"68":1,"69":5,"70":7,"71":5,"72":5,"73":7,"74":7,"75":6,"76":6,"77":6,"78":6,"79":15,"80":13,"81":1,"82":12,"83":6,"84":12,"85":6,"86":6,"87":7,"88":7,"89":7,"90":7,"91":9,"92":6,"93":1,"94":5,"95":7,"96":5,"97":5,"98":7,"99":7,"100":7,"101":7,"102":7,"103":7,"104":9,"105":6,"106":1,"107":5,"108":7,"109":5,"110":5,"111":7,"112":7,"113":48},"f":{"0":48,"1":16,"2":48,"3":31,"4":3,"5":8,"6":6,"7":7,"8":5,"9":7,"10":9,"11":5,"12":6,"13":9,"14":7,"15":7,"16":8,"17":5,"18":6,"19":15,"20":12,"21":7,"22":9,"23":5,"24":7,"25":9,"26":5,"27":48},"b":{"0":[3,13],"1":[1],"2":[6,25],"3":[4,2],"4":[6,19],"5":[4,2],"6":[1,2],"7":[1,1,1,1,1,1,1,1],"8":[6],"9":[6,1],"10":[7],"11":[6,3],"12":[9,8,7],"13":[1,5],"14":[6],"15":[8,1],"16":[7],"17":[6,2],"18":[8,7,6,6],"19":[1,5],"20":[6],"21":[13,2],"22":[15,14,13,13],"23":[1,12],"24":[7],"25":[6,3],"26":[9,8,7,6],"27":[1,5],"28":[7],"29":[6,3],"30":[9,8,7,6],"31":[1,5]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-analytics/AgentData.ts"],"sourcesContent":["/* eslint-disable new-cap */\nimport type { ConversationData } from '@rocket.chat/core-services';\nimport type { IOmnichannelRoom } from '@rocket.chat/core-typings';\nimport type { ILivechatRoomsModel } from '@rocket.chat/model-typings';\nimport type { Filter } from 'mongodb';\n\nimport { secondsToHHMMSS } from '../../../lib/utils/secondsToHHMMSS';\n\ntype AgentOverviewValidActions =\n\t| 'Total_conversations'\n\t| 'Avg_chat_duration'\n\t| 'Total_messages'\n\t| 'Avg_first_response_time'\n\t| 'Best_first_response_time'\n\t| 'Avg_response_time'\n\t| 'Avg_reaction_time';\n\nexport class AgentOverviewData {\n\tconstructor(private readonly roomsModel: ILivechatRoomsModel) {}\n\n\tupdateMap<K>(map: Map<K, number>, key: K, value: number) {\n\t\tconst currentKeyValue = map.get(key);\n\t\tmap.set(key, currentKeyValue ? currentKeyValue + value : value);\n\t}\n\n\tsortByValue(data: { value: string }[], inv = false) {\n\t\tdata.sort((a, b) => {\n\t\t\t// sort array\n\t\t\tif (parseFloat(a.value) > parseFloat(b.value)) {\n\t\t\t\treturn inv ? -1 : 1; // if inv, reverse sort\n\t\t\t}\n\t\t\tif (parseFloat(a.value) < parseFloat(b.value)) {\n\t\t\t\treturn inv ? 1 : -1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\t}\n\n\tisActionAllowed(action: string | undefined): action is AgentOverviewValidActions {\n\t\tif (!action) {\n\t\t\treturn false;\n\t\t}\n\t\treturn [\n\t\t\t'Total_conversations',\n\t\t\t'Avg_chat_duration',\n\t\t\t'Total_messages',\n\t\t\t'Avg_first_response_time',\n\t\t\t'Best_first_response_time',\n\t\t\t'Avg_response_time',\n\t\t\t'Avg_reaction_time',\n\t\t].includes(action);\n\t}\n\n\tcallAction<T extends AgentOverviewValidActions>(action: T, ...args: [moment.Moment, moment.Moment, string?, Filter<IOmnichannelRoom>?]) {\n\t\tswitch (action) {\n\t\t\tcase 'Total_conversations':\n\t\t\t\treturn this.Total_conversations(...args);\n\t\t\tcase 'Avg_chat_duration':\n\t\t\t\treturn this.Avg_chat_duration(...args);\n\t\t\tcase 'Total_messages':\n\t\t\t\treturn this.Total_messages(...args);\n\t\t\tcase 'Avg_first_response_time':\n\t\t\t\treturn this.Avg_first_response_time(...args);\n\t\t\tcase 'Best_first_response_time':\n\t\t\t\treturn this.Best_first_response_time(...args);\n\t\t\tcase 'Avg_response_time':\n\t\t\t\treturn this.Avg_response_time(...args);\n\t\t\tcase 'Avg_reaction_time':\n\t\t\t\treturn this.Avg_reaction_time(...args);\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Invalid action');\n\t\t}\n\t}\n\n\tasync Total_conversations(from: moment.Moment, to: moment.Moment, departmentId?: string, extraQuery: Filter<IOmnichannelRoom> = {}) {\n\t\tlet total = 0;\n\t\tconst agentConversations = new Map(); // stores total conversations for each agent\n\t\tconst date = {\n\t\t\tgte: from.toDate(),\n\t\t\tlte: to.toDate(),\n\t\t};\n\n\t\tconst data: ConversationData = {\n\t\t\thead: [\n\t\t\t\t{\n\t\t\t\t\tname: 'Agent',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: '%_of_conversations',\n\t\t\t\t},\n\t\t\t],\n\t\t\tdata: [],\n\t\t};\n\n\t\tawait this.roomsModel\n\t\t\t.getAnalyticsMetricsBetweenDateWithMessages(\n\t\t\t\t'l',\n\t\t\t\tdate,\n\t\t\t\t{\n\t\t\t\t\tdepartmentId,\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\textraQuery,\n\t\t\t)\n\t\t\t.forEach((room) => {\n\t\t\t\tif (room.servedBy) {\n\t\t\t\t\tthis.updateMap(agentConversations, room.servedBy.username, 1);\n\t\t\t\t\ttotal++;\n\t\t\t\t}\n\t\t\t});\n\n\t\tagentConversations.forEach((value, key) => {\n\t\t\t// calculate percentage\n\t\t\tconst percentage = ((value / total) * 100).toFixed(2);\n\n\t\t\tdata.data.push({\n\t\t\t\tname: key,\n\t\t\t\tvalue: `${percentage}%`,\n\t\t\t});\n\t\t});\n\n\t\tthis.sortByValue(data.data, true); // reverse sort array\n\n\t\treturn data;\n\t}\n\n\tasync Avg_chat_duration(from: moment.Moment, to: moment.Moment, departmentId?: string, extraQuery: Filter<IOmnichannelRoom> = {}) {\n\t\tconst agentChatDurations = new Map(); // stores total conversations for each agent\n\t\tconst date = {\n\t\t\tgte: from.toDate(),\n\t\t\tlte: to.toDate(),\n\t\t};\n\n\t\tconst data: ConversationData = {\n\t\t\thead: [\n\t\t\t\t{\n\t\t\t\t\tname: 'Agent',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'Avg_chat_duration',\n\t\t\t\t},\n\t\t\t],\n\t\t\tdata: [],\n\t\t};\n\n\t\tawait this.roomsModel.getAnalyticsMetricsBetweenDate('l', date, { departmentId }, extraQuery).forEach(({ metrics, servedBy }) => {\n\t\t\tif (servedBy && metrics && metrics.chatDuration) {\n\t\t\t\tif (agentChatDurations.has(servedBy.username)) {\n\t\t\t\t\tagentChatDurations.set(servedBy.username, {\n\t\t\t\t\t\tchatDuration: agentChatDurations.get(servedBy.username).chatDuration + metrics.chatDuration,\n\t\t\t\t\t\ttotal: agentChatDurations.get(servedBy.username).total + 1,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tagentChatDurations.set(servedBy.username, {\n\t\t\t\t\t\tchatDuration: metrics.chatDuration,\n\t\t\t\t\t\ttotal: 1,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tagentChatDurations.forEach((obj, key) => {\n\t\t\t// calculate percentage\n\t\t\tconst avg = (obj.chatDuration / obj.total).toFixed(2);\n\n\t\t\tdata.data.push({\n\t\t\t\tname: key,\n\t\t\t\tvalue: secondsToHHMMSS(avg),\n\t\t\t});\n\t\t});\n\n\t\tthis.sortByValue(data.data, true); // reverse sort array\n\n\t\treturn data;\n\t}\n\n\tasync Total_messages(from: moment.Moment, to: moment.Moment, departmentId?: string, extraQuery: Filter<IOmnichannelRoom> = {}) {\n\t\tconst agentMessages = new Map(); // stores total conversations for each agent\n\t\tconst date = {\n\t\t\tgte: from.toDate(),\n\t\t\tlte: to.toDate(),\n\t\t};\n\n\t\tconst data: ConversationData = {\n\t\t\thead: [\n\t\t\t\t{\n\t\t\t\t\tname: 'Agent',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'Total_messages',\n\t\t\t\t},\n\t\t\t],\n\t\t\tdata: [],\n\t\t};\n\n\t\t// we don't want to count visitor messages\n\t\tconst extraFilter = { $lte: ['$token', null] };\n\t\tawait this.roomsModel\n\t\t\t.getAnalyticsMetricsBetweenDateWithMessages('l', date, { departmentId }, extraFilter, extraQuery)\n\t\t\t.forEach(({ servedBy, msgs }) => {\n\t\t\t\tif (servedBy) {\n\t\t\t\t\tthis.updateMap(agentMessages, servedBy.username, msgs);\n\t\t\t\t}\n\t\t\t});\n\n\t\tagentMessages.forEach((value, key) => {\n\t\t\t// calculate percentage\n\t\t\tdata.data.push({\n\t\t\t\tname: key,\n\t\t\t\tvalue,\n\t\t\t});\n\t\t});\n\n\t\tthis.sortByValue(data.data, true); // reverse sort array\n\n\t\treturn data;\n\t}\n\n\tasync Avg_first_response_time(from: moment.Moment, to: moment.Moment, departmentId?: string, extraQuery: Filter<IOmnichannelRoom> = {}) {\n\t\tconst agentAvgRespTime = new Map(); // stores avg response time for each agent\n\t\tconst date = {\n\t\t\tgte: from.toDate(),\n\t\t\tlte: to.toDate(),\n\t\t};\n\n\t\tconst data: ConversationData = {\n\t\t\thead: [\n\t\t\t\t{\n\t\t\t\t\tname: 'Agent',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'Avg_first_response_time',\n\t\t\t\t},\n\t\t\t],\n\t\t\tdata: [],\n\t\t};\n\n\t\tawait this.roomsModel.getAnalyticsMetricsBetweenDate('l', date, { departmentId }, extraQuery).forEach(({ metrics, servedBy }) => {\n\t\t\tif (servedBy && metrics && metrics.response && metrics.response.ft) {\n\t\t\t\tif (agentAvgRespTime.has(servedBy.username)) {\n\t\t\t\t\tagentAvgRespTime.set(servedBy.username, {\n\t\t\t\t\t\tfrt: agentAvgRespTime.get(servedBy.username).frt + metrics.response.ft,\n\t\t\t\t\t\ttotal: agentAvgRespTime.get(servedBy.username).total + 1,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tagentAvgRespTime.set(servedBy.username, {\n\t\t\t\t\t\tfrt: metrics.response.ft,\n\t\t\t\t\t\ttotal: 1,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tagentAvgRespTime.forEach((obj, key) => {\n\t\t\t// calculate avg\n\t\t\tconst avg = obj.frt / obj.total;\n\n\t\t\tdata.data.push({\n\t\t\t\tname: key,\n\t\t\t\tvalue: secondsToHHMMSS(avg.toFixed(2)),\n\t\t\t});\n\t\t});\n\n\t\tthis.sortByValue(data.data, false); // sort array\n\n\t\treturn data;\n\t}\n\n\tasync Best_first_response_time(from: moment.Moment, to: moment.Moment, departmentId?: string, extraQuery: Filter<IOmnichannelRoom> = {}) {\n\t\tconst agentFirstRespTime = new Map(); // stores avg response time for each agent\n\t\tconst date = {\n\t\t\tgte: from.toDate(),\n\t\t\tlte: to.toDate(),\n\t\t};\n\n\t\tconst data: ConversationData = {\n\t\t\thead: [\n\t\t\t\t{\n\t\t\t\t\tname: 'Agent',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'Best_first_response_time',\n\t\t\t\t},\n\t\t\t],\n\t\t\tdata: [],\n\t\t};\n\n\t\tawait this.roomsModel.getAnalyticsMetricsBetweenDate('l', date, { departmentId }, extraQuery).forEach(({ metrics, servedBy }) => {\n\t\t\tif (servedBy && metrics && metrics.response && metrics.response.ft) {\n\t\t\t\tif (agentFirstRespTime.has(servedBy.username)) {\n\t\t\t\t\tagentFirstRespTime.set(servedBy.username, Math.min(agentFirstRespTime.get(servedBy.username), metrics.response.ft));\n\t\t\t\t} else {\n\t\t\t\t\tagentFirstRespTime.set(servedBy.username, metrics.response.ft);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tagentFirstRespTime.forEach((value, key) => {\n\t\t\t// calculate avg\n\t\t\tdata.data.push({\n\t\t\t\tname: key,\n\t\t\t\tvalue: secondsToHHMMSS(value.toFixed(2)),\n\t\t\t});\n\t\t});\n\n\t\tthis.sortByValue(data.data, false); // sort array\n\n\t\treturn data;\n\t}\n\n\tasync Avg_response_time(from: moment.Moment, to: moment.Moment, departmentId?: string, extraQuery: Filter<IOmnichannelRoom> = {}) {\n\t\tconst agentAvgRespTime = new Map(); // stores avg response time for each agent\n\t\tconst date = {\n\t\t\tgte: from.toDate(),\n\t\t\tlte: to.toDate(),\n\t\t};\n\n\t\tconst data: ConversationData = {\n\t\t\thead: [\n\t\t\t\t{\n\t\t\t\t\tname: 'Agent',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'Avg_response_time',\n\t\t\t\t},\n\t\t\t],\n\t\t\tdata: [],\n\t\t};\n\n\t\tawait this.roomsModel.getAnalyticsMetricsBetweenDate('l', date, { departmentId }, extraQuery).forEach(({ metrics, servedBy }) => {\n\t\t\tif (servedBy && metrics && metrics.response && metrics.response.avg) {\n\t\t\t\tif (agentAvgRespTime.has(servedBy.username)) {\n\t\t\t\t\tagentAvgRespTime.set(servedBy.username, {\n\t\t\t\t\t\tavg: agentAvgRespTime.get(servedBy.username).avg + metrics.response.avg,\n\t\t\t\t\t\ttotal: agentAvgRespTime.get(servedBy.username).total + 1,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tagentAvgRespTime.set(servedBy.username, {\n\t\t\t\t\t\tavg: metrics.response.avg,\n\t\t\t\t\t\ttotal: 1,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tagentAvgRespTime.forEach((obj, key) => {\n\t\t\t// calculate avg\n\t\t\tconst avg = obj.avg / obj.total;\n\n\t\t\tdata.data.push({\n\t\t\t\tname: key,\n\t\t\t\tvalue: secondsToHHMMSS(avg.toFixed(2)),\n\t\t\t});\n\t\t});\n\n\t\tthis.sortByValue(data.data, false); // sort array\n\n\t\treturn data;\n\t}\n\n\tasync Avg_reaction_time(from: moment.Moment, to: moment.Moment, departmentId?: string, extraQuery: Filter<IOmnichannelRoom> = {}) {\n\t\tconst agentAvgReactionTime = new Map(); // stores avg reaction time for each agent\n\t\tconst date = {\n\t\t\tgte: from.toDate(),\n\t\t\tlte: to.toDate(),\n\t\t};\n\n\t\tconst data: ConversationData = {\n\t\t\thead: [\n\t\t\t\t{\n\t\t\t\t\tname: 'Agent',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'Avg_reaction_time',\n\t\t\t\t},\n\t\t\t],\n\t\t\tdata: [],\n\t\t};\n\n\t\tawait this.roomsModel.getAnalyticsMetricsBetweenDate('l', date, { departmentId }, extraQuery).forEach(({ metrics, servedBy }) => {\n\t\t\tif (servedBy && metrics && metrics.reaction && metrics.reaction.ft) {\n\t\t\t\tif (agentAvgReactionTime.has(servedBy.username)) {\n\t\t\t\t\tagentAvgReactionTime.set(servedBy.username, {\n\t\t\t\t\t\tfrt: agentAvgReactionTime.get(servedBy.username).frt + metrics.reaction.ft,\n\t\t\t\t\t\ttotal: agentAvgReactionTime.get(servedBy.username).total + 1,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tagentAvgReactionTime.set(servedBy.username, {\n\t\t\t\t\t\tfrt: metrics.reaction.ft,\n\t\t\t\t\t\ttotal: 1,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tagentAvgReactionTime.forEach((obj, key) => {\n\t\t\t// calculate avg\n\t\t\tconst avg = obj.frt / obj.total;\n\n\t\t\tdata.data.push({\n\t\t\t\tname: key,\n\t\t\t\tvalue: secondsToHHMMSS(avg.toFixed(2)),\n\t\t\t});\n\t\t});\n\n\t\tthis.sortByValue(data.data, false); // sort array\n\n\t\treturn data;\n\t}\n}\n"],"names":["AgentOverviewData","updateMap","map","key","value","currentKeyValue","get","set","sortByValue","data","inv","sort","a","b","parseFloat","isActionAllowed","action","includes","callAction","args","Total_conversations","Avg_chat_duration","Total_messages","Avg_first_response_time","Best_first_response_time","Avg_response_time","Avg_reaction_time","Error","from","to","departmentId","extraQuery","total","agentConversations","Map","date","gte","toDate","lte","head","name","roomsModel","getAnalyticsMetricsBetweenDateWithMessages","forEach","room","servedBy","username","percentage","toFixed","push","agentChatDurations","getAnalyticsMetricsBetweenDate","metrics","chatDuration","has","obj","avg","secondsToHHMMSS","agentMessages","extraFilter","$lte","msgs","agentAvgRespTime","response","ft","frt","agentFirstRespTime","Math","min","agentAvgReactionTime","reaction","constructor"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-analytics/AgentData.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a08b4b755363558b35ad5f10fdc7bb13b127ab97","contentHash":"3a5302292deba2d37bd9563fdc8d4bd5c326e98f5cdd8d7c3fc370349f7a5515"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-analytics/ChartData.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-analytics/ChartData.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":25}},"3":{"start":{"line":11,"column":16},"end":{"line":147,"column":1}},"4":{"start":{"line":13,"column":8},"end":{"line":15,"column":9}},"5":{"start":{"line":14,"column":12},"end":{"line":14,"column":25}},"6":{"start":{"line":16,"column":8},"end":{"line":24,"column":27}},"7":{"start":{"line":27,"column":8},"end":{"line":44,"column":9}},"8":{"start":{"line":29,"column":16},"end":{"line":29,"column":57}},"9":{"start":{"line":31,"column":16},"end":{"line":31,"column":55}},"10":{"start":{"line":33,"column":16},"end":{"line":33,"column":52}},"11":{"start":{"line":35,"column":16},"end":{"line":35,"column":61}},"12":{"start":{"line":37,"column":16},"end":{"line":37,"column":55}},"13":{"start":{"line":39,"column":16},"end":{"line":39,"column":62}},"14":{"start":{"line":41,"column":16},"end":{"line":41,"column":55}},"15":{"start":{"line":43,"column":16},"end":{"line":43,"column":50}},"16":{"start":{"line":48,"column":8},"end":{"line":50,"column":23}},"17":{"start":{"line":53,"column":20},"end":{"line":53,"column":21}},"18":{"start":{"line":54,"column":20},"end":{"line":54,"column":21}},"19":{"start":{"line":55,"column":8},"end":{"line":62,"column":11}},"20":{"start":{"line":58,"column":12},"end":{"line":61,"column":13}},"21":{"start":{"line":59,"column":16},"end":{"line":59,"column":46}},"22":{"start":{"line":60,"column":16},"end":{"line":60,"column":24}},"23":{"start":{"line":63,"column":22},"end":{"line":63,"column":47}},"24":{"start":{"line":64,"column":8},"end":{"line":64,"column":45}},"25":{"start":{"line":67,"column":20},"end":{"line":67,"column":21}},"26":{"start":{"line":69,"column":28},"end":{"line":74,"column":9}},"27":{"start":{"line":75,"column":8},"end":{"line":81,"column":11}},"28":{"start":{"line":78,"column":12},"end":{"line":80,"column":13}},"29":{"start":{"line":79,"column":16},"end":{"line":79,"column":30}},"30":{"start":{"line":82,"column":8},"end":{"line":82,"column":21}},"31":{"start":{"line":85,"column":18},"end":{"line":85,"column":19}},"32":{"start":{"line":86,"column":20},"end":{"line":86,"column":21}},"33":{"start":{"line":87,"column":8},"end":{"line":95,"column":11}},"34":{"start":{"line":91,"column":12},"end":{"line":94,"column":13}},"35":{"start":{"line":92,"column":16},"end":{"line":92,"column":43}},"36":{"start":{"line":93,"column":16},"end":{"line":93,"column":24}},"37":{"start":{"line":96,"column":23},"end":{"line":96,"column":46}},"38":{"start":{"line":97,"column":8},"end":{"line":97,"column":46}},"39":{"start":{"line":100,"column":21},"end":{"line":100,"column":22}},"40":{"start":{"line":101,"column":8},"end":{"line":108,"column":11}},"41":{"start":{"line":105,"column":12},"end":{"line":107,"column":13}},"42":{"start":{"line":106,"column":16},"end":{"line":106,"column":94}},"43":{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},"44":{"start":{"line":110,"column":12},"end":{"line":110,"column":23}},"45":{"start":{"line":112,"column":8},"end":{"line":112,"column":46}},"46":{"start":{"line":115,"column":18},"end":{"line":115,"column":19}},"47":{"start":{"line":116,"column":20},"end":{"line":116,"column":21}},"48":{"start":{"line":117,"column":8},"end":{"line":125,"column":11}},"49":{"start":{"line":121,"column":12},"end":{"line":124,"column":13}},"50":{"start":{"line":122,"column":16},"end":{"line":122,"column":44}},"51":{"start":{"line":123,"column":16},"end":{"line":123,"column":24}},"52":{"start":{"line":126,"column":23},"end":{"line":126,"column":46}},"53":{"start":{"line":127,"column":8},"end":{"line":127,"column":46}},"54":{"start":{"line":130,"column":19},"end":{"line":130,"column":20}},"55":{"start":{"line":131,"column":20},"end":{"line":131,"column":21}},"56":{"start":{"line":132,"column":8},"end":{"line":140,"column":11}},"57":{"start":{"line":136,"column":12},"end":{"line":139,"column":13}},"58":{"start":{"line":137,"column":16},"end":{"line":137,"column":44}},"59":{"start":{"line":138,"column":16},"end":{"line":138,"column":24}},"60":{"start":{"line":141,"column":24},"end":{"line":141,"column":48}},"61":{"start":{"line":142,"column":8},"end":{"line":142,"column":47}},"62":{"start":{"line":145,"column":8},"end":{"line":145,"column":37}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":4},"end":{"line":12,"column":5}},"loc":{"start":{"line":12,"column":28},"end":{"line":25,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":26,"column":4},"end":{"line":26,"column":5}},"loc":{"start":{"line":26,"column":32},"end":{"line":45,"column":5}},"line":26},"3":{"name":"(anonymous_3)","decl":{"start":{"line":46,"column":4},"end":{"line":46,"column":5}},"loc":{"start":{"line":46,"column":67},"end":{"line":51,"column":5}},"line":46},"4":{"name":"(anonymous_4)","decl":{"start":{"line":52,"column":4},"end":{"line":52,"column":5}},"loc":{"start":{"line":52,"column":65},"end":{"line":65,"column":5}},"line":52},"5":{"name":"(anonymous_5)","decl":{"start":{"line":57,"column":31},"end":{"line":57,"column":32}},"loc":{"start":{"line":57,"column":46},"end":{"line":62,"column":9}},"line":57},"6":{"name":"(anonymous_6)","decl":{"start":{"line":66,"column":4},"end":{"line":66,"column":5}},"loc":{"start":{"line":66,"column":62},"end":{"line":83,"column":5}},"line":66},"7":{"name":"(anonymous_7)","decl":{"start":{"line":77,"column":44},"end":{"line":77,"column":45}},"loc":{"start":{"line":77,"column":56},"end":{"line":81,"column":9}},"line":77},"8":{"name":"(anonymous_8)","decl":{"start":{"line":84,"column":4},"end":{"line":84,"column":5}},"loc":{"start":{"line":84,"column":71},"end":{"line":98,"column":5}},"line":84},"9":{"name":"(anonymous_9)","decl":{"start":{"line":89,"column":31},"end":{"line":89,"column":32}},"loc":{"start":{"line":89,"column":46},"end":{"line":95,"column":9}},"line":89},"10":{"name":"(anonymous_10)","decl":{"start":{"line":99,"column":4},"end":{"line":99,"column":5}},"loc":{"start":{"line":99,"column":72},"end":{"line":113,"column":5}},"line":99},"11":{"name":"(anonymous_11)","decl":{"start":{"line":103,"column":31},"end":{"line":103,"column":32}},"loc":{"start":{"line":103,"column":46},"end":{"line":108,"column":9}},"line":103},"12":{"name":"(anonymous_12)","decl":{"start":{"line":114,"column":4},"end":{"line":114,"column":5}},"loc":{"start":{"line":114,"column":65},"end":{"line":128,"column":5}},"line":114},"13":{"name":"(anonymous_13)","decl":{"start":{"line":119,"column":31},"end":{"line":119,"column":32}},"loc":{"start":{"line":119,"column":46},"end":{"line":125,"column":9}},"line":119},"14":{"name":"(anonymous_14)","decl":{"start":{"line":129,"column":4},"end":{"line":129,"column":5}},"loc":{"start":{"line":129,"column":65},"end":{"line":143,"column":5}},"line":129},"15":{"name":"(anonymous_15)","decl":{"start":{"line":134,"column":31},"end":{"line":134,"column":32}},"loc":{"start":{"line":134,"column":46},"end":{"line":140,"column":9}},"line":134},"16":{"name":"(anonymous_16)","decl":{"start":{"line":144,"column":4},"end":{"line":144,"column":5}},"loc":{"start":{"line":144,"column":27},"end":{"line":146,"column":5}},"line":144}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":8},"end":{"line":15,"column":9}},"type":"if","locations":[{"start":{"line":13,"column":8},"end":{"line":15,"column":9}},{"start":{"line":13,"column":8},"end":{"line":15,"column":9}}],"line":13},"1":{"loc":{"start":{"line":27,"column":8},"end":{"line":44,"column":9}},"type":"switch","locations":[{"start":{"line":28,"column":12},"end":{"line":29,"column":57}},{"start":{"line":30,"column":12},"end":{"line":31,"column":55}},{"start":{"line":32,"column":12},"end":{"line":33,"column":52}},{"start":{"line":34,"column":12},"end":{"line":35,"column":61}},{"start":{"line":36,"column":12},"end":{"line":37,"column":55}},{"start":{"line":38,"column":12},"end":{"line":39,"column":62}},{"start":{"line":40,"column":12},"end":{"line":41,"column":55}},{"start":{"line":42,"column":12},"end":{"line":43,"column":50}}],"line":27},"2":{"loc":{"start":{"line":46,"column":50},"end":{"line":46,"column":65}},"type":"default-arg","locations":[{"start":{"line":46,"column":63},"end":{"line":46,"column":65}}],"line":46},"3":{"loc":{"start":{"line":52,"column":48},"end":{"line":52,"column":63}},"type":"default-arg","locations":[{"start":{"line":52,"column":61},"end":{"line":52,"column":63}}],"line":52},"4":{"loc":{"start":{"line":58,"column":12},"end":{"line":61,"column":13}},"type":"if","locations":[{"start":{"line":58,"column":12},"end":{"line":61,"column":13}},{"start":{"line":58,"column":12},"end":{"line":61,"column":13}}],"line":58},"5":{"loc":{"start":{"line":58,"column":16},"end":{"line":58,"column":86}},"type":"cond-expr","locations":[{"start":{"line":58,"column":57},"end":{"line":58,"column":63}},{"start":{"line":58,"column":66},"end":{"line":58,"column":86}}],"line":58},"6":{"loc":{"start":{"line":58,"column":16},"end":{"line":58,"column":54}},"type":"binary-expr","locations":[{"start":{"line":58,"column":16},"end":{"line":58,"column":32}},{"start":{"line":58,"column":36},"end":{"line":58,"column":54}}],"line":58},"7":{"loc":{"start":{"line":63,"column":22},"end":{"line":63,"column":47}},"type":"cond-expr","locations":[{"start":{"line":63,"column":30},"end":{"line":63,"column":43}},{"start":{"line":63,"column":46},"end":{"line":63,"column":47}}],"line":63},"8":{"loc":{"start":{"line":66,"column":45},"end":{"line":66,"column":60}},"type":"default-arg","locations":[{"start":{"line":66,"column":58},"end":{"line":66,"column":60}}],"line":66},"9":{"loc":{"start":{"line":78,"column":12},"end":{"line":80,"column":13}},"type":"if","locations":[{"start":{"line":78,"column":12},"end":{"line":80,"column":13}},{"start":{"line":78,"column":12},"end":{"line":80,"column":13}}],"line":78},"10":{"loc":{"start":{"line":84,"column":54},"end":{"line":84,"column":69}},"type":"default-arg","locations":[{"start":{"line":84,"column":67},"end":{"line":84,"column":69}}],"line":84},"11":{"loc":{"start":{"line":91,"column":12},"end":{"line":94,"column":13}},"type":"if","locations":[{"start":{"line":91,"column":12},"end":{"line":94,"column":13}},{"start":{"line":91,"column":12},"end":{"line":94,"column":13}}],"line":91},"12":{"loc":{"start":{"line":91,"column":16},"end":{"line":91,"column":177}},"type":"cond-expr","locations":[{"start":{"line":91,"column":57},"end":{"line":91,"column":63}},{"start":{"line":91,"column":66},"end":{"line":91,"column":177}}],"line":91},"13":{"loc":{"start":{"line":91,"column":16},"end":{"line":91,"column":54}},"type":"binary-expr","locations":[{"start":{"line":91,"column":16},"end":{"line":91,"column":32}},{"start":{"line":91,"column":36},"end":{"line":91,"column":54}}],"line":91},"14":{"loc":{"start":{"line":91,"column":66},"end":{"line":91,"column":177}},"type":"cond-expr","locations":[{"start":{"line":91,"column":148},"end":{"line":91,"column":154}},{"start":{"line":91,"column":157},"end":{"line":91,"column":177}}],"line":91},"15":{"loc":{"start":{"line":91,"column":66},"end":{"line":91,"column":145}},"type":"binary-expr","locations":[{"start":{"line":91,"column":66},"end":{"line":91,"column":113}},{"start":{"line":91,"column":117},"end":{"line":91,"column":145}}],"line":91},"16":{"loc":{"start":{"line":96,"column":23},"end":{"line":96,"column":46}},"type":"cond-expr","locations":[{"start":{"line":96,"column":31},"end":{"line":96,"column":42}},{"start":{"line":96,"column":45},"end":{"line":96,"column":46}}],"line":96},"17":{"loc":{"start":{"line":99,"column":55},"end":{"line":99,"column":70}},"type":"default-arg","locations":[{"start":{"line":99,"column":68},"end":{"line":99,"column":70}}],"line":99},"18":{"loc":{"start":{"line":105,"column":12},"end":{"line":107,"column":13}},"type":"if","locations":[{"start":{"line":105,"column":12},"end":{"line":107,"column":13}},{"start":{"line":105,"column":12},"end":{"line":107,"column":13}}],"line":105},"19":{"loc":{"start":{"line":105,"column":16},"end":{"line":105,"column":177}},"type":"cond-expr","locations":[{"start":{"line":105,"column":57},"end":{"line":105,"column":63}},{"start":{"line":105,"column":66},"end":{"line":105,"column":177}}],"line":105},"20":{"loc":{"start":{"line":105,"column":16},"end":{"line":105,"column":54}},"type":"binary-expr","locations":[{"start":{"line":105,"column":16},"end":{"line":105,"column":32}},{"start":{"line":105,"column":36},"end":{"line":105,"column":54}}],"line":105},"21":{"loc":{"start":{"line":105,"column":66},"end":{"line":105,"column":177}},"type":"cond-expr","locations":[{"start":{"line":105,"column":148},"end":{"line":105,"column":154}},{"start":{"line":105,"column":157},"end":{"line":105,"column":177}}],"line":105},"22":{"loc":{"start":{"line":105,"column":66},"end":{"line":105,"column":145}},"type":"binary-expr","locations":[{"start":{"line":105,"column":66},"end":{"line":105,"column":113}},{"start":{"line":105,"column":117},"end":{"line":105,"column":145}}],"line":105},"23":{"loc":{"start":{"line":106,"column":25},"end":{"line":106,"column":93}},"type":"cond-expr","locations":[{"start":{"line":106,"column":34},"end":{"line":106,"column":71}},{"start":{"line":106,"column":74},"end":{"line":106,"column":93}}],"line":106},"24":{"loc":{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},"type":"if","locations":[{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},{"start":{"line":109,"column":8},"end":{"line":111,"column":9}}],"line":109},"25":{"loc":{"start":{"line":114,"column":48},"end":{"line":114,"column":63}},"type":"default-arg","locations":[{"start":{"line":114,"column":61},"end":{"line":114,"column":63}}],"line":114},"26":{"loc":{"start":{"line":121,"column":12},"end":{"line":124,"column":13}},"type":"if","locations":[{"start":{"line":121,"column":12},"end":{"line":124,"column":13}},{"start":{"line":121,"column":12},"end":{"line":124,"column":13}}],"line":121},"27":{"loc":{"start":{"line":121,"column":16},"end":{"line":121,"column":178}},"type":"cond-expr","locations":[{"start":{"line":121,"column":57},"end":{"line":121,"column":63}},{"start":{"line":121,"column":66},"end":{"line":121,"column":178}}],"line":121},"28":{"loc":{"start":{"line":121,"column":16},"end":{"line":121,"column":54}},"type":"binary-expr","locations":[{"start":{"line":121,"column":16},"end":{"line":121,"column":32}},{"start":{"line":121,"column":36},"end":{"line":121,"column":54}}],"line":121},"29":{"loc":{"start":{"line":121,"column":66},"end":{"line":121,"column":178}},"type":"cond-expr","locations":[{"start":{"line":121,"column":148},"end":{"line":121,"column":154}},{"start":{"line":121,"column":157},"end":{"line":121,"column":178}}],"line":121},"30":{"loc":{"start":{"line":121,"column":66},"end":{"line":121,"column":145}},"type":"binary-expr","locations":[{"start":{"line":121,"column":66},"end":{"line":121,"column":113}},{"start":{"line":121,"column":117},"end":{"line":121,"column":145}}],"line":121},"31":{"loc":{"start":{"line":126,"column":23},"end":{"line":126,"column":46}},"type":"cond-expr","locations":[{"start":{"line":126,"column":31},"end":{"line":126,"column":42}},{"start":{"line":126,"column":45},"end":{"line":126,"column":46}}],"line":126},"32":{"loc":{"start":{"line":129,"column":48},"end":{"line":129,"column":63}},"type":"default-arg","locations":[{"start":{"line":129,"column":61},"end":{"line":129,"column":63}}],"line":129},"33":{"loc":{"start":{"line":136,"column":12},"end":{"line":139,"column":13}},"type":"if","locations":[{"start":{"line":136,"column":12},"end":{"line":139,"column":13}},{"start":{"line":136,"column":12},"end":{"line":139,"column":13}}],"line":136},"34":{"loc":{"start":{"line":136,"column":16},"end":{"line":136,"column":177}},"type":"cond-expr","locations":[{"start":{"line":136,"column":57},"end":{"line":136,"column":63}},{"start":{"line":136,"column":66},"end":{"line":136,"column":177}}],"line":136},"35":{"loc":{"start":{"line":136,"column":16},"end":{"line":136,"column":54}},"type":"binary-expr","locations":[{"start":{"line":136,"column":16},"end":{"line":136,"column":32}},{"start":{"line":136,"column":36},"end":{"line":136,"column":54}}],"line":136},"36":{"loc":{"start":{"line":136,"column":66},"end":{"line":136,"column":177}},"type":"cond-expr","locations":[{"start":{"line":136,"column":148},"end":{"line":136,"column":154}},{"start":{"line":136,"column":157},"end":{"line":136,"column":177}}],"line":136},"37":{"loc":{"start":{"line":136,"column":66},"end":{"line":136,"column":145}},"type":"binary-expr","locations":[{"start":{"line":136,"column":66},"end":{"line":136,"column":113}},{"start":{"line":136,"column":117},"end":{"line":136,"column":145}}],"line":136},"38":{"loc":{"start":{"line":141,"column":24},"end":{"line":141,"column":48}},"type":"cond-expr","locations":[{"start":{"line":141,"column":32},"end":{"line":141,"column":44}},{"start":{"line":141,"column":47},"end":{"line":141,"column":48}}],"line":141}},"s":{"0":1,"1":1,"2":31,"3":1,"4":3,"5":1,"6":2,"7":7,"8":2,"9":1,"10":1,"11":1,"12":1,"13":0,"14":0,"15":1,"16":3,"17":5,"18":5,"19":5,"20":5,"21":4,"22":4,"23":5,"24":5,"25":5,"26":5,"27":5,"28":5,"29":4,"30":5,"31":5,"32":5,"33":5,"34":5,"35":4,"36":4,"37":5,"38":5,"39":4,"40":4,"41":5,"42":4,"43":4,"44":1,"45":4,"46":4,"47":4,"48":4,"49":5,"50":4,"51":4,"52":4,"53":4,"54":5,"55":5,"56":5,"57":5,"58":4,"59":4,"60":5,"61":5,"62":31},"f":{"0":31,"1":3,"2":7,"3":3,"4":5,"5":5,"6":5,"7":5,"8":5,"9":5,"10":4,"11":5,"12":4,"13":5,"14":5,"15":5,"16":31},"b":{"0":[1,2],"1":[2,1,1,1,1,0,0,1],"2":[3],"3":[5],"4":[4,1],"5":[0,5],"6":[5,5],"7":[3,2],"8":[5],"9":[4,1],"10":[5],"11":[4,1],"12":[0,5],"13":[5,5],"14":[1,4],"15":[5,5],"16":[3,2],"17":[4],"18":[4,1],"19":[0,5],"20":[5,5],"21":[1,4],"22":[5,5],"23":[1,3],"24":[1,3],"25":[4],"26":[4,1],"27":[0,5],"28":[5,5],"29":[1,4],"30":[5,5],"31":[3,1],"32":[5],"33":[4,1],"34":[0,5],"35":[5,5],"36":[1,4],"37":[5,5],"38":[3,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-analytics/ChartData.ts"],"sourcesContent":["import type { IOmnichannelRoom } from '@rocket.chat/core-typings';\nimport type { ILivechatRoomsModel } from '@rocket.chat/model-typings';\nimport type { Filter } from 'mongodb';\n\n/* eslint-disable new-cap */\ntype ChartDataValidActions =\n\t| 'Total_conversations'\n\t| 'Avg_chat_duration'\n\t| 'Total_messages'\n\t| 'Avg_first_response_time'\n\t| 'Avg_reaction_time'\n\t| 'Best_first_response_time'\n\t| 'Avg_response_time';\n\ntype DateParam = {\n\tgte: Date;\n\tlte: Date;\n};\n\nexport class ChartData {\n\tconstructor(private readonly roomsModel: ILivechatRoomsModel) {}\n\n\tisActionAllowed(action: string | undefined): action is ChartDataValidActions {\n\t\tif (!action) {\n\t\t\treturn false;\n\t\t}\n\t\treturn [\n\t\t\t'Total_conversations',\n\t\t\t'Avg_chat_duration',\n\t\t\t'Total_messages',\n\t\t\t'Avg_first_response_time',\n\t\t\t'Avg_reaction_time',\n\t\t\t'Best_first_response_time',\n\t\t\t'Avg_response_time',\n\t\t].includes(action);\n\t}\n\n\tcallAction<T extends ChartDataValidActions>(action: T, ...args: [DateParam, string?, Filter<IOmnichannelRoom>?]) {\n\t\tswitch (action) {\n\t\t\tcase 'Total_conversations':\n\t\t\t\treturn this.Total_conversations(...args);\n\t\t\tcase 'Avg_chat_duration':\n\t\t\t\treturn this.Avg_chat_duration(...args);\n\t\t\tcase 'Total_messages':\n\t\t\t\treturn this.Total_messages(...args);\n\t\t\tcase 'Avg_first_response_time':\n\t\t\t\treturn this.Avg_first_response_time(...args);\n\t\t\tcase 'Avg_reaction_time':\n\t\t\t\treturn this.Avg_reaction_time(...args);\n\t\t\tcase 'Best_first_response_time':\n\t\t\t\treturn this.Best_first_response_time(...args);\n\t\t\tcase 'Avg_response_time':\n\t\t\t\treturn this.Avg_response_time(...args);\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Invalid action');\n\t\t}\n\t}\n\n\tasync Total_conversations(date: DateParam, departmentId?: string, extraQuery: Filter<IOmnichannelRoom> = {}) {\n\t\t// @ts-expect-error - Check extraquery usage on this func\n\t\treturn this.roomsModel.getTotalConversationsBetweenDate('l', date, { departmentId }, extraQuery);\n\t}\n\n\tasync Avg_chat_duration(date: DateParam, departmentId?: string, extraQuery: Filter<IOmnichannelRoom> = {}) {\n\t\tlet total = 0;\n\t\tlet count = 0;\n\n\t\tawait this.roomsModel.getAnalyticsMetricsBetweenDate('l', date, { departmentId }, extraQuery).forEach(({ metrics }) => {\n\t\t\tif (metrics?.chatDuration) {\n\t\t\t\ttotal += metrics.chatDuration;\n\t\t\t\tcount++;\n\t\t\t}\n\t\t});\n\n\t\tconst avgCD = count ? total / count : 0;\n\t\treturn Math.round(avgCD * 100) / 100;\n\t}\n\n\tasync Total_messages(date: DateParam, departmentId?: string, extraQuery: Filter<IOmnichannelRoom> = {}) {\n\t\tlet total = 0;\n\n\t\t// we don't want to count visitor messages\n\t\tconst extraFilter = { $lte: ['$token', null] };\n\t\tawait this.roomsModel\n\t\t\t.getAnalyticsMetricsBetweenDateWithMessages('l', date, { departmentId }, extraFilter, extraQuery)\n\t\t\t.forEach(({ msgs }) => {\n\t\t\t\tif (msgs) {\n\t\t\t\t\ttotal += msgs;\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn total;\n\t}\n\n\tasync Avg_first_response_time(date: DateParam, departmentId?: string, extraQuery: Filter<IOmnichannelRoom> = {}) {\n\t\tlet frt = 0;\n\t\tlet count = 0;\n\t\tawait this.roomsModel.getAnalyticsMetricsBetweenDate('l', date, { departmentId }, extraQuery).forEach(({ metrics }) => {\n\t\t\tif (metrics?.response?.ft) {\n\t\t\t\tfrt += metrics.response.ft;\n\t\t\t\tcount++;\n\t\t\t}\n\t\t});\n\n\t\tconst avgFrt = count ? frt / count : 0;\n\t\treturn Math.round(avgFrt * 100) / 100;\n\t}\n\n\tasync Best_first_response_time(date: DateParam, departmentId?: string, extraQuery: Filter<IOmnichannelRoom> = {}) {\n\t\tlet maxFrt = 0;\n\n\t\tawait this.roomsModel.getAnalyticsMetricsBetweenDate('l', date, { departmentId }, extraQuery).forEach(({ metrics }) => {\n\t\t\tif (metrics?.response?.ft) {\n\t\t\t\tmaxFrt = maxFrt ? Math.min(maxFrt, metrics.response.ft) : metrics.response.ft;\n\t\t\t}\n\t\t});\n\n\t\tif (!maxFrt) {\n\t\t\tmaxFrt = 0;\n\t\t}\n\n\t\treturn Math.round(maxFrt * 100) / 100;\n\t}\n\n\tasync Avg_response_time(date: DateParam, departmentId?: string, extraQuery: Filter<IOmnichannelRoom> = {}) {\n\t\tlet art = 0;\n\t\tlet count = 0;\n\t\tawait this.roomsModel.getAnalyticsMetricsBetweenDate('l', date, { departmentId }, extraQuery).forEach(({ metrics }) => {\n\t\t\tif (metrics?.response?.avg) {\n\t\t\t\tart += metrics.response.avg;\n\t\t\t\tcount++;\n\t\t\t}\n\t\t});\n\n\t\tconst avgArt = count ? art / count : 0;\n\n\t\treturn Math.round(avgArt * 100) / 100;\n\t}\n\n\tasync Avg_reaction_time(date: DateParam, departmentId?: string, extraQuery: Filter<IOmnichannelRoom> = {}) {\n\t\tlet arnt = 0;\n\t\tlet count = 0;\n\t\tawait this.roomsModel.getAnalyticsMetricsBetweenDate('l', date, { departmentId }, extraQuery).forEach(({ metrics }) => {\n\t\t\tif (metrics?.reaction?.ft) {\n\t\t\t\tarnt += metrics.reaction.ft;\n\t\t\t\tcount++;\n\t\t\t}\n\t\t});\n\n\t\tconst avgArnt = count ? arnt / count : 0;\n\n\t\treturn Math.round(avgArnt * 100) / 100;\n\t}\n}\n"],"names":["ChartData","isActionAllowed","action","includes","callAction","args","Total_conversations","Avg_chat_duration","Total_messages","Avg_first_response_time","Avg_reaction_time","Best_first_response_time","Avg_response_time","Error","date","departmentId","extraQuery","roomsModel","getTotalConversationsBetweenDate","total","count","getAnalyticsMetricsBetweenDate","forEach","metrics","chatDuration","avgCD","Math","round","extraFilter","$lte","getAnalyticsMetricsBetweenDateWithMessages","msgs","frt","response","ft","avgFrt","maxFrt","min","art","avg","avgArt","arnt","reaction","avgArnt","constructor"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-analytics/ChartData.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"e4420366e9e2d0e96fccb0cf84577f9156ee0780","contentHash":"f93e2865f449dfc916e018ecfca16b872e1a89894e06dfb624d39a2994938e58"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-analytics/OverviewData.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-analytics/OverviewData.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":28}},"3":{"start":{"line":11,"column":38},"end":{"line":11,"column":90}},"4":{"start":{"line":12,"column":25},"end":{"line":12,"column":70}},"5":{"start":{"line":14,"column":4},"end":{"line":16,"column":6}},"6":{"start":{"line":18,"column":19},"end":{"line":190,"column":1}},"7":{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},"8":{"start":{"line":21,"column":12},"end":{"line":21,"column":25}},"9":{"start":{"line":23,"column":8},"end":{"line":26,"column":27}},"10":{"start":{"line":29,"column":8},"end":{"line":36,"column":9}},"11":{"start":{"line":31,"column":16},"end":{"line":31,"column":51}},"12":{"start":{"line":33,"column":16},"end":{"line":33,"column":50}},"13":{"start":{"line":35,"column":16},"end":{"line":35,"column":50}},"14":{"start":{"line":39,"column":23},"end":{"line":39,"column":24}},"15":{"start":{"line":40,"column":21},"end":{"line":40,"column":24}},"16":{"start":{"line":41,"column":8},"end":{"line":46,"column":11}},"17":{"start":{"line":42,"column":12},"end":{"line":45,"column":13}},"18":{"start":{"line":43,"column":16},"end":{"line":43,"column":33}},"19":{"start":{"line":44,"column":16},"end":{"line":44,"column":29}},"20":{"start":{"line":47,"column":8},"end":{"line":47,"column":22}},"21":{"start":{"line":50,"column":18},"end":{"line":50,"column":19}},"22":{"start":{"line":51,"column":8},"end":{"line":53,"column":11}},"23":{"start":{"line":52,"column":12},"end":{"line":52,"column":25}},"24":{"start":{"line":54,"column":8},"end":{"line":54,"column":19}},"25":{"start":{"line":57,"column":27},"end":{"line":57,"column":29}},"26":{"start":{"line":58,"column":25},"end":{"line":58,"column":28}},"27":{"start":{"line":59,"column":8},"end":{"line":65,"column":11}},"28":{"start":{"line":60,"column":22},"end":{"line":60,"column":47}},"29":{"start":{"line":61,"column":12},"end":{"line":64,"column":13}},"30":{"start":{"line":62,"column":16},"end":{"line":62,"column":33}},"31":{"start":{"line":63,"column":16},"end":{"line":63,"column":33}},"32":{"start":{"line":66,"column":8},"end":{"line":66,"column":26}},"33":{"start":{"line":69,"column":19},"end":{"line":69,"column":20}},"34":{"start":{"line":70,"column":8},"end":{"line":75,"column":11}},"35":{"start":{"line":74,"column":12},"end":{"line":74,"column":110}},"36":{"start":{"line":76,"column":8},"end":{"line":76,"column":20}},"37":{"start":{"line":78,"column":75},"end":{"line":78,"column":76}},"38":{"start":{"line":79,"column":29},"end":{"line":79,"column":38}},"39":{"start":{"line":80,"column":32},"end":{"line":80,"column":33}},"40":{"start":{"line":81,"column":28},"end":{"line":81,"column":29}},"41":{"start":{"line":82,"column":33},"end":{"line":82,"column":34}},"42":{"start":{"line":83,"column":21},"end":{"line":83,"column":46}},"43":{"start":{"line":84,"column":21},"end":{"line":87,"column":9}},"44":{"start":{"line":89,"column":23},"end":{"line":91,"column":22}},"45":{"start":{"line":92,"column":8},"end":{"line":108,"column":9}},"46":{"start":{"line":93,"column":12},"end":{"line":93,"column":33}},"47":{"start":{"line":94,"column":12},"end":{"line":96,"column":13}},"48":{"start":{"line":95,"column":16},"end":{"line":95,"column":36}},"49":{"start":{"line":97,"column":32},"end":{"line":97,"column":98}},"50":{"start":{"line":98,"column":33},"end":{"line":98,"column":90}},"51":{"start":{"line":99,"column":12},"end":{"line":101,"column":13}},"52":{"start":{"line":100,"column":16},"end":{"line":100,"column":57}},"53":{"start":{"line":102,"column":27},"end":{"line":102,"column":56}},"54":{"start":{"line":103,"column":12},"end":{"line":105,"column":13}},"55":{"start":{"line":104,"column":16},"end":{"line":104,"column":44}},"56":{"start":{"line":106,"column":12},"end":{"line":106,"column":114}},"57":{"start":{"line":107,"column":12},"end":{"line":107,"column":39}},"58":{"start":{"line":110,"column":36},"end":{"line":110,"column":127}},"59":{"start":{"line":111,"column":34},"end":{"line":111,"column":66}},"60":{"start":{"line":112,"column":28},"end":{"line":112,"column":107}},"61":{"start":{"line":113,"column":32},"end":{"line":113,"column":128}},"62":{"start":{"line":114,"column":30},"end":{"line":114,"column":141}},"63":{"start":{"line":115,"column":27},"end":{"line":115,"column":144}},"64":{"start":{"line":116,"column":8},"end":{"line":145,"column":10}},"65":{"start":{"line":147,"column":68},"end":{"line":147,"column":69}},"66":{"start":{"line":148,"column":30},"end":{"line":148,"column":31}},"67":{"start":{"line":149,"column":32},"end":{"line":149,"column":33}},"68":{"start":{"line":150,"column":30},"end":{"line":150,"column":31}},"69":{"start":{"line":151,"column":20},"end":{"line":151,"column":21}},"70":{"start":{"line":152,"column":21},"end":{"line":155,"column":9}},"71":{"start":{"line":156,"column":8},"end":{"line":165,"column":11}},"72":{"start":{"line":159,"column":12},"end":{"line":164,"column":13}},"73":{"start":{"line":160,"column":16},"end":{"line":160,"column":56}},"74":{"start":{"line":161,"column":16},"end":{"line":161,"column":57}},"75":{"start":{"line":162,"column":16},"end":{"line":162,"column":55}},"76":{"start":{"line":163,"column":16},"end":{"line":163,"column":24}},"77":{"start":{"line":166,"column":8},"end":{"line":170,"column":9}},"78":{"start":{"line":167,"column":12},"end":{"line":167,"column":37}},"79":{"start":{"line":168,"column":12},"end":{"line":168,"column":39}},"80":{"start":{"line":169,"column":12},"end":{"line":169,"column":37}},"81":{"start":{"line":171,"column":21},"end":{"line":184,"column":9}},"82":{"start":{"line":185,"column":8},"end":{"line":185,"column":20}},"83":{"start":{"line":188,"column":8},"end":{"line":188,"column":37}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":13,"column":9},"end":{"line":13,"column":33}},"loc":{"start":{"line":13,"column":39},"end":{"line":17,"column":1}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":19,"column":4},"end":{"line":19,"column":5}},"loc":{"start":{"line":19,"column":28},"end":{"line":27,"column":5}},"line":19},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":4},"end":{"line":28,"column":5}},"loc":{"start":{"line":28,"column":32},"end":{"line":37,"column":5}},"line":28},"4":{"name":"(anonymous_4)","decl":{"start":{"line":38,"column":4},"end":{"line":38,"column":5}},"loc":{"start":{"line":38,"column":35},"end":{"line":48,"column":5}},"line":38},"5":{"name":"(anonymous_5)","decl":{"start":{"line":41,"column":20},"end":{"line":41,"column":21}},"loc":{"start":{"line":41,"column":34},"end":{"line":46,"column":9}},"line":41},"6":{"name":"(anonymous_6)","decl":{"start":{"line":49,"column":4},"end":{"line":49,"column":5}},"loc":{"start":{"line":49,"column":23},"end":{"line":55,"column":5}},"line":49},"7":{"name":"(anonymous_7)","decl":{"start":{"line":51,"column":20},"end":{"line":51,"column":21}},"loc":{"start":{"line":51,"column":29},"end":{"line":53,"column":9}},"line":51},"8":{"name":"(anonymous_8)","decl":{"start":{"line":56,"column":4},"end":{"line":56,"column":5}},"loc":{"start":{"line":56,"column":23},"end":{"line":67,"column":5}},"line":56},"9":{"name":"(anonymous_9)","decl":{"start":{"line":59,"column":20},"end":{"line":59,"column":21}},"loc":{"start":{"line":59,"column":34},"end":{"line":65,"column":9}},"line":59},"10":{"name":"(anonymous_10)","decl":{"start":{"line":68,"column":4},"end":{"line":68,"column":5}},"loc":{"start":{"line":68,"column":27},"end":{"line":77,"column":5}},"line":68},"11":{"name":"(anonymous_11)","decl":{"start":{"line":72,"column":18},"end":{"line":72,"column":19}},"loc":{"start":{"line":72,"column":25},"end":{"line":75,"column":9}},"line":72},"12":{"name":"(anonymous_12)","decl":{"start":{"line":78,"column":4},"end":{"line":78,"column":5}},"loc":{"start":{"line":78,"column":95},"end":{"line":146,"column":5}},"line":78},"13":{"name":"(anonymous_13)","decl":{"start":{"line":78,"column":70},"end":{"line":78,"column":71}},"loc":{"start":{"line":78,"column":75},"end":{"line":78,"column":76}},"line":78},"14":{"name":"(anonymous_14)","decl":{"start":{"line":147,"column":4},"end":{"line":147,"column":5}},"loc":{"start":{"line":147,"column":83},"end":{"line":186,"column":5}},"line":147},"15":{"name":"(anonymous_15)","decl":{"start":{"line":147,"column":63},"end":{"line":147,"column":64}},"loc":{"start":{"line":147,"column":68},"end":{"line":147,"column":69}},"line":147},"16":{"name":"(anonymous_16)","decl":{"start":{"line":158,"column":31},"end":{"line":158,"column":32}},"loc":{"start":{"line":158,"column":46},"end":{"line":165,"column":9}},"line":158},"17":{"name":"(anonymous_17)","decl":{"start":{"line":187,"column":4},"end":{"line":187,"column":5}},"loc":{"start":{"line":187,"column":27},"end":{"line":189,"column":5}},"line":187}},"branchMap":{"0":{"loc":{"start":{"line":14,"column":11},"end":{"line":16,"column":5}},"type":"cond-expr","locations":[{"start":{"line":14,"column":35},"end":{"line":14,"column":38}},{"start":{"line":14,"column":41},"end":{"line":16,"column":5}}],"line":14},"1":{"loc":{"start":{"line":14,"column":11},"end":{"line":14,"column":32}},"type":"binary-expr","locations":[{"start":{"line":14,"column":11},"end":{"line":14,"column":14}},{"start":{"line":14,"column":18},"end":{"line":14,"column":32}}],"line":14},"2":{"loc":{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},"type":"if","locations":[{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},{"start":{"line":20,"column":8},"end":{"line":22,"column":9}}],"line":20},"3":{"loc":{"start":{"line":29,"column":8},"end":{"line":36,"column":9}},"type":"switch","locations":[{"start":{"line":30,"column":12},"end":{"line":31,"column":51}},{"start":{"line":32,"column":12},"end":{"line":33,"column":50}},{"start":{"line":34,"column":12},"end":{"line":35,"column":50}}],"line":29},"4":{"loc":{"start":{"line":42,"column":12},"end":{"line":45,"column":13}},"type":"if","locations":[{"start":{"line":42,"column":12},"end":{"line":45,"column":13}},{"start":{"line":42,"column":12},"end":{"line":45,"column":13}}],"line":42},"5":{"loc":{"start":{"line":61,"column":12},"end":{"line":64,"column":13}},"type":"if","locations":[{"start":{"line":61,"column":12},"end":{"line":64,"column":13}},{"start":{"line":61,"column":12},"end":{"line":64,"column":13}}],"line":61},"6":{"loc":{"start":{"line":74,"column":20},"end":{"line":74,"column":109}},"type":"binary-expr","locations":[{"start":{"line":74,"column":21},"end":{"line":74,"column":103}},{"start":{"line":74,"column":108},"end":{"line":74,"column":109}}],"line":74},"7":{"loc":{"start":{"line":74,"column":21},"end":{"line":74,"column":103}},"type":"cond-expr","locations":[{"start":{"line":74,"column":81},"end":{"line":74,"column":87}},{"start":{"line":74,"column":90},"end":{"line":74,"column":103}}],"line":74},"8":{"loc":{"start":{"line":74,"column":21},"end":{"line":74,"column":78}},"type":"binary-expr","locations":[{"start":{"line":74,"column":21},"end":{"line":74,"column":55}},{"start":{"line":74,"column":59},"end":{"line":74,"column":78}}],"line":74},"9":{"loc":{"start":{"line":78,"column":48},"end":{"line":78,"column":64}},"type":"default-arg","locations":[{"start":{"line":78,"column":59},"end":{"line":78,"column":64}}],"line":78},"10":{"loc":{"start":{"line":78,"column":66},"end":{"line":78,"column":76}},"type":"default-arg","locations":[{"start":{"line":78,"column":70},"end":{"line":78,"column":76}}],"line":78},"11":{"loc":{"start":{"line":78,"column":78},"end":{"line":78,"column":93}},"type":"default-arg","locations":[{"start":{"line":78,"column":91},"end":{"line":78,"column":93}}],"line":78},"12":{"loc":{"start":{"line":94,"column":12},"end":{"line":96,"column":13}},"type":"if","locations":[{"start":{"line":94,"column":12},"end":{"line":96,"column":13}},{"start":{"line":94,"column":12},"end":{"line":96,"column":13}}],"line":94},"13":{"loc":{"start":{"line":94,"column":16},"end":{"line":94,"column":74}},"type":"binary-expr","locations":[{"start":{"line":94,"column":16},"end":{"line":94,"column":28}},{"start":{"line":94,"column":32},"end":{"line":94,"column":58}},{"start":{"line":94,"column":62},"end":{"line":94,"column":74}}],"line":94},"14":{"loc":{"start":{"line":99,"column":12},"end":{"line":101,"column":13}},"type":"if","locations":[{"start":{"line":99,"column":12},"end":{"line":101,"column":13}},{"start":{"line":99,"column":12},"end":{"line":101,"column":13}}],"line":99},"15":{"loc":{"start":{"line":103,"column":12},"end":{"line":105,"column":13}},"type":"if","locations":[{"start":{"line":103,"column":12},"end":{"line":105,"column":13}},{"start":{"line":103,"column":12},"end":{"line":105,"column":13}}],"line":103},"16":{"loc":{"start":{"line":106,"column":37},"end":{"line":106,"column":112}},"type":"cond-expr","locations":[{"start":{"line":106,"column":64},"end":{"line":106,"column":100}},{"start":{"line":106,"column":103},"end":{"line":106,"column":112}}],"line":106},"17":{"loc":{"start":{"line":112,"column":54},"end":{"line":112,"column":102}},"type":"binary-expr","locations":[{"start":{"line":112,"column":54},"end":{"line":112,"column":89}},{"start":{"line":112,"column":93},"end":{"line":112,"column":102}}],"line":112},"18":{"loc":{"start":{"line":113,"column":32},"end":{"line":113,"column":128}},"type":"cond-expr","locations":[{"start":{"line":113,"column":51},"end":{"line":113,"column":123}},{"start":{"line":113,"column":126},"end":{"line":113,"column":128}}],"line":113},"19":{"loc":{"start":{"line":114,"column":30},"end":{"line":114,"column":141}},"type":"cond-expr","locations":[{"start":{"line":114,"column":49},"end":{"line":114,"column":136}},{"start":{"line":114,"column":139},"end":{"line":114,"column":141}}],"line":114},"20":{"loc":{"start":{"line":115,"column":27},"end":{"line":115,"column":144}},"type":"cond-expr","locations":[{"start":{"line":115,"column":55},"end":{"line":115,"column":139}},{"start":{"line":115,"column":142},"end":{"line":115,"column":144}}],"line":115},"21":{"loc":{"start":{"line":135,"column":23},"end":{"line":135,"column":43}},"type":"binary-expr","locations":[{"start":{"line":135,"column":23},"end":{"line":135,"column":36}},{"start":{"line":135,"column":40},"end":{"line":135,"column":43}}],"line":135},"22":{"loc":{"start":{"line":143,"column":23},"end":{"line":143,"column":95}},"type":"binary-expr","locations":[{"start":{"line":143,"column":23},"end":{"line":143,"column":88}},{"start":{"line":143,"column":92},"end":{"line":143,"column":95}}],"line":143},"23":{"loc":{"start":{"line":143,"column":44},"end":{"line":143,"column":86}},"type":"cond-expr","locations":[{"start":{"line":143,"column":60},"end":{"line":143,"column":81}},{"start":{"line":143,"column":84},"end":{"line":143,"column":86}}],"line":143},"24":{"loc":{"start":{"line":147,"column":58},"end":{"line":147,"column":69}},"type":"default-arg","locations":[{"start":{"line":147,"column":63},"end":{"line":147,"column":69}}],"line":147},"25":{"loc":{"start":{"line":159,"column":12},"end":{"line":164,"column":13}},"type":"if","locations":[{"start":{"line":159,"column":12},"end":{"line":164,"column":13}},{"start":{"line":159,"column":12},"end":{"line":164,"column":13}}],"line":159},"26":{"loc":{"start":{"line":159,"column":16},"end":{"line":159,"column":104}},"type":"binary-expr","locations":[{"start":{"line":159,"column":17},"end":{"line":159,"column":83}},{"start":{"line":159,"column":88},"end":{"line":159,"column":104}}],"line":159},"27":{"loc":{"start":{"line":159,"column":17},"end":{"line":159,"column":83}},"type":"cond-expr","locations":[{"start":{"line":159,"column":58},"end":{"line":159,"column":64}},{"start":{"line":159,"column":67},"end":{"line":159,"column":83}}],"line":159},"28":{"loc":{"start":{"line":159,"column":17},"end":{"line":159,"column":55}},"type":"binary-expr","locations":[{"start":{"line":159,"column":17},"end":{"line":159,"column":33}},{"start":{"line":159,"column":37},"end":{"line":159,"column":55}}],"line":159},"29":{"loc":{"start":{"line":166,"column":8},"end":{"line":170,"column":9}},"type":"if","locations":[{"start":{"line":166,"column":8},"end":{"line":170,"column":9}},{"start":{"line":166,"column":8},"end":{"line":170,"column":9}}],"line":166}},"s":{"0":1,"1":1,"2":24,"3":1,"4":1,"5":1,"6":1,"7":3,"8":1,"9":2,"10":3,"11":1,"12":1,"13":1,"14":8,"15":8,"16":8,"17":5,"18":5,"19":5,"20":8,"21":12,"22":12,"23":20,"24":12,"25":9,"26":9,"27":9,"28":8,"29":8,"30":5,"31":5,"32":9,"33":0,"34":0,"35":0,"36":0,"37":3,"38":6,"39":6,"40":6,"41":6,"42":6,"43":6,"44":6,"45":6,"46":2,"47":2,"48":0,"49":2,"50":2,"51":2,"52":2,"53":2,"54":2,"55":2,"56":2,"57":2,"58":6,"59":6,"60":6,"61":6,"62":6,"63":6,"64":6,"65":0,"66":6,"67":6,"68":6,"69":6,"70":6,"71":6,"72":16,"73":4,"74":4,"75":4,"76":4,"77":6,"78":2,"79":2,"80":2,"81":6,"82":6,"83":24},"f":{"0":24,"1":1,"2":3,"3":3,"4":8,"5":5,"6":12,"7":20,"8":9,"9":8,"10":0,"11":0,"12":6,"13":3,"14":6,"15":0,"16":16,"17":24},"b":{"0":[0,1],"1":[1,1],"2":[1,2],"3":[1,1,1],"4":[5,0],"5":[5,3],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0],"10":[3],"11":[3],"12":[0,2],"13":[2,0,0],"14":[2,0],"15":[2,0],"16":[0,2],"17":[6,4],"18":[2,4],"19":[2,4],"20":[2,4],"21":[6,4],"22":[6,4],"23":[2,4],"24":[3],"25":[4,12],"26":[16,4],"27":[12,4],"28":[16,16],"29":[2,4]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-analytics/OverviewData.ts"],"sourcesContent":["/* eslint-disable new-cap */\nimport type { IOmnichannelRoom } from '@rocket.chat/core-typings';\nimport type { ILivechatRoomsModel } from '@rocket.chat/model-typings';\nimport moment from 'moment-timezone';\nimport type { Filter } from 'mongodb';\n\nimport { secondsToHHMMSS } from '../../../lib/utils/secondsToHHMMSS';\n\ntype OverviewDataValidActions = 'Conversations' | 'Productivity';\n\nexport class OverviewData {\n\tconstructor(private readonly roomsModel: ILivechatRoomsModel) {}\n\n\tisActionAllowed(action: string | undefined): action is OverviewDataValidActions {\n\t\tif (!action) {\n\t\t\treturn false;\n\t\t}\n\t\treturn ['Conversations', 'Productivity'].includes(action);\n\t}\n\n\tcallAction<T extends OverviewDataValidActions>(\n\t\taction: T,\n\t\t...args: [moment.Moment, moment.Moment, string?, string?, ((v: string) => string)?, Filter<IOmnichannelRoom>?]\n\t) {\n\t\tswitch (action) {\n\t\t\tcase 'Conversations':\n\t\t\t\treturn this.Conversations(...args);\n\t\t\tcase 'Productivity':\n\t\t\t\treturn this.Productivity(...args);\n\t\t\tdefault:\n\t\t\t\tthrow new Error('Invalid action');\n\t\t}\n\t}\n\n\tgetKeyHavingMaxValue<T>(map: Map<T, number>, def: T): T {\n\t\tlet maxValue = 0;\n\t\tlet maxKey = def; // default\n\n\t\tmap.forEach((value, key) => {\n\t\t\tif (value > maxValue) {\n\t\t\t\tmaxValue = value;\n\t\t\t\tmaxKey = key;\n\t\t\t}\n\t\t});\n\n\t\treturn maxKey;\n\t}\n\n\tsumAllMapKeys<T>(map: Map<T, number>): number {\n\t\tlet sum = 0;\n\n\t\tmap.forEach((value) => {\n\t\t\tsum += value;\n\t\t});\n\n\t\treturn sum;\n\t}\n\n\tgetBusiestDay(map: Map<string, Map<string, number>>): string {\n\t\tlet mostMessages = -1;\n\t\tlet busiestDay = '-';\n\n\t\tmap.forEach((value, key) => {\n\t\t\tconst v = this.sumAllMapKeys(value);\n\t\t\tif (v > mostMessages) {\n\t\t\t\tmostMessages = v;\n\t\t\t\tbusiestDay = key;\n\t\t\t}\n\t\t});\n\n\t\treturn busiestDay;\n\t}\n\n\tgetAllMapKeysSize<T>(map: Map<T, Map<T, number>>): number {\n\t\tlet size = 0;\n\n\t\t[...map.keys()].forEach((key) => {\n\t\t\tsize += map.get(key)?.size || 0;\n\t\t});\n\n\t\treturn size;\n\t}\n\n\tasync Conversations(\n\t\tfrom: moment.Moment,\n\t\tto: moment.Moment,\n\t\tdepartmentId?: string,\n\t\ttimezone = 'UTC',\n\t\tt = (v: string): string => v,\n\t\textraQuery: Filter<IOmnichannelRoom> = {},\n\t) {\n\t\tconst analyticsMap = new Map();\n\t\tlet openConversations = 0; // open conversations\n\t\tlet totalMessages = 0; // total msgs\n\t\tlet totalConversations = 0; // Total conversations\n\t\tconst days = to.diff(from, 'days') + 1; // total days\n\n\t\tconst date = {\n\t\t\tgte: moment.tz(from, timezone).startOf('day').utc(),\n\t\t\tlte: moment.tz(to, timezone).endOf('day').utc(),\n\t\t};\n\n\t\t// @ts-expect-error - Check extraquery usage on this func\n\t\tconst cursor = this.roomsModel.getAnalyticsBetweenDate(date, { departmentId }, extraQuery);\n\n\t\tfor await (const room of cursor) {\n\t\t\ttotalConversations++;\n\n\t\t\tif (room.metrics && !room.metrics.chatDuration && !room.onHold) {\n\t\t\t\topenConversations++;\n\t\t\t}\n\t\t\tconst creationDay = moment.tz(room.ts, timezone).format('DD-MM-YYYY'); // @string: 01-01-2021\n\t\t\tconst creationHour = moment.tz(room.ts, timezone).format('H'); // @int : 0, 1, ... 23\n\n\t\t\tif (!analyticsMap.has(creationDay)) {\n\t\t\t\tanalyticsMap.set(creationDay, new Map());\n\t\t\t}\n\n\t\t\tconst dayMap = analyticsMap.get(creationDay);\n\n\t\t\tif (!dayMap.has(creationHour)) {\n\t\t\t\tdayMap.set(creationHour, 0);\n\t\t\t}\n\n\t\t\tdayMap.set(creationHour, dayMap.get(creationHour) ? dayMap.get(creationHour) + room.msgs : room.msgs);\n\t\t\ttotalMessages += room.msgs;\n\t\t}\n\n\t\t// @ts-expect-error - Check extraquery usage on this func\n\t\tconst onHoldConversations = await this.roomsModel.getOnHoldConversationsBetweenDate(from, to, departmentId, extraQuery);\n\t\tconst busiestDayFromMap = this.getBusiestDay(analyticsMap); // returns busiest day based on the number of messages sent on that day\n\t\tconst busiestHour = this.getKeyHavingMaxValue<number>(analyticsMap.get(busiestDayFromMap) || new Map(), -1); // returns key with max value\n\t\tconst busiestTimeFrom = busiestHour >= 0 ? moment.tz(`${busiestHour}`, 'H', timezone).format('hA') : ''; // @string: 12AM, 1AM ...\n\t\tconst busiestTimeTo = busiestHour >= 0 ? moment.tz(`${busiestHour}`, 'H', timezone).add(1, 'hour').format('hA') : ''; // @string: 1AM, 2AM ...\n\t\tconst busiestDay = busiestDayFromMap !== '-' ? moment.tz(busiestDayFromMap, 'DD-MM-YYYY', timezone).format('dddd') : ''; // @string: Monday, Tuesday ...\n\n\t\treturn [\n\t\t\t{\n\t\t\t\ttitle: 'Total_conversations',\n\t\t\t\tvalue: totalConversations,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'Open_conversations',\n\t\t\t\tvalue: openConversations,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'On_Hold_conversations',\n\t\t\t\tvalue: onHoldConversations,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'Total_messages',\n\t\t\t\tvalue: totalMessages,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'Busiest_day',\n\t\t\t\tvalue: t(busiestDay) || '-',\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'Conversations_per_day',\n\t\t\t\tvalue: (totalConversations / days).toFixed(2),\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'Busiest_time',\n\t\t\t\tvalue: `${busiestTimeFrom}${busiestTimeTo ? ` - ${busiestTimeTo}` : ''}` || '-',\n\t\t\t},\n\t\t];\n\t}\n\n\tasync Productivity(\n\t\tfrom: moment.Moment,\n\t\tto: moment.Moment,\n\t\tdepartmentId?: string,\n\t\t_timezone?: string,\n\t\t_t = (v: string): string => v,\n\t\textraQuery?: Filter<IOmnichannelRoom>,\n\t) {\n\t\tlet avgResponseTime = 0;\n\t\tlet firstResponseTime = 0;\n\t\tlet avgReactionTime = 0;\n\t\tlet count = 0;\n\n\t\tconst date = {\n\t\t\tgte: from.toDate(),\n\t\t\tlte: to.toDate(),\n\t\t};\n\n\t\tawait this.roomsModel.getAnalyticsMetricsBetweenDate('l', date, { departmentId }, extraQuery).forEach(({ metrics }) => {\n\t\t\tif (metrics?.response && metrics.reaction) {\n\t\t\t\tavgResponseTime += metrics.response.avg;\n\t\t\t\tfirstResponseTime += metrics.response.ft;\n\t\t\t\tavgReactionTime += metrics.reaction.ft;\n\t\t\t\tcount++;\n\t\t\t}\n\t\t});\n\n\t\tif (count) {\n\t\t\tavgResponseTime /= count;\n\t\t\tfirstResponseTime /= count;\n\t\t\tavgReactionTime /= count;\n\t\t}\n\n\t\tconst data = [\n\t\t\t{\n\t\t\t\ttitle: 'Avg_response_time',\n\t\t\t\tvalue: secondsToHHMMSS(avgResponseTime.toFixed(2)),\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'Avg_first_response_time',\n\t\t\t\tvalue: secondsToHHMMSS(firstResponseTime.toFixed(2)),\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'Avg_reaction_time',\n\t\t\t\tvalue: secondsToHHMMSS(avgReactionTime.toFixed(2)),\n\t\t\t},\n\t\t];\n\n\t\treturn data;\n\t}\n}\n"],"names":["OverviewData","isActionAllowed","action","includes","callAction","args","Conversations","Productivity","Error","getKeyHavingMaxValue","map","def","maxValue","maxKey","forEach","value","key","sumAllMapKeys","sum","getBusiestDay","mostMessages","busiestDay","v","getAllMapKeysSize","size","keys","get","from","to","departmentId","timezone","t","extraQuery","analyticsMap","Map","openConversations","totalMessages","totalConversations","days","diff","date","gte","moment","tz","startOf","utc","lte","endOf","cursor","roomsModel","getAnalyticsBetweenDate","room","metrics","chatDuration","onHold","creationDay","ts","format","creationHour","has","set","dayMap","msgs","onHoldConversations","getOnHoldConversationsBetweenDate","busiestDayFromMap","busiestHour","busiestTimeFrom","busiestTimeTo","add","title","toFixed","_timezone","_t","avgResponseTime","firstResponseTime","avgReactionTime","count","toDate","getAnalyticsMetricsBetweenDate","response","reaction","avg","ft","data","secondsToHHMMSS","constructor"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-analytics/OverviewData.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f8105f2b0fed439c59678c3b85ac8b4e5d90730b","contentHash":"0fd094921e6d68c934bfd79e31f6b069fdee4c8c883634b7669bec7466caad09"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel/queue.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel/queue.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":32}},"3":{"start":{"line":11,"column":17},"end":{"line":11,"column":48}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":46}},"5":{"start":{"line":13,"column":16},"end":{"line":13,"column":66}},"6":{"start":{"line":14,"column":24},"end":{"line":14,"column":82}},"7":{"start":{"line":15,"column":18},"end":{"line":15,"column":70}},"8":{"start":{"line":16,"column":16},"end":{"line":16,"column":55}},"9":{"start":{"line":17,"column":16},"end":{"line":17,"column":35}},"10":{"start":{"line":18,"column":29},"end":{"line":18,"column":33}},"11":{"start":{"line":19,"column":23},"end":{"line":210,"column":1}},"12":{"start":{"line":22,"column":24},"end":{"line":22,"column":154}},"13":{"start":{"line":23,"column":8},"end":{"line":23,"column":67}},"14":{"start":{"line":26,"column":8},"end":{"line":26,"column":28}},"15":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"16":{"start":{"line":30,"column":12},"end":{"line":30,"column":19}},"17":{"start":{"line":32,"column":29},"end":{"line":32,"column":57}},"18":{"start":{"line":33,"column":8},"end":{"line":33,"column":75}},"19":{"start":{"line":34,"column":8},"end":{"line":34,"column":28}},"20":{"start":{"line":35,"column":8},"end":{"line":35,"column":52}},"21":{"start":{"line":36,"column":8},"end":{"line":36,"column":30}},"22":{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},"23":{"start":{"line":40,"column":12},"end":{"line":40,"column":19}},"24":{"start":{"line":42,"column":8},"end":{"line":42,"column":50}},"25":{"start":{"line":43,"column":8},"end":{"line":43,"column":29}},"26":{"start":{"line":44,"column":8},"end":{"line":44,"column":52}},"27":{"start":{"line":48,"column":8},"end":{"line":50,"column":81}},"28":{"start":{"line":53,"column":8},"end":{"line":56,"column":9}},"29":{"start":{"line":54,"column":12},"end":{"line":54,"column":79}},"30":{"start":{"line":55,"column":12},"end":{"line":55,"column":55}},"31":{"start":{"line":57,"column":8},"end":{"line":57,"column":35}},"32":{"start":{"line":60,"column":8},"end":{"line":63,"column":9}},"33":{"start":{"line":61,"column":12},"end":{"line":61,"column":71}},"34":{"start":{"line":62,"column":12},"end":{"line":62,"column":19}},"35":{"start":{"line":64,"column":8},"end":{"line":68,"column":9}},"36":{"start":{"line":65,"column":12},"end":{"line":65,"column":79}},"37":{"start":{"line":66,"column":12},"end":{"line":66,"column":33}},"38":{"start":{"line":67,"column":12},"end":{"line":67,"column":19}},"39":{"start":{"line":69,"column":22},"end":{"line":69,"column":44}},"40":{"start":{"line":70,"column":34},"end":{"line":70,"column":46}},"41":{"start":{"line":71,"column":8},"end":{"line":71,"column":111}},"42":{"start":{"line":72,"column":8},"end":{"line":74,"column":11}},"43":{"start":{"line":73,"column":12},"end":{"line":73,"column":41}},"44":{"start":{"line":77,"column":8},"end":{"line":77,"column":85}},"45":{"start":{"line":78,"column":8},"end":{"line":109,"column":9}},"46":{"start":{"line":79,"column":32},"end":{"line":79,"column":133}},"47":{"start":{"line":80,"column":12},"end":{"line":83,"column":13}},"48":{"start":{"line":81,"column":16},"end":{"line":81,"column":90}},"49":{"start":{"line":82,"column":16},"end":{"line":82,"column":23}},"50":{"start":{"line":84,"column":27},"end":{"line":84,"column":77}},"51":{"start":{"line":85,"column":12},"end":{"line":92,"column":13}},"52":{"start":{"line":89,"column":16},"end":{"line":89,"column":109}},"53":{"start":{"line":90,"column":37},"end":{"line":90,"column":98}},"54":{"start":{"line":91,"column":16},"end":{"line":91,"column":36}},"55":{"start":{"line":93,"column":12},"end":{"line":93,"column":98}},"56":{"start":{"line":94,"column":12},"end":{"line":94,"column":66}},"57":{"start":{"line":95,"column":12},"end":{"line":100,"column":15}},"58":{"start":{"line":102,"column":12},"end":{"line":106,"column":15}},"59":{"start":{"line":108,"column":12},"end":{"line":108,"column":62}},"60":{"start":{"line":113,"column":8},"end":{"line":116,"column":9}},"61":{"start":{"line":114,"column":12},"end":{"line":114,"column":29}},"62":{"start":{"line":115,"column":12},"end":{"line":115,"column":19}},"63":{"start":{"line":117,"column":42},"end":{"line":117,"column":216}},"64":{"start":{"line":118,"column":8},"end":{"line":122,"column":11}},"65":{"start":{"line":123,"column":8},"end":{"line":123,"column":70}},"66":{"start":{"line":126,"column":8},"end":{"line":165,"column":9}},"67":{"start":{"line":129,"column":20},"end":{"line":134,"column":23}},"68":{"start":{"line":135,"column":20},"end":{"line":135,"column":73}},"69":{"start":{"line":136,"column":20},"end":{"line":136,"column":26}},"70":{"start":{"line":140,"column":20},"end":{"line":145,"column":23}},"71":{"start":{"line":147,"column":20},"end":{"line":147,"column":73}},"72":{"start":{"line":148,"column":20},"end":{"line":148,"column":26}},"73":{"start":{"line":152,"column":20},"end":{"line":157,"column":23}},"74":{"start":{"line":158,"column":20},"end":{"line":158,"column":73}},"75":{"start":{"line":159,"column":20},"end":{"line":159,"column":26}},"76":{"start":{"line":163,"column":20},"end":{"line":163,"column":32}},"77":{"start":{"line":166,"column":8},"end":{"line":166,"column":20}},"78":{"start":{"line":169,"column":22},"end":{"line":169,"column":44}},"79":{"start":{"line":170,"column":8},"end":{"line":170,"column":91}},"80":{"start":{"line":171,"column":33},"end":{"line":171,"column":40}},"81":{"start":{"line":172,"column":27},"end":{"line":172,"column":79}},"82":{"start":{"line":175,"column":8},"end":{"line":180,"column":9}},"83":{"start":{"line":176,"column":12},"end":{"line":179,"column":15}},"84":{"start":{"line":182,"column":8},"end":{"line":187,"column":9}},"85":{"start":{"line":183,"column":12},"end":{"line":186,"column":15}},"86":{"start":{"line":189,"column":8},"end":{"line":194,"column":9}},"87":{"start":{"line":190,"column":12},"end":{"line":193,"column":15}},"88":{"start":{"line":195,"column":21},"end":{"line":195,"column":119}},"89":{"start":{"line":196,"column":8},"end":{"line":203,"column":9}},"90":{"start":{"line":197,"column":61},"end":{"line":197,"column":65}},"91":{"start":{"line":198,"column":12},"end":{"line":198,"column":114}},"92":{"start":{"line":199,"column":12},"end":{"line":201,"column":21}},"93":{"start":{"line":200,"column":16},"end":{"line":200,"column":71}},"94":{"start":{"line":202,"column":12},"end":{"line":202,"column":24}},"95":{"start":{"line":204,"column":8},"end":{"line":204,"column":21}},"96":{"start":{"line":207,"column":8},"end":{"line":207,"column":29}},"97":{"start":{"line":208,"column":8},"end":{"line":208,"column":25}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":20,"column":4},"end":{"line":20,"column":5}},"loc":{"start":{"line":20,"column":12},"end":{"line":24,"column":5}},"line":20},"2":{"name":"(anonymous_2)","decl":{"start":{"line":25,"column":4},"end":{"line":25,"column":5}},"loc":{"start":{"line":25,"column":16},"end":{"line":27,"column":5}},"line":25},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":4},"end":{"line":28,"column":5}},"loc":{"start":{"line":28,"column":18},"end":{"line":37,"column":5}},"line":28},"4":{"name":"(anonymous_4)","decl":{"start":{"line":38,"column":4},"end":{"line":38,"column":5}},"loc":{"start":{"line":38,"column":17},"end":{"line":45,"column":5}},"line":38},"5":{"name":"(anonymous_5)","decl":{"start":{"line":46,"column":4},"end":{"line":46,"column":5}},"loc":{"start":{"line":46,"column":28},"end":{"line":51,"column":5}},"line":46},"6":{"name":"(anonymous_6)","decl":{"start":{"line":52,"column":4},"end":{"line":52,"column":5}},"loc":{"start":{"line":52,"column":22},"end":{"line":58,"column":5}},"line":52},"7":{"name":"(anonymous_7)","decl":{"start":{"line":59,"column":4},"end":{"line":59,"column":5}},"loc":{"start":{"line":59,"column":20},"end":{"line":75,"column":5}},"line":59},"8":{"name":"(anonymous_8)","decl":{"start":{"line":72,"column":42},"end":{"line":72,"column":43}},"loc":{"start":{"line":72,"column":47},"end":{"line":74,"column":9}},"line":72},"9":{"name":"(anonymous_9)","decl":{"start":{"line":76,"column":4},"end":{"line":76,"column":5}},"loc":{"start":{"line":76,"column":28},"end":{"line":110,"column":5}},"line":76},"10":{"name":"(anonymous_10)","decl":{"start":{"line":111,"column":4},"end":{"line":111,"column":5}},"loc":{"start":{"line":111,"column":24},"end":{"line":124,"column":5}},"line":111},"11":{"name":"(anonymous_11)","decl":{"start":{"line":125,"column":4},"end":{"line":125,"column":5}},"loc":{"start":{"line":125,"column":56},"end":{"line":167,"column":5}},"line":125},"12":{"name":"(anonymous_12)","decl":{"start":{"line":168,"column":4},"end":{"line":168,"column":5}},"loc":{"start":{"line":168,"column":51},"end":{"line":205,"column":5}},"line":168},"13":{"name":"(anonymous_13)","decl":{"start":{"line":199,"column":23},"end":{"line":199,"column":24}},"loc":{"start":{"line":199,"column":27},"end":{"line":201,"column":13}},"line":199},"14":{"name":"(anonymous_14)","decl":{"start":{"line":206,"column":4},"end":{"line":206,"column":5}},"loc":{"start":{"line":206,"column":17},"end":{"line":209,"column":5}},"line":206}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":24},"end":{"line":22,"column":154}},"type":"cond-expr","locations":[{"start":{"line":22,"column":137},"end":{"line":22,"column":150}},{"start":{"line":22,"column":153},"end":{"line":22,"column":154}}],"line":22},"1":{"loc":{"start":{"line":22,"column":24},"end":{"line":22,"column":134}},"type":"binary-expr","locations":[{"start":{"line":22,"column":24},"end":{"line":22,"column":106}},{"start":{"line":22,"column":110},"end":{"line":22,"column":134}}],"line":22},"2":{"loc":{"start":{"line":23,"column":15},"end":{"line":23,"column":66}},"type":"cond-expr","locations":[{"start":{"line":23,"column":29},"end":{"line":23,"column":49}},{"start":{"line":23,"column":52},"end":{"line":23,"column":66}}],"line":23},"3":{"loc":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"type":"if","locations":[{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},{"start":{"line":29,"column":8},"end":{"line":31,"column":9}}],"line":29},"4":{"loc":{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},"type":"if","locations":[{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},{"start":{"line":39,"column":8},"end":{"line":41,"column":9}}],"line":39},"5":{"loc":{"start":{"line":53,"column":8},"end":{"line":56,"column":9}},"type":"if","locations":[{"start":{"line":53,"column":8},"end":{"line":56,"column":9}},{"start":{"line":53,"column":8},"end":{"line":56,"column":9}}],"line":53},"6":{"loc":{"start":{"line":60,"column":8},"end":{"line":63,"column":9}},"type":"if","locations":[{"start":{"line":60,"column":8},"end":{"line":63,"column":9}},{"start":{"line":60,"column":8},"end":{"line":63,"column":9}}],"line":60},"7":{"loc":{"start":{"line":64,"column":8},"end":{"line":68,"column":9}},"type":"if","locations":[{"start":{"line":64,"column":8},"end":{"line":68,"column":9}},{"start":{"line":64,"column":8},"end":{"line":68,"column":9}}],"line":64},"8":{"loc":{"start":{"line":71,"column":53},"end":{"line":71,"column":70}},"type":"binary-expr","locations":[{"start":{"line":71,"column":53},"end":{"line":71,"column":58}},{"start":{"line":71,"column":62},"end":{"line":71,"column":70}}],"line":71},"9":{"loc":{"start":{"line":77,"column":64},"end":{"line":77,"column":81}},"type":"binary-expr","locations":[{"start":{"line":77,"column":64},"end":{"line":77,"column":69}},{"start":{"line":77,"column":73},"end":{"line":77,"column":81}}],"line":77},"10":{"loc":{"start":{"line":80,"column":12},"end":{"line":83,"column":13}},"type":"if","locations":[{"start":{"line":80,"column":12},"end":{"line":83,"column":13}},{"start":{"line":80,"column":12},"end":{"line":83,"column":13}}],"line":80},"11":{"loc":{"start":{"line":81,"column":69},"end":{"line":81,"column":86}},"type":"binary-expr","locations":[{"start":{"line":81,"column":69},"end":{"line":81,"column":74}},{"start":{"line":81,"column":78},"end":{"line":81,"column":86}}],"line":81},"12":{"loc":{"start":{"line":85,"column":12},"end":{"line":92,"column":13}},"type":"if","locations":[{"start":{"line":85,"column":12},"end":{"line":92,"column":13}},{"start":{"line":85,"column":12},"end":{"line":92,"column":13}}],"line":85},"13":{"loc":{"start":{"line":98,"column":23},"end":{"line":98,"column":40}},"type":"binary-expr","locations":[{"start":{"line":98,"column":23},"end":{"line":98,"column":28}},{"start":{"line":98,"column":32},"end":{"line":98,"column":40}}],"line":98},"14":{"loc":{"start":{"line":104,"column":23},"end":{"line":104,"column":40}},"type":"binary-expr","locations":[{"start":{"line":104,"column":23},"end":{"line":104,"column":28}},{"start":{"line":104,"column":32},"end":{"line":104,"column":40}}],"line":104},"15":{"loc":{"start":{"line":113,"column":8},"end":{"line":116,"column":9}},"type":"if","locations":[{"start":{"line":113,"column":8},"end":{"line":116,"column":9}},{"start":{"line":113,"column":8},"end":{"line":116,"column":9}}],"line":113},"16":{"loc":{"start":{"line":117,"column":42},"end":{"line":117,"column":216}},"type":"cond-expr","locations":[{"start":{"line":117,"column":166},"end":{"line":117,"column":172}},{"start":{"line":117,"column":175},"end":{"line":117,"column":216}}],"line":117},"17":{"loc":{"start":{"line":117,"column":42},"end":{"line":117,"column":163}},"type":"binary-expr","locations":[{"start":{"line":117,"column":42},"end":{"line":117,"column":123}},{"start":{"line":117,"column":127},"end":{"line":117,"column":163}}],"line":117},"18":{"loc":{"start":{"line":121,"column":20},"end":{"line":121,"column":71}},"type":"cond-expr","locations":[{"start":{"line":121,"column":48},"end":{"line":121,"column":58}},{"start":{"line":121,"column":61},"end":{"line":121,"column":71}}],"line":121},"19":{"loc":{"start":{"line":123,"column":14},"end":{"line":123,"column":68}},"type":"cond-expr","locations":[{"start":{"line":123,"column":42},"end":{"line":123,"column":54}},{"start":{"line":123,"column":57},"end":{"line":123,"column":68}}],"line":123},"20":{"loc":{"start":{"line":126,"column":8},"end":{"line":165,"column":9}},"type":"switch","locations":[{"start":{"line":127,"column":12},"end":{"line":137,"column":17}},{"start":{"line":138,"column":12},"end":{"line":149,"column":17}},{"start":{"line":150,"column":12},"end":{"line":160,"column":17}},{"start":{"line":161,"column":12},"end":{"line":164,"column":17}}],"line":126},"21":{"loc":{"start":{"line":169,"column":22},"end":{"line":169,"column":44}},"type":"binary-expr","locations":[{"start":{"line":169,"column":22},"end":{"line":169,"column":32}},{"start":{"line":169,"column":36},"end":{"line":169,"column":44}}],"line":169},"22":{"loc":{"start":{"line":175,"column":8},"end":{"line":180,"column":9}},"type":"if","locations":[{"start":{"line":175,"column":8},"end":{"line":180,"column":9}},{"start":{"line":175,"column":8},"end":{"line":180,"column":9}}],"line":175},"23":{"loc":{"start":{"line":182,"column":8},"end":{"line":187,"column":9}},"type":"if","locations":[{"start":{"line":182,"column":8},"end":{"line":187,"column":9}},{"start":{"line":182,"column":8},"end":{"line":187,"column":9}}],"line":182},"24":{"loc":{"start":{"line":189,"column":8},"end":{"line":194,"column":9}},"type":"if","locations":[{"start":{"line":189,"column":8},"end":{"line":194,"column":9}},{"start":{"line":189,"column":8},"end":{"line":194,"column":9}}],"line":189},"25":{"loc":{"start":{"line":196,"column":8},"end":{"line":203,"column":9}},"type":"if","locations":[{"start":{"line":196,"column":8},"end":{"line":203,"column":9}},{"start":{"line":196,"column":8},"end":{"line":203,"column":9}}],"line":196},"26":{"loc":{"start":{"line":196,"column":12},"end":{"line":196,"column":69}},"type":"cond-expr","locations":[{"start":{"line":196,"column":47},"end":{"line":196,"column":53}},{"start":{"line":196,"column":56},"end":{"line":196,"column":69}}],"line":196},"27":{"loc":{"start":{"line":196,"column":12},"end":{"line":196,"column":44}},"type":"binary-expr","locations":[{"start":{"line":196,"column":12},"end":{"line":196,"column":25}},{"start":{"line":196,"column":29},"end":{"line":196,"column":44}}],"line":196}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":9,"13":9,"14":2,"15":2,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":0,"24":1,"25":1,"26":1,"27":2,"28":4,"29":2,"30":2,"31":4,"32":3,"33":1,"34":1,"35":2,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":0,"44":7,"45":7,"46":7,"47":6,"48":2,"49":2,"50":4,"51":3,"52":1,"53":1,"54":1,"55":2,"56":2,"57":2,"58":2,"59":7,"60":3,"61":1,"62":1,"63":2,"64":2,"65":2,"66":6,"67":1,"68":1,"69":1,"70":1,"71":1,"72":1,"73":3,"74":3,"75":3,"76":1,"77":5,"78":7,"79":7,"80":7,"81":7,"82":7,"83":2,"84":5,"85":1,"86":4,"87":1,"88":3,"89":3,"90":2,"91":2,"92":2,"93":1,"94":2,"95":1,"96":35,"97":35},"f":{"0":1,"1":9,"2":2,"3":2,"4":1,"5":2,"6":4,"7":3,"8":0,"9":7,"10":3,"11":6,"12":7,"13":1,"14":35},"b":{"0":[1,8],"1":[9,9],"2":[0,9],"3":[1,1],"4":[0,1],"5":[2,2],"6":[1,2],"7":[1,1],"8":[1,1],"9":[7,7],"10":[2,4],"11":[2,2],"12":[1,2],"13":[2,2],"14":[2,2],"15":[1,2],"16":[0,2],"17":[2,2],"18":[1,1],"19":[1,1],"20":[1,1,3,1],"21":[7,1],"22":[2,5],"23":[1,4],"24":[1,3],"25":[2,1],"26":[0,3],"27":[3,3]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel/queue.ts"],"sourcesContent":["import { type InquiryWithAgentInfo, type IOmnichannelQueue } from '@rocket.chat/core-typings';\nimport { License } from '@rocket.chat/license';\nimport { LivechatInquiry, LivechatRooms } from '@rocket.chat/models';\n\nimport { dispatchAgentDelegated } from '../../../app/livechat/server/lib/Helper';\nimport { RoutingManager } from '../../../app/livechat/server/lib/RoutingManager';\nimport { getInquirySortMechanismSetting } from '../../../app/livechat/server/lib/settings';\nimport { settings } from '../../../app/settings/server';\nimport { queueLogger } from './logger';\n\nconst DEFAULT_RACE_TIMEOUT = 5000;\n\nexport class OmnichannelQueue implements IOmnichannelQueue {\n\tprivate running = false;\n\n\tprivate queues: (string | undefined)[] = [];\n\n\tprivate delay() {\n\t\tconst timeout = settings.get<number>('Omnichannel_queue_delay_timeout') ?? 5;\n\t\treturn timeout < 1 ? DEFAULT_RACE_TIMEOUT : timeout * 1000;\n\t}\n\n\tpublic isRunning() {\n\t\treturn this.running;\n\t}\n\n\tasync start() {\n\t\tif (this.running) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst activeQueues = await this.getActiveQueues();\n\t\tqueueLogger.debug(`Active queues: ${activeQueues.length}`);\n\t\tthis.running = true;\n\n\t\tqueueLogger.info('Service started');\n\t\treturn this.execute();\n\t}\n\n\tasync stop() {\n\t\tif (!this.running) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait LivechatInquiry.unlockAll();\n\n\t\tthis.running = false;\n\t\tqueueLogger.info('Service stopped');\n\t}\n\n\tprivate async getActiveQueues() {\n\t\t// undefined = public queue(without department)\n\t\treturn ([undefined] as typeof this.queues).concat(await LivechatInquiry.getDistinctQueuedDepartments({}));\n\t}\n\n\tprivate async nextQueue() {\n\t\tif (!this.queues.length) {\n\t\t\tqueueLogger.debug('No more registered queues. Refreshing');\n\t\t\tthis.queues = await this.getActiveQueues();\n\t\t}\n\n\t\treturn this.queues.shift();\n\t}\n\n\tprivate async execute() {\n\t\tif (!this.running) {\n\t\t\tqueueLogger.debug('Queue stopped. Cannot execute');\n\t\t\treturn;\n\t\t}\n\n\t\tif (await License.shouldPreventAction('monthlyActiveContacts', 1)) {\n\t\t\tqueueLogger.debug('MAC limit reached. Queue wont execute');\n\t\t\tthis.running = false;\n\t\t\treturn;\n\t\t}\n\n\t\tconst queue = await this.nextQueue();\n\t\tconst queueDelayTimeout = this.delay();\n\t\tqueueLogger.debug(`Executing queue ${queue || 'Public'} with timeout of ${queueDelayTimeout}`);\n\n\t\tvoid this.checkQueue(queue).catch((e) => {\n\t\t\tqueueLogger.error(e);\n\t\t});\n\t}\n\n\tprivate async checkQueue(queue: string | undefined) {\n\t\tqueueLogger.debug(`Processing items for queue ${queue || 'Public'}`);\n\t\ttry {\n\t\t\tconst nextInquiry = await LivechatInquiry.findNextAndLock(getInquirySortMechanismSetting(), queue);\n\t\t\tif (!nextInquiry) {\n\t\t\t\tqueueLogger.debug(`No more items for queue ${queue || 'Public'}`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst result = await this.processWaitingQueue(queue, nextInquiry as InquiryWithAgentInfo);\n\n\t\t\tif (!result) {\n\t\t\t\t// Note: this removes the \"one-shot\" behavior of queue, allowing it to take a conversation again in the future\n\t\t\t\t// And sorting them by _updatedAt: -1 will make it so that the oldest inquiries are taken first\n\t\t\t\t// preventing us from playing with the same inquiry over and over again\n\t\t\t\tqueueLogger.debug(`Inquiry ${nextInquiry._id} not taken. Unlocking and re-queueing`);\n\t\t\t\tconst updatedQueue = await LivechatInquiry.unlockAndQueue(nextInquiry._id);\n\t\t\t\treturn updatedQueue;\n\t\t\t}\n\n\t\t\tqueueLogger.debug(`Inquiry ${nextInquiry._id} taken successfully. Unlocking`);\n\t\t\tawait LivechatInquiry.unlock(nextInquiry._id);\n\t\t\tqueueLogger.debug({\n\t\t\t\tmsg: 'Inquiry processed',\n\t\t\t\tinquiry: nextInquiry._id,\n\t\t\t\tqueue: queue || 'Public',\n\t\t\t\tresult,\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tqueueLogger.error({\n\t\t\t\tmsg: 'Error processing queue',\n\t\t\t\tqueue: queue || 'Public',\n\t\t\t\terr: e,\n\t\t\t});\n\t\t} finally {\n\t\t\tsetTimeout(this.execute.bind(this), this.delay());\n\t\t}\n\t}\n\n\tasync shouldStart() {\n\t\tif (!settings.get('Livechat_enabled')) {\n\t\t\tvoid this.stop();\n\t\t\treturn;\n\t\t}\n\n\t\tconst routingSupportsAutoAssign = RoutingManager.getConfig()?.autoAssignAgent;\n\t\tqueueLogger.debug({\n\t\t\tmsg: 'Routing method supports auto assignment',\n\t\t\tmethod: settings.get('Livechat_Routing_Method'),\n\t\t\tstatus: routingSupportsAutoAssign ? 'Starting' : 'Stopping',\n\t\t});\n\n\t\tvoid (routingSupportsAutoAssign ? this.start() : this.stop());\n\t}\n\n\tprivate async reconciliation(reason: 'closed' | 'taken' | 'missing', { roomId, inquiryId }: { roomId: string; inquiryId: string }) {\n\t\tswitch (reason) {\n\t\t\tcase 'closed': {\n\t\t\t\tqueueLogger.debug({\n\t\t\t\t\tmsg: 'Room closed. Removing inquiry',\n\t\t\t\t\troomId,\n\t\t\t\t\tinquiryId,\n\t\t\t\t\tstep: 'reconciliation',\n\t\t\t\t});\n\t\t\t\tawait LivechatInquiry.removeByRoomId(roomId);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'taken': {\n\t\t\t\tqueueLogger.debug({\n\t\t\t\t\tmsg: 'Room taken. Updating inquiry status',\n\t\t\t\t\troomId,\n\t\t\t\t\tinquiryId,\n\t\t\t\t\tstep: 'reconciliation',\n\t\t\t\t});\n\t\t\t\t// Reconciliate served inquiries, by updating their status to taken after queue tried to pick and failed\n\t\t\t\tawait LivechatInquiry.takeInquiry(inquiryId);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'missing': {\n\t\t\t\tqueueLogger.debug({\n\t\t\t\t\tmsg: 'Room from inquiry missing. Removing inquiry',\n\t\t\t\t\troomId,\n\t\t\t\t\tinquiryId,\n\t\t\t\t\tstep: 'reconciliation',\n\t\t\t\t});\n\t\t\t\tawait LivechatInquiry.removeByRoomId(roomId);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault: {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate async processWaitingQueue(department: string | undefined, inquiry: InquiryWithAgentInfo) {\n\t\tconst queue = department || 'Public';\n\n\t\tqueueLogger.debug(`Processing inquiry ${inquiry._id} from queue ${queue}`);\n\t\tconst { defaultAgent } = inquiry;\n\n\t\tconst roomFromDb = await LivechatRooms.findOneById(inquiry.rid);\n\n\t\t// This is a precaution to avoid taking inquiries tied to rooms that no longer exist.\n\t\t// This should never happen.\n\t\tif (!roomFromDb) {\n\t\t\treturn this.reconciliation('missing', { roomId: inquiry.rid, inquiryId: inquiry._id });\n\t\t}\n\n\t\t// This is a precaution to avoid taking the same inquiry multiple times. It should not happen, but it's a safety net\n\t\tif (roomFromDb.servedBy) {\n\t\t\treturn this.reconciliation('taken', { roomId: inquiry.rid, inquiryId: inquiry._id });\n\t\t}\n\n\t\t// This is another precaution. If the room is closed, we should not take it\n\t\tif (roomFromDb.closedAt) {\n\t\t\treturn this.reconciliation('closed', { roomId: inquiry.rid, inquiryId: inquiry._id });\n\t\t}\n\n\t\tconst room = await RoutingManager.delegateInquiry(inquiry, defaultAgent, undefined, roomFromDb);\n\n\t\tif (room?.servedBy) {\n\t\t\tconst {\n\t\t\t\t_id: rid,\n\t\t\t\tservedBy: { _id: agentId },\n\t\t\t} = room;\n\t\t\tqueueLogger.debug(`Inquiry ${inquiry._id} taken successfully by agent ${agentId}. Notifying`);\n\t\t\tsetTimeout(() => {\n\t\t\t\tvoid dispatchAgentDelegated(rid, agentId);\n\t\t\t}, 1000);\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n}\n"],"names":["OmnichannelQueue","DEFAULT_RACE_TIMEOUT","delay","settings","timeout","get","isRunning","running","start","activeQueues","getActiveQueues","queueLogger","debug","length","info","execute","stop","LivechatInquiry","unlockAll","undefined","concat","getDistinctQueuedDepartments","nextQueue","queues","shift","License","shouldPreventAction","queue","queueDelayTimeout","checkQueue","catch","e","error","nextInquiry","findNextAndLock","getInquirySortMechanismSetting","result","processWaitingQueue","_id","updatedQueue","unlockAndQueue","unlock","msg","inquiry","err","setTimeout","bind","shouldStart","RoutingManager","routingSupportsAutoAssign","getConfig","autoAssignAgent","method","status","reconciliation","reason","roomId","inquiryId","step","removeByRoomId","takeInquiry","department","defaultAgent","roomFromDb","LivechatRooms","findOneById","rid","servedBy","closedAt","room","delegateInquiry","agentId","dispatchAgentDelegated"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel/queue.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b240a7f139c238290f5d9c19a7b9c21956061e0c","contentHash":"75e288f2a07213b5727fac42192e7ad2fdf0bdef10f81c50b7be46a93a393320"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/user/service.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/user/service.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":27}},"3":{"start":{"line":11,"column":22},"end":{"line":11,"column":59}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":46}},"5":{"start":{"line":13,"column":27},"end":{"line":13,"column":65}},"6":{"start":{"line":14,"column":18},"end":{"line":26,"column":1}},"7":{"start":{"line":16,"column":29},"end":{"line":16,"column":81}},"8":{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},"9":{"start":{"line":18,"column":12},"end":{"line":18,"column":19}},"10":{"start":{"line":20,"column":27},"end":{"line":20,"column":92}},"11":{"start":{"line":21,"column":8},"end":{"line":21,"column":82}},"12":{"start":{"line":24,"column":8},"end":{"line":24,"column":43}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":38},"end":{"line":22,"column":5}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":23,"column":4},"end":{"line":23,"column":5}},"loc":{"start":{"line":23,"column":24},"end":{"line":25,"column":5}},"line":23}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},"type":"if","locations":[{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},{"start":{"line":17,"column":8},"end":{"line":19,"column":9}}],"line":17}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":2,"9":1,"10":1,"11":1,"12":2},"f":{"0":1,"1":2,"2":2},"b":{"0":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/user/service.ts"],"sourcesContent":["import { ServiceClassInternal } from '@rocket.chat/core-services';\nimport type { IUserService } from '@rocket.chat/core-services';\nimport { Users } from '@rocket.chat/models';\n\nimport { getMaxLoginTokens } from '../../lib/getMaxLoginTokens';\n\n// TODO merge this service with Account service\nexport class UserService extends ServiceClassInternal implements IUserService {\n\tprotected name = 'user';\n\n\tasync ensureLoginTokensLimit(uid: string): Promise<void> {\n\t\tconst [{ tokens }] = await Users.findAllResumeTokensByUserId(uid);\n\t\tif (tokens.length < getMaxLoginTokens()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldestDate = tokens.reverse()[getMaxLoginTokens() - 1];\n\t\tawait Users.removeOlderResumeTokensByUserId(uid, oldestDate.when);\n\t}\n}\n"],"names":["UserService","ServiceClassInternal","ensureLoginTokensLimit","uid","tokens","Users","findAllResumeTokensByUserId","length","getMaxLoginTokens","oldestDate","reverse","removeOlderResumeTokensByUserId","when","name"],"mappings":";;;;+BAOaA;;;eAAAA;;;8BAPwB;wBAEf;mCAEY;AAG3B,IAAA,AAAMA,cAAN,MAAMA,oBAAoBC,kCAAoB;IAGpD,MAAMC,uBAAuBC,GAAW,EAAiB;QACxD,MAAM,CAAC,EAAEC,MAAM,EAAE,CAAC,GAAG,MAAMC,aAAK,CAACC,2BAA2B,CAACH;QAC7D,IAAIC,OAAOG,MAAM,GAAGC,IAAAA,oCAAiB,KAAI;YACxC;QACD;QAEA,MAAMC,aAAaL,OAAOM,OAAO,EAAE,CAACF,IAAAA,oCAAiB,MAAK,EAAE;QAC5D,MAAMH,aAAK,CAACM,+BAA+B,CAACR,KAAKM,WAAWG,IAAI;IACjE;;6BAVUC,OAAO;;AAWlB","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/user/service.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8b82ee7d77c7c40ae4a54d8a77bd954ce257ecaf","contentHash":"c15302b6f072464aa3759c8eb9a5a0526da5b43675a6132fada3bff81cc99d60"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/startup/initialData.js":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/startup/initialData.js","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":38}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":28},"end":{"line":12,"column":76}},"5":{"start":{"line":13,"column":22},"end":{"line":13,"column":53}},"6":{"start":{"line":14,"column":16},"end":{"line":14,"column":40}},"7":{"start":{"line":15,"column":16},"end":{"line":15,"column":55}},"8":{"start":{"line":16,"column":17},"end":{"line":16,"column":49}},"9":{"start":{"line":17,"column":34},"end":{"line":17,"column":100}},"10":{"start":{"line":18,"column":35},"end":{"line":18,"column":102}},"11":{"start":{"line":19,"column":24},"end":{"line":19,"column":74}},"12":{"start":{"line":20,"column":17},"end":{"line":20,"column":53}},"13":{"start":{"line":21,"column":24},"end":{"line":21,"column":59}},"14":{"start":{"line":22,"column":22},"end":{"line":22,"column":58}},"15":{"start":{"line":24,"column":4},"end":{"line":26,"column":6}},"16":{"start":{"line":29,"column":4},"end":{"line":88,"column":5}},"17":{"start":{"line":30,"column":8},"end":{"line":87,"column":9}},"18":{"start":{"line":31,"column":30},"end":{"line":38,"column":13}},"19":{"start":{"line":39,"column":12},"end":{"line":41,"column":13}},"20":{"start":{"line":40,"column":16},"end":{"line":40,"column":56}},"21":{"start":{"line":42,"column":12},"end":{"line":42,"column":72}},"22":{"start":{"line":43,"column":12},"end":{"line":59,"column":13}},"23":{"start":{"line":44,"column":16},"end":{"line":58,"column":17}},"24":{"start":{"line":45,"column":20},"end":{"line":55,"column":21}},"25":{"start":{"line":46,"column":24},"end":{"line":51,"column":26}},"26":{"start":{"line":52,"column":24},"end":{"line":52,"column":94}},"27":{"start":{"line":54,"column":24},"end":{"line":54,"column":132}},"28":{"start":{"line":57,"column":20},"end":{"line":57,"column":124}},"29":{"start":{"line":60,"column":12},"end":{"line":77,"column":13}},"30":{"start":{"line":62,"column":16},"end":{"line":66,"column":17}},"31":{"start":{"line":63,"column":20},"end":{"line":63,"column":108}},"32":{"start":{"line":65,"column":20},"end":{"line":65,"column":69}},"33":{"start":{"line":67,"column":16},"end":{"line":76,"column":17}},"34":{"start":{"line":68,"column":20},"end":{"line":73,"column":21}},"35":{"start":{"line":69,"column":24},"end":{"line":69,"column":116}},"36":{"start":{"line":70,"column":24},"end":{"line":70,"column":72}},"37":{"start":{"line":72,"column":24},"end":{"line":72,"column":163}},"38":{"start":{"line":75,"column":20},"end":{"line":75,"column":130}},"39":{"start":{"line":78,"column":12},"end":{"line":78,"column":80}},"40":{"start":{"line":79,"column":12},"end":{"line":79,"column":36}},"41":{"start":{"line":80,"column":43},"end":{"line":80,"column":80}},"42":{"start":{"line":81,"column":12},"end":{"line":81,"column":90}},"43":{"start":{"line":82,"column":12},"end":{"line":84,"column":15}},"44":{"start":{"line":86,"column":12},"end":{"line":86,"column":125}},"45":{"start":{"line":90,"column":0},"end":{"line":240,"column":3}},"46":{"start":{"line":91,"column":26},"end":{"line":95,"column":5}},"47":{"start":{"line":96,"column":4},"end":{"line":104,"column":5}},"48":{"start":{"line":97,"column":8},"end":{"line":103,"column":10}},"49":{"start":{"line":105,"column":4},"end":{"line":111,"column":5}},"50":{"start":{"line":106,"column":8},"end":{"line":110,"column":10}},"51":{"start":{"line":112,"column":4},"end":{"line":114,"column":5}},"52":{"start":{"line":113,"column":8},"end":{"line":113,"column":64}},"53":{"start":{"line":115,"column":4},"end":{"line":115,"column":96}},"54":{"start":{"line":116,"column":4},"end":{"line":128,"column":5}},"55":{"start":{"line":117,"column":23},"end":{"line":121,"column":10}},"56":{"start":{"line":122,"column":8},"end":{"line":126,"column":9}},"57":{"start":{"line":123,"column":12},"end":{"line":125,"column":15}},"58":{"start":{"line":127,"column":8},"end":{"line":127,"column":179}},"59":{"start":{"line":129,"column":4},"end":{"line":163,"column":5}},"60":{"start":{"line":130,"column":8},"end":{"line":159,"column":9}},"61":{"start":{"line":135,"column":12},"end":{"line":144,"column":15}},"62":{"start":{"line":145,"column":12},"end":{"line":147,"column":15}},"63":{"start":{"line":148,"column":27},"end":{"line":148,"column":92}},"64":{"start":{"line":149,"column":23},"end":{"line":149,"column":77}},"65":{"start":{"line":150,"column":30},"end":{"line":150,"column":68}},"66":{"start":{"line":151,"column":12},"end":{"line":151,"column":55}},"67":{"start":{"line":152,"column":25},"end":{"line":156,"column":13}},"68":{"start":{"line":157,"column":27},"end":{"line":157,"column":59}},"69":{"start":{"line":158,"column":12},"end":{"line":158,"column":82}},"70":{"start":{"line":161,"column":8},"end":{"line":161,"column":146}},"71":{"start":{"line":162,"column":8},"end":{"line":162,"column":20}},"72":{"start":{"line":164,"column":4},"end":{"line":164,"column":35}},"73":{"start":{"line":165,"column":4},"end":{"line":179,"column":5}},"74":{"start":{"line":166,"column":8},"end":{"line":178,"column":9}},"75":{"start":{"line":167,"column":32},"end":{"line":167,"column":68}},"76":{"start":{"line":168,"column":12},"end":{"line":175,"column":13}},"77":{"start":{"line":169,"column":16},"end":{"line":169,"column":110}},"78":{"start":{"line":170,"column":19},"end":{"line":175,"column":13}},"79":{"start":{"line":171,"column":16},"end":{"line":171,"column":76}},"80":{"start":{"line":172,"column":16},"end":{"line":172,"column":87}},"81":{"start":{"line":173,"column":16},"end":{"line":173,"column":56}},"82":{"start":{"line":174,"column":16},"end":{"line":174,"column":97}},"83":{"start":{"line":177,"column":12},"end":{"line":177,"column":100}},"84":{"start":{"line":180,"column":4},"end":{"line":194,"column":5}},"85":{"start":{"line":181,"column":27},"end":{"line":187,"column":10}},"86":{"start":{"line":188,"column":8},"end":{"line":193,"column":9}},"87":{"start":{"line":189,"column":12},"end":{"line":191,"column":15}},"88":{"start":{"line":192,"column":12},"end":{"line":192,"column":129}},"89":{"start":{"line":195,"column":4},"end":{"line":200,"column":5}},"90":{"start":{"line":196,"column":8},"end":{"line":199,"column":9}},"91":{"start":{"line":197,"column":12},"end":{"line":197,"column":104}},"92":{"start":{"line":198,"column":12},"end":{"line":198,"column":180}},"93":{"start":{"line":201,"column":4},"end":{"line":201,"column":69}},"94":{"start":{"line":202,"column":4},"end":{"line":239,"column":5}},"95":{"start":{"line":203,"column":8},"end":{"line":203,"column":71}},"96":{"start":{"line":204,"column":26},"end":{"line":219,"column":9}},"97":{"start":{"line":220,"column":8},"end":{"line":220,"column":68}},"98":{"start":{"line":221,"column":8},"end":{"line":221,"column":82}},"99":{"start":{"line":222,"column":8},"end":{"line":222,"column":76}},"100":{"start":{"line":223,"column":8},"end":{"line":223,"column":71}},"101":{"start":{"line":224,"column":8},"end":{"line":226,"column":9}},"102":{"start":{"line":225,"column":12},"end":{"line":225,"column":136}},"103":{"start":{"line":227,"column":8},"end":{"line":229,"column":9}},"104":{"start":{"line":228,"column":12},"end":{"line":228,"column":130}},"105":{"start":{"line":230,"column":8},"end":{"line":230,"column":46}},"106":{"start":{"line":231,"column":8},"end":{"line":231,"column":84}},"107":{"start":{"line":232,"column":8},"end":{"line":234,"column":11}},"108":{"start":{"line":235,"column":8},"end":{"line":237,"column":9}},"109":{"start":{"line":236,"column":12},"end":{"line":236,"column":180}},"110":{"start":{"line":238,"column":8},"end":{"line":238,"column":88}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":23,"column":9},"end":{"line":23,"column":33}},"loc":{"start":{"line":23,"column":39},"end":{"line":27,"column":1}},"line":23},"2":{"name":"insertAdminUserFromEnv","decl":{"start":{"line":28,"column":15},"end":{"line":28,"column":37}},"loc":{"start":{"line":28,"column":40},"end":{"line":89,"column":1}},"line":28},"3":{"name":"(anonymous_3)","decl":{"start":{"line":90,"column":23},"end":{"line":90,"column":24}},"loc":{"start":{"line":90,"column":33},"end":{"line":240,"column":1}},"line":90}},"branchMap":{"0":{"loc":{"start":{"line":24,"column":11},"end":{"line":26,"column":5}},"type":"cond-expr","locations":[{"start":{"line":24,"column":35},"end":{"line":24,"column":38}},{"start":{"line":24,"column":41},"end":{"line":26,"column":5}}],"line":24},"1":{"loc":{"start":{"line":24,"column":11},"end":{"line":24,"column":32}},"type":"binary-expr","locations":[{"start":{"line":24,"column":11},"end":{"line":24,"column":14}},{"start":{"line":24,"column":18},"end":{"line":24,"column":32}}],"line":24},"2":{"loc":{"start":{"line":29,"column":4},"end":{"line":88,"column":5}},"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":88,"column":5}},{"start":{"line":29,"column":4},"end":{"line":88,"column":5}}],"line":29},"3":{"loc":{"start":{"line":30,"column":8},"end":{"line":87,"column":9}},"type":"if","locations":[{"start":{"line":30,"column":8},"end":{"line":87,"column":9}},{"start":{"line":30,"column":8},"end":{"line":87,"column":9}}],"line":30},"4":{"loc":{"start":{"line":39,"column":12},"end":{"line":41,"column":13}},"type":"if","locations":[{"start":{"line":39,"column":12},"end":{"line":41,"column":13}},{"start":{"line":39,"column":12},"end":{"line":41,"column":13}}],"line":39},"5":{"loc":{"start":{"line":43,"column":12},"end":{"line":59,"column":13}},"type":"if","locations":[{"start":{"line":43,"column":12},"end":{"line":59,"column":13}},{"start":{"line":43,"column":12},"end":{"line":59,"column":13}}],"line":43},"6":{"loc":{"start":{"line":44,"column":16},"end":{"line":58,"column":17}},"type":"if","locations":[{"start":{"line":44,"column":16},"end":{"line":58,"column":17}},{"start":{"line":44,"column":16},"end":{"line":58,"column":17}}],"line":44},"7":{"loc":{"start":{"line":45,"column":20},"end":{"line":55,"column":21}},"type":"if","locations":[{"start":{"line":45,"column":20},"end":{"line":55,"column":21}},{"start":{"line":45,"column":20},"end":{"line":55,"column":21}}],"line":45},"8":{"loc":{"start":{"line":60,"column":12},"end":{"line":77,"column":13}},"type":"if","locations":[{"start":{"line":60,"column":12},"end":{"line":77,"column":13}},{"start":{"line":60,"column":12},"end":{"line":77,"column":13}}],"line":60},"9":{"loc":{"start":{"line":67,"column":16},"end":{"line":76,"column":17}},"type":"if","locations":[{"start":{"line":67,"column":16},"end":{"line":76,"column":17}},{"start":{"line":67,"column":16},"end":{"line":76,"column":17}}],"line":67},"10":{"loc":{"start":{"line":96,"column":4},"end":{"line":104,"column":5}},"type":"if","locations":[{"start":{"line":96,"column":4},"end":{"line":104,"column":5}},{"start":{"line":96,"column":4},"end":{"line":104,"column":5}}],"line":96},"11":{"loc":{"start":{"line":105,"column":4},"end":{"line":111,"column":5}},"type":"if","locations":[{"start":{"line":105,"column":4},"end":{"line":111,"column":5}},{"start":{"line":105,"column":4},"end":{"line":111,"column":5}}],"line":105},"12":{"loc":{"start":{"line":112,"column":4},"end":{"line":114,"column":5}},"type":"if","locations":[{"start":{"line":112,"column":4},"end":{"line":114,"column":5}},{"start":{"line":112,"column":4},"end":{"line":114,"column":5}}],"line":112},"13":{"loc":{"start":{"line":116,"column":4},"end":{"line":128,"column":5}},"type":"if","locations":[{"start":{"line":116,"column":4},"end":{"line":128,"column":5}},{"start":{"line":116,"column":4},"end":{"line":128,"column":5}}],"line":116},"14":{"loc":{"start":{"line":122,"column":8},"end":{"line":126,"column":9}},"type":"if","locations":[{"start":{"line":122,"column":8},"end":{"line":126,"column":9}},{"start":{"line":122,"column":8},"end":{"line":126,"column":9}}],"line":122},"15":{"loc":{"start":{"line":127,"column":8},"end":{"line":127,"column":178}},"type":"binary-expr","locations":[{"start":{"line":127,"column":8},"end":{"line":127,"column":95}},{"start":{"line":127,"column":99},"end":{"line":127,"column":178}}],"line":127},"16":{"loc":{"start":{"line":130,"column":8},"end":{"line":159,"column":9}},"type":"if","locations":[{"start":{"line":130,"column":8},"end":{"line":159,"column":9}},{"start":{"line":130,"column":8},"end":{"line":159,"column":9}}],"line":130},"17":{"loc":{"start":{"line":165,"column":4},"end":{"line":179,"column":5}},"type":"if","locations":[{"start":{"line":165,"column":4},"end":{"line":179,"column":5}},{"start":{"line":165,"column":4},"end":{"line":179,"column":5}}],"line":165},"18":{"loc":{"start":{"line":165,"column":8},"end":{"line":165,"column":91}},"type":"binary-expr","locations":[{"start":{"line":165,"column":8},"end":{"line":165,"column":52}},{"start":{"line":165,"column":56},"end":{"line":165,"column":91}}],"line":165},"19":{"loc":{"start":{"line":168,"column":12},"end":{"line":175,"column":13}},"type":"if","locations":[{"start":{"line":168,"column":12},"end":{"line":175,"column":13}},{"start":{"line":168,"column":12},"end":{"line":175,"column":13}}],"line":168},"20":{"loc":{"start":{"line":170,"column":19},"end":{"line":175,"column":13}},"type":"if","locations":[{"start":{"line":170,"column":19},"end":{"line":175,"column":13}},{"start":{"line":170,"column":19},"end":{"line":175,"column":13}}],"line":170},"21":{"loc":{"start":{"line":180,"column":4},"end":{"line":194,"column":5}},"type":"if","locations":[{"start":{"line":180,"column":4},"end":{"line":194,"column":5}},{"start":{"line":180,"column":4},"end":{"line":194,"column":5}}],"line":180},"22":{"loc":{"start":{"line":188,"column":8},"end":{"line":193,"column":9}},"type":"if","locations":[{"start":{"line":188,"column":8},"end":{"line":193,"column":9}},{"start":{"line":188,"column":8},"end":{"line":193,"column":9}}],"line":188},"23":{"loc":{"start":{"line":192,"column":52},"end":{"line":192,"column":90}},"type":"binary-expr","locations":[{"start":{"line":192,"column":52},"end":{"line":192,"column":71}},{"start":{"line":192,"column":75},"end":{"line":192,"column":90}}],"line":192},"24":{"loc":{"start":{"line":195,"column":4},"end":{"line":200,"column":5}},"type":"if","locations":[{"start":{"line":195,"column":4},"end":{"line":200,"column":5}},{"start":{"line":195,"column":4},"end":{"line":200,"column":5}}],"line":195},"25":{"loc":{"start":{"line":196,"column":8},"end":{"line":199,"column":9}},"type":"if","locations":[{"start":{"line":196,"column":8},"end":{"line":199,"column":9}},{"start":{"line":196,"column":8},"end":{"line":199,"column":9}}],"line":196},"26":{"loc":{"start":{"line":198,"column":12},"end":{"line":198,"column":179}},"type":"binary-expr","locations":[{"start":{"line":198,"column":12},"end":{"line":198,"column":102}},{"start":{"line":198,"column":106},"end":{"line":198,"column":179}}],"line":198},"27":{"loc":{"start":{"line":202,"column":4},"end":{"line":239,"column":5}},"type":"if","locations":[{"start":{"line":202,"column":4},"end":{"line":239,"column":5}},{"start":{"line":202,"column":4},"end":{"line":239,"column":5}}],"line":202},"28":{"loc":{"start":{"line":224,"column":8},"end":{"line":226,"column":9}},"type":"if","locations":[{"start":{"line":224,"column":8},"end":{"line":226,"column":9}},{"start":{"line":224,"column":8},"end":{"line":226,"column":9}}],"line":224},"29":{"loc":{"start":{"line":227,"column":8},"end":{"line":229,"column":9}},"type":"if","locations":[{"start":{"line":227,"column":8},"end":{"line":229,"column":9}},{"start":{"line":227,"column":8},"end":{"line":229,"column":9}}],"line":227},"30":{"loc":{"start":{"line":235,"column":8},"end":{"line":237,"column":9}},"type":"if","locations":[{"start":{"line":235,"column":8},"end":{"line":237,"column":9}},{"start":{"line":235,"column":8},"end":{"line":237,"column":9}}],"line":235},"31":{"loc":{"start":{"line":236,"column":12},"end":{"line":236,"column":179}},"type":"binary-expr","locations":[{"start":{"line":236,"column":12},"end":{"line":236,"column":102}},{"start":{"line":236,"column":106},"end":{"line":236,"column":179}}],"line":236}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":13,"17":12,"18":11,"19":11,"20":10,"21":11,"22":11,"23":11,"24":7,"25":6,"26":6,"27":1,"28":4,"29":11,"30":6,"31":6,"32":1,"33":6,"34":3,"35":3,"36":3,"37":0,"38":3,"39":11,"40":11,"41":11,"42":11,"43":11,"44":1,"45":1,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0},"f":{"0":1,"1":1,"2":13,"3":0},"b":{"0":[0,1],"1":[1,1],"2":[12,1],"3":[11,1],"4":[10,1],"5":[11,0],"6":[7,4],"7":[6,1],"8":[6,5],"9":[3,3],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/startup/initialData.js"],"sourcesContent":["import { Settings, Rooms, Users, Roles } from '@rocket.chat/models';\nimport colors from 'colors/safe';\nimport { Accounts } from 'meteor/accounts-base';\nimport { Meteor } from 'meteor/meteor';\n\nimport { FileUpload } from '../../app/file-upload/server';\nimport { RocketChatFile } from '../../app/file/server';\nimport { addUserToDefaultChannels } from '../../app/lib/server/functions/addUserToDefaultChannels';\nimport { checkUsernameAvailability } from '../../app/lib/server/functions/checkUsernameAvailability';\nimport { notifyOnSettingChangedById } from '../../app/lib/server/lib/notifyListener';\nimport { settings } from '../../app/settings/server';\nimport { validateEmail } from '../../lib/emailValidator';\nimport { addUserRolesAsync } from '../lib/roles/addUserRoles';\n\nexport async function insertAdminUserFromEnv() {\n\tif (process.env.ADMIN_PASS) {\n\t\tif ((await Roles.countUsersInRole('admin')) === 0) {\n\t\t\tconst adminUser = {\n\t\t\t\tname: 'Administrator',\n\t\t\t\tusername: 'admin',\n\t\t\t\tstatus: 'offline',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t};\n\n\t\t\tif (process.env.ADMIN_NAME) {\n\t\t\t\tadminUser.name = process.env.ADMIN_NAME;\n\t\t\t}\n\n\t\t\tconsole.log(colors.green(`Name: ${adminUser.name}`));\n\n\t\t\tif (process.env.ADMIN_EMAIL) {\n\t\t\t\tif (validateEmail(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\tif (!(await Users.findOneByEmailAddress(process.env.ADMIN_EMAIL))) {\n\t\t\t\t\t\tadminUser.emails = [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\taddress: process.env.ADMIN_EMAIL,\n\t\t\t\t\t\t\t\tverified: process.env.ADMIN_EMAIL_VERIFIED === 'true',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t];\n\n\t\t\t\t\t\tconsole.log(colors.green(`Email: ${process.env.ADMIN_EMAIL}`));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log(colors.red('Email provided already exists; Ignoring environment variables ADMIN_EMAIL'));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(colors.red('Email provided is invalid; Ignoring environment variables ADMIN_EMAIL'));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (process.env.ADMIN_USERNAME) {\n\t\t\t\tlet nameValidation;\n\n\t\t\t\ttry {\n\t\t\t\t\tnameValidation = new RegExp(`^${settings.get('UTF8_User_Names_Validation')}$`);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t\t\t\t}\n\n\t\t\t\tif (nameValidation.test(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait checkUsernameAvailability(process.env.ADMIN_USERNAME);\n\t\t\t\t\t\tadminUser.username = process.env.ADMIN_USERNAME;\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\tcolors.red('Username provided already exists or is blocked from usage; Ignoring environment variables ADMIN_USERNAME'),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(colors.red('Username provided is invalid; Ignoring environment variables ADMIN_USERNAME'));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconsole.log(colors.green(`Username: ${adminUser.username}`));\n\n\t\t\tadminUser.type = 'user';\n\n\t\t\tconst { insertedId: userId } = await Users.create(adminUser);\n\n\t\t\tawait Accounts.setPasswordAsync(userId, process.env.ADMIN_PASS);\n\n\t\t\tawait addUserRolesAsync(userId, ['admin']);\n\t\t} else {\n\t\t\tconsole.log(colors.red('Users with admin role already exist; Ignoring environment variables ADMIN_PASS'));\n\t\t}\n\t}\n}\n\nMeteor.startup(async () => {\n\tconst dynamicImport = {\n\t\t'dynamic-import': {\n\t\t\tuseLocationOrigin: true,\n\t\t},\n\t};\n\n\tif (!Meteor.settings) {\n\t\tMeteor.settings = {\n\t\t\tpublic: {\n\t\t\t\tpackages: {\n\t\t\t\t\t'dynamic-import': dynamicImport,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tif (!Meteor.settings.public) {\n\t\tMeteor.settings.public = {\n\t\t\tpackages: {\n\t\t\t\t'dynamic-import': dynamicImport,\n\t\t\t},\n\t\t};\n\t}\n\n\tif (!Meteor.settings.public.packages) {\n\t\tMeteor.settings.public.packages = dynamicImport;\n\t}\n\n\tMeteor.settings.public.packages['dynamic-import'] = dynamicImport['dynamic-import'];\n\n\tif (!settings.get('Initial_Channel_Created')) {\n\t\tconst exists = await Rooms.findOneById('GENERAL', { projection: { _id: 1 } });\n\t\tif (!exists) {\n\t\t\tawait Rooms.createWithIdTypeAndName('GENERAL', 'c', 'general', {\n\t\t\t\tdefault: true,\n\t\t\t});\n\t\t}\n\n\t\t(await Settings.updateValueById('Initial_Channel_Created', true)).modifiedCount &&\n\t\t\tvoid notifyOnSettingChangedById('Initial_Channel_Created');\n\t}\n\n\ttry {\n\t\tif (!(await Users.findOneById('rocket.cat', { projection: { _id: 1 } }))) {\n\t\t\tawait Users.create({\n\t\t\t\t_id: 'rocket.cat',\n\t\t\t\tname: 'Rocket.Cat',\n\t\t\t\tusername: 'rocket.cat',\n\t\t\t\tstatus: 'online',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'bot',\n\t\t\t});\n\n\t\t\tawait addUserRolesAsync('rocket.cat', ['bot']);\n\n\t\t\tconst buffer = Buffer.from(await Assets.getBinaryAsync('avatars/rocketcat.png'));\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(buffer, 'utf8');\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tawait fileStore.deleteByName('rocket.cat');\n\n\t\t\tconst file = {\n\t\t\t\tuserId: 'rocket.cat',\n\t\t\t\ttype: 'image/png',\n\t\t\t\tsize: buffer.length,\n\t\t\t};\n\n\t\t\tconst upload = await fileStore.insert(file, rs);\n\t\t\tawait Users.setAvatarData('rocket.cat', 'local', upload.etag);\n\t\t}\n\t} catch (error) {\n\t\tconsole.log(\n\t\t\t'Error creating default `rocket.cat` user, if you created a user with this username please remove it and restart the server',\n\t\t);\n\t\tthrow error;\n\t}\n\n\tawait insertAdminUserFromEnv();\n\n\tif (typeof process.env.INITIAL_USER === 'string' && process.env.INITIAL_USER.length > 0) {\n\t\ttry {\n\t\t\tconst initialUser = JSON.parse(process.env.INITIAL_USER);\n\n\t\t\tif (!initialUser._id) {\n\t\t\t\tconsole.log(colors.red('No _id provided; Ignoring environment variable INITIAL_USER'));\n\t\t\t} else if (!(await Users.findOneById(initialUser._id))) {\n\t\t\t\tconsole.log(colors.green('Inserting initial user:'));\n\t\t\t\tconsole.log(colors.green(JSON.stringify(initialUser, null, 2)));\n\t\t\t\tawait Users.create(initialUser);\n\n\t\t\t\tawait addUserToDefaultChannels(initialUser, true);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.log(colors.red('Error processing environment variable INITIAL_USER'), e);\n\t\t}\n\t}\n\n\tif ((await Roles.countUsersInRole('admin')) === 0) {\n\t\tconst oldestUser = await Users.getOldest({ projection: { _id: 1, username: 1, name: 1 } });\n\n\t\tif (oldestUser) {\n\t\t\tawait addUserRolesAsync(oldestUser._id, ['admin']);\n\t\t\tconsole.log(`No admins are found. Set ${oldestUser.username || oldestUser.name} as admin for being the oldest user`);\n\t\t}\n\t}\n\n\tif ((await Roles.countUsersInRole('admin')) !== 0) {\n\t\tif (settings.get('Show_Setup_Wizard') === 'pending') {\n\t\t\tconsole.log('Setting Setup Wizard to \"in_progress\" because, at least, one admin was found');\n\n\t\t\t(await Settings.updateValueById('Show_Setup_Wizard', 'in_progress')).modifiedCount &&\n\t\t\t\tvoid notifyOnSettingChangedById('Show_Setup_Wizard');\n\t\t}\n\t}\n\n\tawait Users.removeById('rocketchat.internal.admin.test');\n\n\tif (process.env.TEST_MODE === 'true') {\n\t\tconsole.log(colors.green('Inserting admin test user:'));\n\n\t\tconst adminUser = {\n\t\t\t_id: 'rocketchat.internal.admin.test',\n\t\t\tname: 'RocketChat Internal Admin Test',\n\t\t\tusername: 'rocketchat.internal.admin.test',\n\t\t\temails: [\n\t\t\t\t{\n\t\t\t\t\taddress: 'rocketchat.internal.admin.test@rocket.chat',\n\t\t\t\t\tverified: false,\n\t\t\t\t},\n\t\t\t],\n\t\t\tstatus: 'offline',\n\t\t\tstatusDefault: 'online',\n\t\t\tutcOffset: 0,\n\t\t\tactive: true,\n\t\t\ttype: 'user',\n\t\t};\n\n\t\tconsole.log(colors.green(`Name: ${adminUser.name}`));\n\t\tconsole.log(colors.green(`Email: ${adminUser.emails[0].address}`));\n\t\tconsole.log(colors.green(`Username: ${adminUser.username}`));\n\t\tconsole.log(colors.green(`Password: ${adminUser._id}`));\n\n\t\tif (await Users.findOneByEmailAddress(adminUser.emails[0].address)) {\n\t\t\tthrow new Meteor.Error(`Email ${adminUser.emails[0].address} already exists`, \"Rocket.Chat can't run in test mode\");\n\t\t}\n\n\t\tif (!(await checkUsernameAvailability(adminUser.username))) {\n\t\t\tthrow new Meteor.Error(`Username ${adminUser.username} already exists`, \"Rocket.Chat can't run in test mode\");\n\t\t}\n\n\t\tawait Users.create(adminUser);\n\n\t\tawait Accounts.setPasswordAsync(adminUser._id, adminUser._id);\n\n\t\tawait addUserRolesAsync(adminUser._id, ['admin']);\n\n\t\tif (settings.get('Show_Setup_Wizard') === 'pending') {\n\t\t\t(await Settings.updateValueById('Show_Setup_Wizard', 'in_progress')).modifiedCount &&\n\t\t\t\tvoid notifyOnSettingChangedById('Show_Setup_Wizard');\n\t\t}\n\n\t\treturn addUserToDefaultChannels(adminUser, true);\n\t}\n});\n"],"names":["insertAdminUserFromEnv","process","env","ADMIN_PASS","Roles","countUsersInRole","adminUser","name","username","status","statusDefault","utcOffset","active","ADMIN_NAME","console","log","colors","green","ADMIN_EMAIL","validateEmail","Users","findOneByEmailAddress","emails","address","verified","ADMIN_EMAIL_VERIFIED","red","ADMIN_USERNAME","nameValidation","RegExp","settings","get","error","test","checkUsernameAvailability","type","insertedId","userId","create","Accounts","setPasswordAsync","addUserRolesAsync","Meteor","startup","dynamicImport","useLocationOrigin","public","packages","exists","Rooms","findOneById","projection","_id","createWithIdTypeAndName","default","Settings","updateValueById","modifiedCount","notifyOnSettingChangedById","buffer","Buffer","from","Assets","getBinaryAsync","rs","RocketChatFile","bufferToStream","fileStore","FileUpload","getStore","deleteByName","file","size","length","upload","insert","setAvatarData","etag","INITIAL_USER","initialUser","JSON","parse","stringify","addUserToDefaultChannels","e","oldestUser","getOldest","removeById","TEST_MODE","Error"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/startup/initialData.js"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c7d15477529eedbf7eb16577c8f3c3fa43e949e9","contentHash":"fb30cad9d4a1d03bea5d389620351f2921e94d58fc895733163cb1bb94562f64"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/receiver/MessageServiceReceiver.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/receiver/MessageServiceReceiver.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":48}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":46},"end":{"line":12,"column":102}},"5":{"start":{"line":13,"column":39},"end":{"line":42,"column":1}},"6":{"start":{"line":16,"column":145},"end":{"line":16,"column":170}},"7":{"start":{"line":17,"column":30},"end":{"line":17,"column":105}},"8":{"start":{"line":18,"column":8},"end":{"line":20,"column":9}},"9":{"start":{"line":19,"column":12},"end":{"line":19,"column":19}},"10":{"start":{"line":21,"column":30},"end":{"line":21,"column":107}},"11":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"12":{"start":{"line":23,"column":12},"end":{"line":23,"column":19}},"13":{"start":{"line":25,"column":24},"end":{"line":25,"column":101}},"14":{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},"15":{"start":{"line":27,"column":12},"end":{"line":27,"column":19}},"16":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"17":{"start":{"line":30,"column":12},"end":{"line":30,"column":19}},"18":{"start":{"line":33,"column":35},"end":{"line":33,"column":500}},"19":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"20":{"start":{"line":35,"column":12},"end":{"line":35,"column":19}},"21":{"start":{"line":37,"column":8},"end":{"line":37,"column":113}},"22":{"start":{"line":40,"column":8},"end":{"line":40,"column":365}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":55},"end":{"line":38,"column":5}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":39,"column":4},"end":{"line":39,"column":5}},"loc":{"start":{"line":39,"column":135},"end":{"line":41,"column":5}},"line":39}},"branchMap":{"0":{"loc":{"start":{"line":18,"column":8},"end":{"line":20,"column":9}},"type":"if","locations":[{"start":{"line":18,"column":8},"end":{"line":20,"column":9}},{"start":{"line":18,"column":8},"end":{"line":20,"column":9}}],"line":18},"1":{"loc":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"type":"if","locations":[{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},{"start":{"line":22,"column":8},"end":{"line":24,"column":9}}],"line":22},"2":{"loc":{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},{"start":{"line":26,"column":8},"end":{"line":28,"column":9}}],"line":26},"3":{"loc":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"type":"if","locations":[{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},{"start":{"line":29,"column":8},"end":{"line":31,"column":9}}],"line":29},"4":{"loc":{"start":{"line":33,"column":43},"end":{"line":33,"column":499}},"type":"binary-expr","locations":[{"start":{"line":33,"column":43},"end":{"line":33,"column":70}},{"start":{"line":33,"column":75},"end":{"line":33,"column":498}}],"line":33},"5":{"loc":{"start":{"line":33,"column":75},"end":{"line":33,"column":498}},"type":"cond-expr","locations":[{"start":{"line":33,"column":160},"end":{"line":33,"column":166}},{"start":{"line":33,"column":169},"end":{"line":33,"column":498}}],"line":33},"6":{"loc":{"start":{"line":33,"column":75},"end":{"line":33,"column":157}},"type":"binary-expr","locations":[{"start":{"line":33,"column":75},"end":{"line":33,"column":124}},{"start":{"line":33,"column":128},"end":{"line":33,"column":157}}],"line":33},"7":{"loc":{"start":{"line":33,"column":169},"end":{"line":33,"column":498}},"type":"cond-expr","locations":[{"start":{"line":33,"column":274},"end":{"line":33,"column":280}},{"start":{"line":33,"column":283},"end":{"line":33,"column":498}}],"line":33},"8":{"loc":{"start":{"line":33,"column":169},"end":{"line":33,"column":271}},"type":"binary-expr","locations":[{"start":{"line":33,"column":169},"end":{"line":33,"column":232}},{"start":{"line":33,"column":236},"end":{"line":33,"column":271}}],"line":33},"9":{"loc":{"start":{"line":33,"column":283},"end":{"line":33,"column":498}},"type":"cond-expr","locations":[{"start":{"line":33,"column":417},"end":{"line":33,"column":423}},{"start":{"line":33,"column":426},"end":{"line":33,"column":498}}],"line":33},"10":{"loc":{"start":{"line":33,"column":283},"end":{"line":33,"column":414}},"type":"binary-expr","locations":[{"start":{"line":33,"column":283},"end":{"line":33,"column":365}},{"start":{"line":33,"column":369},"end":{"line":33,"column":414}}],"line":33},"11":{"loc":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"type":"if","locations":[{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},{"start":{"line":34,"column":8},"end":{"line":36,"column":9}}],"line":34}},"s":{"0":1,"1":1,"2":6,"3":1,"4":1,"5":1,"6":6,"7":6,"8":6,"9":1,"10":5,"11":5,"12":1,"13":4,"14":4,"15":1,"16":3,"17":1,"18":2,"19":2,"20":1,"21":1,"22":6},"f":{"0":6,"1":6,"2":6},"b":{"0":[1,5],"1":[1,4],"2":[1,3],"3":[1,2],"4":[2,2],"5":[0,2],"6":[2,2],"7":[0,2],"8":[2,2],"9":[0,2],"10":[2,2],"11":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/receiver/MessageServiceReceiver.ts"],"sourcesContent":["import { isMessageFromMatrixFederation } from '@rocket.chat/core-typings';\n\nimport type { IFederationBridge } from '../../../../domain/IFederationBridge';\nimport type { RocketChatFileAdapter } from '../../../../infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatMessageAdapter } from '../../../../infrastructure/rocket-chat/adapters/Message';\nimport type { RocketChatRoomAdapter } from '../../../../infrastructure/rocket-chat/adapters/Room';\nimport type { RocketChatSettingsAdapter } from '../../../../infrastructure/rocket-chat/adapters/Settings';\nimport type { RocketChatUserAdapter } from '../../../../infrastructure/rocket-chat/adapters/User';\nimport { AbstractFederationApplicationService } from '../../../AbstractFederationApplicationService';\nimport type { FederationMessageReactionEventDto } from '../../input/MessageReceiverDto';\n\nexport class FederationMessageServiceReceiver extends AbstractFederationApplicationService {\n\tconstructor(\n\t\tprotected internalRoomAdapter: RocketChatRoomAdapter,\n\t\tprotected internalUserAdapter: RocketChatUserAdapter,\n\t\tprotected internalMessageAdapter: RocketChatMessageAdapter,\n\t\tprotected internalFileAdapter: RocketChatFileAdapter,\n\t\tprotected internalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tprotected bridge: IFederationBridge,\n\t) {\n\t\tsuper(bridge, internalUserAdapter, internalFileAdapter, internalSettingsAdapter);\n\t}\n\n\tpublic async onMessageReaction(messageReactionEventInput: FederationMessageReactionEventDto): Promise<void> {\n\t\tconst {\n\t\t\texternalRoomId,\n\t\t\temoji,\n\t\t\texternalSenderId,\n\t\t\texternalEventId: externalReactionEventId,\n\t\t\texternalReactedEventId: externalMessageId,\n\t\t} = messageReactionEventInput;\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalSenderId);\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\t\tconst message = await this.internalMessageAdapter.getMessageByFederationId(externalMessageId);\n\t\tif (!message) {\n\t\t\treturn;\n\t\t}\n\t\tif (!isMessageFromMatrixFederation(message)) {\n\t\t\treturn;\n\t\t}\n\t\t// TODO: move this to a Message entity in the domain layer\n\t\tconst userAlreadyReacted = Boolean(\n\t\t\tfederatedUser.getUsername() && message.reactions?.[emoji]?.usernames?.includes(federatedUser.getUsername() as string),\n\t\t);\n\t\tif (userAlreadyReacted) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.internalMessageAdapter.reactToMessage(federatedUser, message, emoji, externalReactionEventId);\n\t}\n}\n"],"names":["FederationMessageServiceReceiver","AbstractFederationApplicationService","onMessageReaction","messageReactionEventInput","message","externalRoomId","emoji","externalSenderId","externalEventId","externalReactionEventId","externalReactedEventId","externalMessageId","federatedRoom","internalRoomAdapter","getFederatedRoomByExternalId","federatedUser","internalUserAdapter","getFederatedUserByExternalId","internalMessageAdapter","getMessageByFederationId","isMessageFromMatrixFederation","userAlreadyReacted","Boolean","getUsername","reactions","usernames","includes","reactToMessage","constructor","internalFileAdapter","internalSettingsAdapter","bridge"],"mappings":";;;;+BAWaA;;;eAAAA;;;6BAXiC;sDAQO;AAG9C,IAAA,AAAMA,mCAAN,MAAMA,yCAAyCC,0EAAoC;IAYzF,MAAaC,kBAAkBC,yBAA4D,EAAiB;YA2B3EC,oCAAAA,0BAAAA;QA1BhC,MAAM,EACLC,cAAc,EACdC,KAAK,EACLC,gBAAgB,EAChBC,iBAAiBC,uBAAuB,EACxCC,wBAAwBC,iBAAiB,EACzC,GAAGR;QAEJ,MAAMS,gBAAgB,MAAM,IAAI,CAACC,mBAAmB,CAACC,4BAA4B,CAACT;QAClF,IAAI,CAACO,eAAe;YACnB;QACD;QAEA,MAAMG,gBAAgB,MAAM,IAAI,CAACC,mBAAmB,CAACC,4BAA4B,CAACV;QAClF,IAAI,CAACQ,eAAe;YACnB;QACD;QACA,MAAMX,UAAU,MAAM,IAAI,CAACc,sBAAsB,CAACC,wBAAwB,CAACR;QAC3E,IAAI,CAACP,SAAS;YACb;QACD;QACA,IAAI,CAACgB,IAAAA,0CAA6B,EAAChB,UAAU;YAC5C;QACD;QACA,0DAA0D;QAC1D,MAAMiB,qBAAqBC,QAC1BP,cAAcQ,WAAW,QAAMnB,qBAAAA,QAAQoB,SAAS,cAAjBpB,0CAAAA,2BAAAA,kBAAmB,CAACE,MAAM,cAA1BF,gDAAAA,qCAAAA,yBAA4BqB,SAAS,cAArCrB,yDAAAA,mCAAuCsB,QAAQ,CAACX,cAAcQ,WAAW;QAEzG,IAAIF,oBAAoB;YACvB;QACD;QAEA,MAAM,IAAI,CAACH,sBAAsB,CAACS,cAAc,CAACZ,eAAeX,SAASE,OAAOG;IACjF;IA7CAmB,YACC,AAAUf,mBAA0C,EACpD,AAAUG,mBAA0C,EACpD,AAAUE,sBAAgD,EAC1D,AAAUW,mBAA0C,EACpD,AAAUC,uBAAkD,EAC5D,AAAUC,MAAyB,CAClC;QACD,KAAK,CAACA,QAAQf,qBAAqBa,qBAAqBC,+BAP9CjB,sBAAAA,0BACAG,sBAAAA,0BACAE,yBAAAA,6BACAW,sBAAAA,0BACAC,0BAAAA,8BACAC,SAAAA;IAGX;AAqCD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/receiver/MessageServiceReceiver.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"99077231a66bbbc8a420c6ccd7b010bd076237ba","contentHash":"283c377c93f0629c66324f05f31e1c20dd010c13c06cb782876ea96b14df02a6"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/sender/message-sender-helper.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/sender/message-sender-helper.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":40}},"3":{"start":{"line":11,"column":32},"end":{"line":27,"column":1}},"4":{"start":{"line":13,"column":34},"end":{"line":13,"column":106}},"5":{"start":{"line":14,"column":8},"end":{"line":14,"column":110}},"6":{"start":{"line":18,"column":31},"end":{"line":18,"column":280}},"7":{"start":{"line":19,"column":34},"end":{"line":19,"column":375}},"8":{"start":{"line":20,"column":8},"end":{"line":20,"column":110}},"9":{"start":{"line":23,"column":8},"end":{"line":23,"column":29}},"10":{"start":{"line":24,"column":8},"end":{"line":24,"column":61}},"11":{"start":{"line":25,"column":8},"end":{"line":25,"column":55}},"12":{"start":{"line":28,"column":32},"end":{"line":74,"column":1}},"13":{"start":{"line":31,"column":21},"end":{"line":31,"column":142}},"14":{"start":{"line":32,"column":8},"end":{"line":34,"column":9}},"15":{"start":{"line":33,"column":12},"end":{"line":33,"column":19}},"16":{"start":{"line":35,"column":23},"end":{"line":35,"column":82}},"17":{"start":{"line":36,"column":25},"end":{"line":36,"column":84}},"18":{"start":{"line":37,"column":34},"end":{"line":46,"column":10}},"19":{"start":{"line":47,"column":8},"end":{"line":47,"column":110}},"20":{"start":{"line":51,"column":21},"end":{"line":51,"column":142}},"21":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"22":{"start":{"line":53,"column":12},"end":{"line":53,"column":19}},"23":{"start":{"line":55,"column":23},"end":{"line":55,"column":82}},"24":{"start":{"line":56,"column":25},"end":{"line":56,"column":84}},"25":{"start":{"line":57,"column":34},"end":{"line":66,"column":172}},"26":{"start":{"line":67,"column":8},"end":{"line":67,"column":110}},"27":{"start":{"line":70,"column":8},"end":{"line":70,"column":29}},"28":{"start":{"line":71,"column":8},"end":{"line":71,"column":53}},"29":{"start":{"line":72,"column":8},"end":{"line":72,"column":61}},"30":{"start":{"line":75,"column":38},"end":{"line":106,"column":1}},"31":{"start":{"line":78,"column":8},"end":{"line":80,"column":9}},"32":{"start":{"line":79,"column":12},"end":{"line":79,"column":19}},"33":{"start":{"line":81,"column":30},"end":{"line":81,"column":92}},"34":{"start":{"line":82,"column":8},"end":{"line":84,"column":9}},"35":{"start":{"line":83,"column":12},"end":{"line":83,"column":19}},"36":{"start":{"line":85,"column":34},"end":{"line":85,"column":146}},"37":{"start":{"line":86,"column":8},"end":{"line":86,"column":110}},"38":{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},"39":{"start":{"line":91,"column":12},"end":{"line":91,"column":19}},"40":{"start":{"line":93,"column":30},"end":{"line":93,"column":92}},"41":{"start":{"line":94,"column":8},"end":{"line":96,"column":9}},"42":{"start":{"line":95,"column":12},"end":{"line":95,"column":19}},"43":{"start":{"line":97,"column":31},"end":{"line":97,"column":280}},"44":{"start":{"line":98,"column":34},"end":{"line":98,"column":415}},"45":{"start":{"line":99,"column":8},"end":{"line":99,"column":110}},"46":{"start":{"line":102,"column":8},"end":{"line":102,"column":29}},"47":{"start":{"line":103,"column":8},"end":{"line":103,"column":61}},"48":{"start":{"line":104,"column":8},"end":{"line":104,"column":55}},"49":{"start":{"line":107,"column":38},"end":{"line":167,"column":1}},"50":{"start":{"line":110,"column":21},"end":{"line":110,"column":142}},"51":{"start":{"line":111,"column":8},"end":{"line":113,"column":9}},"52":{"start":{"line":112,"column":12},"end":{"line":112,"column":19}},"53":{"start":{"line":114,"column":8},"end":{"line":116,"column":9}},"54":{"start":{"line":115,"column":12},"end":{"line":115,"column":19}},"55":{"start":{"line":117,"column":30},"end":{"line":117,"column":92}},"56":{"start":{"line":118,"column":8},"end":{"line":120,"column":9}},"57":{"start":{"line":119,"column":12},"end":{"line":119,"column":19}},"58":{"start":{"line":121,"column":23},"end":{"line":121,"column":82}},"59":{"start":{"line":122,"column":25},"end":{"line":122,"column":84}},"60":{"start":{"line":123,"column":34},"end":{"line":132,"column":44}},"61":{"start":{"line":133,"column":8},"end":{"line":133,"column":110}},"62":{"start":{"line":137,"column":21},"end":{"line":137,"column":142}},"63":{"start":{"line":138,"column":8},"end":{"line":140,"column":9}},"64":{"start":{"line":139,"column":12},"end":{"line":139,"column":19}},"65":{"start":{"line":141,"column":8},"end":{"line":143,"column":9}},"66":{"start":{"line":142,"column":12},"end":{"line":142,"column":19}},"67":{"start":{"line":144,"column":30},"end":{"line":144,"column":92}},"68":{"start":{"line":145,"column":8},"end":{"line":147,"column":9}},"69":{"start":{"line":146,"column":12},"end":{"line":146,"column":19}},"70":{"start":{"line":148,"column":23},"end":{"line":148,"column":82}},"71":{"start":{"line":149,"column":25},"end":{"line":149,"column":84}},"72":{"start":{"line":150,"column":34},"end":{"line":159,"column":206}},"73":{"start":{"line":160,"column":8},"end":{"line":160,"column":110}},"74":{"start":{"line":163,"column":8},"end":{"line":163,"column":29}},"75":{"start":{"line":164,"column":8},"end":{"line":164,"column":53}},"76":{"start":{"line":165,"column":8},"end":{"line":165,"column":61}},"77":{"start":{"line":168,"column":33},"end":{"line":173,"column":1}},"78":{"start":{"line":169,"column":4},"end":{"line":171,"column":5}},"79":{"start":{"line":170,"column":8},"end":{"line":170,"column":211}},"80":{"start":{"line":172,"column":4},"end":{"line":172,"column":195}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":4},"end":{"line":12,"column":5}},"loc":{"start":{"line":12,"column":65},"end":{"line":15,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":4},"end":{"line":16,"column":5}},"loc":{"start":{"line":16,"column":88},"end":{"line":21,"column":5}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":22,"column":4},"end":{"line":22,"column":5}},"loc":{"start":{"line":22,"column":68},"end":{"line":26,"column":5}},"line":22},"4":{"name":"(anonymous_4)","decl":{"start":{"line":29,"column":4},"end":{"line":29,"column":5}},"loc":{"start":{"line":29,"column":65},"end":{"line":48,"column":5}},"line":29},"5":{"name":"(anonymous_5)","decl":{"start":{"line":49,"column":4},"end":{"line":49,"column":5}},"loc":{"start":{"line":49,"column":88},"end":{"line":68,"column":5}},"line":49},"6":{"name":"(anonymous_6)","decl":{"start":{"line":69,"column":4},"end":{"line":69,"column":5}},"loc":{"start":{"line":69,"column":67},"end":{"line":73,"column":5}},"line":69},"7":{"name":"(anonymous_7)","decl":{"start":{"line":76,"column":4},"end":{"line":76,"column":5}},"loc":{"start":{"line":76,"column":65},"end":{"line":87,"column":5}},"line":76},"8":{"name":"(anonymous_8)","decl":{"start":{"line":88,"column":4},"end":{"line":88,"column":5}},"loc":{"start":{"line":88,"column":88},"end":{"line":100,"column":5}},"line":88},"9":{"name":"(anonymous_9)","decl":{"start":{"line":101,"column":4},"end":{"line":101,"column":5}},"loc":{"start":{"line":101,"column":68},"end":{"line":105,"column":5}},"line":101},"10":{"name":"(anonymous_10)","decl":{"start":{"line":108,"column":4},"end":{"line":108,"column":5}},"loc":{"start":{"line":108,"column":65},"end":{"line":134,"column":5}},"line":108},"11":{"name":"(anonymous_11)","decl":{"start":{"line":135,"column":4},"end":{"line":135,"column":5}},"loc":{"start":{"line":135,"column":88},"end":{"line":161,"column":5}},"line":135},"12":{"name":"(anonymous_12)","decl":{"start":{"line":162,"column":4},"end":{"line":162,"column":5}},"loc":{"start":{"line":162,"column":67},"end":{"line":166,"column":5}},"line":162},"13":{"name":"(anonymous_13)","decl":{"start":{"line":168,"column":33},"end":{"line":168,"column":34}},"loc":{"start":{"line":168,"column":141},"end":{"line":173,"column":1}},"line":168}},"branchMap":{"0":{"loc":{"start":{"line":18,"column":91},"end":{"line":18,"column":279}},"type":"cond-expr","locations":[{"start":{"line":18,"column":150},"end":{"line":18,"column":156}},{"start":{"line":18,"column":159},"end":{"line":18,"column":279}}],"line":18},"1":{"loc":{"start":{"line":18,"column":91},"end":{"line":18,"column":147}},"type":"binary-expr","locations":[{"start":{"line":18,"column":91},"end":{"line":18,"column":116}},{"start":{"line":18,"column":120},"end":{"line":18,"column":147}}],"line":18},"2":{"loc":{"start":{"line":18,"column":159},"end":{"line":18,"column":279}},"type":"cond-expr","locations":[{"start":{"line":18,"column":247},"end":{"line":18,"column":253}},{"start":{"line":18,"column":256},"end":{"line":18,"column":279}}],"line":18},"3":{"loc":{"start":{"line":18,"column":159},"end":{"line":18,"column":244}},"type":"binary-expr","locations":[{"start":{"line":18,"column":159},"end":{"line":18,"column":210}},{"start":{"line":18,"column":214},"end":{"line":18,"column":244}}],"line":18},"4":{"loc":{"start":{"line":19,"column":105},"end":{"line":19,"column":265}},"type":"cond-expr","locations":[{"start":{"line":19,"column":220},"end":{"line":19,"column":226}},{"start":{"line":19,"column":229},"end":{"line":19,"column":265}}],"line":19},"5":{"loc":{"start":{"line":19,"column":105},"end":{"line":19,"column":217}},"type":"binary-expr","locations":[{"start":{"line":19,"column":105},"end":{"line":19,"column":174}},{"start":{"line":19,"column":178},"end":{"line":19,"column":217}}],"line":19},"6":{"loc":{"start":{"line":19,"column":267},"end":{"line":19,"column":361}},"type":"cond-expr","locations":[{"start":{"line":19,"column":322},"end":{"line":19,"column":328}},{"start":{"line":19,"column":331},"end":{"line":19,"column":361}}],"line":19},"7":{"loc":{"start":{"line":19,"column":267},"end":{"line":19,"column":319}},"type":"binary-expr","locations":[{"start":{"line":19,"column":267},"end":{"line":19,"column":290}},{"start":{"line":19,"column":294},"end":{"line":19,"column":319}}],"line":19},"8":{"loc":{"start":{"line":31,"column":69},"end":{"line":31,"column":141}},"type":"cond-expr","locations":[{"start":{"line":31,"column":127},"end":{"line":31,"column":133}},{"start":{"line":31,"column":136},"end":{"line":31,"column":141}}],"line":31},"9":{"loc":{"start":{"line":31,"column":69},"end":{"line":31,"column":124}},"type":"binary-expr","locations":[{"start":{"line":31,"column":69},"end":{"line":31,"column":108}},{"start":{"line":31,"column":112},"end":{"line":31,"column":124}}],"line":31},"10":{"loc":{"start":{"line":31,"column":75},"end":{"line":31,"column":94}},"type":"binary-expr","locations":[{"start":{"line":31,"column":75},"end":{"line":31,"column":88}},{"start":{"line":31,"column":92},"end":{"line":31,"column":94}}],"line":31},"11":{"loc":{"start":{"line":32,"column":8},"end":{"line":34,"column":9}},"type":"if","locations":[{"start":{"line":32,"column":8},"end":{"line":34,"column":9}},{"start":{"line":32,"column":8},"end":{"line":34,"column":9}}],"line":32},"12":{"loc":{"start":{"line":32,"column":12},"end":{"line":32,"column":82}},"type":"binary-expr","locations":[{"start":{"line":32,"column":12},"end":{"line":32,"column":68}},{"start":{"line":32,"column":72},"end":{"line":32,"column":82}}],"line":32},"13":{"loc":{"start":{"line":32,"column":14},"end":{"line":32,"column":67}},"type":"cond-expr","locations":[{"start":{"line":32,"column":49},"end":{"line":32,"column":55}},{"start":{"line":32,"column":58},"end":{"line":32,"column":67}}],"line":32},"14":{"loc":{"start":{"line":32,"column":14},"end":{"line":32,"column":46}},"type":"binary-expr","locations":[{"start":{"line":32,"column":14},"end":{"line":32,"column":27}},{"start":{"line":32,"column":31},"end":{"line":32,"column":46}}],"line":32},"15":{"loc":{"start":{"line":38,"column":22},"end":{"line":38,"column":37}},"type":"binary-expr","locations":[{"start":{"line":38,"column":22},"end":{"line":38,"column":31}},{"start":{"line":38,"column":35},"end":{"line":38,"column":37}}],"line":38},"16":{"loc":{"start":{"line":42,"column":23},"end":{"line":42,"column":89}},"type":"cond-expr","locations":[{"start":{"line":42,"column":66},"end":{"line":42,"column":72}},{"start":{"line":42,"column":75},"end":{"line":42,"column":89}}],"line":42},"17":{"loc":{"start":{"line":42,"column":23},"end":{"line":42,"column":63}},"type":"binary-expr","locations":[{"start":{"line":42,"column":23},"end":{"line":42,"column":40}},{"start":{"line":42,"column":44},"end":{"line":42,"column":63}}],"line":42},"18":{"loc":{"start":{"line":43,"column":24},"end":{"line":43,"column":91}},"type":"cond-expr","locations":[{"start":{"line":43,"column":67},"end":{"line":43,"column":73}},{"start":{"line":43,"column":76},"end":{"line":43,"column":91}}],"line":43},"19":{"loc":{"start":{"line":43,"column":24},"end":{"line":43,"column":64}},"type":"binary-expr","locations":[{"start":{"line":43,"column":24},"end":{"line":43,"column":41}},{"start":{"line":43,"column":45},"end":{"line":43,"column":64}}],"line":43},"20":{"loc":{"start":{"line":44,"column":24},"end":{"line":44,"column":91}},"type":"cond-expr","locations":[{"start":{"line":44,"column":67},"end":{"line":44,"column":73}},{"start":{"line":44,"column":76},"end":{"line":44,"column":91}}],"line":44},"21":{"loc":{"start":{"line":44,"column":24},"end":{"line":44,"column":64}},"type":"binary-expr","locations":[{"start":{"line":44,"column":24},"end":{"line":44,"column":41}},{"start":{"line":44,"column":45},"end":{"line":44,"column":64}}],"line":44},"22":{"loc":{"start":{"line":51,"column":69},"end":{"line":51,"column":141}},"type":"cond-expr","locations":[{"start":{"line":51,"column":127},"end":{"line":51,"column":133}},{"start":{"line":51,"column":136},"end":{"line":51,"column":141}}],"line":51},"23":{"loc":{"start":{"line":51,"column":69},"end":{"line":51,"column":124}},"type":"binary-expr","locations":[{"start":{"line":51,"column":69},"end":{"line":51,"column":108}},{"start":{"line":51,"column":112},"end":{"line":51,"column":124}}],"line":51},"24":{"loc":{"start":{"line":51,"column":75},"end":{"line":51,"column":94}},"type":"binary-expr","locations":[{"start":{"line":51,"column":75},"end":{"line":51,"column":88}},{"start":{"line":51,"column":92},"end":{"line":51,"column":94}}],"line":51},"25":{"loc":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"type":"if","locations":[{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},{"start":{"line":52,"column":8},"end":{"line":54,"column":9}}],"line":52},"26":{"loc":{"start":{"line":52,"column":12},"end":{"line":52,"column":82}},"type":"binary-expr","locations":[{"start":{"line":52,"column":12},"end":{"line":52,"column":68}},{"start":{"line":52,"column":72},"end":{"line":52,"column":82}}],"line":52},"27":{"loc":{"start":{"line":52,"column":14},"end":{"line":52,"column":67}},"type":"cond-expr","locations":[{"start":{"line":52,"column":49},"end":{"line":52,"column":55}},{"start":{"line":52,"column":58},"end":{"line":52,"column":67}}],"line":52},"28":{"loc":{"start":{"line":52,"column":14},"end":{"line":52,"column":46}},"type":"binary-expr","locations":[{"start":{"line":52,"column":14},"end":{"line":52,"column":27}},{"start":{"line":52,"column":31},"end":{"line":52,"column":46}}],"line":52},"29":{"loc":{"start":{"line":58,"column":22},"end":{"line":58,"column":37}},"type":"binary-expr","locations":[{"start":{"line":58,"column":22},"end":{"line":58,"column":31}},{"start":{"line":58,"column":35},"end":{"line":58,"column":37}}],"line":58},"30":{"loc":{"start":{"line":62,"column":23},"end":{"line":62,"column":89}},"type":"cond-expr","locations":[{"start":{"line":62,"column":66},"end":{"line":62,"column":72}},{"start":{"line":62,"column":75},"end":{"line":62,"column":89}}],"line":62},"31":{"loc":{"start":{"line":62,"column":23},"end":{"line":62,"column":63}},"type":"binary-expr","locations":[{"start":{"line":62,"column":23},"end":{"line":62,"column":40}},{"start":{"line":62,"column":44},"end":{"line":62,"column":63}}],"line":62},"32":{"loc":{"start":{"line":63,"column":24},"end":{"line":63,"column":91}},"type":"cond-expr","locations":[{"start":{"line":63,"column":67},"end":{"line":63,"column":73}},{"start":{"line":63,"column":76},"end":{"line":63,"column":91}}],"line":63},"33":{"loc":{"start":{"line":63,"column":24},"end":{"line":63,"column":64}},"type":"binary-expr","locations":[{"start":{"line":63,"column":24},"end":{"line":63,"column":41}},{"start":{"line":63,"column":45},"end":{"line":63,"column":64}}],"line":63},"34":{"loc":{"start":{"line":64,"column":24},"end":{"line":64,"column":91}},"type":"cond-expr","locations":[{"start":{"line":64,"column":67},"end":{"line":64,"column":73}},{"start":{"line":64,"column":76},"end":{"line":64,"column":91}}],"line":64},"35":{"loc":{"start":{"line":64,"column":24},"end":{"line":64,"column":64}},"type":"binary-expr","locations":[{"start":{"line":64,"column":24},"end":{"line":64,"column":41}},{"start":{"line":64,"column":45},"end":{"line":64,"column":64}}],"line":64},"36":{"loc":{"start":{"line":66,"column":11},"end":{"line":66,"column":171}},"type":"cond-expr","locations":[{"start":{"line":66,"column":126},"end":{"line":66,"column":132}},{"start":{"line":66,"column":135},"end":{"line":66,"column":171}}],"line":66},"37":{"loc":{"start":{"line":66,"column":11},"end":{"line":66,"column":123}},"type":"binary-expr","locations":[{"start":{"line":66,"column":11},"end":{"line":66,"column":80}},{"start":{"line":66,"column":84},"end":{"line":66,"column":123}}],"line":66},"38":{"loc":{"start":{"line":78,"column":8},"end":{"line":80,"column":9}},"type":"if","locations":[{"start":{"line":78,"column":8},"end":{"line":80,"column":9}},{"start":{"line":78,"column":8},"end":{"line":80,"column":9}}],"line":78},"39":{"loc":{"start":{"line":82,"column":8},"end":{"line":84,"column":9}},"type":"if","locations":[{"start":{"line":82,"column":8},"end":{"line":84,"column":9}},{"start":{"line":82,"column":8},"end":{"line":84,"column":9}}],"line":82},"40":{"loc":{"start":{"line":82,"column":14},"end":{"line":82,"column":224}},"type":"cond-expr","locations":[{"start":{"line":82,"column":67},"end":{"line":82,"column":73}},{"start":{"line":82,"column":76},"end":{"line":82,"column":224}}],"line":82},"41":{"loc":{"start":{"line":82,"column":14},"end":{"line":82,"column":64}},"type":"binary-expr","locations":[{"start":{"line":82,"column":14},"end":{"line":82,"column":36}},{"start":{"line":82,"column":40},"end":{"line":82,"column":64}}],"line":82},"42":{"loc":{"start":{"line":82,"column":76},"end":{"line":82,"column":224}},"type":"cond-expr","locations":[{"start":{"line":82,"column":182},"end":{"line":82,"column":188}},{"start":{"line":82,"column":191},"end":{"line":82,"column":224}}],"line":82},"43":{"loc":{"start":{"line":82,"column":76},"end":{"line":82,"column":179}},"type":"binary-expr","locations":[{"start":{"line":82,"column":76},"end":{"line":82,"column":139}},{"start":{"line":82,"column":143},"end":{"line":82,"column":179}}],"line":82},"44":{"loc":{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},"type":"if","locations":[{"start":{"line":90,"column":8},"end":{"line":92,"column":9}},{"start":{"line":90,"column":8},"end":{"line":92,"column":9}}],"line":90},"45":{"loc":{"start":{"line":94,"column":8},"end":{"line":96,"column":9}},"type":"if","locations":[{"start":{"line":94,"column":8},"end":{"line":96,"column":9}},{"start":{"line":94,"column":8},"end":{"line":96,"column":9}}],"line":94},"46":{"loc":{"start":{"line":94,"column":14},"end":{"line":94,"column":224}},"type":"cond-expr","locations":[{"start":{"line":94,"column":67},"end":{"line":94,"column":73}},{"start":{"line":94,"column":76},"end":{"line":94,"column":224}}],"line":94},"47":{"loc":{"start":{"line":94,"column":14},"end":{"line":94,"column":64}},"type":"binary-expr","locations":[{"start":{"line":94,"column":14},"end":{"line":94,"column":36}},{"start":{"line":94,"column":40},"end":{"line":94,"column":64}}],"line":94},"48":{"loc":{"start":{"line":94,"column":76},"end":{"line":94,"column":224}},"type":"cond-expr","locations":[{"start":{"line":94,"column":182},"end":{"line":94,"column":188}},{"start":{"line":94,"column":191},"end":{"line":94,"column":224}}],"line":94},"49":{"loc":{"start":{"line":94,"column":76},"end":{"line":94,"column":179}},"type":"binary-expr","locations":[{"start":{"line":94,"column":76},"end":{"line":94,"column":139}},{"start":{"line":94,"column":143},"end":{"line":94,"column":179}}],"line":94},"50":{"loc":{"start":{"line":97,"column":91},"end":{"line":97,"column":279}},"type":"cond-expr","locations":[{"start":{"line":97,"column":150},"end":{"line":97,"column":156}},{"start":{"line":97,"column":159},"end":{"line":97,"column":279}}],"line":97},"51":{"loc":{"start":{"line":97,"column":91},"end":{"line":97,"column":147}},"type":"binary-expr","locations":[{"start":{"line":97,"column":91},"end":{"line":97,"column":116}},{"start":{"line":97,"column":120},"end":{"line":97,"column":147}}],"line":97},"52":{"loc":{"start":{"line":97,"column":159},"end":{"line":97,"column":279}},"type":"cond-expr","locations":[{"start":{"line":97,"column":247},"end":{"line":97,"column":253}},{"start":{"line":97,"column":256},"end":{"line":97,"column":279}}],"line":97},"53":{"loc":{"start":{"line":97,"column":159},"end":{"line":97,"column":244}},"type":"binary-expr","locations":[{"start":{"line":97,"column":159},"end":{"line":97,"column":210}},{"start":{"line":97,"column":214},"end":{"line":97,"column":244}}],"line":97},"54":{"loc":{"start":{"line":98,"column":111},"end":{"line":98,"column":271}},"type":"cond-expr","locations":[{"start":{"line":98,"column":226},"end":{"line":98,"column":232}},{"start":{"line":98,"column":235},"end":{"line":98,"column":271}}],"line":98},"55":{"loc":{"start":{"line":98,"column":111},"end":{"line":98,"column":223}},"type":"binary-expr","locations":[{"start":{"line":98,"column":111},"end":{"line":98,"column":180}},{"start":{"line":98,"column":184},"end":{"line":98,"column":223}}],"line":98},"56":{"loc":{"start":{"line":98,"column":273},"end":{"line":98,"column":367}},"type":"cond-expr","locations":[{"start":{"line":98,"column":328},"end":{"line":98,"column":334}},{"start":{"line":98,"column":337},"end":{"line":98,"column":367}}],"line":98},"57":{"loc":{"start":{"line":98,"column":273},"end":{"line":98,"column":325}},"type":"binary-expr","locations":[{"start":{"line":98,"column":273},"end":{"line":98,"column":296}},{"start":{"line":98,"column":300},"end":{"line":98,"column":325}}],"line":98},"58":{"loc":{"start":{"line":110,"column":69},"end":{"line":110,"column":141}},"type":"cond-expr","locations":[{"start":{"line":110,"column":127},"end":{"line":110,"column":133}},{"start":{"line":110,"column":136},"end":{"line":110,"column":141}}],"line":110},"59":{"loc":{"start":{"line":110,"column":69},"end":{"line":110,"column":124}},"type":"binary-expr","locations":[{"start":{"line":110,"column":69},"end":{"line":110,"column":108}},{"start":{"line":110,"column":112},"end":{"line":110,"column":124}}],"line":110},"60":{"loc":{"start":{"line":110,"column":75},"end":{"line":110,"column":94}},"type":"binary-expr","locations":[{"start":{"line":110,"column":75},"end":{"line":110,"column":88}},{"start":{"line":110,"column":92},"end":{"line":110,"column":94}}],"line":110},"61":{"loc":{"start":{"line":111,"column":8},"end":{"line":113,"column":9}},"type":"if","locations":[{"start":{"line":111,"column":8},"end":{"line":113,"column":9}},{"start":{"line":111,"column":8},"end":{"line":113,"column":9}}],"line":111},"62":{"loc":{"start":{"line":111,"column":12},"end":{"line":111,"column":96}},"type":"binary-expr","locations":[{"start":{"line":111,"column":12},"end":{"line":111,"column":68}},{"start":{"line":111,"column":72},"end":{"line":111,"column":82}},{"start":{"line":111,"column":86},"end":{"line":111,"column":96}}],"line":111},"63":{"loc":{"start":{"line":111,"column":14},"end":{"line":111,"column":67}},"type":"cond-expr","locations":[{"start":{"line":111,"column":49},"end":{"line":111,"column":55}},{"start":{"line":111,"column":58},"end":{"line":111,"column":67}}],"line":111},"64":{"loc":{"start":{"line":111,"column":14},"end":{"line":111,"column":46}},"type":"binary-expr","locations":[{"start":{"line":111,"column":14},"end":{"line":111,"column":27}},{"start":{"line":111,"column":31},"end":{"line":111,"column":46}}],"line":111},"65":{"loc":{"start":{"line":114,"column":8},"end":{"line":116,"column":9}},"type":"if","locations":[{"start":{"line":114,"column":8},"end":{"line":116,"column":9}},{"start":{"line":114,"column":8},"end":{"line":116,"column":9}}],"line":114},"66":{"loc":{"start":{"line":118,"column":8},"end":{"line":120,"column":9}},"type":"if","locations":[{"start":{"line":118,"column":8},"end":{"line":120,"column":9}},{"start":{"line":118,"column":8},"end":{"line":120,"column":9}}],"line":118},"67":{"loc":{"start":{"line":118,"column":14},"end":{"line":118,"column":224}},"type":"cond-expr","locations":[{"start":{"line":118,"column":67},"end":{"line":118,"column":73}},{"start":{"line":118,"column":76},"end":{"line":118,"column":224}}],"line":118},"68":{"loc":{"start":{"line":118,"column":14},"end":{"line":118,"column":64}},"type":"binary-expr","locations":[{"start":{"line":118,"column":14},"end":{"line":118,"column":36}},{"start":{"line":118,"column":40},"end":{"line":118,"column":64}}],"line":118},"69":{"loc":{"start":{"line":118,"column":76},"end":{"line":118,"column":224}},"type":"cond-expr","locations":[{"start":{"line":118,"column":182},"end":{"line":118,"column":188}},{"start":{"line":118,"column":191},"end":{"line":118,"column":224}}],"line":118},"70":{"loc":{"start":{"line":118,"column":76},"end":{"line":118,"column":179}},"type":"binary-expr","locations":[{"start":{"line":118,"column":76},"end":{"line":118,"column":139}},{"start":{"line":118,"column":143},"end":{"line":118,"column":179}}],"line":118},"71":{"loc":{"start":{"line":128,"column":23},"end":{"line":128,"column":89}},"type":"cond-expr","locations":[{"start":{"line":128,"column":66},"end":{"line":128,"column":72}},{"start":{"line":128,"column":75},"end":{"line":128,"column":89}}],"line":128},"72":{"loc":{"start":{"line":128,"column":23},"end":{"line":128,"column":63}},"type":"binary-expr","locations":[{"start":{"line":128,"column":23},"end":{"line":128,"column":40}},{"start":{"line":128,"column":44},"end":{"line":128,"column":63}}],"line":128},"73":{"loc":{"start":{"line":129,"column":24},"end":{"line":129,"column":91}},"type":"cond-expr","locations":[{"start":{"line":129,"column":67},"end":{"line":129,"column":73}},{"start":{"line":129,"column":76},"end":{"line":129,"column":91}}],"line":129},"74":{"loc":{"start":{"line":129,"column":24},"end":{"line":129,"column":64}},"type":"binary-expr","locations":[{"start":{"line":129,"column":24},"end":{"line":129,"column":41}},{"start":{"line":129,"column":45},"end":{"line":129,"column":64}}],"line":129},"75":{"loc":{"start":{"line":130,"column":24},"end":{"line":130,"column":91}},"type":"cond-expr","locations":[{"start":{"line":130,"column":67},"end":{"line":130,"column":73}},{"start":{"line":130,"column":76},"end":{"line":130,"column":91}}],"line":130},"76":{"loc":{"start":{"line":130,"column":24},"end":{"line":130,"column":64}},"type":"binary-expr","locations":[{"start":{"line":130,"column":24},"end":{"line":130,"column":41}},{"start":{"line":130,"column":45},"end":{"line":130,"column":64}}],"line":130},"77":{"loc":{"start":{"line":137,"column":69},"end":{"line":137,"column":141}},"type":"cond-expr","locations":[{"start":{"line":137,"column":127},"end":{"line":137,"column":133}},{"start":{"line":137,"column":136},"end":{"line":137,"column":141}}],"line":137},"78":{"loc":{"start":{"line":137,"column":69},"end":{"line":137,"column":124}},"type":"binary-expr","locations":[{"start":{"line":137,"column":69},"end":{"line":137,"column":108}},{"start":{"line":137,"column":112},"end":{"line":137,"column":124}}],"line":137},"79":{"loc":{"start":{"line":137,"column":75},"end":{"line":137,"column":94}},"type":"binary-expr","locations":[{"start":{"line":137,"column":75},"end":{"line":137,"column":88}},{"start":{"line":137,"column":92},"end":{"line":137,"column":94}}],"line":137},"80":{"loc":{"start":{"line":138,"column":8},"end":{"line":140,"column":9}},"type":"if","locations":[{"start":{"line":138,"column":8},"end":{"line":140,"column":9}},{"start":{"line":138,"column":8},"end":{"line":140,"column":9}}],"line":138},"81":{"loc":{"start":{"line":138,"column":12},"end":{"line":138,"column":96}},"type":"binary-expr","locations":[{"start":{"line":138,"column":12},"end":{"line":138,"column":68}},{"start":{"line":138,"column":72},"end":{"line":138,"column":82}},{"start":{"line":138,"column":86},"end":{"line":138,"column":96}}],"line":138},"82":{"loc":{"start":{"line":138,"column":14},"end":{"line":138,"column":67}},"type":"cond-expr","locations":[{"start":{"line":138,"column":49},"end":{"line":138,"column":55}},{"start":{"line":138,"column":58},"end":{"line":138,"column":67}}],"line":138},"83":{"loc":{"start":{"line":138,"column":14},"end":{"line":138,"column":46}},"type":"binary-expr","locations":[{"start":{"line":138,"column":14},"end":{"line":138,"column":27}},{"start":{"line":138,"column":31},"end":{"line":138,"column":46}}],"line":138},"84":{"loc":{"start":{"line":141,"column":8},"end":{"line":143,"column":9}},"type":"if","locations":[{"start":{"line":141,"column":8},"end":{"line":143,"column":9}},{"start":{"line":141,"column":8},"end":{"line":143,"column":9}}],"line":141},"85":{"loc":{"start":{"line":145,"column":8},"end":{"line":147,"column":9}},"type":"if","locations":[{"start":{"line":145,"column":8},"end":{"line":147,"column":9}},{"start":{"line":145,"column":8},"end":{"line":147,"column":9}}],"line":145},"86":{"loc":{"start":{"line":145,"column":14},"end":{"line":145,"column":224}},"type":"cond-expr","locations":[{"start":{"line":145,"column":67},"end":{"line":145,"column":73}},{"start":{"line":145,"column":76},"end":{"line":145,"column":224}}],"line":145},"87":{"loc":{"start":{"line":145,"column":14},"end":{"line":145,"column":64}},"type":"binary-expr","locations":[{"start":{"line":145,"column":14},"end":{"line":145,"column":36}},{"start":{"line":145,"column":40},"end":{"line":145,"column":64}}],"line":145},"88":{"loc":{"start":{"line":145,"column":76},"end":{"line":145,"column":224}},"type":"cond-expr","locations":[{"start":{"line":145,"column":182},"end":{"line":145,"column":188}},{"start":{"line":145,"column":191},"end":{"line":145,"column":224}}],"line":145},"89":{"loc":{"start":{"line":145,"column":76},"end":{"line":145,"column":179}},"type":"binary-expr","locations":[{"start":{"line":145,"column":76},"end":{"line":145,"column":139}},{"start":{"line":145,"column":143},"end":{"line":145,"column":179}}],"line":145},"90":{"loc":{"start":{"line":155,"column":23},"end":{"line":155,"column":89}},"type":"cond-expr","locations":[{"start":{"line":155,"column":66},"end":{"line":155,"column":72}},{"start":{"line":155,"column":75},"end":{"line":155,"column":89}}],"line":155},"91":{"loc":{"start":{"line":155,"column":23},"end":{"line":155,"column":63}},"type":"binary-expr","locations":[{"start":{"line":155,"column":23},"end":{"line":155,"column":40}},{"start":{"line":155,"column":44},"end":{"line":155,"column":63}}],"line":155},"92":{"loc":{"start":{"line":156,"column":24},"end":{"line":156,"column":91}},"type":"cond-expr","locations":[{"start":{"line":156,"column":67},"end":{"line":156,"column":73}},{"start":{"line":156,"column":76},"end":{"line":156,"column":91}}],"line":156},"93":{"loc":{"start":{"line":156,"column":24},"end":{"line":156,"column":64}},"type":"binary-expr","locations":[{"start":{"line":156,"column":24},"end":{"line":156,"column":41}},{"start":{"line":156,"column":45},"end":{"line":156,"column":64}}],"line":156},"94":{"loc":{"start":{"line":157,"column":24},"end":{"line":157,"column":91}},"type":"cond-expr","locations":[{"start":{"line":157,"column":67},"end":{"line":157,"column":73}},{"start":{"line":157,"column":76},"end":{"line":157,"column":91}}],"line":157},"95":{"loc":{"start":{"line":157,"column":24},"end":{"line":157,"column":64}},"type":"binary-expr","locations":[{"start":{"line":157,"column":24},"end":{"line":157,"column":41}},{"start":{"line":157,"column":45},"end":{"line":157,"column":64}}],"line":157},"96":{"loc":{"start":{"line":159,"column":11},"end":{"line":159,"column":171}},"type":"cond-expr","locations":[{"start":{"line":159,"column":126},"end":{"line":159,"column":132}},{"start":{"line":159,"column":135},"end":{"line":159,"column":171}}],"line":159},"97":{"loc":{"start":{"line":159,"column":11},"end":{"line":159,"column":123}},"type":"binary-expr","locations":[{"start":{"line":159,"column":11},"end":{"line":159,"column":80}},{"start":{"line":159,"column":84},"end":{"line":159,"column":123}}],"line":159},"98":{"loc":{"start":{"line":169,"column":4},"end":{"line":171,"column":5}},"type":"if","locations":[{"start":{"line":169,"column":4},"end":{"line":171,"column":5}},{"start":{"line":169,"column":4},"end":{"line":171,"column":5}}],"line":169},"99":{"loc":{"start":{"line":170,"column":15},"end":{"line":170,"column":210}},"type":"cond-expr","locations":[{"start":{"line":170,"column":31},"end":{"line":170,"column":119}},{"start":{"line":170,"column":122},"end":{"line":170,"column":210}}],"line":170},"100":{"loc":{"start":{"line":172,"column":11},"end":{"line":172,"column":194}},"type":"cond-expr","locations":[{"start":{"line":172,"column":27},"end":{"line":172,"column":109}},{"start":{"line":172,"column":112},"end":{"line":172,"column":194}}],"line":172}},"s":{"0":1,"1":1,"2":28,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":2,"10":2,"11":2,"12":1,"13":4,"14":4,"15":3,"16":1,"17":1,"18":1,"19":1,"20":4,"21":4,"22":3,"23":1,"24":1,"25":1,"26":1,"27":8,"28":8,"29":8,"30":1,"31":4,"32":0,"33":4,"34":4,"35":3,"36":1,"37":1,"38":4,"39":0,"40":4,"41":4,"42":3,"43":1,"44":1,"45":1,"46":8,"47":8,"48":8,"49":1,"50":5,"51":5,"52":4,"53":1,"54":0,"55":1,"56":1,"57":0,"58":1,"59":1,"60":1,"61":1,"62":5,"63":5,"64":4,"65":1,"66":0,"67":1,"68":1,"69":0,"70":1,"71":1,"72":1,"73":1,"74":10,"75":10,"76":10,"77":1,"78":28,"79":18,"80":10},"f":{"0":28,"1":1,"2":1,"3":2,"4":4,"5":4,"6":8,"7":4,"8":4,"9":8,"10":5,"11":5,"12":10,"13":28},"b":{"0":[0,1],"1":[1,1],"2":[1,0],"3":[1,1],"4":[0,1],"5":[1,1],"6":[0,1],"7":[1,1],"8":[0,4],"9":[4,4],"10":[4,0],"11":[3,1],"12":[4,2],"13":[1,3],"14":[4,4],"15":[1,0],"16":[0,1],"17":[1,1],"18":[0,1],"19":[1,1],"20":[0,1],"21":[1,1],"22":[0,4],"23":[4,4],"24":[4,0],"25":[3,1],"26":[4,2],"27":[1,3],"28":[4,4],"29":[1,0],"30":[0,1],"31":[1,1],"32":[0,1],"33":[1,1],"34":[0,1],"35":[1,1],"36":[0,1],"37":[1,1],"38":[0,4],"39":[3,1],"40":[3,1],"41":[4,4],"42":[0,1],"43":[1,1],"44":[0,4],"45":[3,1],"46":[3,1],"47":[4,4],"48":[0,1],"49":[1,1],"50":[0,1],"51":[1,1],"52":[1,0],"53":[1,1],"54":[0,1],"55":[1,1],"56":[0,1],"57":[1,1],"58":[0,5],"59":[5,5],"60":[5,0],"61":[4,1],"62":[5,2,1],"63":[2,3],"64":[5,5],"65":[0,1],"66":[0,1],"67":[0,1],"68":[1,1],"69":[0,1],"70":[1,1],"71":[0,1],"72":[1,1],"73":[0,1],"74":[1,1],"75":[0,1],"76":[1,1],"77":[0,5],"78":[5,5],"79":[5,0],"80":[4,1],"81":[5,2,1],"82":[2,3],"83":[5,5],"84":[0,1],"85":[0,1],"86":[0,1],"87":[1,1],"88":[0,1],"89":[1,1],"90":[0,1],"91":[1,1],"92":[0,1],"93":[1,1],"94":[0,1],"95":[1,1],"96":[0,1],"97":[1,1],"98":[18,10],"99":[10,8],"100":[8,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/sender/message-sender-helper.ts"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\n\nimport type { IFederationBridge } from '../../../../domain/IFederationBridge';\nimport type { RocketChatFileAdapter } from '../../../../infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatMessageAdapter } from '../../../../infrastructure/rocket-chat/adapters/Message';\nimport type { RocketChatUserAdapter } from '../../../../infrastructure/rocket-chat/adapters/User';\n\ninterface IExternalMessageSender {\n\tsendMessage(externalRoomId: string, externalSenderId: string, message: IMessage): Promise<void>;\n\tsendQuoteMessage(externalRoomId: string, externalSenderId: string, message: IMessage, messageToReplyTo: IMessage): Promise<void>;\n}\n\nclass TextExternalMessageSender implements IExternalMessageSender {\n\tconstructor(\n\t\tprivate readonly bridge: IFederationBridge,\n\t\tprivate readonly internalMessageAdapter: RocketChatMessageAdapter,\n\t\tprivate readonly internalUserAdapter: RocketChatUserAdapter,\n\t) {}\n\n\tpublic async sendMessage(externalRoomId: string, externalSenderId: string, message: IMessage): Promise<void> {\n\t\tconst externalMessageId = await this.bridge.sendMessage(externalRoomId, externalSenderId, message);\n\n\t\tawait this.internalMessageAdapter.setExternalFederationEventOnMessage(message._id, externalMessageId);\n\t}\n\n\tpublic async sendQuoteMessage(\n\t\texternalRoomId: string,\n\t\texternalSenderId: string,\n\t\tmessage: IMessage,\n\t\tmessageToReplyTo: IMessage,\n\t): Promise<void> {\n\t\tconst originalSender = await this.internalUserAdapter.getFederatedUserByInternalId(messageToReplyTo?.u?._id);\n\t\tconst externalMessageId = await this.bridge.sendReplyToMessage(\n\t\t\texternalRoomId,\n\t\t\texternalSenderId,\n\t\t\tmessageToReplyTo.federation?.eventId as string,\n\t\t\toriginalSender?.getExternalId() as string,\n\t\t\tmessage.msg,\n\t\t);\n\t\tawait this.internalMessageAdapter.setExternalFederationEventOnMessage(message._id, externalMessageId);\n\t}\n}\n\nclass FileExternalMessageSender implements IExternalMessageSender {\n\tconstructor(\n\t\tprivate readonly bridge: IFederationBridge,\n\t\tprivate readonly internalFileHelper: RocketChatFileAdapter,\n\t\tprivate readonly internalMessageAdapter: RocketChatMessageAdapter,\n\t) {}\n\n\tpublic async sendMessage(externalRoomId: string, externalSenderId: string, message: IMessage): Promise<void> {\n\t\tconst file = await this.internalFileHelper.getFileRecordById((message.files || [])[0]?._id);\n\t\tif (!file?.size || !file.type) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst buffer = await this.internalFileHelper.getBufferFromFileRecord(file);\n\t\tconst metadata = await this.internalFileHelper.extractMetadataFromFile(file);\n\n\t\tconst externalMessageId = await this.bridge.sendMessageFileToRoom(externalRoomId, externalSenderId, buffer, {\n\t\t\tfilename: file.name || '',\n\t\t\tfileSize: file.size,\n\t\t\tmimeType: file.type,\n\t\t\tmetadata: {\n\t\t\t\twidth: metadata?.width,\n\t\t\t\theight: metadata?.height,\n\t\t\t\tformat: metadata?.format,\n\t\t\t},\n\t\t});\n\n\t\tawait this.internalMessageAdapter.setExternalFederationEventOnMessage(message._id, externalMessageId);\n\t}\n\n\tpublic async sendQuoteMessage(\n\t\texternalRoomId: string,\n\t\texternalSenderId: string,\n\t\tmessage: IMessage,\n\t\tmessageToReplyTo: IMessage,\n\t): Promise<void> {\n\t\tconst file = await this.internalFileHelper.getFileRecordById((message.files || [])[0]?._id);\n\t\tif (!file?.size || !file.type) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst buffer = await this.internalFileHelper.getBufferFromFileRecord(file);\n\t\tconst metadata = await this.internalFileHelper.extractMetadataFromFile(file);\n\n\t\tconst externalMessageId = await this.bridge.sendReplyMessageFileToRoom(\n\t\t\texternalRoomId,\n\t\t\texternalSenderId,\n\t\t\tbuffer,\n\t\t\t{\n\t\t\t\tfilename: file.name || '',\n\t\t\t\tfileSize: file.size,\n\t\t\t\tmimeType: file.type,\n\t\t\t\tmetadata: {\n\t\t\t\t\twidth: metadata?.width,\n\t\t\t\t\theight: metadata?.height,\n\t\t\t\t\tformat: metadata?.format,\n\t\t\t\t},\n\t\t\t},\n\t\t\tmessageToReplyTo.federation?.eventId as string,\n\t\t);\n\n\t\tawait this.internalMessageAdapter.setExternalFederationEventOnMessage(message._id, externalMessageId);\n\t}\n}\n\nclass ThreadTextExternalMessageSender implements IExternalMessageSender {\n\tconstructor(\n\t\tprivate readonly bridge: IFederationBridge,\n\t\tprivate readonly internalMessageAdapter: RocketChatMessageAdapter,\n\t\tprivate readonly internalUserAdapter: RocketChatUserAdapter,\n\t) {}\n\n\tpublic async sendMessage(externalRoomId: string, externalSenderId: string, message: IMessage): Promise<void> {\n\t\tif (!message.tmid) {\n\t\t\treturn;\n\t\t}\n\t\tconst parentMessage = await this.internalMessageAdapter.getMessageById(message.tmid);\n\t\tif (!parentMessage?.federation?.eventId) {\n\t\t\treturn;\n\t\t}\n\t\tconst externalMessageId = await this.bridge.sendThreadMessage(\n\t\t\texternalRoomId,\n\t\t\texternalSenderId,\n\t\t\tmessage,\n\t\t\tparentMessage.federation.eventId,\n\t\t);\n\n\t\tawait this.internalMessageAdapter.setExternalFederationEventOnMessage(message._id, externalMessageId);\n\t}\n\n\tpublic async sendQuoteMessage(\n\t\texternalRoomId: string,\n\t\texternalSenderId: string,\n\t\tmessage: IMessage,\n\t\tmessageToReplyTo: IMessage,\n\t): Promise<void> {\n\t\tif (!message.tmid) {\n\t\t\treturn;\n\t\t}\n\t\tconst parentMessage = await this.internalMessageAdapter.getMessageById(message.tmid);\n\t\tif (!parentMessage?.federation?.eventId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst originalSender = await this.internalUserAdapter.getFederatedUserByInternalId(messageToReplyTo?.u?._id);\n\t\tconst externalMessageId = await this.bridge.sendThreadReplyToMessage(\n\t\t\texternalRoomId,\n\t\t\texternalSenderId,\n\t\t\tmessageToReplyTo.federation?.eventId as string,\n\t\t\toriginalSender?.getExternalId() as string,\n\t\t\tmessage.msg,\n\t\t\tparentMessage.federation.eventId,\n\t\t);\n\t\tawait this.internalMessageAdapter.setExternalFederationEventOnMessage(message._id, externalMessageId);\n\t}\n}\n\nclass ThreadFileExternalMessageSender implements IExternalMessageSender {\n\tconstructor(\n\t\tprivate readonly bridge: IFederationBridge,\n\t\tprivate readonly internalFileHelper: RocketChatFileAdapter,\n\t\tprivate readonly internalMessageAdapter: RocketChatMessageAdapter,\n\t) {}\n\n\tpublic async sendMessage(externalRoomId: string, externalSenderId: string, message: IMessage): Promise<void> {\n\t\tconst file = await this.internalFileHelper.getFileRecordById((message.files || [])[0]?._id);\n\t\tif (!file?.size || !file.type || !file.name) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!message.tmid) {\n\t\t\treturn;\n\t\t}\n\t\tconst parentMessage = await this.internalMessageAdapter.getMessageById(message.tmid);\n\t\tif (!parentMessage?.federation?.eventId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst buffer = await this.internalFileHelper.getBufferFromFileRecord(file);\n\t\tconst metadata = await this.internalFileHelper.extractMetadataFromFile(file);\n\n\t\tconst externalMessageId = await this.bridge.sendMessageFileToThread(\n\t\t\texternalRoomId,\n\t\t\texternalSenderId,\n\t\t\tbuffer,\n\t\t\t{\n\t\t\t\tfilename: file.name,\n\t\t\t\tfileSize: file.size,\n\t\t\t\tmimeType: file.type,\n\t\t\t\tmetadata: {\n\t\t\t\t\twidth: metadata?.width,\n\t\t\t\t\theight: metadata?.height,\n\t\t\t\t\tformat: metadata?.format,\n\t\t\t\t},\n\t\t\t},\n\t\t\tparentMessage.federation.eventId,\n\t\t);\n\n\t\tawait this.internalMessageAdapter.setExternalFederationEventOnMessage(message._id, externalMessageId);\n\t}\n\n\tpublic async sendQuoteMessage(\n\t\texternalRoomId: string,\n\t\texternalSenderId: string,\n\t\tmessage: IMessage,\n\t\tmessageToReplyTo: IMessage,\n\t): Promise<void> {\n\t\tconst file = await this.internalFileHelper.getFileRecordById((message.files || [])[0]?._id);\n\t\tif (!file?.size || !file.type || !file.name) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!message.tmid) {\n\t\t\treturn;\n\t\t}\n\t\tconst parentMessage = await this.internalMessageAdapter.getMessageById(message.tmid);\n\t\tif (!parentMessage?.federation?.eventId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst buffer = await this.internalFileHelper.getBufferFromFileRecord(file);\n\t\tconst metadata = await this.internalFileHelper.extractMetadataFromFile(file);\n\n\t\tconst externalMessageId = await this.bridge.sendReplyMessageFileToThread(\n\t\t\texternalRoomId,\n\t\t\texternalSenderId,\n\t\t\tbuffer,\n\t\t\t{\n\t\t\t\tfilename: file.name,\n\t\t\t\tfileSize: file.size,\n\t\t\t\tmimeType: file.type,\n\t\t\t\tmetadata: {\n\t\t\t\t\twidth: metadata?.width,\n\t\t\t\t\theight: metadata?.height,\n\t\t\t\t\tformat: metadata?.format,\n\t\t\t\t},\n\t\t\t},\n\t\t\tmessageToReplyTo.federation?.eventId as string,\n\t\t\tparentMessage.federation.eventId,\n\t\t);\n\n\t\tawait this.internalMessageAdapter.setExternalFederationEventOnMessage(message._id, externalMessageId);\n\t}\n}\n\nexport const getExternalMessageSender = ({\n\tmessage,\n\tbridge,\n\tinternalFileAdapter,\n\tinternalMessageAdapter,\n\tinternalUserAdapter,\n\tisThreadedMessage,\n}: {\n\tmessage: IMessage;\n\tisThreadedMessage: boolean;\n\tbridge: IFederationBridge;\n\tinternalFileAdapter: RocketChatFileAdapter;\n\tinternalMessageAdapter: RocketChatMessageAdapter;\n\tinternalUserAdapter: RocketChatUserAdapter;\n}): IExternalMessageSender => {\n\tif (isThreadedMessage) {\n\t\treturn message.files\n\t\t\t? new ThreadFileExternalMessageSender(bridge, internalFileAdapter, internalMessageAdapter)\n\t\t\t: new ThreadTextExternalMessageSender(bridge, internalMessageAdapter, internalUserAdapter);\n\t}\n\treturn message.files\n\t\t? new FileExternalMessageSender(bridge, internalFileAdapter, internalMessageAdapter)\n\t\t: new TextExternalMessageSender(bridge, internalMessageAdapter, internalUserAdapter);\n};\n"],"names":["getExternalMessageSender","TextExternalMessageSender","sendMessage","externalRoomId","externalSenderId","message","externalMessageId","bridge","internalMessageAdapter","setExternalFederationEventOnMessage","_id","sendQuoteMessage","messageToReplyTo","originalSender","internalUserAdapter","getFederatedUserByInternalId","u","sendReplyToMessage","federation","eventId","getExternalId","msg","constructor","FileExternalMessageSender","file","internalFileHelper","getFileRecordById","files","size","type","buffer","getBufferFromFileRecord","metadata","extractMetadataFromFile","sendMessageFileToRoom","filename","name","fileSize","mimeType","width","height","format","sendReplyMessageFileToRoom","ThreadTextExternalMessageSender","parentMessage","tmid","getMessageById","sendThreadMessage","sendThreadReplyToMessage","ThreadFileExternalMessageSender","sendMessageFileToThread","sendReplyMessageFileToThread","internalFileAdapter","isThreadedMessage"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/sender/message-sender-helper.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"3cecb7e9653f396ce60a4f25bbe332d0a0767f4a","contentHash":"11c68300bf798d9fb9f1310abb9e91a95516aa61f67bc2274e6d3821367544bc"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/sender/MessageServiceSender.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/sender/MessageServiceSender.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":46}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":20},"end":{"line":12,"column":53}},"5":{"start":{"line":13,"column":23},"end":{"line":13,"column":66}},"6":{"start":{"line":14,"column":37},"end":{"line":77,"column":1}},"7":{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},"8":{"start":{"line":18,"column":12},"end":{"line":18,"column":19}},"9":{"start":{"line":20,"column":32},"end":{"line":20,"column":109}},"10":{"start":{"line":21,"column":8},"end":{"line":23,"column":9}},"11":{"start":{"line":22,"column":12},"end":{"line":22,"column":19}},"12":{"start":{"line":24,"column":30},"end":{"line":24,"column":110}},"13":{"start":{"line":25,"column":8},"end":{"line":27,"column":9}},"14":{"start":{"line":26,"column":12},"end":{"line":26,"column":19}},"15":{"start":{"line":28,"column":8},"end":{"line":30,"column":9}},"16":{"start":{"line":29,"column":12},"end":{"line":29,"column":19}},"17":{"start":{"line":31,"column":44},"end":{"line":31,"column":223}},"18":{"start":{"line":32,"column":8},"end":{"line":34,"column":9}},"19":{"start":{"line":33,"column":12},"end":{"line":33,"column":19}},"20":{"start":{"line":35,"column":24},"end":{"line":35,"column":293}},"21":{"start":{"line":36,"column":8},"end":{"line":36,"column":186}},"22":{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},"23":{"start":{"line":41,"column":12},"end":{"line":41,"column":19}},"24":{"start":{"line":43,"column":32},"end":{"line":43,"column":109}},"25":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"26":{"start":{"line":45,"column":12},"end":{"line":45,"column":19}},"27":{"start":{"line":47,"column":30},"end":{"line":47,"column":110}},"28":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"29":{"start":{"line":49,"column":12},"end":{"line":49,"column":19}},"30":{"start":{"line":51,"column":8},"end":{"line":53,"column":9}},"31":{"start":{"line":52,"column":12},"end":{"line":52,"column":19}},"32":{"start":{"line":54,"column":44},"end":{"line":54,"column":223}},"33":{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},"34":{"start":{"line":56,"column":12},"end":{"line":56,"column":19}},"35":{"start":{"line":59,"column":32},"end":{"line":62,"column":10}},"36":{"start":{"line":61,"column":12},"end":{"line":61,"column":461}},"37":{"start":{"line":63,"column":8},"end":{"line":65,"column":9}},"38":{"start":{"line":64,"column":12},"end":{"line":64,"column":19}},"39":{"start":{"line":66,"column":34},"end":{"line":66,"column":107}},"40":{"start":{"line":67,"column":8},"end":{"line":67,"column":121}},"41":{"start":{"line":68,"column":8},"end":{"line":68,"column":132}},"42":{"start":{"line":71,"column":8},"end":{"line":71,"column":55}},"43":{"start":{"line":72,"column":8},"end":{"line":72,"column":55}},"44":{"start":{"line":73,"column":8},"end":{"line":73,"column":63}},"45":{"start":{"line":74,"column":8},"end":{"line":74,"column":61}},"46":{"start":{"line":75,"column":8},"end":{"line":75,"column":29}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":15,"column":4},"end":{"line":15,"column":5}},"loc":{"start":{"line":15,"column":79},"end":{"line":37,"column":5}},"line":15},"2":{"name":"(anonymous_2)","decl":{"start":{"line":38,"column":4},"end":{"line":38,"column":5}},"loc":{"start":{"line":38,"column":81},"end":{"line":69,"column":5}},"line":38},"3":{"name":"(anonymous_3)","decl":{"start":{"line":59,"column":240},"end":{"line":59,"column":241}},"loc":{"start":{"line":59,"column":247},"end":{"line":62,"column":9}},"line":59},"4":{"name":"(anonymous_4)","decl":{"start":{"line":70,"column":4},"end":{"line":70,"column":5}},"loc":{"start":{"line":70,"column":114},"end":{"line":76,"column":5}},"line":70}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},"type":"if","locations":[{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},{"start":{"line":17,"column":8},"end":{"line":19,"column":9}}],"line":17},"1":{"loc":{"start":{"line":17,"column":12},"end":{"line":17,"column":90}},"type":"binary-expr","locations":[{"start":{"line":17,"column":12},"end":{"line":17,"column":28}},{"start":{"line":17,"column":32},"end":{"line":17,"column":45}},{"start":{"line":17,"column":49},"end":{"line":17,"column":66}},{"start":{"line":17,"column":70},"end":{"line":17,"column":90}}],"line":17},"2":{"loc":{"start":{"line":21,"column":8},"end":{"line":23,"column":9}},"type":"if","locations":[{"start":{"line":21,"column":8},"end":{"line":23,"column":9}},{"start":{"line":21,"column":8},"end":{"line":23,"column":9}}],"line":21},"3":{"loc":{"start":{"line":25,"column":8},"end":{"line":27,"column":9}},"type":"if","locations":[{"start":{"line":25,"column":8},"end":{"line":27,"column":9}},{"start":{"line":25,"column":8},"end":{"line":27,"column":9}}],"line":25},"4":{"loc":{"start":{"line":28,"column":8},"end":{"line":30,"column":9}},"type":"if","locations":[{"start":{"line":28,"column":8},"end":{"line":30,"column":9}},{"start":{"line":28,"column":8},"end":{"line":30,"column":9}}],"line":28},"5":{"loc":{"start":{"line":32,"column":8},"end":{"line":34,"column":9}},"type":"if","locations":[{"start":{"line":32,"column":8},"end":{"line":34,"column":9}},{"start":{"line":32,"column":8},"end":{"line":34,"column":9}}],"line":32},"6":{"loc":{"start":{"line":35,"column":126},"end":{"line":35,"column":282}},"type":"cond-expr","locations":[{"start":{"line":35,"column":238},"end":{"line":35,"column":244}},{"start":{"line":35,"column":247},"end":{"line":35,"column":282}}],"line":35},"7":{"loc":{"start":{"line":35,"column":126},"end":{"line":35,"column":235}},"type":"binary-expr","locations":[{"start":{"line":35,"column":126},"end":{"line":35,"column":193}},{"start":{"line":35,"column":197},"end":{"line":35,"column":235}}],"line":35},"8":{"loc":{"start":{"line":36,"column":8},"end":{"line":36,"column":185}},"type":"binary-expr","locations":[{"start":{"line":36,"column":8},"end":{"line":36,"column":37}},{"start":{"line":36,"column":41},"end":{"line":36,"column":185}}],"line":36},"9":{"loc":{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},"type":"if","locations":[{"start":{"line":40,"column":8},"end":{"line":42,"column":9}},{"start":{"line":40,"column":8},"end":{"line":42,"column":9}}],"line":40},"10":{"loc":{"start":{"line":40,"column":12},"end":{"line":40,"column":90}},"type":"binary-expr","locations":[{"start":{"line":40,"column":12},"end":{"line":40,"column":28}},{"start":{"line":40,"column":32},"end":{"line":40,"column":45}},{"start":{"line":40,"column":49},"end":{"line":40,"column":66}},{"start":{"line":40,"column":70},"end":{"line":40,"column":90}}],"line":40},"11":{"loc":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"type":"if","locations":[{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},{"start":{"line":44,"column":8},"end":{"line":46,"column":9}}],"line":44},"12":{"loc":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"type":"if","locations":[{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},{"start":{"line":48,"column":8},"end":{"line":50,"column":9}}],"line":48},"13":{"loc":{"start":{"line":51,"column":8},"end":{"line":53,"column":9}},"type":"if","locations":[{"start":{"line":51,"column":8},"end":{"line":53,"column":9}},{"start":{"line":51,"column":8},"end":{"line":53,"column":9}}],"line":51},"14":{"loc":{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},"type":"if","locations":[{"start":{"line":55,"column":8},"end":{"line":57,"column":9}},{"start":{"line":55,"column":8},"end":{"line":57,"column":9}}],"line":55},"15":{"loc":{"start":{"line":59,"column":44},"end":{"line":59,"column":233}},"type":"binary-expr","locations":[{"start":{"line":59,"column":45},"end":{"line":59,"column":226}},{"start":{"line":59,"column":231},"end":{"line":59,"column":233}}],"line":59},"16":{"loc":{"start":{"line":59,"column":45},"end":{"line":59,"column":226}},"type":"cond-expr","locations":[{"start":{"line":59,"column":154},"end":{"line":59,"column":160}},{"start":{"line":59,"column":163},"end":{"line":59,"column":226}}],"line":59},"17":{"loc":{"start":{"line":59,"column":45},"end":{"line":59,"column":151}},"type":"binary-expr","locations":[{"start":{"line":59,"column":45},"end":{"line":59,"column":110}},{"start":{"line":59,"column":114},"end":{"line":59,"column":151}}],"line":59},"18":{"loc":{"start":{"line":61,"column":20},"end":{"line":61,"column":433}},"type":"cond-expr","locations":[{"start":{"line":61,"column":129},"end":{"line":61,"column":135}},{"start":{"line":61,"column":138},"end":{"line":61,"column":433}}],"line":61},"19":{"loc":{"start":{"line":61,"column":20},"end":{"line":61,"column":126}},"type":"binary-expr","locations":[{"start":{"line":61,"column":20},"end":{"line":61,"column":85}},{"start":{"line":61,"column":89},"end":{"line":61,"column":126}}],"line":61},"20":{"loc":{"start":{"line":61,"column":138},"end":{"line":61,"column":433}},"type":"cond-expr","locations":[{"start":{"line":61,"column":357},"end":{"line":61,"column":363}},{"start":{"line":61,"column":366},"end":{"line":61,"column":433}}],"line":61},"21":{"loc":{"start":{"line":61,"column":138},"end":{"line":61,"column":354}},"type":"binary-expr","locations":[{"start":{"line":61,"column":138},"end":{"line":61,"column":277}},{"start":{"line":61,"column":281},"end":{"line":61,"column":354}}],"line":61},"22":{"loc":{"start":{"line":63,"column":8},"end":{"line":65,"column":9}},"type":"if","locations":[{"start":{"line":63,"column":8},"end":{"line":65,"column":9}},{"start":{"line":63,"column":8},"end":{"line":65,"column":9}}],"line":63}},"s":{"0":1,"1":1,"2":20,"3":1,"4":1,"5":1,"6":1,"7":9,"8":4,"9":5,"10":5,"11":1,"12":4,"13":4,"14":1,"15":3,"16":1,"17":2,"18":2,"19":1,"20":1,"21":1,"22":11,"23":4,"24":7,"25":7,"26":1,"27":6,"28":6,"29":1,"30":5,"31":1,"32":4,"33":4,"34":1,"35":3,"36":1,"37":3,"38":2,"39":1,"40":1,"41":1,"42":20,"43":20,"44":20,"45":20,"46":20},"f":{"0":20,"1":9,"2":11,"3":1,"4":20},"b":{"0":[4,5],"1":[9,8,7,6],"2":[1,4],"3":[1,3],"4":[1,2],"5":[1,1],"6":[0,1],"7":[1,1],"8":[1,1],"9":[4,7],"10":[11,10,9,8],"11":[1,6],"12":[1,5],"13":[1,4],"14":[1,3],"15":[3,2],"16":[2,1],"17":[3,3],"18":[0,1],"19":[1,1],"20":[0,1],"21":[1,1],"22":[2,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/sender/MessageServiceSender.ts"],"sourcesContent":["import type { IMessage, IUser } from '@rocket.chat/core-typings';\nimport { isMessageFromMatrixFederation } from '@rocket.chat/core-typings';\n\nimport { Federation } from '../../../../Federation';\nimport { FederatedUser } from '../../../../domain/FederatedUser';\nimport type { IFederationBridge } from '../../../../domain/IFederationBridge';\nimport type { RocketChatMessageAdapter } from '../../../../infrastructure/rocket-chat/adapters/Message';\nimport type { RocketChatRoomAdapter } from '../../../../infrastructure/rocket-chat/adapters/Room';\nimport type { RocketChatSettingsAdapter } from '../../../../infrastructure/rocket-chat/adapters/Settings';\nimport type { RocketChatUserAdapter } from '../../../../infrastructure/rocket-chat/adapters/User';\n\nexport class FederationMessageServiceSender {\n\tconstructor(\n\t\tprotected internalRoomAdapter: RocketChatRoomAdapter,\n\t\tprotected internalUserAdapter: RocketChatUserAdapter,\n\t\tprotected internalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tprotected internalMessageAdapter: RocketChatMessageAdapter,\n\t\tprotected bridge: IFederationBridge,\n\t) {}\n\n\tpublic async sendExternalMessageReaction(internalMessage: IMessage, internalUser: IUser, reaction: string): Promise<void> {\n\t\tif (!internalMessage || !internalUser || !internalUser._id || !internalMessage.rid) {\n\t\t\treturn;\n\t\t}\n\t\tconst federatedSender = await this.internalUserAdapter.getFederatedUserByInternalId(internalUser._id);\n\t\tif (!federatedSender) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalMessage.rid);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!isMessageFromMatrixFederation(internalMessage)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isUserFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(federatedSender.getExternalId()),\n\t\t\tthis.internalSettingsAdapter.getHomeServerDomain(),\n\t\t);\n\t\tif (!isUserFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst eventId = await this.bridge.sendMessageReaction(\n\t\t\tfederatedRoom.getExternalId(),\n\t\t\tfederatedSender.getExternalId(),\n\t\t\tinternalMessage.federation?.eventId as string,\n\t\t\treaction,\n\t\t);\n\t\tfederatedSender.getUsername() &&\n\t\t\t(await this.internalMessageAdapter.setExternalFederationEventOnMessageReaction(\n\t\t\t\tfederatedSender.getUsername() as string,\n\t\t\t\tinternalMessage,\n\t\t\t\treaction,\n\t\t\t\teventId,\n\t\t\t));\n\t}\n\n\tpublic async sendExternalMessageUnReaction(internalMessage: IMessage, internalUser: IUser, reaction: string): Promise<void> {\n\t\tif (!internalMessage || !internalUser || !internalUser._id || !internalMessage.rid) {\n\t\t\treturn;\n\t\t}\n\t\tconst federatedSender = await this.internalUserAdapter.getFederatedUserByInternalId(internalUser._id);\n\t\tif (!federatedSender) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalMessage.rid);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!isMessageFromMatrixFederation(internalMessage)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isUserFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(federatedSender.getExternalId()),\n\t\t\tthis.internalSettingsAdapter.getHomeServerDomain(),\n\t\t);\n\t\tif (!isUserFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\t\t// TODO: leaked business logic, move this to the domain layer\n\t\tconst externalEventId = Object.keys(internalMessage.reactions?.[reaction].federationReactionEventIds || {}).find(\n\t\t\t(key) => internalMessage.reactions?.[reaction].federationReactionEventIds?.[key] === internalUser.username,\n\t\t);\n\t\tif (!externalEventId) {\n\t\t\treturn;\n\t\t}\n\t\tconst normalizedEventId = Federation.unescapeExternalFederationEventId(externalEventId);\n\t\tawait this.bridge.redactEvent(federatedRoom.getExternalId(), federatedSender.getExternalId(), normalizedEventId);\n\t\tawait this.internalMessageAdapter.unsetExternalFederationEventOnMessageReaction(externalEventId, internalMessage, reaction);\n\t}\n}\n"],"names":["FederationMessageServiceSender","sendExternalMessageReaction","internalMessage","internalUser","reaction","_id","rid","federatedSender","internalUserAdapter","getFederatedUserByInternalId","federatedRoom","internalRoomAdapter","getFederatedRoomByInternalId","isMessageFromMatrixFederation","isUserFromTheSameHomeServer","FederatedUser","isOriginalFromTheProxyServer","bridge","extractHomeserverOrigin","getExternalId","internalSettingsAdapter","getHomeServerDomain","eventId","sendMessageReaction","federation","getUsername","internalMessageAdapter","setExternalFederationEventOnMessageReaction","sendExternalMessageUnReaction","externalEventId","Object","keys","reactions","federationReactionEventIds","find","key","username","normalizedEventId","Federation","unescapeExternalFederationEventId","redactEvent","unsetExternalFederationEventOnMessageReaction","constructor"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/sender/MessageServiceSender.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ac1e57041b3261ea18344269d901c0c1ec1c5f4a","contentHash":"ba53b0418144637718d290b5c66d39adeb053856bc5a47d3c6944ac57b4e58f4"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/Federation.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/Federation.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":26}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":46}},"5":{"start":{"line":13,"column":25},"end":{"line":13,"column":71}},"6":{"start":{"line":14,"column":34},"end":{"line":14,"column":110}},"7":{"start":{"line":15,"column":39},"end":{"line":22,"column":1}},"8":{"start":{"line":23,"column":36},"end":{"line":23,"column":143}},"9":{"start":{"line":23,"column":84},"end":{"line":23,"column":142}},"10":{"start":{"line":24,"column":51},"end":{"line":27,"column":1}},"11":{"start":{"line":28,"column":17},"end":{"line":73,"column":1}},"12":{"start":{"line":31,"column":8},"end":{"line":33,"column":9}},"13":{"start":{"line":32,"column":12},"end":{"line":32,"column":25}},"14":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"15":{"start":{"line":35,"column":12},"end":{"line":35,"column":25}},"16":{"start":{"line":37,"column":8},"end":{"line":39,"column":9}},"17":{"start":{"line":38,"column":12},"end":{"line":38,"column":24}},"18":{"start":{"line":40,"column":33},"end":{"line":40,"column":103}},"19":{"start":{"line":41,"column":8},"end":{"line":43,"column":9}},"20":{"start":{"line":42,"column":12},"end":{"line":42,"column":24}},"21":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"22":{"start":{"line":45,"column":12},"end":{"line":45,"column":24}},"23":{"start":{"line":47,"column":8},"end":{"line":49,"column":9}},"24":{"start":{"line":48,"column":12},"end":{"line":48,"column":67}},"25":{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},"26":{"start":{"line":51,"column":12},"end":{"line":51,"column":64}},"27":{"start":{"line":53,"column":8},"end":{"line":53,"column":21}},"28":{"start":{"line":56,"column":8},"end":{"line":56,"column":64}},"29":{"start":{"line":59,"column":8},"end":{"line":59,"column":95}},"30":{"start":{"line":62,"column":8},"end":{"line":62,"column":97}},"31":{"start":{"line":65,"column":8},"end":{"line":67,"column":9}},"32":{"start":{"line":66,"column":12},"end":{"line":66,"column":25}},"33":{"start":{"line":68,"column":8},"end":{"line":70,"column":9}},"34":{"start":{"line":69,"column":12},"end":{"line":69,"column":25}},"35":{"start":{"line":71,"column":8},"end":{"line":71,"column":76}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":23,"column":74},"end":{"line":23,"column":75}},"loc":{"start":{"line":23,"column":84},"end":{"line":23,"column":142}},"line":23},"2":{"name":"(anonymous_2)","decl":{"start":{"line":29,"column":4},"end":{"line":29,"column":5}},"loc":{"start":{"line":29,"column":53},"end":{"line":54,"column":5}},"line":29},"3":{"name":"(anonymous_3)","decl":{"start":{"line":55,"column":4},"end":{"line":55,"column":5}},"loc":{"start":{"line":55,"column":42},"end":{"line":57,"column":5}},"line":55},"4":{"name":"(anonymous_4)","decl":{"start":{"line":58,"column":4},"end":{"line":58,"column":5}},"loc":{"start":{"line":58,"column":60},"end":{"line":60,"column":5}},"line":58},"5":{"name":"(anonymous_5)","decl":{"start":{"line":61,"column":4},"end":{"line":61,"column":5}},"loc":{"start":{"line":61,"column":62},"end":{"line":63,"column":5}},"line":61},"6":{"name":"(anonymous_6)","decl":{"start":{"line":64,"column":4},"end":{"line":64,"column":5}},"loc":{"start":{"line":64,"column":47},"end":{"line":72,"column":5}},"line":64}},"branchMap":{"0":{"loc":{"start":{"line":31,"column":8},"end":{"line":33,"column":9}},"type":"if","locations":[{"start":{"line":31,"column":8},"end":{"line":33,"column":9}},{"start":{"line":31,"column":8},"end":{"line":33,"column":9}}],"line":31},"1":{"loc":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"type":"if","locations":[{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},{"start":{"line":34,"column":8},"end":{"line":36,"column":9}}],"line":34},"2":{"loc":{"start":{"line":37,"column":8},"end":{"line":39,"column":9}},"type":"if","locations":[{"start":{"line":37,"column":8},"end":{"line":39,"column":9}},{"start":{"line":37,"column":8},"end":{"line":39,"column":9}}],"line":37},"3":{"loc":{"start":{"line":41,"column":8},"end":{"line":43,"column":9}},"type":"if","locations":[{"start":{"line":41,"column":8},"end":{"line":43,"column":9}},{"start":{"line":41,"column":8},"end":{"line":43,"column":9}}],"line":41},"4":{"loc":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"type":"if","locations":[{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},{"start":{"line":44,"column":8},"end":{"line":46,"column":9}}],"line":44},"5":{"loc":{"start":{"line":47,"column":8},"end":{"line":49,"column":9}},"type":"if","locations":[{"start":{"line":47,"column":8},"end":{"line":49,"column":9}},{"start":{"line":47,"column":8},"end":{"line":49,"column":9}}],"line":47},"6":{"loc":{"start":{"line":47,"column":12},"end":{"line":47,"column":162}},"type":"cond-expr","locations":[{"start":{"line":47,"column":112},"end":{"line":47,"column":118}},{"start":{"line":47,"column":121},"end":{"line":47,"column":162}}],"line":47},"7":{"loc":{"start":{"line":47,"column":12},"end":{"line":47,"column":109}},"type":"binary-expr","locations":[{"start":{"line":47,"column":12},"end":{"line":47,"column":71}},{"start":{"line":47,"column":75},"end":{"line":47,"column":109}}],"line":47},"8":{"loc":{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},"type":"if","locations":[{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},{"start":{"line":50,"column":8},"end":{"line":52,"column":9}}],"line":50},"9":{"loc":{"start":{"line":50,"column":12},"end":{"line":50,"column":169}},"type":"cond-expr","locations":[{"start":{"line":50,"column":114},"end":{"line":50,"column":120}},{"start":{"line":50,"column":123},"end":{"line":50,"column":169}}],"line":50},"10":{"loc":{"start":{"line":50,"column":12},"end":{"line":50,"column":111}},"type":"binary-expr","locations":[{"start":{"line":50,"column":12},"end":{"line":50,"column":72}},{"start":{"line":50,"column":76},"end":{"line":50,"column":111}}],"line":50},"11":{"loc":{"start":{"line":56,"column":15},"end":{"line":56,"column":63}},"type":"binary-expr","locations":[{"start":{"line":56,"column":15},"end":{"line":56,"column":37}},{"start":{"line":56,"column":41},"end":{"line":56,"column":63}}],"line":56},"12":{"loc":{"start":{"line":65,"column":8},"end":{"line":67,"column":9}},"type":"if","locations":[{"start":{"line":65,"column":8},"end":{"line":67,"column":9}},{"start":{"line":65,"column":8},"end":{"line":67,"column":9}}],"line":65},"13":{"loc":{"start":{"line":68,"column":8},"end":{"line":70,"column":9}},"type":"if","locations":[{"start":{"line":68,"column":8},"end":{"line":70,"column":9}},{"start":{"line":68,"column":8},"end":{"line":70,"column":9}}],"line":68}},"s":{"0":3,"1":3,"2":4,"3":3,"4":3,"5":3,"6":3,"7":3,"8":3,"9":18,"10":3,"11":3,"12":27,"13":1,"14":26,"15":1,"16":25,"17":1,"18":24,"19":24,"20":1,"21":23,"22":3,"23":20,"24":5,"25":15,"26":5,"27":10,"28":2,"29":3,"30":2,"31":14,"32":1,"33":13,"34":1,"35":12},"f":{"0":4,"1":18,"2":27,"3":2,"4":3,"5":2,"6":14},"b":{"0":[1,26],"1":[1,25],"2":[1,24],"3":[1,23],"4":[3,20],"5":[5,15],"6":[10,10],"7":[20,20],"8":[5,10],"9":[10,5],"10":[15,15],"11":[2,1],"12":[1,13],"13":[1,12]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/Federation.ts"],"sourcesContent":["import type { IRoom, IUser, ValueOf } from '@rocket.chat/core-typings';\nimport { isRoomFederated, isDirectMessageRoom } from '@rocket.chat/core-typings';\nimport { Subscriptions } from '@rocket.chat/models';\n\nimport { RoomMemberActions, RoomSettingsEnum } from '../../../definition/IRoomTypeConfig';\nimport {\n\tescapeExternalFederationEventId,\n\tunescapeExternalFederationEventId,\n} from './infrastructure/rocket-chat/adapters/federation-id-escape-helper';\n\nconst allowedActionsInFederatedRooms: ValueOf<typeof RoomMemberActions>[] = [\n\tRoomMemberActions.REMOVE_USER,\n\tRoomMemberActions.SET_AS_OWNER,\n\tRoomMemberActions.SET_AS_MODERATOR,\n\tRoomMemberActions.INVITE,\n\tRoomMemberActions.JOIN,\n\tRoomMemberActions.LEAVE,\n];\n\nconst allowedActionsForModerators: ValueOf<typeof RoomMemberActions>[] = allowedActionsInFederatedRooms.filter(\n\t(action) => action !== RoomMemberActions.SET_AS_OWNER,\n);\n\nconst allowedRoomSettingsChangesInFederatedRooms: ValueOf<typeof RoomSettingsEnum>[] = [RoomSettingsEnum.NAME, RoomSettingsEnum.TOPIC];\n\nexport class Federation {\n\tpublic static async actionAllowed(room: IRoom, action: ValueOf<typeof RoomMemberActions>, userId?: IUser['_id']): Promise<boolean> {\n\t\tif (!isRoomFederated(room)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (isDirectMessageRoom(room)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!userId) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst userSubscription = await Subscriptions.findOneByRoomIdAndUserId(room._id, userId);\n\t\tif (!userSubscription) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (action === RoomMemberActions.LEAVE) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (userSubscription.roles?.includes('owner')) {\n\t\t\treturn allowedActionsInFederatedRooms.includes(action);\n\t\t}\n\n\t\tif (userSubscription.roles?.includes('moderator')) {\n\t\t\treturn allowedActionsForModerators.includes(action);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tpublic static isAFederatedUsername(username: string): boolean {\n\t\treturn username.includes('@') && username.includes(':');\n\t}\n\n\tpublic static escapeExternalFederationEventId(externalEventId: string): string {\n\t\treturn escapeExternalFederationEventId(externalEventId);\n\t}\n\n\tpublic static unescapeExternalFederationEventId(externalEventId: string): string {\n\t\treturn unescapeExternalFederationEventId(externalEventId);\n\t}\n\n\tpublic static isRoomSettingAllowed(room: Partial<IRoom>, setting: ValueOf<typeof RoomSettingsEnum>): boolean {\n\t\tif (!isRoomFederated(room)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (isDirectMessageRoom(room)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn allowedRoomSettingsChangesInFederatedRooms.includes(setting);\n\t}\n}\n"],"names":["Federation","allowedActionsInFederatedRooms","RoomMemberActions","REMOVE_USER","SET_AS_OWNER","SET_AS_MODERATOR","INVITE","JOIN","LEAVE","allowedActionsForModerators","filter","action","allowedRoomSettingsChangesInFederatedRooms","RoomSettingsEnum","NAME","TOPIC","actionAllowed","room","userId","userSubscription","isRoomFederated","isDirectMessageRoom","Subscriptions","findOneByRoomIdAndUserId","_id","roles","includes","isAFederatedUsername","username","escapeExternalFederationEventId","externalEventId","unescapeExternalFederationEventId","isRoomSettingAllowed","setting"],"mappings":";;;;+BAyBaA;;;eAAAA;;;6BAxBwC;wBACvB;iCAEsB;0CAI7C;AAEP,MAAMC,iCAAsE;IAC3EC,kCAAiB,CAACC,WAAW;IAC7BD,kCAAiB,CAACE,YAAY;IAC9BF,kCAAiB,CAACG,gBAAgB;IAClCH,kCAAiB,CAACI,MAAM;IACxBJ,kCAAiB,CAACK,IAAI;IACtBL,kCAAiB,CAACM,KAAK;CACvB;AAED,MAAMC,8BAAmER,+BAA+BS,MAAM,CAC7G,CAACC,SAAWA,WAAWT,kCAAiB,CAACE,YAAY;AAGtD,MAAMQ,6CAAiF;IAACC,iCAAgB,CAACC,IAAI;IAAED,iCAAgB,CAACE,KAAK;CAAC;AAE/H,IAAA,AAAMf,aAAN,MAAMA;IACZ,aAAoBgB,cAAcC,IAAW,EAAEN,MAAyC,EAAEO,MAAqB,EAAoB;YAoB9HC,yBAIAA;QAvBJ,IAAI,CAACC,IAAAA,4BAAe,EAACH,OAAO;YAC3B,OAAO;QACR;QACA,IAAII,IAAAA,gCAAmB,EAACJ,OAAO;YAC9B,OAAO;QACR;QACA,IAAI,CAACC,QAAQ;YACZ,OAAO;QACR;QAEA,MAAMC,mBAAmB,MAAMG,qBAAa,CAACC,wBAAwB,CAACN,KAAKO,GAAG,EAAEN;QAChF,IAAI,CAACC,kBAAkB;YACtB,OAAO;QACR;QAEA,IAAIR,WAAWT,kCAAiB,CAACM,KAAK,EAAE;YACvC,OAAO;QACR;QAEA,KAAIW,0BAAAA,iBAAiBM,KAAK,cAAtBN,8CAAAA,wBAAwBO,QAAQ,CAAC,UAAU;YAC9C,OAAOzB,+BAA+ByB,QAAQ,CAACf;QAChD;QAEA,KAAIQ,2BAAAA,iBAAiBM,KAAK,cAAtBN,+CAAAA,yBAAwBO,QAAQ,CAAC,cAAc;YAClD,OAAOjB,4BAA4BiB,QAAQ,CAACf;QAC7C;QAEA,OAAO;IACR;IAEA,OAAcgB,qBAAqBC,QAAgB,EAAW;QAC7D,OAAOA,SAASF,QAAQ,CAAC,QAAQE,SAASF,QAAQ,CAAC;IACpD;IAEA,OAAcG,gCAAgCC,eAAuB,EAAU;QAC9E,OAAOD,IAAAA,yDAA+B,EAACC;IACxC;IAEA,OAAcC,kCAAkCD,eAAuB,EAAU;QAChF,OAAOC,IAAAA,2DAAiC,EAACD;IAC1C;IAEA,OAAcE,qBAAqBf,IAAoB,EAAEgB,OAAyC,EAAW;QAC5G,IAAI,CAACb,IAAAA,4BAAe,EAACH,OAAO;YAC3B,OAAO;QACR;QAEA,IAAII,IAAAA,gCAAmB,EAACJ,OAAO;YAC9B,OAAO;QACR;QACA,OAAOL,2CAA2Cc,QAAQ,CAACO;IAC5D;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/Federation.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7a609ae52aa9dfbdb99995ef29213e2bbc75e6a1","contentHash":"5b1749f780eec22a8f3def9b48298ad1264a8249ade0f655fe599a38bd7a9fea"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/definition/IRoomTypeConfig.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/definition/IRoomTypeConfig.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":21,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":33}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":32}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":29}},"7":{"start":{"line":22,"column":25},"end":{"line":35,"column":1}},"8":{"start":{"line":36,"column":26},"end":{"line":48,"column":1}},"9":{"start":{"line":49,"column":22},"end":{"line":52,"column":1}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":23},"end":{"line":12,"column":24}},"loc":{"start":{"line":12,"column":34},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":22},"end":{"line":15,"column":23}},"loc":{"start":{"line":15,"column":33},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":19},"end":{"line":18,"column":20}},"loc":{"start":{"line":18,"column":30},"end":{"line":20,"column":5}},"line":18}},"branchMap":{},"s":{"0":2,"1":2,"2":6,"3":2,"4":84,"5":11,"6":0,"7":2,"8":2,"9":2},"f":{"0":2,"1":84,"2":11,"3":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/definition/IRoomTypeConfig.ts"],"sourcesContent":["import type {\n\tIRoom,\n\tRoomType,\n\tIUser,\n\tIMessage,\n\tReadReceipt,\n\tValueOf,\n\tAtLeast,\n\tISubscription,\n\tIOmnichannelRoom,\n} from '@rocket.chat/core-typings';\nimport type { Keys as IconName } from '@rocket.chat/icons';\nimport type { IRouterPaths, RouteName } from '@rocket.chat/ui-contexts';\n\nexport type RoomIdentification = { rid?: IRoom['_id']; name?: string; tab?: string };\n\nexport interface IRoomTypeRouteConfig<TRouteName extends RouteName> {\n\tname: TRouteName;\n\tpath?: IRouterPaths[TRouteName]['pattern'];\n\tlink?: (data: RoomIdentification) => Record<string, string>;\n}\n\nexport const RoomSettingsEnum = {\n\tTYPE: 'type',\n\tNAME: 'roomName',\n\tTOPIC: 'roomTopic',\n\tANNOUNCEMENT: 'roomAnnouncement',\n\tDESCRIPTION: 'roomDescription',\n\tREAD_ONLY: 'readOnly',\n\tREACT_WHEN_READ_ONLY: 'reactWhenReadOnly',\n\tARCHIVE_OR_UNARCHIVE: 'archiveOrUnarchive',\n\tJOIN_CODE: 'joinCode',\n\tBROADCAST: 'broadcast',\n\tSYSTEM_MESSAGES: 'systemMessages',\n\tE2E: 'encrypted',\n} as const;\n\nexport const RoomMemberActions = {\n\tARCHIVE: 'archive',\n\tIGNORE: 'ignore',\n\tBLOCK: 'block',\n\tMUTE: 'mute',\n\tSET_AS_OWNER: 'setAsOwner',\n\tSET_AS_LEADER: 'setAsLeader',\n\tSET_AS_MODERATOR: 'setAsModerator',\n\tLEAVE: 'leave',\n\tREMOVE_USER: 'removeUser',\n\tJOIN: 'join',\n\tINVITE: 'invite',\n} as const;\n\nexport const UiTextContext = {\n\tHIDE_WARNING: 'hideWarning',\n\tLEAVE_WARNING: 'leaveWarning',\n} as const;\n\nexport interface IRoomTypeConfig {\n\tidentifier: string;\n\troute?: IRoomTypeRouteConfig<RouteName>;\n}\n\nexport interface IRoomTypeClientConfig extends IRoomTypeConfig {\n\tlabel?: string;\n}\n\nexport interface IRoomTypeClientDirectives {\n\tconfig: IRoomTypeClientConfig;\n\n\tallowRoomSettingChange: (room: Partial<IRoom>, setting: ValueOf<typeof RoomSettingsEnum>) => boolean;\n\tallowMemberAction: (\n\t\troom: Partial<IRoom>,\n\t\taction: ValueOf<typeof RoomMemberActions>,\n\t\tuserId: IUser['_id'],\n\t\tuserSubscription?: ISubscription,\n\t) => boolean;\n\troomName: (room: AtLeast<IRoom, '_id' | 'name' | 'fname' | 'prid'>) => string | undefined;\n\tisGroupChat: (room: Partial<IRoom>) => boolean;\n\tgetUiText: (context: ValueOf<typeof UiTextContext>) => string;\n\tcondition: () => boolean;\n\tgetAvatarPath: (\n\t\troom: AtLeast<IRoom, '_id' | 'name' | 'fname' | 'prid' | 'avatarETag' | 'uids' | 'usernames'> & { username?: IRoom['_id'] },\n\t) => string;\n\tgetIcon?: (room: Partial<IRoom>) => IconName;\n\textractOpenRoomParams?: (routeParams: Record<string, string | null | undefined>) => { type: RoomType; reference: string };\n\tfindRoom: (identifier: string) => IRoom | undefined;\n\tshowJoinLink: (roomId: string) => boolean;\n\tisLivechatRoom: () => boolean;\n\tcanSendMessage: (rid: string) => boolean;\n\treadOnly?: (rid: string, user: AtLeast<IUser, 'username'>) => boolean;\n}\n\nexport interface IRoomTypeServerDirectives {\n\tconfig: IRoomTypeConfig;\n\n\tallowRoomSettingChange: (room: IRoom, setting: ValueOf<typeof RoomSettingsEnum>) => boolean;\n\tallowMemberAction: (room: IRoom, action: ValueOf<typeof RoomMemberActions>, userId?: IUser['_id']) => Promise<boolean>;\n\troomName: (room: IRoom, userId?: string) => Promise<string | undefined>;\n\tisGroupChat: (room: IRoom) => boolean;\n\tcanBeDeleted: (hasPermission: (permissionId: string, rid?: string) => Promise<boolean> | boolean, room: IRoom) => Promise<boolean>;\n\tpreventRenaming: () => boolean;\n\tgetDiscussionType: (room?: AtLeast<IRoom, 'teamId'>) => Promise<RoomType>;\n\tcanAccessUploadedFile: (params: { rc_uid: string; rc_rid: string; rc_token: string }) => Promise<boolean>;\n\tgetNotificationDetails: (\n\t\troom: IRoom,\n\t\tsender: AtLeast<IUser, '_id' | 'name' | 'username'>,\n\t\tnotificationMessage: string,\n\t\tuserId: string,\n\t) => Promise<{ title: string | undefined; text: string; name: string | undefined }>;\n\tgetMsgSender: (message: IMessage) => Promise<IUser | null>;\n\tincludeInRoomSearch: () => boolean;\n\tgetReadReceiptsExtraData: (message: IMessage) => Partial<ReadReceipt>;\n\tincludeInDashboard: () => boolean;\n\troomFind?: (rid: string) => Promise<IRoom | undefined> | Promise<IOmnichannelRoom | null> | IRoom | undefined;\n}\n"],"names":["RoomMemberActions","RoomSettingsEnum","UiTextContext","TYPE","NAME","TOPIC","ANNOUNCEMENT","DESCRIPTION","READ_ONLY","REACT_WHEN_READ_ONLY","ARCHIVE_OR_UNARCHIVE","JOIN_CODE","BROADCAST","SYSTEM_MESSAGES","E2E","ARCHIVE","IGNORE","BLOCK","MUTE","SET_AS_OWNER","SET_AS_LEADER","SET_AS_MODERATOR","LEAVE","REMOVE_USER","JOIN","INVITE","HIDE_WARNING","LEAVE_WARNING"],"mappings":";;;;;;;;;;;IAqCaA,iBAAiB;eAAjBA;;IAfAC,gBAAgB;eAAhBA;;IA6BAC,aAAa;eAAbA;;;AA7BN,MAAMD,mBAAmB;IAC/BE,MAAM;IACNC,MAAM;IACNC,OAAO;IACPC,cAAc;IACdC,aAAa;IACbC,WAAW;IACXC,sBAAsB;IACtBC,sBAAsB;IACtBC,WAAW;IACXC,WAAW;IACXC,iBAAiB;IACjBC,KAAK;AACN;AAEO,MAAMd,oBAAoB;IAChCe,SAAS;IACTC,QAAQ;IACRC,OAAO;IACPC,MAAM;IACNC,cAAc;IACdC,eAAe;IACfC,kBAAkB;IAClBC,OAAO;IACPC,aAAa;IACbC,MAAM;IACNC,QAAQ;AACT;AAEO,MAAMvB,gBAAgB;IAC5BwB,cAAc;IACdC,eAAe;AAChB","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/definition/IRoomTypeConfig.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"970aaa29273de5509814c59428cef9e7b93899ba","contentHash":"1a7d4c35be932b39528645664d293b6620dec8e302beb7e3bbb75ed91d794b88"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/adapters/federation-id-escape-helper.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/adapters/federation-id-escape-helper.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":47}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":49}},"6":{"start":{"line":19,"column":40},"end":{"line":21,"column":1}},"7":{"start":{"line":20,"column":4},"end":{"line":20,"column":54}},"8":{"start":{"line":22,"column":42},"end":{"line":24,"column":1}},"9":{"start":{"line":23,"column":4},"end":{"line":23,"column":53}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":37},"end":{"line":12,"column":38}},"loc":{"start":{"line":12,"column":48},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":39},"end":{"line":15,"column":40}},"loc":{"start":{"line":15,"column":50},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":19,"column":40},"end":{"line":19,"column":41}},"loc":{"start":{"line":19,"column":59},"end":{"line":21,"column":1}},"line":19},"4":{"name":"(anonymous_4)","decl":{"start":{"line":22,"column":42},"end":{"line":22,"column":43}},"loc":{"start":{"line":22,"column":61},"end":{"line":24,"column":1}},"line":22}},"branchMap":{},"s":{"0":2,"1":2,"2":4,"3":2,"4":3,"5":2,"6":2,"7":3,"8":2,"9":2},"f":{"0":2,"1":3,"2":2,"3":3,"4":2},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/adapters/federation-id-escape-helper.ts"],"sourcesContent":["export const escapeExternalFederationEventId = (externalEventId: string): string => {\n\treturn externalEventId.replace(/\\$/g, '__sign__');\n};\n\nexport const unescapeExternalFederationEventId = (externalEventId: string): string => {\n\treturn externalEventId.replace(/__sign__/g, '$');\n};\n"],"names":["escapeExternalFederationEventId","unescapeExternalFederationEventId","externalEventId","replace"],"mappings":";;;;;;;;;;;IAAaA,+BAA+B;eAA/BA;;IAIAC,iCAAiC;eAAjCA;;;AAJN,MAAMD,kCAAkC,CAACE;IAC/C,OAAOA,gBAAgBC,OAAO,CAAC,OAAO;AACvC;AAEO,MAAMF,oCAAoC,CAACC;IACjD,OAAOA,gBAAgBC,OAAO,CAAC,aAAa;AAC7C","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/adapters/federation-id-escape-helper.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"aa95bc56351c84a60022ad0c39a6c14ca31560b1","contentHash":"4c86159246a848333095ee727ac0848d0e010464deb4ce81d8a081f616e0a243"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/receiver/RoomServiceReceiver.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/receiver/RoomServiceReceiver.ts","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}},"1":{"start":{"line":6,"column":0},"end":{"line":11,"column":3}},"2":{"start":{"line":9,"column":8},"end":{"line":9,"column":45}},"3":{"start":{"line":12,"column":15},"end":{"line":12,"column":67}},"4":{"start":{"line":13,"column":21},"end":{"line":13,"column":57}},"5":{"start":{"line":14,"column":23},"end":{"line":14,"column":63}},"6":{"start":{"line":15,"column":23},"end":{"line":15,"column":63}},"7":{"start":{"line":16,"column":27},"end":{"line":16,"column":71}},"8":{"start":{"line":17,"column":22},"end":{"line":17,"column":92}},"9":{"start":{"line":18,"column":46},"end":{"line":18,"column":99}},"10":{"start":{"line":19,"column":32},"end":{"line":19,"column":87}},"11":{"start":{"line":20,"column":36},"end":{"line":492,"column":1}},"12":{"start":{"line":22,"column":101},"end":{"line":22,"column":116}},"13":{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},"14":{"start":{"line":24,"column":12},"end":{"line":24,"column":19}},"15":{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},"16":{"start":{"line":27,"column":12},"end":{"line":27,"column":19}},"17":{"start":{"line":29,"column":21},"end":{"line":29,"column":87}},"18":{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},"19":{"start":{"line":31,"column":12},"end":{"line":31,"column":19}},"20":{"start":{"line":33,"column":8},"end":{"line":33,"column":107}},"21":{"start":{"line":36,"column":283},"end":{"line":36,"column":308}},"22":{"start":{"line":37,"column":45},"end":{"line":37,"column":98}},"23":{"start":{"line":38,"column":38},"end":{"line":38,"column":113}},"24":{"start":{"line":39,"column":39},"end":{"line":39,"column":88}},"25":{"start":{"line":40,"column":8},"end":{"line":43,"column":9}},"26":{"start":{"line":41,"column":34},"end":{"line":41,"column":112}},"27":{"start":{"line":42,"column":12},"end":{"line":42,"column":163}},"28":{"start":{"line":44,"column":8},"end":{"line":47,"column":9}},"29":{"start":{"line":45,"column":34},"end":{"line":45,"column":112}},"30":{"start":{"line":46,"column":12},"end":{"line":46,"column":170}},"31":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"32":{"start":{"line":49,"column":12},"end":{"line":49,"column":19}},"33":{"start":{"line":51,"column":47},"end":{"line":51,"column":191}},"34":{"start":{"line":52,"column":47},"end":{"line":52,"column":191}},"35":{"start":{"line":53,"column":32},"end":{"line":53,"column":106}},"36":{"start":{"line":54,"column":32},"end":{"line":54,"column":106}},"37":{"start":{"line":55,"column":28},"end":{"line":55,"column":106}},"38":{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},"39":{"start":{"line":57,"column":12},"end":{"line":57,"column":125}},"40":{"start":{"line":59,"column":28},"end":{"line":59,"column":106}},"41":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"42":{"start":{"line":61,"column":12},"end":{"line":61,"column":125}},"43":{"start":{"line":63,"column":37},"end":{"line":63,"column":130}},"44":{"start":{"line":64,"column":37},"end":{"line":64,"column":130}},"45":{"start":{"line":65,"column":8},"end":{"line":67,"column":9}},"46":{"start":{"line":66,"column":12},"end":{"line":66,"column":65}},"47":{"start":{"line":68,"column":8},"end":{"line":71,"column":9}},"48":{"start":{"line":69,"column":12},"end":{"line":69,"column":128}},"49":{"start":{"line":70,"column":12},"end":{"line":70,"column":19}},"50":{"start":{"line":72,"column":8},"end":{"line":103,"column":9}},"51":{"start":{"line":73,"column":12},"end":{"line":75,"column":13}},"52":{"start":{"line":74,"column":16},"end":{"line":74,"column":23}},"53":{"start":{"line":76,"column":12},"end":{"line":84,"column":13}},"54":{"start":{"line":79,"column":71},"end":{"line":79,"column":142}},"55":{"start":{"line":80,"column":16},"end":{"line":82,"column":17}},"56":{"start":{"line":81,"column":20},"end":{"line":81,"column":168}},"57":{"start":{"line":83,"column":16},"end":{"line":83,"column":138}},"58":{"start":{"line":85,"column":37},"end":{"line":85,"column":146}},"59":{"start":{"line":86,"column":42},"end":{"line":86,"column":110}},"60":{"start":{"line":87,"column":12},"end":{"line":87,"column":74}},"61":{"start":{"line":88,"column":12},"end":{"line":96,"column":13}},"62":{"start":{"line":89,"column":16},"end":{"line":95,"column":19}},"63":{"start":{"line":97,"column":12},"end":{"line":97,"column":218}},"64":{"start":{"line":98,"column":45},"end":{"line":101,"column":14}},"65":{"start":{"line":102,"column":12},"end":{"line":102,"column":102}},"66":{"start":{"line":102,"column":54},"end":{"line":102,"column":100}},"67":{"start":{"line":104,"column":30},"end":{"line":104,"column":130}},"68":{"start":{"line":105,"column":8},"end":{"line":107,"column":9}},"69":{"start":{"line":106,"column":12},"end":{"line":106,"column":19}},"70":{"start":{"line":108,"column":52},"end":{"line":108,"column":171}},"71":{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},"72":{"start":{"line":110,"column":12},"end":{"line":110,"column":19}},"73":{"start":{"line":112,"column":8},"end":{"line":118,"column":9}},"74":{"start":{"line":113,"column":12},"end":{"line":115,"column":13}},"75":{"start":{"line":114,"column":16},"end":{"line":114,"column":23}},"76":{"start":{"line":116,"column":12},"end":{"line":116,"column":121}},"77":{"start":{"line":117,"column":12},"end":{"line":117,"column":19}},"78":{"start":{"line":119,"column":8},"end":{"line":130,"column":9}},"79":{"start":{"line":120,"column":38},"end":{"line":120,"column":51}},"80":{"start":{"line":121,"column":12},"end":{"line":123,"column":13}},"81":{"start":{"line":122,"column":16},"end":{"line":122,"column":23}},"82":{"start":{"line":124,"column":12},"end":{"line":124,"column":62}},"83":{"start":{"line":125,"column":37},"end":{"line":125,"column":163}},"84":{"start":{"line":126,"column":12},"end":{"line":126,"column":82}},"85":{"start":{"line":127,"column":42},"end":{"line":127,"column":126}},"86":{"start":{"line":128,"column":12},"end":{"line":128,"column":218}},"87":{"start":{"line":129,"column":12},"end":{"line":129,"column":19}},"88":{"start":{"line":131,"column":8},"end":{"line":131,"column":112}},"89":{"start":{"line":132,"column":8},"end":{"line":134,"column":9}},"90":{"start":{"line":133,"column":12},"end":{"line":133,"column":74}},"91":{"start":{"line":137,"column":21},"end":{"line":137,"column":96}},"92":{"start":{"line":138,"column":8},"end":{"line":146,"column":9}},"93":{"start":{"line":139,"column":12},"end":{"line":139,"column":217}},"94":{"start":{"line":140,"column":56},"end":{"line":140,"column":166}},"95":{"start":{"line":141,"column":12},"end":{"line":143,"column":13}},"96":{"start":{"line":142,"column":16},"end":{"line":142,"column":23}},"97":{"start":{"line":144,"column":12},"end":{"line":144,"column":85}},"98":{"start":{"line":145,"column":12},"end":{"line":145,"column":19}},"99":{"start":{"line":147,"column":33},"end":{"line":147,"column":116}},"100":{"start":{"line":148,"column":8},"end":{"line":150,"column":9}},"101":{"start":{"line":149,"column":12},"end":{"line":149,"column":19}},"102":{"start":{"line":151,"column":28},"end":{"line":151,"column":116}},"103":{"start":{"line":152,"column":59},"end":{"line":152,"column":151}},"104":{"start":{"line":153,"column":8},"end":{"line":155,"column":9}},"105":{"start":{"line":154,"column":12},"end":{"line":154,"column":19}},"106":{"start":{"line":156,"column":8},"end":{"line":158,"column":9}},"107":{"start":{"line":157,"column":12},"end":{"line":157,"column":118}},"108":{"start":{"line":159,"column":37},"end":{"line":159,"column":125}},"109":{"start":{"line":160,"column":8},"end":{"line":162,"column":9}},"110":{"start":{"line":161,"column":12},"end":{"line":161,"column":19}},"111":{"start":{"line":163,"column":44},"end":{"line":163,"column":185}},"112":{"start":{"line":164,"column":33},"end":{"line":164,"column":222}},"113":{"start":{"line":165,"column":38},"end":{"line":165,"column":106}},"114":{"start":{"line":166,"column":8},"end":{"line":174,"column":9}},"115":{"start":{"line":167,"column":12},"end":{"line":173,"column":15}},"116":{"start":{"line":175,"column":30},"end":{"line":175,"column":105}},"117":{"start":{"line":176,"column":8},"end":{"line":178,"column":9}},"118":{"start":{"line":177,"column":12},"end":{"line":177,"column":19}},"119":{"start":{"line":180,"column":8},"end":{"line":180,"column":167}},"120":{"start":{"line":181,"column":8},"end":{"line":181,"column":214}},"121":{"start":{"line":182,"column":8},"end":{"line":182,"column":90}},"122":{"start":{"line":185,"column":21},"end":{"line":185,"column":96}},"123":{"start":{"line":186,"column":8},"end":{"line":188,"column":9}},"124":{"start":{"line":187,"column":12},"end":{"line":187,"column":24}},"125":{"start":{"line":189,"column":44},"end":{"line":189,"column":185}},"126":{"start":{"line":190,"column":40},"end":{"line":190,"column":67}},"127":{"start":{"line":191,"column":30},"end":{"line":191,"column":134}},"128":{"start":{"line":192,"column":25},"end":{"line":192,"column":155}},"129":{"start":{"line":193,"column":8},"end":{"line":193,"column":104}},"130":{"start":{"line":194,"column":8},"end":{"line":194,"column":91}},"131":{"start":{"line":197,"column":65},"end":{"line":197,"column":199}},"132":{"start":{"line":197,"column":119},"end":{"line":197,"column":198}},"133":{"start":{"line":198,"column":31},"end":{"line":198,"column":177}},"134":{"start":{"line":198,"column":122},"end":{"line":198,"column":175}},"135":{"start":{"line":199,"column":8},"end":{"line":199,"column":127}},"136":{"start":{"line":202,"column":28},"end":{"line":210,"column":11}},"137":{"start":{"line":203,"column":28},"end":{"line":203,"column":126}},"138":{"start":{"line":204,"column":12},"end":{"line":208,"column":13}},"139":{"start":{"line":205,"column":57},"end":{"line":205,"column":221}},"140":{"start":{"line":206,"column":42},"end":{"line":206,"column":158}},"141":{"start":{"line":207,"column":16},"end":{"line":207,"column":153}},"142":{"start":{"line":209,"column":12},"end":{"line":209,"column":129}},"143":{"start":{"line":211,"column":33},"end":{"line":214,"column":10}},"144":{"start":{"line":215,"column":38},"end":{"line":215,"column":122}},"145":{"start":{"line":216,"column":8},"end":{"line":216,"column":214}},"146":{"start":{"line":217,"column":8},"end":{"line":217,"column":287}},"147":{"start":{"line":217,"column":56},"end":{"line":217,"column":206}},"148":{"start":{"line":217,"column":223},"end":{"line":217,"column":284}},"149":{"start":{"line":220,"column":24},"end":{"line":223,"column":9}},"150":{"start":{"line":224,"column":33},"end":{"line":224,"column":136}},"151":{"start":{"line":225,"column":38},"end":{"line":225,"column":122}},"152":{"start":{"line":226,"column":47},"end":{"line":226,"column":210}},"153":{"start":{"line":227,"column":8},"end":{"line":227,"column":214}},"154":{"start":{"line":228,"column":8},"end":{"line":230,"column":9}},"155":{"start":{"line":229,"column":12},"end":{"line":229,"column":93}},"156":{"start":{"line":233,"column":121},"end":{"line":233,"column":152}},"157":{"start":{"line":234,"column":30},"end":{"line":234,"column":105}},"158":{"start":{"line":235,"column":8},"end":{"line":237,"column":9}},"159":{"start":{"line":236,"column":12},"end":{"line":236,"column":19}},"160":{"start":{"line":238,"column":27},"end":{"line":238,"column":104}},"161":{"start":{"line":239,"column":8},"end":{"line":241,"column":9}},"162":{"start":{"line":240,"column":12},"end":{"line":240,"column":19}},"163":{"start":{"line":242,"column":24},"end":{"line":242,"column":99}},"164":{"start":{"line":243,"column":8},"end":{"line":245,"column":9}},"165":{"start":{"line":244,"column":12},"end":{"line":244,"column":19}},"166":{"start":{"line":246,"column":8},"end":{"line":253,"column":9}},"167":{"start":{"line":247,"column":37},"end":{"line":247,"column":111}},"168":{"start":{"line":248,"column":12},"end":{"line":250,"column":13}},"169":{"start":{"line":249,"column":16},"end":{"line":249,"column":23}},"170":{"start":{"line":251,"column":12},"end":{"line":251,"column":191}},"171":{"start":{"line":252,"column":12},"end":{"line":252,"column":19}},"172":{"start":{"line":254,"column":8},"end":{"line":254,"column":164}},"173":{"start":{"line":258,"column":106},"end":{"line":258,"column":134}},"174":{"start":{"line":259,"column":30},"end":{"line":259,"column":105}},"175":{"start":{"line":260,"column":8},"end":{"line":262,"column":9}},"176":{"start":{"line":261,"column":12},"end":{"line":261,"column":19}},"177":{"start":{"line":263,"column":27},"end":{"line":263,"column":104}},"178":{"start":{"line":264,"column":8},"end":{"line":266,"column":9}},"179":{"start":{"line":265,"column":12},"end":{"line":265,"column":19}},"180":{"start":{"line":267,"column":24},"end":{"line":267,"column":94}},"181":{"start":{"line":268,"column":8},"end":{"line":270,"column":9}},"182":{"start":{"line":269,"column":12},"end":{"line":269,"column":19}},"183":{"start":{"line":272,"column":33},"end":{"line":272,"column":257}},"184":{"start":{"line":272,"column":173},"end":{"line":272,"column":256}},"185":{"start":{"line":273,"column":8},"end":{"line":285,"column":9}},"186":{"start":{"line":274,"column":40},"end":{"line":274,"column":183}},"187":{"start":{"line":275,"column":12},"end":{"line":277,"column":13}},"188":{"start":{"line":276,"column":16},"end":{"line":276,"column":23}},"189":{"start":{"line":278,"column":55},"end":{"line":278,"column":215}},"190":{"start":{"line":280,"column":12},"end":{"line":282,"column":13}},"191":{"start":{"line":281,"column":16},"end":{"line":281,"column":23}},"192":{"start":{"line":283,"column":12},"end":{"line":283,"column":157}},"193":{"start":{"line":284,"column":12},"end":{"line":284,"column":19}},"194":{"start":{"line":286,"column":8},"end":{"line":288,"column":9}},"195":{"start":{"line":287,"column":12},"end":{"line":287,"column":19}},"196":{"start":{"line":289,"column":8},"end":{"line":289,"column":147}},"197":{"start":{"line":292,"column":99},"end":{"line":292,"column":130}},"198":{"start":{"line":293,"column":30},"end":{"line":293,"column":105}},"199":{"start":{"line":294,"column":8},"end":{"line":296,"column":9}},"200":{"start":{"line":295,"column":12},"end":{"line":295,"column":19}},"201":{"start":{"line":297,"column":27},"end":{"line":297,"column":104}},"202":{"start":{"line":298,"column":8},"end":{"line":300,"column":9}},"203":{"start":{"line":299,"column":12},"end":{"line":299,"column":19}},"204":{"start":{"line":301,"column":24},"end":{"line":301,"column":99}},"205":{"start":{"line":302,"column":8},"end":{"line":304,"column":9}},"206":{"start":{"line":303,"column":12},"end":{"line":303,"column":19}},"207":{"start":{"line":305,"column":28},"end":{"line":311,"column":9}},"208":{"start":{"line":312,"column":31},"end":{"line":312,"column":121}},"209":{"start":{"line":313,"column":44},"end":{"line":313,"column":180}},"210":{"start":{"line":314,"column":8},"end":{"line":321,"column":9}},"211":{"start":{"line":315,"column":37},"end":{"line":315,"column":111}},"212":{"start":{"line":316,"column":12},"end":{"line":318,"column":13}},"213":{"start":{"line":317,"column":16},"end":{"line":317,"column":23}},"214":{"start":{"line":319,"column":12},"end":{"line":319,"column":180}},"215":{"start":{"line":320,"column":12},"end":{"line":320,"column":19}},"216":{"start":{"line":322,"column":8},"end":{"line":322,"column":122}},"217":{"start":{"line":325,"column":45},"end":{"line":325,"column":69}},"218":{"start":{"line":326,"column":30},"end":{"line":326,"column":105}},"219":{"start":{"line":327,"column":8},"end":{"line":329,"column":9}},"220":{"start":{"line":328,"column":12},"end":{"line":328,"column":19}},"221":{"start":{"line":330,"column":42},"end":{"line":330,"column":73}},"222":{"start":{"line":331,"column":8},"end":{"line":333,"column":9}},"223":{"start":{"line":332,"column":12},"end":{"line":332,"column":19}},"224":{"start":{"line":334,"column":8},"end":{"line":334,"column":47}},"225":{"start":{"line":335,"column":8},"end":{"line":335,"column":69}},"226":{"start":{"line":338,"column":73},"end":{"line":338,"column":92}},"227":{"start":{"line":339,"column":30},"end":{"line":339,"column":105}},"228":{"start":{"line":340,"column":8},"end":{"line":342,"column":9}},"229":{"start":{"line":341,"column":12},"end":{"line":341,"column":19}},"230":{"start":{"line":343,"column":30},"end":{"line":343,"column":107}},"231":{"start":{"line":344,"column":8},"end":{"line":346,"column":9}},"232":{"start":{"line":345,"column":12},"end":{"line":345,"column":19}},"233":{"start":{"line":347,"column":50},"end":{"line":347,"column":192}},"234":{"start":{"line":348,"column":8},"end":{"line":351,"column":9}},"235":{"start":{"line":349,"column":12},"end":{"line":349,"column":57}},"236":{"start":{"line":350,"column":12},"end":{"line":350,"column":73}},"237":{"start":{"line":352,"column":8},"end":{"line":354,"column":9}},"238":{"start":{"line":353,"column":12},"end":{"line":353,"column":19}},"239":{"start":{"line":355,"column":8},"end":{"line":355,"column":64}},"240":{"start":{"line":356,"column":8},"end":{"line":356,"column":91}},"241":{"start":{"line":359,"column":64},"end":{"line":359,"column":84}},"242":{"start":{"line":360,"column":30},"end":{"line":360,"column":105}},"243":{"start":{"line":361,"column":8},"end":{"line":363,"column":9}},"244":{"start":{"line":362,"column":12},"end":{"line":362,"column":19}},"245":{"start":{"line":364,"column":8},"end":{"line":366,"column":9}},"246":{"start":{"line":365,"column":12},"end":{"line":365,"column":19}},"247":{"start":{"line":367,"column":30},"end":{"line":367,"column":107}},"248":{"start":{"line":368,"column":8},"end":{"line":370,"column":9}},"249":{"start":{"line":369,"column":12},"end":{"line":369,"column":19}},"250":{"start":{"line":371,"column":8},"end":{"line":371,"column":49}},"251":{"start":{"line":372,"column":8},"end":{"line":372,"column":85}},"252":{"start":{"line":375,"column":67},"end":{"line":375,"column":87}},"253":{"start":{"line":376,"column":30},"end":{"line":376,"column":105}},"254":{"start":{"line":377,"column":8},"end":{"line":379,"column":9}},"255":{"start":{"line":378,"column":12},"end":{"line":378,"column":19}},"256":{"start":{"line":380,"column":30},"end":{"line":380,"column":107}},"257":{"start":{"line":381,"column":8},"end":{"line":383,"column":9}},"258":{"start":{"line":382,"column":12},"end":{"line":382,"column":19}},"259":{"start":{"line":384,"column":24},"end":{"line":384,"column":143}},"260":{"start":{"line":385,"column":8},"end":{"line":387,"column":9}},"261":{"start":{"line":386,"column":12},"end":{"line":386,"column":19}},"262":{"start":{"line":388,"column":8},"end":{"line":388,"column":31}},"263":{"start":{"line":391,"column":78},"end":{"line":391,"column":98}},"264":{"start":{"line":392,"column":30},"end":{"line":392,"column":105}},"265":{"start":{"line":393,"column":8},"end":{"line":395,"column":9}},"266":{"start":{"line":394,"column":12},"end":{"line":394,"column":19}},"267":{"start":{"line":396,"column":53},"end":{"line":396,"column":130}},"268":{"start":{"line":397,"column":8},"end":{"line":399,"column":9}},"269":{"start":{"line":398,"column":12},"end":{"line":398,"column":19}},"270":{"start":{"line":400,"column":31},"end":{"line":400,"column":125}},"271":{"start":{"line":401,"column":8},"end":{"line":416,"column":12}},"272":{"start":{"line":402,"column":28},"end":{"line":402,"column":83}},"273":{"start":{"line":403,"column":12},"end":{"line":405,"column":13}},"274":{"start":{"line":404,"column":16},"end":{"line":404,"column":23}},"275":{"start":{"line":406,"column":34},"end":{"line":406,"column":113}},"276":{"start":{"line":406,"column":59},"end":{"line":406,"column":85}},"277":{"start":{"line":406,"column":101},"end":{"line":406,"column":112}},"278":{"start":{"line":407,"column":31},"end":{"line":407,"column":107}},"279":{"start":{"line":407,"column":56},"end":{"line":407,"column":79}},"280":{"start":{"line":407,"column":95},"end":{"line":407,"column":106}},"281":{"start":{"line":408,"column":12},"end":{"line":415,"column":15}},"282":{"start":{"line":419,"column":129},"end":{"line":419,"column":160}},"283":{"start":{"line":420,"column":8},"end":{"line":422,"column":9}},"284":{"start":{"line":421,"column":12},"end":{"line":421,"column":19}},"285":{"start":{"line":423,"column":30},"end":{"line":423,"column":108}},"286":{"start":{"line":424,"column":8},"end":{"line":426,"column":9}},"287":{"start":{"line":425,"column":12},"end":{"line":425,"column":19}},"288":{"start":{"line":427,"column":30},"end":{"line":427,"column":105}},"289":{"start":{"line":428,"column":8},"end":{"line":430,"column":9}},"290":{"start":{"line":429,"column":12},"end":{"line":429,"column":19}},"291":{"start":{"line":431,"column":27},"end":{"line":431,"column":104}},"292":{"start":{"line":432,"column":8},"end":{"line":434,"column":9}},"293":{"start":{"line":433,"column":12},"end":{"line":433,"column":19}},"294":{"start":{"line":435,"column":24},"end":{"line":435,"column":99}},"295":{"start":{"line":436,"column":8},"end":{"line":438,"column":9}},"296":{"start":{"line":437,"column":12},"end":{"line":437,"column":19}},"297":{"start":{"line":439,"column":8},"end":{"line":446,"column":9}},"298":{"start":{"line":440,"column":37},"end":{"line":440,"column":111}},"299":{"start":{"line":441,"column":12},"end":{"line":443,"column":13}},"300":{"start":{"line":442,"column":16},"end":{"line":442,"column":23}},"301":{"start":{"line":444,"column":12},"end":{"line":444,"column":216}},"302":{"start":{"line":445,"column":12},"end":{"line":445,"column":19}},"303":{"start":{"line":447,"column":8},"end":{"line":447,"column":189}},"304":{"start":{"line":450,"column":107},"end":{"line":450,"column":138}},"305":{"start":{"line":451,"column":8},"end":{"line":453,"column":9}},"306":{"start":{"line":452,"column":12},"end":{"line":452,"column":19}},"307":{"start":{"line":454,"column":30},"end":{"line":454,"column":108}},"308":{"start":{"line":455,"column":8},"end":{"line":457,"column":9}},"309":{"start":{"line":456,"column":12},"end":{"line":456,"column":19}},"310":{"start":{"line":458,"column":30},"end":{"line":458,"column":105}},"311":{"start":{"line":459,"column":8},"end":{"line":461,"column":9}},"312":{"start":{"line":460,"column":12},"end":{"line":460,"column":19}},"313":{"start":{"line":462,"column":27},"end":{"line":462,"column":104}},"314":{"start":{"line":463,"column":8},"end":{"line":465,"column":9}},"315":{"start":{"line":464,"column":12},"end":{"line":464,"column":19}},"316":{"start":{"line":466,"column":24},"end":{"line":466,"column":99}},"317":{"start":{"line":467,"column":8},"end":{"line":469,"column":9}},"318":{"start":{"line":468,"column":12},"end":{"line":468,"column":19}},"319":{"start":{"line":470,"column":28},"end":{"line":476,"column":9}},"320":{"start":{"line":477,"column":31},"end":{"line":477,"column":121}},"321":{"start":{"line":478,"column":44},"end":{"line":478,"column":180}},"322":{"start":{"line":479,"column":8},"end":{"line":486,"column":9}},"323":{"start":{"line":480,"column":37},"end":{"line":480,"column":111}},"324":{"start":{"line":481,"column":12},"end":{"line":483,"column":13}},"325":{"start":{"line":482,"column":16},"end":{"line":482,"column":23}},"326":{"start":{"line":484,"column":12},"end":{"line":484,"column":205}},"327":{"start":{"line":485,"column":12},"end":{"line":485,"column":19}},"328":{"start":{"line":487,"column":8},"end":{"line":487,"column":147}},"329":{"start":{"line":490,"column":8},"end":{"line":490,"column":485}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":8,"column":9},"end":{"line":8,"column":10}},"loc":{"start":{"line":8,"column":20},"end":{"line":10,"column":5}},"line":8},"1":{"name":"(anonymous_1)","decl":{"start":{"line":21,"column":4},"end":{"line":21,"column":5}},"loc":{"start":{"line":21,"column":40},"end":{"line":34,"column":5}},"line":21},"2":{"name":"(anonymous_2)","decl":{"start":{"line":35,"column":4},"end":{"line":35,"column":5}},"loc":{"start":{"line":35,"column":60},"end":{"line":135,"column":5}},"line":35},"3":{"name":"(anonymous_3)","decl":{"start":{"line":102,"column":45},"end":{"line":102,"column":46}},"loc":{"start":{"line":102,"column":54},"end":{"line":102,"column":100}},"line":102},"4":{"name":"(anonymous_4)","decl":{"start":{"line":136,"column":4},"end":{"line":136,"column":5}},"loc":{"start":{"line":136,"column":115},"end":{"line":183,"column":5}},"line":136},"5":{"name":"(anonymous_5)","decl":{"start":{"line":184,"column":4},"end":{"line":184,"column":5}},"loc":{"start":{"line":184,"column":75},"end":{"line":195,"column":5}},"line":184},"6":{"name":"(anonymous_6)","decl":{"start":{"line":196,"column":4},"end":{"line":196,"column":5}},"loc":{"start":{"line":196,"column":125},"end":{"line":200,"column":5}},"line":196},"7":{"name":"(anonymous_7)","decl":{"start":{"line":197,"column":99},"end":{"line":197,"column":100}},"loc":{"start":{"line":197,"column":119},"end":{"line":197,"column":198}},"line":197},"8":{"name":"(anonymous_8)","decl":{"start":{"line":198,"column":102},"end":{"line":198,"column":103}},"loc":{"start":{"line":198,"column":122},"end":{"line":198,"column":175}},"line":198},"9":{"name":"(anonymous_9)","decl":{"start":{"line":201,"column":4},"end":{"line":201,"column":5}},"loc":{"start":{"line":201,"column":140},"end":{"line":218,"column":5}},"line":201},"10":{"name":"(anonymous_10)","decl":{"start":{"line":202,"column":73},"end":{"line":202,"column":74}},"loc":{"start":{"line":202,"column":102},"end":{"line":210,"column":9}},"line":202},"11":{"name":"(anonymous_11)","decl":{"start":{"line":217,"column":45},"end":{"line":217,"column":46}},"loc":{"start":{"line":217,"column":56},"end":{"line":217,"column":206}},"line":217},"12":{"name":"(anonymous_12)","decl":{"start":{"line":217,"column":212},"end":{"line":217,"column":213}},"loc":{"start":{"line":217,"column":223},"end":{"line":217,"column":284}},"line":217},"13":{"name":"(anonymous_13)","decl":{"start":{"line":219,"column":4},"end":{"line":219,"column":5}},"loc":{"start":{"line":219,"column":120},"end":{"line":231,"column":5}},"line":219},"14":{"name":"(anonymous_14)","decl":{"start":{"line":232,"column":4},"end":{"line":232,"column":5}},"loc":{"start":{"line":232,"column":69},"end":{"line":255,"column":5}},"line":232},"15":{"name":"(anonymous_15)","decl":{"start":{"line":256,"column":4},"end":{"line":256,"column":5}},"loc":{"start":{"line":256,"column":72},"end":{"line":290,"column":5}},"line":256},"16":{"name":"(anonymous_16)","decl":{"start":{"line":272,"column":159},"end":{"line":272,"column":160}},"loc":{"start":{"line":272,"column":173},"end":{"line":272,"column":256}},"line":272},"17":{"name":"(anonymous_17)","decl":{"start":{"line":291,"column":4},"end":{"line":291,"column":5}},"loc":{"start":{"line":291,"column":73},"end":{"line":323,"column":5}},"line":291},"18":{"name":"(anonymous_18)","decl":{"start":{"line":324,"column":4},"end":{"line":324,"column":5}},"loc":{"start":{"line":324,"column":54},"end":{"line":336,"column":5}},"line":324},"19":{"name":"(anonymous_19)","decl":{"start":{"line":337,"column":4},"end":{"line":337,"column":5}},"loc":{"start":{"line":337,"column":48},"end":{"line":357,"column":5}},"line":337},"20":{"name":"(anonymous_20)","decl":{"start":{"line":358,"column":4},"end":{"line":358,"column":5}},"loc":{"start":{"line":358,"column":50},"end":{"line":373,"column":5}},"line":358},"21":{"name":"(anonymous_21)","decl":{"start":{"line":374,"column":4},"end":{"line":374,"column":5}},"loc":{"start":{"line":374,"column":46},"end":{"line":389,"column":5}},"line":374},"22":{"name":"(anonymous_22)","decl":{"start":{"line":390,"column":4},"end":{"line":390,"column":5}},"loc":{"start":{"line":390,"column":56},"end":{"line":417,"column":5}},"line":390},"23":{"name":"(anonymous_23)","decl":{"start":{"line":401,"column":45},"end":{"line":401,"column":46}},"loc":{"start":{"line":401,"column":68},"end":{"line":416,"column":9}},"line":401},"24":{"name":"(anonymous_24)","decl":{"start":{"line":406,"column":49},"end":{"line":406,"column":50}},"loc":{"start":{"line":406,"column":59},"end":{"line":406,"column":85}},"line":406},"25":{"name":"(anonymous_25)","decl":{"start":{"line":406,"column":91},"end":{"line":406,"column":92}},"loc":{"start":{"line":406,"column":101},"end":{"line":406,"column":112}},"line":406},"26":{"name":"(anonymous_26)","decl":{"start":{"line":407,"column":46},"end":{"line":407,"column":47}},"loc":{"start":{"line":407,"column":56},"end":{"line":407,"column":79}},"line":407},"27":{"name":"(anonymous_27)","decl":{"start":{"line":407,"column":85},"end":{"line":407,"column":86}},"loc":{"start":{"line":407,"column":95},"end":{"line":407,"column":106}},"line":407},"28":{"name":"(anonymous_28)","decl":{"start":{"line":418,"column":4},"end":{"line":418,"column":5}},"loc":{"start":{"line":418,"column":77},"end":{"line":448,"column":5}},"line":418},"29":{"name":"(anonymous_29)","decl":{"start":{"line":449,"column":4},"end":{"line":449,"column":5}},"loc":{"start":{"line":449,"column":81},"end":{"line":488,"column":5}},"line":449},"30":{"name":"(anonymous_30)","decl":{"start":{"line":489,"column":4},"end":{"line":489,"column":5}},"loc":{"start":{"line":489,"column":189},"end":{"line":491,"column":5}},"line":489}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":32},"end":{"line":22,"column":75}},"type":"default-arg","locations":[{"start":{"line":22,"column":70},"end":{"line":22,"column":75}}],"line":22},"1":{"loc":{"start":{"line":22,"column":77},"end":{"line":22,"column":96}},"type":"default-arg","locations":[{"start":{"line":22,"column":94},"end":{"line":22,"column":96}}],"line":22},"2":{"loc":{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},"type":"if","locations":[{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},{"start":{"line":23,"column":8},"end":{"line":25,"column":9}}],"line":23},"3":{"loc":{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":28,"column":9}},{"start":{"line":26,"column":8},"end":{"line":28,"column":9}}],"line":26},"4":{"loc":{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},"type":"if","locations":[{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},{"start":{"line":30,"column":8},"end":{"line":32,"column":9}}],"line":30},"5":{"loc":{"start":{"line":30,"column":12},"end":{"line":30,"column":65}},"type":"binary-expr","locations":[{"start":{"line":30,"column":12},"end":{"line":30,"column":17}},{"start":{"line":30,"column":21},"end":{"line":30,"column":65}}],"line":30},"6":{"loc":{"start":{"line":39,"column":39},"end":{"line":39,"column":88}},"type":"binary-expr","locations":[{"start":{"line":39,"column":39},"end":{"line":39,"column":78}},{"start":{"line":39,"column":82},"end":{"line":39,"column":88}}],"line":39},"7":{"loc":{"start":{"line":40,"column":8},"end":{"line":43,"column":9}},"type":"if","locations":[{"start":{"line":40,"column":8},"end":{"line":43,"column":9}},{"start":{"line":40,"column":8},"end":{"line":43,"column":9}}],"line":40},"8":{"loc":{"start":{"line":40,"column":12},"end":{"line":40,"column":91}},"type":"cond-expr","locations":[{"start":{"line":40,"column":61},"end":{"line":40,"column":67}},{"start":{"line":40,"column":70},"end":{"line":40,"column":91}}],"line":40},"9":{"loc":{"start":{"line":40,"column":12},"end":{"line":40,"column":58}},"type":"binary-expr","locations":[{"start":{"line":40,"column":12},"end":{"line":40,"column":32}},{"start":{"line":40,"column":36},"end":{"line":40,"column":58}}],"line":40},"10":{"loc":{"start":{"line":42,"column":12},"end":{"line":42,"column":162}},"type":"binary-expr","locations":[{"start":{"line":42,"column":12},"end":{"line":42,"column":25}},{"start":{"line":42,"column":29},"end":{"line":42,"column":162}}],"line":42},"11":{"loc":{"start":{"line":42,"column":82},"end":{"line":42,"column":161}},"type":"cond-expr","locations":[{"start":{"line":42,"column":131},"end":{"line":42,"column":137}},{"start":{"line":42,"column":140},"end":{"line":42,"column":161}}],"line":42},"12":{"loc":{"start":{"line":42,"column":82},"end":{"line":42,"column":128}},"type":"binary-expr","locations":[{"start":{"line":42,"column":82},"end":{"line":42,"column":102}},{"start":{"line":42,"column":106},"end":{"line":42,"column":128}}],"line":42},"13":{"loc":{"start":{"line":44,"column":8},"end":{"line":47,"column":9}},"type":"if","locations":[{"start":{"line":44,"column":8},"end":{"line":47,"column":9}},{"start":{"line":44,"column":8},"end":{"line":47,"column":9}}],"line":44},"14":{"loc":{"start":{"line":44,"column":12},"end":{"line":44,"column":93}},"type":"cond-expr","locations":[{"start":{"line":44,"column":61},"end":{"line":44,"column":67}},{"start":{"line":44,"column":70},"end":{"line":44,"column":93}}],"line":44},"15":{"loc":{"start":{"line":44,"column":12},"end":{"line":44,"column":58}},"type":"binary-expr","locations":[{"start":{"line":44,"column":12},"end":{"line":44,"column":32}},{"start":{"line":44,"column":36},"end":{"line":44,"column":58}}],"line":44},"16":{"loc":{"start":{"line":46,"column":12},"end":{"line":46,"column":169}},"type":"binary-expr","locations":[{"start":{"line":46,"column":12},"end":{"line":46,"column":25}},{"start":{"line":46,"column":29},"end":{"line":46,"column":169}}],"line":46},"17":{"loc":{"start":{"line":46,"column":87},"end":{"line":46,"column":168}},"type":"cond-expr","locations":[{"start":{"line":46,"column":136},"end":{"line":46,"column":142}},{"start":{"line":46,"column":145},"end":{"line":46,"column":168}}],"line":46},"18":{"loc":{"start":{"line":46,"column":87},"end":{"line":46,"column":133}},"type":"binary-expr","locations":[{"start":{"line":46,"column":87},"end":{"line":46,"column":107}},{"start":{"line":46,"column":111},"end":{"line":46,"column":133}}],"line":46},"19":{"loc":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"type":"if","locations":[{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},{"start":{"line":48,"column":8},"end":{"line":50,"column":9}}],"line":48},"20":{"loc":{"start":{"line":48,"column":12},"end":{"line":48,"column":93}},"type":"binary-expr","locations":[{"start":{"line":48,"column":12},"end":{"line":48,"column":40}},{"start":{"line":48,"column":44},"end":{"line":48,"column":67}},{"start":{"line":48,"column":71},"end":{"line":48,"column":93}}],"line":48},"21":{"loc":{"start":{"line":53,"column":32},"end":{"line":53,"column":106}},"type":"cond-expr","locations":[{"start":{"line":53,"column":65},"end":{"line":53,"column":84}},{"start":{"line":53,"column":87},"end":{"line":53,"column":106}}],"line":53},"22":{"loc":{"start":{"line":54,"column":32},"end":{"line":54,"column":106}},"type":"cond-expr","locations":[{"start":{"line":54,"column":65},"end":{"line":54,"column":84}},{"start":{"line":54,"column":87},"end":{"line":54,"column":106}}],"line":54},"23":{"loc":{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},"type":"if","locations":[{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},{"start":{"line":56,"column":8},"end":{"line":58,"column":9}}],"line":56},"24":{"loc":{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},"type":"if","locations":[{"start":{"line":60,"column":8},"end":{"line":62,"column":9}},{"start":{"line":60,"column":8},"end":{"line":62,"column":9}}],"line":60},"25":{"loc":{"start":{"line":63,"column":37},"end":{"line":63,"column":130}},"type":"binary-expr","locations":[{"start":{"line":63,"column":37},"end":{"line":63,"column":48}},{"start":{"line":63,"column":52},"end":{"line":63,"column":130}}],"line":63},"26":{"loc":{"start":{"line":64,"column":37},"end":{"line":64,"column":130}},"type":"binary-expr","locations":[{"start":{"line":64,"column":37},"end":{"line":64,"column":48}},{"start":{"line":64,"column":52},"end":{"line":64,"column":130}}],"line":64},"27":{"loc":{"start":{"line":65,"column":8},"end":{"line":67,"column":9}},"type":"if","locations":[{"start":{"line":65,"column":8},"end":{"line":67,"column":9}},{"start":{"line":65,"column":8},"end":{"line":67,"column":9}}],"line":65},"28":{"loc":{"start":{"line":65,"column":12},"end":{"line":65,"column":58}},"type":"binary-expr","locations":[{"start":{"line":65,"column":12},"end":{"line":65,"column":33}},{"start":{"line":65,"column":37},"end":{"line":65,"column":58}}],"line":65},"29":{"loc":{"start":{"line":68,"column":8},"end":{"line":71,"column":9}},"type":"if","locations":[{"start":{"line":68,"column":8},"end":{"line":71,"column":9}},{"start":{"line":68,"column":8},"end":{"line":71,"column":9}}],"line":68},"30":{"loc":{"start":{"line":72,"column":8},"end":{"line":103,"column":9}},"type":"if","locations":[{"start":{"line":72,"column":8},"end":{"line":103,"column":9}},{"start":{"line":72,"column":8},"end":{"line":103,"column":9}}],"line":72},"31":{"loc":{"start":{"line":72,"column":12},"end":{"line":72,"column":67}},"type":"binary-expr","locations":[{"start":{"line":72,"column":12},"end":{"line":72,"column":41}},{"start":{"line":72,"column":45},"end":{"line":72,"column":67}}],"line":72},"32":{"loc":{"start":{"line":73,"column":12},"end":{"line":75,"column":13}},"type":"if","locations":[{"start":{"line":73,"column":12},"end":{"line":75,"column":13}},{"start":{"line":73,"column":12},"end":{"line":75,"column":13}}],"line":73},"33":{"loc":{"start":{"line":76,"column":12},"end":{"line":84,"column":13}},"type":"if","locations":[{"start":{"line":76,"column":12},"end":{"line":84,"column":13}},{"start":{"line":76,"column":12},"end":{"line":84,"column":13}}],"line":76},"34":{"loc":{"start":{"line":79,"column":71},"end":{"line":79,"column":142}},"type":"binary-expr","locations":[{"start":{"line":79,"column":71},"end":{"line":79,"column":99}},{"start":{"line":79,"column":103},"end":{"line":79,"column":142}}],"line":79},"35":{"loc":{"start":{"line":80,"column":16},"end":{"line":82,"column":17}},"type":"if","locations":[{"start":{"line":80,"column":16},"end":{"line":82,"column":17}},{"start":{"line":80,"column":16},"end":{"line":82,"column":17}}],"line":80},"36":{"loc":{"start":{"line":88,"column":12},"end":{"line":96,"column":13}},"type":"if","locations":[{"start":{"line":88,"column":12},"end":{"line":96,"column":13}},{"start":{"line":88,"column":12},"end":{"line":96,"column":13}}],"line":88},"37":{"loc":{"start":{"line":104,"column":30},"end":{"line":104,"column":130}},"type":"binary-expr","locations":[{"start":{"line":104,"column":30},"end":{"line":104,"column":51}},{"start":{"line":104,"column":55},"end":{"line":104,"column":130}}],"line":104},"38":{"loc":{"start":{"line":105,"column":8},"end":{"line":107,"column":9}},"type":"if","locations":[{"start":{"line":105,"column":8},"end":{"line":107,"column":9}},{"start":{"line":105,"column":8},"end":{"line":107,"column":9}}],"line":105},"39":{"loc":{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},"type":"if","locations":[{"start":{"line":109,"column":8},"end":{"line":111,"column":9}},{"start":{"line":109,"column":8},"end":{"line":111,"column":9}}],"line":109},"40":{"loc":{"start":{"line":109,"column":12},"end":{"line":109,"column":57}},"type":"binary-expr","locations":[{"start":{"line":109,"column":12},"end":{"line":109,"column":18}},{"start":{"line":109,"column":22},"end":{"line":109,"column":57}}],"line":109},"41":{"loc":{"start":{"line":112,"column":8},"end":{"line":118,"column":9}},"type":"if","locations":[{"start":{"line":112,"column":8},"end":{"line":118,"column":9}},{"start":{"line":112,"column":8},"end":{"line":118,"column":9}}],"line":112},"42":{"loc":{"start":{"line":113,"column":12},"end":{"line":115,"column":13}},"type":"if","locations":[{"start":{"line":113,"column":12},"end":{"line":115,"column":13}},{"start":{"line":113,"column":12},"end":{"line":115,"column":13}}],"line":113},"43":{"loc":{"start":{"line":119,"column":8},"end":{"line":130,"column":9}},"type":"if","locations":[{"start":{"line":119,"column":8},"end":{"line":130,"column":9}},{"start":{"line":119,"column":8},"end":{"line":130,"column":9}}],"line":119},"44":{"loc":{"start":{"line":119,"column":12},"end":{"line":119,"column":76}},"type":"binary-expr","locations":[{"start":{"line":119,"column":12},"end":{"line":119,"column":41}},{"start":{"line":119,"column":45},"end":{"line":119,"column":76}}],"line":119},"45":{"loc":{"start":{"line":121,"column":12},"end":{"line":123,"column":13}},"type":"if","locations":[{"start":{"line":121,"column":12},"end":{"line":123,"column":13}},{"start":{"line":121,"column":12},"end":{"line":123,"column":13}}],"line":121},"46":{"loc":{"start":{"line":132,"column":8},"end":{"line":134,"column":9}},"type":"if","locations":[{"start":{"line":132,"column":8},"end":{"line":134,"column":9}},{"start":{"line":132,"column":8},"end":{"line":134,"column":9}}],"line":132},"47":{"loc":{"start":{"line":138,"column":8},"end":{"line":146,"column":9}},"type":"if","locations":[{"start":{"line":138,"column":8},"end":{"line":146,"column":9}},{"start":{"line":138,"column":8},"end":{"line":146,"column":9}}],"line":138},"48":{"loc":{"start":{"line":141,"column":12},"end":{"line":143,"column":13}},"type":"if","locations":[{"start":{"line":141,"column":12},"end":{"line":143,"column":13}},{"start":{"line":141,"column":12},"end":{"line":143,"column":13}}],"line":141},"49":{"loc":{"start":{"line":148,"column":8},"end":{"line":150,"column":9}},"type":"if","locations":[{"start":{"line":148,"column":8},"end":{"line":150,"column":9}},{"start":{"line":148,"column":8},"end":{"line":150,"column":9}}],"line":148},"50":{"loc":{"start":{"line":152,"column":59},"end":{"line":152,"column":151}},"type":"binary-expr","locations":[{"start":{"line":152,"column":59},"end":{"line":152,"column":64}},{"start":{"line":152,"column":68},"end":{"line":152,"column":79}},{"start":{"line":152,"column":83},"end":{"line":152,"column":151}}],"line":152},"51":{"loc":{"start":{"line":153,"column":8},"end":{"line":155,"column":9}},"type":"if","locations":[{"start":{"line":153,"column":8},"end":{"line":155,"column":9}},{"start":{"line":153,"column":8},"end":{"line":155,"column":9}}],"line":153},"52":{"loc":{"start":{"line":156,"column":8},"end":{"line":158,"column":9}},"type":"if","locations":[{"start":{"line":156,"column":8},"end":{"line":158,"column":9}},{"start":{"line":156,"column":8},"end":{"line":158,"column":9}}],"line":156},"53":{"loc":{"start":{"line":160,"column":8},"end":{"line":162,"column":9}},"type":"if","locations":[{"start":{"line":160,"column":8},"end":{"line":162,"column":9}},{"start":{"line":160,"column":8},"end":{"line":162,"column":9}}],"line":160},"54":{"loc":{"start":{"line":164,"column":158},"end":{"line":164,"column":221}},"type":"cond-expr","locations":[{"start":{"line":164,"column":188},"end":{"line":164,"column":209}},{"start":{"line":164,"column":212},"end":{"line":164,"column":221}}],"line":164},"55":{"loc":{"start":{"line":166,"column":8},"end":{"line":174,"column":9}},"type":"if","locations":[{"start":{"line":166,"column":8},"end":{"line":174,"column":9}},{"start":{"line":166,"column":8},"end":{"line":174,"column":9}}],"line":166},"56":{"loc":{"start":{"line":166,"column":12},"end":{"line":166,"column":65}},"type":"binary-expr","locations":[{"start":{"line":166,"column":12},"end":{"line":166,"column":40}},{"start":{"line":166,"column":44},"end":{"line":166,"column":65}}],"line":166},"57":{"loc":{"start":{"line":176,"column":8},"end":{"line":178,"column":9}},"type":"if","locations":[{"start":{"line":176,"column":8},"end":{"line":178,"column":9}},{"start":{"line":176,"column":8},"end":{"line":178,"column":9}}],"line":176},"58":{"loc":{"start":{"line":186,"column":8},"end":{"line":188,"column":9}},"type":"if","locations":[{"start":{"line":186,"column":8},"end":{"line":188,"column":9}},{"start":{"line":186,"column":8},"end":{"line":188,"column":9}}],"line":186},"59":{"loc":{"start":{"line":191,"column":30},"end":{"line":191,"column":134}},"type":"binary-expr","locations":[{"start":{"line":191,"column":30},"end":{"line":191,"column":46}},{"start":{"line":191,"column":50},"end":{"line":191,"column":134}}],"line":191},"60":{"loc":{"start":{"line":192,"column":25},"end":{"line":192,"column":155}},"type":"cond-expr","locations":[{"start":{"line":192,"column":55},"end":{"line":192,"column":68}},{"start":{"line":192,"column":71},"end":{"line":192,"column":155}}],"line":192},"61":{"loc":{"start":{"line":197,"column":119},"end":{"line":197,"column":198}},"type":"binary-expr","locations":[{"start":{"line":197,"column":119},"end":{"line":197,"column":157}},{"start":{"line":197,"column":161},"end":{"line":197,"column":198}}],"line":197},"62":{"loc":{"start":{"line":204,"column":12},"end":{"line":208,"column":13}},"type":"if","locations":[{"start":{"line":204,"column":12},"end":{"line":208,"column":13}},{"start":{"line":204,"column":12},"end":{"line":208,"column":13}}],"line":204},"63":{"loc":{"start":{"line":206,"column":42},"end":{"line":206,"column":158}},"type":"cond-expr","locations":[{"start":{"line":206,"column":77},"end":{"line":206,"column":116}},{"start":{"line":206,"column":119},"end":{"line":206,"column":158}}],"line":206},"64":{"loc":{"start":{"line":209,"column":19},"end":{"line":209,"column":128}},"type":"binary-expr","locations":[{"start":{"line":209,"column":19},"end":{"line":209,"column":26}},{"start":{"line":209,"column":30},"end":{"line":209,"column":128}}],"line":209},"65":{"loc":{"start":{"line":228,"column":8},"end":{"line":230,"column":9}},"type":"if","locations":[{"start":{"line":228,"column":8},"end":{"line":230,"column":9}},{"start":{"line":228,"column":8},"end":{"line":230,"column":9}}],"line":228},"66":{"loc":{"start":{"line":235,"column":8},"end":{"line":237,"column":9}},"type":"if","locations":[{"start":{"line":235,"column":8},"end":{"line":237,"column":9}},{"start":{"line":235,"column":8},"end":{"line":237,"column":9}}],"line":235},"67":{"loc":{"start":{"line":239,"column":8},"end":{"line":241,"column":9}},"type":"if","locations":[{"start":{"line":239,"column":8},"end":{"line":241,"column":9}},{"start":{"line":239,"column":8},"end":{"line":241,"column":9}}],"line":239},"68":{"loc":{"start":{"line":243,"column":8},"end":{"line":245,"column":9}},"type":"if","locations":[{"start":{"line":243,"column":8},"end":{"line":245,"column":9}},{"start":{"line":243,"column":8},"end":{"line":245,"column":9}}],"line":243},"69":{"loc":{"start":{"line":246,"column":8},"end":{"line":253,"column":9}},"type":"if","locations":[{"start":{"line":246,"column":8},"end":{"line":253,"column":9}},{"start":{"line":246,"column":8},"end":{"line":253,"column":9}}],"line":246},"70":{"loc":{"start":{"line":248,"column":12},"end":{"line":250,"column":13}},"type":"if","locations":[{"start":{"line":248,"column":12},"end":{"line":250,"column":13}},{"start":{"line":248,"column":12},"end":{"line":250,"column":13}}],"line":248},"71":{"loc":{"start":{"line":260,"column":8},"end":{"line":262,"column":9}},"type":"if","locations":[{"start":{"line":260,"column":8},"end":{"line":262,"column":9}},{"start":{"line":260,"column":8},"end":{"line":262,"column":9}}],"line":260},"72":{"loc":{"start":{"line":264,"column":8},"end":{"line":266,"column":9}},"type":"if","locations":[{"start":{"line":264,"column":8},"end":{"line":266,"column":9}},{"start":{"line":264,"column":8},"end":{"line":266,"column":9}}],"line":264},"73":{"loc":{"start":{"line":268,"column":8},"end":{"line":270,"column":9}},"type":"if","locations":[{"start":{"line":268,"column":8},"end":{"line":270,"column":9}},{"start":{"line":268,"column":8},"end":{"line":270,"column":9}}],"line":268},"74":{"loc":{"start":{"line":272,"column":33},"end":{"line":272,"column":257}},"type":"cond-expr","locations":[{"start":{"line":272,"column":124},"end":{"line":272,"column":130}},{"start":{"line":272,"column":133},"end":{"line":272,"column":257}}],"line":272},"75":{"loc":{"start":{"line":272,"column":33},"end":{"line":272,"column":121}},"type":"binary-expr","locations":[{"start":{"line":272,"column":33},"end":{"line":272,"column":86}},{"start":{"line":272,"column":90},"end":{"line":272,"column":121}}],"line":272},"76":{"loc":{"start":{"line":272,"column":173},"end":{"line":272,"column":256}},"type":"binary-expr","locations":[{"start":{"line":272,"column":173},"end":{"line":272,"column":220}},{"start":{"line":272,"column":224},"end":{"line":272,"column":256}}],"line":272},"77":{"loc":{"start":{"line":273,"column":8},"end":{"line":285,"column":9}},"type":"if","locations":[{"start":{"line":273,"column":8},"end":{"line":285,"column":9}},{"start":{"line":273,"column":8},"end":{"line":285,"column":9}}],"line":273},"78":{"loc":{"start":{"line":275,"column":12},"end":{"line":277,"column":13}},"type":"if","locations":[{"start":{"line":275,"column":12},"end":{"line":277,"column":13}},{"start":{"line":275,"column":12},"end":{"line":277,"column":13}}],"line":275},"79":{"loc":{"start":{"line":280,"column":12},"end":{"line":282,"column":13}},"type":"if","locations":[{"start":{"line":280,"column":12},"end":{"line":282,"column":13}},{"start":{"line":280,"column":12},"end":{"line":282,"column":13}}],"line":280},"80":{"loc":{"start":{"line":286,"column":8},"end":{"line":288,"column":9}},"type":"if","locations":[{"start":{"line":286,"column":8},"end":{"line":288,"column":9}},{"start":{"line":286,"column":8},"end":{"line":288,"column":9}}],"line":286},"81":{"loc":{"start":{"line":294,"column":8},"end":{"line":296,"column":9}},"type":"if","locations":[{"start":{"line":294,"column":8},"end":{"line":296,"column":9}},{"start":{"line":294,"column":8},"end":{"line":296,"column":9}}],"line":294},"82":{"loc":{"start":{"line":298,"column":8},"end":{"line":300,"column":9}},"type":"if","locations":[{"start":{"line":298,"column":8},"end":{"line":300,"column":9}},{"start":{"line":298,"column":8},"end":{"line":300,"column":9}}],"line":298},"83":{"loc":{"start":{"line":302,"column":8},"end":{"line":304,"column":9}},"type":"if","locations":[{"start":{"line":302,"column":8},"end":{"line":304,"column":9}},{"start":{"line":302,"column":8},"end":{"line":304,"column":9}}],"line":302},"84":{"loc":{"start":{"line":313,"column":16},"end":{"line":313,"column":26}},"type":"default-arg","locations":[{"start":{"line":313,"column":24},"end":{"line":313,"column":26}}],"line":313},"85":{"loc":{"start":{"line":314,"column":8},"end":{"line":321,"column":9}},"type":"if","locations":[{"start":{"line":314,"column":8},"end":{"line":321,"column":9}},{"start":{"line":314,"column":8},"end":{"line":321,"column":9}}],"line":314},"86":{"loc":{"start":{"line":316,"column":12},"end":{"line":318,"column":13}},"type":"if","locations":[{"start":{"line":316,"column":12},"end":{"line":318,"column":13}},{"start":{"line":316,"column":12},"end":{"line":318,"column":13}}],"line":316},"87":{"loc":{"start":{"line":327,"column":8},"end":{"line":329,"column":9}},"type":"if","locations":[{"start":{"line":327,"column":8},"end":{"line":329,"column":9}},{"start":{"line":327,"column":8},"end":{"line":329,"column":9}}],"line":327},"88":{"loc":{"start":{"line":331,"column":8},"end":{"line":333,"column":9}},"type":"if","locations":[{"start":{"line":331,"column":8},"end":{"line":333,"column":9}},{"start":{"line":331,"column":8},"end":{"line":333,"column":9}}],"line":331},"89":{"loc":{"start":{"line":340,"column":8},"end":{"line":342,"column":9}},"type":"if","locations":[{"start":{"line":340,"column":8},"end":{"line":342,"column":9}},{"start":{"line":340,"column":8},"end":{"line":342,"column":9}}],"line":340},"90":{"loc":{"start":{"line":344,"column":8},"end":{"line":346,"column":9}},"type":"if","locations":[{"start":{"line":344,"column":8},"end":{"line":346,"column":9}},{"start":{"line":344,"column":8},"end":{"line":346,"column":9}}],"line":344},"91":{"loc":{"start":{"line":348,"column":8},"end":{"line":351,"column":9}},"type":"if","locations":[{"start":{"line":348,"column":8},"end":{"line":351,"column":9}},{"start":{"line":348,"column":8},"end":{"line":351,"column":9}}],"line":348},"92":{"loc":{"start":{"line":348,"column":12},"end":{"line":348,"column":99}},"type":"binary-expr","locations":[{"start":{"line":348,"column":12},"end":{"line":348,"column":45}},{"start":{"line":348,"column":49},"end":{"line":348,"column":99}}],"line":348},"93":{"loc":{"start":{"line":352,"column":8},"end":{"line":354,"column":9}},"type":"if","locations":[{"start":{"line":352,"column":8},"end":{"line":354,"column":9}},{"start":{"line":352,"column":8},"end":{"line":354,"column":9}}],"line":352},"94":{"loc":{"start":{"line":361,"column":8},"end":{"line":363,"column":9}},"type":"if","locations":[{"start":{"line":361,"column":8},"end":{"line":363,"column":9}},{"start":{"line":361,"column":8},"end":{"line":363,"column":9}}],"line":361},"95":{"loc":{"start":{"line":364,"column":8},"end":{"line":366,"column":9}},"type":"if","locations":[{"start":{"line":364,"column":8},"end":{"line":366,"column":9}},{"start":{"line":364,"column":8},"end":{"line":366,"column":9}}],"line":364},"96":{"loc":{"start":{"line":368,"column":8},"end":{"line":370,"column":9}},"type":"if","locations":[{"start":{"line":368,"column":8},"end":{"line":370,"column":9}},{"start":{"line":368,"column":8},"end":{"line":370,"column":9}}],"line":368},"97":{"loc":{"start":{"line":377,"column":8},"end":{"line":379,"column":9}},"type":"if","locations":[{"start":{"line":377,"column":8},"end":{"line":379,"column":9}},{"start":{"line":377,"column":8},"end":{"line":379,"column":9}}],"line":377},"98":{"loc":{"start":{"line":381,"column":8},"end":{"line":383,"column":9}},"type":"if","locations":[{"start":{"line":381,"column":8},"end":{"line":383,"column":9}},{"start":{"line":381,"column":8},"end":{"line":383,"column":9}}],"line":381},"99":{"loc":{"start":{"line":385,"column":8},"end":{"line":387,"column":9}},"type":"if","locations":[{"start":{"line":385,"column":8},"end":{"line":387,"column":9}},{"start":{"line":385,"column":8},"end":{"line":387,"column":9}}],"line":385},"100":{"loc":{"start":{"line":391,"column":32},"end":{"line":391,"column":55}},"type":"default-arg","locations":[{"start":{"line":391,"column":53},"end":{"line":391,"column":55}}],"line":391},"101":{"loc":{"start":{"line":393,"column":8},"end":{"line":395,"column":9}},"type":"if","locations":[{"start":{"line":393,"column":8},"end":{"line":395,"column":9}},{"start":{"line":393,"column":8},"end":{"line":395,"column":9}}],"line":393},"102":{"loc":{"start":{"line":397,"column":8},"end":{"line":399,"column":9}},"type":"if","locations":[{"start":{"line":397,"column":8},"end":{"line":399,"column":9}},{"start":{"line":397,"column":8},"end":{"line":399,"column":9}}],"line":397},"103":{"loc":{"start":{"line":403,"column":12},"end":{"line":405,"column":13}},"type":"if","locations":[{"start":{"line":403,"column":12},"end":{"line":405,"column":13}},{"start":{"line":403,"column":12},"end":{"line":405,"column":13}}],"line":403},"104":{"loc":{"start":{"line":420,"column":8},"end":{"line":422,"column":9}},"type":"if","locations":[{"start":{"line":420,"column":8},"end":{"line":422,"column":9}},{"start":{"line":420,"column":8},"end":{"line":422,"column":9}}],"line":420},"105":{"loc":{"start":{"line":420,"column":14},"end":{"line":420,"column":80}},"type":"cond-expr","locations":[{"start":{"line":420,"column":53},"end":{"line":420,"column":59}},{"start":{"line":420,"column":62},"end":{"line":420,"column":80}}],"line":420},"106":{"loc":{"start":{"line":420,"column":14},"end":{"line":420,"column":50}},"type":"binary-expr","locations":[{"start":{"line":420,"column":14},"end":{"line":420,"column":29}},{"start":{"line":420,"column":33},"end":{"line":420,"column":50}}],"line":420},"107":{"loc":{"start":{"line":424,"column":8},"end":{"line":426,"column":9}},"type":"if","locations":[{"start":{"line":424,"column":8},"end":{"line":426,"column":9}},{"start":{"line":424,"column":8},"end":{"line":426,"column":9}}],"line":424},"108":{"loc":{"start":{"line":428,"column":8},"end":{"line":430,"column":9}},"type":"if","locations":[{"start":{"line":428,"column":8},"end":{"line":430,"column":9}},{"start":{"line":428,"column":8},"end":{"line":430,"column":9}}],"line":428},"109":{"loc":{"start":{"line":432,"column":8},"end":{"line":434,"column":9}},"type":"if","locations":[{"start":{"line":432,"column":8},"end":{"line":434,"column":9}},{"start":{"line":432,"column":8},"end":{"line":434,"column":9}}],"line":432},"110":{"loc":{"start":{"line":436,"column":8},"end":{"line":438,"column":9}},"type":"if","locations":[{"start":{"line":436,"column":8},"end":{"line":438,"column":9}},{"start":{"line":436,"column":8},"end":{"line":438,"column":9}}],"line":436},"111":{"loc":{"start":{"line":439,"column":8},"end":{"line":446,"column":9}},"type":"if","locations":[{"start":{"line":439,"column":8},"end":{"line":446,"column":9}},{"start":{"line":439,"column":8},"end":{"line":446,"column":9}}],"line":439},"112":{"loc":{"start":{"line":441,"column":12},"end":{"line":443,"column":13}},"type":"if","locations":[{"start":{"line":441,"column":12},"end":{"line":443,"column":13}},{"start":{"line":441,"column":12},"end":{"line":443,"column":13}}],"line":441},"113":{"loc":{"start":{"line":451,"column":8},"end":{"line":453,"column":9}},"type":"if","locations":[{"start":{"line":451,"column":8},"end":{"line":453,"column":9}},{"start":{"line":451,"column":8},"end":{"line":453,"column":9}}],"line":451},"114":{"loc":{"start":{"line":451,"column":14},"end":{"line":451,"column":80}},"type":"cond-expr","locations":[{"start":{"line":451,"column":53},"end":{"line":451,"column":59}},{"start":{"line":451,"column":62},"end":{"line":451,"column":80}}],"line":451},"115":{"loc":{"start":{"line":451,"column":14},"end":{"line":451,"column":50}},"type":"binary-expr","locations":[{"start":{"line":451,"column":14},"end":{"line":451,"column":29}},{"start":{"line":451,"column":33},"end":{"line":451,"column":50}}],"line":451},"116":{"loc":{"start":{"line":455,"column":8},"end":{"line":457,"column":9}},"type":"if","locations":[{"start":{"line":455,"column":8},"end":{"line":457,"column":9}},{"start":{"line":455,"column":8},"end":{"line":457,"column":9}}],"line":455},"117":{"loc":{"start":{"line":459,"column":8},"end":{"line":461,"column":9}},"type":"if","locations":[{"start":{"line":459,"column":8},"end":{"line":461,"column":9}},{"start":{"line":459,"column":8},"end":{"line":461,"column":9}}],"line":459},"118":{"loc":{"start":{"line":463,"column":8},"end":{"line":465,"column":9}},"type":"if","locations":[{"start":{"line":463,"column":8},"end":{"line":465,"column":9}},{"start":{"line":463,"column":8},"end":{"line":465,"column":9}}],"line":463},"119":{"loc":{"start":{"line":467,"column":8},"end":{"line":469,"column":9}},"type":"if","locations":[{"start":{"line":467,"column":8},"end":{"line":469,"column":9}},{"start":{"line":467,"column":8},"end":{"line":469,"column":9}}],"line":467},"120":{"loc":{"start":{"line":478,"column":16},"end":{"line":478,"column":26}},"type":"default-arg","locations":[{"start":{"line":478,"column":24},"end":{"line":478,"column":26}}],"line":478},"121":{"loc":{"start":{"line":479,"column":8},"end":{"line":486,"column":9}},"type":"if","locations":[{"start":{"line":479,"column":8},"end":{"line":486,"column":9}},{"start":{"line":479,"column":8},"end":{"line":486,"column":9}}],"line":479},"122":{"loc":{"start":{"line":481,"column":12},"end":{"line":483,"column":13}},"type":"if","locations":[{"start":{"line":481,"column":12},"end":{"line":483,"column":13}},{"start":{"line":481,"column":12},"end":{"line":483,"column":13}}],"line":481}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":5,"13":5,"14":1,"15":4,"16":0,"17":4,"18":4,"19":3,"20":1,"21":48,"22":48,"23":48,"24":48,"25":48,"26":4,"27":4,"28":48,"29":5,"30":5,"31":48,"32":9,"33":39,"34":39,"35":39,"36":39,"37":39,"38":39,"39":3,"40":39,"41":39,"42":3,"43":39,"44":39,"45":39,"46":2,"47":37,"48":18,"49":18,"50":19,"51":8,"52":1,"53":7,"54":4,"55":4,"56":2,"57":2,"58":3,"59":3,"60":3,"61":3,"62":3,"63":3,"64":3,"65":3,"66":2,"67":14,"68":14,"69":0,"70":14,"71":14,"72":1,"73":13,"74":2,"75":1,"76":1,"77":1,"78":11,"79":2,"80":2,"81":1,"82":1,"83":1,"84":1,"85":1,"86":1,"87":1,"88":9,"89":9,"90":2,"91":18,"92":18,"93":8,"94":8,"95":8,"96":1,"97":7,"98":7,"99":10,"100":10,"101":1,"102":9,"103":9,"104":9,"105":1,"106":8,"107":8,"108":8,"109":8,"110":3,"111":5,"112":5,"113":5,"114":5,"115":2,"116":5,"117":5,"118":3,"119":2,"120":2,"121":2,"122":2,"123":2,"124":0,"125":2,"126":2,"127":2,"128":2,"129":2,"130":2,"131":2,"132":8,"133":2,"134":4,"135":2,"136":2,"137":2,"138":2,"139":0,"140":0,"141":0,"142":2,"143":2,"144":2,"145":2,"146":2,"147":2,"148":1,"149":2,"150":2,"151":2,"152":2,"153":2,"154":2,"155":1,"156":6,"157":6,"158":6,"159":1,"160":5,"161":5,"162":1,"163":4,"164":4,"165":1,"166":3,"167":2,"168":2,"169":1,"170":1,"171":1,"172":1,"173":8,"174":8,"175":8,"176":1,"177":7,"178":7,"179":1,"180":6,"181":6,"182":1,"183":5,"184":3,"185":5,"186":3,"187":3,"188":1,"189":2,"190":2,"191":1,"192":1,"193":1,"194":2,"195":1,"196":1,"197":5,"198":5,"199":5,"200":1,"201":4,"202":4,"203":1,"204":3,"205":3,"206":0,"207":3,"208":3,"209":3,"210":3,"211":2,"212":2,"213":1,"214":1,"215":1,"216":1,"217":3,"218":3,"219":3,"220":1,"221":2,"222":2,"223":1,"224":1,"225":1,"226":11,"227":11,"228":11,"229":3,"230":8,"231":8,"232":2,"233":6,"234":6,"235":3,"236":3,"237":6,"238":4,"239":2,"240":2,"241":3,"242":3,"243":3,"244":1,"245":2,"246":1,"247":1,"248":1,"249":0,"250":1,"251":1,"252":6,"253":6,"254":6,"255":1,"256":5,"257":5,"258":1,"259":4,"260":4,"261":1,"262":3,"263":5,"264":5,"265":5,"266":1,"267":4,"268":4,"269":1,"270":3,"271":3,"272":2,"273":2,"274":0,"275":2,"276":2,"277":1,"278":2,"279":2,"280":1,"281":2,"282":8,"283":8,"284":1,"285":7,"286":7,"287":1,"288":6,"289":6,"290":1,"291":5,"292":5,"293":1,"294":4,"295":4,"296":1,"297":3,"298":2,"299":2,"300":1,"301":1,"302":1,"303":1,"304":7,"305":7,"306":1,"307":6,"308":6,"309":1,"310":5,"311":5,"312":1,"313":4,"314":4,"315":1,"316":3,"317":3,"318":0,"319":3,"320":3,"321":3,"322":3,"323":2,"324":2,"325":1,"326":1,"327":1,"328":1,"329":110},"f":{"0":1,"1":5,"2":48,"3":2,"4":18,"5":2,"6":2,"7":8,"8":4,"9":2,"10":2,"11":2,"12":1,"13":2,"14":6,"15":8,"16":3,"17":5,"18":3,"19":11,"20":3,"21":6,"22":5,"23":2,"24":2,"25":1,"26":2,"27":1,"28":8,"29":7,"30":110},"b":{"0":[1],"1":[4],"2":[1,4],"3":[0,4],"4":[3,1],"5":[4,2],"6":[48,18],"7":[4,44],"8":[41,7],"9":[48,48],"10":[4,3],"11":[0,3],"12":[3,3],"13":[5,43],"14":[41,7],"15":[48,48],"16":[5,4],"17":[0,4],"18":[4,4],"19":[9,39],"20":[48,34,18],"21":[8,31],"22":[8,31],"23":[3,36],"24":[3,36],"25":[39,3],"26":[39,3],"27":[2,37],"28":[39,37],"29":[18,19],"30":[8,11],"31":[19,12],"32":[1,7],"33":[4,3],"34":[4,2],"35":[2,2],"36":[3,0],"37":[14,3],"38":[0,14],"39":[1,13],"40":[14,12],"41":[2,11],"42":[1,1],"43":[2,9],"44":[11,7],"45":[1,1],"46":[2,7],"47":[8,10],"48":[1,7],"49":[1,9],"50":[9,9,1],"51":[1,8],"52":[8,0],"53":[3,5],"54":[3,2],"55":[2,3],"56":[5,2],"57":[3,2],"58":[0,2],"59":[2,0],"60":[1,1],"61":[8,6],"62":[0,2],"63":[0,0],"64":[2,0],"65":[1,1],"66":[1,5],"67":[1,4],"68":[1,3],"69":[2,1],"70":[1,1],"71":[1,7],"72":[1,6],"73":[1,5],"74":[2,3],"75":[5,5],"76":[3,3],"77":[3,2],"78":[1,2],"79":[1,1],"80":[1,1],"81":[1,4],"82":[1,3],"83":[0,3],"84":[1],"85":[2,1],"86":[1,1],"87":[1,2],"88":[1,1],"89":[3,8],"90":[2,6],"91":[3,3],"92":[6,5],"93":[4,2],"94":[1,2],"95":[1,1],"96":[0,1],"97":[1,5],"98":[1,4],"99":[1,3],"100":[3],"101":[1,4],"102":[1,3],"103":[0,2],"104":[1,7],"105":[1,7],"106":[8,8],"107":[1,6],"108":[1,5],"109":[1,4],"110":[1,3],"111":[2,1],"112":[1,1],"113":[1,6],"114":[1,6],"115":[7,7],"116":[1,5],"117":[1,4],"118":[1,3],"119":[0,3],"120":[1],"121":[2,1],"122":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/receiver/RoomServiceReceiver.ts"],"sourcesContent":["// TODO: Refactor this file splitting it into smaller files + removing the complexity of the most important method (changeMembership)\nimport { RoomType } from '@rocket.chat/apps-engine/definition/rooms';\nimport { isDirectMessageRoom, isQuoteAttachment } from '@rocket.chat/core-typings';\n\nimport { DirectMessageFederatedRoom, FederatedRoom } from '../../../domain/FederatedRoom';\nimport { FederatedUser } from '../../../domain/FederatedUser';\nimport { EVENT_ORIGIN } from '../../../domain/IFederationBridge';\nimport type { IFederationBridge } from '../../../domain/IFederationBridge';\nimport { removeExternalSpecificCharsFromExternalIdentifier } from '../../../infrastructure/matrix/converters/room/RoomReceiver';\nimport type { InMemoryQueue } from '../../../infrastructure/queue/InMemoryQueue';\nimport type { RocketChatFileAdapter } from '../../../infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatMessageAdapter } from '../../../infrastructure/rocket-chat/adapters/Message';\nimport type { RocketChatNotificationAdapter } from '../../../infrastructure/rocket-chat/adapters/Notification';\nimport type { RocketChatRoomAdapter } from '../../../infrastructure/rocket-chat/adapters/Room';\nimport type { RocketChatSettingsAdapter } from '../../../infrastructure/rocket-chat/adapters/Settings';\nimport type { RocketChatUserAdapter } from '../../../infrastructure/rocket-chat/adapters/User';\nimport { AbstractFederationApplicationService } from '../../AbstractFederationApplicationService';\nimport type {\n\tFederationRoomCreateInputDto,\n\tFederationRoomChangeMembershipDto,\n\tFederationRoomReceiveExternalMessageDto,\n\tFederationRoomChangeJoinRulesDto,\n\tFederationRoomChangeNameDto,\n\tFederationRoomChangeTopicDto,\n\tFederationRoomReceiveExternalFileMessageDto,\n\tFederationRoomRedactEventDto,\n\tFederationRoomEditExternalMessageDto,\n\tFederationRoomRoomChangePowerLevelsEventDto,\n} from '../input/RoomReceiverDto';\nimport { getMessageRedactionHandler } from '../message/receiver/message-redaction-helper';\n\nexport class FederationRoomServiceReceiver extends AbstractFederationApplicationService {\n\tconstructor(\n\t\tprotected internalRoomAdapter: RocketChatRoomAdapter,\n\t\tprotected internalUserAdapter: RocketChatUserAdapter,\n\t\tprotected internalMessageAdapter: RocketChatMessageAdapter,\n\t\tprotected internalFileAdapter: RocketChatFileAdapter,\n\t\tprotected internalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tprotected internalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tprotected federationQueueInstance: InMemoryQueue,\n\t\tprotected bridge: IFederationBridge,\n\t) {\n\t\tsuper(bridge, internalUserAdapter, internalFileAdapter, internalSettingsAdapter);\n\t}\n\n\tpublic async onCreateRoom(roomCreateInput: FederationRoomCreateInputDto): Promise<void> {\n\t\tconst { externalRoomId, wasInternallyProgramaticallyCreated = false, internalRoomId = '' } = roomCreateInput;\n\t\tif (await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId)) {\n\t\t\treturn;\n\t\t}\n\t\tif (!wasInternallyProgramaticallyCreated) {\n\t\t\treturn;\n\t\t}\n\t\tconst room = await this.internalRoomAdapter.getInternalRoomById(internalRoomId);\n\t\tif (!room || !isDirectMessageRoom(room)) {\n\t\t\treturn;\n\t\t}\n\t\tawait this.internalRoomAdapter.updateFederatedRoomByInternalRoomId(internalRoomId, externalRoomId);\n\t}\n\n\tpublic async onChangeRoomMembership(roomChangeMembershipInput: FederationRoomChangeMembershipDto): Promise<void> {\n\t\tconst {\n\t\t\texternalRoomId,\n\t\t\tnormalizedInviteeId,\n\t\t\tnormalizedRoomId,\n\t\t\tnormalizedInviterId,\n\t\t\texternalInviteeId,\n\t\t\texternalInviterId,\n\t\t\tinviteeUsernameOnly,\n\t\t\tinviterUsernameOnly,\n\t\t\teventOrigin,\n\t\t\troomType,\n\t\t\tleave,\n\t\t\tuserProfile,\n\t\t\tallInviteesExternalIdsWhenDM,\n\t\t\texternalRoomName,\n\t\t\texternalEventId,\n\t\t} = roomChangeMembershipInput;\n\t\tconst wasGeneratedOnTheProxyServer = eventOrigin === EVENT_ORIGIN.LOCAL;\n\t\tconst affectedFederatedRoom = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tconst isUserJoiningByHimself = externalInviterId === externalInviteeId && !leave;\n\n\t\tif (userProfile?.avatarUrl) {\n\t\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalInviteeId);\n\t\t\tfederatedUser && (await this.updateUserAvatarInternally(federatedUser, userProfile?.avatarUrl));\n\t\t}\n\t\tif (userProfile?.displayName) {\n\t\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalInviteeId);\n\t\t\tfederatedUser && (await this.updateUserDisplayNameInternally(federatedUser, userProfile?.displayName));\n\t\t}\n\n\t\tif (wasGeneratedOnTheProxyServer && !isUserJoiningByHimself && !affectedFederatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isInviterFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(externalInviterId),\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t\tconst isInviteeFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(externalInviteeId),\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t\tconst inviterUsername = isInviterFromTheSameHomeServer ? inviterUsernameOnly : normalizedInviterId;\n\t\tconst inviteeUsername = isInviteeFromTheSameHomeServer ? inviteeUsernameOnly : normalizedInviteeId;\n\n\t\tconst inviterUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalInviterId);\n\t\tif (!inviterUser) {\n\t\t\tawait this.createFederatedUserInternallyOnly(externalInviterId, inviterUsername, isInviterFromTheSameHomeServer);\n\t\t}\n\n\t\tconst inviteeUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalInviteeId);\n\t\tif (!inviteeUser) {\n\t\t\tawait this.createFederatedUserInternallyOnly(externalInviteeId, inviteeUsername, isInviteeFromTheSameHomeServer);\n\t\t}\n\t\tconst federatedInviteeUser = inviteeUser || (await this.internalUserAdapter.getFederatedUserByExternalId(externalInviteeId));\n\t\tconst federatedInviterUser = inviterUser || (await this.internalUserAdapter.getFederatedUserByExternalId(externalInviterId));\n\n\t\tif (!federatedInviteeUser || !federatedInviterUser) {\n\t\t\tthrow new Error('Invitee or inviter user not found');\n\t\t}\n\n\t\tif (isUserJoiningByHimself) {\n\t\t\tawait this.whenUserIsJoiningByHimself(externalRoomId, normalizedRoomId, federatedInviterUser, federatedInviteeUser);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!wasGeneratedOnTheProxyServer && !affectedFederatedRoom) {\n\t\t\tif (!roomType) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isDirectMessageRoom({ t: roomType })) {\n\t\t\t\tconst wereAllInviteesProvidedByCreationalEventAtOnce = allInviteesExternalIdsWhenDM && allInviteesExternalIdsWhenDM.length > 0;\n\t\t\t\tif (wereAllInviteesProvidedByCreationalEventAtOnce) {\n\t\t\t\t\treturn this.handleDMRoomInviteWhenAllUsersWereBeingProvidedInTheCreationalEvent(\n\t\t\t\t\t\tallInviteesExternalIdsWhenDM,\n\t\t\t\t\t\texternalRoomId,\n\t\t\t\t\t\tfederatedInviterUser,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn this.handleDMRoomInviteWhenNotifiedByRegularEventsOnly(federatedInviteeUser, federatedInviterUser, externalRoomId);\n\t\t\t}\n\n\t\t\tconst newFederatedRoom = FederatedRoom.createInstance(externalRoomId, normalizedRoomId, federatedInviterUser, roomType);\n\t\t\tconst createdInternalRoomId = await this.internalRoomAdapter.createFederatedRoom(newFederatedRoom);\n\n\t\t\tawait this.bridge.joinRoom(externalRoomId, externalInviteeId);\n\t\t\tif (externalRoomName) {\n\t\t\t\tawait this.onChangeRoomName({\n\t\t\t\t\texternalRoomId,\n\t\t\t\t\tnormalizedRoomName: externalRoomName,\n\t\t\t\t\texternalEventId,\n\t\t\t\t\texternalSenderId: externalInviterId,\n\t\t\t\t\tnormalizedRoomId,\n\t\t\t\t});\n\t\t\t}\n\t\t\tawait this.internalNotificationAdapter.subscribeToUserTypingEventsOnFederatedRoomId(\n\t\t\t\tcreatedInternalRoomId,\n\t\t\t\tthis.internalNotificationAdapter.broadcastUserTypingOnRoom.bind(this.internalNotificationAdapter),\n\t\t\t);\n\t\t\tconst roomHistoricalJoinEvents = await this.bridge.getRoomHistoricalJoinEvents(externalRoomId, externalInviteeId, [\n\t\t\t\texternalInviterId,\n\t\t\t\texternalInviteeId,\n\t\t\t]);\n\t\t\troomHistoricalJoinEvents.forEach((event) => this.federationQueueInstance.addToQueue(event));\n\t\t}\n\n\t\tconst federatedRoom = affectedFederatedRoom || (await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId));\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst inviteeAlreadyJoinedTheInternalRoom = await this.internalRoomAdapter.isUserAlreadyJoined(\n\t\t\tfederatedRoom.getInternalId(),\n\t\t\tfederatedInviteeUser.getInternalId(),\n\t\t);\n\t\tif (!leave && inviteeAlreadyJoinedTheInternalRoom) {\n\t\t\treturn;\n\t\t}\n\t\tif (leave) {\n\t\t\tif (!inviteeAlreadyJoinedTheInternalRoom) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.internalRoomAdapter.removeUserFromRoom(federatedRoom, federatedInviteeUser, federatedInviterUser);\n\t\t\treturn;\n\t\t}\n\t\tif (!wasGeneratedOnTheProxyServer && federatedRoom.isDirectMessage()) {\n\t\t\tconst directMessageRoom = federatedRoom as DirectMessageFederatedRoom;\n\t\t\tif (directMessageRoom.isUserPartOfTheRoom(federatedInviteeUser)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tdirectMessageRoom.addMember(federatedInviteeUser);\n\t\t\tconst newFederatedRoom = DirectMessageFederatedRoom.createInstance(\n\t\t\t\texternalRoomId,\n\t\t\t\tfederatedInviterUser,\n\t\t\t\tdirectMessageRoom.getMembers(),\n\t\t\t);\n\t\t\tawait this.internalRoomAdapter.removeDirectMessageRoom(federatedRoom);\n\t\t\tconst createdInternalRoomId = await this.internalRoomAdapter.createFederatedRoomForDirectMessage(newFederatedRoom);\n\t\t\tawait this.internalNotificationAdapter.subscribeToUserTypingEventsOnFederatedRoomId(\n\t\t\t\tcreatedInternalRoomId,\n\t\t\t\tthis.internalNotificationAdapter.broadcastUserTypingOnRoom.bind(this.internalNotificationAdapter),\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tawait this.internalRoomAdapter.addUserToRoom(federatedRoom, federatedInviteeUser, federatedInviterUser);\n\t\tif (isInviteeFromTheSameHomeServer) {\n\t\t\tawait this.bridge.joinRoom(externalRoomId, externalInviteeId);\n\t\t}\n\t}\n\n\tprivate async whenUserIsJoiningByHimself(\n\t\texternalRoomId: string,\n\t\tnormalizedRoomId: string,\n\t\tfederatedInviterUser: FederatedUser,\n\t\tfederatedInviteeUser: FederatedUser,\n\t): Promise<void> {\n\t\tconst room = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (room) {\n\t\t\tawait this.internalNotificationAdapter.subscribeToUserTypingEventsOnFederatedRoomId(\n\t\t\t\troom.getInternalId(),\n\t\t\t\tthis.internalNotificationAdapter.broadcastUserTypingOnRoom.bind(this.internalNotificationAdapter),\n\t\t\t);\n\t\t\tconst inviteeAlreadyJoinedTheInternalRoom = await this.internalRoomAdapter.isUserAlreadyJoined(\n\t\t\t\troom.getInternalId(),\n\t\t\t\tfederatedInviteeUser.getInternalId(),\n\t\t\t);\n\t\t\tif (inviteeAlreadyJoinedTheInternalRoom) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.internalRoomAdapter.addUserToRoom(room, federatedInviteeUser);\n\t\t\treturn;\n\t\t}\n\n\t\tconst externalRoomData = await this.bridge.getRoomData(federatedInviterUser.getExternalId(), externalRoomId);\n\t\tif (!externalRoomData) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst creatorUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalRoomData.creator.id);\n\t\tconst roomCreationProcessIsRunningLocallyAlready =\n\t\t\t!room && creatorUser && federatedInviterUser.getInternalId() === creatorUser.getInternalId();\n\t\tif (roomCreationProcessIsRunningLocallyAlready) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!creatorUser) {\n\t\t\tawait this.createFederatedUserAndReturnIt(externalRoomData.creator.id, externalRoomData.creator.username);\n\t\t}\n\t\tconst federatedCreatorUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalRoomData.creator.id);\n\t\tif (!federatedCreatorUser) {\n\t\t\treturn;\n\t\t}\n\t\tconst isRoomFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(externalRoomId),\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t\tconst newFederatedRoom = FederatedRoom.createInstance(\n\t\t\texternalRoomId,\n\t\t\tnormalizedRoomId,\n\t\t\tfederatedCreatorUser,\n\t\t\tRoomType.CHANNEL,\n\t\t\tisRoomFromTheSameHomeServer ? externalRoomData.name : undefined,\n\t\t);\n\t\tconst createdInternalRoomId = await this.internalRoomAdapter.createFederatedRoom(newFederatedRoom);\n\t\tif (!isRoomFromTheSameHomeServer && externalRoomData.name) {\n\t\t\tawait this.onChangeRoomName({\n\t\t\t\texternalRoomId,\n\t\t\t\tnormalizedRoomName: externalRoomData.name,\n\t\t\t\texternalEventId: '',\n\t\t\t\texternalSenderId: federatedCreatorUser.getExternalId(),\n\t\t\t\tnormalizedRoomId,\n\t\t\t});\n\t\t}\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\t\t// Do not need to await this, this can be done in parallel\n\t\tvoid this.createFederatedUsersForRoomMembers(\n\t\t\tfederatedRoom,\n\t\t\texternalRoomData.joinedMembers,\n\t\t\texternalRoomData.creator.id,\n\t\t\tfederatedInviteeUser.getExternalId(),\n\t\t);\n\t\tawait this.internalNotificationAdapter.subscribeToUserTypingEventsOnFederatedRoomId(\n\t\t\tcreatedInternalRoomId,\n\t\t\tthis.internalNotificationAdapter.broadcastUserTypingOnRoom.bind(this.internalNotificationAdapter),\n\t\t);\n\t\tawait this.internalRoomAdapter.addUserToRoom(federatedRoom, federatedInviteeUser);\n\t}\n\n\tprivate async createFederatedUserAndReturnIt(externalUserId: string, externalUsername?: string): Promise<FederatedUser> {\n\t\tconst user = await this.internalUserAdapter.getFederatedUserByExternalId(externalUserId);\n\t\tif (user) {\n\t\t\treturn user;\n\t\t}\n\t\tconst isUserFromTheSameHomeserver = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(externalUserId),\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t\tconst existsOnlyOnProxyServer = isUserFromTheSameHomeserver;\n\t\tconst localUsername = externalUsername || removeExternalSpecificCharsFromExternalIdentifier(externalUserId);\n\t\tconst username = isUserFromTheSameHomeserver ? localUsername : removeExternalSpecificCharsFromExternalIdentifier(externalUserId); // TODO: move these common functions to a proper layer\n\t\tawait this.createFederatedUserInternallyOnly(externalUserId, username, existsOnlyOnProxyServer);\n\n\t\treturn (await this.internalUserAdapter.getFederatedUserByExternalId(externalUserId)) as FederatedUser;\n\t}\n\n\tprivate async createFederatedUsersForRoomMembers(\n\t\tfederatedRoom: FederatedRoom,\n\t\texternalMembersExternalIds: string[],\n\t\tcreatorExternalId: string,\n\t\tmyselfExternalId: string,\n\t): Promise<void> {\n\t\tconst membersExcludingOnesInvolvedInTheCreationProcess = externalMembersExternalIds.filter(\n\t\t\t(externalMemberId) => externalMemberId !== creatorExternalId && externalMemberId !== myselfExternalId,\n\t\t);\n\n\t\tconst federatedUsers = await Promise.all(\n\t\t\tmembersExcludingOnesInvolvedInTheCreationProcess.map((externalMemberId) => this.createFederatedUserAndReturnIt(externalMemberId)),\n\t\t);\n\t\tawait this.internalRoomAdapter.addUsersToRoomWhenJoinExternalPublicRoom(\n\t\t\tfederatedUsers.filter(Boolean) as FederatedUser[],\n\t\t\tfederatedRoom,\n\t\t);\n\t}\n\n\tprivate async handleDMRoomInviteWhenAllUsersWereBeingProvidedInTheCreationalEvent(\n\t\tallInviteesExternalIds: {\n\t\t\texternalInviteeId: string;\n\t\t\tnormalizedInviteeId: string;\n\t\t\tinviteeUsernameOnly: string;\n\t\t}[],\n\t\texternalRoomId: string,\n\t\tfederatedInviterUser: FederatedUser,\n\t): Promise<void> {\n\t\tconst allInvitees = await Promise.all(\n\t\t\tallInviteesExternalIds.map(async (dmExternalInviteeId) => {\n\t\t\t\tconst invitee = await this.internalUserAdapter.getFederatedUserByExternalId(dmExternalInviteeId.externalInviteeId);\n\t\t\t\tif (!invitee) {\n\t\t\t\t\tconst isDMInviteeFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\t\t\t\tthis.bridge.extractHomeserverOrigin(dmExternalInviteeId.externalInviteeId),\n\t\t\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t\t\t);\n\t\t\t\t\tconst dmInviteeUsername = isDMInviteeFromTheSameHomeServer\n\t\t\t\t\t\t? dmExternalInviteeId.inviteeUsernameOnly\n\t\t\t\t\t\t: dmExternalInviteeId.normalizedInviteeId;\n\t\t\t\t\tawait this.createFederatedUserInternallyOnly(\n\t\t\t\t\t\tdmExternalInviteeId.externalInviteeId,\n\t\t\t\t\t\tdmInviteeUsername,\n\t\t\t\t\t\tisDMInviteeFromTheSameHomeServer,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn (invitee ||\n\t\t\t\t\t(await this.internalUserAdapter.getFederatedUserByExternalId(dmExternalInviteeId.externalInviteeId))) as FederatedUser;\n\t\t\t}),\n\t\t);\n\t\tconst newFederatedRoom = DirectMessageFederatedRoom.createInstance(externalRoomId, federatedInviterUser, [\n\t\t\tfederatedInviterUser,\n\t\t\t...allInvitees,\n\t\t]);\n\t\tconst createdInternalRoomId = await this.internalRoomAdapter.createFederatedRoomForDirectMessage(newFederatedRoom);\n\t\tawait this.internalNotificationAdapter.subscribeToUserTypingEventsOnFederatedRoomId(\n\t\t\tcreatedInternalRoomId,\n\t\t\tthis.internalNotificationAdapter.broadcastUserTypingOnRoom.bind(this.internalNotificationAdapter),\n\t\t);\n\t\tawait Promise.all(\n\t\t\tallInvitees\n\t\t\t\t.filter((invitee) =>\n\t\t\t\t\tFederatedUser.isOriginalFromTheProxyServer(\n\t\t\t\t\t\tthis.bridge.extractHomeserverOrigin(invitee.getExternalId()),\n\t\t\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t\t\t),\n\t\t\t\t)\n\t\t\t\t.map((invitee) => this.bridge.joinRoom(externalRoomId, invitee.getExternalId())),\n\t\t);\n\t}\n\n\tprivate async handleDMRoomInviteWhenNotifiedByRegularEventsOnly(\n\t\tfederatedInviteeUser: FederatedUser,\n\t\tfederatedInviterUser: FederatedUser,\n\t\texternalRoomId: string,\n\t): Promise<void> {\n\t\tconst members = [federatedInviterUser, federatedInviteeUser];\n\t\tconst newFederatedRoom = DirectMessageFederatedRoom.createInstance(externalRoomId, federatedInviterUser, members);\n\t\tconst createdInternalRoomId = await this.internalRoomAdapter.createFederatedRoomForDirectMessage(newFederatedRoom);\n\t\tconst isInviteeFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(federatedInviteeUser.getExternalId()),\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t\tawait this.internalNotificationAdapter.subscribeToUserTypingEventsOnFederatedRoomId(\n\t\t\tcreatedInternalRoomId,\n\t\t\tthis.internalNotificationAdapter.broadcastUserTypingOnRoom.bind(this.internalNotificationAdapter),\n\t\t);\n\t\tif (isInviteeFromTheSameHomeServer) {\n\t\t\tawait this.bridge.joinRoom(externalRoomId, federatedInviteeUser.getExternalId());\n\t\t}\n\t}\n\n\tpublic async onExternalMessageReceived(roomReceiveExternalMessageInput: FederationRoomReceiveExternalMessageDto): Promise<void> {\n\t\tconst { externalRoomId, externalSenderId, rawMessage, externalFormattedText, externalEventId, replyToEventId } =\n\t\t\troomReceiveExternalMessageInput;\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst senderUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalSenderId);\n\t\tif (!senderUser) {\n\t\t\treturn;\n\t\t}\n\t\tconst message = await this.internalMessageAdapter.getMessageByFederationId(externalEventId);\n\t\tif (message) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (replyToEventId) {\n\t\t\tconst messageToReplyTo = await this.internalMessageAdapter.getMessageByFederationId(replyToEventId);\n\t\t\tif (!messageToReplyTo) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.internalMessageAdapter.sendQuoteMessage(\n\t\t\t\tsenderUser,\n\t\t\t\tfederatedRoom,\n\t\t\t\texternalFormattedText,\n\t\t\t\trawMessage,\n\t\t\t\texternalEventId,\n\t\t\t\tmessageToReplyTo,\n\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.internalMessageAdapter.sendMessage(\n\t\t\tsenderUser,\n\t\t\tfederatedRoom,\n\t\t\trawMessage,\n\t\t\texternalFormattedText,\n\t\t\texternalEventId,\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t}\n\n\tpublic async onExternalMessageEditedReceived(roomEditExternalMessageInput: FederationRoomEditExternalMessageDto): Promise<void> {\n\t\tconst { externalRoomId, externalSenderId, editsEvent, newExternalFormattedText, newRawMessage } = roomEditExternalMessageInput;\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst senderUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalSenderId);\n\t\tif (!senderUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst message = await this.internalMessageAdapter.getMessageByFederationId(editsEvent);\n\t\tif (!message) {\n\t\t\treturn;\n\t\t}\n\n\t\t// TODO: leaked business logic, move this to its proper place\n\t\tconst isAQuotedMessage = message.attachments?.some((attachment) => isQuoteAttachment(attachment) && Boolean(attachment.message_link));\n\t\tif (isAQuotedMessage) {\n\t\t\tconst wasGeneratedLocally = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\t\tthis.bridge.extractHomeserverOrigin(externalSenderId),\n\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t);\n\t\t\tif (wasGeneratedLocally) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst internalFormattedMessageToBeEdited = await this.internalMessageAdapter.getMessageToEditWhenReplyAndQuote(\n\t\t\t\tmessage,\n\t\t\t\tnewExternalFormattedText,\n\t\t\t\tnewRawMessage,\n\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t\tsenderUser,\n\t\t\t);\n\t\t\t// TODO: create an entity to abstract all the message logic\n\t\t\tif (!FederatedRoom.shouldUpdateMessage(internalFormattedMessageToBeEdited, message)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.internalMessageAdapter.editQuotedMessage(\n\t\t\t\tsenderUser,\n\t\t\t\tnewRawMessage,\n\t\t\t\tnewExternalFormattedText,\n\t\t\t\tmessage,\n\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tif (!FederatedRoom.shouldUpdateMessage(newRawMessage, message)) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.internalMessageAdapter.editMessage(\n\t\t\tsenderUser,\n\t\t\tnewRawMessage,\n\t\t\tnewExternalFormattedText,\n\t\t\tmessage,\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t}\n\n\tpublic async onExternalFileMessageReceived(roomReceiveExternalMessageInput: FederationRoomReceiveExternalFileMessageDto): Promise<void> {\n\t\tconst { externalRoomId, externalSenderId, messageBody, externalEventId, replyToEventId } = roomReceiveExternalMessageInput;\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst senderUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalSenderId);\n\t\tif (!senderUser) {\n\t\t\treturn;\n\t\t}\n\t\tconst message = await this.internalMessageAdapter.getMessageByFederationId(externalEventId);\n\t\tif (message) {\n\t\t\treturn;\n\t\t}\n\t\tconst fileDetails = {\n\t\t\tname: messageBody.filename,\n\t\t\tsize: messageBody.size,\n\t\t\ttype: messageBody.mimetype,\n\t\t\trid: federatedRoom.getInternalId(),\n\t\t\tuserId: senderUser.getInternalId(),\n\t\t};\n\t\tconst readableStream = await this.bridge.getReadStreamForFileFromUrl(senderUser.getExternalId(), messageBody.url);\n\t\tconst { files = [], attachments } = await this.internalFileAdapter.uploadFile(\n\t\t\treadableStream,\n\t\t\tfederatedRoom.getInternalId(),\n\t\t\tsenderUser.getInternalReference(),\n\t\t\tfileDetails,\n\t\t);\n\n\t\tif (replyToEventId) {\n\t\t\tconst messageToReplyTo = await this.internalMessageAdapter.getMessageByFederationId(replyToEventId);\n\t\t\tif (!messageToReplyTo) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.internalMessageAdapter.sendQuoteFileMessage(\n\t\t\t\tsenderUser,\n\t\t\t\tfederatedRoom,\n\t\t\t\tfiles,\n\t\t\t\tattachments,\n\t\t\t\texternalEventId,\n\t\t\t\tmessageToReplyTo,\n\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.internalMessageAdapter.sendFileMessage(senderUser, federatedRoom, files, attachments, externalEventId);\n\t}\n\n\tpublic async onChangeJoinRules(roomJoinRulesChangeInput: FederationRoomChangeJoinRulesDto): Promise<void> {\n\t\tconst { externalRoomId, roomType } = roomJoinRulesChangeInput;\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst notAllowedChangeJoinRules = federatedRoom.isDirectMessage();\n\t\tif (notAllowedChangeJoinRules) {\n\t\t\treturn;\n\t\t}\n\n\t\tfederatedRoom.changeRoomType(roomType);\n\t\tawait this.internalRoomAdapter.updateRoomType(federatedRoom);\n\t}\n\n\tpublic async onChangeRoomName(roomChangeNameInput: FederationRoomChangeNameDto): Promise<void> {\n\t\tconst { externalRoomId, normalizedRoomName, externalSenderId } = roomChangeNameInput;\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalSenderId);\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\t\tconst shouldUseExternalRoomIdAsRoomName = !FederatedRoom.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(externalRoomId),\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t\tif (shouldUseExternalRoomIdAsRoomName && federatedRoom.shouldUpdateRoomName(externalRoomId)) {\n\t\t\tfederatedRoom.changeRoomName(externalRoomId);\n\t\t\tawait this.internalRoomAdapter.updateRoomName(federatedRoom);\n\t\t}\n\t\tif (!federatedRoom.shouldUpdateDisplayRoomName(normalizedRoomName)) {\n\t\t\treturn;\n\t\t}\n\n\t\tfederatedRoom.changeDisplayRoomName(normalizedRoomName);\n\n\t\tawait this.internalRoomAdapter.updateDisplayRoomName(federatedRoom, federatedUser);\n\t}\n\n\tpublic async onChangeRoomTopic(roomChangeTopicInput: FederationRoomChangeTopicDto): Promise<void> {\n\t\tconst { externalRoomId, roomTopic, externalSenderId } = roomChangeTopicInput;\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!federatedRoom.shouldUpdateRoomTopic(roomTopic)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalSenderId);\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tfederatedRoom.changeRoomTopic(roomTopic);\n\n\t\tawait this.internalRoomAdapter.updateRoomTopic(federatedRoom, federatedUser);\n\t}\n\n\tpublic async onRedactEvent(roomRedactEventInput: FederationRoomRedactEventDto): Promise<void> {\n\t\tconst { externalRoomId, redactsEvent, externalSenderId } = roomRedactEventInput;\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalSenderId);\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\t\tconst handler = await getMessageRedactionHandler(this.internalMessageAdapter, redactsEvent, federatedUser);\n\t\tif (!handler) {\n\t\t\treturn;\n\t\t}\n\t\tawait handler.handle();\n\t}\n\n\tpublic async onChangeRoomPowerLevels(roomPowerLevelsInput: FederationRoomRoomChangePowerLevelsEventDto): Promise<void> {\n\t\tconst { externalRoomId, roleChangesToApply = {}, externalSenderId } = roomPowerLevelsInput;\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUserWhoChangedThePermission = await this.internalUserAdapter.getFederatedUserByExternalId(externalSenderId);\n\t\tif (!federatedUserWhoChangedThePermission) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUsers = await this.internalUserAdapter.getFederatedUsersByExternalIds(Object.keys(roleChangesToApply));\n\n\t\tawait Promise.all(\n\t\t\tfederatedUsers.map((targetFederatedUser) => {\n\t\t\t\tconst changes = roleChangesToApply[targetFederatedUser.getExternalId()];\n\t\t\t\tif (!changes) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst rolesToRemove = changes.filter((change) => change.action === 'remove').map((change) => change.role);\n\t\t\t\tconst rolesToAdd = changes.filter((change) => change.action === 'add').map((change) => change.role);\n\n\t\t\t\treturn this.internalRoomAdapter.applyRoomRolesToUser({\n\t\t\t\t\tfederatedRoom,\n\t\t\t\t\ttargetFederatedUser,\n\t\t\t\t\tfromUser: federatedUserWhoChangedThePermission,\n\t\t\t\t\trolesToAdd,\n\t\t\t\t\trolesToRemove,\n\t\t\t\t\tnotifyChannel: true,\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\t}\n\n\tpublic async onExternalThreadedMessageReceived(roomReceiveExternalMessageInput: FederationRoomReceiveExternalMessageDto): Promise<void> {\n\t\tconst { externalRoomId, externalSenderId, rawMessage, externalFormattedText, externalEventId, replyToEventId, thread } =\n\t\t\troomReceiveExternalMessageInput;\n\t\tif (!thread?.rootEventId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst parentMessage = await this.internalMessageAdapter.getMessageByFederationId(thread.rootEventId);\n\t\tif (!parentMessage) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst senderUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalSenderId);\n\t\tif (!senderUser) {\n\t\t\treturn;\n\t\t}\n\t\tconst message = await this.internalMessageAdapter.getMessageByFederationId(externalEventId);\n\t\tif (message) {\n\t\t\treturn;\n\t\t}\n\t\tif (replyToEventId) {\n\t\t\tconst messageToReplyTo = await this.internalMessageAdapter.getMessageByFederationId(replyToEventId);\n\t\t\tif (!messageToReplyTo) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.internalMessageAdapter.sendThreadQuoteMessage(\n\t\t\t\tsenderUser,\n\t\t\t\tfederatedRoom,\n\t\t\t\trawMessage,\n\t\t\t\texternalEventId,\n\t\t\t\tmessageToReplyTo,\n\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t\tparentMessage._id,\n\t\t\t\texternalFormattedText,\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.internalMessageAdapter.sendThreadMessage(\n\t\t\tsenderUser,\n\t\t\tfederatedRoom,\n\t\t\trawMessage,\n\t\t\texternalEventId,\n\t\t\tparentMessage._id,\n\t\t\texternalFormattedText,\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t}\n\n\tpublic async onExternalThreadedFileMessageReceived(\n\t\troomReceiveExternalMessageInput: FederationRoomReceiveExternalFileMessageDto,\n\t): Promise<void> {\n\t\tconst { externalRoomId, externalSenderId, messageBody, externalEventId, replyToEventId, thread } = roomReceiveExternalMessageInput;\n\n\t\tif (!thread?.rootEventId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst parentMessage = await this.internalMessageAdapter.getMessageByFederationId(thread.rootEventId);\n\t\tif (!parentMessage) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst senderUser = await this.internalUserAdapter.getFederatedUserByExternalId(externalSenderId);\n\t\tif (!senderUser) {\n\t\t\treturn;\n\t\t}\n\t\tconst message = await this.internalMessageAdapter.getMessageByFederationId(externalEventId);\n\t\tif (message) {\n\t\t\treturn;\n\t\t}\n\t\tconst fileDetails = {\n\t\t\tname: messageBody.filename,\n\t\t\tsize: messageBody.size,\n\t\t\ttype: messageBody.mimetype,\n\t\t\trid: federatedRoom.getInternalId(),\n\t\t\tuserId: senderUser.getInternalId(),\n\t\t};\n\t\tconst readableStream = await this.bridge.getReadStreamForFileFromUrl(senderUser.getExternalId(), messageBody.url);\n\t\tconst { files = [], attachments } = await this.internalFileAdapter.uploadFile(\n\t\t\treadableStream,\n\t\t\tfederatedRoom.getInternalId(),\n\t\t\tsenderUser.getInternalReference(),\n\t\t\tfileDetails,\n\t\t);\n\n\t\tif (replyToEventId) {\n\t\t\tconst messageToReplyTo = await this.internalMessageAdapter.getMessageByFederationId(replyToEventId);\n\t\t\tif (!messageToReplyTo) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.internalMessageAdapter.sendThreadQuoteFileMessage(\n\t\t\t\tsenderUser,\n\t\t\t\tfederatedRoom,\n\t\t\t\tfiles,\n\t\t\t\tattachments,\n\t\t\t\texternalEventId,\n\t\t\t\tmessageToReplyTo,\n\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t\tparentMessage._id,\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.internalMessageAdapter.sendThreadFileMessage(\n\t\t\tsenderUser,\n\t\t\tfederatedRoom,\n\t\t\tfiles,\n\t\t\tattachments,\n\t\t\texternalEventId,\n\t\t\tparentMessage._id,\n\t\t);\n\t}\n}\n"],"names":["FederationRoomServiceReceiver","AbstractFederationApplicationService","onCreateRoom","roomCreateInput","externalRoomId","wasInternallyProgramaticallyCreated","internalRoomId","internalRoomAdapter","getFederatedRoomByExternalId","room","getInternalRoomById","isDirectMessageRoom","updateFederatedRoomByInternalRoomId","onChangeRoomMembership","roomChangeMembershipInput","normalizedInviteeId","normalizedRoomId","normalizedInviterId","externalInviteeId","externalInviterId","inviteeUsernameOnly","inviterUsernameOnly","eventOrigin","roomType","leave","userProfile","allInviteesExternalIdsWhenDM","externalRoomName","externalEventId","wasGeneratedOnTheProxyServer","EVENT_ORIGIN","LOCAL","affectedFederatedRoom","isUserJoiningByHimself","avatarUrl","federatedUser","internalUserAdapter","getFederatedUserByExternalId","updateUserAvatarInternally","displayName","updateUserDisplayNameInternally","isInviterFromTheSameHomeServer","FederatedUser","isOriginalFromTheProxyServer","bridge","extractHomeserverOrigin","internalHomeServerDomain","isInviteeFromTheSameHomeServer","inviterUsername","inviteeUsername","inviterUser","createFederatedUserInternallyOnly","inviteeUser","federatedInviteeUser","federatedInviterUser","Error","whenUserIsJoiningByHimself","t","wereAllInviteesProvidedByCreationalEventAtOnce","length","handleDMRoomInviteWhenAllUsersWereBeingProvidedInTheCreationalEvent","handleDMRoomInviteWhenNotifiedByRegularEventsOnly","newFederatedRoom","FederatedRoom","createInstance","createdInternalRoomId","createFederatedRoom","joinRoom","onChangeRoomName","normalizedRoomName","externalSenderId","internalNotificationAdapter","subscribeToUserTypingEventsOnFederatedRoomId","broadcastUserTypingOnRoom","bind","roomHistoricalJoinEvents","getRoomHistoricalJoinEvents","forEach","event","federationQueueInstance","addToQueue","federatedRoom","inviteeAlreadyJoinedTheInternalRoom","isUserAlreadyJoined","getInternalId","removeUserFromRoom","isDirectMessage","directMessageRoom","isUserPartOfTheRoom","addMember","DirectMessageFederatedRoom","getMembers","removeDirectMessageRoom","createFederatedRoomForDirectMessage","addUserToRoom","externalRoomData","getRoomData","getExternalId","creatorUser","creator","id","roomCreationProcessIsRunningLocallyAlready","createFederatedUserAndReturnIt","username","federatedCreatorUser","isRoomFromTheSameHomeServer","RoomType","CHANNEL","name","undefined","createFederatedUsersForRoomMembers","joinedMembers","externalUserId","externalUsername","user","isUserFromTheSameHomeserver","existsOnlyOnProxyServer","localUsername","removeExternalSpecificCharsFromExternalIdentifier","externalMembersExternalIds","creatorExternalId","myselfExternalId","membersExcludingOnesInvolvedInTheCreationProcess","filter","externalMemberId","federatedUsers","Promise","all","map","addUsersToRoomWhenJoinExternalPublicRoom","Boolean","allInviteesExternalIds","allInvitees","dmExternalInviteeId","invitee","isDMInviteeFromTheSameHomeServer","dmInviteeUsername","members","onExternalMessageReceived","roomReceiveExternalMessageInput","rawMessage","externalFormattedText","replyToEventId","senderUser","message","internalMessageAdapter","getMessageByFederationId","messageToReplyTo","sendQuoteMessage","sendMessage","onExternalMessageEditedReceived","roomEditExternalMessageInput","editsEvent","newExternalFormattedText","newRawMessage","isAQuotedMessage","attachments","some","attachment","isQuoteAttachment","message_link","wasGeneratedLocally","internalFormattedMessageToBeEdited","getMessageToEditWhenReplyAndQuote","shouldUpdateMessage","editQuotedMessage","editMessage","onExternalFileMessageReceived","messageBody","fileDetails","filename","size","type","mimetype","rid","userId","readableStream","getReadStreamForFileFromUrl","url","files","internalFileAdapter","uploadFile","getInternalReference","sendQuoteFileMessage","sendFileMessage","onChangeJoinRules","roomJoinRulesChangeInput","notAllowedChangeJoinRules","changeRoomType","updateRoomType","roomChangeNameInput","shouldUseExternalRoomIdAsRoomName","shouldUpdateRoomName","changeRoomName","updateRoomName","shouldUpdateDisplayRoomName","changeDisplayRoomName","updateDisplayRoomName","onChangeRoomTopic","roomChangeTopicInput","roomTopic","shouldUpdateRoomTopic","changeRoomTopic","updateRoomTopic","onRedactEvent","roomRedactEventInput","redactsEvent","handler","getMessageRedactionHandler","handle","onChangeRoomPowerLevels","roomPowerLevelsInput","roleChangesToApply","federatedUserWhoChangedThePermission","getFederatedUsersByExternalIds","Object","keys","targetFederatedUser","changes","rolesToRemove","change","action","role","rolesToAdd","applyRoomRolesToUser","fromUser","notifyChannel","onExternalThreadedMessageReceived","thread","rootEventId","parentMessage","sendThreadQuoteMessage","_id","sendThreadMessage","onExternalThreadedFileMessageReceived","sendThreadQuoteFileMessage","sendThreadFileMessage","constructor","internalSettingsAdapter"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/receiver/RoomServiceReceiver.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"1f737bd36a31b44168175bdc819341353423a513","contentHash":"5060f8291b1a755ebbc78c2d6846dbe55d1f746c86dde3063dbe014e4145fef9"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/receiver/message-redaction-helper.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/receiver/message-redaction-helper.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":42}},"3":{"start":{"line":11,"column":20},"end":{"line":11,"column":53}},"4":{"start":{"line":12,"column":27},"end":{"line":21,"column":1}},"5":{"start":{"line":14,"column":8},"end":{"line":14,"column":90}},"6":{"start":{"line":17,"column":8},"end":{"line":17,"column":61}},"7":{"start":{"line":18,"column":8},"end":{"line":18,"column":31}},"8":{"start":{"line":19,"column":8},"end":{"line":19,"column":43}},"9":{"start":{"line":22,"column":30},"end":{"line":40,"column":1}},"10":{"start":{"line":24,"column":34},"end":{"line":24,"column":108}},"11":{"start":{"line":25,"column":25},"end":{"line":28,"column":10}},"12":{"start":{"line":27,"column":12},"end":{"line":27,"column":1049}},"13":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"14":{"start":{"line":30,"column":12},"end":{"line":30,"column":19}},"15":{"start":{"line":32,"column":8},"end":{"line":32,"column":123}},"16":{"start":{"line":35,"column":8},"end":{"line":35,"column":61}},"17":{"start":{"line":36,"column":8},"end":{"line":36,"column":31}},"18":{"start":{"line":37,"column":8},"end":{"line":37,"column":43}},"19":{"start":{"line":38,"column":8},"end":{"line":38,"column":43}},"20":{"start":{"line":41,"column":35},"end":{"line":53,"column":1}},"21":{"start":{"line":42,"column":20},"end":{"line":42,"column":87}},"22":{"start":{"line":43,"column":32},"end":{"line":43,"column":122}},"23":{"start":{"line":44,"column":4},"end":{"line":46,"column":5}},"24":{"start":{"line":45,"column":8},"end":{"line":45,"column":15}},"25":{"start":{"line":47,"column":4},"end":{"line":49,"column":5}},"26":{"start":{"line":48,"column":8},"end":{"line":48,"column":117}},"27":{"start":{"line":50,"column":4},"end":{"line":52,"column":5}},"28":{"start":{"line":51,"column":8},"end":{"line":51,"column":88}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":4},"end":{"line":13,"column":5}},"loc":{"start":{"line":13,"column":19},"end":{"line":15,"column":5}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":4},"end":{"line":16,"column":5}},"loc":{"start":{"line":16,"column":63},"end":{"line":20,"column":5}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":23,"column":4},"end":{"line":23,"column":5}},"loc":{"start":{"line":23,"column":19},"end":{"line":33,"column":5}},"line":23},"4":{"name":"(anonymous_4)","decl":{"start":{"line":25,"column":72},"end":{"line":25,"column":73}},"loc":{"start":{"line":25,"column":79},"end":{"line":28,"column":9}},"line":25},"5":{"name":"(anonymous_5)","decl":{"start":{"line":34,"column":4},"end":{"line":34,"column":5}},"loc":{"start":{"line":34,"column":78},"end":{"line":39,"column":5}},"line":34},"6":{"name":"(anonymous_6)","decl":{"start":{"line":41,"column":35},"end":{"line":41,"column":36}},"loc":{"start":{"line":41,"column":96},"end":{"line":53,"column":1}},"line":41}},"branchMap":{"0":{"loc":{"start":{"line":25,"column":37},"end":{"line":25,"column":65}},"type":"binary-expr","locations":[{"start":{"line":25,"column":37},"end":{"line":25,"column":59}},{"start":{"line":25,"column":63},"end":{"line":25,"column":65}}],"line":25},"1":{"loc":{"start":{"line":27,"column":19},"end":{"line":27,"column":1048}},"type":"binary-expr","locations":[{"start":{"line":27,"column":19},"end":{"line":27,"column":566}},{"start":{"line":27,"column":571},"end":{"line":27,"column":1047}}],"line":27},"2":{"loc":{"start":{"line":27,"column":20},"end":{"line":27,"column":528}},"type":"cond-expr","locations":[{"start":{"line":27,"column":120},"end":{"line":27,"column":126}},{"start":{"line":27,"column":129},"end":{"line":27,"column":528}}],"line":27},"3":{"loc":{"start":{"line":27,"column":20},"end":{"line":27,"column":117}},"type":"binary-expr","locations":[{"start":{"line":27,"column":20},"end":{"line":27,"column":79}},{"start":{"line":27,"column":83},"end":{"line":27,"column":117}}],"line":27},"4":{"loc":{"start":{"line":27,"column":129},"end":{"line":27,"column":528}},"type":"cond-expr","locations":[{"start":{"line":27,"column":243},"end":{"line":27,"column":249}},{"start":{"line":27,"column":252},"end":{"line":27,"column":528}}],"line":27},"5":{"loc":{"start":{"line":27,"column":129},"end":{"line":27,"column":240}},"type":"binary-expr","locations":[{"start":{"line":27,"column":129},"end":{"line":27,"column":198}},{"start":{"line":27,"column":202},"end":{"line":27,"column":240}}],"line":27},"6":{"loc":{"start":{"line":27,"column":252},"end":{"line":27,"column":528}},"type":"cond-expr","locations":[{"start":{"line":27,"column":446},"end":{"line":27,"column":452}},{"start":{"line":27,"column":455},"end":{"line":27,"column":528}}],"line":27},"7":{"loc":{"start":{"line":27,"column":252},"end":{"line":27,"column":443}},"type":"binary-expr","locations":[{"start":{"line":27,"column":252},"end":{"line":27,"column":374}},{"start":{"line":27,"column":378},"end":{"line":27,"column":443}}],"line":27},"8":{"loc":{"start":{"line":27,"column":571},"end":{"line":27,"column":1047}},"type":"cond-expr","locations":[{"start":{"line":27,"column":673},"end":{"line":27,"column":679}},{"start":{"line":27,"column":682},"end":{"line":27,"column":1047}}],"line":27},"9":{"loc":{"start":{"line":27,"column":571},"end":{"line":27,"column":670}},"type":"binary-expr","locations":[{"start":{"line":27,"column":571},"end":{"line":27,"column":631}},{"start":{"line":27,"column":635},"end":{"line":27,"column":670}}],"line":27},"10":{"loc":{"start":{"line":27,"column":682},"end":{"line":27,"column":1047}},"type":"cond-expr","locations":[{"start":{"line":27,"column":799},"end":{"line":27,"column":805}},{"start":{"line":27,"column":808},"end":{"line":27,"column":1047}}],"line":27},"11":{"loc":{"start":{"line":27,"column":682},"end":{"line":27,"column":796}},"type":"binary-expr","locations":[{"start":{"line":27,"column":682},"end":{"line":27,"column":753}},{"start":{"line":27,"column":757},"end":{"line":27,"column":796}}],"line":27},"12":{"loc":{"start":{"line":27,"column":808},"end":{"line":27,"column":1047}},"type":"cond-expr","locations":[{"start":{"line":27,"column":952},"end":{"line":27,"column":958}},{"start":{"line":27,"column":961},"end":{"line":27,"column":1047}}],"line":27},"13":{"loc":{"start":{"line":27,"column":808},"end":{"line":27,"column":949}},"type":"binary-expr","locations":[{"start":{"line":27,"column":808},"end":{"line":27,"column":897}},{"start":{"line":27,"column":901},"end":{"line":27,"column":949}}],"line":27},"14":{"loc":{"start":{"line":27,"column":1008},"end":{"line":27,"column":1046}},"type":"binary-expr","locations":[{"start":{"line":27,"column":1008},"end":{"line":27,"column":1040}},{"start":{"line":27,"column":1044},"end":{"line":27,"column":1046}}],"line":27},"15":{"loc":{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},"type":"if","locations":[{"start":{"line":29,"column":8},"end":{"line":31,"column":9}},{"start":{"line":29,"column":8},"end":{"line":31,"column":9}}],"line":29},"16":{"loc":{"start":{"line":44,"column":4},"end":{"line":46,"column":5}},"type":"if","locations":[{"start":{"line":44,"column":4},"end":{"line":46,"column":5}},{"start":{"line":44,"column":4},"end":{"line":46,"column":5}}],"line":44},"17":{"loc":{"start":{"line":44,"column":8},"end":{"line":44,"column":40}},"type":"binary-expr","locations":[{"start":{"line":44,"column":8},"end":{"line":44,"column":16}},{"start":{"line":44,"column":20},"end":{"line":44,"column":40}}],"line":44},"18":{"loc":{"start":{"line":47,"column":4},"end":{"line":49,"column":5}},"type":"if","locations":[{"start":{"line":47,"column":4},"end":{"line":49,"column":5}},{"start":{"line":47,"column":4},"end":{"line":49,"column":5}}],"line":47},"19":{"loc":{"start":{"line":50,"column":4},"end":{"line":52,"column":5}},"type":"if","locations":[{"start":{"line":50,"column":4},"end":{"line":52,"column":5}},{"start":{"line":50,"column":4},"end":{"line":52,"column":5}}],"line":50}},"s":{"0":1,"1":1,"2":4,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":2,"11":2,"12":2,"13":2,"14":1,"15":1,"16":2,"17":2,"18":2,"19":2,"20":1,"21":4,"22":4,"23":4,"24":1,"25":3,"26":2,"27":1,"28":1},"f":{"0":4,"1":1,"2":1,"3":2,"4":2,"5":2,"6":4},"b":{"0":[2,0],"1":[2,1],"2":[0,2],"3":[2,2],"4":[0,2],"5":[2,2],"6":[0,2],"7":[2,2],"8":[0,1],"9":[1,1],"10":[0,1],"11":[1,1],"12":[0,1],"13":[1,1],"14":[1,0],"15":[1,1],"16":[1,3],"17":[4,3],"18":[2,1],"19":[1,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/receiver/message-redaction-helper.ts"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\n\nimport { Federation } from '../../../../Federation';\nimport type { FederatedUser } from '../../../../domain/FederatedUser';\nimport type { RocketChatMessageAdapter } from '../../../../infrastructure/rocket-chat/adapters/Message';\n\ninterface IRoomRedactionHandler {\n\thandle(): Promise<void>;\n}\n\nclass DeleteMessageHandler implements IRoomRedactionHandler {\n\tconstructor(\n\t\tprivate readonly internalMessageAdapter: RocketChatMessageAdapter,\n\t\tprivate readonly message: IMessage,\n\t\tprivate readonly federatedUser: FederatedUser,\n\t) {}\n\n\tpublic async handle(): Promise<void> {\n\t\tawait this.internalMessageAdapter.deleteMessage(this.message, this.federatedUser);\n\t}\n}\n\nclass UnreactToMessageHandler implements IRoomRedactionHandler {\n\tconstructor(\n\t\tprivate readonly internalMessageAdapter: RocketChatMessageAdapter,\n\t\tprivate readonly message: IMessage,\n\t\tprivate readonly federatedUser: FederatedUser,\n\t\tprivate readonly redactsEvents: string,\n\t) {}\n\n\tpublic async handle(): Promise<void> {\n\t\tconst normalizedEventId = Federation.escapeExternalFederationEventId(this.redactsEvents);\n\t\tconst reaction = Object.keys(this.message.reactions || {}).find(\n\t\t\t(key) =>\n\t\t\t\tthis.message.reactions?.[key]?.federationReactionEventIds?.[normalizedEventId] === this.federatedUser.getUsername() &&\n\t\t\t\tthis.message.reactions?.[key]?.usernames?.includes(this.federatedUser.getUsername() || ''),\n\t\t);\n\t\tif (!reaction) {\n\t\t\treturn;\n\t\t}\n\t\tawait this.internalMessageAdapter.unreactToMessage(this.federatedUser, this.message, reaction, this.redactsEvents);\n\t}\n}\n\nexport const getMessageRedactionHandler = async (\n\tinternalMessageAdapter: RocketChatMessageAdapter,\n\tredactsEvent: string,\n\tfederatedUser: FederatedUser,\n): Promise<IRoomRedactionHandler | undefined> => {\n\tconst message = await internalMessageAdapter.getMessageByFederationId(redactsEvent);\n\tconst messageWithReaction = await internalMessageAdapter.findOneByFederationIdOnReactions(redactsEvent, federatedUser);\n\tif (!message && !messageWithReaction) {\n\t\treturn;\n\t}\n\tif (messageWithReaction) {\n\t\treturn new UnreactToMessageHandler(internalMessageAdapter, messageWithReaction, federatedUser, redactsEvent);\n\t}\n\tif (message) {\n\t\treturn new DeleteMessageHandler(internalMessageAdapter, message, federatedUser);\n\t}\n};\n"],"names":["getMessageRedactionHandler","DeleteMessageHandler","handle","internalMessageAdapter","deleteMessage","message","federatedUser","constructor","UnreactToMessageHandler","normalizedEventId","Federation","escapeExternalFederationEventId","redactsEvents","reaction","Object","keys","reactions","find","key","federationReactionEventIds","getUsername","usernames","includes","unreactToMessage","redactsEvent","getMessageByFederationId","messageWithReaction","findOneByFederationIdOnReactions"],"mappings":";;;;+BA4CaA;;;eAAAA;;;4BA1Cc;AAQ3B,IAAA,AAAMC,uBAAN,MAAMA;IAOL,MAAaC,SAAwB;QACpC,MAAM,IAAI,CAACC,sBAAsB,CAACC,aAAa,CAAC,IAAI,CAACC,OAAO,EAAE,IAAI,CAACC,aAAa;IACjF;IARAC,YACC,AAAiBJ,sBAAgD,EACjE,AAAiBE,OAAiB,EAClC,AAAiBC,aAA4B,CAC5C;aAHgBH,yBAAAA;aACAE,UAAAA;aACAC,gBAAAA;IACf;AAKJ;AAEA,IAAA,AAAME,0BAAN,MAAMA;IAQL,MAAaN,SAAwB;QACpC,MAAMO,oBAAoBC,sBAAU,CAACC,+BAA+B,CAAC,IAAI,CAACC,aAAa;QACvF,MAAMC,WAAWC,OAAOC,IAAI,CAAC,IAAI,CAACV,OAAO,CAACW,SAAS,IAAI,CAAC,GAAGC,IAAI,CAC9D,CAACC;gBACA,wDAAA,6BAAA,yBACA,uCAAA,8BAAA;mBADA,EAAA,0BAAA,IAAI,CAACb,OAAO,CAACW,SAAS,cAAtB,+CAAA,8BAAA,uBAAwB,CAACE,IAAI,cAA7B,mDAAA,yDAAA,4BAA+BC,0BAA0B,cAAzD,6EAAA,sDAA2D,CAACV,kBAAkB,MAAK,IAAI,CAACH,aAAa,CAACc,WAAW,QACjH,2BAAA,IAAI,CAACf,OAAO,CAACW,SAAS,cAAtB,gDAAA,+BAAA,wBAAwB,CAACE,IAAI,cAA7B,oDAAA,wCAAA,6BAA+BG,SAAS,cAAxC,4DAAA,sCAA0CC,QAAQ,CAAC,IAAI,CAAChB,aAAa,CAACc,WAAW,MAAM;;QAEzF,IAAI,CAACP,UAAU;YACd;QACD;QACA,MAAM,IAAI,CAACV,sBAAsB,CAACoB,gBAAgB,CAAC,IAAI,CAACjB,aAAa,EAAE,IAAI,CAACD,OAAO,EAAEQ,UAAU,IAAI,CAACD,aAAa;IAClH;IAlBAL,YACC,AAAiBJ,sBAAgD,EACjE,AAAiBE,OAAiB,EAClC,AAAiBC,aAA4B,EAC7C,AAAiBM,aAAqB,CACrC;aAJgBT,yBAAAA;aACAE,UAAAA;aACAC,gBAAAA;aACAM,gBAAAA;IACf;AAcJ;AAEO,MAAMZ,6BAA6B,OACzCG,wBACAqB,cACAlB;IAEA,MAAMD,UAAU,MAAMF,uBAAuBsB,wBAAwB,CAACD;IACtE,MAAME,sBAAsB,MAAMvB,uBAAuBwB,gCAAgC,CAACH,cAAclB;IACxG,IAAI,CAACD,WAAW,CAACqB,qBAAqB;QACrC;IACD;IACA,IAAIA,qBAAqB;QACxB,OAAO,IAAIlB,wBAAwBL,wBAAwBuB,qBAAqBpB,eAAekB;IAChG;IACA,IAAInB,SAAS;QACZ,OAAO,IAAIJ,qBAAqBE,wBAAwBE,SAASC;IAClE;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/message/receiver/message-redaction-helper.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f6af0a1248924132cf4fcb9b76e3bc52963d9a37","contentHash":"29ae82ad417ded55d8e225f84fceb7a4387a37fc82bcdf348de9d3a6c231f026"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/sender/RoomInternalValidator.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/sender/RoomInternalValidator.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":47}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":23},"end":{"line":12,"column":63}},"5":{"start":{"line":13,"column":23},"end":{"line":13,"column":63}},"6":{"start":{"line":14,"column":46},"end":{"line":14,"column":99}},"7":{"start":{"line":15,"column":38},"end":{"line":72,"column":1}},"8":{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},"9":{"start":{"line":18,"column":12},"end":{"line":18,"column":19}},"10":{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},"11":{"start":{"line":21,"column":12},"end":{"line":21,"column":62}},"12":{"start":{"line":23,"column":21},"end":{"line":23,"column":98}},"13":{"start":{"line":24,"column":33},"end":{"line":24,"column":92}},"14":{"start":{"line":25,"column":8},"end":{"line":27,"column":9}},"15":{"start":{"line":26,"column":12},"end":{"line":26,"column":62}},"16":{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},"17":{"start":{"line":31,"column":12},"end":{"line":31,"column":19}},"18":{"start":{"line":33,"column":8},"end":{"line":35,"column":9}},"19":{"start":{"line":34,"column":12},"end":{"line":34,"column":63}},"20":{"start":{"line":36,"column":24},"end":{"line":36,"column":104}},"21":{"start":{"line":37,"column":29},"end":{"line":37,"column":106}},"22":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"23":{"start":{"line":39,"column":12},"end":{"line":39,"column":19}},"24":{"start":{"line":41,"column":41},"end":{"line":41,"column":196}},"25":{"start":{"line":42,"column":44},"end":{"line":42,"column":194}},"26":{"start":{"line":43,"column":56},"end":{"line":43,"column":113}},"27":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"28":{"start":{"line":45,"column":12},"end":{"line":45,"column":19}},"29":{"start":{"line":47,"column":24},"end":{"line":47,"column":101}},"30":{"start":{"line":48,"column":37},"end":{"line":48,"column":105}},"31":{"start":{"line":49,"column":57},"end":{"line":49,"column":133}},"32":{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},"33":{"start":{"line":51,"column":12},"end":{"line":51,"column":63}},"34":{"start":{"line":55,"column":26},"end":{"line":60,"column":10}},"35":{"start":{"line":56,"column":12},"end":{"line":58,"column":13}},"36":{"start":{"line":57,"column":16},"end":{"line":57,"column":28}},"37":{"start":{"line":59,"column":12},"end":{"line":59,"column":39}},"38":{"start":{"line":61,"column":39},"end":{"line":61,"column":327}},"39":{"start":{"line":61,"column":66},"end":{"line":61,"column":202}},"40":{"start":{"line":61,"column":236},"end":{"line":61,"column":272}},"41":{"start":{"line":61,"column":287},"end":{"line":61,"column":326}},"42":{"start":{"line":62,"column":8},"end":{"line":64,"column":9}},"43":{"start":{"line":63,"column":12},"end":{"line":63,"column":63}},"44":{"start":{"line":67,"column":8},"end":{"line":67,"column":40}},"45":{"start":{"line":70,"column":8},"end":{"line":70,"column":311}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":16,"column":4},"end":{"line":16,"column":5}},"loc":{"start":{"line":16,"column":76},"end":{"line":28,"column":5}},"line":16},"2":{"name":"(anonymous_2)","decl":{"start":{"line":29,"column":4},"end":{"line":29,"column":5}},"loc":{"start":{"line":29,"column":90},"end":{"line":53,"column":5}},"line":29},"3":{"name":"(anonymous_3)","decl":{"start":{"line":54,"column":4},"end":{"line":54,"column":5}},"loc":{"start":{"line":54,"column":54},"end":{"line":65,"column":5}},"line":54},"4":{"name":"(anonymous_4)","decl":{"start":{"line":55,"column":44},"end":{"line":55,"column":45}},"loc":{"start":{"line":55,"column":52},"end":{"line":60,"column":9}},"line":55},"5":{"name":"(anonymous_5)","decl":{"start":{"line":61,"column":54},"end":{"line":61,"column":55}},"loc":{"start":{"line":61,"column":66},"end":{"line":61,"column":202}},"line":61},"6":{"name":"(anonymous_6)","decl":{"start":{"line":61,"column":228},"end":{"line":61,"column":229}},"loc":{"start":{"line":61,"column":236},"end":{"line":61,"column":272}},"line":61},"7":{"name":"(anonymous_7)","decl":{"start":{"line":61,"column":279},"end":{"line":61,"column":280}},"loc":{"start":{"line":61,"column":287},"end":{"line":61,"column":326}},"line":61},"8":{"name":"(anonymous_8)","decl":{"start":{"line":66,"column":4},"end":{"line":66,"column":5}},"loc":{"start":{"line":66,"column":35},"end":{"line":68,"column":5}},"line":66},"9":{"name":"(anonymous_9)","decl":{"start":{"line":69,"column":4},"end":{"line":69,"column":5}},"loc":{"start":{"line":69,"column":111},"end":{"line":71,"column":5}},"line":69}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},"type":"if","locations":[{"start":{"line":17,"column":8},"end":{"line":19,"column":9}},{"start":{"line":17,"column":8},"end":{"line":19,"column":9}}],"line":17},"1":{"loc":{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},"type":"if","locations":[{"start":{"line":20,"column":8},"end":{"line":22,"column":9}},{"start":{"line":20,"column":8},"end":{"line":22,"column":9}}],"line":20},"2":{"loc":{"start":{"line":24,"column":33},"end":{"line":24,"column":92}},"type":"cond-expr","locations":[{"start":{"line":24,"column":68},"end":{"line":24,"column":74}},{"start":{"line":24,"column":77},"end":{"line":24,"column":92}}],"line":24},"3":{"loc":{"start":{"line":24,"column":33},"end":{"line":24,"column":65}},"type":"binary-expr","locations":[{"start":{"line":24,"column":33},"end":{"line":24,"column":46}},{"start":{"line":24,"column":50},"end":{"line":24,"column":65}}],"line":24},"4":{"loc":{"start":{"line":25,"column":8},"end":{"line":27,"column":9}},"type":"if","locations":[{"start":{"line":25,"column":8},"end":{"line":27,"column":9}},{"start":{"line":25,"column":8},"end":{"line":27,"column":9}}],"line":25},"5":{"loc":{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},"type":"if","locations":[{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},{"start":{"line":30,"column":8},"end":{"line":32,"column":9}}],"line":30},"6":{"loc":{"start":{"line":33,"column":8},"end":{"line":35,"column":9}},"type":"if","locations":[{"start":{"line":33,"column":8},"end":{"line":35,"column":9}},{"start":{"line":33,"column":8},"end":{"line":35,"column":9}}],"line":33},"7":{"loc":{"start":{"line":33,"column":12},"end":{"line":33,"column":111}},"type":"binary-expr","locations":[{"start":{"line":33,"column":12},"end":{"line":33,"column":55}},{"start":{"line":33,"column":59},"end":{"line":33,"column":111}}],"line":33},"8":{"loc":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"type":"if","locations":[{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},{"start":{"line":38,"column":8},"end":{"line":40,"column":9}}],"line":38},"9":{"loc":{"start":{"line":38,"column":12},"end":{"line":38,"column":37}},"type":"binary-expr","locations":[{"start":{"line":38,"column":12},"end":{"line":38,"column":25}},{"start":{"line":38,"column":29},"end":{"line":38,"column":37}}],"line":38},"10":{"loc":{"start":{"line":43,"column":56},"end":{"line":43,"column":113}},"type":"binary-expr","locations":[{"start":{"line":43,"column":56},"end":{"line":43,"column":81}},{"start":{"line":43,"column":85},"end":{"line":43,"column":113}}],"line":43},"11":{"loc":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"type":"if","locations":[{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},{"start":{"line":44,"column":8},"end":{"line":46,"column":9}}],"line":44},"12":{"loc":{"start":{"line":48,"column":37},"end":{"line":48,"column":105}},"type":"cond-expr","locations":[{"start":{"line":48,"column":78},"end":{"line":48,"column":84}},{"start":{"line":48,"column":87},"end":{"line":48,"column":105}}],"line":48},"13":{"loc":{"start":{"line":48,"column":37},"end":{"line":48,"column":75}},"type":"binary-expr","locations":[{"start":{"line":48,"column":37},"end":{"line":48,"column":53}},{"start":{"line":48,"column":57},"end":{"line":48,"column":75}}],"line":48},"14":{"loc":{"start":{"line":49,"column":57},"end":{"line":49,"column":133}},"type":"binary-expr","locations":[{"start":{"line":49,"column":57},"end":{"line":49,"column":77}},{"start":{"line":49,"column":81},"end":{"line":49,"column":133}}],"line":49},"15":{"loc":{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},"type":"if","locations":[{"start":{"line":50,"column":8},"end":{"line":52,"column":9}},{"start":{"line":50,"column":8},"end":{"line":52,"column":9}}],"line":50},"16":{"loc":{"start":{"line":56,"column":12},"end":{"line":58,"column":13}},"type":"if","locations":[{"start":{"line":56,"column":12},"end":{"line":58,"column":13}},{"start":{"line":56,"column":12},"end":{"line":58,"column":13}}],"line":56},"17":{"loc":{"start":{"line":59,"column":19},"end":{"line":59,"column":38}},"type":"binary-expr","locations":[{"start":{"line":59,"column":19},"end":{"line":59,"column":32}},{"start":{"line":59,"column":36},"end":{"line":59,"column":38}}],"line":59},"18":{"loc":{"start":{"line":61,"column":39},"end":{"line":61,"column":327}},"type":"binary-expr","locations":[{"start":{"line":61,"column":39},"end":{"line":61,"column":203}},{"start":{"line":61,"column":207},"end":{"line":61,"column":327}}],"line":61},"19":{"loc":{"start":{"line":62,"column":8},"end":{"line":64,"column":9}},"type":"if","locations":[{"start":{"line":62,"column":8},"end":{"line":64,"column":9}},{"start":{"line":62,"column":8},"end":{"line":64,"column":9}}],"line":62}},"s":{"0":1,"1":1,"2":16,"3":1,"4":1,"5":1,"6":1,"7":1,"8":4,"9":2,"10":2,"11":1,"12":1,"13":1,"14":1,"15":1,"16":10,"17":1,"18":9,"19":1,"20":8,"21":8,"22":8,"23":3,"24":5,"25":5,"26":5,"27":5,"28":1,"29":4,"30":4,"31":4,"32":4,"33":1,"34":2,"35":4,"36":1,"37":3,"38":2,"39":3,"40":2,"41":1,"42":2,"43":1,"44":17,"45":16},"f":{"0":16,"1":4,"2":10,"3":2,"4":4,"5":3,"6":2,"7":1,"8":17,"9":16},"b":{"0":[2,2],"1":[1,1],"2":[0,1],"3":[1,1],"4":[1,0],"5":[1,9],"6":[1,8],"7":[9,2],"8":[3,5],"9":[8,6],"10":[5,1],"11":[1,4],"12":[0,4],"13":[4,4],"14":[4,2],"15":[1,3],"16":[1,3],"17":[3,3],"18":[2,1],"19":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/sender/RoomInternalValidator.ts"],"sourcesContent":["import type { IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isDirectMessageRoom, isRoomFederated, isUserFederated } from '@rocket.chat/core-typings';\n\nimport { FederatedRoom } from '../../../domain/FederatedRoom';\nimport { FederatedUser } from '../../../domain/FederatedUser';\nimport type { IFederationBridge } from '../../../domain/IFederationBridge';\nimport type { RocketChatFileAdapter } from '../../../infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatRoomAdapter } from '../../../infrastructure/rocket-chat/adapters/Room';\nimport type { RocketChatSettingsAdapter } from '../../../infrastructure/rocket-chat/adapters/Settings';\nimport type { RocketChatUserAdapter } from '../../../infrastructure/rocket-chat/adapters/User';\nimport { AbstractFederationApplicationService } from '../../AbstractFederationApplicationService';\n\nexport class FederationRoomInternalValidator extends AbstractFederationApplicationService {\n\tconstructor(\n\t\tprotected internalRoomAdapter: RocketChatRoomAdapter,\n\t\tprotected internalUserAdapter: RocketChatUserAdapter,\n\t\tprotected internalFileAdapter: RocketChatFileAdapter,\n\t\tprotected internalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tprotected bridge: IFederationBridge,\n\t) {\n\t\tsuper(bridge, internalUserAdapter, internalFileAdapter, internalSettingsAdapter);\n\t}\n\n\tpublic async canAddFederatedUserToNonFederatedRoom(internalUser: IUser | string, internalRoom: IRoom): Promise<void> {\n\t\tif (isRoomFederated(internalRoom)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isAddingANewExternalUser(internalUser)) {\n\t\t\tthrow new Error('error-cant-add-federated-users');\n\t\t}\n\n\t\tconst user = await this.internalUserAdapter.getFederatedUserByInternalId((internalUser as IUser)._id);\n\t\tconst isAFederatedUser = user?.isRemote();\n\t\tif (isAFederatedUser) {\n\t\t\tthrow new Error('error-cant-add-federated-users');\n\t\t}\n\t}\n\n\tpublic async canAddFederatedUserToFederatedRoom(\n\t\tinternalUser: IUser | string,\n\t\tinternalInviter: IUser,\n\t\tinternalRoom: IRoom,\n\t): Promise<void> {\n\t\tif (!isRoomFederated(internalRoom)) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.isAddingANewExternalUser(internalUser) && !isDirectMessageRoom(internalRoom)) {\n\t\t\tthrow new Error('error-this-is-a-premium-feature');\n\t\t}\n\n\t\tconst inviter = await this.internalUserAdapter.getFederatedUserByInternalId(internalInviter._id);\n\t\tconst externalRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoom._id);\n\t\tif (!externalRoom || !inviter) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isRoomFromTheProxyServer = FederatedRoom.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(externalRoom.getExternalId()),\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t\tconst isInviterFromTheProxyServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(inviter.getExternalId()),\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t\tconst fullActionExecutedOnTheRemoteHomeServer = !isRoomFromTheProxyServer && !isInviterFromTheProxyServer;\n\t\tif (fullActionExecutedOnTheRemoteHomeServer) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst invitee = await this.internalUserAdapter.getFederatedUserByInternalId((internalUser as IUser)._id);\n\t\tconst addingAnExternalUser = invitee?.isRemote();\n\t\tconst addingExternalUserToNonDirectMessageRoom = addingAnExternalUser && !isDirectMessageRoom(internalRoom);\n\t\tif (addingExternalUserToNonDirectMessageRoom) {\n\t\t\tthrow new Error('error-this-is-a-premium-feature');\n\t\t}\n\t}\n\n\tpublic async canCreateDirectMessageFromUI(internalUsers: (IUser | string)[]): Promise<void> {\n\t\tconst usernames: string[] = internalUsers.map((user) => {\n\t\t\tif (this.isAddingANewExternalUser(user)) {\n\t\t\t\treturn user;\n\t\t\t}\n\t\t\treturn user.username || '';\n\t\t});\n\t\tconst atLeastOneExternalUser =\n\t\t\tusernames.some(\n\t\t\t\t(username) =>\n\t\t\t\t\t!FederatedUser.isOriginalFromTheProxyServer(this.bridge.extractHomeserverOrigin(username), this.internalHomeServerDomain),\n\t\t\t) || internalUsers.filter((user) => !this.isAddingANewExternalUser(user)).some((user) => isUserFederated(user as IUser));\n\t\tif (atLeastOneExternalUser) {\n\t\t\tthrow new Error('error-this-is-a-premium-feature');\n\t\t}\n\t}\n\n\tprivate isAddingANewExternalUser(user: IUser | string): user is string {\n\t\treturn typeof user === 'string';\n\t}\n}\n"],"names":["FederationRoomInternalValidator","AbstractFederationApplicationService","canAddFederatedUserToNonFederatedRoom","internalUser","internalRoom","isRoomFederated","isAddingANewExternalUser","Error","user","internalUserAdapter","getFederatedUserByInternalId","_id","isAFederatedUser","isRemote","canAddFederatedUserToFederatedRoom","internalInviter","isDirectMessageRoom","inviter","externalRoom","internalRoomAdapter","getFederatedRoomByInternalId","isRoomFromTheProxyServer","FederatedRoom","isOriginalFromTheProxyServer","bridge","extractHomeserverOrigin","getExternalId","internalHomeServerDomain","isInviterFromTheProxyServer","FederatedUser","fullActionExecutedOnTheRemoteHomeServer","invitee","addingAnExternalUser","addingExternalUserToNonDirectMessageRoom","canCreateDirectMessageFromUI","internalUsers","usernames","map","username","atLeastOneExternalUser","some","filter","isUserFederated","constructor","internalFileAdapter","internalSettingsAdapter"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/sender/RoomInternalValidator.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d1dfdc305540a3a8ec59653ca199e089ab3d444d","contentHash":"f50dcca038f55c1412fb9fdc5620d1f935c2e6a1abd1c794bc77aaf03fba863c"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/sender/RoomServiceSender.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/sender/RoomServiceSender.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":43}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":23},"end":{"line":12,"column":63}},"5":{"start":{"line":13,"column":23},"end":{"line":13,"column":63}},"6":{"start":{"line":14,"column":27},"end":{"line":14,"column":98}},"7":{"start":{"line":15,"column":36},"end":{"line":15,"column":121}},"8":{"start":{"line":16,"column":46},"end":{"line":16,"column":99}},"9":{"start":{"line":17,"column":29},"end":{"line":17,"column":79}},"10":{"start":{"line":18,"column":34},"end":{"line":366,"column":1}},"11":{"start":{"line":20,"column":110},"end":{"line":20,"column":140}},"12":{"start":{"line":21,"column":36},"end":{"line":21,"column":114}},"13":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"14":{"start":{"line":23,"column":12},"end":{"line":23,"column":102}},"15":{"start":{"line":25,"column":36},"end":{"line":25,"column":116}},"16":{"start":{"line":26,"column":8},"end":{"line":29,"column":9}},"17":{"start":{"line":27,"column":44},"end":{"line":27,"column":49}},"18":{"start":{"line":28,"column":12},"end":{"line":28,"column":117}},"19":{"start":{"line":30,"column":37},"end":{"line":30,"column":138}},"20":{"start":{"line":31,"column":37},"end":{"line":31,"column":146}},"21":{"start":{"line":32,"column":8},"end":{"line":34,"column":9}},"22":{"start":{"line":33,"column":12},"end":{"line":33,"column":70}},"23":{"start":{"line":35,"column":47},"end":{"line":35,"column":186}},"24":{"start":{"line":36,"column":38},"end":{"line":39,"column":10}},"25":{"start":{"line":40,"column":8},"end":{"line":52,"column":9}},"26":{"start":{"line":41,"column":35},"end":{"line":45,"column":14}},"27":{"start":{"line":46,"column":37},"end":{"line":49,"column":14}},"28":{"start":{"line":50,"column":42},"end":{"line":50,"column":126}},"29":{"start":{"line":51,"column":12},"end":{"line":51,"column":218}},"30":{"start":{"line":53,"column":30},"end":{"line":56,"column":10}},"31":{"start":{"line":57,"column":8},"end":{"line":62,"column":9}},"32":{"start":{"line":58,"column":12},"end":{"line":61,"column":27}},"33":{"start":{"line":63,"column":8},"end":{"line":70,"column":9}},"34":{"start":{"line":64,"column":28},"end":{"line":64,"column":109}},"35":{"start":{"line":65,"column":12},"end":{"line":67,"column":13}},"36":{"start":{"line":66,"column":16},"end":{"line":66,"column":152}},"37":{"start":{"line":68,"column":12},"end":{"line":68,"column":150}},"38":{"start":{"line":69,"column":12},"end":{"line":69,"column":108}},"39":{"start":{"line":71,"column":8},"end":{"line":71,"column":112}},"40":{"start":{"line":74,"column":51},"end":{"line":74,"column":70}},"41":{"start":{"line":75,"column":30},"end":{"line":75,"column":105}},"42":{"start":{"line":76,"column":8},"end":{"line":78,"column":9}},"43":{"start":{"line":77,"column":12},"end":{"line":77,"column":19}},"44":{"start":{"line":79,"column":30},"end":{"line":79,"column":105}},"45":{"start":{"line":80,"column":8},"end":{"line":82,"column":9}},"46":{"start":{"line":81,"column":12},"end":{"line":81,"column":19}},"47":{"start":{"line":83,"column":44},"end":{"line":83,"column":200}},"48":{"start":{"line":84,"column":8},"end":{"line":86,"column":9}},"49":{"start":{"line":85,"column":12},"end":{"line":85,"column":19}},"50":{"start":{"line":87,"column":8},"end":{"line":87,"column":98}},"51":{"start":{"line":90,"column":75},"end":{"line":90,"column":94}},"52":{"start":{"line":91,"column":30},"end":{"line":91,"column":105}},"53":{"start":{"line":92,"column":8},"end":{"line":94,"column":9}},"54":{"start":{"line":93,"column":12},"end":{"line":93,"column":19}},"55":{"start":{"line":95,"column":30},"end":{"line":95,"column":105}},"56":{"start":{"line":96,"column":8},"end":{"line":98,"column":9}},"57":{"start":{"line":97,"column":12},"end":{"line":97,"column":19}},"58":{"start":{"line":99,"column":23},"end":{"line":99,"column":106}},"59":{"start":{"line":100,"column":8},"end":{"line":102,"column":9}},"60":{"start":{"line":101,"column":12},"end":{"line":101,"column":19}},"61":{"start":{"line":103,"column":44},"end":{"line":103,"column":193}},"62":{"start":{"line":104,"column":8},"end":{"line":106,"column":9}},"63":{"start":{"line":105,"column":12},"end":{"line":105,"column":19}},"64":{"start":{"line":107,"column":8},"end":{"line":107,"column":129}},"65":{"start":{"line":111,"column":81},"end":{"line":111,"column":109}},"66":{"start":{"line":112,"column":32},"end":{"line":112,"column":109}},"67":{"start":{"line":113,"column":8},"end":{"line":115,"column":9}},"68":{"start":{"line":114,"column":12},"end":{"line":114,"column":78}},"69":{"start":{"line":116,"column":30},"end":{"line":116,"column":105}},"70":{"start":{"line":117,"column":8},"end":{"line":119,"column":9}},"71":{"start":{"line":118,"column":12},"end":{"line":118,"column":76}},"72":{"start":{"line":120,"column":8},"end":{"line":122,"column":9}},"73":{"start":{"line":121,"column":12},"end":{"line":121,"column":19}},"74":{"start":{"line":123,"column":8},"end":{"line":146,"column":9}},"75":{"start":{"line":123,"column":152},"end":{"line":123,"column":235}},"76":{"start":{"line":125,"column":32},"end":{"line":125,"column":168}},"77":{"start":{"line":125,"column":71},"end":{"line":125,"column":154}},"78":{"start":{"line":126,"column":12},"end":{"line":128,"column":13}},"79":{"start":{"line":127,"column":16},"end":{"line":127,"column":23}},"80":{"start":{"line":129,"column":39},"end":{"line":129,"column":162}},"81":{"start":{"line":130,"column":12},"end":{"line":132,"column":13}},"82":{"start":{"line":131,"column":16},"end":{"line":131,"column":23}},"83":{"start":{"line":133,"column":37},"end":{"line":133,"column":105}},"84":{"start":{"line":134,"column":12},"end":{"line":136,"column":13}},"85":{"start":{"line":135,"column":16},"end":{"line":135,"column":23}},"86":{"start":{"line":137,"column":12},"end":{"line":144,"column":123}},"87":{"start":{"line":145,"column":12},"end":{"line":145,"column":19}},"88":{"start":{"line":147,"column":8},"end":{"line":154,"column":96}},"89":{"start":{"line":158,"column":30},"end":{"line":158,"column":105}},"90":{"start":{"line":159,"column":8},"end":{"line":161,"column":9}},"91":{"start":{"line":160,"column":12},"end":{"line":160,"column":19}},"92":{"start":{"line":162,"column":30},"end":{"line":162,"column":234}},"93":{"start":{"line":163,"column":8},"end":{"line":165,"column":9}},"94":{"start":{"line":164,"column":12},"end":{"line":164,"column":19}},"95":{"start":{"line":166,"column":8},"end":{"line":168,"column":9}},"96":{"start":{"line":167,"column":12},"end":{"line":167,"column":19}},"97":{"start":{"line":169,"column":44},"end":{"line":169,"column":221}},"98":{"start":{"line":170,"column":8},"end":{"line":172,"column":9}},"99":{"start":{"line":171,"column":12},"end":{"line":171,"column":19}},"100":{"start":{"line":173,"column":8},"end":{"line":173,"column":258}},"101":{"start":{"line":177,"column":30},"end":{"line":177,"column":105}},"102":{"start":{"line":178,"column":8},"end":{"line":180,"column":9}},"103":{"start":{"line":179,"column":12},"end":{"line":179,"column":19}},"104":{"start":{"line":181,"column":30},"end":{"line":181,"column":105}},"105":{"start":{"line":182,"column":8},"end":{"line":184,"column":9}},"106":{"start":{"line":183,"column":12},"end":{"line":183,"column":19}},"107":{"start":{"line":185,"column":8},"end":{"line":187,"column":9}},"108":{"start":{"line":186,"column":12},"end":{"line":186,"column":19}},"109":{"start":{"line":188,"column":44},"end":{"line":188,"column":221}},"110":{"start":{"line":189,"column":8},"end":{"line":191,"column":9}},"111":{"start":{"line":190,"column":12},"end":{"line":190,"column":19}},"112":{"start":{"line":192,"column":8},"end":{"line":192,"column":281}},"113":{"start":{"line":195,"column":30},"end":{"line":195,"column":105}},"114":{"start":{"line":196,"column":8},"end":{"line":198,"column":9}},"115":{"start":{"line":197,"column":12},"end":{"line":197,"column":19}},"116":{"start":{"line":199,"column":30},"end":{"line":199,"column":105}},"117":{"start":{"line":200,"column":8},"end":{"line":202,"column":9}},"118":{"start":{"line":201,"column":12},"end":{"line":201,"column":19}},"119":{"start":{"line":203,"column":36},"end":{"line":203,"column":117}},"120":{"start":{"line":204,"column":8},"end":{"line":206,"column":9}},"121":{"start":{"line":205,"column":12},"end":{"line":205,"column":19}},"122":{"start":{"line":207,"column":30},"end":{"line":207,"column":121}},"123":{"start":{"line":208,"column":23},"end":{"line":208,"column":92}},"124":{"start":{"line":209,"column":8},"end":{"line":211,"column":9}},"125":{"start":{"line":210,"column":12},"end":{"line":210,"column":77}},"126":{"start":{"line":212,"column":44},"end":{"line":212,"column":221}},"127":{"start":{"line":213,"column":8},"end":{"line":215,"column":9}},"128":{"start":{"line":214,"column":12},"end":{"line":214,"column":19}},"129":{"start":{"line":216,"column":8},"end":{"line":222,"column":9}},"130":{"start":{"line":217,"column":12},"end":{"line":217,"column":194}},"131":{"start":{"line":219,"column":12},"end":{"line":221,"column":15}},"132":{"start":{"line":225,"column":30},"end":{"line":225,"column":105}},"133":{"start":{"line":226,"column":8},"end":{"line":228,"column":9}},"134":{"start":{"line":227,"column":12},"end":{"line":227,"column":19}},"135":{"start":{"line":229,"column":30},"end":{"line":229,"column":105}},"136":{"start":{"line":230,"column":8},"end":{"line":232,"column":9}},"137":{"start":{"line":231,"column":12},"end":{"line":231,"column":19}},"138":{"start":{"line":233,"column":36},"end":{"line":233,"column":117}},"139":{"start":{"line":234,"column":8},"end":{"line":236,"column":9}},"140":{"start":{"line":235,"column":12},"end":{"line":235,"column":19}},"141":{"start":{"line":237,"column":30},"end":{"line":237,"column":121}},"142":{"start":{"line":238,"column":23},"end":{"line":238,"column":92}},"143":{"start":{"line":239,"column":8},"end":{"line":241,"column":9}},"144":{"start":{"line":240,"column":12},"end":{"line":240,"column":77}},"145":{"start":{"line":242,"column":44},"end":{"line":242,"column":221}},"146":{"start":{"line":243,"column":8},"end":{"line":245,"column":9}},"147":{"start":{"line":244,"column":12},"end":{"line":244,"column":19}},"148":{"start":{"line":246,"column":8},"end":{"line":252,"column":9}},"149":{"start":{"line":247,"column":12},"end":{"line":247,"column":193}},"150":{"start":{"line":249,"column":12},"end":{"line":251,"column":19}},"151":{"start":{"line":255,"column":30},"end":{"line":255,"column":105}},"152":{"start":{"line":256,"column":8},"end":{"line":258,"column":9}},"153":{"start":{"line":257,"column":12},"end":{"line":257,"column":19}},"154":{"start":{"line":259,"column":30},"end":{"line":259,"column":105}},"155":{"start":{"line":260,"column":8},"end":{"line":262,"column":9}},"156":{"start":{"line":261,"column":12},"end":{"line":261,"column":19}},"157":{"start":{"line":263,"column":36},"end":{"line":263,"column":117}},"158":{"start":{"line":264,"column":8},"end":{"line":266,"column":9}},"159":{"start":{"line":265,"column":12},"end":{"line":265,"column":19}},"160":{"start":{"line":267,"column":30},"end":{"line":267,"column":121}},"161":{"start":{"line":268,"column":23},"end":{"line":268,"column":92}},"162":{"start":{"line":269,"column":8},"end":{"line":271,"column":9}},"163":{"start":{"line":270,"column":12},"end":{"line":270,"column":81}},"164":{"start":{"line":272,"column":44},"end":{"line":272,"column":221}},"165":{"start":{"line":273,"column":8},"end":{"line":275,"column":9}},"166":{"start":{"line":274,"column":12},"end":{"line":274,"column":19}},"167":{"start":{"line":276,"column":8},"end":{"line":282,"column":9}},"168":{"start":{"line":277,"column":12},"end":{"line":277,"column":198}},"169":{"start":{"line":279,"column":12},"end":{"line":281,"column":15}},"170":{"start":{"line":285,"column":30},"end":{"line":285,"column":105}},"171":{"start":{"line":286,"column":8},"end":{"line":288,"column":9}},"172":{"start":{"line":287,"column":12},"end":{"line":287,"column":19}},"173":{"start":{"line":289,"column":30},"end":{"line":289,"column":105}},"174":{"start":{"line":290,"column":8},"end":{"line":292,"column":9}},"175":{"start":{"line":291,"column":12},"end":{"line":291,"column":19}},"176":{"start":{"line":293,"column":36},"end":{"line":293,"column":117}},"177":{"start":{"line":294,"column":8},"end":{"line":296,"column":9}},"178":{"start":{"line":295,"column":12},"end":{"line":295,"column":19}},"179":{"start":{"line":297,"column":30},"end":{"line":297,"column":121}},"180":{"start":{"line":298,"column":23},"end":{"line":298,"column":92}},"181":{"start":{"line":299,"column":8},"end":{"line":301,"column":9}},"182":{"start":{"line":300,"column":12},"end":{"line":300,"column":81}},"183":{"start":{"line":302,"column":44},"end":{"line":302,"column":221}},"184":{"start":{"line":303,"column":8},"end":{"line":305,"column":9}},"185":{"start":{"line":304,"column":12},"end":{"line":304,"column":19}},"186":{"start":{"line":306,"column":8},"end":{"line":312,"column":9}},"187":{"start":{"line":307,"column":12},"end":{"line":307,"column":193}},"188":{"start":{"line":309,"column":12},"end":{"line":311,"column":19}},"189":{"start":{"line":315,"column":30},"end":{"line":315,"column":105}},"190":{"start":{"line":316,"column":8},"end":{"line":318,"column":9}},"191":{"start":{"line":317,"column":12},"end":{"line":317,"column":19}},"192":{"start":{"line":319,"column":30},"end":{"line":319,"column":151}},"193":{"start":{"line":320,"column":8},"end":{"line":322,"column":9}},"194":{"start":{"line":321,"column":12},"end":{"line":321,"column":19}},"195":{"start":{"line":323,"column":44},"end":{"line":323,"column":221}},"196":{"start":{"line":324,"column":8},"end":{"line":326,"column":9}},"197":{"start":{"line":325,"column":12},"end":{"line":325,"column":19}},"198":{"start":{"line":327,"column":33},"end":{"line":327,"column":124}},"199":{"start":{"line":328,"column":8},"end":{"line":330,"column":9}},"200":{"start":{"line":329,"column":12},"end":{"line":329,"column":19}},"201":{"start":{"line":331,"column":8},"end":{"line":331,"column":118}},"202":{"start":{"line":334,"column":30},"end":{"line":334,"column":105}},"203":{"start":{"line":335,"column":8},"end":{"line":337,"column":9}},"204":{"start":{"line":336,"column":12},"end":{"line":336,"column":19}},"205":{"start":{"line":338,"column":30},"end":{"line":338,"column":151}},"206":{"start":{"line":339,"column":8},"end":{"line":341,"column":9}},"207":{"start":{"line":340,"column":12},"end":{"line":340,"column":19}},"208":{"start":{"line":342,"column":44},"end":{"line":342,"column":221}},"209":{"start":{"line":343,"column":8},"end":{"line":345,"column":9}},"210":{"start":{"line":344,"column":12},"end":{"line":344,"column":19}},"211":{"start":{"line":346,"column":34},"end":{"line":346,"column":126}},"212":{"start":{"line":347,"column":8},"end":{"line":349,"column":9}},"213":{"start":{"line":348,"column":12},"end":{"line":348,"column":19}},"214":{"start":{"line":350,"column":8},"end":{"line":350,"column":120}},"215":{"start":{"line":353,"column":8},"end":{"line":360,"column":11}},"216":{"start":{"line":361,"column":8},"end":{"line":361,"column":172}},"217":{"start":{"line":364,"column":8},"end":{"line":364,"column":429}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":19,"column":4},"end":{"line":19,"column":5}},"loc":{"start":{"line":19,"column":79},"end":{"line":72,"column":5}},"line":19},"2":{"name":"(anonymous_2)","decl":{"start":{"line":73,"column":4},"end":{"line":73,"column":5}},"loc":{"start":{"line":73,"column":50},"end":{"line":88,"column":5}},"line":73},"3":{"name":"(anonymous_3)","decl":{"start":{"line":89,"column":4},"end":{"line":89,"column":5}},"loc":{"start":{"line":89,"column":53},"end":{"line":108,"column":5}},"line":89},"4":{"name":"(anonymous_4)","decl":{"start":{"line":109,"column":4},"end":{"line":109,"column":5}},"loc":{"start":{"line":109,"column":60},"end":{"line":155,"column":5}},"line":109},"5":{"name":"(anonymous_5)","decl":{"start":{"line":123,"column":138},"end":{"line":123,"column":139}},"loc":{"start":{"line":123,"column":152},"end":{"line":123,"column":235}},"line":123},"6":{"name":"(anonymous_6)","decl":{"start":{"line":125,"column":57},"end":{"line":125,"column":58}},"loc":{"start":{"line":125,"column":71},"end":{"line":125,"column":154}},"line":125},"7":{"name":"(anonymous_7)","decl":{"start":{"line":156,"column":4},"end":{"line":156,"column":5}},"loc":{"start":{"line":156,"column":63},"end":{"line":174,"column":5}},"line":156},"8":{"name":"(anonymous_8)","decl":{"start":{"line":175,"column":4},"end":{"line":175,"column":5}},"loc":{"start":{"line":175,"column":79},"end":{"line":193,"column":5}},"line":175},"9":{"name":"(anonymous_9)","decl":{"start":{"line":194,"column":4},"end":{"line":194,"column":5}},"loc":{"start":{"line":194,"column":81},"end":{"line":223,"column":5}},"line":194},"10":{"name":"(anonymous_10)","decl":{"start":{"line":224,"column":4},"end":{"line":224,"column":5}},"loc":{"start":{"line":224,"column":83},"end":{"line":253,"column":5}},"line":224},"11":{"name":"(anonymous_11)","decl":{"start":{"line":254,"column":4},"end":{"line":254,"column":5}},"loc":{"start":{"line":254,"column":85},"end":{"line":283,"column":5}},"line":254},"12":{"name":"(anonymous_12)","decl":{"start":{"line":284,"column":4},"end":{"line":284,"column":5}},"loc":{"start":{"line":284,"column":87},"end":{"line":313,"column":5}},"line":284},"13":{"name":"(anonymous_13)","decl":{"start":{"line":314,"column":4},"end":{"line":314,"column":5}},"loc":{"start":{"line":314,"column":65},"end":{"line":332,"column":5}},"line":314},"14":{"name":"(anonymous_14)","decl":{"start":{"line":333,"column":4},"end":{"line":333,"column":5}},"loc":{"start":{"line":333,"column":67},"end":{"line":351,"column":5}},"line":333},"15":{"name":"(anonymous_15)","decl":{"start":{"line":352,"column":4},"end":{"line":352,"column":5}},"loc":{"start":{"line":352,"column":101},"end":{"line":362,"column":5}},"line":352},"16":{"name":"(anonymous_16)","decl":{"start":{"line":363,"column":4},"end":{"line":363,"column":5}},"loc":{"start":{"line":363,"column":164},"end":{"line":365,"column":5}},"line":363}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"type":"if","locations":[{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},{"start":{"line":22,"column":8},"end":{"line":24,"column":9}}],"line":22},"1":{"loc":{"start":{"line":26,"column":8},"end":{"line":29,"column":9}},"type":"if","locations":[{"start":{"line":26,"column":8},"end":{"line":29,"column":9}},{"start":{"line":26,"column":8},"end":{"line":29,"column":9}}],"line":26},"2":{"loc":{"start":{"line":30,"column":37},"end":{"line":30,"column":138}},"type":"binary-expr","locations":[{"start":{"line":30,"column":37},"end":{"line":30,"column":56}},{"start":{"line":30,"column":60},"end":{"line":30,"column":138}}],"line":30},"3":{"loc":{"start":{"line":31,"column":37},"end":{"line":31,"column":146}},"type":"binary-expr","locations":[{"start":{"line":31,"column":37},"end":{"line":31,"column":56}},{"start":{"line":31,"column":60},"end":{"line":31,"column":146}}],"line":31},"4":{"loc":{"start":{"line":32,"column":8},"end":{"line":34,"column":9}},"type":"if","locations":[{"start":{"line":32,"column":8},"end":{"line":34,"column":9}},{"start":{"line":32,"column":8},"end":{"line":34,"column":9}}],"line":32},"5":{"loc":{"start":{"line":32,"column":12},"end":{"line":32,"column":58}},"type":"binary-expr","locations":[{"start":{"line":32,"column":12},"end":{"line":32,"column":33}},{"start":{"line":32,"column":37},"end":{"line":32,"column":58}}],"line":32},"6":{"loc":{"start":{"line":40,"column":8},"end":{"line":52,"column":9}},"type":"if","locations":[{"start":{"line":40,"column":8},"end":{"line":52,"column":9}},{"start":{"line":40,"column":8},"end":{"line":52,"column":9}}],"line":40},"7":{"loc":{"start":{"line":53,"column":30},"end":{"line":56,"column":10}},"type":"binary-expr","locations":[{"start":{"line":53,"column":30},"end":{"line":53,"column":51}},{"start":{"line":53,"column":55},"end":{"line":56,"column":10}}],"line":53},"8":{"loc":{"start":{"line":57,"column":8},"end":{"line":62,"column":9}},"type":"if","locations":[{"start":{"line":57,"column":8},"end":{"line":62,"column":9}},{"start":{"line":57,"column":8},"end":{"line":62,"column":9}}],"line":57},"9":{"loc":{"start":{"line":63,"column":8},"end":{"line":70,"column":9}},"type":"if","locations":[{"start":{"line":63,"column":8},"end":{"line":70,"column":9}},{"start":{"line":63,"column":8},"end":{"line":70,"column":9}}],"line":63},"10":{"loc":{"start":{"line":65,"column":12},"end":{"line":67,"column":13}},"type":"if","locations":[{"start":{"line":65,"column":12},"end":{"line":67,"column":13}},{"start":{"line":65,"column":12},"end":{"line":67,"column":13}}],"line":65},"11":{"loc":{"start":{"line":66,"column":66},"end":{"line":66,"column":119}},"type":"binary-expr","locations":[{"start":{"line":66,"column":66},"end":{"line":66,"column":96}},{"start":{"line":66,"column":100},"end":{"line":66,"column":119}}],"line":66},"12":{"loc":{"start":{"line":76,"column":8},"end":{"line":78,"column":9}},"type":"if","locations":[{"start":{"line":76,"column":8},"end":{"line":78,"column":9}},{"start":{"line":76,"column":8},"end":{"line":78,"column":9}}],"line":76},"13":{"loc":{"start":{"line":80,"column":8},"end":{"line":82,"column":9}},"type":"if","locations":[{"start":{"line":80,"column":8},"end":{"line":82,"column":9}},{"start":{"line":80,"column":8},"end":{"line":82,"column":9}}],"line":80},"14":{"loc":{"start":{"line":84,"column":8},"end":{"line":86,"column":9}},"type":"if","locations":[{"start":{"line":84,"column":8},"end":{"line":86,"column":9}},{"start":{"line":84,"column":8},"end":{"line":86,"column":9}}],"line":84},"15":{"loc":{"start":{"line":92,"column":8},"end":{"line":94,"column":9}},"type":"if","locations":[{"start":{"line":92,"column":8},"end":{"line":94,"column":9}},{"start":{"line":92,"column":8},"end":{"line":94,"column":9}}],"line":92},"16":{"loc":{"start":{"line":96,"column":8},"end":{"line":98,"column":9}},"type":"if","locations":[{"start":{"line":96,"column":8},"end":{"line":98,"column":9}},{"start":{"line":96,"column":8},"end":{"line":98,"column":9}}],"line":96},"17":{"loc":{"start":{"line":100,"column":8},"end":{"line":102,"column":9}},"type":"if","locations":[{"start":{"line":100,"column":8},"end":{"line":102,"column":9}},{"start":{"line":100,"column":8},"end":{"line":102,"column":9}}],"line":100},"18":{"loc":{"start":{"line":104,"column":8},"end":{"line":106,"column":9}},"type":"if","locations":[{"start":{"line":104,"column":8},"end":{"line":106,"column":9}},{"start":{"line":104,"column":8},"end":{"line":106,"column":9}}],"line":104},"19":{"loc":{"start":{"line":113,"column":8},"end":{"line":115,"column":9}},"type":"if","locations":[{"start":{"line":113,"column":8},"end":{"line":115,"column":9}},{"start":{"line":113,"column":8},"end":{"line":115,"column":9}}],"line":113},"20":{"loc":{"start":{"line":117,"column":8},"end":{"line":119,"column":9}},"type":"if","locations":[{"start":{"line":117,"column":8},"end":{"line":119,"column":9}},{"start":{"line":117,"column":8},"end":{"line":119,"column":9}}],"line":117},"21":{"loc":{"start":{"line":120,"column":8},"end":{"line":122,"column":9}},"type":"if","locations":[{"start":{"line":120,"column":8},"end":{"line":122,"column":9}},{"start":{"line":120,"column":8},"end":{"line":122,"column":9}}],"line":120},"22":{"loc":{"start":{"line":120,"column":12},"end":{"line":120,"column":136}},"type":"cond-expr","locations":[{"start":{"line":120,"column":100},"end":{"line":120,"column":106}},{"start":{"line":120,"column":109},"end":{"line":120,"column":136}}],"line":120},"23":{"loc":{"start":{"line":120,"column":12},"end":{"line":120,"column":97}},"type":"binary-expr","locations":[{"start":{"line":120,"column":12},"end":{"line":120,"column":63}},{"start":{"line":120,"column":67},"end":{"line":120,"column":97}}],"line":120},"24":{"loc":{"start":{"line":123,"column":8},"end":{"line":146,"column":9}},"type":"if","locations":[{"start":{"line":123,"column":8},"end":{"line":146,"column":9}},{"start":{"line":123,"column":8},"end":{"line":146,"column":9}}],"line":123},"25":{"loc":{"start":{"line":123,"column":12},"end":{"line":123,"column":236}},"type":"cond-expr","locations":[{"start":{"line":123,"column":103},"end":{"line":123,"column":109}},{"start":{"line":123,"column":112},"end":{"line":123,"column":236}}],"line":123},"26":{"loc":{"start":{"line":123,"column":12},"end":{"line":123,"column":100}},"type":"binary-expr","locations":[{"start":{"line":123,"column":12},"end":{"line":123,"column":65}},{"start":{"line":123,"column":69},"end":{"line":123,"column":100}}],"line":123},"27":{"loc":{"start":{"line":123,"column":152},"end":{"line":123,"column":235}},"type":"binary-expr","locations":[{"start":{"line":123,"column":152},"end":{"line":123,"column":199}},{"start":{"line":123,"column":203},"end":{"line":123,"column":235}}],"line":123},"28":{"loc":{"start":{"line":125,"column":71},"end":{"line":125,"column":154}},"type":"binary-expr","locations":[{"start":{"line":125,"column":71},"end":{"line":125,"column":118}},{"start":{"line":125,"column":122},"end":{"line":125,"column":154}}],"line":125},"29":{"loc":{"start":{"line":126,"column":12},"end":{"line":128,"column":13}},"type":"if","locations":[{"start":{"line":126,"column":12},"end":{"line":128,"column":13}},{"start":{"line":126,"column":12},"end":{"line":128,"column":13}}],"line":126},"30":{"loc":{"start":{"line":129,"column":39},"end":{"line":129,"column":162}},"type":"binary-expr","locations":[{"start":{"line":129,"column":39},"end":{"line":129,"column":67}},{"start":{"line":129,"column":72},"end":{"line":129,"column":161}}],"line":129},"31":{"loc":{"start":{"line":129,"column":72},"end":{"line":129,"column":161}},"type":"cond-expr","locations":[{"start":{"line":129,"column":121},"end":{"line":129,"column":127}},{"start":{"line":129,"column":130},"end":{"line":129,"column":161}}],"line":129},"32":{"loc":{"start":{"line":129,"column":72},"end":{"line":129,"column":118}},"type":"binary-expr","locations":[{"start":{"line":129,"column":72},"end":{"line":129,"column":92}},{"start":{"line":129,"column":96},"end":{"line":129,"column":118}}],"line":129},"33":{"loc":{"start":{"line":130,"column":12},"end":{"line":132,"column":13}},"type":"if","locations":[{"start":{"line":130,"column":12},"end":{"line":132,"column":13}},{"start":{"line":130,"column":12},"end":{"line":132,"column":13}}],"line":130},"34":{"loc":{"start":{"line":134,"column":12},"end":{"line":136,"column":13}},"type":"if","locations":[{"start":{"line":134,"column":12},"end":{"line":136,"column":13}},{"start":{"line":134,"column":12},"end":{"line":136,"column":13}}],"line":134},"35":{"loc":{"start":{"line":159,"column":8},"end":{"line":161,"column":9}},"type":"if","locations":[{"start":{"line":159,"column":8},"end":{"line":161,"column":9}},{"start":{"line":159,"column":8},"end":{"line":161,"column":9}}],"line":159},"36":{"loc":{"start":{"line":162,"column":30},"end":{"line":162,"column":234}},"type":"binary-expr","locations":[{"start":{"line":162,"column":31},"end":{"line":162,"column":147}},{"start":{"line":162,"column":152},"end":{"line":162,"column":234}}],"line":162},"37":{"loc":{"start":{"line":162,"column":31},"end":{"line":162,"column":147}},"type":"cond-expr","locations":[{"start":{"line":162,"column":116},"end":{"line":162,"column":122}},{"start":{"line":162,"column":125},"end":{"line":162,"column":147}}],"line":162},"38":{"loc":{"start":{"line":162,"column":31},"end":{"line":162,"column":113}},"type":"binary-expr","locations":[{"start":{"line":162,"column":31},"end":{"line":162,"column":80}},{"start":{"line":162,"column":84},"end":{"line":162,"column":113}}],"line":162},"39":{"loc":{"start":{"line":163,"column":8},"end":{"line":165,"column":9}},"type":"if","locations":[{"start":{"line":163,"column":8},"end":{"line":165,"column":9}},{"start":{"line":163,"column":8},"end":{"line":165,"column":9}}],"line":163},"40":{"loc":{"start":{"line":166,"column":8},"end":{"line":168,"column":9}},"type":"if","locations":[{"start":{"line":166,"column":8},"end":{"line":168,"column":9}},{"start":{"line":166,"column":8},"end":{"line":168,"column":9}}],"line":166},"41":{"loc":{"start":{"line":166,"column":12},"end":{"line":166,"column":132}},"type":"binary-expr","locations":[{"start":{"line":166,"column":12},"end":{"line":166,"column":77}},{"start":{"line":166,"column":81},"end":{"line":166,"column":132}}],"line":166},"42":{"loc":{"start":{"line":170,"column":8},"end":{"line":172,"column":9}},"type":"if","locations":[{"start":{"line":170,"column":8},"end":{"line":172,"column":9}},{"start":{"line":170,"column":8},"end":{"line":172,"column":9}}],"line":170},"43":{"loc":{"start":{"line":173,"column":100},"end":{"line":173,"column":256}},"type":"cond-expr","locations":[{"start":{"line":173,"column":212},"end":{"line":173,"column":218}},{"start":{"line":173,"column":221},"end":{"line":173,"column":256}}],"line":173},"44":{"loc":{"start":{"line":173,"column":100},"end":{"line":173,"column":209}},"type":"binary-expr","locations":[{"start":{"line":173,"column":100},"end":{"line":173,"column":167}},{"start":{"line":173,"column":171},"end":{"line":173,"column":209}}],"line":173},"45":{"loc":{"start":{"line":178,"column":8},"end":{"line":180,"column":9}},"type":"if","locations":[{"start":{"line":178,"column":8},"end":{"line":180,"column":9}},{"start":{"line":178,"column":8},"end":{"line":180,"column":9}}],"line":178},"46":{"loc":{"start":{"line":182,"column":8},"end":{"line":184,"column":9}},"type":"if","locations":[{"start":{"line":182,"column":8},"end":{"line":184,"column":9}},{"start":{"line":182,"column":8},"end":{"line":184,"column":9}}],"line":182},"47":{"loc":{"start":{"line":185,"column":8},"end":{"line":187,"column":9}},"type":"if","locations":[{"start":{"line":185,"column":8},"end":{"line":187,"column":9}},{"start":{"line":185,"column":8},"end":{"line":187,"column":9}}],"line":185},"48":{"loc":{"start":{"line":185,"column":12},"end":{"line":185,"column":176}},"type":"binary-expr","locations":[{"start":{"line":185,"column":12},"end":{"line":185,"column":77}},{"start":{"line":185,"column":81},"end":{"line":185,"column":132}},{"start":{"line":185,"column":136},"end":{"line":185,"column":176}}],"line":185},"49":{"loc":{"start":{"line":189,"column":8},"end":{"line":191,"column":9}},"type":"if","locations":[{"start":{"line":189,"column":8},"end":{"line":191,"column":9}},{"start":{"line":189,"column":8},"end":{"line":191,"column":9}}],"line":189},"50":{"loc":{"start":{"line":192,"column":102},"end":{"line":192,"column":258}},"type":"cond-expr","locations":[{"start":{"line":192,"column":214},"end":{"line":192,"column":220}},{"start":{"line":192,"column":223},"end":{"line":192,"column":258}}],"line":192},"51":{"loc":{"start":{"line":192,"column":102},"end":{"line":192,"column":211}},"type":"binary-expr","locations":[{"start":{"line":192,"column":102},"end":{"line":192,"column":169}},{"start":{"line":192,"column":173},"end":{"line":192,"column":211}}],"line":192},"52":{"loc":{"start":{"line":196,"column":8},"end":{"line":198,"column":9}},"type":"if","locations":[{"start":{"line":196,"column":8},"end":{"line":198,"column":9}},{"start":{"line":196,"column":8},"end":{"line":198,"column":9}}],"line":196},"53":{"loc":{"start":{"line":200,"column":8},"end":{"line":202,"column":9}},"type":"if","locations":[{"start":{"line":200,"column":8},"end":{"line":202,"column":9}},{"start":{"line":200,"column":8},"end":{"line":202,"column":9}}],"line":200},"54":{"loc":{"start":{"line":204,"column":8},"end":{"line":206,"column":9}},"type":"if","locations":[{"start":{"line":204,"column":8},"end":{"line":206,"column":9}},{"start":{"line":204,"column":8},"end":{"line":206,"column":9}}],"line":204},"55":{"loc":{"start":{"line":209,"column":8},"end":{"line":211,"column":9}},"type":"if","locations":[{"start":{"line":209,"column":8},"end":{"line":211,"column":9}},{"start":{"line":209,"column":8},"end":{"line":211,"column":9}}],"line":209},"56":{"loc":{"start":{"line":209,"column":12},"end":{"line":209,"column":174}},"type":"binary-expr","locations":[{"start":{"line":209,"column":12},"end":{"line":209,"column":163}},{"start":{"line":209,"column":167},"end":{"line":209,"column":174}}],"line":209},"57":{"loc":{"start":{"line":209,"column":14},"end":{"line":209,"column":162}},"type":"cond-expr","locations":[{"start":{"line":209,"column":67},"end":{"line":209,"column":73}},{"start":{"line":209,"column":76},"end":{"line":209,"column":162}}],"line":209},"58":{"loc":{"start":{"line":209,"column":14},"end":{"line":209,"column":64}},"type":"binary-expr","locations":[{"start":{"line":209,"column":14},"end":{"line":209,"column":36}},{"start":{"line":209,"column":40},"end":{"line":209,"column":64}}],"line":209},"59":{"loc":{"start":{"line":213,"column":8},"end":{"line":215,"column":9}},"type":"if","locations":[{"start":{"line":213,"column":8},"end":{"line":215,"column":9}},{"start":{"line":213,"column":8},"end":{"line":215,"column":9}}],"line":213},"60":{"loc":{"start":{"line":226,"column":8},"end":{"line":228,"column":9}},"type":"if","locations":[{"start":{"line":226,"column":8},"end":{"line":228,"column":9}},{"start":{"line":226,"column":8},"end":{"line":228,"column":9}}],"line":226},"61":{"loc":{"start":{"line":230,"column":8},"end":{"line":232,"column":9}},"type":"if","locations":[{"start":{"line":230,"column":8},"end":{"line":232,"column":9}},{"start":{"line":230,"column":8},"end":{"line":232,"column":9}}],"line":230},"62":{"loc":{"start":{"line":234,"column":8},"end":{"line":236,"column":9}},"type":"if","locations":[{"start":{"line":234,"column":8},"end":{"line":236,"column":9}},{"start":{"line":234,"column":8},"end":{"line":236,"column":9}}],"line":234},"63":{"loc":{"start":{"line":239,"column":8},"end":{"line":241,"column":9}},"type":"if","locations":[{"start":{"line":239,"column":8},"end":{"line":241,"column":9}},{"start":{"line":239,"column":8},"end":{"line":241,"column":9}}],"line":239},"64":{"loc":{"start":{"line":239,"column":12},"end":{"line":239,"column":174}},"type":"binary-expr","locations":[{"start":{"line":239,"column":12},"end":{"line":239,"column":163}},{"start":{"line":239,"column":167},"end":{"line":239,"column":174}}],"line":239},"65":{"loc":{"start":{"line":239,"column":14},"end":{"line":239,"column":162}},"type":"cond-expr","locations":[{"start":{"line":239,"column":67},"end":{"line":239,"column":73}},{"start":{"line":239,"column":76},"end":{"line":239,"column":162}}],"line":239},"66":{"loc":{"start":{"line":239,"column":14},"end":{"line":239,"column":64}},"type":"binary-expr","locations":[{"start":{"line":239,"column":14},"end":{"line":239,"column":36}},{"start":{"line":239,"column":40},"end":{"line":239,"column":64}}],"line":239},"67":{"loc":{"start":{"line":243,"column":8},"end":{"line":245,"column":9}},"type":"if","locations":[{"start":{"line":243,"column":8},"end":{"line":245,"column":9}},{"start":{"line":243,"column":8},"end":{"line":245,"column":9}}],"line":243},"68":{"loc":{"start":{"line":256,"column":8},"end":{"line":258,"column":9}},"type":"if","locations":[{"start":{"line":256,"column":8},"end":{"line":258,"column":9}},{"start":{"line":256,"column":8},"end":{"line":258,"column":9}}],"line":256},"69":{"loc":{"start":{"line":260,"column":8},"end":{"line":262,"column":9}},"type":"if","locations":[{"start":{"line":260,"column":8},"end":{"line":262,"column":9}},{"start":{"line":260,"column":8},"end":{"line":262,"column":9}}],"line":260},"70":{"loc":{"start":{"line":264,"column":8},"end":{"line":266,"column":9}},"type":"if","locations":[{"start":{"line":264,"column":8},"end":{"line":266,"column":9}},{"start":{"line":264,"column":8},"end":{"line":266,"column":9}}],"line":264},"71":{"loc":{"start":{"line":269,"column":8},"end":{"line":271,"column":9}},"type":"if","locations":[{"start":{"line":269,"column":8},"end":{"line":271,"column":9}},{"start":{"line":269,"column":8},"end":{"line":271,"column":9}}],"line":269},"72":{"loc":{"start":{"line":269,"column":12},"end":{"line":269,"column":333}},"type":"binary-expr","locations":[{"start":{"line":269,"column":12},"end":{"line":269,"column":163}},{"start":{"line":269,"column":167},"end":{"line":269,"column":322}},{"start":{"line":269,"column":326},"end":{"line":269,"column":333}}],"line":269},"73":{"loc":{"start":{"line":269,"column":14},"end":{"line":269,"column":162}},"type":"cond-expr","locations":[{"start":{"line":269,"column":67},"end":{"line":269,"column":73}},{"start":{"line":269,"column":76},"end":{"line":269,"column":162}}],"line":269},"74":{"loc":{"start":{"line":269,"column":14},"end":{"line":269,"column":64}},"type":"binary-expr","locations":[{"start":{"line":269,"column":14},"end":{"line":269,"column":36}},{"start":{"line":269,"column":40},"end":{"line":269,"column":64}}],"line":269},"75":{"loc":{"start":{"line":269,"column":169},"end":{"line":269,"column":321}},"type":"cond-expr","locations":[{"start":{"line":269,"column":222},"end":{"line":269,"column":228}},{"start":{"line":269,"column":231},"end":{"line":269,"column":321}}],"line":269},"76":{"loc":{"start":{"line":269,"column":169},"end":{"line":269,"column":219}},"type":"binary-expr","locations":[{"start":{"line":269,"column":169},"end":{"line":269,"column":191}},{"start":{"line":269,"column":195},"end":{"line":269,"column":219}}],"line":269},"77":{"loc":{"start":{"line":273,"column":8},"end":{"line":275,"column":9}},"type":"if","locations":[{"start":{"line":273,"column":8},"end":{"line":275,"column":9}},{"start":{"line":273,"column":8},"end":{"line":275,"column":9}}],"line":273},"78":{"loc":{"start":{"line":286,"column":8},"end":{"line":288,"column":9}},"type":"if","locations":[{"start":{"line":286,"column":8},"end":{"line":288,"column":9}},{"start":{"line":286,"column":8},"end":{"line":288,"column":9}}],"line":286},"79":{"loc":{"start":{"line":290,"column":8},"end":{"line":292,"column":9}},"type":"if","locations":[{"start":{"line":290,"column":8},"end":{"line":292,"column":9}},{"start":{"line":290,"column":8},"end":{"line":292,"column":9}}],"line":290},"80":{"loc":{"start":{"line":294,"column":8},"end":{"line":296,"column":9}},"type":"if","locations":[{"start":{"line":294,"column":8},"end":{"line":296,"column":9}},{"start":{"line":294,"column":8},"end":{"line":296,"column":9}}],"line":294},"81":{"loc":{"start":{"line":299,"column":8},"end":{"line":301,"column":9}},"type":"if","locations":[{"start":{"line":299,"column":8},"end":{"line":301,"column":9}},{"start":{"line":299,"column":8},"end":{"line":301,"column":9}}],"line":299},"82":{"loc":{"start":{"line":299,"column":12},"end":{"line":299,"column":333}},"type":"binary-expr","locations":[{"start":{"line":299,"column":12},"end":{"line":299,"column":163}},{"start":{"line":299,"column":167},"end":{"line":299,"column":322}},{"start":{"line":299,"column":326},"end":{"line":299,"column":333}}],"line":299},"83":{"loc":{"start":{"line":299,"column":14},"end":{"line":299,"column":162}},"type":"cond-expr","locations":[{"start":{"line":299,"column":67},"end":{"line":299,"column":73}},{"start":{"line":299,"column":76},"end":{"line":299,"column":162}}],"line":299},"84":{"loc":{"start":{"line":299,"column":14},"end":{"line":299,"column":64}},"type":"binary-expr","locations":[{"start":{"line":299,"column":14},"end":{"line":299,"column":36}},{"start":{"line":299,"column":40},"end":{"line":299,"column":64}}],"line":299},"85":{"loc":{"start":{"line":299,"column":169},"end":{"line":299,"column":321}},"type":"cond-expr","locations":[{"start":{"line":299,"column":222},"end":{"line":299,"column":228}},{"start":{"line":299,"column":231},"end":{"line":299,"column":321}}],"line":299},"86":{"loc":{"start":{"line":299,"column":169},"end":{"line":299,"column":219}},"type":"binary-expr","locations":[{"start":{"line":299,"column":169},"end":{"line":299,"column":191}},{"start":{"line":299,"column":195},"end":{"line":299,"column":219}}],"line":299},"87":{"loc":{"start":{"line":303,"column":8},"end":{"line":305,"column":9}},"type":"if","locations":[{"start":{"line":303,"column":8},"end":{"line":305,"column":9}},{"start":{"line":303,"column":8},"end":{"line":305,"column":9}}],"line":303},"88":{"loc":{"start":{"line":316,"column":8},"end":{"line":318,"column":9}},"type":"if","locations":[{"start":{"line":316,"column":8},"end":{"line":318,"column":9}},{"start":{"line":316,"column":8},"end":{"line":318,"column":9}}],"line":316},"89":{"loc":{"start":{"line":319,"column":30},"end":{"line":319,"column":151}},"type":"binary-expr","locations":[{"start":{"line":319,"column":30},"end":{"line":319,"column":58}},{"start":{"line":319,"column":62},"end":{"line":319,"column":151}}],"line":319},"90":{"loc":{"start":{"line":320,"column":8},"end":{"line":322,"column":9}},"type":"if","locations":[{"start":{"line":320,"column":8},"end":{"line":322,"column":9}},{"start":{"line":320,"column":8},"end":{"line":322,"column":9}}],"line":320},"91":{"loc":{"start":{"line":324,"column":8},"end":{"line":326,"column":9}},"type":"if","locations":[{"start":{"line":324,"column":8},"end":{"line":326,"column":9}},{"start":{"line":324,"column":8},"end":{"line":326,"column":9}}],"line":324},"92":{"loc":{"start":{"line":328,"column":8},"end":{"line":330,"column":9}},"type":"if","locations":[{"start":{"line":328,"column":8},"end":{"line":330,"column":9}},{"start":{"line":328,"column":8},"end":{"line":330,"column":9}}],"line":328},"93":{"loc":{"start":{"line":328,"column":55},"end":{"line":328,"column":77}},"type":"binary-expr","locations":[{"start":{"line":328,"column":55},"end":{"line":328,"column":71}},{"start":{"line":328,"column":75},"end":{"line":328,"column":77}}],"line":328},"94":{"loc":{"start":{"line":335,"column":8},"end":{"line":337,"column":9}},"type":"if","locations":[{"start":{"line":335,"column":8},"end":{"line":337,"column":9}},{"start":{"line":335,"column":8},"end":{"line":337,"column":9}}],"line":335},"95":{"loc":{"start":{"line":338,"column":30},"end":{"line":338,"column":151}},"type":"binary-expr","locations":[{"start":{"line":338,"column":30},"end":{"line":338,"column":58}},{"start":{"line":338,"column":62},"end":{"line":338,"column":151}}],"line":338},"96":{"loc":{"start":{"line":339,"column":8},"end":{"line":341,"column":9}},"type":"if","locations":[{"start":{"line":339,"column":8},"end":{"line":341,"column":9}},{"start":{"line":339,"column":8},"end":{"line":341,"column":9}}],"line":339},"97":{"loc":{"start":{"line":343,"column":8},"end":{"line":345,"column":9}},"type":"if","locations":[{"start":{"line":343,"column":8},"end":{"line":345,"column":9}},{"start":{"line":343,"column":8},"end":{"line":345,"column":9}}],"line":343},"98":{"loc":{"start":{"line":347,"column":8},"end":{"line":349,"column":9}},"type":"if","locations":[{"start":{"line":347,"column":8},"end":{"line":349,"column":9}},{"start":{"line":347,"column":8},"end":{"line":349,"column":9}}],"line":347},"99":{"loc":{"start":{"line":347,"column":49},"end":{"line":347,"column":72}},"type":"binary-expr","locations":[{"start":{"line":347,"column":49},"end":{"line":347,"column":66}},{"start":{"line":347,"column":70},"end":{"line":347,"column":72}}],"line":347}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":13,"12":13,"13":13,"14":3,"15":13,"16":13,"17":3,"18":3,"19":13,"20":13,"21":13,"22":2,"23":11,"24":11,"25":11,"26":2,"27":2,"28":2,"29":2,"30":11,"31":11,"32":1,"33":10,"34":2,"35":2,"36":2,"37":2,"38":2,"39":10,"40":4,"41":4,"42":4,"43":1,"44":3,"45":3,"46":1,"47":2,"48":2,"49":1,"50":1,"51":5,"52":5,"53":5,"54":1,"55":4,"56":4,"57":1,"58":3,"59":3,"60":2,"61":1,"62":1,"63":0,"64":1,"65":6,"66":6,"67":6,"68":1,"69":5,"70":5,"71":1,"72":4,"73":1,"74":3,"75":2,"76":2,"77":2,"78":2,"79":0,"80":2,"81":2,"82":1,"83":1,"84":1,"85":0,"86":1,"87":1,"88":1,"89":6,"90":6,"91":1,"92":5,"93":5,"94":1,"95":4,"96":3,"97":1,"98":1,"99":0,"100":1,"101":6,"102":6,"103":1,"104":5,"105":5,"106":1,"107":4,"108":3,"109":1,"110":1,"111":0,"112":1,"113":8,"114":8,"115":1,"116":7,"117":7,"118":1,"119":6,"120":6,"121":1,"122":5,"123":5,"124":5,"125":1,"126":4,"127":4,"128":1,"129":3,"130":3,"131":1,"132":7,"133":7,"134":1,"135":6,"136":6,"137":1,"138":5,"139":5,"140":1,"141":4,"142":4,"143":4,"144":1,"145":3,"146":3,"147":1,"148":2,"149":2,"150":1,"151":9,"152":9,"153":1,"154":8,"155":8,"156":1,"157":7,"158":7,"159":1,"160":6,"161":6,"162":6,"163":1,"164":5,"165":5,"166":1,"167":4,"168":4,"169":1,"170":7,"171":7,"172":1,"173":6,"174":6,"175":1,"176":5,"177":5,"178":1,"179":4,"180":4,"181":4,"182":1,"183":3,"184":3,"185":1,"186":2,"187":2,"188":1,"189":5,"190":5,"191":1,"192":4,"193":4,"194":1,"195":3,"196":3,"197":1,"198":2,"199":2,"200":1,"201":1,"202":5,"203":5,"204":1,"205":4,"206":4,"207":1,"208":3,"209":3,"210":1,"211":2,"212":2,"213":1,"214":1,"215":4,"216":4,"217":81},"f":{"0":1,"1":13,"2":4,"3":5,"4":6,"5":2,"6":2,"7":6,"8":6,"9":8,"10":7,"11":9,"12":7,"13":5,"14":5,"15":4,"16":81},"b":{"0":[3,10],"1":[3,10],"2":[13,3],"3":[13,3],"4":[2,11],"5":[13,11],"6":[2,9],"7":[11,2],"8":[1,10],"9":[2,8],"10":[2,0],"11":[2,0],"12":[1,3],"13":[1,2],"14":[1,1],"15":[1,4],"16":[1,3],"17":[2,1],"18":[0,1],"19":[1,5],"20":[1,4],"21":[1,3],"22":[3,1],"23":[4,4],"24":[2,1],"25":[1,2],"26":[3,3],"27":[2,2],"28":[2,2],"29":[0,2],"30":[2,1],"31":[0,1],"32":[1,1],"33":[1,1],"34":[0,1],"35":[1,5],"36":[5,5],"37":[0,5],"38":[5,5],"39":[1,4],"40":[3,1],"41":[4,2],"42":[0,1],"43":[0,1],"44":[1,1],"45":[1,5],"46":[1,4],"47":[3,1],"48":[4,3,2],"49":[0,1],"50":[0,1],"51":[1,1],"52":[1,7],"53":[1,6],"54":[1,5],"55":[1,4],"56":[5,1],"57":[0,5],"58":[5,5],"59":[1,3],"60":[1,6],"61":[1,5],"62":[1,4],"63":[1,3],"64":[4,3],"65":[2,2],"66":[4,4],"67":[1,2],"68":[1,8],"69":[1,7],"70":[1,6],"71":[1,5],"72":[6,2,1],"73":[0,6],"74":[6,6],"75":[0,2],"76":[2,2],"77":[1,4],"78":[1,6],"79":[1,5],"80":[1,4],"81":[1,3],"82":[4,1,1],"83":[0,4],"84":[4,4],"85":[0,1],"86":[1,1],"87":[1,2],"88":[1,4],"89":[4,4],"90":[1,3],"91":[1,2],"92":[1,1],"93":[2,0],"94":[1,4],"95":[4,4],"96":[1,3],"97":[1,2],"98":[1,1],"99":[2,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/sender/RoomServiceSender.ts"],"sourcesContent":["import type { IMessage, MessageQuoteAttachment } from '@rocket.chat/core-typings';\nimport { isDeletedMessage, isEditedMessage, isMessageFromMatrixFederation, isQuoteAttachment } from '@rocket.chat/core-typings';\n\nimport { FederatedRoom, DirectMessageFederatedRoom } from '../../../domain/FederatedRoom';\nimport { FederatedUser } from '../../../domain/FederatedUser';\nimport type { IFederationBridge } from '../../../domain/IFederationBridge';\nimport { MATRIX_POWER_LEVELS } from '../../../infrastructure/matrix/definitions/MatrixPowerLevels';\nimport type { RocketChatFileAdapter } from '../../../infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatMessageAdapter } from '../../../infrastructure/rocket-chat/adapters/Message';\nimport type { RocketChatNotificationAdapter } from '../../../infrastructure/rocket-chat/adapters/Notification';\nimport type { RocketChatRoomAdapter } from '../../../infrastructure/rocket-chat/adapters/Room';\nimport type { RocketChatSettingsAdapter } from '../../../infrastructure/rocket-chat/adapters/Settings';\nimport type { RocketChatUserAdapter } from '../../../infrastructure/rocket-chat/adapters/User';\nimport { ROCKET_CHAT_FEDERATION_ROLES } from '../../../infrastructure/rocket-chat/definitions/FederatedRoomInternalRoles';\nimport { AbstractFederationApplicationService } from '../../AbstractFederationApplicationService';\nimport type {\n\tFederationAfterLeaveRoomDto,\n\tFederationAfterRemoveUserFromRoomDto,\n\tFederationCreateDMAndInviteUserDto,\n\tFederationRoomSendExternalMessageDto,\n} from '../input/RoomSenderDto';\nimport { getExternalMessageSender } from '../message/sender/message-sender-helper';\n\nexport class FederationRoomServiceSender extends AbstractFederationApplicationService {\n\tconstructor(\n\t\tprotected internalRoomAdapter: RocketChatRoomAdapter,\n\t\tprotected internalUserAdapter: RocketChatUserAdapter,\n\t\tprotected internalFileAdapter: RocketChatFileAdapter,\n\t\tprotected internalMessageAdapter: RocketChatMessageAdapter,\n\t\tprotected internalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tprotected internalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tprotected bridge: IFederationBridge,\n\t) {\n\t\tsuper(bridge, internalUserAdapter, internalFileAdapter, internalSettingsAdapter);\n\t}\n\n\tpublic async createDirectMessageRoomAndInviteUser(roomCreateDMAndInviteUserInput: FederationCreateDMAndInviteUserDto): Promise<void> {\n\t\tconst { normalizedInviteeId, rawInviteeId, internalInviterId, inviteeUsernameOnly, internalRoomId } = roomCreateDMAndInviteUserInput;\n\n\t\tconst internalInviterUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalInviterId);\n\t\tif (!internalInviterUser) {\n\t\t\tawait this.createFederatedUserIncludingHomeserverUsingLocalInformation(internalInviterId);\n\t\t}\n\n\t\tconst internalInviteeUser = await this.internalUserAdapter.getFederatedUserByInternalId(normalizedInviteeId);\n\t\tif (!internalInviteeUser) {\n\t\t\tconst existsOnlyOnProxyServer = false;\n\t\t\tawait this.createFederatedUserInternallyOnly(rawInviteeId, normalizedInviteeId, existsOnlyOnProxyServer);\n\t\t}\n\n\t\tconst federatedInviterUser = internalInviterUser || (await this.internalUserAdapter.getFederatedUserByInternalId(internalInviterId));\n\t\tconst federatedInviteeUser =\n\t\t\tinternalInviteeUser || (await this.internalUserAdapter.getFederatedUserByInternalUsername(normalizedInviteeId));\n\t\tif (!federatedInviterUser || !federatedInviteeUser) {\n\t\t\tthrow new Error('Could not find inviter or invitee user');\n\t\t}\n\n\t\tconst isInviteeFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(rawInviteeId),\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\n\t\tconst internalFederatedRoom = await this.internalRoomAdapter.getDirectMessageFederatedRoomByUserIds([\n\t\t\tfederatedInviteeUser.getInternalId(),\n\t\t\tfederatedInviterUser.getInternalId(),\n\t\t]);\n\n\t\tif (!internalFederatedRoom) {\n\t\t\tconst externalRoomId = await this.bridge.createDirectMessageRoom(\n\t\t\t\tfederatedInviterUser.getExternalId(),\n\t\t\t\t[federatedInviteeUser.getExternalId()],\n\t\t\t\t{ internalRoomId },\n\t\t\t);\n\t\t\tconst newFederatedRoom = DirectMessageFederatedRoom.createInstance(externalRoomId, federatedInviterUser, [\n\t\t\t\tfederatedInviterUser,\n\t\t\t\tfederatedInviteeUser,\n\t\t\t]);\n\t\t\tconst createdInternalRoomId = await this.internalRoomAdapter.createFederatedRoomForDirectMessage(newFederatedRoom);\n\t\t\tawait this.internalNotificationAdapter.subscribeToUserTypingEventsOnFederatedRoomId(\n\t\t\t\tcreatedInternalRoomId,\n\t\t\t\tthis.internalNotificationAdapter.broadcastUserTypingOnRoom.bind(this.internalNotificationAdapter),\n\t\t\t);\n\t\t}\n\n\t\tconst federatedRoom =\n\t\t\tinternalFederatedRoom ||\n\t\t\t(await this.internalRoomAdapter.getDirectMessageFederatedRoomByUserIds([\n\t\t\t\tfederatedInviteeUser.getInternalId(),\n\t\t\t\tfederatedInviterUser.getInternalId(),\n\t\t\t]));\n\n\t\tif (!federatedRoom) {\n\t\t\tthrow new Error(\n\t\t\t\t`Could not find room id for users: ${[federatedInviteeUser.getInternalId(), federatedInviterUser.getInternalId()].join(' ')}`,\n\t\t\t);\n\t\t}\n\n\t\tif (isInviteeFromTheSameHomeServer) {\n\t\t\tconst profile = await this.bridge.getUserProfileInformation(federatedInviteeUser.getExternalId());\n\t\t\tif (!profile) {\n\t\t\t\tawait this.bridge.createUser(\n\t\t\t\t\tinviteeUsernameOnly,\n\t\t\t\t\tfederatedInviteeUser.getName() || normalizedInviteeId,\n\t\t\t\t\tthis.internalHomeServerDomain,\n\t\t\t\t);\n\t\t\t}\n\t\t\tawait this.bridge.inviteToRoom(\n\t\t\t\tfederatedRoom.getExternalId(),\n\t\t\t\tfederatedInviterUser.getExternalId(),\n\t\t\t\tfederatedInviteeUser.getExternalId(),\n\t\t\t);\n\t\t\tawait this.bridge.joinRoom(federatedRoom.getExternalId(), federatedInviteeUser.getExternalId());\n\t\t}\n\n\t\tawait this.internalRoomAdapter.addUserToRoom(federatedRoom, federatedInviteeUser, federatedInviterUser);\n\t}\n\n\tpublic async afterUserLeaveRoom(afterLeaveRoomInput: FederationAfterLeaveRoomDto): Promise<void> {\n\t\tconst { internalRoomId, internalUserId } = afterLeaveRoomInput;\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalUserId);\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isUserFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(federatedUser.getExternalId()),\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t\tif (!isUserFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.bridge.leaveRoom(federatedRoom.getExternalId(), federatedUser.getExternalId());\n\t}\n\n\tpublic async onUserRemovedFromRoom(afterLeaveRoomInput: FederationAfterRemoveUserFromRoomDto): Promise<void> {\n\t\tconst { internalRoomId, internalUserId, actionDoneByInternalId } = afterLeaveRoomInput;\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalUserId);\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst byWhom = await this.internalUserAdapter.getFederatedUserByInternalId(actionDoneByInternalId);\n\t\tif (!byWhom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isUserFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(byWhom.getExternalId()),\n\t\t\tthis.internalHomeServerDomain,\n\t\t);\n\t\tif (!isUserFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.bridge.kickUserFromRoom(federatedRoom.getExternalId(), federatedUser.getExternalId(), byWhom.getExternalId());\n\t}\n\n\tpublic async sendExternalMessage(roomSendExternalMessageInput: FederationRoomSendExternalMessageDto): Promise<void> {\n\t\tconst { internalRoomId, internalSenderId, message, isThreadedMessage } = roomSendExternalMessageInput;\n\t\tconst federatedSender = await this.internalUserAdapter.getFederatedUserByInternalId(internalSenderId);\n\t\tif (!federatedSender) {\n\t\t\tthrow new Error(`Could not find user id for ${internalSenderId}`);\n\t\t}\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\tthrow new Error(`Could not find room id for ${internalRoomId}`);\n\t\t}\n\n\t\tif (message.federation?.eventId) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (message.attachments?.some((attachment) => isQuoteAttachment(attachment) && Boolean(attachment.message_link))) {\n\t\t\t// TODO: move this to the domain layer in a proper entity\n\t\t\tconst messageLink = (\n\t\t\t\tmessage.attachments.find(\n\t\t\t\t\t(attachment) => isQuoteAttachment(attachment) && Boolean(attachment.message_link),\n\t\t\t\t) as MessageQuoteAttachment\n\t\t\t).message_link;\n\t\t\tif (!messageLink) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst messageToReplyToId = messageLink.includes('msg=') && messageLink?.split('msg=').pop();\n\t\t\tif (!messageToReplyToId) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst messageToReplyTo = await this.internalMessageAdapter.getMessageById(messageToReplyToId);\n\t\t\tif (!messageToReplyTo) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait getExternalMessageSender({\n\t\t\t\tmessage,\n\t\t\t\tisThreadedMessage,\n\t\t\t\tbridge: this.bridge,\n\t\t\t\tinternalFileAdapter: this.internalFileAdapter,\n\t\t\t\tinternalMessageAdapter: this.internalMessageAdapter,\n\t\t\t\tinternalUserAdapter: this.internalUserAdapter,\n\t\t\t}).sendQuoteMessage(federatedRoom.getExternalId(), federatedSender.getExternalId(), message, messageToReplyTo);\n\t\t\treturn;\n\t\t}\n\n\t\tawait getExternalMessageSender({\n\t\t\tmessage,\n\t\t\tisThreadedMessage,\n\t\t\tbridge: this.bridge,\n\t\t\tinternalFileAdapter: this.internalFileAdapter,\n\t\t\tinternalMessageAdapter: this.internalMessageAdapter,\n\t\t\tinternalUserAdapter: this.internalUserAdapter,\n\t\t}).sendMessage(federatedRoom.getExternalId(), federatedSender.getExternalId(), message);\n\t}\n\n\tpublic async afterMessageDeleted(internalMessage: IMessage, internalRoomId: string): Promise<void> {\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUser = internalMessage.u?._id && (await this.internalUserAdapter.getFederatedUserByInternalId(internalMessage.u._id));\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!isMessageFromMatrixFederation(internalMessage) || isDeletedMessage(internalMessage)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isUserFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(federatedUser.getExternalId()),\n\t\t\tthis.internalSettingsAdapter.getHomeServerDomain(),\n\t\t);\n\t\tif (!isUserFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.bridge.redactEvent(\n\t\t\tfederatedRoom.getExternalId(),\n\t\t\tfederatedUser.getExternalId(),\n\t\t\tinternalMessage.federation?.eventId as string,\n\t\t);\n\t}\n\n\tpublic async afterMessageUpdated(internalMessage: IMessage, internalRoomId: string, internalUserId: string): Promise<void> {\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalUserId);\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\t\tif (!isMessageFromMatrixFederation(internalMessage) || !isEditedMessage(internalMessage) || internalMessage.u._id !== internalUserId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isUserFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(federatedUser.getExternalId()),\n\t\t\tthis.internalSettingsAdapter.getHomeServerDomain(),\n\t\t);\n\t\tif (!isUserFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.bridge.updateMessage(\n\t\t\tfederatedRoom.getExternalId(),\n\t\t\tfederatedUser.getExternalId(),\n\t\t\tinternalMessage.federation?.eventId as string,\n\t\t\tinternalMessage.msg,\n\t\t);\n\t}\n\n\tpublic async onRoomOwnerAdded(internalUserId: string, internalTargetUserId: string, internalRoomId: string): Promise<void> {\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalUserId);\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedTargetUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalTargetUserId);\n\t\tif (!federatedTargetUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst userRoomRoles = await this.internalRoomAdapter.getInternalRoomRolesByUserId(internalRoomId, internalUserId);\n\t\tconst myself = federatedUser.getInternalId() === federatedTargetUser.getInternalId();\n\t\tif (!userRoomRoles?.includes(ROCKET_CHAT_FEDERATION_ROLES.OWNER) && !myself) {\n\t\t\tthrow new Error('Federation_Matrix_not_allowed_to_change_owner');\n\t\t}\n\n\t\tconst isUserFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(federatedUser.getExternalId()),\n\t\t\tthis.internalSettingsAdapter.getHomeServerDomain(),\n\t\t);\n\t\tif (!isUserFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\tawait this.bridge.setRoomPowerLevels(\n\t\t\t\tfederatedRoom.getExternalId(),\n\t\t\t\tfederatedUser.getExternalId(),\n\t\t\t\tfederatedTargetUser.getExternalId(),\n\t\t\t\tMATRIX_POWER_LEVELS.ADMIN,\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tawait this.rollbackRoomRoles(federatedRoom, federatedTargetUser, federatedUser, [], [ROCKET_CHAT_FEDERATION_ROLES.OWNER]);\n\t\t}\n\t}\n\n\tpublic async onRoomOwnerRemoved(internalUserId: string, internalTargetUserId: string, internalRoomId: string): Promise<void> {\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalUserId);\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedTargetUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalTargetUserId);\n\t\tif (!federatedTargetUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst userRoomRoles = await this.internalRoomAdapter.getInternalRoomRolesByUserId(internalRoomId, internalUserId);\n\t\tconst myself = federatedUser.getInternalId() === federatedTargetUser.getInternalId();\n\t\tif (!userRoomRoles?.includes(ROCKET_CHAT_FEDERATION_ROLES.OWNER) && !myself) {\n\t\t\tthrow new Error('Federation_Matrix_not_allowed_to_change_owner');\n\t\t}\n\n\t\tconst isUserFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(federatedUser.getExternalId()),\n\t\t\tthis.internalSettingsAdapter.getHomeServerDomain(),\n\t\t);\n\t\tif (!isUserFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\tawait this.bridge.setRoomPowerLevels(\n\t\t\t\tfederatedRoom.getExternalId(),\n\t\t\t\tfederatedUser.getExternalId(),\n\t\t\t\tfederatedTargetUser.getExternalId(),\n\t\t\t\tMATRIX_POWER_LEVELS.USER,\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tawait this.rollbackRoomRoles(federatedRoom, federatedTargetUser, federatedUser, [ROCKET_CHAT_FEDERATION_ROLES.OWNER], []);\n\t\t}\n\t}\n\n\tpublic async onRoomModeratorAdded(internalUserId: string, internalTargetUserId: string, internalRoomId: string): Promise<void> {\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalUserId);\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\t\tconst federatedTargetUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalTargetUserId);\n\t\tif (!federatedTargetUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst userRoomRoles = await this.internalRoomAdapter.getInternalRoomRolesByUserId(internalRoomId, internalUserId);\n\t\tconst myself = federatedUser.getInternalId() === federatedTargetUser.getInternalId();\n\t\tif (\n\t\t\t!userRoomRoles?.includes(ROCKET_CHAT_FEDERATION_ROLES.OWNER) &&\n\t\t\t!userRoomRoles?.includes(ROCKET_CHAT_FEDERATION_ROLES.MODERATOR) &&\n\t\t\t!myself\n\t\t) {\n\t\t\tthrow new Error('Federation_Matrix_not_allowed_to_change_moderator');\n\t\t}\n\n\t\tconst isUserFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(federatedUser.getExternalId()),\n\t\t\tthis.internalSettingsAdapter.getHomeServerDomain(),\n\t\t);\n\t\tif (!isUserFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait this.bridge.setRoomPowerLevels(\n\t\t\t\tfederatedRoom.getExternalId(),\n\t\t\t\tfederatedUser.getExternalId(),\n\t\t\t\tfederatedTargetUser.getExternalId(),\n\t\t\t\tMATRIX_POWER_LEVELS.MODERATOR,\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tawait this.rollbackRoomRoles(federatedRoom, federatedTargetUser, federatedUser, [], [ROCKET_CHAT_FEDERATION_ROLES.MODERATOR]);\n\t\t}\n\t}\n\n\tpublic async onRoomModeratorRemoved(internalUserId: string, internalTargetUserId: string, internalRoomId: string): Promise<void> {\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalUserId);\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedTargetUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalTargetUserId);\n\t\tif (!federatedTargetUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst userRoomRoles = await this.internalRoomAdapter.getInternalRoomRolesByUserId(internalRoomId, internalUserId);\n\t\tconst myself = federatedUser.getInternalId() === federatedTargetUser.getInternalId();\n\t\tif (\n\t\t\t!userRoomRoles?.includes(ROCKET_CHAT_FEDERATION_ROLES.OWNER) &&\n\t\t\t!userRoomRoles?.includes(ROCKET_CHAT_FEDERATION_ROLES.MODERATOR) &&\n\t\t\t!myself\n\t\t) {\n\t\t\tthrow new Error('Federation_Matrix_not_allowed_to_change_moderator');\n\t\t}\n\n\t\tconst isUserFromTheSameHomeServer = FederatedUser.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(federatedUser.getExternalId()),\n\t\t\tthis.internalSettingsAdapter.getHomeServerDomain(),\n\t\t);\n\t\tif (!isUserFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait this.bridge.setRoomPowerLevels(\n\t\t\t\tfederatedRoom.getExternalId(),\n\t\t\t\tfederatedUser.getExternalId(),\n\t\t\t\tfederatedTargetUser.getExternalId(),\n\t\t\t\tMATRIX_POWER_LEVELS.USER,\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tawait this.rollbackRoomRoles(federatedRoom, federatedTargetUser, federatedUser, [ROCKET_CHAT_FEDERATION_ROLES.MODERATOR], []);\n\t\t}\n\t}\n\n\tpublic async afterRoomNameChanged(internalRoomId: string, internalRoomName: string): Promise<void> {\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUser =\n\t\t\tfederatedRoom.getCreatorId() && (await this.internalUserAdapter.getFederatedUserByInternalId(federatedRoom.getCreatorId() as string));\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isRoomFromTheSameHomeServer = FederatedRoom.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(federatedRoom.getExternalId()),\n\t\t\tthis.internalSettingsAdapter.getHomeServerDomain(),\n\t\t);\n\t\tif (!isRoomFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst externalRoomName = await this.bridge.getRoomName(federatedRoom.getExternalId(), federatedUser.getExternalId());\n\n\t\tif (!federatedRoom.shouldUpdateDisplayRoomName(externalRoomName || '')) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.bridge.setRoomName(federatedRoom.getExternalId(), federatedUser.getExternalId(), internalRoomName);\n\t}\n\n\tpublic async afterRoomTopicChanged(internalRoomId: string, internalRoomTopic: string): Promise<void> {\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUser =\n\t\t\tfederatedRoom.getCreatorId() && (await this.internalUserAdapter.getFederatedUserByInternalId(federatedRoom.getCreatorId() as string));\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isRoomFromTheSameHomeServer = FederatedRoom.isOriginalFromTheProxyServer(\n\t\t\tthis.bridge.extractHomeserverOrigin(federatedRoom.getExternalId()),\n\t\t\tthis.internalSettingsAdapter.getHomeServerDomain(),\n\t\t);\n\t\tif (!isRoomFromTheSameHomeServer) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst externalRoomTopic = await this.bridge.getRoomTopic(federatedRoom.getExternalId(), federatedUser.getExternalId());\n\t\tif (!federatedRoom.shouldUpdateRoomTopic(externalRoomTopic || '')) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.bridge.setRoomTopic(federatedRoom.getExternalId(), federatedUser.getExternalId(), internalRoomTopic);\n\t}\n\n\tprivate async rollbackRoomRoles(\n\t\tfederatedRoom: FederatedRoom,\n\t\ttargetFederatedUser: FederatedUser,\n\t\tfromUser: FederatedUser,\n\t\trolesToAdd: ROCKET_CHAT_FEDERATION_ROLES[],\n\t\trolesToRemove: ROCKET_CHAT_FEDERATION_ROLES[],\n\t): Promise<void> {\n\t\tawait this.internalRoomAdapter.applyRoomRolesToUser({\n\t\t\tfederatedRoom,\n\t\t\ttargetFederatedUser,\n\t\t\tfromUser,\n\t\t\trolesToAdd,\n\t\t\trolesToRemove,\n\t\t\tnotifyChannel: false,\n\t\t});\n\t\tthis.internalNotificationAdapter.notifyWithEphemeralMessage(\n\t\t\t'Federation_Matrix_error_applying_room_roles',\n\t\t\tfromUser.getInternalId(),\n\t\t\tfederatedRoom.getInternalId(),\n\t\t);\n\t}\n}\n"],"names":["FederationRoomServiceSender","AbstractFederationApplicationService","createDirectMessageRoomAndInviteUser","roomCreateDMAndInviteUserInput","normalizedInviteeId","rawInviteeId","internalInviterId","inviteeUsernameOnly","internalRoomId","internalInviterUser","internalUserAdapter","getFederatedUserByInternalId","createFederatedUserIncludingHomeserverUsingLocalInformation","internalInviteeUser","existsOnlyOnProxyServer","createFederatedUserInternallyOnly","federatedInviterUser","federatedInviteeUser","getFederatedUserByInternalUsername","Error","isInviteeFromTheSameHomeServer","FederatedUser","isOriginalFromTheProxyServer","bridge","extractHomeserverOrigin","internalHomeServerDomain","internalFederatedRoom","internalRoomAdapter","getDirectMessageFederatedRoomByUserIds","getInternalId","externalRoomId","createDirectMessageRoom","getExternalId","newFederatedRoom","DirectMessageFederatedRoom","createInstance","createdInternalRoomId","createFederatedRoomForDirectMessage","internalNotificationAdapter","subscribeToUserTypingEventsOnFederatedRoomId","broadcastUserTypingOnRoom","bind","federatedRoom","join","profile","getUserProfileInformation","createUser","getName","inviteToRoom","joinRoom","addUserToRoom","afterUserLeaveRoom","afterLeaveRoomInput","internalUserId","getFederatedRoomByInternalId","federatedUser","isUserFromTheSameHomeServer","leaveRoom","onUserRemovedFromRoom","actionDoneByInternalId","byWhom","kickUserFromRoom","sendExternalMessage","roomSendExternalMessageInput","message","internalSenderId","isThreadedMessage","federatedSender","federation","eventId","attachments","some","attachment","isQuoteAttachment","Boolean","message_link","messageLink","find","messageToReplyToId","includes","split","pop","messageToReplyTo","internalMessageAdapter","getMessageById","getExternalMessageSender","internalFileAdapter","sendQuoteMessage","sendMessage","afterMessageDeleted","internalMessage","u","_id","isMessageFromMatrixFederation","isDeletedMessage","internalSettingsAdapter","getHomeServerDomain","redactEvent","afterMessageUpdated","isEditedMessage","updateMessage","msg","onRoomOwnerAdded","internalTargetUserId","federatedTargetUser","userRoomRoles","getInternalRoomRolesByUserId","myself","ROCKET_CHAT_FEDERATION_ROLES","OWNER","setRoomPowerLevels","MATRIX_POWER_LEVELS","ADMIN","e","rollbackRoomRoles","onRoomOwnerRemoved","USER","onRoomModeratorAdded","MODERATOR","onRoomModeratorRemoved","afterRoomNameChanged","internalRoomName","getCreatorId","isRoomFromTheSameHomeServer","FederatedRoom","externalRoomName","getRoomName","shouldUpdateDisplayRoomName","setRoomName","afterRoomTopicChanged","internalRoomTopic","externalRoomTopic","getRoomTopic","shouldUpdateRoomTopic","setRoomTopic","targetFederatedUser","fromUser","rolesToAdd","rolesToRemove","applyRoomRolesToUser","notifyChannel","notifyWithEphemeralMessage","constructor"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/sender/RoomServiceSender.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"64b314914b9953c7326e1998eba4c05045ff9d59","contentHash":"07944cf67bbc35358c7dced2a90e0e567856e21752014e1754ddd600b4ce24f6"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/user/receiver/UserServiceReceiver.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/user/receiver/UserServiceReceiver.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":45}},"3":{"start":{"line":11,"column":46},"end":{"line":11,"column":99}},"4":{"start":{"line":12,"column":36},"end":{"line":49,"column":1}},"5":{"start":{"line":15,"column":25},"end":{"line":15,"column":30}},"6":{"start":{"line":16,"column":33},"end":{"line":16,"column":294}},"7":{"start":{"line":16,"column":241},"end":{"line":16,"column":293}},"8":{"start":{"line":17,"column":28},"end":{"line":17,"column":291}},"9":{"start":{"line":17,"column":239},"end":{"line":17,"column":290}},"10":{"start":{"line":18,"column":8},"end":{"line":18,"column":207}},"11":{"start":{"line":18,"column":109},"end":{"line":18,"column":205}},"12":{"start":{"line":19,"column":8},"end":{"line":19,"column":77}},"13":{"start":{"line":22,"column":58},"end":{"line":22,"column":73}},"14":{"start":{"line":23,"column":30},"end":{"line":23,"column":105}},"15":{"start":{"line":24,"column":8},"end":{"line":26,"column":9}},"16":{"start":{"line":25,"column":12},"end":{"line":25,"column":19}},"17":{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},"18":{"start":{"line":28,"column":12},"end":{"line":28,"column":115}},"19":{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},"20":{"start":{"line":31,"column":12},"end":{"line":31,"column":19}},"21":{"start":{"line":33,"column":31},"end":{"line":33,"column":115}},"22":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"23":{"start":{"line":35,"column":12},"end":{"line":35,"column":19}},"24":{"start":{"line":37,"column":25},"end":{"line":37,"column":29}},"25":{"start":{"line":38,"column":8},"end":{"line":44,"column":12}},"26":{"start":{"line":39,"column":12},"end":{"line":39,"column":143}},"27":{"start":{"line":40,"column":12},"end":{"line":43,"column":14}},"28":{"start":{"line":47,"column":8},"end":{"line":47,"column":418}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":4},"end":{"line":13,"column":5}},"loc":{"start":{"line":13,"column":87},"end":{"line":20,"column":5}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":16,"column":233},"end":{"line":16,"column":234}},"loc":{"start":{"line":16,"column":241},"end":{"line":16,"column":293}},"line":16},"3":{"name":"(anonymous_3)","decl":{"start":{"line":17,"column":231},"end":{"line":17,"column":232}},"loc":{"start":{"line":17,"column":239},"end":{"line":17,"column":290}},"line":17},"4":{"name":"(anonymous_4)","decl":{"start":{"line":18,"column":101},"end":{"line":18,"column":102}},"loc":{"start":{"line":18,"column":109},"end":{"line":18,"column":205}},"line":18},"5":{"name":"(anonymous_5)","decl":{"start":{"line":21,"column":4},"end":{"line":21,"column":5}},"loc":{"start":{"line":21,"column":40},"end":{"line":45,"column":5}},"line":21},"6":{"name":"(anonymous_6)","decl":{"start":{"line":38,"column":77},"end":{"line":38,"column":78}},"loc":{"start":{"line":38,"column":94},"end":{"line":44,"column":9}},"line":38},"7":{"name":"(anonymous_7)","decl":{"start":{"line":46,"column":4},"end":{"line":46,"column":5}},"loc":{"start":{"line":46,"column":140},"end":{"line":48,"column":5}},"line":46}},"branchMap":{"0":{"loc":{"start":{"line":16,"column":33},"end":{"line":16,"column":294}},"type":"cond-expr","locations":[{"start":{"line":16,"column":182},"end":{"line":16,"column":188}},{"start":{"line":16,"column":191},"end":{"line":16,"column":294}}],"line":16},"1":{"loc":{"start":{"line":16,"column":33},"end":{"line":16,"column":179}},"type":"binary-expr","locations":[{"start":{"line":16,"column":33},"end":{"line":16,"column":130}},{"start":{"line":16,"column":134},"end":{"line":16,"column":179}}],"line":16},"2":{"loc":{"start":{"line":17,"column":28},"end":{"line":17,"column":291}},"type":"cond-expr","locations":[{"start":{"line":17,"column":179},"end":{"line":17,"column":185}},{"start":{"line":17,"column":188},"end":{"line":17,"column":291}}],"line":17},"3":{"loc":{"start":{"line":17,"column":28},"end":{"line":17,"column":176}},"type":"binary-expr","locations":[{"start":{"line":17,"column":28},"end":{"line":17,"column":126}},{"start":{"line":17,"column":130},"end":{"line":17,"column":176}}],"line":17},"4":{"loc":{"start":{"line":18,"column":8},"end":{"line":18,"column":206}},"type":"cond-expr","locations":[{"start":{"line":18,"column":67},"end":{"line":18,"column":73}},{"start":{"line":18,"column":76},"end":{"line":18,"column":206}}],"line":18},"5":{"loc":{"start":{"line":18,"column":8},"end":{"line":18,"column":64}},"type":"binary-expr","locations":[{"start":{"line":18,"column":8},"end":{"line":18,"column":33}},{"start":{"line":18,"column":37},"end":{"line":18,"column":64}}],"line":18},"6":{"loc":{"start":{"line":19,"column":58},"end":{"line":19,"column":75}},"type":"binary-expr","locations":[{"start":{"line":19,"column":58},"end":{"line":19,"column":69}},{"start":{"line":19,"column":73},"end":{"line":19,"column":75}}],"line":19},"7":{"loc":{"start":{"line":24,"column":8},"end":{"line":26,"column":9}},"type":"if","locations":[{"start":{"line":24,"column":8},"end":{"line":26,"column":9}},{"start":{"line":24,"column":8},"end":{"line":26,"column":9}}],"line":24},"8":{"loc":{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},"type":"if","locations":[{"start":{"line":27,"column":8},"end":{"line":29,"column":9}},{"start":{"line":27,"column":8},"end":{"line":29,"column":9}}],"line":27},"9":{"loc":{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},"type":"if","locations":[{"start":{"line":30,"column":8},"end":{"line":32,"column":9}},{"start":{"line":30,"column":8},"end":{"line":32,"column":9}}],"line":30},"10":{"loc":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"type":"if","locations":[{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},{"start":{"line":34,"column":8},"end":{"line":36,"column":9}}],"line":34}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":3,"6":3,"7":10,"8":3,"9":10,"10":3,"11":4,"12":3,"13":5,"14":5,"15":5,"16":1,"17":4,"18":3,"19":4,"20":0,"21":4,"22":4,"23":3,"24":1,"25":1,"26":2,"27":2,"28":5},"f":{"0":1,"1":3,"2":10,"3":10,"4":4,"5":5,"6":2,"7":5},"b":{"0":[0,3],"1":[3,3],"2":[0,3],"3":[3,3],"4":[0,3],"5":[3,3],"6":[3,0],"7":[1,4],"8":[3,1],"9":[0,4],"10":[3,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/user/receiver/UserServiceReceiver.ts"],"sourcesContent":["import type { IFederationBridge } from '../../../domain/IFederationBridge';\nimport type { RocketChatFileAdapter } from '../../../infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatNotificationAdapter } from '../../../infrastructure/rocket-chat/adapters/Notification';\nimport type { RocketChatRoomAdapter } from '../../../infrastructure/rocket-chat/adapters/Room';\nimport type { RocketChatSettingsAdapter } from '../../../infrastructure/rocket-chat/adapters/Settings';\nimport type { RocketChatUserAdapter } from '../../../infrastructure/rocket-chat/adapters/User';\nimport { AbstractFederationApplicationService } from '../../AbstractFederationApplicationService';\nimport type { FederationUserTypingStatusEventDto } from '../../room/input/UserReceiverDto';\n\nexport class FederationUserServiceReceiver extends AbstractFederationApplicationService {\n\tprivate usersTypingByRoomIdCache: Map<string, Record<string, string>[]> = new Map();\n\n\tconstructor(\n\t\tprotected internalRoomAdapter: RocketChatRoomAdapter,\n\t\tprotected internalUserAdapter: RocketChatUserAdapter,\n\t\tprotected internalFileAdapter: RocketChatFileAdapter,\n\t\tprotected internalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tprotected internalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tprotected bridge: IFederationBridge,\n\t) {\n\t\tsuper(bridge, internalUserAdapter, internalFileAdapter, internalSettingsAdapter);\n\t}\n\n\tprivate handleUsersWhoStoppedTyping(externalRoomId: string, internalRoomId: string, externalUserIdsTyping: string[]): void {\n\t\tconst isTyping = false;\n\t\tconst notTypingAnymore = this.usersTypingByRoomIdCache\n\t\t\t.get(externalRoomId)\n\t\t\t?.filter((user) => !externalUserIdsTyping.includes(user.externalUserId));\n\n\t\tconst stillTyping = this.usersTypingByRoomIdCache\n\t\t\t.get(externalRoomId)\n\t\t\t?.filter((user) => externalUserIdsTyping.includes(user.externalUserId));\n\n\t\tnotTypingAnymore?.forEach((user) => this.internalNotificationAdapter.notifyUserTypingOnRoom(internalRoomId, user.username, isTyping));\n\t\tthis.usersTypingByRoomIdCache.set(externalRoomId, stillTyping || []);\n\t}\n\n\tpublic async onUserTyping(userTypingInput: FederationUserTypingStatusEventDto): Promise<void> {\n\t\tconst { externalUserIdsTyping, externalRoomId } = userTypingInput;\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByExternalId(externalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.usersTypingByRoomIdCache.has(externalRoomId)) {\n\t\t\tthis.handleUsersWhoStoppedTyping(externalRoomId, federatedRoom.getInternalId(), externalUserIdsTyping);\n\t\t}\n\n\t\tif (externalUserIdsTyping.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedUsers = await this.internalUserAdapter.getFederatedUsersByExternalIds(externalUserIdsTyping);\n\t\tif (federatedUsers.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isTyping = true;\n\n\t\tthis.usersTypingByRoomIdCache.set(\n\t\t\texternalRoomId,\n\t\t\tfederatedUsers.map((federatedUser) => {\n\t\t\t\tvoid this.internalNotificationAdapter.notifyUserTypingOnRoom(\n\t\t\t\t\tfederatedRoom.getInternalId(),\n\t\t\t\t\tfederatedUser.getUsername() as string,\n\t\t\t\t\tisTyping,\n\t\t\t\t);\n\n\t\t\t\treturn {\n\t\t\t\t\texternalUserId: federatedUser.getInternalId(),\n\t\t\t\t\tusername: federatedUser.getUsername() as string,\n\t\t\t\t};\n\t\t\t}),\n\t\t);\n\t}\n}\n"],"names":["FederationUserServiceReceiver","AbstractFederationApplicationService","handleUsersWhoStoppedTyping","externalRoomId","internalRoomId","externalUserIdsTyping","isTyping","notTypingAnymore","usersTypingByRoomIdCache","get","filter","user","includes","externalUserId","stillTyping","forEach","internalNotificationAdapter","notifyUserTypingOnRoom","username","set","onUserTyping","userTypingInput","federatedRoom","internalRoomAdapter","getFederatedRoomByExternalId","has","getInternalId","length","federatedUsers","internalUserAdapter","getFederatedUsersByExternalIds","map","federatedUser","getUsername","constructor","internalFileAdapter","internalSettingsAdapter","bridge","Map"],"mappings":";;;;+BASaA;;;eAAAA;;;sDAHwC;AAG9C,IAAA,AAAMA,gCAAN,MAAMA,sCAAsCC,0EAAoC;IAc9EC,4BAA4BC,cAAsB,EAAEC,cAAsB,EAAEC,qBAA+B,EAAQ;YAEjG,oCAIL;QALpB,MAAMC,WAAW;QACjB,MAAMC,oBAAmB,qCAAA,IAAI,CAACC,wBAAwB,CACpDC,GAAG,CAACN,6BADmB,yDAAA,mCAEtBO,MAAM,CAAC,CAACC,OAAS,CAACN,sBAAsBO,QAAQ,CAACD,KAAKE,cAAc;QAEvE,MAAMC,eAAc,sCAAA,IAAI,CAACN,wBAAwB,CAC/CC,GAAG,CAACN,6BADc,0DAAA,oCAEjBO,MAAM,CAAC,CAACC,OAASN,sBAAsBO,QAAQ,CAACD,KAAKE,cAAc;QAEtEN,6BAAAA,uCAAAA,iBAAkBQ,OAAO,CAAC,CAACJ,OAAS,IAAI,CAACK,2BAA2B,CAACC,sBAAsB,CAACb,gBAAgBO,KAAKO,QAAQ,EAAEZ;QAC3H,IAAI,CAACE,wBAAwB,CAACW,GAAG,CAAChB,gBAAgBW,eAAe,EAAE;IACpE;IAEA,MAAaM,aAAaC,eAAmD,EAAiB;QAC7F,MAAM,EAAEhB,qBAAqB,EAAEF,cAAc,EAAE,GAAGkB;QAClD,MAAMC,gBAAgB,MAAM,IAAI,CAACC,mBAAmB,CAACC,4BAA4B,CAACrB;QAClF,IAAI,CAACmB,eAAe;YACnB;QACD;QACA,IAAI,IAAI,CAACd,wBAAwB,CAACiB,GAAG,CAACtB,iBAAiB;YACtD,IAAI,CAACD,2BAA2B,CAACC,gBAAgBmB,cAAcI,aAAa,IAAIrB;QACjF;QAEA,IAAIA,sBAAsBsB,MAAM,KAAK,GAAG;YACvC;QACD;QAEA,MAAMC,iBAAiB,MAAM,IAAI,CAACC,mBAAmB,CAACC,8BAA8B,CAACzB;QACrF,IAAIuB,eAAeD,MAAM,KAAK,GAAG;YAChC;QACD;QAEA,MAAMrB,WAAW;QAEjB,IAAI,CAACE,wBAAwB,CAACW,GAAG,CAChChB,gBACAyB,eAAeG,GAAG,CAAC,CAACC;YACnB,KAAK,IAAI,CAAChB,2BAA2B,CAACC,sBAAsB,CAC3DK,cAAcI,aAAa,IAC3BM,cAAcC,WAAW,IACzB3B;YAGD,OAAO;gBACNO,gBAAgBmB,cAAcN,aAAa;gBAC3CR,UAAUc,cAAcC,WAAW;YACpC;QACD;IAEF;IA7DAC,YACC,AAAUX,mBAA0C,EACpD,AAAUM,mBAA0C,EACpD,AAAUM,mBAA0C,EACpD,AAAUnB,2BAA0D,EACpE,AAAUoB,uBAAkD,EAC5D,AAAUC,MAAyB,CAClC;QACD,KAAK,CAACA,QAAQR,qBAAqBM,qBAAqBC,+BAP9Cb,sBAAAA,0BACAM,sBAAAA,0BACAM,sBAAAA,0BACAnB,8BAAAA,kCACAoB,0BAAAA,8BACAC,SAAAA,aARH7B,2BAAkE,IAAI8B;IAW9E;AAqDD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/user/receiver/UserServiceReceiver.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ec8b8f80ed81bc1e26faaef56d84480d3590e085","contentHash":"d2fb34fa1061b8f58d0bab25a8dfbdd0236dbef47e7624c9bd9b91250327a8b2"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/user/sender/UserServiceSender.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/user/sender/UserServiceSender.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":43}},"3":{"start":{"line":11,"column":46},"end":{"line":11,"column":99}},"4":{"start":{"line":12,"column":34},"end":{"line":64,"column":1}},"5":{"start":{"line":14,"column":30},"end":{"line":14,"column":113}},"6":{"start":{"line":15,"column":8},"end":{"line":22,"column":9}},"7":{"start":{"line":16,"column":33},"end":{"line":16,"column":107}},"8":{"start":{"line":17,"column":12},"end":{"line":19,"column":13}},"9":{"start":{"line":18,"column":16},"end":{"line":18,"column":23}},"10":{"start":{"line":20,"column":12},"end":{"line":20,"column":101}},"11":{"start":{"line":21,"column":12},"end":{"line":21,"column":19}},"12":{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},"13":{"start":{"line":24,"column":12},"end":{"line":24,"column":19}},"14":{"start":{"line":26,"column":8},"end":{"line":26,"column":99}},"15":{"start":{"line":29,"column":30},"end":{"line":29,"column":105}},"16":{"start":{"line":30,"column":8},"end":{"line":37,"column":9}},"17":{"start":{"line":31,"column":33},"end":{"line":31,"column":99}},"18":{"start":{"line":32,"column":12},"end":{"line":34,"column":13}},"19":{"start":{"line":33,"column":16},"end":{"line":33,"column":23}},"20":{"start":{"line":35,"column":12},"end":{"line":35,"column":101}},"21":{"start":{"line":36,"column":12},"end":{"line":36,"column":19}},"22":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"23":{"start":{"line":39,"column":12},"end":{"line":39,"column":19}},"24":{"start":{"line":41,"column":47},"end":{"line":41,"column":121}},"25":{"start":{"line":42,"column":8},"end":{"line":44,"column":9}},"26":{"start":{"line":43,"column":12},"end":{"line":43,"column":19}},"27":{"start":{"line":45,"column":8},"end":{"line":45,"column":82}},"28":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"29":{"start":{"line":49,"column":12},"end":{"line":49,"column":19}},"30":{"start":{"line":51,"column":30},"end":{"line":51,"column":113}},"31":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"32":{"start":{"line":53,"column":12},"end":{"line":53,"column":19}},"33":{"start":{"line":55,"column":30},"end":{"line":55,"column":105}},"34":{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},"35":{"start":{"line":57,"column":12},"end":{"line":57,"column":19}},"36":{"start":{"line":59,"column":8},"end":{"line":59,"column":115}},"37":{"start":{"line":62,"column":8},"end":{"line":62,"column":311}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":4},"end":{"line":13,"column":5}},"loc":{"start":{"line":13,"column":51},"end":{"line":27,"column":5}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":28,"column":4},"end":{"line":28,"column":5}},"loc":{"start":{"line":28,"column":57},"end":{"line":46,"column":5}},"line":28},"3":{"name":"(anonymous_3)","decl":{"start":{"line":47,"column":4},"end":{"line":47,"column":5}},"loc":{"start":{"line":47,"column":67},"end":{"line":60,"column":5}},"line":47},"4":{"name":"(anonymous_4)","decl":{"start":{"line":61,"column":4},"end":{"line":61,"column":5}},"loc":{"start":{"line":61,"column":111},"end":{"line":63,"column":5}},"line":61}},"branchMap":{"0":{"loc":{"start":{"line":15,"column":8},"end":{"line":22,"column":9}},"type":"if","locations":[{"start":{"line":15,"column":8},"end":{"line":22,"column":9}},{"start":{"line":15,"column":8},"end":{"line":22,"column":9}}],"line":15},"1":{"loc":{"start":{"line":17,"column":12},"end":{"line":19,"column":13}},"type":"if","locations":[{"start":{"line":17,"column":12},"end":{"line":19,"column":13}},{"start":{"line":17,"column":12},"end":{"line":19,"column":13}}],"line":17},"2":{"loc":{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},"type":"if","locations":[{"start":{"line":23,"column":8},"end":{"line":25,"column":9}},{"start":{"line":23,"column":8},"end":{"line":25,"column":9}}],"line":23},"3":{"loc":{"start":{"line":30,"column":8},"end":{"line":37,"column":9}},"type":"if","locations":[{"start":{"line":30,"column":8},"end":{"line":37,"column":9}},{"start":{"line":30,"column":8},"end":{"line":37,"column":9}}],"line":30},"4":{"loc":{"start":{"line":32,"column":12},"end":{"line":34,"column":13}},"type":"if","locations":[{"start":{"line":32,"column":12},"end":{"line":34,"column":13}},{"start":{"line":32,"column":12},"end":{"line":34,"column":13}}],"line":32},"5":{"loc":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"type":"if","locations":[{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},{"start":{"line":38,"column":8},"end":{"line":40,"column":9}}],"line":38},"6":{"loc":{"start":{"line":42,"column":8},"end":{"line":44,"column":9}},"type":"if","locations":[{"start":{"line":42,"column":8},"end":{"line":44,"column":9}},{"start":{"line":42,"column":8},"end":{"line":44,"column":9}}],"line":42},"7":{"loc":{"start":{"line":42,"column":51},"end":{"line":42,"column":197}},"type":"binary-expr","locations":[{"start":{"line":42,"column":52},"end":{"line":42,"column":190}},{"start":{"line":42,"column":195},"end":{"line":42,"column":197}}],"line":42},"8":{"loc":{"start":{"line":42,"column":52},"end":{"line":42,"column":190}},"type":"cond-expr","locations":[{"start":{"line":42,"column":139},"end":{"line":42,"column":145}},{"start":{"line":42,"column":148},"end":{"line":42,"column":190}}],"line":42},"9":{"loc":{"start":{"line":42,"column":52},"end":{"line":42,"column":136}},"type":"binary-expr","locations":[{"start":{"line":42,"column":52},"end":{"line":42,"column":91}},{"start":{"line":42,"column":95},"end":{"line":42,"column":136}}],"line":42},"10":{"loc":{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},"type":"if","locations":[{"start":{"line":48,"column":8},"end":{"line":50,"column":9}},{"start":{"line":48,"column":8},"end":{"line":50,"column":9}}],"line":48},"11":{"loc":{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},"type":"if","locations":[{"start":{"line":52,"column":8},"end":{"line":54,"column":9}},{"start":{"line":52,"column":8},"end":{"line":54,"column":9}}],"line":52},"12":{"loc":{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},"type":"if","locations":[{"start":{"line":56,"column":8},"end":{"line":58,"column":9}},{"start":{"line":56,"column":8},"end":{"line":58,"column":9}}],"line":56}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":8,"6":8,"7":3,"8":3,"9":2,"10":1,"11":1,"12":5,"13":0,"14":5,"15":5,"16":5,"17":2,"18":2,"19":1,"20":1,"21":1,"22":3,"23":2,"24":1,"25":1,"26":0,"27":1,"28":4,"29":1,"30":3,"31":3,"32":1,"33":2,"34":2,"35":1,"36":1,"37":17},"f":{"0":1,"1":8,"2":5,"3":4,"4":17},"b":{"0":[3,5],"1":[2,1],"2":[0,5],"3":[2,3],"4":[1,1],"5":[2,1],"6":[0,1],"7":[1,1],"8":[0,1],"9":[1,1],"10":[1,3],"11":[1,2],"12":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/user/sender/UserServiceSender.ts"],"sourcesContent":["import type { IFederationBridge } from '../../../domain/IFederationBridge';\nimport type { RocketChatFileAdapter } from '../../../infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatRoomAdapter } from '../../../infrastructure/rocket-chat/adapters/Room';\nimport type { RocketChatSettingsAdapter } from '../../../infrastructure/rocket-chat/adapters/Settings';\nimport type { RocketChatUserAdapter } from '../../../infrastructure/rocket-chat/adapters/User';\nimport { AbstractFederationApplicationService } from '../../AbstractFederationApplicationService';\n\nexport class FederationUserServiceSender extends AbstractFederationApplicationService {\n\tconstructor(\n\t\tprotected internalRoomAdapter: RocketChatRoomAdapter,\n\t\tprotected internalUserAdapter: RocketChatUserAdapter,\n\t\tprotected internalFileAdapter: RocketChatFileAdapter,\n\t\tprotected internalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tprotected bridge: IFederationBridge,\n\t) {\n\t\tsuper(bridge, internalUserAdapter, internalFileAdapter, internalSettingsAdapter);\n\t}\n\n\tpublic async afterUserAvatarChanged(internalUsername: string): Promise<void> {\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByInternalUsername(internalUsername);\n\t\tif (!federatedUser) {\n\t\t\tconst internalUser = await this.internalUserAdapter.getInternalUserByUsername(internalUsername);\n\t\t\tif (!internalUser) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.createFederatedUserIncludingHomeserverUsingLocalInformation(internalUser._id);\n\t\t\treturn;\n\t\t}\n\n\t\tif (federatedUser.isRemote()) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.updateUserAvatarExternally(federatedUser.getInternalReference(), federatedUser);\n\t}\n\n\tpublic async afterUserRealNameChanged(internalUserId: string, name: string): Promise<void> {\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByInternalId(internalUserId);\n\t\tif (!federatedUser) {\n\t\t\tconst internalUser = await this.internalUserAdapter.getInternalUserById(internalUserId);\n\t\t\tif (!internalUser) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this.createFederatedUserIncludingHomeserverUsingLocalInformation(internalUser._id);\n\t\t\treturn;\n\t\t}\n\n\t\tif (federatedUser.isRemote()) {\n\t\t\treturn;\n\t\t}\n\t\tconst externalUserProfileInformation = await this.bridge.getUserProfileInformation(federatedUser.getExternalId());\n\t\tif (!federatedUser.shouldUpdateDisplayName(externalUserProfileInformation?.displayName || '')) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.bridge.setUserDisplayName(federatedUser.getExternalId(), name);\n\t}\n\n\tpublic async onUserTyping(internalUsername: string, internalRoomId: string, isTyping: boolean): Promise<void> {\n\t\tif (!this.internalSettingsAdapter.isTypingStatusEnabled()) {\n\t\t\treturn;\n\t\t}\n\t\tconst federatedUser = await this.internalUserAdapter.getFederatedUserByInternalUsername(internalUsername);\n\t\tif (!federatedUser) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst federatedRoom = await this.internalRoomAdapter.getFederatedRoomByInternalId(internalRoomId);\n\t\tif (!federatedRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.bridge.notifyUserTyping(federatedRoom.getExternalId(), federatedUser.getExternalId(), isTyping);\n\t}\n}\n"],"names":["FederationUserServiceSender","AbstractFederationApplicationService","afterUserAvatarChanged","internalUsername","federatedUser","internalUserAdapter","getFederatedUserByInternalUsername","internalUser","getInternalUserByUsername","createFederatedUserIncludingHomeserverUsingLocalInformation","_id","isRemote","updateUserAvatarExternally","getInternalReference","afterUserRealNameChanged","internalUserId","name","getFederatedUserByInternalId","getInternalUserById","externalUserProfileInformation","bridge","getUserProfileInformation","getExternalId","shouldUpdateDisplayName","displayName","setUserDisplayName","onUserTyping","internalRoomId","isTyping","internalSettingsAdapter","isTypingStatusEnabled","federatedRoom","internalRoomAdapter","getFederatedRoomByInternalId","notifyUserTyping","constructor","internalFileAdapter"],"mappings":";;;;+BAOaA;;;eAAAA;;;sDAFwC;AAE9C,IAAA,AAAMA,8BAAN,MAAMA,oCAAoCC,0EAAoC;IAWpF,MAAaC,uBAAuBC,gBAAwB,EAAiB;QAC5E,MAAMC,gBAAgB,MAAM,IAAI,CAACC,mBAAmB,CAACC,kCAAkC,CAACH;QACxF,IAAI,CAACC,eAAe;YACnB,MAAMG,eAAe,MAAM,IAAI,CAACF,mBAAmB,CAACG,yBAAyB,CAACL;YAC9E,IAAI,CAACI,cAAc;gBAClB;YACD;YACA,MAAM,IAAI,CAACE,2DAA2D,CAACF,aAAaG,GAAG;YACvF;QACD;QAEA,IAAIN,cAAcO,QAAQ,IAAI;YAC7B;QACD;QAEA,MAAM,IAAI,CAACC,0BAA0B,CAACR,cAAcS,oBAAoB,IAAIT;IAC7E;IAEA,MAAaU,yBAAyBC,cAAsB,EAAEC,IAAY,EAAiB;QAC1F,MAAMZ,gBAAgB,MAAM,IAAI,CAACC,mBAAmB,CAACY,4BAA4B,CAACF;QAClF,IAAI,CAACX,eAAe;YACnB,MAAMG,eAAe,MAAM,IAAI,CAACF,mBAAmB,CAACa,mBAAmB,CAACH;YACxE,IAAI,CAACR,cAAc;gBAClB;YACD;YACA,MAAM,IAAI,CAACE,2DAA2D,CAACF,aAAaG,GAAG;YACvF;QACD;QAEA,IAAIN,cAAcO,QAAQ,IAAI;YAC7B;QACD;QACA,MAAMQ,iCAAiC,MAAM,IAAI,CAACC,MAAM,CAACC,yBAAyB,CAACjB,cAAckB,aAAa;QAC9G,IAAI,CAAClB,cAAcmB,uBAAuB,CAACJ,CAAAA,2CAAAA,qDAAAA,+BAAgCK,WAAW,KAAI,KAAK;YAC9F;QACD;QAEA,MAAM,IAAI,CAACJ,MAAM,CAACK,kBAAkB,CAACrB,cAAckB,aAAa,IAAIN;IACrE;IAEA,MAAaU,aAAavB,gBAAwB,EAAEwB,cAAsB,EAAEC,QAAiB,EAAiB;QAC7G,IAAI,CAAC,IAAI,CAACC,uBAAuB,CAACC,qBAAqB,IAAI;YAC1D;QACD;QACA,MAAM1B,gBAAgB,MAAM,IAAI,CAACC,mBAAmB,CAACC,kCAAkC,CAACH;QACxF,IAAI,CAACC,eAAe;YACnB;QACD;QAEA,MAAM2B,gBAAgB,MAAM,IAAI,CAACC,mBAAmB,CAACC,4BAA4B,CAACN;QAClF,IAAI,CAACI,eAAe;YACnB;QACD;QAEA,MAAM,IAAI,CAACX,MAAM,CAACc,gBAAgB,CAACH,cAAcT,aAAa,IAAIlB,cAAckB,aAAa,IAAIM;IAClG;IAjEAO,YACC,AAAUH,mBAA0C,EACpD,AAAU3B,mBAA0C,EACpD,AAAU+B,mBAA0C,EACpD,AAAUP,uBAAkD,EAC5D,AAAUT,MAAyB,CAClC;QACD,KAAK,CAACA,QAAQf,qBAAqB+B,qBAAqBP,+BAN9CG,sBAAAA,0BACA3B,sBAAAA,0BACA+B,sBAAAA,0BACAP,0BAAAA,8BACAT,SAAAA;IAGX;AA0DD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/user/sender/UserServiceSender.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d38fb8dd47f523808b9a20efea903fc1860a480a","contentHash":"51e564f82fe7fdd894e9204561a4fb19e00b43ad43306d9ec168ef6546fcab0b"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/helpers/MatrixIdVerificationTypes.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/helpers/MatrixIdVerificationTypes.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":34}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":34}},"6":{"start":{"line":19,"column":39},"end":{"line":24,"column":5}},"7":{"start":{"line":20,"column":4},"end":{"line":20,"column":48}},"8":{"start":{"line":21,"column":4},"end":{"line":21,"column":52}},"9":{"start":{"line":22,"column":4},"end":{"line":22,"column":64}},"10":{"start":{"line":23,"column":4},"end":{"line":23,"column":30}},"11":{"start":{"line":25,"column":27},"end":{"line":25,"column":42}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":24},"end":{"line":12,"column":25}},"loc":{"start":{"line":12,"column":35},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":24},"end":{"line":15,"column":25}},"loc":{"start":{"line":15,"column":35},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":19,"column":39},"end":{"line":19,"column":40}},"loc":{"start":{"line":19,"column":68},"end":{"line":24,"column":1}},"line":19}},"branchMap":{},"s":{"0":1,"1":1,"2":2,"3":1,"4":1,"5":8,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1},"f":{"0":1,"1":1,"2":8,"3":1},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/helpers/MatrixIdVerificationTypes.ts"],"sourcesContent":["export const enum VerificationStatus {\n\tVERIFIED = 'VERIFIED',\n\tUNVERIFIED = 'UNVERIFIED',\n\tUNABLE_TO_VERIFY = 'UNABLE_TO_VERIFY',\n}\n\nexport const MATRIX_USER_IN_USE = 'M_USER_IN_USE';\n"],"names":["MATRIX_USER_IN_USE","VerificationStatus"],"mappings":";;;;;;;;;;;IAMaA,kBAAkB;eAAlBA;;IANKC,kBAAkB;eAAlBA;;;AAAX,IAAA,AAAWA,4CAAAA;;;;WAAAA;;AAMX,MAAMD,qBAAqB","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/helpers/MatrixIdVerificationTypes.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"aab94af4aaacd17f4a92d8b8416e16a638cf2ef0","contentHash":"f7e6f76eef4487c9c4aa57db0922dc02ea602055051d0f7d109ffcd8d1b164bb"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/Bridge.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/Bridge.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":28}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":57}},"5":{"start":{"line":13,"column":25},"end":{"line":13,"column":69}},"6":{"start":{"line":14,"column":22},"end":{"line":14,"column":63}},"7":{"start":{"line":15,"column":35},"end":{"line":15,"column":92}},"8":{"start":{"line":16,"column":25},"end":{"line":16,"column":65}},"9":{"start":{"line":17,"column":24},"end":{"line":17,"column":63}},"10":{"start":{"line":18,"column":30},"end":{"line":18,"column":75}},"11":{"start":{"line":19,"column":31},"end":{"line":19,"column":84}},"12":{"start":{"line":20,"column":25},"end":{"line":20,"column":72}},"13":{"start":{"line":21,"column":26},"end":{"line":21,"column":63}},"14":{"start":{"line":22,"column":29},"end":{"line":22,"column":69}},"15":{"start":{"line":23,"column":35},"end":{"line":23,"column":81}},"16":{"start":{"line":25,"column":4},"end":{"line":25,"column":51}},"17":{"start":{"line":25,"column":39},"end":{"line":25,"column":51}},"18":{"start":{"line":26,"column":28},"end":{"line":26,"column":41}},"19":{"start":{"line":27,"column":27},"end":{"line":27,"column":40}},"20":{"start":{"line":28,"column":4},"end":{"line":30,"column":20}},"21":{"start":{"line":29,"column":8},"end":{"line":29,"column":66}},"22":{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},"23":{"start":{"line":34,"column":8},"end":{"line":34,"column":19}},"24":{"start":{"line":36,"column":4},"end":{"line":40,"column":5}},"25":{"start":{"line":37,"column":8},"end":{"line":39,"column":10}},"26":{"start":{"line":41,"column":16},"end":{"line":41,"column":53}},"27":{"start":{"line":42,"column":4},"end":{"line":44,"column":5}},"28":{"start":{"line":43,"column":8},"end":{"line":43,"column":30}},"29":{"start":{"line":45,"column":17},"end":{"line":47,"column":5}},"30":{"start":{"line":48,"column":32},"end":{"line":48,"column":88}},"31":{"start":{"line":49,"column":4},"end":{"line":58,"column":5}},"32":{"start":{"line":50,"column":8},"end":{"line":57,"column":9}},"33":{"start":{"line":51,"column":23},"end":{"line":51,"column":95}},"34":{"start":{"line":52,"column":12},"end":{"line":56,"column":13}},"35":{"start":{"line":53,"column":16},"end":{"line":53,"column":57}},"36":{"start":{"line":55,"column":16},"end":{"line":55,"column":39}},"37":{"start":{"line":59,"column":4},"end":{"line":59,"column":25}},"38":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"39":{"start":{"line":61,"column":8},"end":{"line":61,"column":31}},"40":{"start":{"line":63,"column":4},"end":{"line":63,"column":18}},"41":{"start":{"line":66,"column":48},"end":{"line":66,"column":54}},"42":{"start":{"line":67,"column":45},"end":{"line":67,"column":54}},"43":{"start":{"line":68,"column":19},"end":{"line":730,"column":1}},"44":{"start":{"line":70,"column":8},"end":{"line":72,"column":9}},"45":{"start":{"line":71,"column":12},"end":{"line":71,"column":19}},"46":{"start":{"line":73,"column":8},"end":{"line":73,"column":43}},"47":{"start":{"line":74,"column":8},"end":{"line":111,"column":9}},"48":{"start":{"line":75,"column":12},"end":{"line":75,"column":30}},"49":{"start":{"line":76,"column":12},"end":{"line":76,"column":40}},"50":{"start":{"line":77,"column":12},"end":{"line":103,"column":13}},"51":{"start":{"line":78,"column":16},"end":{"line":78,"column":85}},"52":{"start":{"line":79,"column":16},"end":{"line":101,"column":19}},"53":{"start":{"line":99,"column":10},"end":{"line":99,"column":35}},"54":{"start":{"line":102,"column":16},"end":{"line":102,"column":38}},"55":{"start":{"line":105,"column":12},"end":{"line":108,"column":15}},"56":{"start":{"line":110,"column":12},"end":{"line":110,"column":48}},"57":{"start":{"line":114,"column":8},"end":{"line":116,"column":9}},"58":{"start":{"line":115,"column":12},"end":{"line":115,"column":19}},"59":{"start":{"line":117,"column":8},"end":{"line":123,"column":11}},"60":{"start":{"line":120,"column":12},"end":{"line":120,"column":149}},"61":{"start":{"line":121,"column":12},"end":{"line":121,"column":35}},"62":{"start":{"line":122,"column":12},"end":{"line":122,"column":22}},"63":{"start":{"line":126,"column":8},"end":{"line":136,"column":9}},"64":{"start":{"line":127,"column":40},"end":{"line":127,"column":140}},"65":{"start":{"line":128,"column":12},"end":{"line":133,"column":14}},"66":{"start":{"line":139,"column":8},"end":{"line":145,"column":9}},"67":{"start":{"line":140,"column":12},"end":{"line":142,"column":60}},"68":{"start":{"line":144,"column":12},"end":{"line":144,"column":57}},"69":{"start":{"line":149,"column":23},"end":{"line":149,"column":116}},"70":{"start":{"line":150,"column":28},"end":{"line":150,"column":304}},"71":{"start":{"line":150,"column":65},"end":{"line":150,"column":125}},"72":{"start":{"line":151,"column":8},"end":{"line":153,"column":9}},"73":{"start":{"line":152,"column":12},"end":{"line":152,"column":22}},"74":{"start":{"line":154,"column":8},"end":{"line":157,"column":16}},"75":{"start":{"line":154,"column":38},"end":{"line":154,"column":247}},"76":{"start":{"line":154,"column":263},"end":{"line":157,"column":13}},"77":{"start":{"line":160,"column":30},"end":{"line":162,"column":9}},"78":{"start":{"line":163,"column":30},"end":{"line":166,"column":9}},"79":{"start":{"line":167,"column":24},"end":{"line":167,"column":160}},"80":{"start":{"line":168,"column":30},"end":{"line":168,"column":131}},"81":{"start":{"line":169,"column":28},"end":{"line":169,"column":83}},"82":{"start":{"line":169,"column":49},"end":{"line":169,"column":74}},"83":{"start":{"line":170,"column":8},"end":{"line":172,"column":9}},"84":{"start":{"line":171,"column":12},"end":{"line":171,"column":19}},"85":{"start":{"line":173,"column":25},"end":{"line":173,"column":79}},"86":{"start":{"line":174,"column":8},"end":{"line":176,"column":9}},"87":{"start":{"line":175,"column":12},"end":{"line":175,"column":19}},"88":{"start":{"line":177,"column":8},"end":{"line":184,"column":10}},"89":{"start":{"line":187,"column":8},"end":{"line":191,"column":9}},"90":{"start":{"line":188,"column":12},"end":{"line":188,"column":109}},"91":{"start":{"line":194,"column":8},"end":{"line":198,"column":9}},"92":{"start":{"line":195,"column":12},"end":{"line":195,"column":101}},"93":{"start":{"line":201,"column":40},"end":{"line":201,"column":49}},"94":{"start":{"line":202,"column":46},"end":{"line":202,"column":103}},"95":{"start":{"line":202,"column":72},"end":{"line":202,"column":102}},"96":{"start":{"line":203,"column":53},"end":{"line":203,"column":108}},"97":{"start":{"line":204,"column":54},"end":{"line":204,"column":166}},"98":{"start":{"line":204,"column":108},"end":{"line":204,"column":137}},"99":{"start":{"line":204,"column":153},"end":{"line":204,"column":165}},"100":{"start":{"line":205,"column":8},"end":{"line":205,"column":126}},"101":{"start":{"line":205,"column":43},"end":{"line":205,"column":124}},"102":{"start":{"line":206,"column":8},"end":{"line":206,"column":39}},"103":{"start":{"line":209,"column":40},"end":{"line":209,"column":123}},"104":{"start":{"line":210,"column":8},"end":{"line":227,"column":9}},"105":{"start":{"line":211,"column":29},"end":{"line":215,"column":14}},"106":{"start":{"line":216,"column":12},"end":{"line":221,"column":13}},"107":{"start":{"line":217,"column":37},"end":{"line":217,"column":58}},"108":{"start":{"line":218,"column":16},"end":{"line":220,"column":17}},"109":{"start":{"line":219,"column":20},"end":{"line":219,"column":82}},"110":{"start":{"line":222,"column":12},"end":{"line":224,"column":13}},"111":{"start":{"line":223,"column":16},"end":{"line":223,"column":80}},"112":{"start":{"line":226,"column":12},"end":{"line":226,"column":82}},"113":{"start":{"line":228,"column":8},"end":{"line":228,"column":78}},"114":{"start":{"line":231,"column":8},"end":{"line":233,"column":9}},"115":{"start":{"line":232,"column":12},"end":{"line":232,"column":96}},"116":{"start":{"line":234,"column":29},"end":{"line":234,"column":119}},"117":{"start":{"line":235,"column":24},"end":{"line":235,"column":60}},"118":{"start":{"line":236,"column":8},"end":{"line":241,"column":11}},"119":{"start":{"line":242,"column":8},"end":{"line":242,"column":28}},"120":{"start":{"line":245,"column":8},"end":{"line":249,"column":9}},"121":{"start":{"line":246,"column":12},"end":{"line":246,"column":92}},"122":{"start":{"line":252,"column":23},"end":{"line":252,"column":71}},"123":{"start":{"line":253,"column":27},"end":{"line":253,"column":77}},"124":{"start":{"line":254,"column":23},"end":{"line":254,"column":61}},"125":{"start":{"line":255,"column":27},"end":{"line":268,"column":10}},"126":{"start":{"line":269,"column":8},"end":{"line":269,"column":34}},"127":{"start":{"line":272,"column":8},"end":{"line":286,"column":9}},"128":{"start":{"line":273,"column":30},"end":{"line":282,"column":14}},"129":{"start":{"line":283,"column":12},"end":{"line":283,"column":29}},"130":{"start":{"line":285,"column":12},"end":{"line":285,"column":61}},"131":{"start":{"line":289,"column":21},"end":{"line":293,"column":11}},"132":{"start":{"line":294,"column":26},"end":{"line":307,"column":10}},"133":{"start":{"line":308,"column":8},"end":{"line":308,"column":25}},"134":{"start":{"line":311,"column":46},"end":{"line":317,"column":10}},"135":{"start":{"line":318,"column":26},"end":{"line":331,"column":10}},"136":{"start":{"line":332,"column":8},"end":{"line":332,"column":25}},"137":{"start":{"line":335,"column":8},"end":{"line":371,"column":9}},"138":{"start":{"line":337,"column":27},"end":{"line":337,"column":103}},"139":{"start":{"line":338,"column":30},"end":{"line":359,"column":14}},"140":{"start":{"line":360,"column":12},"end":{"line":360,"column":29}},"141":{"start":{"line":363,"column":12},"end":{"line":366,"column":15}},"142":{"start":{"line":367,"column":12},"end":{"line":369,"column":13}},"143":{"start":{"line":368,"column":16},"end":{"line":368,"column":53}},"144":{"start":{"line":370,"column":12},"end":{"line":370,"column":22}},"145":{"start":{"line":374,"column":8},"end":{"line":410,"column":9}},"146":{"start":{"line":376,"column":27},"end":{"line":376,"column":103}},"147":{"start":{"line":377,"column":30},"end":{"line":398,"column":14}},"148":{"start":{"line":399,"column":12},"end":{"line":399,"column":29}},"149":{"start":{"line":402,"column":12},"end":{"line":405,"column":15}},"150":{"start":{"line":406,"column":12},"end":{"line":408,"column":13}},"151":{"start":{"line":407,"column":16},"end":{"line":407,"column":53}},"152":{"start":{"line":409,"column":12},"end":{"line":409,"column":22}},"153":{"start":{"line":413,"column":46},"end":{"line":419,"column":10}},"154":{"start":{"line":420,"column":26},"end":{"line":430,"column":10}},"155":{"start":{"line":431,"column":8},"end":{"line":431,"column":25}},"156":{"start":{"line":434,"column":8},"end":{"line":434,"column":83}},"157":{"start":{"line":437,"column":25},"end":{"line":437,"column":120}},"158":{"start":{"line":438,"column":8},"end":{"line":440,"column":9}},"159":{"start":{"line":439,"column":12},"end":{"line":439,"column":61}},"160":{"start":{"line":441,"column":8},"end":{"line":441,"column":29}},"161":{"start":{"line":444,"column":27},"end":{"line":444,"column":71}},"162":{"start":{"line":445,"column":8},"end":{"line":445,"column":37}},"163":{"start":{"line":448,"column":8},"end":{"line":448,"column":130}},"164":{"start":{"line":451,"column":8},"end":{"line":451,"column":74}},"165":{"start":{"line":454,"column":8},"end":{"line":459,"column":5}},"166":{"start":{"line":462,"column":8},"end":{"line":466,"column":9}},"167":{"start":{"line":463,"column":12},"end":{"line":463,"column":86}},"168":{"start":{"line":469,"column":8},"end":{"line":469,"column":98}},"169":{"start":{"line":472,"column":8},"end":{"line":472,"column":120}},"170":{"start":{"line":475,"column":8},"end":{"line":475,"column":118}},"171":{"start":{"line":478,"column":8},"end":{"line":478,"column":97}},"172":{"start":{"line":481,"column":24},"end":{"line":487,"column":10}},"173":{"start":{"line":488,"column":8},"end":{"line":488,"column":23}},"174":{"start":{"line":491,"column":40},"end":{"line":495,"column":11}},"175":{"start":{"line":496,"column":8},"end":{"line":511,"column":11}},"176":{"start":{"line":514,"column":8},"end":{"line":542,"column":9}},"177":{"start":{"line":516,"column":27},"end":{"line":516,"column":102}},"178":{"start":{"line":517,"column":44},"end":{"line":530,"column":14}},"179":{"start":{"line":531,"column":12},"end":{"line":531,"column":29}},"180":{"start":{"line":534,"column":12},"end":{"line":537,"column":15}},"181":{"start":{"line":538,"column":12},"end":{"line":540,"column":13}},"182":{"start":{"line":539,"column":16},"end":{"line":539,"column":53}},"183":{"start":{"line":541,"column":12},"end":{"line":541,"column":22}},"184":{"start":{"line":545,"column":8},"end":{"line":578,"column":9}},"185":{"start":{"line":547,"column":27},"end":{"line":547,"column":102}},"186":{"start":{"line":548,"column":44},"end":{"line":566,"column":14}},"187":{"start":{"line":567,"column":12},"end":{"line":567,"column":29}},"188":{"start":{"line":570,"column":12},"end":{"line":573,"column":15}},"189":{"start":{"line":574,"column":12},"end":{"line":576,"column":13}},"190":{"start":{"line":575,"column":16},"end":{"line":575,"column":53}},"191":{"start":{"line":577,"column":12},"end":{"line":577,"column":22}},"192":{"start":{"line":581,"column":36},"end":{"line":585,"column":9}},"193":{"start":{"line":586,"column":36},"end":{"line":590,"column":9}},"194":{"start":{"line":591,"column":36},"end":{"line":595,"column":9}},"195":{"start":{"line":596,"column":8},"end":{"line":598,"column":9}},"196":{"start":{"line":597,"column":12},"end":{"line":597,"column":68}},"197":{"start":{"line":599,"column":8},"end":{"line":601,"column":9}},"198":{"start":{"line":600,"column":12},"end":{"line":600,"column":68}},"199":{"start":{"line":602,"column":8},"end":{"line":604,"column":9}},"200":{"start":{"line":603,"column":12},"end":{"line":603,"column":68}},"201":{"start":{"line":605,"column":8},"end":{"line":605,"column":63}},"202":{"start":{"line":608,"column":8},"end":{"line":608,"column":90}},"203":{"start":{"line":611,"column":8},"end":{"line":623,"column":9}},"204":{"start":{"line":612,"column":27},"end":{"line":612,"column":112}},"205":{"start":{"line":613,"column":12},"end":{"line":613,"column":26}},"206":{"start":{"line":616,"column":12},"end":{"line":619,"column":15}},"207":{"start":{"line":620,"column":12},"end":{"line":622,"column":13}},"208":{"start":{"line":621,"column":16},"end":{"line":621,"column":53}},"209":{"start":{"line":626,"column":8},"end":{"line":632,"column":9}},"210":{"start":{"line":628,"column":30},"end":{"line":628,"column":107}},"211":{"start":{"line":629,"column":12},"end":{"line":629,"column":315}},"212":{"start":{"line":629,"column":60},"end":{"line":629,"column":173}},"213":{"start":{"line":635,"column":8},"end":{"line":641,"column":9}},"214":{"start":{"line":637,"column":30},"end":{"line":637,"column":107}},"215":{"start":{"line":638,"column":12},"end":{"line":638,"column":317}},"216":{"start":{"line":638,"column":60},"end":{"line":638,"column":174}},"217":{"start":{"line":644,"column":8},"end":{"line":644,"column":98}},"218":{"start":{"line":647,"column":8},"end":{"line":647,"column":100}},"219":{"start":{"line":650,"column":8},"end":{"line":650,"column":95}},"220":{"start":{"line":653,"column":8},"end":{"line":653,"column":101}},"221":{"start":{"line":655,"column":63},"end":{"line":655,"column":173}},"222":{"start":{"line":655,"column":110},"end":{"line":655,"column":172}},"223":{"start":{"line":656,"column":8},"end":{"line":656,"column":40}},"224":{"start":{"line":657,"column":33},"end":{"line":657,"column":88}},"225":{"start":{"line":658,"column":8},"end":{"line":686,"column":11}},"226":{"start":{"line":665,"column":34},"end":{"line":665,"column":51}},"227":{"start":{"line":671,"column":20},"end":{"line":673,"column":21}},"228":{"start":{"line":672,"column":24},"end":{"line":672,"column":31}},"229":{"start":{"line":674,"column":20},"end":{"line":674,"column":45}},"230":{"start":{"line":677,"column":20},"end":{"line":677,"column":47}},"231":{"start":{"line":681,"column":38},"end":{"line":681,"column":55}},"232":{"start":{"line":682,"column":24},"end":{"line":682,"column":49}},"233":{"start":{"line":689,"column":8},"end":{"line":697,"column":10}},"234":{"start":{"line":700,"column":8},"end":{"line":702,"column":9}},"235":{"start":{"line":701,"column":12},"end":{"line":701,"column":63}},"236":{"start":{"line":703,"column":44},"end":{"line":706,"column":48}},"237":{"start":{"line":707,"column":8},"end":{"line":709,"column":10}},"238":{"start":{"line":715,"column":19},"end":{"line":719,"column":10}},"239":{"start":{"line":720,"column":8},"end":{"line":722,"column":9}},"240":{"start":{"line":721,"column":12},"end":{"line":721,"column":64}},"241":{"start":{"line":725,"column":8},"end":{"line":725,"column":49}},"242":{"start":{"line":726,"column":8},"end":{"line":726,"column":41}},"243":{"start":{"line":727,"column":8},"end":{"line":727,"column":31}},"244":{"start":{"line":728,"column":8},"end":{"line":728,"column":44}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_getRequireWildcardCache","decl":{"start":{"line":24,"column":9},"end":{"line":24,"column":33}},"loc":{"start":{"line":24,"column":47},"end":{"line":31,"column":1}},"line":24},"2":{"name":"(anonymous_2)","decl":{"start":{"line":28,"column":39},"end":{"line":28,"column":40}},"loc":{"start":{"line":28,"column":61},"end":{"line":30,"column":5}},"line":28},"3":{"name":"_interop_require_wildcard","decl":{"start":{"line":32,"column":9},"end":{"line":32,"column":34}},"loc":{"start":{"line":32,"column":53},"end":{"line":64,"column":1}},"line":32},"4":{"name":"(anonymous_4)","decl":{"start":{"line":69,"column":4},"end":{"line":69,"column":5}},"loc":{"start":{"line":69,"column":18},"end":{"line":112,"column":5}},"line":69},"5":{"name":"(anonymous_5)","decl":{"start":{"line":83,"column":29},"end":{"line":83,"column":30}},"loc":{"start":{"line":83,"column":49},"end":{"line":100,"column":21}},"line":83},"6":{"name":"(anonymous_6)","decl":{"start":{"line":113,"column":4},"end":{"line":113,"column":5}},"loc":{"start":{"line":113,"column":17},"end":{"line":124,"column":5}},"line":113},"7":{"name":"(anonymous_7)","decl":{"start":{"line":117,"column":27},"end":{"line":117,"column":28}},"loc":{"start":{"line":117,"column":44},"end":{"line":123,"column":9}},"line":117},"8":{"name":"(anonymous_8)","decl":{"start":{"line":125,"column":4},"end":{"line":125,"column":5}},"loc":{"start":{"line":125,"column":52},"end":{"line":137,"column":5}},"line":125},"9":{"name":"(anonymous_9)","decl":{"start":{"line":138,"column":4},"end":{"line":138,"column":5}},"loc":{"start":{"line":138,"column":63},"end":{"line":146,"column":5}},"line":138},"10":{"name":"(anonymous_10)","decl":{"start":{"line":147,"column":4},"end":{"line":147,"column":5}},"loc":{"start":{"line":147,"column":93},"end":{"line":158,"column":5}},"line":147},"11":{"name":"(anonymous_11)","decl":{"start":{"line":150,"column":56},"end":{"line":150,"column":57}},"loc":{"start":{"line":150,"column":65},"end":{"line":150,"column":125}},"line":150},"12":{"name":"(anonymous_12)","decl":{"start":{"line":154,"column":29},"end":{"line":154,"column":30}},"loc":{"start":{"line":154,"column":38},"end":{"line":154,"column":247}},"line":154},"13":{"name":"(anonymous_13)","decl":{"start":{"line":154,"column":253},"end":{"line":154,"column":254}},"loc":{"start":{"line":154,"column":263},"end":{"line":157,"column":13}},"line":154},"14":{"name":"(anonymous_14)","decl":{"start":{"line":159,"column":4},"end":{"line":159,"column":5}},"loc":{"start":{"line":159,"column":54},"end":{"line":185,"column":5}},"line":159},"15":{"name":"(anonymous_15)","decl":{"start":{"line":169,"column":41},"end":{"line":169,"column":42}},"loc":{"start":{"line":169,"column":49},"end":{"line":169,"column":74}},"line":169},"16":{"name":"(anonymous_16)","decl":{"start":{"line":186,"column":4},"end":{"line":186,"column":5}},"loc":{"start":{"line":186,"column":77},"end":{"line":192,"column":5}},"line":186},"17":{"name":"(anonymous_17)","decl":{"start":{"line":193,"column":4},"end":{"line":193,"column":5}},"loc":{"start":{"line":193,"column":51},"end":{"line":199,"column":5}},"line":193},"18":{"name":"(anonymous_18)","decl":{"start":{"line":200,"column":4},"end":{"line":200,"column":5}},"loc":{"start":{"line":200,"column":38},"end":{"line":207,"column":5}},"line":200},"19":{"name":"(anonymous_19)","decl":{"start":{"line":202,"column":60},"end":{"line":202,"column":61}},"loc":{"start":{"line":202,"column":72},"end":{"line":202,"column":102}},"line":202},"20":{"name":"(anonymous_20)","decl":{"start":{"line":204,"column":98},"end":{"line":204,"column":99}},"loc":{"start":{"line":204,"column":108},"end":{"line":204,"column":137}},"line":204},"21":{"name":"(anonymous_21)","decl":{"start":{"line":204,"column":143},"end":{"line":204,"column":144}},"loc":{"start":{"line":204,"column":153},"end":{"line":204,"column":165}},"line":204},"22":{"name":"(anonymous_22)","decl":{"start":{"line":205,"column":26},"end":{"line":205,"column":27}},"loc":{"start":{"line":205,"column":43},"end":{"line":205,"column":124}},"line":205},"23":{"name":"(anonymous_23)","decl":{"start":{"line":208,"column":4},"end":{"line":208,"column":5}},"loc":{"start":{"line":208,"column":45},"end":{"line":229,"column":5}},"line":208},"24":{"name":"(anonymous_24)","decl":{"start":{"line":230,"column":4},"end":{"line":230,"column":5}},"loc":{"start":{"line":230,"column":56},"end":{"line":243,"column":5}},"line":230},"25":{"name":"(anonymous_25)","decl":{"start":{"line":244,"column":4},"end":{"line":244,"column":5}},"loc":{"start":{"line":244,"column":58},"end":{"line":250,"column":5}},"line":244},"26":{"name":"(anonymous_26)","decl":{"start":{"line":251,"column":4},"end":{"line":251,"column":5}},"loc":{"start":{"line":251,"column":90},"end":{"line":270,"column":5}},"line":251},"27":{"name":"(anonymous_27)","decl":{"start":{"line":271,"column":4},"end":{"line":271,"column":5}},"loc":{"start":{"line":271,"column":65},"end":{"line":287,"column":5}},"line":271},"28":{"name":"(anonymous_28)","decl":{"start":{"line":288,"column":4},"end":{"line":288,"column":5}},"loc":{"start":{"line":288,"column":89},"end":{"line":309,"column":5}},"line":288},"29":{"name":"(anonymous_29)","decl":{"start":{"line":310,"column":4},"end":{"line":310,"column":5}},"loc":{"start":{"line":310,"column":136},"end":{"line":333,"column":5}},"line":310},"30":{"name":"(anonymous_30)","decl":{"start":{"line":334,"column":4},"end":{"line":334,"column":5}},"loc":{"start":{"line":334,"column":108},"end":{"line":372,"column":5}},"line":334},"31":{"name":"(anonymous_31)","decl":{"start":{"line":373,"column":4},"end":{"line":373,"column":5}},"loc":{"start":{"line":373,"column":129},"end":{"line":411,"column":5}},"line":373},"32":{"name":"(anonymous_32)","decl":{"start":{"line":412,"column":4},"end":{"line":412,"column":5}},"loc":{"start":{"line":412,"column":112},"end":{"line":432,"column":5}},"line":412},"33":{"name":"(anonymous_33)","decl":{"start":{"line":433,"column":4},"end":{"line":433,"column":5}},"loc":{"start":{"line":433,"column":23},"end":{"line":435,"column":5}},"line":433},"34":{"name":"(anonymous_34)","decl":{"start":{"line":436,"column":4},"end":{"line":436,"column":5}},"loc":{"start":{"line":436,"column":63},"end":{"line":442,"column":5}},"line":436},"35":{"name":"(anonymous_35)","decl":{"start":{"line":443,"column":4},"end":{"line":443,"column":5}},"loc":{"start":{"line":443,"column":58},"end":{"line":446,"column":5}},"line":443},"36":{"name":"(anonymous_36)","decl":{"start":{"line":447,"column":4},"end":{"line":447,"column":5}},"loc":{"start":{"line":447,"column":44},"end":{"line":449,"column":5}},"line":447},"37":{"name":"(anonymous_37)","decl":{"start":{"line":450,"column":4},"end":{"line":450,"column":5}},"loc":{"start":{"line":450,"column":56},"end":{"line":452,"column":5}},"line":450},"38":{"name":"(anonymous_38)","decl":{"start":{"line":453,"column":4},"end":{"line":453,"column":5}},"loc":{"start":{"line":453,"column":35},"end":{"line":460,"column":5}},"line":453},"39":{"name":"(anonymous_39)","decl":{"start":{"line":461,"column":4},"end":{"line":461,"column":5}},"loc":{"start":{"line":461,"column":52},"end":{"line":467,"column":5}},"line":461},"40":{"name":"(anonymous_40)","decl":{"start":{"line":468,"column":4},"end":{"line":468,"column":5}},"loc":{"start":{"line":468,"column":76},"end":{"line":470,"column":5}},"line":468},"41":{"name":"(anonymous_41)","decl":{"start":{"line":471,"column":4},"end":{"line":471,"column":5}},"loc":{"start":{"line":471,"column":91},"end":{"line":473,"column":5}},"line":471},"42":{"name":"(anonymous_42)","decl":{"start":{"line":474,"column":4},"end":{"line":474,"column":5}},"loc":{"start":{"line":474,"column":71},"end":{"line":476,"column":5}},"line":474},"43":{"name":"(anonymous_43)","decl":{"start":{"line":477,"column":4},"end":{"line":477,"column":5}},"loc":{"start":{"line":477,"column":69},"end":{"line":479,"column":5}},"line":477},"44":{"name":"(anonymous_44)","decl":{"start":{"line":480,"column":4},"end":{"line":480,"column":5}},"loc":{"start":{"line":480,"column":89},"end":{"line":489,"column":5}},"line":480},"45":{"name":"(anonymous_45)","decl":{"start":{"line":490,"column":4},"end":{"line":490,"column":5}},"loc":{"start":{"line":490,"column":89},"end":{"line":512,"column":5}},"line":490},"46":{"name":"(anonymous_46)","decl":{"start":{"line":513,"column":4},"end":{"line":513,"column":5}},"loc":{"start":{"line":513,"column":87},"end":{"line":543,"column":5}},"line":513},"47":{"name":"(anonymous_47)","decl":{"start":{"line":544,"column":4},"end":{"line":544,"column":5}},"loc":{"start":{"line":544,"column":108},"end":{"line":579,"column":5}},"line":544},"48":{"name":"(anonymous_48)","decl":{"start":{"line":580,"column":4},"end":{"line":580,"column":5}},"loc":{"start":{"line":580,"column":40},"end":{"line":606,"column":5}},"line":580},"49":{"name":"(anonymous_49)","decl":{"start":{"line":607,"column":4},"end":{"line":607,"column":5}},"loc":{"start":{"line":607,"column":28},"end":{"line":609,"column":5}},"line":607},"50":{"name":"(anonymous_50)","decl":{"start":{"line":610,"column":4},"end":{"line":610,"column":5}},"loc":{"start":{"line":610,"column":60},"end":{"line":624,"column":5}},"line":610},"51":{"name":"(anonymous_51)","decl":{"start":{"line":625,"column":4},"end":{"line":625,"column":5}},"loc":{"start":{"line":625,"column":54},"end":{"line":633,"column":5}},"line":625},"52":{"name":"(anonymous_52)","decl":{"start":{"line":629,"column":51},"end":{"line":629,"column":52}},"loc":{"start":{"line":629,"column":60},"end":{"line":629,"column":173}},"line":629},"53":{"name":"(anonymous_53)","decl":{"start":{"line":634,"column":4},"end":{"line":634,"column":5}},"loc":{"start":{"line":634,"column":55},"end":{"line":642,"column":5}},"line":634},"54":{"name":"(anonymous_54)","decl":{"start":{"line":638,"column":51},"end":{"line":638,"column":52}},"loc":{"start":{"line":638,"column":60},"end":{"line":638,"column":174}},"line":638},"55":{"name":"(anonymous_55)","decl":{"start":{"line":643,"column":4},"end":{"line":643,"column":5}},"loc":{"start":{"line":643,"column":64},"end":{"line":645,"column":5}},"line":643},"56":{"name":"(anonymous_56)","decl":{"start":{"line":646,"column":4},"end":{"line":646,"column":5}},"loc":{"start":{"line":646,"column":66},"end":{"line":648,"column":5}},"line":646},"57":{"name":"(anonymous_57)","decl":{"start":{"line":649,"column":4},"end":{"line":649,"column":5}},"loc":{"start":{"line":649,"column":54},"end":{"line":651,"column":5}},"line":649},"58":{"name":"(anonymous_58)","decl":{"start":{"line":652,"column":4},"end":{"line":652,"column":5}},"loc":{"start":{"line":652,"column":27},"end":{"line":687,"column":5}},"line":652},"59":{"name":"(anonymous_59)","decl":{"start":{"line":655,"column":92},"end":{"line":655,"column":93}},"loc":{"start":{"line":655,"column":110},"end":{"line":655,"column":172}},"line":655},"60":{"name":"(anonymous_60)","decl":{"start":{"line":664,"column":25},"end":{"line":664,"column":26}},"loc":{"start":{"line":664,"column":36},"end":{"line":675,"column":17}},"line":664},"61":{"name":"(anonymous_61)","decl":{"start":{"line":676,"column":23},"end":{"line":676,"column":24}},"loc":{"start":{"line":676,"column":40},"end":{"line":678,"column":17}},"line":676},"62":{"name":"(anonymous_62)","decl":{"start":{"line":680,"column":38},"end":{"line":680,"column":39}},"loc":{"start":{"line":680,"column":49},"end":{"line":683,"column":21}},"line":680},"63":{"name":"(anonymous_63)","decl":{"start":{"line":688,"column":4},"end":{"line":688,"column":5}},"loc":{"start":{"line":688,"column":60},"end":{"line":698,"column":5}},"line":688},"64":{"name":"(anonymous_64)","decl":{"start":{"line":699,"column":4},"end":{"line":699,"column":5}},"loc":{"start":{"line":699,"column":17},"end":{"line":710,"column":5}},"line":699},"65":{"name":"(anonymous_65)","decl":{"start":{"line":711,"column":4},"end":{"line":711,"column":5}},"loc":{"start":{"line":711,"column":30},"end":{"line":723,"column":5}},"line":711},"66":{"name":"(anonymous_66)","decl":{"start":{"line":724,"column":4},"end":{"line":724,"column":5}},"loc":{"start":{"line":724,"column":47},"end":{"line":729,"column":5}},"line":724}},"branchMap":{"0":{"loc":{"start":{"line":25,"column":4},"end":{"line":25,"column":51}},"type":"if","locations":[{"start":{"line":25,"column":4},"end":{"line":25,"column":51}},{"start":{"line":25,"column":4},"end":{"line":25,"column":51}}],"line":25},"1":{"loc":{"start":{"line":29,"column":15},"end":{"line":29,"column":65}},"type":"cond-expr","locations":[{"start":{"line":29,"column":29},"end":{"line":29,"column":45}},{"start":{"line":29,"column":48},"end":{"line":29,"column":65}}],"line":29},"2":{"loc":{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},"type":"if","locations":[{"start":{"line":33,"column":4},"end":{"line":35,"column":5}},{"start":{"line":33,"column":4},"end":{"line":35,"column":5}}],"line":33},"3":{"loc":{"start":{"line":33,"column":8},"end":{"line":33,"column":45}},"type":"binary-expr","locations":[{"start":{"line":33,"column":8},"end":{"line":33,"column":20}},{"start":{"line":33,"column":24},"end":{"line":33,"column":27}},{"start":{"line":33,"column":31},"end":{"line":33,"column":45}}],"line":33},"4":{"loc":{"start":{"line":36,"column":4},"end":{"line":40,"column":5}},"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":40,"column":5}},{"start":{"line":36,"column":4},"end":{"line":40,"column":5}}],"line":36},"5":{"loc":{"start":{"line":36,"column":8},"end":{"line":36,"column":76}},"type":"binary-expr","locations":[{"start":{"line":36,"column":8},"end":{"line":36,"column":20}},{"start":{"line":36,"column":24},"end":{"line":36,"column":47}},{"start":{"line":36,"column":51},"end":{"line":36,"column":76}}],"line":36},"6":{"loc":{"start":{"line":42,"column":4},"end":{"line":44,"column":5}},"type":"if","locations":[{"start":{"line":42,"column":4},"end":{"line":44,"column":5}},{"start":{"line":42,"column":4},"end":{"line":44,"column":5}}],"line":42},"7":{"loc":{"start":{"line":42,"column":8},"end":{"line":42,"column":31}},"type":"binary-expr","locations":[{"start":{"line":42,"column":8},"end":{"line":42,"column":13}},{"start":{"line":42,"column":17},"end":{"line":42,"column":31}}],"line":42},"8":{"loc":{"start":{"line":48,"column":32},"end":{"line":48,"column":88}},"type":"binary-expr","locations":[{"start":{"line":48,"column":32},"end":{"line":48,"column":53}},{"start":{"line":48,"column":57},"end":{"line":48,"column":88}}],"line":48},"9":{"loc":{"start":{"line":50,"column":8},"end":{"line":57,"column":9}},"type":"if","locations":[{"start":{"line":50,"column":8},"end":{"line":57,"column":9}},{"start":{"line":50,"column":8},"end":{"line":57,"column":9}}],"line":50},"10":{"loc":{"start":{"line":50,"column":12},"end":{"line":50,"column":79}},"type":"binary-expr","locations":[{"start":{"line":50,"column":12},"end":{"line":50,"column":29}},{"start":{"line":50,"column":33},"end":{"line":50,"column":79}}],"line":50},"11":{"loc":{"start":{"line":51,"column":23},"end":{"line":51,"column":95}},"type":"cond-expr","locations":[{"start":{"line":51,"column":47},"end":{"line":51,"column":88}},{"start":{"line":51,"column":91},"end":{"line":51,"column":95}}],"line":51},"12":{"loc":{"start":{"line":52,"column":12},"end":{"line":56,"column":13}},"type":"if","locations":[{"start":{"line":52,"column":12},"end":{"line":56,"column":13}},{"start":{"line":52,"column":12},"end":{"line":56,"column":13}}],"line":52},"13":{"loc":{"start":{"line":52,"column":16},"end":{"line":52,"column":46}},"type":"binary-expr","locations":[{"start":{"line":52,"column":16},"end":{"line":52,"column":20}},{"start":{"line":52,"column":25},"end":{"line":52,"column":33}},{"start":{"line":52,"column":37},"end":{"line":52,"column":45}}],"line":52},"14":{"loc":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"type":"if","locations":[{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},{"start":{"line":60,"column":4},"end":{"line":62,"column":5}}],"line":60},"15":{"loc":{"start":{"line":70,"column":8},"end":{"line":72,"column":9}},"type":"if","locations":[{"start":{"line":70,"column":8},"end":{"line":72,"column":9}},{"start":{"line":70,"column":8},"end":{"line":72,"column":9}}],"line":70},"16":{"loc":{"start":{"line":77,"column":12},"end":{"line":103,"column":13}},"type":"if","locations":[{"start":{"line":77,"column":12},"end":{"line":103,"column":13}},{"start":{"line":77,"column":12},"end":{"line":103,"column":13}}],"line":77},"17":{"loc":{"start":{"line":114,"column":8},"end":{"line":116,"column":9}},"type":"if","locations":[{"start":{"line":114,"column":8},"end":{"line":116,"column":9}},{"start":{"line":114,"column":8},"end":{"line":116,"column":9}}],"line":114},"18":{"loc":{"start":{"line":120,"column":19},"end":{"line":120,"column":147}},"type":"cond-expr","locations":[{"start":{"line":120,"column":110},"end":{"line":120,"column":116}},{"start":{"line":120,"column":119},"end":{"line":120,"column":147}}],"line":120},"19":{"loc":{"start":{"line":120,"column":19},"end":{"line":120,"column":107}},"type":"binary-expr","locations":[{"start":{"line":120,"column":19},"end":{"line":120,"column":72}},{"start":{"line":120,"column":76},"end":{"line":120,"column":107}}],"line":120},"20":{"loc":{"start":{"line":129,"column":29},"end":{"line":129,"column":66}},"type":"binary-expr","locations":[{"start":{"line":129,"column":29},"end":{"line":129,"column":60}},{"start":{"line":129,"column":64},"end":{"line":129,"column":66}}],"line":129},"21":{"loc":{"start":{"line":130,"column":19},"end":{"line":132,"column":22}},"type":"cond-expr","locations":[{"start":{"line":130,"column":52},"end":{"line":132,"column":17}},{"start":{"line":132,"column":20},"end":{"line":132,"column":22}}],"line":130},"22":{"loc":{"start":{"line":147,"column":70},"end":{"line":147,"column":91}},"type":"default-arg","locations":[{"start":{"line":147,"column":89},"end":{"line":147,"column":91}}],"line":147},"23":{"loc":{"start":{"line":150,"column":28},"end":{"line":150,"column":304}},"type":"cond-expr","locations":[{"start":{"line":150,"column":166},"end":{"line":150,"column":172}},{"start":{"line":150,"column":175},"end":{"line":150,"column":304}}],"line":150},"24":{"loc":{"start":{"line":150,"column":28},"end":{"line":150,"column":163}},"type":"binary-expr","locations":[{"start":{"line":150,"column":28},"end":{"line":150,"column":136}},{"start":{"line":150,"column":140},"end":{"line":150,"column":163}}],"line":150},"25":{"loc":{"start":{"line":150,"column":175},"end":{"line":150,"column":304}},"type":"cond-expr","locations":[{"start":{"line":150,"column":267},"end":{"line":150,"column":273}},{"start":{"line":150,"column":276},"end":{"line":150,"column":304}}],"line":150},"26":{"loc":{"start":{"line":150,"column":175},"end":{"line":150,"column":264}},"type":"binary-expr","locations":[{"start":{"line":150,"column":175},"end":{"line":150,"column":229}},{"start":{"line":150,"column":233},"end":{"line":150,"column":264}}],"line":150},"27":{"loc":{"start":{"line":151,"column":8},"end":{"line":153,"column":9}},"type":"if","locations":[{"start":{"line":151,"column":8},"end":{"line":153,"column":9}},{"start":{"line":151,"column":8},"end":{"line":153,"column":9}}],"line":151},"28":{"loc":{"start":{"line":154,"column":38},"end":{"line":154,"column":247}},"type":"binary-expr","locations":[{"start":{"line":154,"column":38},"end":{"line":154,"column":109}},{"start":{"line":154,"column":113},"end":{"line":154,"column":200}},{"start":{"line":154,"column":204},"end":{"line":154,"column":247}}],"line":154},"29":{"loc":{"start":{"line":170,"column":8},"end":{"line":172,"column":9}},"type":"if","locations":[{"start":{"line":170,"column":8},"end":{"line":172,"column":9}},{"start":{"line":170,"column":8},"end":{"line":172,"column":9}}],"line":170},"30":{"loc":{"start":{"line":174,"column":8},"end":{"line":176,"column":9}},"type":"if","locations":[{"start":{"line":174,"column":8},"end":{"line":176,"column":9}},{"start":{"line":174,"column":8},"end":{"line":176,"column":9}}],"line":174},"31":{"loc":{"start":{"line":216,"column":12},"end":{"line":221,"column":13}},"type":"if","locations":[{"start":{"line":216,"column":12},"end":{"line":221,"column":13}},{"start":{"line":216,"column":12},"end":{"line":221,"column":13}}],"line":216},"32":{"loc":{"start":{"line":218,"column":16},"end":{"line":220,"column":17}},"type":"if","locations":[{"start":{"line":218,"column":16},"end":{"line":220,"column":17}},{"start":{"line":218,"column":16},"end":{"line":220,"column":17}}],"line":218},"33":{"loc":{"start":{"line":222,"column":12},"end":{"line":224,"column":13}},"type":"if","locations":[{"start":{"line":222,"column":12},"end":{"line":224,"column":13}},{"start":{"line":222,"column":12},"end":{"line":224,"column":13}}],"line":222},"34":{"loc":{"start":{"line":231,"column":8},"end":{"line":233,"column":9}},"type":"if","locations":[{"start":{"line":231,"column":8},"end":{"line":233,"column":9}},{"start":{"line":231,"column":8},"end":{"line":233,"column":9}}],"line":231},"35":{"loc":{"start":{"line":234,"column":33},"end":{"line":234,"column":107}},"type":"cond-expr","locations":[{"start":{"line":234,"column":76},"end":{"line":234,"column":82}},{"start":{"line":234,"column":85},"end":{"line":234,"column":107}}],"line":234},"36":{"loc":{"start":{"line":234,"column":33},"end":{"line":234,"column":73}},"type":"binary-expr","locations":[{"start":{"line":234,"column":33},"end":{"line":234,"column":50}},{"start":{"line":234,"column":54},"end":{"line":234,"column":73}}],"line":234},"37":{"loc":{"start":{"line":238,"column":15},"end":{"line":240,"column":18}},"type":"cond-expr","locations":[{"start":{"line":238,"column":27},"end":{"line":240,"column":13}},{"start":{"line":240,"column":16},"end":{"line":240,"column":18}}],"line":238},"38":{"loc":{"start":{"line":251,"column":74},"end":{"line":251,"column":88}},"type":"default-arg","locations":[{"start":{"line":251,"column":86},"end":{"line":251,"column":88}}],"line":251},"39":{"loc":{"start":{"line":344,"column":23},"end":{"line":347,"column":26}},"type":"cond-expr","locations":[{"start":{"line":344,"column":298},"end":{"line":347,"column":21}},{"start":{"line":347,"column":24},"end":{"line":347,"column":26}}],"line":344},"40":{"loc":{"start":{"line":344,"column":23},"end":{"line":344,"column":295}},"type":"binary-expr","locations":[{"start":{"line":344,"column":24},"end":{"line":344,"column":155}},{"start":{"line":344,"column":161},"end":{"line":344,"column":294}}],"line":344},"41":{"loc":{"start":{"line":344,"column":24},"end":{"line":344,"column":155}},"type":"cond-expr","locations":[{"start":{"line":344,"column":118},"end":{"line":344,"column":124}},{"start":{"line":344,"column":127},"end":{"line":344,"column":155}}],"line":344},"42":{"loc":{"start":{"line":344,"column":24},"end":{"line":344,"column":115}},"type":"binary-expr","locations":[{"start":{"line":344,"column":24},"end":{"line":344,"column":79}},{"start":{"line":344,"column":83},"end":{"line":344,"column":115}}],"line":344},"43":{"loc":{"start":{"line":344,"column":161},"end":{"line":344,"column":294}},"type":"cond-expr","locations":[{"start":{"line":344,"column":257},"end":{"line":344,"column":263}},{"start":{"line":344,"column":266},"end":{"line":344,"column":294}}],"line":344},"44":{"loc":{"start":{"line":344,"column":161},"end":{"line":344,"column":254}},"type":"binary-expr","locations":[{"start":{"line":344,"column":161},"end":{"line":344,"column":217}},{"start":{"line":344,"column":221},"end":{"line":344,"column":254}}],"line":344},"45":{"loc":{"start":{"line":345,"column":27},"end":{"line":345,"column":161}},"type":"cond-expr","locations":[{"start":{"line":345,"column":123},"end":{"line":345,"column":129}},{"start":{"line":345,"column":132},"end":{"line":345,"column":161}}],"line":345},"46":{"loc":{"start":{"line":345,"column":27},"end":{"line":345,"column":120}},"type":"binary-expr","locations":[{"start":{"line":345,"column":27},"end":{"line":345,"column":83}},{"start":{"line":345,"column":87},"end":{"line":345,"column":120}}],"line":345},"47":{"loc":{"start":{"line":346,"column":27},"end":{"line":346,"column":160}},"type":"cond-expr","locations":[{"start":{"line":346,"column":123},"end":{"line":346,"column":129}},{"start":{"line":346,"column":132},"end":{"line":346,"column":160}}],"line":346},"48":{"loc":{"start":{"line":346,"column":27},"end":{"line":346,"column":120}},"type":"binary-expr","locations":[{"start":{"line":346,"column":27},"end":{"line":346,"column":83}},{"start":{"line":346,"column":87},"end":{"line":346,"column":120}}],"line":346},"49":{"loc":{"start":{"line":367,"column":12},"end":{"line":369,"column":13}},"type":"if","locations":[{"start":{"line":367,"column":12},"end":{"line":369,"column":13}},{"start":{"line":367,"column":12},"end":{"line":369,"column":13}}],"line":367},"50":{"loc":{"start":{"line":367,"column":16},"end":{"line":367,"column":203}},"type":"binary-expr","locations":[{"start":{"line":367,"column":17},"end":{"line":367,"column":101}},{"start":{"line":367,"column":107},"end":{"line":367,"column":202}}],"line":367},"51":{"loc":{"start":{"line":367,"column":17},"end":{"line":367,"column":101}},"type":"cond-expr","locations":[{"start":{"line":367,"column":69},"end":{"line":367,"column":75}},{"start":{"line":367,"column":78},"end":{"line":367,"column":101}}],"line":367},"52":{"loc":{"start":{"line":367,"column":17},"end":{"line":367,"column":66}},"type":"binary-expr","locations":[{"start":{"line":367,"column":17},"end":{"line":367,"column":44}},{"start":{"line":367,"column":48},"end":{"line":367,"column":66}}],"line":367},"53":{"loc":{"start":{"line":367,"column":107},"end":{"line":367,"column":202}},"type":"cond-expr","locations":[{"start":{"line":367,"column":161},"end":{"line":367,"column":167}},{"start":{"line":367,"column":170},"end":{"line":367,"column":202}}],"line":367},"54":{"loc":{"start":{"line":367,"column":107},"end":{"line":367,"column":158}},"type":"binary-expr","locations":[{"start":{"line":367,"column":107},"end":{"line":367,"column":135}},{"start":{"line":367,"column":139},"end":{"line":367,"column":158}}],"line":367},"55":{"loc":{"start":{"line":383,"column":23},"end":{"line":386,"column":26}},"type":"cond-expr","locations":[{"start":{"line":383,"column":298},"end":{"line":386,"column":21}},{"start":{"line":386,"column":24},"end":{"line":386,"column":26}}],"line":383},"56":{"loc":{"start":{"line":383,"column":23},"end":{"line":383,"column":295}},"type":"binary-expr","locations":[{"start":{"line":383,"column":24},"end":{"line":383,"column":155}},{"start":{"line":383,"column":161},"end":{"line":383,"column":294}}],"line":383},"57":{"loc":{"start":{"line":383,"column":24},"end":{"line":383,"column":155}},"type":"cond-expr","locations":[{"start":{"line":383,"column":118},"end":{"line":383,"column":124}},{"start":{"line":383,"column":127},"end":{"line":383,"column":155}}],"line":383},"58":{"loc":{"start":{"line":383,"column":24},"end":{"line":383,"column":115}},"type":"binary-expr","locations":[{"start":{"line":383,"column":24},"end":{"line":383,"column":79}},{"start":{"line":383,"column":83},"end":{"line":383,"column":115}}],"line":383},"59":{"loc":{"start":{"line":383,"column":161},"end":{"line":383,"column":294}},"type":"cond-expr","locations":[{"start":{"line":383,"column":257},"end":{"line":383,"column":263}},{"start":{"line":383,"column":266},"end":{"line":383,"column":294}}],"line":383},"60":{"loc":{"start":{"line":383,"column":161},"end":{"line":383,"column":254}},"type":"binary-expr","locations":[{"start":{"line":383,"column":161},"end":{"line":383,"column":217}},{"start":{"line":383,"column":221},"end":{"line":383,"column":254}}],"line":383},"61":{"loc":{"start":{"line":384,"column":27},"end":{"line":384,"column":161}},"type":"cond-expr","locations":[{"start":{"line":384,"column":123},"end":{"line":384,"column":129}},{"start":{"line":384,"column":132},"end":{"line":384,"column":161}}],"line":384},"62":{"loc":{"start":{"line":384,"column":27},"end":{"line":384,"column":120}},"type":"binary-expr","locations":[{"start":{"line":384,"column":27},"end":{"line":384,"column":83}},{"start":{"line":384,"column":87},"end":{"line":384,"column":120}}],"line":384},"63":{"loc":{"start":{"line":385,"column":27},"end":{"line":385,"column":160}},"type":"cond-expr","locations":[{"start":{"line":385,"column":123},"end":{"line":385,"column":129}},{"start":{"line":385,"column":132},"end":{"line":385,"column":160}}],"line":385},"64":{"loc":{"start":{"line":385,"column":27},"end":{"line":385,"column":120}},"type":"binary-expr","locations":[{"start":{"line":385,"column":27},"end":{"line":385,"column":83}},{"start":{"line":385,"column":87},"end":{"line":385,"column":120}}],"line":385},"65":{"loc":{"start":{"line":406,"column":12},"end":{"line":408,"column":13}},"type":"if","locations":[{"start":{"line":406,"column":12},"end":{"line":408,"column":13}},{"start":{"line":406,"column":12},"end":{"line":408,"column":13}}],"line":406},"66":{"loc":{"start":{"line":406,"column":16},"end":{"line":406,"column":203}},"type":"binary-expr","locations":[{"start":{"line":406,"column":17},"end":{"line":406,"column":101}},{"start":{"line":406,"column":107},"end":{"line":406,"column":202}}],"line":406},"67":{"loc":{"start":{"line":406,"column":17},"end":{"line":406,"column":101}},"type":"cond-expr","locations":[{"start":{"line":406,"column":69},"end":{"line":406,"column":75}},{"start":{"line":406,"column":78},"end":{"line":406,"column":101}}],"line":406},"68":{"loc":{"start":{"line":406,"column":17},"end":{"line":406,"column":66}},"type":"binary-expr","locations":[{"start":{"line":406,"column":17},"end":{"line":406,"column":44}},{"start":{"line":406,"column":48},"end":{"line":406,"column":66}}],"line":406},"69":{"loc":{"start":{"line":406,"column":107},"end":{"line":406,"column":202}},"type":"cond-expr","locations":[{"start":{"line":406,"column":161},"end":{"line":406,"column":167}},{"start":{"line":406,"column":170},"end":{"line":406,"column":202}}],"line":406},"70":{"loc":{"start":{"line":406,"column":107},"end":{"line":406,"column":158}},"type":"binary-expr","locations":[{"start":{"line":406,"column":107},"end":{"line":406,"column":135}},{"start":{"line":406,"column":139},"end":{"line":406,"column":158}}],"line":406},"71":{"loc":{"start":{"line":438,"column":8},"end":{"line":440,"column":9}},"type":"if","locations":[{"start":{"line":438,"column":8},"end":{"line":440,"column":9}},{"start":{"line":438,"column":8},"end":{"line":440,"column":9}}],"line":438},"72":{"loc":{"start":{"line":448,"column":15},"end":{"line":448,"column":129}},"type":"cond-expr","locations":[{"start":{"line":448,"column":46},"end":{"line":448,"column":83}},{"start":{"line":448,"column":86},"end":{"line":448,"column":129}}],"line":448},"73":{"loc":{"start":{"line":448,"column":46},"end":{"line":448,"column":83}},"type":"binary-expr","locations":[{"start":{"line":448,"column":46},"end":{"line":448,"column":77}},{"start":{"line":448,"column":81},"end":{"line":448,"column":83}}],"line":448},"74":{"loc":{"start":{"line":523,"column":23},"end":{"line":526,"column":26}},"type":"cond-expr","locations":[{"start":{"line":523,"column":298},"end":{"line":526,"column":21}},{"start":{"line":526,"column":24},"end":{"line":526,"column":26}}],"line":523},"75":{"loc":{"start":{"line":523,"column":23},"end":{"line":523,"column":295}},"type":"binary-expr","locations":[{"start":{"line":523,"column":24},"end":{"line":523,"column":155}},{"start":{"line":523,"column":161},"end":{"line":523,"column":294}}],"line":523},"76":{"loc":{"start":{"line":523,"column":24},"end":{"line":523,"column":155}},"type":"cond-expr","locations":[{"start":{"line":523,"column":118},"end":{"line":523,"column":124}},{"start":{"line":523,"column":127},"end":{"line":523,"column":155}}],"line":523},"77":{"loc":{"start":{"line":523,"column":24},"end":{"line":523,"column":115}},"type":"binary-expr","locations":[{"start":{"line":523,"column":24},"end":{"line":523,"column":79}},{"start":{"line":523,"column":83},"end":{"line":523,"column":115}}],"line":523},"78":{"loc":{"start":{"line":523,"column":161},"end":{"line":523,"column":294}},"type":"cond-expr","locations":[{"start":{"line":523,"column":257},"end":{"line":523,"column":263}},{"start":{"line":523,"column":266},"end":{"line":523,"column":294}}],"line":523},"79":{"loc":{"start":{"line":523,"column":161},"end":{"line":523,"column":254}},"type":"binary-expr","locations":[{"start":{"line":523,"column":161},"end":{"line":523,"column":217}},{"start":{"line":523,"column":221},"end":{"line":523,"column":254}}],"line":523},"80":{"loc":{"start":{"line":524,"column":27},"end":{"line":524,"column":161}},"type":"cond-expr","locations":[{"start":{"line":524,"column":123},"end":{"line":524,"column":129}},{"start":{"line":524,"column":132},"end":{"line":524,"column":161}}],"line":524},"81":{"loc":{"start":{"line":524,"column":27},"end":{"line":524,"column":120}},"type":"binary-expr","locations":[{"start":{"line":524,"column":27},"end":{"line":524,"column":83}},{"start":{"line":524,"column":87},"end":{"line":524,"column":120}}],"line":524},"82":{"loc":{"start":{"line":525,"column":27},"end":{"line":525,"column":160}},"type":"cond-expr","locations":[{"start":{"line":525,"column":123},"end":{"line":525,"column":129}},{"start":{"line":525,"column":132},"end":{"line":525,"column":160}}],"line":525},"83":{"loc":{"start":{"line":525,"column":27},"end":{"line":525,"column":120}},"type":"binary-expr","locations":[{"start":{"line":525,"column":27},"end":{"line":525,"column":83}},{"start":{"line":525,"column":87},"end":{"line":525,"column":120}}],"line":525},"84":{"loc":{"start":{"line":538,"column":12},"end":{"line":540,"column":13}},"type":"if","locations":[{"start":{"line":538,"column":12},"end":{"line":540,"column":13}},{"start":{"line":538,"column":12},"end":{"line":540,"column":13}}],"line":538},"85":{"loc":{"start":{"line":538,"column":16},"end":{"line":538,"column":203}},"type":"binary-expr","locations":[{"start":{"line":538,"column":17},"end":{"line":538,"column":101}},{"start":{"line":538,"column":107},"end":{"line":538,"column":202}}],"line":538},"86":{"loc":{"start":{"line":538,"column":17},"end":{"line":538,"column":101}},"type":"cond-expr","locations":[{"start":{"line":538,"column":69},"end":{"line":538,"column":75}},{"start":{"line":538,"column":78},"end":{"line":538,"column":101}}],"line":538},"87":{"loc":{"start":{"line":538,"column":17},"end":{"line":538,"column":66}},"type":"binary-expr","locations":[{"start":{"line":538,"column":17},"end":{"line":538,"column":44}},{"start":{"line":538,"column":48},"end":{"line":538,"column":66}}],"line":538},"88":{"loc":{"start":{"line":538,"column":107},"end":{"line":538,"column":202}},"type":"cond-expr","locations":[{"start":{"line":538,"column":161},"end":{"line":538,"column":167}},{"start":{"line":538,"column":170},"end":{"line":538,"column":202}}],"line":538},"89":{"loc":{"start":{"line":538,"column":107},"end":{"line":538,"column":158}},"type":"binary-expr","locations":[{"start":{"line":538,"column":107},"end":{"line":538,"column":135}},{"start":{"line":538,"column":139},"end":{"line":538,"column":158}}],"line":538},"90":{"loc":{"start":{"line":554,"column":23},"end":{"line":557,"column":26}},"type":"cond-expr","locations":[{"start":{"line":554,"column":298},"end":{"line":557,"column":21}},{"start":{"line":557,"column":24},"end":{"line":557,"column":26}}],"line":554},"91":{"loc":{"start":{"line":554,"column":23},"end":{"line":554,"column":295}},"type":"binary-expr","locations":[{"start":{"line":554,"column":24},"end":{"line":554,"column":155}},{"start":{"line":554,"column":161},"end":{"line":554,"column":294}}],"line":554},"92":{"loc":{"start":{"line":554,"column":24},"end":{"line":554,"column":155}},"type":"cond-expr","locations":[{"start":{"line":554,"column":118},"end":{"line":554,"column":124}},{"start":{"line":554,"column":127},"end":{"line":554,"column":155}}],"line":554},"93":{"loc":{"start":{"line":554,"column":24},"end":{"line":554,"column":115}},"type":"binary-expr","locations":[{"start":{"line":554,"column":24},"end":{"line":554,"column":79}},{"start":{"line":554,"column":83},"end":{"line":554,"column":115}}],"line":554},"94":{"loc":{"start":{"line":554,"column":161},"end":{"line":554,"column":294}},"type":"cond-expr","locations":[{"start":{"line":554,"column":257},"end":{"line":554,"column":263}},{"start":{"line":554,"column":266},"end":{"line":554,"column":294}}],"line":554},"95":{"loc":{"start":{"line":554,"column":161},"end":{"line":554,"column":254}},"type":"binary-expr","locations":[{"start":{"line":554,"column":161},"end":{"line":554,"column":217}},{"start":{"line":554,"column":221},"end":{"line":554,"column":254}}],"line":554},"96":{"loc":{"start":{"line":555,"column":27},"end":{"line":555,"column":161}},"type":"cond-expr","locations":[{"start":{"line":555,"column":123},"end":{"line":555,"column":129}},{"start":{"line":555,"column":132},"end":{"line":555,"column":161}}],"line":555},"97":{"loc":{"start":{"line":555,"column":27},"end":{"line":555,"column":120}},"type":"binary-expr","locations":[{"start":{"line":555,"column":27},"end":{"line":555,"column":83}},{"start":{"line":555,"column":87},"end":{"line":555,"column":120}}],"line":555},"98":{"loc":{"start":{"line":556,"column":27},"end":{"line":556,"column":160}},"type":"cond-expr","locations":[{"start":{"line":556,"column":123},"end":{"line":556,"column":129}},{"start":{"line":556,"column":132},"end":{"line":556,"column":160}}],"line":556},"99":{"loc":{"start":{"line":556,"column":27},"end":{"line":556,"column":120}},"type":"binary-expr","locations":[{"start":{"line":556,"column":27},"end":{"line":556,"column":83}},{"start":{"line":556,"column":87},"end":{"line":556,"column":120}}],"line":556},"100":{"loc":{"start":{"line":574,"column":12},"end":{"line":576,"column":13}},"type":"if","locations":[{"start":{"line":574,"column":12},"end":{"line":576,"column":13}},{"start":{"line":574,"column":12},"end":{"line":576,"column":13}}],"line":574},"101":{"loc":{"start":{"line":574,"column":16},"end":{"line":574,"column":203}},"type":"binary-expr","locations":[{"start":{"line":574,"column":17},"end":{"line":574,"column":101}},{"start":{"line":574,"column":107},"end":{"line":574,"column":202}}],"line":574},"102":{"loc":{"start":{"line":574,"column":17},"end":{"line":574,"column":101}},"type":"cond-expr","locations":[{"start":{"line":574,"column":69},"end":{"line":574,"column":75}},{"start":{"line":574,"column":78},"end":{"line":574,"column":101}}],"line":574},"103":{"loc":{"start":{"line":574,"column":17},"end":{"line":574,"column":66}},"type":"binary-expr","locations":[{"start":{"line":574,"column":17},"end":{"line":574,"column":44}},{"start":{"line":574,"column":48},"end":{"line":574,"column":66}}],"line":574},"104":{"loc":{"start":{"line":574,"column":107},"end":{"line":574,"column":202}},"type":"cond-expr","locations":[{"start":{"line":574,"column":161},"end":{"line":574,"column":167}},{"start":{"line":574,"column":170},"end":{"line":574,"column":202}}],"line":574},"105":{"loc":{"start":{"line":574,"column":107},"end":{"line":574,"column":158}},"type":"binary-expr","locations":[{"start":{"line":574,"column":107},"end":{"line":574,"column":135}},{"start":{"line":574,"column":139},"end":{"line":574,"column":158}}],"line":574},"106":{"loc":{"start":{"line":596,"column":8},"end":{"line":598,"column":9}},"type":"if","locations":[{"start":{"line":596,"column":8},"end":{"line":598,"column":9}},{"start":{"line":596,"column":8},"end":{"line":598,"column":9}}],"line":596},"107":{"loc":{"start":{"line":599,"column":8},"end":{"line":601,"column":9}},"type":"if","locations":[{"start":{"line":599,"column":8},"end":{"line":601,"column":9}},{"start":{"line":599,"column":8},"end":{"line":601,"column":9}}],"line":599},"108":{"loc":{"start":{"line":602,"column":8},"end":{"line":604,"column":9}},"type":"if","locations":[{"start":{"line":602,"column":8},"end":{"line":604,"column":9}},{"start":{"line":602,"column":8},"end":{"line":604,"column":9}}],"line":602},"109":{"loc":{"start":{"line":620,"column":12},"end":{"line":622,"column":13}},"type":"if","locations":[{"start":{"line":620,"column":12},"end":{"line":622,"column":13}},{"start":{"line":620,"column":12},"end":{"line":622,"column":13}}],"line":620},"110":{"loc":{"start":{"line":620,"column":16},"end":{"line":620,"column":203}},"type":"binary-expr","locations":[{"start":{"line":620,"column":17},"end":{"line":620,"column":101}},{"start":{"line":620,"column":107},"end":{"line":620,"column":202}}],"line":620},"111":{"loc":{"start":{"line":620,"column":17},"end":{"line":620,"column":101}},"type":"cond-expr","locations":[{"start":{"line":620,"column":69},"end":{"line":620,"column":75}},{"start":{"line":620,"column":78},"end":{"line":620,"column":101}}],"line":620},"112":{"loc":{"start":{"line":620,"column":17},"end":{"line":620,"column":66}},"type":"binary-expr","locations":[{"start":{"line":620,"column":17},"end":{"line":620,"column":44}},{"start":{"line":620,"column":48},"end":{"line":620,"column":66}}],"line":620},"113":{"loc":{"start":{"line":620,"column":107},"end":{"line":620,"column":202}},"type":"cond-expr","locations":[{"start":{"line":620,"column":161},"end":{"line":620,"column":167}},{"start":{"line":620,"column":170},"end":{"line":620,"column":202}}],"line":620},"114":{"loc":{"start":{"line":620,"column":107},"end":{"line":620,"column":158}},"type":"binary-expr","locations":[{"start":{"line":620,"column":107},"end":{"line":620,"column":135}},{"start":{"line":620,"column":139},"end":{"line":620,"column":158}}],"line":620},"115":{"loc":{"start":{"line":629,"column":19},"end":{"line":629,"column":314}},"type":"cond-expr","locations":[{"start":{"line":629,"column":207},"end":{"line":629,"column":213}},{"start":{"line":629,"column":216},"end":{"line":629,"column":314}}],"line":629},"116":{"loc":{"start":{"line":629,"column":19},"end":{"line":629,"column":204}},"type":"binary-expr","locations":[{"start":{"line":629,"column":19},"end":{"line":629,"column":184}},{"start":{"line":629,"column":188},"end":{"line":629,"column":204}}],"line":629},"117":{"loc":{"start":{"line":629,"column":29},"end":{"line":629,"column":44}},"type":"binary-expr","locations":[{"start":{"line":629,"column":29},"end":{"line":629,"column":38}},{"start":{"line":629,"column":42},"end":{"line":629,"column":44}}],"line":629},"118":{"loc":{"start":{"line":629,"column":61},"end":{"line":629,"column":117}},"type":"cond-expr","locations":[{"start":{"line":629,"column":98},"end":{"line":629,"column":104}},{"start":{"line":629,"column":107},"end":{"line":629,"column":117}}],"line":629},"119":{"loc":{"start":{"line":629,"column":61},"end":{"line":629,"column":95}},"type":"binary-expr","locations":[{"start":{"line":629,"column":61},"end":{"line":629,"column":75}},{"start":{"line":629,"column":79},"end":{"line":629,"column":95}}],"line":629},"120":{"loc":{"start":{"line":629,"column":216},"end":{"line":629,"column":314}},"type":"cond-expr","locations":[{"start":{"line":629,"column":287},"end":{"line":629,"column":293}},{"start":{"line":629,"column":296},"end":{"line":629,"column":314}}],"line":629},"121":{"loc":{"start":{"line":629,"column":216},"end":{"line":629,"column":284}},"type":"binary-expr","locations":[{"start":{"line":629,"column":216},"end":{"line":629,"column":256}},{"start":{"line":629,"column":260},"end":{"line":629,"column":284}}],"line":629},"122":{"loc":{"start":{"line":638,"column":19},"end":{"line":638,"column":316}},"type":"cond-expr","locations":[{"start":{"line":638,"column":208},"end":{"line":638,"column":214}},{"start":{"line":638,"column":217},"end":{"line":638,"column":316}}],"line":638},"123":{"loc":{"start":{"line":638,"column":19},"end":{"line":638,"column":205}},"type":"binary-expr","locations":[{"start":{"line":638,"column":19},"end":{"line":638,"column":185}},{"start":{"line":638,"column":189},"end":{"line":638,"column":205}}],"line":638},"124":{"loc":{"start":{"line":638,"column":29},"end":{"line":638,"column":44}},"type":"binary-expr","locations":[{"start":{"line":638,"column":29},"end":{"line":638,"column":38}},{"start":{"line":638,"column":42},"end":{"line":638,"column":44}}],"line":638},"125":{"loc":{"start":{"line":638,"column":61},"end":{"line":638,"column":117}},"type":"cond-expr","locations":[{"start":{"line":638,"column":98},"end":{"line":638,"column":104}},{"start":{"line":638,"column":107},"end":{"line":638,"column":117}}],"line":638},"126":{"loc":{"start":{"line":638,"column":61},"end":{"line":638,"column":95}},"type":"binary-expr","locations":[{"start":{"line":638,"column":61},"end":{"line":638,"column":75}},{"start":{"line":638,"column":79},"end":{"line":638,"column":95}}],"line":638},"127":{"loc":{"start":{"line":638,"column":217},"end":{"line":638,"column":316}},"type":"cond-expr","locations":[{"start":{"line":638,"column":288},"end":{"line":638,"column":294}},{"start":{"line":638,"column":297},"end":{"line":638,"column":316}}],"line":638},"128":{"loc":{"start":{"line":638,"column":217},"end":{"line":638,"column":285}},"type":"binary-expr","locations":[{"start":{"line":638,"column":217},"end":{"line":638,"column":257}},{"start":{"line":638,"column":261},"end":{"line":638,"column":285}}],"line":638},"129":{"loc":{"start":{"line":671,"column":20},"end":{"line":673,"column":21}},"type":"if","locations":[{"start":{"line":671,"column":20},"end":{"line":673,"column":21}},{"start":{"line":671,"column":20},"end":{"line":673,"column":21}}],"line":671},"130":{"loc":{"start":{"line":671,"column":24},"end":{"line":671,"column":134}},"type":"binary-expr","locations":[{"start":{"line":671,"column":24},"end":{"line":671,"column":55}},{"start":{"line":671,"column":59},"end":{"line":671,"column":134}}],"line":671},"131":{"loc":{"start":{"line":679,"column":19},"end":{"line":684,"column":22}},"type":"cond-expr","locations":[{"start":{"line":679,"column":99},"end":{"line":684,"column":17}},{"start":{"line":684,"column":20},"end":{"line":684,"column":22}}],"line":679},"132":{"loc":{"start":{"line":700,"column":8},"end":{"line":702,"column":9}},"type":"if","locations":[{"start":{"line":700,"column":8},"end":{"line":702,"column":9}},{"start":{"line":700,"column":8},"end":{"line":702,"column":9}}],"line":700},"133":{"loc":{"start":{"line":700,"column":12},"end":{"line":700,"column":51}},"type":"binary-expr","locations":[{"start":{"line":700,"column":12},"end":{"line":700,"column":27}},{"start":{"line":700,"column":31},"end":{"line":700,"column":51}}],"line":700},"134":{"loc":{"start":{"line":720,"column":8},"end":{"line":722,"column":9}},"type":"if","locations":[{"start":{"line":720,"column":8},"end":{"line":722,"column":9}},{"start":{"line":720,"column":8},"end":{"line":722,"column":9}}],"line":720}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":1,"42":1,"43":1,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":4,"104":4,"105":4,"106":3,"107":1,"108":1,"109":1,"110":2,"111":1,"112":1,"113":1,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":5,"162":5,"163":7,"164":2,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"187":0,"188":0,"189":0,"190":0,"191":0,"192":0,"193":0,"194":0,"195":0,"196":0,"197":0,"198":0,"199":0,"200":0,"201":0,"202":0,"203":0,"204":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"211":0,"212":0,"213":0,"214":0,"215":0,"216":0,"217":0,"218":0,"219":0,"220":0,"221":0,"222":0,"223":0,"224":0,"225":0,"226":0,"227":0,"228":0,"229":0,"230":0,"231":0,"232":0,"233":0,"234":0,"235":0,"236":0,"237":0,"238":0,"239":0,"240":0,"241":1,"242":1,"243":1,"244":1},"f":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":4,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":5,"36":7,"37":2,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":1},"b":{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0,0],"4":[0,0],"5":[0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0,0],"29":[0,0],"30":[0,0],"31":[1,2],"32":[1,0],"33":[1,1],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0],"56":[0,0],"57":[0,0],"58":[0,0],"59":[0,0],"60":[0,0],"61":[0,0],"62":[0,0],"63":[0,0],"64":[0,0],"65":[0,0],"66":[0,0],"67":[0,0],"68":[0,0],"69":[0,0],"70":[0,0],"71":[0,0],"72":[5,2],"73":[5,0],"74":[0,0],"75":[0,0],"76":[0,0],"77":[0,0],"78":[0,0],"79":[0,0],"80":[0,0],"81":[0,0],"82":[0,0],"83":[0,0],"84":[0,0],"85":[0,0],"86":[0,0],"87":[0,0],"88":[0,0],"89":[0,0],"90":[0,0],"91":[0,0],"92":[0,0],"93":[0,0],"94":[0,0],"95":[0,0],"96":[0,0],"97":[0,0],"98":[0,0],"99":[0,0],"100":[0,0],"101":[0,0],"102":[0,0],"103":[0,0],"104":[0,0],"105":[0,0],"106":[0,0],"107":[0,0],"108":[0,0],"109":[0,0],"110":[0,0],"111":[0,0],"112":[0,0],"113":[0,0],"114":[0,0],"115":[0,0],"116":[0,0],"117":[0,0],"118":[0,0],"119":[0,0],"120":[0,0],"121":[0,0],"122":[0,0],"123":[0,0],"124":[0,0],"125":[0,0],"126":[0,0],"127":[0,0],"128":[0,0],"129":[0,0],"130":[0,0],"131":[0,0],"132":[0,0],"133":[0,0],"134":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/Bridge.ts"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { serverFetch as fetch } from '@rocket.chat/server-fetch';\nimport type { AppServiceOutput, Bridge } from 'matrix-appservice-bridge';\n\nimport type { IExternalUserProfileInformation, IFederationBridge, IFederationBridgeRegistrationFile } from '../../domain/IFederationBridge';\nimport type { RocketChatSettingsAdapter } from '../rocket-chat/adapters/Settings';\nimport { federationBridgeLogger } from '../rocket-chat/adapters/logger';\nimport { convertEmojisFromRCFormatToMatrixFormat } from './converters/room/MessageReceiver';\nimport { formatExternalUserIdToInternalUsernameFormat } from './converters/room/RoomReceiver';\nimport { toExternalMessageFormat, toExternalQuoteMessageFormat } from './converters/room/to-internal-parser-formatter';\nimport type { AbstractMatrixEvent } from './definitions/AbstractMatrixEvent';\nimport { MatrixEventType } from './definitions/MatrixEventType';\nimport { MatrixRoomType } from './definitions/MatrixRoomType';\nimport { MatrixRoomVisibility } from './definitions/MatrixRoomVisibility';\nimport { RoomMembershipChangedEventType } from './definitions/events/RoomMembershipChanged';\nimport { MatrixEnumRelatesToRelType, MatrixEnumSendMessageType } from './definitions/events/RoomMessageSent';\nimport type { MatrixEventRoomNameChanged } from './definitions/events/RoomNameChanged';\nimport type { MatrixEventRoomTopicChanged } from './definitions/events/RoomTopicChanged';\nimport { HttpStatusCodes } from './helpers/HtttpStatusCodes';\nimport { extractUserIdAndHomeserverFromMatrixId } from './helpers/MatrixIdStringTools';\nimport { VerificationStatus, MATRIX_USER_IN_USE } from './helpers/MatrixIdVerificationTypes';\n\nlet MatrixUserInstance: any;\n\nconst DEFAULT_TIMEOUT_IN_MS_FOR_JOINING_ROOMS = 180000;\n\nconst DEFAULT_TIMEOUT_IN_MS_FOR_PING_EVENT = 60 * 1000;\n\nexport class MatrixBridge implements IFederationBridge {\n\tprotected bridgeInstance: Bridge;\n\n\tprotected isRunning = false;\n\n\tprotected isUpdatingBridgeStatus = false;\n\n\tconstructor(\n\t\tprotected internalSettings: RocketChatSettingsAdapter,\n\t\tprotected eventHandler: (event: AbstractMatrixEvent) => void,\n\t) {} // eslint-disable-line no-empty-function\n\n\tpublic async start(): Promise<void> {\n\t\tif (this.isUpdatingBridgeStatus) {\n\t\t\treturn;\n\t\t}\n\t\tthis.isUpdatingBridgeStatus = true;\n\t\ttry {\n\t\t\tawait this.stop();\n\t\t\tawait this.createInstance();\n\n\t\t\tif (!this.isRunning) {\n\t\t\t\tawait this.bridgeInstance.run(this.internalSettings.getBridgePort());\n\n\t\t\t\tthis.bridgeInstance.addAppServicePath({\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tpath: '/_matrix/app/v1/ping',\n\t\t\t\t\tauthenticate: true,\n\t\t\t\t\thandler: (_req, res, _next) => {\n\t\t\t\t\t\t/*\n\t\t\t\t\t\t * https://spec.matrix.org/v1.11/application-service-api/#post_matrixappv1ping\n\t\t\t\t\t\t * Spec does not talk about what to do with the id. It is safe to ignore it as we are already checking for\n\t\t\t\t\t\t * homeserver token to be correct.\n\t\t\t\t\t\t * From the spec this might be a bit confusing, as it shows a txn id for post, but app service doing nothing with it afterwards\n\t\t\t\t\t\t * when receiving from the homeserver.\n\t\t\t\t\t\t * From spec directly -\n\t\t\t\t\t\t\tAS ---> HS : /_matrix/client/v1/appservice/{appserviceId}/ping {\"transaction_id\": \"meow\"}\n\t\t\t\t\t\t\t\tHS ---> AS : /_matrix/app/v1/ping {\"transaction_id\": \"meow\"}\n\t\t\t\t\t\t\t\tHS <--- AS : 200 OK {}\n\t\t\t\t\t\t\tAS <--- HS : 200 OK {\"duration_ms\": 123}\n\t\t\t\t\t\t * https://github.com/matrix-org/matrix-spec/blob/e53e6ea8764b95f0bdb738549fca6f9f3f901298/content/application-service-api.md?plain=1#L229-L232\n\t\t\t\t\t\t * Code - wise, also doesn't care what happens with the response.\n\t\t\t\t\t\t * https://github.com/element-hq/synapse/blob/cb6f4a84a6a8f2b79b80851f37eb5fa4c7c5264a/synapse/rest/client/appservice_ping.py#L80 - nothing done on return\n\t\t\t\t\t\t * https://github.com/element-hq/synapse/blob/cb6f4a84a6a8f2b79b80851f37eb5fa4c7c5264a/synapse/appservice/api.py#L321-L332 - not even returning the response, caring for just the http status code - https://github.com/element-hq/synapse/blob/cb6f4a84a6a8f2b79b80851f37eb5fa4c7c5264a/synapse/http/client.py#L532-L537\n\t\t\t\t\t\t */\n\t\t\t\t\t\tres.status(200).json({});\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tthis.isRunning = true;\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tfederationBridgeLogger.error({ msg: 'Failed to initialize the matrix-appservice-bridge.', err });\n\t\t} finally {\n\t\t\tthis.isUpdatingBridgeStatus = false;\n\t\t}\n\t}\n\n\tpublic async stop(): Promise<void> {\n\t\tif (!this.isRunning) {\n\t\t\treturn;\n\t\t}\n\t\treturn new Promise(async (resolve: () => void): Promise<void> => {\n\t\t\t// the http server might take some minutes to shutdown, and this promise can take some time to be resolved\n\t\t\tawait this.bridgeInstance?.close();\n\t\t\tthis.isRunning = false;\n\t\t\tresolve();\n\t\t});\n\t}\n\n\tpublic async getUserProfileInformation(externalUserId: string): Promise<IExternalUserProfileInformation | undefined> {\n\t\ttry {\n\t\t\tconst externalInformation = await this.bridgeInstance.getIntent(externalUserId).getProfileInfo(externalUserId, undefined, false);\n\n\t\t\treturn {\n\t\t\t\tdisplayName: externalInformation.displayname || '',\n\t\t\t\t...(externalInformation.avatar_url\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tavatarUrl: externalInformation.avatar_url,\n\t\t\t\t\t\t}\n\t\t\t\t\t: {}),\n\t\t\t};\n\t\t} catch (err) {\n\t\t\t// no-op\n\t\t}\n\t}\n\n\tpublic async joinRoom(externalRoomId: string, externalUserId: string, viaServers?: string[]): Promise<void> {\n\t\ttry {\n\t\t\tawait this.bridgeInstance\n\t\t\t\t.getIntent(externalUserId)\n\t\t\t\t.matrixClient.doRequest(\n\t\t\t\t\t'POST',\n\t\t\t\t\t`/_matrix/client/v3/join/${externalRoomId}`,\n\t\t\t\t\t{ server_name: viaServers },\n\t\t\t\t\t{},\n\t\t\t\t\tDEFAULT_TIMEOUT_IN_MS_FOR_JOINING_ROOMS,\n\t\t\t\t);\n\t\t} catch (e) {\n\t\t\tthrow new Error('Error joining Matrix room');\n\t\t}\n\t}\n\n\tpublic async getRoomHistoricalJoinEvents(\n\t\texternalRoomId: string,\n\t\texternalUserId: string,\n\t\texcludingUserIds: string[] = [],\n\t): Promise<any[]> {\n\t\tconst events = await this.bridgeInstance.getIntent(externalUserId).matrixClient.getRoomState(externalRoomId);\n\t\tconst roomCreator = events.find((event) => event.type === MatrixEventType.ROOM_CREATED)?.content?.creator;\n\t\tif (!roomCreator) {\n\t\t\treturn [];\n\t\t}\n\t\treturn events\n\t\t\t.filter(\n\t\t\t\t(event) =>\n\t\t\t\t\tevent.type === MatrixEventType.ROOM_MEMBERSHIP_CHANGED &&\n\t\t\t\t\tevent.content.membership === RoomMembershipChangedEventType.JOIN &&\n\t\t\t\t\t!excludingUserIds.includes(event.state_key),\n\t\t\t)\n\t\t\t.map((event) => ({\n\t\t\t\t...event,\n\t\t\t\tsender: roomCreator,\n\t\t\t}));\n\t}\n\n\tpublic async getRoomData(\n\t\texternalUserId: string,\n\t\texternalRoomId: string,\n\t): Promise<{ creator: { id: string; username: string }; name: string; joinedMembers: string[] } | undefined> {\n\t\tconst includeEvents = ['join'];\n\t\tconst excludeEvents = ['leave', 'ban'];\n\t\tconst members = await this.bridgeInstance\n\t\t\t.getIntent(externalUserId)\n\t\t\t.matrixClient.getRoomMembers(externalRoomId, undefined, includeEvents as any[], excludeEvents as any[]);\n\n\t\tconst joinedMembers = await this.bridgeInstance.getIntent(externalUserId).matrixClient.getJoinedRoomMembers(externalRoomId);\n\n\t\tconst oldestFirst = members.sort((a, b) => a.timestamp - b.timestamp).shift();\n\t\tif (!oldestFirst) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst roomName = await this.getRoomName(externalRoomId, externalUserId);\n\t\tif (!roomName) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn {\n\t\t\tcreator: {\n\t\t\t\tid: oldestFirst.sender,\n\t\t\t\tusername: formatExternalUserIdToInternalUsernameFormat(oldestFirst.sender),\n\t\t\t},\n\t\t\tjoinedMembers,\n\t\t\tname: roomName,\n\t\t};\n\t}\n\n\tpublic async inviteToRoom(externalRoomId: string, externalInviterId: string, externalInviteeId: string): Promise<void> {\n\t\ttry {\n\t\t\tawait this.bridgeInstance.getIntent(externalInviterId).invite(externalRoomId, externalInviteeId);\n\t\t} catch (e) {\n\t\t\t// no-op\n\t\t}\n\t}\n\n\tpublic async setUserAvatar(externalUserId: string, avatarUrl: string): Promise<void> {\n\t\ttry {\n\t\t\tawait this.bridgeInstance.getIntent(externalUserId).matrixClient.setAvatarUrl(avatarUrl);\n\t\t} catch (e) {\n\t\t\t// no-op\n\t\t}\n\t}\n\n\tpublic async verifyInviteeIds(matrixIds: string[]): Promise<Map<string, string>> {\n\t\tconst matrixIdVerificationMap = new Map();\n\t\tconst matrixIdsVerificationPromises = matrixIds.map((matrixId) => this.verifyInviteeId(matrixId));\n\t\tconst matrixIdsVerificationPromiseResponse = await Promise.allSettled(matrixIdsVerificationPromises);\n\t\tconst matrixIdsVerificationFulfilledResults = matrixIdsVerificationPromiseResponse\n\t\t\t.filter((result): result is PromiseFulfilledResult<VerificationStatus> => result.status === 'fulfilled')\n\t\t\t.map((result) => result.value);\n\n\t\tmatrixIds.forEach((matrixId, idx) => matrixIdVerificationMap.set(matrixId, matrixIdsVerificationFulfilledResults[idx]));\n\t\treturn matrixIdVerificationMap;\n\t}\n\n\tprivate async verifyInviteeId(externalInviteeId: string): Promise<VerificationStatus> {\n\t\tconst [userId, homeserverUrl] = extractUserIdAndHomeserverFromMatrixId(externalInviteeId);\n\t\ttry {\n\t\t\tconst response = await fetch(`https://${homeserverUrl}/_matrix/client/v3/register/available`, { params: { username: userId } });\n\n\t\t\tif (response.status === HttpStatusCodes.BAD_REQUEST) {\n\t\t\t\tconst responseBody = await response.json();\n\n\t\t\t\tif (responseBody.errcode === MATRIX_USER_IN_USE) {\n\t\t\t\t\treturn VerificationStatus.VERIFIED;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (response.status === HttpStatusCodes.OK) {\n\t\t\t\treturn VerificationStatus.UNVERIFIED;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\treturn VerificationStatus.UNABLE_TO_VERIFY;\n\t\t}\n\n\t\treturn VerificationStatus.UNABLE_TO_VERIFY;\n\t}\n\n\tpublic async createUser(username: string, name: string, domain: string, avatarUrl?: string): Promise<string> {\n\t\tif (!MatrixUserInstance) {\n\t\t\tthrow new Error('Error loading the Matrix User instance from the external library');\n\t\t}\n\t\tconst matrixUserId = `@${username?.toLowerCase()}:${domain}`;\n\t\tconst newUser = new MatrixUserInstance(matrixUserId);\n\t\tawait this.bridgeInstance.provisionUser(newUser, { name, ...(avatarUrl ? { url: avatarUrl } : {}) });\n\n\t\treturn matrixUserId;\n\t}\n\n\tpublic async setUserDisplayName(externalUserId: string, displayName: string): Promise<void> {\n\t\ttry {\n\t\t\tawait this.bridgeInstance.getIntent(externalUserId).setDisplayName(displayName);\n\t\t} catch (e) {\n\t\t\t// no-op\n\t\t}\n\t}\n\n\tpublic async createDirectMessageRoom(\n\t\texternalCreatorId: string,\n\t\tinviteesExternalIds: string[],\n\t\textraData: Record<string, any> = {},\n\t): Promise<string> {\n\t\tconst intent = this.bridgeInstance.getIntent(externalCreatorId);\n\n\t\tconst visibility = MatrixRoomVisibility.PRIVATE;\n\t\tconst preset = MatrixRoomType.PRIVATE;\n\n\t\tconst matrixRoom = await intent.createRoom({\n\t\t\tcreateAsClient: true,\n\t\t\toptions: {\n\t\t\t\tvisibility,\n\t\t\t\tpreset,\n\t\t\t\tis_direct: true,\n\t\t\t\tinvite: inviteesExternalIds,\n\t\t\t\tcreation_content: {\n\t\t\t\t\twas_internally_programatically_created: true,\n\t\t\t\t\t...extraData,\n\t\t\t\t\tinviteesExternalIds,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t\treturn matrixRoom.room_id;\n\t}\n\n\tpublic async sendMessage(externalRoomId: string, externalSenderId: string, message: IMessage): Promise<string> {\n\t\ttry {\n\t\t\tconst messageId = await this.bridgeInstance\n\t\t\t\t.getIntent(externalSenderId)\n\t\t\t\t.matrixClient.sendRawEvent(externalRoomId, MatrixEventType.ROOM_MESSAGE_SENT, {\n\t\t\t\t\tmsgtype: 'm.text',\n\t\t\t\t\tbody: this.escapeEmojis(message.msg),\n\t\t\t\t\tformatted_body: this.escapeEmojis(\n\t\t\t\t\t\tawait toExternalMessageFormat({\n\t\t\t\t\t\t\tmessage: message.msg,\n\t\t\t\t\t\t\texternalRoomId,\n\t\t\t\t\t\t\thomeServerDomain: this.internalSettings.getHomeServerDomain(),\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t\tformat: 'org.matrix.custom.html',\n\t\t\t\t});\n\n\t\t\treturn messageId;\n\t\t} catch (e) {\n\t\t\tthrow new Error('User is not part of the room.');\n\t\t}\n\t}\n\n\tpublic async sendThreadMessage(\n\t\texternalRoomId: string,\n\t\texternalSenderId: string,\n\t\tmessage: IMessage,\n\t\trelatesToEventId: string,\n\t): Promise<string> {\n\t\tconst text = this.escapeEmojis(\n\t\t\tawait toExternalMessageFormat({\n\t\t\t\tmessage: message.msg,\n\t\t\t\texternalRoomId,\n\t\t\t\thomeServerDomain: this.internalSettings.getHomeServerDomain(),\n\t\t\t}),\n\t\t);\n\t\tconst messageId = await this.bridgeInstance\n\t\t\t.getIntent(externalSenderId)\n\t\t\t.matrixClient.sendRawEvent(externalRoomId, MatrixEventType.ROOM_MESSAGE_SENT, {\n\t\t\t\t'msgtype': 'm.text',\n\t\t\t\t'body': this.escapeEmojis(message.msg),\n\t\t\t\t'formatted_body': text,\n\t\t\t\t'format': 'org.matrix.custom.html',\n\t\t\t\t'm.relates_to': {\n\t\t\t\t\t'rel_type': 'm.thread',\n\t\t\t\t\t'event_id': relatesToEventId,\n\t\t\t\t\t'is_falling_back': true,\n\t\t\t\t\t'm.in_reply_to': {\n\t\t\t\t\t\tevent_id: relatesToEventId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\treturn messageId;\n\t}\n\n\tpublic async sendThreadReplyToMessage(\n\t\texternalRoomId: string,\n\t\texternalUserId: string,\n\t\teventToReplyTo: string,\n\t\toriginalEventSender: string,\n\t\treplyMessage: string,\n\t\trelatesToEventId: string,\n\t): Promise<string> {\n\t\tconst { formattedMessage, message } = await toExternalQuoteMessageFormat({\n\t\t\texternalRoomId,\n\t\t\teventToReplyTo,\n\t\t\toriginalEventSender,\n\t\t\tmessage: this.escapeEmojis(replyMessage),\n\t\t\thomeServerDomain: this.internalSettings.getHomeServerDomain(),\n\t\t});\n\t\tconst messageId = await this.bridgeInstance\n\t\t\t.getIntent(externalUserId)\n\t\t\t.matrixClient.sendRawEvent(externalRoomId, MatrixEventType.ROOM_MESSAGE_SENT, {\n\t\t\t\t'msgtype': 'm.text',\n\t\t\t\t'body': message,\n\t\t\t\t'format': 'org.matrix.custom.html',\n\t\t\t\t'formatted_body': formattedMessage,\n\t\t\t\t'm.relates_to': {\n\t\t\t\t\t'rel_type': 'm.thread',\n\t\t\t\t\t'event_id': relatesToEventId,\n\t\t\t\t\t'is_falling_back': false,\n\t\t\t\t\t'm.in_reply_to': {\n\t\t\t\t\t\tevent_id: eventToReplyTo,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\treturn messageId;\n\t}\n\n\tpublic async sendMessageFileToThread(\n\t\texternalRoomId: string,\n\t\texternalSenderId: string,\n\t\tcontent: Buffer,\n\t\tfileDetails: { filename: string; fileSize: number; mimeType: string; metadata?: { width?: number; height?: number; format?: string } },\n\t\trelatesToEventId: string,\n\t): Promise<string> {\n\t\ttry {\n\t\t\tconst mxcUrl = await this.bridgeInstance.getIntent(externalSenderId).uploadContent(content);\n\t\t\tconst messageId = await this.bridgeInstance\n\t\t\t\t.getIntent(externalSenderId)\n\t\t\t\t.matrixClient.sendRawEvent(externalRoomId, MatrixEventType.ROOM_MESSAGE_SENT, {\n\t\t\t\t\t'body': fileDetails.filename,\n\t\t\t\t\t'filename': fileDetails.filename,\n\t\t\t\t\t'info': {\n\t\t\t\t\t\tsize: fileDetails.fileSize,\n\t\t\t\t\t\tmimetype: fileDetails.mimeType,\n\t\t\t\t\t\t...(fileDetails.metadata?.height && fileDetails.metadata?.width\n\t\t\t\t\t\t\t? { h: fileDetails.metadata?.height, w: fileDetails.metadata?.width }\n\t\t\t\t\t\t\t: {}),\n\t\t\t\t\t},\n\t\t\t\t\t'msgtype': this.getMsgTypeBasedOnMimeType(fileDetails.mimeType),\n\t\t\t\t\t'url': mxcUrl,\n\t\t\t\t\t'm.relates_to': {\n\t\t\t\t\t\t'rel_type': 'm.thread',\n\t\t\t\t\t\t'event_id': relatesToEventId,\n\t\t\t\t\t\t'is_falling_back': true,\n\t\t\t\t\t\t'm.in_reply_to': {\n\t\t\t\t\t\t\tevent_id: relatesToEventId,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\treturn messageId;\n\t\t} catch (e: any) {\n\t\t\tfederationBridgeLogger.error({ msg: 'Error sending file to thread', err: e });\n\t\t\tif (e.body?.includes('413') || e.body?.includes('M_TOO_LARGE')) {\n\t\t\t\tthrow new Error('File is too large');\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\t}\n\n\tpublic async sendReplyMessageFileToThread(\n\t\texternalRoomId: string,\n\t\texternalSenderId: string,\n\t\tcontent: Buffer,\n\t\tfileDetails: { filename: string; fileSize: number; mimeType: string; metadata?: { width?: number; height?: number; format?: string } },\n\t\teventToReplyTo: string,\n\t\trelatesToEventId: string,\n\t): Promise<string> {\n\t\ttry {\n\t\t\tconst mxcUrl = await this.bridgeInstance.getIntent(externalSenderId).uploadContent(content);\n\t\t\tconst messageId = await this.bridgeInstance\n\t\t\t\t.getIntent(externalSenderId)\n\t\t\t\t.matrixClient.sendRawEvent(externalRoomId, MatrixEventType.ROOM_MESSAGE_SENT, {\n\t\t\t\t\t'body': fileDetails.filename,\n\t\t\t\t\t'filename': fileDetails.filename,\n\t\t\t\t\t'info': {\n\t\t\t\t\t\tsize: fileDetails.fileSize,\n\t\t\t\t\t\tmimetype: fileDetails.mimeType,\n\t\t\t\t\t\t...(fileDetails.metadata?.height && fileDetails.metadata?.width\n\t\t\t\t\t\t\t? { h: fileDetails.metadata?.height, w: fileDetails.metadata?.width }\n\t\t\t\t\t\t\t: {}),\n\t\t\t\t\t},\n\t\t\t\t\t'msgtype': this.getMsgTypeBasedOnMimeType(fileDetails.mimeType),\n\t\t\t\t\t'url': mxcUrl,\n\t\t\t\t\t'm.relates_to': {\n\t\t\t\t\t\t'rel_type': 'm.thread',\n\t\t\t\t\t\t'event_id': relatesToEventId,\n\t\t\t\t\t\t'is_falling_back': false,\n\t\t\t\t\t\t'm.in_reply_to': {\n\t\t\t\t\t\t\tevent_id: eventToReplyTo,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\treturn messageId;\n\t\t} catch (e: any) {\n\t\t\tfederationBridgeLogger.error({ msg: 'Error sending file to thread', err: e });\n\t\t\tif (e.body?.includes('413') || e.body?.includes('M_TOO_LARGE')) {\n\t\t\t\tthrow new Error('File is too large');\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\t}\n\n\tpublic async sendReplyToMessage(\n\t\texternalRoomId: string,\n\t\texternalUserId: string,\n\t\teventToReplyTo: string,\n\t\toriginalEventSender: string,\n\t\treplyMessage: string,\n\t): Promise<string> {\n\t\tconst { formattedMessage, message } = await toExternalQuoteMessageFormat({\n\t\t\texternalRoomId,\n\t\t\teventToReplyTo,\n\t\t\toriginalEventSender,\n\t\t\tmessage: this.escapeEmojis(replyMessage),\n\t\t\thomeServerDomain: this.internalSettings.getHomeServerDomain(),\n\t\t});\n\t\tconst messageId = await this.bridgeInstance\n\t\t\t.getIntent(externalUserId)\n\t\t\t.matrixClient.sendEvent(externalRoomId, MatrixEventType.ROOM_MESSAGE_SENT, {\n\t\t\t\t'body': message,\n\t\t\t\t'format': 'org.matrix.custom.html',\n\t\t\t\t'formatted_body': formattedMessage,\n\t\t\t\t'm.relates_to': {\n\t\t\t\t\t'm.in_reply_to': { event_id: eventToReplyTo },\n\t\t\t\t},\n\t\t\t\t'msgtype': MatrixEnumSendMessageType.TEXT,\n\t\t\t});\n\n\t\treturn messageId;\n\t}\n\n\tprivate escapeEmojis(text: string): string {\n\t\treturn convertEmojisFromRCFormatToMatrixFormat(text);\n\t}\n\n\tpublic async getReadStreamForFileFromUrl(externalUserId: string, fileUrl: string): Promise<ReadableStream> {\n\t\tconst response = await fetch(await this.convertMatrixUrlToHttp(externalUserId, fileUrl));\n\t\tif (!response.body) {\n\t\t\tthrow new Error('Not able to download the file');\n\t\t}\n\n\t\treturn response.body as unknown as ReadableStream;\n\t}\n\n\tpublic isUserIdFromTheSameHomeserver(externalUserId: string, domain: string): boolean {\n\t\tconst userDomain = this.extractHomeserverOrigin(externalUserId);\n\n\t\treturn userDomain === domain;\n\t}\n\n\tpublic extractHomeserverOrigin(externalUserId: string): string {\n\t\treturn externalUserId.includes(':') ? externalUserId.split(':').pop() || '' : this.internalSettings.getHomeServerDomain();\n\t}\n\n\tpublic isRoomFromTheSameHomeserver(externalRoomId: string, domain: string): boolean {\n\t\treturn this.isUserIdFromTheSameHomeserver(externalRoomId, domain);\n\t}\n\n\tpublic logFederationStartupInfo(info?: string): void {\n\t\tfederationBridgeLogger.info(`${info}:\n\t\t\tid: ${this.internalSettings.getApplicationServiceId()}\n\t\t\tbridgeUrl: ${this.internalSettings.getBridgeUrl()}\n\t\t\thomeserverURL: ${this.internalSettings.getHomeServerUrl()}\n\t\t\thomeserverDomain: ${this.internalSettings.getHomeServerDomain()}\n\t\t`);\n\t}\n\n\tpublic async leaveRoom(externalRoomId: string, externalUserId: string): Promise<void> {\n\t\ttry {\n\t\t\tawait this.bridgeInstance.getIntent(externalUserId).leave(externalRoomId);\n\t\t} catch (e) {\n\t\t\t// no-op\n\t\t}\n\t}\n\n\tpublic async kickUserFromRoom(externalRoomId: string, externalUserId: string, externalOwnerId: string): Promise<void> {\n\t\tawait this.bridgeInstance.getIntent(externalOwnerId).kick(externalRoomId, externalUserId);\n\t}\n\n\tpublic async setRoomPowerLevels(\n\t\texternalRoomId: string,\n\t\texternalOwnerId: string,\n\t\texternalUserId: string,\n\t\tpowerLevels: number,\n\t): Promise<void> {\n\t\tawait this.bridgeInstance.getIntent(externalOwnerId).setPowerLevel(externalRoomId, externalUserId, powerLevels);\n\t}\n\n\tpublic async redactEvent(externalRoomId: string, externalUserId: string, externalEventId: string): Promise<void> {\n\t\tawait this.bridgeInstance.getIntent(externalUserId).matrixClient.redactEvent(externalRoomId, externalEventId);\n\t}\n\n\tpublic async notifyUserTyping(externalRoomId: string, externalUserId: string, isTyping: boolean): Promise<void> {\n\t\tawait this.bridgeInstance.getIntent(externalUserId).sendTyping(externalRoomId, isTyping);\n\t}\n\n\tpublic async sendMessageReaction(\n\t\texternalRoomId: string,\n\t\texternalUserId: string,\n\t\texternalEventId: string,\n\t\treaction: string,\n\t): Promise<string> {\n\t\tconst eventId = await this.bridgeInstance\n\t\t\t.getIntent(externalUserId)\n\t\t\t.matrixClient.sendEvent(externalRoomId, MatrixEventType.MESSAGE_REACTED, {\n\t\t\t\t'm.relates_to': {\n\t\t\t\t\tevent_id: externalEventId,\n\t\t\t\t\tkey: convertEmojisFromRCFormatToMatrixFormat(reaction),\n\t\t\t\t\trel_type: 'm.annotation',\n\t\t\t\t},\n\t\t\t});\n\n\t\treturn eventId;\n\t}\n\n\tpublic async updateMessage(\n\t\texternalRoomId: string,\n\t\texternalUserId: string,\n\t\texternalEventId: string,\n\t\tnewMessageText: string,\n\t): Promise<void> {\n\t\tconst messageInExternalFormat = this.escapeEmojis(\n\t\t\tawait toExternalMessageFormat({\n\t\t\t\tmessage: newMessageText,\n\t\t\t\texternalRoomId,\n\t\t\t\thomeServerDomain: this.internalSettings.getHomeServerDomain(),\n\t\t\t}),\n\t\t);\n\n\t\tawait this.bridgeInstance.getIntent(externalUserId).matrixClient.sendEvent(externalRoomId, MatrixEventType.ROOM_MESSAGE_SENT, {\n\t\t\t'body': ` * ${this.escapeEmojis(newMessageText)}`,\n\t\t\t'format': 'org.matrix.custom.html',\n\t\t\t'formatted_body': messageInExternalFormat,\n\t\t\t'm.new_content': {\n\t\t\t\tbody: this.escapeEmojis(newMessageText),\n\t\t\t\tformat: 'org.matrix.custom.html',\n\t\t\t\tformatted_body: messageInExternalFormat,\n\t\t\t\tmsgtype: MatrixEnumSendMessageType.TEXT,\n\t\t\t},\n\t\t\t'm.relates_to': {\n\t\t\t\trel_type: MatrixEnumRelatesToRelType.REPLACE,\n\t\t\t\tevent_id: externalEventId,\n\t\t\t},\n\t\t\t'msgtype': MatrixEnumSendMessageType.TEXT,\n\t\t});\n\t}\n\n\tpublic async sendMessageFileToRoom(\n\t\texternalRoomId: string,\n\t\texternaSenderId: string,\n\t\tcontent: Buffer,\n\t\tfileDetails: { filename: string; fileSize: number; mimeType: string; metadata?: { width?: number; height?: number; format?: string } },\n\t): Promise<string> {\n\t\ttry {\n\t\t\tconst mxcUrl = await this.bridgeInstance.getIntent(externaSenderId).uploadContent(content);\n\t\t\tconst { event_id: messageId } = await this.bridgeInstance.getIntent(externaSenderId).sendMessage(externalRoomId, {\n\t\t\t\tbody: fileDetails.filename,\n\t\t\t\tfilename: fileDetails.filename,\n\t\t\t\tinfo: {\n\t\t\t\t\tsize: fileDetails.fileSize,\n\t\t\t\t\tmimetype: fileDetails.mimeType,\n\t\t\t\t\t...(fileDetails.metadata?.height && fileDetails.metadata?.width\n\t\t\t\t\t\t? { h: fileDetails.metadata?.height, w: fileDetails.metadata?.width }\n\t\t\t\t\t\t: {}),\n\t\t\t\t},\n\t\t\t\tmsgtype: this.getMsgTypeBasedOnMimeType(fileDetails.mimeType),\n\t\t\t\turl: mxcUrl,\n\t\t\t});\n\n\t\t\treturn messageId;\n\t\t} catch (e: any) {\n\t\t\tfederationBridgeLogger.error({ msg: 'Error sending file to room', err: e });\n\t\t\tif (e.body?.includes('413') || e.body?.includes('M_TOO_LARGE')) {\n\t\t\t\tthrow new Error('File is too large');\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\t}\n\n\tpublic async sendReplyMessageFileToRoom(\n\t\texternalRoomId: string,\n\t\texternaSenderId: string,\n\t\tcontent: Buffer,\n\t\tfileDetails: { filename: string; fileSize: number; mimeType: string; metadata?: { width?: number; height?: number; format?: string } },\n\t\teventToReplyTo: string,\n\t): Promise<string> {\n\t\ttry {\n\t\t\tconst mxcUrl = await this.bridgeInstance.getIntent(externaSenderId).uploadContent(content);\n\t\t\tconst { event_id: messageId } = await this.bridgeInstance.getIntent(externaSenderId).sendMessage(externalRoomId, {\n\t\t\t\t'body': fileDetails.filename,\n\t\t\t\t'filename': fileDetails.filename,\n\t\t\t\t'info': {\n\t\t\t\t\tsize: fileDetails.fileSize,\n\t\t\t\t\tmimetype: fileDetails.mimeType,\n\t\t\t\t\t...(fileDetails.metadata?.height && fileDetails.metadata?.width\n\t\t\t\t\t\t? { h: fileDetails.metadata?.height, w: fileDetails.metadata?.width }\n\t\t\t\t\t\t: {}),\n\t\t\t\t},\n\t\t\t\t'm.relates_to': {\n\t\t\t\t\t'm.in_reply_to': { event_id: eventToReplyTo },\n\t\t\t\t},\n\t\t\t\t'msgtype': this.getMsgTypeBasedOnMimeType(fileDetails.mimeType),\n\t\t\t\t'url': mxcUrl,\n\t\t\t});\n\n\t\t\treturn messageId;\n\t\t} catch (e: any) {\n\t\t\tfederationBridgeLogger.error({ msg: 'Error sending file to room', err: e });\n\t\t\tif (e.body?.includes('413') || e.body?.includes('M_TOO_LARGE')) {\n\t\t\t\tthrow new Error('File is too large');\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\t}\n\n\tprivate getMsgTypeBasedOnMimeType(mimeType: string): MatrixEnumSendMessageType {\n\t\tconst knownImageMimeTypes = ['image/jpeg', 'image/png', 'image/gif'];\n\t\tconst knownAudioMimeTypes = ['audio/mpeg', 'audio/ogg', 'audio/wav'];\n\t\tconst knownVideoMimeTypes = ['video/mp4', 'video/ogg', 'video/webm'];\n\n\t\tif (knownImageMimeTypes.includes(mimeType)) {\n\t\t\treturn MatrixEnumSendMessageType.IMAGE;\n\t\t}\n\t\tif (knownAudioMimeTypes.includes(mimeType)) {\n\t\t\treturn MatrixEnumSendMessageType.AUDIO;\n\t\t}\n\t\tif (knownVideoMimeTypes.includes(mimeType)) {\n\t\t\treturn MatrixEnumSendMessageType.VIDEO;\n\t\t}\n\t\treturn MatrixEnumSendMessageType.FILE;\n\t}\n\n\tprivate getMyHomeServerOrigin() {\n\t\treturn new URL(`https://${this.internalSettings.getHomeServerDomain()}`).hostname;\n\t}\n\n\tpublic async uploadContent(\n\t\texternalSenderId: string,\n\t\tcontent: Buffer,\n\t\toptions?: { name?: string; type?: string },\n\t): Promise<string | undefined> {\n\t\ttry {\n\t\t\tconst mxcUrl = await this.bridgeInstance.getIntent(externalSenderId).uploadContent(content, options);\n\n\t\t\treturn mxcUrl;\n\t\t} catch (e: any) {\n\t\t\tfederationBridgeLogger.error({ msg: 'Error uploading content to Matrix', err: e });\n\t\t\tif (e.body?.includes('413') || e.body?.includes('M_TOO_LARGE')) {\n\t\t\t\tthrow new Error('File is too large');\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic async getRoomName(externalRoomId: string, externalUserId: string): Promise<string | undefined> {\n\t\ttry {\n\t\t\tconst roomState = (await this.bridgeInstance.getIntent(externalUserId).roomState(externalRoomId)) as AbstractMatrixEvent[];\n\n\t\t\treturn ((roomState || []).find((event) => event?.type === MatrixEventType.ROOM_NAME_CHANGED) as MatrixEventRoomNameChanged)?.content\n\t\t\t\t?.name;\n\t\t} catch (error) {\n\t\t\t// no-op\n\t\t}\n\t}\n\n\tpublic async getRoomTopic(externalRoomId: string, externalUserId: string): Promise<string | undefined> {\n\t\ttry {\n\t\t\tconst roomState = (await this.bridgeInstance.getIntent(externalUserId).roomState(externalRoomId)) as AbstractMatrixEvent[];\n\n\t\t\treturn ((roomState || []).find((event) => event?.type === MatrixEventType.ROOM_TOPIC_CHANGED) as MatrixEventRoomTopicChanged)?.content\n\t\t\t\t?.topic;\n\t\t} catch (error) {\n\t\t\t// no-op\n\t\t}\n\t}\n\n\tpublic async setRoomName(externalRoomId: string, externalUserId: string, roomName: string): Promise<void> {\n\t\tawait this.bridgeInstance.getIntent(externalUserId).setRoomName(externalRoomId, roomName);\n\t}\n\n\tpublic async setRoomTopic(externalRoomId: string, externalUserId: string, roomTopic: string): Promise<void> {\n\t\tawait this.bridgeInstance.getIntent(externalUserId).setRoomTopic(externalRoomId, roomTopic);\n\t}\n\n\tpublic convertMatrixUrlToHttp(externalUserId: string, matrixUrl: string): Promise<string> {\n\t\treturn this.bridgeInstance.getIntent(externalUserId).matrixClient.mxcToHttp(matrixUrl);\n\t}\n\n\tprotected async createInstance(): Promise<void> {\n\t\tfederationBridgeLogger.info('Performing Dynamic Import of matrix-appservice-bridge');\n\n\t\t// Dynamic import to prevent Rocket.Chat from loading the module until needed and then handle if that fails\n\t\tconst { Bridge, AppServiceRegistration, MatrixUser } = await import('matrix-appservice-bridge');\n\t\tMatrixUserInstance = MatrixUser;\n\t\tconst registrationFile = this.internalSettings.getAppServiceRegistrationObject();\n\n\t\tthis.bridgeInstance = new Bridge({\n\t\t\thomeserverUrl: this.internalSettings.getHomeServerUrl(),\n\t\t\tdomain: this.internalSettings.getHomeServerDomain(),\n\t\t\tregistration: AppServiceRegistration.fromObject(this.convertRegistrationFileToMatrixFormat(registrationFile)),\n\t\t\tdisableStores: true,\n\t\t\tcontroller: {\n\t\t\t\tonEvent: (request) => {\n\t\t\t\t\tconst event = request.getData() as unknown as AbstractMatrixEvent;\n\n\t\t\t\t\t// TODO: can we ignore all events from out homeserver?\n\t\t\t\t\t// This was added particularly to avoid duplicating messages.\n\t\t\t\t\t// Messages sent from rocket.chat also causes a m.room.message event, which if gets to this bridge\n\t\t\t\t\t// before the event id promise is resolved, the respective message does not get event id attached to them any longer,\n\t\t\t\t\t// thus this event handler \"resends\" the message to the rocket.chat room (not to matrix though).\n\t\t\t\t\tif (event.type === 'm.room.message' && this.extractHomeserverOrigin(event.sender) === this.getMyHomeServerOrigin()) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.eventHandler(event);\n\t\t\t\t},\n\t\t\t\tonLog: (line, isError) => {\n\t\t\t\t\tconsole.log(line, isError);\n\t\t\t\t},\n\t\t\t\t...(this.internalSettings.getAppServiceRegistrationObject().enableEphemeralEvents\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tonEphemeralEvent: (request) => {\n\t\t\t\t\t\t\t\tconst event = request.getData() as unknown as AbstractMatrixEvent;\n\t\t\t\t\t\t\t\tthis.eventHandler(event);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t: {}),\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate convertRegistrationFileToMatrixFormat(registrationFile: IFederationBridgeRegistrationFile): AppServiceOutput {\n\t\treturn {\n\t\t\t'id': registrationFile.id,\n\t\t\t'hs_token': registrationFile.homeserverToken,\n\t\t\t'as_token': registrationFile.applicationServiceToken,\n\t\t\t'url': registrationFile.bridgeUrl,\n\t\t\t'sender_localpart': registrationFile.botName,\n\t\t\t'namespaces': registrationFile.listenTo,\n\t\t\t'de.sorunome.msc2409.push_ephemeral': registrationFile.enableEphemeralEvents,\n\t\t};\n\t}\n\n\tpublic async ping(): Promise<{ durationMs: number }> {\n\t\tif (!this.isRunning || !this.bridgeInstance) {\n\t\t\tthrow new Error(\"matrix bridge isn't yet running\");\n\t\t}\n\n\t\tconst { duration_ms: durationMs } = await this.bridgeInstance.getIntent().matrixClient.doRequest(\n\t\t\t'POST',\n\t\t\t`/_matrix/client/v1/appservice/${this.internalSettings.getApplicationServiceId()}/ping`,\n\t\t\t{},\n\t\t\t/*\n\t\t\t * Empty txn id as it is optional, neither does the spec says exactly what to do with it.\n\t\t\t * https://github.com/matrix-org/matrix-spec/blob/1fc8f8856fe47849f90344cfa91601c984627acb/data/api/client-server/appservice_ping.yaml#L55-L56\n\t\t\t */\n\t\t\t{},\n\t\t\tDEFAULT_TIMEOUT_IN_MS_FOR_PING_EVENT,\n\t\t);\n\n\t\treturn { durationMs };\n\t}\n\n\tpublic async deactivateUser(uid: string): Promise<void> {\n\t\t/*\n\t\t * https://spec.matrix.org/v1.11/client-server-api/#post_matrixclientv3accountdeactivate\n\t\t * Using { erase: false } since rocket.chat side on deactivation we do not delete anything.\n\t\t */\n\t\tconst resp = await this.bridgeInstance\n\t\t\t.getIntent()\n\t\t\t.matrixClient.doRequest('POST', '/_matrix/client/v3/account/deactivate', { user_id: uid }, { erase: false });\n\t\tif (resp.id_server_unbind_result !== 'success') {\n\t\t\tthrow new Error('Failed to deactivate matrix user');\n\t\t}\n\t}\n}\n"],"names":["MatrixBridge","MatrixUserInstance","DEFAULT_TIMEOUT_IN_MS_FOR_JOINING_ROOMS","DEFAULT_TIMEOUT_IN_MS_FOR_PING_EVENT","start","isUpdatingBridgeStatus","stop","createInstance","isRunning","bridgeInstance","run","internalSettings","getBridgePort","addAppServicePath","method","path","authenticate","handler","_req","res","_next","status","json","err","federationBridgeLogger","error","msg","Promise","resolve","close","getUserProfileInformation","externalUserId","externalInformation","getIntent","getProfileInfo","undefined","displayName","displayname","avatar_url","avatarUrl","joinRoom","externalRoomId","viaServers","matrixClient","doRequest","server_name","e","Error","getRoomHistoricalJoinEvents","excludingUserIds","events","getRoomState","roomCreator","find","event","type","MatrixEventType","ROOM_CREATED","content","creator","filter","ROOM_MEMBERSHIP_CHANGED","membership","RoomMembershipChangedEventType","JOIN","includes","state_key","map","sender","getRoomData","includeEvents","excludeEvents","members","getRoomMembers","joinedMembers","getJoinedRoomMembers","oldestFirst","sort","a","b","timestamp","shift","roomName","getRoomName","id","username","formatExternalUserIdToInternalUsernameFormat","name","inviteToRoom","externalInviterId","externalInviteeId","invite","setUserAvatar","setAvatarUrl","verifyInviteeIds","matrixIds","matrixIdVerificationMap","Map","matrixIdsVerificationPromises","matrixId","verifyInviteeId","matrixIdsVerificationPromiseResponse","allSettled","matrixIdsVerificationFulfilledResults","result","value","forEach","idx","set","userId","homeserverUrl","extractUserIdAndHomeserverFromMatrixId","response","fetch","params","HttpStatusCodes","BAD_REQUEST","responseBody","errcode","MATRIX_USER_IN_USE","VerificationStatus","VERIFIED","OK","UNVERIFIED","UNABLE_TO_VERIFY","createUser","domain","matrixUserId","toLowerCase","newUser","provisionUser","url","setUserDisplayName","setDisplayName","createDirectMessageRoom","externalCreatorId","inviteesExternalIds","extraData","intent","visibility","MatrixRoomVisibility","PRIVATE","preset","MatrixRoomType","matrixRoom","createRoom","createAsClient","options","is_direct","creation_content","was_internally_programatically_created","room_id","sendMessage","externalSenderId","message","messageId","sendRawEvent","ROOM_MESSAGE_SENT","msgtype","body","escapeEmojis","formatted_body","toExternalMessageFormat","homeServerDomain","getHomeServerDomain","format","sendThreadMessage","relatesToEventId","text","event_id","sendThreadReplyToMessage","eventToReplyTo","originalEventSender","replyMessage","formattedMessage","toExternalQuoteMessageFormat","sendMessageFileToThread","fileDetails","mxcUrl","uploadContent","filename","size","fileSize","mimetype","mimeType","metadata","height","width","h","w","getMsgTypeBasedOnMimeType","sendReplyMessageFileToThread","sendReplyToMessage","sendEvent","MatrixEnumSendMessageType","TEXT","convertEmojisFromRCFormatToMatrixFormat","getReadStreamForFileFromUrl","fileUrl","convertMatrixUrlToHttp","isUserIdFromTheSameHomeserver","userDomain","extractHomeserverOrigin","split","pop","isRoomFromTheSameHomeserver","logFederationStartupInfo","info","getApplicationServiceId","getBridgeUrl","getHomeServerUrl","leaveRoom","leave","kickUserFromRoom","externalOwnerId","kick","setRoomPowerLevels","powerLevels","setPowerLevel","redactEvent","externalEventId","notifyUserTyping","isTyping","sendTyping","sendMessageReaction","reaction","eventId","MESSAGE_REACTED","key","rel_type","updateMessage","newMessageText","messageInExternalFormat","MatrixEnumRelatesToRelType","REPLACE","sendMessageFileToRoom","externaSenderId","sendReplyMessageFileToRoom","knownImageMimeTypes","knownAudioMimeTypes","knownVideoMimeTypes","IMAGE","AUDIO","VIDEO","FILE","getMyHomeServerOrigin","URL","hostname","roomState","ROOM_NAME_CHANGED","getRoomTopic","ROOM_TOPIC_CHANGED","topic","setRoomName","setRoomTopic","roomTopic","matrixUrl","mxcToHttp","Bridge","AppServiceRegistration","MatrixUser","registrationFile","getAppServiceRegistrationObject","registration","fromObject","convertRegistrationFileToMatrixFormat","disableStores","controller","onEvent","request","getData","eventHandler","onLog","line","isError","console","log","enableEphemeralEvents","onEphemeralEvent","homeserverToken","applicationServiceToken","bridgeUrl","botName","listenTo","ping","duration_ms","durationMs","deactivateUser","uid","resp","user_id","erase","id_server_unbind_result","constructor"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/Bridge.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"1912c381f8840b905a956b15f484b39eb8d5f33e","contentHash":"27d0cb3ed633ca0764c1192ae357430157827b3d130a92795bec90cf32a8f4b7"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/adapters/logger.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/adapters/logger.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":38}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":39}},"6":{"start":{"line":19,"column":16},"end":{"line":19,"column":46}},"7":{"start":{"line":20,"column":15},"end":{"line":20,"column":54}},"8":{"start":{"line":21,"column":31},"end":{"line":21,"column":73}},"9":{"start":{"line":22,"column":32},"end":{"line":22,"column":75}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":28},"end":{"line":12,"column":29}},"loc":{"start":{"line":12,"column":39},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":29},"end":{"line":15,"column":30}},"loc":{"start":{"line":15,"column":40},"end":{"line":17,"column":5}},"line":15}},"branchMap":{},"s":{"0":1,"1":1,"2":2,"3":1,"4":0,"5":0,"6":1,"7":1,"8":1,"9":1},"f":{"0":1,"1":0,"2":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/adapters/logger.ts"],"sourcesContent":["import { Logger } from '@rocket.chat/logger';\n\nconst logger = new Logger('Federation_Matrix');\n\nexport const federationBridgeLogger = logger.section('matrix_federation_bridge');\n\nexport const federationServiceLogger = logger.section('matrix_federation_service');\n"],"names":["federationBridgeLogger","federationServiceLogger","logger","Logger","section"],"mappings":";;;;;;;;;;;IAIaA,sBAAsB;eAAtBA;;IAEAC,uBAAuB;eAAvBA;;;wBANU;AAEvB,MAAMC,SAAS,IAAIC,cAAM,CAAC;AAEnB,MAAMH,yBAAyBE,OAAOE,OAAO,CAAC;AAE9C,MAAMH,0BAA0BC,OAAOE,OAAO,CAAC","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/adapters/logger.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9c211abe6e2f7df7f231fa72866115b18e7a58ec","contentHash":"15dcce4b03d5937084d4ef51aff7d4af7cdfb11526c9b84aa3a24bb5d2dba863"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/MessageReceiver.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/MessageReceiver.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":46}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":55}},"6":{"start":{"line":19,"column":32},"end":{"line":19,"column":77}},"7":{"start":{"line":20,"column":28},"end":{"line":20,"column":92}},"8":{"start":{"line":21,"column":22},"end":{"line":21,"column":47}},"9":{"start":{"line":23,"column":4},"end":{"line":25,"column":6}},"10":{"start":{"line":27,"column":44},"end":{"line":27,"column":85}},"11":{"start":{"line":27,"column":53},"end":{"line":27,"column":85}},"12":{"start":{"line":28,"column":48},"end":{"line":28,"column":100}},"13":{"start":{"line":28,"column":57},"end":{"line":28,"column":100}},"14":{"start":{"line":29,"column":37},"end":{"line":40,"column":1}},"15":{"start":{"line":31,"column":8},"end":{"line":38,"column":11}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":36},"end":{"line":12,"column":37}},"loc":{"start":{"line":12,"column":47},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":45},"end":{"line":15,"column":46}},"loc":{"start":{"line":15,"column":56},"end":{"line":17,"column":5}},"line":15},"3":{"name":"_interop_require_default","decl":{"start":{"line":22,"column":9},"end":{"line":22,"column":33}},"loc":{"start":{"line":22,"column":39},"end":{"line":26,"column":1}},"line":22},"4":{"name":"(anonymous_4)","decl":{"start":{"line":27,"column":44},"end":{"line":27,"column":45}},"loc":{"start":{"line":27,"column":53},"end":{"line":27,"column":85}},"line":27},"5":{"name":"(anonymous_5)","decl":{"start":{"line":28,"column":48},"end":{"line":28,"column":49}},"loc":{"start":{"line":28,"column":57},"end":{"line":28,"column":100}},"line":28},"6":{"name":"(anonymous_6)","decl":{"start":{"line":30,"column":4},"end":{"line":30,"column":5}},"loc":{"start":{"line":30,"column":47},"end":{"line":39,"column":5}},"line":30}},"branchMap":{"0":{"loc":{"start":{"line":23,"column":11},"end":{"line":25,"column":5}},"type":"cond-expr","locations":[{"start":{"line":23,"column":35},"end":{"line":23,"column":38}},{"start":{"line":23,"column":41},"end":{"line":25,"column":5}}],"line":23},"1":{"loc":{"start":{"line":23,"column":11},"end":{"line":23,"column":32}},"type":"binary-expr","locations":[{"start":{"line":23,"column":11},"end":{"line":23,"column":14}},{"start":{"line":23,"column":18},"end":{"line":23,"column":32}}],"line":23}},"s":{"0":1,"1":1,"2":2,"3":1,"4":0,"5":0,"6":1,"7":1,"8":1,"9":1,"10":1,"11":0,"12":1,"13":0,"14":1,"15":0},"f":{"0":1,"1":0,"2":0,"3":1,"4":0,"5":0,"6":0},"b":{"0":[0,1],"1":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/MessageReceiver.ts"],"sourcesContent":["import emojione from 'emojione';\n\nimport { FederationMessageReactionEventDto } from '../../../../application/room/input/MessageReceiverDto';\nimport type { MatrixEventMessageReact } from '../../definitions/events/MessageReacted';\nimport { convertExternalRoomIdToInternalRoomIdFormat } from './RoomReceiver';\n\nconst convertEmojisMatrixFormatToRCFormat = (emoji: string): string => emojione.toShort(emoji);\nexport const convertEmojisFromRCFormatToMatrixFormat = (emoji: string): string => emojione.shortnameToUnicode(emoji);\n\nexport class MatrixMessageReceiverConverter {\n\tpublic static toMessageReactionDto(externalEvent: MatrixEventMessageReact): FederationMessageReactionEventDto {\n\t\treturn new FederationMessageReactionEventDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\temoji: convertEmojisMatrixFormatToRCFormat(externalEvent.content['m.relates_to'].key),\n\t\t\texternalReactedEventId: externalEvent.content['m.relates_to'].event_id,\n\t\t});\n\t}\n}\n"],"names":["MatrixMessageReceiverConverter","convertEmojisFromRCFormatToMatrixFormat","convertEmojisMatrixFormatToRCFormat","emoji","emojione","toShort","shortnameToUnicode","toMessageReactionDto","externalEvent","FederationMessageReactionEventDto","externalEventId","event_id","externalRoomId","room_id","normalizedRoomId","convertExternalRoomIdToInternalRoomIdFormat","externalSenderId","sender","content","key","externalReactedEventId"],"mappings":";;;;;;;;;;;IASaA,8BAA8B;eAA9BA;;IAFAC,uCAAuC;eAAvCA;;;iEAPQ;oCAE6B;8BAEU;;;;;;AAE5D,MAAMC,sCAAsC,CAACC,QAA0BC,iBAAQ,CAACC,OAAO,CAACF;AACjF,MAAMF,0CAA0C,CAACE,QAA0BC,iBAAQ,CAACE,kBAAkB,CAACH;AAEvG,IAAA,AAAMH,iCAAN,MAAMA;IACZ,OAAcO,qBAAqBC,aAAsC,EAAqC;QAC7G,OAAO,IAAIC,qDAAiC,CAAC;YAC5CC,iBAAiBF,cAAcG,QAAQ;YACvCC,gBAAgBJ,cAAcK,OAAO;YACrCC,kBAAkBC,IAAAA,yDAA2C,EAACP,cAAcK,OAAO;YACnFG,kBAAkBR,cAAcS,MAAM;YACtCd,OAAOD,oCAAoCM,cAAcU,OAAO,CAAC,eAAe,CAACC,GAAG;YACpFC,wBAAwBZ,cAAcU,OAAO,CAAC,eAAe,CAACP,QAAQ;QACvE;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/MessageReceiver.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6e177cd92b136ef040961992f9053d870920dccc","contentHash":"a7bcf6b7df352eb28839dbae282abe2b51f85a073319997d8b58a53fec1e0c58"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/MessageReceiverDto.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/MessageReceiverDto.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":49}},"3":{"start":{"line":11,"column":25},"end":{"line":11,"column":53}},"4":{"start":{"line":12,"column":40},"end":{"line":23,"column":1}},"5":{"start":{"line":14,"column":8},"end":{"line":18,"column":11}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":27}},"7":{"start":{"line":20,"column":8},"end":{"line":20,"column":49}},"8":{"start":{"line":21,"column":8},"end":{"line":21,"column":61}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":4},"end":{"line":13,"column":5}},"loc":{"start":{"line":13,"column":119},"end":{"line":22,"column":5}},"line":13}},"branchMap":{},"s":{"0":1,"1":1,"2":0,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0},"f":{"0":0,"1":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/MessageReceiverDto.ts"],"sourcesContent":["import type { IFederationReceiverBaseRoomInputDto } from './RoomReceiverDto';\nimport { FederationBaseRoomInputDto } from './RoomReceiverDto';\n\ninterface IFederationRoomMessageReactionInputDto extends IFederationReceiverBaseRoomInputDto {\n\texternalSenderId: string;\n\texternalEventId: string;\n\texternalReactedEventId: string;\n\temoji: string;\n}\n\nexport class FederationMessageReactionEventDto extends FederationBaseRoomInputDto {\n\tconstructor({\n\t\texternalRoomId,\n\t\tnormalizedRoomId,\n\t\texternalEventId,\n\t\texternalReactedEventId,\n\t\temoji,\n\t\texternalSenderId,\n\t}: IFederationRoomMessageReactionInputDto) {\n\t\tsuper({ externalRoomId, normalizedRoomId, externalEventId });\n\t\tthis.emoji = emoji;\n\t\tthis.externalSenderId = externalSenderId;\n\t\tthis.externalReactedEventId = externalReactedEventId;\n\t}\n\n\temoji: string;\n\n\texternalSenderId: string;\n\n\texternalReactedEventId: string;\n}\n"],"names":["FederationMessageReactionEventDto","FederationBaseRoomInputDto","constructor","externalRoomId","normalizedRoomId","externalEventId","externalReactedEventId","emoji","externalSenderId"],"mappings":";;;;+BAUaA;;;eAAAA;;;iCAT8B;AASpC,IAAA,AAAMA,oCAAN,MAAMA,0CAA0CC,2CAA0B;IAChFC,YAAY,EACXC,cAAc,EACdC,gBAAgB,EAChBC,eAAe,EACfC,sBAAsB,EACtBC,KAAK,EACLC,gBAAgB,EACwB,CAAE;QAC1C,KAAK,CAAC;YAAEL;YAAgBC;YAAkBC;QAAgB;QAC1D,IAAI,CAACE,KAAK,GAAGA;QACb,IAAI,CAACC,gBAAgB,GAAGA;QACxB,IAAI,CAACF,sBAAsB,GAAGA;IAC/B;AAOD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/MessageReceiverDto.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"b7846dc35d9696feda33c19d7dfed0dd79dd5eda","contentHash":"5440d0fefc74c48e06bc9631f6c91cec0e41acb84ac62ed9e2da44383d8f5404"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/to-internal-parser-formatter.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/to-internal-parser-formatter.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":39}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":44}},"6":{"start":{"line":19,"column":16},"end":{"line":19,"column":33}},"7":{"start":{"line":21,"column":4},"end":{"line":21,"column":51}},"8":{"start":{"line":21,"column":39},"end":{"line":21,"column":51}},"9":{"start":{"line":22,"column":28},"end":{"line":22,"column":41}},"10":{"start":{"line":23,"column":27},"end":{"line":23,"column":40}},"11":{"start":{"line":24,"column":4},"end":{"line":26,"column":20}},"12":{"start":{"line":25,"column":8},"end":{"line":25,"column":66}},"13":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"14":{"start":{"line":30,"column":8},"end":{"line":30,"column":19}},"15":{"start":{"line":32,"column":4},"end":{"line":36,"column":5}},"16":{"start":{"line":33,"column":8},"end":{"line":35,"column":10}},"17":{"start":{"line":37,"column":16},"end":{"line":37,"column":53}},"18":{"start":{"line":38,"column":4},"end":{"line":40,"column":5}},"19":{"start":{"line":39,"column":8},"end":{"line":39,"column":30}},"20":{"start":{"line":41,"column":17},"end":{"line":43,"column":5}},"21":{"start":{"line":44,"column":32},"end":{"line":44,"column":88}},"22":{"start":{"line":45,"column":4},"end":{"line":54,"column":5}},"23":{"start":{"line":46,"column":8},"end":{"line":53,"column":9}},"24":{"start":{"line":47,"column":23},"end":{"line":47,"column":95}},"25":{"start":{"line":48,"column":12},"end":{"line":52,"column":13}},"26":{"start":{"line":49,"column":16},"end":{"line":49,"column":57}},"27":{"start":{"line":51,"column":16},"end":{"line":51,"column":39}},"28":{"start":{"line":55,"column":4},"end":{"line":55,"column":25}},"29":{"start":{"line":56,"column":4},"end":{"line":58,"column":5}},"30":{"start":{"line":57,"column":8},"end":{"line":57,"column":31}},"31":{"start":{"line":59,"column":4},"end":{"line":59,"column":18}},"32":{"start":{"line":61,"column":51},"end":{"line":61,"column":132}},"33":{"start":{"line":62,"column":51},"end":{"line":62,"column":140}},"34":{"start":{"line":63,"column":31},"end":{"line":63,"column":49}},"35":{"start":{"line":64,"column":31},"end":{"line":72,"column":1}},"36":{"start":{"line":65,"column":21},"end":{"line":65,"column":23}},"37":{"start":{"line":66,"column":4},"end":{"line":66,"column":79}},"38":{"start":{"line":66,"column":43},"end":{"line":66,"column":77}},"39":{"start":{"line":67,"column":21},"end":{"line":67,"column":48}},"40":{"start":{"line":68,"column":4},"end":{"line":71,"column":7}},"41":{"start":{"line":70,"column":8},"end":{"line":70,"column":129}},"42":{"start":{"line":73,"column":63},"end":{"line":76,"column":1}},"43":{"start":{"line":74,"column":28},"end":{"line":74,"column":139}},"44":{"start":{"line":74,"column":75},"end":{"line":74,"column":138}},"45":{"start":{"line":75,"column":4},"end":{"line":75,"column":136}},"46":{"start":{"line":75,"column":96},"end":{"line":75,"column":134}},"47":{"start":{"line":77,"column":54},"end":{"line":80,"column":1}},"48":{"start":{"line":78,"column":28},"end":{"line":78,"column":139}},"49":{"start":{"line":78,"column":75},"end":{"line":78,"column":138}},"50":{"start":{"line":79,"column":4},"end":{"line":79,"column":161}},"51":{"start":{"line":79,"column":96},"end":{"line":79,"column":159}},"52":{"start":{"line":81,"column":56},"end":{"line":84,"column":1}},"53":{"start":{"line":82,"column":28},"end":{"line":82,"column":139}},"54":{"start":{"line":82,"column":75},"end":{"line":82,"column":138}},"55":{"start":{"line":83,"column":4},"end":{"line":83,"column":108}},"56":{"start":{"line":83,"column":71},"end":{"line":83,"column":106}},"57":{"start":{"line":85,"column":47},"end":{"line":85,"column":93}},"58":{"start":{"line":85,"column":58},"end":{"line":85,"column":93}},"59":{"start":{"line":86,"column":44},"end":{"line":86,"column":300}},"60":{"start":{"line":86,"column":95},"end":{"line":86,"column":300}},"61":{"start":{"line":87,"column":30},"end":{"line":87,"column":70}},"62":{"start":{"line":87,"column":41},"end":{"line":87,"column":70}},"63":{"start":{"line":88,"column":32},"end":{"line":88,"column":243}},"64":{"start":{"line":88,"column":87},"end":{"line":88,"column":243}},"65":{"start":{"line":89,"column":37},"end":{"line":109,"column":1}},"66":{"start":{"line":90,"column":26},"end":{"line":90,"column":137}},"67":{"start":{"line":90,"column":73},"end":{"line":90,"column":136}},"68":{"start":{"line":91,"column":29},"end":{"line":91,"column":59}},"69":{"start":{"line":92,"column":34},"end":{"line":96,"column":7}},"70":{"start":{"line":97,"column":46},"end":{"line":100,"column":47}},"71":{"start":{"line":101,"column":21},"end":{"line":104,"column":38}},"72":{"start":{"line":105,"column":4},"end":{"line":108,"column":6}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":29},"end":{"line":12,"column":30}},"loc":{"start":{"line":12,"column":40},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":34},"end":{"line":15,"column":35}},"loc":{"start":{"line":15,"column":45},"end":{"line":17,"column":5}},"line":15},"3":{"name":"_getRequireWildcardCache","decl":{"start":{"line":20,"column":9},"end":{"line":20,"column":33}},"loc":{"start":{"line":20,"column":47},"end":{"line":27,"column":1}},"line":20},"4":{"name":"(anonymous_4)","decl":{"start":{"line":24,"column":39},"end":{"line":24,"column":40}},"loc":{"start":{"line":24,"column":61},"end":{"line":26,"column":5}},"line":24},"5":{"name":"_interop_require_wildcard","decl":{"start":{"line":28,"column":9},"end":{"line":28,"column":34}},"loc":{"start":{"line":28,"column":53},"end":{"line":60,"column":1}},"line":28},"6":{"name":"(anonymous_6)","decl":{"start":{"line":64,"column":31},"end":{"line":64,"column":32}},"loc":{"start":{"line":64,"column":76},"end":{"line":72,"column":1}},"line":64},"7":{"name":"(anonymous_7)","decl":{"start":{"line":66,"column":34},"end":{"line":66,"column":35}},"loc":{"start":{"line":66,"column":43},"end":{"line":66,"column":77}},"line":66},"8":{"name":"(anonymous_8)","decl":{"start":{"line":68,"column":41},"end":{"line":68,"column":42}},"loc":{"start":{"line":68,"column":45},"end":{"line":71,"column":5}},"line":68},"9":{"name":"(anonymous_9)","decl":{"start":{"line":73,"column":63},"end":{"line":73,"column":64}},"loc":{"start":{"line":73,"column":80},"end":{"line":76,"column":1}},"line":73},"10":{"name":"(anonymous_10)","decl":{"start":{"line":74,"column":57},"end":{"line":74,"column":58}},"loc":{"start":{"line":74,"column":75},"end":{"line":74,"column":138}},"line":74},"11":{"name":"(anonymous_11)","decl":{"start":{"line":75,"column":87},"end":{"line":75,"column":88}},"loc":{"start":{"line":75,"column":96},"end":{"line":75,"column":134}},"line":75},"12":{"name":"(anonymous_12)","decl":{"start":{"line":77,"column":54},"end":{"line":77,"column":55}},"loc":{"start":{"line":77,"column":89},"end":{"line":80,"column":1}},"line":77},"13":{"name":"(anonymous_13)","decl":{"start":{"line":78,"column":57},"end":{"line":78,"column":58}},"loc":{"start":{"line":78,"column":75},"end":{"line":78,"column":138}},"line":78},"14":{"name":"(anonymous_14)","decl":{"start":{"line":79,"column":87},"end":{"line":79,"column":88}},"loc":{"start":{"line":79,"column":96},"end":{"line":79,"column":159}},"line":79},"15":{"name":"(anonymous_15)","decl":{"start":{"line":81,"column":56},"end":{"line":81,"column":57}},"loc":{"start":{"line":81,"column":89},"end":{"line":84,"column":1}},"line":81},"16":{"name":"(anonymous_16)","decl":{"start":{"line":82,"column":57},"end":{"line":82,"column":58}},"loc":{"start":{"line":82,"column":75},"end":{"line":82,"column":138}},"line":82},"17":{"name":"(anonymous_17)","decl":{"start":{"line":83,"column":67},"end":{"line":83,"column":68}},"loc":{"start":{"line":83,"column":71},"end":{"line":83,"column":106}},"line":83},"18":{"name":"(anonymous_18)","decl":{"start":{"line":85,"column":47},"end":{"line":85,"column":48}},"loc":{"start":{"line":85,"column":58},"end":{"line":85,"column":93}},"line":85},"19":{"name":"(anonymous_19)","decl":{"start":{"line":86,"column":44},"end":{"line":86,"column":45}},"loc":{"start":{"line":86,"column":95},"end":{"line":86,"column":300}},"line":86},"20":{"name":"(anonymous_20)","decl":{"start":{"line":87,"column":30},"end":{"line":87,"column":31}},"loc":{"start":{"line":87,"column":41},"end":{"line":87,"column":70}},"line":87},"21":{"name":"(anonymous_21)","decl":{"start":{"line":88,"column":32},"end":{"line":88,"column":33}},"loc":{"start":{"line":88,"column":87},"end":{"line":88,"column":243}},"line":88},"22":{"name":"(anonymous_22)","decl":{"start":{"line":89,"column":37},"end":{"line":89,"column":38}},"loc":{"start":{"line":89,"column":129},"end":{"line":109,"column":1}},"line":89},"23":{"name":"(anonymous_23)","decl":{"start":{"line":90,"column":55},"end":{"line":90,"column":56}},"loc":{"start":{"line":90,"column":73},"end":{"line":90,"column":136}},"line":90}},"branchMap":{"0":{"loc":{"start":{"line":21,"column":4},"end":{"line":21,"column":51}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":21,"column":51}},{"start":{"line":21,"column":4},"end":{"line":21,"column":51}}],"line":21},"1":{"loc":{"start":{"line":25,"column":15},"end":{"line":25,"column":65}},"type":"cond-expr","locations":[{"start":{"line":25,"column":29},"end":{"line":25,"column":45}},{"start":{"line":25,"column":48},"end":{"line":25,"column":65}}],"line":25},"2":{"loc":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},{"start":{"line":29,"column":4},"end":{"line":31,"column":5}}],"line":29},"3":{"loc":{"start":{"line":29,"column":8},"end":{"line":29,"column":45}},"type":"binary-expr","locations":[{"start":{"line":29,"column":8},"end":{"line":29,"column":20}},{"start":{"line":29,"column":24},"end":{"line":29,"column":27}},{"start":{"line":29,"column":31},"end":{"line":29,"column":45}}],"line":29},"4":{"loc":{"start":{"line":32,"column":4},"end":{"line":36,"column":5}},"type":"if","locations":[{"start":{"line":32,"column":4},"end":{"line":36,"column":5}},{"start":{"line":32,"column":4},"end":{"line":36,"column":5}}],"line":32},"5":{"loc":{"start":{"line":32,"column":8},"end":{"line":32,"column":76}},"type":"binary-expr","locations":[{"start":{"line":32,"column":8},"end":{"line":32,"column":20}},{"start":{"line":32,"column":24},"end":{"line":32,"column":47}},{"start":{"line":32,"column":51},"end":{"line":32,"column":76}}],"line":32},"6":{"loc":{"start":{"line":38,"column":4},"end":{"line":40,"column":5}},"type":"if","locations":[{"start":{"line":38,"column":4},"end":{"line":40,"column":5}},{"start":{"line":38,"column":4},"end":{"line":40,"column":5}}],"line":38},"7":{"loc":{"start":{"line":38,"column":8},"end":{"line":38,"column":31}},"type":"binary-expr","locations":[{"start":{"line":38,"column":8},"end":{"line":38,"column":13}},{"start":{"line":38,"column":17},"end":{"line":38,"column":31}}],"line":38},"8":{"loc":{"start":{"line":44,"column":32},"end":{"line":44,"column":88}},"type":"binary-expr","locations":[{"start":{"line":44,"column":32},"end":{"line":44,"column":53}},{"start":{"line":44,"column":57},"end":{"line":44,"column":88}}],"line":44},"9":{"loc":{"start":{"line":46,"column":8},"end":{"line":53,"column":9}},"type":"if","locations":[{"start":{"line":46,"column":8},"end":{"line":53,"column":9}},{"start":{"line":46,"column":8},"end":{"line":53,"column":9}}],"line":46},"10":{"loc":{"start":{"line":46,"column":12},"end":{"line":46,"column":79}},"type":"binary-expr","locations":[{"start":{"line":46,"column":12},"end":{"line":46,"column":29}},{"start":{"line":46,"column":33},"end":{"line":46,"column":79}}],"line":46},"11":{"loc":{"start":{"line":47,"column":23},"end":{"line":47,"column":95}},"type":"cond-expr","locations":[{"start":{"line":47,"column":47},"end":{"line":47,"column":88}},{"start":{"line":47,"column":91},"end":{"line":47,"column":95}}],"line":47},"12":{"loc":{"start":{"line":48,"column":12},"end":{"line":52,"column":13}},"type":"if","locations":[{"start":{"line":48,"column":12},"end":{"line":52,"column":13}},{"start":{"line":48,"column":12},"end":{"line":52,"column":13}}],"line":48},"13":{"loc":{"start":{"line":48,"column":16},"end":{"line":48,"column":46}},"type":"binary-expr","locations":[{"start":{"line":48,"column":16},"end":{"line":48,"column":20}},{"start":{"line":48,"column":25},"end":{"line":48,"column":33}},{"start":{"line":48,"column":37},"end":{"line":48,"column":45}}],"line":48},"14":{"loc":{"start":{"line":56,"column":4},"end":{"line":58,"column":5}},"type":"if","locations":[{"start":{"line":56,"column":4},"end":{"line":58,"column":5}},{"start":{"line":56,"column":4},"end":{"line":58,"column":5}}],"line":56},"15":{"loc":{"start":{"line":70,"column":19},"end":{"line":70,"column":126}},"type":"cond-expr","locations":[{"start":{"line":70,"column":97},"end":{"line":70,"column":103}},{"start":{"line":70,"column":106},"end":{"line":70,"column":126}}],"line":70},"16":{"loc":{"start":{"line":70,"column":19},"end":{"line":70,"column":94}},"type":"binary-expr","locations":[{"start":{"line":70,"column":19},"end":{"line":70,"column":64}},{"start":{"line":70,"column":68},"end":{"line":70,"column":94}}],"line":70}},"s":{"0":1,"1":1,"2":2,"3":1,"4":16,"5":14,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":104,"14":104,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":1,"33":1,"34":1,"35":1,"36":90,"37":90,"38":48,"39":90,"40":90,"41":48,"42":1,"43":30,"44":30,"45":30,"46":20,"47":1,"48":30,"49":30,"50":30,"51":20,"52":1,"53":30,"54":30,"55":30,"56":8,"57":1,"58":30,"59":1,"60":30,"61":1,"62":58,"63":1,"64":30,"65":1,"66":14,"67":14,"68":14,"69":14,"70":14,"71":14,"72":14},"f":{"0":1,"1":16,"2":14,"3":0,"4":0,"5":104,"6":90,"7":48,"8":48,"9":30,"10":30,"11":20,"12":30,"13":30,"14":20,"15":30,"16":30,"17":8,"18":30,"19":30,"20":58,"21":30,"22":14,"23":14},"b":{"0":[0,0],"1":[0,0],"2":[104,0],"3":[104,104,104],"4":[0,0],"5":[0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0],"14":[0,0],"15":[0,48],"16":[48,48]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/to-internal-parser-formatter.ts"],"sourcesContent":["import type { MentionPill as MentionPillType } from '@vector-im/matrix-bot-sdk';\nimport { marked } from 'marked';\n\nconst INTERNAL_MENTIONS_FOR_EXTERNAL_USERS_REGEX = /@([0-9a-zA-Z-_.]+(@([0-9a-zA-Z-_.]+))?):+([0-9a-zA-Z-_.]+)(?=[^<>]*(?:<\\w|$))/gm; // @username:server.com excluding any <a> tags\nconst INTERNAL_MENTIONS_FOR_INTERNAL_USERS_REGEX = /(?:^|(?<=\\s))@([0-9a-zA-Z-_.]+(@([0-9a-zA-Z-_.]+))?)(?=[^<>]*(?:<\\w|$))/gm; // @username, @username.name excluding any <a> tags and emails\nconst INTERNAL_GENERAL_REGEX = /(@all)|(@here)/gm;\n\nconst replaceMessageMentions = async (\n\tmessage: string,\n\tmentionRegex: RegExp,\n\tparseMatchFn: (match: string) => Promise<MentionPillType>,\n): Promise<string> => {\n\tconst promises: Promise<MentionPillType>[] = [];\n\n\tmessage.replace(mentionRegex, (match: string): any => promises.push(parseMatchFn(match)));\n\n\tconst mentions = await Promise.all(promises);\n\n\treturn message.replace(mentionRegex, () => ` ${mentions.shift()?.html}`);\n};\n\nconst replaceMentionsFromLocalExternalUsersForExternalFormat = async (message: string): Promise<string> => {\n\tconst { MentionPill } = await import('@vector-im/matrix-bot-sdk');\n\n\treturn replaceMessageMentions(message, INTERNAL_MENTIONS_FOR_EXTERNAL_USERS_REGEX, (match: string) =>\n\t\tMentionPill.forUser(match.trimStart()),\n\t);\n};\n\nconst replaceInternalUsersMentionsForExternalFormat = async (message: string, homeServerDomain: string): Promise<string> => {\n\tconst { MentionPill } = await import('@vector-im/matrix-bot-sdk');\n\n\treturn replaceMessageMentions(message, INTERNAL_MENTIONS_FOR_INTERNAL_USERS_REGEX, (match: string) =>\n\t\tMentionPill.forUser(`${match.trimStart()}:${homeServerDomain}`),\n\t);\n};\n\nconst replaceInternalGeneralMentionsForExternalFormat = async (message: string, externalRoomId: string): Promise<string> => {\n\tconst { MentionPill } = await import('@vector-im/matrix-bot-sdk');\n\n\treturn replaceMessageMentions(message, INTERNAL_GENERAL_REGEX, () => MentionPill.forRoom(externalRoomId));\n};\n\nconst removeAllExtraBlankSpacesForASingleOne = (message: string): string => message.replace(/\\s+/g, ' ').trim();\n\nconst replaceInternalWithExternalMentions = async (message: string, externalRoomId: string, homeServerDomain: string): Promise<string> =>\n\treplaceInternalUsersMentionsForExternalFormat(\n\t\tawait replaceMentionsFromLocalExternalUsersForExternalFormat(\n\t\t\tawait replaceInternalGeneralMentionsForExternalFormat(message, externalRoomId),\n\t\t),\n\t\thomeServerDomain,\n\t);\n\nconst convertMarkdownToHTML = (message: string): string => marked.parse(message);\n\nexport const toExternalMessageFormat = async ({\n\texternalRoomId,\n\thomeServerDomain,\n\tmessage,\n}: {\n\tmessage: string;\n\texternalRoomId: string;\n\thomeServerDomain: string;\n}): Promise<string> =>\n\tremoveAllExtraBlankSpacesForASingleOne(\n\t\tconvertMarkdownToHTML((await replaceInternalWithExternalMentions(message, externalRoomId, homeServerDomain)).trim()),\n\t);\n\nexport const toExternalQuoteMessageFormat = async ({\n\tmessage,\n\teventToReplyTo,\n\texternalRoomId,\n\thomeServerDomain,\n\toriginalEventSender,\n}: {\n\texternalRoomId: string;\n\teventToReplyTo: string;\n\toriginalEventSender: string;\n\tmessage: string;\n\thomeServerDomain: string;\n}): Promise<{ message: string; formattedMessage: string }> => {\n\tconst { RichReply } = await import('@vector-im/matrix-bot-sdk');\n\n\tconst formattedMessage = convertMarkdownToHTML(message);\n\tconst finalFormattedMessage = convertMarkdownToHTML(\n\t\tawait toExternalMessageFormat({\n\t\t\tmessage,\n\t\t\texternalRoomId,\n\t\t\thomeServerDomain,\n\t\t}),\n\t);\n\n\tconst { formatted_body: formattedBody } = RichReply.createFor(\n\t\texternalRoomId,\n\t\t{ event_id: eventToReplyTo, sender: originalEventSender },\n\t\tformattedMessage,\n\t\tfinalFormattedMessage,\n\t);\n\tconst { body } = RichReply.createFor(\n\t\texternalRoomId,\n\t\t{ event_id: eventToReplyTo, sender: originalEventSender },\n\t\tmessage,\n\t\tfinalFormattedMessage,\n\t);\n\n\treturn {\n\t\tmessage: body,\n\t\tformattedMessage: formattedBody,\n\t};\n};\n"],"names":["toExternalMessageFormat","toExternalQuoteMessageFormat","INTERNAL_MENTIONS_FOR_EXTERNAL_USERS_REGEX","INTERNAL_MENTIONS_FOR_INTERNAL_USERS_REGEX","INTERNAL_GENERAL_REGEX","replaceMessageMentions","message","mentionRegex","parseMatchFn","promises","replace","match","push","mentions","Promise","all","shift","html","replaceMentionsFromLocalExternalUsersForExternalFormat","MentionPill","forUser","trimStart","replaceInternalUsersMentionsForExternalFormat","homeServerDomain","replaceInternalGeneralMentionsForExternalFormat","externalRoomId","forRoom","removeAllExtraBlankSpacesForASingleOne","trim","replaceInternalWithExternalMentions","convertMarkdownToHTML","marked","parse","eventToReplyTo","originalEventSender","RichReply","formattedMessage","finalFormattedMessage","formatted_body","formattedBody","createFor","event_id","sender","body"],"mappings":";;;;;;;;;;;IAuDaA,uBAAuB;eAAvBA;;IAaAC,4BAA4B;eAA5BA;;;wBAnEU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEvB,MAAMC,6CAA6C,mFAAmF,8CAA8C;AACpL,MAAMC,6CAA6C,2FAA6E,8DAA8D;AAC9L,MAAMC,yBAAyB;AAE/B,MAAMC,yBAAyB,OAC9BC,SACAC,cACAC;IAEA,MAAMC,WAAuC,EAAE;IAE/CH,QAAQI,OAAO,CAACH,cAAc,CAACI,QAAuBF,SAASG,IAAI,CAACJ,aAAaG;IAEjF,MAAME,WAAW,MAAMC,QAAQC,GAAG,CAACN;IAEnC,OAAOH,QAAQI,OAAO,CAACH,cAAc;YAAUM;eAAJ,CAAC,CAAC,GAAEA,kBAAAA,SAASG,KAAK,gBAAdH,sCAAAA,gBAAkBI,IAAI,EAAE;;AACxE;AAEA,MAAMC,yDAAyD,OAAOZ;IACrE,MAAM,EAAEa,WAAW,EAAE,GAAG,MAAM,mEAAA,QAAO;IAErC,OAAOd,uBAAuBC,SAASJ,4CAA4C,CAACS,QACnFQ,YAAYC,OAAO,CAACT,MAAMU,SAAS;AAErC;AAEA,MAAMC,gDAAgD,OAAOhB,SAAiBiB;IAC7E,MAAM,EAAEJ,WAAW,EAAE,GAAG,MAAM,mEAAA,QAAO;IAErC,OAAOd,uBAAuBC,SAASH,4CAA4C,CAACQ,QACnFQ,YAAYC,OAAO,CAAC,GAAGT,MAAMU,SAAS,GAAG,CAAC,EAAEE,kBAAkB;AAEhE;AAEA,MAAMC,kDAAkD,OAAOlB,SAAiBmB;IAC/E,MAAM,EAAEN,WAAW,EAAE,GAAG,MAAM,mEAAA,QAAO;IAErC,OAAOd,uBAAuBC,SAASF,wBAAwB,IAAMe,YAAYO,OAAO,CAACD;AAC1F;AAEA,MAAME,yCAAyC,CAACrB,UAA4BA,QAAQI,OAAO,CAAC,QAAQ,KAAKkB,IAAI;AAE7G,MAAMC,sCAAsC,OAAOvB,SAAiBmB,gBAAwBF,mBAC3FD,8CACC,MAAMJ,uDACL,MAAMM,gDAAgDlB,SAASmB,kBAEhEF;AAGF,MAAMO,wBAAwB,CAACxB,UAA4ByB,cAAM,CAACC,KAAK,CAAC1B;AAEjE,MAAMN,0BAA0B,OAAO,EAC7CyB,cAAc,EACdF,gBAAgB,EAChBjB,OAAO,EAKP,GACAqB,uCACCG,sBAAsB,AAAC,CAAA,MAAMD,oCAAoCvB,SAASmB,gBAAgBF,iBAAgB,EAAGK,IAAI;AAG5G,MAAM3B,+BAA+B,OAAO,EAClDK,OAAO,EACP2B,cAAc,EACdR,cAAc,EACdF,gBAAgB,EAChBW,mBAAmB,EAOnB;IACA,MAAM,EAAEC,SAAS,EAAE,GAAG,MAAM,mEAAA,QAAO;IAEnC,MAAMC,mBAAmBN,sBAAsBxB;IAC/C,MAAM+B,wBAAwBP,sBAC7B,MAAM9B,wBAAwB;QAC7BM;QACAmB;QACAF;IACD;IAGD,MAAM,EAAEe,gBAAgBC,aAAa,EAAE,GAAGJ,UAAUK,SAAS,CAC5Df,gBACA;QAAEgB,UAAUR;QAAgBS,QAAQR;IAAoB,GACxDE,kBACAC;IAED,MAAM,EAAEM,IAAI,EAAE,GAAGR,UAAUK,SAAS,CACnCf,gBACA;QAAEgB,UAAUR;QAAgBS,QAAQR;IAAoB,GACxD5B,SACA+B;IAGD,OAAO;QACN/B,SAASqC;QACTP,kBAAkBG;IACnB;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/to-internal-parser-formatter.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"5150d96113a9b090794dd3577b1ec0e92e780a28","contentHash":"286be8e9ebfb281bb648235e4e235152898599f3123031402d251ba7bab86ae5"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixRoomType.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixRoomType.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":30}},"3":{"start":{"line":11,"column":35},"end":{"line":15,"column":5}},"4":{"start":{"line":12,"column":4},"end":{"line":12,"column":47}},"5":{"start":{"line":13,"column":4},"end":{"line":13,"column":45}},"6":{"start":{"line":14,"column":4},"end":{"line":14,"column":26}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":35},"end":{"line":11,"column":36}},"loc":{"start":{"line":11,"column":60},"end":{"line":15,"column":1}},"line":11}},"branchMap":{},"s":{"0":1,"1":1,"2":0,"3":1,"4":1,"5":1,"6":1},"f":{"0":0,"1":1},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixRoomType.ts"],"sourcesContent":["export enum MatrixRoomType {\n\tPRIVATE = 'private_chat',\n\tPUBLIC = 'public_chat',\n}\n"],"names":["MatrixRoomType"],"mappings":";;;;+BAAYA;;;eAAAA;;;AAAL,IAAA,AAAKA,wCAAAA;;;WAAAA","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixRoomType.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"cd8e5793663a439d4e13a823e855f05dac7a8a85","contentHash":"25f8dabc0b313e97c42298e289cc6027d3ca44d271ef5f0ec24effe74c28ebff"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixRoomVisibility.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixRoomVisibility.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":36}},"3":{"start":{"line":11,"column":41},"end":{"line":15,"column":5}},"4":{"start":{"line":12,"column":4},"end":{"line":12,"column":48}},"5":{"start":{"line":13,"column":4},"end":{"line":13,"column":46}},"6":{"start":{"line":14,"column":4},"end":{"line":14,"column":32}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":41},"end":{"line":11,"column":42}},"loc":{"start":{"line":11,"column":72},"end":{"line":15,"column":1}},"line":11}},"branchMap":{},"s":{"0":1,"1":1,"2":0,"3":1,"4":1,"5":1,"6":1},"f":{"0":0,"1":1},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixRoomVisibility.ts"],"sourcesContent":["export enum MatrixRoomVisibility {\n\tPRIVATE = 'private',\n\tPUBLIC = 'public',\n}\n"],"names":["MatrixRoomVisibility"],"mappings":";;;;+BAAYA;;;eAAAA;;;AAAL,IAAA,AAAKA,8CAAAA;;;WAAAA","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/MatrixRoomVisibility.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"da7ad59dccd0c1a81d1ac07ea29339b167f959f5","contentHash":"aece44493995a398943638929d015c4d844e722a5a57eadee1554a260862ad0e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/events/RoomMessageSent.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/events/RoomMessageSent.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":21,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":42}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":41}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":42}},"7":{"start":{"line":22,"column":29},"end":{"line":22,"column":62}},"8":{"start":{"line":23,"column":25},"end":{"line":23,"column":54}},"9":{"start":{"line":24,"column":46},"end":{"line":34,"column":5}},"10":{"start":{"line":25,"column":4},"end":{"line":25,"column":49}},"11":{"start":{"line":26,"column":4},"end":{"line":26,"column":51}},"12":{"start":{"line":27,"column":4},"end":{"line":27,"column":53}},"13":{"start":{"line":28,"column":4},"end":{"line":28,"column":51}},"14":{"start":{"line":29,"column":4},"end":{"line":29,"column":49}},"15":{"start":{"line":30,"column":4},"end":{"line":30,"column":51}},"16":{"start":{"line":31,"column":4},"end":{"line":31,"column":57}},"17":{"start":{"line":32,"column":4},"end":{"line":32,"column":51}},"18":{"start":{"line":33,"column":4},"end":{"line":33,"column":37}},"19":{"start":{"line":35,"column":47},"end":{"line":38,"column":5}},"20":{"start":{"line":36,"column":4},"end":{"line":36,"column":56}},"21":{"start":{"line":37,"column":4},"end":{"line":37,"column":38}},"22":{"start":{"line":39,"column":33},"end":{"line":43,"column":1}},"23":{"start":{"line":41,"column":8},"end":{"line":41,"column":87}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":32},"end":{"line":12,"column":33}},"loc":{"start":{"line":12,"column":43},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":31},"end":{"line":15,"column":32}},"loc":{"start":{"line":15,"column":42},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":32},"end":{"line":18,"column":33}},"loc":{"start":{"line":18,"column":43},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":24,"column":46},"end":{"line":24,"column":47}},"loc":{"start":{"line":24,"column":82},"end":{"line":34,"column":1}},"line":24},"5":{"name":"(anonymous_5)","decl":{"start":{"line":35,"column":47},"end":{"line":35,"column":48}},"loc":{"start":{"line":35,"column":84},"end":{"line":38,"column":1}},"line":35},"6":{"name":"(anonymous_6)","decl":{"start":{"line":40,"column":4},"end":{"line":40,"column":5}},"loc":{"start":{"line":40,"column":24},"end":{"line":42,"column":5}},"line":40}},"branchMap":{},"s":{"0":1,"1":1,"2":3,"3":1,"4":4,"5":336,"6":0,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":0},"f":{"0":1,"1":4,"2":336,"3":0,"4":1,"5":1,"6":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/events/RoomMessageSent.ts"],"sourcesContent":["import type { IBaseEventContent } from '../AbstractMatrixEvent';\nimport { AbstractMatrixEvent } from '../AbstractMatrixEvent';\nimport { MatrixEventType } from '../MatrixEventType';\n\ntype MatrixSendMessageType = 'm.text' | 'm.emote' | 'm.notice' | 'm.image' | 'm.file' | 'm.audio' | 'm.location' | 'm.video' | string;\n\nexport enum MatrixEnumSendMessageType {\n\tTEXT = 'm.text',\n\tEMOTE = 'm.emote',\n\tNOTICE = 'm.notice',\n\tIMAGE = 'm.image',\n\tFILE = 'm.file',\n\tAUDIO = 'm.audio',\n\tLOCATION = 'm.location',\n\tVIDEO = 'm.video',\n}\n\ninterface IMatrixContentInfo {\n\tmimetype: string;\n\tsize: number;\n\tduration?: number;\n}\n\ntype MatrixRelatesToRelType = 'm.replace' | MatrixEventType.MESSAGE_ON_THREAD;\n\nexport enum MatrixEnumRelatesToRelType {\n\tREPLACE = 'm.replace',\n}\n\nexport interface IMatrixEventContentRoomMessageSent extends IBaseEventContent {\n\t'body': string;\n\t'msgtype': MatrixSendMessageType;\n\t'info'?: IMatrixContentInfo;\n\t'url'?: string;\n\t'format'?: string;\n\t'formatted_body'?: string;\n\t'geo_uri'?: string;\n\t'm.new_content'?: {\n\t\tbody: string;\n\t\tmsgtype: MatrixSendMessageType;\n\t\tformat?: string;\n\t\tformatted_body?: string;\n\t};\n\t'm.relates_to'?: {\n\t\t'rel_type': MatrixRelatesToRelType;\n\t\t'event_id': string;\n\t\t'm.in_reply_to'?: {\n\t\t\tevent_id: string;\n\t\t};\n\t\t'is_falling_back'?: boolean;\n\t};\n}\n\nexport class MatrixEventRoomMessageSent extends AbstractMatrixEvent {\n\tpublic content: IMatrixEventContentRoomMessageSent;\n\n\tpublic type = MatrixEventType.ROOM_MESSAGE_SENT;\n}\n"],"names":["MatrixEnumRelatesToRelType","MatrixEnumSendMessageType","MatrixEventRoomMessageSent","AbstractMatrixEvent","type","MatrixEventType","ROOM_MESSAGE_SENT"],"mappings":";;;;;;;;;;;IAyBYA,0BAA0B;eAA1BA;;IAnBAC,yBAAyB;eAAzBA;;IA+CCC,0BAA0B;eAA1BA;;;qCApDuB;iCACJ;AAIzB,IAAA,AAAKD,mDAAAA;;;;;;;;;WAAAA;;AAmBL,IAAA,AAAKD,oDAAAA;;WAAAA;;AA4BL,IAAA,AAAME,6BAAN,MAAMA,mCAAmCC,wCAAmB;;6BAG3DC,OAAOC,gCAAe,CAACC,iBAAiB;;AAChD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/definitions/events/RoomMessageSent.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d39c10bbe7c5acaa088a6c7f958f46917cf7d04a","contentHash":"60217fde556d2da345898ccc059f471ba4d6353640fc01a6ae1485273bcca3a7"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/helpers/HtttpStatusCodes.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/helpers/HtttpStatusCodes.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":31}},"3":{"start":{"line":11,"column":36},"end":{"line":69,"column":5}},"4":{"start":{"line":12,"column":4},"end":{"line":12,"column":68}},"5":{"start":{"line":13,"column":4},"end":{"line":13,"column":90}},"6":{"start":{"line":14,"column":4},"end":{"line":14,"column":72}},"7":{"start":{"line":15,"column":4},"end":{"line":15,"column":56}},"8":{"start":{"line":16,"column":4},"end":{"line":16,"column":66}},"9":{"start":{"line":17,"column":4},"end":{"line":17,"column":68}},"10":{"start":{"line":18,"column":4},"end":{"line":18,"column":110}},"11":{"start":{"line":19,"column":4},"end":{"line":19,"column":72}},"12":{"start":{"line":20,"column":4},"end":{"line":20,"column":78}},"13":{"start":{"line":21,"column":4},"end":{"line":21,"column":82}},"14":{"start":{"line":22,"column":4},"end":{"line":22,"column":76}},"15":{"start":{"line":23,"column":4},"end":{"line":23,"column":84}},"16":{"start":{"line":24,"column":4},"end":{"line":24,"column":86}},"17":{"start":{"line":25,"column":4},"end":{"line":25,"column":86}},"18":{"start":{"line":26,"column":4},"end":{"line":26,"column":70}},"19":{"start":{"line":27,"column":4},"end":{"line":27,"column":76}},"20":{"start":{"line":28,"column":4},"end":{"line":28,"column":70}},"21":{"start":{"line":29,"column":4},"end":{"line":29,"column":88}},"22":{"start":{"line":30,"column":4},"end":{"line":30,"column":88}},"23":{"start":{"line":31,"column":4},"end":{"line":31,"column":74}},"24":{"start":{"line":32,"column":4},"end":{"line":32,"column":76}},"25":{"start":{"line":33,"column":4},"end":{"line":33,"column":84}},"26":{"start":{"line":34,"column":4},"end":{"line":34,"column":70}},"27":{"start":{"line":35,"column":4},"end":{"line":35,"column":70}},"28":{"start":{"line":36,"column":4},"end":{"line":36,"column":88}},"29":{"start":{"line":37,"column":4},"end":{"line":37,"column":80}},"30":{"start":{"line":38,"column":4},"end":{"line":38,"column":110}},"31":{"start":{"line":39,"column":4},"end":{"line":39,"column":82}},"32":{"start":{"line":40,"column":4},"end":{"line":40,"column":68}},"33":{"start":{"line":41,"column":4},"end":{"line":41,"column":60}},"34":{"start":{"line":42,"column":4},"end":{"line":42,"column":82}},"35":{"start":{"line":43,"column":4},"end":{"line":43,"column":90}},"36":{"start":{"line":44,"column":4},"end":{"line":44,"column":84}},"37":{"start":{"line":45,"column":4},"end":{"line":45,"column":92}},"38":{"start":{"line":46,"column":4},"end":{"line":46,"column":96}},"39":{"start":{"line":47,"column":4},"end":{"line":47,"column":114}},"40":{"start":{"line":48,"column":4},"end":{"line":48,"column":88}},"41":{"start":{"line":49,"column":4},"end":{"line":49,"column":74}},"42":{"start":{"line":50,"column":4},"end":{"line":50,"column":112}},"43":{"start":{"line":51,"column":4},"end":{"line":51,"column":80}},"44":{"start":{"line":52,"column":4},"end":{"line":52,"column":90}},"45":{"start":{"line":53,"column":4},"end":{"line":53,"column":92}},"46":{"start":{"line":54,"column":4},"end":{"line":54,"column":64}},"47":{"start":{"line":55,"column":4},"end":{"line":55,"column":86}},"48":{"start":{"line":56,"column":4},"end":{"line":56,"column":94}},"49":{"start":{"line":57,"column":4},"end":{"line":57,"column":86}},"50":{"start":{"line":58,"column":4},"end":{"line":58,"column":114}},"51":{"start":{"line":59,"column":4},"end":{"line":59,"column":110}},"52":{"start":{"line":60,"column":4},"end":{"line":60,"column":94}},"53":{"start":{"line":61,"column":4},"end":{"line":61,"column":82}},"54":{"start":{"line":62,"column":4},"end":{"line":62,"column":74}},"55":{"start":{"line":63,"column":4},"end":{"line":63,"column":90}},"56":{"start":{"line":64,"column":4},"end":{"line":64,"column":82}},"57":{"start":{"line":65,"column":4},"end":{"line":65,"column":104}},"58":{"start":{"line":66,"column":4},"end":{"line":66,"column":92}},"59":{"start":{"line":67,"column":4},"end":{"line":67,"column":114}},"60":{"start":{"line":68,"column":4},"end":{"line":68,"column":27}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":36},"end":{"line":11,"column":37}},"loc":{"start":{"line":11,"column":62},"end":{"line":69,"column":1}},"line":11}},"branchMap":{},"s":{"0":1,"1":1,"2":5,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1},"f":{"0":5,"1":1},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/helpers/HtttpStatusCodes.ts"],"sourcesContent":["export const enum HttpStatusCodes {\n\tCONTINUE = 100,\n\tSWITCHING_PROTOCOLS = 101,\n\tPROCESSING = 102,\n\tOK = 200,\n\tCREATED = 201,\n\tACCEPTED = 202,\n\tNON_AUTHORITATIVE_INFORMATION = 203,\n\tNO_CONTENT = 204,\n\tRESET_CONTENT = 205,\n\tPARTIAL_CONTENT = 206,\n\tMULTI_STATUS = 207,\n\tMULTIPLE_CHOICES = 300,\n\tMOVED_PERMANENTLY = 301,\n\tMOVED_TEMPORARILY = 302,\n\tSEE_OTHER = 303,\n\tNOT_MODIFIED = 304,\n\tUSE_PROXY = 305,\n\tTEMPORARY_REDIRECT = 307,\n\tPERMANENT_REDIRECT = 308,\n\tBAD_REQUEST = 400,\n\tUNAUTHORIZED = 401,\n\tPAYMENT_REQUIRED = 402,\n\tFORBIDDEN = 403,\n\tNOT_FOUND = 404,\n\tMETHOD_NOT_ALLOWED = 405,\n\tNOT_ACCEPTABLE = 406,\n\tPROXY_AUTHENTICATION_REQUIRED = 407,\n\tREQUEST_TIMEOUT = 408,\n\tCONFLICT = 409,\n\tGONE = 410,\n\tLENGTH_REQUIRED = 411,\n\tPRECONDITION_FAILED = 412,\n\tREQUEST_TOO_LONG = 413,\n\tREQUEST_URI_TOO_LONG = 414,\n\tUNSUPPORTED_MEDIA_TYPE = 415,\n\tREQUESTED_RANGE_NOT_SATISFIABLE = 416,\n\tEXPECTATION_FAILED = 417,\n\tIM_A_TEAPOT = 418,\n\tINSUFFICIENT_SPACE_ON_RESOURCE = 419,\n\tMETHOD_FAILURE = 420,\n\tMISDIRECTED_REQUEST = 421,\n\tUNPROCESSABLE_ENTITY = 422,\n\tLOCKED = 423,\n\tFAILED_DEPENDENCY = 424,\n\tPRECONDITION_REQUIRED = 428,\n\tTOO_MANY_REQUESTS = 429,\n\tREQUEST_HEADER_FIELDS_TOO_LARGE = 431,\n\tUNAVAILABLE_FOR_LEGAL_REASONS = 451,\n\tINTERNAL_SERVER_ERROR = 500,\n\tNOT_IMPLEMENTED = 501,\n\tBAD_GATEWAY = 502,\n\tSERVICE_UNAVAILABLE = 503,\n\tGATEWAY_TIMEOUT = 504,\n\tHTTP_VERSION_NOT_SUPPORTED = 505,\n\tINSUFFICIENT_STORAGE = 507,\n\tNETWORK_AUTHENTICATION_REQUIRED = 511,\n}\n"],"names":["HttpStatusCodes"],"mappings":";;;;+BAAkBA;;;eAAAA;;;AAAX,IAAA,AAAWA,yCAAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;WAAAA","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/helpers/HtttpStatusCodes.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"20e3548fff713648fde9fd875ac760eb071c5abb","contentHash":"c331aa6e439bd5db9519fe4464bedfc7235550eba298b0054e7d4fef18159667"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/helpers/MatrixIdStringTools.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/helpers/MatrixIdStringTools.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":33,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":55}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":54}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":53}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":60}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":44}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":40}},"10":{"start":{"line":31,"column":8},"end":{"line":31,"column":65}},"11":{"start":{"line":34,"column":58},"end":{"line":36,"column":1}},"12":{"start":{"line":35,"column":4},"end":{"line":35,"column":71}},"13":{"start":{"line":37,"column":53},"end":{"line":40,"column":1}},"14":{"start":{"line":39,"column":4},"end":{"line":39,"column":140}},"15":{"start":{"line":41,"column":46},"end":{"line":44,"column":1}},"16":{"start":{"line":43,"column":4},"end":{"line":43,"column":128}},"17":{"start":{"line":45,"column":37},"end":{"line":45,"column":75}},"18":{"start":{"line":45,"column":51},"end":{"line":45,"column":75}},"19":{"start":{"line":46,"column":33},"end":{"line":46,"column":103}},"20":{"start":{"line":46,"column":43},"end":{"line":46,"column":103}},"21":{"start":{"line":47,"column":48},"end":{"line":50,"column":1}},"22":{"start":{"line":48,"column":21},"end":{"line":48,"column":42}},"23":{"start":{"line":49,"column":4},"end":{"line":49,"column":50}},"24":{"start":{"line":51,"column":47},"end":{"line":53,"column":1}},"25":{"start":{"line":52,"column":4},"end":{"line":52,"column":48}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":45},"end":{"line":12,"column":46}},"loc":{"start":{"line":12,"column":56},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":44},"end":{"line":15,"column":45}},"loc":{"start":{"line":15,"column":55},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":43},"end":{"line":18,"column":44}},"loc":{"start":{"line":18,"column":54},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":50},"end":{"line":21,"column":51}},"loc":{"start":{"line":21,"column":61},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":34},"end":{"line":24,"column":35}},"loc":{"start":{"line":24,"column":45},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":30},"end":{"line":27,"column":31}},"loc":{"start":{"line":27,"column":41},"end":{"line":29,"column":5}},"line":27},"7":{"name":"(anonymous_7)","decl":{"start":{"line":30,"column":55},"end":{"line":30,"column":56}},"loc":{"start":{"line":30,"column":66},"end":{"line":32,"column":5}},"line":30},"8":{"name":"(anonymous_8)","decl":{"start":{"line":34,"column":58},"end":{"line":34,"column":59}},"loc":{"start":{"line":34,"column":75},"end":{"line":36,"column":1}},"line":34},"9":{"name":"(anonymous_9)","decl":{"start":{"line":37,"column":53},"end":{"line":37,"column":54}},"loc":{"start":{"line":37,"column":70},"end":{"line":40,"column":1}},"line":37},"10":{"name":"(anonymous_10)","decl":{"start":{"line":41,"column":46},"end":{"line":41,"column":47}},"loc":{"start":{"line":41,"column":60},"end":{"line":44,"column":1}},"line":41},"11":{"name":"(anonymous_11)","decl":{"start":{"line":45,"column":37},"end":{"line":45,"column":38}},"loc":{"start":{"line":45,"column":51},"end":{"line":45,"column":75}},"line":45},"12":{"name":"(anonymous_12)","decl":{"start":{"line":46,"column":33},"end":{"line":46,"column":34}},"loc":{"start":{"line":46,"column":43},"end":{"line":46,"column":103}},"line":46},"13":{"name":"(anonymous_13)","decl":{"start":{"line":47,"column":48},"end":{"line":47,"column":49}},"loc":{"start":{"line":47,"column":67},"end":{"line":50,"column":1}},"line":47},"14":{"name":"(anonymous_14)","decl":{"start":{"line":51,"column":47},"end":{"line":51,"column":48}},"loc":{"start":{"line":51,"column":64},"end":{"line":53,"column":1}},"line":51}},"branchMap":{"0":{"loc":{"start":{"line":34,"column":59},"end":{"line":34,"column":72}},"type":"default-arg","locations":[{"start":{"line":34,"column":70},"end":{"line":34,"column":72}}],"line":34},"1":{"loc":{"start":{"line":37,"column":54},"end":{"line":37,"column":67}},"type":"default-arg","locations":[{"start":{"line":37,"column":65},"end":{"line":37,"column":67}}],"line":37},"2":{"loc":{"start":{"line":39,"column":11},"end":{"line":39,"column":139}},"type":"cond-expr","locations":[{"start":{"line":39,"column":97},"end":{"line":39,"column":103}},{"start":{"line":39,"column":106},"end":{"line":39,"column":139}}],"line":39},"3":{"loc":{"start":{"line":39,"column":11},"end":{"line":39,"column":94}},"type":"binary-expr","locations":[{"start":{"line":39,"column":11},"end":{"line":39,"column":63}},{"start":{"line":39,"column":67},"end":{"line":39,"column":94}}],"line":39},"4":{"loc":{"start":{"line":41,"column":47},"end":{"line":41,"column":57}},"type":"default-arg","locations":[{"start":{"line":41,"column":55},"end":{"line":41,"column":57}}],"line":41},"5":{"loc":{"start":{"line":43,"column":11},"end":{"line":43,"column":127}},"type":"cond-expr","locations":[{"start":{"line":43,"column":88},"end":{"line":43,"column":94}},{"start":{"line":43,"column":97},"end":{"line":43,"column":127}}],"line":43},"6":{"loc":{"start":{"line":43,"column":11},"end":{"line":43,"column":85}},"type":"binary-expr","locations":[{"start":{"line":43,"column":11},"end":{"line":43,"column":57}},{"start":{"line":43,"column":61},"end":{"line":43,"column":85}}],"line":43},"7":{"loc":{"start":{"line":46,"column":43},"end":{"line":46,"column":103}},"type":"binary-expr","locations":[{"start":{"line":46,"column":43},"end":{"line":46,"column":79}},{"start":{"line":46,"column":83},"end":{"line":46,"column":103}}],"line":46},"8":{"loc":{"start":{"line":47,"column":49},"end":{"line":47,"column":64}},"type":"default-arg","locations":[{"start":{"line":47,"column":62},"end":{"line":47,"column":64}}],"line":47},"9":{"loc":{"start":{"line":49,"column":11},"end":{"line":49,"column":49}},"type":"cond-expr","locations":[{"start":{"line":49,"column":33},"end":{"line":49,"column":44}},{"start":{"line":49,"column":47},"end":{"line":49,"column":49}}],"line":49},"10":{"loc":{"start":{"line":51,"column":48},"end":{"line":51,"column":61}},"type":"default-arg","locations":[{"start":{"line":51,"column":59},"end":{"line":51,"column":61}}],"line":51}},"s":{"0":1,"1":1,"2":7,"3":1,"4":0,"5":4,"6":0,"7":0,"8":0,"9":0,"10":0,"11":1,"12":0,"13":1,"14":0,"15":1,"16":0,"17":1,"18":0,"19":1,"20":0,"21":1,"22":0,"23":0,"24":1,"25":4},"f":{"0":1,"1":0,"2":4,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":4},"b":{"0":[0],"1":[0],"2":[0,0],"3":[0,0],"4":[0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0],"9":[0,0],"10":[0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/helpers/MatrixIdStringTools.ts"],"sourcesContent":["export const removeExternalSpecificCharsFromExternalIdentifier = (matrixId = ''): string => {\n\treturn matrixId.replace('@', '').replace('!', '').replace('#', '');\n};\n\nexport const formatExternalUserIdToInternalUsernameFormat = (matrixId = ''): string => {\n\treturn matrixId.split(':')[0]?.replace('@', '');\n};\n\nexport const formatExternalAliasIdToInternalFormat = (alias = ''): string => {\n\treturn alias.split(':')[0]?.replace('#', '');\n};\n\nexport const isAnExternalIdentifierFormat = (identifier: string): boolean => identifier.includes(':');\n\nexport const isAnExternalUserIdFormat = (userId: string): boolean => isAnExternalIdentifierFormat(userId) && userId.includes('@');\n\nexport const extractServerNameFromExternalIdentifier = (identifier = ''): string => {\n\tconst splitted = identifier.split(':');\n\n\treturn splitted.length > 1 ? splitted[1] : '';\n};\n\nexport const extractUserIdAndHomeserverFromMatrixId = (matrixId = ''): string[] => {\n\treturn matrixId.replace('@', '').split(':');\n};\n"],"names":["extractServerNameFromExternalIdentifier","extractUserIdAndHomeserverFromMatrixId","formatExternalAliasIdToInternalFormat","formatExternalUserIdToInternalUsernameFormat","isAnExternalIdentifierFormat","isAnExternalUserIdFormat","removeExternalSpecificCharsFromExternalIdentifier","matrixId","replace","split","alias","identifier","includes","userId","splitted","length"],"mappings":";;;;;;;;;;;IAgBaA,uCAAuC;eAAvCA;;IAMAC,sCAAsC;eAAtCA;;IAdAC,qCAAqC;eAArCA;;IAJAC,4CAA4C;eAA5CA;;IAQAC,4BAA4B;eAA5BA;;IAEAC,wBAAwB;eAAxBA;;IAdAC,iDAAiD;eAAjDA;;;AAAN,MAAMA,oDAAoD,CAACC,WAAW,EAAE;IAC9E,OAAOA,SAASC,OAAO,CAAC,KAAK,IAAIA,OAAO,CAAC,KAAK,IAAIA,OAAO,CAAC,KAAK;AAChE;AAEO,MAAML,+CAA+C,CAACI,WAAW,EAAE;QAClEA;IAAP,QAAOA,mBAAAA,SAASE,KAAK,CAAC,IAAI,CAAC,EAAE,cAAtBF,uCAAAA,iBAAwBC,OAAO,CAAC,KAAK;AAC7C;AAEO,MAAMN,wCAAwC,CAACQ,QAAQ,EAAE;QACxDA;IAAP,QAAOA,gBAAAA,MAAMD,KAAK,CAAC,IAAI,CAAC,EAAE,cAAnBC,oCAAAA,cAAqBF,OAAO,CAAC,KAAK;AAC1C;AAEO,MAAMJ,+BAA+B,CAACO,aAAgCA,WAAWC,QAAQ,CAAC;AAE1F,MAAMP,2BAA2B,CAACQ,SAA4BT,6BAA6BS,WAAWA,OAAOD,QAAQ,CAAC;AAEtH,MAAMZ,0CAA0C,CAACW,aAAa,EAAE;IACtE,MAAMG,WAAWH,WAAWF,KAAK,CAAC;IAElC,OAAOK,SAASC,MAAM,GAAG,IAAID,QAAQ,CAAC,EAAE,GAAG;AAC5C;AAEO,MAAMb,yCAAyC,CAACM,WAAW,EAAE;IACnE,OAAOA,SAASC,OAAO,CAAC,KAAK,IAAIC,KAAK,CAAC;AACxC","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/helpers/MatrixIdStringTools.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6425fadc15ebbf0ee7725245511d09f1afab50a1","contentHash":"835bccaab8e502ea6c6d45e372c880da5f0ff3161344ab19d753ac1f1feb266c"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/UserReceiverDto.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/UserReceiverDto.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":50}},"3":{"start":{"line":11,"column":25},"end":{"line":11,"column":53}},"4":{"start":{"line":12,"column":41},"end":{"line":23,"column":1}},"5":{"start":{"line":14,"column":8},"end":{"line":18,"column":11}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":45}},"7":{"start":{"line":20,"column":8},"end":{"line":20,"column":49}},"8":{"start":{"line":21,"column":8},"end":{"line":21,"column":59}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":4},"end":{"line":13,"column":5}},"loc":{"start":{"line":13,"column":76},"end":{"line":22,"column":5}},"line":13}},"branchMap":{},"s":{"0":1,"1":1,"2":3,"3":1,"4":1,"5":2,"6":2,"7":2,"8":2},"f":{"0":3,"1":2},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/UserReceiverDto.ts"],"sourcesContent":["import type { IFederationReceiverBaseRoomInputDto } from './RoomReceiverDto';\nimport { FederationBaseRoomInputDto } from './RoomReceiverDto';\n\ninterface IFederationUserTypingStatusInputDto extends IFederationReceiverBaseRoomInputDto {\n\texternalUserIdsTyping: string[];\n}\n\nexport class FederationUserTypingStatusEventDto extends FederationBaseRoomInputDto {\n\tconstructor({ externalRoomId, normalizedRoomId, externalUserIdsTyping }: IFederationUserTypingStatusInputDto) {\n\t\tsuper({ externalRoomId, normalizedRoomId, externalEventId: '' });\n\t\tthis.externalRoomId = externalRoomId;\n\t\tthis.normalizedRoomId = normalizedRoomId;\n\t\tthis.externalUserIdsTyping = externalUserIdsTyping;\n\t}\n\n\texternalUserIdsTyping: string[];\n}\n"],"names":["FederationUserTypingStatusEventDto","FederationBaseRoomInputDto","constructor","externalRoomId","normalizedRoomId","externalUserIdsTyping","externalEventId"],"mappings":";;;;+BAOaA;;;eAAAA;;;iCAN8B;AAMpC,IAAA,AAAMA,qCAAN,MAAMA,2CAA2CC,2CAA0B;IACjFC,YAAY,EAAEC,cAAc,EAAEC,gBAAgB,EAAEC,qBAAqB,EAAuC,CAAE;QAC7G,KAAK,CAAC;YAAEF;YAAgBC;YAAkBE,iBAAiB;QAAG;QAC9D,IAAI,CAACH,cAAc,GAAGA;QACtB,IAAI,CAACC,gBAAgB,GAAGA;QACxB,IAAI,CAACC,qBAAqB,GAAGA;IAC9B;AAGD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/UserReceiverDto.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f3e970d82b4bbfa6d3862fdfe7699dca618a3a1c","contentHash":"7ee66739153aee479d37bc098e0e9ccc352bd7a0364dd90075746e9da516379e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/user/UserReceiver.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/user/UserReceiver.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":43}},"3":{"start":{"line":11,"column":25},"end":{"line":11,"column":86}},"4":{"start":{"line":12,"column":22},"end":{"line":12,"column":53}},"5":{"start":{"line":13,"column":34},"end":{"line":22,"column":1}},"6":{"start":{"line":15,"column":8},"end":{"line":20,"column":11}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":42},"end":{"line":21,"column":5}},"line":14}},"branchMap":{},"s":{"0":1,"1":1,"2":2,"3":1,"4":1,"5":1,"6":2},"f":{"0":2,"1":2},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/user/UserReceiver.ts"],"sourcesContent":["import { FederationUserTypingStatusEventDto } from '../../../../application/room/input/UserReceiverDto';\nimport type { MatrixEventUserTypingStatusChanged } from '../../definitions/events/UserTypingStatusChanged';\nimport { convertExternalRoomIdToInternalRoomIdFormat } from '../room/RoomReceiver';\n\nexport class MatrixUserReceiverConverter {\n\tpublic static toUserTypingDto(externalEvent: MatrixEventUserTypingStatusChanged): FederationUserTypingStatusEventDto {\n\t\treturn new FederationUserTypingStatusEventDto({\n\t\t\texternalEventId: '',\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\texternalUserIdsTyping: externalEvent.content.user_ids,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t});\n\t}\n}\n"],"names":["MatrixUserReceiverConverter","toUserTypingDto","externalEvent","FederationUserTypingStatusEventDto","externalEventId","externalRoomId","room_id","externalUserIdsTyping","content","user_ids","normalizedRoomId","convertExternalRoomIdToInternalRoomIdFormat"],"mappings":";;;;+BAIaA;;;eAAAA;;;iCAJsC;8BAES;AAErD,IAAA,AAAMA,8BAAN,MAAMA;IACZ,OAAcC,gBAAgBC,aAAiD,EAAsC;QACpH,OAAO,IAAIC,mDAAkC,CAAC;YAC7CC,iBAAiB;YACjBC,gBAAgBH,cAAcI,OAAO;YACrCC,uBAAuBL,cAAcM,OAAO,CAACC,QAAQ;YACrDC,kBAAkBC,IAAAA,yDAA2C,EAACT,cAAcI,OAAO;QACpF;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/user/UserReceiver.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"dab53eed66612eaa9b1ec79bd72170001f831c19","contentHash":"4853429dd5a51c9ba281cf162a3e704d74bf9cb5c59dc8fae206040b66603844"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/BaseEvent.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/BaseEvent.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":38}},"3":{"start":{"line":11,"column":29},"end":{"line":15,"column":1}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":45}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":4},"end":{"line":12,"column":5}},"loc":{"start":{"line":12,"column":18},"end":{"line":14,"column":5}},"line":12}},"branchMap":{},"s":{"0":1,"1":1,"2":10,"3":1,"4":2},"f":{"0":10,"1":2},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/BaseEvent.ts"],"sourcesContent":["import type { AbstractMatrixEvent } from '../definitions/AbstractMatrixEvent';\n\nexport abstract class MatrixBaseEventHandler {\n\tpublic abstract eventType: string;\n\n\tpublic abstract handle(externalEvent: AbstractMatrixEvent): Promise<void>;\n\n\tpublic equals(event: AbstractMatrixEvent): boolean {\n\t\treturn this.eventType === event.type;\n\t}\n}\n"],"names":["MatrixBaseEventHandler","equals","event","eventType","type"],"mappings":";;;;+BAEsBA;;;eAAAA;;;AAAf,IAAA,AAAeA,yBAAf,MAAeA;IAKdC,OAAOC,KAA0B,EAAW;QAClD,OAAO,IAAI,CAACC,SAAS,KAAKD,MAAME,IAAI;IACrC;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/BaseEvent.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f610aa830d380a972241a5e1dbee008e20d37979","contentHash":"65b6a41b91ee7b046fd19943aef128599dfb5626774eeb44941a2e9dfc0bde18"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/index.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/index.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":35}},"3":{"start":{"line":11,"column":26},"end":{"line":27,"column":1}},"4":{"start":{"line":13,"column":24},"end":{"line":13,"column":76}},"5":{"start":{"line":13,"column":54},"end":{"line":13,"column":75}},"6":{"start":{"line":14,"column":8},"end":{"line":16,"column":9}},"7":{"start":{"line":15,"column":12},"end":{"line":15,"column":82}},"8":{"start":{"line":17,"column":8},"end":{"line":21,"column":9}},"9":{"start":{"line":18,"column":12},"end":{"line":18,"column":40}},"10":{"start":{"line":20,"column":12},"end":{"line":20,"column":46}},"11":{"start":{"line":25,"column":8},"end":{"line":25,"column":33}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":4},"end":{"line":12,"column":5}},"loc":{"start":{"line":12,"column":29},"end":{"line":22,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":13,"column":43},"end":{"line":13,"column":44}},"loc":{"start":{"line":13,"column":54},"end":{"line":13,"column":75}},"line":13},"3":{"name":"(anonymous_3)","decl":{"start":{"line":24,"column":4},"end":{"line":24,"column":5}},"loc":{"start":{"line":24,"column":25},"end":{"line":26,"column":5}},"line":24}},"branchMap":{"0":{"loc":{"start":{"line":14,"column":8},"end":{"line":16,"column":9}},"type":"if","locations":[{"start":{"line":14,"column":8},"end":{"line":16,"column":9}},{"start":{"line":14,"column":8},"end":{"line":16,"column":9}}],"line":14}},"s":{"0":1,"1":1,"2":1,"3":1,"4":2,"5":2,"6":2,"7":1,"8":1,"9":1,"10":0,"11":1},"f":{"0":1,"1":2,"2":2,"3":1},"b":{"0":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/index.ts"],"sourcesContent":["import type { AbstractMatrixEvent } from '../definitions/AbstractMatrixEvent';\nimport type { MatrixBaseEventHandler } from './BaseEvent';\n\nexport class MatrixEventsHandler {\n\t// eslint-disable-next-line no-empty-function\n\tconstructor(protected handlers: MatrixBaseEventHandler[]) {}\n\n\tpublic async handleEvent(event: AbstractMatrixEvent): Promise<void> {\n\t\tconst handler = this.handlers.find((handler) => handler.equals(event));\n\t\tif (!handler) {\n\t\t\treturn console.log(`Could not find handler for ${event.type}`, event);\n\t\t}\n\t\ttry {\n\t\t\tawait handler.handle(event);\n\t\t} catch (e: any) {\n\t\t\tthrow new Meteor.Error(e.message);\n\t\t}\n\t}\n}\n"],"names":["MatrixEventsHandler","handleEvent","event","handler","handlers","find","equals","console","log","type","handle","e","Meteor","Error","message","constructor"],"mappings":";;;;+BAGaA;;;eAAAA;;;AAAN,IAAA,AAAMA,sBAAN,MAAMA;IAIZ,MAAaC,YAAYC,KAA0B,EAAiB;QACnE,MAAMC,UAAU,IAAI,CAACC,QAAQ,CAACC,IAAI,CAAC,CAACF,UAAYA,QAAQG,MAAM,CAACJ;QAC/D,IAAI,CAACC,SAAS;YACb,OAAOI,QAAQC,GAAG,CAAC,CAAC,2BAA2B,EAAEN,MAAMO,IAAI,EAAE,EAAEP;QAChE;QACA,IAAI;YACH,MAAMC,QAAQO,MAAM,CAACR;QACtB,EAAE,OAAOS,GAAQ;YAChB,MAAM,IAAIC,OAAOC,KAAK,CAACF,EAAEG,OAAO;QACjC;IACD;IAbA,6CAA6C;IAC7CC,YAAY,AAAUX,QAAkC,CAAE;aAApCA,WAAAA;IAAqC;AAa5D","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/index.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"74d13b4adae1955b879f0ef683ba74e605e52951","contentHash":"88831e94d2a8a24e7fcb8665884297ffc2c9fc5e32e12b3ff02a8db954109d1b"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/Room.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/Room.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":36,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":40}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":46}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":49}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":50}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":44}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":44}},"10":{"start":{"line":31,"column":8},"end":{"line":31,"column":51}},"11":{"start":{"line":34,"column":8},"end":{"line":34,"column":45}},"12":{"start":{"line":37,"column":22},"end":{"line":37,"column":64}},"13":{"start":{"line":38,"column":25},"end":{"line":38,"column":66}},"14":{"start":{"line":39,"column":25},"end":{"line":39,"column":73}},"15":{"start":{"line":40,"column":19},"end":{"line":40,"column":41}},"16":{"start":{"line":41,"column":31},"end":{"line":48,"column":1}},"17":{"start":{"line":43,"column":8},"end":{"line":43,"column":118}},"18":{"start":{"line":46,"column":8},"end":{"line":46,"column":112}},"19":{"start":{"line":49,"column":41},"end":{"line":56,"column":1}},"20":{"start":{"line":51,"column":8},"end":{"line":51,"column":188}},"21":{"start":{"line":54,"column":8},"end":{"line":54,"column":175}},"22":{"start":{"line":57,"column":35},"end":{"line":103,"column":1}},"23":{"start":{"line":59,"column":33},"end":{"line":59,"column":191}},"24":{"start":{"line":60,"column":8},"end":{"line":60,"column":286}},"25":{"start":{"line":63,"column":33},"end":{"line":63,"column":191}},"26":{"start":{"line":64,"column":8},"end":{"line":64,"column":294}},"27":{"start":{"line":68,"column":25},"end":{"line":79,"column":9}},"28":{"start":{"line":69,"column":67},"end":{"line":69,"column":135}},"29":{"start":{"line":70,"column":68},"end":{"line":70,"column":197}},"30":{"start":{"line":71,"column":67},"end":{"line":71,"column":196}},"31":{"start":{"line":72,"column":68},"end":{"line":72,"column":197}},"32":{"start":{"line":73,"column":69},"end":{"line":73,"column":190}},"33":{"start":{"line":74,"column":68},"end":{"line":74,"column":197}},"34":{"start":{"line":75,"column":68},"end":{"line":75,"column":189}},"35":{"start":{"line":77,"column":16},"end":{"line":77,"column":73}},"36":{"start":{"line":80,"column":31},"end":{"line":91,"column":9}},"37":{"start":{"line":81,"column":67},"end":{"line":81,"column":143}},"38":{"start":{"line":82,"column":68},"end":{"line":82,"column":205}},"39":{"start":{"line":83,"column":67},"end":{"line":83,"column":204}},"40":{"start":{"line":84,"column":68},"end":{"line":84,"column":205}},"41":{"start":{"line":85,"column":69},"end":{"line":85,"column":198}},"42":{"start":{"line":86,"column":68},"end":{"line":86,"column":205}},"43":{"start":{"line":87,"column":68},"end":{"line":87,"column":197}},"44":{"start":{"line":89,"column":16},"end":{"line":89,"column":73}},"45":{"start":{"line":92,"column":31},"end":{"line":92,"column":164}},"46":{"start":{"line":92,"column":35},"end":{"line":92,"column":164}},"47":{"start":{"line":93,"column":39},"end":{"line":93,"column":172}},"48":{"start":{"line":93,"column":43},"end":{"line":93,"column":172}},"49":{"start":{"line":94,"column":34},"end":{"line":94,"column":396}},"50":{"start":{"line":95,"column":8},"end":{"line":97,"column":9}},"51":{"start":{"line":96,"column":12},"end":{"line":96,"column":95}},"52":{"start":{"line":98,"column":8},"end":{"line":98,"column":76}},"53":{"start":{"line":101,"column":8},"end":{"line":101,"column":117}},"54":{"start":{"line":104,"column":40},"end":{"line":111,"column":1}},"55":{"start":{"line":106,"column":8},"end":{"line":106,"column":132}},"56":{"start":{"line":109,"column":8},"end":{"line":109,"column":123}},"57":{"start":{"line":112,"column":35},"end":{"line":119,"column":1}},"58":{"start":{"line":114,"column":8},"end":{"line":114,"column":126}},"59":{"start":{"line":117,"column":8},"end":{"line":117,"column":117}},"60":{"start":{"line":120,"column":36},"end":{"line":127,"column":1}},"61":{"start":{"line":122,"column":8},"end":{"line":122,"column":128}},"62":{"start":{"line":125,"column":8},"end":{"line":125,"column":118}},"63":{"start":{"line":128,"column":37},"end":{"line":135,"column":1}},"64":{"start":{"line":130,"column":8},"end":{"line":130,"column":124}},"65":{"start":{"line":133,"column":8},"end":{"line":133,"column":119}},"66":{"start":{"line":136,"column":42},"end":{"line":143,"column":1}},"67":{"start":{"line":138,"column":8},"end":{"line":138,"column":145}},"68":{"start":{"line":141,"column":8},"end":{"line":141,"column":125}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":30},"end":{"line":12,"column":31}},"loc":{"start":{"line":12,"column":41},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":36},"end":{"line":15,"column":37}},"loc":{"start":{"line":15,"column":47},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":39},"end":{"line":18,"column":40}},"loc":{"start":{"line":18,"column":50},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":40},"end":{"line":21,"column":41}},"loc":{"start":{"line":21,"column":51},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":34},"end":{"line":24,"column":35}},"loc":{"start":{"line":24,"column":45},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":34},"end":{"line":27,"column":35}},"loc":{"start":{"line":27,"column":45},"end":{"line":29,"column":5}},"line":27},"7":{"name":"(anonymous_7)","decl":{"start":{"line":30,"column":41},"end":{"line":30,"column":42}},"loc":{"start":{"line":30,"column":52},"end":{"line":32,"column":5}},"line":30},"8":{"name":"(anonymous_8)","decl":{"start":{"line":33,"column":35},"end":{"line":33,"column":36}},"loc":{"start":{"line":33,"column":46},"end":{"line":35,"column":5}},"line":33},"9":{"name":"(anonymous_9)","decl":{"start":{"line":42,"column":4},"end":{"line":42,"column":5}},"loc":{"start":{"line":42,"column":32},"end":{"line":44,"column":5}},"line":42},"10":{"name":"(anonymous_10)","decl":{"start":{"line":45,"column":4},"end":{"line":45,"column":5}},"loc":{"start":{"line":45,"column":28},"end":{"line":47,"column":5}},"line":45},"11":{"name":"(anonymous_11)","decl":{"start":{"line":50,"column":4},"end":{"line":50,"column":5}},"loc":{"start":{"line":50,"column":32},"end":{"line":52,"column":5}},"line":50},"12":{"name":"(anonymous_12)","decl":{"start":{"line":53,"column":4},"end":{"line":53,"column":5}},"loc":{"start":{"line":53,"column":51},"end":{"line":55,"column":5}},"line":53},"13":{"name":"(anonymous_13)","decl":{"start":{"line":58,"column":4},"end":{"line":58,"column":5}},"loc":{"start":{"line":58,"column":59},"end":{"line":61,"column":5}},"line":58},"14":{"name":"(anonymous_14)","decl":{"start":{"line":62,"column":4},"end":{"line":62,"column":5}},"loc":{"start":{"line":62,"column":67},"end":{"line":65,"column":5}},"line":62},"15":{"name":"(anonymous_15)","decl":{"start":{"line":66,"column":4},"end":{"line":66,"column":5}},"loc":{"start":{"line":66,"column":32},"end":{"line":99,"column":5}},"line":66},"16":{"name":"(anonymous_16)","decl":{"start":{"line":69,"column":63},"end":{"line":69,"column":64}},"loc":{"start":{"line":69,"column":67},"end":{"line":69,"column":135}},"line":69},"17":{"name":"(anonymous_17)","decl":{"start":{"line":70,"column":64},"end":{"line":70,"column":65}},"loc":{"start":{"line":70,"column":68},"end":{"line":70,"column":197}},"line":70},"18":{"name":"(anonymous_18)","decl":{"start":{"line":71,"column":63},"end":{"line":71,"column":64}},"loc":{"start":{"line":71,"column":67},"end":{"line":71,"column":196}},"line":71},"19":{"name":"(anonymous_19)","decl":{"start":{"line":72,"column":64},"end":{"line":72,"column":65}},"loc":{"start":{"line":72,"column":68},"end":{"line":72,"column":197}},"line":72},"20":{"name":"(anonymous_20)","decl":{"start":{"line":73,"column":65},"end":{"line":73,"column":66}},"loc":{"start":{"line":73,"column":69},"end":{"line":73,"column":190}},"line":73},"21":{"name":"(anonymous_21)","decl":{"start":{"line":74,"column":64},"end":{"line":74,"column":65}},"loc":{"start":{"line":74,"column":68},"end":{"line":74,"column":197}},"line":74},"22":{"name":"(anonymous_22)","decl":{"start":{"line":75,"column":64},"end":{"line":75,"column":65}},"loc":{"start":{"line":75,"column":68},"end":{"line":75,"column":189}},"line":75},"23":{"name":"(anonymous_23)","decl":{"start":{"line":76,"column":67},"end":{"line":76,"column":68}},"loc":{"start":{"line":76,"column":71},"end":{"line":78,"column":13}},"line":76},"24":{"name":"(anonymous_24)","decl":{"start":{"line":81,"column":63},"end":{"line":81,"column":64}},"loc":{"start":{"line":81,"column":67},"end":{"line":81,"column":143}},"line":81},"25":{"name":"(anonymous_25)","decl":{"start":{"line":82,"column":64},"end":{"line":82,"column":65}},"loc":{"start":{"line":82,"column":68},"end":{"line":82,"column":205}},"line":82},"26":{"name":"(anonymous_26)","decl":{"start":{"line":83,"column":63},"end":{"line":83,"column":64}},"loc":{"start":{"line":83,"column":67},"end":{"line":83,"column":204}},"line":83},"27":{"name":"(anonymous_27)","decl":{"start":{"line":84,"column":64},"end":{"line":84,"column":65}},"loc":{"start":{"line":84,"column":68},"end":{"line":84,"column":205}},"line":84},"28":{"name":"(anonymous_28)","decl":{"start":{"line":85,"column":65},"end":{"line":85,"column":66}},"loc":{"start":{"line":85,"column":69},"end":{"line":85,"column":198}},"line":85},"29":{"name":"(anonymous_29)","decl":{"start":{"line":86,"column":64},"end":{"line":86,"column":65}},"loc":{"start":{"line":86,"column":68},"end":{"line":86,"column":205}},"line":86},"30":{"name":"(anonymous_30)","decl":{"start":{"line":87,"column":64},"end":{"line":87,"column":65}},"loc":{"start":{"line":87,"column":68},"end":{"line":87,"column":197}},"line":87},"31":{"name":"(anonymous_31)","decl":{"start":{"line":88,"column":67},"end":{"line":88,"column":68}},"loc":{"start":{"line":88,"column":71},"end":{"line":90,"column":13}},"line":88},"32":{"name":"(anonymous_32)","decl":{"start":{"line":92,"column":31},"end":{"line":92,"column":32}},"loc":{"start":{"line":92,"column":35},"end":{"line":92,"column":164}},"line":92},"33":{"name":"(anonymous_33)","decl":{"start":{"line":93,"column":39},"end":{"line":93,"column":40}},"loc":{"start":{"line":93,"column":43},"end":{"line":93,"column":172}},"line":93},"34":{"name":"(anonymous_34)","decl":{"start":{"line":100,"column":4},"end":{"line":100,"column":5}},"loc":{"start":{"line":100,"column":28},"end":{"line":102,"column":5}},"line":100},"35":{"name":"(anonymous_35)","decl":{"start":{"line":105,"column":4},"end":{"line":105,"column":5}},"loc":{"start":{"line":105,"column":32},"end":{"line":107,"column":5}},"line":105},"36":{"name":"(anonymous_36)","decl":{"start":{"line":108,"column":4},"end":{"line":108,"column":5}},"loc":{"start":{"line":108,"column":28},"end":{"line":110,"column":5}},"line":108},"37":{"name":"(anonymous_37)","decl":{"start":{"line":113,"column":4},"end":{"line":113,"column":5}},"loc":{"start":{"line":113,"column":32},"end":{"line":115,"column":5}},"line":113},"38":{"name":"(anonymous_38)","decl":{"start":{"line":116,"column":4},"end":{"line":116,"column":5}},"loc":{"start":{"line":116,"column":28},"end":{"line":118,"column":5}},"line":116},"39":{"name":"(anonymous_39)","decl":{"start":{"line":121,"column":4},"end":{"line":121,"column":5}},"loc":{"start":{"line":121,"column":32},"end":{"line":123,"column":5}},"line":121},"40":{"name":"(anonymous_40)","decl":{"start":{"line":124,"column":4},"end":{"line":124,"column":5}},"loc":{"start":{"line":124,"column":28},"end":{"line":126,"column":5}},"line":124},"41":{"name":"(anonymous_41)","decl":{"start":{"line":129,"column":4},"end":{"line":129,"column":5}},"loc":{"start":{"line":129,"column":32},"end":{"line":131,"column":5}},"line":129},"42":{"name":"(anonymous_42)","decl":{"start":{"line":132,"column":4},"end":{"line":132,"column":5}},"loc":{"start":{"line":132,"column":28},"end":{"line":134,"column":5}},"line":132},"43":{"name":"(anonymous_43)","decl":{"start":{"line":137,"column":4},"end":{"line":137,"column":5}},"loc":{"start":{"line":137,"column":32},"end":{"line":139,"column":5}},"line":137},"44":{"name":"(anonymous_44)","decl":{"start":{"line":140,"column":4},"end":{"line":140,"column":5}},"loc":{"start":{"line":140,"column":28},"end":{"line":142,"column":5}},"line":140}},"branchMap":{"0":{"loc":{"start":{"line":59,"column":33},"end":{"line":59,"column":191}},"type":"binary-expr","locations":[{"start":{"line":59,"column":33},"end":{"line":59,"column":62}},{"start":{"line":59,"column":66},"end":{"line":59,"column":94}},{"start":{"line":59,"column":98},"end":{"line":59,"column":191}}],"line":59},"1":{"loc":{"start":{"line":60,"column":15},"end":{"line":60,"column":285}},"type":"cond-expr","locations":[{"start":{"line":60,"column":34},"end":{"line":60,"column":161}},{"start":{"line":60,"column":164},"end":{"line":60,"column":285}}],"line":60},"2":{"loc":{"start":{"line":63,"column":33},"end":{"line":63,"column":191}},"type":"binary-expr","locations":[{"start":{"line":63,"column":33},"end":{"line":63,"column":62}},{"start":{"line":63,"column":66},"end":{"line":63,"column":94}},{"start":{"line":63,"column":98},"end":{"line":63,"column":191}}],"line":63},"3":{"loc":{"start":{"line":64,"column":15},"end":{"line":64,"column":293}},"type":"cond-expr","locations":[{"start":{"line":64,"column":34},"end":{"line":64,"column":161}},{"start":{"line":64,"column":164},"end":{"line":64,"column":293}}],"line":64},"4":{"loc":{"start":{"line":94,"column":43},"end":{"line":94,"column":339}},"type":"cond-expr","locations":[{"start":{"line":94,"column":140},"end":{"line":94,"column":146}},{"start":{"line":94,"column":149},"end":{"line":94,"column":339}}],"line":94},"5":{"loc":{"start":{"line":94,"column":43},"end":{"line":94,"column":137}},"type":"binary-expr","locations":[{"start":{"line":94,"column":43},"end":{"line":94,"column":100}},{"start":{"line":94,"column":104},"end":{"line":94,"column":137}}],"line":94},"6":{"loc":{"start":{"line":94,"column":149},"end":{"line":94,"column":339}},"type":"cond-expr","locations":[{"start":{"line":94,"column":287},"end":{"line":94,"column":293}},{"start":{"line":94,"column":296},"end":{"line":94,"column":339}}],"line":94},"7":{"loc":{"start":{"line":94,"column":149},"end":{"line":94,"column":284}},"type":"binary-expr","locations":[{"start":{"line":94,"column":149},"end":{"line":94,"column":235}},{"start":{"line":94,"column":239},"end":{"line":94,"column":284}}],"line":94},"8":{"loc":{"start":{"line":95,"column":8},"end":{"line":97,"column":9}},"type":"if","locations":[{"start":{"line":95,"column":8},"end":{"line":97,"column":9}},{"start":{"line":95,"column":8},"end":{"line":97,"column":9}}],"line":95},"9":{"loc":{"start":{"line":96,"column":20},"end":{"line":96,"column":91}},"type":"binary-expr","locations":[{"start":{"line":96,"column":20},"end":{"line":96,"column":65}},{"start":{"line":96,"column":69},"end":{"line":96,"column":91}}],"line":96},"10":{"loc":{"start":{"line":98,"column":15},"end":{"line":98,"column":72}},"type":"binary-expr","locations":[{"start":{"line":98,"column":15},"end":{"line":98,"column":54}},{"start":{"line":98,"column":58},"end":{"line":98,"column":72}}],"line":98}},"s":{"0":1,"1":1,"2":8,"3":1,"4":0,"5":0,"6":0,"7":0,"8":1,"9":0,"10":0,"11":0,"12":1,"13":1,"14":1,"15":1,"16":1,"17":0,"18":0,"19":1,"20":0,"21":0,"22":1,"23":3,"24":3,"25":1,"26":1,"27":20,"28":3,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":20,"37":1,"38":1,"39":1,"40":1,"41":1,"42":1,"43":1,"44":1,"45":20,"46":1,"47":20,"48":1,"49":20,"50":20,"51":9,"52":11,"53":1,"54":1,"55":0,"56":0,"57":1,"58":0,"59":0,"60":1,"61":0,"62":0,"63":1,"64":0,"65":0,"66":1,"67":0,"68":0},"f":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":3,"14":1,"15":20,"16":3,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0},"b":{"0":[3,2,2],"1":[2,1],"2":[1,0,0],"3":[0,1],"4":[0,20],"5":[20,20],"6":[9,11],"7":[20,20],"8":[9,11],"9":[9,1],"10":[11,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/Room.ts"],"sourcesContent":["import type { FederationRoomServiceReceiver } from '../../../application/room/receiver/RoomServiceReceiver';\nimport type { RocketChatSettingsAdapter } from '../../rocket-chat/adapters/Settings';\nimport { MatrixRoomReceiverConverter } from '../converters/room/RoomReceiver';\nimport { MatrixEventType } from '../definitions/MatrixEventType';\nimport type { MatrixEventRoomCreated } from '../definitions/events/RoomCreated';\nimport type { MatrixEventRoomRedacted } from '../definitions/events/RoomEventRedacted';\nimport type { MatrixEventRoomJoinRulesChanged } from '../definitions/events/RoomJoinRulesChanged';\nimport type { MatrixEventRoomMembershipChanged } from '../definitions/events/RoomMembershipChanged';\nimport type { IMatrixEventContentRoomMessageSent, MatrixEventRoomMessageSent } from '../definitions/events/RoomMessageSent';\nimport { MatrixEnumRelatesToRelType, MatrixEnumSendMessageType } from '../definitions/events/RoomMessageSent';\nimport type { MatrixEventRoomNameChanged } from '../definitions/events/RoomNameChanged';\nimport type { MatrixEventRoomRoomPowerLevelsChanged } from '../definitions/events/RoomPowerLevelsChanged';\nimport type { MatrixEventRoomTopicChanged } from '../definitions/events/RoomTopicChanged';\nimport { MatrixBaseEventHandler } from './BaseEvent';\n\nexport class MatrixRoomCreatedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_CREATED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomCreated): Promise<void> {\n\t\tawait this.roomService.onCreateRoom(MatrixRoomReceiverConverter.toRoomCreateDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomMembershipChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_MEMBERSHIP_CHANGED;\n\n\tconstructor(\n\t\tprivate roomService: FederationRoomServiceReceiver,\n\t\tprivate rocketSettingsAdapter: RocketChatSettingsAdapter,\n\t) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomMembershipChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomMembership(\n\t\t\tMatrixRoomReceiverConverter.toChangeRoomMembershipDto(externalEvent, this.rocketSettingsAdapter.getHomeServerDomain()),\n\t\t);\n\t}\n}\n\nexport class MatrixRoomMessageSentHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_MESSAGE_SENT;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tprivate executeTextMessageHandler(eventContent: IMatrixEventContentRoomMessageSent, externalEvent: MatrixEventRoomMessageSent): any {\n\t\tconst isAnEditionEvent =\n\t\t\teventContent['m.new_content'] &&\n\t\t\teventContent['m.relates_to'] &&\n\t\t\teventContent['m.relates_to'].rel_type === MatrixEnumRelatesToRelType.REPLACE;\n\t\treturn isAnEditionEvent\n\t\t\t? this.roomService.onExternalMessageEditedReceived(MatrixRoomReceiverConverter.toEditRoomMessageDto(externalEvent))\n\t\t\t: this.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\t}\n\n\tprivate executeThreadedTextMessageHandler(\n\t\teventContent: IMatrixEventContentRoomMessageSent,\n\t\texternalEvent: MatrixEventRoomMessageSent,\n\t): any {\n\t\tconst isAnEditionEvent =\n\t\t\teventContent['m.new_content'] &&\n\t\t\teventContent['m.relates_to'] &&\n\t\t\teventContent['m.relates_to'].rel_type === MatrixEnumRelatesToRelType.REPLACE;\n\t\treturn isAnEditionEvent\n\t\t\t? this.roomService.onExternalMessageEditedReceived(MatrixRoomReceiverConverter.toEditRoomMessageDto(externalEvent))\n\t\t\t: this.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomMessageSent): Promise<void> {\n\t\tconst handlers = {\n\t\t\t[MatrixEnumSendMessageType.TEXT]: () => this.executeTextMessageHandler(externalEvent.content, externalEvent),\n\t\t\t[MatrixEnumSendMessageType.AUDIO]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.FILE]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.IMAGE]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.NOTICE]: () =>\n\t\t\t\tthis.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.VIDEO]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.EMOTE]: () =>\n\t\t\t\tthis.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.LOCATION]: () => {\n\t\t\t\tthrow new Error('Location events are not supported yet');\n\t\t\t},\n\t\t};\n\n\t\tconst threadHandlers = {\n\t\t\t[MatrixEnumSendMessageType.TEXT]: () => this.executeThreadedTextMessageHandler(externalEvent.content, externalEvent),\n\t\t\t[MatrixEnumSendMessageType.AUDIO]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.FILE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.IMAGE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.NOTICE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.VIDEO]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.EMOTE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.LOCATION]: () => {\n\t\t\t\tthrow new Error('Location events are not supported yet');\n\t\t\t},\n\t\t};\n\n\t\tconst defaultHandler = () =>\n\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\t\tconst threadedDefaultHandler = () =>\n\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\n\t\tconst isThreadedMessage = Boolean(externalEvent.content?.['m.relates_to']?.rel_type === MatrixEventType.MESSAGE_ON_THREAD);\n\t\tif (isThreadedMessage) {\n\t\t\treturn (threadHandlers[externalEvent.content.msgtype as MatrixEnumSendMessageType] || threadedDefaultHandler)();\n\t\t}\n\t\tawait (handlers[externalEvent.content.msgtype as MatrixEnumSendMessageType] || defaultHandler)();\n\t}\n}\n\nexport class MatrixRoomJoinRulesChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_JOIN_RULES_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomJoinRulesChanged): Promise<void> {\n\t\tawait this.roomService.onChangeJoinRules(MatrixRoomReceiverConverter.toRoomChangeJoinRulesDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomNameChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_NAME_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomNameChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomName(MatrixRoomReceiverConverter.toRoomChangeNameDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomTopicChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_TOPIC_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomTopicChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomTopic(MatrixRoomReceiverConverter.toRoomChangeTopicDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomEventRedactedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_EVENT_REDACTED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomRedacted): Promise<void> {\n\t\tawait this.roomService.onRedactEvent(MatrixRoomReceiverConverter.toRoomRedactEventDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomPowerLevelsChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_POWER_LEVELS_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomRoomPowerLevelsChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomPowerLevels(MatrixRoomReceiverConverter.toRoomChangePowerLevelsEventDto(externalEvent));\n\t}\n}\n"],"names":["MatrixRoomCreatedHandler","MatrixRoomEventRedactedHandler","MatrixRoomJoinRulesChangedHandler","MatrixRoomMembershipChangedHandler","MatrixRoomMessageSentHandler","MatrixRoomNameChangedHandler","MatrixRoomPowerLevelsChangedHandler","MatrixRoomTopicChangedHandler","MatrixBaseEventHandler","handle","externalEvent","roomService","onCreateRoom","MatrixRoomReceiverConverter","toRoomCreateDto","constructor","eventType","MatrixEventType","ROOM_CREATED","onChangeRoomMembership","toChangeRoomMembershipDto","rocketSettingsAdapter","getHomeServerDomain","ROOM_MEMBERSHIP_CHANGED","executeTextMessageHandler","eventContent","isAnEditionEvent","rel_type","MatrixEnumRelatesToRelType","REPLACE","onExternalMessageEditedReceived","toEditRoomMessageDto","onExternalMessageReceived","toSendRoomMessageDto","executeThreadedTextMessageHandler","onExternalThreadedMessageReceived","handlers","MatrixEnumSendMessageType","TEXT","content","AUDIO","onExternalFileMessageReceived","toSendRoomFileMessageDto","FILE","IMAGE","NOTICE","VIDEO","EMOTE","LOCATION","Error","threadHandlers","onExternalThreadedFileMessageReceived","defaultHandler","threadedDefaultHandler","isThreadedMessage","Boolean","MESSAGE_ON_THREAD","msgtype","ROOM_MESSAGE_SENT","onChangeJoinRules","toRoomChangeJoinRulesDto","ROOM_JOIN_RULES_CHANGED","onChangeRoomName","toRoomChangeNameDto","ROOM_NAME_CHANGED","onChangeRoomTopic","toRoomChangeTopicDto","ROOM_TOPIC_CHANGED","onRedactEvent","toRoomRedactEventDto","ROOM_EVENT_REDACTED","onChangeRoomPowerLevels","toRoomChangePowerLevelsEventDto","ROOM_POWER_LEVELS_CHANGED"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/Room.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2f6e93efe476a48f2932cd3e5ea278c8a00c3bf9","contentHash":"4c321e1f736ba12ac565ccc88688cdb30c36c9b4d5e1dde784086c3ccfe4400a"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/queue/InMemoryQueue.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/queue/InMemoryQueue.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":29}},"3":{"start":{"line":11,"column":29},"end":{"line":11,"column":71}},"4":{"start":{"line":13,"column":4},"end":{"line":15,"column":6}},"5":{"start":{"line":17,"column":20},"end":{"line":27,"column":1}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":69}},"7":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"8":{"start":{"line":23,"column":12},"end":{"line":23,"column":65}},"9":{"start":{"line":25,"column":8},"end":{"line":25,"column":54}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":12,"column":9},"end":{"line":12,"column":33}},"loc":{"start":{"line":12,"column":39},"end":{"line":16,"column":1}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":18,"column":4},"end":{"line":18,"column":5}},"loc":{"start":{"line":18,"column":37},"end":{"line":20,"column":5}},"line":18},"3":{"name":"(anonymous_3)","decl":{"start":{"line":21,"column":4},"end":{"line":21,"column":5}},"loc":{"start":{"line":21,"column":21},"end":{"line":26,"column":5}},"line":21}},"branchMap":{"0":{"loc":{"start":{"line":13,"column":11},"end":{"line":15,"column":5}},"type":"cond-expr","locations":[{"start":{"line":13,"column":35},"end":{"line":13,"column":38}},{"start":{"line":13,"column":41},"end":{"line":15,"column":5}}],"line":13},"1":{"loc":{"start":{"line":13,"column":11},"end":{"line":13,"column":32}},"type":"binary-expr","locations":[{"start":{"line":13,"column":11},"end":{"line":13,"column":14}},{"start":{"line":13,"column":18},"end":{"line":13,"column":32}}],"line":13},"2":{"loc":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"type":"if","locations":[{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},{"start":{"line":22,"column":8},"end":{"line":24,"column":9}}],"line":22}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":2,"8":1,"9":1},"f":{"0":1,"1":1,"2":1,"3":2},"b":{"0":[0,1],"1":[1,1],"2":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/queue/InMemoryQueue.ts"],"sourcesContent":["import fastq from 'fastq';\n\nimport type { AbstractMatrixEvent } from '../matrix/definitions/AbstractMatrixEvent';\n\nexport class InMemoryQueue {\n\tprivate instance: any;\n\n\tpublic setHandler(handler: (event: AbstractMatrixEvent) => Promise<void>, concurrency: number): void {\n\t\tthis.instance = fastq.promise(handler, concurrency);\n\t}\n\n\tpublic addToQueue(task: Record<string, any>): void {\n\t\tif (!this.instance) {\n\t\t\tthrow new Error('You need to set the handler first');\n\t\t}\n\t\tthis.instance.push(task).catch(console.error);\n\t}\n}\n"],"names":["InMemoryQueue","setHandler","handler","concurrency","instance","fastq","promise","addToQueue","task","Error","push","catch","console","error"],"mappings":";;;;+BAIaA;;;eAAAA;;;8DAJK;;;;;;AAIX,IAAA,AAAMA,gBAAN,MAAMA;IAGLC,WAAWC,OAAsD,EAAEC,WAAmB,EAAQ;QACpG,IAAI,CAACC,QAAQ,GAAGC,cAAK,CAACC,OAAO,CAACJ,SAASC;IACxC;IAEOI,WAAWC,IAAyB,EAAQ;QAClD,IAAI,CAAC,IAAI,CAACJ,QAAQ,EAAE;YACnB,MAAM,IAAIK,MAAM;QACjB;QACA,IAAI,CAACL,QAAQ,CAACM,IAAI,CAACF,MAAMG,KAAK,CAACC,QAAQC,KAAK;IAC7C;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/queue/InMemoryQueue.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"769e892420c6d616ca4efcde2ba0c16e51215991","contentHash":"29eee8b6265ac0bb1dc0aeedf0a60bd4f9764212792f47e64744c6814f2d3d64"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/adapters/Statistics.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/adapters/Statistics.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":45}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":64}},"5":{"start":{"line":13,"column":34},"end":{"line":61,"column":1}},"6":{"start":{"line":15,"column":21},"end":{"line":21,"column":10}},"7":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"8":{"start":{"line":23,"column":12},"end":{"line":23,"column":24}},"9":{"start":{"line":25,"column":8},"end":{"line":29,"column":10}},"10":{"start":{"line":32,"column":21},"end":{"line":38,"column":10}},"11":{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},"12":{"start":{"line":40,"column":12},"end":{"line":40,"column":24}},"13":{"start":{"line":42,"column":8},"end":{"line":46,"column":10}},"14":{"start":{"line":49,"column":8},"end":{"line":49,"column":59}},"15":{"start":{"line":52,"column":8},"end":{"line":52,"column":51}},"16":{"start":{"line":55,"column":32},"end":{"line":55,"column":160}},"17":{"start":{"line":56,"column":8},"end":{"line":59,"column":10}},"18":{"start":{"line":62,"column":38},"end":{"line":73,"column":1}},"19":{"start":{"line":63,"column":30},"end":{"line":63,"column":63}},"20":{"start":{"line":64,"column":4},"end":{"line":72,"column":6}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":36},"end":{"line":30,"column":5}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":31,"column":4},"end":{"line":31,"column":5}},"loc":{"start":{"line":31,"column":37},"end":{"line":47,"column":5}},"line":31},"3":{"name":"(anonymous_3)","decl":{"start":{"line":48,"column":4},"end":{"line":48,"column":5}},"loc":{"start":{"line":48,"column":37},"end":{"line":50,"column":5}},"line":48},"4":{"name":"(anonymous_4)","decl":{"start":{"line":51,"column":4},"end":{"line":51,"column":5}},"loc":{"start":{"line":51,"column":37},"end":{"line":53,"column":5}},"line":51},"5":{"name":"(anonymous_5)","decl":{"start":{"line":54,"column":4},"end":{"line":54,"column":5}},"loc":{"start":{"line":54,"column":48},"end":{"line":60,"column":5}},"line":54},"6":{"name":"(anonymous_6)","decl":{"start":{"line":62,"column":38},"end":{"line":62,"column":39}},"loc":{"start":{"line":62,"column":48},"end":{"line":73,"column":1}},"line":62}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},"type":"if","locations":[{"start":{"line":22,"column":8},"end":{"line":24,"column":9}},{"start":{"line":22,"column":8},"end":{"line":24,"column":9}}],"line":22},"1":{"loc":{"start":{"line":27,"column":18},"end":{"line":27,"column":47}},"type":"binary-expr","locations":[{"start":{"line":27,"column":18},"end":{"line":27,"column":28}},{"start":{"line":27,"column":32},"end":{"line":27,"column":41}},{"start":{"line":27,"column":45},"end":{"line":27,"column":47}}],"line":27},"2":{"loc":{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},"type":"if","locations":[{"start":{"line":39,"column":8},"end":{"line":41,"column":9}},{"start":{"line":39,"column":8},"end":{"line":41,"column":9}}],"line":39},"3":{"loc":{"start":{"line":44,"column":18},"end":{"line":44,"column":47}},"type":"binary-expr","locations":[{"start":{"line":44,"column":18},"end":{"line":44,"column":28}},{"start":{"line":44,"column":32},"end":{"line":44,"column":41}},{"start":{"line":44,"column":45},"end":{"line":44,"column":47}}],"line":44}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":3,"7":3,"8":2,"9":1,"10":3,"11":3,"12":2,"13":1,"14":3,"15":3,"16":3,"17":3,"18":1,"19":3,"20":3},"f":{"0":1,"1":3,"2":3,"3":3,"4":3,"5":3,"6":3},"b":{"0":[2,1],"1":[1,1,0],"2":[2,1],"3":[1,1,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/adapters/Statistics.ts"],"sourcesContent":["import type { IMatrixFederationStatistics } from '@rocket.chat/core-typings';\nimport { MatrixBridgedRoom, Rooms, Users } from '@rocket.chat/models';\n\nimport { settings } from '../../../../../../app/settings/server';\n\nclass RocketChatStatisticsAdapter {\n\tasync getBiggestRoomAvailable(): Promise<{\n\t\t_id: string;\n\t\tname: string;\n\t\tusersCount: number;\n\t} | null> {\n\t\tconst room = await Rooms.findBiggestFederatedRoomInNumberOfUsers({ projection: { usersCount: 1, fname: 1, name: 1 } });\n\t\tif (!room) {\n\t\t\treturn null;\n\t\t}\n\t\treturn {\n\t\t\t_id: room._id,\n\t\t\tname: room.fname || room.name || '',\n\t\t\tusersCount: room.usersCount,\n\t\t};\n\t}\n\n\tasync getSmallestRoomAvailable(): Promise<{\n\t\t_id: string;\n\t\tname: string;\n\t\tusersCount: number;\n\t} | null> {\n\t\tconst room = await Rooms.findSmallestFederatedRoomInNumberOfUsers({ projection: { usersCount: 1, fname: 1, name: 1 } });\n\t\tif (!room) {\n\t\t\treturn null;\n\t\t}\n\t\treturn {\n\t\t\t_id: room._id,\n\t\t\tname: room.fname || room.name || '',\n\t\t\tusersCount: room.usersCount,\n\t\t};\n\t}\n\n\tasync getAmountOfExternalUsers(): Promise<number> {\n\t\treturn Users.countFederatedExternalUsers();\n\t}\n\n\tasync getAmountOfExternalRooms(): Promise<number> {\n\t\treturn Rooms.countFederatedRooms();\n\t}\n\n\tasync getAmountOfConnectedExternalServers(): Promise<{ quantity: number; servers: string[] }> {\n\t\tconst externalServers = await MatrixBridgedRoom.getExternalServerConnectedExcluding(\n\t\t\tsettings.get('Federation_Matrix_homeserver_domain'),\n\t\t);\n\n\t\treturn {\n\t\t\tquantity: externalServers.length,\n\t\t\tservers: externalServers,\n\t\t};\n\t}\n}\n\nexport const getMatrixFederationStatistics = async (): Promise<IMatrixFederationStatistics> => {\n\tconst statisticsService = new RocketChatStatisticsAdapter();\n\n\treturn {\n\t\tenabled: settings.get('Federation_Matrix_enabled'),\n\t\tmaximumSizeOfPublicRoomsUsers: settings.get('Federation_Matrix_max_size_of_public_rooms_users'),\n\t\tbiggestRoom: await statisticsService.getBiggestRoomAvailable(),\n\t\tsmallestRoom: await statisticsService.getSmallestRoomAvailable(),\n\t\tamountOfExternalUsers: await statisticsService.getAmountOfExternalUsers(),\n\t\tamountOfFederatedRooms: await statisticsService.getAmountOfExternalRooms(),\n\t\texternalConnectedServers: await statisticsService.getAmountOfConnectedExternalServers(),\n\t};\n};\n"],"names":["getMatrixFederationStatistics","RocketChatStatisticsAdapter","getBiggestRoomAvailable","room","Rooms","findBiggestFederatedRoomInNumberOfUsers","projection","usersCount","fname","name","_id","getSmallestRoomAvailable","findSmallestFederatedRoomInNumberOfUsers","getAmountOfExternalUsers","Users","countFederatedExternalUsers","getAmountOfExternalRooms","countFederatedRooms","getAmountOfConnectedExternalServers","externalServers","MatrixBridgedRoom","getExternalServerConnectedExcluding","settings","get","quantity","length","servers","statisticsService","enabled","maximumSizeOfPublicRoomsUsers","biggestRoom","smallestRoom","amountOfExternalUsers","amountOfFederatedRooms","externalConnectedServers"],"mappings":";;;;+BA0DaA;;;eAAAA;;;wBAzDmC;wBAEvB;AAEzB,IAAA,AAAMC,8BAAN,MAAMA;IACL,MAAMC,0BAII;QACT,MAAMC,OAAO,MAAMC,aAAK,CAACC,uCAAuC,CAAC;YAAEC,YAAY;gBAAEC,YAAY;gBAAGC,OAAO;gBAAGC,MAAM;YAAE;QAAE;QACpH,IAAI,CAACN,MAAM;YACV,OAAO;QACR;QACA,OAAO;YACNO,KAAKP,KAAKO,GAAG;YACbD,MAAMN,KAAKK,KAAK,IAAIL,KAAKM,IAAI,IAAI;YACjCF,YAAYJ,KAAKI,UAAU;QAC5B;IACD;IAEA,MAAMI,2BAII;QACT,MAAMR,OAAO,MAAMC,aAAK,CAACQ,wCAAwC,CAAC;YAAEN,YAAY;gBAAEC,YAAY;gBAAGC,OAAO;gBAAGC,MAAM;YAAE;QAAE;QACrH,IAAI,CAACN,MAAM;YACV,OAAO;QACR;QACA,OAAO;YACNO,KAAKP,KAAKO,GAAG;YACbD,MAAMN,KAAKK,KAAK,IAAIL,KAAKM,IAAI,IAAI;YACjCF,YAAYJ,KAAKI,UAAU;QAC5B;IACD;IAEA,MAAMM,2BAA4C;QACjD,OAAOC,aAAK,CAACC,2BAA2B;IACzC;IAEA,MAAMC,2BAA4C;QACjD,OAAOZ,aAAK,CAACa,mBAAmB;IACjC;IAEA,MAAMC,sCAAwF;QAC7F,MAAMC,kBAAkB,MAAMC,yBAAiB,CAACC,mCAAmC,CAClFC,gBAAQ,CAACC,GAAG,CAAC;QAGd,OAAO;YACNC,UAAUL,gBAAgBM,MAAM;YAChCC,SAASP;QACV;IACD;AACD;AAEO,MAAMnB,gCAAgC;IAC5C,MAAM2B,oBAAoB,IAAI1B;IAE9B,OAAO;QACN2B,SAASN,gBAAQ,CAACC,GAAG,CAAC;QACtBM,+BAA+BP,gBAAQ,CAACC,GAAG,CAAC;QAC5CO,aAAa,MAAMH,kBAAkBzB,uBAAuB;QAC5D6B,cAAc,MAAMJ,kBAAkBhB,wBAAwB;QAC9DqB,uBAAuB,MAAML,kBAAkBd,wBAAwB;QACvEoB,wBAAwB,MAAMN,kBAAkBX,wBAAwB;QACxEkB,0BAA0B,MAAMP,kBAAkBT,mCAAmC;IACtF;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/adapters/Statistics.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"78038016b665282dcc7307fe2ccbc0774b62b66a","contentHash":"36ddb0f62f2af506583c9ff2fb1e0957d5830fba0445cc89654b84d06659c88e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/converters/to-external-parser-formatter.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/converters/to-external-parser-formatter.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":18,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":39}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":44}},"6":{"start":{"line":19,"column":36},"end":{"line":19,"column":86}},"7":{"start":{"line":20,"column":23},"end":{"line":20,"column":63}},"8":{"start":{"line":22,"column":4},"end":{"line":24,"column":6}},"9":{"start":{"line":26,"column":41},"end":{"line":26,"column":63}},"10":{"start":{"line":27,"column":39},"end":{"line":30,"column":1}},"11":{"start":{"line":31,"column":41},"end":{"line":66,"column":1}},"12":{"start":{"line":32,"column":21},"end":{"line":32,"column":23}},"13":{"start":{"line":33,"column":4},"end":{"line":64,"column":7}},"14":{"start":{"line":38,"column":58},"end":{"line":38,"column":63}},"15":{"start":{"line":39,"column":30},"end":{"line":39,"column":57}},"16":{"start":{"line":40,"column":12},"end":{"line":42,"column":13}},"17":{"start":{"line":41,"column":16},"end":{"line":41,"column":29}},"18":{"start":{"line":43,"column":38},"end":{"line":43,"column":107}},"19":{"start":{"line":44,"column":12},"end":{"line":54,"column":13}},"20":{"start":{"line":45,"column":37},"end":{"line":45,"column":52}},"21":{"start":{"line":46,"column":41},"end":{"line":46,"column":60}},"22":{"start":{"line":47,"column":52},"end":{"line":47,"column":85}},"23":{"start":{"line":48,"column":37},"end":{"line":48,"column":51}},"24":{"start":{"line":49,"column":44},"end":{"line":49,"column":69}},"25":{"start":{"line":50,"column":16},"end":{"line":53,"column":19}},"26":{"start":{"line":55,"column":36},"end":{"line":55,"column":106}},"27":{"start":{"line":56,"column":12},"end":{"line":61,"column":13}},"28":{"start":{"line":57,"column":16},"end":{"line":60,"column":19}},"29":{"start":{"line":62,"column":12},"end":{"line":62,"column":25}},"30":{"start":{"line":65,"column":4},"end":{"line":65,"column":20}},"31":{"start":{"line":67,"column":32},"end":{"line":67,"column":242}},"32":{"start":{"line":67,"column":104},"end":{"line":67,"column":242}},"33":{"start":{"line":68,"column":23},"end":{"line":68,"column":26}},"34":{"start":{"line":69,"column":47},"end":{"line":97,"column":1}},"35":{"start":{"line":70,"column":24},"end":{"line":70,"column":26}},"36":{"start":{"line":71,"column":25},"end":{"line":71,"column":32}},"37":{"start":{"line":72,"column":4},"end":{"line":74,"column":5}},"38":{"start":{"line":73,"column":8},"end":{"line":73,"column":23}},"39":{"start":{"line":75,"column":4},"end":{"line":95,"column":7}},"40":{"start":{"line":76,"column":34},"end":{"line":76,"column":57}},"41":{"start":{"line":77,"column":30},"end":{"line":77,"column":81}},"42":{"start":{"line":78,"column":31},"end":{"line":78,"column":67}},"43":{"start":{"line":79,"column":41},"end":{"line":79,"column":64}},"44":{"start":{"line":80,"column":41},"end":{"line":80,"column":119}},"45":{"start":{"line":81,"column":42},"end":{"line":81,"column":112}},"46":{"start":{"line":82,"column":31},"end":{"line":82,"column":57}},"47":{"start":{"line":83,"column":8},"end":{"line":89,"column":9}},"48":{"start":{"line":84,"column":31},"end":{"line":84,"column":37}},"49":{"start":{"line":85,"column":41},"end":{"line":85,"column":94}},"50":{"start":{"line":86,"column":12},"end":{"line":86,"column":75}},"51":{"start":{"line":87,"column":12},"end":{"line":87,"column":95}},"52":{"start":{"line":88,"column":12},"end":{"line":88,"column":83}},"53":{"start":{"line":90,"column":25},"end":{"line":90,"column":60}},"54":{"start":{"line":91,"column":37},"end":{"line":91,"column":63}},"55":{"start":{"line":92,"column":36},"end":{"line":92,"column":73}},"56":{"start":{"line":93,"column":8},"end":{"line":93,"column":75}},"57":{"start":{"line":94,"column":8},"end":{"line":94,"column":117}},"58":{"start":{"line":96,"column":4},"end":{"line":96,"column":32}},"59":{"start":{"line":99,"column":23},"end":{"line":99,"column":45}},"60":{"start":{"line":101,"column":25},"end":{"line":101,"column":26}},"61":{"start":{"line":102,"column":4},"end":{"line":107,"column":5}},"62":{"start":{"line":103,"column":8},"end":{"line":105,"column":9}},"63":{"start":{"line":104,"column":12},"end":{"line":104,"column":18}},"64":{"start":{"line":106,"column":8},"end":{"line":106,"column":28}},"65":{"start":{"line":108,"column":4},"end":{"line":108,"column":63}},"66":{"start":{"line":110,"column":37},"end":{"line":124,"column":1}},"67":{"start":{"line":111,"column":29},"end":{"line":121,"column":6}},"68":{"start":{"line":122,"column":53},"end":{"line":122,"column":80}},"69":{"start":{"line":123,"column":4},"end":{"line":123,"column":213}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":29},"end":{"line":12,"column":30}},"loc":{"start":{"line":12,"column":40},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":34},"end":{"line":15,"column":35}},"loc":{"start":{"line":15,"column":45},"end":{"line":17,"column":5}},"line":15},"3":{"name":"_interop_require_default","decl":{"start":{"line":21,"column":9},"end":{"line":21,"column":33}},"loc":{"start":{"line":21,"column":39},"end":{"line":25,"column":1}},"line":21},"4":{"name":"(anonymous_4)","decl":{"start":{"line":31,"column":41},"end":{"line":31,"column":42}},"loc":{"start":{"line":31,"column":88},"end":{"line":66,"column":1}},"line":31},"5":{"name":"(anonymous_5)","decl":{"start":{"line":37,"column":25},"end":{"line":37,"column":26}},"loc":{"start":{"line":37,"column":34},"end":{"line":63,"column":9}},"line":37},"6":{"name":"(anonymous_6)","decl":{"start":{"line":67,"column":32},"end":{"line":67,"column":33}},"loc":{"start":{"line":67,"column":104},"end":{"line":67,"column":242}},"line":67},"7":{"name":"(anonymous_7)","decl":{"start":{"line":69,"column":47},"end":{"line":69,"column":48}},"loc":{"start":{"line":69,"column":84},"end":{"line":97,"column":1}},"line":69},"8":{"name":"(anonymous_8)","decl":{"start":{"line":75,"column":37},"end":{"line":75,"column":38}},"loc":{"start":{"line":75,"column":77},"end":{"line":95,"column":5}},"line":75},"9":{"name":"stripReplyQuote","decl":{"start":{"line":98,"column":9},"end":{"line":98,"column":24}},"loc":{"start":{"line":98,"column":34},"end":{"line":109,"column":1}},"line":98},"10":{"name":"(anonymous_10)","decl":{"start":{"line":110,"column":37},"end":{"line":110,"column":38}},"loc":{"start":{"line":110,"column":136},"end":{"line":124,"column":1}},"line":110}},"branchMap":{"0":{"loc":{"start":{"line":22,"column":11},"end":{"line":24,"column":5}},"type":"cond-expr","locations":[{"start":{"line":22,"column":35},"end":{"line":22,"column":38}},{"start":{"line":22,"column":41},"end":{"line":24,"column":5}}],"line":22},"1":{"loc":{"start":{"line":22,"column":11},"end":{"line":22,"column":32}},"type":"binary-expr","locations":[{"start":{"line":22,"column":11},"end":{"line":22,"column":14}},{"start":{"line":22,"column":18},"end":{"line":22,"column":32}}],"line":22},"2":{"loc":{"start":{"line":38,"column":31},"end":{"line":38,"column":40}},"type":"default-arg","locations":[{"start":{"line":38,"column":38},"end":{"line":38,"column":40}}],"line":38},"3":{"loc":{"start":{"line":39,"column":30},"end":{"line":39,"column":57}},"type":"binary-expr","locations":[{"start":{"line":39,"column":30},"end":{"line":39,"column":41}},{"start":{"line":39,"column":45},"end":{"line":39,"column":49}},{"start":{"line":39,"column":53},"end":{"line":39,"column":57}}],"line":39},"4":{"loc":{"start":{"line":40,"column":12},"end":{"line":42,"column":13}},"type":"if","locations":[{"start":{"line":40,"column":12},"end":{"line":42,"column":13}},{"start":{"line":40,"column":12},"end":{"line":42,"column":13}}],"line":40},"5":{"loc":{"start":{"line":43,"column":38},"end":{"line":43,"column":107}},"type":"binary-expr","locations":[{"start":{"line":43,"column":38},"end":{"line":43,"column":85}},{"start":{"line":43,"column":89},"end":{"line":43,"column":107}}],"line":43},"6":{"loc":{"start":{"line":44,"column":12},"end":{"line":54,"column":13}},"type":"if","locations":[{"start":{"line":44,"column":12},"end":{"line":54,"column":13}},{"start":{"line":44,"column":12},"end":{"line":54,"column":13}}],"line":44},"7":{"loc":{"start":{"line":51,"column":29},"end":{"line":51,"column":163}},"type":"cond-expr","locations":[{"start":{"line":51,"column":121},"end":{"line":51,"column":148}},{"start":{"line":51,"column":151},"end":{"line":51,"column":163}}],"line":51},"8":{"loc":{"start":{"line":52,"column":30},"end":{"line":52,"column":86}},"type":"cond-expr","locations":[{"start":{"line":52,"column":52},"end":{"line":52,"column":79}},{"start":{"line":52,"column":82},"end":{"line":52,"column":86}}],"line":52},"9":{"loc":{"start":{"line":55,"column":36},"end":{"line":55,"column":106}},"type":"binary-expr","locations":[{"start":{"line":55,"column":36},"end":{"line":55,"column":83}},{"start":{"line":55,"column":87},"end":{"line":55,"column":106}}],"line":55},"10":{"loc":{"start":{"line":56,"column":12},"end":{"line":61,"column":13}},"type":"if","locations":[{"start":{"line":56,"column":12},"end":{"line":61,"column":13}},{"start":{"line":56,"column":12},"end":{"line":61,"column":13}}],"line":56},"11":{"loc":{"start":{"line":72,"column":4},"end":{"line":74,"column":5}},"type":"if","locations":[{"start":{"line":72,"column":4},"end":{"line":74,"column":5}},{"start":{"line":72,"column":4},"end":{"line":74,"column":5}}],"line":72},"12":{"loc":{"start":{"line":80,"column":41},"end":{"line":80,"column":119}},"type":"cond-expr","locations":[{"start":{"line":80,"column":68},"end":{"line":80,"column":114}},{"start":{"line":80,"column":117},"end":{"line":80,"column":119}}],"line":80},"13":{"loc":{"start":{"line":81,"column":42},"end":{"line":81,"column":112}},"type":"cond-expr","locations":[{"start":{"line":81,"column":69},"end":{"line":81,"column":107}},{"start":{"line":81,"column":110},"end":{"line":81,"column":112}}],"line":81},"14":{"loc":{"start":{"line":83,"column":8},"end":{"line":89,"column":9}},"type":"if","locations":[{"start":{"line":83,"column":8},"end":{"line":89,"column":9}},{"start":{"line":83,"column":8},"end":{"line":89,"column":9}}],"line":83},"15":{"loc":{"start":{"line":83,"column":12},"end":{"line":83,"column":55}},"type":"binary-expr","locations":[{"start":{"line":83,"column":12},"end":{"line":83,"column":37}},{"start":{"line":83,"column":41},"end":{"line":83,"column":55}}],"line":83},"16":{"loc":{"start":{"line":94,"column":61},"end":{"line":94,"column":115}},"type":"cond-expr","locations":[{"start":{"line":94,"column":84},"end":{"line":94,"column":93}},{"start":{"line":94,"column":96},"end":{"line":94,"column":115}}],"line":94},"17":{"loc":{"start":{"line":103,"column":8},"end":{"line":105,"column":9}},"type":"if","locations":[{"start":{"line":103,"column":8},"end":{"line":105,"column":9}},{"start":{"line":103,"column":8},"end":{"line":105,"column":9}}],"line":103}},"s":{"0":1,"1":1,"2":2,"3":1,"4":19,"5":14,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":33,"13":33,"14":58,"15":58,"16":58,"17":0,"18":58,"19":58,"20":53,"21":53,"22":53,"23":53,"24":53,"25":53,"26":58,"27":58,"28":5,"29":58,"30":33,"31":1,"32":19,"33":1,"34":1,"35":33,"36":33,"37":33,"38":3,"39":30,"40":58,"41":58,"42":58,"43":58,"44":58,"45":58,"46":58,"47":58,"48":1,"49":1,"50":1,"51":1,"52":1,"53":58,"54":58,"55":58,"56":58,"57":58,"58":30,"59":14,"60":14,"61":14,"62":29,"63":14,"64":15,"65":14,"66":1,"67":14,"68":14,"69":14},"f":{"0":1,"1":19,"2":14,"3":1,"4":33,"5":58,"6":19,"7":33,"8":58,"9":14,"10":14},"b":{"0":[0,1],"1":[1,1],"2":[0],"3":[58,58,58],"4":[0,58],"5":[58,58],"6":[53,5],"7":[18,35],"8":[9,44],"9":[58,58],"10":[5,53],"11":[3,30],"12":[57,1],"13":[57,1],"14":[1,57],"15":[58,1],"16":[30,28],"17":[14,15]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/converters/to-external-parser-formatter.ts"],"sourcesContent":["import sanitizeHtml from 'sanitize-html';\nimport type { IFrame } from 'sanitize-html';\n\nimport { FederatedUser } from '../../../domain/FederatedUser';\n\ninterface IInternalMention {\n\tmention: string;\n\trealName: string;\n}\n\nconst DEFAULT_LINK_FOR_MATRIX_MENTIONS = 'https://matrix.to/#/';\nconst DEFAULT_TAGS_FOR_MATRIX_QUOTES = ['mx-reply', 'blockquote'];\n\nconst getAllMentionsWithTheirRealNames = (message: string, homeServerDomain: string, senderExternalId: string): IInternalMention[] => {\n\tconst mentions: IInternalMention[] = [];\n\tsanitizeHtml(message, {\n\t\tallowedTags: ['a'],\n\t\texclusiveFilter: (frame: IFrame): boolean => {\n\t\t\tconst {\n\t\t\t\tattribs: { href = '' },\n\t\t\t\ttag,\n\t\t\t\ttext,\n\t\t\t} = frame;\n\t\t\tconst validATag = tag === 'a' && href && text;\n\t\t\tif (!validATag) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst isUsernameMention = href.includes(DEFAULT_LINK_FOR_MATRIX_MENTIONS) && href.includes('@');\n\t\t\tif (isUsernameMention) {\n\t\t\t\tconst [, username] = href.split('@');\n\t\t\t\tconst [, serverDomain] = username.split(':');\n\n\t\t\t\tconst withoutServerIdentification = `@${username.split(':').shift()}`;\n\t\t\t\tconst fullUsername = `@${username}`;\n\t\t\t\tconst isMentioningHimself = senderExternalId === text;\n\n\t\t\t\tmentions.push({\n\t\t\t\t\tmention: FederatedUser.isOriginalFromTheProxyServer(serverDomain, homeServerDomain) ? withoutServerIdentification : fullUsername,\n\t\t\t\t\trealName: isMentioningHimself ? withoutServerIdentification : text,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst isMentioningAll = href.includes(DEFAULT_LINK_FOR_MATRIX_MENTIONS) && !href.includes('@');\n\t\t\tif (isMentioningAll) {\n\t\t\t\tmentions.push({\n\t\t\t\t\tmention: '@all',\n\t\t\t\t\trealName: text,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t});\n\n\treturn mentions;\n};\n\nexport const toInternalMessageFormat = ({\n\trawMessage,\n\tformattedMessage,\n\thomeServerDomain,\n\tsenderExternalId,\n}: {\n\trawMessage: string;\n\tformattedMessage: string;\n\thomeServerDomain: string;\n\tsenderExternalId: string;\n}): string =>\n\treplaceAllMentionsOneByOneSequentially(\n\t\trawMessage,\n\t\tgetAllMentionsWithTheirRealNames(formattedMessage, homeServerDomain, senderExternalId),\n\t);\n\nconst MATCH_ANYTHING = 'w';\nconst replaceAllMentionsOneByOneSequentially = (message: string, allMentionsWithRealNames: IInternalMention[]): string => {\n\tlet parsedMessage = '';\n\tlet toCompareAgain = message;\n\n\tif (allMentionsWithRealNames.length === 0) {\n\t\treturn message;\n\t}\n\n\tallMentionsWithRealNames.forEach(({ mention, realName }, mentionsIndex) => {\n\t\tconst negativeLookAhead = `(?!${MATCH_ANYTHING})`;\n\t\tconst realNameRegex = new RegExp(`(?<!w)${realName}${negativeLookAhead}`);\n\t\tlet realNamePosition = toCompareAgain.search(realNameRegex);\n\t\tconst realNamePresentInMessage = realNamePosition !== -1;\n\t\tlet messageReplacedWithMention = realNamePresentInMessage ? toCompareAgain.replace(realNameRegex, mention) : '';\n\t\tlet positionRemovingLastMention = realNamePresentInMessage ? realNamePosition + realName.length + 1 : -1;\n\t\tconst mentionForRoom = realName.charAt(0) === '!';\n\t\tif (!realNamePresentInMessage && mentionForRoom) {\n\t\t\tconst allMention = '@all';\n\t\t\tconst defaultRegexForRooms = new RegExp(`(?<!w)${allMention}${negativeLookAhead}`);\n\t\t\trealNamePosition = toCompareAgain.search(defaultRegexForRooms);\n\t\t\tmessageReplacedWithMention = toCompareAgain.replace(defaultRegexForRooms, mention);\n\t\t\tpositionRemovingLastMention = realNamePosition + allMention.length + 1;\n\t\t}\n\t\tconst lastItem = allMentionsWithRealNames.length - 1;\n\t\tconst lastMentionToProcess = mentionsIndex === lastItem;\n\t\tconst lastMentionPosition = realNamePosition + mention.length + 1;\n\n\t\ttoCompareAgain = toCompareAgain.slice(positionRemovingLastMention);\n\t\tparsedMessage += messageReplacedWithMention.slice(0, lastMentionToProcess ? undefined : lastMentionPosition);\n\t});\n\n\treturn parsedMessage.trim();\n};\n\nfunction stripReplyQuote(message: string): string {\n\tconst splitLines = message.split(/\\r?\\n/);\n\n\t// Find which line the quote ends on\n\tlet splitLineIndex = 0;\n\tfor (const line of splitLines) {\n\t\tif (line[0] !== '>') {\n\t\t\tbreak;\n\t\t}\n\t\tsplitLineIndex += 1;\n\t}\n\n\treturn splitLines.splice(splitLineIndex).join('\\n').trim();\n}\n\nexport const toInternalQuoteMessageFormat = async ({\n\thomeServerDomain,\n\tformattedMessage,\n\trawMessage,\n\tmessageToReplyToUrl,\n\tsenderExternalId,\n}: {\n\tmessageToReplyToUrl: string;\n\tformattedMessage: string;\n\trawMessage: string;\n\thomeServerDomain: string;\n\tsenderExternalId: string;\n}): Promise<string> => {\n\tconst withMentionsOnly = sanitizeHtml(formattedMessage, {\n\t\tallowedTags: ['a'],\n\t\tallowedAttributes: {\n\t\t\ta: ['href'],\n\t\t},\n\t\tnonTextTags: DEFAULT_TAGS_FOR_MATRIX_QUOTES,\n\t});\n\tconst rawMessageWithoutMatrixQuotingFormatting = stripReplyQuote(rawMessage);\n\n\treturn `[ ](${messageToReplyToUrl}) ${replaceAllMentionsOneByOneSequentially(\n\t\trawMessageWithoutMatrixQuotingFormatting,\n\t\tgetAllMentionsWithTheirRealNames(withMentionsOnly, homeServerDomain, senderExternalId),\n\t)}`;\n};\n"],"names":["toInternalMessageFormat","toInternalQuoteMessageFormat","DEFAULT_LINK_FOR_MATRIX_MENTIONS","DEFAULT_TAGS_FOR_MATRIX_QUOTES","getAllMentionsWithTheirRealNames","message","homeServerDomain","senderExternalId","mentions","sanitizeHtml","allowedTags","exclusiveFilter","frame","attribs","href","tag","text","validATag","isUsernameMention","includes","username","split","serverDomain","withoutServerIdentification","shift","fullUsername","isMentioningHimself","push","mention","FederatedUser","isOriginalFromTheProxyServer","realName","isMentioningAll","rawMessage","formattedMessage","replaceAllMentionsOneByOneSequentially","MATCH_ANYTHING","allMentionsWithRealNames","parsedMessage","toCompareAgain","length","forEach","mentionsIndex","negativeLookAhead","realNameRegex","RegExp","realNamePosition","search","realNamePresentInMessage","messageReplacedWithMention","replace","positionRemovingLastMention","mentionForRoom","charAt","allMention","defaultRegexForRooms","lastItem","lastMentionToProcess","lastMentionPosition","slice","undefined","trim","stripReplyQuote","splitLines","splitLineIndex","line","splice","join","messageToReplyToUrl","withMentionsOnly","allowedAttributes","a","nonTextTags","rawMessageWithoutMatrixQuotingFormatting"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/converters/to-external-parser-formatter.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"8282391c26150de43e8acb6d9c18177b82685b21","contentHash":"19ad07cc381e270944cbb9d142bf2f0762da0d3330c6daa5c683ca83e3b36dcf"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/RoomSenderDto.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/RoomSenderDto.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":24,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":43}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":52}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":50}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":52}},"8":{"start":{"line":25,"column":39},"end":{"line":29,"column":1}},"9":{"start":{"line":27,"column":8},"end":{"line":27,"column":45}},"10":{"start":{"line":30,"column":41},"end":{"line":40,"column":1}},"11":{"start":{"line":32,"column":8},"end":{"line":34,"column":11}},"12":{"start":{"line":35,"column":8},"end":{"line":35,"column":51}},"13":{"start":{"line":36,"column":8},"end":{"line":36,"column":41}},"14":{"start":{"line":37,"column":8},"end":{"line":37,"column":55}},"15":{"start":{"line":38,"column":8},"end":{"line":38,"column":55}},"16":{"start":{"line":41,"column":43},"end":{"line":50,"column":1}},"17":{"start":{"line":43,"column":8},"end":{"line":45,"column":11}},"18":{"start":{"line":46,"column":8},"end":{"line":46,"column":49}},"19":{"start":{"line":47,"column":8},"end":{"line":47,"column":31}},"20":{"start":{"line":48,"column":8},"end":{"line":48,"column":51}},"21":{"start":{"line":51,"column":34},"end":{"line":58,"column":1}},"22":{"start":{"line":53,"column":8},"end":{"line":55,"column":11}},"23":{"start":{"line":56,"column":8},"end":{"line":56,"column":45}},"24":{"start":{"line":59,"column":43},"end":{"line":67,"column":1}},"25":{"start":{"line":61,"column":8},"end":{"line":63,"column":11}},"26":{"start":{"line":64,"column":8},"end":{"line":64,"column":45}},"27":{"start":{"line":65,"column":8},"end":{"line":65,"column":61}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":33},"end":{"line":12,"column":34}},"loc":{"start":{"line":12,"column":44},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":42},"end":{"line":15,"column":43}},"loc":{"start":{"line":15,"column":53},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":40},"end":{"line":18,"column":41}},"loc":{"start":{"line":18,"column":51},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":42},"end":{"line":21,"column":43}},"loc":{"start":{"line":21,"column":53},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":26,"column":4},"end":{"line":26,"column":5}},"loc":{"start":{"line":26,"column":35},"end":{"line":28,"column":5}},"line":26},"6":{"name":"(anonymous_6)","decl":{"start":{"line":31,"column":4},"end":{"line":31,"column":5}},"loc":{"start":{"line":31,"column":110},"end":{"line":39,"column":5}},"line":31},"7":{"name":"(anonymous_7)","decl":{"start":{"line":42,"column":4},"end":{"line":42,"column":5}},"loc":{"start":{"line":42,"column":81},"end":{"line":49,"column":5}},"line":42},"8":{"name":"(anonymous_8)","decl":{"start":{"line":52,"column":4},"end":{"line":52,"column":5}},"loc":{"start":{"line":52,"column":51},"end":{"line":57,"column":5}},"line":52},"9":{"name":"(anonymous_9)","decl":{"start":{"line":60,"column":4},"end":{"line":60,"column":5}},"loc":{"start":{"line":60,"column":75},"end":{"line":66,"column":5}},"line":60}},"branchMap":{},"s":{"0":1,"1":1,"2":4,"3":1,"4":0,"5":0,"6":0,"7":0,"8":1,"9":0,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":1,"17":0,"18":0,"19":0,"20":0,"21":1,"22":0,"23":0,"24":1,"25":0,"26":0,"27":0},"f":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/RoomSenderDto.ts"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\n\ninterface IFederationSenderBaseRoomInputDto {\n\tinternalRoomId: string;\n}\n\ninterface IFederationCreateDMAndInviteUserDto extends IFederationSenderBaseRoomInputDto {\n\tinternalInviterId: string;\n\trawInviteeId: string;\n\tnormalizedInviteeId: string;\n\tinviteeUsernameOnly: string;\n}\n\ninterface IFederationRoomSendExternalMessageDto extends IFederationSenderBaseRoomInputDto {\n\tmessage: IMessage;\n\tinternalSenderId: string;\n\tisThreadedMessage: boolean;\n}\n\ninterface IFederationAfterLeaveRoomDto extends IFederationSenderBaseRoomInputDto {\n\tinternalUserId: string;\n}\n\ninterface IFederationAfterRemoveUserFromRoomDto extends IFederationSenderBaseRoomInputDto {\n\tinternalUserId: string;\n\tactionDoneByInternalId: string;\n}\n\nclass FederationSenderBaseRoomInputDto {\n\tconstructor({ internalRoomId }: IFederationSenderBaseRoomInputDto) {\n\t\tthis.internalRoomId = internalRoomId;\n\t}\n\n\tinternalRoomId: string;\n}\n\nexport class FederationCreateDMAndInviteUserDto extends FederationSenderBaseRoomInputDto {\n\tconstructor({\n\t\tinternalRoomId,\n\t\tinternalInviterId,\n\t\trawInviteeId,\n\t\tnormalizedInviteeId,\n\t\tinviteeUsernameOnly,\n\t}: IFederationCreateDMAndInviteUserDto) {\n\t\tsuper({ internalRoomId });\n\t\tthis.internalInviterId = internalInviterId;\n\t\tthis.rawInviteeId = rawInviteeId;\n\t\tthis.normalizedInviteeId = normalizedInviteeId;\n\t\tthis.inviteeUsernameOnly = inviteeUsernameOnly;\n\t}\n\n\tinternalInviterId: string;\n\n\trawInviteeId: string;\n\n\tnormalizedInviteeId: string;\n\n\tinviteeUsernameOnly: string;\n}\n\nexport class FederationRoomSendExternalMessageDto extends FederationSenderBaseRoomInputDto {\n\tconstructor({ internalRoomId, internalSenderId, message, isThreadedMessage }: IFederationRoomSendExternalMessageDto) {\n\t\tsuper({ internalRoomId });\n\t\tthis.internalSenderId = internalSenderId;\n\t\tthis.message = message;\n\t\tthis.isThreadedMessage = isThreadedMessage;\n\t}\n\n\tinternalSenderId: string;\n\n\tisThreadedMessage: boolean;\n\n\tmessage: IMessage;\n}\n\nexport class FederationAfterLeaveRoomDto extends FederationSenderBaseRoomInputDto {\n\tconstructor({ internalRoomId, internalUserId }: IFederationAfterLeaveRoomDto) {\n\t\tsuper({ internalRoomId });\n\t\tthis.internalUserId = internalUserId;\n\t}\n\n\tinternalUserId: string;\n}\n\nexport class FederationAfterRemoveUserFromRoomDto extends FederationSenderBaseRoomInputDto {\n\tconstructor({ internalRoomId, internalUserId, actionDoneByInternalId }: IFederationAfterRemoveUserFromRoomDto) {\n\t\tsuper({ internalRoomId });\n\t\tthis.internalUserId = internalUserId;\n\t\tthis.actionDoneByInternalId = actionDoneByInternalId;\n\t}\n\n\tinternalUserId: string;\n\n\tactionDoneByInternalId: string;\n}\n"],"names":["FederationAfterLeaveRoomDto","FederationAfterRemoveUserFromRoomDto","FederationCreateDMAndInviteUserDto","FederationRoomSendExternalMessageDto","FederationSenderBaseRoomInputDto","constructor","internalRoomId","internalInviterId","rawInviteeId","normalizedInviteeId","inviteeUsernameOnly","internalSenderId","message","isThreadedMessage","internalUserId","actionDoneByInternalId"],"mappings":";;;;;;;;;;;IA2EaA,2BAA2B;eAA3BA;;IASAC,oCAAoC;eAApCA;;IAhDAC,kCAAkC;eAAlCA;;IAwBAC,oCAAoC;eAApCA;;;AAhCb,IAAA,AAAMC,mCAAN,MAAMA;IACLC,YAAY,EAAEC,cAAc,EAAqC,CAAE;QAClE,IAAI,CAACA,cAAc,GAAGA;IACvB;AAGD;AAEO,IAAA,AAAMJ,qCAAN,MAAMA,2CAA2CE;IACvDC,YAAY,EACXC,cAAc,EACdC,iBAAiB,EACjBC,YAAY,EACZC,mBAAmB,EACnBC,mBAAmB,EACkB,CAAE;QACvC,KAAK,CAAC;YAAEJ;QAAe;QACvB,IAAI,CAACC,iBAAiB,GAAGA;QACzB,IAAI,CAACC,YAAY,GAAGA;QACpB,IAAI,CAACC,mBAAmB,GAAGA;QAC3B,IAAI,CAACC,mBAAmB,GAAGA;IAC5B;AASD;AAEO,IAAA,AAAMP,uCAAN,MAAMA,6CAA6CC;IACzDC,YAAY,EAAEC,cAAc,EAAEK,gBAAgB,EAAEC,OAAO,EAAEC,iBAAiB,EAAyC,CAAE;QACpH,KAAK,CAAC;YAAEP;QAAe;QACvB,IAAI,CAACK,gBAAgB,GAAGA;QACxB,IAAI,CAACC,OAAO,GAAGA;QACf,IAAI,CAACC,iBAAiB,GAAGA;IAC1B;AAOD;AAEO,IAAA,AAAMb,8BAAN,MAAMA,oCAAoCI;IAChDC,YAAY,EAAEC,cAAc,EAAEQ,cAAc,EAAgC,CAAE;QAC7E,KAAK,CAAC;YAAER;QAAe;QACvB,IAAI,CAACQ,cAAc,GAAGA;IACvB;AAGD;AAEO,IAAA,AAAMb,uCAAN,MAAMA,6CAA6CG;IACzDC,YAAY,EAAEC,cAAc,EAAEQ,cAAc,EAAEC,sBAAsB,EAAyC,CAAE;QAC9G,KAAK,CAAC;YAAET;QAAe;QACvB,IAAI,CAACQ,cAAc,GAAGA;QACtB,IAAI,CAACC,sBAAsB,GAAGA;IAC/B;AAKD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/application/room/input/RoomSenderDto.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"30ff8fb734fbca66599c7900d4aef8c175dda5c4","contentHash":"5ec7235568577db747f478f2c2602a972a7c50624e56a67b36b301d7f28907d2"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/converters/RoomSender.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/converters/RoomSender.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":45}},"3":{"start":{"line":11,"column":23},"end":{"line":11,"column":79}},"4":{"start":{"line":12,"column":22},"end":{"line":12,"column":74}},"5":{"start":{"line":13,"column":36},"end":{"line":46,"column":1}},"6":{"start":{"line":15,"column":36},"end":{"line":15,"column":123}},"7":{"start":{"line":16,"column":36},"end":{"line":16,"column":118}},"8":{"start":{"line":17,"column":8},"end":{"line":23,"column":11}},"9":{"start":{"line":26,"column":8},"end":{"line":31,"column":11}},"10":{"start":{"line":34,"column":8},"end":{"line":37,"column":11}},"11":{"start":{"line":40,"column":8},"end":{"line":44,"column":11}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":14,"column":4},"end":{"line":14,"column":5}},"loc":{"start":{"line":14,"column":94},"end":{"line":24,"column":5}},"line":14},"2":{"name":"(anonymous_2)","decl":{"start":{"line":25,"column":4},"end":{"line":25,"column":5}},"loc":{"start":{"line":25,"column":79},"end":{"line":32,"column":5}},"line":25},"3":{"name":"(anonymous_3)","decl":{"start":{"line":33,"column":4},"end":{"line":33,"column":5}},"loc":{"start":{"line":33,"column":64},"end":{"line":38,"column":5}},"line":33},"4":{"name":"(anonymous_4)","decl":{"start":{"line":39,"column":4},"end":{"line":39,"column":5}},"loc":{"start":{"line":39,"column":91},"end":{"line":45,"column":5}},"line":39}},"branchMap":{},"s":{"0":1,"1":1,"2":0,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},"f":{"0":0,"1":0,"2":0,"3":0,"4":0},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/converters/RoomSender.ts"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\n\nimport {\n\tFederationAfterLeaveRoomDto,\n\tFederationAfterRemoveUserFromRoomDto,\n\tFederationCreateDMAndInviteUserDto,\n\tFederationRoomSendExternalMessageDto,\n} from '../../../application/room/input/RoomSenderDto';\nimport {\n\tformatExternalUserIdToInternalUsernameFormat,\n\tremoveExternalSpecificCharsFromExternalIdentifier,\n} from '../../matrix/converters/room/RoomReceiver';\n\nexport class FederationRoomSenderConverter {\n\tpublic static toCreateDirectMessageRoomDto(\n\t\tinternalInviterId: string,\n\t\tinternalRoomId: string,\n\t\texternalInviteeId: string,\n\t): FederationCreateDMAndInviteUserDto {\n\t\tconst normalizedInviteeId = removeExternalSpecificCharsFromExternalIdentifier(externalInviteeId);\n\t\tconst inviteeUsernameOnly = formatExternalUserIdToInternalUsernameFormat(externalInviteeId);\n\n\t\treturn new FederationCreateDMAndInviteUserDto({\n\t\t\tinternalInviterId,\n\t\t\tinternalRoomId,\n\t\t\trawInviteeId: externalInviteeId,\n\t\t\tnormalizedInviteeId,\n\t\t\tinviteeUsernameOnly,\n\t\t});\n\t}\n\n\tpublic static toSendExternalMessageDto(\n\t\tinternalSenderId: string,\n\t\tinternalRoomId: string,\n\t\tmessage: IMessage,\n\t): FederationRoomSendExternalMessageDto {\n\t\treturn new FederationRoomSendExternalMessageDto({\n\t\t\tinternalRoomId,\n\t\t\tinternalSenderId,\n\t\t\tmessage,\n\t\t\tisThreadedMessage: Boolean(message.tmid),\n\t\t});\n\t}\n\n\tpublic static toAfterUserLeaveRoom(internalUserId: string, internalRoomId: string): FederationAfterLeaveRoomDto {\n\t\treturn new FederationAfterLeaveRoomDto({\n\t\t\tinternalRoomId,\n\t\t\tinternalUserId,\n\t\t});\n\t}\n\n\tpublic static toOnUserRemovedFromRoom(\n\t\tinternalUserId: string,\n\t\tinternalRoomId: string,\n\t\tactionDoneByInternalId: string,\n\t): FederationAfterRemoveUserFromRoomDto {\n\t\treturn new FederationAfterRemoveUserFromRoomDto({\n\t\t\tinternalRoomId,\n\t\t\tinternalUserId,\n\t\t\tactionDoneByInternalId,\n\t\t});\n\t}\n}\n"],"names":["FederationRoomSenderConverter","toCreateDirectMessageRoomDto","internalInviterId","internalRoomId","externalInviteeId","normalizedInviteeId","removeExternalSpecificCharsFromExternalIdentifier","inviteeUsernameOnly","formatExternalUserIdToInternalUsernameFormat","FederationCreateDMAndInviteUserDto","rawInviteeId","toSendExternalMessageDto","internalSenderId","message","FederationRoomSendExternalMessageDto","isThreadedMessage","Boolean","tmid","toAfterUserLeaveRoom","internalUserId","FederationAfterLeaveRoomDto","toOnUserRemovedFromRoom","actionDoneByInternalId","FederationAfterRemoveUserFromRoomDto"],"mappings":";;;;+BAaaA;;;eAAAA;;;+BANN;8BAIA;AAEA,IAAA,AAAMA,gCAAN,MAAMA;IACZ,OAAcC,6BACbC,iBAAyB,EACzBC,cAAsB,EACtBC,iBAAyB,EACY;QACrC,MAAMC,sBAAsBC,IAAAA,+DAAiD,EAACF;QAC9E,MAAMG,sBAAsBC,IAAAA,0DAA4C,EAACJ;QAEzE,OAAO,IAAIK,iDAAkC,CAAC;YAC7CP;YACAC;YACAO,cAAcN;YACdC;YACAE;QACD;IACD;IAEA,OAAcI,yBACbC,gBAAwB,EACxBT,cAAsB,EACtBU,OAAiB,EACsB;QACvC,OAAO,IAAIC,mDAAoC,CAAC;YAC/CX;YACAS;YACAC;YACAE,mBAAmBC,QAAQH,QAAQI,IAAI;QACxC;IACD;IAEA,OAAcC,qBAAqBC,cAAsB,EAAEhB,cAAsB,EAA+B;QAC/G,OAAO,IAAIiB,0CAA2B,CAAC;YACtCjB;YACAgB;QACD;IACD;IAEA,OAAcE,wBACbF,cAAsB,EACtBhB,cAAsB,EACtBmB,sBAA8B,EACS;QACvC,OAAO,IAAIC,mDAAoC,CAAC;YAC/CpB;YACAgB;YACAG;QACD;IACD;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/converters/RoomSender.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ce0f3e59472476c8854967c6293b911fb1beb75f","contentHash":"cd92074542a7db19f13567a5c395e1061151fbd5c35d9b4d5ab6c1a0af700798"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks/afterLeaveRoomCallback.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks/afterLeaveRoomCallback.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":38}},"3":{"start":{"line":11,"column":23},"end":{"line":11,"column":49}},"4":{"start":{"line":12,"column":31},"end":{"line":12,"column":80}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7}},"branchMap":{},"s":{"0":1,"1":1,"2":6,"3":1,"4":1},"f":{"0":6},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks/afterLeaveRoomCallback.ts"],"sourcesContent":["import type { IUser, IRoom } from '@rocket.chat/core-typings';\n\nimport { Callbacks } from './callbacksBase';\n\nexport const afterLeaveRoomCallback = Callbacks.create<(user: IUser, room: IRoom) => void>('afterLeaveRoom');\n"],"names":["afterLeaveRoomCallback","Callbacks","create"],"mappings":";;;;+BAIaA;;;eAAAA;;;+BAFa;AAEnB,MAAMA,yBAAyBC,wBAAS,CAACC,MAAM,CAAqC","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks/afterLeaveRoomCallback.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"83ff1d7b6fa90f9e63112cb5c07aa505d90bb3ae","contentHash":"a17305047002a8938c21602da68151dcafe31ee18a8ed1a2a619c6e32015bb90"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks/afterRemoveFromRoomCallback.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks/afterRemoveFromRoomCallback.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":43}},"3":{"start":{"line":11,"column":23},"end":{"line":11,"column":49}},"4":{"start":{"line":12,"column":36},"end":{"line":12,"column":90}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7}},"branchMap":{},"s":{"0":1,"1":1,"2":8,"3":1,"4":1},"f":{"0":8},"b":{},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks/afterRemoveFromRoomCallback.ts"],"sourcesContent":["import type { IRoom, IUser } from '@rocket.chat/core-typings';\n\nimport { Callbacks } from './callbacksBase';\n\nexport const afterRemoveFromRoomCallback =\n\tCallbacks.create<(data: { removedUser: IUser; userWhoRemoved: IUser }, room: IRoom) => void>('afterRemoveFromRoom');\n"],"names":["afterRemoveFromRoomCallback","Callbacks","create"],"mappings":";;;;+BAIaA;;;eAAAA;;;+BAFa;AAEnB,MAAMA,8BACZC,wBAAS,CAACC,MAAM,CAA6E","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/callbacks/afterRemoveFromRoomCallback.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"a1a0d958bd55f69fd9fed8ec355a1fafb7c93d3c","contentHash":"ec2289320c0b5f9b3c704cbdc8a8f0c1b2c38496bbd3a6d874886ba4021c4801"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/hooks/index.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/hooks/index.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":31}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":19},"end":{"line":12,"column":61}},"5":{"start":{"line":13,"column":32},"end":{"line":13,"column":97}},"6":{"start":{"line":14,"column":37},"end":{"line":14,"column":107}},"7":{"start":{"line":15,"column":15},"end":{"line":15,"column":40}},"8":{"start":{"line":16,"column":22},"end":{"line":178,"column":1}},"9":{"start":{"line":18,"column":8},"end":{"line":24,"column":81}},"10":{"start":{"line":19,"column":12},"end":{"line":21,"column":13}},"11":{"start":{"line":20,"column":16},"end":{"line":20,"column":23}},"12":{"start":{"line":22,"column":12},"end":{"line":22,"column":64}},"13":{"start":{"line":23,"column":12},"end":{"line":23,"column":39}},"14":{"start":{"line":27,"column":8},"end":{"line":33,"column":87}},"15":{"start":{"line":28,"column":12},"end":{"line":30,"column":13}},"16":{"start":{"line":29,"column":16},"end":{"line":29,"column":23}},"17":{"start":{"line":31,"column":12},"end":{"line":31,"column":64}},"18":{"start":{"line":32,"column":12},"end":{"line":32,"column":76}},"19":{"start":{"line":36,"column":8},"end":{"line":41,"column":109}},"20":{"start":{"line":37,"column":12},"end":{"line":39,"column":13}},"21":{"start":{"line":38,"column":16},"end":{"line":38,"column":23}},"22":{"start":{"line":40,"column":12},"end":{"line":40,"column":46}},"23":{"start":{"line":44,"column":8},"end":{"line":49,"column":105}},"24":{"start":{"line":45,"column":12},"end":{"line":47,"column":13}},"25":{"start":{"line":46,"column":16},"end":{"line":46,"column":23}},"26":{"start":{"line":48,"column":12},"end":{"line":48,"column":62}},"27":{"start":{"line":52,"column":8},"end":{"line":58,"column":101}},"28":{"start":{"line":53,"column":12},"end":{"line":55,"column":13}},"29":{"start":{"line":54,"column":16},"end":{"line":54,"column":23}},"30":{"start":{"line":56,"column":12},"end":{"line":56,"column":64}},"31":{"start":{"line":57,"column":12},"end":{"line":57,"column":36}},"32":{"start":{"line":61,"column":8},"end":{"line":67,"column":86}},"33":{"start":{"line":62,"column":12},"end":{"line":64,"column":13}},"34":{"start":{"line":63,"column":16},"end":{"line":63,"column":23}},"35":{"start":{"line":65,"column":12},"end":{"line":65,"column":64}},"36":{"start":{"line":66,"column":12},"end":{"line":66,"column":66}},"37":{"start":{"line":70,"column":8},"end":{"line":76,"column":88}},"38":{"start":{"line":71,"column":12},"end":{"line":73,"column":13}},"39":{"start":{"line":72,"column":16},"end":{"line":72,"column":23}},"40":{"start":{"line":74,"column":12},"end":{"line":74,"column":64}},"41":{"start":{"line":75,"column":12},"end":{"line":75,"column":76}},"42":{"start":{"line":79,"column":8},"end":{"line":85,"column":91}},"43":{"start":{"line":80,"column":12},"end":{"line":82,"column":13}},"44":{"start":{"line":81,"column":16},"end":{"line":81,"column":23}},"45":{"start":{"line":83,"column":12},"end":{"line":83,"column":64}},"46":{"start":{"line":84,"column":12},"end":{"line":84,"column":46}},"47":{"start":{"line":88,"column":8},"end":{"line":98,"column":91}},"48":{"start":{"line":89,"column":12},"end":{"line":91,"column":13}},"49":{"start":{"line":90,"column":16},"end":{"line":90,"column":31}},"50":{"start":{"line":92,"column":12},"end":{"line":92,"column":64}},"51":{"start":{"line":93,"column":12},"end":{"line":95,"column":13}},"52":{"start":{"line":94,"column":16},"end":{"line":94,"column":31}},"53":{"start":{"line":96,"column":12},"end":{"line":96,"column":68}},"54":{"start":{"line":97,"column":12},"end":{"line":97,"column":27}},"55":{"start":{"line":101,"column":8},"end":{"line":112,"column":88}},"56":{"start":{"line":103,"column":12},"end":{"line":105,"column":13}},"57":{"start":{"line":104,"column":16},"end":{"line":104,"column":31}},"58":{"start":{"line":106,"column":12},"end":{"line":106,"column":64}},"59":{"start":{"line":107,"column":12},"end":{"line":109,"column":13}},"60":{"start":{"line":108,"column":16},"end":{"line":108,"column":31}},"61":{"start":{"line":110,"column":12},"end":{"line":110,"column":132}},"62":{"start":{"line":111,"column":12},"end":{"line":111,"column":27}},"63":{"start":{"line":115,"column":8},"end":{"line":117,"column":9}},"64":{"start":{"line":116,"column":12},"end":{"line":116,"column":19}},"65":{"start":{"line":118,"column":8},"end":{"line":120,"column":9}},"66":{"start":{"line":119,"column":12},"end":{"line":119,"column":19}},"67":{"start":{"line":121,"column":8},"end":{"line":121,"column":48}},"68":{"start":{"line":122,"column":149},"end":{"line":122,"column":153}},"69":{"start":{"line":123,"column":39},"end":{"line":126,"column":9}},"70":{"start":{"line":127,"column":8},"end":{"line":129,"column":9}},"71":{"start":{"line":128,"column":12},"end":{"line":128,"column":19}},"72":{"start":{"line":130,"column":25},"end":{"line":135,"column":9}},"73":{"start":{"line":131,"column":83},"end":{"line":131,"column":175}},"74":{"start":{"line":132,"column":85},"end":{"line":132,"column":179}},"75":{"start":{"line":133,"column":87},"end":{"line":133,"column":183}},"76":{"start":{"line":134,"column":89},"end":{"line":134,"column":187}},"77":{"start":{"line":136,"column":8},"end":{"line":138,"column":9}},"78":{"start":{"line":137,"column":12},"end":{"line":137,"column":19}},"79":{"start":{"line":139,"column":8},"end":{"line":139,"column":98}},"80":{"start":{"line":142,"column":8},"end":{"line":148,"column":88}},"81":{"start":{"line":143,"column":12},"end":{"line":145,"column":13}},"82":{"start":{"line":144,"column":16},"end":{"line":144,"column":23}},"83":{"start":{"line":146,"column":12},"end":{"line":146,"column":64}},"84":{"start":{"line":147,"column":12},"end":{"line":147,"column":52}},"85":{"start":{"line":151,"column":8},"end":{"line":157,"column":89}},"86":{"start":{"line":152,"column":12},"end":{"line":154,"column":13}},"87":{"start":{"line":153,"column":16},"end":{"line":153,"column":23}},"88":{"start":{"line":155,"column":12},"end":{"line":155,"column":64}},"89":{"start":{"line":156,"column":12},"end":{"line":156,"column":53}},"90":{"start":{"line":160,"column":8},"end":{"line":160,"column":129}},"91":{"start":{"line":161,"column":8},"end":{"line":161,"column":130}},"92":{"start":{"line":164,"column":8},"end":{"line":164,"column":96}},"93":{"start":{"line":165,"column":8},"end":{"line":165,"column":112}},"94":{"start":{"line":166,"column":8},"end":{"line":166,"column":133}},"95":{"start":{"line":167,"column":8},"end":{"line":167,"column":129}},"96":{"start":{"line":168,"column":8},"end":{"line":168,"column":130}},"97":{"start":{"line":169,"column":8},"end":{"line":169,"column":95}},"98":{"start":{"line":170,"column":8},"end":{"line":170,"column":99}},"99":{"start":{"line":171,"column":8},"end":{"line":171,"column":102}},"100":{"start":{"line":172,"column":8},"end":{"line":172,"column":100}},"101":{"start":{"line":173,"column":8},"end":{"line":173,"column":97}},"102":{"start":{"line":174,"column":8},"end":{"line":174,"column":97}},"103":{"start":{"line":175,"column":8},"end":{"line":175,"column":100}},"104":{"start":{"line":176,"column":8},"end":{"line":176,"column":102}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":17,"column":4},"end":{"line":17,"column":5}},"loc":{"start":{"line":17,"column":40},"end":{"line":25,"column":5}},"line":17},"2":{"name":"(anonymous_2)","decl":{"start":{"line":18,"column":59},"end":{"line":18,"column":60}},"loc":{"start":{"line":18,"column":79},"end":{"line":24,"column":9}},"line":18},"3":{"name":"(anonymous_3)","decl":{"start":{"line":26,"column":4},"end":{"line":26,"column":5}},"loc":{"start":{"line":26,"column":43},"end":{"line":34,"column":5}},"line":26},"4":{"name":"(anonymous_4)","decl":{"start":{"line":27,"column":69},"end":{"line":27,"column":70}},"loc":{"start":{"line":27,"column":91},"end":{"line":33,"column":9}},"line":27},"5":{"name":"(anonymous_5)","decl":{"start":{"line":35,"column":4},"end":{"line":35,"column":5}},"loc":{"start":{"line":35,"column":59},"end":{"line":42,"column":5}},"line":35},"6":{"name":"(anonymous_6)","decl":{"start":{"line":36,"column":68},"end":{"line":36,"column":69}},"loc":{"start":{"line":36,"column":90},"end":{"line":41,"column":9}},"line":36},"7":{"name":"(anonymous_7)","decl":{"start":{"line":43,"column":4},"end":{"line":43,"column":5}},"loc":{"start":{"line":43,"column":56},"end":{"line":50,"column":5}},"line":43},"8":{"name":"(anonymous_8)","decl":{"start":{"line":44,"column":68},"end":{"line":44,"column":69}},"loc":{"start":{"line":44,"column":90},"end":{"line":49,"column":9}},"line":44},"9":{"name":"(anonymous_9)","decl":{"start":{"line":51,"column":4},"end":{"line":51,"column":5}},"loc":{"start":{"line":51,"column":50},"end":{"line":59,"column":5}},"line":51},"10":{"name":"(anonymous_10)","decl":{"start":{"line":52,"column":73},"end":{"line":52,"column":74}},"loc":{"start":{"line":52,"column":90},"end":{"line":58,"column":9}},"line":52},"11":{"name":"(anonymous_11)","decl":{"start":{"line":60,"column":4},"end":{"line":60,"column":5}},"loc":{"start":{"line":60,"column":41},"end":{"line":68,"column":5}},"line":60},"12":{"name":"(anonymous_12)","decl":{"start":{"line":61,"column":53},"end":{"line":61,"column":54}},"loc":{"start":{"line":61,"column":78},"end":{"line":67,"column":9}},"line":61},"13":{"name":"(anonymous_13)","decl":{"start":{"line":69,"column":4},"end":{"line":69,"column":5}},"loc":{"start":{"line":69,"column":43},"end":{"line":77,"column":5}},"line":69},"14":{"name":"(anonymous_14)","decl":{"start":{"line":70,"column":55},"end":{"line":70,"column":56}},"loc":{"start":{"line":70,"column":80},"end":{"line":76,"column":9}},"line":70},"15":{"name":"(anonymous_15)","decl":{"start":{"line":78,"column":4},"end":{"line":78,"column":5}},"loc":{"start":{"line":78,"column":41},"end":{"line":86,"column":5}},"line":78},"16":{"name":"(anonymous_16)","decl":{"start":{"line":79,"column":55},"end":{"line":79,"column":56}},"loc":{"start":{"line":79,"column":78},"end":{"line":85,"column":9}},"line":79},"17":{"name":"(anonymous_17)","decl":{"start":{"line":87,"column":4},"end":{"line":87,"column":5}},"loc":{"start":{"line":87,"column":41},"end":{"line":99,"column":5}},"line":87},"18":{"name":"(anonymous_18)","decl":{"start":{"line":88,"column":53},"end":{"line":88,"column":54}},"loc":{"start":{"line":88,"column":80},"end":{"line":98,"column":9}},"line":88},"19":{"name":"(anonymous_19)","decl":{"start":{"line":100,"column":4},"end":{"line":100,"column":5}},"loc":{"start":{"line":100,"column":38},"end":{"line":113,"column":5}},"line":100},"20":{"name":"(anonymous_20)","decl":{"start":{"line":101,"column":53},"end":{"line":101,"column":54}},"loc":{"start":{"line":101,"column":80},"end":{"line":112,"column":9}},"line":101},"21":{"name":"(anonymous_21)","decl":{"start":{"line":114,"column":4},"end":{"line":114,"column":5}},"loc":{"start":{"line":114,"column":67},"end":{"line":140,"column":5}},"line":114},"22":{"name":"(anonymous_22)","decl":{"start":{"line":131,"column":27},"end":{"line":131,"column":28}},"loc":{"start":{"line":131,"column":83},"end":{"line":131,"column":175}},"line":131},"23":{"name":"(anonymous_23)","decl":{"start":{"line":132,"column":29},"end":{"line":132,"column":30}},"loc":{"start":{"line":132,"column":85},"end":{"line":132,"column":179}},"line":132},"24":{"name":"(anonymous_24)","decl":{"start":{"line":133,"column":31},"end":{"line":133,"column":32}},"loc":{"start":{"line":133,"column":87},"end":{"line":133,"column":183}},"line":133},"25":{"name":"(anonymous_25)","decl":{"start":{"line":134,"column":33},"end":{"line":134,"column":34}},"loc":{"start":{"line":134,"column":89},"end":{"line":134,"column":187}},"line":134},"26":{"name":"(anonymous_26)","decl":{"start":{"line":141,"column":4},"end":{"line":141,"column":5}},"loc":{"start":{"line":141,"column":42},"end":{"line":149,"column":5}},"line":141},"27":{"name":"(anonymous_27)","decl":{"start":{"line":142,"column":56},"end":{"line":142,"column":57}},"loc":{"start":{"line":142,"column":72},"end":{"line":148,"column":9}},"line":142},"28":{"name":"(anonymous_28)","decl":{"start":{"line":150,"column":4},"end":{"line":150,"column":5}},"loc":{"start":{"line":150,"column":43},"end":{"line":158,"column":5}},"line":150},"29":{"name":"(anonymous_29)","decl":{"start":{"line":151,"column":57},"end":{"line":151,"column":58}},"loc":{"start":{"line":151,"column":73},"end":{"line":157,"column":9}},"line":151},"30":{"name":"(anonymous_30)","decl":{"start":{"line":159,"column":4},"end":{"line":159,"column":5}},"loc":{"start":{"line":159,"column":32},"end":{"line":162,"column":5}},"line":159},"31":{"name":"(anonymous_31)","decl":{"start":{"line":163,"column":4},"end":{"line":163,"column":5}},"loc":{"start":{"line":163,"column":32},"end":{"line":177,"column":5}},"line":163}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":12},"end":{"line":21,"column":13}},"type":"if","locations":[{"start":{"line":19,"column":12},"end":{"line":21,"column":13}},{"start":{"line":19,"column":12},"end":{"line":21,"column":13}}],"line":19},"1":{"loc":{"start":{"line":19,"column":16},"end":{"line":19,"column":74}},"type":"binary-expr","locations":[{"start":{"line":19,"column":16},"end":{"line":19,"column":21}},{"start":{"line":19,"column":25},"end":{"line":19,"column":65}},{"start":{"line":19,"column":69},"end":{"line":19,"column":74}}],"line":19},"2":{"loc":{"start":{"line":28,"column":12},"end":{"line":30,"column":13}},"type":"if","locations":[{"start":{"line":28,"column":12},"end":{"line":30,"column":13}},{"start":{"line":28,"column":12},"end":{"line":30,"column":13}}],"line":28},"3":{"loc":{"start":{"line":28,"column":16},"end":{"line":28,"column":125}},"type":"binary-expr","locations":[{"start":{"line":28,"column":16},"end":{"line":28,"column":21}},{"start":{"line":28,"column":25},"end":{"line":28,"column":65}},{"start":{"line":28,"column":69},"end":{"line":28,"column":76}},{"start":{"line":28,"column":80},"end":{"line":28,"column":99}},{"start":{"line":28,"column":103},"end":{"line":28,"column":125}}],"line":28},"4":{"loc":{"start":{"line":37,"column":12},"end":{"line":39,"column":13}},"type":"if","locations":[{"start":{"line":37,"column":12},"end":{"line":39,"column":13}},{"start":{"line":37,"column":12},"end":{"line":39,"column":13}}],"line":37},"5":{"loc":{"start":{"line":37,"column":16},"end":{"line":37,"column":125}},"type":"binary-expr","locations":[{"start":{"line":37,"column":16},"end":{"line":37,"column":78}},{"start":{"line":37,"column":82},"end":{"line":37,"column":87}},{"start":{"line":37,"column":91},"end":{"line":37,"column":125}}],"line":37},"6":{"loc":{"start":{"line":37,"column":18},"end":{"line":37,"column":77}},"type":"cond-expr","locations":[{"start":{"line":37,"column":57},"end":{"line":37,"column":63}},{"start":{"line":37,"column":66},"end":{"line":37,"column":77}}],"line":37},"7":{"loc":{"start":{"line":37,"column":18},"end":{"line":37,"column":54}},"type":"binary-expr","locations":[{"start":{"line":37,"column":18},"end":{"line":37,"column":33}},{"start":{"line":37,"column":37},"end":{"line":37,"column":54}}],"line":37},"8":{"loc":{"start":{"line":45,"column":12},"end":{"line":47,"column":13}},"type":"if","locations":[{"start":{"line":45,"column":12},"end":{"line":47,"column":13}},{"start":{"line":45,"column":12},"end":{"line":47,"column":13}}],"line":45},"9":{"loc":{"start":{"line":45,"column":16},"end":{"line":45,"column":144}},"type":"binary-expr","locations":[{"start":{"line":45,"column":16},"end":{"line":45,"column":78}},{"start":{"line":45,"column":82},"end":{"line":45,"column":97}},{"start":{"line":45,"column":101},"end":{"line":45,"column":106}},{"start":{"line":45,"column":110},"end":{"line":45,"column":144}}],"line":45},"10":{"loc":{"start":{"line":45,"column":18},"end":{"line":45,"column":77}},"type":"cond-expr","locations":[{"start":{"line":45,"column":57},"end":{"line":45,"column":63}},{"start":{"line":45,"column":66},"end":{"line":45,"column":77}}],"line":45},"11":{"loc":{"start":{"line":45,"column":18},"end":{"line":45,"column":54}},"type":"binary-expr","locations":[{"start":{"line":45,"column":18},"end":{"line":45,"column":33}},{"start":{"line":45,"column":37},"end":{"line":45,"column":54}}],"line":45},"12":{"loc":{"start":{"line":53,"column":12},"end":{"line":55,"column":13}},"type":"if","locations":[{"start":{"line":53,"column":12},"end":{"line":55,"column":13}},{"start":{"line":53,"column":12},"end":{"line":55,"column":13}}],"line":53},"13":{"loc":{"start":{"line":62,"column":12},"end":{"line":64,"column":13}},"type":"if","locations":[{"start":{"line":62,"column":12},"end":{"line":64,"column":13}},{"start":{"line":62,"column":12},"end":{"line":64,"column":13}}],"line":62},"14":{"loc":{"start":{"line":62,"column":16},"end":{"line":62,"column":132}},"type":"binary-expr","locations":[{"start":{"line":62,"column":16},"end":{"line":62,"column":24}},{"start":{"line":62,"column":28},"end":{"line":62,"column":85}},{"start":{"line":62,"column":89},"end":{"line":62,"column":96}},{"start":{"line":62,"column":100},"end":{"line":62,"column":112}},{"start":{"line":62,"column":116},"end":{"line":62,"column":132}}],"line":62},"15":{"loc":{"start":{"line":71,"column":12},"end":{"line":73,"column":13}},"type":"if","locations":[{"start":{"line":71,"column":12},"end":{"line":73,"column":13}},{"start":{"line":71,"column":12},"end":{"line":73,"column":13}}],"line":71},"16":{"loc":{"start":{"line":71,"column":16},"end":{"line":71,"column":154}},"type":"binary-expr","locations":[{"start":{"line":71,"column":16},"end":{"line":71,"column":24}},{"start":{"line":71,"column":28},"end":{"line":71,"column":85}},{"start":{"line":71,"column":89},"end":{"line":71,"column":96}},{"start":{"line":71,"column":100},"end":{"line":71,"column":112}},{"start":{"line":71,"column":116},"end":{"line":71,"column":132}},{"start":{"line":71,"column":136},"end":{"line":71,"column":154}}],"line":71},"17":{"loc":{"start":{"line":80,"column":12},"end":{"line":82,"column":13}},"type":"if","locations":[{"start":{"line":80,"column":12},"end":{"line":82,"column":13}},{"start":{"line":80,"column":12},"end":{"line":82,"column":13}}],"line":80},"18":{"loc":{"start":{"line":80,"column":16},"end":{"line":80,"column":138}},"type":"binary-expr","locations":[{"start":{"line":80,"column":16},"end":{"line":80,"column":21}},{"start":{"line":80,"column":25},"end":{"line":80,"column":33}},{"start":{"line":80,"column":37},"end":{"line":80,"column":77}},{"start":{"line":80,"column":81},"end":{"line":80,"column":138}}],"line":80},"19":{"loc":{"start":{"line":89,"column":12},"end":{"line":91,"column":13}},"type":"if","locations":[{"start":{"line":89,"column":12},"end":{"line":91,"column":13}},{"start":{"line":89,"column":12},"end":{"line":91,"column":13}}],"line":89},"20":{"loc":{"start":{"line":89,"column":16},"end":{"line":89,"column":138}},"type":"binary-expr","locations":[{"start":{"line":89,"column":16},"end":{"line":89,"column":21}},{"start":{"line":89,"column":25},"end":{"line":89,"column":65}},{"start":{"line":89,"column":69},"end":{"line":89,"column":77}},{"start":{"line":89,"column":81},"end":{"line":89,"column":138}}],"line":89},"21":{"loc":{"start":{"line":93,"column":12},"end":{"line":95,"column":13}},"type":"if","locations":[{"start":{"line":93,"column":12},"end":{"line":95,"column":13}},{"start":{"line":93,"column":12},"end":{"line":95,"column":13}}],"line":93},"22":{"loc":{"start":{"line":103,"column":12},"end":{"line":105,"column":13}},"type":"if","locations":[{"start":{"line":103,"column":12},"end":{"line":105,"column":13}},{"start":{"line":103,"column":12},"end":{"line":105,"column":13}}],"line":103},"23":{"loc":{"start":{"line":103,"column":16},"end":{"line":103,"column":77}},"type":"binary-expr","locations":[{"start":{"line":103,"column":16},"end":{"line":103,"column":21}},{"start":{"line":103,"column":25},"end":{"line":103,"column":65}},{"start":{"line":103,"column":69},"end":{"line":103,"column":77}}],"line":103},"24":{"loc":{"start":{"line":107,"column":12},"end":{"line":109,"column":13}},"type":"if","locations":[{"start":{"line":107,"column":12},"end":{"line":109,"column":13}},{"start":{"line":107,"column":12},"end":{"line":109,"column":13}}],"line":107},"25":{"loc":{"start":{"line":110,"column":46},"end":{"line":110,"column":130}},"type":"cond-expr","locations":[{"start":{"line":110,"column":107},"end":{"line":110,"column":113}},{"start":{"line":110,"column":116},"end":{"line":110,"column":130}}],"line":110},"26":{"loc":{"start":{"line":110,"column":46},"end":{"line":110,"column":104}},"type":"binary-expr","locations":[{"start":{"line":110,"column":46},"end":{"line":110,"column":79}},{"start":{"line":110,"column":83},"end":{"line":110,"column":104}}],"line":110},"27":{"loc":{"start":{"line":115,"column":8},"end":{"line":117,"column":9}},"type":"if","locations":[{"start":{"line":115,"column":8},"end":{"line":117,"column":9}},{"start":{"line":115,"column":8},"end":{"line":117,"column":9}}],"line":115},"28":{"loc":{"start":{"line":118,"column":8},"end":{"line":120,"column":9}},"type":"if","locations":[{"start":{"line":118,"column":8},"end":{"line":120,"column":9}},{"start":{"line":118,"column":8},"end":{"line":120,"column":9}}],"line":118},"29":{"loc":{"start":{"line":122,"column":67},"end":{"line":122,"column":113}},"type":"default-arg","locations":[{"start":{"line":122,"column":111},"end":{"line":122,"column":113}}],"line":122},"30":{"loc":{"start":{"line":122,"column":74},"end":{"line":122,"column":106}},"type":"default-arg","locations":[{"start":{"line":122,"column":97},"end":{"line":122,"column":106}}],"line":122},"31":{"loc":{"start":{"line":127,"column":8},"end":{"line":129,"column":9}},"type":"if","locations":[{"start":{"line":127,"column":8},"end":{"line":129,"column":9}},{"start":{"line":127,"column":8},"end":{"line":129,"column":9}}],"line":127},"32":{"loc":{"start":{"line":136,"column":8},"end":{"line":138,"column":9}},"type":"if","locations":[{"start":{"line":136,"column":8},"end":{"line":138,"column":9}},{"start":{"line":136,"column":8},"end":{"line":138,"column":9}}],"line":136},"33":{"loc":{"start":{"line":143,"column":12},"end":{"line":145,"column":13}},"type":"if","locations":[{"start":{"line":143,"column":12},"end":{"line":145,"column":13}},{"start":{"line":143,"column":12},"end":{"line":145,"column":13}}],"line":143},"34":{"loc":{"start":{"line":143,"column":16},"end":{"line":143,"column":93}},"type":"binary-expr","locations":[{"start":{"line":143,"column":16},"end":{"line":143,"column":77}},{"start":{"line":143,"column":81},"end":{"line":143,"column":93}}],"line":143},"35":{"loc":{"start":{"line":143,"column":18},"end":{"line":143,"column":76}},"type":"cond-expr","locations":[{"start":{"line":143,"column":57},"end":{"line":143,"column":63}},{"start":{"line":143,"column":66},"end":{"line":143,"column":76}}],"line":143},"36":{"loc":{"start":{"line":143,"column":18},"end":{"line":143,"column":54}},"type":"binary-expr","locations":[{"start":{"line":143,"column":18},"end":{"line":143,"column":33}},{"start":{"line":143,"column":37},"end":{"line":143,"column":54}}],"line":143},"37":{"loc":{"start":{"line":152,"column":12},"end":{"line":154,"column":13}},"type":"if","locations":[{"start":{"line":152,"column":12},"end":{"line":154,"column":13}},{"start":{"line":152,"column":12},"end":{"line":154,"column":13}}],"line":152},"38":{"loc":{"start":{"line":152,"column":16},"end":{"line":152,"column":94}},"type":"binary-expr","locations":[{"start":{"line":152,"column":16},"end":{"line":152,"column":77}},{"start":{"line":152,"column":81},"end":{"line":152,"column":94}}],"line":152},"39":{"loc":{"start":{"line":152,"column":18},"end":{"line":152,"column":76}},"type":"cond-expr","locations":[{"start":{"line":152,"column":57},"end":{"line":152,"column":63}},{"start":{"line":152,"column":66},"end":{"line":152,"column":76}}],"line":152},"40":{"loc":{"start":{"line":152,"column":18},"end":{"line":152,"column":54}},"type":"binary-expr","locations":[{"start":{"line":152,"column":18},"end":{"line":152,"column":33}},{"start":{"line":152,"column":37},"end":{"line":152,"column":54}}],"line":152}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":5,"10":5,"11":3,"12":2,"13":1,"14":7,"15":7,"16":5,"17":2,"18":1,"19":4,"20":4,"21":3,"22":1,"23":6,"24":6,"25":5,"26":1,"27":3,"28":3,"29":1,"30":2,"31":1,"32":7,"33":7,"34":5,"35":2,"36":1,"37":8,"38":8,"39":6,"40":2,"41":1,"42":5,"43":5,"44":3,"45":2,"46":1,"47":6,"48":5,"49":4,"50":1,"51":1,"52":0,"53":1,"54":1,"55":5,"56":4,"57":3,"58":1,"59":1,"60":0,"61":1,"62":1,"63":8,"64":2,"65":6,"66":0,"67":6,"68":6,"69":6,"70":6,"71":1,"72":5,"73":1,"74":1,"75":1,"76":1,"77":5,"78":1,"79":4,"80":5,"81":5,"82":3,"83":2,"84":1,"85":5,"86":5,"87":3,"88":2,"89":1,"90":1,"91":1,"92":77,"93":77,"94":77,"95":77,"96":77,"97":77,"98":77,"99":77,"100":77,"101":77,"102":77,"103":77,"104":77},"f":{"0":1,"1":5,"2":5,"3":7,"4":7,"5":4,"6":4,"7":6,"8":6,"9":3,"10":3,"11":7,"12":7,"13":8,"14":8,"15":5,"16":5,"17":6,"18":5,"19":5,"20":4,"21":8,"22":1,"23":1,"24":1,"25":1,"26":5,"27":5,"28":5,"29":5,"30":1,"31":77},"b":{"0":[3,2],"1":[5,4,3],"2":[5,2],"3":[7,6,5,5,3],"4":[3,1],"5":[4,1,1],"6":[1,3],"7":[4,4],"8":[5,1],"9":[6,3,2,2],"10":[1,5],"11":[6,6],"12":[1,2],"13":[5,2],"14":[7,6,5,5,3],"15":[6,2],"16":[8,7,6,6,4,3],"17":[3,2],"18":[5,4,4,3],"19":[4,1],"20":[5,1,1,1],"21":[0,1],"22":[3,1],"23":[4,1,1],"24":[0,1],"25":[0,1],"26":[1,1],"27":[2,6],"28":[0,6],"29":[2],"30":[2],"31":[1,5],"32":[1,4],"33":[3,2],"34":[5,3],"35":[1,4],"36":[5,5],"37":[3,2],"38":[5,3],"39":[1,4],"40":[5,5]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/hooks/index.ts"],"sourcesContent":["import type { IMessage, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isMessageFromMatrixFederation, isRoomFederated, isEditedMessage } from '@rocket.chat/core-typings';\n\nimport { callbacks } from '../../../../../../lib/callbacks';\nimport { afterLeaveRoomCallback } from '../../../../../../lib/callbacks/afterLeaveRoomCallback';\nimport { afterRemoveFromRoomCallback } from '../../../../../../lib/callbacks/afterRemoveFromRoomCallback';\nimport type { FederationRoomServiceSender } from '../../../application/room/sender/RoomServiceSender';\nimport { isFederationEnabled, throwIfFederationNotEnabledOrNotReady, throwIfFederationNotReady } from '../../../utils';\n\nexport class FederationHooks {\n\tpublic static afterUserLeaveRoom(callback: (user: IUser, room: IRoom) => Promise<void>): void {\n\t\tafterLeaveRoomCallback.add(\n\t\t\tasync (user: IUser, room?: IRoom): Promise<void> => {\n\t\t\t\tif (!room || !isRoomFederated(room) || !user) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\n\t\t\t\tawait callback(user, room);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-after-leave-room',\n\t\t);\n\t}\n\n\tpublic static onUserRemovedFromRoom(callback: (removedUser: IUser, room: IRoom, userWhoRemoved: IUser) => Promise<void>): void {\n\t\tafterRemoveFromRoomCallback.add(\n\t\t\tasync (params, room): Promise<void> => {\n\t\t\t\tif (!room || !isRoomFederated(room) || !params || !params.removedUser || !params.userWhoRemoved) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\n\t\t\t\tawait callback(params.removedUser, room, params.userWhoRemoved);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-after-remove-from-room',\n\t\t);\n\t}\n\n\tpublic static canAddFederatedUserToNonFederatedRoom(callback: (user: IUser | string, room: IRoom) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'federation.beforeAddUserToARoom',\n\t\t\tasync (params: { user: IUser | string; inviter?: IUser }, room: IRoom): Promise<void> => {\n\t\t\t\tif (!params?.user || !room || !isFederationEnabled()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tawait callback(params.user, room);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-can-add-federated-user-to-non-federated-room',\n\t\t);\n\t}\n\n\tpublic static canAddFederatedUserToFederatedRoom(callback: (user: IUser | string, inviter: IUser, room: IRoom) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'federation.beforeAddUserToARoom',\n\t\t\tasync (params: { user: IUser | string; inviter: IUser }, room: IRoom): Promise<void> => {\n\t\t\t\tif (!params?.user || !params.inviter || !room || !isFederationEnabled()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tawait callback(params.user, params.inviter, room);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-can-add-federated-user-to-federated-room',\n\t\t);\n\t}\n\n\tpublic static canCreateDirectMessageFromUI(callback: (members: IUser[]) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'federation.beforeCreateDirectMessage',\n\t\t\tasync (members: IUser[]): Promise<void> => {\n\t\t\t\tif (!members) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\n\t\t\t\tawait callback(members);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-can-create-direct-message-from-ui-ce',\n\t\t);\n\t}\n\n\tpublic static afterMessageReacted(callback: (message: IMessage, user: IUser, reaction: string) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'afterSetReaction',\n\t\t\tasync (message: IMessage, params: { user: IUser; reaction: string }): Promise<void> => {\n\t\t\t\tif (!message || !isMessageFromMatrixFederation(message) || !params || !params.user || !params.reaction) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\n\t\t\t\tawait callback(message, params.user, params.reaction);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-after-message-reacted',\n\t\t);\n\t}\n\n\tpublic static afterMessageunReacted(callback: (message: IMessage, user: IUser, reaction: string) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'afterUnsetReaction',\n\t\t\tasync (message: IMessage, params: { user: IUser; reaction: string; oldMessage: IMessage }): Promise<void> => {\n\t\t\t\tif (!message || !isMessageFromMatrixFederation(message) || !params || !params.user || !params.reaction || !params.oldMessage) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\n\t\t\t\tawait callback(params.oldMessage, params.user, params.reaction);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-after-message-unreacted',\n\t\t);\n\t}\n\n\tpublic static afterMessageDeleted(callback: (message: IMessage, roomId: IRoom['_id']) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'afterDeleteMessage',\n\t\t\tasync (message: IMessage, room: IRoom): Promise<void> => {\n\t\t\t\tif (!room || !message || !isRoomFederated(room) || !isMessageFromMatrixFederation(message)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\n\t\t\t\tawait callback(message, room._id);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-after-room-message-deleted',\n\t\t);\n\t}\n\n\tpublic static afterMessageUpdated(callback: (message: IMessage, roomId: IRoom['_id'], userId: string) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'afterSaveMessage',\n\t\t\tasync (message: IMessage, { room }): Promise<IMessage> => {\n\t\t\t\tif (!room || !isRoomFederated(room) || !message || !isMessageFromMatrixFederation(message)) {\n\t\t\t\t\treturn message;\n\t\t\t\t}\n\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\n\t\t\t\tif (!isEditedMessage(message)) {\n\t\t\t\t\treturn message;\n\t\t\t\t}\n\t\t\t\tawait callback(message, room._id, message.editedBy._id);\n\t\t\t\treturn message;\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-after-room-message-updated',\n\t\t);\n\t}\n\n\tpublic static afterMessageSent(callback: (message: IMessage, roomId: IRoom['_id'], userId: string) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'afterSaveMessage',\n\t\t\tasync (message: IMessage, { room }): Promise<IMessage> => {\n\t\t\t\tif (!room || !isRoomFederated(room) || !message) {\n\t\t\t\t\treturn message;\n\t\t\t\t}\n\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\n\t\t\t\tif (isEditedMessage(message)) {\n\t\t\t\t\treturn message;\n\t\t\t\t}\n\t\t\t\tawait callback(message, room._id, message.u?._id);\n\t\t\t\treturn message;\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-after-room-message-sent',\n\t\t);\n\t}\n\n\tpublic static async afterRoomRoleChanged(federationRoomService: FederationRoomServiceSender, data?: Record<string, any>) {\n\t\tif (!data) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!isFederationEnabled()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthrowIfFederationNotReady();\n\n\t\tconst {\n\t\t\t_id: role,\n\t\t\ttype: action,\n\t\t\tscope: internalRoomId,\n\t\t\tu: { _id: internalTargetUserId = undefined } = {},\n\t\t\tgivenByUserId: internalUserId,\n\t\t} = data;\n\t\tconst roleEventsInterestedIn = ['moderator', 'owner'];\n\t\tif (!roleEventsInterestedIn.includes(role)) {\n\t\t\treturn;\n\t\t}\n\t\tconst handlers: Record<string, (internalUserId: string, internalTargetUserId: string, internalRoomId: string) => Promise<void>> = {\n\t\t\t'owner-added': (internalUserId: string, internalTargetUserId: string, internalRoomId: string): Promise<void> =>\n\t\t\t\tfederationRoomService.onRoomOwnerAdded(internalUserId, internalTargetUserId, internalRoomId),\n\t\t\t'owner-removed': (internalUserId: string, internalTargetUserId: string, internalRoomId: string): Promise<void> =>\n\t\t\t\tfederationRoomService.onRoomOwnerRemoved(internalUserId, internalTargetUserId, internalRoomId),\n\t\t\t'moderator-added': (internalUserId: string, internalTargetUserId: string, internalRoomId: string): Promise<void> =>\n\t\t\t\tfederationRoomService.onRoomModeratorAdded(internalUserId, internalTargetUserId, internalRoomId),\n\t\t\t'moderator-removed': (internalUserId: string, internalTargetUserId: string, internalRoomId: string): Promise<void> =>\n\t\t\t\tfederationRoomService.onRoomModeratorRemoved(internalUserId, internalTargetUserId, internalRoomId),\n\t\t};\n\n\t\tif (!handlers[`${role}-${action}`]) {\n\t\t\treturn;\n\t\t}\n\t\tawait handlers[`${role}-${action}`](internalUserId, internalTargetUserId, internalRoomId);\n\t}\n\n\tpublic static afterRoomNameChanged(callback: (roomId: string, changedRoomName: string) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'afterRoomNameChange',\n\t\t\tasync (params: Record<string, any>): Promise<void> => {\n\t\t\t\tif (!params?.rid || !params.name) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\n\t\t\t\tawait callback(params.rid, params.name);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-after-room-name-changed',\n\t\t);\n\t}\n\n\tpublic static afterRoomTopicChanged(callback: (roomId: string, changedRoomTopic: string) => Promise<void>): void {\n\t\tcallbacks.add(\n\t\t\t'afterRoomTopicChange',\n\t\t\tasync (params: Record<string, any>): Promise<void> => {\n\t\t\t\tif (!params?.rid || !params.topic) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthrowIfFederationNotEnabledOrNotReady();\n\n\t\t\t\tawait callback(params.rid, params.topic);\n\t\t\t},\n\t\t\tcallbacks.priority.HIGH,\n\t\t\t'federation-v2-after-room-topic-changed',\n\t\t);\n\t}\n\n\tpublic static removeCEValidation(): void {\n\t\tcallbacks.remove('federation.beforeAddUserToARoom', 'federation-v2-can-add-federated-user-to-federated-room');\n\t\tcallbacks.remove('federation.beforeCreateDirectMessage', 'federation-v2-can-create-direct-message-from-ui-ce');\n\t}\n\n\tpublic static removeAllListeners(): void {\n\t\tafterLeaveRoomCallback.remove('federation-v2-after-leave-room');\n\t\tafterRemoveFromRoomCallback.remove('federation-v2-after-remove-from-room');\n\t\tcallbacks.remove('federation.beforeAddUserToARoom', 'federation-v2-can-add-federated-user-to-non-federated-room');\n\t\tcallbacks.remove('federation.beforeAddUserToARoom', 'federation-v2-can-add-federated-user-to-federated-room');\n\t\tcallbacks.remove('federation.beforeCreateDirectMessage', 'federation-v2-can-create-direct-message-from-ui-ce');\n\t\tcallbacks.remove('afterSetReaction', 'federation-v2-after-message-reacted');\n\t\tcallbacks.remove('afterUnsetReaction', 'federation-v2-after-message-unreacted');\n\t\tcallbacks.remove('afterDeleteMessage', 'federation-v2-after-room-message-deleted');\n\t\tcallbacks.remove('afterSaveMessage', 'federation-v2-after-room-message-updated');\n\t\tcallbacks.remove('afterSaveMessage', 'federation-v2-after-room-message-sent');\n\t\tcallbacks.remove('afterSaveMessage', 'federation-v2-after-room-message-sent');\n\t\tcallbacks.remove('afterRoomNameChange', 'federation-v2-after-room-name-changed');\n\t\tcallbacks.remove('afterRoomTopicChange', 'federation-v2-after-room-topic-changed');\n\t}\n}\n"],"names":["FederationHooks","afterUserLeaveRoom","callback","afterLeaveRoomCallback","add","user","room","isRoomFederated","throwIfFederationNotEnabledOrNotReady","callbacks","priority","HIGH","onUserRemovedFromRoom","afterRemoveFromRoomCallback","params","removedUser","userWhoRemoved","canAddFederatedUserToNonFederatedRoom","isFederationEnabled","canAddFederatedUserToFederatedRoom","inviter","canCreateDirectMessageFromUI","members","afterMessageReacted","message","isMessageFromMatrixFederation","reaction","afterMessageunReacted","oldMessage","afterMessageDeleted","_id","afterMessageUpdated","isEditedMessage","editedBy","afterMessageSent","u","afterRoomRoleChanged","federationRoomService","data","throwIfFederationNotReady","role","type","action","scope","internalRoomId","internalTargetUserId","undefined","givenByUserId","internalUserId","roleEventsInterestedIn","includes","handlers","onRoomOwnerAdded","onRoomOwnerRemoved","onRoomModeratorAdded","onRoomModeratorRemoved","afterRoomNameChanged","rid","name","afterRoomTopicChanged","topic","removeCEValidation","remove","removeAllListeners"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/rocket-chat/hooks/index.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"fa6a058b7d36527b4e8fcb6fefdf65c678820d63","contentHash":"a91bb04df9ae72f0db1246f30be4b7daa2f7f6a161c666bc16ebc5690926521e"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/utils.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/utils.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":30,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":57}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":35}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":33}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":51}},"8":{"start":{"line":25,"column":8},"end":{"line":25,"column":53}},"9":{"start":{"line":28,"column":8},"end":{"line":28,"column":41}},"10":{"start":{"line":31,"column":16},"end":{"line":31,"column":55}},"11":{"start":{"line":33,"column":4},"end":{"line":33,"column":61}},"12":{"start":{"line":36,"column":4},"end":{"line":36,"column":86}},"13":{"start":{"line":39,"column":4},"end":{"line":41,"column":5}},"14":{"start":{"line":40,"column":8},"end":{"line":40,"column":53}},"15":{"start":{"line":42,"column":4},"end":{"line":44,"column":5}},"16":{"start":{"line":43,"column":8},"end":{"line":43,"column":63}},"17":{"start":{"line":47,"column":4},"end":{"line":49,"column":5}},"18":{"start":{"line":48,"column":8},"end":{"line":48,"column":15}},"19":{"start":{"line":50,"column":4},"end":{"line":50,"column":32}},"20":{"start":{"line":53,"column":4},"end":{"line":55,"column":5}},"21":{"start":{"line":54,"column":8},"end":{"line":54,"column":63}},"22":{"start":{"line":57,"column":48},"end":{"line":64,"column":1}},"23":{"start":{"line":60,"column":24},"end":{"line":60,"column":124}},"24":{"start":{"line":61,"column":8},"end":{"line":61,"column":23}},"25":{"start":{"line":62,"column":8},"end":{"line":62,"column":59}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":47},"end":{"line":12,"column":48}},"loc":{"start":{"line":12,"column":58},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":25},"end":{"line":15,"column":26}},"loc":{"start":{"line":15,"column":36},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":23},"end":{"line":18,"column":24}},"loc":{"start":{"line":18,"column":34},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":41},"end":{"line":21,"column":42}},"loc":{"start":{"line":21,"column":52},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":24,"column":43},"end":{"line":24,"column":44}},"loc":{"start":{"line":24,"column":54},"end":{"line":26,"column":5}},"line":24},"6":{"name":"(anonymous_6)","decl":{"start":{"line":27,"column":31},"end":{"line":27,"column":32}},"loc":{"start":{"line":27,"column":42},"end":{"line":29,"column":5}},"line":27},"7":{"name":"isFederationEnabled","decl":{"start":{"line":32,"column":9},"end":{"line":32,"column":28}},"loc":{"start":{"line":32,"column":31},"end":{"line":34,"column":1}},"line":32},"8":{"name":"isFederationReady","decl":{"start":{"line":35,"column":9},"end":{"line":35,"column":26}},"loc":{"start":{"line":35,"column":29},"end":{"line":37,"column":1}},"line":35},"9":{"name":"throwIfFederationNotEnabledOrNotReady","decl":{"start":{"line":38,"column":9},"end":{"line":38,"column":46}},"loc":{"start":{"line":38,"column":49},"end":{"line":45,"column":1}},"line":38},"10":{"name":"throwIfFederationEnabledButNotReady","decl":{"start":{"line":46,"column":9},"end":{"line":46,"column":44}},"loc":{"start":{"line":46,"column":47},"end":{"line":51,"column":1}},"line":46},"11":{"name":"throwIfFederationNotReady","decl":{"start":{"line":52,"column":9},"end":{"line":52,"column":34}},"loc":{"start":{"line":52,"column":37},"end":{"line":56,"column":1}},"line":52},"12":{"name":"(anonymous_12)","decl":{"start":{"line":58,"column":4},"end":{"line":58,"column":5}},"loc":{"start":{"line":58,"column":22},"end":{"line":63,"column":5}},"line":58}},"branchMap":{"0":{"loc":{"start":{"line":39,"column":4},"end":{"line":41,"column":5}},"type":"if","locations":[{"start":{"line":39,"column":4},"end":{"line":41,"column":5}},{"start":{"line":39,"column":4},"end":{"line":41,"column":5}}],"line":39},"1":{"loc":{"start":{"line":42,"column":4},"end":{"line":44,"column":5}},"type":"if","locations":[{"start":{"line":42,"column":4},"end":{"line":44,"column":5}},{"start":{"line":42,"column":4},"end":{"line":44,"column":5}}],"line":42},"2":{"loc":{"start":{"line":47,"column":4},"end":{"line":49,"column":5}},"type":"if","locations":[{"start":{"line":47,"column":4},"end":{"line":49,"column":5}},{"start":{"line":47,"column":4},"end":{"line":49,"column":5}}],"line":47},"3":{"loc":{"start":{"line":53,"column":4},"end":{"line":55,"column":5}},"type":"if","locations":[{"start":{"line":53,"column":4},"end":{"line":55,"column":5}},{"start":{"line":53,"column":4},"end":{"line":55,"column":5}}],"line":53},"4":{"loc":{"start":{"line":60,"column":65},"end":{"line":60,"column":123}},"type":"cond-expr","locations":[{"start":{"line":60,"column":73},"end":{"line":60,"column":118}},{"start":{"line":60,"column":121},"end":{"line":60,"column":123}}],"line":60}},"s":{"0":1,"1":1,"2":6,"3":1,"4":0,"5":0,"6":0,"7":1,"8":1,"9":1,"10":1,"11":6,"12":4,"13":3,"14":1,"15":2,"16":1,"17":3,"18":2,"19":1,"20":2,"21":2,"22":1,"23":0,"24":0,"25":0},"f":{"0":1,"1":0,"2":0,"3":0,"4":1,"5":1,"6":1,"7":6,"8":4,"9":3,"10":3,"11":2,"12":0},"b":{"0":[1,2],"1":[1,1],"2":[2,1],"3":[2,0],"4":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/utils.ts"],"sourcesContent":["import { settings } from '../../../app/settings/server';\n\nexport function isFederationEnabled(): boolean {\n\treturn settings.get<boolean>('Federation_Matrix_enabled');\n}\n\nexport function isFederationReady(): boolean {\n\treturn settings.get<string>('Federation_Matrix_configuration_status') === 'Valid';\n}\n\nexport function throwIfFederationNotEnabledOrNotReady(): void {\n\tif (!isFederationEnabled()) {\n\t\tthrow new Error('Federation is not enabled');\n\t}\n\n\tif (!isFederationReady()) {\n\t\tthrow new Error('Federation configuration is invalid');\n\t}\n}\n\nexport function throwIfFederationEnabledButNotReady(): void {\n\tif (!isFederationEnabled()) {\n\t\treturn;\n\t}\n\n\tthrowIfFederationNotReady();\n}\n\nexport function throwIfFederationNotReady(): void {\n\tif (!isFederationReady()) {\n\t\tthrow new Error('Federation configuration is invalid');\n\t}\n}\n\nexport class FederationMatrixInvalidConfigurationError extends Error {\n\tconstructor(cause?: string) {\n\t\t// eslint-disable-next-line prefer-template\n\t\tconst message = 'Federation configuration is invalid' + (cause ? ',' + cause[0].toLowerCase() + cause.slice(1) : '');\n\n\t\tsuper(message);\n\n\t\tthis.name = 'FederationMatrixInvalidConfiguration';\n\t}\n}\n"],"names":["FederationMatrixInvalidConfigurationError","isFederationEnabled","isFederationReady","throwIfFederationEnabledButNotReady","throwIfFederationNotEnabledOrNotReady","throwIfFederationNotReady","settings","get","Error","constructor","cause","message","toLowerCase","slice","name"],"mappings":";;;;;;;;;;;IAkCaA,yCAAyC;eAAzCA;;IAhCGC,mBAAmB;eAAnBA;;IAIAC,iBAAiB;eAAjBA;;IAcAC,mCAAmC;eAAnCA;;IAVAC,qCAAqC;eAArCA;;IAkBAC,yBAAyB;eAAzBA;;;wBA5BS;AAElB,SAASJ;IACf,OAAOK,gBAAQ,CAACC,GAAG,CAAU;AAC9B;AAEO,SAASL;IACf,OAAOI,gBAAQ,CAACC,GAAG,CAAS,8CAA8C;AAC3E;AAEO,SAASH;IACf,IAAI,CAACH,uBAAuB;QAC3B,MAAM,IAAIO,MAAM;IACjB;IAEA,IAAI,CAACN,qBAAqB;QACzB,MAAM,IAAIM,MAAM;IACjB;AACD;AAEO,SAASL;IACf,IAAI,CAACF,uBAAuB;QAC3B;IACD;IAEAI;AACD;AAEO,SAASA;IACf,IAAI,CAACH,qBAAqB;QACzB,MAAM,IAAIM,MAAM;IACjB;AACD;AAEO,IAAA,AAAMR,4CAAN,MAAMA,kDAAkDQ;IAC9DC,YAAYC,KAAc,CAAE;QAC3B,2CAA2C;QAC3C,MAAMC,UAAU,wCAAyCD,CAAAA,QAAQ,MAAMA,KAAK,CAAC,EAAE,CAACE,WAAW,KAAKF,MAAMG,KAAK,CAAC,KAAK,EAAC;QAElH,KAAK,CAACF;QAEN,IAAI,CAACG,IAAI,GAAG;IACb;AACD","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/utils.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"46ccfecc6aa21d5c58a06d0829080afdb6830b23","contentHash":"764eb6758a02cca9cadf776b1c35bf4cadcf74f60659c721da512bbed8b52660"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/dataExport/exportRoomMessagesToFile.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/dataExport/exportRoomMessagesToFile.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":24,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":35}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":34}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":40}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":30}},"8":{"start":{"line":25,"column":18},"end":{"line":25,"column":40}},"9":{"start":{"line":26,"column":16},"end":{"line":26,"column":46}},"10":{"start":{"line":27,"column":16},"end":{"line":27,"column":55}},"11":{"start":{"line":28,"column":32},"end":{"line":28,"column":80}},"12":{"start":{"line":29,"column":19},"end":{"line":29,"column":42}},"13":{"start":{"line":30,"column":14},"end":{"line":30,"column":32}},"14":{"start":{"line":31,"column":21},"end":{"line":43,"column":1}},"15":{"start":{"line":32,"column":4},"end":{"line":34,"column":5}},"16":{"start":{"line":33,"column":8},"end":{"line":33,"column":36}},"17":{"start":{"line":35,"column":4},"end":{"line":41,"column":5}},"18":{"start":{"line":36,"column":8},"end":{"line":40,"column":9}},"19":{"start":{"line":37,"column":12},"end":{"line":37,"column":56}},"20":{"start":{"line":39,"column":12},"end":{"line":39,"column":104}},"21":{"start":{"line":42,"column":4},"end":{"line":42,"column":44}},"22":{"start":{"line":44,"column":26},"end":{"line":65,"column":1}},"23":{"start":{"line":46,"column":4},"end":{"line":64,"column":6}},"24":{"start":{"line":66,"column":23},"end":{"line":158,"column":1}},"25":{"start":{"line":67,"column":21},"end":{"line":67,"column":118}},"26":{"start":{"line":68,"column":26},"end":{"line":78,"column":5}},"27":{"start":{"line":73,"column":59},"end":{"line":73,"column":93}},"28":{"start":{"line":79,"column":4},"end":{"line":156,"column":5}},"29":{"start":{"line":81,"column":12},"end":{"line":81,"column":72}},"30":{"start":{"line":82,"column":12},"end":{"line":82,"column":18}},"31":{"start":{"line":84,"column":12},"end":{"line":84,"column":71}},"32":{"start":{"line":85,"column":12},"end":{"line":85,"column":18}},"33":{"start":{"line":87,"column":12},"end":{"line":87,"column":68}},"34":{"start":{"line":88,"column":12},"end":{"line":88,"column":18}},"35":{"start":{"line":90,"column":12},"end":{"line":92,"column":15}},"36":{"start":{"line":93,"column":12},"end":{"line":93,"column":18}},"37":{"start":{"line":95,"column":12},"end":{"line":97,"column":15}},"38":{"start":{"line":98,"column":12},"end":{"line":98,"column":18}},"39":{"start":{"line":100,"column":12},"end":{"line":102,"column":15}},"40":{"start":{"line":103,"column":12},"end":{"line":103,"column":18}},"41":{"start":{"line":105,"column":12},"end":{"line":107,"column":15}},"42":{"start":{"line":108,"column":12},"end":{"line":108,"column":18}},"43":{"start":{"line":110,"column":12},"end":{"line":112,"column":15}},"44":{"start":{"line":113,"column":12},"end":{"line":113,"column":18}},"45":{"start":{"line":115,"column":12},"end":{"line":115,"column":69}},"46":{"start":{"line":116,"column":12},"end":{"line":116,"column":18}},"47":{"start":{"line":118,"column":12},"end":{"line":121,"column":15}},"48":{"start":{"line":122,"column":12},"end":{"line":122,"column":18}},"49":{"start":{"line":124,"column":12},"end":{"line":126,"column":15}},"50":{"start":{"line":127,"column":12},"end":{"line":127,"column":18}},"51":{"start":{"line":129,"column":12},"end":{"line":132,"column":15}},"52":{"start":{"line":133,"column":12},"end":{"line":133,"column":18}},"53":{"start":{"line":135,"column":12},"end":{"line":138,"column":15}},"54":{"start":{"line":139,"column":12},"end":{"line":139,"column":18}},"55":{"start":{"line":141,"column":12},"end":{"line":143,"column":15}},"56":{"start":{"line":144,"column":12},"end":{"line":144,"column":18}},"57":{"start":{"line":146,"column":12},"end":{"line":148,"column":15}},"58":{"start":{"line":149,"column":12},"end":{"line":149,"column":18}},"59":{"start":{"line":151,"column":12},"end":{"line":151,"column":70}},"60":{"start":{"line":152,"column":12},"end":{"line":152,"column":18}},"61":{"start":{"line":154,"column":12},"end":{"line":154,"column":61}},"62":{"start":{"line":155,"column":12},"end":{"line":155,"column":18}},"63":{"start":{"line":157,"column":4},"end":{"line":157,"column":25}},"64":{"start":{"line":159,"column":28},"end":{"line":191,"column":1}},"65":{"start":{"line":160,"column":4},"end":{"line":162,"column":5}},"66":{"start":{"line":161,"column":8},"end":{"line":161,"column":45}},"67":{"start":{"line":163,"column":17},"end":{"line":163,"column":19}},"68":{"start":{"line":164,"column":24},"end":{"line":164,"column":42}},"69":{"start":{"line":165,"column":22},"end":{"line":165,"column":86}},"70":{"start":{"line":166,"column":24},"end":{"line":174,"column":5}},"71":{"start":{"line":175,"column":20},"end":{"line":175,"column":105}},"72":{"start":{"line":176,"column":4},"end":{"line":176,"column":84}},"73":{"start":{"line":177,"column":4},"end":{"line":177,"column":23}},"74":{"start":{"line":178,"column":4},"end":{"line":188,"column":5}},"75":{"start":{"line":180,"column":27},"end":{"line":183,"column":10}},"76":{"start":{"line":182,"column":12},"end":{"line":182,"column":171}},"77":{"start":{"line":184,"column":28},"end":{"line":184,"column":141}},"78":{"start":{"line":185,"column":25},"end":{"line":185,"column":74}},"79":{"start":{"line":186,"column":21},"end":{"line":186,"column":68}},"80":{"start":{"line":187,"column":8},"end":{"line":187,"column":24}},"81":{"start":{"line":189,"column":4},"end":{"line":189,"column":22}},"82":{"start":{"line":190,"column":4},"end":{"line":190,"column":27}},"83":{"start":{"line":192,"column":27},"end":{"line":223,"column":1}},"84":{"start":{"line":193,"column":27},"end":{"line":193,"column":80}},"85":{"start":{"line":194,"column":35},"end":{"line":204,"column":6}},"86":{"start":{"line":205,"column":29},"end":{"line":208,"column":6}},"87":{"start":{"line":209,"column":19},"end":{"line":214,"column":5}},"88":{"start":{"line":215,"column":4},"end":{"line":221,"column":7}},"89":{"start":{"line":216,"column":30},"end":{"line":216,"column":80}},"90":{"start":{"line":217,"column":8},"end":{"line":219,"column":9}},"91":{"start":{"line":218,"column":12},"end":{"line":218,"column":42}},"92":{"start":{"line":220,"column":8},"end":{"line":220,"column":87}},"93":{"start":{"line":222,"column":4},"end":{"line":222,"column":18}},"94":{"start":{"line":224,"column":33},"end":{"line":261,"column":1}},"95":{"start":{"line":225,"column":4},"end":{"line":227,"column":7}},"96":{"start":{"line":228,"column":4},"end":{"line":230,"column":7}},"97":{"start":{"line":231,"column":19},"end":{"line":233,"column":5}},"98":{"start":{"line":234,"column":18},"end":{"line":234,"column":142}},"99":{"start":{"line":235,"column":4},"end":{"line":259,"column":5}},"100":{"start":{"line":236,"column":8},"end":{"line":238,"column":9}},"101":{"start":{"line":237,"column":12},"end":{"line":237,"column":21}},"102":{"start":{"line":239,"column":25},"end":{"line":239,"column":90}},"103":{"start":{"line":240,"column":8},"end":{"line":247,"column":9}},"104":{"start":{"line":241,"column":12},"end":{"line":241,"column":50}},"105":{"start":{"line":242,"column":12},"end":{"line":246,"column":13}},"106":{"start":{"line":243,"column":16},"end":{"line":245,"column":19}},"107":{"start":{"line":248,"column":21},"end":{"line":248,"column":51}},"108":{"start":{"line":249,"column":55},"end":{"line":249,"column":176}},"109":{"start":{"line":250,"column":8},"end":{"line":250,"column":41}},"110":{"start":{"line":251,"column":8},"end":{"line":251,"column":51}},"111":{"start":{"line":252,"column":8},"end":{"line":254,"column":9}},"112":{"start":{"line":253,"column":12},"end":{"line":253,"column":50}},"113":{"start":{"line":255,"column":8},"end":{"line":258,"column":11}},"114":{"start":{"line":260,"column":4},"end":{"line":260,"column":18}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":25},"end":{"line":12,"column":26}},"loc":{"start":{"line":12,"column":36},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":24},"end":{"line":15,"column":25}},"loc":{"start":{"line":15,"column":35},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":30},"end":{"line":18,"column":31}},"loc":{"start":{"line":18,"column":41},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":20},"end":{"line":21,"column":21}},"loc":{"start":{"line":21,"column":31},"end":{"line":23,"column":5}},"line":21},"5":{"name":"(anonymous_5)","decl":{"start":{"line":31,"column":21},"end":{"line":31,"column":22}},"loc":{"start":{"line":31,"column":53},"end":{"line":43,"column":1}},"line":31},"6":{"name":"(anonymous_6)","decl":{"start":{"line":44,"column":26},"end":{"line":44,"column":27}},"loc":{"start":{"line":44,"column":49},"end":{"line":65,"column":1}},"line":44},"7":{"name":"(anonymous_7)","decl":{"start":{"line":66,"column":23},"end":{"line":66,"column":24}},"loc":{"start":{"line":66,"column":61},"end":{"line":158,"column":1}},"line":66},"8":{"name":"(anonymous_8)","decl":{"start":{"line":73,"column":45},"end":{"line":73,"column":46}},"loc":{"start":{"line":73,"column":59},"end":{"line":73,"column":93}},"line":73},"9":{"name":"(anonymous_9)","decl":{"start":{"line":159,"column":28},"end":{"line":159,"column":29}},"loc":{"start":{"line":159,"column":64},"end":{"line":191,"column":1}},"line":159},"10":{"name":"(anonymous_10)","decl":{"start":{"line":180,"column":177},"end":{"line":180,"column":178}},"loc":{"start":{"line":180,"column":184},"end":{"line":183,"column":9}},"line":180},"11":{"name":"(anonymous_11)","decl":{"start":{"line":192,"column":27},"end":{"line":192,"column":28}},"loc":{"start":{"line":192,"column":121},"end":{"line":223,"column":1}},"line":192},"12":{"name":"(anonymous_12)","decl":{"start":{"line":215,"column":20},"end":{"line":215,"column":21}},"loc":{"start":{"line":215,"column":27},"end":{"line":221,"column":5}},"line":215},"13":{"name":"(anonymous_13)","decl":{"start":{"line":224,"column":33},"end":{"line":224,"column":34}},"loc":{"start":{"line":224,"column":158},"end":{"line":261,"column":1}},"line":224}},"branchMap":{"0":{"loc":{"start":{"line":32,"column":4},"end":{"line":34,"column":5}},"type":"if","locations":[{"start":{"line":32,"column":4},"end":{"line":34,"column":5}},{"start":{"line":32,"column":4},"end":{"line":34,"column":5}}],"line":32},"1":{"loc":{"start":{"line":35,"column":4},"end":{"line":41,"column":5}},"type":"if","locations":[{"start":{"line":35,"column":4},"end":{"line":41,"column":5}},{"start":{"line":35,"column":4},"end":{"line":41,"column":5}}],"line":35},"2":{"loc":{"start":{"line":36,"column":8},"end":{"line":40,"column":9}},"type":"if","locations":[{"start":{"line":36,"column":8},"end":{"line":40,"column":9}},{"start":{"line":36,"column":8},"end":{"line":40,"column":9}}],"line":36},"3":{"loc":{"start":{"line":36,"column":12},"end":{"line":36,"column":54}},"type":"binary-expr","locations":[{"start":{"line":36,"column":12},"end":{"line":36,"column":20}},{"start":{"line":36,"column":24},"end":{"line":36,"column":54}}],"line":36},"4":{"loc":{"start":{"line":47,"column":14},"end":{"line":47,"column":64}},"type":"cond-expr","locations":[{"start":{"line":47,"column":37},"end":{"line":47,"column":52}},{"start":{"line":47,"column":55},"end":{"line":47,"column":64}}],"line":47},"5":{"loc":{"start":{"line":50,"column":19},"end":{"line":50,"column":79}},"type":"cond-expr","locations":[{"start":{"line":50,"column":47},"end":{"line":50,"column":67}},{"start":{"line":50,"column":70},"end":{"line":50,"column":79}}],"line":50},"6":{"loc":{"start":{"line":51,"column":19},"end":{"line":51,"column":79}},"type":"cond-expr","locations":[{"start":{"line":51,"column":47},"end":{"line":51,"column":67}},{"start":{"line":51,"column":70},"end":{"line":51,"column":79}}],"line":51},"7":{"loc":{"start":{"line":52,"column":19},"end":{"line":52,"column":79}},"type":"cond-expr","locations":[{"start":{"line":52,"column":47},"end":{"line":52,"column":67}},{"start":{"line":52,"column":70},"end":{"line":52,"column":79}}],"line":52},"8":{"loc":{"start":{"line":53,"column":22},"end":{"line":53,"column":88}},"type":"cond-expr","locations":[{"start":{"line":53,"column":53},"end":{"line":53,"column":76}},{"start":{"line":53,"column":79},"end":{"line":53,"column":88}}],"line":53},"9":{"loc":{"start":{"line":54,"column":20},"end":{"line":54,"column":82}},"type":"cond-expr","locations":[{"start":{"line":54,"column":49},"end":{"line":54,"column":70}},{"start":{"line":54,"column":73},"end":{"line":54,"column":82}}],"line":54},"10":{"loc":{"start":{"line":55,"column":20},"end":{"line":55,"column":82}},"type":"cond-expr","locations":[{"start":{"line":55,"column":49},"end":{"line":55,"column":70}},{"start":{"line":55,"column":73},"end":{"line":55,"column":82}}],"line":55},"11":{"loc":{"start":{"line":56,"column":20},"end":{"line":56,"column":82}},"type":"cond-expr","locations":[{"start":{"line":56,"column":49},"end":{"line":56,"column":70}},{"start":{"line":56,"column":73},"end":{"line":56,"column":82}}],"line":56},"12":{"loc":{"start":{"line":57,"column":20},"end":{"line":57,"column":82}},"type":"cond-expr","locations":[{"start":{"line":57,"column":49},"end":{"line":57,"column":70}},{"start":{"line":57,"column":73},"end":{"line":57,"column":82}}],"line":57},"13":{"loc":{"start":{"line":58,"column":20},"end":{"line":58,"column":82}},"type":"cond-expr","locations":[{"start":{"line":58,"column":49},"end":{"line":58,"column":70}},{"start":{"line":58,"column":73},"end":{"line":58,"column":82}}],"line":58},"14":{"loc":{"start":{"line":59,"column":20},"end":{"line":59,"column":82}},"type":"cond-expr","locations":[{"start":{"line":59,"column":49},"end":{"line":59,"column":70}},{"start":{"line":59,"column":73},"end":{"line":59,"column":82}}],"line":59},"15":{"loc":{"start":{"line":60,"column":13},"end":{"line":60,"column":312}},"type":"binary-expr","locations":[{"start":{"line":60,"column":13},"end":{"line":60,"column":34}},{"start":{"line":60,"column":39},"end":{"line":60,"column":99}},{"start":{"line":60,"column":105},"end":{"line":60,"column":165}},{"start":{"line":60,"column":171},"end":{"line":60,"column":231}},{"start":{"line":60,"column":237},"end":{"line":60,"column":303}},{"start":{"line":60,"column":308},"end":{"line":60,"column":312}}],"line":60},"16":{"loc":{"start":{"line":60,"column":39},"end":{"line":60,"column":99}},"type":"cond-expr","locations":[{"start":{"line":60,"column":67},"end":{"line":60,"column":87}},{"start":{"line":60,"column":90},"end":{"line":60,"column":99}}],"line":60},"17":{"loc":{"start":{"line":60,"column":105},"end":{"line":60,"column":165}},"type":"cond-expr","locations":[{"start":{"line":60,"column":133},"end":{"line":60,"column":153}},{"start":{"line":60,"column":156},"end":{"line":60,"column":165}}],"line":60},"18":{"loc":{"start":{"line":60,"column":171},"end":{"line":60,"column":231}},"type":"cond-expr","locations":[{"start":{"line":60,"column":199},"end":{"line":60,"column":219}},{"start":{"line":60,"column":222},"end":{"line":60,"column":231}}],"line":60},"19":{"loc":{"start":{"line":60,"column":237},"end":{"line":60,"column":303}},"type":"cond-expr","locations":[{"start":{"line":60,"column":268},"end":{"line":60,"column":291}},{"start":{"line":60,"column":294},"end":{"line":60,"column":303}}],"line":60},"20":{"loc":{"start":{"line":61,"column":18},"end":{"line":61,"column":114}},"type":"cond-expr","locations":[{"start":{"line":61,"column":88},"end":{"line":61,"column":94}},{"start":{"line":61,"column":97},"end":{"line":61,"column":114}}],"line":61},"21":{"loc":{"start":{"line":61,"column":18},"end":{"line":61,"column":85}},"type":"binary-expr","locations":[{"start":{"line":61,"column":18},"end":{"line":61,"column":57}},{"start":{"line":61,"column":61},"end":{"line":61,"column":85}}],"line":61},"22":{"loc":{"start":{"line":62,"column":16},"end":{"line":62,"column":115}},"type":"cond-expr","locations":[{"start":{"line":62,"column":88},"end":{"line":62,"column":94}},{"start":{"line":62,"column":97},"end":{"line":62,"column":115}}],"line":62},"23":{"loc":{"start":{"line":62,"column":16},"end":{"line":62,"column":85}},"type":"binary-expr","locations":[{"start":{"line":62,"column":16},"end":{"line":62,"column":56}},{"start":{"line":62,"column":60},"end":{"line":62,"column":85}}],"line":62},"24":{"loc":{"start":{"line":63,"column":18},"end":{"line":63,"column":118}},"type":"cond-expr","locations":[{"start":{"line":63,"column":90},"end":{"line":63,"column":96}},{"start":{"line":63,"column":99},"end":{"line":63,"column":118}}],"line":63},"25":{"loc":{"start":{"line":63,"column":18},"end":{"line":63,"column":87}},"type":"binary-expr","locations":[{"start":{"line":63,"column":18},"end":{"line":63,"column":58}},{"start":{"line":63,"column":62},"end":{"line":63,"column":87}}],"line":63},"26":{"loc":{"start":{"line":67,"column":21},"end":{"line":67,"column":118}},"type":"cond-expr","locations":[{"start":{"line":67,"column":33},"end":{"line":67,"column":101}},{"start":{"line":67,"column":104},"end":{"line":67,"column":118}}],"line":67},"27":{"loc":{"start":{"line":67,"column":46},"end":{"line":67,"column":80}},"type":"binary-expr","locations":[{"start":{"line":67,"column":46},"end":{"line":67,"column":60}},{"start":{"line":67,"column":64},"end":{"line":67,"column":74}},{"start":{"line":67,"column":78},"end":{"line":67,"column":80}}],"line":67},"28":{"loc":{"start":{"line":72,"column":11},"end":{"line":74,"column":9}},"type":"binary-expr","locations":[{"start":{"line":72,"column":11},"end":{"line":72,"column":26}},{"start":{"line":72,"column":30},"end":{"line":74,"column":9}}],"line":72},"29":{"loc":{"start":{"line":75,"column":11},"end":{"line":77,"column":9}},"type":"binary-expr","locations":[{"start":{"line":75,"column":11},"end":{"line":75,"column":16}},{"start":{"line":75,"column":20},"end":{"line":77,"column":9}}],"line":75},"30":{"loc":{"start":{"line":79,"column":4},"end":{"line":156,"column":5}},"type":"switch","locations":[{"start":{"line":80,"column":8},"end":{"line":82,"column":18}},{"start":{"line":83,"column":8},"end":{"line":85,"column":18}},{"start":{"line":86,"column":8},"end":{"line":88,"column":18}},{"start":{"line":89,"column":8},"end":{"line":93,"column":18}},{"start":{"line":94,"column":8},"end":{"line":98,"column":18}},{"start":{"line":99,"column":8},"end":{"line":103,"column":18}},{"start":{"line":104,"column":8},"end":{"line":108,"column":18}},{"start":{"line":109,"column":8},"end":{"line":113,"column":18}},{"start":{"line":114,"column":8},"end":{"line":116,"column":18}},{"start":{"line":117,"column":8},"end":{"line":122,"column":18}},{"start":{"line":123,"column":8},"end":{"line":127,"column":18}},{"start":{"line":128,"column":8},"end":{"line":133,"column":18}},{"start":{"line":134,"column":8},"end":{"line":139,"column":18}},{"start":{"line":140,"column":8},"end":{"line":144,"column":18}},{"start":{"line":145,"column":8},"end":{"line":149,"column":18}},{"start":{"line":150,"column":8},"end":{"line":152,"column":18}},{"start":{"line":153,"column":8},"end":{"line":155,"column":18}}],"line":79},"31":{"loc":{"start":{"line":160,"column":4},"end":{"line":162,"column":5}},"type":"if","locations":[{"start":{"line":160,"column":4},"end":{"line":162,"column":5}},{"start":{"line":160,"column":4},"end":{"line":162,"column":5}}],"line":160},"32":{"loc":{"start":{"line":165,"column":22},"end":{"line":165,"column":86}},"type":"cond-expr","locations":[{"start":{"line":165,"column":41},"end":{"line":165,"column":81}},{"start":{"line":165,"column":84},"end":{"line":165,"column":86}}],"line":165},"33":{"loc":{"start":{"line":175,"column":20},"end":{"line":175,"column":105}},"type":"cond-expr","locations":[{"start":{"line":175,"column":56},"end":{"line":175,"column":85}},{"start":{"line":175,"column":88},"end":{"line":175,"column":105}}],"line":175},"34":{"loc":{"start":{"line":178,"column":4},"end":{"line":188,"column":5}},"type":"if","locations":[{"start":{"line":178,"column":4},"end":{"line":188,"column":5}},{"start":{"line":178,"column":4},"end":{"line":188,"column":5}}],"line":178},"35":{"loc":{"start":{"line":178,"column":8},"end":{"line":178,"column":81}},"type":"cond-expr","locations":[{"start":{"line":178,"column":57},"end":{"line":178,"column":63}},{"start":{"line":178,"column":66},"end":{"line":178,"column":81}}],"line":178},"36":{"loc":{"start":{"line":178,"column":8},"end":{"line":178,"column":54}},"type":"binary-expr","locations":[{"start":{"line":178,"column":8},"end":{"line":178,"column":28}},{"start":{"line":178,"column":32},"end":{"line":178,"column":54}}],"line":178},"37":{"loc":{"start":{"line":180,"column":27},"end":{"line":183,"column":10}},"type":"cond-expr","locations":[{"start":{"line":180,"column":136},"end":{"line":180,"column":142}},{"start":{"line":180,"column":145},"end":{"line":183,"column":10}}],"line":180},"38":{"loc":{"start":{"line":180,"column":27},"end":{"line":180,"column":133}},"type":"binary-expr","locations":[{"start":{"line":180,"column":27},"end":{"line":180,"column":92}},{"start":{"line":180,"column":96},"end":{"line":180,"column":133}}],"line":180},"39":{"loc":{"start":{"line":182,"column":19},"end":{"line":182,"column":170}},"type":"binary-expr","locations":[{"start":{"line":182,"column":19},"end":{"line":182,"column":38}},{"start":{"line":182,"column":43},"end":{"line":182,"column":169}}],"line":182},"40":{"loc":{"start":{"line":182,"column":43},"end":{"line":182,"column":169}},"type":"cond-expr","locations":[{"start":{"line":182,"column":119},"end":{"line":182,"column":125}},{"start":{"line":182,"column":128},"end":{"line":182,"column":169}}],"line":182},"41":{"loc":{"start":{"line":182,"column":43},"end":{"line":182,"column":116}},"type":"binary-expr","locations":[{"start":{"line":182,"column":43},"end":{"line":182,"column":86}},{"start":{"line":182,"column":90},"end":{"line":182,"column":116}}],"line":182},"42":{"loc":{"start":{"line":184,"column":28},"end":{"line":184,"column":141}},"type":"binary-expr","locations":[{"start":{"line":184,"column":29},"end":{"line":184,"column":101}},{"start":{"line":184,"column":106},"end":{"line":184,"column":141}}],"line":184},"43":{"loc":{"start":{"line":184,"column":29},"end":{"line":184,"column":101}},"type":"cond-expr","locations":[{"start":{"line":184,"column":76},"end":{"line":184,"column":82}},{"start":{"line":184,"column":85},"end":{"line":184,"column":101}}],"line":184},"44":{"loc":{"start":{"line":184,"column":29},"end":{"line":184,"column":73}},"type":"binary-expr","locations":[{"start":{"line":184,"column":29},"end":{"line":184,"column":48}},{"start":{"line":184,"column":52},"end":{"line":184,"column":73}}],"line":184},"45":{"loc":{"start":{"line":192,"column":74},"end":{"line":192,"column":85}},"type":"default-arg","locations":[{"start":{"line":192,"column":83},"end":{"line":192,"column":85}}],"line":192},"46":{"loc":{"start":{"line":192,"column":87},"end":{"line":192,"column":100}},"type":"default-arg","locations":[{"start":{"line":192,"column":98},"end":{"line":192,"column":100}}],"line":192},"47":{"loc":{"start":{"line":192,"column":102},"end":{"line":192,"column":118}},"type":"default-arg","locations":[{"start":{"line":192,"column":114},"end":{"line":192,"column":118}}],"line":192},"48":{"loc":{"start":{"line":217,"column":8},"end":{"line":219,"column":9}},"type":"if","locations":[{"start":{"line":217,"column":8},"end":{"line":219,"column":9}},{"start":{"line":217,"column":8},"end":{"line":219,"column":9}}],"line":217},"49":{"loc":{"start":{"line":224,"column":104},"end":{"line":224,"column":123}},"type":"default-arg","locations":[{"start":{"line":224,"column":121},"end":{"line":224,"column":123}}],"line":224},"50":{"loc":{"start":{"line":224,"column":125},"end":{"line":224,"column":138}},"type":"default-arg","locations":[{"start":{"line":224,"column":136},"end":{"line":224,"column":138}}],"line":224},"51":{"loc":{"start":{"line":224,"column":140},"end":{"line":224,"column":156}},"type":"default-arg","locations":[{"start":{"line":224,"column":152},"end":{"line":224,"column":156}}],"line":224},"52":{"loc":{"start":{"line":234,"column":18},"end":{"line":234,"column":142}},"type":"cond-expr","locations":[{"start":{"line":234,"column":80},"end":{"line":234,"column":135}},{"start":{"line":234,"column":138},"end":{"line":234,"column":142}}],"line":234},"53":{"loc":{"start":{"line":236,"column":8},"end":{"line":238,"column":9}},"type":"if","locations":[{"start":{"line":236,"column":8},"end":{"line":238,"column":9}},{"start":{"line":236,"column":8},"end":{"line":238,"column":9}}],"line":236},"54":{"loc":{"start":{"line":240,"column":8},"end":{"line":247,"column":9}},"type":"if","locations":[{"start":{"line":240,"column":8},"end":{"line":247,"column":9}},{"start":{"line":240,"column":8},"end":{"line":247,"column":9}}],"line":240},"55":{"loc":{"start":{"line":242,"column":12},"end":{"line":246,"column":13}},"type":"if","locations":[{"start":{"line":242,"column":12},"end":{"line":246,"column":13}},{"start":{"line":242,"column":12},"end":{"line":246,"column":13}}],"line":242},"56":{"loc":{"start":{"line":252,"column":8},"end":{"line":254,"column":9}},"type":"if","locations":[{"start":{"line":252,"column":8},"end":{"line":254,"column":9}},{"start":{"line":252,"column":8},"end":{"line":254,"column":9}}],"line":252}},"s":{"0":1,"1":1,"2":4,"3":1,"4":1,"5":1,"6":0,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":10,"16":2,"17":10,"18":8,"19":0,"20":8,"21":10,"22":1,"23":6,"24":1,"25":15,"26":15,"27":6,"28":15,"29":3,"30":3,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":3,"46":3,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":15,"64":1,"65":16,"66":6,"67":10,"68":10,"69":10,"70":10,"71":10,"72":10,"73":10,"74":10,"75":4,"76":4,"77":4,"78":4,"79":4,"80":4,"81":10,"82":10,"83":1,"84":2,"85":2,"86":2,"87":2,"88":2,"89":10,"90":10,"91":4,"92":10,"93":2,"94":1,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0},"f":{"0":1,"1":1,"2":1,"3":0,"4":1,"5":10,"6":6,"7":15,"8":6,"9":16,"10":4,"11":2,"12":10,"13":0},"b":{"0":[2,8],"1":[8,2],"2":[0,8],"3":[8,8],"4":[6,0],"5":[0,6],"6":[0,6],"7":[0,6],"8":[0,6],"9":[0,6],"10":[0,6],"11":[0,6],"12":[0,6],"13":[0,6],"14":[0,6],"15":[6,0,0,0,0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,6],"21":[6,6],"22":[0,6],"23":[6,6],"24":[0,6],"25":[6,6],"26":[10,5],"27":[10,0,0],"28":[15,6],"29":[15,6],"30":[3,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0],"31":[6,10],"32":[10,0],"33":[2,8],"34":[4,6],"35":[6,4],"36":[10,10],"37":[0,4],"38":[4,4],"39":[4,4],"40":[0,4],"41":[4,4],"42":[4,2],"43":[2,2],"44":[4,4],"45":[2],"46":[2],"47":[2],"48":[4,6],"49":[0],"50":[0],"51":[0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0],"56":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/dataExport/exportRoomMessagesToFile.ts"],"sourcesContent":["import { mkdir, writeFile } from 'fs/promises';\n\nimport type { IMessage, IRoom, IUser, MessageAttachment, FileProp, RoomType } from '@rocket.chat/core-typings';\nimport { Messages } from '@rocket.chat/models';\n\nimport { settings } from '../../../app/settings/server';\nimport { readSecondaryPreferred } from '../../database/readSecondaryPreferred';\nimport { joinPath } from '../fileUtils';\nimport { i18n } from '../i18n';\n\nconst hideUserName = (\n\tusername: string,\n\tuserData: Pick<IUser, 'username'> | undefined,\n\tusersMap: { userNameTable: Record<string, string> },\n) => {\n\tif (!usersMap.userNameTable) {\n\t\tusersMap.userNameTable = {};\n\t}\n\n\tif (!usersMap.userNameTable[username]) {\n\t\tif (userData && username === userData.username) {\n\t\t\tusersMap.userNameTable[username] = username;\n\t\t} else {\n\t\t\tusersMap.userNameTable[username] = `User_${Object.keys(usersMap.userNameTable).length + 1}`;\n\t\t}\n\t}\n\n\treturn usersMap.userNameTable[username];\n};\n\nconst getAttachmentData = (attachment: MessageAttachment, message: IMessage) => {\n\treturn {\n\t\ttype: 'type' in attachment ? attachment.type : undefined,\n\t\ttitle: attachment.title,\n\t\ttitle_link: attachment.title_link,\n\t\timage_url: 'image_url' in attachment ? attachment.image_url : undefined,\n\t\taudio_url: 'audio_url' in attachment ? attachment.audio_url : undefined,\n\t\tvideo_url: 'video_url' in attachment ? attachment.video_url : undefined,\n\t\tmessage_link: 'message_link' in attachment ? attachment.message_link : undefined,\n\t\timage_type: 'image_type' in attachment ? attachment.image_type : undefined,\n\t\timage_size: 'image_size' in attachment ? attachment.image_size : undefined,\n\t\tvideo_size: 'video_size' in attachment ? attachment.video_size : undefined,\n\t\tvideo_type: 'video_type' in attachment ? attachment.video_type : undefined,\n\t\taudio_size: 'audio_size' in attachment ? attachment.audio_size : undefined,\n\t\taudio_type: 'audio_type' in attachment ? attachment.audio_type : undefined,\n\t\turl:\n\t\t\tattachment.title_link ||\n\t\t\t('image_url' in attachment ? attachment.image_url : undefined) ||\n\t\t\t('audio_url' in attachment ? attachment.audio_url : undefined) ||\n\t\t\t('video_url' in attachment ? attachment.video_url : undefined) ||\n\t\t\t('message_link' in attachment ? attachment.message_link : undefined) ||\n\t\t\tnull,\n\t\tremote: !message.file?._id,\n\t\tfileId: message.file?._id,\n\t\tfileName: message.file?.name,\n\t};\n};\n\nexport type MessageData = Pick<IMessage, 'msg' | 'ts'> & {\n\tusername?: IUser['username'] | IUser['name'];\n\tattachments?: ReturnType<typeof getAttachmentData>[];\n\ttype?: IMessage['t'];\n};\n\nexport const getMessageData = (\n\tmsg: IMessage,\n\thideUsers: boolean,\n\tuserData: Pick<IUser, 'username'> | undefined,\n\tusersMap: { userNameTable: Record<string, string> },\n): MessageData => {\n\tconst username = hideUsers ? hideUserName(msg.u.username || msg.u.name || '', userData, usersMap) : msg.u.username;\n\n\tconst messageObject = {\n\t\tmsg: msg.msg,\n\t\tusername,\n\t\tts: msg.ts,\n\t\t...(msg.attachments && {\n\t\t\tattachments: msg.attachments.map((attachment) => getAttachmentData(attachment, msg)),\n\t\t}),\n\t\t...(msg.t && { type: msg.t }),\n\t};\n\n\tswitch (msg.t) {\n\t\tcase 'uj':\n\t\t\tmessageObject.msg = i18n.t('User_joined_the_channel');\n\t\t\tbreak;\n\t\tcase 'ul':\n\t\t\tmessageObject.msg = i18n.t('User_left_this_channel');\n\t\t\tbreak;\n\t\tcase 'ult':\n\t\t\tmessageObject.msg = i18n.t('User_left_this_team');\n\t\t\tbreak;\n\t\tcase 'user-added-room-to-team':\n\t\t\tmessageObject.msg = i18n.t('added__roomName__to_this_team', {\n\t\t\t\troomName: msg.msg,\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 'user-converted-to-team':\n\t\t\tmessageObject.msg = i18n.t('Converted__roomName__to_a_team', {\n\t\t\t\troomName: msg.msg,\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 'user-converted-to-channel':\n\t\t\tmessageObject.msg = i18n.t('Converted__roomName__to_a_channel', {\n\t\t\t\troomName: msg.msg,\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 'user-deleted-room-from-team':\n\t\t\tmessageObject.msg = i18n.t('Deleted__roomName__room', {\n\t\t\t\troomName: msg.msg,\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 'user-removed-room-from-team':\n\t\t\tmessageObject.msg = i18n.t('Removed__roomName__from_the_team', {\n\t\t\t\troomName: msg.msg,\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 'ujt':\n\t\t\tmessageObject.msg = i18n.t('User_joined_the_team');\n\t\t\tbreak;\n\t\tcase 'au':\n\t\t\tmessageObject.msg = i18n.t('User_added_to', {\n\t\t\t\tuser_added: hideUserName(msg.msg, userData, usersMap),\n\t\t\t\tuser_by: username,\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 'added-user-to-team':\n\t\t\tmessageObject.msg = i18n.t('Added__username__to_this_team', {\n\t\t\t\tuser_added: msg.msg,\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 'r':\n\t\t\tmessageObject.msg = i18n.t('Room_name_changed_to', {\n\t\t\t\troom_name: msg.msg,\n\t\t\t\tuser_by: username,\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 'ru':\n\t\t\tmessageObject.msg = i18n.t('User_has_been_removed', {\n\t\t\t\tuser_removed: hideUserName(msg.msg, userData, usersMap),\n\t\t\t\tuser_by: username,\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 'removed-user-from-team':\n\t\t\tmessageObject.msg = i18n.t('Removed__username__from_the_team', {\n\t\t\t\tuser_removed: hideUserName(msg.msg, userData, usersMap),\n\t\t\t});\n\t\t\tbreak;\n\t\tcase 'wm':\n\t\t\tmessageObject.msg = i18n.t('Welcome', { user: username });\n\t\t\tbreak;\n\t\tcase 'livechat-close':\n\t\t\tmessageObject.msg = i18n.t('Conversation_finished');\n\t\t\tbreak;\n\t\tcase 'livechat-started':\n\t\t\tmessageObject.msg = i18n.t('Chat_started');\n\t\t\tbreak;\n\t}\n\n\treturn messageObject;\n};\n\nexport const exportMessageObject = (type: 'json' | 'html', messageObject: MessageData, messageFile?: FileProp): string => {\n\tif (type === 'json') {\n\t\treturn JSON.stringify(messageObject);\n\t}\n\n\tconst file = [];\n\n\tconst messageType = messageObject.type;\n\tconst timestamp = messageObject.ts ? new Date(messageObject.ts).toUTCString() : '';\n\n\tconst italicTypes: IMessage['t'][] = ['uj', 'ul', 'au', 'r', 'ru', 'wm', 'livechat-close'];\n\n\tconst message = italicTypes.includes(messageType) ? `<i>${messageObject.msg}</i>` : messageObject.msg;\n\n\tfile.push(`<p><strong>${messageObject.username}</strong> (${timestamp}):<br/>`);\n\tfile.push(message);\n\n\tif (messageFile?._id) {\n\t\tconst attachment = messageObject.attachments?.find((att) => att.type === 'file' && att.title_link?.includes(messageFile._id));\n\n\t\tconst description = attachment?.title || i18n.t('Message_Attachments');\n\n\t\tconst assetUrl = `./assets/${messageFile._id}-${messageFile.name}`;\n\t\tconst link = `<br/><a href=\"${assetUrl}\">${description}</a>`;\n\t\tfile.push(link);\n\t}\n\n\tfile.push('</p>');\n\n\treturn file.join('\\n');\n};\n\nexport const exportRoomMessages = async (\n\trid: IRoom['_id'],\n\texportType: 'json' | 'html',\n\tskip: number,\n\tlimit: number,\n\tuserData: any,\n\tfilter: any = {},\n\tusersMap: any = {},\n\thideUsers = true,\n) => {\n\tconst readPreference = readSecondaryPreferred();\n\n\tconst { cursor, totalCount } = Messages.findPaginated(\n\t\t{ ...filter, rid },\n\t\t{\n\t\t\tsort: { ts: 1 },\n\t\t\tskip,\n\t\t\tlimit,\n\t\t\treadPreference,\n\t\t},\n\t);\n\n\tconst [results, total] = await Promise.all([cursor.toArray(), totalCount]);\n\n\tconst result = {\n\t\ttotal,\n\t\texported: results.length,\n\t\tmessages: [] as string[],\n\t\tuploads: [] as FileProp[],\n\t};\n\n\tresults.forEach((msg) => {\n\t\tconst messageObject = getMessageData(msg, hideUsers, userData, usersMap);\n\n\t\tif (msg.file) {\n\t\t\tresult.uploads.push(msg.file);\n\t\t}\n\n\t\tresult.messages.push(exportMessageObject(exportType, messageObject, msg.file));\n\t});\n\n\treturn result;\n};\n\nexport const exportRoomMessagesToFile = async function (\n\texportPath: string,\n\tassetsPath: string,\n\texportType: 'json' | 'html',\n\troomList: (\n\t\t| {\n\t\t\t\troomId: string;\n\t\t\t\troomName: string;\n\t\t\t\tuserId: string | undefined;\n\t\t\t\texportedCount: number;\n\t\t\t\tstatus: string;\n\t\t\t\ttype: RoomType;\n\t\t\t\ttargetFile: string;\n\t\t  }\n\t\t| Record<string, never>\n\t)[],\n\tuserData: IUser,\n\tmessagesFilter = {},\n\tusersMap = {},\n\thideUsers = true,\n) {\n\tawait mkdir(exportPath, { recursive: true });\n\tawait mkdir(assetsPath, { recursive: true });\n\n\tconst result = {\n\t\tfileList: [] as FileProp[],\n\t};\n\n\tconst limit =\n\t\tsettings.get<number>('UserData_MessageLimitPerRequest') > 0 ? settings.get<number>('UserData_MessageLimitPerRequest') : 1000;\n\tfor await (const exportOpRoomData of roomList) {\n\t\tif (!('targetFile' in exportOpRoomData)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst filePath = joinPath(exportPath, exportOpRoomData.targetFile);\n\t\tif (exportOpRoomData.status === 'pending') {\n\t\t\texportOpRoomData.status = 'exporting';\n\t\t\tif (exportType === 'html') {\n\t\t\t\tawait writeFile(filePath, '<meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\">', { encoding: 'utf8' });\n\t\t\t}\n\t\t}\n\n\t\tconst skip = exportOpRoomData.exportedCount;\n\n\t\tconst { total, exported, uploads, messages } = await exportRoomMessages(\n\t\t\texportOpRoomData.roomId,\n\t\t\texportType,\n\t\t\tskip,\n\t\t\tlimit,\n\t\t\tuserData,\n\t\t\tmessagesFilter,\n\t\t\tusersMap,\n\t\t\thideUsers,\n\t\t);\n\n\t\tresult.fileList.push(...uploads);\n\n\t\texportOpRoomData.exportedCount += exported;\n\n\t\tif (total <= exportOpRoomData.exportedCount) {\n\t\t\texportOpRoomData.status = 'completed';\n\t\t}\n\n\t\tawait writeFile(filePath, `${messages.join('\\n')}\\n`, { encoding: 'utf8', flag: 'a' });\n\t}\n\n\treturn result;\n};\n"],"names":["exportMessageObject","exportRoomMessages","exportRoomMessagesToFile","getMessageData","hideUserName","username","userData","usersMap","userNameTable","Object","keys","length","getAttachmentData","attachment","message","type","undefined","title","title_link","image_url","audio_url","video_url","message_link","image_type","image_size","video_size","video_type","audio_size","audio_type","url","remote","file","_id","fileId","fileName","name","msg","hideUsers","u","messageObject","ts","attachments","map","t","i18n","roomName","user_added","user_by","room_name","user_removed","user","messageFile","JSON","stringify","messageType","timestamp","Date","toUTCString","italicTypes","includes","push","find","att","description","assetUrl","link","join","rid","exportType","skip","limit","filter","readPreference","readSecondaryPreferred","cursor","totalCount","Messages","findPaginated","sort","results","total","Promise","all","toArray","result","exported","messages","uploads","forEach","exportPath","assetsPath","roomList","messagesFilter","mkdir","recursive","fileList","settings","get","exportOpRoomData","filePath","joinPath","targetFile","status","writeFile","encoding","exportedCount","roomId","flag"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/dataExport/exportRoomMessagesToFile.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"ef428ab5e4b2ba993cb27d02371fe073b311aaaf","contentHash":"5c2bcc5a2dc7c5b5429568070b67590630b382e1cea4f5056e43dd125d8a3478"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/database/readSecondaryPreferred.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/database/readSecondaryPreferred.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":38}},"3":{"start":{"line":11,"column":17},"end":{"line":11,"column":35}},"4":{"start":{"line":14,"column":31},"end":{"line":14,"column":89}},"5":{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},"6":{"start":{"line":16,"column":8},"end":{"line":16,"column":94}},"7":{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},"8":{"start":{"line":19,"column":8},"end":{"line":19,"column":109}},"9":{"start":{"line":24,"column":4},"end":{"line":24,"column":55}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"readSecondaryPreferred","decl":{"start":{"line":12,"column":9},"end":{"line":12,"column":31}},"loc":{"start":{"line":12,"column":47},"end":{"line":25,"column":1}},"line":12}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":36},"end":{"line":12,"column":45}},"type":"default-arg","locations":[{"start":{"line":12,"column":43},"end":{"line":12,"column":45}}],"line":12},"1":{"loc":{"start":{"line":14,"column":31},"end":{"line":14,"column":89}},"type":"binary-expr","locations":[{"start":{"line":14,"column":32},"end":{"line":14,"column":82}},{"start":{"line":14,"column":87},"end":{"line":14,"column":89}}],"line":14},"2":{"loc":{"start":{"line":14,"column":32},"end":{"line":14,"column":82}},"type":"cond-expr","locations":[{"start":{"line":14,"column":63},"end":{"line":14,"column":69}},{"start":{"line":14,"column":72},"end":{"line":14,"column":82}}],"line":14},"3":{"loc":{"start":{"line":14,"column":32},"end":{"line":14,"column":60}},"type":"binary-expr","locations":[{"start":{"line":14,"column":32},"end":{"line":14,"column":43}},{"start":{"line":14,"column":47},"end":{"line":14,"column":60}}],"line":14},"4":{"loc":{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},"type":"if","locations":[{"start":{"line":15,"column":4},"end":{"line":17,"column":5}},{"start":{"line":15,"column":4},"end":{"line":17,"column":5}}],"line":15},"5":{"loc":{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},"type":"if","locations":[{"start":{"line":18,"column":4},"end":{"line":20,"column":5}},{"start":{"line":18,"column":4},"end":{"line":20,"column":5}}],"line":18},"6":{"loc":{"start":{"line":18,"column":8},"end":{"line":18,"column":208}},"type":"binary-expr","locations":[{"start":{"line":18,"column":8},"end":{"line":18,"column":22}},{"start":{"line":18,"column":26},"end":{"line":18,"column":75}},{"start":{"line":18,"column":80},"end":{"line":18,"column":207}}],"line":18},"7":{"loc":{"start":{"line":18,"column":80},"end":{"line":18,"column":207}},"type":"cond-expr","locations":[{"start":{"line":18,"column":171},"end":{"line":18,"column":177}},{"start":{"line":18,"column":180},"end":{"line":18,"column":207}}],"line":18},"8":{"loc":{"start":{"line":18,"column":80},"end":{"line":18,"column":168}},"type":"binary-expr","locations":[{"start":{"line":18,"column":80},"end":{"line":18,"column":133}},{"start":{"line":18,"column":137},"end":{"line":18,"column":168}}],"line":18}},"s":{"0":1,"1":1,"2":2,"3":1,"4":2,"5":2,"6":0,"7":2,"8":0,"9":2},"f":{"0":2,"1":2},"b":{"0":[2],"1":[2,2],"2":[2,0],"3":[2,2],"4":[0,2],"5":[0,2],"6":[2,0,0],"7":[0,0],"8":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/database/readSecondaryPreferred.ts"],"sourcesContent":["import type { Db, ReadPreferenceLike } from 'mongodb';\nimport { ReadPreference } from 'mongodb';\n\nexport function readSecondaryPreferred(db?: Db, tags: any[] = []): ReadPreferenceLike {\n\tconst { readPreference } = db?.options || {};\n\n\tif (tags.length) {\n\t\treturn new ReadPreference(ReadPreference.SECONDARY_PREFERRED, tags);\n\t}\n\tif (readPreference && readPreference instanceof ReadPreference && readPreference.tags?.length) {\n\t\treturn new ReadPreference(ReadPreference.SECONDARY_PREFERRED, readPreference.tags);\n\t}\n\n\t// For some reason the new ReadPreference definition requires the tags parameter even not been\n\t// required by the code implementation and, for some reason, when passing an empty array it\n\t// doesn't ignore the tags and stop using the secondaries.\n\treturn ReadPreference.SECONDARY_PREFERRED;\n}\n"],"names":["readSecondaryPreferred","db","tags","readPreference","options","length","ReadPreference","SECONDARY_PREFERRED"],"mappings":";;;;+BAGgBA;;;eAAAA;;;yBAFe;AAExB,SAASA,uBAAuBC,EAAO,EAAEC,OAAc,EAAE;QAMGC;IALlE,MAAM,EAAEA,cAAc,EAAE,GAAGF,CAAAA,eAAAA,yBAAAA,GAAIG,OAAO,KAAI,CAAC;IAE3C,IAAIF,KAAKG,MAAM,EAAE;QAChB,OAAO,IAAIC,uBAAc,CAACA,uBAAc,CAACC,mBAAmB,EAAEL;IAC/D;IACA,IAAIC,kBAAkBA,0BAA0BG,uBAAc,MAAIH,uBAAAA,eAAeD,IAAI,cAAnBC,2CAAAA,qBAAqBE,MAAM,GAAE;QAC9F,OAAO,IAAIC,uBAAc,CAACA,uBAAc,CAACC,mBAAmB,EAAEJ,eAAeD,IAAI;IAClF;IAEA,8FAA8F;IAC9F,2FAA2F;IAC3F,0DAA0D;IAC1D,OAAOI,uBAAc,CAACC,mBAAmB;AAC1C","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/database/readSecondaryPreferred.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"cca5808d39da649c71f6201440599f754e18aa29","contentHash":"739f94bd5acf788625d15e62e2d5b36be5e16119e1798683376e5a6f9b804417"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/dataExport/uploadZipFile.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/dataExport/uploadZipFile.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":29}},"3":{"start":{"line":11,"column":12},"end":{"line":11,"column":25}},"4":{"start":{"line":12,"column":18},"end":{"line":12,"column":40}},"5":{"start":{"line":13,"column":16},"end":{"line":13,"column":46}},"6":{"start":{"line":14,"column":16},"end":{"line":14,"column":46}},"7":{"start":{"line":15,"column":16},"end":{"line":15,"column":58}},"8":{"start":{"line":16,"column":22},"end":{"line":39,"column":1}},"9":{"start":{"line":17,"column":24},"end":{"line":17,"column":41}},"10":{"start":{"line":18,"column":21},"end":{"line":18,"column":56}},"11":{"start":{"line":19,"column":17},"end":{"line":19,"column":56}},"12":{"start":{"line":20,"column":26},"end":{"line":20,"column":32}},"13":{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},"14":{"start":{"line":22,"column":8},"end":{"line":22,"column":63}},"15":{"start":{"line":24,"column":20},"end":{"line":24,"column":58}},"16":{"start":{"line":25,"column":23},"end":{"line":25,"column":59}},"17":{"start":{"line":26,"column":19},"end":{"line":26,"column":38}},"18":{"start":{"line":27,"column":24},"end":{"line":27,"column":102}},"19":{"start":{"line":28,"column":20},"end":{"line":34,"column":5}},"20":{"start":{"line":35,"column":19},"end":{"line":35,"column":54}},"21":{"start":{"line":36,"column":26},"end":{"line":36,"column":70}},"22":{"start":{"line":37,"column":17},"end":{"line":37,"column":60}},"23":{"start":{"line":38,"column":4},"end":{"line":38,"column":16}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":16,"column":22},"end":{"line":16,"column":23}},"loc":{"start":{"line":16,"column":60},"end":{"line":39,"column":1}},"line":16}},"branchMap":{"0":{"loc":{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":23,"column":5}},{"start":{"line":21,"column":4},"end":{"line":23,"column":5}}],"line":21},"1":{"loc":{"start":{"line":22,"column":26},"end":{"line":22,"column":62}},"type":"binary-expr","locations":[{"start":{"line":22,"column":26},"end":{"line":22,"column":35}},{"start":{"line":22,"column":39},"end":{"line":22,"column":52}},{"start":{"line":22,"column":56},"end":{"line":22,"column":62}}],"line":22},"2":{"loc":{"start":{"line":25,"column":23},"end":{"line":25,"column":59}},"type":"cond-expr","locations":[{"start":{"line":25,"column":47},"end":{"line":25,"column":54}},{"start":{"line":25,"column":57},"end":{"line":25,"column":59}}],"line":25}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":4,"10":4,"11":4,"12":4,"13":4,"14":3,"15":4,"16":4,"17":4,"18":4,"19":4,"20":4,"21":4,"22":4,"23":4},"f":{"0":1,"1":4},"b":{"0":[3,1],"1":[3,1,0],"2":[1,3]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/dataExport/uploadZipFile.ts"],"sourcesContent":["import { createReadStream } from 'fs';\nimport { stat } from 'fs/promises';\n\nimport type { IUser } from '@rocket.chat/core-typings';\nimport { Users } from '@rocket.chat/models';\nimport { Random } from '@rocket.chat/random';\n\nimport { FileUpload } from '../../../app/file-upload/server';\n\nexport const uploadZipFile = async (filePath: string, userId: IUser['_id'], exportType: 'json' | 'html'): Promise<any> => {\n\tconst contentType = 'application/zip';\n\tconst { size } = await stat(filePath);\n\n\tconst user = await Users.findOneById(userId);\n\tlet userDisplayName = userId;\n\tif (user) {\n\t\tuserDisplayName = user.name || user.username || userId;\n\t}\n\n\tconst utcDate = new Date().toISOString().split('T')[0];\n\tconst fileSuffix = exportType === 'json' ? '-data' : '';\n\tconst fileId = Random.id();\n\n\tconst newFileName = encodeURIComponent(`${utcDate}-${userDisplayName}${fileSuffix}-${fileId}.zip`);\n\n\tconst details = {\n\t\t_id: fileId,\n\t\tuserId,\n\t\ttype: contentType,\n\t\tsize,\n\t\tname: newFileName,\n\t};\n\n\tconst stream = createReadStream(filePath);\n\n\tconst userDataStore = FileUpload.getStore('UserDataFiles');\n\n\tconst file = await userDataStore.insert(details, stream);\n\n\treturn file;\n};\n"],"names":["uploadZipFile","filePath","userId","exportType","contentType","size","stat","user","Users","findOneById","userDisplayName","name","username","utcDate","Date","toISOString","split","fileSuffix","fileId","Random","id","newFileName","encodeURIComponent","details","_id","type","stream","createReadStream","userDataStore","FileUpload","getStore","file","insert"],"mappings":";;;;+BASaA;;;eAAAA;;;oBAToB;0BACZ;wBAGC;wBACC;wBAEI;AAEpB,MAAMA,gBAAgB,OAAOC,UAAkBC,QAAsBC;IAC3E,MAAMC,cAAc;IACpB,MAAM,EAAEC,IAAI,EAAE,GAAG,MAAMC,IAAAA,cAAI,EAACL;IAE5B,MAAMM,OAAO,MAAMC,aAAK,CAACC,WAAW,CAACP;IACrC,IAAIQ,kBAAkBR;IACtB,IAAIK,MAAM;QACTG,kBAAkBH,KAAKI,IAAI,IAAIJ,KAAKK,QAAQ,IAAIV;IACjD;IAEA,MAAMW,UAAU,IAAIC,OAAOC,WAAW,GAAGC,KAAK,CAAC,IAAI,CAAC,EAAE;IACtD,MAAMC,aAAad,eAAe,SAAS,UAAU;IACrD,MAAMe,SAASC,cAAM,CAACC,EAAE;IAExB,MAAMC,cAAcC,mBAAmB,GAAGT,QAAQ,CAAC,EAAEH,kBAAkBO,WAAW,CAAC,EAAEC,OAAO,IAAI,CAAC;IAEjG,MAAMK,UAAU;QACfC,KAAKN;QACLhB;QACAuB,MAAMrB;QACNC;QACAM,MAAMU;IACP;IAEA,MAAMK,SAASC,IAAAA,oBAAgB,EAAC1B;IAEhC,MAAM2B,gBAAgBC,kBAAU,CAACC,QAAQ,CAAC;IAE1C,MAAMC,OAAO,MAAMH,cAAcI,MAAM,CAACT,SAASG;IAEjD,OAAOK;AACR","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/dataExport/uploadZipFile.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7e2cabe2bbcc93cc5842518731882723ab709911","contentHash":"c32b4394c76b0b34f277dfb3ed6db2cd9d3ffccee0e9db7d9ba791ca6ea95e0b"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/parseMessageSearchQuery.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/parseMessageSearchQuery.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":39}},"3":{"start":{"line":11,"column":23},"end":{"line":11,"column":61}},"4":{"start":{"line":12,"column":31},"end":{"line":244,"column":1}},"5":{"start":{"line":14,"column":21},"end":{"line":14,"column":23}},"6":{"start":{"line":15,"column":8},"end":{"line":26,"column":11}},"7":{"start":{"line":17,"column":12},"end":{"line":19,"column":13}},"8":{"start":{"line":18,"column":16},"end":{"line":18,"column":46}},"9":{"start":{"line":20,"column":12},"end":{"line":20,"column":32}},"10":{"start":{"line":21,"column":12},"end":{"line":24,"column":14}},"11":{"start":{"line":25,"column":12},"end":{"line":25,"column":22}},"12":{"start":{"line":29,"column":25},"end":{"line":29,"column":27}},"13":{"start":{"line":30,"column":8},"end":{"line":37,"column":11}},"14":{"start":{"line":31,"column":12},"end":{"line":31,"column":36}},"15":{"start":{"line":32,"column":12},"end":{"line":35,"column":14}},"16":{"start":{"line":36,"column":12},"end":{"line":36,"column":22}},"17":{"start":{"line":42,"column":8},"end":{"line":48,"column":11}},"18":{"start":{"line":44,"column":12},"end":{"line":46,"column":13}},"19":{"start":{"line":45,"column":16},"end":{"line":45,"column":58}},"20":{"start":{"line":47,"column":12},"end":{"line":47,"column":22}},"21":{"start":{"line":53,"column":8},"end":{"line":58,"column":11}},"22":{"start":{"line":54,"column":12},"end":{"line":56,"column":14}},"23":{"start":{"line":57,"column":12},"end":{"line":57,"column":22}},"24":{"start":{"line":63,"column":8},"end":{"line":66,"column":11}},"25":{"start":{"line":64,"column":12},"end":{"line":64,"column":37}},"26":{"start":{"line":65,"column":12},"end":{"line":65,"column":22}},"27":{"start":{"line":71,"column":8},"end":{"line":76,"column":11}},"28":{"start":{"line":72,"column":12},"end":{"line":74,"column":14}},"29":{"start":{"line":75,"column":12},"end":{"line":75,"column":22}},"30":{"start":{"line":81,"column":8},"end":{"line":87,"column":11}},"31":{"start":{"line":82,"column":12},"end":{"line":85,"column":14}},"32":{"start":{"line":86,"column":12},"end":{"line":86,"column":22}},"33":{"start":{"line":92,"column":8},"end":{"line":98,"column":11}},"34":{"start":{"line":93,"column":12},"end":{"line":96,"column":14}},"35":{"start":{"line":97,"column":12},"end":{"line":97,"column":22}},"36":{"start":{"line":103,"column":8},"end":{"line":109,"column":11}},"37":{"start":{"line":104,"column":12},"end":{"line":107,"column":14}},"38":{"start":{"line":108,"column":12},"end":{"line":108,"column":22}},"39":{"start":{"line":114,"column":8},"end":{"line":124,"column":11}},"40":{"start":{"line":116,"column":31},"end":{"line":116,"column":103}},"41":{"start":{"line":118,"column":12},"end":{"line":118,"column":290}},"42":{"start":{"line":119,"column":12},"end":{"line":122,"column":14}},"43":{"start":{"line":123,"column":12},"end":{"line":123,"column":22}},"44":{"start":{"line":129,"column":8},"end":{"line":139,"column":11}},"45":{"start":{"line":131,"column":30},"end":{"line":131,"column":106}},"46":{"start":{"line":133,"column":12},"end":{"line":133,"column":287}},"47":{"start":{"line":134,"column":12},"end":{"line":137,"column":14}},"48":{"start":{"line":138,"column":12},"end":{"line":138,"column":22}},"49":{"start":{"line":144,"column":8},"end":{"line":156,"column":11}},"50":{"start":{"line":146,"column":25},"end":{"line":146,"column":97}},"51":{"start":{"line":148,"column":12},"end":{"line":148,"column":272}},"52":{"start":{"line":149,"column":29},"end":{"line":149,"column":43}},"53":{"start":{"line":150,"column":12},"end":{"line":150,"column":53}},"54":{"start":{"line":151,"column":12},"end":{"line":154,"column":14}},"55":{"start":{"line":155,"column":12},"end":{"line":155,"column":22}},"56":{"start":{"line":161,"column":8},"end":{"line":174,"column":11}},"57":{"start":{"line":162,"column":12},"end":{"line":172,"column":13}},"58":{"start":{"line":163,"column":16},"end":{"line":166,"column":18}},"59":{"start":{"line":167,"column":19},"end":{"line":172,"column":13}},"60":{"start":{"line":168,"column":16},"end":{"line":171,"column":18}},"61":{"start":{"line":173,"column":12},"end":{"line":173,"column":22}},"62":{"start":{"line":179,"column":8},"end":{"line":179,"column":49}},"63":{"start":{"line":180,"column":8},"end":{"line":182,"column":9}},"64":{"start":{"line":181,"column":12},"end":{"line":181,"column":24}},"65":{"start":{"line":183,"column":8},"end":{"line":203,"column":9}},"66":{"start":{"line":184,"column":22},"end":{"line":184,"column":37}},"67":{"start":{"line":185,"column":12},"end":{"line":188,"column":14}},"68":{"start":{"line":189,"column":15},"end":{"line":203,"column":9}},"69":{"start":{"line":190,"column":12},"end":{"line":193,"column":14}},"70":{"start":{"line":195,"column":12},"end":{"line":197,"column":14}},"71":{"start":{"line":198,"column":12},"end":{"line":202,"column":14}},"72":{"start":{"line":204,"column":8},"end":{"line":204,"column":20}},"73":{"start":{"line":207,"column":8},"end":{"line":222,"column":45}},"74":{"start":{"line":208,"column":21},"end":{"line":208,"column":44}},"75":{"start":{"line":209,"column":21},"end":{"line":209,"column":47}},"76":{"start":{"line":210,"column":21},"end":{"line":210,"column":47}},"77":{"start":{"line":211,"column":21},"end":{"line":211,"column":46}},"78":{"start":{"line":212,"column":21},"end":{"line":212,"column":48}},"79":{"start":{"line":213,"column":21},"end":{"line":213,"column":51}},"80":{"start":{"line":214,"column":21},"end":{"line":214,"column":45}},"81":{"start":{"line":215,"column":21},"end":{"line":215,"column":55}},"82":{"start":{"line":216,"column":21},"end":{"line":216,"column":49}},"83":{"start":{"line":217,"column":21},"end":{"line":217,"column":46}},"84":{"start":{"line":218,"column":21},"end":{"line":218,"column":45}},"85":{"start":{"line":219,"column":21},"end":{"line":219,"column":42}},"86":{"start":{"line":220,"column":21},"end":{"line":220,"column":45}},"87":{"start":{"line":221,"column":21},"end":{"line":221,"column":51}},"88":{"start":{"line":222,"column":29},"end":{"line":222,"column":37}},"89":{"start":{"line":223,"column":8},"end":{"line":226,"column":10}},"90":{"start":{"line":229,"column":8},"end":{"line":229,"column":24}},"91":{"start":{"line":230,"column":8},"end":{"line":237,"column":10}},"92":{"start":{"line":238,"column":8},"end":{"line":238,"column":32}},"93":{"start":{"line":239,"column":8},"end":{"line":239,"column":25}},"94":{"start":{"line":240,"column":8},"end":{"line":240,"column":35}},"95":{"start":{"line":241,"column":8},"end":{"line":241,"column":35}},"96":{"start":{"line":242,"column":8},"end":{"line":242,"column":37}},"97":{"start":{"line":246,"column":19},"end":{"line":251,"column":6}},"98":{"start":{"line":252,"column":4},"end":{"line":252,"column":30}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":13,"column":4},"end":{"line":13,"column":5}},"loc":{"start":{"line":13,"column":22},"end":{"line":27,"column":5}},"line":13},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":54},"end":{"line":15,"column":55}},"loc":{"start":{"line":15,"column":69},"end":{"line":26,"column":9}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":28,"column":4},"end":{"line":28,"column":5}},"loc":{"start":{"line":28,"column":25},"end":{"line":38,"column":5}},"line":28},"4":{"name":"(anonymous_4)","decl":{"start":{"line":30,"column":57},"end":{"line":30,"column":58}},"loc":{"start":{"line":30,"column":72},"end":{"line":37,"column":9}},"line":30},"5":{"name":"(anonymous_5)","decl":{"start":{"line":41,"column":5},"end":{"line":41,"column":6}},"loc":{"start":{"line":41,"column":26},"end":{"line":49,"column":5}},"line":41},"6":{"name":"(anonymous_6)","decl":{"start":{"line":42,"column":41},"end":{"line":42,"column":42}},"loc":{"start":{"line":42,"column":45},"end":{"line":48,"column":9}},"line":42},"7":{"name":"(anonymous_7)","decl":{"start":{"line":52,"column":5},"end":{"line":52,"column":6}},"loc":{"start":{"line":52,"column":25},"end":{"line":59,"column":5}},"line":52},"8":{"name":"(anonymous_8)","decl":{"start":{"line":53,"column":49},"end":{"line":53,"column":50}},"loc":{"start":{"line":53,"column":53},"end":{"line":58,"column":9}},"line":53},"9":{"name":"(anonymous_9)","decl":{"start":{"line":62,"column":5},"end":{"line":62,"column":6}},"loc":{"start":{"line":62,"column":27},"end":{"line":67,"column":5}},"line":62},"10":{"name":"(anonymous_10)","decl":{"start":{"line":63,"column":50},"end":{"line":63,"column":51}},"loc":{"start":{"line":63,"column":54},"end":{"line":66,"column":9}},"line":63},"11":{"name":"(anonymous_11)","decl":{"start":{"line":70,"column":5},"end":{"line":70,"column":6}},"loc":{"start":{"line":70,"column":30},"end":{"line":77,"column":5}},"line":70},"12":{"name":"(anonymous_12)","decl":{"start":{"line":71,"column":53},"end":{"line":71,"column":54}},"loc":{"start":{"line":71,"column":57},"end":{"line":76,"column":9}},"line":71},"13":{"name":"(anonymous_13)","decl":{"start":{"line":80,"column":5},"end":{"line":80,"column":6}},"loc":{"start":{"line":80,"column":24},"end":{"line":88,"column":5}},"line":80},"14":{"name":"(anonymous_14)","decl":{"start":{"line":81,"column":44},"end":{"line":81,"column":45}},"loc":{"start":{"line":81,"column":54},"end":{"line":87,"column":9}},"line":81},"15":{"name":"(anonymous_15)","decl":{"start":{"line":91,"column":5},"end":{"line":91,"column":6}},"loc":{"start":{"line":91,"column":34},"end":{"line":99,"column":5}},"line":91},"16":{"name":"(anonymous_16)","decl":{"start":{"line":92,"column":48},"end":{"line":92,"column":49}},"loc":{"start":{"line":92,"column":58},"end":{"line":98,"column":9}},"line":92},"17":{"name":"(anonymous_17)","decl":{"start":{"line":102,"column":5},"end":{"line":102,"column":6}},"loc":{"start":{"line":102,"column":28},"end":{"line":110,"column":5}},"line":102},"18":{"name":"(anonymous_18)","decl":{"start":{"line":103,"column":49},"end":{"line":103,"column":50}},"loc":{"start":{"line":103,"column":59},"end":{"line":109,"column":9}},"line":103},"19":{"name":"(anonymous_19)","decl":{"start":{"line":113,"column":5},"end":{"line":113,"column":6}},"loc":{"start":{"line":113,"column":25},"end":{"line":125,"column":5}},"line":113},"20":{"name":"(anonymous_20)","decl":{"start":{"line":114,"column":79},"end":{"line":114,"column":80}},"loc":{"start":{"line":114,"column":102},"end":{"line":124,"column":9}},"line":114},"21":{"name":"(anonymous_21)","decl":{"start":{"line":128,"column":5},"end":{"line":128,"column":6}},"loc":{"start":{"line":128,"column":24},"end":{"line":140,"column":5}},"line":128},"22":{"name":"(anonymous_22)","decl":{"start":{"line":129,"column":78},"end":{"line":129,"column":79}},"loc":{"start":{"line":129,"column":101},"end":{"line":139,"column":9}},"line":129},"23":{"name":"(anonymous_23)","decl":{"start":{"line":143,"column":5},"end":{"line":143,"column":6}},"loc":{"start":{"line":143,"column":21},"end":{"line":157,"column":5}},"line":143},"24":{"name":"(anonymous_24)","decl":{"start":{"line":144,"column":75},"end":{"line":144,"column":76}},"loc":{"start":{"line":144,"column":98},"end":{"line":156,"column":9}},"line":144},"25":{"name":"(anonymous_25)","decl":{"start":{"line":160,"column":5},"end":{"line":160,"column":6}},"loc":{"start":{"line":160,"column":24},"end":{"line":175,"column":5}},"line":160},"26":{"name":"(anonymous_26)","decl":{"start":{"line":161,"column":94},"end":{"line":161,"column":95}},"loc":{"start":{"line":161,"column":110},"end":{"line":174,"column":9}},"line":161},"27":{"name":"(anonymous_27)","decl":{"start":{"line":178,"column":5},"end":{"line":178,"column":6}},"loc":{"start":{"line":178,"column":30},"end":{"line":205,"column":5}},"line":178},"28":{"name":"(anonymous_28)","decl":{"start":{"line":206,"column":4},"end":{"line":206,"column":5}},"loc":{"start":{"line":206,"column":16},"end":{"line":227,"column":5}},"line":206},"29":{"name":"(anonymous_29)","decl":{"start":{"line":208,"column":12},"end":{"line":208,"column":13}},"loc":{"start":{"line":208,"column":21},"end":{"line":208,"column":44}},"line":208},"30":{"name":"(anonymous_30)","decl":{"start":{"line":209,"column":12},"end":{"line":209,"column":13}},"loc":{"start":{"line":209,"column":21},"end":{"line":209,"column":47}},"line":209},"31":{"name":"(anonymous_31)","decl":{"start":{"line":210,"column":12},"end":{"line":210,"column":13}},"loc":{"start":{"line":210,"column":21},"end":{"line":210,"column":47}},"line":210},"32":{"name":"(anonymous_32)","decl":{"start":{"line":211,"column":12},"end":{"line":211,"column":13}},"loc":{"start":{"line":211,"column":21},"end":{"line":211,"column":46}},"line":211},"33":{"name":"(anonymous_33)","decl":{"start":{"line":212,"column":12},"end":{"line":212,"column":13}},"loc":{"start":{"line":212,"column":21},"end":{"line":212,"column":48}},"line":212},"34":{"name":"(anonymous_34)","decl":{"start":{"line":213,"column":12},"end":{"line":213,"column":13}},"loc":{"start":{"line":213,"column":21},"end":{"line":213,"column":51}},"line":213},"35":{"name":"(anonymous_35)","decl":{"start":{"line":214,"column":12},"end":{"line":214,"column":13}},"loc":{"start":{"line":214,"column":21},"end":{"line":214,"column":45}},"line":214},"36":{"name":"(anonymous_36)","decl":{"start":{"line":215,"column":12},"end":{"line":215,"column":13}},"loc":{"start":{"line":215,"column":21},"end":{"line":215,"column":55}},"line":215},"37":{"name":"(anonymous_37)","decl":{"start":{"line":216,"column":12},"end":{"line":216,"column":13}},"loc":{"start":{"line":216,"column":21},"end":{"line":216,"column":49}},"line":216},"38":{"name":"(anonymous_38)","decl":{"start":{"line":217,"column":12},"end":{"line":217,"column":13}},"loc":{"start":{"line":217,"column":21},"end":{"line":217,"column":46}},"line":217},"39":{"name":"(anonymous_39)","decl":{"start":{"line":218,"column":12},"end":{"line":218,"column":13}},"loc":{"start":{"line":218,"column":21},"end":{"line":218,"column":45}},"line":218},"40":{"name":"(anonymous_40)","decl":{"start":{"line":219,"column":12},"end":{"line":219,"column":13}},"loc":{"start":{"line":219,"column":21},"end":{"line":219,"column":42}},"line":219},"41":{"name":"(anonymous_41)","decl":{"start":{"line":220,"column":12},"end":{"line":220,"column":13}},"loc":{"start":{"line":220,"column":21},"end":{"line":220,"column":45}},"line":220},"42":{"name":"(anonymous_42)","decl":{"start":{"line":221,"column":12},"end":{"line":221,"column":13}},"loc":{"start":{"line":221,"column":21},"end":{"line":221,"column":51}},"line":221},"43":{"name":"(anonymous_43)","decl":{"start":{"line":222,"column":17},"end":{"line":222,"column":18}},"loc":{"start":{"line":222,"column":29},"end":{"line":222,"column":37}},"line":222},"44":{"name":"(anonymous_44)","decl":{"start":{"line":228,"column":4},"end":{"line":228,"column":5}},"loc":{"start":{"line":228,"column":69},"end":{"line":243,"column":5}},"line":228},"45":{"name":"parseMessageSearchQuery","decl":{"start":{"line":245,"column":9},"end":{"line":245,"column":32}},"loc":{"start":{"line":245,"column":93},"end":{"line":253,"column":1}},"line":245}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":12},"end":{"line":19,"column":13}},"type":"if","locations":[{"start":{"line":17,"column":12},"end":{"line":19,"column":13}},{"start":{"line":17,"column":12},"end":{"line":19,"column":13}}],"line":17},"1":{"loc":{"start":{"line":17,"column":16},"end":{"line":17,"column":166}},"type":"binary-expr","locations":[{"start":{"line":17,"column":16},"end":{"line":17,"column":33}},{"start":{"line":17,"column":38},"end":{"line":17,"column":127}},{"start":{"line":17,"column":132},"end":{"line":17,"column":166}}],"line":17},"2":{"loc":{"start":{"line":17,"column":38},"end":{"line":17,"column":127}},"type":"cond-expr","locations":[{"start":{"line":17,"column":99},"end":{"line":17,"column":105}},{"start":{"line":17,"column":108},"end":{"line":17,"column":127}}],"line":17},"3":{"loc":{"start":{"line":17,"column":38},"end":{"line":17,"column":96}},"type":"binary-expr","locations":[{"start":{"line":17,"column":38},"end":{"line":17,"column":71}},{"start":{"line":17,"column":75},"end":{"line":17,"column":96}}],"line":17},"4":{"loc":{"start":{"line":44,"column":12},"end":{"line":46,"column":13}},"type":"if","locations":[{"start":{"line":44,"column":12},"end":{"line":46,"column":13}},{"start":{"line":44,"column":12},"end":{"line":46,"column":13}}],"line":44},"5":{"loc":{"start":{"line":44,"column":16},"end":{"line":44,"column":100}},"type":"cond-expr","locations":[{"start":{"line":44,"column":77},"end":{"line":44,"column":83}},{"start":{"line":44,"column":86},"end":{"line":44,"column":100}}],"line":44},"6":{"loc":{"start":{"line":44,"column":16},"end":{"line":44,"column":74}},"type":"binary-expr","locations":[{"start":{"line":44,"column":16},"end":{"line":44,"column":49}},{"start":{"line":44,"column":53},"end":{"line":44,"column":74}}],"line":44},"7":{"loc":{"start":{"line":118,"column":101},"end":{"line":118,"column":287}},"type":"cond-expr","locations":[{"start":{"line":118,"column":263},"end":{"line":118,"column":283}},{"start":{"line":118,"column":286},"end":{"line":118,"column":287}}],"line":118},"8":{"loc":{"start":{"line":118,"column":101},"end":{"line":118,"column":260}},"type":"binary-expr","locations":[{"start":{"line":118,"column":101},"end":{"line":118,"column":225}},{"start":{"line":118,"column":229},"end":{"line":118,"column":260}}],"line":118},"9":{"loc":{"start":{"line":118,"column":125},"end":{"line":118,"column":215}},"type":"cond-expr","locations":[{"start":{"line":118,"column":186},"end":{"line":118,"column":192}},{"start":{"line":118,"column":195},"end":{"line":118,"column":215}}],"line":118},"10":{"loc":{"start":{"line":118,"column":125},"end":{"line":118,"column":183}},"type":"binary-expr","locations":[{"start":{"line":118,"column":125},"end":{"line":118,"column":158}},{"start":{"line":118,"column":162},"end":{"line":118,"column":183}}],"line":118},"11":{"loc":{"start":{"line":133,"column":98},"end":{"line":133,"column":284}},"type":"cond-expr","locations":[{"start":{"line":133,"column":260},"end":{"line":133,"column":280}},{"start":{"line":133,"column":283},"end":{"line":133,"column":284}}],"line":133},"12":{"loc":{"start":{"line":133,"column":98},"end":{"line":133,"column":257}},"type":"binary-expr","locations":[{"start":{"line":133,"column":98},"end":{"line":133,"column":222}},{"start":{"line":133,"column":226},"end":{"line":133,"column":257}}],"line":133},"13":{"loc":{"start":{"line":133,"column":122},"end":{"line":133,"column":212}},"type":"cond-expr","locations":[{"start":{"line":133,"column":183},"end":{"line":133,"column":189}},{"start":{"line":133,"column":192},"end":{"line":133,"column":212}}],"line":133},"14":{"loc":{"start":{"line":133,"column":122},"end":{"line":133,"column":180}},"type":"binary-expr","locations":[{"start":{"line":133,"column":122},"end":{"line":133,"column":155}},{"start":{"line":133,"column":159},"end":{"line":133,"column":180}}],"line":133},"15":{"loc":{"start":{"line":148,"column":83},"end":{"line":148,"column":269}},"type":"cond-expr","locations":[{"start":{"line":148,"column":245},"end":{"line":148,"column":265}},{"start":{"line":148,"column":268},"end":{"line":148,"column":269}}],"line":148},"16":{"loc":{"start":{"line":148,"column":83},"end":{"line":148,"column":242}},"type":"binary-expr","locations":[{"start":{"line":148,"column":83},"end":{"line":148,"column":207}},{"start":{"line":148,"column":211},"end":{"line":148,"column":242}}],"line":148},"17":{"loc":{"start":{"line":148,"column":107},"end":{"line":148,"column":197}},"type":"cond-expr","locations":[{"start":{"line":148,"column":168},"end":{"line":148,"column":174}},{"start":{"line":148,"column":177},"end":{"line":148,"column":197}}],"line":148},"18":{"loc":{"start":{"line":148,"column":107},"end":{"line":148,"column":165}},"type":"binary-expr","locations":[{"start":{"line":148,"column":107},"end":{"line":148,"column":140}},{"start":{"line":148,"column":144},"end":{"line":148,"column":165}}],"line":148},"19":{"loc":{"start":{"line":162,"column":12},"end":{"line":172,"column":13}},"type":"if","locations":[{"start":{"line":162,"column":12},"end":{"line":172,"column":13}},{"start":{"line":162,"column":12},"end":{"line":172,"column":13}}],"line":162},"20":{"loc":{"start":{"line":164,"column":23},"end":{"line":164,"column":122}},"type":"cond-expr","locations":[{"start":{"line":164,"column":100},"end":{"line":164,"column":117}},{"start":{"line":164,"column":120},"end":{"line":164,"column":122}}],"line":164},"21":{"loc":{"start":{"line":164,"column":23},"end":{"line":164,"column":97}},"type":"binary-expr","locations":[{"start":{"line":164,"column":23},"end":{"line":164,"column":60}},{"start":{"line":164,"column":64},"end":{"line":164,"column":97}}],"line":164},"22":{"loc":{"start":{"line":167,"column":19},"end":{"line":172,"column":13}},"type":"if","locations":[{"start":{"line":167,"column":19},"end":{"line":172,"column":13}},{"start":{"line":167,"column":19},"end":{"line":172,"column":13}}],"line":167},"23":{"loc":{"start":{"line":169,"column":23},"end":{"line":169,"column":122}},"type":"cond-expr","locations":[{"start":{"line":169,"column":100},"end":{"line":169,"column":117}},{"start":{"line":169,"column":120},"end":{"line":169,"column":122}}],"line":169},"24":{"loc":{"start":{"line":169,"column":23},"end":{"line":169,"column":97}},"type":"binary-expr","locations":[{"start":{"line":169,"column":23},"end":{"line":169,"column":60}},{"start":{"line":169,"column":64},"end":{"line":169,"column":97}}],"line":169},"25":{"loc":{"start":{"line":180,"column":8},"end":{"line":182,"column":9}},"type":"if","locations":[{"start":{"line":180,"column":8},"end":{"line":182,"column":9}},{"start":{"line":180,"column":8},"end":{"line":182,"column":9}}],"line":180},"26":{"loc":{"start":{"line":183,"column":8},"end":{"line":203,"column":9}},"type":"if","locations":[{"start":{"line":183,"column":8},"end":{"line":203,"column":9}},{"start":{"line":183,"column":8},"end":{"line":203,"column":9}}],"line":183},"27":{"loc":{"start":{"line":189,"column":15},"end":{"line":203,"column":9}},"type":"if","locations":[{"start":{"line":189,"column":15},"end":{"line":203,"column":9}},{"start":{"line":189,"column":15},"end":{"line":203,"column":9}}],"line":189},"28":{"loc":{"start":{"line":228,"column":24},"end":{"line":228,"column":34}},"type":"default-arg","locations":[{"start":{"line":228,"column":33},"end":{"line":228,"column":34}}],"line":228},"29":{"loc":{"start":{"line":228,"column":36},"end":{"line":228,"column":46}},"type":"default-arg","locations":[{"start":{"line":228,"column":44},"end":{"line":228,"column":46}}],"line":228},"30":{"loc":{"start":{"line":228,"column":48},"end":{"line":228,"column":66}},"type":"default-arg","locations":[{"start":{"line":228,"column":61},"end":{"line":228,"column":66}}],"line":228},"31":{"loc":{"start":{"line":245,"column":47},"end":{"line":245,"column":57}},"type":"default-arg","locations":[{"start":{"line":245,"column":56},"end":{"line":245,"column":57}}],"line":245},"32":{"loc":{"start":{"line":245,"column":59},"end":{"line":245,"column":69}},"type":"default-arg","locations":[{"start":{"line":245,"column":67},"end":{"line":245,"column":69}}],"line":245},"33":{"loc":{"start":{"line":245,"column":71},"end":{"line":245,"column":89}},"type":"default-arg","locations":[{"start":{"line":245,"column":84},"end":{"line":245,"column":89}}],"line":245}},"s":{"0":1,"1":1,"2":17,"3":1,"4":1,"5":17,"6":17,"7":1,"8":0,"9":1,"10":1,"11":1,"12":17,"13":17,"14":1,"15":1,"16":1,"17":17,"18":1,"19":1,"20":1,"21":17,"22":2,"23":2,"24":17,"25":2,"26":2,"27":17,"28":2,"29":2,"30":17,"31":3,"32":3,"33":17,"34":1,"35":1,"36":17,"37":1,"38":1,"39":17,"40":1,"41":1,"42":1,"43":1,"44":17,"45":1,"46":1,"47":1,"48":1,"49":17,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":17,"57":1,"58":1,"59":0,"60":0,"61":1,"62":17,"63":17,"64":15,"65":2,"66":0,"67":0,"68":2,"69":0,"70":2,"71":2,"72":2,"73":17,"74":17,"75":17,"76":17,"77":17,"78":17,"79":17,"80":17,"81":17,"82":17,"83":17,"84":17,"85":17,"86":17,"87":17,"88":238,"89":17,"90":17,"91":17,"92":17,"93":17,"94":17,"95":17,"96":17,"97":17,"98":17},"f":{"0":17,"1":17,"2":1,"3":17,"4":1,"5":17,"6":1,"7":17,"8":2,"9":17,"10":2,"11":17,"12":2,"13":17,"14":3,"15":17,"16":1,"17":17,"18":1,"19":17,"20":1,"21":17,"22":1,"23":17,"24":1,"25":17,"26":1,"27":17,"28":17,"29":17,"30":17,"31":17,"32":17,"33":17,"34":17,"35":17,"36":17,"37":17,"38":17,"39":17,"40":17,"41":17,"42":17,"43":238,"44":17,"45":17},"b":{"0":[0,1],"1":[1,0,0],"2":[0,0],"3":[0,0],"4":[1,0],"5":[0,1],"6":[1,1],"7":[0,1],"8":[1,1],"9":[0,1],"10":[1,1],"11":[0,1],"12":[1,1],"13":[0,1],"14":[1,1],"15":[0,1],"16":[1,1],"17":[0,1],"18":[1,1],"19":[1,0],"20":[1,0],"21":[1,1],"22":[0,0],"23":[0,0],"24":[0,0],"25":[15,2],"26":[0,2],"27":[0,2],"28":[0],"29":[0],"30":[0],"31":[17],"32":[17],"33":[17]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/parseMessageSearchQuery.ts"],"sourcesContent":["import type { IMessage, IUser } from '@rocket.chat/core-typings';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\nimport type { Filter, FindOptions } from 'mongodb';\n\nclass MessageSearchQueryParser {\n\tprivate query: Exclude<Filter<IMessage>, Partial<IMessage>> = {};\n\n\tprivate options: FindOptions<IMessage> = {\n\t\tprojection: {},\n\t\tsort: {\n\t\t\tts: -1,\n\t\t},\n\t\tskip: 0,\n\t\tlimit: 20,\n\t};\n\n\tprivate user: IUser | undefined;\n\n\tprivate forceRegex = false;\n\n\tconstructor({\n\t\tuser,\n\t\toffset = 0,\n\t\tlimit = 20,\n\t\tforceRegex = false,\n\t}: {\n\t\tuser?: IUser;\n\t\toffset?: number;\n\t\tlimit?: number;\n\t\tforceRegex?: boolean;\n\t}) {\n\t\tthis.user = user;\n\t\tthis.options.skip = offset;\n\t\tthis.options.limit = limit;\n\t\tthis.forceRegex = forceRegex;\n\t}\n\n\tprivate consumeFrom(text: string) {\n\t\tconst from: string[] = [];\n\n\t\treturn text.replace(/from:([a-z0-9.\\-_]+)/gi, (_, username) => {\n\t\t\tif (username === 'me' && this.user?.username && !from.includes(this.user.username)) {\n\t\t\t\tusername = this.user.username;\n\t\t\t}\n\t\t\tfrom.push(username);\n\n\t\t\tthis.query['u.username'] = {\n\t\t\t\t$regex: from.join('|'),\n\t\t\t\t$options: 'i',\n\t\t\t};\n\n\t\t\treturn '';\n\t\t});\n\t}\n\n\tprivate consumeMention(text: string) {\n\t\tconst mentions: string[] = [];\n\n\t\treturn text.replace(/mention:([a-z0-9.\\-_]+)/gi, (_: string, username: string) => {\n\t\t\tmentions.push(username);\n\n\t\t\tthis.query['mentions.username'] = {\n\t\t\t\t$regex: mentions.join('|'),\n\t\t\t\t$options: 'i',\n\t\t\t};\n\n\t\t\treturn '';\n\t\t});\n\t}\n\n\t/**\n\t * Filter on messages that are starred by the current user.\n\t */\n\tprivate consumeHasStar(text: string) {\n\t\treturn text.replace(/has:star/g, () => {\n\t\t\tif (this.user?._id) {\n\t\t\t\tthis.query['starred._id'] = this.user._id;\n\t\t\t}\n\t\t\treturn '';\n\t\t});\n\t}\n\n\t/**\n\t * Filter on messages that have an url.\n\t */\n\tprivate consumeHasUrl(text: string) {\n\t\treturn text.replace(/has:url|has:link/g, () => {\n\t\t\tthis.query['urls.0'] = {\n\t\t\t\t$exists: true,\n\t\t\t};\n\t\t\treturn '';\n\t\t});\n\t}\n\n\t/**\n\t * Filter on pinned messages.\n\t */\n\tprivate consumeIsPinned(text: string) {\n\t\treturn text.replace(/is:pinned|has:pin/g, () => {\n\t\t\tthis.query.pinned = true;\n\t\t\treturn '';\n\t\t});\n\t}\n\n\t/**\n\t * Filter on messages which have a location attached.\n\t */\n\tprivate consumeHasLocation(text: string) {\n\t\treturn text.replace(/has:location|has:map/g, () => {\n\t\t\tthis.query.location = {\n\t\t\t\t$exists: true,\n\t\t\t};\n\t\t\treturn '';\n\t\t});\n\t}\n\n\t/**\n\t * Filter image tags\n\t */\n\tprivate consumeLabel(text: string) {\n\t\treturn text.replace(/label:(\\w+)/g, (_: string, tag: string) => {\n\t\t\tthis.query['attachments.0.labels'] = {\n\t\t\t\t$regex: escapeRegExp(tag),\n\t\t\t\t$options: 'i',\n\t\t\t};\n\t\t\treturn '';\n\t\t});\n\t}\n\n\t/**\n\t * Filter on description of messages.\n\t */\n\tprivate consumeFileDescription(text: string) {\n\t\treturn text.replace(/file-desc:(\\w+)/g, (_: string, tag: string) => {\n\t\t\tthis.query['attachments.description'] = {\n\t\t\t\t$regex: escapeRegExp(tag),\n\t\t\t\t$options: 'i',\n\t\t\t};\n\t\t\treturn '';\n\t\t});\n\t}\n\n\t/**\n\t * Filter on title of messages.\n\t */\n\tprivate consumeFileTitle(text: string) {\n\t\treturn text.replace(/file-title:(\\w+)/g, (_: string, tag: string) => {\n\t\t\tthis.query['attachments.title'] = {\n\t\t\t\t$regex: escapeRegExp(tag),\n\t\t\t\t$options: 'i',\n\t\t\t};\n\n\t\t\treturn '';\n\t\t});\n\t}\n\n\t/**\n\t * Filter on messages that have been sent before a date.\n\t */\n\tprivate consumeBefore(text: string) {\n\t\treturn text.replace(/before:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, (_: string, day: string, month: string, year: string) => {\n\t\t\tconst beforeDate = new Date(parseInt(year, 10), parseInt(month, 10) - 1, parseInt(day, 10));\n\t\t\tbeforeDate.setUTCHours(beforeDate.getUTCHours() + beforeDate.getTimezoneOffset() / 60 + (this.user?.utcOffset ?? 0));\n\n\t\t\tthis.query.ts = {\n\t\t\t\t...this.query.ts,\n\t\t\t\t$lte: beforeDate,\n\t\t\t};\n\n\t\t\treturn '';\n\t\t});\n\t}\n\n\t/**\n\t * Filter on messages that have been sent after a date.\n\t */\n\tprivate consumeAfter(text: string) {\n\t\treturn text.replace(/after:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, (_: string, day: string, month: string, year: string) => {\n\t\t\tconst afterDate = new Date(parseInt(year, 10), parseInt(month, 10) - 1, parseInt(day, 10) + 1);\n\t\t\tafterDate.setUTCHours(afterDate.getUTCHours() + afterDate.getTimezoneOffset() / 60 + (this.user?.utcOffset ?? 0));\n\n\t\t\tthis.query.ts = {\n\t\t\t\t...this.query.ts,\n\t\t\t\t$gte: afterDate,\n\t\t\t};\n\n\t\t\treturn '';\n\t\t});\n\t}\n\n\t/**\n\t * Filter on messages that have been sent on a date.\n\t */\n\tprivate consumeOn(text: string) {\n\t\treturn text.replace(/on:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, (_: string, day: string, month: string, year: string) => {\n\t\t\tconst date = new Date(parseInt(year, 10), parseInt(month, 10) - 1, parseInt(day, 10));\n\t\t\tdate.setUTCHours(date.getUTCHours() + date.getTimezoneOffset() / 60 + (this.user?.utcOffset ?? 0));\n\t\t\tconst dayAfter = new Date(date);\n\t\t\tdayAfter.setDate(dayAfter.getDate() + 1);\n\n\t\t\tthis.query.ts = {\n\t\t\t\t$gte: date,\n\t\t\t\t$lt: dayAfter,\n\t\t\t};\n\n\t\t\treturn '';\n\t\t});\n\t}\n\n\t/**\n\t * Sort by timestamp.\n\t */\n\tconsumeOrder(text: string) {\n\t\treturn text.replace(/(?:order|sort):(asc|ascend|ascending|desc|descend|descending)/g, (_: string, direction: string) => {\n\t\t\tif (direction.startsWith('asc')) {\n\t\t\t\tthis.options.sort = {\n\t\t\t\t\t...(typeof this.options.sort === 'object' && !Array.isArray(this.options.sort) ? this.options.sort : {}),\n\t\t\t\t\tts: 1,\n\t\t\t\t};\n\t\t\t} else if (direction.startsWith('desc')) {\n\t\t\t\tthis.options.sort = {\n\t\t\t\t\t...(typeof this.options.sort === 'object' && !Array.isArray(this.options.sort) ? this.options.sort : {}),\n\t\t\t\t\tts: -1,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn '';\n\t\t});\n\t}\n\n\t/**\n\t * Query in message text\n\t */\n\tprivate consumeMessageText(text: string) {\n\t\ttext = text.trim().replace(/\\s\\s/g, ' ');\n\n\t\tif (text === '') {\n\t\t\treturn text;\n\t\t}\n\n\t\tif (/^\\/.+\\/[imxs]*$/.test(text)) {\n\t\t\tconst r = text.split('/');\n\t\t\tthis.query.msg = {\n\t\t\t\t$regex: r[1],\n\t\t\t\t$options: r[2],\n\t\t\t};\n\t\t} else if (this.forceRegex) {\n\t\t\tthis.query.msg = {\n\t\t\t\t$regex: text,\n\t\t\t\t$options: 'i',\n\t\t\t};\n\t\t} else {\n\t\t\tthis.query.$text = {\n\t\t\t\t$search: text,\n\t\t\t};\n\t\t\tthis.options.projection = {\n\t\t\t\tscore: {\n\t\t\t\t\t$meta: 'textScore',\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\treturn text;\n\t}\n\n\tparse(text: string) {\n\t\t[\n\t\t\t(input: string) => this.consumeFrom(input),\n\t\t\t(input: string) => this.consumeMention(input),\n\t\t\t(input: string) => this.consumeHasStar(input),\n\t\t\t(input: string) => this.consumeHasUrl(input),\n\t\t\t(input: string) => this.consumeIsPinned(input),\n\t\t\t(input: string) => this.consumeHasLocation(input),\n\t\t\t(input: string) => this.consumeLabel(input),\n\t\t\t(input: string) => this.consumeFileDescription(input),\n\t\t\t(input: string) => this.consumeFileTitle(input),\n\t\t\t(input: string) => this.consumeBefore(input),\n\t\t\t(input: string) => this.consumeAfter(input),\n\t\t\t(input: string) => this.consumeOn(input),\n\t\t\t(input: string) => this.consumeOrder(input),\n\t\t\t(input: string) => this.consumeMessageText(input),\n\t\t].reduce((text, fn) => fn(text), text);\n\n\t\treturn {\n\t\t\tquery: this.query,\n\t\t\toptions: this.options,\n\t\t};\n\t}\n}\n\n/**\n * Parses a message search query and returns a MongoDB query and options\n * @param text The query text\n * @param options The options\n * @param options.user The user object\n * @param options.offset The offset\n * @param options.limit The limit\n * @param options.forceRegex Whether to force the use of regex\n * @returns The MongoDB query and options\n * @private\n * @example\n * const { query, options } = parseMessageSearchQuery('from:rocket.cat', {\n * \tuser: await Meteor.userAsync(),\n * \toffset: 0,\n * \tlimit: 20,\n * \tforceRegex: false,\n * });\n */\nexport function parseMessageSearchQuery(\n\ttext: string,\n\t{\n\t\tuser,\n\t\toffset = 0,\n\t\tlimit = 20,\n\t\tforceRegex = false,\n\t}: {\n\t\tuser?: IUser;\n\t\toffset?: number;\n\t\tlimit?: number;\n\t\tforceRegex?: boolean;\n\t},\n) {\n\tconst parser = new MessageSearchQueryParser({ user, offset, limit, forceRegex });\n\treturn parser.parse(text);\n}\n"],"names":["parseMessageSearchQuery","MessageSearchQueryParser","consumeFrom","text","from","replace","_","username","user","includes","push","query","$regex","join","$options","consumeMention","mentions","consumeHasStar","_id","consumeHasUrl","$exists","consumeIsPinned","pinned","consumeHasLocation","location","consumeLabel","tag","escapeRegExp","consumeFileDescription","consumeFileTitle","consumeBefore","day","month","year","beforeDate","Date","parseInt","setUTCHours","getUTCHours","getTimezoneOffset","utcOffset","ts","$lte","consumeAfter","afterDate","$gte","consumeOn","date","dayAfter","setDate","getDate","$lt","consumeOrder","direction","startsWith","options","sort","Array","isArray","consumeMessageText","trim","test","r","split","msg","forceRegex","$text","$search","projection","score","$meta","parse","input","reduce","fn","constructor","offset","limit","skip","parser"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/parseMessageSearchQuery.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"acf058f0a921af013e3f5c4a008506d894f3405b","contentHash":"79bb8d36afafe6b97770b482cf52fbd08b0df61905952dd344569a6ac09cf6fa"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/hooks/beforeNewRoom.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/hooks/beforeNewRoom.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":16},"end":{"line":5,"column":46}},"2":{"start":{"line":6,"column":16},"end":{"line":6,"column":40}},"3":{"start":{"line":7,"column":19},"end":{"line":7,"column":58}},"4":{"start":{"line":8,"column":23},"end":{"line":8,"column":72}},"5":{"start":{"line":9,"column":0},"end":{"line":34,"column":69}},"6":{"start":{"line":10,"column":4},"end":{"line":12,"column":5}},"7":{"start":{"line":11,"column":8},"end":{"line":11,"column":24}},"8":{"start":{"line":13,"column":46},"end":{"line":13,"column":55}},"9":{"start":{"line":14,"column":34},"end":{"line":19,"column":5}},"10":{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},"11":{"start":{"line":21,"column":8},"end":{"line":21,"column":37}},"12":{"start":{"line":23,"column":16},"end":{"line":23,"column":93}},"13":{"start":{"line":24,"column":4},"end":{"line":28,"column":5}},"14":{"start":{"line":25,"column":8},"end":{"line":27,"column":11}},"15":{"start":{"line":29,"column":27},"end":{"line":29,"column":30}},"16":{"start":{"line":30,"column":4},"end":{"line":33,"column":6}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":9,"column":48},"end":{"line":9,"column":49}},"loc":{"start":{"line":9,"column":77},"end":{"line":34,"column":1}},"line":9}},"branchMap":{"0":{"loc":{"start":{"line":10,"column":4},"end":{"line":12,"column":5}},"type":"if","locations":[{"start":{"line":10,"column":4},"end":{"line":12,"column":5}},{"start":{"line":10,"column":4},"end":{"line":12,"column":5}}],"line":10},"1":{"loc":{"start":{"line":16,"column":11},"end":{"line":18,"column":9}},"type":"binary-expr","locations":[{"start":{"line":16,"column":11},"end":{"line":16,"column":58}},{"start":{"line":16,"column":62},"end":{"line":18,"column":9}}],"line":16},"2":{"loc":{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},"type":"if","locations":[{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},{"start":{"line":20,"column":4},"end":{"line":22,"column":5}}],"line":20},"3":{"loc":{"start":{"line":24,"column":4},"end":{"line":28,"column":5}},"type":"if","locations":[{"start":{"line":24,"column":4},"end":{"line":28,"column":5}},{"start":{"line":24,"column":4},"end":{"line":28,"column":5}}],"line":24}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":4,"7":0,"8":4,"9":4,"10":4,"11":2,"12":2,"13":2,"14":1,"15":1,"16":1},"f":{"0":4},"b":{"0":[0,4],"1":[4,3],"2":[2,2],"3":[1,1]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/hooks/beforeNewRoom.ts"],"sourcesContent":["import { OmnichannelServiceLevelAgreements } from '@rocket.chat/models';\nimport { Meteor } from 'meteor/meteor';\n\nimport { callbacks } from '../../../../../lib/callbacks';\nimport { isPlainObject } from '../../../../../lib/utils/isPlainObject';\n\ncallbacks.add(\n\t'livechat.beforeRoom',\n\tasync (roomInfo, extraData) => {\n\t\tif (!extraData) {\n\t\t\treturn roomInfo;\n\t\t}\n\n\t\tconst { sla: searchTerm, customFields } = extraData;\n\t\tconst roomInfoWithExtraData = { ...roomInfo, ...(isPlainObject(customFields) && { customFields }) };\n\n\t\tif (!searchTerm) {\n\t\t\treturn roomInfoWithExtraData;\n\t\t}\n\n\t\tconst sla = await OmnichannelServiceLevelAgreements.findOneByIdOrName(searchTerm);\n\t\tif (!sla) {\n\t\t\tthrow new Meteor.Error('error-invalid-sla', 'Invalid sla', {\n\t\t\t\tfunction: 'livechat.beforeRoom',\n\t\t\t});\n\t\t}\n\n\t\tconst { _id: slaId } = sla;\n\t\treturn { ...roomInfoWithExtraData, slaId };\n\t},\n\tcallbacks.priority.MEDIUM,\n\t'livechat-before-new-room',\n);\n"],"names":["callbacks","add","roomInfo","extraData","sla","searchTerm","customFields","roomInfoWithExtraData","isPlainObject","OmnichannelServiceLevelAgreements","findOneByIdOrName","Meteor","Error","function","_id","slaId","priority","MEDIUM"],"mappings":";;;;wBAAkD;wBAC3B;2BAEG;+BACI;AAE9BA,oBAAS,CAACC,GAAG,CACZ,uBACA,OAAOC,UAAUC;IAChB,IAAI,CAACA,WAAW;QACf,OAAOD;IACR;IAEA,MAAM,EAAEE,KAAKC,UAAU,EAAEC,YAAY,EAAE,GAAGH;IAC1C,MAAMI,wBAAwB;QAAE,GAAGL,QAAQ;QAAE,GAAIM,IAAAA,4BAAa,EAACF,iBAAiB;YAAEA;QAAa,CAAC;IAAE;IAElG,IAAI,CAACD,YAAY;QAChB,OAAOE;IACR;IAEA,MAAMH,MAAM,MAAMK,yCAAiC,CAACC,iBAAiB,CAACL;IACtE,IAAI,CAACD,KAAK;QACT,MAAM,IAAIO,cAAM,CAACC,KAAK,CAAC,qBAAqB,eAAe;YAC1DC,UAAU;QACX;IACD;IAEA,MAAM,EAAEC,KAAKC,KAAK,EAAE,GAAGX;IACvB,OAAO;QAAE,GAAGG,qBAAqB;QAAEQ;IAAM;AAC1C,GACAf,oBAAS,CAACgB,QAAQ,CAACC,MAAM,EACzB","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/app/livechat-enterprise/server/hooks/beforeNewRoom.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"652fd1af0bee86824de13062857db3bb9bdad667","contentHash":"8e57894bdb0c0895678791ad2bfc7f1887b693d19902bf0f3ae77e7cc4eebf28"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isPlainObject.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isPlainObject.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":29}},"3":{"start":{"line":12,"column":4},"end":{"line":12,"column":80}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"isPlainObject","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":22}},"loc":{"start":{"line":11,"column":30},"end":{"line":13,"column":1}},"line":11}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":11},"end":{"line":12,"column":79}},"type":"binary-expr","locations":[{"start":{"line":12,"column":11},"end":{"line":12,"column":25}},{"start":{"line":12,"column":29},"end":{"line":12,"column":54}},{"start":{"line":12,"column":58},"end":{"line":12,"column":79}}],"line":12}},"s":{"0":1,"1":1,"2":4,"3":4},"f":{"0":4,"1":4},"b":{"0":[4,4,3]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isPlainObject.ts"],"sourcesContent":["export function isPlainObject(value: unknown) {\n\treturn value !== null && typeof value === 'object' && !Array.isArray(value);\n}\n"],"names":["isPlainObject","value","Array","isArray"],"mappings":";;;;+BAAgBA;;;eAAAA;;;AAAT,SAASA,cAAcC,KAAc;IAC3C,OAAOA,UAAU,QAAQ,OAAOA,UAAU,YAAY,CAACC,MAAMC,OAAO,CAACF;AACtE","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/utils/isPlainObject.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"c5dd1d28069419aad3fe794b7173220ff7a609ec","contentHash":"b535cff5d7e1de51df8e1dd38252937e3232b17e9da720ecf9bf90bf336f4a6a"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/hooks/markRoomResponded.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/hooks/markRoomResponded.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":33}},"3":{"start":{"line":11,"column":21},"end":{"line":11,"column":57}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":46}},"5":{"start":{"line":13,"column":30},"end":{"line":13,"column":73}},"6":{"start":{"line":14,"column":19},"end":{"line":14,"column":55}},"7":{"start":{"line":15,"column":24},"end":{"line":15,"column":73}},"8":{"start":{"line":17,"column":4},"end":{"line":19,"column":6}},"9":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"10":{"start":{"line":24,"column":8},"end":{"line":24,"column":15}},"11":{"start":{"line":26,"column":22},"end":{"line":26,"column":62}},"12":{"start":{"line":27,"column":28},"end":{"line":27,"column":105}},"13":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"14":{"start":{"line":30,"column":8},"end":{"line":30,"column":89}},"15":{"start":{"line":32,"column":4},"end":{"line":40,"column":5}},"16":{"start":{"line":33,"column":8},"end":{"line":33,"column":91}},"17":{"start":{"line":34,"column":32},"end":{"line":34,"column":109}},"18":{"start":{"line":35,"column":8},"end":{"line":39,"column":9}},"19":{"start":{"line":36,"column":12},"end":{"line":38,"column":15}},"20":{"start":{"line":41,"column":4},"end":{"line":48,"column":5}},"21":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"22":{"start":{"line":45,"column":12},"end":{"line":45,"column":80}},"23":{"start":{"line":47,"column":8},"end":{"line":47,"column":31}},"24":{"start":{"line":51,"column":68},"end":{"line":51,"column":72}},"25":{"start":{"line":52,"column":23},"end":{"line":57,"column":5}},"26":{"start":{"line":58,"column":4},"end":{"line":58,"column":82}},"27":{"start":{"line":59,"column":4},"end":{"line":59,"column":22}},"28":{"start":{"line":61,"column":0},"end":{"line":66,"column":60}},"29":{"start":{"line":62,"column":4},"end":{"line":64,"column":5}},"30":{"start":{"line":63,"column":8},"end":{"line":63,"column":15}},"31":{"start":{"line":65,"column":4},"end":{"line":65,"column":56}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":33}},"loc":{"start":{"line":16,"column":39},"end":{"line":20,"column":1}},"line":16},"2":{"name":"markRoomResponded","decl":{"start":{"line":21,"column":15},"end":{"line":21,"column":32}},"loc":{"start":{"line":21,"column":61},"end":{"line":60,"column":1}},"line":21},"3":{"name":"(anonymous_3)","decl":{"start":{"line":61,"column":56},"end":{"line":61,"column":57}},"loc":{"start":{"line":61,"column":96},"end":{"line":66,"column":1}},"line":61}},"branchMap":{"0":{"loc":{"start":{"line":17,"column":11},"end":{"line":19,"column":5}},"type":"cond-expr","locations":[{"start":{"line":17,"column":35},"end":{"line":17,"column":38}},{"start":{"line":17,"column":41},"end":{"line":19,"column":5}}],"line":17},"1":{"loc":{"start":{"line":17,"column":11},"end":{"line":17,"column":32}},"type":"binary-expr","locations":[{"start":{"line":17,"column":11},"end":{"line":17,"column":14}},{"start":{"line":17,"column":18},"end":{"line":17,"column":32}}],"line":17},"2":{"loc":{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},"type":"if","locations":[{"start":{"line":23,"column":4},"end":{"line":25,"column":5}},{"start":{"line":23,"column":4},"end":{"line":25,"column":5}}],"line":23},"3":{"loc":{"start":{"line":23,"column":8},"end":{"line":23,"column":147}},"type":"binary-expr","locations":[{"start":{"line":23,"column":8},"end":{"line":23,"column":50}},{"start":{"line":23,"column":54},"end":{"line":23,"column":96}},{"start":{"line":23,"column":100},"end":{"line":23,"column":147}}],"line":23},"4":{"loc":{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},"type":"if","locations":[{"start":{"line":29,"column":4},"end":{"line":31,"column":5}},{"start":{"line":29,"column":4},"end":{"line":31,"column":5}}],"line":29},"5":{"loc":{"start":{"line":32,"column":4},"end":{"line":40,"column":5}},"type":"if","locations":[{"start":{"line":32,"column":4},"end":{"line":40,"column":5}},{"start":{"line":32,"column":4},"end":{"line":40,"column":5}}],"line":32},"6":{"loc":{"start":{"line":32,"column":10},"end":{"line":32,"column":196}},"type":"cond-expr","locations":[{"start":{"line":32,"column":62},"end":{"line":32,"column":68}},{"start":{"line":32,"column":71},"end":{"line":32,"column":196}}],"line":32},"7":{"loc":{"start":{"line":32,"column":10},"end":{"line":32,"column":59}},"type":"binary-expr","locations":[{"start":{"line":32,"column":10},"end":{"line":32,"column":37}},{"start":{"line":32,"column":41},"end":{"line":32,"column":59}}],"line":32},"8":{"loc":{"start":{"line":32,"column":71},"end":{"line":32,"column":196}},"type":"cond-expr","locations":[{"start":{"line":32,"column":151},"end":{"line":32,"column":157}},{"start":{"line":32,"column":160},"end":{"line":32,"column":196}}],"line":32},"9":{"loc":{"start":{"line":32,"column":71},"end":{"line":32,"column":148}},"type":"binary-expr","locations":[{"start":{"line":32,"column":71},"end":{"line":32,"column":117}},{"start":{"line":32,"column":121},"end":{"line":32,"column":148}}],"line":32},"10":{"loc":{"start":{"line":35,"column":8},"end":{"line":39,"column":9}},"type":"if","locations":[{"start":{"line":35,"column":8},"end":{"line":39,"column":9}},{"start":{"line":35,"column":8},"end":{"line":39,"column":9}}],"line":35},"11":{"loc":{"start":{"line":41,"column":4},"end":{"line":48,"column":5}},"type":"if","locations":[{"start":{"line":41,"column":4},"end":{"line":48,"column":5}},{"start":{"line":41,"column":4},"end":{"line":48,"column":5}}],"line":41},"12":{"loc":{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},"type":"if","locations":[{"start":{"line":44,"column":8},"end":{"line":46,"column":9}},{"start":{"line":44,"column":8},"end":{"line":46,"column":9}}],"line":44},"13":{"loc":{"start":{"line":51,"column":24},"end":{"line":51,"column":63}},"type":"default-arg","locations":[{"start":{"line":51,"column":61},"end":{"line":51,"column":63}}],"line":51},"14":{"loc":{"start":{"line":53,"column":13},"end":{"line":53,"column":33}},"type":"binary-expr","locations":[{"start":{"line":53,"column":13},"end":{"line":53,"column":16}},{"start":{"line":53,"column":20},"end":{"line":53,"column":33}}],"line":53},"15":{"loc":{"start":{"line":54,"column":18},"end":{"line":54,"column":48}},"type":"binary-expr","locations":[{"start":{"line":54,"column":18},"end":{"line":54,"column":26}},{"start":{"line":54,"column":30},"end":{"line":54,"column":48}}],"line":54},"16":{"loc":{"start":{"line":55,"column":25},"end":{"line":55,"column":64}},"type":"binary-expr","locations":[{"start":{"line":55,"column":25},"end":{"line":55,"column":40}},{"start":{"line":55,"column":44},"end":{"line":55,"column":64}}],"line":55},"17":{"loc":{"start":{"line":62,"column":4},"end":{"line":64,"column":5}},"type":"if","locations":[{"start":{"line":62,"column":4},"end":{"line":64,"column":5}},{"start":{"line":62,"column":4},"end":{"line":64,"column":5}}],"line":62},"18":{"loc":{"start":{"line":62,"column":8},"end":{"line":62,"column":159}},"type":"binary-expr","locations":[{"start":{"line":62,"column":8},"end":{"line":62,"column":16}},{"start":{"line":62,"column":20},"end":{"line":62,"column":62}},{"start":{"line":62,"column":66},"end":{"line":62,"column":113}},{"start":{"line":62,"column":117},"end":{"line":62,"column":159}}],"line":62}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":9,"10":3,"11":6,"12":6,"13":6,"14":6,"15":6,"16":6,"17":6,"18":6,"19":1,"20":6,"21":4,"22":2,"23":4,"24":2,"25":2,"26":2,"27":2,"28":1,"29":0,"30":0,"31":0},"f":{"0":1,"1":1,"2":9,"3":0},"b":{"0":[0,1],"1":[1,1],"2":[3,6],"3":[9,8,7],"4":[6,0],"5":[6,0],"6":[0,6],"7":[6,6],"8":[5,1],"9":[6,6],"10":[1,5],"11":[4,2],"12":[2,2],"13":[1],"14":[2,1],"15":[2,1],"16":[2,1],"17":[0,0],"18":[0,0,0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/hooks/markRoomResponded.ts"],"sourcesContent":["import type { IOmnichannelRoom, IMessage } from '@rocket.chat/core-typings';\nimport { isEditedMessage, isMessageFromVisitor, isSystemMessage } from '@rocket.chat/core-typings';\nimport type { Updater } from '@rocket.chat/models';\nimport { LivechatRooms, LivechatVisitors, LivechatInquiry } from '@rocket.chat/models';\nimport moment from 'moment';\n\nimport { callbacks } from '../../../../lib/callbacks';\nimport { notifyOnLivechatInquiryChanged } from '../../../lib/server/lib/notifyListener';\n\nexport async function markRoomResponded(\n\tmessage: IMessage,\n\troom: IOmnichannelRoom,\n\troomUpdater: Updater<IOmnichannelRoom>,\n): Promise<IOmnichannelRoom['responseBy'] | undefined> {\n\tif (isSystemMessage(message) || isEditedMessage(message) || isMessageFromVisitor(message)) {\n\t\treturn;\n\t}\n\n\tconst monthYear = moment().format('YYYY-MM');\n\tconst isVisitorActive = await LivechatVisitors.isVisitorActiveOnPeriod(room.v._id, monthYear);\n\n\t// Case: agent answers & visitor is not active, we mark visitor as active\n\tif (!isVisitorActive) {\n\t\tawait LivechatVisitors.markVisitorActiveForPeriod(room.v._id, monthYear);\n\t}\n\n\tif (!room.v?.activity?.includes(monthYear)) {\n\t\tLivechatRooms.getVisitorActiveForPeriodUpdateQuery(monthYear, roomUpdater);\n\t\tconst livechatInquiry = await LivechatInquiry.markInquiryActiveForPeriod(room._id, monthYear);\n\n\t\tif (livechatInquiry) {\n\t\t\tvoid notifyOnLivechatInquiryChanged(livechatInquiry, 'updated', { v: livechatInquiry.v });\n\t\t}\n\t}\n\n\tif (!room.waitingResponse) {\n\t\t// case where agent sends second message or any subsequent message in a room before visitor responds to the first message\n\t\t// in this case, we just need to update the lastMessageTs of the responseBy object\n\t\tif (room.responseBy) {\n\t\t\tLivechatRooms.getAgentLastMessageTsUpdateQuery(roomUpdater);\n\t\t}\n\n\t\treturn room.responseBy;\n\t}\n\n\t// Since we're updating the whole object anyways, we re-use the same values from object (or from message if not present)\n\t// And then we update the lastMessageTs, which is the only thing that should be updating here\n\tconst { responseBy: { _id, username, firstResponseTs } = {} } = room;\n\tconst responseBy: IOmnichannelRoom['responseBy'] = {\n\t\t_id: _id || message.u._id,\n\t\tusername: username || message.u.username,\n\t\tfirstResponseTs: firstResponseTs || new Date(message.ts),\n\t\tlastMessageTs: new Date(message.ts),\n\t};\n\n\tLivechatRooms.getResponseByRoomIdUpdateQuery(responseBy, roomUpdater);\n\n\treturn responseBy;\n}\n\ncallbacks.add(\n\t'afterOmnichannelSaveMessage',\n\tasync (message, { room, roomUpdater }) => {\n\t\tif (!message || isEditedMessage(message) || isMessageFromVisitor(message) || isSystemMessage(message)) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait markRoomResponded(message, room, roomUpdater);\n\t},\n\tcallbacks.priority.HIGH,\n\t'markRoomResponded',\n);\n"],"names":["markRoomResponded","message","room","roomUpdater","isSystemMessage","isEditedMessage","isMessageFromVisitor","monthYear","moment","format","isVisitorActive","LivechatVisitors","isVisitorActiveOnPeriod","v","_id","markVisitorActiveForPeriod","activity","includes","LivechatRooms","getVisitorActiveForPeriodUpdateQuery","livechatInquiry","LivechatInquiry","markInquiryActiveForPeriod","notifyOnLivechatInquiryChanged","waitingResponse","responseBy","getAgentLastMessageTsUpdateQuery","username","firstResponseTs","u","Date","ts","lastMessageTs","getResponseByRoomIdUpdateQuery","callbacks","add","priority","HIGH"],"mappings":";;;;+BASsBA;;;eAAAA;;;6BARiD;wBAEN;+DAC9C;2BAEO;gCACqB;;;;;;AAExC,eAAeA,kBACrBC,OAAiB,EACjBC,IAAsB,EACtBC,WAAsC;QAcjCD,kBAAAA;IAZL,IAAIE,IAAAA,4BAAe,EAACH,YAAYI,IAAAA,4BAAe,EAACJ,YAAYK,IAAAA,iCAAoB,EAACL,UAAU;QAC1F;IACD;IAEA,MAAMM,YAAYC,IAAAA,eAAM,IAAGC,MAAM,CAAC;IAClC,MAAMC,kBAAkB,MAAMC,wBAAgB,CAACC,uBAAuB,CAACV,KAAKW,CAAC,CAACC,GAAG,EAAEP;IAEnF,yEAAyE;IACzE,IAAI,CAACG,iBAAiB;QACrB,MAAMC,wBAAgB,CAACI,0BAA0B,CAACb,KAAKW,CAAC,CAACC,GAAG,EAAEP;IAC/D;IAEA,IAAI,GAACL,UAAAA,KAAKW,CAAC,cAANX,+BAAAA,mBAAAA,QAAQc,QAAQ,cAAhBd,uCAAAA,iBAAkBe,QAAQ,CAACV,aAAY;QAC3CW,qBAAa,CAACC,oCAAoC,CAACZ,WAAWJ;QAC9D,MAAMiB,kBAAkB,MAAMC,uBAAe,CAACC,0BAA0B,CAACpB,KAAKY,GAAG,EAAEP;QAEnF,IAAIa,iBAAiB;YACpB,KAAKG,IAAAA,8CAA8B,EAACH,iBAAiB,WAAW;gBAAEP,GAAGO,gBAAgBP,CAAC;YAAC;QACxF;IACD;IAEA,IAAI,CAACX,KAAKsB,eAAe,EAAE;QAC1B,yHAAyH;QACzH,kFAAkF;QAClF,IAAItB,KAAKuB,UAAU,EAAE;YACpBP,qBAAa,CAACQ,gCAAgC,CAACvB;QAChD;QAEA,OAAOD,KAAKuB,UAAU;IACvB;IAEA,wHAAwH;IACxH,6FAA6F;IAC7F,MAAM,EAAEA,YAAY,EAAEX,GAAG,EAAEa,QAAQ,EAAEC,eAAe,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG1B;IAChE,MAAMuB,aAA6C;QAClDX,KAAKA,OAAOb,QAAQ4B,CAAC,CAACf,GAAG;QACzBa,UAAUA,YAAY1B,QAAQ4B,CAAC,CAACF,QAAQ;QACxCC,iBAAiBA,mBAAmB,IAAIE,KAAK7B,QAAQ8B,EAAE;QACvDC,eAAe,IAAIF,KAAK7B,QAAQ8B,EAAE;IACnC;IAEAb,qBAAa,CAACe,8BAA8B,CAACR,YAAYtB;IAEzD,OAAOsB;AACR;AAEAS,oBAAS,CAACC,GAAG,CACZ,+BACA,OAAOlC,SAAS,EAAEC,IAAI,EAAEC,WAAW,EAAE;IACpC,IAAI,CAACF,WAAWI,IAAAA,4BAAe,EAACJ,YAAYK,IAAAA,iCAAoB,EAACL,YAAYG,IAAAA,4BAAe,EAACH,UAAU;QACtG;IACD;IAEA,MAAMD,kBAAkBC,SAASC,MAAMC;AACxC,GACA+B,oBAAS,CAACE,QAAQ,CAACC,IAAI,EACvB","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/hooks/markRoomResponded.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9b398f915e024b095d756c1c40c19e4d5628e754","contentHash":"d0ce52b8bb67b38ef4a0945b7d0637ac7739ee725c9093520365ef5c2c3f8edf"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-integrations/providers/twilio.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-integrations/providers/twilio.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":22}},"3":{"start":{"line":11,"column":22},"end":{"line":11,"column":59}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":46}},"5":{"start":{"line":13,"column":32},"end":{"line":13,"column":77}},"6":{"start":{"line":14,"column":30},"end":{"line":14,"column":73}},"7":{"start":{"line":15,"column":16},"end":{"line":15,"column":58}},"8":{"start":{"line":16,"column":22},"end":{"line":16,"column":74}},"9":{"start":{"line":17,"column":14},"end":{"line":17,"column":42}},"10":{"start":{"line":18,"column":16},"end":{"line":18,"column":53}},"11":{"start":{"line":20,"column":4},"end":{"line":22,"column":6}},"12":{"start":{"line":24,"column":21},"end":{"line":30,"column":1}},"13":{"start":{"line":25,"column":4},"end":{"line":27,"column":5}},"14":{"start":{"line":26,"column":8},"end":{"line":26,"column":21}},"15":{"start":{"line":28,"column":31},"end":{"line":28,"column":35}},"16":{"start":{"line":29,"column":4},"end":{"line":29,"column":90}},"17":{"start":{"line":31,"column":22},"end":{"line":31,"column":29}},"18":{"start":{"line":32,"column":20},"end":{"line":34,"column":6}},"19":{"start":{"line":32,"column":40},"end":{"line":34,"column":6}},"20":{"start":{"line":35,"column":13},"end":{"line":245,"column":1}},"21":{"start":{"line":37,"column":23},"end":{"line":37,"column":24}},"22":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"23":{"start":{"line":39,"column":12},"end":{"line":39,"column":44}},"24":{"start":{"line":41,"column":27},"end":{"line":57,"column":9}},"25":{"start":{"line":58,"column":8},"end":{"line":60,"column":9}},"26":{"start":{"line":59,"column":12},"end":{"line":59,"column":51}},"27":{"start":{"line":61,"column":8},"end":{"line":64,"column":9}},"28":{"start":{"line":62,"column":12},"end":{"line":62,"column":82}},"29":{"start":{"line":63,"column":12},"end":{"line":63,"column":30}},"30":{"start":{"line":65,"column":8},"end":{"line":65,"column":30}},"31":{"start":{"line":66,"column":8},"end":{"line":76,"column":9}},"32":{"start":{"line":66,"column":29},"end":{"line":66,"column":30}},"33":{"start":{"line":67,"column":26},"end":{"line":70,"column":13}},"34":{"start":{"line":71,"column":29},"end":{"line":71,"column":58}},"35":{"start":{"line":72,"column":32},"end":{"line":72,"column":69}},"36":{"start":{"line":73,"column":12},"end":{"line":73,"column":33}},"37":{"start":{"line":74,"column":12},"end":{"line":74,"column":44}},"38":{"start":{"line":75,"column":12},"end":{"line":75,"column":41}},"39":{"start":{"line":77,"column":8},"end":{"line":77,"column":26}},"40":{"start":{"line":80,"column":20},"end":{"line":80,"column":66}},"41":{"start":{"line":81,"column":22},"end":{"line":81,"column":66}},"42":{"start":{"line":82,"column":8},"end":{"line":85,"column":9}},"43":{"start":{"line":83,"column":12},"end":{"line":83,"column":85}},"44":{"start":{"line":84,"column":12},"end":{"line":84,"column":19}},"45":{"start":{"line":86,"column":8},"end":{"line":91,"column":9}},"46":{"start":{"line":87,"column":12},"end":{"line":87,"column":52}},"47":{"start":{"line":89,"column":12},"end":{"line":89,"column":90}},"48":{"start":{"line":90,"column":12},"end":{"line":90,"column":63}},"49":{"start":{"line":97,"column":14},"end":{"line":97,"column":23}},"50":{"start":{"line":98,"column":21},"end":{"line":104,"column":17}},"51":{"start":{"line":105,"column":20},"end":{"line":105,"column":87}},"52":{"start":{"line":107,"column":8},"end":{"line":124,"column":9}},"53":{"start":{"line":108,"column":12},"end":{"line":110,"column":15}},"54":{"start":{"line":111,"column":15},"end":{"line":124,"column":9}},"55":{"start":{"line":112,"column":12},"end":{"line":115,"column":15}},"56":{"start":{"line":116,"column":15},"end":{"line":124,"column":9}},"57":{"start":{"line":117,"column":12},"end":{"line":119,"column":15}},"58":{"start":{"line":120,"column":15},"end":{"line":124,"column":9}},"59":{"start":{"line":121,"column":12},"end":{"line":123,"column":15}},"60":{"start":{"line":127,"column":35},"end":{"line":127,"column":82}},"61":{"start":{"line":128,"column":27},"end":{"line":128,"column":93}},"62":{"start":{"line":129,"column":28},"end":{"line":129,"column":110}},"63":{"start":{"line":130,"column":8},"end":{"line":134,"column":9}},"64":{"start":{"line":131,"column":12},"end":{"line":133,"column":15}},"65":{"start":{"line":135,"column":8},"end":{"line":139,"column":9}},"66":{"start":{"line":136,"column":12},"end":{"line":136,"column":51}},"67":{"start":{"line":137,"column":12},"end":{"line":137,"column":64}},"68":{"start":{"line":138,"column":12},"end":{"line":138,"column":22}},"69":{"start":{"line":141,"column":8},"end":{"line":141,"column":30}},"70":{"start":{"line":144,"column":32},"end":{"line":144,"column":47}},"71":{"start":{"line":145,"column":23},"end":{"line":145,"column":56}},"72":{"start":{"line":146,"column":8},"end":{"line":151,"column":9}},"73":{"start":{"line":147,"column":12},"end":{"line":150,"column":14}},"74":{"start":{"line":152,"column":19},"end":{"line":152,"column":26}},"75":{"start":{"line":154,"column":32},"end":{"line":154,"column":72}},"76":{"start":{"line":155,"column":8},"end":{"line":166,"column":9}},"77":{"start":{"line":156,"column":35},"end":{"line":156,"column":92}},"78":{"start":{"line":157,"column":12},"end":{"line":162,"column":13}},"79":{"start":{"line":158,"column":16},"end":{"line":161,"column":18}},"80":{"start":{"line":163,"column":12},"end":{"line":165,"column":14}},"81":{"start":{"line":168,"column":8},"end":{"line":174,"column":9}},"82":{"start":{"line":169,"column":42},"end":{"line":169,"column":72}},"83":{"start":{"line":170,"column":12},"end":{"line":170,"column":62}},"84":{"start":{"line":171,"column":12},"end":{"line":173,"column":15}},"85":{"start":{"line":175,"column":8},"end":{"line":201,"column":9}},"86":{"start":{"line":176,"column":27},"end":{"line":186,"column":14}},"87":{"start":{"line":187,"column":12},"end":{"line":190,"column":13}},"88":{"start":{"line":188,"column":16},"end":{"line":188,"column":68}},"89":{"start":{"line":189,"column":16},"end":{"line":189,"column":78}},"90":{"start":{"line":191,"column":12},"end":{"line":194,"column":14}},"91":{"start":{"line":196,"column":12},"end":{"line":196,"column":54}},"92":{"start":{"line":197,"column":12},"end":{"line":200,"column":14}},"93":{"start":{"line":204,"column":8},"end":{"line":209,"column":10}},"94":{"start":{"line":212,"column":26},"end":{"line":212,"column":70}},"95":{"start":{"line":213,"column":22},"end":{"line":213,"column":54}},"96":{"start":{"line":214,"column":8},"end":{"line":216,"column":9}},"97":{"start":{"line":215,"column":12},"end":{"line":215,"column":48}},"98":{"start":{"line":217,"column":8},"end":{"line":220,"column":9}},"99":{"start":{"line":218,"column":12},"end":{"line":218,"column":90}},"100":{"start":{"line":219,"column":12},"end":{"line":219,"column":25}},"101":{"start":{"line":221,"column":26},"end":{"line":221,"column":133}},"102":{"start":{"line":222,"column":8},"end":{"line":222,"column":94}},"103":{"start":{"line":226,"column":8},"end":{"line":228,"column":9}},"104":{"start":{"line":227,"column":12},"end":{"line":227,"column":24}},"105":{"start":{"line":229,"column":29},"end":{"line":229,"column":72}},"106":{"start":{"line":230,"column":32},"end":{"line":230,"column":92}},"107":{"start":{"line":231,"column":8},"end":{"line":231,"column":66}},"108":{"start":{"line":234,"column":22},"end":{"line":234,"column":24}},"109":{"start":{"line":235,"column":8},"end":{"line":237,"column":9}},"110":{"start":{"line":236,"column":12},"end":{"line":236,"column":59}},"111":{"start":{"line":238,"column":8},"end":{"line":243,"column":10}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"_interop_require_default","decl":{"start":{"line":19,"column":9},"end":{"line":19,"column":33}},"loc":{"start":{"line":19,"column":39},"end":{"line":23,"column":1}},"line":19},"2":{"name":"(anonymous_2)","decl":{"start":{"line":24,"column":21},"end":{"line":24,"column":22}},"loc":{"start":{"line":24,"column":29},"end":{"line":30,"column":1}},"line":24},"3":{"name":"(anonymous_3)","decl":{"start":{"line":32,"column":20},"end":{"line":32,"column":21}},"loc":{"start":{"line":32,"column":40},"end":{"line":34,"column":6}},"line":32},"4":{"name":"(anonymous_4)","decl":{"start":{"line":36,"column":4},"end":{"line":36,"column":5}},"loc":{"start":{"line":36,"column":16},"end":{"line":78,"column":5}},"line":36},"5":{"name":"(anonymous_5)","decl":{"start":{"line":79,"column":4},"end":{"line":79,"column":5}},"loc":{"start":{"line":79,"column":33},"end":{"line":92,"column":5}},"line":79},"6":{"name":"(anonymous_6)","decl":{"start":{"line":93,"column":4},"end":{"line":93,"column":5}},"loc":{"start":{"line":93,"column":46},"end":{"line":142,"column":5}},"line":93},"7":{"name":"(anonymous_7)","decl":{"start":{"line":143,"column":4},"end":{"line":143,"column":5}},"loc":{"start":{"line":143,"column":57},"end":{"line":202,"column":5}},"line":143},"8":{"name":"(anonymous_8)","decl":{"start":{"line":203,"column":4},"end":{"line":203,"column":5}},"loc":{"start":{"line":203,"column":15},"end":{"line":210,"column":5}},"line":203},"9":{"name":"(anonymous_9)","decl":{"start":{"line":211,"column":4},"end":{"line":211,"column":5}},"loc":{"start":{"line":211,"column":44},"end":{"line":223,"column":5}},"line":211},"10":{"name":"(anonymous_10)","decl":{"start":{"line":224,"column":4},"end":{"line":224,"column":5}},"loc":{"start":{"line":224,"column":29},"end":{"line":232,"column":5}},"line":224},"11":{"name":"(anonymous_11)","decl":{"start":{"line":233,"column":4},"end":{"line":233,"column":5}},"loc":{"start":{"line":233,"column":17},"end":{"line":244,"column":5}},"line":233}},"branchMap":{"0":{"loc":{"start":{"line":20,"column":11},"end":{"line":22,"column":5}},"type":"cond-expr","locations":[{"start":{"line":20,"column":35},"end":{"line":20,"column":38}},{"start":{"line":20,"column":41},"end":{"line":22,"column":5}}],"line":20},"1":{"loc":{"start":{"line":20,"column":11},"end":{"line":20,"column":32}},"type":"binary-expr","locations":[{"start":{"line":20,"column":11},"end":{"line":20,"column":14}},{"start":{"line":20,"column":18},"end":{"line":20,"column":32}}],"line":20},"2":{"loc":{"start":{"line":25,"column":4},"end":{"line":27,"column":5}},"type":"if","locations":[{"start":{"line":25,"column":4},"end":{"line":27,"column":5}},{"start":{"line":25,"column":4},"end":{"line":27,"column":5}}],"line":25},"3":{"loc":{"start":{"line":25,"column":8},"end":{"line":25,"column":49}},"type":"binary-expr","locations":[{"start":{"line":25,"column":8},"end":{"line":25,"column":32}},{"start":{"line":25,"column":36},"end":{"line":25,"column":49}}],"line":25},"4":{"loc":{"start":{"line":29,"column":11},"end":{"line":29,"column":89}},"type":"binary-expr","locations":[{"start":{"line":29,"column":11},"end":{"line":29,"column":35}},{"start":{"line":29,"column":39},"end":{"line":29,"column":61}},{"start":{"line":29,"column":65},"end":{"line":29,"column":89}}],"line":29},"5":{"loc":{"start":{"line":32,"column":40},"end":{"line":34,"column":6}},"type":"binary-expr","locations":[{"start":{"line":32,"column":40},"end":{"line":32,"column":46}},{"start":{"line":32,"column":50},"end":{"line":32,"column":53}},{"start":{"line":32,"column":57},"end":{"line":34,"column":6}}],"line":32},"6":{"loc":{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},"type":"if","locations":[{"start":{"line":38,"column":8},"end":{"line":40,"column":9}},{"start":{"line":38,"column":8},"end":{"line":40,"column":9}}],"line":38},"7":{"loc":{"start":{"line":58,"column":8},"end":{"line":60,"column":9}},"type":"if","locations":[{"start":{"line":58,"column":8},"end":{"line":60,"column":9}},{"start":{"line":58,"column":8},"end":{"line":60,"column":9}}],"line":58},"8":{"loc":{"start":{"line":61,"column":8},"end":{"line":64,"column":9}},"type":"if","locations":[{"start":{"line":61,"column":8},"end":{"line":64,"column":9}},{"start":{"line":61,"column":8},"end":{"line":64,"column":9}}],"line":61},"9":{"loc":{"start":{"line":82,"column":8},"end":{"line":85,"column":9}},"type":"if","locations":[{"start":{"line":82,"column":8},"end":{"line":85,"column":9}},{"start":{"line":82,"column":8},"end":{"line":85,"column":9}}],"line":82},"10":{"loc":{"start":{"line":82,"column":12},"end":{"line":82,"column":26}},"type":"binary-expr","locations":[{"start":{"line":82,"column":12},"end":{"line":82,"column":16}},{"start":{"line":82,"column":20},"end":{"line":82,"column":26}}],"line":82},"11":{"loc":{"start":{"line":94,"column":41},"end":{"line":97,"column":9}},"type":"default-arg","locations":[{"start":{"line":94,"column":74},"end":{"line":97,"column":9}}],"line":94},"12":{"loc":{"start":{"line":98,"column":21},"end":{"line":104,"column":17}},"type":"cond-expr","locations":[{"start":{"line":98,"column":30},"end":{"line":104,"column":10}},{"start":{"line":104,"column":13},"end":{"line":104,"column":17}}],"line":98},"13":{"loc":{"start":{"line":105,"column":20},"end":{"line":105,"column":87}},"type":"binary-expr","locations":[{"start":{"line":105,"column":21},"end":{"line":105,"column":78}},{"start":{"line":105,"column":83},"end":{"line":105,"column":87}}],"line":105},"14":{"loc":{"start":{"line":105,"column":21},"end":{"line":105,"column":78}},"type":"cond-expr","locations":[{"start":{"line":105,"column":56},"end":{"line":105,"column":62}},{"start":{"line":105,"column":65},"end":{"line":105,"column":78}}],"line":105},"15":{"loc":{"start":{"line":105,"column":21},"end":{"line":105,"column":53}},"type":"binary-expr","locations":[{"start":{"line":105,"column":21},"end":{"line":105,"column":34}},{"start":{"line":105,"column":38},"end":{"line":105,"column":53}}],"line":105},"16":{"loc":{"start":{"line":107,"column":8},"end":{"line":124,"column":9}},"type":"if","locations":[{"start":{"line":107,"column":8},"end":{"line":124,"column":9}},{"start":{"line":107,"column":8},"end":{"line":124,"column":9}}],"line":107},"17":{"loc":{"start":{"line":111,"column":15},"end":{"line":124,"column":9}},"type":"if","locations":[{"start":{"line":111,"column":15},"end":{"line":124,"column":9}},{"start":{"line":111,"column":15},"end":{"line":124,"column":9}}],"line":111},"18":{"loc":{"start":{"line":116,"column":15},"end":{"line":124,"column":9}},"type":"if","locations":[{"start":{"line":116,"column":15},"end":{"line":124,"column":9}},{"start":{"line":116,"column":15},"end":{"line":124,"column":9}}],"line":116},"19":{"loc":{"start":{"line":120,"column":15},"end":{"line":124,"column":9}},"type":"if","locations":[{"start":{"line":120,"column":15},"end":{"line":124,"column":9}},{"start":{"line":120,"column":15},"end":{"line":124,"column":9}}],"line":120},"20":{"loc":{"start":{"line":129,"column":28},"end":{"line":129,"column":110}},"type":"binary-expr","locations":[{"start":{"line":129,"column":28},"end":{"line":129,"column":38}},{"start":{"line":129,"column":42},"end":{"line":129,"column":110}}],"line":129},"21":{"loc":{"start":{"line":130,"column":8},"end":{"line":134,"column":9}},"type":"if","locations":[{"start":{"line":130,"column":8},"end":{"line":134,"column":9}},{"start":{"line":130,"column":8},"end":{"line":134,"column":9}}],"line":130},"22":{"loc":{"start":{"line":130,"column":12},"end":{"line":130,"column":63}},"type":"binary-expr","locations":[{"start":{"line":130,"column":12},"end":{"line":130,"column":30}},{"start":{"line":130,"column":35},"end":{"line":130,"column":46}},{"start":{"line":130,"column":50},"end":{"line":130,"column":62}}],"line":130},"23":{"loc":{"start":{"line":135,"column":8},"end":{"line":139,"column":9}},"type":"if","locations":[{"start":{"line":135,"column":8},"end":{"line":139,"column":9}},{"start":{"line":135,"column":8},"end":{"line":139,"column":9}}],"line":135},"24":{"loc":{"start":{"line":144,"column":32},"end":{"line":144,"column":47}},"type":"binary-expr","locations":[{"start":{"line":144,"column":32},"end":{"line":144,"column":41}},{"start":{"line":144,"column":45},"end":{"line":144,"column":47}}],"line":144},"25":{"loc":{"start":{"line":146,"column":8},"end":{"line":151,"column":9}},"type":"if","locations":[{"start":{"line":146,"column":8},"end":{"line":151,"column":9}},{"start":{"line":146,"column":8},"end":{"line":151,"column":9}}],"line":146},"26":{"loc":{"start":{"line":154,"column":32},"end":{"line":154,"column":72}},"type":"binary-expr","locations":[{"start":{"line":154,"column":32},"end":{"line":154,"column":64}},{"start":{"line":154,"column":68},"end":{"line":154,"column":72}}],"line":154},"27":{"loc":{"start":{"line":155,"column":8},"end":{"line":166,"column":9}},"type":"if","locations":[{"start":{"line":155,"column":8},"end":{"line":166,"column":9}},{"start":{"line":155,"column":8},"end":{"line":166,"column":9}}],"line":155},"28":{"loc":{"start":{"line":155,"column":12},"end":{"line":155,"column":86}},"type":"cond-expr","locations":[{"start":{"line":155,"column":57},"end":{"line":155,"column":63}},{"start":{"line":155,"column":66},"end":{"line":155,"column":86}}],"line":155},"29":{"loc":{"start":{"line":155,"column":12},"end":{"line":155,"column":54}},"type":"binary-expr","locations":[{"start":{"line":155,"column":12},"end":{"line":155,"column":30}},{"start":{"line":155,"column":34},"end":{"line":155,"column":54}}],"line":155},"30":{"loc":{"start":{"line":157,"column":12},"end":{"line":162,"column":13}},"type":"if","locations":[{"start":{"line":157,"column":12},"end":{"line":162,"column":13}},{"start":{"line":157,"column":12},"end":{"line":162,"column":13}}],"line":157},"31":{"loc":{"start":{"line":168,"column":8},"end":{"line":174,"column":9}},"type":"if","locations":[{"start":{"line":168,"column":8},"end":{"line":174,"column":9}},{"start":{"line":168,"column":8},"end":{"line":174,"column":9}}],"line":168},"32":{"loc":{"start":{"line":168,"column":12},"end":{"line":168,"column":84}},"type":"cond-expr","locations":[{"start":{"line":168,"column":57},"end":{"line":168,"column":63}},{"start":{"line":168,"column":66},"end":{"line":168,"column":84}}],"line":168},"33":{"loc":{"start":{"line":168,"column":12},"end":{"line":168,"column":54}},"type":"binary-expr","locations":[{"start":{"line":168,"column":12},"end":{"line":168,"column":30}},{"start":{"line":168,"column":34},"end":{"line":168,"column":54}}],"line":168},"34":{"loc":{"start":{"line":180,"column":19},"end":{"line":182,"column":17}},"type":"binary-expr","locations":[{"start":{"line":180,"column":19},"end":{"line":180,"column":27}},{"start":{"line":180,"column":31},"end":{"line":182,"column":17}}],"line":180},"35":{"loc":{"start":{"line":183,"column":19},"end":{"line":185,"column":17}},"type":"binary-expr","locations":[{"start":{"line":183,"column":19},"end":{"line":183,"column":35}},{"start":{"line":183,"column":39},"end":{"line":185,"column":17}}],"line":183},"36":{"loc":{"start":{"line":187,"column":12},"end":{"line":190,"column":13}},"type":"if","locations":[{"start":{"line":187,"column":12},"end":{"line":190,"column":13}},{"start":{"line":187,"column":12},"end":{"line":190,"column":13}}],"line":187},"37":{"loc":{"start":{"line":214,"column":8},"end":{"line":216,"column":9}},"type":"if","locations":[{"start":{"line":214,"column":8},"end":{"line":216,"column":9}},{"start":{"line":214,"column":8},"end":{"line":216,"column":9}}],"line":214},"38":{"loc":{"start":{"line":217,"column":8},"end":{"line":220,"column":9}},"type":"if","locations":[{"start":{"line":217,"column":8},"end":{"line":220,"column":9}},{"start":{"line":217,"column":8},"end":{"line":220,"column":9}}],"line":217},"39":{"loc":{"start":{"line":217,"column":12},"end":{"line":217,"column":34}},"type":"binary-expr","locations":[{"start":{"line":217,"column":12},"end":{"line":217,"column":22}},{"start":{"line":217,"column":26},"end":{"line":217,"column":34}}],"line":217},"40":{"loc":{"start":{"line":221,"column":26},"end":{"line":221,"column":133}},"type":"cond-expr","locations":[{"start":{"line":221,"column":48},"end":{"line":221,"column":82}},{"start":{"line":221,"column":85},"end":{"line":221,"column":133}}],"line":221},"41":{"loc":{"start":{"line":226,"column":8},"end":{"line":228,"column":9}},"type":"if","locations":[{"start":{"line":226,"column":8},"end":{"line":228,"column":9}},{"start":{"line":226,"column":8},"end":{"line":228,"column":9}}],"line":226},"42":{"loc":{"start":{"line":229,"column":29},"end":{"line":229,"column":72}},"type":"binary-expr","locations":[{"start":{"line":229,"column":29},"end":{"line":229,"column":66}},{"start":{"line":229,"column":70},"end":{"line":229,"column":72}}],"line":229},"43":{"loc":{"start":{"line":230,"column":32},"end":{"line":230,"column":92}},"type":"cond-expr","locations":[{"start":{"line":230,"column":62},"end":{"line":230,"column":77}},{"start":{"line":230,"column":80},"end":{"line":230,"column":92}}],"line":230},"44":{"loc":{"start":{"line":235,"column":8},"end":{"line":237,"column":9}},"type":"if","locations":[{"start":{"line":235,"column":8},"end":{"line":237,"column":9}},{"start":{"line":235,"column":8},"end":{"line":237,"column":9}}],"line":235}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":2,"12":1,"13":0,"14":0,"15":0,"16":0,"17":1,"18":1,"19":0,"20":1,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":7,"95":7,"96":7,"97":1,"98":7,"99":2,"100":2,"101":5,"102":5,"103":8,"104":1,"105":7,"106":7,"107":7,"108":0,"109":0,"110":0,"111":0},"f":{"0":1,"1":2,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":7,"10":8,"11":0},"b":{"0":[0,2],"1":[2,2],"2":[0,0],"3":[0,0],"4":[0,0,0],"5":[0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[1,6],"38":[2,5],"39":[7,6],"40":[1,4],"41":[1,7],"42":[7,1],"43":[0,7],"44":[0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-integrations/providers/twilio.ts"],"sourcesContent":["import { api } from '@rocket.chat/core-services';\nimport type { ISMSProvider, ServiceData, SMSProviderResponse, SMSProviderResult } from '@rocket.chat/core-typings';\nimport { Users } from '@rocket.chat/models';\nimport type { Request } from 'express';\nimport filesize from 'filesize';\nimport twilio from 'twilio';\n\nimport { settings } from '../../../../app/settings/server';\nimport { fileUploadIsValidContentType } from '../../../../app/utils/server/restrictions';\nimport { i18n } from '../../../lib/i18n';\nimport { SystemLogger } from '../../../lib/logger/system';\n\ntype TwilioData = {\n\tFrom: string;\n\tTo: string;\n\tBody: string;\n\tNumMedia?: string;\n\tToCountry?: string;\n\tToState?: string;\n\tToCity?: string;\n\tToZip?: string;\n\tFromCountry?: string;\n\tFromState?: string;\n\tFromCity?: string;\n\tFromZip?: string;\n\tLatitude?: string;\n\tLongitude?: string;\n} & Record<`MediaUrl${number}`, string> &\n\tRecord<`MediaContentType${number}`, string>;\n\nconst isTwilioData = (data: unknown): data is TwilioData => {\n\tif (typeof data !== 'object' || data === null) {\n\t\treturn false;\n\t}\n\n\tconst { From, To, Body } = data as Record<string, unknown>;\n\n\treturn typeof From === 'string' && typeof To === 'string' && typeof Body === 'string';\n};\n\nconst MAX_FILE_SIZE = 5242880;\n\nconst notifyAgent = (userId: string | undefined, rid: string | undefined, msg: string) =>\n\tuserId &&\n\trid &&\n\tvoid api.broadcast('notify.ephemeralMessage', userId, rid, {\n\t\tmsg,\n\t});\n\nexport class Twilio implements ISMSProvider {\n\tparse(data: unknown): ServiceData {\n\t\tlet numMedia = 0;\n\n\t\tif (!isTwilioData(data)) {\n\t\t\tthrow new Error('Invalid data');\n\t\t}\n\n\t\tconst returnData: ServiceData = {\n\t\t\tfrom: data.From,\n\t\t\tto: data.To,\n\t\t\tbody: data.Body,\n\n\t\t\textra: {\n\t\t\t\ttoCountry: data.ToCountry,\n\t\t\t\ttoState: data.ToState,\n\t\t\t\ttoCity: data.ToCity,\n\t\t\t\ttoZip: data.ToZip,\n\t\t\t\tfromCountry: data.FromCountry,\n\t\t\t\tfromState: data.FromState,\n\t\t\t\tfromCity: data.FromCity,\n\t\t\t\tfromZip: data.FromZip,\n\t\t\t\tfromLatitude: data.Latitude,\n\t\t\t\tfromLongitude: data.Longitude,\n\t\t\t},\n\t\t};\n\n\t\tif (data.NumMedia) {\n\t\t\tnumMedia = parseInt(data.NumMedia, 10);\n\t\t}\n\n\t\tif (isNaN(numMedia)) {\n\t\t\tSystemLogger.error(`Error parsing NumMedia ${data.NumMedia}`);\n\t\t\treturn returnData;\n\t\t}\n\n\t\treturnData.media = [];\n\n\t\tfor (let mediaIndex = 0; mediaIndex < numMedia; mediaIndex++) {\n\t\t\tconst media = {\n\t\t\t\turl: '',\n\t\t\t\tcontentType: '',\n\t\t\t};\n\n\t\t\tconst mediaUrl = data[`MediaUrl${mediaIndex}`];\n\t\t\tconst contentType = data[`MediaContentType${mediaIndex}`];\n\n\t\t\tmedia.url = mediaUrl;\n\t\t\tmedia.contentType = contentType;\n\n\t\t\treturnData.media.push(media);\n\t\t}\n\n\t\treturn returnData;\n\t}\n\n\tprivate async getClient(rid?: string, userId?: string) {\n\t\tconst sid = settings.get<string>('SMS_Twilio_Account_SID');\n\t\tconst token = settings.get<string>('SMS_Twilio_authToken');\n\t\tif (!sid || !token) {\n\t\t\tawait notifyAgent(userId, rid, i18n.t('SMS_Twilio_NotConfigured'));\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\treturn twilio(sid, token);\n\t\t} catch (error) {\n\t\t\tawait notifyAgent(userId, rid, i18n.t('SMS_Twilio_InvalidCredentials'));\n\t\t\tSystemLogger.error(`(Twilio) -> ${error}`);\n\t\t}\n\t}\n\n\tprivate async validateFileUpload(\n\t\textraData: {\n\t\t\tfileUpload?: { size: number; type: string; publicFilePath: string };\n\t\t\tlocation?: { coordinates: [number, number] };\n\t\t\trid?: string;\n\t\t\tuserId?: string;\n\t\t},\n\t\tlang: string,\n\t): Promise<string> {\n\t\tconst { rid, userId, fileUpload: { size, type, publicFilePath } = { size: 0, type: 'invalid' } } = extraData;\n\t\tconst user = userId ? await Users.findOne({ _id: userId }, { projection: { language: 1 } }) : null;\n\t\tconst lng = user?.language || lang;\n\n\t\tlet reason;\n\t\tif (!settings.get('SMS_Twilio_FileUpload_Enabled')) {\n\t\t\treason = i18n.t('FileUpload_Disabled', { lng });\n\t\t} else if (size > MAX_FILE_SIZE) {\n\t\t\treason = i18n.t('File_exceeds_allowed_size_of_bytes', {\n\t\t\t\tsize: filesize(MAX_FILE_SIZE),\n\t\t\t\tlng,\n\t\t\t});\n\t\t} else if (!fileUploadIsValidContentType(type, settings.get('SMS_Twilio_FileUpload_MediaTypeWhiteList'))) {\n\t\t\treason = i18n.t('File_type_is_not_accepted', { lng });\n\t\t} else if (!publicFilePath) {\n\t\t\treason = i18n.t('FileUpload_NotAllowed', { lng });\n\t\t}\n\n\t\t// Check if JWT is set for public file uploads when protect_files is on\n\t\t// If it's not, notify user upload won't go to twilio\n\t\tconst protectFileUploads = settings.get('FileUpload_ProtectFiles');\n\t\tconst jwtEnabled = settings.get('FileUpload_Enable_json_web_token_for_files');\n\t\tconst isJWTKeySet = jwtEnabled && !!settings.get('FileUpload_json_web_token_secret_for_files');\n\n\t\tif (protectFileUploads && (!jwtEnabled || !isJWTKeySet)) {\n\t\t\treason = i18n.t('FileUpload_ProtectFilesEnabled_JWTNotSet', { lng });\n\t\t}\n\n\t\tif (reason) {\n\t\t\tawait notifyAgent(userId, rid, reason);\n\t\t\tSystemLogger.error(`(Twilio) -> ${reason}`);\n\t\t\treturn '';\n\t\t}\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\treturn publicFilePath!;\n\t}\n\n\tasync send(\n\t\tfromNumber: string,\n\t\ttoNumber: string,\n\t\tmessage: string,\n\t\textraData?: {\n\t\t\tfileUpload?: { size: number; type: string; publicFilePath: string };\n\t\t\tlocation?: { coordinates: [number, number] };\n\t\t\trid?: string;\n\t\t\tuserId?: string;\n\t\t},\n\t): Promise<SMSProviderResult> {\n\t\tconst { rid, userId } = extraData || {};\n\n\t\tconst client = await this.getClient(rid, userId);\n\t\tif (!client) {\n\t\t\treturn {\n\t\t\t\tisSuccess: false,\n\t\t\t\tresultMsg: 'Twilio not configured',\n\t\t\t};\n\t\t}\n\n\t\tlet body = message;\n\n\t\tlet mediaUrl;\n\t\tconst defaultLanguage = settings.get<string>('Language') || 'en';\n\t\tif (extraData?.fileUpload) {\n\t\t\tconst publicFilePath = await this.validateFileUpload(extraData, defaultLanguage);\n\t\t\tif (!publicFilePath) {\n\t\t\t\treturn {\n\t\t\t\t\tisSuccess: false,\n\t\t\t\t\tresultMsg: 'File upload not allowed',\n\t\t\t\t};\n\t\t\t}\n\t\t\tmediaUrl = [publicFilePath];\n\t\t}\n\n\t\tlet persistentAction;\n\t\tif (extraData?.location) {\n\t\t\tconst [longitude, latitude] = extraData.location.coordinates;\n\t\t\tpersistentAction = `geo:${latitude},${longitude}`;\n\t\t\tbody = i18n.t('Location', { lng: defaultLanguage });\n\t\t}\n\n\t\ttry {\n\t\t\tconst result = await client.messages.create({\n\t\t\t\tto: toNumber,\n\t\t\t\tfrom: fromNumber,\n\t\t\t\tbody,\n\t\t\t\t...(mediaUrl && { mediaUrl }),\n\t\t\t\t...(persistentAction && { persistentAction }),\n\t\t\t});\n\n\t\t\tif (result.errorCode) {\n\t\t\t\tawait notifyAgent(userId, rid, result.errorMessage);\n\t\t\t\tSystemLogger.error(`(Twilio) -> ${result.errorCode}`);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tisSuccess: result.status !== 'failed',\n\t\t\t\tresultMsg: result.status,\n\t\t\t};\n\t\t} catch (e: any) {\n\t\t\tawait notifyAgent(userId, rid, e.message);\n\t\t\treturn {\n\t\t\t\tisSuccess: false,\n\t\t\t\tresultMsg: e.message,\n\t\t\t};\n\t\t}\n\t}\n\n\tresponse(): SMSProviderResponse {\n\t\treturn {\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'text/xml',\n\t\t\t},\n\t\t\tbody: '<Response></Response>',\n\t\t};\n\t}\n\n\tisRequestFromTwilio(signature: string, request: Request): boolean {\n\t\tconst authToken = settings.get<string>('SMS_Twilio_authToken');\n\t\tlet siteUrl = settings.get<string>('Site_Url');\n\t\tif (siteUrl.endsWith('/')) {\n\t\t\tsiteUrl = siteUrl.replace(/.$/, '');\n\t\t}\n\n\t\tif (!authToken || !siteUrl) {\n\t\t\tSystemLogger.error(`(Twilio) -> URL or Twilio token not configured.`);\n\t\t\treturn false;\n\t\t}\n\n\t\tconst twilioUrl = request.originalUrl ? `${siteUrl}${request.originalUrl}` : `${siteUrl}/api/v1/livechat/sms-incoming/twilio`;\n\n\t\treturn twilio.validateRequest(authToken, signature, twilioUrl, request.body);\n\t}\n\n\tvalidateRequest(request: Request): boolean {\n\t\t// We're not getting original twilio requests on CI :p\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\treturn true;\n\t\t}\n\t\tconst twilioHeader = request.headers['x-twilio-signature'] || '';\n\t\tconst twilioSignature = Array.isArray(twilioHeader) ? twilioHeader[0] : twilioHeader;\n\t\treturn this.isRequestFromTwilio(twilioSignature, request);\n\t}\n\n\terror(error: Error & { reason?: string }): SMSProviderResponse {\n\t\tlet message = '';\n\t\tif (error.reason) {\n\t\t\tmessage = `<Message>${error.reason}</Message>`;\n\t\t}\n\t\treturn {\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'text/xml',\n\t\t\t},\n\t\t\tbody: `<Response>${message}</Response>`,\n\t\t};\n\t}\n}\n"],"names":["Twilio","isTwilioData","data","From","To","Body","MAX_FILE_SIZE","notifyAgent","userId","rid","msg","api","broadcast","parse","numMedia","Error","returnData","from","to","body","extra","toCountry","ToCountry","toState","ToState","toCity","ToCity","toZip","ToZip","fromCountry","FromCountry","fromState","FromState","fromCity","FromCity","fromZip","FromZip","fromLatitude","Latitude","fromLongitude","Longitude","NumMedia","parseInt","isNaN","SystemLogger","error","media","mediaIndex","url","contentType","mediaUrl","push","getClient","sid","settings","get","token","i18n","t","twilio","validateFileUpload","extraData","lang","fileUpload","size","type","publicFilePath","user","Users","findOne","_id","projection","language","lng","reason","filesize","fileUploadIsValidContentType","protectFileUploads","jwtEnabled","isJWTKeySet","send","fromNumber","toNumber","message","client","isSuccess","resultMsg","defaultLanguage","persistentAction","location","longitude","latitude","coordinates","result","messages","create","errorCode","errorMessage","status","e","response","headers","isRequestFromTwilio","signature","request","authToken","siteUrl","endsWith","replace","twilioUrl","originalUrl","validateRequest","process","env","TEST_MODE","twilioHeader","twilioSignature","Array","isArray"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/omnichannel-integrations/providers/twilio.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7bf4f8a3eef75ad8e6f9d0b4284dc090697e2f11","contentHash":"b881df0b1d99f903c30400f9c9b77e9ee38afd9113937017da7b1077c8ccafb0"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/saveUserIdentity.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/saveUserIdentity.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":32}},"3":{"start":{"line":11,"column":16},"end":{"line":11,"column":46}},"4":{"start":{"line":12,"column":16},"end":{"line":12,"column":63}},"5":{"start":{"line":13,"column":16},"end":{"line":13,"column":54}},"6":{"start":{"line":14,"column":24},"end":{"line":14,"column":56}},"7":{"start":{"line":15,"column":21},"end":{"line":15,"column":45}},"8":{"start":{"line":16,"column":21},"end":{"line":16,"column":45}},"9":{"start":{"line":17,"column":28},"end":{"line":17,"column":59}},"10":{"start":{"line":18,"column":22},"end":{"line":18,"column":47}},"11":{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},"12":{"start":{"line":21,"column":8},"end":{"line":21,"column":21}},"13":{"start":{"line":23,"column":17},"end":{"line":23,"column":39}},"14":{"start":{"line":24,"column":21},"end":{"line":24,"column":47}},"15":{"start":{"line":25,"column":17},"end":{"line":25,"column":53}},"16":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"17":{"start":{"line":27,"column":8},"end":{"line":27,"column":21}},"18":{"start":{"line":29,"column":29},"end":{"line":29,"column":42}},"19":{"start":{"line":30,"column":25},"end":{"line":30,"column":34}},"20":{"start":{"line":31,"column":24},"end":{"line":31,"column":45}},"21":{"start":{"line":32,"column":28},"end":{"line":32,"column":57}},"22":{"start":{"line":33,"column":4},"end":{"line":41,"column":5}},"23":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"24":{"start":{"line":35,"column":12},"end":{"line":35,"column":25}},"25":{"start":{"line":37,"column":8},"end":{"line":39,"column":9}},"26":{"start":{"line":38,"column":12},"end":{"line":38,"column":25}},"27":{"start":{"line":40,"column":8},"end":{"line":40,"column":33}},"28":{"start":{"line":42,"column":4},"end":{"line":46,"column":5}},"29":{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},"30":{"start":{"line":44,"column":12},"end":{"line":44,"column":25}},"31":{"start":{"line":48,"column":4},"end":{"line":71,"column":5}},"32":{"start":{"line":49,"column":35},"end":{"line":59,"column":9}},"33":{"start":{"line":60,"column":8},"end":{"line":70,"column":9}},"34":{"start":{"line":61,"column":12},"end":{"line":67,"column":15}},"35":{"start":{"line":62,"column":16},"end":{"line":66,"column":17}},"36":{"start":{"line":63,"column":20},"end":{"line":63,"column":71}},"37":{"start":{"line":65,"column":20},"end":{"line":65,"column":52}},"38":{"start":{"line":69,"column":12},"end":{"line":69,"column":63}},"39":{"start":{"line":72,"column":4},"end":{"line":72,"column":16}},"40":{"start":{"line":75,"column":4},"end":{"line":111,"column":5}},"41":{"start":{"line":77,"column":26},"end":{"line":77,"column":64}},"42":{"start":{"line":78,"column":29},"end":{"line":78,"column":82}},"43":{"start":{"line":79,"column":21},"end":{"line":79,"column":66}},"44":{"start":{"line":80,"column":8},"end":{"line":82,"column":9}},"45":{"start":{"line":81,"column":12},"end":{"line":81,"column":55}},"46":{"start":{"line":83,"column":8},"end":{"line":85,"column":9}},"47":{"start":{"line":84,"column":12},"end":{"line":84,"column":81}},"48":{"start":{"line":86,"column":8},"end":{"line":86,"column":78}},"49":{"start":{"line":87,"column":8},"end":{"line":87,"column":80}},"50":{"start":{"line":88,"column":23},"end":{"line":88,"column":71}},"51":{"start":{"line":89,"column":8},"end":{"line":92,"column":9}},"52":{"start":{"line":90,"column":31},"end":{"line":90,"column":104}},"53":{"start":{"line":91,"column":12},"end":{"line":91,"column":136}},"54":{"start":{"line":93,"column":26},"end":{"line":99,"column":10}},"55":{"start":{"line":100,"column":8},"end":{"line":102,"column":9}},"56":{"start":{"line":101,"column":12},"end":{"line":101,"column":84}},"57":{"start":{"line":103,"column":8},"end":{"line":110,"column":9}},"58":{"start":{"line":104,"column":12},"end":{"line":109,"column":15}},"59":{"start":{"line":113,"column":4},"end":{"line":126,"column":5}},"60":{"start":{"line":115,"column":41},"end":{"line":115,"column":159}},"61":{"start":{"line":116,"column":8},"end":{"line":121,"column":9}},"62":{"start":{"line":117,"column":12},"end":{"line":120,"column":15}},"63":{"start":{"line":123,"column":8},"end":{"line":123,"column":64}},"64":{"start":{"line":125,"column":8},"end":{"line":125,"column":121}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"saveUserIdentity","decl":{"start":{"line":19,"column":15},"end":{"line":19,"column":31}},"loc":{"start":{"line":19,"column":115},"end":{"line":73,"column":1}},"line":19},"2":{"name":"(anonymous_2)","decl":{"start":{"line":61,"column":25},"end":{"line":61,"column":26}},"loc":{"start":{"line":61,"column":35},"end":{"line":67,"column":13}},"line":61},"3":{"name":"updateUsernameReferences","decl":{"start":{"line":74,"column":15},"end":{"line":74,"column":39}},"loc":{"start":{"line":74,"column":150},"end":{"line":127,"column":1}},"line":74}},"branchMap":{"0":{"loc":{"start":{"line":19,"column":77},"end":{"line":19,"column":111}},"type":"default-arg","locations":[{"start":{"line":19,"column":106},"end":{"line":19,"column":111}}],"line":19},"1":{"loc":{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},"type":"if","locations":[{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},{"start":{"line":20,"column":4},"end":{"line":22,"column":5}}],"line":20},"2":{"loc":{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},"type":"if","locations":[{"start":{"line":26,"column":4},"end":{"line":28,"column":5}},{"start":{"line":26,"column":4},"end":{"line":28,"column":5}}],"line":26},"3":{"loc":{"start":{"line":33,"column":4},"end":{"line":41,"column":5}},"type":"if","locations":[{"start":{"line":33,"column":4},"end":{"line":41,"column":5}},{"start":{"line":33,"column":4},"end":{"line":41,"column":5}}],"line":33},"4":{"loc":{"start":{"line":33,"column":8},"end":{"line":33,"column":61}},"type":"binary-expr","locations":[{"start":{"line":33,"column":8},"end":{"line":33,"column":42}},{"start":{"line":33,"column":46},"end":{"line":33,"column":61}}],"line":33},"5":{"loc":{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},"type":"if","locations":[{"start":{"line":34,"column":8},"end":{"line":36,"column":9}},{"start":{"line":34,"column":8},"end":{"line":36,"column":9}}],"line":34},"6":{"loc":{"start":{"line":37,"column":8},"end":{"line":39,"column":9}},"type":"if","locations":[{"start":{"line":37,"column":8},"end":{"line":39,"column":9}},{"start":{"line":37,"column":8},"end":{"line":39,"column":9}}],"line":37},"7":{"loc":{"start":{"line":42,"column":4},"end":{"line":46,"column":5}},"type":"if","locations":[{"start":{"line":42,"column":4},"end":{"line":46,"column":5}},{"start":{"line":42,"column":4},"end":{"line":46,"column":5}}],"line":42},"8":{"loc":{"start":{"line":42,"column":8},"end":{"line":42,"column":53}},"type":"binary-expr","locations":[{"start":{"line":42,"column":8},"end":{"line":42,"column":38}},{"start":{"line":42,"column":42},"end":{"line":42,"column":53}}],"line":42},"9":{"loc":{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},"type":"if","locations":[{"start":{"line":43,"column":8},"end":{"line":45,"column":9}},{"start":{"line":43,"column":8},"end":{"line":45,"column":9}}],"line":43},"10":{"loc":{"start":{"line":48,"column":4},"end":{"line":71,"column":5}},"type":"if","locations":[{"start":{"line":48,"column":4},"end":{"line":71,"column":5}},{"start":{"line":48,"column":4},"end":{"line":71,"column":5}}],"line":48},"11":{"loc":{"start":{"line":60,"column":8},"end":{"line":70,"column":9}},"type":"if","locations":[{"start":{"line":60,"column":8},"end":{"line":70,"column":9}},{"start":{"line":60,"column":8},"end":{"line":70,"column":9}}],"line":60},"12":{"loc":{"start":{"line":75,"column":4},"end":{"line":111,"column":5}},"type":"if","locations":[{"start":{"line":75,"column":4},"end":{"line":111,"column":5}},{"start":{"line":75,"column":4},"end":{"line":111,"column":5}}],"line":75},"13":{"loc":{"start":{"line":75,"column":8},"end":{"line":75,"column":61}},"type":"binary-expr","locations":[{"start":{"line":75,"column":8},"end":{"line":75,"column":23}},{"start":{"line":75,"column":27},"end":{"line":75,"column":61}}],"line":75},"14":{"loc":{"start":{"line":80,"column":8},"end":{"line":82,"column":9}},"type":"if","locations":[{"start":{"line":80,"column":8},"end":{"line":82,"column":9}},{"start":{"line":80,"column":8},"end":{"line":82,"column":9}}],"line":80},"15":{"loc":{"start":{"line":83,"column":8},"end":{"line":85,"column":9}},"type":"if","locations":[{"start":{"line":83,"column":8},"end":{"line":85,"column":9}},{"start":{"line":83,"column":8},"end":{"line":85,"column":9}}],"line":83},"16":{"loc":{"start":{"line":100,"column":8},"end":{"line":102,"column":9}},"type":"if","locations":[{"start":{"line":100,"column":8},"end":{"line":102,"column":9}},{"start":{"line":100,"column":8},"end":{"line":102,"column":9}}],"line":100},"17":{"loc":{"start":{"line":100,"column":12},"end":{"line":100,"column":112}},"type":"cond-expr","locations":[{"start":{"line":100,"column":78},"end":{"line":100,"column":84}},{"start":{"line":100,"column":87},"end":{"line":100,"column":112}}],"line":100},"18":{"loc":{"start":{"line":100,"column":12},"end":{"line":100,"column":75}},"type":"binary-expr","locations":[{"start":{"line":100,"column":12},"end":{"line":100,"column":49}},{"start":{"line":100,"column":53},"end":{"line":100,"column":75}}],"line":100},"19":{"loc":{"start":{"line":103,"column":8},"end":{"line":110,"column":9}},"type":"if","locations":[{"start":{"line":103,"column":8},"end":{"line":110,"column":9}},{"start":{"line":103,"column":8},"end":{"line":110,"column":9}}],"line":103},"20":{"loc":{"start":{"line":103,"column":12},"end":{"line":103,"column":335}},"type":"binary-expr","locations":[{"start":{"line":103,"column":13},"end":{"line":103,"column":116}},{"start":{"line":103,"column":122},"end":{"line":103,"column":225}},{"start":{"line":103,"column":231},"end":{"line":103,"column":334}}],"line":103},"21":{"loc":{"start":{"line":103,"column":13},"end":{"line":103,"column":116}},"type":"cond-expr","locations":[{"start":{"line":103,"column":81},"end":{"line":103,"column":87}},{"start":{"line":103,"column":90},"end":{"line":103,"column":116}}],"line":103},"22":{"loc":{"start":{"line":103,"column":13},"end":{"line":103,"column":78}},"type":"binary-expr","locations":[{"start":{"line":103,"column":13},"end":{"line":103,"column":51}},{"start":{"line":103,"column":55},"end":{"line":103,"column":78}}],"line":103},"23":{"loc":{"start":{"line":103,"column":122},"end":{"line":103,"column":225}},"type":"cond-expr","locations":[{"start":{"line":103,"column":190},"end":{"line":103,"column":196}},{"start":{"line":103,"column":199},"end":{"line":103,"column":225}}],"line":103},"24":{"loc":{"start":{"line":103,"column":122},"end":{"line":103,"column":187}},"type":"binary-expr","locations":[{"start":{"line":103,"column":122},"end":{"line":103,"column":160}},{"start":{"line":103,"column":164},"end":{"line":103,"column":187}}],"line":103},"25":{"loc":{"start":{"line":103,"column":231},"end":{"line":103,"column":334}},"type":"cond-expr","locations":[{"start":{"line":103,"column":299},"end":{"line":103,"column":305}},{"start":{"line":103,"column":308},"end":{"line":103,"column":334}}],"line":103},"26":{"loc":{"start":{"line":103,"column":231},"end":{"line":103,"column":296}},"type":"binary-expr","locations":[{"start":{"line":103,"column":231},"end":{"line":103,"column":269}},{"start":{"line":103,"column":273},"end":{"line":103,"column":296}}],"line":103},"27":{"loc":{"start":{"line":113,"column":4},"end":{"line":126,"column":5}},"type":"if","locations":[{"start":{"line":113,"column":4},"end":{"line":126,"column":5}},{"start":{"line":113,"column":4},"end":{"line":126,"column":5}}],"line":113},"28":{"loc":{"start":{"line":113,"column":8},"end":{"line":113,"column":38}},"type":"binary-expr","locations":[{"start":{"line":113,"column":8},"end":{"line":113,"column":23}},{"start":{"line":113,"column":27},"end":{"line":113,"column":38}}],"line":113},"29":{"loc":{"start":{"line":115,"column":118},"end":{"line":115,"column":141}},"type":"binary-expr","locations":[{"start":{"line":115,"column":118},"end":{"line":115,"column":129}},{"start":{"line":115,"column":133},"end":{"line":115,"column":141}}],"line":115},"30":{"loc":{"start":{"line":115,"column":143},"end":{"line":115,"column":158}},"type":"binary-expr","locations":[{"start":{"line":115,"column":143},"end":{"line":115,"column":150}},{"start":{"line":115,"column":154},"end":{"line":115,"column":158}}],"line":115},"31":{"loc":{"start":{"line":116,"column":8},"end":{"line":121,"column":9}},"type":"if","locations":[{"start":{"line":116,"column":8},"end":{"line":121,"column":9}},{"start":{"line":116,"column":8},"end":{"line":121,"column":9}}],"line":116},"32":{"loc":{"start":{"line":116,"column":12},"end":{"line":116,"column":134}},"type":"cond-expr","locations":[{"start":{"line":116,"column":87},"end":{"line":116,"column":93}},{"start":{"line":116,"column":96},"end":{"line":116,"column":134}}],"line":116},"33":{"loc":{"start":{"line":116,"column":12},"end":{"line":116,"column":84}},"type":"binary-expr","locations":[{"start":{"line":116,"column":12},"end":{"line":116,"column":45}},{"start":{"line":116,"column":49},"end":{"line":116,"column":84}}],"line":116},"34":{"loc":{"start":{"line":125,"column":69},"end":{"line":125,"column":97}},"type":"binary-expr","locations":[{"start":{"line":125,"column":69},"end":{"line":125,"column":77}},{"start":{"line":125,"column":81},"end":{"line":125,"column":97}}],"line":125},"35":{"loc":{"start":{"line":125,"column":99},"end":{"line":125,"column":119}},"type":"binary-expr","locations":[{"start":{"line":125,"column":99},"end":{"line":125,"column":103}},{"start":{"line":125,"column":107},"end":{"line":125,"column":119}}],"line":125}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":7,"12":1,"13":6,"14":6,"15":6,"16":6,"17":1,"18":5,"19":5,"20":5,"21":5,"22":5,"23":2,"24":1,"25":1,"26":1,"27":0,"28":3,"29":2,"30":1,"31":2,"32":2,"33":2,"34":0,"35":0,"36":0,"37":0,"38":2,"39":2,"40":2,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":2,"60":1,"61":1,"62":0,"63":1,"64":1},"f":{"0":1,"1":7,"2":0,"3":2},"b":{"0":[7],"1":[1,6],"2":[1,5],"3":[2,3],"4":[5,4],"5":[1,1],"6":[1,0],"7":[2,1],"8":[3,3],"9":[1,1],"10":[2,0],"11":[0,2],"12":[0,2],"13":[2,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[1,1],"28":[2,2],"29":[1,1],"30":[1,1],"31":[0,1],"32":[1,0],"33":[1,1],"34":[1,0],"35":[1,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/saveUserIdentity.ts"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { Messages, VideoConference, LivechatDepartmentAgents, Rooms, Subscriptions, Users } from '@rocket.chat/models';\n\nimport { SystemLogger } from '../../../../server/lib/logger/system';\nimport { FileUpload } from '../../../file-upload/server';\nimport {\n\tnotifyOnRoomChangedByUsernamesOrUids,\n\tnotifyOnSubscriptionChangedByUserId,\n\tnotifyOnSubscriptionChangedByNameAndRoomType,\n} from '../lib/notifyListener';\nimport { _setRealName } from './setRealName';\nimport { _setUsername } from './setUsername';\nimport { updateGroupDMsName } from './updateGroupDMsName';\nimport { validateName } from './validateName';\n\n/**\n *\n * @param {object} changes changes to the user\n */\n\nexport async function saveUserIdentity({\n\t_id,\n\tname: rawName,\n\tusername: rawUsername,\n\tupdateUsernameInBackground = false,\n}: {\n\t_id: string;\n\tname?: string;\n\tusername?: string;\n\tupdateUsernameInBackground?: boolean; // TODO: remove this\n}) {\n\tif (!_id) {\n\t\treturn false;\n\t}\n\n\tconst name = String(rawName).trim();\n\tconst username = String(rawUsername).trim();\n\n\tconst user = await Users.findOneById(_id);\n\tif (!user) {\n\t\treturn false;\n\t}\n\n\tconst previousUsername = user.username;\n\tconst previousName = user.name;\n\tconst nameChanged = previousName !== name;\n\tconst usernameChanged = previousUsername !== username;\n\n\tif (typeof rawUsername !== 'undefined' && usernameChanged) {\n\t\tif (!validateName(username)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!(await _setUsername(_id, username, user))) {\n\t\t\treturn false;\n\t\t}\n\t\tuser.username = username;\n\t}\n\n\tif (typeof rawName !== 'undefined' && nameChanged) {\n\t\tif (!(await _setRealName(_id, name, user))) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t// if coming from old username, update all references\n\tif (previousUsername) {\n\t\tconst handleUpdateParams = {\n\t\t\tusername,\n\t\t\tpreviousUsername,\n\t\t\trawUsername,\n\t\t\tusernameChanged,\n\t\t\tuser,\n\t\t\tname,\n\t\t\tpreviousName,\n\t\t\trawName,\n\t\t\tnameChanged,\n\t\t};\n\t\tif (updateUsernameInBackground) {\n\t\t\tsetImmediate(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tawait updateUsernameReferences(handleUpdateParams);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tSystemLogger.error(err);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tawait updateUsernameReferences(handleUpdateParams);\n\t\t}\n\t}\n\n\treturn true;\n}\n\nasync function updateUsernameReferences({\n\tusername,\n\tpreviousUsername,\n\trawUsername,\n\tusernameChanged,\n\tuser,\n\tname,\n\tpreviousName,\n\trawName,\n\tnameChanged,\n}: {\n\tusername: string;\n\tpreviousUsername: string;\n\trawUsername?: string;\n\tusernameChanged: boolean;\n\tuser: IUser;\n\tname: string;\n\tpreviousName: string | undefined;\n\trawName?: string;\n\tnameChanged: boolean;\n}): Promise<void> {\n\tif (usernameChanged && typeof rawUsername !== 'undefined') {\n\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\tconst previousFile = await fileStore.model.findOneByName(previousUsername);\n\t\tconst file = await fileStore.model.findOneByName(username);\n\t\tif (file) {\n\t\t\tawait fileStore.model.deleteFile(file._id);\n\t\t}\n\t\tif (previousFile) {\n\t\t\tawait fileStore.model.updateFileNameById(previousFile._id, username);\n\t\t}\n\n\t\tawait Messages.updateAllUsernamesByUserId(user._id, username);\n\t\tawait Messages.updateUsernameOfEditByUserId(user._id, username);\n\n\t\tconst cursor = Messages.findByMention(previousUsername);\n\t\tfor await (const msg of cursor) {\n\t\t\tconst updatedMsg = msg.msg.replace(new RegExp(`@${previousUsername}`, 'ig'), `@${username}`);\n\t\t\tawait Messages.updateUsernameAndMessageOfMentionByIdAndOldUsername(msg._id, previousUsername, username, updatedMsg);\n\t\t}\n\n\t\tconst responses = await Promise.all([\n\t\t\tRooms.replaceUsername(previousUsername, username),\n\t\t\tRooms.replaceMutedUsername(previousUsername, username),\n\t\t\tRooms.replaceUsernameOfUserByUserId(user._id, username),\n\t\t\tSubscriptions.setUserUsernameByUserId(user._id, username),\n\t\t\tLivechatDepartmentAgents.replaceUsernameOfAgentByUserId(user._id, username),\n\t\t]);\n\n\t\tif (responses[3]?.modifiedCount) {\n\t\t\tvoid notifyOnSubscriptionChangedByUserId(user._id);\n\t\t}\n\n\t\tif (responses[0]?.modifiedCount || responses[1]?.modifiedCount || responses[2]?.modifiedCount) {\n\t\t\tvoid notifyOnRoomChangedByUsernamesOrUids([user._id], [previousUsername, username]);\n\t\t}\n\t}\n\n\t// update other references if either the name or username has changed\n\tif (usernameChanged || nameChanged) {\n\t\t// update name and fname of 1-on-1 direct messages\n\t\tconst updateDirectNameResponse = await Subscriptions.updateDirectNameAndFnameByName(\n\t\t\tpreviousUsername,\n\t\t\trawUsername && username,\n\t\t\trawName && name,\n\t\t);\n\n\t\tif (updateDirectNameResponse?.modifiedCount) {\n\t\t\tvoid notifyOnSubscriptionChangedByNameAndRoomType({\n\t\t\t\tt: 'd',\n\t\t\t\tname: username,\n\t\t\t});\n\t\t}\n\n\t\t// update name and fname of group direct messages\n\t\tawait updateGroupDMsName(user);\n\n\t\t// update name and username of users on video conferences\n\t\tawait VideoConference.updateUserReferences(user._id, username || previousUsername, name || previousName);\n\t}\n}\n"],"names":["saveUserIdentity","_id","name","rawName","username","rawUsername","updateUsernameInBackground","String","trim","user","Users","findOneById","previousUsername","previousName","nameChanged","usernameChanged","validateName","_setUsername","_setRealName","handleUpdateParams","setImmediate","updateUsernameReferences","err","SystemLogger","error","responses","fileStore","FileUpload","getStore","previousFile","model","findOneByName","file","deleteFile","updateFileNameById","Messages","updateAllUsernamesByUserId","updateUsernameOfEditByUserId","cursor","findByMention","msg","updatedMsg","replace","RegExp","updateUsernameAndMessageOfMentionByIdAndOldUsername","Promise","all","Rooms","replaceUsername","replaceMutedUsername","replaceUsernameOfUserByUserId","Subscriptions","setUserUsernameByUserId","LivechatDepartmentAgents","replaceUsernameOfAgentByUserId","modifiedCount","notifyOnSubscriptionChangedByUserId","notifyOnRoomChangedByUsernamesOrUids","updateDirectNameResponse","updateDirectNameAndFnameByName","notifyOnSubscriptionChangedByNameAndRoomType","t","updateGroupDMsName","VideoConference","updateUserReferences"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/saveUserIdentity.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f4425deb8738d2a1518fddb7b52b2a720c518052","contentHash":"9492fa93d2fee19e5308643d83fc5f4785f8948756d6d0cb852094ece8b7f31c"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/notifications/email.js":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/notifications/email.js","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":6,"column":4},"end":{"line":9,"column":7}},"2":{"start":{"line":6,"column":24},"end":{"line":9,"column":7}},"3":{"start":{"line":11,"column":0},"end":{"line":24,"column":3}},"4":{"start":{"line":13,"column":8},"end":{"line":13,"column":31}},"5":{"start":{"line":16,"column":8},"end":{"line":16,"column":28}},"6":{"start":{"line":19,"column":8},"end":{"line":19,"column":33}},"7":{"start":{"line":22,"column":8},"end":{"line":22,"column":33}},"8":{"start":{"line":25,"column":23},"end":{"line":25,"column":61}},"9":{"start":{"line":26,"column":16},"end":{"line":26,"column":40}},"10":{"start":{"line":27,"column":19},"end":{"line":27,"column":58}},"11":{"start":{"line":28,"column":21},"end":{"line":28,"column":68}},"12":{"start":{"line":29,"column":14},"end":{"line":29,"column":55}},"13":{"start":{"line":30,"column":25},"end":{"line":30,"column":83}},"14":{"start":{"line":31,"column":27},"end":{"line":31,"column":94}},"15":{"start":{"line":32,"column":16},"end":{"line":32,"column":53}},"16":{"start":{"line":33,"column":17},"end":{"line":33,"column":55}},"17":{"start":{"line":34,"column":16},"end":{"line":34,"column":58}},"18":{"start":{"line":36,"column":4},"end":{"line":36,"column":51}},"19":{"start":{"line":36,"column":39},"end":{"line":36,"column":51}},"20":{"start":{"line":37,"column":28},"end":{"line":37,"column":41}},"21":{"start":{"line":38,"column":27},"end":{"line":38,"column":40}},"22":{"start":{"line":39,"column":4},"end":{"line":41,"column":20}},"23":{"start":{"line":40,"column":8},"end":{"line":40,"column":66}},"24":{"start":{"line":44,"column":4},"end":{"line":46,"column":5}},"25":{"start":{"line":45,"column":8},"end":{"line":45,"column":19}},"26":{"start":{"line":47,"column":4},"end":{"line":51,"column":5}},"27":{"start":{"line":48,"column":8},"end":{"line":50,"column":10}},"28":{"start":{"line":52,"column":16},"end":{"line":52,"column":53}},"29":{"start":{"line":53,"column":4},"end":{"line":55,"column":5}},"30":{"start":{"line":54,"column":8},"end":{"line":54,"column":30}},"31":{"start":{"line":56,"column":17},"end":{"line":58,"column":5}},"32":{"start":{"line":59,"column":32},"end":{"line":59,"column":88}},"33":{"start":{"line":60,"column":4},"end":{"line":69,"column":5}},"34":{"start":{"line":61,"column":8},"end":{"line":68,"column":9}},"35":{"start":{"line":62,"column":23},"end":{"line":62,"column":95}},"36":{"start":{"line":63,"column":12},"end":{"line":67,"column":13}},"37":{"start":{"line":64,"column":16},"end":{"line":64,"column":57}},"38":{"start":{"line":66,"column":16},"end":{"line":66,"column":39}},"39":{"start":{"line":70,"column":4},"end":{"line":70,"column":25}},"40":{"start":{"line":71,"column":4},"end":{"line":73,"column":5}},"41":{"start":{"line":72,"column":8},"end":{"line":72,"column":31}},"42":{"start":{"line":74,"column":4},"end":{"line":74,"column":18}},"43":{"start":{"line":76,"column":13},"end":{"line":76,"column":15}},"44":{"start":{"line":77,"column":18},"end":{"line":77,"column":20}},"45":{"start":{"line":78,"column":0},"end":{"line":85,"column":3}},"46":{"start":{"line":79,"column":4},"end":{"line":81,"column":7}},"47":{"start":{"line":80,"column":8},"end":{"line":80,"column":110}},"48":{"start":{"line":82,"column":4},"end":{"line":84,"column":7}},"49":{"start":{"line":83,"column":8},"end":{"line":83,"column":23}},"50":{"start":{"line":87,"column":16},"end":{"line":87,"column":82}},"51":{"start":{"line":88,"column":21},"end":{"line":88,"column":123}},"52":{"start":{"line":89,"column":21},"end":{"line":89,"column":154}},"53":{"start":{"line":90,"column":27},"end":{"line":90,"column":85}},"54":{"start":{"line":91,"column":19},"end":{"line":95,"column":6}},"55":{"start":{"line":96,"column":4},"end":{"line":100,"column":5}},"56":{"start":{"line":97,"column":8},"end":{"line":99,"column":20}},"57":{"start":{"line":101,"column":4},"end":{"line":114,"column":5}},"58":{"start":{"line":102,"column":8},"end":{"line":104,"column":9}},"59":{"start":{"line":103,"column":12},"end":{"line":103,"column":26}},"60":{"start":{"line":105,"column":29},"end":{"line":105,"column":72}},"61":{"start":{"line":106,"column":8},"end":{"line":106,"column":75}},"62":{"start":{"line":107,"column":8},"end":{"line":112,"column":9}},"63":{"start":{"line":108,"column":12},"end":{"line":111,"column":15}},"64":{"start":{"line":109,"column":16},"end":{"line":109,"column":80}},"65":{"start":{"line":110,"column":16},"end":{"line":110,"column":81}},"66":{"start":{"line":113,"column":8},"end":{"line":113,"column":80}},"67":{"start":{"line":115,"column":4},"end":{"line":129,"column":5}},"68":{"start":{"line":116,"column":27},"end":{"line":120,"column":10}},"69":{"start":{"line":121,"column":8},"end":{"line":123,"column":9}},"70":{"start":{"line":122,"column":12},"end":{"line":122,"column":30}},"71":{"start":{"line":124,"column":22},"end":{"line":124,"column":76}},"72":{"start":{"line":125,"column":8},"end":{"line":127,"column":9}},"73":{"start":{"line":126,"column":12},"end":{"line":126,"column":105}},"74":{"start":{"line":128,"column":8},"end":{"line":128,"column":52}},"75":{"start":{"line":130,"column":4},"end":{"line":132,"column":5}},"76":{"start":{"line":131,"column":8},"end":{"line":131,"column":22}},"77":{"start":{"line":133,"column":4},"end":{"line":143,"column":5}},"78":{"start":{"line":134,"column":29},"end":{"line":134,"column":48}},"79":{"start":{"line":135,"column":22},"end":{"line":135,"column":24}},"80":{"start":{"line":136,"column":8},"end":{"line":138,"column":9}},"81":{"start":{"line":137,"column":12},"end":{"line":137,"column":82}},"82":{"start":{"line":139,"column":8},"end":{"line":141,"column":9}},"83":{"start":{"line":140,"column":12},"end":{"line":140,"column":81}},"84":{"start":{"line":142,"column":8},"end":{"line":142,"column":48}},"85":{"start":{"line":144,"column":4},"end":{"line":144,"column":18}},"86":{"start":{"line":146,"column":21},"end":{"line":158,"column":1}},"87":{"start":{"line":147,"column":21},"end":{"line":147,"column":130}},"88":{"start":{"line":148,"column":17},"end":{"line":148,"column":79}},"89":{"start":{"line":149,"column":4},"end":{"line":157,"column":46}},"90":{"start":{"line":160,"column":4},"end":{"line":160,"column":83}},"91":{"start":{"line":164,"column":21},"end":{"line":164,"column":122}},"92":{"start":{"line":165,"column":21},"end":{"line":165,"column":48}},"93":{"start":{"line":166,"column":4},"end":{"line":170,"column":5}},"94":{"start":{"line":167,"column":8},"end":{"line":167,"column":40}},"95":{"start":{"line":168,"column":11},"end":{"line":170,"column":5}},"96":{"start":{"line":169,"column":8},"end":{"line":169,"column":45}},"97":{"start":{"line":171,"column":25},"end":{"line":174,"column":6}},"98":{"start":{"line":175,"column":20},"end":{"line":179,"column":6}},"99":{"start":{"line":180,"column":22},"end":{"line":180,"column":63}},"100":{"start":{"line":181,"column":25},"end":{"line":181,"column":123}},"101":{"start":{"line":182,"column":18},"end":{"line":191,"column":5}},"102":{"start":{"line":192,"column":4},"end":{"line":195,"column":5}},"103":{"start":{"line":193,"column":30},"end":{"line":193,"column":43}},"104":{"start":{"line":194,"column":8},"end":{"line":194,"column":85}},"105":{"start":{"line":197,"column":4},"end":{"line":201,"column":5}},"106":{"start":{"line":198,"column":24},"end":{"line":198,"column":119}},"107":{"start":{"line":200,"column":8},"end":{"line":200,"column":226}},"108":{"start":{"line":202,"column":4},"end":{"line":204,"column":7}},"109":{"start":{"line":205,"column":4},"end":{"line":205,"column":17}},"110":{"start":{"line":208,"column":4},"end":{"line":210,"column":7}},"111":{"start":{"line":211,"column":4},"end":{"line":211,"column":27}},"112":{"start":{"line":215,"column":4},"end":{"line":217,"column":5}},"113":{"start":{"line":216,"column":8},"end":{"line":216,"column":21}},"114":{"start":{"line":219,"column":4},"end":{"line":221,"column":5}},"115":{"start":{"line":220,"column":8},"end":{"line":220,"column":21}},"116":{"start":{"line":223,"column":4},"end":{"line":225,"column":5}},"117":{"start":{"line":224,"column":8},"end":{"line":224,"column":21}},"118":{"start":{"line":227,"column":4},"end":{"line":235,"column":5}},"119":{"start":{"line":228,"column":8},"end":{"line":230,"column":9}},"120":{"start":{"line":229,"column":12},"end":{"line":229,"column":25}},"121":{"start":{"line":232,"column":8},"end":{"line":234,"column":9}},"122":{"start":{"line":233,"column":12},"end":{"line":233,"column":25}},"123":{"start":{"line":236,"column":4},"end":{"line":236,"column":205}}},"fnMap":{"0":{"name":"_export","decl":{"start":{"line":5,"column":9},"end":{"line":5,"column":16}},"loc":{"start":{"line":5,"column":30},"end":{"line":10,"column":1}},"line":5},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":21},"end":{"line":12,"column":22}},"loc":{"start":{"line":12,"column":32},"end":{"line":14,"column":5}},"line":12},"2":{"name":"(anonymous_2)","decl":{"start":{"line":15,"column":18},"end":{"line":15,"column":19}},"loc":{"start":{"line":15,"column":29},"end":{"line":17,"column":5}},"line":15},"3":{"name":"(anonymous_3)","decl":{"start":{"line":18,"column":23},"end":{"line":18,"column":24}},"loc":{"start":{"line":18,"column":34},"end":{"line":20,"column":5}},"line":18},"4":{"name":"(anonymous_4)","decl":{"start":{"line":21,"column":23},"end":{"line":21,"column":24}},"loc":{"start":{"line":21,"column":34},"end":{"line":23,"column":5}},"line":21},"5":{"name":"_getRequireWildcardCache","decl":{"start":{"line":35,"column":9},"end":{"line":35,"column":33}},"loc":{"start":{"line":35,"column":47},"end":{"line":42,"column":1}},"line":35},"6":{"name":"(anonymous_6)","decl":{"start":{"line":39,"column":39},"end":{"line":39,"column":40}},"loc":{"start":{"line":39,"column":61},"end":{"line":41,"column":5}},"line":39},"7":{"name":"_interop_require_wildcard","decl":{"start":{"line":43,"column":9},"end":{"line":43,"column":34}},"loc":{"start":{"line":43,"column":53},"end":{"line":75,"column":1}},"line":43},"8":{"name":"(anonymous_8)","decl":{"start":{"line":78,"column":23},"end":{"line":78,"column":24}},"loc":{"start":{"line":78,"column":27},"end":{"line":85,"column":1}},"line":78},"9":{"name":"(anonymous_9)","decl":{"start":{"line":79,"column":43},"end":{"line":79,"column":44}},"loc":{"start":{"line":79,"column":47},"end":{"line":81,"column":5}},"line":79},"10":{"name":"(anonymous_10)","decl":{"start":{"line":82,"column":50},"end":{"line":82,"column":51}},"loc":{"start":{"line":82,"column":59},"end":{"line":84,"column":5}},"line":82},"11":{"name":"getEmailContent","decl":{"start":{"line":86,"column":15},"end":{"line":86,"column":30}},"loc":{"start":{"line":86,"column":56},"end":{"line":145,"column":1}},"line":86},"12":{"name":"(anonymous_12)","decl":{"start":{"line":108,"column":35},"end":{"line":108,"column":36}},"loc":{"start":{"line":108,"column":44},"end":{"line":111,"column":13}},"line":108},"13":{"name":"(anonymous_13)","decl":{"start":{"line":146,"column":21},"end":{"line":146,"column":22}},"loc":{"start":{"line":146,"column":52},"end":{"line":158,"column":1}},"line":146},"14":{"name":"generateNameEmail","decl":{"start":{"line":159,"column":9},"end":{"line":159,"column":26}},"loc":{"start":{"line":159,"column":40},"end":{"line":161,"column":1}},"line":159},"15":{"name":"getEmailData","decl":{"start":{"line":162,"column":15},"end":{"line":162,"column":27}},"loc":{"start":{"line":162,"column":111},"end":{"line":206,"column":1}},"line":162},"16":{"name":"sendEmailFromData","decl":{"start":{"line":207,"column":9},"end":{"line":207,"column":26}},"loc":{"start":{"line":207,"column":33},"end":{"line":212,"column":1}},"line":207},"17":{"name":"shouldNotifyEmail","decl":{"start":{"line":213,"column":9},"end":{"line":213,"column":26}},"loc":{"start":{"line":213,"column":189},"end":{"line":237,"column":1}},"line":213}},"branchMap":{"0":{"loc":{"start":{"line":36,"column":4},"end":{"line":36,"column":51}},"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":36,"column":51}},{"start":{"line":36,"column":4},"end":{"line":36,"column":51}}],"line":36},"1":{"loc":{"start":{"line":40,"column":15},"end":{"line":40,"column":65}},"type":"cond-expr","locations":[{"start":{"line":40,"column":29},"end":{"line":40,"column":45}},{"start":{"line":40,"column":48},"end":{"line":40,"column":65}}],"line":40},"2":{"loc":{"start":{"line":44,"column":4},"end":{"line":46,"column":5}},"type":"if","locations":[{"start":{"line":44,"column":4},"end":{"line":46,"column":5}},{"start":{"line":44,"column":4},"end":{"line":46,"column":5}}],"line":44},"3":{"loc":{"start":{"line":44,"column":8},"end":{"line":44,"column":45}},"type":"binary-expr","locations":[{"start":{"line":44,"column":8},"end":{"line":44,"column":20}},{"start":{"line":44,"column":24},"end":{"line":44,"column":27}},{"start":{"line":44,"column":31},"end":{"line":44,"column":45}}],"line":44},"4":{"loc":{"start":{"line":47,"column":4},"end":{"line":51,"column":5}},"type":"if","locations":[{"start":{"line":47,"column":4},"end":{"line":51,"column":5}},{"start":{"line":47,"column":4},"end":{"line":51,"column":5}}],"line":47},"5":{"loc":{"start":{"line":47,"column":8},"end":{"line":47,"column":76}},"type":"binary-expr","locations":[{"start":{"line":47,"column":8},"end":{"line":47,"column":20}},{"start":{"line":47,"column":24},"end":{"line":47,"column":47}},{"start":{"line":47,"column":51},"end":{"line":47,"column":76}}],"line":47},"6":{"loc":{"start":{"line":53,"column":4},"end":{"line":55,"column":5}},"type":"if","locations":[{"start":{"line":53,"column":4},"end":{"line":55,"column":5}},{"start":{"line":53,"column":4},"end":{"line":55,"column":5}}],"line":53},"7":{"loc":{"start":{"line":53,"column":8},"end":{"line":53,"column":31}},"type":"binary-expr","locations":[{"start":{"line":53,"column":8},"end":{"line":53,"column":13}},{"start":{"line":53,"column":17},"end":{"line":53,"column":31}}],"line":53},"8":{"loc":{"start":{"line":59,"column":32},"end":{"line":59,"column":88}},"type":"binary-expr","locations":[{"start":{"line":59,"column":32},"end":{"line":59,"column":53}},{"start":{"line":59,"column":57},"end":{"line":59,"column":88}}],"line":59},"9":{"loc":{"start":{"line":61,"column":8},"end":{"line":68,"column":9}},"type":"if","locations":[{"start":{"line":61,"column":8},"end":{"line":68,"column":9}},{"start":{"line":61,"column":8},"end":{"line":68,"column":9}}],"line":61},"10":{"loc":{"start":{"line":61,"column":12},"end":{"line":61,"column":79}},"type":"binary-expr","locations":[{"start":{"line":61,"column":12},"end":{"line":61,"column":29}},{"start":{"line":61,"column":33},"end":{"line":61,"column":79}}],"line":61},"11":{"loc":{"start":{"line":62,"column":23},"end":{"line":62,"column":95}},"type":"cond-expr","locations":[{"start":{"line":62,"column":47},"end":{"line":62,"column":88}},{"start":{"line":62,"column":91},"end":{"line":62,"column":95}}],"line":62},"12":{"loc":{"start":{"line":63,"column":12},"end":{"line":67,"column":13}},"type":"if","locations":[{"start":{"line":63,"column":12},"end":{"line":67,"column":13}},{"start":{"line":63,"column":12},"end":{"line":67,"column":13}}],"line":63},"13":{"loc":{"start":{"line":63,"column":16},"end":{"line":63,"column":46}},"type":"binary-expr","locations":[{"start":{"line":63,"column":16},"end":{"line":63,"column":20}},{"start":{"line":63,"column":25},"end":{"line":63,"column":33}},{"start":{"line":63,"column":37},"end":{"line":63,"column":45}}],"line":63},"14":{"loc":{"start":{"line":71,"column":4},"end":{"line":73,"column":5}},"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":73,"column":5}},{"start":{"line":71,"column":4},"end":{"line":73,"column":5}}],"line":71},"15":{"loc":{"start":{"line":87,"column":16},"end":{"line":87,"column":82}},"type":"binary-expr","locations":[{"start":{"line":87,"column":16},"end":{"line":87,"column":20}},{"start":{"line":87,"column":24},"end":{"line":87,"column":37}},{"start":{"line":87,"column":41},"end":{"line":87,"column":74}},{"start":{"line":87,"column":78},"end":{"line":87,"column":82}}],"line":87},"16":{"loc":{"start":{"line":89,"column":52},"end":{"line":89,"column":153}},"type":"cond-expr","locations":[{"start":{"line":89,"column":96},"end":{"line":89,"column":132}},{"start":{"line":89,"column":135},"end":{"line":89,"column":153}}],"line":89},"17":{"loc":{"start":{"line":89,"column":96},"end":{"line":89,"column":132}},"type":"binary-expr","locations":[{"start":{"line":89,"column":96},"end":{"line":89,"column":110}},{"start":{"line":89,"column":114},"end":{"line":89,"column":132}}],"line":89},"18":{"loc":{"start":{"line":91,"column":32},"end":{"line":91,"column":131}},"type":"cond-expr","locations":[{"start":{"line":91,"column":68},"end":{"line":91,"column":96}},{"start":{"line":91,"column":99},"end":{"line":91,"column":131}}],"line":91},"19":{"loc":{"start":{"line":96,"column":4},"end":{"line":100,"column":5}},"type":"if","locations":[{"start":{"line":96,"column":4},"end":{"line":100,"column":5}},{"start":{"line":96,"column":4},"end":{"line":100,"column":5}}],"line":96},"20":{"loc":{"start":{"line":96,"column":8},"end":{"line":96,"column":44}},"type":"binary-expr","locations":[{"start":{"line":96,"column":8},"end":{"line":96,"column":27}},{"start":{"line":96,"column":31},"end":{"line":96,"column":44}}],"line":96},"21":{"loc":{"start":{"line":97,"column":15},"end":{"line":99,"column":19}},"type":"cond-expr","locations":[{"start":{"line":97,"column":74},"end":{"line":99,"column":10}},{"start":{"line":99,"column":13},"end":{"line":99,"column":19}}],"line":97},"22":{"loc":{"start":{"line":101,"column":4},"end":{"line":114,"column":5}},"type":"if","locations":[{"start":{"line":101,"column":4},"end":{"line":114,"column":5}},{"start":{"line":101,"column":4},"end":{"line":114,"column":5}}],"line":101},"23":{"loc":{"start":{"line":102,"column":8},"end":{"line":104,"column":9}},"type":"if","locations":[{"start":{"line":102,"column":8},"end":{"line":104,"column":9}},{"start":{"line":102,"column":8},"end":{"line":104,"column":9}}],"line":102},"24":{"loc":{"start":{"line":107,"column":8},"end":{"line":112,"column":9}},"type":"if","locations":[{"start":{"line":107,"column":8},"end":{"line":112,"column":9}},{"start":{"line":107,"column":8},"end":{"line":112,"column":9}}],"line":107},"25":{"loc":{"start":{"line":107,"column":12},"end":{"line":107,"column":55}},"type":"binary-expr","locations":[{"start":{"line":107,"column":12},"end":{"line":107,"column":26}},{"start":{"line":107,"column":30},"end":{"line":107,"column":55}}],"line":107},"26":{"loc":{"start":{"line":115,"column":4},"end":{"line":129,"column":5}},"type":"if","locations":[{"start":{"line":115,"column":4},"end":{"line":129,"column":5}},{"start":{"line":115,"column":4},"end":{"line":129,"column":5}}],"line":115},"27":{"loc":{"start":{"line":116,"column":40},"end":{"line":116,"column":141}},"type":"cond-expr","locations":[{"start":{"line":116,"column":76},"end":{"line":116,"column":105}},{"start":{"line":116,"column":108},"end":{"line":116,"column":141}}],"line":116},"28":{"loc":{"start":{"line":121,"column":8},"end":{"line":123,"column":9}},"type":"if","locations":[{"start":{"line":121,"column":8},"end":{"line":123,"column":9}},{"start":{"line":121,"column":8},"end":{"line":123,"column":9}}],"line":121},"29":{"loc":{"start":{"line":125,"column":8},"end":{"line":127,"column":9}},"type":"if","locations":[{"start":{"line":125,"column":8},"end":{"line":127,"column":9}},{"start":{"line":125,"column":8},"end":{"line":127,"column":9}}],"line":125},"30":{"loc":{"start":{"line":125,"column":12},"end":{"line":125,"column":112}},"type":"binary-expr","locations":[{"start":{"line":125,"column":12},"end":{"line":125,"column":31}},{"start":{"line":125,"column":35},"end":{"line":125,"column":67}},{"start":{"line":125,"column":71},"end":{"line":125,"column":112}}],"line":125},"31":{"loc":{"start":{"line":130,"column":4},"end":{"line":132,"column":5}},"type":"if","locations":[{"start":{"line":130,"column":4},"end":{"line":132,"column":5}},{"start":{"line":130,"column":4},"end":{"line":132,"column":5}}],"line":130},"32":{"loc":{"start":{"line":133,"column":4},"end":{"line":143,"column":5}},"type":"if","locations":[{"start":{"line":133,"column":4},"end":{"line":143,"column":5}},{"start":{"line":133,"column":4},"end":{"line":143,"column":5}}],"line":133},"33":{"loc":{"start":{"line":133,"column":8},"end":{"line":133,"column":76}},"type":"binary-expr","locations":[{"start":{"line":133,"column":8},"end":{"line":133,"column":42}},{"start":{"line":133,"column":46},"end":{"line":133,"column":76}}],"line":133},"34":{"loc":{"start":{"line":136,"column":8},"end":{"line":138,"column":9}},"type":"if","locations":[{"start":{"line":136,"column":8},"end":{"line":138,"column":9}},{"start":{"line":136,"column":8},"end":{"line":138,"column":9}}],"line":136},"35":{"loc":{"start":{"line":139,"column":8},"end":{"line":141,"column":9}},"type":"if","locations":[{"start":{"line":139,"column":8},"end":{"line":141,"column":9}},{"start":{"line":139,"column":8},"end":{"line":141,"column":9}}],"line":139},"36":{"loc":{"start":{"line":164,"column":21},"end":{"line":164,"column":122}},"type":"cond-expr","locations":[{"start":{"line":164,"column":65},"end":{"line":164,"column":101}},{"start":{"line":164,"column":104},"end":{"line":164,"column":122}}],"line":164},"37":{"loc":{"start":{"line":164,"column":65},"end":{"line":164,"column":101}},"type":"binary-expr","locations":[{"start":{"line":164,"column":65},"end":{"line":164,"column":79}},{"start":{"line":164,"column":83},"end":{"line":164,"column":101}}],"line":164},"38":{"loc":{"start":{"line":166,"column":4},"end":{"line":170,"column":5}},"type":"if","locations":[{"start":{"line":166,"column":4},"end":{"line":170,"column":5}},{"start":{"line":166,"column":4},"end":{"line":170,"column":5}}],"line":166},"39":{"loc":{"start":{"line":168,"column":11},"end":{"line":170,"column":5}},"type":"if","locations":[{"start":{"line":168,"column":11},"end":{"line":170,"column":5}},{"start":{"line":168,"column":11},"end":{"line":170,"column":5}}],"line":168},"40":{"loc":{"start":{"line":181,"column":25},"end":{"line":181,"column":123}},"type":"cond-expr","locations":[{"start":{"line":181,"column":69},"end":{"line":181,"column":103}},{"start":{"line":181,"column":106},"end":{"line":181,"column":123}}],"line":181},"41":{"loc":{"start":{"line":181,"column":69},"end":{"line":181,"column":103}},"type":"binary-expr","locations":[{"start":{"line":181,"column":69},"end":{"line":181,"column":82}},{"start":{"line":181,"column":86},"end":{"line":181,"column":103}}],"line":181},"42":{"loc":{"start":{"line":186,"column":39},"end":{"line":186,"column":97}},"type":"cond-expr","locations":[{"start":{"line":186,"column":86},"end":{"line":186,"column":92}},{"start":{"line":186,"column":95},"end":{"line":186,"column":97}}],"line":186},"43":{"loc":{"start":{"line":192,"column":4},"end":{"line":195,"column":5}},"type":"if","locations":[{"start":{"line":192,"column":4},"end":{"line":195,"column":5}},{"start":{"line":192,"column":4},"end":{"line":195,"column":5}}],"line":192},"44":{"loc":{"start":{"line":192,"column":8},"end":{"line":192,"column":167}},"type":"binary-expr","locations":[{"start":{"line":192,"column":8},"end":{"line":192,"column":117}},{"start":{"line":192,"column":121},"end":{"line":192,"column":167}}],"line":192},"45":{"loc":{"start":{"line":192,"column":9},"end":{"line":192,"column":112}},"type":"cond-expr","locations":[{"start":{"line":192,"column":82},"end":{"line":192,"column":88}},{"start":{"line":192,"column":91},"end":{"line":192,"column":112}}],"line":192},"46":{"loc":{"start":{"line":192,"column":9},"end":{"line":192,"column":79}},"type":"binary-expr","locations":[{"start":{"line":192,"column":9},"end":{"line":192,"column":50}},{"start":{"line":192,"column":54},"end":{"line":192,"column":79}}],"line":192},"47":{"loc":{"start":{"line":197,"column":4},"end":{"line":201,"column":5}},"type":"if","locations":[{"start":{"line":197,"column":4},"end":{"line":201,"column":5}},{"start":{"line":197,"column":4},"end":{"line":201,"column":5}}],"line":197},"48":{"loc":{"start":{"line":198,"column":24},"end":{"line":198,"column":119}},"type":"binary-expr","locations":[{"start":{"line":198,"column":24},"end":{"line":198,"column":69}},{"start":{"line":198,"column":73},"end":{"line":198,"column":119}}],"line":198},"49":{"loc":{"start":{"line":200,"column":171},"end":{"line":200,"column":198}},"type":"binary-expr","locations":[{"start":{"line":200,"column":171},"end":{"line":200,"column":183}},{"start":{"line":200,"column":187},"end":{"line":200,"column":198}}],"line":200},"50":{"loc":{"start":{"line":215,"column":4},"end":{"line":217,"column":5}},"type":"if","locations":[{"start":{"line":215,"column":4},"end":{"line":217,"column":5}},{"start":{"line":215,"column":4},"end":{"line":217,"column":5}}],"line":215},"51":{"loc":{"start":{"line":219,"column":4},"end":{"line":221,"column":5}},"type":"if","locations":[{"start":{"line":219,"column":4},"end":{"line":221,"column":5}},{"start":{"line":219,"column":4},"end":{"line":221,"column":5}}],"line":219},"52":{"loc":{"start":{"line":223,"column":4},"end":{"line":225,"column":5}},"type":"if","locations":[{"start":{"line":223,"column":4},"end":{"line":225,"column":5}},{"start":{"line":223,"column":4},"end":{"line":225,"column":5}}],"line":223},"53":{"loc":{"start":{"line":227,"column":4},"end":{"line":235,"column":5}},"type":"if","locations":[{"start":{"line":227,"column":4},"end":{"line":235,"column":5}},{"start":{"line":227,"column":4},"end":{"line":235,"column":5}}],"line":227},"54":{"loc":{"start":{"line":228,"column":8},"end":{"line":230,"column":9}},"type":"if","locations":[{"start":{"line":228,"column":8},"end":{"line":230,"column":9}},{"start":{"line":228,"column":8},"end":{"line":230,"column":9}}],"line":228},"55":{"loc":{"start":{"line":228,"column":12},"end":{"line":228,"column":102}},"type":"binary-expr","locations":[{"start":{"line":228,"column":12},"end":{"line":228,"column":42}},{"start":{"line":228,"column":46},"end":{"line":228,"column":60}},{"start":{"line":228,"column":64},"end":{"line":228,"column":81}},{"start":{"line":228,"column":85},"end":{"line":228,"column":102}}],"line":228},"56":{"loc":{"start":{"line":232,"column":8},"end":{"line":234,"column":9}},"type":"if","locations":[{"start":{"line":232,"column":8},"end":{"line":234,"column":9}},{"start":{"line":232,"column":8},"end":{"line":234,"column":9}}],"line":232},"57":{"loc":{"start":{"line":236,"column":11},"end":{"line":236,"column":204}},"type":"binary-expr","locations":[{"start":{"line":236,"column":12},"end":{"line":236,"column":28}},{"start":{"line":236,"column":32},"end":{"line":236,"column":45}},{"start":{"line":236,"column":49},"end":{"line":236,"column":77}},{"start":{"line":236,"column":81},"end":{"line":236,"column":97}},{"start":{"line":236,"column":101},"end":{"line":236,"column":132}},{"start":{"line":236,"column":136},"end":{"line":236,"column":151}},{"start":{"line":236,"column":157},"end":{"line":236,"column":170}},{"start":{"line":236,"column":174},"end":{"line":236,"column":183}},{"start":{"line":236,"column":187},"end":{"line":236,"column":203}}],"line":236}},"s":{"0":2,"1":2,"2":8,"3":2,"4":2,"5":0,"6":0,"7":0,"8":2,"9":2,"10":2,"11":2,"12":2,"13":2,"14":2,"15":2,"16":2,"17":2,"18":2,"19":0,"20":2,"21":2,"22":2,"23":2,"24":2,"25":0,"26":2,"27":0,"28":2,"29":2,"30":0,"31":2,"32":2,"33":2,"34":6,"35":6,"36":6,"37":0,"38":6,"39":2,"40":2,"41":2,"42":2,"43":2,"44":2,"45":2,"46":0,"47":0,"48":0,"49":0,"50":2,"51":2,"52":2,"53":2,"54":2,"55":2,"56":2,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":2,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0},"f":{"0":2,"1":2,"2":0,"3":0,"4":0,"5":2,"6":2,"7":2,"8":0,"9":0,"10":0,"11":2,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},"b":{"0":[0,2],"1":[0,2],"2":[0,2],"3":[2,2,2],"4":[0,2],"5":[2,2,0],"6":[0,2],"7":[2,2],"8":[2,2],"9":[6,0],"10":[6,6],"11":[6,0],"12":[0,6],"13":[6,6,6],"14":[2,0],"15":[2,0,2,1],"16":[1,1],"17":[1,0],"18":[0,2],"19":[2,0],"20":[2,2],"21":[1,1],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0,0,0],"56":[0,0],"57":[0,0,0,0,0,0,0,0,0]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/notifications/email.js"],"sourcesContent":["import { escapeHTML } from '@rocket.chat/string-helpers';\nimport { Meteor } from 'meteor/meteor';\n\nimport { callbacks } from '../../../../../lib/callbacks';\nimport { ltrim } from '../../../../../lib/utils/stringUtils';\nimport { i18n } from '../../../../../server/lib/i18n';\nimport { roomCoordinator } from '../../../../../server/lib/rooms/roomCoordinator';\nimport * as Mailer from '../../../../mailer/server/api';\nimport { metrics } from '../../../../metrics/server';\nimport { settings } from '../../../../settings/server';\nimport { getURL } from '../../../../utils/server/getURL';\n\nlet advice = '';\nlet goToMessage = '';\nMeteor.startup(() => {\n\tsettings.watch('email_style', () => {\n\t\tgoToMessage = Mailer.inlinecss('<p><a class=\\'btn\\' href=\"[room_path]\">{Offline_Link_Message}</a></p>');\n\t});\n\tMailer.getTemplate('Email_Footer_Direct_Reply', (value) => {\n\t\tadvice = value;\n\t});\n});\n\nexport async function getEmailContent({ message, user, room }) {\n\tconst lng = (user && user.language) || settings.get('Language') || 'en';\n\n\tconst roomName = escapeHTML(`#${await roomCoordinator.getRoomName(room.t, room)}`);\n\tconst userName = escapeHTML(settings.get('UI_Use_Real_Name') ? message.u.name || message.u.username : message.u.username);\n\n\tconst roomDirectives = roomCoordinator.getRoomDirectives(room.t);\n\n\tconst header = i18n.t(!roomDirectives.isGroupChat(room) ? 'User_sent_a_message_to_you' : 'User_sent_a_message_on_channel', {\n\t\tusername: userName,\n\t\tchannel: roomName,\n\t\tlng,\n\t});\n\n\tif (message.t === 'e2e' && !message.file) {\n\t\treturn settings.get('Email_notification_show_message') ? i18n.t('Encrypted_message_preview_unavailable', { lng }) : header;\n\t}\n\n\tif (message.msg !== '') {\n\t\tif (!settings.get('Email_notification_show_message')) {\n\t\t\treturn header;\n\t\t}\n\n\t\tlet messageContent = escapeHTML(message.msg);\n\n\t\tmessage = await callbacks.run('renderMessage', message);\n\t\tif (message.tokens && message.tokens.length > 0) {\n\t\t\tmessage.tokens.forEach((token) => {\n\t\t\t\ttoken.text = token.text.replace(/([^\\$])(\\$[^\\$])/gm, '$1$$$2');\n\t\t\t\tmessageContent = messageContent.replace(token.token, token.text);\n\t\t\t});\n\t\t}\n\t\treturn `${header}:<br/><br/>${messageContent.replace(/\\n/gm, '<br/>')}`;\n\t}\n\n\tif (message.file) {\n\t\tconst fileHeader = i18n.t(!roomDirectives.isGroupChat(room) ? 'User_uploaded_a_file_to_you' : 'User_uploaded_a_file_on_channel', {\n\t\t\tusername: userName,\n\t\t\tchannel: roomName,\n\t\t\tlng,\n\t\t});\n\n\t\tif (!settings.get('Email_notification_show_message')) {\n\t\t\treturn fileHeader;\n\t\t}\n\n\t\tlet content = `${escapeHTML(message.file.name)}`;\n\n\t\tif (message.attachments && message.attachments.length === 1 && message.attachments[0].description !== '') {\n\t\t\tcontent += `<br/><br/>${escapeHTML(message.attachments[0].description)}`;\n\t\t}\n\n\t\treturn `${fileHeader}:<br/><br/>${content}`;\n\t}\n\n\tif (!settings.get('Email_notification_show_message')) {\n\t\treturn header;\n\t}\n\n\tif (Array.isArray(message.attachments) && message.attachments.length > 0) {\n\t\tconst [attachment] = message.attachments;\n\n\t\tlet content = '';\n\n\t\tif (attachment.title) {\n\t\t\tcontent += `${escapeHTML(attachment.title)}<br/>`;\n\t\t}\n\t\tif (attachment.text) {\n\t\t\tcontent += `${escapeHTML(attachment.text)}<br/>`;\n\t\t}\n\n\t\treturn `${header}:<br/><br/>${content}`;\n\t}\n\n\treturn header;\n}\n\nconst getButtonUrl = (room, subscription, message) => {\n\tconst basePath = roomCoordinator.getRouteLink(room.t, subscription).replace(Meteor.absoluteUrl(), '');\n\n\tconst path = `${ltrim(basePath, '/')}?msg=${message._id}`;\n\treturn getURL(\n\t\tpath,\n\t\t{\n\t\t\tfull: true,\n\t\t\tcloud: settings.get('Offline_Message_Use_DeepLink'),\n\t\t\tcloud_route: 'room',\n\t\t\tcloud_params: {\n\t\t\t\trid: room._id,\n\t\t\t\tmid: message._id,\n\t\t\t},\n\t\t},\n\t\tsettings.get('DeepLink_Url'),\n\t);\n};\n\nfunction generateNameEmail(name, email) {\n\treturn `${String(name).replace(/@/g, '%40').replace(/[<>,]/g, '')} <${email}>`;\n}\n\nexport async function getEmailData({ message, receiver, sender, subscription, room, emailAddress, hasMentionToUser }) {\n\tconst username = settings.get('UI_Use_Real_Name') ? message.u.name || message.u.username : message.u.username;\n\tlet subjectKey = 'Offline_Mention_All_Email';\n\n\tif (!roomCoordinator.getRoomDirectives(room.t).isGroupChat(room)) {\n\t\tsubjectKey = 'Offline_DM_Email';\n\t} else if (hasMentionToUser) {\n\t\tsubjectKey = 'Offline_Mention_Email';\n\t}\n\n\tconst emailSubject = Mailer.replace(settings.get(subjectKey), {\n\t\tuser: username,\n\t\troom: await roomCoordinator.getRoomName(room.t, room),\n\t});\n\tconst content = await getEmailContent({\n\t\tmessage,\n\t\tuser: receiver,\n\t\troom,\n\t});\n\n\tconst room_path = getButtonUrl(room, subscription, message);\n\n\tconst receiverName = settings.get('UI_Use_Real_Name') ? receiver.name || receiver.username : receiver.username;\n\n\tconst email = {\n\t\tfrom: generateNameEmail(username, settings.get('From_Email')),\n\t\tto: generateNameEmail(receiverName, emailAddress),\n\t\tsubject: emailSubject,\n\t\thtml: content + goToMessage + (settings.get('Direct_Reply_Enable') ? advice : ''),\n\t\tdata: {\n\t\t\troom_path,\n\t\t},\n\t\theaders: {},\n\t};\n\n\tif (sender.emails?.length > 0 && settings.get('Add_Sender_To_ReplyTo')) {\n\t\tconst [senderEmail] = sender.emails;\n\t\temail.headers['Reply-To'] = generateNameEmail(username, senderEmail.address);\n\t}\n\n\t// If direct reply enabled, email content with headers\n\tif (settings.get('Direct_Reply_Enable')) {\n\t\tconst replyto = settings.get('Direct_Reply_ReplyTo') || settings.get('Direct_Reply_Username');\n\n\t\t// Reply-To header with format \"username+messageId@domain\"\n\t\temail.headers['Reply-To'] = `${replyto.split('@')[0].split(settings.get('Direct_Reply_Separator'))[0]}${settings.get(\n\t\t\t'Direct_Reply_Separator',\n\t\t)}${message.tmid || message._id}@${replyto.split('@')[1]}`;\n\t}\n\n\tmetrics.notificationsSent.inc({ notification_type: 'email' });\n\treturn email;\n}\n\nexport function sendEmailFromData(data) {\n\tmetrics.notificationsSent.inc({ notification_type: 'email' });\n\treturn Mailer.send(data);\n}\n\nexport function shouldNotifyEmail({\n\tdisableAllMessageNotifications,\n\tstatusConnection,\n\temailNotifications,\n\tisHighlighted,\n\thasMentionToUser,\n\thasMentionToAll,\n\thasReplyToThread,\n\troomType,\n\tisThread,\n}) {\n\t// email notifications are disabled globally\n\tif (!settings.get('Accounts_AllowEmailNotifications')) {\n\t\treturn false;\n\t}\n\n\t// user/room preference to nothing\n\tif (emailNotifications === 'nothing') {\n\t\treturn false;\n\t}\n\n\t// user connected (don't need to send him an email)\n\tif (statusConnection === 'online') {\n\t\treturn false;\n\t}\n\n\t// no user or room preference\n\tif (emailNotifications == null) {\n\t\tif (disableAllMessageNotifications && !isHighlighted && !hasMentionToUser && !hasReplyToThread) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// default server preference is disabled\n\t\tif (settings.get('Accounts_Default_User_Preferences_emailNotificationMode') === 'nothing') {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn (\n\t\t(roomType === 'd' ||\n\t\t\tisHighlighted ||\n\t\t\temailNotifications === 'all' ||\n\t\t\thasMentionToUser ||\n\t\t\t(!disableAllMessageNotifications && hasMentionToAll)) &&\n\t\t(isHighlighted || !isThread || hasReplyToThread)\n\t);\n}\n"],"names":["getEmailContent","getEmailData","sendEmailFromData","shouldNotifyEmail","advice","goToMessage","Meteor","startup","settings","watch","Mailer","inlinecss","getTemplate","value","message","user","room","lng","language","get","roomName","escapeHTML","roomCoordinator","getRoomName","t","userName","u","name","username","roomDirectives","getRoomDirectives","header","i18n","isGroupChat","channel","file","msg","messageContent","callbacks","run","tokens","length","forEach","token","text","replace","fileHeader","content","attachments","description","Array","isArray","attachment","title","getButtonUrl","subscription","basePath","getRouteLink","absoluteUrl","path","ltrim","_id","getURL","full","cloud","cloud_route","cloud_params","rid","mid","generateNameEmail","email","String","receiver","sender","emailAddress","hasMentionToUser","subjectKey","emailSubject","room_path","receiverName","from","to","subject","html","data","headers","emails","senderEmail","address","replyto","split","tmid","metrics","notificationsSent","inc","notification_type","send","disableAllMessageNotifications","statusConnection","emailNotifications","isHighlighted","hasMentionToAll","hasReplyToThread","roomType","isThread"],"mappings":"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","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/notifications/email.js"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"6ba6cfccd7d5b43016fee3f9b9e58243295bc4a1","contentHash":"375d6c1734a49aebbe512326844bac2b8a9ab8d0f416724e496623faf42a24fd"},"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/disableCustomScripts.ts":{"path":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/disableCustomScripts.ts","statementMap":{"0":{"start":{"line":2,"column":0},"end":{"line":4,"column":3}},"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":3}},"2":{"start":{"line":8,"column":8},"end":{"line":8,"column":36}},"3":{"start":{"line":11,"column":17},"end":{"line":11,"column":48}},"4":{"start":{"line":12,"column":29},"end":{"line":20,"column":1}},"5":{"start":{"line":13,"column":20},"end":{"line":13,"column":49}},"6":{"start":{"line":14,"column":4},"end":{"line":16,"column":5}},"7":{"start":{"line":15,"column":8},"end":{"line":15,"column":21}},"8":{"start":{"line":17,"column":35},"end":{"line":17,"column":80}},"9":{"start":{"line":18,"column":27},"end":{"line":18,"column":102}},"10":{"start":{"line":19,"column":4},"end":{"line":19,"column":52}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":10}},"loc":{"start":{"line":7,"column":20},"end":{"line":9,"column":5}},"line":7},"1":{"name":"(anonymous_1)","decl":{"start":{"line":12,"column":29},"end":{"line":12,"column":30}},"loc":{"start":{"line":12,"column":33},"end":{"line":20,"column":1}},"line":12}},"branchMap":{"0":{"loc":{"start":{"line":14,"column":4},"end":{"line":16,"column":5}},"type":"if","locations":[{"start":{"line":14,"column":4},"end":{"line":16,"column":5}},{"start":{"line":14,"column":4},"end":{"line":16,"column":5}}],"line":14},"1":{"loc":{"start":{"line":18,"column":27},"end":{"line":18,"column":102}},"type":"cond-expr","locations":[{"start":{"line":18,"column":68},"end":{"line":18,"column":74}},{"start":{"line":18,"column":77},"end":{"line":18,"column":102}}],"line":18},"2":{"loc":{"start":{"line":18,"column":27},"end":{"line":18,"column":65}},"type":"binary-expr","locations":[{"start":{"line":18,"column":27},"end":{"line":18,"column":43}},{"start":{"line":18,"column":47},"end":{"line":18,"column":65}}],"line":18},"3":{"loc":{"start":{"line":19,"column":11},"end":{"line":19,"column":51}},"type":"binary-expr","locations":[{"start":{"line":19,"column":11},"end":{"line":19,"column":33}},{"start":{"line":19,"column":37},"end":{"line":19,"column":51}}],"line":19}},"s":{"0":4,"1":4,"2":4,"3":4,"4":4,"5":4,"6":4,"7":1,"8":3,"9":3,"10":3},"f":{"0":4,"1":4},"b":{"0":[1,3],"1":[0,3],"2":[3,3],"3":[3,2]},"inputSourceMap":{"version":3,"sources":["/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/disableCustomScripts.ts"],"sourcesContent":["import { License } from '@rocket.chat/license';\n\nexport const disableCustomScripts = () => {\n\tconst license = License.getLicense();\n\n\tif (!license) {\n\t\treturn false;\n\t}\n\n\tconst isCustomScriptDisabled = process.env.DISABLE_CUSTOM_SCRIPTS === 'true';\n\tconst isTrialLicense = license?.information.trial;\n\n\treturn isCustomScriptDisabled && isTrialLicense;\n};\n"],"names":["disableCustomScripts","license","License","getLicense","isCustomScriptDisabled","process","env","DISABLE_CUSTOM_SCRIPTS","isTrialLicense","information","trial"],"mappings":";;;;+BAEaA;;;eAAAA;;;yBAFW;AAEjB,MAAMA,uBAAuB;IACnC,MAAMC,UAAUC,gBAAO,CAACC,UAAU;IAElC,IAAI,CAACF,SAAS;QACb,OAAO;IACR;IAEA,MAAMG,yBAAyBC,QAAQC,GAAG,CAACC,sBAAsB,KAAK;IACtE,MAAMC,iBAAiBP,oBAAAA,8BAAAA,QAASQ,WAAW,CAACC,KAAK;IAEjD,OAAON,0BAA0BI;AAClC","file":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/disableCustomScripts.ts"},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"f10c60cb6873cbf9e3c35b601d741e5b1c0eeb6e","contentHash":"5048702583d2065968cd8dffc341bc88144f90185567bea72d712ef3255ea3d1"}}