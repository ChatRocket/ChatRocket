{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/KonchatNotification.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui/client/lib/KonchatNotification.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/KonchatNotification.ts","inputSourceMap":{"version":3,"file":"app/ui/client/lib/KonchatNotification.ts","sourceRoot":"","sources":["app/ui/client/lib/KonchatNotification.ts"],"names":[],"mappings":"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","sourcesContent":["import type { INotificationDesktop, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { Random } from '@rocket.chat/random';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\n\nimport { RoomManager } from '../../../../client/lib/RoomManager';\nimport { onClientMessageReceived } from '../../../../client/lib/onClientMessageReceived';\nimport { getAvatarAsPng } from '../../../../client/lib/utils/getAvatarAsPng';\nimport { router } from '../../../../client/providers/RouterProvider';\nimport { stripTags } from '../../../../lib/utils/stringUtils';\nimport { CustomSounds } from '../../../custom-sounds/client/lib/CustomSounds';\nimport { e2e } from '../../../e2e/client';\nimport { ChatSubscription } from '../../../models/client';\nimport { getUserPreference } from '../../../utils/client';\nimport { getUserAvatarURL } from '../../../utils/client/getUserAvatarURL';\nimport { sdk } from '../../../utils/client/lib/SDKClient';\n\ndeclare global {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface NotificationEventMap {\n\t\treply: { response: string };\n\t}\n}\n\nclass KonchatNotification {\n\tpublic notificationStatus = new ReactiveVar<NotificationPermission | undefined>(undefined);\n\n\tpublic getDesktopPermission() {\n\t\tif (window.Notification && Notification.permission !== 'granted') {\n\t\t\treturn Notification.requestPermission((status) => {\n\t\t\t\tthis.notificationStatus.set(status);\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic async notify(notification: INotificationDesktop) {\n\t\tif (typeof window.Notification === 'undefined' || Notification.permission !== 'granted') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!notification.payload) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { rid } = notification.payload;\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\t\tconst message = await onClientMessageReceived({\n\t\t\trid,\n\t\t\tmsg: notification.text,\n\t\t\tnotification: true,\n\t\t} as any);\n\n\t\tconst requireInteraction = getUserPreference<boolean>(Meteor.userId(), 'desktopNotificationRequireInteraction');\n\t\tconst n = new Notification(notification.title, {\n\t\t\ticon: notification.icon || getUserAvatarURL(notification.payload.sender?.username as string),\n\t\t\tbody: stripTags(message.msg),\n\t\t\ttag: notification.payload._id,\n\t\t\tcanReply: true,\n\t\t\tsilent: true,\n\t\t\trequireInteraction,\n\t\t} as NotificationOptions & {\n\t\t\tcanReply?: boolean; // TODO is this still needed for the desktop app?\n\t\t});\n\n\t\tconst notificationDuration = !requireInteraction ? (notification.duration ?? 0) - 0 || 10 : -1;\n\t\tif (notificationDuration > 0) {\n\t\t\tsetTimeout(() => n.close(), notificationDuration * 1000);\n\t\t}\n\n\t\tif (n.addEventListener) {\n\t\t\tn.addEventListener(\n\t\t\t\t'reply',\n\t\t\t\t({ response }) =>\n\t\t\t\t\tvoid sdk.call('sendMessage', {\n\t\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\t\trid,\n\t\t\t\t\t\tmsg: response,\n\t\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tn.onclick = function () {\n\t\t\tthis.close();\n\t\t\twindow.focus();\n\n\t\t\tif (!notification.payload._id || !notification.payload.rid || !notification.payload.name) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (notification.payload?.type) {\n\t\t\t\tcase 'd':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/direct/:rid/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\trid: notification.payload.rid,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'c':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/channel/:name/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tname: notification.payload.name,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'p':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/group/:name/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tname: notification.payload.name,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'l':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/live/:id/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tid: notification.payload.rid,\n\t\t\t\t\t\t\ttab: 'room-info',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic async showDesktop(notification: INotificationDesktop) {\n\t\tif (!notification.payload.rid) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tnotification.payload?.rid === RoomManager.opened &&\n\t\t\t(typeof window.document.hasFocus === 'function' ? window.document.hasFocus() : undefined)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ((Meteor.user() as IUser | null)?.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (notification.payload?.message?.t === 'e2e') {\n\t\t\tconst e2eRoom = await e2e.getInstanceByRoomId(notification.payload.rid);\n\t\t\tif (e2eRoom) {\n\t\t\t\tnotification.text = (await e2eRoom.decrypt(notification.payload.message.msg)).text;\n\t\t\t}\n\t\t}\n\n\t\treturn getAvatarAsPng(notification.payload?.sender?.username, (avatarAsPng) => {\n\t\t\tnotification.icon = avatarAsPng;\n\t\t\treturn this.notify(notification);\n\t\t});\n\t}\n\n\tpublic async newMessage(rid: IRoom['_id'] | undefined) {\n\t\tif ((Meteor.user() as IUser | null)?.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst userId = Meteor.userId();\n\t\tconst newMessageNotification = getUserPreference<string>(userId, 'newMessageNotification');\n\t\tconst audioVolume = getUserPreference(userId, 'notificationsSoundVolume', 100);\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sub = ChatSubscription.findOne({ rid }, { fields: { audioNotificationValue: 1 } });\n\n\t\tif (!sub || sub.audioNotificationValue === 'none') {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tif (sub.audioNotificationValue && sub.audioNotificationValue !== '0') {\n\t\t\t\tvoid CustomSounds.play(sub.audioNotificationValue, {\n\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (newMessageNotification && newMessageNotification !== 'none') {\n\t\t\t\tvoid CustomSounds.play(newMessageNotification, {\n\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// do nothing\n\t\t}\n\t}\n\n\tpublic newRoom(rid: IRoom['_id']) {\n\t\tTracker.nonreactive(() => {\n\t\t\tlet newRoomSound = Session.get('newRoomSound') as IRoom['_id'][] | undefined;\n\t\t\tif (newRoomSound) {\n\t\t\t\tnewRoomSound = [...newRoomSound, rid];\n\t\t\t} else {\n\t\t\t\tnewRoomSound = [rid];\n\t\t\t}\n\n\t\t\treturn Session.set('newRoomSound', newRoomSound);\n\t\t});\n\t}\n\n\tpublic removeRoomNotification(rid: IRoom['_id']) {\n\t\tlet newRoomSound = (Session.get('newRoomSound') as IRoom['_id'][] | undefined) ?? [];\n\t\tnewRoomSound = newRoomSound.filter((_rid) => _rid !== rid);\n\t\tTracker.nonreactive(() => Session.set('newRoomSound', newRoomSound));\n\n\t\tconst link = document.querySelector(`.link-room-${rid}`);\n\n\t\tlink?.classList.remove('new-room-highlight');\n\t}\n}\n\nconst instance = new KonchatNotification();\n\nexport { instance as KonchatNotification };\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/KonchatNotification.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui/client/lib/KonchatNotification.ts","inputSourceMap":{"version":3,"file":"app/ui/client/lib/KonchatNotification.ts","sourceRoot":"","sources":["app/ui/client/lib/KonchatNotification.ts"],"names":[],"mappings":"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","sourcesContent":["import type { INotificationDesktop, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { Random } from '@rocket.chat/random';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\n\nimport { RoomManager } from '../../../../client/lib/RoomManager';\nimport { onClientMessageReceived } from '../../../../client/lib/onClientMessageReceived';\nimport { getAvatarAsPng } from '../../../../client/lib/utils/getAvatarAsPng';\nimport { router } from '../../../../client/providers/RouterProvider';\nimport { stripTags } from '../../../../lib/utils/stringUtils';\nimport { CustomSounds } from '../../../custom-sounds/client/lib/CustomSounds';\nimport { e2e } from '../../../e2e/client';\nimport { ChatSubscription } from '../../../models/client';\nimport { getUserPreference } from '../../../utils/client';\nimport { getUserAvatarURL } from '../../../utils/client/getUserAvatarURL';\nimport { sdk } from '../../../utils/client/lib/SDKClient';\n\ndeclare global {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface NotificationEventMap {\n\t\treply: { response: string };\n\t}\n}\n\nclass KonchatNotification {\n\tpublic notificationStatus = new ReactiveVar<NotificationPermission | undefined>(undefined);\n\n\tpublic getDesktopPermission() {\n\t\tif (window.Notification && Notification.permission !== 'granted') {\n\t\t\treturn Notification.requestPermission((status) => {\n\t\t\t\tthis.notificationStatus.set(status);\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic async notify(notification: INotificationDesktop) {\n\t\tif (typeof window.Notification === 'undefined' || Notification.permission !== 'granted') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!notification.payload) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { rid } = notification.payload;\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\t\tconst message = await onClientMessageReceived({\n\t\t\trid,\n\t\t\tmsg: notification.text,\n\t\t\tnotification: true,\n\t\t} as any);\n\n\t\tconst requireInteraction = getUserPreference<boolean>(Meteor.userId(), 'desktopNotificationRequireInteraction');\n\t\tconst n = new Notification(notification.title, {\n\t\t\ticon: notification.icon || getUserAvatarURL(notification.payload.sender?.username as string),\n\t\t\tbody: stripTags(message.msg),\n\t\t\ttag: notification.payload._id,\n\t\t\tcanReply: true,\n\t\t\tsilent: true,\n\t\t\trequireInteraction,\n\t\t} as NotificationOptions & {\n\t\t\tcanReply?: boolean; // TODO is this still needed for the desktop app?\n\t\t});\n\n\t\tconst notificationDuration = !requireInteraction ? (notification.duration ?? 0) - 0 || 10 : -1;\n\t\tif (notificationDuration > 0) {\n\t\t\tsetTimeout(() => n.close(), notificationDuration * 1000);\n\t\t}\n\n\t\tif (n.addEventListener) {\n\t\t\tn.addEventListener(\n\t\t\t\t'reply',\n\t\t\t\t({ response }) =>\n\t\t\t\t\tvoid sdk.call('sendMessage', {\n\t\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\t\trid,\n\t\t\t\t\t\tmsg: response,\n\t\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tn.onclick = function () {\n\t\t\tthis.close();\n\t\t\twindow.focus();\n\n\t\t\tif (!notification.payload._id || !notification.payload.rid || !notification.payload.name) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (notification.payload?.type) {\n\t\t\t\tcase 'd':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/direct/:rid/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\trid: notification.payload.rid,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'c':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/channel/:name/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tname: notification.payload.name,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'p':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/group/:name/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tname: notification.payload.name,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'l':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/live/:id/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tid: notification.payload.rid,\n\t\t\t\t\t\t\ttab: 'room-info',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic async showDesktop(notification: INotificationDesktop) {\n\t\tif (!notification.payload.rid) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tnotification.payload?.rid === RoomManager.opened &&\n\t\t\t(typeof window.document.hasFocus === 'function' ? window.document.hasFocus() : undefined)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ((Meteor.user() as IUser | null)?.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (notification.payload?.message?.t === 'e2e') {\n\t\t\tconst e2eRoom = await e2e.getInstanceByRoomId(notification.payload.rid);\n\t\t\tif (e2eRoom) {\n\t\t\t\tnotification.text = (await e2eRoom.decrypt(notification.payload.message.msg)).text;\n\t\t\t}\n\t\t}\n\n\t\treturn getAvatarAsPng(notification.payload?.sender?.username, (avatarAsPng) => {\n\t\t\tnotification.icon = avatarAsPng;\n\t\t\treturn this.notify(notification);\n\t\t});\n\t}\n\n\tpublic async newMessage(rid: IRoom['_id'] | undefined) {\n\t\tif ((Meteor.user() as IUser | null)?.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst userId = Meteor.userId();\n\t\tconst newMessageNotification = getUserPreference<string>(userId, 'newMessageNotification');\n\t\tconst audioVolume = getUserPreference(userId, 'notificationsSoundVolume', 100);\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sub = ChatSubscription.findOne({ rid }, { fields: { audioNotificationValue: 1 } });\n\n\t\tif (!sub || sub.audioNotificationValue === 'none') {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tif (sub.audioNotificationValue && sub.audioNotificationValue !== '0') {\n\t\t\t\tvoid CustomSounds.play(sub.audioNotificationValue, {\n\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (newMessageNotification && newMessageNotification !== 'none') {\n\t\t\t\tvoid CustomSounds.play(newMessageNotification, {\n\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// do nothing\n\t\t}\n\t}\n\n\tpublic newRoom(rid: IRoom['_id']) {\n\t\tTracker.nonreactive(() => {\n\t\t\tlet newRoomSound = Session.get('newRoomSound') as IRoom['_id'][] | undefined;\n\t\t\tif (newRoomSound) {\n\t\t\t\tnewRoomSound = [...newRoomSound, rid];\n\t\t\t} else {\n\t\t\t\tnewRoomSound = [rid];\n\t\t\t}\n\n\t\t\treturn Session.set('newRoomSound', newRoomSound);\n\t\t});\n\t}\n\n\tpublic removeRoomNotification(rid: IRoom['_id']) {\n\t\tlet newRoomSound = (Session.get('newRoomSound') as IRoom['_id'][] | undefined) ?? [];\n\t\tnewRoomSound = newRoomSound.filter((_rid) => _rid !== rid);\n\t\tTracker.nonreactive(() => Session.set('newRoomSound', newRoomSound));\n\n\t\tconst link = document.querySelector(`.link-room-${rid}`);\n\n\t\tlink?.classList.remove('new-room-highlight');\n\t}\n}\n\nconst instance = new KonchatNotification();\n\nexport { instance as KonchatNotification };\n"]}}},"code":"let _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n}, 0);\nmodule.export({\n  KonchatNotification: () => instance\n});\nlet Random;\nmodule.link(\"@rocket.chat/random\", {\n  Random(v) {\n    Random = v;\n  }\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n}, 1);\nlet ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar(v) {\n    ReactiveVar = v;\n  }\n}, 2);\nlet RoomManager;\nmodule.link(\"../../../../client/lib/RoomManager\", {\n  RoomManager(v) {\n    RoomManager = v;\n  }\n}, 3);\nlet onClientMessageReceived;\nmodule.link(\"../../../../client/lib/onClientMessageReceived\", {\n  onClientMessageReceived(v) {\n    onClientMessageReceived = v;\n  }\n}, 4);\nlet getAvatarAsPng;\nmodule.link(\"../../../../client/lib/utils/getAvatarAsPng\", {\n  getAvatarAsPng(v) {\n    getAvatarAsPng = v;\n  }\n}, 5);\nlet router;\nmodule.link(\"../../../../client/providers/RouterProvider\", {\n  router(v) {\n    router = v;\n  }\n}, 6);\nlet stripTags;\nmodule.link(\"../../../../lib/utils/stringUtils\", {\n  stripTags(v) {\n    stripTags = v;\n  }\n}, 7);\nlet CustomSounds;\nmodule.link(\"../../../custom-sounds/client/lib/CustomSounds\", {\n  CustomSounds(v) {\n    CustomSounds = v;\n  }\n}, 8);\nlet e2e;\nmodule.link(\"../../../e2e/client\", {\n  e2e(v) {\n    e2e = v;\n  }\n}, 9);\nlet ChatSubscription;\nmodule.link(\"../../../models/client\", {\n  ChatSubscription(v) {\n    ChatSubscription = v;\n  }\n}, 10);\nlet getUserPreference;\nmodule.link(\"../../../utils/client\", {\n  getUserPreference(v) {\n    getUserPreference = v;\n  }\n}, 11);\nlet getUserAvatarURL;\nmodule.link(\"../../../utils/client/getUserAvatarURL\", {\n  getUserAvatarURL(v) {\n    getUserAvatarURL = v;\n  }\n}, 12);\nlet sdk;\nmodule.link(\"../../../utils/client/lib/SDKClient\", {\n  sdk(v) {\n    sdk = v;\n  }\n}, 13);\nclass KonchatNotification {\n  constructor() {\n    this.notificationStatus = new ReactiveVar(undefined);\n  }\n  getDesktopPermission() {\n    if (window.Notification && Notification.permission !== 'granted') {\n      return Notification.requestPermission(status => {\n        this.notificationStatus.set(status);\n      });\n    }\n  }\n  async notify(notification) {\n    var _notification$payload, _notification$duratio;\n    if (typeof window.Notification === 'undefined' || Notification.permission !== 'granted') {\n      return;\n    }\n    if (!notification.payload) {\n      return;\n    }\n    const {\n      rid\n    } = notification.payload;\n    if (!rid) {\n      return;\n    }\n    const message = await onClientMessageReceived({\n      rid,\n      msg: notification.text,\n      notification: true\n    });\n    const requireInteraction = getUserPreference(Meteor.userId(), 'desktopNotificationRequireInteraction');\n    const n = new Notification(notification.title, {\n      icon: notification.icon || getUserAvatarURL((_notification$payload = notification.payload.sender) === null || _notification$payload === void 0 ? void 0 : _notification$payload.username),\n      body: stripTags(message.msg),\n      tag: notification.payload._id,\n      canReply: true,\n      silent: true,\n      requireInteraction\n    });\n    const notificationDuration = !requireInteraction ? ((_notification$duratio = notification.duration) !== null && _notification$duratio !== void 0 ? _notification$duratio : 0) - 0 || 10 : -1;\n    if (notificationDuration > 0) {\n      setTimeout(() => n.close(), notificationDuration * 1000);\n    }\n    if (n.addEventListener) {\n      n.addEventListener('reply', _ref => {\n        let {\n          response\n        } = _ref;\n        return void sdk.call('sendMessage', {\n          _id: Random.id(),\n          rid,\n          msg: response\n        });\n      });\n    }\n    n.onclick = function () {\n      var _notification$payload2;\n      this.close();\n      window.focus();\n      if (!notification.payload._id || !notification.payload.rid || !notification.payload.name) {\n        return;\n      }\n      switch ((_notification$payload2 = notification.payload) === null || _notification$payload2 === void 0 ? void 0 : _notification$payload2.type) {\n        case 'd':\n          return router.navigate({\n            pattern: '/direct/:rid/:tab?/:context?',\n            params: _objectSpread({\n              rid: notification.payload.rid\n            }, notification.payload.tmid && {\n              tab: 'thread',\n              context: notification.payload.tmid\n            }),\n            search: _objectSpread(_objectSpread({}, router.getSearchParameters()), {}, {\n              jump: notification.payload._id\n            })\n          });\n        case 'c':\n          return router.navigate({\n            pattern: '/channel/:name/:tab?/:context?',\n            params: _objectSpread({\n              name: notification.payload.name\n            }, notification.payload.tmid && {\n              tab: 'thread',\n              context: notification.payload.tmid\n            }),\n            search: _objectSpread(_objectSpread({}, router.getSearchParameters()), {}, {\n              jump: notification.payload._id\n            })\n          });\n        case 'p':\n          return router.navigate({\n            pattern: '/group/:name/:tab?/:context?',\n            params: _objectSpread({\n              name: notification.payload.name\n            }, notification.payload.tmid && {\n              tab: 'thread',\n              context: notification.payload.tmid\n            }),\n            search: _objectSpread(_objectSpread({}, router.getSearchParameters()), {}, {\n              jump: notification.payload._id\n            })\n          });\n        case 'l':\n          return router.navigate({\n            pattern: '/live/:id/:tab?/:context?',\n            params: {\n              id: notification.payload.rid,\n              tab: 'room-info'\n            },\n            search: _objectSpread(_objectSpread({}, router.getSearchParameters()), {}, {\n              jump: notification.payload._id\n            })\n          });\n      }\n    };\n  }\n  async showDesktop(notification) {\n    var _notification$payload3, _Meteor$user, _notification$payload4, _notification$payload5, _notification$payload6, _notification$payload7;\n    if (!notification.payload.rid) {\n      return;\n    }\n    if (((_notification$payload3 = notification.payload) === null || _notification$payload3 === void 0 ? void 0 : _notification$payload3.rid) === RoomManager.opened && (typeof window.document.hasFocus === 'function' ? window.document.hasFocus() : undefined)) {\n      return;\n    }\n    if (((_Meteor$user = Meteor.user()) === null || _Meteor$user === void 0 ? void 0 : _Meteor$user.status) === 'busy') {\n      return;\n    }\n    if (((_notification$payload4 = notification.payload) === null || _notification$payload4 === void 0 ? void 0 : (_notification$payload5 = _notification$payload4.message) === null || _notification$payload5 === void 0 ? void 0 : _notification$payload5.t) === 'e2e') {\n      const e2eRoom = await e2e.getInstanceByRoomId(notification.payload.rid);\n      if (e2eRoom) {\n        notification.text = (await e2eRoom.decrypt(notification.payload.message.msg)).text;\n      }\n    }\n    return getAvatarAsPng((_notification$payload6 = notification.payload) === null || _notification$payload6 === void 0 ? void 0 : (_notification$payload7 = _notification$payload6.sender) === null || _notification$payload7 === void 0 ? void 0 : _notification$payload7.username, avatarAsPng => {\n      notification.icon = avatarAsPng;\n      return this.notify(notification);\n    });\n  }\n  async newMessage(rid) {\n    var _Meteor$user2;\n    if (((_Meteor$user2 = Meteor.user()) === null || _Meteor$user2 === void 0 ? void 0 : _Meteor$user2.status) === 'busy') {\n      return;\n    }\n    const userId = Meteor.userId();\n    const newMessageNotification = getUserPreference(userId, 'newMessageNotification');\n    const audioVolume = getUserPreference(userId, 'notificationsSoundVolume', 100);\n    if (!rid) {\n      return;\n    }\n    const sub = ChatSubscription.findOne({\n      rid\n    }, {\n      fields: {\n        audioNotificationValue: 1\n      }\n    });\n    if (!sub || sub.audioNotificationValue === 'none') {\n      return;\n    }\n    try {\n      if (sub.audioNotificationValue && sub.audioNotificationValue !== '0') {\n        void CustomSounds.play(sub.audioNotificationValue, {\n          volume: Number((audioVolume / 100).toPrecision(2))\n        });\n        return;\n      }\n      if (newMessageNotification && newMessageNotification !== 'none') {\n        void CustomSounds.play(newMessageNotification, {\n          volume: Number((audioVolume / 100).toPrecision(2))\n        });\n      }\n    } catch (e) {\n      // do nothing\n    }\n  }\n  newRoom(rid) {\n    Tracker.nonreactive(() => {\n      let newRoomSound = Session.get('newRoomSound');\n      if (newRoomSound) {\n        newRoomSound = [...newRoomSound, rid];\n      } else {\n        newRoomSound = [rid];\n      }\n      return Session.set('newRoomSound', newRoomSound);\n    });\n  }\n  removeRoomNotification(rid) {\n    var _Session$get;\n    let newRoomSound = (_Session$get = Session.get('newRoomSound')) !== null && _Session$get !== void 0 ? _Session$get : [];\n    newRoomSound = newRoomSound.filter(_rid => _rid !== rid);\n    Tracker.nonreactive(() => Session.set('newRoomSound', newRoomSound));\n    const link = document.querySelector(\".link-room-\".concat(rid));\n    link === null || link === void 0 ? void 0 : link.classList.remove('new-room-highlight');\n  }\n}\nconst instance = new KonchatNotification();","map":{"version":3,"names":["_objectSpread","module","link","default","v","export","KonchatNotification","instance","Random","Meteor","ReactiveVar","RoomManager","onClientMessageReceived","getAvatarAsPng","router","stripTags","CustomSounds","e2e","ChatSubscription","getUserPreference","getUserAvatarURL","sdk","constructor","notificationStatus","undefined","getDesktopPermission","window","Notification","permission","requestPermission","status","set","notify","notification","_notification$payload","_notification$duratio","payload","rid","message","msg","text","requireInteraction","userId","n","title","icon","sender","username","body","tag","_id","canReply","silent","notificationDuration","duration","setTimeout","close","addEventListener","_ref","response","call","id","onclick","_notification$payload2","focus","name","type","navigate","pattern","params","tmid","tab","context","search","getSearchParameters","jump","showDesktop","_notification$payload3","_Meteor$user","_notification$payload4","_notification$payload5","_notification$payload6","_notification$payload7","opened","document","hasFocus","user","t","e2eRoom","getInstanceByRoomId","decrypt","avatarAsPng","newMessage","_Meteor$user2","newMessageNotification","audioVolume","sub","findOne","fields","audioNotificationValue","play","volume","Number","toPrecision","e","newRoom","Tracker","nonreactive","newRoomSound","Session","get","removeRoomNotification","_Session$get","filter","_rid","querySelector","concat","classList","remove"],"sources":["app/ui/client/lib/KonchatNotification.ts"],"sourcesContent":["import type { INotificationDesktop, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { Random } from '@rocket.chat/random';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\n\nimport { RoomManager } from '../../../../client/lib/RoomManager';\nimport { onClientMessageReceived } from '../../../../client/lib/onClientMessageReceived';\nimport { getAvatarAsPng } from '../../../../client/lib/utils/getAvatarAsPng';\nimport { router } from '../../../../client/providers/RouterProvider';\nimport { stripTags } from '../../../../lib/utils/stringUtils';\nimport { CustomSounds } from '../../../custom-sounds/client/lib/CustomSounds';\nimport { e2e } from '../../../e2e/client';\nimport { ChatSubscription } from '../../../models/client';\nimport { getUserPreference } from '../../../utils/client';\nimport { getUserAvatarURL } from '../../../utils/client/getUserAvatarURL';\nimport { sdk } from '../../../utils/client/lib/SDKClient';\n\ndeclare global {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface NotificationEventMap {\n\t\treply: { response: string };\n\t}\n}\n\nclass KonchatNotification {\n\tpublic notificationStatus = new ReactiveVar<NotificationPermission | undefined>(undefined);\n\n\tpublic getDesktopPermission() {\n\t\tif (window.Notification && Notification.permission !== 'granted') {\n\t\t\treturn Notification.requestPermission((status) => {\n\t\t\t\tthis.notificationStatus.set(status);\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic async notify(notification: INotificationDesktop) {\n\t\tif (typeof window.Notification === 'undefined' || Notification.permission !== 'granted') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!notification.payload) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { rid } = notification.payload;\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\t\tconst message = await onClientMessageReceived({\n\t\t\trid,\n\t\t\tmsg: notification.text,\n\t\t\tnotification: true,\n\t\t} as any);\n\n\t\tconst requireInteraction = getUserPreference<boolean>(Meteor.userId(), 'desktopNotificationRequireInteraction');\n\t\tconst n = new Notification(notification.title, {\n\t\t\ticon: notification.icon || getUserAvatarURL(notification.payload.sender?.username as string),\n\t\t\tbody: stripTags(message.msg),\n\t\t\ttag: notification.payload._id,\n\t\t\tcanReply: true,\n\t\t\tsilent: true,\n\t\t\trequireInteraction,\n\t\t} as NotificationOptions & {\n\t\t\tcanReply?: boolean; // TODO is this still needed for the desktop app?\n\t\t});\n\n\t\tconst notificationDuration = !requireInteraction ? (notification.duration ?? 0) - 0 || 10 : -1;\n\t\tif (notificationDuration > 0) {\n\t\t\tsetTimeout(() => n.close(), notificationDuration * 1000);\n\t\t}\n\n\t\tif (n.addEventListener) {\n\t\t\tn.addEventListener(\n\t\t\t\t'reply',\n\t\t\t\t({ response }) =>\n\t\t\t\t\tvoid sdk.call('sendMessage', {\n\t\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\t\trid,\n\t\t\t\t\t\tmsg: response,\n\t\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tn.onclick = function () {\n\t\t\tthis.close();\n\t\t\twindow.focus();\n\n\t\t\tif (!notification.payload._id || !notification.payload.rid || !notification.payload.name) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (notification.payload?.type) {\n\t\t\t\tcase 'd':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/direct/:rid/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\trid: notification.payload.rid,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'c':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/channel/:name/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tname: notification.payload.name,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'p':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/group/:name/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tname: notification.payload.name,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'l':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/live/:id/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tid: notification.payload.rid,\n\t\t\t\t\t\t\ttab: 'room-info',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic async showDesktop(notification: INotificationDesktop) {\n\t\tif (!notification.payload.rid) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tnotification.payload?.rid === RoomManager.opened &&\n\t\t\t(typeof window.document.hasFocus === 'function' ? window.document.hasFocus() : undefined)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ((Meteor.user() as IUser | null)?.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (notification.payload?.message?.t === 'e2e') {\n\t\t\tconst e2eRoom = await e2e.getInstanceByRoomId(notification.payload.rid);\n\t\t\tif (e2eRoom) {\n\t\t\t\tnotification.text = (await e2eRoom.decrypt(notification.payload.message.msg)).text;\n\t\t\t}\n\t\t}\n\n\t\treturn getAvatarAsPng(notification.payload?.sender?.username, (avatarAsPng) => {\n\t\t\tnotification.icon = avatarAsPng;\n\t\t\treturn this.notify(notification);\n\t\t});\n\t}\n\n\tpublic async newMessage(rid: IRoom['_id'] | undefined) {\n\t\tif ((Meteor.user() as IUser | null)?.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst userId = Meteor.userId();\n\t\tconst newMessageNotification = getUserPreference<string>(userId, 'newMessageNotification');\n\t\tconst audioVolume = getUserPreference(userId, 'notificationsSoundVolume', 100);\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sub = ChatSubscription.findOne({ rid }, { fields: { audioNotificationValue: 1 } });\n\n\t\tif (!sub || sub.audioNotificationValue === 'none') {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tif (sub.audioNotificationValue && sub.audioNotificationValue !== '0') {\n\t\t\t\tvoid CustomSounds.play(sub.audioNotificationValue, {\n\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (newMessageNotification && newMessageNotification !== 'none') {\n\t\t\t\tvoid CustomSounds.play(newMessageNotification, {\n\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// do nothing\n\t\t}\n\t}\n\n\tpublic newRoom(rid: IRoom['_id']) {\n\t\tTracker.nonreactive(() => {\n\t\t\tlet newRoomSound = Session.get('newRoomSound') as IRoom['_id'][] | undefined;\n\t\t\tif (newRoomSound) {\n\t\t\t\tnewRoomSound = [...newRoomSound, rid];\n\t\t\t} else {\n\t\t\t\tnewRoomSound = [rid];\n\t\t\t}\n\n\t\t\treturn Session.set('newRoomSound', newRoomSound);\n\t\t});\n\t}\n\n\tpublic removeRoomNotification(rid: IRoom['_id']) {\n\t\tlet newRoomSound = (Session.get('newRoomSound') as IRoom['_id'][] | undefined) ?? [];\n\t\tnewRoomSound = newRoomSound.filter((_rid) => _rid !== rid);\n\t\tTracker.nonreactive(() => Session.set('newRoomSound', newRoomSound));\n\n\t\tconst link = document.querySelector(`.link-room-${rid}`);\n\n\t\tlink?.classList.remove('new-room-highlight');\n\t}\n}\n\nconst instance = new KonchatNotification();\n\nexport { instance as KonchatNotification };\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"612a4f731c9b0b53112fdf220a04f6d5e12868a7"}
