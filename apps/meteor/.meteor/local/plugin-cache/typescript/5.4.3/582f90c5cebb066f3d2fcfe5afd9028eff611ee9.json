{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/ChatMessages.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui/client/lib/ChatMessages.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/ChatMessages.ts","inputSourceMap":{"version":3,"file":"app/ui/client/lib/ChatMessages.ts","sourceRoot":"","sources":["app/ui/client/lib/ChatMessages.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isVideoConfMessage } from '@rocket.chat/core-typings';\nimport type { IActionManager } from '@rocket.chat/ui-contexts';\n\nimport type { ChatAPI, ComposerAPI, DataAPI, UploadsAPI } from '../../../../client/lib/chats/ChatAPI';\nimport { createDataAPI } from '../../../../client/lib/chats/data';\nimport { processMessageEditing } from '../../../../client/lib/chats/flows/processMessageEditing';\nimport { processSetReaction } from '../../../../client/lib/chats/flows/processSetReaction';\nimport { processSlashCommand } from '../../../../client/lib/chats/flows/processSlashCommand';\nimport { processTooLongMessage } from '../../../../client/lib/chats/flows/processTooLongMessage';\nimport { replyBroadcast } from '../../../../client/lib/chats/flows/replyBroadcast';\nimport { requestMessageDeletion } from '../../../../client/lib/chats/flows/requestMessageDeletion';\nimport { sendMessage } from '../../../../client/lib/chats/flows/sendMessage';\nimport { uploadFiles } from '../../../../client/lib/chats/flows/uploadFiles';\nimport { ReadStateManager } from '../../../../client/lib/chats/readStateManager';\nimport { createUploadsAPI } from '../../../../client/lib/chats/uploads';\nimport {\n\tsetHighlightMessage,\n\tclearHighlightMessage,\n} from '../../../../client/views/room/MessageList/providers/messageHighlightSubscription';\nimport { UserAction } from './UserAction';\n\ntype DeepWritable<T> = T extends (...args: any) => any\n\t? T\n\t: {\n\t\t\t-readonly [P in keyof T]: DeepWritable<T[P]>;\n\t  };\n\nexport class ChatMessages implements ChatAPI {\n\tpublic uid: string | null;\n\n\tpublic composer: ComposerAPI | undefined;\n\n\tpublic setComposerAPI = (composer: ComposerAPI): void => {\n\t\tthis.composer?.release();\n\t\tthis.composer = composer;\n\t};\n\n\tpublic data: DataAPI;\n\n\tpublic readStateManager: ReadStateManager;\n\n\tpublic uploads: UploadsAPI;\n\n\tpublic ActionManager: any;\n\n\tpublic emojiPicker: {\n\t\topen(el: Element, cb: (emoji: string) => void): void;\n\t\tclose(): void;\n\t};\n\n\tpublic action: {\n\t\tstart(action: 'typing'): Promise<void> | void;\n\t\tstop(action: 'typing' | 'recording' | 'uploading' | 'playing'): Promise<void> | void;\n\t\tperformContinuously(action: 'recording' | 'uploading' | 'playing'): Promise<void> | void;\n\t};\n\n\tprivate currentEditingMID?: string;\n\n\tpublic messageEditing: ChatAPI['messageEditing'] = {\n\t\ttoPreviousMessage: async () => {\n\t\t\tif (!this.composer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.currentEditing) {\n\t\t\t\tlet lastMessage = await this.data.findLastOwnMessage();\n\n\t\t\t\t// Videoconf messages should not be edited\n\t\t\t\tif (lastMessage && isVideoConfMessage(lastMessage)) {\n\t\t\t\t\tlastMessage = await this.data.findPreviousOwnMessage(lastMessage);\n\t\t\t\t}\n\n\t\t\t\tif (lastMessage) {\n\t\t\t\t\tawait this.data.saveDraft(undefined, this.composer.text);\n\t\t\t\t\tawait this.messageEditing.editMessage(lastMessage);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n\t\t\tlet previousMessage = currentMessage ? await this.data.findPreviousOwnMessage(currentMessage) : undefined;\n\n\t\t\t// Videoconf messages should not be edited\n\t\t\tif (previousMessage && isVideoConfMessage(previousMessage)) {\n\t\t\t\tpreviousMessage = await this.data.findPreviousOwnMessage(previousMessage);\n\t\t\t}\n\n\t\t\tif (previousMessage) {\n\t\t\t\tawait this.messageEditing.editMessage(previousMessage);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.currentEditing.cancel();\n\t\t},\n\t\ttoNextMessage: async () => {\n\t\t\tif (!this.composer || !this.currentEditing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n\t\t\tlet nextMessage = currentMessage ? await this.data.findNextOwnMessage(currentMessage) : undefined;\n\n\t\t\t// Videoconf messages should not be edited\n\t\t\tif (nextMessage && isVideoConfMessage(nextMessage)) {\n\t\t\t\tnextMessage = await this.data.findNextOwnMessage(nextMessage);\n\t\t\t}\n\n\t\t\tif (nextMessage) {\n\t\t\t\tawait this.messageEditing.editMessage(nextMessage, { cursorAtStart: true });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.currentEditing.cancel();\n\t\t},\n\t\teditMessage: async (message: IMessage, { cursorAtStart = false }: { cursorAtStart?: boolean } = {}) => {\n\t\t\tconst text = (await this.data.getDraft(message._id)) || message.attachments?.[0]?.description || message.msg;\n\n\t\t\tawait this.currentEditing?.stop();\n\n\t\t\tif (!this.composer || !(await this.data.canUpdateMessage(message))) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentEditingMID = message._id;\n\t\t\tsetHighlightMessage(message._id);\n\t\t\tthis.composer.setEditingMode(true);\n\n\t\t\tthis.composer.setText(text);\n\t\t\tcursorAtStart && this.composer.setCursorToStart();\n\t\t\t!cursorAtStart && this.composer.setCursorToEnd();\n\t\t\tthis.composer.focus();\n\t\t},\n\t};\n\n\tpublic flows: DeepWritable<ChatAPI['flows']>;\n\n\tpublic constructor(\n\t\tprivate params: {\n\t\t\trid: IRoom['_id'];\n\t\t\ttmid?: IMessage['_id'];\n\t\t\tuid: IUser['_id'] | null;\n\t\t\tactionManager: IActionManager;\n\t\t},\n\t) {\n\t\tconst { rid, tmid } = params;\n\t\tthis.uid = params.uid;\n\t\tthis.data = createDataAPI({ rid, tmid });\n\t\tthis.uploads = createUploadsAPI({ rid, tmid });\n\t\tthis.ActionManager = params.actionManager;\n\n\t\tconst unimplemented = () => {\n\t\t\tthrow new Error('Flow is not implemented');\n\t\t};\n\n\t\tthis.readStateManager = new ReadStateManager(rid);\n\n\t\tthis.emojiPicker = {\n\t\t\topen: unimplemented,\n\t\t\tclose: unimplemented,\n\t\t};\n\n\t\tthis.action = {\n\t\t\tstart: async (action: 'typing') => {\n\t\t\t\tUserAction.start(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t\tperformContinuously: async (action: 'recording' | 'uploading' | 'playing') => {\n\t\t\t\tUserAction.performContinuously(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t\tstop: async (action: 'typing' | 'recording' | 'uploading' | 'playing') => {\n\t\t\t\tUserAction.stop(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t};\n\n\t\tthis.flows = {\n\t\t\tuploadFiles: uploadFiles.bind(null, this),\n\t\t\tsendMessage: sendMessage.bind(this, this),\n\t\t\tprocessSlashCommand: processSlashCommand.bind(null, this),\n\t\t\tprocessTooLongMessage: processTooLongMessage.bind(null, this),\n\t\t\tprocessMessageEditing: processMessageEditing.bind(null, this),\n\t\t\tprocessSetReaction: processSetReaction.bind(null, this),\n\t\t\trequestMessageDeletion: requestMessageDeletion.bind(this, this),\n\t\t\treplyBroadcast: replyBroadcast.bind(null, this),\n\t\t};\n\t}\n\n\tpublic get currentEditing() {\n\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tmid: this.currentEditingMID,\n\t\t\treset: async (): Promise<boolean> => {\n\t\t\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst message = await this.data.findMessageByID(this.currentEditingMID);\n\t\t\t\tif (this.composer.text !== message?.msg) {\n\t\t\t\t\tthis.composer.setText(message?.msg ?? '');\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tstop: async (): Promise<void> => {\n\t\t\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst message = await this.data.findMessageByID(this.currentEditingMID);\n\t\t\t\tconst draft = this.composer.text;\n\n\t\t\t\tif (draft === message?.msg) {\n\t\t\t\t\tawait this.data.discardDraft(this.currentEditingMID);\n\t\t\t\t} else {\n\t\t\t\t\tawait this.data.saveDraft(this.currentEditingMID, (await this.data.getDraft(this.currentEditingMID)) || draft);\n\t\t\t\t}\n\n\t\t\t\tthis.composer.setEditingMode(false);\n\t\t\t\tthis.currentEditingMID = undefined;\n\t\t\t\tclearHighlightMessage();\n\t\t\t},\n\t\t\tcancel: async (): Promise<void> => {\n\t\t\t\tif (!this.currentEditingMID) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tawait this.data.discardDraft(this.currentEditingMID);\n\t\t\t\tawait this.currentEditing?.stop();\n\t\t\t\tthis.composer?.setText((await this.data.getDraft(undefined)) ?? '');\n\t\t\t},\n\t\t};\n\t}\n\n\tpublic async release() {\n\t\tif (this.currentEditing) {\n\t\t\tif (!this.params.tmid) {\n\t\t\t\tawait this.currentEditing.cancel();\n\t\t\t}\n\t\t\tthis.composer?.clear();\n\t\t}\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/ChatMessages.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui/client/lib/ChatMessages.ts","inputSourceMap":{"version":3,"file":"app/ui/client/lib/ChatMessages.ts","sourceRoot":"","sources":["app/ui/client/lib/ChatMessages.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isVideoConfMessage } from '@rocket.chat/core-typings';\nimport type { IActionManager } from '@rocket.chat/ui-contexts';\n\nimport type { ChatAPI, ComposerAPI, DataAPI, UploadsAPI } from '../../../../client/lib/chats/ChatAPI';\nimport { createDataAPI } from '../../../../client/lib/chats/data';\nimport { processMessageEditing } from '../../../../client/lib/chats/flows/processMessageEditing';\nimport { processSetReaction } from '../../../../client/lib/chats/flows/processSetReaction';\nimport { processSlashCommand } from '../../../../client/lib/chats/flows/processSlashCommand';\nimport { processTooLongMessage } from '../../../../client/lib/chats/flows/processTooLongMessage';\nimport { replyBroadcast } from '../../../../client/lib/chats/flows/replyBroadcast';\nimport { requestMessageDeletion } from '../../../../client/lib/chats/flows/requestMessageDeletion';\nimport { sendMessage } from '../../../../client/lib/chats/flows/sendMessage';\nimport { uploadFiles } from '../../../../client/lib/chats/flows/uploadFiles';\nimport { ReadStateManager } from '../../../../client/lib/chats/readStateManager';\nimport { createUploadsAPI } from '../../../../client/lib/chats/uploads';\nimport {\n\tsetHighlightMessage,\n\tclearHighlightMessage,\n} from '../../../../client/views/room/MessageList/providers/messageHighlightSubscription';\nimport { UserAction } from './UserAction';\n\ntype DeepWritable<T> = T extends (...args: any) => any\n\t? T\n\t: {\n\t\t\t-readonly [P in keyof T]: DeepWritable<T[P]>;\n\t  };\n\nexport class ChatMessages implements ChatAPI {\n\tpublic uid: string | null;\n\n\tpublic composer: ComposerAPI | undefined;\n\n\tpublic setComposerAPI = (composer: ComposerAPI): void => {\n\t\tthis.composer?.release();\n\t\tthis.composer = composer;\n\t};\n\n\tpublic data: DataAPI;\n\n\tpublic readStateManager: ReadStateManager;\n\n\tpublic uploads: UploadsAPI;\n\n\tpublic ActionManager: any;\n\n\tpublic emojiPicker: {\n\t\topen(el: Element, cb: (emoji: string) => void): void;\n\t\tclose(): void;\n\t};\n\n\tpublic action: {\n\t\tstart(action: 'typing'): Promise<void> | void;\n\t\tstop(action: 'typing' | 'recording' | 'uploading' | 'playing'): Promise<void> | void;\n\t\tperformContinuously(action: 'recording' | 'uploading' | 'playing'): Promise<void> | void;\n\t};\n\n\tprivate currentEditingMID?: string;\n\n\tpublic messageEditing: ChatAPI['messageEditing'] = {\n\t\ttoPreviousMessage: async () => {\n\t\t\tif (!this.composer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.currentEditing) {\n\t\t\t\tlet lastMessage = await this.data.findLastOwnMessage();\n\n\t\t\t\t// Videoconf messages should not be edited\n\t\t\t\tif (lastMessage && isVideoConfMessage(lastMessage)) {\n\t\t\t\t\tlastMessage = await this.data.findPreviousOwnMessage(lastMessage);\n\t\t\t\t}\n\n\t\t\t\tif (lastMessage) {\n\t\t\t\t\tawait this.data.saveDraft(undefined, this.composer.text);\n\t\t\t\t\tawait this.messageEditing.editMessage(lastMessage);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n\t\t\tlet previousMessage = currentMessage ? await this.data.findPreviousOwnMessage(currentMessage) : undefined;\n\n\t\t\t// Videoconf messages should not be edited\n\t\t\tif (previousMessage && isVideoConfMessage(previousMessage)) {\n\t\t\t\tpreviousMessage = await this.data.findPreviousOwnMessage(previousMessage);\n\t\t\t}\n\n\t\t\tif (previousMessage) {\n\t\t\t\tawait this.messageEditing.editMessage(previousMessage);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.currentEditing.cancel();\n\t\t},\n\t\ttoNextMessage: async () => {\n\t\t\tif (!this.composer || !this.currentEditing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n\t\t\tlet nextMessage = currentMessage ? await this.data.findNextOwnMessage(currentMessage) : undefined;\n\n\t\t\t// Videoconf messages should not be edited\n\t\t\tif (nextMessage && isVideoConfMessage(nextMessage)) {\n\t\t\t\tnextMessage = await this.data.findNextOwnMessage(nextMessage);\n\t\t\t}\n\n\t\t\tif (nextMessage) {\n\t\t\t\tawait this.messageEditing.editMessage(nextMessage, { cursorAtStart: true });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.currentEditing.cancel();\n\t\t},\n\t\teditMessage: async (message: IMessage, { cursorAtStart = false }: { cursorAtStart?: boolean } = {}) => {\n\t\t\tconst text = (await this.data.getDraft(message._id)) || message.attachments?.[0]?.description || message.msg;\n\n\t\t\tawait this.currentEditing?.stop();\n\n\t\t\tif (!this.composer || !(await this.data.canUpdateMessage(message))) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentEditingMID = message._id;\n\t\t\tsetHighlightMessage(message._id);\n\t\t\tthis.composer.setEditingMode(true);\n\n\t\t\tthis.composer.setText(text);\n\t\t\tcursorAtStart && this.composer.setCursorToStart();\n\t\t\t!cursorAtStart && this.composer.setCursorToEnd();\n\t\t\tthis.composer.focus();\n\t\t},\n\t};\n\n\tpublic flows: DeepWritable<ChatAPI['flows']>;\n\n\tpublic constructor(\n\t\tprivate params: {\n\t\t\trid: IRoom['_id'];\n\t\t\ttmid?: IMessage['_id'];\n\t\t\tuid: IUser['_id'] | null;\n\t\t\tactionManager: IActionManager;\n\t\t},\n\t) {\n\t\tconst { rid, tmid } = params;\n\t\tthis.uid = params.uid;\n\t\tthis.data = createDataAPI({ rid, tmid });\n\t\tthis.uploads = createUploadsAPI({ rid, tmid });\n\t\tthis.ActionManager = params.actionManager;\n\n\t\tconst unimplemented = () => {\n\t\t\tthrow new Error('Flow is not implemented');\n\t\t};\n\n\t\tthis.readStateManager = new ReadStateManager(rid);\n\n\t\tthis.emojiPicker = {\n\t\t\topen: unimplemented,\n\t\t\tclose: unimplemented,\n\t\t};\n\n\t\tthis.action = {\n\t\t\tstart: async (action: 'typing') => {\n\t\t\t\tUserAction.start(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t\tperformContinuously: async (action: 'recording' | 'uploading' | 'playing') => {\n\t\t\t\tUserAction.performContinuously(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t\tstop: async (action: 'typing' | 'recording' | 'uploading' | 'playing') => {\n\t\t\t\tUserAction.stop(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t};\n\n\t\tthis.flows = {\n\t\t\tuploadFiles: uploadFiles.bind(null, this),\n\t\t\tsendMessage: sendMessage.bind(this, this),\n\t\t\tprocessSlashCommand: processSlashCommand.bind(null, this),\n\t\t\tprocessTooLongMessage: processTooLongMessage.bind(null, this),\n\t\t\tprocessMessageEditing: processMessageEditing.bind(null, this),\n\t\t\tprocessSetReaction: processSetReaction.bind(null, this),\n\t\t\trequestMessageDeletion: requestMessageDeletion.bind(this, this),\n\t\t\treplyBroadcast: replyBroadcast.bind(null, this),\n\t\t};\n\t}\n\n\tpublic get currentEditing() {\n\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tmid: this.currentEditingMID,\n\t\t\treset: async (): Promise<boolean> => {\n\t\t\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst message = await this.data.findMessageByID(this.currentEditingMID);\n\t\t\t\tif (this.composer.text !== message?.msg) {\n\t\t\t\t\tthis.composer.setText(message?.msg ?? '');\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tstop: async (): Promise<void> => {\n\t\t\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst message = await this.data.findMessageByID(this.currentEditingMID);\n\t\t\t\tconst draft = this.composer.text;\n\n\t\t\t\tif (draft === message?.msg) {\n\t\t\t\t\tawait this.data.discardDraft(this.currentEditingMID);\n\t\t\t\t} else {\n\t\t\t\t\tawait this.data.saveDraft(this.currentEditingMID, (await this.data.getDraft(this.currentEditingMID)) || draft);\n\t\t\t\t}\n\n\t\t\t\tthis.composer.setEditingMode(false);\n\t\t\t\tthis.currentEditingMID = undefined;\n\t\t\t\tclearHighlightMessage();\n\t\t\t},\n\t\t\tcancel: async (): Promise<void> => {\n\t\t\t\tif (!this.currentEditingMID) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tawait this.data.discardDraft(this.currentEditingMID);\n\t\t\t\tawait this.currentEditing?.stop();\n\t\t\t\tthis.composer?.setText((await this.data.getDraft(undefined)) ?? '');\n\t\t\t},\n\t\t};\n\t}\n\n\tpublic async release() {\n\t\tif (this.currentEditing) {\n\t\t\tif (!this.params.tmid) {\n\t\t\t\tawait this.currentEditing.cancel();\n\t\t\t}\n\t\t\tthis.composer?.clear();\n\t\t}\n\t}\n}\n"]}}},"code":"var _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nvar _createClass;\nmodule.link(\"@babel/runtime/helpers/createClass\", {\n  default: function (v) {\n    _createClass = v;\n  }\n}, 1);\nmodule.export({\n  ChatMessages: function () {\n    return ChatMessages;\n  }\n});\nvar isVideoConfMessage;\nmodule.link(\"@rocket.chat/core-typings\", {\n  isVideoConfMessage: function (v) {\n    isVideoConfMessage = v;\n  }\n}, 0);\nvar createDataAPI;\nmodule.link(\"../../../../client/lib/chats/data\", {\n  createDataAPI: function (v) {\n    createDataAPI = v;\n  }\n}, 1);\nvar processMessageEditing;\nmodule.link(\"../../../../client/lib/chats/flows/processMessageEditing\", {\n  processMessageEditing: function (v) {\n    processMessageEditing = v;\n  }\n}, 2);\nvar processSetReaction;\nmodule.link(\"../../../../client/lib/chats/flows/processSetReaction\", {\n  processSetReaction: function (v) {\n    processSetReaction = v;\n  }\n}, 3);\nvar processSlashCommand;\nmodule.link(\"../../../../client/lib/chats/flows/processSlashCommand\", {\n  processSlashCommand: function (v) {\n    processSlashCommand = v;\n  }\n}, 4);\nvar processTooLongMessage;\nmodule.link(\"../../../../client/lib/chats/flows/processTooLongMessage\", {\n  processTooLongMessage: function (v) {\n    processTooLongMessage = v;\n  }\n}, 5);\nvar replyBroadcast;\nmodule.link(\"../../../../client/lib/chats/flows/replyBroadcast\", {\n  replyBroadcast: function (v) {\n    replyBroadcast = v;\n  }\n}, 6);\nvar requestMessageDeletion;\nmodule.link(\"../../../../client/lib/chats/flows/requestMessageDeletion\", {\n  requestMessageDeletion: function (v) {\n    requestMessageDeletion = v;\n  }\n}, 7);\nvar sendMessage;\nmodule.link(\"../../../../client/lib/chats/flows/sendMessage\", {\n  sendMessage: function (v) {\n    sendMessage = v;\n  }\n}, 8);\nvar uploadFiles;\nmodule.link(\"../../../../client/lib/chats/flows/uploadFiles\", {\n  uploadFiles: function (v) {\n    uploadFiles = v;\n  }\n}, 9);\nvar ReadStateManager;\nmodule.link(\"../../../../client/lib/chats/readStateManager\", {\n  ReadStateManager: function (v) {\n    ReadStateManager = v;\n  }\n}, 10);\nvar createUploadsAPI;\nmodule.link(\"../../../../client/lib/chats/uploads\", {\n  createUploadsAPI: function (v) {\n    createUploadsAPI = v;\n  }\n}, 11);\nvar setHighlightMessage, clearHighlightMessage;\nmodule.link(\"../../../../client/views/room/MessageList/providers/messageHighlightSubscription\", {\n  setHighlightMessage: function (v) {\n    setHighlightMessage = v;\n  },\n  clearHighlightMessage: function (v) {\n    clearHighlightMessage = v;\n  }\n}, 12);\nvar UserAction;\nmodule.link(\"./UserAction\", {\n  UserAction: function (v) {\n    UserAction = v;\n  }\n}, 13);\nvar ChatMessages = /*#__PURE__*/function () {\n  function ChatMessages(params) {\n    var _this = this;\n    this.params = void 0;\n    this.uid = void 0;\n    this.composer = void 0;\n    this.setComposerAPI = function (composer) {\n      var _this$composer;\n      (_this$composer = _this.composer) === null || _this$composer === void 0 ? void 0 : _this$composer.release();\n      _this.composer = composer;\n    };\n    this.data = void 0;\n    this.readStateManager = void 0;\n    this.uploads = void 0;\n    this.ActionManager = void 0;\n    this.emojiPicker = void 0;\n    this.action = void 0;\n    this.currentEditingMID = void 0;\n    this.messageEditing = {\n      toPreviousMessage: function () {\n        function _callee() {\n          var lastMessage, currentMessage, previousMessage;\n          return _regeneratorRuntime.async(function () {\n            function _callee$(_context) {\n              while (1) switch (_context.prev = _context.next) {\n                case 0:\n                  if (_this.composer) {\n                    _context.next = 2;\n                    break;\n                  }\n                  return _context.abrupt(\"return\");\n                case 2:\n                  if (_this.currentEditing) {\n                    _context.next = 16;\n                    break;\n                  }\n                  _context.next = 5;\n                  return _regeneratorRuntime.awrap(_this.data.findLastOwnMessage());\n                case 5:\n                  lastMessage = _context.sent;\n                  if (!(lastMessage && isVideoConfMessage(lastMessage))) {\n                    _context.next = 10;\n                    break;\n                  }\n                  _context.next = 9;\n                  return _regeneratorRuntime.awrap(_this.data.findPreviousOwnMessage(lastMessage));\n                case 9:\n                  lastMessage = _context.sent;\n                case 10:\n                  if (!lastMessage) {\n                    _context.next = 15;\n                    break;\n                  }\n                  _context.next = 13;\n                  return _regeneratorRuntime.awrap(_this.data.saveDraft(undefined, _this.composer.text));\n                case 13:\n                  _context.next = 15;\n                  return _regeneratorRuntime.awrap(_this.messageEditing.editMessage(lastMessage));\n                case 15:\n                  return _context.abrupt(\"return\");\n                case 16:\n                  _context.next = 18;\n                  return _regeneratorRuntime.awrap(_this.data.findMessageByID(_this.currentEditing.mid));\n                case 18:\n                  currentMessage = _context.sent;\n                  if (!currentMessage) {\n                    _context.next = 25;\n                    break;\n                  }\n                  _context.next = 22;\n                  return _regeneratorRuntime.awrap(_this.data.findPreviousOwnMessage(currentMessage));\n                case 22:\n                  _context.t0 = _context.sent;\n                  _context.next = 26;\n                  break;\n                case 25:\n                  _context.t0 = undefined;\n                case 26:\n                  previousMessage = _context.t0;\n                  if (!(previousMessage && isVideoConfMessage(previousMessage))) {\n                    _context.next = 31;\n                    break;\n                  }\n                  _context.next = 30;\n                  return _regeneratorRuntime.awrap(_this.data.findPreviousOwnMessage(previousMessage));\n                case 30:\n                  previousMessage = _context.sent;\n                case 31:\n                  if (!previousMessage) {\n                    _context.next = 35;\n                    break;\n                  }\n                  _context.next = 34;\n                  return _regeneratorRuntime.awrap(_this.messageEditing.editMessage(previousMessage));\n                case 34:\n                  return _context.abrupt(\"return\");\n                case 35:\n                  _context.next = 37;\n                  return _regeneratorRuntime.awrap(_this.currentEditing.cancel());\n                case 37:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n            return _callee$;\n          }(), null, null, null, Promise);\n        }\n        return _callee;\n      }(),\n      toNextMessage: function () {\n        function _callee2() {\n          var currentMessage, nextMessage;\n          return _regeneratorRuntime.async(function () {\n            function _callee2$(_context2) {\n              while (1) switch (_context2.prev = _context2.next) {\n                case 0:\n                  if (!(!_this.composer || !_this.currentEditing)) {\n                    _context2.next = 2;\n                    break;\n                  }\n                  return _context2.abrupt(\"return\");\n                case 2:\n                  _context2.next = 4;\n                  return _regeneratorRuntime.awrap(_this.data.findMessageByID(_this.currentEditing.mid));\n                case 4:\n                  currentMessage = _context2.sent;\n                  if (!currentMessage) {\n                    _context2.next = 11;\n                    break;\n                  }\n                  _context2.next = 8;\n                  return _regeneratorRuntime.awrap(_this.data.findNextOwnMessage(currentMessage));\n                case 8:\n                  _context2.t0 = _context2.sent;\n                  _context2.next = 12;\n                  break;\n                case 11:\n                  _context2.t0 = undefined;\n                case 12:\n                  nextMessage = _context2.t0;\n                  if (!(nextMessage && isVideoConfMessage(nextMessage))) {\n                    _context2.next = 17;\n                    break;\n                  }\n                  _context2.next = 16;\n                  return _regeneratorRuntime.awrap(_this.data.findNextOwnMessage(nextMessage));\n                case 16:\n                  nextMessage = _context2.sent;\n                case 17:\n                  if (!nextMessage) {\n                    _context2.next = 21;\n                    break;\n                  }\n                  _context2.next = 20;\n                  return _regeneratorRuntime.awrap(_this.messageEditing.editMessage(nextMessage, {\n                    cursorAtStart: true\n                  }));\n                case 20:\n                  return _context2.abrupt(\"return\");\n                case 21:\n                  _context2.next = 23;\n                  return _regeneratorRuntime.awrap(_this.currentEditing.cancel());\n                case 23:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n            return _callee2$;\n          }(), null, null, null, Promise);\n        }\n        return _callee2;\n      }(),\n      editMessage: function () {\n        function _callee3(message) {\n          var _message$attachments, _message$attachments$, _this$currentEditing;\n          var _ref,\n            _ref$cursorAtStart,\n            cursorAtStart,\n            text,\n            _args3 = arguments;\n          return _regeneratorRuntime.async(function () {\n            function _callee3$(_context3) {\n              while (1) switch (_context3.prev = _context3.next) {\n                case 0:\n                  _ref = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : {}, _ref$cursorAtStart = _ref.cursorAtStart, cursorAtStart = _ref$cursorAtStart === void 0 ? false : _ref$cursorAtStart;\n                  _context3.next = 3;\n                  return _regeneratorRuntime.awrap(_this.data.getDraft(message._id));\n                case 3:\n                  _context3.t1 = _context3.sent;\n                  if (_context3.t1) {\n                    _context3.next = 6;\n                    break;\n                  }\n                  _context3.t1 = (_message$attachments = message.attachments) === null || _message$attachments === void 0 ? void 0 : (_message$attachments$ = _message$attachments[0]) === null || _message$attachments$ === void 0 ? void 0 : _message$attachments$.description;\n                case 6:\n                  _context3.t0 = _context3.t1;\n                  if (_context3.t0) {\n                    _context3.next = 9;\n                    break;\n                  }\n                  _context3.t0 = message.msg;\n                case 9:\n                  text = _context3.t0;\n                  _context3.next = 12;\n                  return _regeneratorRuntime.awrap((_this$currentEditing = _this.currentEditing) === null || _this$currentEditing === void 0 ? void 0 : _this$currentEditing.stop());\n                case 12:\n                  _context3.t2 = !_this.composer;\n                  if (_context3.t2) {\n                    _context3.next = 17;\n                    break;\n                  }\n                  _context3.next = 16;\n                  return _regeneratorRuntime.awrap(_this.data.canUpdateMessage(message));\n                case 16:\n                  _context3.t2 = !_context3.sent;\n                case 17:\n                  if (!_context3.t2) {\n                    _context3.next = 19;\n                    break;\n                  }\n                  return _context3.abrupt(\"return\");\n                case 19:\n                  _this.currentEditingMID = message._id;\n                  setHighlightMessage(message._id);\n                  _this.composer.setEditingMode(true);\n                  _this.composer.setText(text);\n                  cursorAtStart && _this.composer.setCursorToStart();\n                  !cursorAtStart && _this.composer.setCursorToEnd();\n                  _this.composer.focus();\n                case 26:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n            return _callee3$;\n          }(), null, null, null, Promise);\n        }\n        return _callee3;\n      }()\n    };\n    this.flows = void 0;\n    this.params = params;\n    var rid = params.rid,\n      tmid = params.tmid;\n    this.uid = params.uid;\n    this.data = createDataAPI({\n      rid: rid,\n      tmid: tmid\n    });\n    this.uploads = createUploadsAPI({\n      rid: rid,\n      tmid: tmid\n    });\n    this.ActionManager = params.actionManager;\n    var unimplemented = function () {\n      throw new Error('Flow is not implemented');\n    };\n    this.readStateManager = new ReadStateManager(rid);\n    this.emojiPicker = {\n      open: unimplemented,\n      close: unimplemented\n    };\n    this.action = {\n      start: function () {\n        function _callee4(action) {\n          return _regeneratorRuntime.async(function () {\n            function _callee4$(_context4) {\n              while (1) switch (_context4.prev = _context4.next) {\n                case 0:\n                  UserAction.start(params.rid, \"user-\" + action, {\n                    tmid: params.tmid\n                  });\n                case 1:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n            return _callee4$;\n          }(), null, null, null, Promise);\n        }\n        return _callee4;\n      }(),\n      performContinuously: function () {\n        function _callee5(action) {\n          return _regeneratorRuntime.async(function () {\n            function _callee5$(_context5) {\n              while (1) switch (_context5.prev = _context5.next) {\n                case 0:\n                  UserAction.performContinuously(params.rid, \"user-\" + action, {\n                    tmid: params.tmid\n                  });\n                case 1:\n                case \"end\":\n                  return _context5.stop();\n              }\n            }\n            return _callee5$;\n          }(), null, null, null, Promise);\n        }\n        return _callee5;\n      }(),\n      stop: function () {\n        function _callee6(action) {\n          return _regeneratorRuntime.async(function () {\n            function _callee6$(_context6) {\n              while (1) switch (_context6.prev = _context6.next) {\n                case 0:\n                  UserAction.stop(params.rid, \"user-\" + action, {\n                    tmid: params.tmid\n                  });\n                case 1:\n                case \"end\":\n                  return _context6.stop();\n              }\n            }\n            return _callee6$;\n          }(), null, null, null, Promise);\n        }\n        return _callee6;\n      }()\n    };\n    this.flows = {\n      uploadFiles: uploadFiles.bind(null, this),\n      sendMessage: sendMessage.bind(this, this),\n      processSlashCommand: processSlashCommand.bind(null, this),\n      processTooLongMessage: processTooLongMessage.bind(null, this),\n      processMessageEditing: processMessageEditing.bind(null, this),\n      processSetReaction: processSetReaction.bind(null, this),\n      requestMessageDeletion: requestMessageDeletion.bind(this, this),\n      replyBroadcast: replyBroadcast.bind(null, this)\n    };\n  }\n  var _proto = ChatMessages.prototype;\n  _proto.release = function () {\n    function release() {\n      var _this$composer2;\n      return _regeneratorRuntime.async(function () {\n        function release$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              if (!this.currentEditing) {\n                _context7.next = 5;\n                break;\n              }\n              if (this.params.tmid) {\n                _context7.next = 4;\n                break;\n              }\n              _context7.next = 4;\n              return _regeneratorRuntime.awrap(this.currentEditing.cancel());\n            case 4:\n              (_this$composer2 = this.composer) === null || _this$composer2 === void 0 ? void 0 : _this$composer2.clear();\n            case 5:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n        return release$;\n      }(), null, this, null, Promise);\n    }\n    return release;\n  }();\n  return _createClass(ChatMessages, [{\n    key: \"currentEditing\",\n    get: function () {\n      var _this2 = this;\n      if (!this.composer || !this.currentEditingMID) {\n        return undefined;\n      }\n      return {\n        mid: this.currentEditingMID,\n        reset: function () {\n          function _callee7() {\n            var message, _message$msg;\n            return _regeneratorRuntime.async(function () {\n              function _callee7$(_context8) {\n                while (1) switch (_context8.prev = _context8.next) {\n                  case 0:\n                    if (!(!_this2.composer || !_this2.currentEditingMID)) {\n                      _context8.next = 2;\n                      break;\n                    }\n                    return _context8.abrupt(\"return\", false);\n                  case 2:\n                    _context8.next = 4;\n                    return _regeneratorRuntime.awrap(_this2.data.findMessageByID(_this2.currentEditingMID));\n                  case 4:\n                    message = _context8.sent;\n                    if (!(_this2.composer.text !== (message === null || message === void 0 ? void 0 : message.msg))) {\n                      _context8.next = 8;\n                      break;\n                    }\n                    _this2.composer.setText((_message$msg = message === null || message === void 0 ? void 0 : message.msg) !== null && _message$msg !== void 0 ? _message$msg : '');\n                    return _context8.abrupt(\"return\", true);\n                  case 8:\n                    return _context8.abrupt(\"return\", false);\n                  case 9:\n                  case \"end\":\n                    return _context8.stop();\n                }\n              }\n              return _callee7$;\n            }(), null, null, null, Promise);\n          }\n          return _callee7;\n        }(),\n        stop: function () {\n          function _callee8() {\n            var message, draft;\n            return _regeneratorRuntime.async(function () {\n              function _callee8$(_context9) {\n                while (1) switch (_context9.prev = _context9.next) {\n                  case 0:\n                    if (!(!_this2.composer || !_this2.currentEditingMID)) {\n                      _context9.next = 2;\n                      break;\n                    }\n                    return _context9.abrupt(\"return\");\n                  case 2:\n                    _context9.next = 4;\n                    return _regeneratorRuntime.awrap(_this2.data.findMessageByID(_this2.currentEditingMID));\n                  case 4:\n                    message = _context9.sent;\n                    draft = _this2.composer.text;\n                    if (!(draft === (message === null || message === void 0 ? void 0 : message.msg))) {\n                      _context9.next = 11;\n                      break;\n                    }\n                    _context9.next = 9;\n                    return _regeneratorRuntime.awrap(_this2.data.discardDraft(_this2.currentEditingMID));\n                  case 9:\n                    _context9.next = 23;\n                    break;\n                  case 11:\n                    _context9.t0 = _regeneratorRuntime;\n                    _context9.t1 = _this2.data;\n                    _context9.t2 = _this2.currentEditingMID;\n                    _context9.next = 16;\n                    return _regeneratorRuntime.awrap(_this2.data.getDraft(_this2.currentEditingMID));\n                  case 16:\n                    _context9.t3 = _context9.sent;\n                    if (_context9.t3) {\n                      _context9.next = 19;\n                      break;\n                    }\n                    _context9.t3 = draft;\n                  case 19:\n                    _context9.t4 = _context9.t3;\n                    _context9.t5 = _context9.t1.saveDraft.call(_context9.t1, _context9.t2, _context9.t4);\n                    _context9.next = 23;\n                    return _context9.t0.awrap.call(_context9.t0, _context9.t5);\n                  case 23:\n                    _this2.composer.setEditingMode(false);\n                    _this2.currentEditingMID = undefined;\n                    clearHighlightMessage();\n                  case 26:\n                  case \"end\":\n                    return _context9.stop();\n                }\n              }\n              return _callee8$;\n            }(), null, null, null, Promise);\n          }\n          return _callee8;\n        }(),\n        cancel: function () {\n          function _callee9() {\n            var _this2$currentEditing, _this2$composer, _await$_this2$data$ge;\n            return _regeneratorRuntime.async(function () {\n              function _callee9$(_context10) {\n                while (1) switch (_context10.prev = _context10.next) {\n                  case 0:\n                    if (_this2.currentEditingMID) {\n                      _context10.next = 2;\n                      break;\n                    }\n                    return _context10.abrupt(\"return\");\n                  case 2:\n                    _context10.next = 4;\n                    return _regeneratorRuntime.awrap(_this2.data.discardDraft(_this2.currentEditingMID));\n                  case 4:\n                    _context10.next = 6;\n                    return _regeneratorRuntime.awrap((_this2$currentEditing = _this2.currentEditing) === null || _this2$currentEditing === void 0 ? void 0 : _this2$currentEditing.stop());\n                  case 6:\n                    if (!((_this2$composer = _this2.composer) === null || _this2$composer === void 0)) {\n                      _context10.next = 10;\n                      break;\n                    }\n                    void 0;\n                    _context10.next = 24;\n                    break;\n                  case 10:\n                    _context10.t0 = _this2$composer;\n                    _context10.next = 13;\n                    return _regeneratorRuntime.awrap(_this2.data.getDraft(undefined));\n                  case 13:\n                    _context10.t2 = _await$_this2$data$ge = _context10.sent;\n                    _context10.t1 = _context10.t2 !== null;\n                    if (!_context10.t1) {\n                      _context10.next = 17;\n                      break;\n                    }\n                    _context10.t1 = _await$_this2$data$ge !== void 0;\n                  case 17:\n                    if (!_context10.t1) {\n                      _context10.next = 21;\n                      break;\n                    }\n                    _context10.t3 = _await$_this2$data$ge;\n                    _context10.next = 22;\n                    break;\n                  case 21:\n                    _context10.t3 = '';\n                  case 22:\n                    _context10.t4 = _context10.t3;\n                    _context10.t0.setText.call(_context10.t0, _context10.t4);\n                  case 24:\n                  case \"end\":\n                    return _context10.stop();\n                }\n              }\n              return _callee9$;\n            }(), null, null, null, Promise);\n          }\n          return _callee9;\n        }()\n      };\n    }\n  }]);\n}();","map":{"version":3,"names":["_regeneratorRuntime","module","link","default","v","_createClass","export","ChatMessages","isVideoConfMessage","createDataAPI","processMessageEditing","processSetReaction","processSlashCommand","processTooLongMessage","replyBroadcast","requestMessageDeletion","sendMessage","uploadFiles","ReadStateManager","createUploadsAPI","setHighlightMessage","clearHighlightMessage","UserAction","params","_this","uid","composer","setComposerAPI","_this$composer","release","data","readStateManager","uploads","ActionManager","emojiPicker","action","currentEditingMID","messageEditing","toPreviousMessage","_callee","lastMessage","currentMessage","previousMessage","async","_callee$","_context","prev","next","abrupt","currentEditing","awrap","findLastOwnMessage","sent","findPreviousOwnMessage","saveDraft","undefined","text","editMessage","findMessageByID","mid","t0","cancel","stop","Promise","toNextMessage","_callee2","nextMessage","_callee2$","_context2","findNextOwnMessage","cursorAtStart","_callee3","message","_message$attachments","_message$attachments$","_this$currentEditing","_ref","_ref$cursorAtStart","_args3","arguments","_callee3$","_context3","length","getDraft","_id","t1","attachments","description","msg","t2","canUpdateMessage","setEditingMode","setText","setCursorToStart","setCursorToEnd","focus","flows","rid","tmid","actionManager","unimplemented","Error","open","close","start","_callee4","_callee4$","_context4","performContinuously","_callee5","_callee5$","_context5","_callee6","_callee6$","_context6","bind","_proto","prototype","_this$composer2","release$","_context7","clear","key","get","_this2","reset","_callee7","_message$msg","_callee7$","_context8","_callee8","draft","_callee8$","_context9","discardDraft","t3","t4","t5","call","_callee9","_this2$currentEditing","_this2$composer","_await$_this2$data$ge","_callee9$","_context10"],"sources":["app/ui/client/lib/ChatMessages.ts"],"sourcesContent":["import type { IMessage, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isVideoConfMessage } from '@rocket.chat/core-typings';\nimport type { IActionManager } from '@rocket.chat/ui-contexts';\n\nimport type { ChatAPI, ComposerAPI, DataAPI, UploadsAPI } from '../../../../client/lib/chats/ChatAPI';\nimport { createDataAPI } from '../../../../client/lib/chats/data';\nimport { processMessageEditing } from '../../../../client/lib/chats/flows/processMessageEditing';\nimport { processSetReaction } from '../../../../client/lib/chats/flows/processSetReaction';\nimport { processSlashCommand } from '../../../../client/lib/chats/flows/processSlashCommand';\nimport { processTooLongMessage } from '../../../../client/lib/chats/flows/processTooLongMessage';\nimport { replyBroadcast } from '../../../../client/lib/chats/flows/replyBroadcast';\nimport { requestMessageDeletion } from '../../../../client/lib/chats/flows/requestMessageDeletion';\nimport { sendMessage } from '../../../../client/lib/chats/flows/sendMessage';\nimport { uploadFiles } from '../../../../client/lib/chats/flows/uploadFiles';\nimport { ReadStateManager } from '../../../../client/lib/chats/readStateManager';\nimport { createUploadsAPI } from '../../../../client/lib/chats/uploads';\nimport {\n\tsetHighlightMessage,\n\tclearHighlightMessage,\n} from '../../../../client/views/room/MessageList/providers/messageHighlightSubscription';\nimport { UserAction } from './UserAction';\n\ntype DeepWritable<T> = T extends (...args: any) => any\n\t? T\n\t: {\n\t\t\t-readonly [P in keyof T]: DeepWritable<T[P]>;\n\t  };\n\nexport class ChatMessages implements ChatAPI {\n\tpublic uid: string | null;\n\n\tpublic composer: ComposerAPI | undefined;\n\n\tpublic setComposerAPI = (composer: ComposerAPI): void => {\n\t\tthis.composer?.release();\n\t\tthis.composer = composer;\n\t};\n\n\tpublic data: DataAPI;\n\n\tpublic readStateManager: ReadStateManager;\n\n\tpublic uploads: UploadsAPI;\n\n\tpublic ActionManager: any;\n\n\tpublic emojiPicker: {\n\t\topen(el: Element, cb: (emoji: string) => void): void;\n\t\tclose(): void;\n\t};\n\n\tpublic action: {\n\t\tstart(action: 'typing'): Promise<void> | void;\n\t\tstop(action: 'typing' | 'recording' | 'uploading' | 'playing'): Promise<void> | void;\n\t\tperformContinuously(action: 'recording' | 'uploading' | 'playing'): Promise<void> | void;\n\t};\n\n\tprivate currentEditingMID?: string;\n\n\tpublic messageEditing: ChatAPI['messageEditing'] = {\n\t\ttoPreviousMessage: async () => {\n\t\t\tif (!this.composer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.currentEditing) {\n\t\t\t\tlet lastMessage = await this.data.findLastOwnMessage();\n\n\t\t\t\t// Videoconf messages should not be edited\n\t\t\t\tif (lastMessage && isVideoConfMessage(lastMessage)) {\n\t\t\t\t\tlastMessage = await this.data.findPreviousOwnMessage(lastMessage);\n\t\t\t\t}\n\n\t\t\t\tif (lastMessage) {\n\t\t\t\t\tawait this.data.saveDraft(undefined, this.composer.text);\n\t\t\t\t\tawait this.messageEditing.editMessage(lastMessage);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n\t\t\tlet previousMessage = currentMessage ? await this.data.findPreviousOwnMessage(currentMessage) : undefined;\n\n\t\t\t// Videoconf messages should not be edited\n\t\t\tif (previousMessage && isVideoConfMessage(previousMessage)) {\n\t\t\t\tpreviousMessage = await this.data.findPreviousOwnMessage(previousMessage);\n\t\t\t}\n\n\t\t\tif (previousMessage) {\n\t\t\t\tawait this.messageEditing.editMessage(previousMessage);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.currentEditing.cancel();\n\t\t},\n\t\ttoNextMessage: async () => {\n\t\t\tif (!this.composer || !this.currentEditing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n\t\t\tlet nextMessage = currentMessage ? await this.data.findNextOwnMessage(currentMessage) : undefined;\n\n\t\t\t// Videoconf messages should not be edited\n\t\t\tif (nextMessage && isVideoConfMessage(nextMessage)) {\n\t\t\t\tnextMessage = await this.data.findNextOwnMessage(nextMessage);\n\t\t\t}\n\n\t\t\tif (nextMessage) {\n\t\t\t\tawait this.messageEditing.editMessage(nextMessage, { cursorAtStart: true });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.currentEditing.cancel();\n\t\t},\n\t\teditMessage: async (message: IMessage, { cursorAtStart = false }: { cursorAtStart?: boolean } = {}) => {\n\t\t\tconst text = (await this.data.getDraft(message._id)) || message.attachments?.[0]?.description || message.msg;\n\n\t\t\tawait this.currentEditing?.stop();\n\n\t\t\tif (!this.composer || !(await this.data.canUpdateMessage(message))) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentEditingMID = message._id;\n\t\t\tsetHighlightMessage(message._id);\n\t\t\tthis.composer.setEditingMode(true);\n\n\t\t\tthis.composer.setText(text);\n\t\t\tcursorAtStart && this.composer.setCursorToStart();\n\t\t\t!cursorAtStart && this.composer.setCursorToEnd();\n\t\t\tthis.composer.focus();\n\t\t},\n\t};\n\n\tpublic flows: DeepWritable<ChatAPI['flows']>;\n\n\tpublic constructor(\n\t\tprivate params: {\n\t\t\trid: IRoom['_id'];\n\t\t\ttmid?: IMessage['_id'];\n\t\t\tuid: IUser['_id'] | null;\n\t\t\tactionManager: IActionManager;\n\t\t},\n\t) {\n\t\tconst { rid, tmid } = params;\n\t\tthis.uid = params.uid;\n\t\tthis.data = createDataAPI({ rid, tmid });\n\t\tthis.uploads = createUploadsAPI({ rid, tmid });\n\t\tthis.ActionManager = params.actionManager;\n\n\t\tconst unimplemented = () => {\n\t\t\tthrow new Error('Flow is not implemented');\n\t\t};\n\n\t\tthis.readStateManager = new ReadStateManager(rid);\n\n\t\tthis.emojiPicker = {\n\t\t\topen: unimplemented,\n\t\t\tclose: unimplemented,\n\t\t};\n\n\t\tthis.action = {\n\t\t\tstart: async (action: 'typing') => {\n\t\t\t\tUserAction.start(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t\tperformContinuously: async (action: 'recording' | 'uploading' | 'playing') => {\n\t\t\t\tUserAction.performContinuously(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t\tstop: async (action: 'typing' | 'recording' | 'uploading' | 'playing') => {\n\t\t\t\tUserAction.stop(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t};\n\n\t\tthis.flows = {\n\t\t\tuploadFiles: uploadFiles.bind(null, this),\n\t\t\tsendMessage: sendMessage.bind(this, this),\n\t\t\tprocessSlashCommand: processSlashCommand.bind(null, this),\n\t\t\tprocessTooLongMessage: processTooLongMessage.bind(null, this),\n\t\t\tprocessMessageEditing: processMessageEditing.bind(null, this),\n\t\t\tprocessSetReaction: processSetReaction.bind(null, this),\n\t\t\trequestMessageDeletion: requestMessageDeletion.bind(this, this),\n\t\t\treplyBroadcast: replyBroadcast.bind(null, this),\n\t\t};\n\t}\n\n\tpublic get currentEditing() {\n\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tmid: this.currentEditingMID,\n\t\t\treset: async (): Promise<boolean> => {\n\t\t\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst message = await this.data.findMessageByID(this.currentEditingMID);\n\t\t\t\tif (this.composer.text !== message?.msg) {\n\t\t\t\t\tthis.composer.setText(message?.msg ?? '');\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tstop: async (): Promise<void> => {\n\t\t\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst message = await this.data.findMessageByID(this.currentEditingMID);\n\t\t\t\tconst draft = this.composer.text;\n\n\t\t\t\tif (draft === message?.msg) {\n\t\t\t\t\tawait this.data.discardDraft(this.currentEditingMID);\n\t\t\t\t} else {\n\t\t\t\t\tawait this.data.saveDraft(this.currentEditingMID, (await this.data.getDraft(this.currentEditingMID)) || draft);\n\t\t\t\t}\n\n\t\t\t\tthis.composer.setEditingMode(false);\n\t\t\t\tthis.currentEditingMID = undefined;\n\t\t\t\tclearHighlightMessage();\n\t\t\t},\n\t\t\tcancel: async (): Promise<void> => {\n\t\t\t\tif (!this.currentEditingMID) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tawait this.data.discardDraft(this.currentEditingMID);\n\t\t\t\tawait this.currentEditing?.stop();\n\t\t\t\tthis.composer?.setText((await this.data.getDraft(undefined)) ?? '');\n\t\t\t},\n\t\t};\n\t}\n\n\tpublic async release() {\n\t\tif (this.currentEditing) {\n\t\t\tif (!this.params.tmid) {\n\t\t\t\tawait this.currentEditing.cancel();\n\t\t\t}\n\t\t\tthis.composer?.clear();\n\t\t}\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"582f90c5cebb066f3d2fcfe5afd9028eff611ee9"}
