{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/webdav/server/lib/webdavClientAdapter.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/webdav/server/lib/webdavClientAdapter.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/webdav/server/lib/webdavClientAdapter.ts","inputSourceMap":{"version":3,"file":"app/webdav/server/lib/webdavClientAdapter.ts","sourceRoot":"","sources":["app/webdav/server/lib/webdavClientAdapter.ts"],"names":[],"mappings":"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","sourcesContent":["import stream from 'stream';\nimport type { Readable, Writable } from 'stream';\n\nimport type { WebDAVClient, FileStat, ResponseDataDetailed, WebDAVClientOptions } from 'webdav';\nimport { createClient } from 'webdav';\n\nexport class WebdavClientAdapter {\n\t_client: WebDAVClient;\n\n\tconstructor(serverConfig: string, cred: WebDAVClientOptions) {\n\t\tif (cred.token) {\n\t\t\tthis._client = createClient(serverConfig, { token: cred.token });\n\t\t} else {\n\t\t\tthis._client = createClient(serverConfig, {\n\t\t\t\tusername: cred.username,\n\t\t\t\tpassword: cred.password,\n\t\t\t});\n\t\t}\n\t}\n\n\tasync stat(path: string): Promise<FileStat | ResponseDataDetailed<FileStat>> {\n\t\ttry {\n\t\t\treturn await this._client.stat(path);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error checking if directory exists on webdav');\n\t\t}\n\t}\n\n\tasync createDirectory(path: string): Promise<void> {\n\t\ttry {\n\t\t\treturn await this._client.createDirectory(path);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error creating directory on webdav');\n\t\t}\n\t}\n\n\tasync deleteFile(path: string): Promise<void> {\n\t\ttry {\n\t\t\treturn await this._client.deleteFile(path);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error deleting file on webdav');\n\t\t}\n\t}\n\n\tasync getFileContents(filename: string): Promise<Buffer> {\n\t\ttry {\n\t\t\treturn (await this._client.getFileContents(filename)) as Buffer;\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error getting file contents webdav');\n\t\t}\n\t}\n\n\tasync getDirectoryContents(path: string): Promise<FileStat[] | ResponseDataDetailed<FileStat[]>> {\n\t\ttry {\n\t\t\treturn await this._client.getDirectoryContents(path);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error getting directory contents webdav');\n\t\t}\n\t}\n\n\tasync putFileContents(path: string, data: Buffer, options: Record<string, any> = {}): Promise<any> {\n\t\ttry {\n\t\t\treturn await this._client.putFileContents(path, data, options);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ?? 'Error updating file contents.');\n\t\t}\n\t}\n\n\tcreateReadStream(path: string, options?: Record<string, any>): Readable {\n\t\treturn this._client.createReadStream(path, options);\n\t}\n\n\tcreateWriteStream(path: string, fileSize: number): Writable {\n\t\tconst ws = new stream.PassThrough();\n\n\t\tthis._client\n\t\t\t.customRequest(path, {\n\t\t\t\tmethod: 'PUT',\n\t\t\t\theaders: {\n\t\t\t\t\t...(fileSize ? { 'Content-Length': String(fileSize) } : {}),\n\t\t\t\t},\n\t\t\t\tdata: ws,\n\t\t\t\tmaxRedirects: 0,\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tws.emit('error', err);\n\t\t\t});\n\n\t\treturn ws;\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/webdav/server/lib/webdavClientAdapter.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/webdav/server/lib/webdavClientAdapter.ts","inputSourceMap":{"version":3,"file":"app/webdav/server/lib/webdavClientAdapter.ts","sourceRoot":"","sources":["app/webdav/server/lib/webdavClientAdapter.ts"],"names":[],"mappings":"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","sourcesContent":["import stream from 'stream';\nimport type { Readable, Writable } from 'stream';\n\nimport type { WebDAVClient, FileStat, ResponseDataDetailed, WebDAVClientOptions } from 'webdav';\nimport { createClient } from 'webdav';\n\nexport class WebdavClientAdapter {\n\t_client: WebDAVClient;\n\n\tconstructor(serverConfig: string, cred: WebDAVClientOptions) {\n\t\tif (cred.token) {\n\t\t\tthis._client = createClient(serverConfig, { token: cred.token });\n\t\t} else {\n\t\t\tthis._client = createClient(serverConfig, {\n\t\t\t\tusername: cred.username,\n\t\t\t\tpassword: cred.password,\n\t\t\t});\n\t\t}\n\t}\n\n\tasync stat(path: string): Promise<FileStat | ResponseDataDetailed<FileStat>> {\n\t\ttry {\n\t\t\treturn await this._client.stat(path);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error checking if directory exists on webdav');\n\t\t}\n\t}\n\n\tasync createDirectory(path: string): Promise<void> {\n\t\ttry {\n\t\t\treturn await this._client.createDirectory(path);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error creating directory on webdav');\n\t\t}\n\t}\n\n\tasync deleteFile(path: string): Promise<void> {\n\t\ttry {\n\t\t\treturn await this._client.deleteFile(path);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error deleting file on webdav');\n\t\t}\n\t}\n\n\tasync getFileContents(filename: string): Promise<Buffer> {\n\t\ttry {\n\t\t\treturn (await this._client.getFileContents(filename)) as Buffer;\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error getting file contents webdav');\n\t\t}\n\t}\n\n\tasync getDirectoryContents(path: string): Promise<FileStat[] | ResponseDataDetailed<FileStat[]>> {\n\t\ttry {\n\t\t\treturn await this._client.getDirectoryContents(path);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error getting directory contents webdav');\n\t\t}\n\t}\n\n\tasync putFileContents(path: string, data: Buffer, options: Record<string, any> = {}): Promise<any> {\n\t\ttry {\n\t\t\treturn await this._client.putFileContents(path, data, options);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ?? 'Error updating file contents.');\n\t\t}\n\t}\n\n\tcreateReadStream(path: string, options?: Record<string, any>): Readable {\n\t\treturn this._client.createReadStream(path, options);\n\t}\n\n\tcreateWriteStream(path: string, fileSize: number): Writable {\n\t\tconst ws = new stream.PassThrough();\n\n\t\tthis._client\n\t\t\t.customRequest(path, {\n\t\t\t\tmethod: 'PUT',\n\t\t\t\theaders: {\n\t\t\t\t\t...(fileSize ? { 'Content-Length': String(fileSize) } : {}),\n\t\t\t\t},\n\t\t\t\tdata: ws,\n\t\t\t\tmaxRedirects: 0,\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tws.emit('error', err);\n\t\t\t});\n\n\t\treturn ws;\n\t}\n}\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let _objectSpread;\n    module.link(\"@babel/runtime/helpers/objectSpread2\", {\n      default(v) {\n        _objectSpread = v;\n      }\n    }, 0);\n    module.export({\n      WebdavClientAdapter: () => WebdavClientAdapter\n    });\n    let stream;\n    module.link(\"stream\", {\n      default(v) {\n        stream = v;\n      }\n    }, 0);\n    let createClient;\n    module.link(\"webdav\", {\n      createClient(v) {\n        createClient = v;\n      }\n    }, 1);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    class WebdavClientAdapter {\n      constructor(serverConfig, cred) {\n        this._client = void 0;\n        if (cred.token) {\n          this._client = createClient(serverConfig, {\n            token: cred.token\n          });\n        } else {\n          this._client = createClient(serverConfig, {\n            username: cred.username,\n            password: cred.password\n          });\n        }\n      }\n      async stat(path) {\n        try {\n          return await this._client.stat(path);\n        } catch (error) {\n          var _error$response;\n          throw new Error((_error$response = error.response) !== null && _error$response !== void 0 && _error$response.statusText ? error.response.statusText : 'Error checking if directory exists on webdav');\n        }\n      }\n      async createDirectory(path) {\n        try {\n          return await this._client.createDirectory(path);\n        } catch (error) {\n          var _error$response2;\n          throw new Error((_error$response2 = error.response) !== null && _error$response2 !== void 0 && _error$response2.statusText ? error.response.statusText : 'Error creating directory on webdav');\n        }\n      }\n      async deleteFile(path) {\n        try {\n          return await this._client.deleteFile(path);\n        } catch (error) {\n          var _error$response3;\n          throw new Error((_error$response3 = error.response) !== null && _error$response3 !== void 0 && _error$response3.statusText ? error.response.statusText : 'Error deleting file on webdav');\n        }\n      }\n      async getFileContents(filename) {\n        try {\n          return await this._client.getFileContents(filename);\n        } catch (error) {\n          var _error$response4;\n          throw new Error((_error$response4 = error.response) !== null && _error$response4 !== void 0 && _error$response4.statusText ? error.response.statusText : 'Error getting file contents webdav');\n        }\n      }\n      async getDirectoryContents(path) {\n        try {\n          return await this._client.getDirectoryContents(path);\n        } catch (error) {\n          var _error$response5;\n          throw new Error((_error$response5 = error.response) !== null && _error$response5 !== void 0 && _error$response5.statusText ? error.response.statusText : 'Error getting directory contents webdav');\n        }\n      }\n      async putFileContents(path, data) {\n        let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n        try {\n          return await this._client.putFileContents(path, data, options);\n        } catch (error) {\n          var _error$response$statu, _error$response6;\n          throw new Error((_error$response$statu = (_error$response6 = error.response) === null || _error$response6 === void 0 ? void 0 : _error$response6.statusText) !== null && _error$response$statu !== void 0 ? _error$response$statu : 'Error updating file contents.');\n        }\n      }\n      createReadStream(path, options) {\n        return this._client.createReadStream(path, options);\n      }\n      createWriteStream(path, fileSize) {\n        const ws = new stream.PassThrough();\n        this._client.customRequest(path, {\n          method: 'PUT',\n          headers: _objectSpread({}, fileSize ? {\n            'Content-Length': String(fileSize)\n          } : {}),\n          data: ws,\n          maxRedirects: 0\n        }).catch(err => {\n          ws.emit('error', err);\n        });\n        return ws;\n      }\n    }\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["_objectSpread","module","link","default","v","export","WebdavClientAdapter","stream","createClient","__reifyWaitForDeps__","constructor","serverConfig","cred","_client","token","username","password","stat","path","error","_error$response","Error","response","statusText","createDirectory","_error$response2","deleteFile","_error$response3","getFileContents","filename","_error$response4","getDirectoryContents","_error$response5","putFileContents","data","options","arguments","length","undefined","_error$response$statu","_error$response6","createReadStream","createWriteStream","fileSize","ws","PassThrough","customRequest","method","headers","String","maxRedirects","catch","err","emit","__reify_async_result__","_reifyError","self","async"],"sources":["app/webdav/server/lib/webdavClientAdapter.ts"],"sourcesContent":["import stream from 'stream';\nimport type { Readable, Writable } from 'stream';\n\nimport type { WebDAVClient, FileStat, ResponseDataDetailed, WebDAVClientOptions } from 'webdav';\nimport { createClient } from 'webdav';\n\nexport class WebdavClientAdapter {\n\t_client: WebDAVClient;\n\n\tconstructor(serverConfig: string, cred: WebDAVClientOptions) {\n\t\tif (cred.token) {\n\t\t\tthis._client = createClient(serverConfig, { token: cred.token });\n\t\t} else {\n\t\t\tthis._client = createClient(serverConfig, {\n\t\t\t\tusername: cred.username,\n\t\t\t\tpassword: cred.password,\n\t\t\t});\n\t\t}\n\t}\n\n\tasync stat(path: string): Promise<FileStat | ResponseDataDetailed<FileStat>> {\n\t\ttry {\n\t\t\treturn await this._client.stat(path);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error checking if directory exists on webdav');\n\t\t}\n\t}\n\n\tasync createDirectory(path: string): Promise<void> {\n\t\ttry {\n\t\t\treturn await this._client.createDirectory(path);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error creating directory on webdav');\n\t\t}\n\t}\n\n\tasync deleteFile(path: string): Promise<void> {\n\t\ttry {\n\t\t\treturn await this._client.deleteFile(path);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error deleting file on webdav');\n\t\t}\n\t}\n\n\tasync getFileContents(filename: string): Promise<Buffer> {\n\t\ttry {\n\t\t\treturn (await this._client.getFileContents(filename)) as Buffer;\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error getting file contents webdav');\n\t\t}\n\t}\n\n\tasync getDirectoryContents(path: string): Promise<FileStat[] | ResponseDataDetailed<FileStat[]>> {\n\t\ttry {\n\t\t\treturn await this._client.getDirectoryContents(path);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ? error.response.statusText : 'Error getting directory contents webdav');\n\t\t}\n\t}\n\n\tasync putFileContents(path: string, data: Buffer, options: Record<string, any> = {}): Promise<any> {\n\t\ttry {\n\t\t\treturn await this._client.putFileContents(path, data, options);\n\t\t} catch (error: any) {\n\t\t\tthrow new Error(error.response?.statusText ?? 'Error updating file contents.');\n\t\t}\n\t}\n\n\tcreateReadStream(path: string, options?: Record<string, any>): Readable {\n\t\treturn this._client.createReadStream(path, options);\n\t}\n\n\tcreateWriteStream(path: string, fileSize: number): Writable {\n\t\tconst ws = new stream.PassThrough();\n\n\t\tthis._client\n\t\t\t.customRequest(path, {\n\t\t\t\tmethod: 'PUT',\n\t\t\t\theaders: {\n\t\t\t\t\t...(fileSize ? { 'Content-Length': String(fileSize) } : {}),\n\t\t\t\t},\n\t\t\t\tdata: ws,\n\t\t\t\tmaxRedirects: 0,\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tws.emit('error', err);\n\t\t\t});\n\n\t\treturn ws;\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"f871c3730acc2273e6563fda5c84d35fc9c256b5"}
