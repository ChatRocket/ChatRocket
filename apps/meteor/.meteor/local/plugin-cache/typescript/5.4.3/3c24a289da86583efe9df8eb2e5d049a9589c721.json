{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/voip/EEVoipClient.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/lib/voip/EEVoipClient.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/voip/EEVoipClient.ts","inputSourceMap":{"version":3,"file":"client/lib/voip/EEVoipClient.ts","sourceRoot":"","sources":["client/lib/voip/EEVoipClient.ts"],"names":[],"mappings":"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","sourcesContent":["import type { ICallerInfo, IMediaStreamRenderer, VoIPUserConfiguration } from '@rocket.chat/core-typings';\nimport { Operation, UserState } from '@rocket.chat/core-typings';\nimport { Inviter, UserAgent } from 'sip.js';\nimport type { IncomingResponse } from 'sip.js/lib/core';\n\nimport { VoIPUser } from './VoIPUser';\n\nexport class EEVoipClient extends VoIPUser {\n\tconstructor(config: VoIPUserConfiguration, mediaRenderer?: IMediaStreamRenderer) {\n\t\tsuper(config, mediaRenderer);\n\t}\n\n\tasync makeCallURI(calleeURI: string, mediaRenderer?: IMediaStreamRenderer): Promise<void> {\n\t\tif (mediaRenderer) {\n\t\t\tthis.mediaStreamRendered = mediaRenderer;\n\t\t}\n\t\tif (this.session) {\n\t\t\tthrow new Error('Session exists');\n\t\t}\n\t\tif (!this.userAgent) {\n\t\t\tthrow new Error('No User Agent.');\n\t\t}\n\t\tif (this.callState !== 'REGISTERED') {\n\t\t\tthrow new Error('Incorrect UA state');\n\t\t}\n\t\tconst target = UserAgent.makeURI(calleeURI);\n\t\tif (!target) {\n\t\t\tthrow new Error(`Failed to create valid URI ${calleeURI}`);\n\t\t}\n\t\t// Replace this when device manager code is ready.\n\t\tconst constraints = {\n\t\t\taudio: true,\n\t\t\tvideo: false,\n\t\t};\n\t\tconst inviterOptions = {\n\t\t\tsessionDescriptionHandlerOptions: { constraints },\n\t\t};\n\t\t// Create a new Inviter for the outgoing Session\n\t\tconst inviter = new Inviter(this.userAgent, target, inviterOptions);\n\t\tthis.session = inviter;\n\t\tthis.setupSessionEventHandlers(inviter);\n\t\tthis._opInProgress = Operation.OP_SEND_INVITE;\n\n\t\tawait inviter.invite({\n\t\t\trequestDelegate: {\n\t\t\t\tonReject: (response: IncomingResponse): void => {\n\t\t\t\t\tif (response.message.reasonPhrase) {\n\t\t\t\t\t\tthis.emit('callfailed', response.message.reasonPhrase || 'unknown');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tthis._callState = 'OFFER_SENT';\n\t\tconst callerInfo: ICallerInfo = {\n\t\t\tcallerId: inviter.remoteIdentity.uri.user ? inviter.remoteIdentity.uri.user : '',\n\t\t\tcallerName: inviter.remoteIdentity.displayName,\n\t\t\thost: inviter.remoteIdentity.uri.host,\n\t\t};\n\t\tthis._callerInfo = callerInfo;\n\t\tthis._userState = UserState.UAC;\n\t\tthis.emit('stateChanged');\n\t}\n\n\tasync makeCall(calleeNumber: string): Promise<void> {\n\t\tconst hasPlusChar = calleeNumber.includes('+');\n\n\t\tconst digits = calleeNumber.replace('+', '');\n\t\tthis.makeCallURI(`sip:${hasPlusChar ? '*' : ''}${digits}@${this.userConfig.sipRegistrarHostnameOrIP}`);\n\t}\n\n\tstatic async create(config: VoIPUserConfiguration, mediaRenderer?: IMediaStreamRenderer): Promise<VoIPUser> {\n\t\tconst voip = new EEVoipClient(config, mediaRenderer);\n\t\tawait voip.init();\n\t\treturn voip;\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/voip/EEVoipClient.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/lib/voip/EEVoipClient.ts","inputSourceMap":{"version":3,"file":"client/lib/voip/EEVoipClient.ts","sourceRoot":"","sources":["client/lib/voip/EEVoipClient.ts"],"names":[],"mappings":"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","sourcesContent":["import type { ICallerInfo, IMediaStreamRenderer, VoIPUserConfiguration } from '@rocket.chat/core-typings';\nimport { Operation, UserState } from '@rocket.chat/core-typings';\nimport { Inviter, UserAgent } from 'sip.js';\nimport type { IncomingResponse } from 'sip.js/lib/core';\n\nimport { VoIPUser } from './VoIPUser';\n\nexport class EEVoipClient extends VoIPUser {\n\tconstructor(config: VoIPUserConfiguration, mediaRenderer?: IMediaStreamRenderer) {\n\t\tsuper(config, mediaRenderer);\n\t}\n\n\tasync makeCallURI(calleeURI: string, mediaRenderer?: IMediaStreamRenderer): Promise<void> {\n\t\tif (mediaRenderer) {\n\t\t\tthis.mediaStreamRendered = mediaRenderer;\n\t\t}\n\t\tif (this.session) {\n\t\t\tthrow new Error('Session exists');\n\t\t}\n\t\tif (!this.userAgent) {\n\t\t\tthrow new Error('No User Agent.');\n\t\t}\n\t\tif (this.callState !== 'REGISTERED') {\n\t\t\tthrow new Error('Incorrect UA state');\n\t\t}\n\t\tconst target = UserAgent.makeURI(calleeURI);\n\t\tif (!target) {\n\t\t\tthrow new Error(`Failed to create valid URI ${calleeURI}`);\n\t\t}\n\t\t// Replace this when device manager code is ready.\n\t\tconst constraints = {\n\t\t\taudio: true,\n\t\t\tvideo: false,\n\t\t};\n\t\tconst inviterOptions = {\n\t\t\tsessionDescriptionHandlerOptions: { constraints },\n\t\t};\n\t\t// Create a new Inviter for the outgoing Session\n\t\tconst inviter = new Inviter(this.userAgent, target, inviterOptions);\n\t\tthis.session = inviter;\n\t\tthis.setupSessionEventHandlers(inviter);\n\t\tthis._opInProgress = Operation.OP_SEND_INVITE;\n\n\t\tawait inviter.invite({\n\t\t\trequestDelegate: {\n\t\t\t\tonReject: (response: IncomingResponse): void => {\n\t\t\t\t\tif (response.message.reasonPhrase) {\n\t\t\t\t\t\tthis.emit('callfailed', response.message.reasonPhrase || 'unknown');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tthis._callState = 'OFFER_SENT';\n\t\tconst callerInfo: ICallerInfo = {\n\t\t\tcallerId: inviter.remoteIdentity.uri.user ? inviter.remoteIdentity.uri.user : '',\n\t\t\tcallerName: inviter.remoteIdentity.displayName,\n\t\t\thost: inviter.remoteIdentity.uri.host,\n\t\t};\n\t\tthis._callerInfo = callerInfo;\n\t\tthis._userState = UserState.UAC;\n\t\tthis.emit('stateChanged');\n\t}\n\n\tasync makeCall(calleeNumber: string): Promise<void> {\n\t\tconst hasPlusChar = calleeNumber.includes('+');\n\n\t\tconst digits = calleeNumber.replace('+', '');\n\t\tthis.makeCallURI(`sip:${hasPlusChar ? '*' : ''}${digits}@${this.userConfig.sipRegistrarHostnameOrIP}`);\n\t}\n\n\tstatic async create(config: VoIPUserConfiguration, mediaRenderer?: IMediaStreamRenderer): Promise<VoIPUser> {\n\t\tconst voip = new EEVoipClient(config, mediaRenderer);\n\t\tawait voip.init();\n\t\treturn voip;\n\t}\n}\n"]}}},"code":"module.export({\n  EEVoipClient: () => EEVoipClient\n});\nlet Operation, UserState;\nmodule.link(\"@rocket.chat/core-typings\", {\n  Operation(v) {\n    Operation = v;\n  },\n  UserState(v) {\n    UserState = v;\n  }\n}, 0);\nlet Inviter, UserAgent;\nmodule.link(\"sip.js\", {\n  Inviter(v) {\n    Inviter = v;\n  },\n  UserAgent(v) {\n    UserAgent = v;\n  }\n}, 1);\nlet VoIPUser;\nmodule.link(\"./VoIPUser\", {\n  VoIPUser(v) {\n    VoIPUser = v;\n  }\n}, 2);\nclass EEVoipClient extends VoIPUser {\n  constructor(config, mediaRenderer) {\n    super(config, mediaRenderer);\n  }\n  async makeCallURI(calleeURI, mediaRenderer) {\n    if (mediaRenderer) {\n      this.mediaStreamRendered = mediaRenderer;\n    }\n    if (this.session) {\n      throw new Error('Session exists');\n    }\n    if (!this.userAgent) {\n      throw new Error('No User Agent.');\n    }\n    if (this.callState !== 'REGISTERED') {\n      throw new Error('Incorrect UA state');\n    }\n    const target = UserAgent.makeURI(calleeURI);\n    if (!target) {\n      throw new Error(\"Failed to create valid URI \".concat(calleeURI));\n    }\n    // Replace this when device manager code is ready.\n    const constraints = {\n      audio: true,\n      video: false\n    };\n    const inviterOptions = {\n      sessionDescriptionHandlerOptions: {\n        constraints\n      }\n    };\n    // Create a new Inviter for the outgoing Session\n    const inviter = new Inviter(this.userAgent, target, inviterOptions);\n    this.session = inviter;\n    this.setupSessionEventHandlers(inviter);\n    this._opInProgress = Operation.OP_SEND_INVITE;\n    await inviter.invite({\n      requestDelegate: {\n        onReject: response => {\n          if (response.message.reasonPhrase) {\n            this.emit('callfailed', response.message.reasonPhrase || 'unknown');\n          }\n        }\n      }\n    });\n    this._callState = 'OFFER_SENT';\n    const callerInfo = {\n      callerId: inviter.remoteIdentity.uri.user ? inviter.remoteIdentity.uri.user : '',\n      callerName: inviter.remoteIdentity.displayName,\n      host: inviter.remoteIdentity.uri.host\n    };\n    this._callerInfo = callerInfo;\n    this._userState = UserState.UAC;\n    this.emit('stateChanged');\n  }\n  async makeCall(calleeNumber) {\n    const hasPlusChar = calleeNumber.includes('+');\n    const digits = calleeNumber.replace('+', '');\n    this.makeCallURI(\"sip:\".concat(hasPlusChar ? '*' : '').concat(digits, \"@\").concat(this.userConfig.sipRegistrarHostnameOrIP));\n  }\n  static async create(config, mediaRenderer) {\n    const voip = new EEVoipClient(config, mediaRenderer);\n    await voip.init();\n    return voip;\n  }\n}","map":{"version":3,"names":["module","export","EEVoipClient","Operation","UserState","link","v","Inviter","UserAgent","VoIPUser","constructor","config","mediaRenderer","makeCallURI","calleeURI","mediaStreamRendered","session","Error","userAgent","callState","target","makeURI","concat","constraints","audio","video","inviterOptions","sessionDescriptionHandlerOptions","inviter","setupSessionEventHandlers","_opInProgress","OP_SEND_INVITE","invite","requestDelegate","onReject","response","message","reasonPhrase","emit","_callState","callerInfo","callerId","remoteIdentity","uri","user","callerName","displayName","host","_callerInfo","_userState","UAC","makeCall","calleeNumber","hasPlusChar","includes","digits","replace","userConfig","sipRegistrarHostnameOrIP","create","voip","init"],"sources":["client/lib/voip/EEVoipClient.ts"],"sourcesContent":["import type { ICallerInfo, IMediaStreamRenderer, VoIPUserConfiguration } from '@rocket.chat/core-typings';\nimport { Operation, UserState } from '@rocket.chat/core-typings';\nimport { Inviter, UserAgent } from 'sip.js';\nimport type { IncomingResponse } from 'sip.js/lib/core';\n\nimport { VoIPUser } from './VoIPUser';\n\nexport class EEVoipClient extends VoIPUser {\n\tconstructor(config: VoIPUserConfiguration, mediaRenderer?: IMediaStreamRenderer) {\n\t\tsuper(config, mediaRenderer);\n\t}\n\n\tasync makeCallURI(calleeURI: string, mediaRenderer?: IMediaStreamRenderer): Promise<void> {\n\t\tif (mediaRenderer) {\n\t\t\tthis.mediaStreamRendered = mediaRenderer;\n\t\t}\n\t\tif (this.session) {\n\t\t\tthrow new Error('Session exists');\n\t\t}\n\t\tif (!this.userAgent) {\n\t\t\tthrow new Error('No User Agent.');\n\t\t}\n\t\tif (this.callState !== 'REGISTERED') {\n\t\t\tthrow new Error('Incorrect UA state');\n\t\t}\n\t\tconst target = UserAgent.makeURI(calleeURI);\n\t\tif (!target) {\n\t\t\tthrow new Error(`Failed to create valid URI ${calleeURI}`);\n\t\t}\n\t\t// Replace this when device manager code is ready.\n\t\tconst constraints = {\n\t\t\taudio: true,\n\t\t\tvideo: false,\n\t\t};\n\t\tconst inviterOptions = {\n\t\t\tsessionDescriptionHandlerOptions: { constraints },\n\t\t};\n\t\t// Create a new Inviter for the outgoing Session\n\t\tconst inviter = new Inviter(this.userAgent, target, inviterOptions);\n\t\tthis.session = inviter;\n\t\tthis.setupSessionEventHandlers(inviter);\n\t\tthis._opInProgress = Operation.OP_SEND_INVITE;\n\n\t\tawait inviter.invite({\n\t\t\trequestDelegate: {\n\t\t\t\tonReject: (response: IncomingResponse): void => {\n\t\t\t\t\tif (response.message.reasonPhrase) {\n\t\t\t\t\t\tthis.emit('callfailed', response.message.reasonPhrase || 'unknown');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tthis._callState = 'OFFER_SENT';\n\t\tconst callerInfo: ICallerInfo = {\n\t\t\tcallerId: inviter.remoteIdentity.uri.user ? inviter.remoteIdentity.uri.user : '',\n\t\t\tcallerName: inviter.remoteIdentity.displayName,\n\t\t\thost: inviter.remoteIdentity.uri.host,\n\t\t};\n\t\tthis._callerInfo = callerInfo;\n\t\tthis._userState = UserState.UAC;\n\t\tthis.emit('stateChanged');\n\t}\n\n\tasync makeCall(calleeNumber: string): Promise<void> {\n\t\tconst hasPlusChar = calleeNumber.includes('+');\n\n\t\tconst digits = calleeNumber.replace('+', '');\n\t\tthis.makeCallURI(`sip:${hasPlusChar ? '*' : ''}${digits}@${this.userConfig.sipRegistrarHostnameOrIP}`);\n\t}\n\n\tstatic async create(config: VoIPUserConfiguration, mediaRenderer?: IMediaStreamRenderer): Promise<VoIPUser> {\n\t\tconst voip = new EEVoipClient(config, mediaRenderer);\n\t\tawait voip.init();\n\t\treturn voip;\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"3c24a289da86583efe9df8eb2e5d049a9589c721"}
