{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/rooms/coordinator.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"lib/rooms/coordinator.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/rooms/coordinator.ts","inputSourceMap":{"version":3,"file":"lib/rooms/coordinator.ts","sourceRoot":"","sources":["lib/rooms/coordinator.ts"],"names":[],"mappings":"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","sourcesContent":["import type { RoomType } from '@rocket.chat/core-typings';\nimport type { LocationPathname } from '@rocket.chat/ui-contexts';\n\nimport type {\n\tIRoomTypeConfig,\n\tIRoomTypeClientDirectives,\n\tIRoomTypeServerDirectives,\n\tRoomIdentification,\n} from '../../definition/IRoomTypeConfig';\n\nexport abstract class RoomCoordinator {\n\tprotected roomTypes: Record<string, { config: IRoomTypeConfig; directives: IRoomTypeClientDirectives | IRoomTypeServerDirectives }> = {};\n\n\tprotected validateRoomConfig(roomConfig: IRoomTypeConfig): void {\n\t\tconst { identifier } = roomConfig;\n\n\t\tif (typeof identifier !== 'string' || identifier.length === 0) {\n\t\t\tthrow new Error('The identifier must be a string.');\n\t\t}\n\t}\n\n\tprotected addRoomType(roomConfig: IRoomTypeConfig, directives: IRoomTypeClientDirectives | IRoomTypeServerDirectives): void {\n\t\tthis.validateRoomConfig(roomConfig);\n\n\t\tif (this.roomTypes[roomConfig.identifier]) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.roomTypes[roomConfig.identifier] = { config: roomConfig, directives };\n\t}\n\n\tprotected getRoomTypeConfig(identifier: RoomType): IRoomTypeConfig & Pick<Required<IRoomTypeConfig>, 'route'>;\n\n\tprotected getRoomTypeConfig(identifier: string): IRoomTypeConfig | undefined;\n\n\tprotected getRoomTypeConfig(identifier: string): IRoomTypeConfig | undefined {\n\t\tif (!this.roomTypes[identifier]) {\n\t\t\tthrow new Error(`Room type with identifier ${identifier} does not exist.`);\n\t\t}\n\n\t\treturn this.roomTypes[identifier].config;\n\t}\n\n\tpublic getRouteLink(roomType: string, subData: RoomIdentification): LocationPathname | false {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst routeData = this.getRouteData(roomType, subData);\n\t\tif (!routeData) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!config.route.path) {\n\t\t\tconsole.warn(`The route for the room type ${roomType} does not have a path`);\n\t\t\treturn false;\n\t\t}\n\n\t\tconst pathDef = config.route.path;\n\t\tconst fields = routeData;\n\n\t\tconst regExp = /(:[\\w\\(\\)\\\\\\+\\*\\.\\?]+)+/g;\n\t\tlet path = pathDef.replace(regExp, (key) => {\n\t\t\tconst firstRegexpChar = key.indexOf('(');\n\t\t\t// get the content behind : and (\\\\d+/)\n\t\t\tkey = key.substring(1, firstRegexpChar > 0 ? firstRegexpChar : undefined);\n\t\t\t// remove +?*\n\t\t\tkey = key.replace(/[\\+\\*\\?]+/g, '');\n\n\t\t\treturn fields[key] || '';\n\t\t});\n\n\t\tpath = path.replace(/\\/\\/+/g, '/'); // Replace multiple slashes with single slash\n\n\t\t// remove trailing slash\n\t\t// but keep the root slash if it's the only one\n\t\tpath = path.match(/^\\/{1}$/) ? path : path.replace(/\\/$/, '');\n\n\t\treturn path as LocationPathname;\n\t}\n\n\tprotected getRouteData(roomType: string, subData: RoomIdentification): Record<string, string> | false {\n\t\tif (!subData.rid && (subData as Record<string, string>)._id) {\n\t\t\tconsole.warn('Deprecated: RoomCoordinator.getRouteData received a room object');\n\t\t\tsubData.rid = (subData as Record<string, string>)._id;\n\t\t}\n\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet routeData = {};\n\t\tif (config.route?.link) {\n\t\t\trouteData = config.route.link(subData);\n\t\t} else if (subData?.name) {\n\t\t\trouteData = {\n\t\t\t\trid: subData.rid,\n\t\t\t\tname: subData.name,\n\t\t\t};\n\t\t}\n\n\t\treturn routeData;\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/lib/rooms/coordinator.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"lib/rooms/coordinator.ts","inputSourceMap":{"version":3,"file":"lib/rooms/coordinator.ts","sourceRoot":"","sources":["lib/rooms/coordinator.ts"],"names":[],"mappings":"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","sourcesContent":["import type { RoomType } from '@rocket.chat/core-typings';\nimport type { LocationPathname } from '@rocket.chat/ui-contexts';\n\nimport type {\n\tIRoomTypeConfig,\n\tIRoomTypeClientDirectives,\n\tIRoomTypeServerDirectives,\n\tRoomIdentification,\n} from '../../definition/IRoomTypeConfig';\n\nexport abstract class RoomCoordinator {\n\tprotected roomTypes: Record<string, { config: IRoomTypeConfig; directives: IRoomTypeClientDirectives | IRoomTypeServerDirectives }> = {};\n\n\tprotected validateRoomConfig(roomConfig: IRoomTypeConfig): void {\n\t\tconst { identifier } = roomConfig;\n\n\t\tif (typeof identifier !== 'string' || identifier.length === 0) {\n\t\t\tthrow new Error('The identifier must be a string.');\n\t\t}\n\t}\n\n\tprotected addRoomType(roomConfig: IRoomTypeConfig, directives: IRoomTypeClientDirectives | IRoomTypeServerDirectives): void {\n\t\tthis.validateRoomConfig(roomConfig);\n\n\t\tif (this.roomTypes[roomConfig.identifier]) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.roomTypes[roomConfig.identifier] = { config: roomConfig, directives };\n\t}\n\n\tprotected getRoomTypeConfig(identifier: RoomType): IRoomTypeConfig & Pick<Required<IRoomTypeConfig>, 'route'>;\n\n\tprotected getRoomTypeConfig(identifier: string): IRoomTypeConfig | undefined;\n\n\tprotected getRoomTypeConfig(identifier: string): IRoomTypeConfig | undefined {\n\t\tif (!this.roomTypes[identifier]) {\n\t\t\tthrow new Error(`Room type with identifier ${identifier} does not exist.`);\n\t\t}\n\n\t\treturn this.roomTypes[identifier].config;\n\t}\n\n\tpublic getRouteLink(roomType: string, subData: RoomIdentification): LocationPathname | false {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst routeData = this.getRouteData(roomType, subData);\n\t\tif (!routeData) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!config.route.path) {\n\t\t\tconsole.warn(`The route for the room type ${roomType} does not have a path`);\n\t\t\treturn false;\n\t\t}\n\n\t\tconst pathDef = config.route.path;\n\t\tconst fields = routeData;\n\n\t\tconst regExp = /(:[\\w\\(\\)\\\\\\+\\*\\.\\?]+)+/g;\n\t\tlet path = pathDef.replace(regExp, (key) => {\n\t\t\tconst firstRegexpChar = key.indexOf('(');\n\t\t\t// get the content behind : and (\\\\d+/)\n\t\t\tkey = key.substring(1, firstRegexpChar > 0 ? firstRegexpChar : undefined);\n\t\t\t// remove +?*\n\t\t\tkey = key.replace(/[\\+\\*\\?]+/g, '');\n\n\t\t\treturn fields[key] || '';\n\t\t});\n\n\t\tpath = path.replace(/\\/\\/+/g, '/'); // Replace multiple slashes with single slash\n\n\t\t// remove trailing slash\n\t\t// but keep the root slash if it's the only one\n\t\tpath = path.match(/^\\/{1}$/) ? path : path.replace(/\\/$/, '');\n\n\t\treturn path as LocationPathname;\n\t}\n\n\tprotected getRouteData(roomType: string, subData: RoomIdentification): Record<string, string> | false {\n\t\tif (!subData.rid && (subData as Record<string, string>)._id) {\n\t\t\tconsole.warn('Deprecated: RoomCoordinator.getRouteData received a room object');\n\t\t\tsubData.rid = (subData as Record<string, string>)._id;\n\t\t}\n\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet routeData = {};\n\t\tif (config.route?.link) {\n\t\t\trouteData = config.route.link(subData);\n\t\t} else if (subData?.name) {\n\t\t\trouteData = {\n\t\t\t\trid: subData.rid,\n\t\t\t\tname: subData.name,\n\t\t\t};\n\t\t}\n\n\t\treturn routeData;\n\t}\n}\n"]}}},"code":"module.export({\n  RoomCoordinator: function () {\n    return RoomCoordinator;\n  }\n});\nvar RoomCoordinator = /*#__PURE__*/function () {\n  function RoomCoordinator() {\n    this.roomTypes = {};\n  }\n  var _proto = RoomCoordinator.prototype;\n  _proto.validateRoomConfig = function () {\n    function validateRoomConfig(roomConfig) {\n      var identifier = roomConfig.identifier;\n      if (typeof identifier !== 'string' || identifier.length === 0) {\n        throw new Error('The identifier must be a string.');\n      }\n    }\n    return validateRoomConfig;\n  }();\n  _proto.addRoomType = function () {\n    function addRoomType(roomConfig, directives) {\n      this.validateRoomConfig(roomConfig);\n      if (this.roomTypes[roomConfig.identifier]) {\n        return;\n      }\n      this.roomTypes[roomConfig.identifier] = {\n        config: roomConfig,\n        directives: directives\n      };\n    }\n    return addRoomType;\n  }();\n  _proto.getRoomTypeConfig = function () {\n    function getRoomTypeConfig(identifier) {\n      if (!this.roomTypes[identifier]) {\n        throw new Error(\"Room type with identifier \" + identifier + \" does not exist.\");\n      }\n      return this.roomTypes[identifier].config;\n    }\n    return getRoomTypeConfig;\n  }();\n  _proto.getRouteLink = function () {\n    function getRouteLink(roomType, subData) {\n      var config = this.getRoomTypeConfig(roomType);\n      if (!(config !== null && config !== void 0 && config.route)) {\n        return false;\n      }\n      var routeData = this.getRouteData(roomType, subData);\n      if (!routeData) {\n        return false;\n      }\n      if (!config.route.path) {\n        console.warn(\"The route for the room type \" + roomType + \" does not have a path\");\n        return false;\n      }\n      var pathDef = config.route.path;\n      var fields = routeData;\n      var regExp = /(:[\\w\\(\\)\\\\\\+\\*\\.\\?]+)+/g;\n      var path = pathDef.replace(regExp, function (key) {\n        var firstRegexpChar = key.indexOf('(');\n        // get the content behind : and (\\\\d+/)\n        key = key.substring(1, firstRegexpChar > 0 ? firstRegexpChar : undefined);\n        // remove +?*\n        key = key.replace(/[\\+\\*\\?]+/g, '');\n        return fields[key] || '';\n      });\n      path = path.replace(/\\/\\/+/g, '/'); // Replace multiple slashes with single slash\n      // remove trailing slash\n      // but keep the root slash if it's the only one\n      path = path.match(/^\\/{1}$/) ? path : path.replace(/\\/$/, '');\n      return path;\n    }\n    return getRouteLink;\n  }();\n  _proto.getRouteData = function () {\n    function getRouteData(roomType, subData) {\n      var _config$route;\n      if (!subData.rid && subData._id) {\n        console.warn('Deprecated: RoomCoordinator.getRouteData received a room object');\n        subData.rid = subData._id;\n      }\n      var config = this.getRoomTypeConfig(roomType);\n      if (!config) {\n        return false;\n      }\n      var routeData = {};\n      if ((_config$route = config.route) !== null && _config$route !== void 0 && _config$route.link) {\n        routeData = config.route.link(subData);\n      } else if (subData !== null && subData !== void 0 && subData.name) {\n        routeData = {\n          rid: subData.rid,\n          name: subData.name\n        };\n      }\n      return routeData;\n    }\n    return getRouteData;\n  }();\n  return RoomCoordinator;\n}();","map":{"version":3,"names":["module","export","RoomCoordinator","roomTypes","_proto","prototype","validateRoomConfig","roomConfig","identifier","length","Error","addRoomType","directives","config","getRoomTypeConfig","getRouteLink","roomType","subData","route","routeData","getRouteData","path","console","warn","pathDef","fields","regExp","replace","key","firstRegexpChar","indexOf","substring","undefined","match","_config$route","rid","_id","link","name"],"sources":["lib/rooms/coordinator.ts"],"sourcesContent":["import type { RoomType } from '@rocket.chat/core-typings';\nimport type { LocationPathname } from '@rocket.chat/ui-contexts';\n\nimport type {\n\tIRoomTypeConfig,\n\tIRoomTypeClientDirectives,\n\tIRoomTypeServerDirectives,\n\tRoomIdentification,\n} from '../../definition/IRoomTypeConfig';\n\nexport abstract class RoomCoordinator {\n\tprotected roomTypes: Record<string, { config: IRoomTypeConfig; directives: IRoomTypeClientDirectives | IRoomTypeServerDirectives }> = {};\n\n\tprotected validateRoomConfig(roomConfig: IRoomTypeConfig): void {\n\t\tconst { identifier } = roomConfig;\n\n\t\tif (typeof identifier !== 'string' || identifier.length === 0) {\n\t\t\tthrow new Error('The identifier must be a string.');\n\t\t}\n\t}\n\n\tprotected addRoomType(roomConfig: IRoomTypeConfig, directives: IRoomTypeClientDirectives | IRoomTypeServerDirectives): void {\n\t\tthis.validateRoomConfig(roomConfig);\n\n\t\tif (this.roomTypes[roomConfig.identifier]) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.roomTypes[roomConfig.identifier] = { config: roomConfig, directives };\n\t}\n\n\tprotected getRoomTypeConfig(identifier: RoomType): IRoomTypeConfig & Pick<Required<IRoomTypeConfig>, 'route'>;\n\n\tprotected getRoomTypeConfig(identifier: string): IRoomTypeConfig | undefined;\n\n\tprotected getRoomTypeConfig(identifier: string): IRoomTypeConfig | undefined {\n\t\tif (!this.roomTypes[identifier]) {\n\t\t\tthrow new Error(`Room type with identifier ${identifier} does not exist.`);\n\t\t}\n\n\t\treturn this.roomTypes[identifier].config;\n\t}\n\n\tpublic getRouteLink(roomType: string, subData: RoomIdentification): LocationPathname | false {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst routeData = this.getRouteData(roomType, subData);\n\t\tif (!routeData) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!config.route.path) {\n\t\t\tconsole.warn(`The route for the room type ${roomType} does not have a path`);\n\t\t\treturn false;\n\t\t}\n\n\t\tconst pathDef = config.route.path;\n\t\tconst fields = routeData;\n\n\t\tconst regExp = /(:[\\w\\(\\)\\\\\\+\\*\\.\\?]+)+/g;\n\t\tlet path = pathDef.replace(regExp, (key) => {\n\t\t\tconst firstRegexpChar = key.indexOf('(');\n\t\t\t// get the content behind : and (\\\\d+/)\n\t\t\tkey = key.substring(1, firstRegexpChar > 0 ? firstRegexpChar : undefined);\n\t\t\t// remove +?*\n\t\t\tkey = key.replace(/[\\+\\*\\?]+/g, '');\n\n\t\t\treturn fields[key] || '';\n\t\t});\n\n\t\tpath = path.replace(/\\/\\/+/g, '/'); // Replace multiple slashes with single slash\n\n\t\t// remove trailing slash\n\t\t// but keep the root slash if it's the only one\n\t\tpath = path.match(/^\\/{1}$/) ? path : path.replace(/\\/$/, '');\n\n\t\treturn path as LocationPathname;\n\t}\n\n\tprotected getRouteData(roomType: string, subData: RoomIdentification): Record<string, string> | false {\n\t\tif (!subData.rid && (subData as Record<string, string>)._id) {\n\t\t\tconsole.warn('Deprecated: RoomCoordinator.getRouteData received a room object');\n\t\t\tsubData.rid = (subData as Record<string, string>)._id;\n\t\t}\n\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet routeData = {};\n\t\tif (config.route?.link) {\n\t\t\trouteData = config.route.link(subData);\n\t\t} else if (subData?.name) {\n\t\t\trouteData = {\n\t\t\t\trid: subData.rid,\n\t\t\t\tname: subData.name,\n\t\t\t};\n\t\t}\n\n\t\treturn routeData;\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"c72a1fd4ab5301923f9ea8391cc157f6fc7be647"}
