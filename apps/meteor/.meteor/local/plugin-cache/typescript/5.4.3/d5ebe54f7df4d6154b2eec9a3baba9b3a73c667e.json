{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/recorderjs/AudioRecorder.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui/client/lib/recorderjs/AudioRecorder.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/recorderjs/AudioRecorder.ts","inputSourceMap":{"version":3,"file":"app/ui/client/lib/recorderjs/AudioRecorder.ts","sourceRoot":"","sources":["app/ui/client/lib/recorderjs/AudioRecorder.ts"],"names":[],"mappings":"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","sourcesContent":["import { settings } from '../../../../settings/client';\nimport { AudioEncoder } from './AudioEncoder';\n\nexport class AudioRecorder {\n\tprivate audioContext: AudioContext | undefined;\n\n\tprivate stream: MediaStream | undefined;\n\n\tprivate encoder: AudioEncoder | undefined;\n\n\tisSupported() {\n\t\treturn Boolean(navigator.mediaDevices?.getUserMedia) && Boolean(AudioContext);\n\t}\n\n\tcreateAudioContext() {\n\t\tif (this.audioContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.audioContext = new AudioContext();\n\t}\n\n\tdestroyAudioContext() {\n\t\tif (!this.audioContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.audioContext.close();\n\t\tdelete this.audioContext;\n\t}\n\n\tasync createStream() {\n\t\tif (this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\t}\n\n\tdestroyStream() {\n\t\tif (!this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stream.getAudioTracks().forEach((track) => track.stop());\n\t\tdelete this.stream;\n\t}\n\n\tasync createEncoder() {\n\t\tif (this.encoder || !this.audioContext || !this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst input = this.audioContext?.createMediaStreamSource(this.stream);\n\t\tthis.encoder = new AudioEncoder(input, { bitRate: settings.get('Message_Audio_bitRate') || 32 });\n\t}\n\n\tdestroyEncoder() {\n\t\tif (!this.encoder) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.encoder.close();\n\t\tdelete this.encoder;\n\t}\n\n\tasync start(cb?: (this: this, done: boolean) => void) {\n\t\ttry {\n\t\t\tthis.createAudioContext();\n\t\t\tawait this.createStream();\n\t\t\tawait this.createEncoder();\n\t\t\tcb?.call(this, true);\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t\tthis.destroyEncoder();\n\t\t\tthis.destroyStream();\n\t\t\tthis.destroyAudioContext();\n\t\t\tcb?.call(this, false);\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tstop(cb: (data: Blob) => void) {\n\t\tthis.encoder?.on('encoded', cb);\n\t\tthis.encoder?.close();\n\n\t\tthis.destroyEncoder();\n\t\tthis.destroyStream();\n\t\tthis.destroyAudioContext();\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/recorderjs/AudioRecorder.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui/client/lib/recorderjs/AudioRecorder.ts","inputSourceMap":{"version":3,"file":"app/ui/client/lib/recorderjs/AudioRecorder.ts","sourceRoot":"","sources":["app/ui/client/lib/recorderjs/AudioRecorder.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,6BAA6B,CAAC;AACvD,OAAO,EAAE,YAAY,EAAE,MAAM,gBAAgB,CAAC;AAE9C,MAAM,OAAO,aAAa;IACjB,YAAY,CAA2B;IAEvC,MAAM,CAA0B;IAEhC,OAAO,CAA2B;IAE1C,WAAW;QACV,OAAO,OAAO,CAAC,SAAS,CAAC,YAAY,EAAE,YAAY,CAAC,IAAI,OAAO,CAAC,YAAY,CAAC,CAAC;IAC/E,CAAC;IAED,kBAAkB;QACjB,IAAI,IAAI,CAAC,YAAY,EAAE,CAAC;YACvB,OAAO;QACR,CAAC;QAED,IAAI,CAAC,YAAY,GAAG,IAAI,YAAY,EAAE,CAAC;IACxC,CAAC;IAED,mBAAmB;QAClB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC;YACxB,OAAO;QACR,CAAC;QAED,KAAK,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC;QAC/B,OAAO,IAAI,CAAC,YAAY,CAAC;IAC1B,CAAC;IAED,KAAK,CAAC,YAAY;QACjB,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;YACjB,OAAO;QACR,CAAC;QAED,IAAI,CAAC,MAAM,GAAG,MAAM,SAAS,CAAC,YAAY,CAAC,YAAY,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;IAC1E,CAAC;IAED,aAAa;QACZ,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;YAClB,OAAO;QACR,CAAC;QAED,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC;QAC9D,OAAO,IAAI,CAAC,MAAM,CAAC;IACpB,CAAC;IAED,KAAK,CAAC,aAAa;QAClB,IAAI,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;YACxD,OAAO;QACR,CAAC;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,YAAY,EAAE,uBAAuB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACtE,IAAI,CAAC,OAAO,GAAG,IAAI,YAAY,CAAC,KAAK,EAAE,EAAE,OAAO,EAAE,QAAQ,CAAC,GAAG,CAAC,uBAAuB,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;IAClG,CAAC;IAED,cAAc;QACb,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;YACnB,OAAO;QACR,CAAC;QAED,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;QACrB,OAAO,IAAI,CAAC,OAAO,CAAC;IACrB,CAAC;IAED,KAAK,CAAC,KAAK,CAAC,EAAwC;QACnD,IAAI,CAAC;YACJ,IAAI,CAAC,kBAAkB,EAAE,CAAC;YAC1B,MAAM,IAAI,CAAC,YAAY,EAAE,CAAC;YAC1B,MAAM,IAAI,CAAC,aAAa,EAAE,CAAC;YAC3B,EAAE,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QACtB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YAChB,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YACrB,IAAI,CAAC,cAAc,EAAE,CAAC;YACtB,IAAI,CAAC,aAAa,EAAE,CAAC;YACrB,IAAI,CAAC,mBAAmB,EAAE,CAAC;YAC3B,EAAE,EAAE,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;YACtB,MAAM,KAAK,CAAC;QACb,CAAC;IACF,CAAC;IAED,IAAI,CAAC,EAAwB;QAC5B,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QAChC,IAAI,CAAC,OAAO,EAAE,KAAK,EAAE,CAAC;QAEtB,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC5B,CAAC;CACD","sourcesContent":["import { settings } from '../../../../settings/client';\nimport { AudioEncoder } from './AudioEncoder';\n\nexport class AudioRecorder {\n\tprivate audioContext: AudioContext | undefined;\n\n\tprivate stream: MediaStream | undefined;\n\n\tprivate encoder: AudioEncoder | undefined;\n\n\tisSupported() {\n\t\treturn Boolean(navigator.mediaDevices?.getUserMedia) && Boolean(AudioContext);\n\t}\n\n\tcreateAudioContext() {\n\t\tif (this.audioContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.audioContext = new AudioContext();\n\t}\n\n\tdestroyAudioContext() {\n\t\tif (!this.audioContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.audioContext.close();\n\t\tdelete this.audioContext;\n\t}\n\n\tasync createStream() {\n\t\tif (this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\t}\n\n\tdestroyStream() {\n\t\tif (!this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stream.getAudioTracks().forEach((track) => track.stop());\n\t\tdelete this.stream;\n\t}\n\n\tasync createEncoder() {\n\t\tif (this.encoder || !this.audioContext || !this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst input = this.audioContext?.createMediaStreamSource(this.stream);\n\t\tthis.encoder = new AudioEncoder(input, { bitRate: settings.get('Message_Audio_bitRate') || 32 });\n\t}\n\n\tdestroyEncoder() {\n\t\tif (!this.encoder) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.encoder.close();\n\t\tdelete this.encoder;\n\t}\n\n\tasync start(cb?: (this: this, done: boolean) => void) {\n\t\ttry {\n\t\t\tthis.createAudioContext();\n\t\t\tawait this.createStream();\n\t\t\tawait this.createEncoder();\n\t\t\tcb?.call(this, true);\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t\tthis.destroyEncoder();\n\t\t\tthis.destroyStream();\n\t\t\tthis.destroyAudioContext();\n\t\t\tcb?.call(this, false);\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tstop(cb: (data: Blob) => void) {\n\t\tthis.encoder?.on('encoded', cb);\n\t\tthis.encoder?.close();\n\n\t\tthis.destroyEncoder();\n\t\tthis.destroyStream();\n\t\tthis.destroyAudioContext();\n\t}\n}\n"]}}},"code":"module.export({\n  AudioRecorder: () => AudioRecorder\n});\nlet settings;\nmodule.link(\"../../../../settings/client\", {\n  settings(v) {\n    settings = v;\n  }\n}, 0);\nlet AudioEncoder;\nmodule.link(\"./AudioEncoder\", {\n  AudioEncoder(v) {\n    AudioEncoder = v;\n  }\n}, 1);\nclass AudioRecorder {\n  constructor() {\n    this.audioContext = void 0;\n    this.stream = void 0;\n    this.encoder = void 0;\n  }\n  isSupported() {\n    var _navigator$mediaDevic;\n    return Boolean((_navigator$mediaDevic = navigator.mediaDevices) === null || _navigator$mediaDevic === void 0 ? void 0 : _navigator$mediaDevic.getUserMedia) && Boolean(AudioContext);\n  }\n  createAudioContext() {\n    if (this.audioContext) {\n      return;\n    }\n    this.audioContext = new AudioContext();\n  }\n  destroyAudioContext() {\n    if (!this.audioContext) {\n      return;\n    }\n    void this.audioContext.close();\n    delete this.audioContext;\n  }\n  async createStream() {\n    if (this.stream) {\n      return;\n    }\n    this.stream = await navigator.mediaDevices.getUserMedia({\n      audio: true\n    });\n  }\n  destroyStream() {\n    if (!this.stream) {\n      return;\n    }\n    this.stream.getAudioTracks().forEach(track => track.stop());\n    delete this.stream;\n  }\n  async createEncoder() {\n    var _this$audioContext;\n    if (this.encoder || !this.audioContext || !this.stream) {\n      return;\n    }\n    const input = (_this$audioContext = this.audioContext) === null || _this$audioContext === void 0 ? void 0 : _this$audioContext.createMediaStreamSource(this.stream);\n    this.encoder = new AudioEncoder(input, {\n      bitRate: settings.get('Message_Audio_bitRate') || 32\n    });\n  }\n  destroyEncoder() {\n    if (!this.encoder) {\n      return;\n    }\n    this.encoder.close();\n    delete this.encoder;\n  }\n  async start(cb) {\n    try {\n      this.createAudioContext();\n      await this.createStream();\n      await this.createEncoder();\n      cb === null || cb === void 0 ? void 0 : cb.call(this, true);\n    } catch (error) {\n      console.error(error);\n      this.destroyEncoder();\n      this.destroyStream();\n      this.destroyAudioContext();\n      cb === null || cb === void 0 ? void 0 : cb.call(this, false);\n      throw error;\n    }\n  }\n  stop(cb) {\n    var _this$encoder, _this$encoder2;\n    (_this$encoder = this.encoder) === null || _this$encoder === void 0 ? void 0 : _this$encoder.on('encoded', cb);\n    (_this$encoder2 = this.encoder) === null || _this$encoder2 === void 0 ? void 0 : _this$encoder2.close();\n    this.destroyEncoder();\n    this.destroyStream();\n    this.destroyAudioContext();\n  }\n}","map":{"version":3,"names":["module","export","AudioRecorder","settings","link","v","AudioEncoder","constructor","audioContext","stream","encoder","isSupported","_navigator$mediaDevic","Boolean","navigator","mediaDevices","getUserMedia","AudioContext","createAudioContext","destroyAudioContext","close","createStream","audio","destroyStream","getAudioTracks","forEach","track","stop","createEncoder","_this$audioContext","input","createMediaStreamSource","bitRate","get","destroyEncoder","start","cb","call","error","console","_this$encoder","_this$encoder2","on"],"sources":["app/ui/client/lib/recorderjs/AudioRecorder.ts"],"sourcesContent":["import { settings } from '../../../../settings/client';\nimport { AudioEncoder } from './AudioEncoder';\n\nexport class AudioRecorder {\n\tprivate audioContext: AudioContext | undefined;\n\n\tprivate stream: MediaStream | undefined;\n\n\tprivate encoder: AudioEncoder | undefined;\n\n\tisSupported() {\n\t\treturn Boolean(navigator.mediaDevices?.getUserMedia) && Boolean(AudioContext);\n\t}\n\n\tcreateAudioContext() {\n\t\tif (this.audioContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.audioContext = new AudioContext();\n\t}\n\n\tdestroyAudioContext() {\n\t\tif (!this.audioContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.audioContext.close();\n\t\tdelete this.audioContext;\n\t}\n\n\tasync createStream() {\n\t\tif (this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\t}\n\n\tdestroyStream() {\n\t\tif (!this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stream.getAudioTracks().forEach((track) => track.stop());\n\t\tdelete this.stream;\n\t}\n\n\tasync createEncoder() {\n\t\tif (this.encoder || !this.audioContext || !this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst input = this.audioContext?.createMediaStreamSource(this.stream);\n\t\tthis.encoder = new AudioEncoder(input, { bitRate: settings.get('Message_Audio_bitRate') || 32 });\n\t}\n\n\tdestroyEncoder() {\n\t\tif (!this.encoder) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.encoder.close();\n\t\tdelete this.encoder;\n\t}\n\n\tasync start(cb?: (this: this, done: boolean) => void) {\n\t\ttry {\n\t\t\tthis.createAudioContext();\n\t\t\tawait this.createStream();\n\t\t\tawait this.createEncoder();\n\t\t\tcb?.call(this, true);\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t\tthis.destroyEncoder();\n\t\t\tthis.destroyStream();\n\t\t\tthis.destroyAudioContext();\n\t\t\tcb?.call(this, false);\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tstop(cb: (data: Blob) => void) {\n\t\tthis.encoder?.on('encoded', cb);\n\t\tthis.encoder?.close();\n\n\t\tthis.destroyEncoder();\n\t\tthis.destroyStream();\n\t\tthis.destroyAudioContext();\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"d5ebe54f7df4d6154b2eec9a3baba9b3a73c667e"}
