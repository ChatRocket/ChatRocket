{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/providers/AppsProvider/AppsProvider.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/providers/AppsProvider/AppsProvider.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/providers/AppsProvider/AppsProvider.tsx","inputSourceMap":{"version":3,"file":"client/providers/AppsProvider/AppsProvider.tsx","sourceRoot":"","sources":["client/providers/AppsProvider/AppsProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import { useDebouncedCallback } from '@rocket.chat/fuselage-hooks';\nimport { usePermission, useStream } from '@rocket.chat/ui-contexts';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport type { ReactNode } from 'react';\nimport React, { useEffect, useState } from 'react';\n\nimport { AppClientOrchestratorInstance } from '../../apps/orchestrator';\nimport { AppsContext } from '../../contexts/AppsContext';\nimport { useInvalidateLicense, useLicense } from '../../hooks/useLicense';\nimport type { AsyncState } from '../../lib/asyncState';\nimport { AsyncStatePhase } from '../../lib/asyncState';\nimport { useInvalidateAppsCountQueryCallback } from '../../views/marketplace/hooks/useAppsCountQuery';\nimport type { App } from '../../views/marketplace/types';\nimport { storeQueryFunction } from './storeQueryFunction';\n\nconst getAppState = (\n\tloading: boolean,\n\tapps: App[] | undefined,\n\terror?: Error,\n): AsyncState<{\n\tapps: App[];\n}> => {\n\tif (error) {\n\t\treturn {\n\t\t\tphase: AsyncStatePhase.REJECTED,\n\t\t\tvalue: undefined,\n\t\t\terror,\n\t\t};\n\t}\n\n\treturn {\n\t\tphase: loading ? AsyncStatePhase.LOADING : AsyncStatePhase.RESOLVED,\n\t\tvalue: { apps: apps || [] },\n\t\terror,\n\t};\n};\n\ntype AppsProviderProps = {\n\tchildren: ReactNode;\n};\n\nconst AppsProvider = ({ children }: AppsProviderProps) => {\n\tconst isAdminUser = usePermission('manage-apps');\n\n\tconst queryClient = useQueryClient();\n\n\tconst { isLoading: isLicenseInformationLoading, data: { license, limits } = {} } = useLicense({ loadValues: true });\n\tconst isEnterprise = isLicenseInformationLoading ? undefined : !!license;\n\n\tconst [marketplaceError, setMarketplaceError] = useState<Error>();\n\n\tconst invalidateAppsCountQuery = useInvalidateAppsCountQueryCallback();\n\tconst invalidateLicenseQuery = useInvalidateLicense();\n\n\tconst stream = useStream('apps');\n\n\tconst invalidate = useDebouncedCallback(\n\t\t() => {\n\t\t\tqueryClient.invalidateQueries(['marketplace', 'apps-instance']);\n\t\t\tinvalidateAppsCountQuery();\n\t\t},\n\t\t100,\n\t\t[],\n\t);\n\n\tuseEffect(() => {\n\t\treturn stream('apps', ([key]) => {\n\t\t\tif (['app/added', 'app/removed', 'app/updated', 'app/statusUpdate', 'app/settingUpdated'].includes(key)) {\n\t\t\t\tinvalidate();\n\t\t\t}\n\t\t\tif (['app/added', 'app/removed'].includes(key) && !isEnterprise) {\n\t\t\t\tinvalidateLicenseQuery();\n\t\t\t}\n\t\t});\n\t}, [invalidate, invalidateLicenseQuery, isEnterprise, stream]);\n\n\tconst marketplace = useQuery(\n\t\t['marketplace', 'apps-marketplace', isAdminUser],\n\t\tasync () => {\n\t\t\tconst result = await AppClientOrchestratorInstance.getAppsFromMarketplace(isAdminUser);\n\t\t\tqueryClient.invalidateQueries(['marketplace', 'apps-stored']);\n\t\t\tif (result.error && typeof result.error === 'string') {\n\t\t\t\tsetMarketplaceError(new Error(result.error));\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\treturn result.apps;\n\t\t},\n\t\t{\n\t\t\tstaleTime: Infinity,\n\t\t\tkeepPreviousData: true,\n\t\t\tonSettled: () => queryClient.invalidateQueries(['marketplace', 'apps-stored']),\n\t\t},\n\t);\n\n\tconst instance = useQuery(\n\t\t['marketplace', 'apps-instance', isAdminUser],\n\t\tasync () => {\n\t\t\tconst result = await AppClientOrchestratorInstance.getInstalledApps().then((result: App[]) =>\n\t\t\t\tresult.map((current: App) => ({\n\t\t\t\t\t...current,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t})),\n\t\t\t);\n\t\t\treturn result;\n\t\t},\n\t\t{\n\t\t\tstaleTime: Infinity,\n\t\t\tonSettled: () => queryClient.invalidateQueries(['marketplace', 'apps-stored']),\n\t\t},\n\t);\n\n\tconst { isLoading: isMarketplaceDataLoading, data: marketplaceData } = useQuery(\n\t\t['marketplace', 'apps-stored', instance.data, marketplace.data],\n\t\t() => storeQueryFunction(marketplace, instance),\n\t\t{\n\t\t\tenabled: marketplace.isFetched && instance.isFetched,\n\t\t\tkeepPreviousData: true,\n\t\t},\n\t);\n\n\tconst [marketplaceAppsData, installedAppsData, privateAppsData] = marketplaceData || [];\n\n\treturn (\n\t\t<AppsContext.Provider\n\t\t\tchildren={children}\n\t\t\tvalue={{\n\t\t\t\tinstalledApps: getAppState(isMarketplaceDataLoading, installedAppsData),\n\t\t\t\tmarketplaceApps: getAppState(isMarketplaceDataLoading, marketplaceAppsData, marketplaceError),\n\t\t\t\tprivateApps: getAppState(isMarketplaceDataLoading, privateAppsData),\n\n\t\t\t\treload: async () => {\n\t\t\t\t\tawait Promise.all([queryClient.invalidateQueries(['marketplace'])]);\n\t\t\t\t},\n\t\t\t\torchestrator: AppClientOrchestratorInstance,\n\t\t\t\tprivateAppsEnabled: (limits?.privateApps?.max ?? 0) !== 0,\n\t\t\t}}\n\t\t/>\n\t);\n};\n\nexport default AppsProvider;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/providers/AppsProvider/AppsProvider.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/providers/AppsProvider/AppsProvider.tsx","inputSourceMap":{"version":3,"file":"client/providers/AppsProvider/AppsProvider.tsx","sourceRoot":"","sources":["client/providers/AppsProvider/AppsProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import { useDebouncedCallback } from '@rocket.chat/fuselage-hooks';\nimport { usePermission, useStream } from '@rocket.chat/ui-contexts';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport type { ReactNode } from 'react';\nimport React, { useEffect, useState } from 'react';\n\nimport { AppClientOrchestratorInstance } from '../../apps/orchestrator';\nimport { AppsContext } from '../../contexts/AppsContext';\nimport { useInvalidateLicense, useLicense } from '../../hooks/useLicense';\nimport type { AsyncState } from '../../lib/asyncState';\nimport { AsyncStatePhase } from '../../lib/asyncState';\nimport { useInvalidateAppsCountQueryCallback } from '../../views/marketplace/hooks/useAppsCountQuery';\nimport type { App } from '../../views/marketplace/types';\nimport { storeQueryFunction } from './storeQueryFunction';\n\nconst getAppState = (\n\tloading: boolean,\n\tapps: App[] | undefined,\n\terror?: Error,\n): AsyncState<{\n\tapps: App[];\n}> => {\n\tif (error) {\n\t\treturn {\n\t\t\tphase: AsyncStatePhase.REJECTED,\n\t\t\tvalue: undefined,\n\t\t\terror,\n\t\t};\n\t}\n\n\treturn {\n\t\tphase: loading ? AsyncStatePhase.LOADING : AsyncStatePhase.RESOLVED,\n\t\tvalue: { apps: apps || [] },\n\t\terror,\n\t};\n};\n\ntype AppsProviderProps = {\n\tchildren: ReactNode;\n};\n\nconst AppsProvider = ({ children }: AppsProviderProps) => {\n\tconst isAdminUser = usePermission('manage-apps');\n\n\tconst queryClient = useQueryClient();\n\n\tconst { isLoading: isLicenseInformationLoading, data: { license, limits } = {} } = useLicense({ loadValues: true });\n\tconst isEnterprise = isLicenseInformationLoading ? undefined : !!license;\n\n\tconst [marketplaceError, setMarketplaceError] = useState<Error>();\n\n\tconst invalidateAppsCountQuery = useInvalidateAppsCountQueryCallback();\n\tconst invalidateLicenseQuery = useInvalidateLicense();\n\n\tconst stream = useStream('apps');\n\n\tconst invalidate = useDebouncedCallback(\n\t\t() => {\n\t\t\tqueryClient.invalidateQueries(['marketplace', 'apps-instance']);\n\t\t\tinvalidateAppsCountQuery();\n\t\t},\n\t\t100,\n\t\t[],\n\t);\n\n\tuseEffect(() => {\n\t\treturn stream('apps', ([key]) => {\n\t\t\tif (['app/added', 'app/removed', 'app/updated', 'app/statusUpdate', 'app/settingUpdated'].includes(key)) {\n\t\t\t\tinvalidate();\n\t\t\t}\n\t\t\tif (['app/added', 'app/removed'].includes(key) && !isEnterprise) {\n\t\t\t\tinvalidateLicenseQuery();\n\t\t\t}\n\t\t});\n\t}, [invalidate, invalidateLicenseQuery, isEnterprise, stream]);\n\n\tconst marketplace = useQuery(\n\t\t['marketplace', 'apps-marketplace', isAdminUser],\n\t\tasync () => {\n\t\t\tconst result = await AppClientOrchestratorInstance.getAppsFromMarketplace(isAdminUser);\n\t\t\tqueryClient.invalidateQueries(['marketplace', 'apps-stored']);\n\t\t\tif (result.error && typeof result.error === 'string') {\n\t\t\t\tsetMarketplaceError(new Error(result.error));\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\treturn result.apps;\n\t\t},\n\t\t{\n\t\t\tstaleTime: Infinity,\n\t\t\tkeepPreviousData: true,\n\t\t\tonSettled: () => queryClient.invalidateQueries(['marketplace', 'apps-stored']),\n\t\t},\n\t);\n\n\tconst instance = useQuery(\n\t\t['marketplace', 'apps-instance', isAdminUser],\n\t\tasync () => {\n\t\t\tconst result = await AppClientOrchestratorInstance.getInstalledApps().then((result: App[]) =>\n\t\t\t\tresult.map((current: App) => ({\n\t\t\t\t\t...current,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t})),\n\t\t\t);\n\t\t\treturn result;\n\t\t},\n\t\t{\n\t\t\tstaleTime: Infinity,\n\t\t\tonSettled: () => queryClient.invalidateQueries(['marketplace', 'apps-stored']),\n\t\t},\n\t);\n\n\tconst { isLoading: isMarketplaceDataLoading, data: marketplaceData } = useQuery(\n\t\t['marketplace', 'apps-stored', instance.data, marketplace.data],\n\t\t() => storeQueryFunction(marketplace, instance),\n\t\t{\n\t\t\tenabled: marketplace.isFetched && instance.isFetched,\n\t\t\tkeepPreviousData: true,\n\t\t},\n\t);\n\n\tconst [marketplaceAppsData, installedAppsData, privateAppsData] = marketplaceData || [];\n\n\treturn (\n\t\t<AppsContext.Provider\n\t\t\tchildren={children}\n\t\t\tvalue={{\n\t\t\t\tinstalledApps: getAppState(isMarketplaceDataLoading, installedAppsData),\n\t\t\t\tmarketplaceApps: getAppState(isMarketplaceDataLoading, marketplaceAppsData, marketplaceError),\n\t\t\t\tprivateApps: getAppState(isMarketplaceDataLoading, privateAppsData),\n\n\t\t\t\treload: async () => {\n\t\t\t\t\tawait Promise.all([queryClient.invalidateQueries(['marketplace'])]);\n\t\t\t\t},\n\t\t\t\torchestrator: AppClientOrchestratorInstance,\n\t\t\t\tprivateAppsEnabled: (limits?.privateApps?.max ?? 0) !== 0,\n\t\t\t}}\n\t\t/>\n\t);\n};\n\nexport default AppsProvider;\n"]}}},"code":"let _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n}, 0);\nlet useDebouncedCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useDebouncedCallback(v) {\n    useDebouncedCallback = v;\n  }\n}, 0);\nlet usePermission, useStream;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  usePermission(v) {\n    usePermission = v;\n  },\n  useStream(v) {\n    useStream = v;\n  }\n}, 1);\nlet useQuery, useQueryClient;\nmodule.link(\"@tanstack/react-query\", {\n  useQuery(v) {\n    useQuery = v;\n  },\n  useQueryClient(v) {\n    useQueryClient = v;\n  }\n}, 2);\nlet React, useEffect, useState;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n  useEffect(v) {\n    useEffect = v;\n  },\n  useState(v) {\n    useState = v;\n  }\n}, 3);\nlet AppClientOrchestratorInstance;\nmodule.link(\"../../apps/orchestrator\", {\n  AppClientOrchestratorInstance(v) {\n    AppClientOrchestratorInstance = v;\n  }\n}, 4);\nlet AppsContext;\nmodule.link(\"../../contexts/AppsContext\", {\n  AppsContext(v) {\n    AppsContext = v;\n  }\n}, 5);\nlet useInvalidateLicense, useLicense;\nmodule.link(\"../../hooks/useLicense\", {\n  useInvalidateLicense(v) {\n    useInvalidateLicense = v;\n  },\n  useLicense(v) {\n    useLicense = v;\n  }\n}, 6);\nlet AsyncStatePhase;\nmodule.link(\"../../lib/asyncState\", {\n  AsyncStatePhase(v) {\n    AsyncStatePhase = v;\n  }\n}, 7);\nlet useInvalidateAppsCountQueryCallback;\nmodule.link(\"../../views/marketplace/hooks/useAppsCountQuery\", {\n  useInvalidateAppsCountQueryCallback(v) {\n    useInvalidateAppsCountQueryCallback = v;\n  }\n}, 8);\nlet storeQueryFunction;\nmodule.link(\"./storeQueryFunction\", {\n  storeQueryFunction(v) {\n    storeQueryFunction = v;\n  }\n}, 9);\nconst getAppState = (loading, apps, error) => {\n  if (error) {\n    return {\n      phase: AsyncStatePhase.REJECTED,\n      value: undefined,\n      error\n    };\n  }\n  return {\n    phase: loading ? AsyncStatePhase.LOADING : AsyncStatePhase.RESOLVED,\n    value: {\n      apps: apps || []\n    },\n    error\n  };\n};\nconst AppsProvider = _ref => {\n  var _limits$privateApps$m, _limits$privateApps;\n  let {\n    children\n  } = _ref;\n  const isAdminUser = usePermission('manage-apps');\n  const queryClient = useQueryClient();\n  const {\n    isLoading: isLicenseInformationLoading,\n    data: {\n      license,\n      limits\n    } = {}\n  } = useLicense({\n    loadValues: true\n  });\n  const isEnterprise = isLicenseInformationLoading ? undefined : !!license;\n  const [marketplaceError, setMarketplaceError] = useState();\n  const invalidateAppsCountQuery = useInvalidateAppsCountQueryCallback();\n  const invalidateLicenseQuery = useInvalidateLicense();\n  const stream = useStream('apps');\n  const invalidate = useDebouncedCallback(() => {\n    queryClient.invalidateQueries(['marketplace', 'apps-instance']);\n    invalidateAppsCountQuery();\n  }, 100, []);\n  useEffect(() => {\n    return stream('apps', _ref2 => {\n      let [key] = _ref2;\n      if (['app/added', 'app/removed', 'app/updated', 'app/statusUpdate', 'app/settingUpdated'].includes(key)) {\n        invalidate();\n      }\n      if (['app/added', 'app/removed'].includes(key) && !isEnterprise) {\n        invalidateLicenseQuery();\n      }\n    });\n  }, [invalidate, invalidateLicenseQuery, isEnterprise, stream]);\n  const marketplace = useQuery(['marketplace', 'apps-marketplace', isAdminUser], async () => {\n    const result = await AppClientOrchestratorInstance.getAppsFromMarketplace(isAdminUser);\n    queryClient.invalidateQueries(['marketplace', 'apps-stored']);\n    if (result.error && typeof result.error === 'string') {\n      setMarketplaceError(new Error(result.error));\n      return [];\n    }\n    return result.apps;\n  }, {\n    staleTime: Infinity,\n    keepPreviousData: true,\n    onSettled: () => queryClient.invalidateQueries(['marketplace', 'apps-stored'])\n  });\n  const instance = useQuery(['marketplace', 'apps-instance', isAdminUser], async () => {\n    const result = await AppClientOrchestratorInstance.getInstalledApps().then(result => result.map(current => _objectSpread(_objectSpread({}, current), {}, {\n      installed: true\n    })));\n    return result;\n  }, {\n    staleTime: Infinity,\n    onSettled: () => queryClient.invalidateQueries(['marketplace', 'apps-stored'])\n  });\n  const {\n    isLoading: isMarketplaceDataLoading,\n    data: marketplaceData\n  } = useQuery(['marketplace', 'apps-stored', instance.data, marketplace.data], () => storeQueryFunction(marketplace, instance), {\n    enabled: marketplace.isFetched && instance.isFetched,\n    keepPreviousData: true\n  });\n  const [marketplaceAppsData, installedAppsData, privateAppsData] = marketplaceData || [];\n  return /*#__PURE__*/React.createElement(AppsContext.Provider, {\n    children: children,\n    value: {\n      installedApps: getAppState(isMarketplaceDataLoading, installedAppsData),\n      marketplaceApps: getAppState(isMarketplaceDataLoading, marketplaceAppsData, marketplaceError),\n      privateApps: getAppState(isMarketplaceDataLoading, privateAppsData),\n      reload: async () => {\n        await Promise.all([queryClient.invalidateQueries(['marketplace'])]);\n      },\n      orchestrator: AppClientOrchestratorInstance,\n      privateAppsEnabled: ((_limits$privateApps$m = limits === null || limits === void 0 ? void 0 : (_limits$privateApps = limits.privateApps) === null || _limits$privateApps === void 0 ? void 0 : _limits$privateApps.max) !== null && _limits$privateApps$m !== void 0 ? _limits$privateApps$m : 0) !== 0\n    }\n  });\n};\nmodule.exportDefault(AppsProvider);","map":{"version":3,"names":["_objectSpread","module","link","default","v","useDebouncedCallback","usePermission","useStream","useQuery","useQueryClient","React","useEffect","useState","AppClientOrchestratorInstance","AppsContext","useInvalidateLicense","useLicense","AsyncStatePhase","useInvalidateAppsCountQueryCallback","storeQueryFunction","getAppState","loading","apps","error","phase","REJECTED","value","undefined","LOADING","RESOLVED","AppsProvider","_ref","_limits$privateApps$m","_limits$privateApps","children","isAdminUser","queryClient","isLoading","isLicenseInformationLoading","data","license","limits","loadValues","isEnterprise","marketplaceError","setMarketplaceError","invalidateAppsCountQuery","invalidateLicenseQuery","stream","invalidate","invalidateQueries","_ref2","key","includes","marketplace","result","getAppsFromMarketplace","Error","staleTime","Infinity","keepPreviousData","onSettled","instance","getInstalledApps","then","map","current","installed","isMarketplaceDataLoading","marketplaceData","enabled","isFetched","marketplaceAppsData","installedAppsData","privateAppsData","createElement","Provider","installedApps","marketplaceApps","privateApps","reload","Promise","all","orchestrator","privateAppsEnabled","max","exportDefault"],"sources":["client/providers/AppsProvider/AppsProvider.tsx"],"sourcesContent":["import { useDebouncedCallback } from '@rocket.chat/fuselage-hooks';\nimport { usePermission, useStream } from '@rocket.chat/ui-contexts';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport type { ReactNode } from 'react';\nimport React, { useEffect, useState } from 'react';\n\nimport { AppClientOrchestratorInstance } from '../../apps/orchestrator';\nimport { AppsContext } from '../../contexts/AppsContext';\nimport { useInvalidateLicense, useLicense } from '../../hooks/useLicense';\nimport type { AsyncState } from '../../lib/asyncState';\nimport { AsyncStatePhase } from '../../lib/asyncState';\nimport { useInvalidateAppsCountQueryCallback } from '../../views/marketplace/hooks/useAppsCountQuery';\nimport type { App } from '../../views/marketplace/types';\nimport { storeQueryFunction } from './storeQueryFunction';\n\nconst getAppState = (\n\tloading: boolean,\n\tapps: App[] | undefined,\n\terror?: Error,\n): AsyncState<{\n\tapps: App[];\n}> => {\n\tif (error) {\n\t\treturn {\n\t\t\tphase: AsyncStatePhase.REJECTED,\n\t\t\tvalue: undefined,\n\t\t\terror,\n\t\t};\n\t}\n\n\treturn {\n\t\tphase: loading ? AsyncStatePhase.LOADING : AsyncStatePhase.RESOLVED,\n\t\tvalue: { apps: apps || [] },\n\t\terror,\n\t};\n};\n\ntype AppsProviderProps = {\n\tchildren: ReactNode;\n};\n\nconst AppsProvider = ({ children }: AppsProviderProps) => {\n\tconst isAdminUser = usePermission('manage-apps');\n\n\tconst queryClient = useQueryClient();\n\n\tconst { isLoading: isLicenseInformationLoading, data: { license, limits } = {} } = useLicense({ loadValues: true });\n\tconst isEnterprise = isLicenseInformationLoading ? undefined : !!license;\n\n\tconst [marketplaceError, setMarketplaceError] = useState<Error>();\n\n\tconst invalidateAppsCountQuery = useInvalidateAppsCountQueryCallback();\n\tconst invalidateLicenseQuery = useInvalidateLicense();\n\n\tconst stream = useStream('apps');\n\n\tconst invalidate = useDebouncedCallback(\n\t\t() => {\n\t\t\tqueryClient.invalidateQueries(['marketplace', 'apps-instance']);\n\t\t\tinvalidateAppsCountQuery();\n\t\t},\n\t\t100,\n\t\t[],\n\t);\n\n\tuseEffect(() => {\n\t\treturn stream('apps', ([key]) => {\n\t\t\tif (['app/added', 'app/removed', 'app/updated', 'app/statusUpdate', 'app/settingUpdated'].includes(key)) {\n\t\t\t\tinvalidate();\n\t\t\t}\n\t\t\tif (['app/added', 'app/removed'].includes(key) && !isEnterprise) {\n\t\t\t\tinvalidateLicenseQuery();\n\t\t\t}\n\t\t});\n\t}, [invalidate, invalidateLicenseQuery, isEnterprise, stream]);\n\n\tconst marketplace = useQuery(\n\t\t['marketplace', 'apps-marketplace', isAdminUser],\n\t\tasync () => {\n\t\t\tconst result = await AppClientOrchestratorInstance.getAppsFromMarketplace(isAdminUser);\n\t\t\tqueryClient.invalidateQueries(['marketplace', 'apps-stored']);\n\t\t\tif (result.error && typeof result.error === 'string') {\n\t\t\t\tsetMarketplaceError(new Error(result.error));\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\treturn result.apps;\n\t\t},\n\t\t{\n\t\t\tstaleTime: Infinity,\n\t\t\tkeepPreviousData: true,\n\t\t\tonSettled: () => queryClient.invalidateQueries(['marketplace', 'apps-stored']),\n\t\t},\n\t);\n\n\tconst instance = useQuery(\n\t\t['marketplace', 'apps-instance', isAdminUser],\n\t\tasync () => {\n\t\t\tconst result = await AppClientOrchestratorInstance.getInstalledApps().then((result: App[]) =>\n\t\t\t\tresult.map((current: App) => ({\n\t\t\t\t\t...current,\n\t\t\t\t\tinstalled: true,\n\t\t\t\t})),\n\t\t\t);\n\t\t\treturn result;\n\t\t},\n\t\t{\n\t\t\tstaleTime: Infinity,\n\t\t\tonSettled: () => queryClient.invalidateQueries(['marketplace', 'apps-stored']),\n\t\t},\n\t);\n\n\tconst { isLoading: isMarketplaceDataLoading, data: marketplaceData } = useQuery(\n\t\t['marketplace', 'apps-stored', instance.data, marketplace.data],\n\t\t() => storeQueryFunction(marketplace, instance),\n\t\t{\n\t\t\tenabled: marketplace.isFetched && instance.isFetched,\n\t\t\tkeepPreviousData: true,\n\t\t},\n\t);\n\n\tconst [marketplaceAppsData, installedAppsData, privateAppsData] = marketplaceData || [];\n\n\treturn (\n\t\t<AppsContext.Provider\n\t\t\tchildren={children}\n\t\t\tvalue={{\n\t\t\t\tinstalledApps: getAppState(isMarketplaceDataLoading, installedAppsData),\n\t\t\t\tmarketplaceApps: getAppState(isMarketplaceDataLoading, marketplaceAppsData, marketplaceError),\n\t\t\t\tprivateApps: getAppState(isMarketplaceDataLoading, privateAppsData),\n\n\t\t\t\treload: async () => {\n\t\t\t\t\tawait Promise.all([queryClient.invalidateQueries(['marketplace'])]);\n\t\t\t\t},\n\t\t\t\torchestrator: AppClientOrchestratorInstance,\n\t\t\t\tprivateAppsEnabled: (limits?.privateApps?.max ?? 0) !== 0,\n\t\t\t}}\n\t\t/>\n\t);\n};\n\nexport default AppsProvider;\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"a915f1757e464952046d4033b27cd2fac1024815"}
