{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/ServiceProviderMetadata.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/meteor-accounts-saml/server/lib/generators/ServiceProviderMetadata.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/ServiceProviderMetadata.ts","inputSourceMap":{"version":3,"file":"app/meteor-accounts-saml/server/lib/generators/ServiceProviderMetadata.ts","sourceRoot":"","sources":["app/meteor-accounts-saml/server/lib/generators/ServiceProviderMetadata.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,MAAM,eAAe,CAAC;AAIvC,OAAO,EAAE,SAAS,EAAE,MAAM,UAAU,CAAC;AACrC,OAAO,EAAE,uBAAuB,EAAE,kCAAkC,EAAE,uBAAuB,EAAE,MAAM,cAAc,CAAC;AAEpH;;;EAGE;AAEF,MAAM,OAAO,uBAAuB;IAC5B,MAAM,CAAC,QAAQ,CAAC,sBAA+C;QACrE,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,sBAAsB,CAAC,CAAC;QAClD,OAAO,SAAS,CAAC,gBAAgB,CAAC,IAAI,CAAC,gBAAgB,CAAC,sBAAsB,CAAC,EAAE,IAAI,CAAC,CAAC;IACxF,CAAC;IAEO,MAAM,CAAC,sBAAsB,CAAC,sBAA+C;QACpF,IAAI,CAAC,sBAAsB,CAAC,UAAU,EAAE,CAAC;YACxC,OAAO,EAAE,CAAC;QACX,CAAC;QAED,IAAI,CAAC,sBAAsB,CAAC,WAAW,EAAE,CAAC;YACzC,MAAM,IAAI,KAAK,CAAC,+EAA+E,CAAC,CAAC;QAClG,CAAC;QAED,OAAO,sBAAsB,CAAC,2BAA2B,IAAI,kCAAkC,CAAC;IACjG,CAAC;IAEO,MAAM,CAAC,gBAAgB,CAAC,sBAA+C;QAC9E,MAAM,IAAI,GAAG;YACZ,cAAc,EAAE,IAAI,CAAC,sBAAsB,CAAC,sBAAsB,CAAC;SACnE,CAAC;QAEF,MAAM,QAAQ,GAAG,sBAAsB,CAAC,gBAAgB,IAAI,uBAAuB,CAAC;QACpF,OAAO,SAAS,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;IACnD,CAAC;IAEO,MAAM,CAAC,OAAO,CAAC,sBAA+C;QACrE,IAAI,CAAC,sBAAsB,CAAC,WAAW,EAAE,CAAC;YACzC,MAAM,IAAI,KAAK,CAAC,iFAAiF,CAAC,CAAC;QACpG,CAAC;QAED,OAAO;YACN,MAAM,EAAE,sBAAsB,CAAC,MAAM;YACrC,WAAW,EAAE,SAAS,CAAC,aAAa,CAAC,sBAAsB,CAAC,WAAW,CAAC;YACxE,gBAAgB,EAAE,sBAAsB,CAAC,gBAAgB,IAAI,uBAAuB;YACpF,WAAW,EAAE,sBAAsB,CAAC,WAAW;YAC/C,WAAW,EAAE,GAAG,MAAM,CAAC,WAAW,EAAE,gBAAgB,sBAAsB,CAAC,QAAQ,GAAG;SACtF,CAAC;IACH,CAAC;CACD","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport type { IMetadataVariables } from '../../definition/IMetadataVariables';\nimport type { IServiceProviderOptions } from '../../definition/IServiceProviderOptions';\nimport { SAMLUtils } from '../Utils';\nimport { defaultIdentifierFormat, defaultMetadataCertificateTemplate, defaultMetadataTemplate } from '../constants';\n\n/*\n\tThe metadata will be available at the following url:\n\t[rocketchat-url]/_saml/metadata/[provider-name]\n*/\n\nexport class ServiceProviderMetadata {\n\tpublic static generate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tconst data = this.getData(serviceProviderOptions);\n\t\treturn SAMLUtils.fillTemplateData(this.metadataTemplate(serviceProviderOptions), data);\n\t}\n\n\tprivate static certificateTagTemplate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tif (!serviceProviderOptions.privateKey) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (!serviceProviderOptions.privateCert) {\n\t\t\tthrow new Error('Missing certificate while generating metadata for decrypting service provider');\n\t\t}\n\n\t\treturn serviceProviderOptions.metadataCertificateTemplate || defaultMetadataCertificateTemplate;\n\t}\n\n\tprivate static metadataTemplate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tconst data = {\n\t\t\tcertificateTag: this.certificateTagTemplate(serviceProviderOptions),\n\t\t};\n\n\t\tconst template = serviceProviderOptions.metadataTemplate || defaultMetadataTemplate;\n\t\treturn SAMLUtils.fillTemplateData(template, data);\n\t}\n\n\tprivate static getData(serviceProviderOptions: IServiceProviderOptions): IMetadataVariables {\n\t\tif (!serviceProviderOptions.callbackUrl) {\n\t\t\tthrow new Error('Unable to generate service provider metadata when callbackUrl option is not set');\n\t\t}\n\n\t\treturn {\n\t\t\tissuer: serviceProviderOptions.issuer,\n\t\t\tcertificate: SAMLUtils.normalizeCert(serviceProviderOptions.privateCert),\n\t\t\tidentifierFormat: serviceProviderOptions.identifierFormat || defaultIdentifierFormat,\n\t\t\tcallbackUrl: serviceProviderOptions.callbackUrl,\n\t\t\tsloLocation: `${Meteor.absoluteUrl()}_saml/logout/${serviceProviderOptions.provider}/`,\n\t\t};\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/meteor-accounts-saml/server/lib/generators/ServiceProviderMetadata.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/meteor-accounts-saml/server/lib/generators/ServiceProviderMetadata.ts","inputSourceMap":{"version":3,"file":"app/meteor-accounts-saml/server/lib/generators/ServiceProviderMetadata.ts","sourceRoot":"","sources":["app/meteor-accounts-saml/server/lib/generators/ServiceProviderMetadata.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,MAAM,eAAe,CAAC;AAIvC,OAAO,EAAE,SAAS,EAAE,MAAM,UAAU,CAAC;AACrC,OAAO,EAAE,uBAAuB,EAAE,kCAAkC,EAAE,uBAAuB,EAAE,MAAM,cAAc,CAAC;AAEpH;;;EAGE;AAEF,MAAM,OAAO,uBAAuB;IAC5B,MAAM,CAAC,QAAQ,CAAC,sBAA+C;QACrE,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,sBAAsB,CAAC,CAAC;QAClD,OAAO,SAAS,CAAC,gBAAgB,CAAC,IAAI,CAAC,gBAAgB,CAAC,sBAAsB,CAAC,EAAE,IAAI,CAAC,CAAC;IACxF,CAAC;IAEO,MAAM,CAAC,sBAAsB,CAAC,sBAA+C;QACpF,IAAI,CAAC,sBAAsB,CAAC,UAAU,EAAE,CAAC;YACxC,OAAO,EAAE,CAAC;QACX,CAAC;QAED,IAAI,CAAC,sBAAsB,CAAC,WAAW,EAAE,CAAC;YACzC,MAAM,IAAI,KAAK,CAAC,+EAA+E,CAAC,CAAC;QAClG,CAAC;QAED,OAAO,sBAAsB,CAAC,2BAA2B,IAAI,kCAAkC,CAAC;IACjG,CAAC;IAEO,MAAM,CAAC,gBAAgB,CAAC,sBAA+C;QAC9E,MAAM,IAAI,GAAG;YACZ,cAAc,EAAE,IAAI,CAAC,sBAAsB,CAAC,sBAAsB,CAAC;SACnE,CAAC;QAEF,MAAM,QAAQ,GAAG,sBAAsB,CAAC,gBAAgB,IAAI,uBAAuB,CAAC;QACpF,OAAO,SAAS,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;IACnD,CAAC;IAEO,MAAM,CAAC,OAAO,CAAC,sBAA+C;QACrE,IAAI,CAAC,sBAAsB,CAAC,WAAW,EAAE,CAAC;YACzC,MAAM,IAAI,KAAK,CAAC,iFAAiF,CAAC,CAAC;QACpG,CAAC;QAED,OAAO;YACN,MAAM,EAAE,sBAAsB,CAAC,MAAM;YACrC,WAAW,EAAE,SAAS,CAAC,aAAa,CAAC,sBAAsB,CAAC,WAAW,CAAC;YACxE,gBAAgB,EAAE,sBAAsB,CAAC,gBAAgB,IAAI,uBAAuB;YACpF,WAAW,EAAE,sBAAsB,CAAC,WAAW;YAC/C,WAAW,EAAE,GAAG,MAAM,CAAC,WAAW,EAAE,gBAAgB,sBAAsB,CAAC,QAAQ,GAAG;SACtF,CAAC;IACH,CAAC;CACD","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport type { IMetadataVariables } from '../../definition/IMetadataVariables';\nimport type { IServiceProviderOptions } from '../../definition/IServiceProviderOptions';\nimport { SAMLUtils } from '../Utils';\nimport { defaultIdentifierFormat, defaultMetadataCertificateTemplate, defaultMetadataTemplate } from '../constants';\n\n/*\n\tThe metadata will be available at the following url:\n\t[rocketchat-url]/_saml/metadata/[provider-name]\n*/\n\nexport class ServiceProviderMetadata {\n\tpublic static generate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tconst data = this.getData(serviceProviderOptions);\n\t\treturn SAMLUtils.fillTemplateData(this.metadataTemplate(serviceProviderOptions), data);\n\t}\n\n\tprivate static certificateTagTemplate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tif (!serviceProviderOptions.privateKey) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (!serviceProviderOptions.privateCert) {\n\t\t\tthrow new Error('Missing certificate while generating metadata for decrypting service provider');\n\t\t}\n\n\t\treturn serviceProviderOptions.metadataCertificateTemplate || defaultMetadataCertificateTemplate;\n\t}\n\n\tprivate static metadataTemplate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tconst data = {\n\t\t\tcertificateTag: this.certificateTagTemplate(serviceProviderOptions),\n\t\t};\n\n\t\tconst template = serviceProviderOptions.metadataTemplate || defaultMetadataTemplate;\n\t\treturn SAMLUtils.fillTemplateData(template, data);\n\t}\n\n\tprivate static getData(serviceProviderOptions: IServiceProviderOptions): IMetadataVariables {\n\t\tif (!serviceProviderOptions.callbackUrl) {\n\t\t\tthrow new Error('Unable to generate service provider metadata when callbackUrl option is not set');\n\t\t}\n\n\t\treturn {\n\t\t\tissuer: serviceProviderOptions.issuer,\n\t\t\tcertificate: SAMLUtils.normalizeCert(serviceProviderOptions.privateCert),\n\t\t\tidentifierFormat: serviceProviderOptions.identifierFormat || defaultIdentifierFormat,\n\t\t\tcallbackUrl: serviceProviderOptions.callbackUrl,\n\t\t\tsloLocation: `${Meteor.absoluteUrl()}_saml/logout/${serviceProviderOptions.provider}/`,\n\t\t};\n\t}\n}\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    module.export({\n      ServiceProviderMetadata: () => ServiceProviderMetadata\n    });\n    let Meteor;\n    module.link(\"meteor/meteor\", {\n      Meteor(v) {\n        Meteor = v;\n      }\n    }, 0);\n    let SAMLUtils;\n    module.link(\"../Utils\", {\n      SAMLUtils(v) {\n        SAMLUtils = v;\n      }\n    }, 1);\n    let defaultIdentifierFormat, defaultMetadataCertificateTemplate, defaultMetadataTemplate;\n    module.link(\"../constants\", {\n      defaultIdentifierFormat(v) {\n        defaultIdentifierFormat = v;\n      },\n      defaultMetadataCertificateTemplate(v) {\n        defaultMetadataCertificateTemplate = v;\n      },\n      defaultMetadataTemplate(v) {\n        defaultMetadataTemplate = v;\n      }\n    }, 2);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    class ServiceProviderMetadata {\n      static generate(serviceProviderOptions) {\n        const data = this.getData(serviceProviderOptions);\n        return SAMLUtils.fillTemplateData(this.metadataTemplate(serviceProviderOptions), data);\n      }\n      static certificateTagTemplate(serviceProviderOptions) {\n        if (!serviceProviderOptions.privateKey) {\n          return '';\n        }\n        if (!serviceProviderOptions.privateCert) {\n          throw new Error('Missing certificate while generating metadata for decrypting service provider');\n        }\n        return serviceProviderOptions.metadataCertificateTemplate || defaultMetadataCertificateTemplate;\n      }\n      static metadataTemplate(serviceProviderOptions) {\n        const data = {\n          certificateTag: this.certificateTagTemplate(serviceProviderOptions)\n        };\n        const template = serviceProviderOptions.metadataTemplate || defaultMetadataTemplate;\n        return SAMLUtils.fillTemplateData(template, data);\n      }\n      static getData(serviceProviderOptions) {\n        if (!serviceProviderOptions.callbackUrl) {\n          throw new Error('Unable to generate service provider metadata when callbackUrl option is not set');\n        }\n        return {\n          issuer: serviceProviderOptions.issuer,\n          certificate: SAMLUtils.normalizeCert(serviceProviderOptions.privateCert),\n          identifierFormat: serviceProviderOptions.identifierFormat || defaultIdentifierFormat,\n          callbackUrl: serviceProviderOptions.callbackUrl,\n          sloLocation: \"\".concat(Meteor.absoluteUrl(), \"_saml/logout/\").concat(serviceProviderOptions.provider, \"/\")\n        };\n      }\n    }\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["module","export","ServiceProviderMetadata","Meteor","link","v","SAMLUtils","defaultIdentifierFormat","defaultMetadataCertificateTemplate","defaultMetadataTemplate","__reifyWaitForDeps__","generate","serviceProviderOptions","data","getData","fillTemplateData","metadataTemplate","certificateTagTemplate","privateKey","privateCert","Error","metadataCertificateTemplate","certificateTag","template","callbackUrl","issuer","certificate","normalizeCert","identifierFormat","sloLocation","concat","absoluteUrl","provider","__reify_async_result__","_reifyError","self","async"],"sources":["app/meteor-accounts-saml/server/lib/generators/ServiceProviderMetadata.ts"],"sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport type { IMetadataVariables } from '../../definition/IMetadataVariables';\nimport type { IServiceProviderOptions } from '../../definition/IServiceProviderOptions';\nimport { SAMLUtils } from '../Utils';\nimport { defaultIdentifierFormat, defaultMetadataCertificateTemplate, defaultMetadataTemplate } from '../constants';\n\n/*\n\tThe metadata will be available at the following url:\n\t[rocketchat-url]/_saml/metadata/[provider-name]\n*/\n\nexport class ServiceProviderMetadata {\n\tpublic static generate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tconst data = this.getData(serviceProviderOptions);\n\t\treturn SAMLUtils.fillTemplateData(this.metadataTemplate(serviceProviderOptions), data);\n\t}\n\n\tprivate static certificateTagTemplate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tif (!serviceProviderOptions.privateKey) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (!serviceProviderOptions.privateCert) {\n\t\t\tthrow new Error('Missing certificate while generating metadata for decrypting service provider');\n\t\t}\n\n\t\treturn serviceProviderOptions.metadataCertificateTemplate || defaultMetadataCertificateTemplate;\n\t}\n\n\tprivate static metadataTemplate(serviceProviderOptions: IServiceProviderOptions): string {\n\t\tconst data = {\n\t\t\tcertificateTag: this.certificateTagTemplate(serviceProviderOptions),\n\t\t};\n\n\t\tconst template = serviceProviderOptions.metadataTemplate || defaultMetadataTemplate;\n\t\treturn SAMLUtils.fillTemplateData(template, data);\n\t}\n\n\tprivate static getData(serviceProviderOptions: IServiceProviderOptions): IMetadataVariables {\n\t\tif (!serviceProviderOptions.callbackUrl) {\n\t\t\tthrow new Error('Unable to generate service provider metadata when callbackUrl option is not set');\n\t\t}\n\n\t\treturn {\n\t\t\tissuer: serviceProviderOptions.issuer,\n\t\t\tcertificate: SAMLUtils.normalizeCert(serviceProviderOptions.privateCert),\n\t\t\tidentifierFormat: serviceProviderOptions.identifierFormat || defaultIdentifierFormat,\n\t\t\tcallbackUrl: serviceProviderOptions.callbackUrl,\n\t\t\tsloLocation: `${Meteor.absoluteUrl()}_saml/logout/${serviceProviderOptions.provider}/`,\n\t\t};\n\t}\n}\n"],"mappings":";;;IAAAA,MAAA,CAAOC,MAAE;MAAMC,uBAAuB,EAACA,CAAA,KAAAA;IAAA;IAAA,IAAAC,MAAA;IAAAH,MAAA,CAAAI,IAAA;MAAAD,OAAAE,CAAA;QAAAF,MAAA,GAAAE,CAAA;MAAA;IAAA;IAAA,IAAAC,SAAA;IAAAN,MAAA,CAAAI,IAAA;MAAAE,UAAAD,CAAA;QAAAC,SAAA,GAAAD,CAAA;MAAA;IAAA;IAAA,IAAAE,uBAAA,EAAAC,kCAAA,EAAAC,uBAAA;IAAAT,MAAA,CAAAI,IAAA;MAAAG,wBAAAF,CAAA;QAAAE,uBAAA,GAAAF,CAAA;MAAA;MAAAG,mCAAAH,CAAA;QAAAG,kCAAA,GAAAH,CAAA;MAAA;MAAAI,wBAAAJ,CAAA;QAAAI,uBAAA,GAAAJ,CAAA;MAAA;IAAA;IAAA,IAAAK,oBAAA,WAAAA,oBAAA;IAYjC,MAAOR,uBAAuB;MAC5B,OAAOS,QAAQA,CAACC,sBAA+C;QACrE,MAAMC,IAAI,GAAG,IAAI,CAACC,OAAO,CAACF,sBAAsB,CAAC;QACjD,OAAON,SAAS,CAACS,gBAAgB,CAAC,IAAI,CAACC,gBAAgB,CAACJ,sBAAsB,CAAC,EAAEC,IAAI,CAAC;MACvF;MAEQ,OAAOI,sBAAsBA,CAACL,sBAA+C;QACpF,IAAI,CAACA,sBAAsB,CAACM,UAAU,EAAE;UACvC,OAAO,EAAE;QACV;QAEA,IAAI,CAACN,sBAAsB,CAACO,WAAW,EAAE;UACxC,MAAM,IAAIC,KAAK,CAAC,+EAA+E,CAAC;QACjG;QAEA,OAAOR,sBAAsB,CAACS,2BAA2B,IAAIb,kCAAkC;MAChG;MAEQ,OAAOQ,gBAAgBA,CAACJ,sBAA+C;QAC9E,MAAMC,IAAI,GAAG;UACZS,cAAc,EAAE,IAAI,CAACL,sBAAsB,CAACL,sBAAsB;SAClE;QAED,MAAMW,QAAQ,GAAGX,sBAAsB,CAACI,gBAAgB,IAAIP,uBAAuB;QACnF,OAAOH,SAAS,CAACS,gBAAgB,CAACQ,QAAQ,EAAEV,IAAI,CAAC;MAClD;MAEQ,OAAOC,OAAOA,CAACF,sBAA+C;QACrE,IAAI,CAACA,sBAAsB,CAACY,WAAW,EAAE;UACxC,MAAM,IAAIJ,KAAK,CAAC,iFAAiF,CAAC;QACnG;QAEA,OAAO;UACNK,MAAM,EAAEb,sBAAsB,CAACa,MAAM;UACrCC,WAAW,EAAEpB,SAAS,CAACqB,aAAa,CAACf,sBAAsB,CAACO,WAAW,CAAC;UACxES,gBAAgB,EAAEhB,sBAAsB,CAACgB,gBAAgB,IAAIrB,uBAAuB;UACpFiB,WAAW,EAAEZ,sBAAsB,CAACY,WAAW;UAC/CK,WAAW,KAAAC,MAAA,CAAK3B,MAAM,CAAC4B,WAAW,EAAE,mBAAAD,MAAA,CAAgBlB,sBAAsB,CAACoB,QAAQ;SACnF;MACF;;IACAC,sBAAA;EAAA,SAAAC,WAAA;IAAA,OAAAD,sBAAA,CAAAC,WAAA;EAAA;EAAAD,sBAAA;AAAA;EAAAE,IAAA;EAAAC,KAAA;AAAA","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"3fe8ea772cabe70717367a3371a712a8004a9e3b"}
