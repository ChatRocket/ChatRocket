{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/webrtc/client/WebRTCClass.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/webrtc/client/WebRTCClass.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/webrtc/client/WebRTCClass.ts","inputSourceMap":{"version":3,"file":"app/webrtc/client/WebRTCClass.ts","sourceRoot":"","sources":["app/webrtc/client/WebRTCClass.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport type { StreamKeys, StreamNames, StreamerCallbackArgs } from '@rocket.chat/ddp-client';\nimport { Emitter } from '@rocket.chat/emitter';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Tracker } from 'meteor/tracker';\n\nimport GenericModal from '../../../client/components/GenericModal';\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\nimport { goToRoomById } from '../../../client/lib/utils/goToRoomById';\nimport { ChatSubscription } from '../../models/client';\nimport { settings } from '../../settings/client';\nimport { sdk } from '../../utils/client/lib/SDKClient';\nimport { t } from '../../utils/lib/i18n';\nimport { WEB_RTC_EVENTS } from '../lib/constants';\nimport { ChromeScreenShare } from './screenShare';\n\n// FIXME: there is a mix of obsolete definitions and incorrect field assignments\n\ndeclare global {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface RTCPeerConnection {\n\t\t/** @deprecated non-standard */\n\t\tcreatedAt: number;\n\t\t/** @deprecated non-standard */\n\t\tremoteMedia: MediaStreamConstraints;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface RTCOfferOptions {\n\t\t/** @deprecated non-standard */\n\t\tmandatory?: unknown;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface MediaStream {\n\t\t/** @deprecated non-standard */\n\t\tvolume?: GainNode;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface MediaStreamConstraints {\n\t\t/** @deprecated non-standard */\n\t\tdesktop?: boolean;\n\t}\n\n\t/** @deprecated browser-specific global */\n\tconst chrome: {\n\t\twebstore: {\n\t\t\tinstall(url: string, onSuccess: () => void, onError: (error: any) => void): void;\n\t\t};\n\t};\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface Window {\n\t\trocketchatscreenshare?: unknown;\n\t\taudioContext?: AudioContext;\n\t}\n}\n\ntype EventData<TStreamName extends StreamNames, TStreamKey extends StreamKeys<TStreamName>, TType> = Extract<\n\tStreamerCallbackArgs<TStreamName, TStreamKey>,\n\t[type: TType, data: any]\n>[1];\n\ntype StatusData = EventData<'notify-room', `${string}/webrtc`, 'status'>;\ntype CallData = EventData<'notify-room-users', `${string}/webrtc`, 'call'>;\ntype CandidateData = EventData<'notify-user', `${string}/webrtc`, 'candidate'>;\ntype DescriptionData = EventData<'notify-user', `${string}/webrtc`, 'description'>;\ntype JoinData = EventData<'notify-user', `${string}/webrtc`, 'join'>;\n\ntype RemoteItem = {\n\tid: string;\n\turl: MediaStream;\n\tstate: RTCIceConnectionState;\n\tstateText?: string;\n\tconnected?: boolean;\n};\n\ntype RemoteConnection = {\n\tid: string;\n\tmedia: MediaStreamConstraints;\n};\n\nclass WebRTCTransportClass extends Emitter<{\n\tstatus: StatusData;\n\tcall: CallData;\n\tcandidate: CandidateData;\n\tdescription: DescriptionData;\n\tjoin: JoinData;\n}> {\n\tpublic debug = false;\n\n\tconstructor(public webrtcInstance: WebRTCClass) {\n\t\tsuper();\n\t\tsdk.stream('notify-room', [`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`], (type, data) => {\n\t\t\tthis.log('WebRTCTransportClass - onRoom', type, data);\n\t\t\tthis.emit(type, data);\n\t\t});\n\t}\n\n\tlog(...args: unknown[]) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log(...args);\n\t\t}\n\t}\n\n\tonUserStream(type: 'candidate', data: CandidateData): void;\n\n\tonUserStream(type: 'description', data: DescriptionData): void;\n\n\tonUserStream(type: 'join', data: JoinData): void;\n\n\tonUserStream(\n\t\t...[type, data]:\n\t\t\t| [type: 'candidate', data: CandidateData]\n\t\t\t| [type: 'description', data: DescriptionData]\n\t\t\t| [type: 'join', data: JoinData]\n\t) {\n\t\tif (data.room !== this.webrtcInstance.room) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('WebRTCTransportClass - onUser', type, data);\n\n\t\tswitch (type) {\n\t\t\tcase 'candidate':\n\t\t\t\tthis.emit('candidate', data);\n\t\t\t\tbreak;\n\t\t\tcase 'description':\n\t\t\t\tthis.emit('description', data);\n\t\t\t\tbreak;\n\t\t\tcase 'join':\n\t\t\t\tthis.emit('join', data);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tstartCall(data: CallData) {\n\t\tthis.log('WebRTCTransportClass - startCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\n\t\tsdk.publish('notify-room-users', [\n\t\t\t`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`,\n\t\t\tWEB_RTC_EVENTS.CALL,\n\t\t\t{\n\t\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\t\troom: this.webrtcInstance.room,\n\t\t\t\tmedia: data.media,\n\t\t\t\tmonitor: data.monitor,\n\t\t\t},\n\t\t]);\n\t}\n\n\tjoinCall(data: JoinData) {\n\t\tthis.log('WebRTCTransportClass - joinCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\n\t\tif (data.monitor === true) {\n\t\t\tsdk.publish('notify-user', [\n\t\t\t\t`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`,\n\t\t\t\tWEB_RTC_EVENTS.JOIN,\n\t\t\t\t{\n\t\t\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\t\t\troom: this.webrtcInstance.room,\n\t\t\t\t\tmedia: data.media,\n\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t},\n\t\t\t]);\n\t\t} else {\n\t\t\tsdk.publish('notify-room-users', [\n\t\t\t\t`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`,\n\t\t\t\tWEB_RTC_EVENTS.JOIN,\n\t\t\t\t{\n\t\t\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\t\t\troom: this.webrtcInstance.room,\n\t\t\t\t\tmedia: data.media,\n\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t},\n\t\t\t]);\n\t\t}\n\t}\n\n\tsendCandidate(data: CandidateData) {\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tdata.room = this.webrtcInstance.room;\n\t\tthis.log('WebRTCTransportClass - sendCandidate', data);\n\t\tsdk.publish('notify-user', [`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.CANDIDATE, data]);\n\t}\n\n\tsendDescription(data: DescriptionData) {\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tdata.room = this.webrtcInstance.room;\n\t\tthis.log('WebRTCTransportClass - sendDescription', data);\n\t\tsdk.publish('notify-user', [`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.DESCRIPTION, data]);\n\t}\n\n\tsendStatus(data: StatusData) {\n\t\tthis.log('WebRTCTransportClass - sendStatus', data, this.webrtcInstance.room);\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tsdk.publish('notify-room', [`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.STATUS, data]);\n\t}\n\n\tonRemoteCall(fn: (data: CallData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.CALL, fn);\n\t}\n\n\tonRemoteJoin(fn: (data: JoinData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.JOIN, fn);\n\t}\n\n\tonRemoteCandidate(fn: (data: CandidateData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.CANDIDATE, fn);\n\t}\n\n\tonRemoteDescription(fn: (data: DescriptionData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.DESCRIPTION, fn);\n\t}\n\n\tonRemoteStatus(fn: (data: StatusData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.STATUS, fn);\n\t}\n}\n\nclass WebRTCClass {\n\ttransport: WebRTCTransportClass;\n\n\tconfig: { iceServers: RTCIceServer[] };\n\n\tdebug: boolean;\n\n\tTransportClass: typeof WebRTCTransportClass;\n\n\tpeerConnections: Record<string, RTCPeerConnection> = {};\n\n\tremoteItems: ReactiveVar<RemoteItem[]>;\n\n\tremoteItemsById: ReactiveVar<Record<string, RemoteItem>>;\n\n\tcallInProgress: ReactiveVar<boolean>;\n\n\taudioEnabled: ReactiveVar<boolean>;\n\n\tvideoEnabled: ReactiveVar<boolean>;\n\n\toverlayEnabled: ReactiveVar<boolean>;\n\n\tscreenShareEnabled: ReactiveVar<boolean>;\n\n\tlocalUrl: ReactiveVar<MediaStream | undefined>;\n\n\tactive: boolean;\n\n\tremoteMonitoring: boolean;\n\n\tmonitor: boolean;\n\n\tnavigator: string | undefined;\n\n\tscreenShareAvailable: boolean;\n\n\tmedia: MediaStreamConstraints;\n\n\tconstructor(public selfId: string, public room: string, public autoAccept = false) {\n\t\tthis.config = {\n\t\t\ticeServers: [],\n\t\t};\n\t\tthis.debug = false;\n\t\tthis.TransportClass = WebRTCTransportClass;\n\t\tlet servers = settings.get<string>('WebRTC_Servers');\n\t\tif (servers && servers.trim() !== '') {\n\t\t\tservers = servers.replace(/\\s/g, '');\n\n\t\t\tservers.split(',').forEach((server) => {\n\t\t\t\tconst parts = server.split('@');\n\t\t\t\tconst serverConfig: RTCIceServer = {\n\t\t\t\t\turls: parts.pop()!,\n\t\t\t\t};\n\t\t\t\tif (parts.length === 1) {\n\t\t\t\t\tconst [username, credential] = parts[0].split(':');\n\t\t\t\t\tserverConfig.username = decodeURIComponent(username);\n\t\t\t\t\tserverConfig.credential = decodeURIComponent(credential);\n\t\t\t\t}\n\t\t\t\tthis.config.iceServers.push(serverConfig);\n\t\t\t});\n\t\t}\n\t\tthis.peerConnections = {};\n\t\tthis.remoteItems = new ReactiveVar([]);\n\t\tthis.remoteItemsById = new ReactiveVar({});\n\t\tthis.callInProgress = new ReactiveVar(false);\n\t\tthis.audioEnabled = new ReactiveVar(false);\n\t\tthis.videoEnabled = new ReactiveVar(false);\n\t\tthis.overlayEnabled = new ReactiveVar(false);\n\t\tthis.screenShareEnabled = new ReactiveVar(false);\n\t\tthis.localUrl = new ReactiveVar(undefined);\n\t\tthis.active = false;\n\t\tthis.remoteMonitoring = false;\n\t\tthis.monitor = false;\n\t\tthis.navigator = undefined;\n\t\tconst userAgent = navigator.userAgent.toLocaleLowerCase();\n\n\t\tif (userAgent.indexOf('electron') !== -1) {\n\t\t\tthis.navigator = 'electron';\n\t\t} else if (userAgent.indexOf('chrome') !== -1) {\n\t\t\tthis.navigator = 'chrome';\n\t\t} else if (userAgent.indexOf('firefox') !== -1) {\n\t\t\tthis.navigator = 'firefox';\n\t\t} else if (userAgent.indexOf('safari') !== -1) {\n\t\t\tthis.navigator = 'safari';\n\t\t}\n\n\t\tthis.screenShareAvailable = ['chrome', 'firefox', 'electron'].includes(this.navigator!);\n\t\tthis.media = {\n\t\t\tvideo: true,\n\t\t\taudio: true,\n\t\t};\n\t\tthis.transport = new this.TransportClass(this);\n\t\tthis.transport.onRemoteCall(this.onRemoteCall.bind(this));\n\t\tthis.transport.onRemoteJoin(this.onRemoteJoin.bind(this));\n\t\tthis.transport.onRemoteCandidate(this.onRemoteCandidate.bind(this));\n\t\tthis.transport.onRemoteDescription(this.onRemoteDescription.bind(this));\n\t\tthis.transport.onRemoteStatus(this.onRemoteStatus.bind(this));\n\n\t\tsetInterval(this.checkPeerConnections.bind(this), 1000);\n\t}\n\n\tonUserStream(type: 'candidate', data: CandidateData): void;\n\n\tonUserStream(type: 'description', data: DescriptionData): void;\n\n\tonUserStream(type: 'join', data: JoinData): void;\n\n\tonUserStream(\n\t\t...[type, data]:\n\t\t\t| [type: 'candidate', data: CandidateData]\n\t\t\t| [type: 'description', data: DescriptionData]\n\t\t\t| [type: 'join', data: JoinData]\n\t) {\n\t\tswitch (type) {\n\t\t\tcase 'candidate':\n\t\t\t\tthis.transport.onUserStream('candidate', data);\n\t\t\t\tbreak;\n\n\t\t\tcase 'description':\n\t\t\t\tthis.transport.onUserStream('description', data);\n\t\t\t\tbreak;\n\n\t\t\tcase 'join':\n\t\t\t\tthis.transport.onUserStream('join', data);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tlog(...args: unknown[]) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log(...args);\n\t\t}\n\t}\n\n\tonError(...args: unknown[]) {\n\t\tconsole.error(...args);\n\t}\n\n\tcheckPeerConnections() {\n\t\tconst { peerConnections } = this;\n\t\tconst date = Date.now();\n\t\tObject.entries(peerConnections).some(([id, peerConnection]) => {\n\t\t\tif (!['connected', 'completed'].includes(peerConnection.iceConnectionState) && peerConnection.createdAt + 5000 < date) {\n\t\t\t\tthis.stopPeerConnection(id);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tupdateRemoteItems() {\n\t\tconst items: RemoteItem[] = [];\n\t\tconst itemsById: Record<string, RemoteItem> = {};\n\t\tconst { peerConnections } = this;\n\n\t\tObject.entries(peerConnections).forEach(([id, peerConnection]) => {\n\t\t\tpeerConnection.getRemoteStreams().forEach((remoteStream) => {\n\t\t\t\tconst item: RemoteItem = {\n\t\t\t\t\tid,\n\t\t\t\t\turl: remoteStream,\n\t\t\t\t\tstate: peerConnection.iceConnectionState,\n\t\t\t\t};\n\t\t\t\tswitch (peerConnection.iceConnectionState) {\n\t\t\t\t\tcase 'checking':\n\t\t\t\t\t\titem.stateText = 'Connecting...';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'connected':\n\t\t\t\t\tcase 'completed':\n\t\t\t\t\t\titem.stateText = 'Connected';\n\t\t\t\t\t\titem.connected = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'disconnected':\n\t\t\t\t\t\titem.stateText = 'Disconnected';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'failed':\n\t\t\t\t\t\titem.stateText = 'Failed';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'closed':\n\t\t\t\t\t\titem.stateText = 'Closed';\n\t\t\t\t}\n\t\t\t\titems.push(item);\n\t\t\t\titemsById[id] = item;\n\t\t\t});\n\t\t});\n\t\tthis.remoteItems.set(items);\n\t\tthis.remoteItemsById.set(itemsById);\n\t}\n\n\tresetCallInProgress = () => {\n\t\tthis.callInProgress.set(false);\n\t};\n\n\tbroadcastStatus() {\n\t\tif (this.active !== true || this.monitor === true || this.remoteMonitoring === true) {\n\t\t\treturn;\n\t\t}\n\t\tconst remoteConnections: RemoteConnection[] = [];\n\t\tconst { peerConnections } = this;\n\t\tObject.entries(peerConnections).forEach(([id, { remoteMedia: media }]) => {\n\t\t\tremoteConnections.push({\n\t\t\t\tid,\n\t\t\t\tmedia,\n\t\t\t});\n\t\t});\n\n\t\tthis.transport.sendStatus({\n\t\t\tmedia: this.media,\n\t\t\tremoteConnections,\n\t\t});\n\t}\n\n\tcallInProgressTimeout: ReturnType<typeof setTimeout> | undefined = undefined;\n\n\tonRemoteStatus(data: StatusData) {\n\t\t// this.log(onRemoteStatus, arguments);\n\t\tthis.callInProgress.set(true);\n\t\tclearTimeout(this.callInProgressTimeout);\n\t\tthis.callInProgressTimeout = setTimeout(this.resetCallInProgress, 2000);\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tconst remoteConnections = [\n\t\t\t{\n\t\t\t\tid: data.from!,\n\t\t\t\tmedia: data.media,\n\t\t\t},\n\t\t\t...data.remoteConnections,\n\t\t];\n\n\t\tremoteConnections.forEach((remoteConnection) => {\n\t\t\tif (remoteConnection.id !== this.selfId && this.peerConnections[remoteConnection.id] == null) {\n\t\t\t\tthis.log('reconnecting with', remoteConnection.id);\n\t\t\t\tthis.onRemoteJoin({\n\t\t\t\t\tfrom: remoteConnection.id,\n\t\t\t\t\tmedia: remoteConnection.media,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tgetPeerConnection(id: string) {\n\t\tif (this.peerConnections[id] != null) {\n\t\t\treturn this.peerConnections[id];\n\t\t}\n\t\tconst peerConnection = new RTCPeerConnection(this.config);\n\n\t\tpeerConnection.createdAt = Date.now();\n\t\tpeerConnection.remoteMedia = {};\n\t\tthis.peerConnections[id] = peerConnection;\n\t\tconst eventNames = [\n\t\t\t'icecandidate',\n\t\t\t'addstream',\n\t\t\t'removestream',\n\t\t\t'iceconnectionstatechange',\n\t\t\t'datachannel',\n\t\t\t'identityresult',\n\t\t\t'idpassertionerror',\n\t\t\t'idpvalidationerror',\n\t\t\t'negotiationneeded',\n\t\t\t'peeridentity',\n\t\t\t'signalingstatechange',\n\t\t];\n\n\t\teventNames.forEach((eventName) => {\n\t\t\tpeerConnection.addEventListener(eventName, (e) => {\n\t\t\t\tthis.log(id, e.type, e);\n\t\t\t});\n\t\t});\n\n\t\tpeerConnection.addEventListener('icecandidate', (e) => {\n\t\t\tif (e.candidate == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.transport.sendCandidate({\n\t\t\t\tto: id,\n\t\t\t\tcandidate: {\n\t\t\t\t\tcandidate: e.candidate.candidate,\n\t\t\t\t\tsdpMLineIndex: e.candidate.sdpMLineIndex,\n\t\t\t\t\tsdpMid: e.candidate.sdpMid,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t\tpeerConnection.addEventListener('addstream', () => {\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\tpeerConnection.addEventListener('removestream', () => {\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\tpeerConnection.addEventListener('iceconnectionstatechange', () => {\n\t\t\tif (\n\t\t\t\t(peerConnection.iceConnectionState === 'disconnected' || peerConnection.iceConnectionState === 'closed') &&\n\t\t\t\tpeerConnection === this.peerConnections[id]\n\t\t\t) {\n\t\t\t\tthis.stopPeerConnection(id);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (Object.keys(this.peerConnections).length === 0) {\n\t\t\t\t\t\tthis.stop();\n\t\t\t\t\t}\n\t\t\t\t}, 3000);\n\t\t\t}\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\treturn peerConnection;\n\t}\n\n\taudioContext: AudioContext | undefined;\n\n\t_getUserMedia(media: MediaStreamConstraints, onSuccess: (stream: MediaStream) => void, onError: (error?: any) => void) {\n\t\tconst onSuccessLocal = (stream: MediaStream) => {\n\t\t\tif (AudioContext && stream.getAudioTracks().length > 0) {\n\t\t\t\tconst audioContext = new AudioContext();\n\t\t\t\tconst source = audioContext.createMediaStreamSource(stream);\n\t\t\t\tconst volume = audioContext.createGain();\n\t\t\t\tsource.connect(volume);\n\t\t\t\tconst peer = audioContext.createMediaStreamDestination();\n\t\t\t\tvolume.connect(peer);\n\t\t\t\tvolume.gain.value = 0.6;\n\t\t\t\tstream.removeTrack(stream.getAudioTracks()[0]);\n\t\t\t\tstream.addTrack(peer.stream.getAudioTracks()[0]);\n\t\t\t\tstream.volume = volume;\n\t\t\t\tthis.audioContext = audioContext;\n\t\t\t}\n\t\t\tonSuccess(stream);\n\t\t};\n\n\t\tif (navigator.mediaDevices?.getUserMedia) {\n\t\t\treturn navigator.mediaDevices.getUserMedia(media).then(onSuccessLocal).catch(onError);\n\t\t}\n\n\t\tnavigator.getUserMedia?.(media, onSuccessLocal, onError);\n\t}\n\n\tgetUserMedia(media: MediaStreamConstraints, onSuccess: (stream: MediaStream) => void, onError: (error: any) => void = this.onError) {\n\t\tif (media.desktop !== true) {\n\t\t\tvoid this._getUserMedia(media, onSuccess, onError);\n\t\t\treturn;\n\t\t}\n\t\tif (this.screenShareAvailable !== true) {\n\t\t\tconsole.log('Screen share is not avaliable');\n\t\t\treturn;\n\t\t}\n\t\tconst getScreen = (audioStream?: MediaStream) => {\n\t\t\tconst refresh = function () {\n\t\t\t\timperativeModal.open({\n\t\t\t\t\tcomponent: GenericModal,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tvariant: 'warning',\n\t\t\t\t\t\ttitle: t('Refresh_your_page_after_install_to_enable_screen_sharing'),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tconst isChromeExtensionInstalled = this.navigator === 'chrome' && ChromeScreenShare.installed;\n\t\t\tconst isFirefoxExtensionInstalled = this.navigator === 'firefox' && window.rocketchatscreenshare != null;\n\n\t\t\tif (!isChromeExtensionInstalled && !isFirefoxExtensionInstalled) {\n\t\t\t\timperativeModal.open({\n\t\t\t\t\tcomponent: GenericModal,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttitle: t('Screen_Share'),\n\t\t\t\t\t\tvariant: 'warning',\n\t\t\t\t\t\tconfirmText: t('Install_Extension'),\n\t\t\t\t\t\tcancelText: t('Cancel'),\n\t\t\t\t\t\tchildren: t('You_need_install_an_extension_to_allow_screen_sharing'),\n\t\t\t\t\t\tonConfirm: () => {\n\t\t\t\t\t\t\tif (this.navigator === 'chrome') {\n\t\t\t\t\t\t\t\tconst url = 'https://chrome.google.com/webstore/detail/rocketchat-screen-share/nocfbnnmjnndkbipkabodnheejiegccf';\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tchrome.webstore.install(url, refresh, () => {\n\t\t\t\t\t\t\t\t\t\twindow.open(url);\n\t\t\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} catch (_error) {\n\t\t\t\t\t\t\t\t\tconsole.log(_error);\n\t\t\t\t\t\t\t\t\twindow.open(url);\n\t\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (this.navigator === 'firefox') {\n\t\t\t\t\t\t\t\twindow.open('https://addons.mozilla.org/en-GB/firefox/addon/rocketchat-screen-share/');\n\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\treturn onError(false);\n\t\t\t}\n\n\t\t\tconst getScreenSuccess = (stream: MediaStream) => {\n\t\t\t\tif (audioStream != null) {\n\t\t\t\t\tstream.addTrack(audioStream.getAudioTracks()[0]);\n\t\t\t\t}\n\t\t\t\tonSuccess(stream);\n\t\t\t};\n\t\t\tif (this.navigator === 'firefox') {\n\t\t\t\tmedia = {\n\t\t\t\t\taudio: media.audio,\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tmozMediaSource: 'window',\n\t\t\t\t\t\tmediaSource: 'window',\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tvoid this._getUserMedia(media, getScreenSuccess, onError);\n\t\t\t} else {\n\t\t\t\tChromeScreenShare.getSourceId(this.navigator!, (id) => {\n\t\t\t\t\tmedia = {\n\t\t\t\t\t\taudio: false,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\t\tchromeMediaSource: 'desktop',\n\t\t\t\t\t\t\t\tchromeMediaSourceId: id,\n\t\t\t\t\t\t\t\tmaxWidth: 1280,\n\t\t\t\t\t\t\t\tmaxHeight: 720,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t\tvoid this._getUserMedia(media, getScreenSuccess, onError);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tif (this.navigator === 'firefox' || media.audio == null || media.audio === false) {\n\t\t\tgetScreen();\n\t\t} else {\n\t\t\tconst getAudioSuccess = (audioStream: MediaStream) => {\n\t\t\t\tgetScreen(audioStream);\n\t\t\t};\n\t\t\tconst getAudioError = () => {\n\t\t\t\tgetScreen();\n\t\t\t};\n\n\t\t\tvoid this._getUserMedia(\n\t\t\t\t{\n\t\t\t\t\taudio: media.audio,\n\t\t\t\t},\n\t\t\t\tgetAudioSuccess,\n\t\t\t\tgetAudioError,\n\t\t\t);\n\t\t}\n\t}\n\n\tgetLocalUserMedia(callback: (...args: any[]) => void, ...args: unknown[]) {\n\t\tthis.log('getLocalUserMedia', [callback, ...args]);\n\t\tif (this.localStream != null) {\n\t\t\treturn callback(null, this.localStream);\n\t\t}\n\t\tconst onSuccess = (stream: MediaStream) => {\n\t\t\tthis.localStream = stream;\n\t\t\t!this.audioEnabled.get() && this.disableAudio();\n\t\t\t!this.videoEnabled.get() && this.disableVideo();\n\t\t\tthis.localUrl.set(stream);\n\t\t\tconst { peerConnections } = this;\n\t\t\tObject.entries(peerConnections).forEach(([, peerConnection]) => peerConnection.addStream(stream));\n\t\t\tdocument.querySelector<HTMLVideoElement>('video#localVideo')!.srcObject = stream;\n\t\t\tcallback(null, this.localStream);\n\t\t};\n\t\tconst onError = (error: any) => {\n\t\t\tcallback(false);\n\t\t\tthis.onError(error);\n\t\t};\n\t\tthis.getUserMedia(this.media, onSuccess, onError);\n\t}\n\n\tstopPeerConnection = (id: string) => {\n\t\tconst peerConnection = this.peerConnections[id];\n\t\tif (peerConnection == null) {\n\t\t\treturn;\n\t\t}\n\t\tdelete this.peerConnections[id];\n\t\tpeerConnection.close();\n\t\tthis.updateRemoteItems();\n\t};\n\n\tstopAllPeerConnections() {\n\t\tconst { peerConnections } = this;\n\n\t\tObject.keys(peerConnections).forEach(this.stopPeerConnection);\n\n\t\tvoid window.audioContext?.close(); // FIXME: probably should be `this.audioContext`\n\t}\n\n\tsetAudioEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.localStream.getAudioTracks().forEach((audio) => {\n\t\t\t\taudio.enabled = enabled;\n\t\t\t});\n\t\t\tthis.audioEnabled.set(enabled);\n\t\t}\n\t}\n\n\tdisableAudio() {\n\t\tthis.setAudioEnabled(false);\n\t}\n\n\tenableAudio() {\n\t\tthis.setAudioEnabled(true);\n\t}\n\n\ttoggleAudio() {\n\t\tif (this.audioEnabled.get()) {\n\t\t\treturn this.disableAudio();\n\t\t}\n\t\treturn this.enableAudio();\n\t}\n\n\tlocalStream: MediaStream | undefined;\n\n\tsetVideoEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.localStream.getVideoTracks().forEach((video) => {\n\t\t\t\tvideo.enabled = enabled;\n\t\t\t});\n\t\t\tthis.videoEnabled.set(enabled);\n\t\t}\n\t}\n\n\tdisableScreenShare() {\n\t\tthis.setScreenShareEnabled(false);\n\t}\n\n\tenableScreenShare() {\n\t\tthis.setScreenShareEnabled(true);\n\t}\n\n\tsetScreenShareEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.media.desktop = enabled;\n\t\t\tdelete this.localStream;\n\t\t\tthis.getLocalUserMedia((err) => {\n\t\t\t\tif (err != null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.screenShareEnabled.set(enabled);\n\t\t\t\tthis.stopAllPeerConnections();\n\t\t\t\tthis.joinCall();\n\t\t\t});\n\t\t}\n\t}\n\n\tdisableVideo() {\n\t\tthis.setVideoEnabled(false);\n\t}\n\n\tenableVideo() {\n\t\tthis.setVideoEnabled(true);\n\t}\n\n\ttoggleVideo() {\n\t\tif (this.videoEnabled.get()) {\n\t\t\treturn this.disableVideo();\n\t\t}\n\t\treturn this.enableVideo();\n\t}\n\n\tstop() {\n\t\tthis.active = false;\n\t\tthis.monitor = false;\n\t\tthis.remoteMonitoring = false;\n\t\tif (this.localStream != null && typeof this.localStream !== 'undefined') {\n\t\t\tthis.localStream.getTracks().forEach((track) => track.stop());\n\t\t}\n\t\tthis.localUrl.set(undefined);\n\t\tdelete this.localStream;\n\t\tthis.stopAllPeerConnections();\n\t}\n\n\tstartCall(media: MediaStreamConstraints = {}, ...args: unknown[]) {\n\t\tthis.log('startCall', [media, ...args]);\n\t\tthis.media = media;\n\t\tthis.getLocalUserMedia(() => {\n\t\t\tthis.active = true;\n\t\t\tthis.transport.startCall({\n\t\t\t\tmedia: this.media,\n\t\t\t});\n\t\t});\n\t}\n\n\tstartCallAsMonitor(media: MediaStreamConstraints = {}, ...args: unknown[]) {\n\t\tthis.log('startCallAsMonitor', [media, ...args]);\n\t\tthis.media = media;\n\t\tthis.active = true;\n\t\tthis.monitor = true;\n\t\tthis.transport.startCall({\n\t\t\tmedia: this.media,\n\t\t\tmonitor: true,\n\t\t});\n\t}\n\n\tonRemoteCall(data: CallData) {\n\t\tif (this.autoAccept === true) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.joinCall({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t\tmedia: data.media,\n\t\t\t\t});\n\t\t\t}, 0);\n\t\t\treturn;\n\t\t}\n\n\t\tconst user = Meteor.users.findOne(data.from);\n\t\tlet fromUsername = undefined;\n\t\tif (user?.username) {\n\t\t\tfromUsername = user.username;\n\t\t}\n\t\tconst subscription = ChatSubscription.findOne({\n\t\t\trid: data.room,\n\t\t})!;\n\n\t\tlet icon;\n\t\tlet title;\n\t\tif (data.monitor === true) {\n\t\t\ticon = 'eye' as const;\n\t\t\ttitle = t('WebRTC_monitor_call_from_%s', fromUsername);\n\t\t} else if (subscription && subscription.t === 'd') {\n\t\t\tif (data.media?.video) {\n\t\t\t\ticon = 'video' as const;\n\t\t\t\ttitle = t('WebRTC_direct_video_call_from_%s', fromUsername);\n\t\t\t} else {\n\t\t\t\ticon = 'phone' as const;\n\t\t\t\ttitle = t('WebRTC_direct_audio_call_from_%s', fromUsername);\n\t\t\t}\n\t\t} else if (data.media?.video) {\n\t\t\ticon = 'video' as const;\n\t\t\ttitle = t('WebRTC_group_video_call_from_%s', subscription.name);\n\t\t} else {\n\t\t\ticon = 'phone' as const;\n\t\t\ttitle = t('WebRTC_group_audio_call_from_%s', subscription.name);\n\t\t}\n\n\t\timperativeModal.open({\n\t\t\tcomponent: GenericModal,\n\t\t\tprops: {\n\t\t\t\ttitle,\n\t\t\t\ticon,\n\t\t\t\tconfirmText: t('Yes'),\n\t\t\t\tcancelText: t('No'),\n\t\t\t\tchildren: t('Do_you_want_to_accept'),\n\t\t\t\tonConfirm: () => {\n\t\t\t\t\tvoid goToRoomById(data.room!);\n\t\t\t\t\treturn this.joinCall({\n\t\t\t\t\t\tto: data.from,\n\t\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t\t\tmedia: data.media,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonCancel: () => this.stop(),\n\t\t\t\tonClose: () => this.stop(),\n\t\t\t},\n\t\t});\n\t}\n\n\tjoinCall(data: JoinData = {}, ...args: unknown[]) {\n\t\tdata.media = this.media;\n\t\tthis.log('joinCall', [data, ...args]);\n\t\tthis.getLocalUserMedia(() => {\n\t\t\tthis.remoteMonitoring = data.monitor!;\n\t\t\tthis.active = true;\n\t\t\tthis.transport.joinCall(data);\n\t\t});\n\t}\n\n\tonRemoteJoin(data: JoinData, ...args: unknown[]) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteJoin', [data, ...args]);\n\t\tlet peerConnection = this.getPeerConnection(data.from!);\n\n\t\t// needsRefresh = false\n\t\t// if peerConnection.iceConnectionState isnt 'new'\n\t\t// needsAudio = data.media.audio is true and peerConnection.remoteMedia.audio isnt true\n\t\t// needsVideo = data.media.video is true and peerConnection.remoteMedia.video isnt true\n\t\t// needsRefresh = needsAudio or needsVideo or data.media.desktop isnt peerConnection.remoteMedia.desktop\n\n\t\t// # if peerConnection.signalingState is \"have-local-offer\" or needsRefresh\n\n\t\tif ((peerConnection.signalingState as RTCSignalingState | 'checking') !== 'checking') {\n\t\t\tthis.stopPeerConnection(data.from!);\n\t\t\tpeerConnection = this.getPeerConnection(data.from!);\n\t\t}\n\t\tif (peerConnection.iceConnectionState !== 'new') {\n\t\t\treturn;\n\t\t}\n\t\tpeerConnection.remoteMedia = data.media!;\n\t\tif (this.localStream) {\n\t\t\tpeerConnection.addStream(this.localStream);\n\t\t}\n\t\tconst onOffer: RTCSessionDescriptionCallback = (offer) => {\n\t\t\tconst onLocalDescription = () => {\n\t\t\t\tthis.transport.sendDescription({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\ttype: 'offer',\n\t\t\t\t\tts: peerConnection.createdAt,\n\t\t\t\t\tmedia: this.media,\n\t\t\t\t\tdescription: {\n\t\t\t\t\t\tsdp: offer.sdp,\n\t\t\t\t\t\ttype: offer.type,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tvoid peerConnection.setLocalDescription(new RTCSessionDescription(offer), onLocalDescription, this.onError);\n\t\t};\n\n\t\tif (data.monitor === true) {\n\t\t\tvoid peerConnection.createOffer(onOffer, this.onError, {\n\t\t\t\tmandatory: {\n\t\t\t\t\tOfferToReceiveAudio: data.media?.audio,\n\t\t\t\t\tOfferToReceiveVideo: data.media?.video,\n\t\t\t\t},\n\t\t\t});\n\t\t} else {\n\t\t\tvoid peerConnection.createOffer(onOffer, this.onError);\n\t\t}\n\t}\n\n\tonRemoteOffer(data: Omit<DescriptionData, 'type'>, ...args: unknown[]) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('onRemoteOffer', [data, ...args]);\n\t\tlet peerConnection = this.getPeerConnection(data.from!);\n\n\t\tif (['have-local-offer', 'stable'].includes(peerConnection.signalingState) && peerConnection.createdAt < data.ts) {\n\t\t\tthis.stopPeerConnection(data.from!);\n\t\t\tpeerConnection = this.getPeerConnection(data.from!);\n\t\t}\n\n\t\tif (peerConnection.iceConnectionState !== 'new') {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid peerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\n\n\t\ttry {\n\t\t\tif (this.localStream) {\n\t\t\t\tpeerConnection.addStream(this.localStream);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t}\n\n\t\tconst onAnswer: RTCSessionDescriptionCallback = (answer) => {\n\t\t\tconst onLocalDescription = () => {\n\t\t\t\tthis.transport.sendDescription({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tts: peerConnection.createdAt,\n\t\t\t\t\tdescription: {\n\t\t\t\t\t\tsdp: answer.sdp,\n\t\t\t\t\t\ttype: answer.type,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tvoid peerConnection.setLocalDescription(new RTCSessionDescription(answer), onLocalDescription, this.onError);\n\t\t};\n\n\t\tvoid peerConnection.createAnswer(onAnswer, this.onError);\n\t}\n\n\tonRemoteCandidate(data: CandidateData, ...args: unknown[]) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tif (data.to !== this.selfId) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteCandidate', [data, ...args]);\n\t\tconst peerConnection = this.getPeerConnection(data.from!);\n\t\tif (\n\t\t\tpeerConnection.iceConnectionState !== 'closed' &&\n\t\t\tpeerConnection.iceConnectionState !== 'failed' &&\n\t\t\tpeerConnection.iceConnectionState !== 'disconnected' &&\n\t\t\tpeerConnection.iceConnectionState !== 'completed'\n\t\t) {\n\t\t\tvoid peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));\n\t\t}\n\t\tdocument.querySelector<HTMLVideoElement>('video#remoteVideo')!.srcObject = this.remoteItems.get()[0]?.url;\n\t}\n\n\tonRemoteDescription(data: DescriptionData, ...args: unknown[]) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tif (data.to !== this.selfId) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteDescription', [data, ...args]);\n\t\tconst peerConnection = this.getPeerConnection(data.from!);\n\t\tif (data.type === 'offer') {\n\t\t\tpeerConnection.remoteMedia = data.media;\n\t\t\tthis.onRemoteOffer({\n\t\t\t\tfrom: data.from,\n\t\t\t\tts: data.ts,\n\t\t\t\tdescription: data.description,\n\t\t\t});\n\t\t} else {\n\t\t\tvoid peerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\n\t\t}\n\t}\n}\n\nconst WebRTC = new (class {\n\tinstancesByRoomId: Record<string, WebRTCClass> = {};\n\n\tconstructor() {\n\t\tthis.instancesByRoomId = {};\n\t}\n\n\tgetInstanceByRoomId(rid: IRoom['_id'], visitorId: string | null = null) {\n\t\tlet enabled = false;\n\t\tif (!visitorId) {\n\t\t\tconst subscription = ChatSubscription.findOne({ rid });\n\t\t\tif (!subscription) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tswitch (subscription.t) {\n\t\t\t\tcase 'd':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Direct');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'p':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Private');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'c':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Channel');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'l':\n\t\t\t\t\tenabled = settings.get<string>('Omnichannel_call_provider') === 'WebRTC';\n\t\t\t}\n\t\t} else {\n\t\t\tenabled = settings.get<string>('Omnichannel_call_provider') === 'WebRTC';\n\t\t}\n\t\tenabled = enabled && settings.get('WebRTC_Enabled');\n\t\tif (enabled === false) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.instancesByRoomId[rid] == null) {\n\t\t\tlet uid = Meteor.userId()!;\n\t\t\tlet autoAccept = false;\n\t\t\tif (visitorId) {\n\t\t\t\tuid = visitorId;\n\t\t\t\tautoAccept = true;\n\t\t\t}\n\t\t\tthis.instancesByRoomId[rid] = new WebRTCClass(uid, rid, autoAccept);\n\t\t}\n\t\treturn this.instancesByRoomId[rid];\n\t}\n})();\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (uid) {\n\t\t\tsdk.stream('notify-user', [`${uid}/${WEB_RTC_EVENTS.WEB_RTC}`], (type, data) => {\n\t\t\t\tif (data.room == null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst webrtc = WebRTC.getInstanceByRoomId(data.room);\n\n\t\t\t\tswitch (type) {\n\t\t\t\t\tcase 'candidate':\n\t\t\t\t\t\twebrtc?.onUserStream('candidate', data);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'description':\n\t\t\t\t\t\twebrtc?.onUserStream('description', data);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'join':\n\t\t\t\t\t\twebrtc?.onUserStream('join', data);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n});\n\nexport { WebRTC };\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"production","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/webrtc/client/WebRTCClass.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/webrtc/client/WebRTCClass.ts","inputSourceMap":{"version":3,"file":"app/webrtc/client/WebRTCClass.ts","sourceRoot":"","sources":["app/webrtc/client/WebRTCClass.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport type { StreamKeys, StreamNames, StreamerCallbackArgs } from '@rocket.chat/ddp-client';\nimport { Emitter } from '@rocket.chat/emitter';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Tracker } from 'meteor/tracker';\n\nimport GenericModal from '../../../client/components/GenericModal';\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\nimport { goToRoomById } from '../../../client/lib/utils/goToRoomById';\nimport { ChatSubscription } from '../../models/client';\nimport { settings } from '../../settings/client';\nimport { sdk } from '../../utils/client/lib/SDKClient';\nimport { t } from '../../utils/lib/i18n';\nimport { WEB_RTC_EVENTS } from '../lib/constants';\nimport { ChromeScreenShare } from './screenShare';\n\n// FIXME: there is a mix of obsolete definitions and incorrect field assignments\n\ndeclare global {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface RTCPeerConnection {\n\t\t/** @deprecated non-standard */\n\t\tcreatedAt: number;\n\t\t/** @deprecated non-standard */\n\t\tremoteMedia: MediaStreamConstraints;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface RTCOfferOptions {\n\t\t/** @deprecated non-standard */\n\t\tmandatory?: unknown;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface MediaStream {\n\t\t/** @deprecated non-standard */\n\t\tvolume?: GainNode;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface MediaStreamConstraints {\n\t\t/** @deprecated non-standard */\n\t\tdesktop?: boolean;\n\t}\n\n\t/** @deprecated browser-specific global */\n\tconst chrome: {\n\t\twebstore: {\n\t\t\tinstall(url: string, onSuccess: () => void, onError: (error: any) => void): void;\n\t\t};\n\t};\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface Window {\n\t\trocketchatscreenshare?: unknown;\n\t\taudioContext?: AudioContext;\n\t}\n}\n\ntype EventData<TStreamName extends StreamNames, TStreamKey extends StreamKeys<TStreamName>, TType> = Extract<\n\tStreamerCallbackArgs<TStreamName, TStreamKey>,\n\t[type: TType, data: any]\n>[1];\n\ntype StatusData = EventData<'notify-room', `${string}/webrtc`, 'status'>;\ntype CallData = EventData<'notify-room-users', `${string}/webrtc`, 'call'>;\ntype CandidateData = EventData<'notify-user', `${string}/webrtc`, 'candidate'>;\ntype DescriptionData = EventData<'notify-user', `${string}/webrtc`, 'description'>;\ntype JoinData = EventData<'notify-user', `${string}/webrtc`, 'join'>;\n\ntype RemoteItem = {\n\tid: string;\n\turl: MediaStream;\n\tstate: RTCIceConnectionState;\n\tstateText?: string;\n\tconnected?: boolean;\n};\n\ntype RemoteConnection = {\n\tid: string;\n\tmedia: MediaStreamConstraints;\n};\n\nclass WebRTCTransportClass extends Emitter<{\n\tstatus: StatusData;\n\tcall: CallData;\n\tcandidate: CandidateData;\n\tdescription: DescriptionData;\n\tjoin: JoinData;\n}> {\n\tpublic debug = false;\n\n\tconstructor(public webrtcInstance: WebRTCClass) {\n\t\tsuper();\n\t\tsdk.stream('notify-room', [`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`], (type, data) => {\n\t\t\tthis.log('WebRTCTransportClass - onRoom', type, data);\n\t\t\tthis.emit(type, data);\n\t\t});\n\t}\n\n\tlog(...args: unknown[]) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log(...args);\n\t\t}\n\t}\n\n\tonUserStream(type: 'candidate', data: CandidateData): void;\n\n\tonUserStream(type: 'description', data: DescriptionData): void;\n\n\tonUserStream(type: 'join', data: JoinData): void;\n\n\tonUserStream(\n\t\t...[type, data]:\n\t\t\t| [type: 'candidate', data: CandidateData]\n\t\t\t| [type: 'description', data: DescriptionData]\n\t\t\t| [type: 'join', data: JoinData]\n\t) {\n\t\tif (data.room !== this.webrtcInstance.room) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('WebRTCTransportClass - onUser', type, data);\n\n\t\tswitch (type) {\n\t\t\tcase 'candidate':\n\t\t\t\tthis.emit('candidate', data);\n\t\t\t\tbreak;\n\t\t\tcase 'description':\n\t\t\t\tthis.emit('description', data);\n\t\t\t\tbreak;\n\t\t\tcase 'join':\n\t\t\t\tthis.emit('join', data);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tstartCall(data: CallData) {\n\t\tthis.log('WebRTCTransportClass - startCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\n\t\tsdk.publish('notify-room-users', [\n\t\t\t`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`,\n\t\t\tWEB_RTC_EVENTS.CALL,\n\t\t\t{\n\t\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\t\troom: this.webrtcInstance.room,\n\t\t\t\tmedia: data.media,\n\t\t\t\tmonitor: data.monitor,\n\t\t\t},\n\t\t]);\n\t}\n\n\tjoinCall(data: JoinData) {\n\t\tthis.log('WebRTCTransportClass - joinCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\n\t\tif (data.monitor === true) {\n\t\t\tsdk.publish('notify-user', [\n\t\t\t\t`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`,\n\t\t\t\tWEB_RTC_EVENTS.JOIN,\n\t\t\t\t{\n\t\t\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\t\t\troom: this.webrtcInstance.room,\n\t\t\t\t\tmedia: data.media,\n\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t},\n\t\t\t]);\n\t\t} else {\n\t\t\tsdk.publish('notify-room-users', [\n\t\t\t\t`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`,\n\t\t\t\tWEB_RTC_EVENTS.JOIN,\n\t\t\t\t{\n\t\t\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\t\t\troom: this.webrtcInstance.room,\n\t\t\t\t\tmedia: data.media,\n\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t},\n\t\t\t]);\n\t\t}\n\t}\n\n\tsendCandidate(data: CandidateData) {\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tdata.room = this.webrtcInstance.room;\n\t\tthis.log('WebRTCTransportClass - sendCandidate', data);\n\t\tsdk.publish('notify-user', [`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.CANDIDATE, data]);\n\t}\n\n\tsendDescription(data: DescriptionData) {\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tdata.room = this.webrtcInstance.room;\n\t\tthis.log('WebRTCTransportClass - sendDescription', data);\n\t\tsdk.publish('notify-user', [`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.DESCRIPTION, data]);\n\t}\n\n\tsendStatus(data: StatusData) {\n\t\tthis.log('WebRTCTransportClass - sendStatus', data, this.webrtcInstance.room);\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tsdk.publish('notify-room', [`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.STATUS, data]);\n\t}\n\n\tonRemoteCall(fn: (data: CallData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.CALL, fn);\n\t}\n\n\tonRemoteJoin(fn: (data: JoinData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.JOIN, fn);\n\t}\n\n\tonRemoteCandidate(fn: (data: CandidateData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.CANDIDATE, fn);\n\t}\n\n\tonRemoteDescription(fn: (data: DescriptionData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.DESCRIPTION, fn);\n\t}\n\n\tonRemoteStatus(fn: (data: StatusData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.STATUS, fn);\n\t}\n}\n\nclass WebRTCClass {\n\ttransport: WebRTCTransportClass;\n\n\tconfig: { iceServers: RTCIceServer[] };\n\n\tdebug: boolean;\n\n\tTransportClass: typeof WebRTCTransportClass;\n\n\tpeerConnections: Record<string, RTCPeerConnection> = {};\n\n\tremoteItems: ReactiveVar<RemoteItem[]>;\n\n\tremoteItemsById: ReactiveVar<Record<string, RemoteItem>>;\n\n\tcallInProgress: ReactiveVar<boolean>;\n\n\taudioEnabled: ReactiveVar<boolean>;\n\n\tvideoEnabled: ReactiveVar<boolean>;\n\n\toverlayEnabled: ReactiveVar<boolean>;\n\n\tscreenShareEnabled: ReactiveVar<boolean>;\n\n\tlocalUrl: ReactiveVar<MediaStream | undefined>;\n\n\tactive: boolean;\n\n\tremoteMonitoring: boolean;\n\n\tmonitor: boolean;\n\n\tnavigator: string | undefined;\n\n\tscreenShareAvailable: boolean;\n\n\tmedia: MediaStreamConstraints;\n\n\tconstructor(public selfId: string, public room: string, public autoAccept = false) {\n\t\tthis.config = {\n\t\t\ticeServers: [],\n\t\t};\n\t\tthis.debug = false;\n\t\tthis.TransportClass = WebRTCTransportClass;\n\t\tlet servers = settings.get<string>('WebRTC_Servers');\n\t\tif (servers && servers.trim() !== '') {\n\t\t\tservers = servers.replace(/\\s/g, '');\n\n\t\t\tservers.split(',').forEach((server) => {\n\t\t\t\tconst parts = server.split('@');\n\t\t\t\tconst serverConfig: RTCIceServer = {\n\t\t\t\t\turls: parts.pop()!,\n\t\t\t\t};\n\t\t\t\tif (parts.length === 1) {\n\t\t\t\t\tconst [username, credential] = parts[0].split(':');\n\t\t\t\t\tserverConfig.username = decodeURIComponent(username);\n\t\t\t\t\tserverConfig.credential = decodeURIComponent(credential);\n\t\t\t\t}\n\t\t\t\tthis.config.iceServers.push(serverConfig);\n\t\t\t});\n\t\t}\n\t\tthis.peerConnections = {};\n\t\tthis.remoteItems = new ReactiveVar([]);\n\t\tthis.remoteItemsById = new ReactiveVar({});\n\t\tthis.callInProgress = new ReactiveVar(false);\n\t\tthis.audioEnabled = new ReactiveVar(false);\n\t\tthis.videoEnabled = new ReactiveVar(false);\n\t\tthis.overlayEnabled = new ReactiveVar(false);\n\t\tthis.screenShareEnabled = new ReactiveVar(false);\n\t\tthis.localUrl = new ReactiveVar(undefined);\n\t\tthis.active = false;\n\t\tthis.remoteMonitoring = false;\n\t\tthis.monitor = false;\n\t\tthis.navigator = undefined;\n\t\tconst userAgent = navigator.userAgent.toLocaleLowerCase();\n\n\t\tif (userAgent.indexOf('electron') !== -1) {\n\t\t\tthis.navigator = 'electron';\n\t\t} else if (userAgent.indexOf('chrome') !== -1) {\n\t\t\tthis.navigator = 'chrome';\n\t\t} else if (userAgent.indexOf('firefox') !== -1) {\n\t\t\tthis.navigator = 'firefox';\n\t\t} else if (userAgent.indexOf('safari') !== -1) {\n\t\t\tthis.navigator = 'safari';\n\t\t}\n\n\t\tthis.screenShareAvailable = ['chrome', 'firefox', 'electron'].includes(this.navigator!);\n\t\tthis.media = {\n\t\t\tvideo: true,\n\t\t\taudio: true,\n\t\t};\n\t\tthis.transport = new this.TransportClass(this);\n\t\tthis.transport.onRemoteCall(this.onRemoteCall.bind(this));\n\t\tthis.transport.onRemoteJoin(this.onRemoteJoin.bind(this));\n\t\tthis.transport.onRemoteCandidate(this.onRemoteCandidate.bind(this));\n\t\tthis.transport.onRemoteDescription(this.onRemoteDescription.bind(this));\n\t\tthis.transport.onRemoteStatus(this.onRemoteStatus.bind(this));\n\n\t\tsetInterval(this.checkPeerConnections.bind(this), 1000);\n\t}\n\n\tonUserStream(type: 'candidate', data: CandidateData): void;\n\n\tonUserStream(type: 'description', data: DescriptionData): void;\n\n\tonUserStream(type: 'join', data: JoinData): void;\n\n\tonUserStream(\n\t\t...[type, data]:\n\t\t\t| [type: 'candidate', data: CandidateData]\n\t\t\t| [type: 'description', data: DescriptionData]\n\t\t\t| [type: 'join', data: JoinData]\n\t) {\n\t\tswitch (type) {\n\t\t\tcase 'candidate':\n\t\t\t\tthis.transport.onUserStream('candidate', data);\n\t\t\t\tbreak;\n\n\t\t\tcase 'description':\n\t\t\t\tthis.transport.onUserStream('description', data);\n\t\t\t\tbreak;\n\n\t\t\tcase 'join':\n\t\t\t\tthis.transport.onUserStream('join', data);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tlog(...args: unknown[]) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log(...args);\n\t\t}\n\t}\n\n\tonError(...args: unknown[]) {\n\t\tconsole.error(...args);\n\t}\n\n\tcheckPeerConnections() {\n\t\tconst { peerConnections } = this;\n\t\tconst date = Date.now();\n\t\tObject.entries(peerConnections).some(([id, peerConnection]) => {\n\t\t\tif (!['connected', 'completed'].includes(peerConnection.iceConnectionState) && peerConnection.createdAt + 5000 < date) {\n\t\t\t\tthis.stopPeerConnection(id);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tupdateRemoteItems() {\n\t\tconst items: RemoteItem[] = [];\n\t\tconst itemsById: Record<string, RemoteItem> = {};\n\t\tconst { peerConnections } = this;\n\n\t\tObject.entries(peerConnections).forEach(([id, peerConnection]) => {\n\t\t\tpeerConnection.getRemoteStreams().forEach((remoteStream) => {\n\t\t\t\tconst item: RemoteItem = {\n\t\t\t\t\tid,\n\t\t\t\t\turl: remoteStream,\n\t\t\t\t\tstate: peerConnection.iceConnectionState,\n\t\t\t\t};\n\t\t\t\tswitch (peerConnection.iceConnectionState) {\n\t\t\t\t\tcase 'checking':\n\t\t\t\t\t\titem.stateText = 'Connecting...';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'connected':\n\t\t\t\t\tcase 'completed':\n\t\t\t\t\t\titem.stateText = 'Connected';\n\t\t\t\t\t\titem.connected = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'disconnected':\n\t\t\t\t\t\titem.stateText = 'Disconnected';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'failed':\n\t\t\t\t\t\titem.stateText = 'Failed';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'closed':\n\t\t\t\t\t\titem.stateText = 'Closed';\n\t\t\t\t}\n\t\t\t\titems.push(item);\n\t\t\t\titemsById[id] = item;\n\t\t\t});\n\t\t});\n\t\tthis.remoteItems.set(items);\n\t\tthis.remoteItemsById.set(itemsById);\n\t}\n\n\tresetCallInProgress = () => {\n\t\tthis.callInProgress.set(false);\n\t};\n\n\tbroadcastStatus() {\n\t\tif (this.active !== true || this.monitor === true || this.remoteMonitoring === true) {\n\t\t\treturn;\n\t\t}\n\t\tconst remoteConnections: RemoteConnection[] = [];\n\t\tconst { peerConnections } = this;\n\t\tObject.entries(peerConnections).forEach(([id, { remoteMedia: media }]) => {\n\t\t\tremoteConnections.push({\n\t\t\t\tid,\n\t\t\t\tmedia,\n\t\t\t});\n\t\t});\n\n\t\tthis.transport.sendStatus({\n\t\t\tmedia: this.media,\n\t\t\tremoteConnections,\n\t\t});\n\t}\n\n\tcallInProgressTimeout: ReturnType<typeof setTimeout> | undefined = undefined;\n\n\tonRemoteStatus(data: StatusData) {\n\t\t// this.log(onRemoteStatus, arguments);\n\t\tthis.callInProgress.set(true);\n\t\tclearTimeout(this.callInProgressTimeout);\n\t\tthis.callInProgressTimeout = setTimeout(this.resetCallInProgress, 2000);\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tconst remoteConnections = [\n\t\t\t{\n\t\t\t\tid: data.from!,\n\t\t\t\tmedia: data.media,\n\t\t\t},\n\t\t\t...data.remoteConnections,\n\t\t];\n\n\t\tremoteConnections.forEach((remoteConnection) => {\n\t\t\tif (remoteConnection.id !== this.selfId && this.peerConnections[remoteConnection.id] == null) {\n\t\t\t\tthis.log('reconnecting with', remoteConnection.id);\n\t\t\t\tthis.onRemoteJoin({\n\t\t\t\t\tfrom: remoteConnection.id,\n\t\t\t\t\tmedia: remoteConnection.media,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tgetPeerConnection(id: string) {\n\t\tif (this.peerConnections[id] != null) {\n\t\t\treturn this.peerConnections[id];\n\t\t}\n\t\tconst peerConnection = new RTCPeerConnection(this.config);\n\n\t\tpeerConnection.createdAt = Date.now();\n\t\tpeerConnection.remoteMedia = {};\n\t\tthis.peerConnections[id] = peerConnection;\n\t\tconst eventNames = [\n\t\t\t'icecandidate',\n\t\t\t'addstream',\n\t\t\t'removestream',\n\t\t\t'iceconnectionstatechange',\n\t\t\t'datachannel',\n\t\t\t'identityresult',\n\t\t\t'idpassertionerror',\n\t\t\t'idpvalidationerror',\n\t\t\t'negotiationneeded',\n\t\t\t'peeridentity',\n\t\t\t'signalingstatechange',\n\t\t];\n\n\t\teventNames.forEach((eventName) => {\n\t\t\tpeerConnection.addEventListener(eventName, (e) => {\n\t\t\t\tthis.log(id, e.type, e);\n\t\t\t});\n\t\t});\n\n\t\tpeerConnection.addEventListener('icecandidate', (e) => {\n\t\t\tif (e.candidate == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.transport.sendCandidate({\n\t\t\t\tto: id,\n\t\t\t\tcandidate: {\n\t\t\t\t\tcandidate: e.candidate.candidate,\n\t\t\t\t\tsdpMLineIndex: e.candidate.sdpMLineIndex,\n\t\t\t\t\tsdpMid: e.candidate.sdpMid,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t\tpeerConnection.addEventListener('addstream', () => {\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\tpeerConnection.addEventListener('removestream', () => {\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\tpeerConnection.addEventListener('iceconnectionstatechange', () => {\n\t\t\tif (\n\t\t\t\t(peerConnection.iceConnectionState === 'disconnected' || peerConnection.iceConnectionState === 'closed') &&\n\t\t\t\tpeerConnection === this.peerConnections[id]\n\t\t\t) {\n\t\t\t\tthis.stopPeerConnection(id);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (Object.keys(this.peerConnections).length === 0) {\n\t\t\t\t\t\tthis.stop();\n\t\t\t\t\t}\n\t\t\t\t}, 3000);\n\t\t\t}\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\treturn peerConnection;\n\t}\n\n\taudioContext: AudioContext | undefined;\n\n\t_getUserMedia(media: MediaStreamConstraints, onSuccess: (stream: MediaStream) => void, onError: (error?: any) => void) {\n\t\tconst onSuccessLocal = (stream: MediaStream) => {\n\t\t\tif (AudioContext && stream.getAudioTracks().length > 0) {\n\t\t\t\tconst audioContext = new AudioContext();\n\t\t\t\tconst source = audioContext.createMediaStreamSource(stream);\n\t\t\t\tconst volume = audioContext.createGain();\n\t\t\t\tsource.connect(volume);\n\t\t\t\tconst peer = audioContext.createMediaStreamDestination();\n\t\t\t\tvolume.connect(peer);\n\t\t\t\tvolume.gain.value = 0.6;\n\t\t\t\tstream.removeTrack(stream.getAudioTracks()[0]);\n\t\t\t\tstream.addTrack(peer.stream.getAudioTracks()[0]);\n\t\t\t\tstream.volume = volume;\n\t\t\t\tthis.audioContext = audioContext;\n\t\t\t}\n\t\t\tonSuccess(stream);\n\t\t};\n\n\t\tif (navigator.mediaDevices?.getUserMedia) {\n\t\t\treturn navigator.mediaDevices.getUserMedia(media).then(onSuccessLocal).catch(onError);\n\t\t}\n\n\t\tnavigator.getUserMedia?.(media, onSuccessLocal, onError);\n\t}\n\n\tgetUserMedia(media: MediaStreamConstraints, onSuccess: (stream: MediaStream) => void, onError: (error: any) => void = this.onError) {\n\t\tif (media.desktop !== true) {\n\t\t\tvoid this._getUserMedia(media, onSuccess, onError);\n\t\t\treturn;\n\t\t}\n\t\tif (this.screenShareAvailable !== true) {\n\t\t\tconsole.log('Screen share is not avaliable');\n\t\t\treturn;\n\t\t}\n\t\tconst getScreen = (audioStream?: MediaStream) => {\n\t\t\tconst refresh = function () {\n\t\t\t\timperativeModal.open({\n\t\t\t\t\tcomponent: GenericModal,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tvariant: 'warning',\n\t\t\t\t\t\ttitle: t('Refresh_your_page_after_install_to_enable_screen_sharing'),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tconst isChromeExtensionInstalled = this.navigator === 'chrome' && ChromeScreenShare.installed;\n\t\t\tconst isFirefoxExtensionInstalled = this.navigator === 'firefox' && window.rocketchatscreenshare != null;\n\n\t\t\tif (!isChromeExtensionInstalled && !isFirefoxExtensionInstalled) {\n\t\t\t\timperativeModal.open({\n\t\t\t\t\tcomponent: GenericModal,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttitle: t('Screen_Share'),\n\t\t\t\t\t\tvariant: 'warning',\n\t\t\t\t\t\tconfirmText: t('Install_Extension'),\n\t\t\t\t\t\tcancelText: t('Cancel'),\n\t\t\t\t\t\tchildren: t('You_need_install_an_extension_to_allow_screen_sharing'),\n\t\t\t\t\t\tonConfirm: () => {\n\t\t\t\t\t\t\tif (this.navigator === 'chrome') {\n\t\t\t\t\t\t\t\tconst url = 'https://chrome.google.com/webstore/detail/rocketchat-screen-share/nocfbnnmjnndkbipkabodnheejiegccf';\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tchrome.webstore.install(url, refresh, () => {\n\t\t\t\t\t\t\t\t\t\twindow.open(url);\n\t\t\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} catch (_error) {\n\t\t\t\t\t\t\t\t\tconsole.log(_error);\n\t\t\t\t\t\t\t\t\twindow.open(url);\n\t\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (this.navigator === 'firefox') {\n\t\t\t\t\t\t\t\twindow.open('https://addons.mozilla.org/en-GB/firefox/addon/rocketchat-screen-share/');\n\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\treturn onError(false);\n\t\t\t}\n\n\t\t\tconst getScreenSuccess = (stream: MediaStream) => {\n\t\t\t\tif (audioStream != null) {\n\t\t\t\t\tstream.addTrack(audioStream.getAudioTracks()[0]);\n\t\t\t\t}\n\t\t\t\tonSuccess(stream);\n\t\t\t};\n\t\t\tif (this.navigator === 'firefox') {\n\t\t\t\tmedia = {\n\t\t\t\t\taudio: media.audio,\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tmozMediaSource: 'window',\n\t\t\t\t\t\tmediaSource: 'window',\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tvoid this._getUserMedia(media, getScreenSuccess, onError);\n\t\t\t} else {\n\t\t\t\tChromeScreenShare.getSourceId(this.navigator!, (id) => {\n\t\t\t\t\tmedia = {\n\t\t\t\t\t\taudio: false,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\t\tchromeMediaSource: 'desktop',\n\t\t\t\t\t\t\t\tchromeMediaSourceId: id,\n\t\t\t\t\t\t\t\tmaxWidth: 1280,\n\t\t\t\t\t\t\t\tmaxHeight: 720,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t\tvoid this._getUserMedia(media, getScreenSuccess, onError);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tif (this.navigator === 'firefox' || media.audio == null || media.audio === false) {\n\t\t\tgetScreen();\n\t\t} else {\n\t\t\tconst getAudioSuccess = (audioStream: MediaStream) => {\n\t\t\t\tgetScreen(audioStream);\n\t\t\t};\n\t\t\tconst getAudioError = () => {\n\t\t\t\tgetScreen();\n\t\t\t};\n\n\t\t\tvoid this._getUserMedia(\n\t\t\t\t{\n\t\t\t\t\taudio: media.audio,\n\t\t\t\t},\n\t\t\t\tgetAudioSuccess,\n\t\t\t\tgetAudioError,\n\t\t\t);\n\t\t}\n\t}\n\n\tgetLocalUserMedia(callback: (...args: any[]) => void, ...args: unknown[]) {\n\t\tthis.log('getLocalUserMedia', [callback, ...args]);\n\t\tif (this.localStream != null) {\n\t\t\treturn callback(null, this.localStream);\n\t\t}\n\t\tconst onSuccess = (stream: MediaStream) => {\n\t\t\tthis.localStream = stream;\n\t\t\t!this.audioEnabled.get() && this.disableAudio();\n\t\t\t!this.videoEnabled.get() && this.disableVideo();\n\t\t\tthis.localUrl.set(stream);\n\t\t\tconst { peerConnections } = this;\n\t\t\tObject.entries(peerConnections).forEach(([, peerConnection]) => peerConnection.addStream(stream));\n\t\t\tdocument.querySelector<HTMLVideoElement>('video#localVideo')!.srcObject = stream;\n\t\t\tcallback(null, this.localStream);\n\t\t};\n\t\tconst onError = (error: any) => {\n\t\t\tcallback(false);\n\t\t\tthis.onError(error);\n\t\t};\n\t\tthis.getUserMedia(this.media, onSuccess, onError);\n\t}\n\n\tstopPeerConnection = (id: string) => {\n\t\tconst peerConnection = this.peerConnections[id];\n\t\tif (peerConnection == null) {\n\t\t\treturn;\n\t\t}\n\t\tdelete this.peerConnections[id];\n\t\tpeerConnection.close();\n\t\tthis.updateRemoteItems();\n\t};\n\n\tstopAllPeerConnections() {\n\t\tconst { peerConnections } = this;\n\n\t\tObject.keys(peerConnections).forEach(this.stopPeerConnection);\n\n\t\tvoid window.audioContext?.close(); // FIXME: probably should be `this.audioContext`\n\t}\n\n\tsetAudioEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.localStream.getAudioTracks().forEach((audio) => {\n\t\t\t\taudio.enabled = enabled;\n\t\t\t});\n\t\t\tthis.audioEnabled.set(enabled);\n\t\t}\n\t}\n\n\tdisableAudio() {\n\t\tthis.setAudioEnabled(false);\n\t}\n\n\tenableAudio() {\n\t\tthis.setAudioEnabled(true);\n\t}\n\n\ttoggleAudio() {\n\t\tif (this.audioEnabled.get()) {\n\t\t\treturn this.disableAudio();\n\t\t}\n\t\treturn this.enableAudio();\n\t}\n\n\tlocalStream: MediaStream | undefined;\n\n\tsetVideoEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.localStream.getVideoTracks().forEach((video) => {\n\t\t\t\tvideo.enabled = enabled;\n\t\t\t});\n\t\t\tthis.videoEnabled.set(enabled);\n\t\t}\n\t}\n\n\tdisableScreenShare() {\n\t\tthis.setScreenShareEnabled(false);\n\t}\n\n\tenableScreenShare() {\n\t\tthis.setScreenShareEnabled(true);\n\t}\n\n\tsetScreenShareEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.media.desktop = enabled;\n\t\t\tdelete this.localStream;\n\t\t\tthis.getLocalUserMedia((err) => {\n\t\t\t\tif (err != null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.screenShareEnabled.set(enabled);\n\t\t\t\tthis.stopAllPeerConnections();\n\t\t\t\tthis.joinCall();\n\t\t\t});\n\t\t}\n\t}\n\n\tdisableVideo() {\n\t\tthis.setVideoEnabled(false);\n\t}\n\n\tenableVideo() {\n\t\tthis.setVideoEnabled(true);\n\t}\n\n\ttoggleVideo() {\n\t\tif (this.videoEnabled.get()) {\n\t\t\treturn this.disableVideo();\n\t\t}\n\t\treturn this.enableVideo();\n\t}\n\n\tstop() {\n\t\tthis.active = false;\n\t\tthis.monitor = false;\n\t\tthis.remoteMonitoring = false;\n\t\tif (this.localStream != null && typeof this.localStream !== 'undefined') {\n\t\t\tthis.localStream.getTracks().forEach((track) => track.stop());\n\t\t}\n\t\tthis.localUrl.set(undefined);\n\t\tdelete this.localStream;\n\t\tthis.stopAllPeerConnections();\n\t}\n\n\tstartCall(media: MediaStreamConstraints = {}, ...args: unknown[]) {\n\t\tthis.log('startCall', [media, ...args]);\n\t\tthis.media = media;\n\t\tthis.getLocalUserMedia(() => {\n\t\t\tthis.active = true;\n\t\t\tthis.transport.startCall({\n\t\t\t\tmedia: this.media,\n\t\t\t});\n\t\t});\n\t}\n\n\tstartCallAsMonitor(media: MediaStreamConstraints = {}, ...args: unknown[]) {\n\t\tthis.log('startCallAsMonitor', [media, ...args]);\n\t\tthis.media = media;\n\t\tthis.active = true;\n\t\tthis.monitor = true;\n\t\tthis.transport.startCall({\n\t\t\tmedia: this.media,\n\t\t\tmonitor: true,\n\t\t});\n\t}\n\n\tonRemoteCall(data: CallData) {\n\t\tif (this.autoAccept === true) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.joinCall({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t\tmedia: data.media,\n\t\t\t\t});\n\t\t\t}, 0);\n\t\t\treturn;\n\t\t}\n\n\t\tconst user = Meteor.users.findOne(data.from);\n\t\tlet fromUsername = undefined;\n\t\tif (user?.username) {\n\t\t\tfromUsername = user.username;\n\t\t}\n\t\tconst subscription = ChatSubscription.findOne({\n\t\t\trid: data.room,\n\t\t})!;\n\n\t\tlet icon;\n\t\tlet title;\n\t\tif (data.monitor === true) {\n\t\t\ticon = 'eye' as const;\n\t\t\ttitle = t('WebRTC_monitor_call_from_%s', fromUsername);\n\t\t} else if (subscription && subscription.t === 'd') {\n\t\t\tif (data.media?.video) {\n\t\t\t\ticon = 'video' as const;\n\t\t\t\ttitle = t('WebRTC_direct_video_call_from_%s', fromUsername);\n\t\t\t} else {\n\t\t\t\ticon = 'phone' as const;\n\t\t\t\ttitle = t('WebRTC_direct_audio_call_from_%s', fromUsername);\n\t\t\t}\n\t\t} else if (data.media?.video) {\n\t\t\ticon = 'video' as const;\n\t\t\ttitle = t('WebRTC_group_video_call_from_%s', subscription.name);\n\t\t} else {\n\t\t\ticon = 'phone' as const;\n\t\t\ttitle = t('WebRTC_group_audio_call_from_%s', subscription.name);\n\t\t}\n\n\t\timperativeModal.open({\n\t\t\tcomponent: GenericModal,\n\t\t\tprops: {\n\t\t\t\ttitle,\n\t\t\t\ticon,\n\t\t\t\tconfirmText: t('Yes'),\n\t\t\t\tcancelText: t('No'),\n\t\t\t\tchildren: t('Do_you_want_to_accept'),\n\t\t\t\tonConfirm: () => {\n\t\t\t\t\tvoid goToRoomById(data.room!);\n\t\t\t\t\treturn this.joinCall({\n\t\t\t\t\t\tto: data.from,\n\t\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t\t\tmedia: data.media,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonCancel: () => this.stop(),\n\t\t\t\tonClose: () => this.stop(),\n\t\t\t},\n\t\t});\n\t}\n\n\tjoinCall(data: JoinData = {}, ...args: unknown[]) {\n\t\tdata.media = this.media;\n\t\tthis.log('joinCall', [data, ...args]);\n\t\tthis.getLocalUserMedia(() => {\n\t\t\tthis.remoteMonitoring = data.monitor!;\n\t\t\tthis.active = true;\n\t\t\tthis.transport.joinCall(data);\n\t\t});\n\t}\n\n\tonRemoteJoin(data: JoinData, ...args: unknown[]) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteJoin', [data, ...args]);\n\t\tlet peerConnection = this.getPeerConnection(data.from!);\n\n\t\t// needsRefresh = false\n\t\t// if peerConnection.iceConnectionState isnt 'new'\n\t\t// needsAudio = data.media.audio is true and peerConnection.remoteMedia.audio isnt true\n\t\t// needsVideo = data.media.video is true and peerConnection.remoteMedia.video isnt true\n\t\t// needsRefresh = needsAudio or needsVideo or data.media.desktop isnt peerConnection.remoteMedia.desktop\n\n\t\t// # if peerConnection.signalingState is \"have-local-offer\" or needsRefresh\n\n\t\tif ((peerConnection.signalingState as RTCSignalingState | 'checking') !== 'checking') {\n\t\t\tthis.stopPeerConnection(data.from!);\n\t\t\tpeerConnection = this.getPeerConnection(data.from!);\n\t\t}\n\t\tif (peerConnection.iceConnectionState !== 'new') {\n\t\t\treturn;\n\t\t}\n\t\tpeerConnection.remoteMedia = data.media!;\n\t\tif (this.localStream) {\n\t\t\tpeerConnection.addStream(this.localStream);\n\t\t}\n\t\tconst onOffer: RTCSessionDescriptionCallback = (offer) => {\n\t\t\tconst onLocalDescription = () => {\n\t\t\t\tthis.transport.sendDescription({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\ttype: 'offer',\n\t\t\t\t\tts: peerConnection.createdAt,\n\t\t\t\t\tmedia: this.media,\n\t\t\t\t\tdescription: {\n\t\t\t\t\t\tsdp: offer.sdp,\n\t\t\t\t\t\ttype: offer.type,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tvoid peerConnection.setLocalDescription(new RTCSessionDescription(offer), onLocalDescription, this.onError);\n\t\t};\n\n\t\tif (data.monitor === true) {\n\t\t\tvoid peerConnection.createOffer(onOffer, this.onError, {\n\t\t\t\tmandatory: {\n\t\t\t\t\tOfferToReceiveAudio: data.media?.audio,\n\t\t\t\t\tOfferToReceiveVideo: data.media?.video,\n\t\t\t\t},\n\t\t\t});\n\t\t} else {\n\t\t\tvoid peerConnection.createOffer(onOffer, this.onError);\n\t\t}\n\t}\n\n\tonRemoteOffer(data: Omit<DescriptionData, 'type'>, ...args: unknown[]) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('onRemoteOffer', [data, ...args]);\n\t\tlet peerConnection = this.getPeerConnection(data.from!);\n\n\t\tif (['have-local-offer', 'stable'].includes(peerConnection.signalingState) && peerConnection.createdAt < data.ts) {\n\t\t\tthis.stopPeerConnection(data.from!);\n\t\t\tpeerConnection = this.getPeerConnection(data.from!);\n\t\t}\n\n\t\tif (peerConnection.iceConnectionState !== 'new') {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid peerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\n\n\t\ttry {\n\t\t\tif (this.localStream) {\n\t\t\t\tpeerConnection.addStream(this.localStream);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t}\n\n\t\tconst onAnswer: RTCSessionDescriptionCallback = (answer) => {\n\t\t\tconst onLocalDescription = () => {\n\t\t\t\tthis.transport.sendDescription({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tts: peerConnection.createdAt,\n\t\t\t\t\tdescription: {\n\t\t\t\t\t\tsdp: answer.sdp,\n\t\t\t\t\t\ttype: answer.type,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tvoid peerConnection.setLocalDescription(new RTCSessionDescription(answer), onLocalDescription, this.onError);\n\t\t};\n\n\t\tvoid peerConnection.createAnswer(onAnswer, this.onError);\n\t}\n\n\tonRemoteCandidate(data: CandidateData, ...args: unknown[]) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tif (data.to !== this.selfId) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteCandidate', [data, ...args]);\n\t\tconst peerConnection = this.getPeerConnection(data.from!);\n\t\tif (\n\t\t\tpeerConnection.iceConnectionState !== 'closed' &&\n\t\t\tpeerConnection.iceConnectionState !== 'failed' &&\n\t\t\tpeerConnection.iceConnectionState !== 'disconnected' &&\n\t\t\tpeerConnection.iceConnectionState !== 'completed'\n\t\t) {\n\t\t\tvoid peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));\n\t\t}\n\t\tdocument.querySelector<HTMLVideoElement>('video#remoteVideo')!.srcObject = this.remoteItems.get()[0]?.url;\n\t}\n\n\tonRemoteDescription(data: DescriptionData, ...args: unknown[]) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tif (data.to !== this.selfId) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteDescription', [data, ...args]);\n\t\tconst peerConnection = this.getPeerConnection(data.from!);\n\t\tif (data.type === 'offer') {\n\t\t\tpeerConnection.remoteMedia = data.media;\n\t\t\tthis.onRemoteOffer({\n\t\t\t\tfrom: data.from,\n\t\t\t\tts: data.ts,\n\t\t\t\tdescription: data.description,\n\t\t\t});\n\t\t} else {\n\t\t\tvoid peerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\n\t\t}\n\t}\n}\n\nconst WebRTC = new (class {\n\tinstancesByRoomId: Record<string, WebRTCClass> = {};\n\n\tconstructor() {\n\t\tthis.instancesByRoomId = {};\n\t}\n\n\tgetInstanceByRoomId(rid: IRoom['_id'], visitorId: string | null = null) {\n\t\tlet enabled = false;\n\t\tif (!visitorId) {\n\t\t\tconst subscription = ChatSubscription.findOne({ rid });\n\t\t\tif (!subscription) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tswitch (subscription.t) {\n\t\t\t\tcase 'd':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Direct');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'p':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Private');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'c':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Channel');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'l':\n\t\t\t\t\tenabled = settings.get<string>('Omnichannel_call_provider') === 'WebRTC';\n\t\t\t}\n\t\t} else {\n\t\t\tenabled = settings.get<string>('Omnichannel_call_provider') === 'WebRTC';\n\t\t}\n\t\tenabled = enabled && settings.get('WebRTC_Enabled');\n\t\tif (enabled === false) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.instancesByRoomId[rid] == null) {\n\t\t\tlet uid = Meteor.userId()!;\n\t\t\tlet autoAccept = false;\n\t\t\tif (visitorId) {\n\t\t\t\tuid = visitorId;\n\t\t\t\tautoAccept = true;\n\t\t\t}\n\t\t\tthis.instancesByRoomId[rid] = new WebRTCClass(uid, rid, autoAccept);\n\t\t}\n\t\treturn this.instancesByRoomId[rid];\n\t}\n})();\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (uid) {\n\t\t\tsdk.stream('notify-user', [`${uid}/${WEB_RTC_EVENTS.WEB_RTC}`], (type, data) => {\n\t\t\t\tif (data.room == null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst webrtc = WebRTC.getInstanceByRoomId(data.room);\n\n\t\t\t\tswitch (type) {\n\t\t\t\t\tcase 'candidate':\n\t\t\t\t\t\twebrtc?.onUserStream('candidate', data);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'description':\n\t\t\t\t\t\twebrtc?.onUserStream('description', data);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'join':\n\t\t\t\t\t\twebrtc?.onUserStream('join', data);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n});\n\nexport { WebRTC };\n"]}}},"code":"var _toConsumableArray;\nmodule.link(\"@babel/runtime/helpers/toConsumableArray\", {\n  default: function (v) {\n    _toConsumableArray = v;\n  }\n}, 0);\nvar _slicedToArray;\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 1);\nvar _inheritsLoose;\nmodule.link(\"@babel/runtime/helpers/inheritsLoose\", {\n  default: function (v) {\n    _inheritsLoose = v;\n  }\n}, 2);\nmodule.export({\n  WebRTC: function () {\n    return WebRTC;\n  }\n});\nvar Emitter;\nmodule.link(\"@rocket.chat/emitter\", {\n  Emitter: function (v) {\n    Emitter = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 2);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 3);\nvar GenericModal;\nmodule.link(\"../../../client/components/GenericModal\", {\n  \"default\": function (v) {\n    GenericModal = v;\n  }\n}, 4);\nvar imperativeModal;\nmodule.link(\"../../../client/lib/imperativeModal\", {\n  imperativeModal: function (v) {\n    imperativeModal = v;\n  }\n}, 5);\nvar goToRoomById;\nmodule.link(\"../../../client/lib/utils/goToRoomById\", {\n  goToRoomById: function (v) {\n    goToRoomById = v;\n  }\n}, 6);\nvar ChatSubscription;\nmodule.link(\"../../models/client\", {\n  ChatSubscription: function (v) {\n    ChatSubscription = v;\n  }\n}, 7);\nvar settings;\nmodule.link(\"../../settings/client\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 8);\nvar sdk;\nmodule.link(\"../../utils/client/lib/SDKClient\", {\n  sdk: function (v) {\n    sdk = v;\n  }\n}, 9);\nvar t;\nmodule.link(\"../../utils/lib/i18n\", {\n  t: function (v) {\n    t = v;\n  }\n}, 10);\nvar WEB_RTC_EVENTS;\nmodule.link(\"../lib/constants\", {\n  WEB_RTC_EVENTS: function (v) {\n    WEB_RTC_EVENTS = v;\n  }\n}, 11);\nvar ChromeScreenShare;\nmodule.link(\"./screenShare\", {\n  ChromeScreenShare: function (v) {\n    ChromeScreenShare = v;\n  }\n}, 12);\nvar WebRTCTransportClass = /*#__PURE__*/function (_Emitter) {\n  function WebRTCTransportClass(webrtcInstance) {\n    var _this;\n    _this = _Emitter.call(this) || this;\n    _this.webrtcInstance = void 0;\n    _this.debug = false;\n    _this.webrtcInstance = webrtcInstance;\n    sdk.stream('notify-room', [_this.webrtcInstance.room + \"/\" + WEB_RTC_EVENTS.WEB_RTC], function (type, data) {\n      _this.log('WebRTCTransportClass - onRoom', type, data);\n      _this.emit(type, data);\n    });\n    return _this;\n  }\n  _inheritsLoose(WebRTCTransportClass, _Emitter);\n  var _proto = WebRTCTransportClass.prototype;\n  _proto.log = function () {\n    function log() {\n      if (this.debug === true) {\n        var _console;\n        (_console = console).log.apply(_console, arguments);\n      }\n    }\n    return log;\n  }();\n  _proto.onUserStream = function () {\n    function onUserStream() {\n      for (var _len = arguments.length, _ref = new Array(_len), _key = 0; _key < _len; _key++) {\n        _ref[_key] = arguments[_key];\n      }\n      var type = _ref[0],\n        data = _ref[1];\n      if (data.room !== this.webrtcInstance.room) {\n        return;\n      }\n      this.log('WebRTCTransportClass - onUser', type, data);\n      switch (type) {\n        case 'candidate':\n          this.emit('candidate', data);\n          break;\n        case 'description':\n          this.emit('description', data);\n          break;\n        case 'join':\n          this.emit('join', data);\n          break;\n      }\n    }\n    return onUserStream;\n  }();\n  _proto.startCall = function () {\n    function startCall(data) {\n      this.log('WebRTCTransportClass - startCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\n      sdk.publish('notify-room-users', [this.webrtcInstance.room + \"/\" + WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.CALL, {\n        from: this.webrtcInstance.selfId,\n        room: this.webrtcInstance.room,\n        media: data.media,\n        monitor: data.monitor\n      }]);\n    }\n    return startCall;\n  }();\n  _proto.joinCall = function () {\n    function joinCall(data) {\n      this.log('WebRTCTransportClass - joinCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\n      if (data.monitor === true) {\n        sdk.publish('notify-user', [data.to + \"/\" + WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.JOIN, {\n          from: this.webrtcInstance.selfId,\n          room: this.webrtcInstance.room,\n          media: data.media,\n          monitor: data.monitor\n        }]);\n      } else {\n        sdk.publish('notify-room-users', [this.webrtcInstance.room + \"/\" + WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.JOIN, {\n          from: this.webrtcInstance.selfId,\n          room: this.webrtcInstance.room,\n          media: data.media,\n          monitor: data.monitor\n        }]);\n      }\n    }\n    return joinCall;\n  }();\n  _proto.sendCandidate = function () {\n    function sendCandidate(data) {\n      data.from = this.webrtcInstance.selfId;\n      data.room = this.webrtcInstance.room;\n      this.log('WebRTCTransportClass - sendCandidate', data);\n      sdk.publish('notify-user', [data.to + \"/\" + WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.CANDIDATE, data]);\n    }\n    return sendCandidate;\n  }();\n  _proto.sendDescription = function () {\n    function sendDescription(data) {\n      data.from = this.webrtcInstance.selfId;\n      data.room = this.webrtcInstance.room;\n      this.log('WebRTCTransportClass - sendDescription', data);\n      sdk.publish('notify-user', [data.to + \"/\" + WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.DESCRIPTION, data]);\n    }\n    return sendDescription;\n  }();\n  _proto.sendStatus = function () {\n    function sendStatus(data) {\n      this.log('WebRTCTransportClass - sendStatus', data, this.webrtcInstance.room);\n      data.from = this.webrtcInstance.selfId;\n      sdk.publish('notify-room', [this.webrtcInstance.room + \"/\" + WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.STATUS, data]);\n    }\n    return sendStatus;\n  }();\n  _proto.onRemoteCall = function () {\n    function onRemoteCall(fn) {\n      return this.on(WEB_RTC_EVENTS.CALL, fn);\n    }\n    return onRemoteCall;\n  }();\n  _proto.onRemoteJoin = function () {\n    function onRemoteJoin(fn) {\n      return this.on(WEB_RTC_EVENTS.JOIN, fn);\n    }\n    return onRemoteJoin;\n  }();\n  _proto.onRemoteCandidate = function () {\n    function onRemoteCandidate(fn) {\n      return this.on(WEB_RTC_EVENTS.CANDIDATE, fn);\n    }\n    return onRemoteCandidate;\n  }();\n  _proto.onRemoteDescription = function () {\n    function onRemoteDescription(fn) {\n      return this.on(WEB_RTC_EVENTS.DESCRIPTION, fn);\n    }\n    return onRemoteDescription;\n  }();\n  _proto.onRemoteStatus = function () {\n    function onRemoteStatus(fn) {\n      return this.on(WEB_RTC_EVENTS.STATUS, fn);\n    }\n    return onRemoteStatus;\n  }();\n  return WebRTCTransportClass;\n}(Emitter);\nvar WebRTCClass = /*#__PURE__*/function () {\n  function WebRTCClass(selfId, room) {\n    var _this2 = this;\n    var autoAccept = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    this.selfId = void 0;\n    this.room = void 0;\n    this.autoAccept = void 0;\n    this.transport = void 0;\n    this.config = void 0;\n    this.debug = void 0;\n    this.TransportClass = void 0;\n    this.peerConnections = {};\n    this.remoteItems = void 0;\n    this.remoteItemsById = void 0;\n    this.callInProgress = void 0;\n    this.audioEnabled = void 0;\n    this.videoEnabled = void 0;\n    this.overlayEnabled = void 0;\n    this.screenShareEnabled = void 0;\n    this.localUrl = void 0;\n    this.active = void 0;\n    this.remoteMonitoring = void 0;\n    this.monitor = void 0;\n    this.navigator = void 0;\n    this.screenShareAvailable = void 0;\n    this.media = void 0;\n    this.resetCallInProgress = function () {\n      _this2.callInProgress.set(false);\n    };\n    this.callInProgressTimeout = undefined;\n    this.audioContext = void 0;\n    this.stopPeerConnection = function (id) {\n      var peerConnection = _this2.peerConnections[id];\n      if (peerConnection == null) {\n        return;\n      }\n      delete _this2.peerConnections[id];\n      peerConnection.close();\n      _this2.updateRemoteItems();\n    };\n    this.localStream = void 0;\n    this.selfId = selfId;\n    this.room = room;\n    this.autoAccept = autoAccept;\n    this.config = {\n      iceServers: []\n    };\n    this.debug = false;\n    this.TransportClass = WebRTCTransportClass;\n    var servers = settings.get('WebRTC_Servers');\n    if (servers && servers.trim() !== '') {\n      servers = servers.replace(/\\s/g, '');\n      servers.split(',').forEach(function (server) {\n        var parts = server.split('@');\n        var serverConfig = {\n          urls: parts.pop()\n        };\n        if (parts.length === 1) {\n          var _parts$0$split = parts[0].split(':'),\n            _parts$0$split2 = _slicedToArray(_parts$0$split, 2),\n            username = _parts$0$split2[0],\n            credential = _parts$0$split2[1];\n          serverConfig.username = decodeURIComponent(username);\n          serverConfig.credential = decodeURIComponent(credential);\n        }\n        _this2.config.iceServers.push(serverConfig);\n      });\n    }\n    this.peerConnections = {};\n    this.remoteItems = new ReactiveVar([]);\n    this.remoteItemsById = new ReactiveVar({});\n    this.callInProgress = new ReactiveVar(false);\n    this.audioEnabled = new ReactiveVar(false);\n    this.videoEnabled = new ReactiveVar(false);\n    this.overlayEnabled = new ReactiveVar(false);\n    this.screenShareEnabled = new ReactiveVar(false);\n    this.localUrl = new ReactiveVar(undefined);\n    this.active = false;\n    this.remoteMonitoring = false;\n    this.monitor = false;\n    this.navigator = undefined;\n    var userAgent = navigator.userAgent.toLocaleLowerCase();\n    if (userAgent.indexOf('electron') !== -1) {\n      this.navigator = 'electron';\n    } else if (userAgent.indexOf('chrome') !== -1) {\n      this.navigator = 'chrome';\n    } else if (userAgent.indexOf('firefox') !== -1) {\n      this.navigator = 'firefox';\n    } else if (userAgent.indexOf('safari') !== -1) {\n      this.navigator = 'safari';\n    }\n    this.screenShareAvailable = ['chrome', 'firefox', 'electron'].includes(this.navigator);\n    this.media = {\n      video: true,\n      audio: true\n    };\n    this.transport = new this.TransportClass(this);\n    this.transport.onRemoteCall(this.onRemoteCall.bind(this));\n    this.transport.onRemoteJoin(this.onRemoteJoin.bind(this));\n    this.transport.onRemoteCandidate(this.onRemoteCandidate.bind(this));\n    this.transport.onRemoteDescription(this.onRemoteDescription.bind(this));\n    this.transport.onRemoteStatus(this.onRemoteStatus.bind(this));\n    setInterval(this.checkPeerConnections.bind(this), 1000);\n  }\n  var _proto2 = WebRTCClass.prototype;\n  _proto2.onUserStream = function () {\n    function onUserStream() {\n      for (var _len2 = arguments.length, _ref2 = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        _ref2[_key2] = arguments[_key2];\n      }\n      var type = _ref2[0],\n        data = _ref2[1];\n      switch (type) {\n        case 'candidate':\n          this.transport.onUserStream('candidate', data);\n          break;\n        case 'description':\n          this.transport.onUserStream('description', data);\n          break;\n        case 'join':\n          this.transport.onUserStream('join', data);\n          break;\n      }\n    }\n    return onUserStream;\n  }();\n  _proto2.log = function () {\n    function log() {\n      if (this.debug === true) {\n        var _console2;\n        (_console2 = console).log.apply(_console2, arguments);\n      }\n    }\n    return log;\n  }();\n  _proto2.onError = function () {\n    function onError() {\n      var _console3;\n      (_console3 = console).error.apply(_console3, arguments);\n    }\n    return onError;\n  }();\n  _proto2.checkPeerConnections = function () {\n    function checkPeerConnections() {\n      var _this3 = this;\n      var peerConnections = this.peerConnections;\n      var date = Date.now();\n      Object.entries(peerConnections).some(function (_ref3) {\n        var _ref4 = _slicedToArray(_ref3, 2),\n          id = _ref4[0],\n          peerConnection = _ref4[1];\n        if (!['connected', 'completed'].includes(peerConnection.iceConnectionState) && peerConnection.createdAt + 5000 < date) {\n          _this3.stopPeerConnection(id);\n          return true;\n        }\n        return false;\n      });\n    }\n    return checkPeerConnections;\n  }();\n  _proto2.updateRemoteItems = function () {\n    function updateRemoteItems() {\n      var items = [];\n      var itemsById = {};\n      var peerConnections = this.peerConnections;\n      Object.entries(peerConnections).forEach(function (_ref5) {\n        var _ref6 = _slicedToArray(_ref5, 2),\n          id = _ref6[0],\n          peerConnection = _ref6[1];\n        peerConnection.getRemoteStreams().forEach(function (remoteStream) {\n          var item = {\n            id: id,\n            url: remoteStream,\n            state: peerConnection.iceConnectionState\n          };\n          switch (peerConnection.iceConnectionState) {\n            case 'checking':\n              item.stateText = 'Connecting...';\n              break;\n            case 'connected':\n            case 'completed':\n              item.stateText = 'Connected';\n              item.connected = true;\n              break;\n            case 'disconnected':\n              item.stateText = 'Disconnected';\n              break;\n            case 'failed':\n              item.stateText = 'Failed';\n              break;\n            case 'closed':\n              item.stateText = 'Closed';\n          }\n          items.push(item);\n          itemsById[id] = item;\n        });\n      });\n      this.remoteItems.set(items);\n      this.remoteItemsById.set(itemsById);\n    }\n    return updateRemoteItems;\n  }();\n  _proto2.broadcastStatus = function () {\n    function broadcastStatus() {\n      if (this.active !== true || this.monitor === true || this.remoteMonitoring === true) {\n        return;\n      }\n      var remoteConnections = [];\n      var peerConnections = this.peerConnections;\n      Object.entries(peerConnections).forEach(function (_ref7) {\n        var _ref8 = _slicedToArray(_ref7, 2),\n          id = _ref8[0],\n          media = _ref8[1].remoteMedia;\n        remoteConnections.push({\n          id: id,\n          media: media\n        });\n      });\n      this.transport.sendStatus({\n        media: this.media,\n        remoteConnections: remoteConnections\n      });\n    }\n    return broadcastStatus;\n  }();\n  _proto2.onRemoteStatus = function () {\n    function onRemoteStatus(data) {\n      var _this4 = this;\n      // this.log(onRemoteStatus, arguments);\n      this.callInProgress.set(true);\n      clearTimeout(this.callInProgressTimeout);\n      this.callInProgressTimeout = setTimeout(this.resetCallInProgress, 2000);\n      if (this.active !== true) {\n        return;\n      }\n      var remoteConnections = [{\n        id: data.from,\n        media: data.media\n      }].concat(_toConsumableArray(data.remoteConnections));\n      remoteConnections.forEach(function (remoteConnection) {\n        if (remoteConnection.id !== _this4.selfId && _this4.peerConnections[remoteConnection.id] == null) {\n          _this4.log('reconnecting with', remoteConnection.id);\n          _this4.onRemoteJoin({\n            from: remoteConnection.id,\n            media: remoteConnection.media\n          });\n        }\n      });\n    }\n    return onRemoteStatus;\n  }();\n  _proto2.getPeerConnection = function () {\n    function getPeerConnection(id) {\n      var _this5 = this;\n      if (this.peerConnections[id] != null) {\n        return this.peerConnections[id];\n      }\n      var peerConnection = new RTCPeerConnection(this.config);\n      peerConnection.createdAt = Date.now();\n      peerConnection.remoteMedia = {};\n      this.peerConnections[id] = peerConnection;\n      var eventNames = ['icecandidate', 'addstream', 'removestream', 'iceconnectionstatechange', 'datachannel', 'identityresult', 'idpassertionerror', 'idpvalidationerror', 'negotiationneeded', 'peeridentity', 'signalingstatechange'];\n      eventNames.forEach(function (eventName) {\n        peerConnection.addEventListener(eventName, function (e) {\n          _this5.log(id, e.type, e);\n        });\n      });\n      peerConnection.addEventListener('icecandidate', function (e) {\n        if (e.candidate == null) {\n          return;\n        }\n        _this5.transport.sendCandidate({\n          to: id,\n          candidate: {\n            candidate: e.candidate.candidate,\n            sdpMLineIndex: e.candidate.sdpMLineIndex,\n            sdpMid: e.candidate.sdpMid\n          }\n        });\n      });\n      peerConnection.addEventListener('addstream', function () {\n        _this5.updateRemoteItems();\n      });\n      peerConnection.addEventListener('removestream', function () {\n        _this5.updateRemoteItems();\n      });\n      peerConnection.addEventListener('iceconnectionstatechange', function () {\n        if ((peerConnection.iceConnectionState === 'disconnected' || peerConnection.iceConnectionState === 'closed') && peerConnection === _this5.peerConnections[id]) {\n          _this5.stopPeerConnection(id);\n          setTimeout(function () {\n            if (Object.keys(_this5.peerConnections).length === 0) {\n              _this5.stop();\n            }\n          }, 3000);\n        }\n        _this5.updateRemoteItems();\n      });\n      return peerConnection;\n    }\n    return getPeerConnection;\n  }();\n  _proto2._getUserMedia = function () {\n    function _getUserMedia(media, onSuccess, onError) {\n      var _this6 = this,\n        _navigator$mediaDevic,\n        _navigator$getUserMed,\n        _navigator;\n      var onSuccessLocal = function (stream) {\n        if (AudioContext && stream.getAudioTracks().length > 0) {\n          var audioContext = new AudioContext();\n          var source = audioContext.createMediaStreamSource(stream);\n          var volume = audioContext.createGain();\n          source.connect(volume);\n          var peer = audioContext.createMediaStreamDestination();\n          volume.connect(peer);\n          volume.gain.value = 0.6;\n          stream.removeTrack(stream.getAudioTracks()[0]);\n          stream.addTrack(peer.stream.getAudioTracks()[0]);\n          stream.volume = volume;\n          _this6.audioContext = audioContext;\n        }\n        onSuccess(stream);\n      };\n      if ((_navigator$mediaDevic = navigator.mediaDevices) !== null && _navigator$mediaDevic !== void 0 && _navigator$mediaDevic.getUserMedia) {\n        return navigator.mediaDevices.getUserMedia(media).then(onSuccessLocal).catch(onError);\n      }\n      (_navigator$getUserMed = (_navigator = navigator).getUserMedia) === null || _navigator$getUserMed === void 0 ? void 0 : _navigator$getUserMed.call(_navigator, media, onSuccessLocal, onError);\n    }\n    return _getUserMedia;\n  }();\n  _proto2.getUserMedia = function () {\n    function getUserMedia(media, onSuccess) {\n      var _this7 = this;\n      var onError = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.onError;\n      if (media.desktop !== true) {\n        void this._getUserMedia(media, onSuccess, onError);\n        return;\n      }\n      if (this.screenShareAvailable !== true) {\n        console.log('Screen share is not avaliable');\n        return;\n      }\n      var getScreen = function (audioStream) {\n        var refresh = function () {\n          imperativeModal.open({\n            component: GenericModal,\n            props: {\n              variant: 'warning',\n              title: t('Refresh_your_page_after_install_to_enable_screen_sharing')\n            }\n          });\n        };\n        var isChromeExtensionInstalled = _this7.navigator === 'chrome' && ChromeScreenShare.installed;\n        var isFirefoxExtensionInstalled = _this7.navigator === 'firefox' && window.rocketchatscreenshare != null;\n        if (!isChromeExtensionInstalled && !isFirefoxExtensionInstalled) {\n          imperativeModal.open({\n            component: GenericModal,\n            props: {\n              title: t('Screen_Share'),\n              variant: 'warning',\n              confirmText: t('Install_Extension'),\n              cancelText: t('Cancel'),\n              children: t('You_need_install_an_extension_to_allow_screen_sharing'),\n              onConfirm: function () {\n                if (_this7.navigator === 'chrome') {\n                  var url = 'https://chrome.google.com/webstore/detail/rocketchat-screen-share/nocfbnnmjnndkbipkabodnheejiegccf';\n                  try {\n                    chrome.webstore.install(url, refresh, function () {\n                      window.open(url);\n                      refresh();\n                    });\n                  } catch (_error) {\n                    console.log(_error);\n                    window.open(url);\n                    refresh();\n                  }\n                } else if (_this7.navigator === 'firefox') {\n                  window.open('https://addons.mozilla.org/en-GB/firefox/addon/rocketchat-screen-share/');\n                  refresh();\n                }\n              }\n            }\n          });\n          return onError(false);\n        }\n        var getScreenSuccess = function (stream) {\n          if (audioStream != null) {\n            stream.addTrack(audioStream.getAudioTracks()[0]);\n          }\n          onSuccess(stream);\n        };\n        if (_this7.navigator === 'firefox') {\n          media = {\n            audio: media.audio,\n            video: {\n              mozMediaSource: 'window',\n              mediaSource: 'window'\n            }\n          };\n          void _this7._getUserMedia(media, getScreenSuccess, onError);\n        } else {\n          ChromeScreenShare.getSourceId(_this7.navigator, function (id) {\n            media = {\n              audio: false,\n              video: {\n                mandatory: {\n                  chromeMediaSource: 'desktop',\n                  chromeMediaSourceId: id,\n                  maxWidth: 1280,\n                  maxHeight: 720\n                }\n              }\n            };\n            void _this7._getUserMedia(media, getScreenSuccess, onError);\n          });\n        }\n      };\n      if (this.navigator === 'firefox' || media.audio == null || media.audio === false) {\n        getScreen();\n      } else {\n        var getAudioSuccess = function (audioStream) {\n          getScreen(audioStream);\n        };\n        var getAudioError = function () {\n          getScreen();\n        };\n        void this._getUserMedia({\n          audio: media.audio\n        }, getAudioSuccess, getAudioError);\n      }\n    }\n    return getUserMedia;\n  }();\n  _proto2.getLocalUserMedia = function () {\n    function getLocalUserMedia(callback) {\n      var _this8 = this;\n      for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n        args[_key3 - 1] = arguments[_key3];\n      }\n      this.log('getLocalUserMedia', [callback].concat(args));\n      if (this.localStream != null) {\n        return callback(null, this.localStream);\n      }\n      var onSuccess = function (stream) {\n        _this8.localStream = stream;\n        !_this8.audioEnabled.get() && _this8.disableAudio();\n        !_this8.videoEnabled.get() && _this8.disableVideo();\n        _this8.localUrl.set(stream);\n        var peerConnections = _this8.peerConnections;\n        Object.entries(peerConnections).forEach(function (_ref9) {\n          var _ref10 = _slicedToArray(_ref9, 2),\n            peerConnection = _ref10[1];\n          return peerConnection.addStream(stream);\n        });\n        document.querySelector('video#localVideo').srcObject = stream;\n        callback(null, _this8.localStream);\n      };\n      var onError = function (error) {\n        callback(false);\n        _this8.onError(error);\n      };\n      this.getUserMedia(this.media, onSuccess, onError);\n    }\n    return getLocalUserMedia;\n  }();\n  _proto2.stopAllPeerConnections = function () {\n    function stopAllPeerConnections() {\n      var _window$audioContext;\n      var peerConnections = this.peerConnections;\n      Object.keys(peerConnections).forEach(this.stopPeerConnection);\n      void ((_window$audioContext = window.audioContext) === null || _window$audioContext === void 0 ? void 0 : _window$audioContext.close()); // FIXME: probably should be `this.audioContext`\n    }\n    return stopAllPeerConnections;\n  }();\n  _proto2.setAudioEnabled = function () {\n    function setAudioEnabled() {\n      var enabled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      if (this.localStream != null) {\n        this.localStream.getAudioTracks().forEach(function (audio) {\n          audio.enabled = enabled;\n        });\n        this.audioEnabled.set(enabled);\n      }\n    }\n    return setAudioEnabled;\n  }();\n  _proto2.disableAudio = function () {\n    function disableAudio() {\n      this.setAudioEnabled(false);\n    }\n    return disableAudio;\n  }();\n  _proto2.enableAudio = function () {\n    function enableAudio() {\n      this.setAudioEnabled(true);\n    }\n    return enableAudio;\n  }();\n  _proto2.toggleAudio = function () {\n    function toggleAudio() {\n      if (this.audioEnabled.get()) {\n        return this.disableAudio();\n      }\n      return this.enableAudio();\n    }\n    return toggleAudio;\n  }();\n  _proto2.setVideoEnabled = function () {\n    function setVideoEnabled() {\n      var enabled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      if (this.localStream != null) {\n        this.localStream.getVideoTracks().forEach(function (video) {\n          video.enabled = enabled;\n        });\n        this.videoEnabled.set(enabled);\n      }\n    }\n    return setVideoEnabled;\n  }();\n  _proto2.disableScreenShare = function () {\n    function disableScreenShare() {\n      this.setScreenShareEnabled(false);\n    }\n    return disableScreenShare;\n  }();\n  _proto2.enableScreenShare = function () {\n    function enableScreenShare() {\n      this.setScreenShareEnabled(true);\n    }\n    return enableScreenShare;\n  }();\n  _proto2.setScreenShareEnabled = function () {\n    function setScreenShareEnabled() {\n      var _this9 = this;\n      var enabled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      if (this.localStream != null) {\n        this.media.desktop = enabled;\n        delete this.localStream;\n        this.getLocalUserMedia(function (err) {\n          if (err != null) {\n            return;\n          }\n          _this9.screenShareEnabled.set(enabled);\n          _this9.stopAllPeerConnections();\n          _this9.joinCall();\n        });\n      }\n    }\n    return setScreenShareEnabled;\n  }();\n  _proto2.disableVideo = function () {\n    function disableVideo() {\n      this.setVideoEnabled(false);\n    }\n    return disableVideo;\n  }();\n  _proto2.enableVideo = function () {\n    function enableVideo() {\n      this.setVideoEnabled(true);\n    }\n    return enableVideo;\n  }();\n  _proto2.toggleVideo = function () {\n    function toggleVideo() {\n      if (this.videoEnabled.get()) {\n        return this.disableVideo();\n      }\n      return this.enableVideo();\n    }\n    return toggleVideo;\n  }();\n  _proto2.stop = function () {\n    function stop() {\n      this.active = false;\n      this.monitor = false;\n      this.remoteMonitoring = false;\n      if (this.localStream != null && typeof this.localStream !== 'undefined') {\n        this.localStream.getTracks().forEach(function (track) {\n          return track.stop();\n        });\n      }\n      this.localUrl.set(undefined);\n      delete this.localStream;\n      this.stopAllPeerConnections();\n    }\n    return stop;\n  }();\n  _proto2.startCall = function () {\n    function startCall() {\n      var _this10 = this;\n      var media = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n        args[_key4 - 1] = arguments[_key4];\n      }\n      this.log('startCall', [media].concat(args));\n      this.media = media;\n      this.getLocalUserMedia(function () {\n        _this10.active = true;\n        _this10.transport.startCall({\n          media: _this10.media\n        });\n      });\n    }\n    return startCall;\n  }();\n  _proto2.startCallAsMonitor = function () {\n    function startCallAsMonitor() {\n      var media = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      for (var _len5 = arguments.length, args = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n        args[_key5 - 1] = arguments[_key5];\n      }\n      this.log('startCallAsMonitor', [media].concat(args));\n      this.media = media;\n      this.active = true;\n      this.monitor = true;\n      this.transport.startCall({\n        media: this.media,\n        monitor: true\n      });\n    }\n    return startCallAsMonitor;\n  }();\n  _proto2.onRemoteCall = function () {\n    function onRemoteCall(data) {\n      var _this11 = this,\n        _data$media2;\n      if (this.autoAccept === true) {\n        setTimeout(function () {\n          _this11.joinCall({\n            to: data.from,\n            monitor: data.monitor,\n            media: data.media\n          });\n        }, 0);\n        return;\n      }\n      var user = Meteor.users.findOne(data.from);\n      var fromUsername = undefined;\n      if (user !== null && user !== void 0 && user.username) {\n        fromUsername = user.username;\n      }\n      var subscription = ChatSubscription.findOne({\n        rid: data.room\n      });\n      var icon;\n      var title;\n      if (data.monitor === true) {\n        icon = 'eye';\n        title = t('WebRTC_monitor_call_from_%s', fromUsername);\n      } else if (subscription && subscription.t === 'd') {\n        var _data$media;\n        if ((_data$media = data.media) !== null && _data$media !== void 0 && _data$media.video) {\n          icon = 'video';\n          title = t('WebRTC_direct_video_call_from_%s', fromUsername);\n        } else {\n          icon = 'phone';\n          title = t('WebRTC_direct_audio_call_from_%s', fromUsername);\n        }\n      } else if ((_data$media2 = data.media) !== null && _data$media2 !== void 0 && _data$media2.video) {\n        icon = 'video';\n        title = t('WebRTC_group_video_call_from_%s', subscription.name);\n      } else {\n        icon = 'phone';\n        title = t('WebRTC_group_audio_call_from_%s', subscription.name);\n      }\n      imperativeModal.open({\n        component: GenericModal,\n        props: {\n          title: title,\n          icon: icon,\n          confirmText: t('Yes'),\n          cancelText: t('No'),\n          children: t('Do_you_want_to_accept'),\n          onConfirm: function () {\n            void goToRoomById(data.room);\n            return _this11.joinCall({\n              to: data.from,\n              monitor: data.monitor,\n              media: data.media\n            });\n          },\n          onCancel: function () {\n            return _this11.stop();\n          },\n          onClose: function () {\n            return _this11.stop();\n          }\n        }\n      });\n    }\n    return onRemoteCall;\n  }();\n  _proto2.joinCall = function () {\n    function joinCall() {\n      var _this12 = this;\n      var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      data.media = this.media;\n      for (var _len6 = arguments.length, args = new Array(_len6 > 1 ? _len6 - 1 : 0), _key6 = 1; _key6 < _len6; _key6++) {\n        args[_key6 - 1] = arguments[_key6];\n      }\n      this.log('joinCall', [data].concat(args));\n      this.getLocalUserMedia(function () {\n        _this12.remoteMonitoring = data.monitor;\n        _this12.active = true;\n        _this12.transport.joinCall(data);\n      });\n    }\n    return joinCall;\n  }();\n  _proto2.onRemoteJoin = function () {\n    function onRemoteJoin(data) {\n      var _this13 = this;\n      if (this.active !== true) {\n        return;\n      }\n      for (var _len7 = arguments.length, args = new Array(_len7 > 1 ? _len7 - 1 : 0), _key7 = 1; _key7 < _len7; _key7++) {\n        args[_key7 - 1] = arguments[_key7];\n      }\n      this.log('onRemoteJoin', [data].concat(args));\n      var peerConnection = this.getPeerConnection(data.from);\n      // needsRefresh = false\n      // if peerConnection.iceConnectionState isnt 'new'\n      // needsAudio = data.media.audio is true and peerConnection.remoteMedia.audio isnt true\n      // needsVideo = data.media.video is true and peerConnection.remoteMedia.video isnt true\n      // needsRefresh = needsAudio or needsVideo or data.media.desktop isnt peerConnection.remoteMedia.desktop\n      // # if peerConnection.signalingState is \"have-local-offer\" or needsRefresh\n      if (peerConnection.signalingState !== 'checking') {\n        this.stopPeerConnection(data.from);\n        peerConnection = this.getPeerConnection(data.from);\n      }\n      if (peerConnection.iceConnectionState !== 'new') {\n        return;\n      }\n      peerConnection.remoteMedia = data.media;\n      if (this.localStream) {\n        peerConnection.addStream(this.localStream);\n      }\n      var onOffer = function (offer) {\n        var onLocalDescription = function () {\n          _this13.transport.sendDescription({\n            to: data.from,\n            type: 'offer',\n            ts: peerConnection.createdAt,\n            media: _this13.media,\n            description: {\n              sdp: offer.sdp,\n              type: offer.type\n            }\n          });\n        };\n        void peerConnection.setLocalDescription(new RTCSessionDescription(offer), onLocalDescription, _this13.onError);\n      };\n      if (data.monitor === true) {\n        var _data$media3, _data$media4;\n        void peerConnection.createOffer(onOffer, this.onError, {\n          mandatory: {\n            OfferToReceiveAudio: (_data$media3 = data.media) === null || _data$media3 === void 0 ? void 0 : _data$media3.audio,\n            OfferToReceiveVideo: (_data$media4 = data.media) === null || _data$media4 === void 0 ? void 0 : _data$media4.video\n          }\n        });\n      } else {\n        void peerConnection.createOffer(onOffer, this.onError);\n      }\n    }\n    return onRemoteJoin;\n  }();\n  _proto2.onRemoteOffer = function () {\n    function onRemoteOffer(data) {\n      var _this14 = this;\n      if (this.active !== true) {\n        return;\n      }\n      for (var _len8 = arguments.length, args = new Array(_len8 > 1 ? _len8 - 1 : 0), _key8 = 1; _key8 < _len8; _key8++) {\n        args[_key8 - 1] = arguments[_key8];\n      }\n      this.log('onRemoteOffer', [data].concat(args));\n      var peerConnection = this.getPeerConnection(data.from);\n      if (['have-local-offer', 'stable'].includes(peerConnection.signalingState) && peerConnection.createdAt < data.ts) {\n        this.stopPeerConnection(data.from);\n        peerConnection = this.getPeerConnection(data.from);\n      }\n      if (peerConnection.iceConnectionState !== 'new') {\n        return;\n      }\n      void peerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\n      try {\n        if (this.localStream) {\n          peerConnection.addStream(this.localStream);\n        }\n      } catch (error) {\n        console.log(error);\n      }\n      var onAnswer = function (answer) {\n        var onLocalDescription = function () {\n          _this14.transport.sendDescription({\n            to: data.from,\n            type: 'answer',\n            ts: peerConnection.createdAt,\n            description: {\n              sdp: answer.sdp,\n              type: answer.type\n            }\n          });\n        };\n        void peerConnection.setLocalDescription(new RTCSessionDescription(answer), onLocalDescription, _this14.onError);\n      };\n      void peerConnection.createAnswer(onAnswer, this.onError);\n    }\n    return onRemoteOffer;\n  }();\n  _proto2.onRemoteCandidate = function () {\n    function onRemoteCandidate(data) {\n      var _this$remoteItems$get;\n      if (this.active !== true) {\n        return;\n      }\n      if (data.to !== this.selfId) {\n        return;\n      }\n      for (var _len9 = arguments.length, args = new Array(_len9 > 1 ? _len9 - 1 : 0), _key9 = 1; _key9 < _len9; _key9++) {\n        args[_key9 - 1] = arguments[_key9];\n      }\n      this.log('onRemoteCandidate', [data].concat(args));\n      var peerConnection = this.getPeerConnection(data.from);\n      if (peerConnection.iceConnectionState !== 'closed' && peerConnection.iceConnectionState !== 'failed' && peerConnection.iceConnectionState !== 'disconnected' && peerConnection.iceConnectionState !== 'completed') {\n        void peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));\n      }\n      document.querySelector('video#remoteVideo').srcObject = (_this$remoteItems$get = this.remoteItems.get()[0]) === null || _this$remoteItems$get === void 0 ? void 0 : _this$remoteItems$get.url;\n    }\n    return onRemoteCandidate;\n  }();\n  _proto2.onRemoteDescription = function () {\n    function onRemoteDescription(data) {\n      if (this.active !== true) {\n        return;\n      }\n      if (data.to !== this.selfId) {\n        return;\n      }\n      for (var _len10 = arguments.length, args = new Array(_len10 > 1 ? _len10 - 1 : 0), _key10 = 1; _key10 < _len10; _key10++) {\n        args[_key10 - 1] = arguments[_key10];\n      }\n      this.log('onRemoteDescription', [data].concat(args));\n      var peerConnection = this.getPeerConnection(data.from);\n      if (data.type === 'offer') {\n        peerConnection.remoteMedia = data.media;\n        this.onRemoteOffer({\n          from: data.from,\n          ts: data.ts,\n          description: data.description\n        });\n      } else {\n        void peerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\n      }\n    }\n    return onRemoteDescription;\n  }();\n  return WebRTCClass;\n}();\nvar WebRTC = new ( /*#__PURE__*/function () {\n  function _class() {\n    this.instancesByRoomId = {};\n    this.instancesByRoomId = {};\n  }\n  var _proto3 = _class.prototype;\n  _proto3.getInstanceByRoomId = function () {\n    function getInstanceByRoomId(rid) {\n      var visitorId = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var enabled = false;\n      if (!visitorId) {\n        var subscription = ChatSubscription.findOne({\n          rid: rid\n        });\n        if (!subscription) {\n          return;\n        }\n        switch (subscription.t) {\n          case 'd':\n            enabled = settings.get('WebRTC_Enable_Direct');\n            break;\n          case 'p':\n            enabled = settings.get('WebRTC_Enable_Private');\n            break;\n          case 'c':\n            enabled = settings.get('WebRTC_Enable_Channel');\n            break;\n          case 'l':\n            enabled = settings.get('Omnichannel_call_provider') === 'WebRTC';\n        }\n      } else {\n        enabled = settings.get('Omnichannel_call_provider') === 'WebRTC';\n      }\n      enabled = enabled && settings.get('WebRTC_Enabled');\n      if (enabled === false) {\n        return;\n      }\n      if (this.instancesByRoomId[rid] == null) {\n        var uid = Meteor.userId();\n        var autoAccept = false;\n        if (visitorId) {\n          uid = visitorId;\n          autoAccept = true;\n        }\n        this.instancesByRoomId[rid] = new WebRTCClass(uid, rid, autoAccept);\n      }\n      return this.instancesByRoomId[rid];\n    }\n    return getInstanceByRoomId;\n  }();\n  return _class;\n}())();\nMeteor.startup(function () {\n  Tracker.autorun(function () {\n    var uid = Meteor.userId();\n    if (uid) {\n      sdk.stream('notify-user', [uid + \"/\" + WEB_RTC_EVENTS.WEB_RTC], function (type, data) {\n        if (data.room == null) {\n          return;\n        }\n        var webrtc = WebRTC.getInstanceByRoomId(data.room);\n        switch (type) {\n          case 'candidate':\n            webrtc === null || webrtc === void 0 ? void 0 : webrtc.onUserStream('candidate', data);\n            break;\n          case 'description':\n            webrtc === null || webrtc === void 0 ? void 0 : webrtc.onUserStream('description', data);\n            break;\n          case 'join':\n            webrtc === null || webrtc === void 0 ? void 0 : webrtc.onUserStream('join', data);\n            break;\n        }\n      });\n    }\n  });\n});","map":{"version":3,"names":["_toConsumableArray","module","link","default","v","_slicedToArray","_inheritsLoose","export","WebRTC","Emitter","Meteor","ReactiveVar","Tracker","GenericModal","imperativeModal","goToRoomById","ChatSubscription","settings","sdk","t","WEB_RTC_EVENTS","ChromeScreenShare","WebRTCTransportClass","_Emitter","webrtcInstance","_this","call","debug","stream","room","WEB_RTC","type","data","log","emit","_proto","prototype","_console","console","apply","arguments","onUserStream","_len","length","_ref","Array","_key","startCall","selfId","publish","CALL","from","media","monitor","joinCall","to","JOIN","sendCandidate","CANDIDATE","sendDescription","DESCRIPTION","sendStatus","STATUS","onRemoteCall","fn","on","onRemoteJoin","onRemoteCandidate","onRemoteDescription","onRemoteStatus","WebRTCClass","_this2","autoAccept","undefined","transport","config","TransportClass","peerConnections","remoteItems","remoteItemsById","callInProgress","audioEnabled","videoEnabled","overlayEnabled","screenShareEnabled","localUrl","active","remoteMonitoring","navigator","screenShareAvailable","resetCallInProgress","set","callInProgressTimeout","audioContext","stopPeerConnection","id","peerConnection","close","updateRemoteItems","localStream","iceServers","servers","get","trim","replace","split","forEach","server","parts","serverConfig","urls","pop","_parts$0$split","_parts$0$split2","username","credential","decodeURIComponent","push","userAgent","toLocaleLowerCase","indexOf","includes","video","audio","bind","setInterval","checkPeerConnections","_proto2","_len2","_ref2","_key2","_console2","onError","_console3","error","_this3","date","Date","now","Object","entries","some","_ref3","_ref4","iceConnectionState","createdAt","items","itemsById","_ref5","_ref6","getRemoteStreams","remoteStream","item","url","state","stateText","connected","broadcastStatus","remoteConnections","_ref7","_ref8","remoteMedia","_this4","clearTimeout","setTimeout","concat","remoteConnection","getPeerConnection","_this5","RTCPeerConnection","eventNames","eventName","addEventListener","e","candidate","sdpMLineIndex","sdpMid","keys","stop","_getUserMedia","onSuccess","_this6","_navigator$mediaDevic","_navigator$getUserMed","_navigator","onSuccessLocal","AudioContext","getAudioTracks","source","createMediaStreamSource","volume","createGain","connect","peer","createMediaStreamDestination","gain","value","removeTrack","addTrack","mediaDevices","getUserMedia","then","catch","_this7","desktop","getScreen","audioStream","refresh","open","component","props","variant","title","isChromeExtensionInstalled","installed","isFirefoxExtensionInstalled","window","rocketchatscreenshare","confirmText","cancelText","children","onConfirm","chrome","webstore","install","_error","getScreenSuccess","mozMediaSource","mediaSource","getSourceId","mandatory","chromeMediaSource","chromeMediaSourceId","maxWidth","maxHeight","getAudioSuccess","getAudioError","getLocalUserMedia","callback","_this8","_len3","args","_key3","disableAudio","disableVideo","_ref9","_ref10","addStream","document","querySelector","srcObject","stopAllPeerConnections","_window$audioContext","setAudioEnabled","enabled","enableAudio","toggleAudio","setVideoEnabled","getVideoTracks","disableScreenShare","setScreenShareEnabled","enableScreenShare","_this9","err","enableVideo","toggleVideo","getTracks","track","_this10","_len4","_key4","startCallAsMonitor","_len5","_key5","_this11","_data$media2","user","users","findOne","fromUsername","subscription","rid","icon","_data$media","name","onCancel","onClose","_this12","_len6","_key6","_this13","_len7","_key7","signalingState","onOffer","offer","onLocalDescription","ts","description","sdp","setLocalDescription","RTCSessionDescription","_data$media3","_data$media4","createOffer","OfferToReceiveAudio","OfferToReceiveVideo","onRemoteOffer","_this14","_len8","_key8","setRemoteDescription","onAnswer","answer","createAnswer","_this$remoteItems$get","_len9","_key9","addIceCandidate","RTCIceCandidate","_len10","_key10","_class","instancesByRoomId","_proto3","getInstanceByRoomId","visitorId","uid","userId","startup","autorun","webrtc"],"sources":["app/webrtc/client/WebRTCClass.ts"],"sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport type { StreamKeys, StreamNames, StreamerCallbackArgs } from '@rocket.chat/ddp-client';\nimport { Emitter } from '@rocket.chat/emitter';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Tracker } from 'meteor/tracker';\n\nimport GenericModal from '../../../client/components/GenericModal';\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\nimport { goToRoomById } from '../../../client/lib/utils/goToRoomById';\nimport { ChatSubscription } from '../../models/client';\nimport { settings } from '../../settings/client';\nimport { sdk } from '../../utils/client/lib/SDKClient';\nimport { t } from '../../utils/lib/i18n';\nimport { WEB_RTC_EVENTS } from '../lib/constants';\nimport { ChromeScreenShare } from './screenShare';\n\n// FIXME: there is a mix of obsolete definitions and incorrect field assignments\n\ndeclare global {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface RTCPeerConnection {\n\t\t/** @deprecated non-standard */\n\t\tcreatedAt: number;\n\t\t/** @deprecated non-standard */\n\t\tremoteMedia: MediaStreamConstraints;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface RTCOfferOptions {\n\t\t/** @deprecated non-standard */\n\t\tmandatory?: unknown;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface MediaStream {\n\t\t/** @deprecated non-standard */\n\t\tvolume?: GainNode;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface MediaStreamConstraints {\n\t\t/** @deprecated non-standard */\n\t\tdesktop?: boolean;\n\t}\n\n\t/** @deprecated browser-specific global */\n\tconst chrome: {\n\t\twebstore: {\n\t\t\tinstall(url: string, onSuccess: () => void, onError: (error: any) => void): void;\n\t\t};\n\t};\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface Window {\n\t\trocketchatscreenshare?: unknown;\n\t\taudioContext?: AudioContext;\n\t}\n}\n\ntype EventData<TStreamName extends StreamNames, TStreamKey extends StreamKeys<TStreamName>, TType> = Extract<\n\tStreamerCallbackArgs<TStreamName, TStreamKey>,\n\t[type: TType, data: any]\n>[1];\n\ntype StatusData = EventData<'notify-room', `${string}/webrtc`, 'status'>;\ntype CallData = EventData<'notify-room-users', `${string}/webrtc`, 'call'>;\ntype CandidateData = EventData<'notify-user', `${string}/webrtc`, 'candidate'>;\ntype DescriptionData = EventData<'notify-user', `${string}/webrtc`, 'description'>;\ntype JoinData = EventData<'notify-user', `${string}/webrtc`, 'join'>;\n\ntype RemoteItem = {\n\tid: string;\n\turl: MediaStream;\n\tstate: RTCIceConnectionState;\n\tstateText?: string;\n\tconnected?: boolean;\n};\n\ntype RemoteConnection = {\n\tid: string;\n\tmedia: MediaStreamConstraints;\n};\n\nclass WebRTCTransportClass extends Emitter<{\n\tstatus: StatusData;\n\tcall: CallData;\n\tcandidate: CandidateData;\n\tdescription: DescriptionData;\n\tjoin: JoinData;\n}> {\n\tpublic debug = false;\n\n\tconstructor(public webrtcInstance: WebRTCClass) {\n\t\tsuper();\n\t\tsdk.stream('notify-room', [`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`], (type, data) => {\n\t\t\tthis.log('WebRTCTransportClass - onRoom', type, data);\n\t\t\tthis.emit(type, data);\n\t\t});\n\t}\n\n\tlog(...args: unknown[]) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log(...args);\n\t\t}\n\t}\n\n\tonUserStream(type: 'candidate', data: CandidateData): void;\n\n\tonUserStream(type: 'description', data: DescriptionData): void;\n\n\tonUserStream(type: 'join', data: JoinData): void;\n\n\tonUserStream(\n\t\t...[type, data]:\n\t\t\t| [type: 'candidate', data: CandidateData]\n\t\t\t| [type: 'description', data: DescriptionData]\n\t\t\t| [type: 'join', data: JoinData]\n\t) {\n\t\tif (data.room !== this.webrtcInstance.room) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('WebRTCTransportClass - onUser', type, data);\n\n\t\tswitch (type) {\n\t\t\tcase 'candidate':\n\t\t\t\tthis.emit('candidate', data);\n\t\t\t\tbreak;\n\t\t\tcase 'description':\n\t\t\t\tthis.emit('description', data);\n\t\t\t\tbreak;\n\t\t\tcase 'join':\n\t\t\t\tthis.emit('join', data);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tstartCall(data: CallData) {\n\t\tthis.log('WebRTCTransportClass - startCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\n\t\tsdk.publish('notify-room-users', [\n\t\t\t`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`,\n\t\t\tWEB_RTC_EVENTS.CALL,\n\t\t\t{\n\t\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\t\troom: this.webrtcInstance.room,\n\t\t\t\tmedia: data.media,\n\t\t\t\tmonitor: data.monitor,\n\t\t\t},\n\t\t]);\n\t}\n\n\tjoinCall(data: JoinData) {\n\t\tthis.log('WebRTCTransportClass - joinCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\n\t\tif (data.monitor === true) {\n\t\t\tsdk.publish('notify-user', [\n\t\t\t\t`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`,\n\t\t\t\tWEB_RTC_EVENTS.JOIN,\n\t\t\t\t{\n\t\t\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\t\t\troom: this.webrtcInstance.room,\n\t\t\t\t\tmedia: data.media,\n\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t},\n\t\t\t]);\n\t\t} else {\n\t\t\tsdk.publish('notify-room-users', [\n\t\t\t\t`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`,\n\t\t\t\tWEB_RTC_EVENTS.JOIN,\n\t\t\t\t{\n\t\t\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\t\t\troom: this.webrtcInstance.room,\n\t\t\t\t\tmedia: data.media,\n\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t},\n\t\t\t]);\n\t\t}\n\t}\n\n\tsendCandidate(data: CandidateData) {\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tdata.room = this.webrtcInstance.room;\n\t\tthis.log('WebRTCTransportClass - sendCandidate', data);\n\t\tsdk.publish('notify-user', [`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.CANDIDATE, data]);\n\t}\n\n\tsendDescription(data: DescriptionData) {\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tdata.room = this.webrtcInstance.room;\n\t\tthis.log('WebRTCTransportClass - sendDescription', data);\n\t\tsdk.publish('notify-user', [`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.DESCRIPTION, data]);\n\t}\n\n\tsendStatus(data: StatusData) {\n\t\tthis.log('WebRTCTransportClass - sendStatus', data, this.webrtcInstance.room);\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tsdk.publish('notify-room', [`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.STATUS, data]);\n\t}\n\n\tonRemoteCall(fn: (data: CallData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.CALL, fn);\n\t}\n\n\tonRemoteJoin(fn: (data: JoinData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.JOIN, fn);\n\t}\n\n\tonRemoteCandidate(fn: (data: CandidateData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.CANDIDATE, fn);\n\t}\n\n\tonRemoteDescription(fn: (data: DescriptionData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.DESCRIPTION, fn);\n\t}\n\n\tonRemoteStatus(fn: (data: StatusData) => void) {\n\t\treturn this.on(WEB_RTC_EVENTS.STATUS, fn);\n\t}\n}\n\nclass WebRTCClass {\n\ttransport: WebRTCTransportClass;\n\n\tconfig: { iceServers: RTCIceServer[] };\n\n\tdebug: boolean;\n\n\tTransportClass: typeof WebRTCTransportClass;\n\n\tpeerConnections: Record<string, RTCPeerConnection> = {};\n\n\tremoteItems: ReactiveVar<RemoteItem[]>;\n\n\tremoteItemsById: ReactiveVar<Record<string, RemoteItem>>;\n\n\tcallInProgress: ReactiveVar<boolean>;\n\n\taudioEnabled: ReactiveVar<boolean>;\n\n\tvideoEnabled: ReactiveVar<boolean>;\n\n\toverlayEnabled: ReactiveVar<boolean>;\n\n\tscreenShareEnabled: ReactiveVar<boolean>;\n\n\tlocalUrl: ReactiveVar<MediaStream | undefined>;\n\n\tactive: boolean;\n\n\tremoteMonitoring: boolean;\n\n\tmonitor: boolean;\n\n\tnavigator: string | undefined;\n\n\tscreenShareAvailable: boolean;\n\n\tmedia: MediaStreamConstraints;\n\n\tconstructor(public selfId: string, public room: string, public autoAccept = false) {\n\t\tthis.config = {\n\t\t\ticeServers: [],\n\t\t};\n\t\tthis.debug = false;\n\t\tthis.TransportClass = WebRTCTransportClass;\n\t\tlet servers = settings.get<string>('WebRTC_Servers');\n\t\tif (servers && servers.trim() !== '') {\n\t\t\tservers = servers.replace(/\\s/g, '');\n\n\t\t\tservers.split(',').forEach((server) => {\n\t\t\t\tconst parts = server.split('@');\n\t\t\t\tconst serverConfig: RTCIceServer = {\n\t\t\t\t\turls: parts.pop()!,\n\t\t\t\t};\n\t\t\t\tif (parts.length === 1) {\n\t\t\t\t\tconst [username, credential] = parts[0].split(':');\n\t\t\t\t\tserverConfig.username = decodeURIComponent(username);\n\t\t\t\t\tserverConfig.credential = decodeURIComponent(credential);\n\t\t\t\t}\n\t\t\t\tthis.config.iceServers.push(serverConfig);\n\t\t\t});\n\t\t}\n\t\tthis.peerConnections = {};\n\t\tthis.remoteItems = new ReactiveVar([]);\n\t\tthis.remoteItemsById = new ReactiveVar({});\n\t\tthis.callInProgress = new ReactiveVar(false);\n\t\tthis.audioEnabled = new ReactiveVar(false);\n\t\tthis.videoEnabled = new ReactiveVar(false);\n\t\tthis.overlayEnabled = new ReactiveVar(false);\n\t\tthis.screenShareEnabled = new ReactiveVar(false);\n\t\tthis.localUrl = new ReactiveVar(undefined);\n\t\tthis.active = false;\n\t\tthis.remoteMonitoring = false;\n\t\tthis.monitor = false;\n\t\tthis.navigator = undefined;\n\t\tconst userAgent = navigator.userAgent.toLocaleLowerCase();\n\n\t\tif (userAgent.indexOf('electron') !== -1) {\n\t\t\tthis.navigator = 'electron';\n\t\t} else if (userAgent.indexOf('chrome') !== -1) {\n\t\t\tthis.navigator = 'chrome';\n\t\t} else if (userAgent.indexOf('firefox') !== -1) {\n\t\t\tthis.navigator = 'firefox';\n\t\t} else if (userAgent.indexOf('safari') !== -1) {\n\t\t\tthis.navigator = 'safari';\n\t\t}\n\n\t\tthis.screenShareAvailable = ['chrome', 'firefox', 'electron'].includes(this.navigator!);\n\t\tthis.media = {\n\t\t\tvideo: true,\n\t\t\taudio: true,\n\t\t};\n\t\tthis.transport = new this.TransportClass(this);\n\t\tthis.transport.onRemoteCall(this.onRemoteCall.bind(this));\n\t\tthis.transport.onRemoteJoin(this.onRemoteJoin.bind(this));\n\t\tthis.transport.onRemoteCandidate(this.onRemoteCandidate.bind(this));\n\t\tthis.transport.onRemoteDescription(this.onRemoteDescription.bind(this));\n\t\tthis.transport.onRemoteStatus(this.onRemoteStatus.bind(this));\n\n\t\tsetInterval(this.checkPeerConnections.bind(this), 1000);\n\t}\n\n\tonUserStream(type: 'candidate', data: CandidateData): void;\n\n\tonUserStream(type: 'description', data: DescriptionData): void;\n\n\tonUserStream(type: 'join', data: JoinData): void;\n\n\tonUserStream(\n\t\t...[type, data]:\n\t\t\t| [type: 'candidate', data: CandidateData]\n\t\t\t| [type: 'description', data: DescriptionData]\n\t\t\t| [type: 'join', data: JoinData]\n\t) {\n\t\tswitch (type) {\n\t\t\tcase 'candidate':\n\t\t\t\tthis.transport.onUserStream('candidate', data);\n\t\t\t\tbreak;\n\n\t\t\tcase 'description':\n\t\t\t\tthis.transport.onUserStream('description', data);\n\t\t\t\tbreak;\n\n\t\t\tcase 'join':\n\t\t\t\tthis.transport.onUserStream('join', data);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tlog(...args: unknown[]) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log(...args);\n\t\t}\n\t}\n\n\tonError(...args: unknown[]) {\n\t\tconsole.error(...args);\n\t}\n\n\tcheckPeerConnections() {\n\t\tconst { peerConnections } = this;\n\t\tconst date = Date.now();\n\t\tObject.entries(peerConnections).some(([id, peerConnection]) => {\n\t\t\tif (!['connected', 'completed'].includes(peerConnection.iceConnectionState) && peerConnection.createdAt + 5000 < date) {\n\t\t\t\tthis.stopPeerConnection(id);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tupdateRemoteItems() {\n\t\tconst items: RemoteItem[] = [];\n\t\tconst itemsById: Record<string, RemoteItem> = {};\n\t\tconst { peerConnections } = this;\n\n\t\tObject.entries(peerConnections).forEach(([id, peerConnection]) => {\n\t\t\tpeerConnection.getRemoteStreams().forEach((remoteStream) => {\n\t\t\t\tconst item: RemoteItem = {\n\t\t\t\t\tid,\n\t\t\t\t\turl: remoteStream,\n\t\t\t\t\tstate: peerConnection.iceConnectionState,\n\t\t\t\t};\n\t\t\t\tswitch (peerConnection.iceConnectionState) {\n\t\t\t\t\tcase 'checking':\n\t\t\t\t\t\titem.stateText = 'Connecting...';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'connected':\n\t\t\t\t\tcase 'completed':\n\t\t\t\t\t\titem.stateText = 'Connected';\n\t\t\t\t\t\titem.connected = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'disconnected':\n\t\t\t\t\t\titem.stateText = 'Disconnected';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'failed':\n\t\t\t\t\t\titem.stateText = 'Failed';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'closed':\n\t\t\t\t\t\titem.stateText = 'Closed';\n\t\t\t\t}\n\t\t\t\titems.push(item);\n\t\t\t\titemsById[id] = item;\n\t\t\t});\n\t\t});\n\t\tthis.remoteItems.set(items);\n\t\tthis.remoteItemsById.set(itemsById);\n\t}\n\n\tresetCallInProgress = () => {\n\t\tthis.callInProgress.set(false);\n\t};\n\n\tbroadcastStatus() {\n\t\tif (this.active !== true || this.monitor === true || this.remoteMonitoring === true) {\n\t\t\treturn;\n\t\t}\n\t\tconst remoteConnections: RemoteConnection[] = [];\n\t\tconst { peerConnections } = this;\n\t\tObject.entries(peerConnections).forEach(([id, { remoteMedia: media }]) => {\n\t\t\tremoteConnections.push({\n\t\t\t\tid,\n\t\t\t\tmedia,\n\t\t\t});\n\t\t});\n\n\t\tthis.transport.sendStatus({\n\t\t\tmedia: this.media,\n\t\t\tremoteConnections,\n\t\t});\n\t}\n\n\tcallInProgressTimeout: ReturnType<typeof setTimeout> | undefined = undefined;\n\n\tonRemoteStatus(data: StatusData) {\n\t\t// this.log(onRemoteStatus, arguments);\n\t\tthis.callInProgress.set(true);\n\t\tclearTimeout(this.callInProgressTimeout);\n\t\tthis.callInProgressTimeout = setTimeout(this.resetCallInProgress, 2000);\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tconst remoteConnections = [\n\t\t\t{\n\t\t\t\tid: data.from!,\n\t\t\t\tmedia: data.media,\n\t\t\t},\n\t\t\t...data.remoteConnections,\n\t\t];\n\n\t\tremoteConnections.forEach((remoteConnection) => {\n\t\t\tif (remoteConnection.id !== this.selfId && this.peerConnections[remoteConnection.id] == null) {\n\t\t\t\tthis.log('reconnecting with', remoteConnection.id);\n\t\t\t\tthis.onRemoteJoin({\n\t\t\t\t\tfrom: remoteConnection.id,\n\t\t\t\t\tmedia: remoteConnection.media,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tgetPeerConnection(id: string) {\n\t\tif (this.peerConnections[id] != null) {\n\t\t\treturn this.peerConnections[id];\n\t\t}\n\t\tconst peerConnection = new RTCPeerConnection(this.config);\n\n\t\tpeerConnection.createdAt = Date.now();\n\t\tpeerConnection.remoteMedia = {};\n\t\tthis.peerConnections[id] = peerConnection;\n\t\tconst eventNames = [\n\t\t\t'icecandidate',\n\t\t\t'addstream',\n\t\t\t'removestream',\n\t\t\t'iceconnectionstatechange',\n\t\t\t'datachannel',\n\t\t\t'identityresult',\n\t\t\t'idpassertionerror',\n\t\t\t'idpvalidationerror',\n\t\t\t'negotiationneeded',\n\t\t\t'peeridentity',\n\t\t\t'signalingstatechange',\n\t\t];\n\n\t\teventNames.forEach((eventName) => {\n\t\t\tpeerConnection.addEventListener(eventName, (e) => {\n\t\t\t\tthis.log(id, e.type, e);\n\t\t\t});\n\t\t});\n\n\t\tpeerConnection.addEventListener('icecandidate', (e) => {\n\t\t\tif (e.candidate == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.transport.sendCandidate({\n\t\t\t\tto: id,\n\t\t\t\tcandidate: {\n\t\t\t\t\tcandidate: e.candidate.candidate,\n\t\t\t\t\tsdpMLineIndex: e.candidate.sdpMLineIndex,\n\t\t\t\t\tsdpMid: e.candidate.sdpMid,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t\tpeerConnection.addEventListener('addstream', () => {\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\tpeerConnection.addEventListener('removestream', () => {\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\tpeerConnection.addEventListener('iceconnectionstatechange', () => {\n\t\t\tif (\n\t\t\t\t(peerConnection.iceConnectionState === 'disconnected' || peerConnection.iceConnectionState === 'closed') &&\n\t\t\t\tpeerConnection === this.peerConnections[id]\n\t\t\t) {\n\t\t\t\tthis.stopPeerConnection(id);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (Object.keys(this.peerConnections).length === 0) {\n\t\t\t\t\t\tthis.stop();\n\t\t\t\t\t}\n\t\t\t\t}, 3000);\n\t\t\t}\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\treturn peerConnection;\n\t}\n\n\taudioContext: AudioContext | undefined;\n\n\t_getUserMedia(media: MediaStreamConstraints, onSuccess: (stream: MediaStream) => void, onError: (error?: any) => void) {\n\t\tconst onSuccessLocal = (stream: MediaStream) => {\n\t\t\tif (AudioContext && stream.getAudioTracks().length > 0) {\n\t\t\t\tconst audioContext = new AudioContext();\n\t\t\t\tconst source = audioContext.createMediaStreamSource(stream);\n\t\t\t\tconst volume = audioContext.createGain();\n\t\t\t\tsource.connect(volume);\n\t\t\t\tconst peer = audioContext.createMediaStreamDestination();\n\t\t\t\tvolume.connect(peer);\n\t\t\t\tvolume.gain.value = 0.6;\n\t\t\t\tstream.removeTrack(stream.getAudioTracks()[0]);\n\t\t\t\tstream.addTrack(peer.stream.getAudioTracks()[0]);\n\t\t\t\tstream.volume = volume;\n\t\t\t\tthis.audioContext = audioContext;\n\t\t\t}\n\t\t\tonSuccess(stream);\n\t\t};\n\n\t\tif (navigator.mediaDevices?.getUserMedia) {\n\t\t\treturn navigator.mediaDevices.getUserMedia(media).then(onSuccessLocal).catch(onError);\n\t\t}\n\n\t\tnavigator.getUserMedia?.(media, onSuccessLocal, onError);\n\t}\n\n\tgetUserMedia(media: MediaStreamConstraints, onSuccess: (stream: MediaStream) => void, onError: (error: any) => void = this.onError) {\n\t\tif (media.desktop !== true) {\n\t\t\tvoid this._getUserMedia(media, onSuccess, onError);\n\t\t\treturn;\n\t\t}\n\t\tif (this.screenShareAvailable !== true) {\n\t\t\tconsole.log('Screen share is not avaliable');\n\t\t\treturn;\n\t\t}\n\t\tconst getScreen = (audioStream?: MediaStream) => {\n\t\t\tconst refresh = function () {\n\t\t\t\timperativeModal.open({\n\t\t\t\t\tcomponent: GenericModal,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tvariant: 'warning',\n\t\t\t\t\t\ttitle: t('Refresh_your_page_after_install_to_enable_screen_sharing'),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tconst isChromeExtensionInstalled = this.navigator === 'chrome' && ChromeScreenShare.installed;\n\t\t\tconst isFirefoxExtensionInstalled = this.navigator === 'firefox' && window.rocketchatscreenshare != null;\n\n\t\t\tif (!isChromeExtensionInstalled && !isFirefoxExtensionInstalled) {\n\t\t\t\timperativeModal.open({\n\t\t\t\t\tcomponent: GenericModal,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttitle: t('Screen_Share'),\n\t\t\t\t\t\tvariant: 'warning',\n\t\t\t\t\t\tconfirmText: t('Install_Extension'),\n\t\t\t\t\t\tcancelText: t('Cancel'),\n\t\t\t\t\t\tchildren: t('You_need_install_an_extension_to_allow_screen_sharing'),\n\t\t\t\t\t\tonConfirm: () => {\n\t\t\t\t\t\t\tif (this.navigator === 'chrome') {\n\t\t\t\t\t\t\t\tconst url = 'https://chrome.google.com/webstore/detail/rocketchat-screen-share/nocfbnnmjnndkbipkabodnheejiegccf';\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tchrome.webstore.install(url, refresh, () => {\n\t\t\t\t\t\t\t\t\t\twindow.open(url);\n\t\t\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} catch (_error) {\n\t\t\t\t\t\t\t\t\tconsole.log(_error);\n\t\t\t\t\t\t\t\t\twindow.open(url);\n\t\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (this.navigator === 'firefox') {\n\t\t\t\t\t\t\t\twindow.open('https://addons.mozilla.org/en-GB/firefox/addon/rocketchat-screen-share/');\n\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\treturn onError(false);\n\t\t\t}\n\n\t\t\tconst getScreenSuccess = (stream: MediaStream) => {\n\t\t\t\tif (audioStream != null) {\n\t\t\t\t\tstream.addTrack(audioStream.getAudioTracks()[0]);\n\t\t\t\t}\n\t\t\t\tonSuccess(stream);\n\t\t\t};\n\t\t\tif (this.navigator === 'firefox') {\n\t\t\t\tmedia = {\n\t\t\t\t\taudio: media.audio,\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tmozMediaSource: 'window',\n\t\t\t\t\t\tmediaSource: 'window',\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tvoid this._getUserMedia(media, getScreenSuccess, onError);\n\t\t\t} else {\n\t\t\t\tChromeScreenShare.getSourceId(this.navigator!, (id) => {\n\t\t\t\t\tmedia = {\n\t\t\t\t\t\taudio: false,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\t\tchromeMediaSource: 'desktop',\n\t\t\t\t\t\t\t\tchromeMediaSourceId: id,\n\t\t\t\t\t\t\t\tmaxWidth: 1280,\n\t\t\t\t\t\t\t\tmaxHeight: 720,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t\tvoid this._getUserMedia(media, getScreenSuccess, onError);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tif (this.navigator === 'firefox' || media.audio == null || media.audio === false) {\n\t\t\tgetScreen();\n\t\t} else {\n\t\t\tconst getAudioSuccess = (audioStream: MediaStream) => {\n\t\t\t\tgetScreen(audioStream);\n\t\t\t};\n\t\t\tconst getAudioError = () => {\n\t\t\t\tgetScreen();\n\t\t\t};\n\n\t\t\tvoid this._getUserMedia(\n\t\t\t\t{\n\t\t\t\t\taudio: media.audio,\n\t\t\t\t},\n\t\t\t\tgetAudioSuccess,\n\t\t\t\tgetAudioError,\n\t\t\t);\n\t\t}\n\t}\n\n\tgetLocalUserMedia(callback: (...args: any[]) => void, ...args: unknown[]) {\n\t\tthis.log('getLocalUserMedia', [callback, ...args]);\n\t\tif (this.localStream != null) {\n\t\t\treturn callback(null, this.localStream);\n\t\t}\n\t\tconst onSuccess = (stream: MediaStream) => {\n\t\t\tthis.localStream = stream;\n\t\t\t!this.audioEnabled.get() && this.disableAudio();\n\t\t\t!this.videoEnabled.get() && this.disableVideo();\n\t\t\tthis.localUrl.set(stream);\n\t\t\tconst { peerConnections } = this;\n\t\t\tObject.entries(peerConnections).forEach(([, peerConnection]) => peerConnection.addStream(stream));\n\t\t\tdocument.querySelector<HTMLVideoElement>('video#localVideo')!.srcObject = stream;\n\t\t\tcallback(null, this.localStream);\n\t\t};\n\t\tconst onError = (error: any) => {\n\t\t\tcallback(false);\n\t\t\tthis.onError(error);\n\t\t};\n\t\tthis.getUserMedia(this.media, onSuccess, onError);\n\t}\n\n\tstopPeerConnection = (id: string) => {\n\t\tconst peerConnection = this.peerConnections[id];\n\t\tif (peerConnection == null) {\n\t\t\treturn;\n\t\t}\n\t\tdelete this.peerConnections[id];\n\t\tpeerConnection.close();\n\t\tthis.updateRemoteItems();\n\t};\n\n\tstopAllPeerConnections() {\n\t\tconst { peerConnections } = this;\n\n\t\tObject.keys(peerConnections).forEach(this.stopPeerConnection);\n\n\t\tvoid window.audioContext?.close(); // FIXME: probably should be `this.audioContext`\n\t}\n\n\tsetAudioEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.localStream.getAudioTracks().forEach((audio) => {\n\t\t\t\taudio.enabled = enabled;\n\t\t\t});\n\t\t\tthis.audioEnabled.set(enabled);\n\t\t}\n\t}\n\n\tdisableAudio() {\n\t\tthis.setAudioEnabled(false);\n\t}\n\n\tenableAudio() {\n\t\tthis.setAudioEnabled(true);\n\t}\n\n\ttoggleAudio() {\n\t\tif (this.audioEnabled.get()) {\n\t\t\treturn this.disableAudio();\n\t\t}\n\t\treturn this.enableAudio();\n\t}\n\n\tlocalStream: MediaStream | undefined;\n\n\tsetVideoEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.localStream.getVideoTracks().forEach((video) => {\n\t\t\t\tvideo.enabled = enabled;\n\t\t\t});\n\t\t\tthis.videoEnabled.set(enabled);\n\t\t}\n\t}\n\n\tdisableScreenShare() {\n\t\tthis.setScreenShareEnabled(false);\n\t}\n\n\tenableScreenShare() {\n\t\tthis.setScreenShareEnabled(true);\n\t}\n\n\tsetScreenShareEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.media.desktop = enabled;\n\t\t\tdelete this.localStream;\n\t\t\tthis.getLocalUserMedia((err) => {\n\t\t\t\tif (err != null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.screenShareEnabled.set(enabled);\n\t\t\t\tthis.stopAllPeerConnections();\n\t\t\t\tthis.joinCall();\n\t\t\t});\n\t\t}\n\t}\n\n\tdisableVideo() {\n\t\tthis.setVideoEnabled(false);\n\t}\n\n\tenableVideo() {\n\t\tthis.setVideoEnabled(true);\n\t}\n\n\ttoggleVideo() {\n\t\tif (this.videoEnabled.get()) {\n\t\t\treturn this.disableVideo();\n\t\t}\n\t\treturn this.enableVideo();\n\t}\n\n\tstop() {\n\t\tthis.active = false;\n\t\tthis.monitor = false;\n\t\tthis.remoteMonitoring = false;\n\t\tif (this.localStream != null && typeof this.localStream !== 'undefined') {\n\t\t\tthis.localStream.getTracks().forEach((track) => track.stop());\n\t\t}\n\t\tthis.localUrl.set(undefined);\n\t\tdelete this.localStream;\n\t\tthis.stopAllPeerConnections();\n\t}\n\n\tstartCall(media: MediaStreamConstraints = {}, ...args: unknown[]) {\n\t\tthis.log('startCall', [media, ...args]);\n\t\tthis.media = media;\n\t\tthis.getLocalUserMedia(() => {\n\t\t\tthis.active = true;\n\t\t\tthis.transport.startCall({\n\t\t\t\tmedia: this.media,\n\t\t\t});\n\t\t});\n\t}\n\n\tstartCallAsMonitor(media: MediaStreamConstraints = {}, ...args: unknown[]) {\n\t\tthis.log('startCallAsMonitor', [media, ...args]);\n\t\tthis.media = media;\n\t\tthis.active = true;\n\t\tthis.monitor = true;\n\t\tthis.transport.startCall({\n\t\t\tmedia: this.media,\n\t\t\tmonitor: true,\n\t\t});\n\t}\n\n\tonRemoteCall(data: CallData) {\n\t\tif (this.autoAccept === true) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.joinCall({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t\tmedia: data.media,\n\t\t\t\t});\n\t\t\t}, 0);\n\t\t\treturn;\n\t\t}\n\n\t\tconst user = Meteor.users.findOne(data.from);\n\t\tlet fromUsername = undefined;\n\t\tif (user?.username) {\n\t\t\tfromUsername = user.username;\n\t\t}\n\t\tconst subscription = ChatSubscription.findOne({\n\t\t\trid: data.room,\n\t\t})!;\n\n\t\tlet icon;\n\t\tlet title;\n\t\tif (data.monitor === true) {\n\t\t\ticon = 'eye' as const;\n\t\t\ttitle = t('WebRTC_monitor_call_from_%s', fromUsername);\n\t\t} else if (subscription && subscription.t === 'd') {\n\t\t\tif (data.media?.video) {\n\t\t\t\ticon = 'video' as const;\n\t\t\t\ttitle = t('WebRTC_direct_video_call_from_%s', fromUsername);\n\t\t\t} else {\n\t\t\t\ticon = 'phone' as const;\n\t\t\t\ttitle = t('WebRTC_direct_audio_call_from_%s', fromUsername);\n\t\t\t}\n\t\t} else if (data.media?.video) {\n\t\t\ticon = 'video' as const;\n\t\t\ttitle = t('WebRTC_group_video_call_from_%s', subscription.name);\n\t\t} else {\n\t\t\ticon = 'phone' as const;\n\t\t\ttitle = t('WebRTC_group_audio_call_from_%s', subscription.name);\n\t\t}\n\n\t\timperativeModal.open({\n\t\t\tcomponent: GenericModal,\n\t\t\tprops: {\n\t\t\t\ttitle,\n\t\t\t\ticon,\n\t\t\t\tconfirmText: t('Yes'),\n\t\t\t\tcancelText: t('No'),\n\t\t\t\tchildren: t('Do_you_want_to_accept'),\n\t\t\t\tonConfirm: () => {\n\t\t\t\t\tvoid goToRoomById(data.room!);\n\t\t\t\t\treturn this.joinCall({\n\t\t\t\t\t\tto: data.from,\n\t\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t\t\tmedia: data.media,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonCancel: () => this.stop(),\n\t\t\t\tonClose: () => this.stop(),\n\t\t\t},\n\t\t});\n\t}\n\n\tjoinCall(data: JoinData = {}, ...args: unknown[]) {\n\t\tdata.media = this.media;\n\t\tthis.log('joinCall', [data, ...args]);\n\t\tthis.getLocalUserMedia(() => {\n\t\t\tthis.remoteMonitoring = data.monitor!;\n\t\t\tthis.active = true;\n\t\t\tthis.transport.joinCall(data);\n\t\t});\n\t}\n\n\tonRemoteJoin(data: JoinData, ...args: unknown[]) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteJoin', [data, ...args]);\n\t\tlet peerConnection = this.getPeerConnection(data.from!);\n\n\t\t// needsRefresh = false\n\t\t// if peerConnection.iceConnectionState isnt 'new'\n\t\t// needsAudio = data.media.audio is true and peerConnection.remoteMedia.audio isnt true\n\t\t// needsVideo = data.media.video is true and peerConnection.remoteMedia.video isnt true\n\t\t// needsRefresh = needsAudio or needsVideo or data.media.desktop isnt peerConnection.remoteMedia.desktop\n\n\t\t// # if peerConnection.signalingState is \"have-local-offer\" or needsRefresh\n\n\t\tif ((peerConnection.signalingState as RTCSignalingState | 'checking') !== 'checking') {\n\t\t\tthis.stopPeerConnection(data.from!);\n\t\t\tpeerConnection = this.getPeerConnection(data.from!);\n\t\t}\n\t\tif (peerConnection.iceConnectionState !== 'new') {\n\t\t\treturn;\n\t\t}\n\t\tpeerConnection.remoteMedia = data.media!;\n\t\tif (this.localStream) {\n\t\t\tpeerConnection.addStream(this.localStream);\n\t\t}\n\t\tconst onOffer: RTCSessionDescriptionCallback = (offer) => {\n\t\t\tconst onLocalDescription = () => {\n\t\t\t\tthis.transport.sendDescription({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\ttype: 'offer',\n\t\t\t\t\tts: peerConnection.createdAt,\n\t\t\t\t\tmedia: this.media,\n\t\t\t\t\tdescription: {\n\t\t\t\t\t\tsdp: offer.sdp,\n\t\t\t\t\t\ttype: offer.type,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tvoid peerConnection.setLocalDescription(new RTCSessionDescription(offer), onLocalDescription, this.onError);\n\t\t};\n\n\t\tif (data.monitor === true) {\n\t\t\tvoid peerConnection.createOffer(onOffer, this.onError, {\n\t\t\t\tmandatory: {\n\t\t\t\t\tOfferToReceiveAudio: data.media?.audio,\n\t\t\t\t\tOfferToReceiveVideo: data.media?.video,\n\t\t\t\t},\n\t\t\t});\n\t\t} else {\n\t\t\tvoid peerConnection.createOffer(onOffer, this.onError);\n\t\t}\n\t}\n\n\tonRemoteOffer(data: Omit<DescriptionData, 'type'>, ...args: unknown[]) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('onRemoteOffer', [data, ...args]);\n\t\tlet peerConnection = this.getPeerConnection(data.from!);\n\n\t\tif (['have-local-offer', 'stable'].includes(peerConnection.signalingState) && peerConnection.createdAt < data.ts) {\n\t\t\tthis.stopPeerConnection(data.from!);\n\t\t\tpeerConnection = this.getPeerConnection(data.from!);\n\t\t}\n\n\t\tif (peerConnection.iceConnectionState !== 'new') {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid peerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\n\n\t\ttry {\n\t\t\tif (this.localStream) {\n\t\t\t\tpeerConnection.addStream(this.localStream);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t}\n\n\t\tconst onAnswer: RTCSessionDescriptionCallback = (answer) => {\n\t\t\tconst onLocalDescription = () => {\n\t\t\t\tthis.transport.sendDescription({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tts: peerConnection.createdAt,\n\t\t\t\t\tdescription: {\n\t\t\t\t\t\tsdp: answer.sdp,\n\t\t\t\t\t\ttype: answer.type,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tvoid peerConnection.setLocalDescription(new RTCSessionDescription(answer), onLocalDescription, this.onError);\n\t\t};\n\n\t\tvoid peerConnection.createAnswer(onAnswer, this.onError);\n\t}\n\n\tonRemoteCandidate(data: CandidateData, ...args: unknown[]) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tif (data.to !== this.selfId) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteCandidate', [data, ...args]);\n\t\tconst peerConnection = this.getPeerConnection(data.from!);\n\t\tif (\n\t\t\tpeerConnection.iceConnectionState !== 'closed' &&\n\t\t\tpeerConnection.iceConnectionState !== 'failed' &&\n\t\t\tpeerConnection.iceConnectionState !== 'disconnected' &&\n\t\t\tpeerConnection.iceConnectionState !== 'completed'\n\t\t) {\n\t\t\tvoid peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));\n\t\t}\n\t\tdocument.querySelector<HTMLVideoElement>('video#remoteVideo')!.srcObject = this.remoteItems.get()[0]?.url;\n\t}\n\n\tonRemoteDescription(data: DescriptionData, ...args: unknown[]) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tif (data.to !== this.selfId) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteDescription', [data, ...args]);\n\t\tconst peerConnection = this.getPeerConnection(data.from!);\n\t\tif (data.type === 'offer') {\n\t\t\tpeerConnection.remoteMedia = data.media;\n\t\t\tthis.onRemoteOffer({\n\t\t\t\tfrom: data.from,\n\t\t\t\tts: data.ts,\n\t\t\t\tdescription: data.description,\n\t\t\t});\n\t\t} else {\n\t\t\tvoid peerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\n\t\t}\n\t}\n}\n\nconst WebRTC = new (class {\n\tinstancesByRoomId: Record<string, WebRTCClass> = {};\n\n\tconstructor() {\n\t\tthis.instancesByRoomId = {};\n\t}\n\n\tgetInstanceByRoomId(rid: IRoom['_id'], visitorId: string | null = null) {\n\t\tlet enabled = false;\n\t\tif (!visitorId) {\n\t\t\tconst subscription = ChatSubscription.findOne({ rid });\n\t\t\tif (!subscription) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tswitch (subscription.t) {\n\t\t\t\tcase 'd':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Direct');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'p':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Private');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'c':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Channel');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'l':\n\t\t\t\t\tenabled = settings.get<string>('Omnichannel_call_provider') === 'WebRTC';\n\t\t\t}\n\t\t} else {\n\t\t\tenabled = settings.get<string>('Omnichannel_call_provider') === 'WebRTC';\n\t\t}\n\t\tenabled = enabled && settings.get('WebRTC_Enabled');\n\t\tif (enabled === false) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.instancesByRoomId[rid] == null) {\n\t\t\tlet uid = Meteor.userId()!;\n\t\t\tlet autoAccept = false;\n\t\t\tif (visitorId) {\n\t\t\t\tuid = visitorId;\n\t\t\t\tautoAccept = true;\n\t\t\t}\n\t\t\tthis.instancesByRoomId[rid] = new WebRTCClass(uid, rid, autoAccept);\n\t\t}\n\t\treturn this.instancesByRoomId[rid];\n\t}\n})();\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (uid) {\n\t\t\tsdk.stream('notify-user', [`${uid}/${WEB_RTC_EVENTS.WEB_RTC}`], (type, data) => {\n\t\t\t\tif (data.room == null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst webrtc = WebRTC.getInstanceByRoomId(data.room);\n\n\t\t\t\tswitch (type) {\n\t\t\t\t\tcase 'candidate':\n\t\t\t\t\t\twebrtc?.onUserStream('candidate', data);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'description':\n\t\t\t\t\t\twebrtc?.onUserStream('description', data);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'join':\n\t\t\t\t\t\twebrtc?.onUserStream('join', data);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n});\n\nexport { WebRTC };\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"6ff9d9b0cf8bb889ad93388af40d226efc387615"}
