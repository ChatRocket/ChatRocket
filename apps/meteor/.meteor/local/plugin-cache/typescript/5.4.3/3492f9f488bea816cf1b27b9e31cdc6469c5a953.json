{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/RoomReceiver.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"server/services/federation/infrastructure/matrix/converters/room/RoomReceiver.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/RoomReceiver.ts","inputSourceMap":{"version":3,"file":"server/services/federation/infrastructure/matrix/converters/room/RoomReceiver.ts","sourceRoot":"","sources":["server/services/federation/infrastructure/matrix/converters/room/RoomReceiver.ts"],"names":[],"mappings":"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","sourcesContent":["import { RoomType } from '@rocket.chat/apps-engine/definition/rooms';\n\nimport {\n\tFederationRoomChangeJoinRulesDto,\n\tFederationRoomChangeMembershipDto,\n\tFederationRoomChangeNameDto,\n\tFederationRoomChangeTopicDto,\n\tFederationRoomCreateInputDto,\n\tFederationRoomEditExternalMessageDto,\n\tFederationRoomReceiveExternalFileMessageDto,\n\tFederationRoomReceiveExternalMessageDto,\n\tFederationRoomRedactEventDto,\n\tFederationRoomRoomChangePowerLevelsEventDto,\n} from '../../../../application/room/input/RoomReceiverDto';\nimport type { IExternalRolesChangesToApplyInputDto } from '../../../../application/room/input/RoomReceiverDto';\nimport { EVENT_ORIGIN } from '../../../../domain/IFederationBridge';\nimport { ROCKET_CHAT_FEDERATION_ROLES } from '../../../rocket-chat/definitions/FederatedRoomInternalRoles';\nimport type { AbstractMatrixEvent } from '../../definitions/AbstractMatrixEvent';\nimport { MatrixEventType } from '../../definitions/MatrixEventType';\nimport { MATRIX_POWER_LEVELS } from '../../definitions/MatrixPowerLevels';\nimport { MatrixRoomJoinRules } from '../../definitions/MatrixRoomJoinRules';\nimport type { MatrixEventRoomCreated } from '../../definitions/events/RoomCreated';\nimport type { MatrixEventRoomRedacted } from '../../definitions/events/RoomEventRedacted';\nimport type { MatrixEventRoomJoinRulesChanged } from '../../definitions/events/RoomJoinRulesChanged';\nimport type { MatrixEventRoomMembershipChanged } from '../../definitions/events/RoomMembershipChanged';\nimport { RoomMembershipChangedEventType } from '../../definitions/events/RoomMembershipChanged';\nimport type { MatrixEventRoomMessageSent } from '../../definitions/events/RoomMessageSent';\nimport type { MatrixEventRoomNameChanged } from '../../definitions/events/RoomNameChanged';\nimport type {\n\tIMatrixEventContentRoomPowerLevelsChanged,\n\tMatrixEventRoomRoomPowerLevelsChanged,\n} from '../../definitions/events/RoomPowerLevelsChanged';\nimport type { MatrixEventRoomTopicChanged } from '../../definitions/events/RoomTopicChanged';\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const removeExternalSpecificCharsFromExternalIdentifier = (matrixIdentifier = ''): string => {\n\treturn matrixIdentifier.replace('@', '').replace('!', '').replace('#', '');\n};\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const formatExternalUserIdToInternalUsernameFormat = (matrixUserId = ''): string => {\n\treturn matrixUserId.split(':')[0]?.replace('@', '');\n};\n\nexport const isAnExternalIdentifierFormat = (identifier: string): boolean => identifier.includes(':');\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const isAnExternalUserIdFormat = (userId: string): boolean => isAnExternalIdentifierFormat(userId) && userId.includes('@');\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const extractServerNameFromExternalIdentifier = (identifier = ''): string => {\n\tconst splitted = identifier.split(':');\n\n\treturn splitted.length > 1 ? splitted[1] : '';\n};\n\nexport const convertExternalRoomIdToInternalRoomIdFormat = (matrixRoomId = ''): string => {\n\tconst prefixedRoomIdOnly = matrixRoomId.split(':')[0];\n\tconst prefix = '!';\n\n\treturn prefixedRoomIdOnly?.replace(prefix, '');\n};\n\nconst getEventOrigin = (inviterId = '', homeServerDomain: string): EVENT_ORIGIN => {\n\tconst fromADifferentServer = extractServerNameFromExternalIdentifier(inviterId) !== homeServerDomain;\n\n\treturn fromADifferentServer ? EVENT_ORIGIN.REMOTE : EVENT_ORIGIN.LOCAL;\n};\n\nconst convertExternalJoinRuleToInternalRoomType = (matrixJoinRule: MatrixRoomJoinRules, matrixRoomIsDirect = false): RoomType => {\n\tif (matrixRoomIsDirect) {\n\t\treturn RoomType.DIRECT_MESSAGE;\n\t}\n\tconst mapping: Record<string, RoomType> = {\n\t\t[MatrixRoomJoinRules.JOIN]: RoomType.CHANNEL,\n\t\t[MatrixRoomJoinRules.INVITE]: RoomType.PRIVATE_GROUP,\n\t};\n\n\treturn mapping[matrixJoinRule] || RoomType.CHANNEL;\n};\n\nconst tryToExtractExternalRoomNameFromTheRoomState = (roomState: AbstractMatrixEvent[] = []): { externalRoomName?: string } => {\n\tif (roomState.length === 0) {\n\t\treturn {};\n\t}\n\tconst externalRoomName = (\n\t\troomState.find((stateEvent) => stateEvent.type === MatrixEventType.ROOM_NAME_CHANGED) as MatrixEventRoomNameChanged\n\t)?.content?.name;\n\n\treturn {\n\t\t...(externalRoomName ? { externalRoomName: removeExternalSpecificCharsFromExternalIdentifier(externalRoomName) } : {}),\n\t};\n};\n\nconst tryToExtractAndConvertRoomTypeFromTheRoomState = (\n\troomState: AbstractMatrixEvent[] = [],\n\tmatrixRoomIsDirect = false,\n): { roomType?: RoomType } => {\n\tif (roomState.length === 0) {\n\t\treturn {};\n\t}\n\tconst externalRoomJoinRule = (\n\t\troomState.find((stateEvent) => stateEvent.type === MatrixEventType.ROOM_JOIN_RULES_CHANGED) as MatrixEventRoomJoinRulesChanged\n\t)?.content?.join_rule;\n\n\treturn {\n\t\t...(externalRoomJoinRule ? { roomType: convertExternalJoinRuleToInternalRoomType(externalRoomJoinRule, matrixRoomIsDirect) } : {}),\n\t};\n};\n\nconst convertNumericalPowerLevelToInternalRole = (powerLevel: number): ROCKET_CHAT_FEDERATION_ROLES | undefined => {\n\tconst mapping: Record<number, ROCKET_CHAT_FEDERATION_ROLES | undefined> = {\n\t\t[MATRIX_POWER_LEVELS.USER]: undefined,\n\t\t[MATRIX_POWER_LEVELS.MODERATOR]: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR,\n\t\t[MATRIX_POWER_LEVELS.ADMIN]: ROCKET_CHAT_FEDERATION_ROLES.OWNER,\n\t};\n\n\tif (mapping[powerLevel]) {\n\t\treturn mapping[powerLevel];\n\t}\n\n\tif (powerLevel <= MATRIX_POWER_LEVELS.USER) {\n\t\treturn;\n\t}\n\tif (powerLevel > MATRIX_POWER_LEVELS.USER && powerLevel <= MATRIX_POWER_LEVELS.MODERATOR) {\n\t\treturn ROCKET_CHAT_FEDERATION_ROLES.MODERATOR;\n\t}\n\treturn ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n};\n\nconst onlyRolesAddedToDefaultUsers = (previousRolesState: { [key: string]: number }, externalUserId: string): boolean =>\n\t!previousRolesState[externalUserId];\n\nconst verifyIfNewRolesWereAddedForDefaultUsers = (\n\tcurrentRolesState: { [key: string]: number },\n\tpreviousRolesState: { [key: string]: number },\n\tchangesAlreadyMadeToRoles: IExternalRolesChangesToApplyInputDto,\n): IExternalRolesChangesToApplyInputDto =>\n\tObject.keys(currentRolesState)\n\t\t.filter((externalUserId) => onlyRolesAddedToDefaultUsers(previousRolesState, externalUserId))\n\t\t.reduce((externalRolesChangesForDefaultUsers, externalUserId) => {\n\t\t\tconst isCurrentRoleAnOwner =\n\t\t\t\tconvertNumericalPowerLevelToInternalRole(currentRolesState[externalUserId]) === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n\t\t\texternalRolesChangesForDefaultUsers[externalUserId] = isCurrentRoleAnOwner\n\t\t\t\t? [{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER }]\n\t\t\t\t: [{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR }];\n\t\t\treturn externalRolesChangesForDefaultUsers;\n\t\t}, changesAlreadyMadeToRoles);\n\nconst createExternalRolesChangesActions = (\n\tcurrentRolesState: { [key: string]: number } = {},\n\tpreviousRolesState: { [key: string]: number } = {},\n): IExternalRolesChangesToApplyInputDto => {\n\tconst changesInRolesBasedOnPreviousState = Object.keys(previousRolesState).reduce((externalRolesChangesByUser, externalUserId) => {\n\t\tconst currentPowerLevel = currentRolesState[externalUserId];\n\t\tconst previousPowerLevel = previousRolesState[externalUserId];\n\t\tconst convertedPreviousExternalRole = convertNumericalPowerLevelToInternalRole(previousPowerLevel);\n\t\tconst convertedCurrentExternalRole = convertNumericalPowerLevelToInternalRole(currentPowerLevel);\n\t\tconst wasPreviousRoleAnOwner = convertedPreviousExternalRole === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n\t\tconst isCurrentRoleAnOwner = convertedCurrentExternalRole === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n\t\tconst isCurrentRoleADefault = currentPowerLevel === undefined;\n\t\tconst isStillTheSameRole = currentPowerLevel === previousPowerLevel;\n\t\tconst isDowngradingTheRole = currentPowerLevel < previousPowerLevel;\n\t\tif (isCurrentRoleADefault) {\n\t\t\texternalRolesChangesByUser[externalUserId] = wasPreviousRoleAnOwner\n\t\t\t\t? [{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER }]\n\t\t\t\t: [{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR }];\n\t\t\treturn externalRolesChangesByUser;\n\t\t}\n\t\tif (isStillTheSameRole) {\n\t\t\treturn externalRolesChangesByUser;\n\t\t}\n\t\tif (isDowngradingTheRole) {\n\t\t\texternalRolesChangesByUser[externalUserId] = [\n\t\t\t\t...(convertedPreviousExternalRole ? [{ action: 'remove', role: convertedPreviousExternalRole }] : []),\n\t\t\t\t...(convertedCurrentExternalRole ? [{ action: 'add', role: convertedCurrentExternalRole }] : []),\n\t\t\t];\n\t\t\treturn externalRolesChangesByUser;\n\t\t}\n\t\texternalRolesChangesByUser[externalUserId] = isCurrentRoleAnOwner\n\t\t\t? [\n\t\t\t\t\t{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER },\n\t\t\t\t\t{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR },\n\t\t\t  ]\n\t\t\t: [\n\t\t\t\t\t{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR },\n\t\t\t\t\t{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER },\n\t\t\t  ];\n\n\t\treturn externalRolesChangesByUser;\n\t}, {} as IExternalRolesChangesToApplyInputDto);\n\n\treturn verifyIfNewRolesWereAddedForDefaultUsers(currentRolesState, previousRolesState, changesInRolesBasedOnPreviousState);\n};\n\nconst getInviteesFromRoomState = (\n\troomState: AbstractMatrixEvent[] = [],\n): {\n\texternalInviteeId: string;\n\tnormalizedInviteeId: string;\n\tinviteeUsernameOnly: string;\n}[] => {\n\tconst inviteesFromRoomState = (\n\t\troomState?.find((stateEvent) => stateEvent.type === MatrixEventType.ROOM_CREATED) as MatrixEventRoomCreated\n\t)?.content.inviteesExternalIds;\n\tif (inviteesFromRoomState) {\n\t\treturn inviteesFromRoomState.map((inviteeExternalId) => ({\n\t\t\texternalInviteeId: inviteeExternalId,\n\t\t\tnormalizedInviteeId: removeExternalSpecificCharsFromExternalIdentifier(inviteeExternalId),\n\t\t\tinviteeUsernameOnly: formatExternalUserIdToInternalUsernameFormat(inviteeExternalId),\n\t\t}));\n\t}\n\treturn [];\n};\n\nconst extractAllInviteeIdsWhenDM = (\n\texternalEvent: MatrixEventRoomMembershipChanged,\n): {\n\texternalInviteeId: string;\n\tnormalizedInviteeId: string;\n\tinviteeUsernameOnly: string;\n}[] => {\n\tif (!externalEvent.invite_room_state && !externalEvent.unsigned?.invite_room_state) {\n\t\treturn [];\n\t}\n\n\treturn getInviteesFromRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state || []);\n};\n\nexport class MatrixRoomReceiverConverter {\n\tpublic static toRoomCreateDto(externalEvent: MatrixEventRoomCreated): FederationRoomCreateInputDto {\n\t\treturn new FederationRoomCreateInputDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\t...tryToExtractExternalRoomNameFromTheRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state),\n\t\t\t...tryToExtractAndConvertRoomTypeFromTheRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state),\n\t\t\texternalInviterId: externalEvent.sender,\n\t\t\tnormalizedInviterId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\twasInternallyProgramaticallyCreated: externalEvent.content?.was_internally_programatically_created || false,\n\t\t\tinternalRoomId: externalEvent.content?.internalRoomId,\n\t\t});\n\t}\n\n\tpublic static toChangeRoomMembershipDto(\n\t\texternalEvent: MatrixEventRoomMembershipChanged,\n\t\thomeServerDomain: string,\n\t): FederationRoomChangeMembershipDto {\n\t\treturn new FederationRoomChangeMembershipDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\t...tryToExtractExternalRoomNameFromTheRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state),\n\t\t\t...tryToExtractAndConvertRoomTypeFromTheRoomState(\n\t\t\t\texternalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state,\n\t\t\t\texternalEvent.content?.is_direct,\n\t\t\t),\n\t\t\texternalInviterId: externalEvent.sender,\n\t\t\tnormalizedInviterId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\texternalInviteeId: externalEvent.state_key,\n\t\t\tnormalizedInviteeId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.state_key),\n\t\t\tinviteeUsernameOnly: formatExternalUserIdToInternalUsernameFormat(externalEvent.state_key),\n\t\t\tinviterUsernameOnly: formatExternalUserIdToInternalUsernameFormat(externalEvent.sender),\n\t\t\teventOrigin: getEventOrigin(externalEvent.sender, homeServerDomain),\n\t\t\tleave: externalEvent.content?.membership === RoomMembershipChangedEventType.LEAVE,\n\t\t\tuserProfile: {\n\t\t\t\tavatarUrl: externalEvent.content?.avatar_url,\n\t\t\t\tdisplayName: externalEvent.content?.displayname,\n\t\t\t},\n\t\t\t...(externalEvent.content?.is_direct ? { allInviteesExternalIdsWhenDM: extractAllInviteeIdsWhenDM(externalEvent) } : {}),\n\t\t});\n\t}\n\n\tpublic static toSendRoomMessageDto(externalEvent: MatrixEventRoomMessageSent): FederationRoomReceiveExternalMessageDto {\n\t\tconst isThreadedMessage = Boolean(externalEvent.content?.['m.relates_to']?.rel_type === MatrixEventType.MESSAGE_ON_THREAD);\n\n\t\treturn new FederationRoomReceiveExternalMessageDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\texternalFormattedText: externalEvent.content.formatted_body || '',\n\t\t\trawMessage: externalEvent.content.body,\n\t\t\t...(isThreadedMessage\n\t\t\t\t? {\n\t\t\t\t\t\tthread: {\n\t\t\t\t\t\t\trootEventId: externalEvent.content?.['m.relates_to']?.event_id || '',\n\t\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id || '',\n\t\t\t\t\t\t},\n\t\t\t\t\t\treplyToEventId: !externalEvent.content?.['m.relates_to']?.is_falling_back\n\t\t\t\t\t\t\t? externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t  }\n\t\t\t\t: {\n\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id,\n\t\t\t\t  }),\n\t\t});\n\t}\n\n\tpublic static toEditRoomMessageDto(externalEvent: MatrixEventRoomMessageSent): FederationRoomEditExternalMessageDto {\n\t\treturn new FederationRoomEditExternalMessageDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\tnewExternalFormattedText: externalEvent.content['m.new_content']?.formatted_body || '',\n\t\t\tnewRawMessage: externalEvent.content['m.new_content']?.body as string,\n\t\t\teditsEvent: externalEvent.content['m.relates_to']?.event_id as string,\n\t\t});\n\t}\n\n\tpublic static toSendRoomFileMessageDto(externalEvent: MatrixEventRoomMessageSent): FederationRoomReceiveExternalFileMessageDto {\n\t\tif (!externalEvent.content.url) {\n\t\t\tthrow new Error('Missing url in the file message');\n\t\t}\n\t\tif (!externalEvent.content.info?.mimetype) {\n\t\t\tthrow new Error('Missing mimetype in the file message info');\n\t\t}\n\t\tif (!externalEvent.content.info?.size) {\n\t\t\tthrow new Error('Missing size in the file message info');\n\t\t}\n\t\tconst isThreadedMessage = Boolean(externalEvent.content?.['m.relates_to']?.rel_type === MatrixEventType.MESSAGE_ON_THREAD);\n\n\t\treturn new FederationRoomReceiveExternalFileMessageDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\tfilename: externalEvent.content.body,\n\t\t\turl: externalEvent.content.url,\n\t\t\tmimetype: externalEvent.content.info.mimetype,\n\t\t\tsize: externalEvent.content.info.size,\n\t\t\tmessageText: externalEvent.content.body,\n\t\t\t...(isThreadedMessage\n\t\t\t\t? {\n\t\t\t\t\t\tthread: {\n\t\t\t\t\t\t\trootEventId: externalEvent.content?.['m.relates_to']?.event_id || '',\n\t\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id || '',\n\t\t\t\t\t\t},\n\t\t\t\t\t\treplyToEventId: !externalEvent.content?.['m.relates_to']?.is_falling_back\n\t\t\t\t\t\t\t? externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t  }\n\t\t\t\t: {\n\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id,\n\t\t\t\t  }),\n\t\t});\n\t}\n\n\tpublic static toRoomChangeJoinRulesDto(externalEvent: MatrixEventRoomJoinRulesChanged): FederationRoomChangeJoinRulesDto {\n\t\treturn new FederationRoomChangeJoinRulesDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\troomType: convertExternalJoinRuleToInternalRoomType(externalEvent.content?.join_rule),\n\t\t});\n\t}\n\n\tpublic static toRoomChangeNameDto(externalEvent: MatrixEventRoomNameChanged): FederationRoomChangeNameDto {\n\t\treturn new FederationRoomChangeNameDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedRoomName: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.content?.name),\n\t\t});\n\t}\n\n\tpublic static toRoomChangeTopicDto(externalEvent: MatrixEventRoomTopicChanged): FederationRoomChangeTopicDto {\n\t\treturn new FederationRoomChangeTopicDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\troomTopic: externalEvent.content?.topic,\n\t\t});\n\t}\n\n\tpublic static toRoomRedactEventDto(externalEvent: MatrixEventRoomRedacted): FederationRoomRedactEventDto {\n\t\treturn new FederationRoomRedactEventDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tredactsEvent: externalEvent.redacts as string,\n\t\t});\n\t}\n\n\tpublic static toRoomChangePowerLevelsEventDto(\n\t\texternalEvent: MatrixEventRoomRoomPowerLevelsChanged,\n\t): FederationRoomRoomChangePowerLevelsEventDto {\n\t\treturn new FederationRoomRoomChangePowerLevelsEventDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\troleChangesToApply: createExternalRolesChangesActions(\n\t\t\t\texternalEvent.content?.users,\n\t\t\t\t(externalEvent.prev_content as IMatrixEventContentRoomPowerLevelsChanged)?.users || {},\n\t\t\t),\n\t\t});\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/converters/room/RoomReceiver.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"server/services/federation/infrastructure/matrix/converters/room/RoomReceiver.ts","inputSourceMap":{"version":3,"file":"server/services/federation/infrastructure/matrix/converters/room/RoomReceiver.ts","sourceRoot":"","sources":["server/services/federation/infrastructure/matrix/converters/room/RoomReceiver.ts"],"names":[],"mappings":"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","sourcesContent":["import { RoomType } from '@rocket.chat/apps-engine/definition/rooms';\n\nimport {\n\tFederationRoomChangeJoinRulesDto,\n\tFederationRoomChangeMembershipDto,\n\tFederationRoomChangeNameDto,\n\tFederationRoomChangeTopicDto,\n\tFederationRoomCreateInputDto,\n\tFederationRoomEditExternalMessageDto,\n\tFederationRoomReceiveExternalFileMessageDto,\n\tFederationRoomReceiveExternalMessageDto,\n\tFederationRoomRedactEventDto,\n\tFederationRoomRoomChangePowerLevelsEventDto,\n} from '../../../../application/room/input/RoomReceiverDto';\nimport type { IExternalRolesChangesToApplyInputDto } from '../../../../application/room/input/RoomReceiverDto';\nimport { EVENT_ORIGIN } from '../../../../domain/IFederationBridge';\nimport { ROCKET_CHAT_FEDERATION_ROLES } from '../../../rocket-chat/definitions/FederatedRoomInternalRoles';\nimport type { AbstractMatrixEvent } from '../../definitions/AbstractMatrixEvent';\nimport { MatrixEventType } from '../../definitions/MatrixEventType';\nimport { MATRIX_POWER_LEVELS } from '../../definitions/MatrixPowerLevels';\nimport { MatrixRoomJoinRules } from '../../definitions/MatrixRoomJoinRules';\nimport type { MatrixEventRoomCreated } from '../../definitions/events/RoomCreated';\nimport type { MatrixEventRoomRedacted } from '../../definitions/events/RoomEventRedacted';\nimport type { MatrixEventRoomJoinRulesChanged } from '../../definitions/events/RoomJoinRulesChanged';\nimport type { MatrixEventRoomMembershipChanged } from '../../definitions/events/RoomMembershipChanged';\nimport { RoomMembershipChangedEventType } from '../../definitions/events/RoomMembershipChanged';\nimport type { MatrixEventRoomMessageSent } from '../../definitions/events/RoomMessageSent';\nimport type { MatrixEventRoomNameChanged } from '../../definitions/events/RoomNameChanged';\nimport type {\n\tIMatrixEventContentRoomPowerLevelsChanged,\n\tMatrixEventRoomRoomPowerLevelsChanged,\n} from '../../definitions/events/RoomPowerLevelsChanged';\nimport type { MatrixEventRoomTopicChanged } from '../../definitions/events/RoomTopicChanged';\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const removeExternalSpecificCharsFromExternalIdentifier = (matrixIdentifier = ''): string => {\n\treturn matrixIdentifier.replace('@', '').replace('!', '').replace('#', '');\n};\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const formatExternalUserIdToInternalUsernameFormat = (matrixUserId = ''): string => {\n\treturn matrixUserId.split(':')[0]?.replace('@', '');\n};\n\nexport const isAnExternalIdentifierFormat = (identifier: string): boolean => identifier.includes(':');\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const isAnExternalUserIdFormat = (userId: string): boolean => isAnExternalIdentifierFormat(userId) && userId.includes('@');\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const extractServerNameFromExternalIdentifier = (identifier = ''): string => {\n\tconst splitted = identifier.split(':');\n\n\treturn splitted.length > 1 ? splitted[1] : '';\n};\n\nexport const convertExternalRoomIdToInternalRoomIdFormat = (matrixRoomId = ''): string => {\n\tconst prefixedRoomIdOnly = matrixRoomId.split(':')[0];\n\tconst prefix = '!';\n\n\treturn prefixedRoomIdOnly?.replace(prefix, '');\n};\n\nconst getEventOrigin = (inviterId = '', homeServerDomain: string): EVENT_ORIGIN => {\n\tconst fromADifferentServer = extractServerNameFromExternalIdentifier(inviterId) !== homeServerDomain;\n\n\treturn fromADifferentServer ? EVENT_ORIGIN.REMOTE : EVENT_ORIGIN.LOCAL;\n};\n\nconst convertExternalJoinRuleToInternalRoomType = (matrixJoinRule: MatrixRoomJoinRules, matrixRoomIsDirect = false): RoomType => {\n\tif (matrixRoomIsDirect) {\n\t\treturn RoomType.DIRECT_MESSAGE;\n\t}\n\tconst mapping: Record<string, RoomType> = {\n\t\t[MatrixRoomJoinRules.JOIN]: RoomType.CHANNEL,\n\t\t[MatrixRoomJoinRules.INVITE]: RoomType.PRIVATE_GROUP,\n\t};\n\n\treturn mapping[matrixJoinRule] || RoomType.CHANNEL;\n};\n\nconst tryToExtractExternalRoomNameFromTheRoomState = (roomState: AbstractMatrixEvent[] = []): { externalRoomName?: string } => {\n\tif (roomState.length === 0) {\n\t\treturn {};\n\t}\n\tconst externalRoomName = (\n\t\troomState.find((stateEvent) => stateEvent.type === MatrixEventType.ROOM_NAME_CHANGED) as MatrixEventRoomNameChanged\n\t)?.content?.name;\n\n\treturn {\n\t\t...(externalRoomName ? { externalRoomName: removeExternalSpecificCharsFromExternalIdentifier(externalRoomName) } : {}),\n\t};\n};\n\nconst tryToExtractAndConvertRoomTypeFromTheRoomState = (\n\troomState: AbstractMatrixEvent[] = [],\n\tmatrixRoomIsDirect = false,\n): { roomType?: RoomType } => {\n\tif (roomState.length === 0) {\n\t\treturn {};\n\t}\n\tconst externalRoomJoinRule = (\n\t\troomState.find((stateEvent) => stateEvent.type === MatrixEventType.ROOM_JOIN_RULES_CHANGED) as MatrixEventRoomJoinRulesChanged\n\t)?.content?.join_rule;\n\n\treturn {\n\t\t...(externalRoomJoinRule ? { roomType: convertExternalJoinRuleToInternalRoomType(externalRoomJoinRule, matrixRoomIsDirect) } : {}),\n\t};\n};\n\nconst convertNumericalPowerLevelToInternalRole = (powerLevel: number): ROCKET_CHAT_FEDERATION_ROLES | undefined => {\n\tconst mapping: Record<number, ROCKET_CHAT_FEDERATION_ROLES | undefined> = {\n\t\t[MATRIX_POWER_LEVELS.USER]: undefined,\n\t\t[MATRIX_POWER_LEVELS.MODERATOR]: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR,\n\t\t[MATRIX_POWER_LEVELS.ADMIN]: ROCKET_CHAT_FEDERATION_ROLES.OWNER,\n\t};\n\n\tif (mapping[powerLevel]) {\n\t\treturn mapping[powerLevel];\n\t}\n\n\tif (powerLevel <= MATRIX_POWER_LEVELS.USER) {\n\t\treturn;\n\t}\n\tif (powerLevel > MATRIX_POWER_LEVELS.USER && powerLevel <= MATRIX_POWER_LEVELS.MODERATOR) {\n\t\treturn ROCKET_CHAT_FEDERATION_ROLES.MODERATOR;\n\t}\n\treturn ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n};\n\nconst onlyRolesAddedToDefaultUsers = (previousRolesState: { [key: string]: number }, externalUserId: string): boolean =>\n\t!previousRolesState[externalUserId];\n\nconst verifyIfNewRolesWereAddedForDefaultUsers = (\n\tcurrentRolesState: { [key: string]: number },\n\tpreviousRolesState: { [key: string]: number },\n\tchangesAlreadyMadeToRoles: IExternalRolesChangesToApplyInputDto,\n): IExternalRolesChangesToApplyInputDto =>\n\tObject.keys(currentRolesState)\n\t\t.filter((externalUserId) => onlyRolesAddedToDefaultUsers(previousRolesState, externalUserId))\n\t\t.reduce((externalRolesChangesForDefaultUsers, externalUserId) => {\n\t\t\tconst isCurrentRoleAnOwner =\n\t\t\t\tconvertNumericalPowerLevelToInternalRole(currentRolesState[externalUserId]) === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n\t\t\texternalRolesChangesForDefaultUsers[externalUserId] = isCurrentRoleAnOwner\n\t\t\t\t? [{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER }]\n\t\t\t\t: [{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR }];\n\t\t\treturn externalRolesChangesForDefaultUsers;\n\t\t}, changesAlreadyMadeToRoles);\n\nconst createExternalRolesChangesActions = (\n\tcurrentRolesState: { [key: string]: number } = {},\n\tpreviousRolesState: { [key: string]: number } = {},\n): IExternalRolesChangesToApplyInputDto => {\n\tconst changesInRolesBasedOnPreviousState = Object.keys(previousRolesState).reduce((externalRolesChangesByUser, externalUserId) => {\n\t\tconst currentPowerLevel = currentRolesState[externalUserId];\n\t\tconst previousPowerLevel = previousRolesState[externalUserId];\n\t\tconst convertedPreviousExternalRole = convertNumericalPowerLevelToInternalRole(previousPowerLevel);\n\t\tconst convertedCurrentExternalRole = convertNumericalPowerLevelToInternalRole(currentPowerLevel);\n\t\tconst wasPreviousRoleAnOwner = convertedPreviousExternalRole === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n\t\tconst isCurrentRoleAnOwner = convertedCurrentExternalRole === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n\t\tconst isCurrentRoleADefault = currentPowerLevel === undefined;\n\t\tconst isStillTheSameRole = currentPowerLevel === previousPowerLevel;\n\t\tconst isDowngradingTheRole = currentPowerLevel < previousPowerLevel;\n\t\tif (isCurrentRoleADefault) {\n\t\t\texternalRolesChangesByUser[externalUserId] = wasPreviousRoleAnOwner\n\t\t\t\t? [{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER }]\n\t\t\t\t: [{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR }];\n\t\t\treturn externalRolesChangesByUser;\n\t\t}\n\t\tif (isStillTheSameRole) {\n\t\t\treturn externalRolesChangesByUser;\n\t\t}\n\t\tif (isDowngradingTheRole) {\n\t\t\texternalRolesChangesByUser[externalUserId] = [\n\t\t\t\t...(convertedPreviousExternalRole ? [{ action: 'remove', role: convertedPreviousExternalRole }] : []),\n\t\t\t\t...(convertedCurrentExternalRole ? [{ action: 'add', role: convertedCurrentExternalRole }] : []),\n\t\t\t];\n\t\t\treturn externalRolesChangesByUser;\n\t\t}\n\t\texternalRolesChangesByUser[externalUserId] = isCurrentRoleAnOwner\n\t\t\t? [\n\t\t\t\t\t{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER },\n\t\t\t\t\t{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR },\n\t\t\t  ]\n\t\t\t: [\n\t\t\t\t\t{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR },\n\t\t\t\t\t{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER },\n\t\t\t  ];\n\n\t\treturn externalRolesChangesByUser;\n\t}, {} as IExternalRolesChangesToApplyInputDto);\n\n\treturn verifyIfNewRolesWereAddedForDefaultUsers(currentRolesState, previousRolesState, changesInRolesBasedOnPreviousState);\n};\n\nconst getInviteesFromRoomState = (\n\troomState: AbstractMatrixEvent[] = [],\n): {\n\texternalInviteeId: string;\n\tnormalizedInviteeId: string;\n\tinviteeUsernameOnly: string;\n}[] => {\n\tconst inviteesFromRoomState = (\n\t\troomState?.find((stateEvent) => stateEvent.type === MatrixEventType.ROOM_CREATED) as MatrixEventRoomCreated\n\t)?.content.inviteesExternalIds;\n\tif (inviteesFromRoomState) {\n\t\treturn inviteesFromRoomState.map((inviteeExternalId) => ({\n\t\t\texternalInviteeId: inviteeExternalId,\n\t\t\tnormalizedInviteeId: removeExternalSpecificCharsFromExternalIdentifier(inviteeExternalId),\n\t\t\tinviteeUsernameOnly: formatExternalUserIdToInternalUsernameFormat(inviteeExternalId),\n\t\t}));\n\t}\n\treturn [];\n};\n\nconst extractAllInviteeIdsWhenDM = (\n\texternalEvent: MatrixEventRoomMembershipChanged,\n): {\n\texternalInviteeId: string;\n\tnormalizedInviteeId: string;\n\tinviteeUsernameOnly: string;\n}[] => {\n\tif (!externalEvent.invite_room_state && !externalEvent.unsigned?.invite_room_state) {\n\t\treturn [];\n\t}\n\n\treturn getInviteesFromRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state || []);\n};\n\nexport class MatrixRoomReceiverConverter {\n\tpublic static toRoomCreateDto(externalEvent: MatrixEventRoomCreated): FederationRoomCreateInputDto {\n\t\treturn new FederationRoomCreateInputDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\t...tryToExtractExternalRoomNameFromTheRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state),\n\t\t\t...tryToExtractAndConvertRoomTypeFromTheRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state),\n\t\t\texternalInviterId: externalEvent.sender,\n\t\t\tnormalizedInviterId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\twasInternallyProgramaticallyCreated: externalEvent.content?.was_internally_programatically_created || false,\n\t\t\tinternalRoomId: externalEvent.content?.internalRoomId,\n\t\t});\n\t}\n\n\tpublic static toChangeRoomMembershipDto(\n\t\texternalEvent: MatrixEventRoomMembershipChanged,\n\t\thomeServerDomain: string,\n\t): FederationRoomChangeMembershipDto {\n\t\treturn new FederationRoomChangeMembershipDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\t...tryToExtractExternalRoomNameFromTheRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state),\n\t\t\t...tryToExtractAndConvertRoomTypeFromTheRoomState(\n\t\t\t\texternalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state,\n\t\t\t\texternalEvent.content?.is_direct,\n\t\t\t),\n\t\t\texternalInviterId: externalEvent.sender,\n\t\t\tnormalizedInviterId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\texternalInviteeId: externalEvent.state_key,\n\t\t\tnormalizedInviteeId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.state_key),\n\t\t\tinviteeUsernameOnly: formatExternalUserIdToInternalUsernameFormat(externalEvent.state_key),\n\t\t\tinviterUsernameOnly: formatExternalUserIdToInternalUsernameFormat(externalEvent.sender),\n\t\t\teventOrigin: getEventOrigin(externalEvent.sender, homeServerDomain),\n\t\t\tleave: externalEvent.content?.membership === RoomMembershipChangedEventType.LEAVE,\n\t\t\tuserProfile: {\n\t\t\t\tavatarUrl: externalEvent.content?.avatar_url,\n\t\t\t\tdisplayName: externalEvent.content?.displayname,\n\t\t\t},\n\t\t\t...(externalEvent.content?.is_direct ? { allInviteesExternalIdsWhenDM: extractAllInviteeIdsWhenDM(externalEvent) } : {}),\n\t\t});\n\t}\n\n\tpublic static toSendRoomMessageDto(externalEvent: MatrixEventRoomMessageSent): FederationRoomReceiveExternalMessageDto {\n\t\tconst isThreadedMessage = Boolean(externalEvent.content?.['m.relates_to']?.rel_type === MatrixEventType.MESSAGE_ON_THREAD);\n\n\t\treturn new FederationRoomReceiveExternalMessageDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\texternalFormattedText: externalEvent.content.formatted_body || '',\n\t\t\trawMessage: externalEvent.content.body,\n\t\t\t...(isThreadedMessage\n\t\t\t\t? {\n\t\t\t\t\t\tthread: {\n\t\t\t\t\t\t\trootEventId: externalEvent.content?.['m.relates_to']?.event_id || '',\n\t\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id || '',\n\t\t\t\t\t\t},\n\t\t\t\t\t\treplyToEventId: !externalEvent.content?.['m.relates_to']?.is_falling_back\n\t\t\t\t\t\t\t? externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t  }\n\t\t\t\t: {\n\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id,\n\t\t\t\t  }),\n\t\t});\n\t}\n\n\tpublic static toEditRoomMessageDto(externalEvent: MatrixEventRoomMessageSent): FederationRoomEditExternalMessageDto {\n\t\treturn new FederationRoomEditExternalMessageDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\tnewExternalFormattedText: externalEvent.content['m.new_content']?.formatted_body || '',\n\t\t\tnewRawMessage: externalEvent.content['m.new_content']?.body as string,\n\t\t\teditsEvent: externalEvent.content['m.relates_to']?.event_id as string,\n\t\t});\n\t}\n\n\tpublic static toSendRoomFileMessageDto(externalEvent: MatrixEventRoomMessageSent): FederationRoomReceiveExternalFileMessageDto {\n\t\tif (!externalEvent.content.url) {\n\t\t\tthrow new Error('Missing url in the file message');\n\t\t}\n\t\tif (!externalEvent.content.info?.mimetype) {\n\t\t\tthrow new Error('Missing mimetype in the file message info');\n\t\t}\n\t\tif (!externalEvent.content.info?.size) {\n\t\t\tthrow new Error('Missing size in the file message info');\n\t\t}\n\t\tconst isThreadedMessage = Boolean(externalEvent.content?.['m.relates_to']?.rel_type === MatrixEventType.MESSAGE_ON_THREAD);\n\n\t\treturn new FederationRoomReceiveExternalFileMessageDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\tfilename: externalEvent.content.body,\n\t\t\turl: externalEvent.content.url,\n\t\t\tmimetype: externalEvent.content.info.mimetype,\n\t\t\tsize: externalEvent.content.info.size,\n\t\t\tmessageText: externalEvent.content.body,\n\t\t\t...(isThreadedMessage\n\t\t\t\t? {\n\t\t\t\t\t\tthread: {\n\t\t\t\t\t\t\trootEventId: externalEvent.content?.['m.relates_to']?.event_id || '',\n\t\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id || '',\n\t\t\t\t\t\t},\n\t\t\t\t\t\treplyToEventId: !externalEvent.content?.['m.relates_to']?.is_falling_back\n\t\t\t\t\t\t\t? externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t  }\n\t\t\t\t: {\n\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id,\n\t\t\t\t  }),\n\t\t});\n\t}\n\n\tpublic static toRoomChangeJoinRulesDto(externalEvent: MatrixEventRoomJoinRulesChanged): FederationRoomChangeJoinRulesDto {\n\t\treturn new FederationRoomChangeJoinRulesDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\troomType: convertExternalJoinRuleToInternalRoomType(externalEvent.content?.join_rule),\n\t\t});\n\t}\n\n\tpublic static toRoomChangeNameDto(externalEvent: MatrixEventRoomNameChanged): FederationRoomChangeNameDto {\n\t\treturn new FederationRoomChangeNameDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedRoomName: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.content?.name),\n\t\t});\n\t}\n\n\tpublic static toRoomChangeTopicDto(externalEvent: MatrixEventRoomTopicChanged): FederationRoomChangeTopicDto {\n\t\treturn new FederationRoomChangeTopicDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\troomTopic: externalEvent.content?.topic,\n\t\t});\n\t}\n\n\tpublic static toRoomRedactEventDto(externalEvent: MatrixEventRoomRedacted): FederationRoomRedactEventDto {\n\t\treturn new FederationRoomRedactEventDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tredactsEvent: externalEvent.redacts as string,\n\t\t});\n\t}\n\n\tpublic static toRoomChangePowerLevelsEventDto(\n\t\texternalEvent: MatrixEventRoomRoomPowerLevelsChanged,\n\t): FederationRoomRoomChangePowerLevelsEventDto {\n\t\treturn new FederationRoomRoomChangePowerLevelsEventDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\troleChangesToApply: createExternalRolesChangesActions(\n\t\t\t\texternalEvent.content?.users,\n\t\t\t\t(externalEvent.prev_content as IMatrixEventContentRoomPowerLevelsChanged)?.users || {},\n\t\t\t),\n\t\t});\n\t}\n}\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let _objectSpread;\n    module.link(\"@babel/runtime/helpers/objectSpread2\", {\n      default(v) {\n        _objectSpread = v;\n      }\n    }, 0);\n    module.export({\n      removeExternalSpecificCharsFromExternalIdentifier: () => removeExternalSpecificCharsFromExternalIdentifier,\n      formatExternalUserIdToInternalUsernameFormat: () => formatExternalUserIdToInternalUsernameFormat,\n      isAnExternalIdentifierFormat: () => isAnExternalIdentifierFormat,\n      isAnExternalUserIdFormat: () => isAnExternalUserIdFormat,\n      extractServerNameFromExternalIdentifier: () => extractServerNameFromExternalIdentifier,\n      convertExternalRoomIdToInternalRoomIdFormat: () => convertExternalRoomIdToInternalRoomIdFormat,\n      MatrixRoomReceiverConverter: () => MatrixRoomReceiverConverter\n    });\n    let RoomType;\n    module.link(\"@rocket.chat/apps-engine/definition/rooms\", {\n      RoomType(v) {\n        RoomType = v;\n      }\n    }, 0);\n    let FederationRoomChangeJoinRulesDto, FederationRoomChangeMembershipDto, FederationRoomChangeNameDto, FederationRoomChangeTopicDto, FederationRoomCreateInputDto, FederationRoomEditExternalMessageDto, FederationRoomReceiveExternalFileMessageDto, FederationRoomReceiveExternalMessageDto, FederationRoomRedactEventDto, FederationRoomRoomChangePowerLevelsEventDto;\n    module.link(\"../../../../application/room/input/RoomReceiverDto\", {\n      FederationRoomChangeJoinRulesDto(v) {\n        FederationRoomChangeJoinRulesDto = v;\n      },\n      FederationRoomChangeMembershipDto(v) {\n        FederationRoomChangeMembershipDto = v;\n      },\n      FederationRoomChangeNameDto(v) {\n        FederationRoomChangeNameDto = v;\n      },\n      FederationRoomChangeTopicDto(v) {\n        FederationRoomChangeTopicDto = v;\n      },\n      FederationRoomCreateInputDto(v) {\n        FederationRoomCreateInputDto = v;\n      },\n      FederationRoomEditExternalMessageDto(v) {\n        FederationRoomEditExternalMessageDto = v;\n      },\n      FederationRoomReceiveExternalFileMessageDto(v) {\n        FederationRoomReceiveExternalFileMessageDto = v;\n      },\n      FederationRoomReceiveExternalMessageDto(v) {\n        FederationRoomReceiveExternalMessageDto = v;\n      },\n      FederationRoomRedactEventDto(v) {\n        FederationRoomRedactEventDto = v;\n      },\n      FederationRoomRoomChangePowerLevelsEventDto(v) {\n        FederationRoomRoomChangePowerLevelsEventDto = v;\n      }\n    }, 1);\n    let EVENT_ORIGIN;\n    module.link(\"../../../../domain/IFederationBridge\", {\n      EVENT_ORIGIN(v) {\n        EVENT_ORIGIN = v;\n      }\n    }, 2);\n    let ROCKET_CHAT_FEDERATION_ROLES;\n    module.link(\"../../../rocket-chat/definitions/FederatedRoomInternalRoles\", {\n      ROCKET_CHAT_FEDERATION_ROLES(v) {\n        ROCKET_CHAT_FEDERATION_ROLES = v;\n      }\n    }, 3);\n    let MatrixEventType;\n    module.link(\"../../definitions/MatrixEventType\", {\n      MatrixEventType(v) {\n        MatrixEventType = v;\n      }\n    }, 4);\n    let MATRIX_POWER_LEVELS;\n    module.link(\"../../definitions/MatrixPowerLevels\", {\n      MATRIX_POWER_LEVELS(v) {\n        MATRIX_POWER_LEVELS = v;\n      }\n    }, 5);\n    let MatrixRoomJoinRules;\n    module.link(\"../../definitions/MatrixRoomJoinRules\", {\n      MatrixRoomJoinRules(v) {\n        MatrixRoomJoinRules = v;\n      }\n    }, 6);\n    let RoomMembershipChangedEventType;\n    module.link(\"../../definitions/events/RoomMembershipChanged\", {\n      RoomMembershipChangedEventType(v) {\n        RoomMembershipChangedEventType = v;\n      }\n    }, 7);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    const removeExternalSpecificCharsFromExternalIdentifier = function () {\n      let matrixIdentifier = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      return matrixIdentifier.replace('@', '').replace('!', '').replace('#', '');\n    };\n    const formatExternalUserIdToInternalUsernameFormat = function () {\n      var _matrixUserId$split$;\n      let matrixUserId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      return (_matrixUserId$split$ = matrixUserId.split(':')[0]) === null || _matrixUserId$split$ === void 0 ? void 0 : _matrixUserId$split$.replace('@', '');\n    };\n    const isAnExternalIdentifierFormat = identifier => identifier.includes(':');\n    const isAnExternalUserIdFormat = userId => isAnExternalIdentifierFormat(userId) && userId.includes('@');\n    const extractServerNameFromExternalIdentifier = function () {\n      let identifier = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      const splitted = identifier.split(':');\n      return splitted.length > 1 ? splitted[1] : '';\n    };\n    const convertExternalRoomIdToInternalRoomIdFormat = function () {\n      let matrixRoomId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      const prefixedRoomIdOnly = matrixRoomId.split(':')[0];\n      const prefix = '!';\n      return prefixedRoomIdOnly === null || prefixedRoomIdOnly === void 0 ? void 0 : prefixedRoomIdOnly.replace(prefix, '');\n    };\n    const getEventOrigin = function () {\n      let inviterId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      let homeServerDomain = arguments.length > 1 ? arguments[1] : undefined;\n      const fromADifferentServer = extractServerNameFromExternalIdentifier(inviterId) !== homeServerDomain;\n      return fromADifferentServer ? EVENT_ORIGIN.REMOTE : EVENT_ORIGIN.LOCAL;\n    };\n    const convertExternalJoinRuleToInternalRoomType = function (matrixJoinRule) {\n      let matrixRoomIsDirect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (matrixRoomIsDirect) {\n        return RoomType.DIRECT_MESSAGE;\n      }\n      const mapping = {\n        [MatrixRoomJoinRules.JOIN]: RoomType.CHANNEL,\n        [MatrixRoomJoinRules.INVITE]: RoomType.PRIVATE_GROUP\n      };\n      return mapping[matrixJoinRule] || RoomType.CHANNEL;\n    };\n    const tryToExtractExternalRoomNameFromTheRoomState = function () {\n      var _roomState$find, _roomState$find$conte;\n      let roomState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      if (roomState.length === 0) {\n        return {};\n      }\n      const externalRoomName = (_roomState$find = roomState.find(stateEvent => stateEvent.type === MatrixEventType.ROOM_NAME_CHANGED)) === null || _roomState$find === void 0 ? void 0 : (_roomState$find$conte = _roomState$find.content) === null || _roomState$find$conte === void 0 ? void 0 : _roomState$find$conte.name;\n      return _objectSpread({}, externalRoomName ? {\n        externalRoomName: removeExternalSpecificCharsFromExternalIdentifier(externalRoomName)\n      } : {});\n    };\n    const tryToExtractAndConvertRoomTypeFromTheRoomState = function () {\n      var _roomState$find2, _roomState$find2$cont;\n      let roomState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      let matrixRoomIsDirect = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (roomState.length === 0) {\n        return {};\n      }\n      const externalRoomJoinRule = (_roomState$find2 = roomState.find(stateEvent => stateEvent.type === MatrixEventType.ROOM_JOIN_RULES_CHANGED)) === null || _roomState$find2 === void 0 ? void 0 : (_roomState$find2$cont = _roomState$find2.content) === null || _roomState$find2$cont === void 0 ? void 0 : _roomState$find2$cont.join_rule;\n      return _objectSpread({}, externalRoomJoinRule ? {\n        roomType: convertExternalJoinRuleToInternalRoomType(externalRoomJoinRule, matrixRoomIsDirect)\n      } : {});\n    };\n    const convertNumericalPowerLevelToInternalRole = powerLevel => {\n      const mapping = {\n        [MATRIX_POWER_LEVELS.USER]: undefined,\n        [MATRIX_POWER_LEVELS.MODERATOR]: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR,\n        [MATRIX_POWER_LEVELS.ADMIN]: ROCKET_CHAT_FEDERATION_ROLES.OWNER\n      };\n      if (mapping[powerLevel]) {\n        return mapping[powerLevel];\n      }\n      if (powerLevel <= MATRIX_POWER_LEVELS.USER) {\n        return;\n      }\n      if (powerLevel > MATRIX_POWER_LEVELS.USER && powerLevel <= MATRIX_POWER_LEVELS.MODERATOR) {\n        return ROCKET_CHAT_FEDERATION_ROLES.MODERATOR;\n      }\n      return ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n    };\n    const onlyRolesAddedToDefaultUsers = (previousRolesState, externalUserId) => !previousRolesState[externalUserId];\n    const verifyIfNewRolesWereAddedForDefaultUsers = (currentRolesState, previousRolesState, changesAlreadyMadeToRoles) => Object.keys(currentRolesState).filter(externalUserId => onlyRolesAddedToDefaultUsers(previousRolesState, externalUserId)).reduce((externalRolesChangesForDefaultUsers, externalUserId) => {\n      const isCurrentRoleAnOwner = convertNumericalPowerLevelToInternalRole(currentRolesState[externalUserId]) === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n      externalRolesChangesForDefaultUsers[externalUserId] = isCurrentRoleAnOwner ? [{\n        action: 'add',\n        role: ROCKET_CHAT_FEDERATION_ROLES.OWNER\n      }] : [{\n        action: 'add',\n        role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR\n      }];\n      return externalRolesChangesForDefaultUsers;\n    }, changesAlreadyMadeToRoles);\n    const createExternalRolesChangesActions = function () {\n      let currentRolesState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      let previousRolesState = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      const changesInRolesBasedOnPreviousState = Object.keys(previousRolesState).reduce((externalRolesChangesByUser, externalUserId) => {\n        const currentPowerLevel = currentRolesState[externalUserId];\n        const previousPowerLevel = previousRolesState[externalUserId];\n        const convertedPreviousExternalRole = convertNumericalPowerLevelToInternalRole(previousPowerLevel);\n        const convertedCurrentExternalRole = convertNumericalPowerLevelToInternalRole(currentPowerLevel);\n        const wasPreviousRoleAnOwner = convertedPreviousExternalRole === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n        const isCurrentRoleAnOwner = convertedCurrentExternalRole === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n        const isCurrentRoleADefault = currentPowerLevel === undefined;\n        const isStillTheSameRole = currentPowerLevel === previousPowerLevel;\n        const isDowngradingTheRole = currentPowerLevel < previousPowerLevel;\n        if (isCurrentRoleADefault) {\n          externalRolesChangesByUser[externalUserId] = wasPreviousRoleAnOwner ? [{\n            action: 'remove',\n            role: ROCKET_CHAT_FEDERATION_ROLES.OWNER\n          }] : [{\n            action: 'remove',\n            role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR\n          }];\n          return externalRolesChangesByUser;\n        }\n        if (isStillTheSameRole) {\n          return externalRolesChangesByUser;\n        }\n        if (isDowngradingTheRole) {\n          externalRolesChangesByUser[externalUserId] = [...(convertedPreviousExternalRole ? [{\n            action: 'remove',\n            role: convertedPreviousExternalRole\n          }] : []), ...(convertedCurrentExternalRole ? [{\n            action: 'add',\n            role: convertedCurrentExternalRole\n          }] : [])];\n          return externalRolesChangesByUser;\n        }\n        externalRolesChangesByUser[externalUserId] = isCurrentRoleAnOwner ? [{\n          action: 'add',\n          role: ROCKET_CHAT_FEDERATION_ROLES.OWNER\n        }, {\n          action: 'remove',\n          role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR\n        }] : [{\n          action: 'add',\n          role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR\n        }, {\n          action: 'remove',\n          role: ROCKET_CHAT_FEDERATION_ROLES.OWNER\n        }];\n        return externalRolesChangesByUser;\n      }, {});\n      return verifyIfNewRolesWereAddedForDefaultUsers(currentRolesState, previousRolesState, changesInRolesBasedOnPreviousState);\n    };\n    const getInviteesFromRoomState = function () {\n      var _roomState$find3;\n      let roomState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      const inviteesFromRoomState = roomState === null || roomState === void 0 ? void 0 : (_roomState$find3 = roomState.find(stateEvent => stateEvent.type === MatrixEventType.ROOM_CREATED)) === null || _roomState$find3 === void 0 ? void 0 : _roomState$find3.content.inviteesExternalIds;\n      if (inviteesFromRoomState) {\n        return inviteesFromRoomState.map(inviteeExternalId => ({\n          externalInviteeId: inviteeExternalId,\n          normalizedInviteeId: removeExternalSpecificCharsFromExternalIdentifier(inviteeExternalId),\n          inviteeUsernameOnly: formatExternalUserIdToInternalUsernameFormat(inviteeExternalId)\n        }));\n      }\n      return [];\n    };\n    const extractAllInviteeIdsWhenDM = externalEvent => {\n      var _externalEvent$unsign, _externalEvent$unsign2;\n      if (!externalEvent.invite_room_state && !((_externalEvent$unsign = externalEvent.unsigned) !== null && _externalEvent$unsign !== void 0 && _externalEvent$unsign.invite_room_state)) {\n        return [];\n      }\n      return getInviteesFromRoomState(externalEvent.invite_room_state || ((_externalEvent$unsign2 = externalEvent.unsigned) === null || _externalEvent$unsign2 === void 0 ? void 0 : _externalEvent$unsign2.invite_room_state) || []);\n    };\n    class MatrixRoomReceiverConverter {\n      static toRoomCreateDto(externalEvent) {\n        var _externalEvent$unsign3, _externalEvent$unsign4, _externalEvent$conten, _externalEvent$conten2;\n        return new FederationRoomCreateInputDto(_objectSpread(_objectSpread(_objectSpread({\n          externalEventId: externalEvent.event_id,\n          externalRoomId: externalEvent.room_id,\n          normalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id)\n        }, tryToExtractExternalRoomNameFromTheRoomState(externalEvent.invite_room_state || ((_externalEvent$unsign3 = externalEvent.unsigned) === null || _externalEvent$unsign3 === void 0 ? void 0 : _externalEvent$unsign3.invite_room_state))), tryToExtractAndConvertRoomTypeFromTheRoomState(externalEvent.invite_room_state || ((_externalEvent$unsign4 = externalEvent.unsigned) === null || _externalEvent$unsign4 === void 0 ? void 0 : _externalEvent$unsign4.invite_room_state))), {}, {\n          externalInviterId: externalEvent.sender,\n          normalizedInviterId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n          wasInternallyProgramaticallyCreated: ((_externalEvent$conten = externalEvent.content) === null || _externalEvent$conten === void 0 ? void 0 : _externalEvent$conten.was_internally_programatically_created) || false,\n          internalRoomId: (_externalEvent$conten2 = externalEvent.content) === null || _externalEvent$conten2 === void 0 ? void 0 : _externalEvent$conten2.internalRoomId\n        }));\n      }\n      static toChangeRoomMembershipDto(externalEvent, homeServerDomain) {\n        var _externalEvent$unsign5, _externalEvent$unsign6, _externalEvent$conten3, _externalEvent$conten4, _externalEvent$conten5, _externalEvent$conten6, _externalEvent$conten7;\n        return new FederationRoomChangeMembershipDto(_objectSpread(_objectSpread(_objectSpread({\n          externalEventId: externalEvent.event_id,\n          externalRoomId: externalEvent.room_id,\n          normalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id)\n        }, tryToExtractExternalRoomNameFromTheRoomState(externalEvent.invite_room_state || ((_externalEvent$unsign5 = externalEvent.unsigned) === null || _externalEvent$unsign5 === void 0 ? void 0 : _externalEvent$unsign5.invite_room_state))), tryToExtractAndConvertRoomTypeFromTheRoomState(externalEvent.invite_room_state || ((_externalEvent$unsign6 = externalEvent.unsigned) === null || _externalEvent$unsign6 === void 0 ? void 0 : _externalEvent$unsign6.invite_room_state), (_externalEvent$conten3 = externalEvent.content) === null || _externalEvent$conten3 === void 0 ? void 0 : _externalEvent$conten3.is_direct)), {}, {\n          externalInviterId: externalEvent.sender,\n          normalizedInviterId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n          externalInviteeId: externalEvent.state_key,\n          normalizedInviteeId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.state_key),\n          inviteeUsernameOnly: formatExternalUserIdToInternalUsernameFormat(externalEvent.state_key),\n          inviterUsernameOnly: formatExternalUserIdToInternalUsernameFormat(externalEvent.sender),\n          eventOrigin: getEventOrigin(externalEvent.sender, homeServerDomain),\n          leave: ((_externalEvent$conten4 = externalEvent.content) === null || _externalEvent$conten4 === void 0 ? void 0 : _externalEvent$conten4.membership) === RoomMembershipChangedEventType.LEAVE,\n          userProfile: {\n            avatarUrl: (_externalEvent$conten5 = externalEvent.content) === null || _externalEvent$conten5 === void 0 ? void 0 : _externalEvent$conten5.avatar_url,\n            displayName: (_externalEvent$conten6 = externalEvent.content) === null || _externalEvent$conten6 === void 0 ? void 0 : _externalEvent$conten6.displayname\n          }\n        }, (_externalEvent$conten7 = externalEvent.content) !== null && _externalEvent$conten7 !== void 0 && _externalEvent$conten7.is_direct ? {\n          allInviteesExternalIdsWhenDM: extractAllInviteeIdsWhenDM(externalEvent)\n        } : {}));\n      }\n      static toSendRoomMessageDto(externalEvent) {\n        var _externalEvent$conten8, _externalEvent$conten9, _externalEvent$conten10, _externalEvent$conten11, _externalEvent$conten12, _externalEvent$conten13, _externalEvent$conten14, _externalEvent$conten15, _externalEvent$conten16, _externalEvent$conten17, _externalEvent$conten18, _externalEvent$conten19, _externalEvent$conten20, _externalEvent$conten21, _externalEvent$conten22;\n        const isThreadedMessage = Boolean(((_externalEvent$conten8 = externalEvent.content) === null || _externalEvent$conten8 === void 0 ? void 0 : (_externalEvent$conten9 = _externalEvent$conten8['m.relates_to']) === null || _externalEvent$conten9 === void 0 ? void 0 : _externalEvent$conten9.rel_type) === MatrixEventType.MESSAGE_ON_THREAD);\n        return new FederationRoomReceiveExternalMessageDto(_objectSpread({\n          externalEventId: externalEvent.event_id,\n          externalRoomId: externalEvent.room_id,\n          normalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n          externalSenderId: externalEvent.sender,\n          normalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n          externalFormattedText: externalEvent.content.formatted_body || '',\n          rawMessage: externalEvent.content.body\n        }, isThreadedMessage ? {\n          thread: {\n            rootEventId: ((_externalEvent$conten10 = externalEvent.content) === null || _externalEvent$conten10 === void 0 ? void 0 : (_externalEvent$conten11 = _externalEvent$conten10['m.relates_to']) === null || _externalEvent$conten11 === void 0 ? void 0 : _externalEvent$conten11.event_id) || '',\n            replyToEventId: ((_externalEvent$conten12 = externalEvent.content) === null || _externalEvent$conten12 === void 0 ? void 0 : (_externalEvent$conten13 = _externalEvent$conten12['m.relates_to']) === null || _externalEvent$conten13 === void 0 ? void 0 : (_externalEvent$conten14 = _externalEvent$conten13['m.in_reply_to']) === null || _externalEvent$conten14 === void 0 ? void 0 : _externalEvent$conten14.event_id) || ''\n          },\n          replyToEventId: !((_externalEvent$conten15 = externalEvent.content) !== null && _externalEvent$conten15 !== void 0 && (_externalEvent$conten16 = _externalEvent$conten15['m.relates_to']) !== null && _externalEvent$conten16 !== void 0 && _externalEvent$conten16.is_falling_back) ? (_externalEvent$conten17 = externalEvent.content) === null || _externalEvent$conten17 === void 0 ? void 0 : (_externalEvent$conten18 = _externalEvent$conten17['m.relates_to']) === null || _externalEvent$conten18 === void 0 ? void 0 : (_externalEvent$conten19 = _externalEvent$conten18['m.in_reply_to']) === null || _externalEvent$conten19 === void 0 ? void 0 : _externalEvent$conten19.event_id : undefined\n        } : {\n          replyToEventId: (_externalEvent$conten20 = externalEvent.content) === null || _externalEvent$conten20 === void 0 ? void 0 : (_externalEvent$conten21 = _externalEvent$conten20['m.relates_to']) === null || _externalEvent$conten21 === void 0 ? void 0 : (_externalEvent$conten22 = _externalEvent$conten21['m.in_reply_to']) === null || _externalEvent$conten22 === void 0 ? void 0 : _externalEvent$conten22.event_id\n        }));\n      }\n      static toEditRoomMessageDto(externalEvent) {\n        var _externalEvent$conten23, _externalEvent$conten24, _externalEvent$conten25;\n        return new FederationRoomEditExternalMessageDto({\n          externalEventId: externalEvent.event_id,\n          externalRoomId: externalEvent.room_id,\n          normalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n          externalSenderId: externalEvent.sender,\n          normalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n          newExternalFormattedText: ((_externalEvent$conten23 = externalEvent.content['m.new_content']) === null || _externalEvent$conten23 === void 0 ? void 0 : _externalEvent$conten23.formatted_body) || '',\n          newRawMessage: (_externalEvent$conten24 = externalEvent.content['m.new_content']) === null || _externalEvent$conten24 === void 0 ? void 0 : _externalEvent$conten24.body,\n          editsEvent: (_externalEvent$conten25 = externalEvent.content['m.relates_to']) === null || _externalEvent$conten25 === void 0 ? void 0 : _externalEvent$conten25.event_id\n        });\n      }\n      static toSendRoomFileMessageDto(externalEvent) {\n        var _externalEvent$conten26, _externalEvent$conten27, _externalEvent$conten28, _externalEvent$conten29, _externalEvent$conten30, _externalEvent$conten31, _externalEvent$conten32, _externalEvent$conten33, _externalEvent$conten34, _externalEvent$conten35, _externalEvent$conten36, _externalEvent$conten37, _externalEvent$conten38, _externalEvent$conten39, _externalEvent$conten40, _externalEvent$conten41, _externalEvent$conten42;\n        if (!externalEvent.content.url) {\n          throw new Error('Missing url in the file message');\n        }\n        if (!((_externalEvent$conten26 = externalEvent.content.info) !== null && _externalEvent$conten26 !== void 0 && _externalEvent$conten26.mimetype)) {\n          throw new Error('Missing mimetype in the file message info');\n        }\n        if (!((_externalEvent$conten27 = externalEvent.content.info) !== null && _externalEvent$conten27 !== void 0 && _externalEvent$conten27.size)) {\n          throw new Error('Missing size in the file message info');\n        }\n        const isThreadedMessage = Boolean(((_externalEvent$conten28 = externalEvent.content) === null || _externalEvent$conten28 === void 0 ? void 0 : (_externalEvent$conten29 = _externalEvent$conten28['m.relates_to']) === null || _externalEvent$conten29 === void 0 ? void 0 : _externalEvent$conten29.rel_type) === MatrixEventType.MESSAGE_ON_THREAD);\n        return new FederationRoomReceiveExternalFileMessageDto(_objectSpread({\n          externalEventId: externalEvent.event_id,\n          externalRoomId: externalEvent.room_id,\n          normalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n          externalSenderId: externalEvent.sender,\n          normalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n          filename: externalEvent.content.body,\n          url: externalEvent.content.url,\n          mimetype: externalEvent.content.info.mimetype,\n          size: externalEvent.content.info.size,\n          messageText: externalEvent.content.body\n        }, isThreadedMessage ? {\n          thread: {\n            rootEventId: ((_externalEvent$conten30 = externalEvent.content) === null || _externalEvent$conten30 === void 0 ? void 0 : (_externalEvent$conten31 = _externalEvent$conten30['m.relates_to']) === null || _externalEvent$conten31 === void 0 ? void 0 : _externalEvent$conten31.event_id) || '',\n            replyToEventId: ((_externalEvent$conten32 = externalEvent.content) === null || _externalEvent$conten32 === void 0 ? void 0 : (_externalEvent$conten33 = _externalEvent$conten32['m.relates_to']) === null || _externalEvent$conten33 === void 0 ? void 0 : (_externalEvent$conten34 = _externalEvent$conten33['m.in_reply_to']) === null || _externalEvent$conten34 === void 0 ? void 0 : _externalEvent$conten34.event_id) || ''\n          },\n          replyToEventId: !((_externalEvent$conten35 = externalEvent.content) !== null && _externalEvent$conten35 !== void 0 && (_externalEvent$conten36 = _externalEvent$conten35['m.relates_to']) !== null && _externalEvent$conten36 !== void 0 && _externalEvent$conten36.is_falling_back) ? (_externalEvent$conten37 = externalEvent.content) === null || _externalEvent$conten37 === void 0 ? void 0 : (_externalEvent$conten38 = _externalEvent$conten37['m.relates_to']) === null || _externalEvent$conten38 === void 0 ? void 0 : (_externalEvent$conten39 = _externalEvent$conten38['m.in_reply_to']) === null || _externalEvent$conten39 === void 0 ? void 0 : _externalEvent$conten39.event_id : undefined\n        } : {\n          replyToEventId: (_externalEvent$conten40 = externalEvent.content) === null || _externalEvent$conten40 === void 0 ? void 0 : (_externalEvent$conten41 = _externalEvent$conten40['m.relates_to']) === null || _externalEvent$conten41 === void 0 ? void 0 : (_externalEvent$conten42 = _externalEvent$conten41['m.in_reply_to']) === null || _externalEvent$conten42 === void 0 ? void 0 : _externalEvent$conten42.event_id\n        }));\n      }\n      static toRoomChangeJoinRulesDto(externalEvent) {\n        var _externalEvent$conten43;\n        return new FederationRoomChangeJoinRulesDto({\n          externalEventId: externalEvent.event_id,\n          externalRoomId: externalEvent.room_id,\n          normalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n          roomType: convertExternalJoinRuleToInternalRoomType((_externalEvent$conten43 = externalEvent.content) === null || _externalEvent$conten43 === void 0 ? void 0 : _externalEvent$conten43.join_rule)\n        });\n      }\n      static toRoomChangeNameDto(externalEvent) {\n        var _externalEvent$conten44;\n        return new FederationRoomChangeNameDto({\n          externalEventId: externalEvent.event_id,\n          externalRoomId: externalEvent.room_id,\n          normalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n          externalSenderId: externalEvent.sender,\n          normalizedRoomName: removeExternalSpecificCharsFromExternalIdentifier((_externalEvent$conten44 = externalEvent.content) === null || _externalEvent$conten44 === void 0 ? void 0 : _externalEvent$conten44.name)\n        });\n      }\n      static toRoomChangeTopicDto(externalEvent) {\n        var _externalEvent$conten45;\n        return new FederationRoomChangeTopicDto({\n          externalEventId: externalEvent.event_id,\n          externalRoomId: externalEvent.room_id,\n          normalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n          externalSenderId: externalEvent.sender,\n          roomTopic: (_externalEvent$conten45 = externalEvent.content) === null || _externalEvent$conten45 === void 0 ? void 0 : _externalEvent$conten45.topic\n        });\n      }\n      static toRoomRedactEventDto(externalEvent) {\n        return new FederationRoomRedactEventDto({\n          externalEventId: externalEvent.event_id,\n          externalRoomId: externalEvent.room_id,\n          normalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n          externalSenderId: externalEvent.sender,\n          redactsEvent: externalEvent.redacts\n        });\n      }\n      static toRoomChangePowerLevelsEventDto(externalEvent) {\n        var _externalEvent$conten46, _externalEvent$prev_c;\n        return new FederationRoomRoomChangePowerLevelsEventDto({\n          externalEventId: externalEvent.event_id,\n          externalRoomId: externalEvent.room_id,\n          normalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n          externalSenderId: externalEvent.sender,\n          roleChangesToApply: createExternalRolesChangesActions((_externalEvent$conten46 = externalEvent.content) === null || _externalEvent$conten46 === void 0 ? void 0 : _externalEvent$conten46.users, ((_externalEvent$prev_c = externalEvent.prev_content) === null || _externalEvent$prev_c === void 0 ? void 0 : _externalEvent$prev_c.users) || {})\n        });\n      }\n    }\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["_objectSpread","module","link","default","v","export","removeExternalSpecificCharsFromExternalIdentifier","formatExternalUserIdToInternalUsernameFormat","isAnExternalIdentifierFormat","isAnExternalUserIdFormat","extractServerNameFromExternalIdentifier","convertExternalRoomIdToInternalRoomIdFormat","MatrixRoomReceiverConverter","RoomType","FederationRoomChangeJoinRulesDto","FederationRoomChangeMembershipDto","FederationRoomChangeNameDto","FederationRoomChangeTopicDto","FederationRoomCreateInputDto","FederationRoomEditExternalMessageDto","FederationRoomReceiveExternalFileMessageDto","FederationRoomReceiveExternalMessageDto","FederationRoomRedactEventDto","FederationRoomRoomChangePowerLevelsEventDto","EVENT_ORIGIN","ROCKET_CHAT_FEDERATION_ROLES","MatrixEventType","MATRIX_POWER_LEVELS","MatrixRoomJoinRules","RoomMembershipChangedEventType","__reifyWaitForDeps__","matrixIdentifier","arguments","length","undefined","replace","_matrixUserId$split$","matrixUserId","split","identifier","includes","userId","splitted","matrixRoomId","prefixedRoomIdOnly","prefix","getEventOrigin","inviterId","homeServerDomain","fromADifferentServer","REMOTE","LOCAL","convertExternalJoinRuleToInternalRoomType","matrixJoinRule","matrixRoomIsDirect","DIRECT_MESSAGE","mapping","JOIN","CHANNEL","INVITE","PRIVATE_GROUP","tryToExtractExternalRoomNameFromTheRoomState","_roomState$find","_roomState$find$conte","roomState","externalRoomName","find","stateEvent","type","ROOM_NAME_CHANGED","content","name","tryToExtractAndConvertRoomTypeFromTheRoomState","_roomState$find2","_roomState$find2$cont","externalRoomJoinRule","ROOM_JOIN_RULES_CHANGED","join_rule","roomType","convertNumericalPowerLevelToInternalRole","powerLevel","USER","MODERATOR","ADMIN","OWNER","onlyRolesAddedToDefaultUsers","previousRolesState","externalUserId","verifyIfNewRolesWereAddedForDefaultUsers","currentRolesState","changesAlreadyMadeToRoles","Object","keys","filter","reduce","externalRolesChangesForDefaultUsers","isCurrentRoleAnOwner","action","role","createExternalRolesChangesActions","changesInRolesBasedOnPreviousState","externalRolesChangesByUser","currentPowerLevel","previousPowerLevel","convertedPreviousExternalRole","convertedCurrentExternalRole","wasPreviousRoleAnOwner","isCurrentRoleADefault","isStillTheSameRole","isDowngradingTheRole","getInviteesFromRoomState","_roomState$find3","inviteesFromRoomState","ROOM_CREATED","inviteesExternalIds","map","inviteeExternalId","externalInviteeId","normalizedInviteeId","inviteeUsernameOnly","extractAllInviteeIdsWhenDM","externalEvent","_externalEvent$unsign","_externalEvent$unsign2","invite_room_state","unsigned","toRoomCreateDto","_externalEvent$unsign3","_externalEvent$unsign4","_externalEvent$conten","_externalEvent$conten2","externalEventId","event_id","externalRoomId","room_id","normalizedRoomId","externalInviterId","sender","normalizedInviterId","wasInternallyProgramaticallyCreated","was_internally_programatically_created","internalRoomId","toChangeRoomMembershipDto","_externalEvent$unsign5","_externalEvent$unsign6","_externalEvent$conten3","_externalEvent$conten4","_externalEvent$conten5","_externalEvent$conten6","_externalEvent$conten7","is_direct","state_key","inviterUsernameOnly","eventOrigin","leave","membership","LEAVE","userProfile","avatarUrl","avatar_url","displayName","displayname","allInviteesExternalIdsWhenDM","toSendRoomMessageDto","_externalEvent$conten8","_externalEvent$conten9","_externalEvent$conten10","_externalEvent$conten11","_externalEvent$conten12","_externalEvent$conten13","_externalEvent$conten14","_externalEvent$conten15","_externalEvent$conten16","_externalEvent$conten17","_externalEvent$conten18","_externalEvent$conten19","_externalEvent$conten20","_externalEvent$conten21","_externalEvent$conten22","isThreadedMessage","Boolean","rel_type","MESSAGE_ON_THREAD","externalSenderId","normalizedSenderId","externalFormattedText","formatted_body","rawMessage","body","thread","rootEventId","replyToEventId","is_falling_back","toEditRoomMessageDto","_externalEvent$conten23","_externalEvent$conten24","_externalEvent$conten25","newExternalFormattedText","newRawMessage","editsEvent","toSendRoomFileMessageDto","_externalEvent$conten26","_externalEvent$conten27","_externalEvent$conten28","_externalEvent$conten29","_externalEvent$conten30","_externalEvent$conten31","_externalEvent$conten32","_externalEvent$conten33","_externalEvent$conten34","_externalEvent$conten35","_externalEvent$conten36","_externalEvent$conten37","_externalEvent$conten38","_externalEvent$conten39","_externalEvent$conten40","_externalEvent$conten41","_externalEvent$conten42","url","Error","info","mimetype","size","filename","messageText","toRoomChangeJoinRulesDto","_externalEvent$conten43","toRoomChangeNameDto","_externalEvent$conten44","normalizedRoomName","toRoomChangeTopicDto","_externalEvent$conten45","roomTopic","topic","toRoomRedactEventDto","redactsEvent","redacts","toRoomChangePowerLevelsEventDto","_externalEvent$conten46","_externalEvent$prev_c","roleChangesToApply","users","prev_content","__reify_async_result__","_reifyError","self","async"],"sources":["server/services/federation/infrastructure/matrix/converters/room/RoomReceiver.ts"],"sourcesContent":["import { RoomType } from '@rocket.chat/apps-engine/definition/rooms';\n\nimport {\n\tFederationRoomChangeJoinRulesDto,\n\tFederationRoomChangeMembershipDto,\n\tFederationRoomChangeNameDto,\n\tFederationRoomChangeTopicDto,\n\tFederationRoomCreateInputDto,\n\tFederationRoomEditExternalMessageDto,\n\tFederationRoomReceiveExternalFileMessageDto,\n\tFederationRoomReceiveExternalMessageDto,\n\tFederationRoomRedactEventDto,\n\tFederationRoomRoomChangePowerLevelsEventDto,\n} from '../../../../application/room/input/RoomReceiverDto';\nimport type { IExternalRolesChangesToApplyInputDto } from '../../../../application/room/input/RoomReceiverDto';\nimport { EVENT_ORIGIN } from '../../../../domain/IFederationBridge';\nimport { ROCKET_CHAT_FEDERATION_ROLES } from '../../../rocket-chat/definitions/FederatedRoomInternalRoles';\nimport type { AbstractMatrixEvent } from '../../definitions/AbstractMatrixEvent';\nimport { MatrixEventType } from '../../definitions/MatrixEventType';\nimport { MATRIX_POWER_LEVELS } from '../../definitions/MatrixPowerLevels';\nimport { MatrixRoomJoinRules } from '../../definitions/MatrixRoomJoinRules';\nimport type { MatrixEventRoomCreated } from '../../definitions/events/RoomCreated';\nimport type { MatrixEventRoomRedacted } from '../../definitions/events/RoomEventRedacted';\nimport type { MatrixEventRoomJoinRulesChanged } from '../../definitions/events/RoomJoinRulesChanged';\nimport type { MatrixEventRoomMembershipChanged } from '../../definitions/events/RoomMembershipChanged';\nimport { RoomMembershipChangedEventType } from '../../definitions/events/RoomMembershipChanged';\nimport type { MatrixEventRoomMessageSent } from '../../definitions/events/RoomMessageSent';\nimport type { MatrixEventRoomNameChanged } from '../../definitions/events/RoomNameChanged';\nimport type {\n\tIMatrixEventContentRoomPowerLevelsChanged,\n\tMatrixEventRoomRoomPowerLevelsChanged,\n} from '../../definitions/events/RoomPowerLevelsChanged';\nimport type { MatrixEventRoomTopicChanged } from '../../definitions/events/RoomTopicChanged';\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const removeExternalSpecificCharsFromExternalIdentifier = (matrixIdentifier = ''): string => {\n\treturn matrixIdentifier.replace('@', '').replace('!', '').replace('#', '');\n};\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const formatExternalUserIdToInternalUsernameFormat = (matrixUserId = ''): string => {\n\treturn matrixUserId.split(':')[0]?.replace('@', '');\n};\n\nexport const isAnExternalIdentifierFormat = (identifier: string): boolean => identifier.includes(':');\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const isAnExternalUserIdFormat = (userId: string): boolean => isAnExternalIdentifierFormat(userId) && userId.includes('@');\n\n/** @deprecated export from {@link ../../helpers/MatrixIdStringTools} instead */\nexport const extractServerNameFromExternalIdentifier = (identifier = ''): string => {\n\tconst splitted = identifier.split(':');\n\n\treturn splitted.length > 1 ? splitted[1] : '';\n};\n\nexport const convertExternalRoomIdToInternalRoomIdFormat = (matrixRoomId = ''): string => {\n\tconst prefixedRoomIdOnly = matrixRoomId.split(':')[0];\n\tconst prefix = '!';\n\n\treturn prefixedRoomIdOnly?.replace(prefix, '');\n};\n\nconst getEventOrigin = (inviterId = '', homeServerDomain: string): EVENT_ORIGIN => {\n\tconst fromADifferentServer = extractServerNameFromExternalIdentifier(inviterId) !== homeServerDomain;\n\n\treturn fromADifferentServer ? EVENT_ORIGIN.REMOTE : EVENT_ORIGIN.LOCAL;\n};\n\nconst convertExternalJoinRuleToInternalRoomType = (matrixJoinRule: MatrixRoomJoinRules, matrixRoomIsDirect = false): RoomType => {\n\tif (matrixRoomIsDirect) {\n\t\treturn RoomType.DIRECT_MESSAGE;\n\t}\n\tconst mapping: Record<string, RoomType> = {\n\t\t[MatrixRoomJoinRules.JOIN]: RoomType.CHANNEL,\n\t\t[MatrixRoomJoinRules.INVITE]: RoomType.PRIVATE_GROUP,\n\t};\n\n\treturn mapping[matrixJoinRule] || RoomType.CHANNEL;\n};\n\nconst tryToExtractExternalRoomNameFromTheRoomState = (roomState: AbstractMatrixEvent[] = []): { externalRoomName?: string } => {\n\tif (roomState.length === 0) {\n\t\treturn {};\n\t}\n\tconst externalRoomName = (\n\t\troomState.find((stateEvent) => stateEvent.type === MatrixEventType.ROOM_NAME_CHANGED) as MatrixEventRoomNameChanged\n\t)?.content?.name;\n\n\treturn {\n\t\t...(externalRoomName ? { externalRoomName: removeExternalSpecificCharsFromExternalIdentifier(externalRoomName) } : {}),\n\t};\n};\n\nconst tryToExtractAndConvertRoomTypeFromTheRoomState = (\n\troomState: AbstractMatrixEvent[] = [],\n\tmatrixRoomIsDirect = false,\n): { roomType?: RoomType } => {\n\tif (roomState.length === 0) {\n\t\treturn {};\n\t}\n\tconst externalRoomJoinRule = (\n\t\troomState.find((stateEvent) => stateEvent.type === MatrixEventType.ROOM_JOIN_RULES_CHANGED) as MatrixEventRoomJoinRulesChanged\n\t)?.content?.join_rule;\n\n\treturn {\n\t\t...(externalRoomJoinRule ? { roomType: convertExternalJoinRuleToInternalRoomType(externalRoomJoinRule, matrixRoomIsDirect) } : {}),\n\t};\n};\n\nconst convertNumericalPowerLevelToInternalRole = (powerLevel: number): ROCKET_CHAT_FEDERATION_ROLES | undefined => {\n\tconst mapping: Record<number, ROCKET_CHAT_FEDERATION_ROLES | undefined> = {\n\t\t[MATRIX_POWER_LEVELS.USER]: undefined,\n\t\t[MATRIX_POWER_LEVELS.MODERATOR]: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR,\n\t\t[MATRIX_POWER_LEVELS.ADMIN]: ROCKET_CHAT_FEDERATION_ROLES.OWNER,\n\t};\n\n\tif (mapping[powerLevel]) {\n\t\treturn mapping[powerLevel];\n\t}\n\n\tif (powerLevel <= MATRIX_POWER_LEVELS.USER) {\n\t\treturn;\n\t}\n\tif (powerLevel > MATRIX_POWER_LEVELS.USER && powerLevel <= MATRIX_POWER_LEVELS.MODERATOR) {\n\t\treturn ROCKET_CHAT_FEDERATION_ROLES.MODERATOR;\n\t}\n\treturn ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n};\n\nconst onlyRolesAddedToDefaultUsers = (previousRolesState: { [key: string]: number }, externalUserId: string): boolean =>\n\t!previousRolesState[externalUserId];\n\nconst verifyIfNewRolesWereAddedForDefaultUsers = (\n\tcurrentRolesState: { [key: string]: number },\n\tpreviousRolesState: { [key: string]: number },\n\tchangesAlreadyMadeToRoles: IExternalRolesChangesToApplyInputDto,\n): IExternalRolesChangesToApplyInputDto =>\n\tObject.keys(currentRolesState)\n\t\t.filter((externalUserId) => onlyRolesAddedToDefaultUsers(previousRolesState, externalUserId))\n\t\t.reduce((externalRolesChangesForDefaultUsers, externalUserId) => {\n\t\t\tconst isCurrentRoleAnOwner =\n\t\t\t\tconvertNumericalPowerLevelToInternalRole(currentRolesState[externalUserId]) === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n\t\t\texternalRolesChangesForDefaultUsers[externalUserId] = isCurrentRoleAnOwner\n\t\t\t\t? [{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER }]\n\t\t\t\t: [{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR }];\n\t\t\treturn externalRolesChangesForDefaultUsers;\n\t\t}, changesAlreadyMadeToRoles);\n\nconst createExternalRolesChangesActions = (\n\tcurrentRolesState: { [key: string]: number } = {},\n\tpreviousRolesState: { [key: string]: number } = {},\n): IExternalRolesChangesToApplyInputDto => {\n\tconst changesInRolesBasedOnPreviousState = Object.keys(previousRolesState).reduce((externalRolesChangesByUser, externalUserId) => {\n\t\tconst currentPowerLevel = currentRolesState[externalUserId];\n\t\tconst previousPowerLevel = previousRolesState[externalUserId];\n\t\tconst convertedPreviousExternalRole = convertNumericalPowerLevelToInternalRole(previousPowerLevel);\n\t\tconst convertedCurrentExternalRole = convertNumericalPowerLevelToInternalRole(currentPowerLevel);\n\t\tconst wasPreviousRoleAnOwner = convertedPreviousExternalRole === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n\t\tconst isCurrentRoleAnOwner = convertedCurrentExternalRole === ROCKET_CHAT_FEDERATION_ROLES.OWNER;\n\t\tconst isCurrentRoleADefault = currentPowerLevel === undefined;\n\t\tconst isStillTheSameRole = currentPowerLevel === previousPowerLevel;\n\t\tconst isDowngradingTheRole = currentPowerLevel < previousPowerLevel;\n\t\tif (isCurrentRoleADefault) {\n\t\t\texternalRolesChangesByUser[externalUserId] = wasPreviousRoleAnOwner\n\t\t\t\t? [{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER }]\n\t\t\t\t: [{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR }];\n\t\t\treturn externalRolesChangesByUser;\n\t\t}\n\t\tif (isStillTheSameRole) {\n\t\t\treturn externalRolesChangesByUser;\n\t\t}\n\t\tif (isDowngradingTheRole) {\n\t\t\texternalRolesChangesByUser[externalUserId] = [\n\t\t\t\t...(convertedPreviousExternalRole ? [{ action: 'remove', role: convertedPreviousExternalRole }] : []),\n\t\t\t\t...(convertedCurrentExternalRole ? [{ action: 'add', role: convertedCurrentExternalRole }] : []),\n\t\t\t];\n\t\t\treturn externalRolesChangesByUser;\n\t\t}\n\t\texternalRolesChangesByUser[externalUserId] = isCurrentRoleAnOwner\n\t\t\t? [\n\t\t\t\t\t{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER },\n\t\t\t\t\t{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR },\n\t\t\t  ]\n\t\t\t: [\n\t\t\t\t\t{ action: 'add', role: ROCKET_CHAT_FEDERATION_ROLES.MODERATOR },\n\t\t\t\t\t{ action: 'remove', role: ROCKET_CHAT_FEDERATION_ROLES.OWNER },\n\t\t\t  ];\n\n\t\treturn externalRolesChangesByUser;\n\t}, {} as IExternalRolesChangesToApplyInputDto);\n\n\treturn verifyIfNewRolesWereAddedForDefaultUsers(currentRolesState, previousRolesState, changesInRolesBasedOnPreviousState);\n};\n\nconst getInviteesFromRoomState = (\n\troomState: AbstractMatrixEvent[] = [],\n): {\n\texternalInviteeId: string;\n\tnormalizedInviteeId: string;\n\tinviteeUsernameOnly: string;\n}[] => {\n\tconst inviteesFromRoomState = (\n\t\troomState?.find((stateEvent) => stateEvent.type === MatrixEventType.ROOM_CREATED) as MatrixEventRoomCreated\n\t)?.content.inviteesExternalIds;\n\tif (inviteesFromRoomState) {\n\t\treturn inviteesFromRoomState.map((inviteeExternalId) => ({\n\t\t\texternalInviteeId: inviteeExternalId,\n\t\t\tnormalizedInviteeId: removeExternalSpecificCharsFromExternalIdentifier(inviteeExternalId),\n\t\t\tinviteeUsernameOnly: formatExternalUserIdToInternalUsernameFormat(inviteeExternalId),\n\t\t}));\n\t}\n\treturn [];\n};\n\nconst extractAllInviteeIdsWhenDM = (\n\texternalEvent: MatrixEventRoomMembershipChanged,\n): {\n\texternalInviteeId: string;\n\tnormalizedInviteeId: string;\n\tinviteeUsernameOnly: string;\n}[] => {\n\tif (!externalEvent.invite_room_state && !externalEvent.unsigned?.invite_room_state) {\n\t\treturn [];\n\t}\n\n\treturn getInviteesFromRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state || []);\n};\n\nexport class MatrixRoomReceiverConverter {\n\tpublic static toRoomCreateDto(externalEvent: MatrixEventRoomCreated): FederationRoomCreateInputDto {\n\t\treturn new FederationRoomCreateInputDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\t...tryToExtractExternalRoomNameFromTheRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state),\n\t\t\t...tryToExtractAndConvertRoomTypeFromTheRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state),\n\t\t\texternalInviterId: externalEvent.sender,\n\t\t\tnormalizedInviterId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\twasInternallyProgramaticallyCreated: externalEvent.content?.was_internally_programatically_created || false,\n\t\t\tinternalRoomId: externalEvent.content?.internalRoomId,\n\t\t});\n\t}\n\n\tpublic static toChangeRoomMembershipDto(\n\t\texternalEvent: MatrixEventRoomMembershipChanged,\n\t\thomeServerDomain: string,\n\t): FederationRoomChangeMembershipDto {\n\t\treturn new FederationRoomChangeMembershipDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\t...tryToExtractExternalRoomNameFromTheRoomState(externalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state),\n\t\t\t...tryToExtractAndConvertRoomTypeFromTheRoomState(\n\t\t\t\texternalEvent.invite_room_state || externalEvent.unsigned?.invite_room_state,\n\t\t\t\texternalEvent.content?.is_direct,\n\t\t\t),\n\t\t\texternalInviterId: externalEvent.sender,\n\t\t\tnormalizedInviterId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\texternalInviteeId: externalEvent.state_key,\n\t\t\tnormalizedInviteeId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.state_key),\n\t\t\tinviteeUsernameOnly: formatExternalUserIdToInternalUsernameFormat(externalEvent.state_key),\n\t\t\tinviterUsernameOnly: formatExternalUserIdToInternalUsernameFormat(externalEvent.sender),\n\t\t\teventOrigin: getEventOrigin(externalEvent.sender, homeServerDomain),\n\t\t\tleave: externalEvent.content?.membership === RoomMembershipChangedEventType.LEAVE,\n\t\t\tuserProfile: {\n\t\t\t\tavatarUrl: externalEvent.content?.avatar_url,\n\t\t\t\tdisplayName: externalEvent.content?.displayname,\n\t\t\t},\n\t\t\t...(externalEvent.content?.is_direct ? { allInviteesExternalIdsWhenDM: extractAllInviteeIdsWhenDM(externalEvent) } : {}),\n\t\t});\n\t}\n\n\tpublic static toSendRoomMessageDto(externalEvent: MatrixEventRoomMessageSent): FederationRoomReceiveExternalMessageDto {\n\t\tconst isThreadedMessage = Boolean(externalEvent.content?.['m.relates_to']?.rel_type === MatrixEventType.MESSAGE_ON_THREAD);\n\n\t\treturn new FederationRoomReceiveExternalMessageDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\texternalFormattedText: externalEvent.content.formatted_body || '',\n\t\t\trawMessage: externalEvent.content.body,\n\t\t\t...(isThreadedMessage\n\t\t\t\t? {\n\t\t\t\t\t\tthread: {\n\t\t\t\t\t\t\trootEventId: externalEvent.content?.['m.relates_to']?.event_id || '',\n\t\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id || '',\n\t\t\t\t\t\t},\n\t\t\t\t\t\treplyToEventId: !externalEvent.content?.['m.relates_to']?.is_falling_back\n\t\t\t\t\t\t\t? externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t  }\n\t\t\t\t: {\n\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id,\n\t\t\t\t  }),\n\t\t});\n\t}\n\n\tpublic static toEditRoomMessageDto(externalEvent: MatrixEventRoomMessageSent): FederationRoomEditExternalMessageDto {\n\t\treturn new FederationRoomEditExternalMessageDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\tnewExternalFormattedText: externalEvent.content['m.new_content']?.formatted_body || '',\n\t\t\tnewRawMessage: externalEvent.content['m.new_content']?.body as string,\n\t\t\teditsEvent: externalEvent.content['m.relates_to']?.event_id as string,\n\t\t});\n\t}\n\n\tpublic static toSendRoomFileMessageDto(externalEvent: MatrixEventRoomMessageSent): FederationRoomReceiveExternalFileMessageDto {\n\t\tif (!externalEvent.content.url) {\n\t\t\tthrow new Error('Missing url in the file message');\n\t\t}\n\t\tif (!externalEvent.content.info?.mimetype) {\n\t\t\tthrow new Error('Missing mimetype in the file message info');\n\t\t}\n\t\tif (!externalEvent.content.info?.size) {\n\t\t\tthrow new Error('Missing size in the file message info');\n\t\t}\n\t\tconst isThreadedMessage = Boolean(externalEvent.content?.['m.relates_to']?.rel_type === MatrixEventType.MESSAGE_ON_THREAD);\n\n\t\treturn new FederationRoomReceiveExternalFileMessageDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedSenderId: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.sender),\n\t\t\tfilename: externalEvent.content.body,\n\t\t\turl: externalEvent.content.url,\n\t\t\tmimetype: externalEvent.content.info.mimetype,\n\t\t\tsize: externalEvent.content.info.size,\n\t\t\tmessageText: externalEvent.content.body,\n\t\t\t...(isThreadedMessage\n\t\t\t\t? {\n\t\t\t\t\t\tthread: {\n\t\t\t\t\t\t\trootEventId: externalEvent.content?.['m.relates_to']?.event_id || '',\n\t\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id || '',\n\t\t\t\t\t\t},\n\t\t\t\t\t\treplyToEventId: !externalEvent.content?.['m.relates_to']?.is_falling_back\n\t\t\t\t\t\t\t? externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t  }\n\t\t\t\t: {\n\t\t\t\t\t\treplyToEventId: externalEvent.content?.['m.relates_to']?.['m.in_reply_to']?.event_id,\n\t\t\t\t  }),\n\t\t});\n\t}\n\n\tpublic static toRoomChangeJoinRulesDto(externalEvent: MatrixEventRoomJoinRulesChanged): FederationRoomChangeJoinRulesDto {\n\t\treturn new FederationRoomChangeJoinRulesDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\troomType: convertExternalJoinRuleToInternalRoomType(externalEvent.content?.join_rule),\n\t\t});\n\t}\n\n\tpublic static toRoomChangeNameDto(externalEvent: MatrixEventRoomNameChanged): FederationRoomChangeNameDto {\n\t\treturn new FederationRoomChangeNameDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tnormalizedRoomName: removeExternalSpecificCharsFromExternalIdentifier(externalEvent.content?.name),\n\t\t});\n\t}\n\n\tpublic static toRoomChangeTopicDto(externalEvent: MatrixEventRoomTopicChanged): FederationRoomChangeTopicDto {\n\t\treturn new FederationRoomChangeTopicDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\troomTopic: externalEvent.content?.topic,\n\t\t});\n\t}\n\n\tpublic static toRoomRedactEventDto(externalEvent: MatrixEventRoomRedacted): FederationRoomRedactEventDto {\n\t\treturn new FederationRoomRedactEventDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\tredactsEvent: externalEvent.redacts as string,\n\t\t});\n\t}\n\n\tpublic static toRoomChangePowerLevelsEventDto(\n\t\texternalEvent: MatrixEventRoomRoomPowerLevelsChanged,\n\t): FederationRoomRoomChangePowerLevelsEventDto {\n\t\treturn new FederationRoomRoomChangePowerLevelsEventDto({\n\t\t\texternalEventId: externalEvent.event_id,\n\t\t\texternalRoomId: externalEvent.room_id,\n\t\t\tnormalizedRoomId: convertExternalRoomIdToInternalRoomIdFormat(externalEvent.room_id),\n\t\t\texternalSenderId: externalEvent.sender,\n\t\t\troleChangesToApply: createExternalRolesChangesActions(\n\t\t\t\texternalEvent.content?.users,\n\t\t\t\t(externalEvent.prev_content as IMatrixEventContentRoomPowerLevelsChanged)?.users || {},\n\t\t\t),\n\t\t});\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"3492f9f488bea816cf1b27b9e31cdc6469c5a953"}
