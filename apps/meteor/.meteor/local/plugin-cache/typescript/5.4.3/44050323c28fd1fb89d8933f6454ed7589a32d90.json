{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/marketplace/hooks/useAppInstallationHandler.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/marketplace/hooks/useAppInstallationHandler.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/marketplace/hooks/useAppInstallationHandler.tsx","inputSourceMap":{"version":3,"file":"client/views/marketplace/hooks/useAppInstallationHandler.tsx","sourceRoot":"","sources":["client/views/marketplace/hooks/useAppInstallationHandler.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { App } from '@rocket.chat/core-typings';\nimport { useEndpoint, useRouteParameter, useSetModal, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport React, { useCallback } from 'react';\n\nimport { useExternalLink } from '../../../hooks/useExternalLink';\nimport { useCheckoutUrl } from '../../admin/subscription/hooks/useCheckoutUrl';\nimport IframeModal from '../IframeModal';\nimport AppInstallModal from '../components/AppInstallModal/AppInstallModal';\nimport type { Actions } from '../helpers';\nimport { handleAPIError } from '../helpers/handleAPIError';\nimport { isMarketplaceRouteContext, useAppsCountQuery } from './useAppsCountQuery';\nimport { useAppsOrchestration } from './useAppsOrchestration';\nimport { useOpenAppPermissionsReviewModal } from './useOpenAppPermissionsReviewModal';\nimport { useOpenIncompatibleModal } from './useOpenIncompatibleModal';\n\nexport type AppInstallationHandlerParams = {\n\tapp: App;\n\taction: Actions | '';\n\tisAppPurchased?: boolean;\n\tonDismiss: () => void;\n\tonSuccess: (action: Actions | '', appPermissions?: App['permissions']) => void;\n\tsetIsPurchased: (purchased: boolean) => void;\n};\n\nexport function useAppInstallationHandler({\n\tapp,\n\taction,\n\tisAppPurchased,\n\tonDismiss,\n\tonSuccess,\n\tsetIsPurchased,\n}: AppInstallationHandlerParams) {\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst setModal = useSetModal();\n\n\tconst routeContext = String(useRouteParameter('context'));\n\tconst context = isMarketplaceRouteContext(routeContext) ? routeContext : 'explore';\n\n\tconst appCountQuery = useAppsCountQuery(context);\n\n\tconst notifyAdmins = useEndpoint('POST', `/apps/notify-admins`);\n\n\tconst openIncompatibleModal = useOpenIncompatibleModal();\n\n\tconst openExternalLink = useExternalLink();\n\tconst manageSubscriptionUrl = useCheckoutUrl()({ target: 'user-page', action: 'buy_more' });\n\n\tconst closeModal = useCallback(() => {\n\t\tsetModal(null);\n\t\tonDismiss();\n\t}, [onDismiss, setModal]);\n\n\tconst success = useCallback(\n\t\t(appPermissions?: App['permissions']) => {\n\t\t\tsetModal(null);\n\t\t\tonSuccess(action, appPermissions);\n\t\t},\n\t\t[action, onSuccess, setModal],\n\t);\n\n\tconst openPermissionModal = useOpenAppPermissionsReviewModal({ app, onCancel: closeModal, onConfirm: success });\n\n\tconst appsOrchestrator = useAppsOrchestration();\n\n\tif (!appsOrchestrator) {\n\t\tthrow new Error('Apps orchestrator is not available');\n\t}\n\n\tconst acquireApp = useCallback(async () => {\n\t\tif (action === 'purchase' && !isAppPurchased) {\n\t\t\ttry {\n\t\t\t\tconst data = await appsOrchestrator.buildExternalUrl(app.id, app.purchaseType, false);\n\t\t\t\tsetModal(\n\t\t\t\t\t<IframeModal\n\t\t\t\t\t\turl={data.url}\n\t\t\t\t\t\tcancel={onDismiss}\n\t\t\t\t\t\tconfirm={() => {\n\t\t\t\t\t\t\tsetIsPurchased(true);\n\t\t\t\t\t\t\topenPermissionModal();\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>,\n\t\t\t\t);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\topenPermissionModal();\n\t}, [action, isAppPurchased, openPermissionModal, appsOrchestrator, app.id, app.purchaseType, setModal, onDismiss, setIsPurchased]);\n\n\treturn useCallback(async () => {\n\t\tif (app?.versionIncompatible) {\n\t\t\topenIncompatibleModal(app, action, closeModal);\n\t\t\treturn;\n\t\t}\n\n\t\tif (action === 'request') {\n\t\t\tconst requestConfirmAction = (postMessage: Record<string, unknown>) => {\n\t\t\t\tsetModal(null);\n\t\t\t\tdispatchToastMessage({ type: 'success', message: 'App request submitted' });\n\n\t\t\t\tnotifyAdmins({\n\t\t\t\t\tappId: app.id,\n\t\t\t\t\tappName: app.name,\n\t\t\t\t\tappVersion: app.marketplaceVersion,\n\t\t\t\t\tmessage: typeof postMessage.message === 'string' ? postMessage.message : '',\n\t\t\t\t});\n\n\t\t\t\tsuccess();\n\t\t\t};\n\n\t\t\ttry {\n\t\t\t\tconst data = await appsOrchestrator.buildExternalAppRequest(app.id);\n\t\t\t\tsetModal(<IframeModal url={data.url} wrapperHeight='x460' cancel={onDismiss} confirm={requestConfirmAction} />);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!appCountQuery.data) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (appCountQuery.data.hasUnlimitedApps) {\n\t\t\treturn acquireApp();\n\t\t}\n\n\t\tsetModal(\n\t\t\t<AppInstallModal\n\t\t\t\tenabled={appCountQuery.data.enabled}\n\t\t\t\tlimit={appCountQuery.data.limit}\n\t\t\t\tappName={app.name}\n\t\t\t\thandleClose={closeModal}\n\t\t\t\thandleConfirm={acquireApp}\n\t\t\t\thandleEnableUnlimitedApps={() => {\n\t\t\t\t\topenExternalLink(manageSubscriptionUrl);\n\t\t\t\t\tsetModal(null);\n\t\t\t\t}}\n\t\t\t/>,\n\t\t);\n\t}, [\n\t\tapp,\n\t\taction,\n\t\tappCountQuery.data,\n\t\tsetModal,\n\t\tcloseModal,\n\t\tacquireApp,\n\t\topenIncompatibleModal,\n\t\tdispatchToastMessage,\n\t\tnotifyAdmins,\n\t\tsuccess,\n\t\tappsOrchestrator,\n\t\tonDismiss,\n\t\topenExternalLink,\n\t\tmanageSubscriptionUrl,\n\t]);\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/marketplace/hooks/useAppInstallationHandler.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/marketplace/hooks/useAppInstallationHandler.tsx","inputSourceMap":{"version":3,"file":"client/views/marketplace/hooks/useAppInstallationHandler.tsx","sourceRoot":"","sources":["client/views/marketplace/hooks/useAppInstallationHandler.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { App } from '@rocket.chat/core-typings';\nimport { useEndpoint, useRouteParameter, useSetModal, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport React, { useCallback } from 'react';\n\nimport { useExternalLink } from '../../../hooks/useExternalLink';\nimport { useCheckoutUrl } from '../../admin/subscription/hooks/useCheckoutUrl';\nimport IframeModal from '../IframeModal';\nimport AppInstallModal from '../components/AppInstallModal/AppInstallModal';\nimport type { Actions } from '../helpers';\nimport { handleAPIError } from '../helpers/handleAPIError';\nimport { isMarketplaceRouteContext, useAppsCountQuery } from './useAppsCountQuery';\nimport { useAppsOrchestration } from './useAppsOrchestration';\nimport { useOpenAppPermissionsReviewModal } from './useOpenAppPermissionsReviewModal';\nimport { useOpenIncompatibleModal } from './useOpenIncompatibleModal';\n\nexport type AppInstallationHandlerParams = {\n\tapp: App;\n\taction: Actions | '';\n\tisAppPurchased?: boolean;\n\tonDismiss: () => void;\n\tonSuccess: (action: Actions | '', appPermissions?: App['permissions']) => void;\n\tsetIsPurchased: (purchased: boolean) => void;\n};\n\nexport function useAppInstallationHandler({\n\tapp,\n\taction,\n\tisAppPurchased,\n\tonDismiss,\n\tonSuccess,\n\tsetIsPurchased,\n}: AppInstallationHandlerParams) {\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst setModal = useSetModal();\n\n\tconst routeContext = String(useRouteParameter('context'));\n\tconst context = isMarketplaceRouteContext(routeContext) ? routeContext : 'explore';\n\n\tconst appCountQuery = useAppsCountQuery(context);\n\n\tconst notifyAdmins = useEndpoint('POST', `/apps/notify-admins`);\n\n\tconst openIncompatibleModal = useOpenIncompatibleModal();\n\n\tconst openExternalLink = useExternalLink();\n\tconst manageSubscriptionUrl = useCheckoutUrl()({ target: 'user-page', action: 'buy_more' });\n\n\tconst closeModal = useCallback(() => {\n\t\tsetModal(null);\n\t\tonDismiss();\n\t}, [onDismiss, setModal]);\n\n\tconst success = useCallback(\n\t\t(appPermissions?: App['permissions']) => {\n\t\t\tsetModal(null);\n\t\t\tonSuccess(action, appPermissions);\n\t\t},\n\t\t[action, onSuccess, setModal],\n\t);\n\n\tconst openPermissionModal = useOpenAppPermissionsReviewModal({ app, onCancel: closeModal, onConfirm: success });\n\n\tconst appsOrchestrator = useAppsOrchestration();\n\n\tif (!appsOrchestrator) {\n\t\tthrow new Error('Apps orchestrator is not available');\n\t}\n\n\tconst acquireApp = useCallback(async () => {\n\t\tif (action === 'purchase' && !isAppPurchased) {\n\t\t\ttry {\n\t\t\t\tconst data = await appsOrchestrator.buildExternalUrl(app.id, app.purchaseType, false);\n\t\t\t\tsetModal(\n\t\t\t\t\t<IframeModal\n\t\t\t\t\t\turl={data.url}\n\t\t\t\t\t\tcancel={onDismiss}\n\t\t\t\t\t\tconfirm={() => {\n\t\t\t\t\t\t\tsetIsPurchased(true);\n\t\t\t\t\t\t\topenPermissionModal();\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>,\n\t\t\t\t);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\topenPermissionModal();\n\t}, [action, isAppPurchased, openPermissionModal, appsOrchestrator, app.id, app.purchaseType, setModal, onDismiss, setIsPurchased]);\n\n\treturn useCallback(async () => {\n\t\tif (app?.versionIncompatible) {\n\t\t\topenIncompatibleModal(app, action, closeModal);\n\t\t\treturn;\n\t\t}\n\n\t\tif (action === 'request') {\n\t\t\tconst requestConfirmAction = (postMessage: Record<string, unknown>) => {\n\t\t\t\tsetModal(null);\n\t\t\t\tdispatchToastMessage({ type: 'success', message: 'App request submitted' });\n\n\t\t\t\tnotifyAdmins({\n\t\t\t\t\tappId: app.id,\n\t\t\t\t\tappName: app.name,\n\t\t\t\t\tappVersion: app.marketplaceVersion,\n\t\t\t\t\tmessage: typeof postMessage.message === 'string' ? postMessage.message : '',\n\t\t\t\t});\n\n\t\t\t\tsuccess();\n\t\t\t};\n\n\t\t\ttry {\n\t\t\t\tconst data = await appsOrchestrator.buildExternalAppRequest(app.id);\n\t\t\t\tsetModal(<IframeModal url={data.url} wrapperHeight='x460' cancel={onDismiss} confirm={requestConfirmAction} />);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!appCountQuery.data) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (appCountQuery.data.hasUnlimitedApps) {\n\t\t\treturn acquireApp();\n\t\t}\n\n\t\tsetModal(\n\t\t\t<AppInstallModal\n\t\t\t\tenabled={appCountQuery.data.enabled}\n\t\t\t\tlimit={appCountQuery.data.limit}\n\t\t\t\tappName={app.name}\n\t\t\t\thandleClose={closeModal}\n\t\t\t\thandleConfirm={acquireApp}\n\t\t\t\thandleEnableUnlimitedApps={() => {\n\t\t\t\t\topenExternalLink(manageSubscriptionUrl);\n\t\t\t\t\tsetModal(null);\n\t\t\t\t}}\n\t\t\t/>,\n\t\t);\n\t}, [\n\t\tapp,\n\t\taction,\n\t\tappCountQuery.data,\n\t\tsetModal,\n\t\tcloseModal,\n\t\tacquireApp,\n\t\topenIncompatibleModal,\n\t\tdispatchToastMessage,\n\t\tnotifyAdmins,\n\t\tsuccess,\n\t\tappsOrchestrator,\n\t\tonDismiss,\n\t\topenExternalLink,\n\t\tmanageSubscriptionUrl,\n\t]);\n}\n"]}}},"code":"var _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nmodule.export({\n  useAppInstallationHandler: function () {\n    return useAppInstallationHandler;\n  }\n});\nvar useEndpoint, useRouteParameter, useSetModal, useToastMessageDispatch;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useEndpoint: function (v) {\n    useEndpoint = v;\n  },\n  useRouteParameter: function (v) {\n    useRouteParameter = v;\n  },\n  useSetModal: function (v) {\n    useSetModal = v;\n  },\n  useToastMessageDispatch: function (v) {\n    useToastMessageDispatch = v;\n  }\n}, 0);\nvar React, useCallback;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useCallback: function (v) {\n    useCallback = v;\n  }\n}, 1);\nvar useExternalLink;\nmodule.link(\"../../../hooks/useExternalLink\", {\n  useExternalLink: function (v) {\n    useExternalLink = v;\n  }\n}, 2);\nvar useCheckoutUrl;\nmodule.link(\"../../admin/subscription/hooks/useCheckoutUrl\", {\n  useCheckoutUrl: function (v) {\n    useCheckoutUrl = v;\n  }\n}, 3);\nvar IframeModal;\nmodule.link(\"../IframeModal\", {\n  \"default\": function (v) {\n    IframeModal = v;\n  }\n}, 4);\nvar AppInstallModal;\nmodule.link(\"../components/AppInstallModal/AppInstallModal\", {\n  \"default\": function (v) {\n    AppInstallModal = v;\n  }\n}, 5);\nvar handleAPIError;\nmodule.link(\"../helpers/handleAPIError\", {\n  handleAPIError: function (v) {\n    handleAPIError = v;\n  }\n}, 6);\nvar isMarketplaceRouteContext, useAppsCountQuery;\nmodule.link(\"./useAppsCountQuery\", {\n  isMarketplaceRouteContext: function (v) {\n    isMarketplaceRouteContext = v;\n  },\n  useAppsCountQuery: function (v) {\n    useAppsCountQuery = v;\n  }\n}, 7);\nvar useAppsOrchestration;\nmodule.link(\"./useAppsOrchestration\", {\n  useAppsOrchestration: function (v) {\n    useAppsOrchestration = v;\n  }\n}, 8);\nvar useOpenAppPermissionsReviewModal;\nmodule.link(\"./useOpenAppPermissionsReviewModal\", {\n  useOpenAppPermissionsReviewModal: function (v) {\n    useOpenAppPermissionsReviewModal = v;\n  }\n}, 9);\nvar useOpenIncompatibleModal;\nmodule.link(\"./useOpenIncompatibleModal\", {\n  useOpenIncompatibleModal: function (v) {\n    useOpenIncompatibleModal = v;\n  }\n}, 10);\nfunction useAppInstallationHandler(_ref) {\n  var app = _ref.app,\n    action = _ref.action,\n    isAppPurchased = _ref.isAppPurchased,\n    onDismiss = _ref.onDismiss,\n    onSuccess = _ref.onSuccess,\n    setIsPurchased = _ref.setIsPurchased;\n  var dispatchToastMessage = useToastMessageDispatch();\n  var setModal = useSetModal();\n  var routeContext = String(useRouteParameter('context'));\n  var context = isMarketplaceRouteContext(routeContext) ? routeContext : 'explore';\n  var appCountQuery = useAppsCountQuery(context);\n  var notifyAdmins = useEndpoint('POST', \"/apps/notify-admins\");\n  var openIncompatibleModal = useOpenIncompatibleModal();\n  var openExternalLink = useExternalLink();\n  var manageSubscriptionUrl = useCheckoutUrl()({\n    target: 'user-page',\n    action: 'buy_more'\n  });\n  var closeModal = useCallback(function () {\n    setModal(null);\n    onDismiss();\n  }, [onDismiss, setModal]);\n  var success = useCallback(function (appPermissions) {\n    setModal(null);\n    onSuccess(action, appPermissions);\n  }, [action, onSuccess, setModal]);\n  var openPermissionModal = useOpenAppPermissionsReviewModal({\n    app: app,\n    onCancel: closeModal,\n    onConfirm: success\n  });\n  var appsOrchestrator = useAppsOrchestration();\n  if (!appsOrchestrator) {\n    throw new Error('Apps orchestrator is not available');\n  }\n  var acquireApp = useCallback(function () {\n    function _callee() {\n      var data;\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (!(action === 'purchase' && !isAppPurchased)) {\n                _context.next = 12;\n                break;\n              }\n              _context.prev = 1;\n              _context.next = 4;\n              return _regeneratorRuntime.awrap(appsOrchestrator.buildExternalUrl(app.id, app.purchaseType, false));\n            case 4:\n              data = _context.sent;\n              setModal( /*#__PURE__*/React.createElement(IframeModal, {\n                url: data.url,\n                cancel: onDismiss,\n                confirm: function () {\n                  setIsPurchased(true);\n                  openPermissionModal();\n                }\n              }));\n              _context.next = 11;\n              break;\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context[\"catch\"](1);\n              handleAPIError(_context.t0);\n            case 11:\n              return _context.abrupt(\"return\");\n            case 12:\n              openPermissionModal();\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n        return _callee$;\n      }(), null, null, [[1, 8]], Promise);\n    }\n    return _callee;\n  }(), [action, isAppPurchased, openPermissionModal, appsOrchestrator, app.id, app.purchaseType, setModal, onDismiss, setIsPurchased]);\n  return useCallback(function () {\n    function _callee2() {\n      var requestConfirmAction, data;\n      return _regeneratorRuntime.async(function () {\n        function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(app !== null && app !== void 0 && app.versionIncompatible)) {\n                _context2.next = 3;\n                break;\n              }\n              openIncompatibleModal(app, action, closeModal);\n              return _context2.abrupt(\"return\");\n            case 3:\n              if (!(action === 'request')) {\n                _context2.next = 16;\n                break;\n              }\n              requestConfirmAction = function (postMessage) {\n                setModal(null);\n                dispatchToastMessage({\n                  type: 'success',\n                  message: 'App request submitted'\n                });\n                notifyAdmins({\n                  appId: app.id,\n                  appName: app.name,\n                  appVersion: app.marketplaceVersion,\n                  message: typeof postMessage.message === 'string' ? postMessage.message : ''\n                });\n                success();\n              };\n              _context2.prev = 5;\n              _context2.next = 8;\n              return _regeneratorRuntime.awrap(appsOrchestrator.buildExternalAppRequest(app.id));\n            case 8:\n              data = _context2.sent;\n              setModal( /*#__PURE__*/React.createElement(IframeModal, {\n                url: data.url,\n                wrapperHeight: \"x460\",\n                cancel: onDismiss,\n                confirm: requestConfirmAction\n              }));\n              _context2.next = 15;\n              break;\n            case 12:\n              _context2.prev = 12;\n              _context2.t0 = _context2[\"catch\"](5);\n              handleAPIError(_context2.t0);\n            case 15:\n              return _context2.abrupt(\"return\");\n            case 16:\n              if (appCountQuery.data) {\n                _context2.next = 18;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 18:\n              if (!appCountQuery.data.hasUnlimitedApps) {\n                _context2.next = 20;\n                break;\n              }\n              return _context2.abrupt(\"return\", acquireApp());\n            case 20:\n              setModal( /*#__PURE__*/React.createElement(AppInstallModal, {\n                enabled: appCountQuery.data.enabled,\n                limit: appCountQuery.data.limit,\n                appName: app.name,\n                handleClose: closeModal,\n                handleConfirm: acquireApp,\n                handleEnableUnlimitedApps: function () {\n                  openExternalLink(manageSubscriptionUrl);\n                  setModal(null);\n                }\n              }));\n            case 21:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n        return _callee2$;\n      }(), null, null, [[5, 12]], Promise);\n    }\n    return _callee2;\n  }(), [app, action, appCountQuery.data, setModal, closeModal, acquireApp, openIncompatibleModal, dispatchToastMessage, notifyAdmins, success, appsOrchestrator, onDismiss, openExternalLink, manageSubscriptionUrl]);\n}","map":{"version":3,"names":["_regeneratorRuntime","module","link","default","v","export","useAppInstallationHandler","useEndpoint","useRouteParameter","useSetModal","useToastMessageDispatch","React","useCallback","useExternalLink","useCheckoutUrl","IframeModal","AppInstallModal","handleAPIError","isMarketplaceRouteContext","useAppsCountQuery","useAppsOrchestration","useOpenAppPermissionsReviewModal","useOpenIncompatibleModal","_ref","app","action","isAppPurchased","onDismiss","onSuccess","setIsPurchased","dispatchToastMessage","setModal","routeContext","String","context","appCountQuery","notifyAdmins","openIncompatibleModal","openExternalLink","manageSubscriptionUrl","target","closeModal","success","appPermissions","openPermissionModal","onCancel","onConfirm","appsOrchestrator","Error","acquireApp","_callee","data","async","_callee$","_context","prev","next","awrap","buildExternalUrl","id","purchaseType","sent","createElement","url","cancel","confirm","t0","abrupt","stop","Promise","_callee2","requestConfirmAction","_callee2$","_context2","versionIncompatible","postMessage","type","message","appId","appName","name","appVersion","marketplaceVersion","buildExternalAppRequest","wrapperHeight","hasUnlimitedApps","enabled","limit","handleClose","handleConfirm","handleEnableUnlimitedApps"],"sources":["client/views/marketplace/hooks/useAppInstallationHandler.tsx"],"sourcesContent":["import type { App } from '@rocket.chat/core-typings';\nimport { useEndpoint, useRouteParameter, useSetModal, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport React, { useCallback } from 'react';\n\nimport { useExternalLink } from '../../../hooks/useExternalLink';\nimport { useCheckoutUrl } from '../../admin/subscription/hooks/useCheckoutUrl';\nimport IframeModal from '../IframeModal';\nimport AppInstallModal from '../components/AppInstallModal/AppInstallModal';\nimport type { Actions } from '../helpers';\nimport { handleAPIError } from '../helpers/handleAPIError';\nimport { isMarketplaceRouteContext, useAppsCountQuery } from './useAppsCountQuery';\nimport { useAppsOrchestration } from './useAppsOrchestration';\nimport { useOpenAppPermissionsReviewModal } from './useOpenAppPermissionsReviewModal';\nimport { useOpenIncompatibleModal } from './useOpenIncompatibleModal';\n\nexport type AppInstallationHandlerParams = {\n\tapp: App;\n\taction: Actions | '';\n\tisAppPurchased?: boolean;\n\tonDismiss: () => void;\n\tonSuccess: (action: Actions | '', appPermissions?: App['permissions']) => void;\n\tsetIsPurchased: (purchased: boolean) => void;\n};\n\nexport function useAppInstallationHandler({\n\tapp,\n\taction,\n\tisAppPurchased,\n\tonDismiss,\n\tonSuccess,\n\tsetIsPurchased,\n}: AppInstallationHandlerParams) {\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst setModal = useSetModal();\n\n\tconst routeContext = String(useRouteParameter('context'));\n\tconst context = isMarketplaceRouteContext(routeContext) ? routeContext : 'explore';\n\n\tconst appCountQuery = useAppsCountQuery(context);\n\n\tconst notifyAdmins = useEndpoint('POST', `/apps/notify-admins`);\n\n\tconst openIncompatibleModal = useOpenIncompatibleModal();\n\n\tconst openExternalLink = useExternalLink();\n\tconst manageSubscriptionUrl = useCheckoutUrl()({ target: 'user-page', action: 'buy_more' });\n\n\tconst closeModal = useCallback(() => {\n\t\tsetModal(null);\n\t\tonDismiss();\n\t}, [onDismiss, setModal]);\n\n\tconst success = useCallback(\n\t\t(appPermissions?: App['permissions']) => {\n\t\t\tsetModal(null);\n\t\t\tonSuccess(action, appPermissions);\n\t\t},\n\t\t[action, onSuccess, setModal],\n\t);\n\n\tconst openPermissionModal = useOpenAppPermissionsReviewModal({ app, onCancel: closeModal, onConfirm: success });\n\n\tconst appsOrchestrator = useAppsOrchestration();\n\n\tif (!appsOrchestrator) {\n\t\tthrow new Error('Apps orchestrator is not available');\n\t}\n\n\tconst acquireApp = useCallback(async () => {\n\t\tif (action === 'purchase' && !isAppPurchased) {\n\t\t\ttry {\n\t\t\t\tconst data = await appsOrchestrator.buildExternalUrl(app.id, app.purchaseType, false);\n\t\t\t\tsetModal(\n\t\t\t\t\t<IframeModal\n\t\t\t\t\t\turl={data.url}\n\t\t\t\t\t\tcancel={onDismiss}\n\t\t\t\t\t\tconfirm={() => {\n\t\t\t\t\t\t\tsetIsPurchased(true);\n\t\t\t\t\t\t\topenPermissionModal();\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>,\n\t\t\t\t);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\topenPermissionModal();\n\t}, [action, isAppPurchased, openPermissionModal, appsOrchestrator, app.id, app.purchaseType, setModal, onDismiss, setIsPurchased]);\n\n\treturn useCallback(async () => {\n\t\tif (app?.versionIncompatible) {\n\t\t\topenIncompatibleModal(app, action, closeModal);\n\t\t\treturn;\n\t\t}\n\n\t\tif (action === 'request') {\n\t\t\tconst requestConfirmAction = (postMessage: Record<string, unknown>) => {\n\t\t\t\tsetModal(null);\n\t\t\t\tdispatchToastMessage({ type: 'success', message: 'App request submitted' });\n\n\t\t\t\tnotifyAdmins({\n\t\t\t\t\tappId: app.id,\n\t\t\t\t\tappName: app.name,\n\t\t\t\t\tappVersion: app.marketplaceVersion,\n\t\t\t\t\tmessage: typeof postMessage.message === 'string' ? postMessage.message : '',\n\t\t\t\t});\n\n\t\t\t\tsuccess();\n\t\t\t};\n\n\t\t\ttry {\n\t\t\t\tconst data = await appsOrchestrator.buildExternalAppRequest(app.id);\n\t\t\t\tsetModal(<IframeModal url={data.url} wrapperHeight='x460' cancel={onDismiss} confirm={requestConfirmAction} />);\n\t\t\t} catch (error) {\n\t\t\t\thandleAPIError(error);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!appCountQuery.data) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (appCountQuery.data.hasUnlimitedApps) {\n\t\t\treturn acquireApp();\n\t\t}\n\n\t\tsetModal(\n\t\t\t<AppInstallModal\n\t\t\t\tenabled={appCountQuery.data.enabled}\n\t\t\t\tlimit={appCountQuery.data.limit}\n\t\t\t\tappName={app.name}\n\t\t\t\thandleClose={closeModal}\n\t\t\t\thandleConfirm={acquireApp}\n\t\t\t\thandleEnableUnlimitedApps={() => {\n\t\t\t\t\topenExternalLink(manageSubscriptionUrl);\n\t\t\t\t\tsetModal(null);\n\t\t\t\t}}\n\t\t\t/>,\n\t\t);\n\t}, [\n\t\tapp,\n\t\taction,\n\t\tappCountQuery.data,\n\t\tsetModal,\n\t\tcloseModal,\n\t\tacquireApp,\n\t\topenIncompatibleModal,\n\t\tdispatchToastMessage,\n\t\tnotifyAdmins,\n\t\tsuccess,\n\t\tappsOrchestrator,\n\t\tonDismiss,\n\t\topenExternalLink,\n\t\tmanageSubscriptionUrl,\n\t]);\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"44050323c28fd1fb89d8933f6454ed7589a32d90"}
