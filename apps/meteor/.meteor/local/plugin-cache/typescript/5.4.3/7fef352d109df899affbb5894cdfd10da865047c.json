{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/minimongo/bson.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/lib/minimongo/bson.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/minimongo/bson.ts","inputSourceMap":{"version":3,"file":"client/lib/minimongo/bson.ts","sourceRoot":"","sources":["client/lib/minimongo/bson.ts"],"names":[],"mappings":"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","sourcesContent":["import { BSONType } from './types';\n\nexport const getBSONType = <T>(v: T): BSONType => {\n\tif (typeof v === 'number') {\n\t\treturn BSONType.Double;\n\t}\n\n\tif (typeof v === 'string') {\n\t\treturn BSONType.String;\n\t}\n\n\tif (typeof v === 'boolean') {\n\t\treturn BSONType.Boolean;\n\t}\n\n\tif (Array.isArray(v)) {\n\t\treturn BSONType.Array;\n\t}\n\n\tif (v === null) {\n\t\treturn BSONType.Null;\n\t}\n\n\tif (v instanceof RegExp) {\n\t\treturn BSONType.Regex;\n\t}\n\n\tif (typeof v === 'function') {\n\t\treturn BSONType.JavaScript;\n\t}\n\n\tif (v instanceof Date) {\n\t\treturn BSONType.Date;\n\t}\n\n\tif (v instanceof Uint8Array) {\n\t\treturn BSONType.BinData;\n\t}\n\n\treturn BSONType.Object;\n};\n\nconst getBSONTypeOrder = (type: BSONType): number => {\n\tswitch (type) {\n\t\tcase BSONType.Null:\n\t\t\treturn 0;\n\n\t\tcase BSONType.Double:\n\t\tcase BSONType.Int:\n\t\tcase BSONType.Long:\n\t\t\treturn 1;\n\n\t\tcase BSONType.String:\n\t\tcase BSONType.Symbol:\n\t\t\treturn 2;\n\n\t\tcase BSONType.Object:\n\t\t\treturn 3;\n\n\t\tcase BSONType.Array:\n\t\t\treturn 4;\n\n\t\tcase BSONType.BinData:\n\t\t\treturn 5;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn 6;\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn 7;\n\n\t\tcase BSONType.Date:\n\t\tcase BSONType.Timestamp:\n\t\t\treturn 8;\n\n\t\tcase BSONType.Regex:\n\t\t\treturn 9;\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\treturn 100;\n\n\t\tdefault:\n\t\t\treturn -1;\n\t}\n};\n\ntype ObjectID = {\n\ttoHexString(): string;\n\tequals(otherID: ObjectID): boolean;\n};\n\nexport const compareBSONValues = (a: unknown, b: unknown): number => {\n\tif (a === undefined) {\n\t\treturn b === undefined ? 0 : -1;\n\t}\n\n\tif (b === undefined) {\n\t\treturn 1;\n\t}\n\n\tconst ta = getBSONType(a);\n\tconst oa = getBSONTypeOrder(ta);\n\n\tconst tb = getBSONType(b);\n\tconst ob = getBSONTypeOrder(tb);\n\n\tif (oa !== ob) {\n\t\treturn oa < ob ? -1 : 1;\n\t}\n\n\tif (ta !== tb) {\n\t\tthrow Error('Missing type coercion logic in compareBSONValues');\n\t}\n\n\tswitch (ta) {\n\t\tcase BSONType.Double:\n\t\t\treturn (a as number) - (b as number);\n\n\t\tcase BSONType.String:\n\t\t\treturn (a as string).localeCompare(b as string);\n\n\t\tcase BSONType.Object:\n\t\t\treturn compareBSONValues(\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(a as Record<string, unknown>)),\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(b as Record<string, unknown>)),\n\t\t\t);\n\n\t\tcase BSONType.Array: {\n\t\t\tfor (let i = 0; ; i++) {\n\t\t\t\tif (i === (a as unknown[]).length) {\n\t\t\t\t\treturn i === (b as unknown[]).length ? 0 : -1;\n\t\t\t\t}\n\n\t\t\t\tif (i === (b as unknown[]).length) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tconst s = compareBSONValues((a as unknown[])[i], (b as unknown[])[i]);\n\t\t\t\tif (s !== 0) {\n\t\t\t\t\treturn s;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tcase BSONType.BinData: {\n\t\t\tif ((a as Uint8Array).length !== (b as Uint8Array).length) {\n\t\t\t\treturn (a as Uint8Array).length - (b as Uint8Array).length;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < (a as Uint8Array).length; i++) {\n\t\t\t\tif ((a as Uint8Array)[i] === (b as Uint8Array)[i]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\treturn (a as Uint8Array)[i] < (b as Uint8Array)[i] ? -1 : 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t}\n\n\t\tcase BSONType.Null:\n\t\tcase BSONType.Undefined:\n\t\t\treturn 0;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn (a as ObjectID).toHexString().localeCompare((b as ObjectID).toHexString());\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn Number(a) - Number(b);\n\n\t\tcase BSONType.Date:\n\t\t\treturn (a as Date).getTime() - (b as Date).getTime();\n\n\t\tcase BSONType.Regex:\n\t\t\tthrow Error('Sorting not supported on regular expression');\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\tthrow Error('Sorting not supported on Javascript code');\n\t}\n\n\tthrow Error('Unknown type to sort');\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/minimongo/bson.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/lib/minimongo/bson.ts","inputSourceMap":{"version":3,"file":"client/lib/minimongo/bson.ts","sourceRoot":"","sources":["client/lib/minimongo/bson.ts"],"names":[],"mappings":"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","sourcesContent":["import { BSONType } from './types';\n\nexport const getBSONType = <T>(v: T): BSONType => {\n\tif (typeof v === 'number') {\n\t\treturn BSONType.Double;\n\t}\n\n\tif (typeof v === 'string') {\n\t\treturn BSONType.String;\n\t}\n\n\tif (typeof v === 'boolean') {\n\t\treturn BSONType.Boolean;\n\t}\n\n\tif (Array.isArray(v)) {\n\t\treturn BSONType.Array;\n\t}\n\n\tif (v === null) {\n\t\treturn BSONType.Null;\n\t}\n\n\tif (v instanceof RegExp) {\n\t\treturn BSONType.Regex;\n\t}\n\n\tif (typeof v === 'function') {\n\t\treturn BSONType.JavaScript;\n\t}\n\n\tif (v instanceof Date) {\n\t\treturn BSONType.Date;\n\t}\n\n\tif (v instanceof Uint8Array) {\n\t\treturn BSONType.BinData;\n\t}\n\n\treturn BSONType.Object;\n};\n\nconst getBSONTypeOrder = (type: BSONType): number => {\n\tswitch (type) {\n\t\tcase BSONType.Null:\n\t\t\treturn 0;\n\n\t\tcase BSONType.Double:\n\t\tcase BSONType.Int:\n\t\tcase BSONType.Long:\n\t\t\treturn 1;\n\n\t\tcase BSONType.String:\n\t\tcase BSONType.Symbol:\n\t\t\treturn 2;\n\n\t\tcase BSONType.Object:\n\t\t\treturn 3;\n\n\t\tcase BSONType.Array:\n\t\t\treturn 4;\n\n\t\tcase BSONType.BinData:\n\t\t\treturn 5;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn 6;\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn 7;\n\n\t\tcase BSONType.Date:\n\t\tcase BSONType.Timestamp:\n\t\t\treturn 8;\n\n\t\tcase BSONType.Regex:\n\t\t\treturn 9;\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\treturn 100;\n\n\t\tdefault:\n\t\t\treturn -1;\n\t}\n};\n\ntype ObjectID = {\n\ttoHexString(): string;\n\tequals(otherID: ObjectID): boolean;\n};\n\nexport const compareBSONValues = (a: unknown, b: unknown): number => {\n\tif (a === undefined) {\n\t\treturn b === undefined ? 0 : -1;\n\t}\n\n\tif (b === undefined) {\n\t\treturn 1;\n\t}\n\n\tconst ta = getBSONType(a);\n\tconst oa = getBSONTypeOrder(ta);\n\n\tconst tb = getBSONType(b);\n\tconst ob = getBSONTypeOrder(tb);\n\n\tif (oa !== ob) {\n\t\treturn oa < ob ? -1 : 1;\n\t}\n\n\tif (ta !== tb) {\n\t\tthrow Error('Missing type coercion logic in compareBSONValues');\n\t}\n\n\tswitch (ta) {\n\t\tcase BSONType.Double:\n\t\t\treturn (a as number) - (b as number);\n\n\t\tcase BSONType.String:\n\t\t\treturn (a as string).localeCompare(b as string);\n\n\t\tcase BSONType.Object:\n\t\t\treturn compareBSONValues(\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(a as Record<string, unknown>)),\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(b as Record<string, unknown>)),\n\t\t\t);\n\n\t\tcase BSONType.Array: {\n\t\t\tfor (let i = 0; ; i++) {\n\t\t\t\tif (i === (a as unknown[]).length) {\n\t\t\t\t\treturn i === (b as unknown[]).length ? 0 : -1;\n\t\t\t\t}\n\n\t\t\t\tif (i === (b as unknown[]).length) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tconst s = compareBSONValues((a as unknown[])[i], (b as unknown[])[i]);\n\t\t\t\tif (s !== 0) {\n\t\t\t\t\treturn s;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tcase BSONType.BinData: {\n\t\t\tif ((a as Uint8Array).length !== (b as Uint8Array).length) {\n\t\t\t\treturn (a as Uint8Array).length - (b as Uint8Array).length;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < (a as Uint8Array).length; i++) {\n\t\t\t\tif ((a as Uint8Array)[i] === (b as Uint8Array)[i]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\treturn (a as Uint8Array)[i] < (b as Uint8Array)[i] ? -1 : 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t}\n\n\t\tcase BSONType.Null:\n\t\tcase BSONType.Undefined:\n\t\t\treturn 0;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn (a as ObjectID).toHexString().localeCompare((b as ObjectID).toHexString());\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn Number(a) - Number(b);\n\n\t\tcase BSONType.Date:\n\t\t\treturn (a as Date).getTime() - (b as Date).getTime();\n\n\t\tcase BSONType.Regex:\n\t\t\tthrow Error('Sorting not supported on regular expression');\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\tthrow Error('Sorting not supported on Javascript code');\n\t}\n\n\tthrow Error('Unknown type to sort');\n};\n"]}}},"code":"var _toConsumableArray;\nmodule.link(\"@babel/runtime/helpers/toConsumableArray\", {\n  default: function (v) {\n    _toConsumableArray = v;\n  }\n}, 0);\nmodule.export({\n  getBSONType: function () {\n    return getBSONType;\n  },\n  compareBSONValues: function () {\n    return compareBSONValues;\n  }\n});\nvar BSONType;\nmodule.link(\"./types\", {\n  BSONType: function (v) {\n    BSONType = v;\n  }\n}, 0);\nvar getBSONType = function (v) {\n  if (typeof v === 'number') {\n    return BSONType.Double;\n  }\n  if (typeof v === 'string') {\n    return BSONType.String;\n  }\n  if (typeof v === 'boolean') {\n    return BSONType.Boolean;\n  }\n  if (Array.isArray(v)) {\n    return BSONType.Array;\n  }\n  if (v === null) {\n    return BSONType.Null;\n  }\n  if (v instanceof RegExp) {\n    return BSONType.Regex;\n  }\n  if (typeof v === 'function') {\n    return BSONType.JavaScript;\n  }\n  if (v instanceof Date) {\n    return BSONType.Date;\n  }\n  if (v instanceof Uint8Array) {\n    return BSONType.BinData;\n  }\n  return BSONType.Object;\n};\nvar getBSONTypeOrder = function (type) {\n  switch (type) {\n    case BSONType.Null:\n      return 0;\n    case BSONType.Double:\n    case BSONType.Int:\n    case BSONType.Long:\n      return 1;\n    case BSONType.String:\n    case BSONType.Symbol:\n      return 2;\n    case BSONType.Object:\n      return 3;\n    case BSONType.Array:\n      return 4;\n    case BSONType.BinData:\n      return 5;\n    case BSONType.ObjectId:\n      return 6;\n    case BSONType.Boolean:\n      return 7;\n    case BSONType.Date:\n    case BSONType.Timestamp:\n      return 8;\n    case BSONType.Regex:\n      return 9;\n    case BSONType.JavaScript:\n    case BSONType.JavaScriptWithScope:\n      return 100;\n    default:\n      return -1;\n  }\n};\nvar compareBSONValues = function (a, b) {\n  var _Array$prototype$conc, _Array$prototype$conc2;\n  if (a === undefined) {\n    return b === undefined ? 0 : -1;\n  }\n  if (b === undefined) {\n    return 1;\n  }\n  var ta = getBSONType(a);\n  var oa = getBSONTypeOrder(ta);\n  var tb = getBSONType(b);\n  var ob = getBSONTypeOrder(tb);\n  if (oa !== ob) {\n    return oa < ob ? -1 : 1;\n  }\n  if (ta !== tb) {\n    throw Error('Missing type coercion logic in compareBSONValues');\n  }\n  switch (ta) {\n    case BSONType.Double:\n      return a - b;\n    case BSONType.String:\n      return a.localeCompare(b);\n    case BSONType.Object:\n      return compareBSONValues((_Array$prototype$conc = Array.prototype.concat).call.apply(_Array$prototype$conc, [[]].concat(_toConsumableArray(Object.entries(a)))), (_Array$prototype$conc2 = Array.prototype.concat).call.apply(_Array$prototype$conc2, [[]].concat(_toConsumableArray(Object.entries(b)))));\n    case BSONType.Array:\n      {\n        for (var i = 0;; i++) {\n          if (i === a.length) {\n            return i === b.length ? 0 : -1;\n          }\n          if (i === b.length) {\n            return 1;\n          }\n          var s = compareBSONValues(a[i], b[i]);\n          if (s !== 0) {\n            return s;\n          }\n        }\n      }\n    case BSONType.BinData:\n      {\n        if (a.length !== b.length) {\n          return a.length - b.length;\n        }\n        for (var _i = 0; _i < a.length; _i++) {\n          if (a[_i] === b[_i]) {\n            continue;\n          }\n          return a[_i] < b[_i] ? -1 : 1;\n        }\n        return 0;\n      }\n    case BSONType.Null:\n    case BSONType.Undefined:\n      return 0;\n    case BSONType.ObjectId:\n      return a.toHexString().localeCompare(b.toHexString());\n    case BSONType.Boolean:\n      return Number(a) - Number(b);\n    case BSONType.Date:\n      return a.getTime() - b.getTime();\n    case BSONType.Regex:\n      throw Error('Sorting not supported on regular expression');\n    case BSONType.JavaScript:\n    case BSONType.JavaScriptWithScope:\n      throw Error('Sorting not supported on Javascript code');\n  }\n  throw Error('Unknown type to sort');\n};","map":{"version":3,"names":["_toConsumableArray","module","link","default","v","export","getBSONType","compareBSONValues","BSONType","Double","String","Boolean","Array","isArray","Null","RegExp","Regex","JavaScript","Date","Uint8Array","BinData","Object","getBSONTypeOrder","type","Int","Long","Symbol","ObjectId","Timestamp","JavaScriptWithScope","a","b","_Array$prototype$conc","_Array$prototype$conc2","undefined","ta","oa","tb","ob","Error","localeCompare","prototype","concat","call","apply","entries","i","length","s","Undefined","toHexString","Number","getTime"],"sources":["client/lib/minimongo/bson.ts"],"sourcesContent":["import { BSONType } from './types';\n\nexport const getBSONType = <T>(v: T): BSONType => {\n\tif (typeof v === 'number') {\n\t\treturn BSONType.Double;\n\t}\n\n\tif (typeof v === 'string') {\n\t\treturn BSONType.String;\n\t}\n\n\tif (typeof v === 'boolean') {\n\t\treturn BSONType.Boolean;\n\t}\n\n\tif (Array.isArray(v)) {\n\t\treturn BSONType.Array;\n\t}\n\n\tif (v === null) {\n\t\treturn BSONType.Null;\n\t}\n\n\tif (v instanceof RegExp) {\n\t\treturn BSONType.Regex;\n\t}\n\n\tif (typeof v === 'function') {\n\t\treturn BSONType.JavaScript;\n\t}\n\n\tif (v instanceof Date) {\n\t\treturn BSONType.Date;\n\t}\n\n\tif (v instanceof Uint8Array) {\n\t\treturn BSONType.BinData;\n\t}\n\n\treturn BSONType.Object;\n};\n\nconst getBSONTypeOrder = (type: BSONType): number => {\n\tswitch (type) {\n\t\tcase BSONType.Null:\n\t\t\treturn 0;\n\n\t\tcase BSONType.Double:\n\t\tcase BSONType.Int:\n\t\tcase BSONType.Long:\n\t\t\treturn 1;\n\n\t\tcase BSONType.String:\n\t\tcase BSONType.Symbol:\n\t\t\treturn 2;\n\n\t\tcase BSONType.Object:\n\t\t\treturn 3;\n\n\t\tcase BSONType.Array:\n\t\t\treturn 4;\n\n\t\tcase BSONType.BinData:\n\t\t\treturn 5;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn 6;\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn 7;\n\n\t\tcase BSONType.Date:\n\t\tcase BSONType.Timestamp:\n\t\t\treturn 8;\n\n\t\tcase BSONType.Regex:\n\t\t\treturn 9;\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\treturn 100;\n\n\t\tdefault:\n\t\t\treturn -1;\n\t}\n};\n\ntype ObjectID = {\n\ttoHexString(): string;\n\tequals(otherID: ObjectID): boolean;\n};\n\nexport const compareBSONValues = (a: unknown, b: unknown): number => {\n\tif (a === undefined) {\n\t\treturn b === undefined ? 0 : -1;\n\t}\n\n\tif (b === undefined) {\n\t\treturn 1;\n\t}\n\n\tconst ta = getBSONType(a);\n\tconst oa = getBSONTypeOrder(ta);\n\n\tconst tb = getBSONType(b);\n\tconst ob = getBSONTypeOrder(tb);\n\n\tif (oa !== ob) {\n\t\treturn oa < ob ? -1 : 1;\n\t}\n\n\tif (ta !== tb) {\n\t\tthrow Error('Missing type coercion logic in compareBSONValues');\n\t}\n\n\tswitch (ta) {\n\t\tcase BSONType.Double:\n\t\t\treturn (a as number) - (b as number);\n\n\t\tcase BSONType.String:\n\t\t\treturn (a as string).localeCompare(b as string);\n\n\t\tcase BSONType.Object:\n\t\t\treturn compareBSONValues(\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(a as Record<string, unknown>)),\n\t\t\t\tArray.prototype.concat.call([], ...Object.entries(b as Record<string, unknown>)),\n\t\t\t);\n\n\t\tcase BSONType.Array: {\n\t\t\tfor (let i = 0; ; i++) {\n\t\t\t\tif (i === (a as unknown[]).length) {\n\t\t\t\t\treturn i === (b as unknown[]).length ? 0 : -1;\n\t\t\t\t}\n\n\t\t\t\tif (i === (b as unknown[]).length) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tconst s = compareBSONValues((a as unknown[])[i], (b as unknown[])[i]);\n\t\t\t\tif (s !== 0) {\n\t\t\t\t\treturn s;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tcase BSONType.BinData: {\n\t\t\tif ((a as Uint8Array).length !== (b as Uint8Array).length) {\n\t\t\t\treturn (a as Uint8Array).length - (b as Uint8Array).length;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < (a as Uint8Array).length; i++) {\n\t\t\t\tif ((a as Uint8Array)[i] === (b as Uint8Array)[i]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\treturn (a as Uint8Array)[i] < (b as Uint8Array)[i] ? -1 : 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t}\n\n\t\tcase BSONType.Null:\n\t\tcase BSONType.Undefined:\n\t\t\treturn 0;\n\n\t\tcase BSONType.ObjectId:\n\t\t\treturn (a as ObjectID).toHexString().localeCompare((b as ObjectID).toHexString());\n\n\t\tcase BSONType.Boolean:\n\t\t\treturn Number(a) - Number(b);\n\n\t\tcase BSONType.Date:\n\t\t\treturn (a as Date).getTime() - (b as Date).getTime();\n\n\t\tcase BSONType.Regex:\n\t\t\tthrow Error('Sorting not supported on regular expression');\n\n\t\tcase BSONType.JavaScript:\n\t\tcase BSONType.JavaScriptWithScope:\n\t\t\tthrow Error('Sorting not supported on Javascript code');\n\t}\n\n\tthrow Error('Unknown type to sort');\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"7fef352d109df899affbb5894cdfd10da865047c"}
