{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/chats/flows/processSlashCommand.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/lib/chats/flows/processSlashCommand.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/chats/flows/processSlashCommand.ts","inputSourceMap":{"version":3,"file":"client/lib/chats/flows/processSlashCommand.ts","sourceRoot":"","sources":["client/lib/chats/flows/processSlashCommand.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage, SlashCommand } from '@rocket.chat/core-typings';\nimport { Random } from '@rocket.chat/random';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\n\nimport { hasAtLeastOnePermission } from '../../../../app/authorization/client';\nimport { settings } from '../../../../app/settings/client';\nimport { slashCommands } from '../../../../app/utils/client';\nimport { sdk } from '../../../../app/utils/client/lib/SDKClient';\nimport { t } from '../../../../app/utils/lib/i18n';\nimport type { ChatAPI } from '../ChatAPI';\n\nconst parse = (msg: string): { command: string; params: string } | { command: SlashCommand; params: string } | undefined => {\n\tconst match = msg.match(/^\\/([^\\s]+)(.*)/);\n\n\tif (!match) {\n\t\treturn undefined;\n\t}\n\n\tconst [, cmd, params] = match;\n\tconst command = slashCommands.commands[cmd];\n\n\tif (!command) {\n\t\treturn { command: cmd, params };\n\t}\n\n\treturn { command, params };\n};\n\nconst warnUnrecognizedSlashCommand = async (chat: ChatAPI, message: string): Promise<void> => {\n\tconsole.error(message);\n\n\tawait chat.data.pushEphemeralMessage({\n\t\t_id: Random.id(),\n\t\tts: new Date(),\n\t\tmsg: message,\n\t\tu: {\n\t\t\t_id: 'rocket.cat',\n\t\t\tusername: 'rocket.cat',\n\t\t\tname: 'Rocket.Cat',\n\t\t},\n\t\tprivate: true,\n\t\t_updatedAt: new Date(),\n\t});\n};\n\nexport const processSlashCommand = async (chat: ChatAPI, message: IMessage): Promise<boolean> => {\n\tconst match = parse(message.msg);\n\n\tif (!match) {\n\t\treturn false;\n\t}\n\n\tconst { command, params } = match;\n\n\tif (typeof command === 'string') {\n\t\tif (!settings.get('Message_AllowUnrecognizedSlashCommand')) {\n\t\t\tawait warnUnrecognizedSlashCommand(chat, t('No_such_command', { command: escapeHTML(command) }));\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tconst { permission, clientOnly, callback: handleOnClient, result: handleResult, appId, command: commandName } = command;\n\n\tif (permission && !hasAtLeastOnePermission(permission, message.rid)) {\n\t\tawait warnUnrecognizedSlashCommand(chat, t('You_do_not_have_permission_to_execute_this_command', { command: escapeHTML(commandName) }));\n\t\treturn true;\n\t}\n\n\tif (clientOnly && chat.uid) {\n\t\thandleOnClient?.({ command: commandName, message, params, userId: chat.uid });\n\t\treturn true;\n\t}\n\n\tawait sdk.rest.post('/v1/statistics.telemetry', {\n\t\tparams: [{ eventName: 'slashCommandsStats', timestamp: Date.now(), command: commandName }],\n\t});\n\n\tconst triggerId = chat.ActionManager.generateTriggerId(appId);\n\n\tconst data = {\n\t\tcmd: commandName,\n\t\tparams,\n\t\tmsg: message,\n\t\tuserId: chat.uid,\n\t} as const;\n\n\ttry {\n\t\tif (appId) {\n\t\t\tchat.ActionManager.notifyBusy();\n\t\t}\n\n\t\tconst result = await sdk.call('slashCommand', { cmd: commandName, params, msg: message, triggerId });\n\n\t\thandleResult?.(undefined, result, data);\n\t} catch (error: unknown) {\n\t\tawait warnUnrecognizedSlashCommand(chat, t('Something_went_wrong_while_executing_command', { command: commandName }));\n\t\thandleResult?.(error, undefined, data);\n\t}\n\n\tif (appId) {\n\t\tchat.ActionManager.notifyIdle();\n\t}\n\n\treturn true;\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/chats/flows/processSlashCommand.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/lib/chats/flows/processSlashCommand.ts","inputSourceMap":{"version":3,"file":"client/lib/chats/flows/processSlashCommand.ts","sourceRoot":"","sources":["client/lib/chats/flows/processSlashCommand.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage, SlashCommand } from '@rocket.chat/core-typings';\nimport { Random } from '@rocket.chat/random';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\n\nimport { hasAtLeastOnePermission } from '../../../../app/authorization/client';\nimport { settings } from '../../../../app/settings/client';\nimport { slashCommands } from '../../../../app/utils/client';\nimport { sdk } from '../../../../app/utils/client/lib/SDKClient';\nimport { t } from '../../../../app/utils/lib/i18n';\nimport type { ChatAPI } from '../ChatAPI';\n\nconst parse = (msg: string): { command: string; params: string } | { command: SlashCommand; params: string } | undefined => {\n\tconst match = msg.match(/^\\/([^\\s]+)(.*)/);\n\n\tif (!match) {\n\t\treturn undefined;\n\t}\n\n\tconst [, cmd, params] = match;\n\tconst command = slashCommands.commands[cmd];\n\n\tif (!command) {\n\t\treturn { command: cmd, params };\n\t}\n\n\treturn { command, params };\n};\n\nconst warnUnrecognizedSlashCommand = async (chat: ChatAPI, message: string): Promise<void> => {\n\tconsole.error(message);\n\n\tawait chat.data.pushEphemeralMessage({\n\t\t_id: Random.id(),\n\t\tts: new Date(),\n\t\tmsg: message,\n\t\tu: {\n\t\t\t_id: 'rocket.cat',\n\t\t\tusername: 'rocket.cat',\n\t\t\tname: 'Rocket.Cat',\n\t\t},\n\t\tprivate: true,\n\t\t_updatedAt: new Date(),\n\t});\n};\n\nexport const processSlashCommand = async (chat: ChatAPI, message: IMessage): Promise<boolean> => {\n\tconst match = parse(message.msg);\n\n\tif (!match) {\n\t\treturn false;\n\t}\n\n\tconst { command, params } = match;\n\n\tif (typeof command === 'string') {\n\t\tif (!settings.get('Message_AllowUnrecognizedSlashCommand')) {\n\t\t\tawait warnUnrecognizedSlashCommand(chat, t('No_such_command', { command: escapeHTML(command) }));\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tconst { permission, clientOnly, callback: handleOnClient, result: handleResult, appId, command: commandName } = command;\n\n\tif (permission && !hasAtLeastOnePermission(permission, message.rid)) {\n\t\tawait warnUnrecognizedSlashCommand(chat, t('You_do_not_have_permission_to_execute_this_command', { command: escapeHTML(commandName) }));\n\t\treturn true;\n\t}\n\n\tif (clientOnly && chat.uid) {\n\t\thandleOnClient?.({ command: commandName, message, params, userId: chat.uid });\n\t\treturn true;\n\t}\n\n\tawait sdk.rest.post('/v1/statistics.telemetry', {\n\t\tparams: [{ eventName: 'slashCommandsStats', timestamp: Date.now(), command: commandName }],\n\t});\n\n\tconst triggerId = chat.ActionManager.generateTriggerId(appId);\n\n\tconst data = {\n\t\tcmd: commandName,\n\t\tparams,\n\t\tmsg: message,\n\t\tuserId: chat.uid,\n\t} as const;\n\n\ttry {\n\t\tif (appId) {\n\t\t\tchat.ActionManager.notifyBusy();\n\t\t}\n\n\t\tconst result = await sdk.call('slashCommand', { cmd: commandName, params, msg: message, triggerId });\n\n\t\thandleResult?.(undefined, result, data);\n\t} catch (error: unknown) {\n\t\tawait warnUnrecognizedSlashCommand(chat, t('Something_went_wrong_while_executing_command', { command: commandName }));\n\t\thandleResult?.(error, undefined, data);\n\t}\n\n\tif (appId) {\n\t\tchat.ActionManager.notifyIdle();\n\t}\n\n\treturn true;\n};\n"]}}},"code":"module.export({\n  processSlashCommand: () => processSlashCommand\n});\nlet Random;\nmodule.link(\"@rocket.chat/random\", {\n  Random(v) {\n    Random = v;\n  }\n}, 0);\nlet escapeHTML;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  escapeHTML(v) {\n    escapeHTML = v;\n  }\n}, 1);\nlet hasAtLeastOnePermission;\nmodule.link(\"../../../../app/authorization/client\", {\n  hasAtLeastOnePermission(v) {\n    hasAtLeastOnePermission = v;\n  }\n}, 2);\nlet settings;\nmodule.link(\"../../../../app/settings/client\", {\n  settings(v) {\n    settings = v;\n  }\n}, 3);\nlet slashCommands;\nmodule.link(\"../../../../app/utils/client\", {\n  slashCommands(v) {\n    slashCommands = v;\n  }\n}, 4);\nlet sdk;\nmodule.link(\"../../../../app/utils/client/lib/SDKClient\", {\n  sdk(v) {\n    sdk = v;\n  }\n}, 5);\nlet t;\nmodule.link(\"../../../../app/utils/lib/i18n\", {\n  t(v) {\n    t = v;\n  }\n}, 6);\nconst parse = msg => {\n  const match = msg.match(/^\\/([^\\s]+)(.*)/);\n  if (!match) {\n    return undefined;\n  }\n  const [, cmd, params] = match;\n  const command = slashCommands.commands[cmd];\n  if (!command) {\n    return {\n      command: cmd,\n      params\n    };\n  }\n  return {\n    command,\n    params\n  };\n};\nconst warnUnrecognizedSlashCommand = async (chat, message) => {\n  console.error(message);\n  await chat.data.pushEphemeralMessage({\n    _id: Random.id(),\n    ts: new Date(),\n    msg: message,\n    u: {\n      _id: 'rocket.cat',\n      username: 'rocket.cat',\n      name: 'Rocket.Cat'\n    },\n    private: true,\n    _updatedAt: new Date()\n  });\n};\nconst processSlashCommand = async (chat, message) => {\n  const match = parse(message.msg);\n  if (!match) {\n    return false;\n  }\n  const {\n    command,\n    params\n  } = match;\n  if (typeof command === 'string') {\n    if (!settings.get('Message_AllowUnrecognizedSlashCommand')) {\n      await warnUnrecognizedSlashCommand(chat, t('No_such_command', {\n        command: escapeHTML(command)\n      }));\n      return true;\n    }\n    return false;\n  }\n  const {\n    permission,\n    clientOnly,\n    callback: handleOnClient,\n    result: handleResult,\n    appId,\n    command: commandName\n  } = command;\n  if (permission && !hasAtLeastOnePermission(permission, message.rid)) {\n    await warnUnrecognizedSlashCommand(chat, t('You_do_not_have_permission_to_execute_this_command', {\n      command: escapeHTML(commandName)\n    }));\n    return true;\n  }\n  if (clientOnly && chat.uid) {\n    handleOnClient === null || handleOnClient === void 0 ? void 0 : handleOnClient({\n      command: commandName,\n      message,\n      params,\n      userId: chat.uid\n    });\n    return true;\n  }\n  await sdk.rest.post('/v1/statistics.telemetry', {\n    params: [{\n      eventName: 'slashCommandsStats',\n      timestamp: Date.now(),\n      command: commandName\n    }]\n  });\n  const triggerId = chat.ActionManager.generateTriggerId(appId);\n  const data = {\n    cmd: commandName,\n    params,\n    msg: message,\n    userId: chat.uid\n  };\n  try {\n    if (appId) {\n      chat.ActionManager.notifyBusy();\n    }\n    const result = await sdk.call('slashCommand', {\n      cmd: commandName,\n      params,\n      msg: message,\n      triggerId\n    });\n    handleResult === null || handleResult === void 0 ? void 0 : handleResult(undefined, result, data);\n  } catch (error) {\n    await warnUnrecognizedSlashCommand(chat, t('Something_went_wrong_while_executing_command', {\n      command: commandName\n    }));\n    handleResult === null || handleResult === void 0 ? void 0 : handleResult(error, undefined, data);\n  }\n  if (appId) {\n    chat.ActionManager.notifyIdle();\n  }\n  return true;\n};","map":{"version":3,"names":["module","export","processSlashCommand","Random","link","v","escapeHTML","hasAtLeastOnePermission","settings","slashCommands","sdk","t","parse","msg","match","undefined","cmd","params","command","commands","warnUnrecognizedSlashCommand","chat","message","console","error","data","pushEphemeralMessage","_id","id","ts","Date","u","username","name","private","_updatedAt","get","permission","clientOnly","callback","handleOnClient","result","handleResult","appId","commandName","rid","uid","userId","rest","post","eventName","timestamp","now","triggerId","ActionManager","generateTriggerId","notifyBusy","call","notifyIdle"],"sources":["client/lib/chats/flows/processSlashCommand.ts"],"sourcesContent":["import type { IMessage, SlashCommand } from '@rocket.chat/core-typings';\nimport { Random } from '@rocket.chat/random';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\n\nimport { hasAtLeastOnePermission } from '../../../../app/authorization/client';\nimport { settings } from '../../../../app/settings/client';\nimport { slashCommands } from '../../../../app/utils/client';\nimport { sdk } from '../../../../app/utils/client/lib/SDKClient';\nimport { t } from '../../../../app/utils/lib/i18n';\nimport type { ChatAPI } from '../ChatAPI';\n\nconst parse = (msg: string): { command: string; params: string } | { command: SlashCommand; params: string } | undefined => {\n\tconst match = msg.match(/^\\/([^\\s]+)(.*)/);\n\n\tif (!match) {\n\t\treturn undefined;\n\t}\n\n\tconst [, cmd, params] = match;\n\tconst command = slashCommands.commands[cmd];\n\n\tif (!command) {\n\t\treturn { command: cmd, params };\n\t}\n\n\treturn { command, params };\n};\n\nconst warnUnrecognizedSlashCommand = async (chat: ChatAPI, message: string): Promise<void> => {\n\tconsole.error(message);\n\n\tawait chat.data.pushEphemeralMessage({\n\t\t_id: Random.id(),\n\t\tts: new Date(),\n\t\tmsg: message,\n\t\tu: {\n\t\t\t_id: 'rocket.cat',\n\t\t\tusername: 'rocket.cat',\n\t\t\tname: 'Rocket.Cat',\n\t\t},\n\t\tprivate: true,\n\t\t_updatedAt: new Date(),\n\t});\n};\n\nexport const processSlashCommand = async (chat: ChatAPI, message: IMessage): Promise<boolean> => {\n\tconst match = parse(message.msg);\n\n\tif (!match) {\n\t\treturn false;\n\t}\n\n\tconst { command, params } = match;\n\n\tif (typeof command === 'string') {\n\t\tif (!settings.get('Message_AllowUnrecognizedSlashCommand')) {\n\t\t\tawait warnUnrecognizedSlashCommand(chat, t('No_such_command', { command: escapeHTML(command) }));\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tconst { permission, clientOnly, callback: handleOnClient, result: handleResult, appId, command: commandName } = command;\n\n\tif (permission && !hasAtLeastOnePermission(permission, message.rid)) {\n\t\tawait warnUnrecognizedSlashCommand(chat, t('You_do_not_have_permission_to_execute_this_command', { command: escapeHTML(commandName) }));\n\t\treturn true;\n\t}\n\n\tif (clientOnly && chat.uid) {\n\t\thandleOnClient?.({ command: commandName, message, params, userId: chat.uid });\n\t\treturn true;\n\t}\n\n\tawait sdk.rest.post('/v1/statistics.telemetry', {\n\t\tparams: [{ eventName: 'slashCommandsStats', timestamp: Date.now(), command: commandName }],\n\t});\n\n\tconst triggerId = chat.ActionManager.generateTriggerId(appId);\n\n\tconst data = {\n\t\tcmd: commandName,\n\t\tparams,\n\t\tmsg: message,\n\t\tuserId: chat.uid,\n\t} as const;\n\n\ttry {\n\t\tif (appId) {\n\t\t\tchat.ActionManager.notifyBusy();\n\t\t}\n\n\t\tconst result = await sdk.call('slashCommand', { cmd: commandName, params, msg: message, triggerId });\n\n\t\thandleResult?.(undefined, result, data);\n\t} catch (error: unknown) {\n\t\tawait warnUnrecognizedSlashCommand(chat, t('Something_went_wrong_while_executing_command', { command: commandName }));\n\t\thandleResult?.(error, undefined, data);\n\t}\n\n\tif (appId) {\n\t\tchat.ActionManager.notifyIdle();\n\t}\n\n\treturn true;\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"d8e7017d6ac17b4a5b43b052f97faf681019e5ae"}
