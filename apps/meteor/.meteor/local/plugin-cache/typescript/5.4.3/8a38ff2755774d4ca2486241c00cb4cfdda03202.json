{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/roomAccessValidator.compatibility.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/livechat/server/roomAccessValidator.compatibility.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/roomAccessValidator.compatibility.ts","inputSourceMap":{"version":3,"file":"app/livechat/server/roomAccessValidator.compatibility.ts","sourceRoot":"","sources":["app/livechat/server/roomAccessValidator.compatibility.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IUser, IOmnichannelRoom } from '@rocket.chat/core-typings';\nimport { LivechatDepartmentAgents, LivechatInquiry, LivechatRooms, LivechatDepartment } from '@rocket.chat/models';\n\nimport { RoutingManager } from './lib/RoutingManager';\nimport { hasPermissionAsync } from '../../authorization/server/functions/hasPermission';\nimport { hasRoleAsync } from '../../authorization/server/functions/hasRole';\n\ntype OmnichannelRoomAccessValidator = (\n\troom: IOmnichannelRoom,\n\tuser?: Pick<IUser, '_id'>,\n\textraData?: Record<string, any>,\n) => boolean | Promise<boolean>;\n\nexport const validators: OmnichannelRoomAccessValidator[] = [\n\tasync function (_room, user) {\n\t\tif (!user?._id) {\n\t\t\treturn false;\n\t\t}\n\t\treturn hasPermissionAsync(user._id, 'view-livechat-rooms');\n\t},\n\tasync function (room, user) {\n\t\tif (!user?._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { _id: userId } = user;\n\t\tconst { servedBy: { _id: agentId } = {} } = room;\n\t\treturn userId === agentId || (!room.open && hasPermissionAsync(user._id, 'view-livechat-room-closed-by-another-agent'));\n\t},\n\tasync function (room, _user, extraData) {\n\t\tif (extraData?.rid) {\n\t\t\tconst dbRoom = await LivechatRooms.findOneById(extraData.rid);\n\t\t\tif (dbRoom) {\n\t\t\t\troom = dbRoom;\n\t\t\t}\n\t\t}\n\n\t\treturn extraData?.visitorToken && room.v && room.v.token === extraData.visitorToken && room.open === true;\n\t},\n\tasync function (room, user) {\n\t\tif (!user?._id) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!RoutingManager.getConfig()?.previewRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet departmentIds;\n\t\tif (!(await hasRoleAsync(user._id, 'livechat-manager'))) {\n\t\t\tconst departmentAgents = (await LivechatDepartmentAgents.findByAgentId(user._id, { projection: { departmentId: 1 } }).toArray()).map(\n\t\t\t\t(d) => d.departmentId,\n\t\t\t);\n\t\t\tdepartmentIds = (await LivechatDepartment.findEnabledInIds(departmentAgents, { projection: { _id: 1 } }).toArray()).map((d) => d._id);\n\t\t}\n\n\t\tconst filter = {\n\t\t\trid: room._id,\n\t\t\t$or: [\n\t\t\t\t{\n\t\t\t\t\t$and: [{ defaultAgent: { $exists: true } }, { 'defaultAgent.agentId': user._id }],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t...(departmentIds && departmentIds.length > 0 && { department: { $in: departmentIds } }),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tdepartment: { $exists: false }, // No department == public queue\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst inquiry = await LivechatInquiry.findOne(filter, { projection: { status: 1 } });\n\t\treturn inquiry && inquiry.status === 'queued';\n\t},\n\tasync function (room, user) {\n\t\tif (!room.departmentId || room.open || !user?._id) {\n\t\t\treturn;\n\t\t}\n\t\tconst agentOfDepartment = await LivechatDepartmentAgents.findOneByAgentIdAndDepartmentId(user._id, room.departmentId, {\n\t\t\tprojection: { _id: 1 },\n\t\t});\n\t\tif (!agentOfDepartment) {\n\t\t\treturn;\n\t\t}\n\t\treturn hasPermissionAsync(user._id, 'view-livechat-room-closed-same-department');\n\t},\n\tfunction (_room, user) {\n\t\t// Check if user is rocket.cat\n\t\tif (!user?._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// This opens the ability for rocketcat to upload files to a livechat room without being included in it :)\n\t\t// Worst case, someone manages to log in as rocketcat lol\n\t\treturn user._id === 'rocket.cat';\n\t},\n];\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/roomAccessValidator.compatibility.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/livechat/server/roomAccessValidator.compatibility.ts","inputSourceMap":{"version":3,"file":"app/livechat/server/roomAccessValidator.compatibility.ts","sourceRoot":"","sources":["app/livechat/server/roomAccessValidator.compatibility.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IUser, IOmnichannelRoom } from '@rocket.chat/core-typings';\nimport { LivechatDepartmentAgents, LivechatInquiry, LivechatRooms, LivechatDepartment } from '@rocket.chat/models';\n\nimport { RoutingManager } from './lib/RoutingManager';\nimport { hasPermissionAsync } from '../../authorization/server/functions/hasPermission';\nimport { hasRoleAsync } from '../../authorization/server/functions/hasRole';\n\ntype OmnichannelRoomAccessValidator = (\n\troom: IOmnichannelRoom,\n\tuser?: Pick<IUser, '_id'>,\n\textraData?: Record<string, any>,\n) => boolean | Promise<boolean>;\n\nexport const validators: OmnichannelRoomAccessValidator[] = [\n\tasync function (_room, user) {\n\t\tif (!user?._id) {\n\t\t\treturn false;\n\t\t}\n\t\treturn hasPermissionAsync(user._id, 'view-livechat-rooms');\n\t},\n\tasync function (room, user) {\n\t\tif (!user?._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { _id: userId } = user;\n\t\tconst { servedBy: { _id: agentId } = {} } = room;\n\t\treturn userId === agentId || (!room.open && hasPermissionAsync(user._id, 'view-livechat-room-closed-by-another-agent'));\n\t},\n\tasync function (room, _user, extraData) {\n\t\tif (extraData?.rid) {\n\t\t\tconst dbRoom = await LivechatRooms.findOneById(extraData.rid);\n\t\t\tif (dbRoom) {\n\t\t\t\troom = dbRoom;\n\t\t\t}\n\t\t}\n\n\t\treturn extraData?.visitorToken && room.v && room.v.token === extraData.visitorToken && room.open === true;\n\t},\n\tasync function (room, user) {\n\t\tif (!user?._id) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!RoutingManager.getConfig()?.previewRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet departmentIds;\n\t\tif (!(await hasRoleAsync(user._id, 'livechat-manager'))) {\n\t\t\tconst departmentAgents = (await LivechatDepartmentAgents.findByAgentId(user._id, { projection: { departmentId: 1 } }).toArray()).map(\n\t\t\t\t(d) => d.departmentId,\n\t\t\t);\n\t\t\tdepartmentIds = (await LivechatDepartment.findEnabledInIds(departmentAgents, { projection: { _id: 1 } }).toArray()).map((d) => d._id);\n\t\t}\n\n\t\tconst filter = {\n\t\t\trid: room._id,\n\t\t\t$or: [\n\t\t\t\t{\n\t\t\t\t\t$and: [{ defaultAgent: { $exists: true } }, { 'defaultAgent.agentId': user._id }],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t...(departmentIds && departmentIds.length > 0 && { department: { $in: departmentIds } }),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tdepartment: { $exists: false }, // No department == public queue\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst inquiry = await LivechatInquiry.findOne(filter, { projection: { status: 1 } });\n\t\treturn inquiry && inquiry.status === 'queued';\n\t},\n\tasync function (room, user) {\n\t\tif (!room.departmentId || room.open || !user?._id) {\n\t\t\treturn;\n\t\t}\n\t\tconst agentOfDepartment = await LivechatDepartmentAgents.findOneByAgentIdAndDepartmentId(user._id, room.departmentId, {\n\t\t\tprojection: { _id: 1 },\n\t\t});\n\t\tif (!agentOfDepartment) {\n\t\t\treturn;\n\t\t}\n\t\treturn hasPermissionAsync(user._id, 'view-livechat-room-closed-same-department');\n\t},\n\tfunction (_room, user) {\n\t\t// Check if user is rocket.cat\n\t\tif (!user?._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// This opens the ability for rocketcat to upload files to a livechat room without being included in it :)\n\t\t// Worst case, someone manages to log in as rocketcat lol\n\t\treturn user._id === 'rocket.cat';\n\t},\n];\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let _objectSpread;\n    module.link(\"@babel/runtime/helpers/objectSpread2\", {\n      default(v) {\n        _objectSpread = v;\n      }\n    }, 0);\n    module.export({\n      validators: () => validators\n    });\n    let LivechatDepartmentAgents, LivechatInquiry, LivechatRooms, LivechatDepartment;\n    module.link(\"@rocket.chat/models\", {\n      LivechatDepartmentAgents(v) {\n        LivechatDepartmentAgents = v;\n      },\n      LivechatInquiry(v) {\n        LivechatInquiry = v;\n      },\n      LivechatRooms(v) {\n        LivechatRooms = v;\n      },\n      LivechatDepartment(v) {\n        LivechatDepartment = v;\n      }\n    }, 0);\n    let RoutingManager;\n    module.link(\"./lib/RoutingManager\", {\n      RoutingManager(v) {\n        RoutingManager = v;\n      }\n    }, 1);\n    let hasPermissionAsync;\n    module.link(\"../../authorization/server/functions/hasPermission\", {\n      hasPermissionAsync(v) {\n        hasPermissionAsync = v;\n      }\n    }, 2);\n    let hasRoleAsync;\n    module.link(\"../../authorization/server/functions/hasRole\", {\n      hasRoleAsync(v) {\n        hasRoleAsync = v;\n      }\n    }, 3);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    const validators = [async function (_room, user) {\n      if (!(user !== null && user !== void 0 && user._id)) {\n        return false;\n      }\n      return hasPermissionAsync(user._id, 'view-livechat-rooms');\n    }, async function (room, user) {\n      if (!(user !== null && user !== void 0 && user._id)) {\n        return false;\n      }\n      const {\n        _id: userId\n      } = user;\n      const {\n        servedBy: {\n          _id: agentId\n        } = {}\n      } = room;\n      return userId === agentId || !room.open && hasPermissionAsync(user._id, 'view-livechat-room-closed-by-another-agent');\n    }, async function (room, _user, extraData) {\n      if (extraData !== null && extraData !== void 0 && extraData.rid) {\n        const dbRoom = await LivechatRooms.findOneById(extraData.rid);\n        if (dbRoom) {\n          room = dbRoom;\n        }\n      }\n      return (extraData === null || extraData === void 0 ? void 0 : extraData.visitorToken) && room.v && room.v.token === extraData.visitorToken && room.open === true;\n    }, async function (room, user) {\n      var _RoutingManager$getCo;\n      if (!(user !== null && user !== void 0 && user._id)) {\n        return false;\n      }\n      if (!((_RoutingManager$getCo = RoutingManager.getConfig()) !== null && _RoutingManager$getCo !== void 0 && _RoutingManager$getCo.previewRoom)) {\n        return;\n      }\n      let departmentIds;\n      if (!(await hasRoleAsync(user._id, 'livechat-manager'))) {\n        const departmentAgents = (await LivechatDepartmentAgents.findByAgentId(user._id, {\n          projection: {\n            departmentId: 1\n          }\n        }).toArray()).map(d => d.departmentId);\n        departmentIds = (await LivechatDepartment.findEnabledInIds(departmentAgents, {\n          projection: {\n            _id: 1\n          }\n        }).toArray()).map(d => d._id);\n      }\n      const filter = {\n        rid: room._id,\n        $or: [{\n          $and: [{\n            defaultAgent: {\n              $exists: true\n            }\n          }, {\n            'defaultAgent.agentId': user._id\n          }]\n        }, _objectSpread({}, departmentIds && departmentIds.length > 0 && {\n          department: {\n            $in: departmentIds\n          }\n        }), {\n          department: {\n            $exists: false\n          } // No department == public queue\n        }]\n      };\n      const inquiry = await LivechatInquiry.findOne(filter, {\n        projection: {\n          status: 1\n        }\n      });\n      return inquiry && inquiry.status === 'queued';\n    }, async function (room, user) {\n      if (!room.departmentId || room.open || !(user !== null && user !== void 0 && user._id)) {\n        return;\n      }\n      const agentOfDepartment = await LivechatDepartmentAgents.findOneByAgentIdAndDepartmentId(user._id, room.departmentId, {\n        projection: {\n          _id: 1\n        }\n      });\n      if (!agentOfDepartment) {\n        return;\n      }\n      return hasPermissionAsync(user._id, 'view-livechat-room-closed-same-department');\n    }, function (_room, user) {\n      // Check if user is rocket.cat\n      if (!(user !== null && user !== void 0 && user._id)) {\n        return false;\n      }\n      // This opens the ability for rocketcat to upload files to a livechat room without being included in it :)\n      // Worst case, someone manages to log in as rocketcat lol\n      return user._id === 'rocket.cat';\n    }];\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["_objectSpread","module","link","default","v","export","validators","LivechatDepartmentAgents","LivechatInquiry","LivechatRooms","LivechatDepartment","RoutingManager","hasPermissionAsync","hasRoleAsync","__reifyWaitForDeps__","_room","user","_id","room","userId","servedBy","agentId","open","_user","extraData","rid","dbRoom","findOneById","visitorToken","token","_RoutingManager$getCo","getConfig","previewRoom","departmentIds","departmentAgents","findByAgentId","projection","departmentId","toArray","map","d","findEnabledInIds","filter","$or","$and","defaultAgent","$exists","length","department","$in","inquiry","findOne","status","agentOfDepartment","findOneByAgentIdAndDepartmentId","__reify_async_result__","_reifyError","self","async"],"sources":["app/livechat/server/roomAccessValidator.compatibility.ts"],"sourcesContent":["import type { IUser, IOmnichannelRoom } from '@rocket.chat/core-typings';\nimport { LivechatDepartmentAgents, LivechatInquiry, LivechatRooms, LivechatDepartment } from '@rocket.chat/models';\n\nimport { RoutingManager } from './lib/RoutingManager';\nimport { hasPermissionAsync } from '../../authorization/server/functions/hasPermission';\nimport { hasRoleAsync } from '../../authorization/server/functions/hasRole';\n\ntype OmnichannelRoomAccessValidator = (\n\troom: IOmnichannelRoom,\n\tuser?: Pick<IUser, '_id'>,\n\textraData?: Record<string, any>,\n) => boolean | Promise<boolean>;\n\nexport const validators: OmnichannelRoomAccessValidator[] = [\n\tasync function (_room, user) {\n\t\tif (!user?._id) {\n\t\t\treturn false;\n\t\t}\n\t\treturn hasPermissionAsync(user._id, 'view-livechat-rooms');\n\t},\n\tasync function (room, user) {\n\t\tif (!user?._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { _id: userId } = user;\n\t\tconst { servedBy: { _id: agentId } = {} } = room;\n\t\treturn userId === agentId || (!room.open && hasPermissionAsync(user._id, 'view-livechat-room-closed-by-another-agent'));\n\t},\n\tasync function (room, _user, extraData) {\n\t\tif (extraData?.rid) {\n\t\t\tconst dbRoom = await LivechatRooms.findOneById(extraData.rid);\n\t\t\tif (dbRoom) {\n\t\t\t\troom = dbRoom;\n\t\t\t}\n\t\t}\n\n\t\treturn extraData?.visitorToken && room.v && room.v.token === extraData.visitorToken && room.open === true;\n\t},\n\tasync function (room, user) {\n\t\tif (!user?._id) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!RoutingManager.getConfig()?.previewRoom) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet departmentIds;\n\t\tif (!(await hasRoleAsync(user._id, 'livechat-manager'))) {\n\t\t\tconst departmentAgents = (await LivechatDepartmentAgents.findByAgentId(user._id, { projection: { departmentId: 1 } }).toArray()).map(\n\t\t\t\t(d) => d.departmentId,\n\t\t\t);\n\t\t\tdepartmentIds = (await LivechatDepartment.findEnabledInIds(departmentAgents, { projection: { _id: 1 } }).toArray()).map((d) => d._id);\n\t\t}\n\n\t\tconst filter = {\n\t\t\trid: room._id,\n\t\t\t$or: [\n\t\t\t\t{\n\t\t\t\t\t$and: [{ defaultAgent: { $exists: true } }, { 'defaultAgent.agentId': user._id }],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t...(departmentIds && departmentIds.length > 0 && { department: { $in: departmentIds } }),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tdepartment: { $exists: false }, // No department == public queue\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst inquiry = await LivechatInquiry.findOne(filter, { projection: { status: 1 } });\n\t\treturn inquiry && inquiry.status === 'queued';\n\t},\n\tasync function (room, user) {\n\t\tif (!room.departmentId || room.open || !user?._id) {\n\t\t\treturn;\n\t\t}\n\t\tconst agentOfDepartment = await LivechatDepartmentAgents.findOneByAgentIdAndDepartmentId(user._id, room.departmentId, {\n\t\t\tprojection: { _id: 1 },\n\t\t});\n\t\tif (!agentOfDepartment) {\n\t\t\treturn;\n\t\t}\n\t\treturn hasPermissionAsync(user._id, 'view-livechat-room-closed-same-department');\n\t},\n\tfunction (_room, user) {\n\t\t// Check if user is rocket.cat\n\t\tif (!user?._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// This opens the ability for rocketcat to upload files to a livechat room without being included in it :)\n\t\t// Worst case, someone manages to log in as rocketcat lol\n\t\treturn user._id === 'rocket.cat';\n\t},\n];\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"8a38ff2755774d4ca2486241c00cb4cfdda03202"}
