{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/userStatuses.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/lib/userStatuses.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/userStatuses.ts","inputSourceMap":{"version":3,"file":"client/lib/userStatuses.ts","sourceRoot":"","sources":["client/lib/userStatuses.ts"],"names":[],"mappings":"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","sourcesContent":["import { UserStatus } from '@rocket.chat/core-typings';\nimport type { ICustomUserStatus } from '@rocket.chat/core-typings';\n\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\n\nexport type UserStatusDescriptor = {\n\tid: string;\n\tname: string;\n\tstatusType: UserStatus;\n\tlocalizeName: boolean;\n};\n\nexport class UserStatuses implements Iterable<UserStatusDescriptor> {\n\tpublic invisibleAllowed = true;\n\n\tprivate store: Map<UserStatusDescriptor['id'], UserStatusDescriptor> = new Map(\n\t\t[UserStatus.ONLINE, UserStatus.AWAY, UserStatus.BUSY, UserStatus.OFFLINE].map((status) => [\n\t\t\tstatus,\n\t\t\t{\n\t\t\t\tid: status,\n\t\t\t\tname: status,\n\t\t\t\tstatusType: status,\n\t\t\t\tlocalizeName: true,\n\t\t\t},\n\t\t]),\n\t);\n\n\tpublic delete(id: string): void {\n\t\tthis.store.delete(id);\n\t}\n\n\tpublic put(customUserStatus: UserStatusDescriptor): void {\n\t\tthis.store.set(customUserStatus.id, customUserStatus);\n\t}\n\n\tpublic createFromCustom(customUserStatus: ICustomUserStatus): UserStatusDescriptor {\n\t\tif (!this.isValidType(customUserStatus.statusType)) {\n\t\t\tthrow new Error('Invalid user status type');\n\t\t}\n\n\t\treturn {\n\t\t\tname: customUserStatus.name,\n\t\t\tid: customUserStatus._id,\n\t\t\tstatusType: customUserStatus.statusType as UserStatus,\n\t\t\tlocalizeName: false,\n\t\t};\n\t}\n\n\tpublic isValidType(type: string): type is UserStatus {\n\t\treturn (Object.values(UserStatus) as string[]).includes(type);\n\t}\n\n\tpublic *[Symbol.iterator]() {\n\t\tfor (const value of this.store.values()) {\n\t\t\tif (this.invisibleAllowed || value.statusType !== UserStatus.OFFLINE) {\n\t\t\t\tyield value;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic async sync() {\n\t\tconst result = await sdk.call('listCustomUserStatus');\n\t\tif (!result) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const customStatus of result) {\n\t\t\tthis.put(this.createFromCustom(customStatus));\n\t\t}\n\t}\n\n\tpublic watch(cb?: () => void) {\n\t\tconst updateSubscription = sdk.stream('notify-logged', ['updateCustomUserStatus'], (data) => {\n\t\t\tthis.put(this.createFromCustom(data.userStatusData));\n\t\t\tcb?.();\n\t\t});\n\n\t\tconst deleteSubscription = sdk.stream('notify-logged', ['deleteCustomUserStatus'], (data) => {\n\t\t\tthis.delete(data.userStatusData._id);\n\t\t\tcb?.();\n\t\t});\n\n\t\treturn () => {\n\t\t\tupdateSubscription.stop();\n\t\t\tdeleteSubscription.stop();\n\t\t};\n\t}\n}\n\nexport const userStatuses = new UserStatuses();\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/userStatuses.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/lib/userStatuses.ts","inputSourceMap":{"version":3,"file":"client/lib/userStatuses.ts","sourceRoot":"","sources":["client/lib/userStatuses.ts"],"names":[],"mappings":"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","sourcesContent":["import { UserStatus } from '@rocket.chat/core-typings';\nimport type { ICustomUserStatus } from '@rocket.chat/core-typings';\n\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\n\nexport type UserStatusDescriptor = {\n\tid: string;\n\tname: string;\n\tstatusType: UserStatus;\n\tlocalizeName: boolean;\n};\n\nexport class UserStatuses implements Iterable<UserStatusDescriptor> {\n\tpublic invisibleAllowed = true;\n\n\tprivate store: Map<UserStatusDescriptor['id'], UserStatusDescriptor> = new Map(\n\t\t[UserStatus.ONLINE, UserStatus.AWAY, UserStatus.BUSY, UserStatus.OFFLINE].map((status) => [\n\t\t\tstatus,\n\t\t\t{\n\t\t\t\tid: status,\n\t\t\t\tname: status,\n\t\t\t\tstatusType: status,\n\t\t\t\tlocalizeName: true,\n\t\t\t},\n\t\t]),\n\t);\n\n\tpublic delete(id: string): void {\n\t\tthis.store.delete(id);\n\t}\n\n\tpublic put(customUserStatus: UserStatusDescriptor): void {\n\t\tthis.store.set(customUserStatus.id, customUserStatus);\n\t}\n\n\tpublic createFromCustom(customUserStatus: ICustomUserStatus): UserStatusDescriptor {\n\t\tif (!this.isValidType(customUserStatus.statusType)) {\n\t\t\tthrow new Error('Invalid user status type');\n\t\t}\n\n\t\treturn {\n\t\t\tname: customUserStatus.name,\n\t\t\tid: customUserStatus._id,\n\t\t\tstatusType: customUserStatus.statusType as UserStatus,\n\t\t\tlocalizeName: false,\n\t\t};\n\t}\n\n\tpublic isValidType(type: string): type is UserStatus {\n\t\treturn (Object.values(UserStatus) as string[]).includes(type);\n\t}\n\n\tpublic *[Symbol.iterator]() {\n\t\tfor (const value of this.store.values()) {\n\t\t\tif (this.invisibleAllowed || value.statusType !== UserStatus.OFFLINE) {\n\t\t\t\tyield value;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic async sync() {\n\t\tconst result = await sdk.call('listCustomUserStatus');\n\t\tif (!result) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const customStatus of result) {\n\t\t\tthis.put(this.createFromCustom(customStatus));\n\t\t}\n\t}\n\n\tpublic watch(cb?: () => void) {\n\t\tconst updateSubscription = sdk.stream('notify-logged', ['updateCustomUserStatus'], (data) => {\n\t\t\tthis.put(this.createFromCustom(data.userStatusData));\n\t\t\tcb?.();\n\t\t});\n\n\t\tconst deleteSubscription = sdk.stream('notify-logged', ['deleteCustomUserStatus'], (data) => {\n\t\t\tthis.delete(data.userStatusData._id);\n\t\t\tcb?.();\n\t\t});\n\n\t\treturn () => {\n\t\t\tupdateSubscription.stop();\n\t\t\tdeleteSubscription.stop();\n\t\t};\n\t}\n}\n\nexport const userStatuses = new UserStatuses();\n"]}}},"code":"var _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nvar _createForOfIteratorHelperLoose;\nmodule.link(\"@babel/runtime/helpers/createForOfIteratorHelperLoose\", {\n  default: function (v) {\n    _createForOfIteratorHelperLoose = v;\n  }\n}, 1);\nmodule.export({\n  UserStatuses: function () {\n    return UserStatuses;\n  },\n  userStatuses: function () {\n    return userStatuses;\n  }\n});\nvar UserStatus;\nmodule.link(\"@rocket.chat/core-typings\", {\n  UserStatus: function (v) {\n    UserStatus = v;\n  }\n}, 0);\nvar sdk;\nmodule.link(\"../../app/utils/client/lib/SDKClient\", {\n  sdk: function (v) {\n    sdk = v;\n  }\n}, 1);\nvar UserStatuses = /*#__PURE__*/function () {\n  function UserStatuses() {\n    this.invisibleAllowed = true;\n    this.store = new Map([UserStatus.ONLINE, UserStatus.AWAY, UserStatus.BUSY, UserStatus.OFFLINE].map(function (status) {\n      return [status, {\n        id: status,\n        name: status,\n        statusType: status,\n        localizeName: true\n      }];\n    }));\n  }\n  var _proto = UserStatuses.prototype;\n  _proto.delete = function () {\n    function _delete(id) {\n      this.store.delete(id);\n    }\n    return _delete;\n  }();\n  _proto.put = function () {\n    function put(customUserStatus) {\n      this.store.set(customUserStatus.id, customUserStatus);\n    }\n    return put;\n  }();\n  _proto.createFromCustom = function () {\n    function createFromCustom(customUserStatus) {\n      if (!this.isValidType(customUserStatus.statusType)) {\n        throw new Error('Invalid user status type');\n      }\n      return {\n        name: customUserStatus.name,\n        id: customUserStatus._id,\n        statusType: customUserStatus.statusType,\n        localizeName: false\n      };\n    }\n    return createFromCustom;\n  }();\n  _proto.isValidType = function () {\n    function isValidType(type) {\n      return Object.values(UserStatus).includes(type);\n    }\n    return isValidType;\n  }();\n  _proto[Symbol.iterator] = /*#__PURE__*/_regeneratorRuntime.mark(function () {\n    function _callee() {\n      var _iterator, _step, value;\n      return _regeneratorRuntime.wrap(function () {\n        function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _iterator = _createForOfIteratorHelperLoose(this.store.values());\n            case 1:\n              if ((_step = _iterator()).done) {\n                _context.next = 8;\n                break;\n              }\n              value = _step.value;\n              if (!(this.invisibleAllowed || value.statusType !== UserStatus.OFFLINE)) {\n                _context.next = 6;\n                break;\n              }\n              _context.next = 6;\n              return value;\n            case 6:\n              _context.next = 1;\n              break;\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n        return _callee$;\n      }(), _callee, this);\n    }\n    return _callee;\n  }());\n  _proto.sync = function () {\n    function sync() {\n      var result, _iterator2, _step2, customStatus;\n      return _regeneratorRuntime.async(function () {\n        function sync$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(sdk.call('listCustomUserStatus'));\n            case 2:\n              result = _context2.sent;\n              if (result) {\n                _context2.next = 5;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 5:\n              for (_iterator2 = _createForOfIteratorHelperLoose(result); !(_step2 = _iterator2()).done;) {\n                customStatus = _step2.value;\n                this.put(this.createFromCustom(customStatus));\n              }\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n        return sync$;\n      }(), null, this, null, Promise);\n    }\n    return sync;\n  }();\n  _proto.watch = function () {\n    function watch(cb) {\n      var _this = this;\n      var updateSubscription = sdk.stream('notify-logged', ['updateCustomUserStatus'], function (data) {\n        _this.put(_this.createFromCustom(data.userStatusData));\n        cb === null || cb === void 0 ? void 0 : cb();\n      });\n      var deleteSubscription = sdk.stream('notify-logged', ['deleteCustomUserStatus'], function (data) {\n        _this.delete(data.userStatusData._id);\n        cb === null || cb === void 0 ? void 0 : cb();\n      });\n      return function () {\n        updateSubscription.stop();\n        deleteSubscription.stop();\n      };\n    }\n    return watch;\n  }();\n  return UserStatuses;\n}();\nvar userStatuses = new UserStatuses();","map":{"version":3,"names":["_regeneratorRuntime","module","link","default","v","_createForOfIteratorHelperLoose","export","UserStatuses","userStatuses","UserStatus","sdk","invisibleAllowed","store","Map","ONLINE","AWAY","BUSY","OFFLINE","map","status","id","name","statusType","localizeName","_proto","prototype","delete","_delete","put","customUserStatus","set","createFromCustom","isValidType","Error","_id","type","Object","values","includes","Symbol","iterator","mark","_callee","_iterator","_step","value","wrap","_callee$","_context","prev","next","done","stop","sync","result","_iterator2","_step2","customStatus","async","sync$","_context2","awrap","call","sent","abrupt","Promise","watch","cb","_this","updateSubscription","stream","data","userStatusData","deleteSubscription"],"sources":["client/lib/userStatuses.ts"],"sourcesContent":["import { UserStatus } from '@rocket.chat/core-typings';\nimport type { ICustomUserStatus } from '@rocket.chat/core-typings';\n\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\n\nexport type UserStatusDescriptor = {\n\tid: string;\n\tname: string;\n\tstatusType: UserStatus;\n\tlocalizeName: boolean;\n};\n\nexport class UserStatuses implements Iterable<UserStatusDescriptor> {\n\tpublic invisibleAllowed = true;\n\n\tprivate store: Map<UserStatusDescriptor['id'], UserStatusDescriptor> = new Map(\n\t\t[UserStatus.ONLINE, UserStatus.AWAY, UserStatus.BUSY, UserStatus.OFFLINE].map((status) => [\n\t\t\tstatus,\n\t\t\t{\n\t\t\t\tid: status,\n\t\t\t\tname: status,\n\t\t\t\tstatusType: status,\n\t\t\t\tlocalizeName: true,\n\t\t\t},\n\t\t]),\n\t);\n\n\tpublic delete(id: string): void {\n\t\tthis.store.delete(id);\n\t}\n\n\tpublic put(customUserStatus: UserStatusDescriptor): void {\n\t\tthis.store.set(customUserStatus.id, customUserStatus);\n\t}\n\n\tpublic createFromCustom(customUserStatus: ICustomUserStatus): UserStatusDescriptor {\n\t\tif (!this.isValidType(customUserStatus.statusType)) {\n\t\t\tthrow new Error('Invalid user status type');\n\t\t}\n\n\t\treturn {\n\t\t\tname: customUserStatus.name,\n\t\t\tid: customUserStatus._id,\n\t\t\tstatusType: customUserStatus.statusType as UserStatus,\n\t\t\tlocalizeName: false,\n\t\t};\n\t}\n\n\tpublic isValidType(type: string): type is UserStatus {\n\t\treturn (Object.values(UserStatus) as string[]).includes(type);\n\t}\n\n\tpublic *[Symbol.iterator]() {\n\t\tfor (const value of this.store.values()) {\n\t\t\tif (this.invisibleAllowed || value.statusType !== UserStatus.OFFLINE) {\n\t\t\t\tyield value;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic async sync() {\n\t\tconst result = await sdk.call('listCustomUserStatus');\n\t\tif (!result) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const customStatus of result) {\n\t\t\tthis.put(this.createFromCustom(customStatus));\n\t\t}\n\t}\n\n\tpublic watch(cb?: () => void) {\n\t\tconst updateSubscription = sdk.stream('notify-logged', ['updateCustomUserStatus'], (data) => {\n\t\t\tthis.put(this.createFromCustom(data.userStatusData));\n\t\t\tcb?.();\n\t\t});\n\n\t\tconst deleteSubscription = sdk.stream('notify-logged', ['deleteCustomUserStatus'], (data) => {\n\t\t\tthis.delete(data.userStatusData._id);\n\t\t\tcb?.();\n\t\t});\n\n\t\treturn () => {\n\t\t\tupdateSubscription.stop();\n\t\t\tdeleteSubscription.stop();\n\t\t};\n\t}\n}\n\nexport const userStatuses = new UserStatuses();\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"18182970492b92261abe3874c83f6c383720d829"}
