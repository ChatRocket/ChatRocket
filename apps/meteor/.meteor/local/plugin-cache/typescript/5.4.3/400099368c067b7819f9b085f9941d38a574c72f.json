{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx","inputSourceMap":{"version":3,"file":"client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx","sourceRoot":"","sources":["client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport { Box, Throbber } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { MessageComposerAction } from '@rocket.chat/ui-composer';\nimport type { ReactElement } from 'react';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { AudioRecorder } from '../../../../app/ui/client/lib/recorderjs/AudioRecorder';\nimport type { ChatAPI } from '../../../lib/chats/ChatAPI';\nimport { useChat } from '../../room/contexts/ChatContext';\n\nconst audioRecorder = new AudioRecorder();\n\ntype AudioMessageRecorderProps = {\n\trid: IRoom['_id'];\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n\tisMicrophoneDenied?: boolean;\n};\n\nconst AudioMessageRecorder = ({ rid, chatContext, isMicrophoneDenied }: AudioMessageRecorderProps): ReactElement | null => {\n\tconst { t } = useTranslation();\n\n\tconst [state, setState] = useState<'loading' | 'recording'>('recording');\n\tconst [time, setTime] = useState('00:00');\n\tconst [recordingInterval, setRecordingInterval] = useState<ReturnType<typeof setInterval> | null>(null);\n\tconst [recordingRoomId, setRecordingRoomId] = useState<IRoom['_id'] | null>(null);\n\n\tconst stopRecording = useMutableCallback(async () => {\n\t\tif (recordingInterval) {\n\t\t\tclearInterval(recordingInterval);\n\t\t}\n\t\tsetRecordingInterval(null);\n\t\tsetRecordingRoomId(null);\n\n\t\tsetTime('00:00');\n\n\t\tchat?.action.stop('recording');\n\n\t\tchat?.composer?.setRecordingMode(false);\n\n\t\tconst blob = await new Promise<Blob>((resolve) => audioRecorder.stop(resolve));\n\n\t\treturn blob;\n\t});\n\n\tconst handleUnmount = useMutableCallback(async () => {\n\t\tif (state === 'recording') {\n\t\t\tawait stopRecording();\n\t\t}\n\t});\n\n\tconst handleRecord = useMutableCallback(async () => {\n\t\tif (recordingRoomId && recordingRoomId !== rid) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait audioRecorder.start();\n\t\t\tchat?.action.performContinuously('recording');\n\t\t\tconst startTime = new Date();\n\t\t\tsetRecordingInterval(\n\t\t\t\tsetInterval(() => {\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tconst distance = (now.getTime() - startTime.getTime()) / 1000;\n\t\t\t\t\tconst minutes = Math.floor(distance / 60);\n\t\t\t\t\tconst seconds = Math.floor(distance % 60);\n\t\t\t\t\tsetTime(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);\n\t\t\t\t}, 1000),\n\t\t\t);\n\t\t\tsetRecordingRoomId(rid);\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t\tchat?.composer?.setRecordingMode(false);\n\t\t}\n\t});\n\n\tconst handleCancelButtonClick = useMutableCallback(async () => {\n\t\tawait stopRecording();\n\t});\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst handleDoneButtonClick = useMutableCallback(async () => {\n\t\tsetState('loading');\n\n\t\tconst blob = await stopRecording();\n\n\t\tconst fileName = `${t('Audio_record')}.mp3`;\n\t\tconst file = new File([blob], fileName, { type: 'audio/mpeg' });\n\n\t\tawait chat?.flows.uploadFiles([file]);\n\t});\n\n\tuseEffect(() => {\n\t\thandleRecord();\n\n\t\treturn () => {\n\t\t\thandleUnmount();\n\t\t};\n\t}, [handleUnmount, handleRecord]);\n\n\tconst stateClass = useMemo(() => {\n\t\tif (recordingRoomId && recordingRoomId !== rid) {\n\t\t\treturn 'rc-message-box__audio-message--busy';\n\t\t}\n\n\t\treturn state && `rc-message-box__audio-message--${state}`;\n\t}, [recordingRoomId, rid, state]);\n\n\tif (isMicrophoneDenied) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<Box position='absolute' pi={4} pb={12} className={`rc-message-box__audio-message ${stateClass}`}>\n\t\t\t{state === 'recording' && (\n\t\t\t\t<>\n\t\t\t\t\t<MessageComposerAction\n\t\t\t\t\t\ticon='circle-cross'\n\t\t\t\t\t\tclassName='rc-message-box__icon rc-message-box__audio-message-cancel'\n\t\t\t\t\t\tonClick={handleCancelButtonClick}\n\t\t\t\t\t/>\n\t\t\t\t\t<Box className='rc-message-box__audio-message-timer' color='default'>\n\t\t\t\t\t\t<span className='rc-message-box__audio-message-timer-dot'></span>\n\t\t\t\t\t\t<span className='rc-message-box__audio-message-timer-text'>{time}</span>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<MessageComposerAction\n\t\t\t\t\t\ticon='circle-check'\n\t\t\t\t\t\tclassName='rc-message-box__icon rc-message-box__audio-message-done'\n\t\t\t\t\t\tonClick={handleDoneButtonClick}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{state === 'loading' && (\n\t\t\t\t<div className='rc-message-box__icon'>\n\t\t\t\t\t<Throbber inheritColor size='x12' />\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</Box>\n\t);\n};\n\nexport default AudioMessageRecorder;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx","inputSourceMap":{"version":3,"file":"client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx","sourceRoot":"","sources":["client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport { Box, Throbber } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { MessageComposerAction } from '@rocket.chat/ui-composer';\nimport type { ReactElement } from 'react';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { AudioRecorder } from '../../../../app/ui/client/lib/recorderjs/AudioRecorder';\nimport type { ChatAPI } from '../../../lib/chats/ChatAPI';\nimport { useChat } from '../../room/contexts/ChatContext';\n\nconst audioRecorder = new AudioRecorder();\n\ntype AudioMessageRecorderProps = {\n\trid: IRoom['_id'];\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n\tisMicrophoneDenied?: boolean;\n};\n\nconst AudioMessageRecorder = ({ rid, chatContext, isMicrophoneDenied }: AudioMessageRecorderProps): ReactElement | null => {\n\tconst { t } = useTranslation();\n\n\tconst [state, setState] = useState<'loading' | 'recording'>('recording');\n\tconst [time, setTime] = useState('00:00');\n\tconst [recordingInterval, setRecordingInterval] = useState<ReturnType<typeof setInterval> | null>(null);\n\tconst [recordingRoomId, setRecordingRoomId] = useState<IRoom['_id'] | null>(null);\n\n\tconst stopRecording = useMutableCallback(async () => {\n\t\tif (recordingInterval) {\n\t\t\tclearInterval(recordingInterval);\n\t\t}\n\t\tsetRecordingInterval(null);\n\t\tsetRecordingRoomId(null);\n\n\t\tsetTime('00:00');\n\n\t\tchat?.action.stop('recording');\n\n\t\tchat?.composer?.setRecordingMode(false);\n\n\t\tconst blob = await new Promise<Blob>((resolve) => audioRecorder.stop(resolve));\n\n\t\treturn blob;\n\t});\n\n\tconst handleUnmount = useMutableCallback(async () => {\n\t\tif (state === 'recording') {\n\t\t\tawait stopRecording();\n\t\t}\n\t});\n\n\tconst handleRecord = useMutableCallback(async () => {\n\t\tif (recordingRoomId && recordingRoomId !== rid) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait audioRecorder.start();\n\t\t\tchat?.action.performContinuously('recording');\n\t\t\tconst startTime = new Date();\n\t\t\tsetRecordingInterval(\n\t\t\t\tsetInterval(() => {\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tconst distance = (now.getTime() - startTime.getTime()) / 1000;\n\t\t\t\t\tconst minutes = Math.floor(distance / 60);\n\t\t\t\t\tconst seconds = Math.floor(distance % 60);\n\t\t\t\t\tsetTime(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);\n\t\t\t\t}, 1000),\n\t\t\t);\n\t\t\tsetRecordingRoomId(rid);\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t\tchat?.composer?.setRecordingMode(false);\n\t\t}\n\t});\n\n\tconst handleCancelButtonClick = useMutableCallback(async () => {\n\t\tawait stopRecording();\n\t});\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst handleDoneButtonClick = useMutableCallback(async () => {\n\t\tsetState('loading');\n\n\t\tconst blob = await stopRecording();\n\n\t\tconst fileName = `${t('Audio_record')}.mp3`;\n\t\tconst file = new File([blob], fileName, { type: 'audio/mpeg' });\n\n\t\tawait chat?.flows.uploadFiles([file]);\n\t});\n\n\tuseEffect(() => {\n\t\thandleRecord();\n\n\t\treturn () => {\n\t\t\thandleUnmount();\n\t\t};\n\t}, [handleUnmount, handleRecord]);\n\n\tconst stateClass = useMemo(() => {\n\t\tif (recordingRoomId && recordingRoomId !== rid) {\n\t\t\treturn 'rc-message-box__audio-message--busy';\n\t\t}\n\n\t\treturn state && `rc-message-box__audio-message--${state}`;\n\t}, [recordingRoomId, rid, state]);\n\n\tif (isMicrophoneDenied) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<Box position='absolute' pi={4} pb={12} className={`rc-message-box__audio-message ${stateClass}`}>\n\t\t\t{state === 'recording' && (\n\t\t\t\t<>\n\t\t\t\t\t<MessageComposerAction\n\t\t\t\t\t\ticon='circle-cross'\n\t\t\t\t\t\tclassName='rc-message-box__icon rc-message-box__audio-message-cancel'\n\t\t\t\t\t\tonClick={handleCancelButtonClick}\n\t\t\t\t\t/>\n\t\t\t\t\t<Box className='rc-message-box__audio-message-timer' color='default'>\n\t\t\t\t\t\t<span className='rc-message-box__audio-message-timer-dot'></span>\n\t\t\t\t\t\t<span className='rc-message-box__audio-message-timer-text'>{time}</span>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<MessageComposerAction\n\t\t\t\t\t\ticon='circle-check'\n\t\t\t\t\t\tclassName='rc-message-box__icon rc-message-box__audio-message-done'\n\t\t\t\t\t\tonClick={handleDoneButtonClick}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{state === 'loading' && (\n\t\t\t\t<div className='rc-message-box__icon'>\n\t\t\t\t\t<Throbber inheritColor size='x12' />\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</Box>\n\t);\n};\n\nexport default AudioMessageRecorder;\n"]}}},"code":"let Box, Throbber;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Box(v) {\n    Box = v;\n  },\n  Throbber(v) {\n    Throbber = v;\n  }\n}, 0);\nlet useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback(v) {\n    useMutableCallback = v;\n  }\n}, 1);\nlet MessageComposerAction;\nmodule.link(\"@rocket.chat/ui-composer\", {\n  MessageComposerAction(v) {\n    MessageComposerAction = v;\n  }\n}, 2);\nlet React, useEffect, useMemo, useState;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n  useEffect(v) {\n    useEffect = v;\n  },\n  useMemo(v) {\n    useMemo = v;\n  },\n  useState(v) {\n    useState = v;\n  }\n}, 3);\nlet useTranslation;\nmodule.link(\"react-i18next\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n}, 4);\nlet AudioRecorder;\nmodule.link(\"../../../../app/ui/client/lib/recorderjs/AudioRecorder\", {\n  AudioRecorder(v) {\n    AudioRecorder = v;\n  }\n}, 5);\nlet useChat;\nmodule.link(\"../../room/contexts/ChatContext\", {\n  useChat(v) {\n    useChat = v;\n  }\n}, 6);\nconst audioRecorder = new AudioRecorder();\nconst AudioMessageRecorder = _ref => {\n  var _useChat;\n  let {\n    rid,\n    chatContext,\n    isMicrophoneDenied\n  } = _ref;\n  const {\n    t\n  } = useTranslation();\n  const [state, setState] = useState('recording');\n  const [time, setTime] = useState('00:00');\n  const [recordingInterval, setRecordingInterval] = useState(null);\n  const [recordingRoomId, setRecordingRoomId] = useState(null);\n  const stopRecording = useMutableCallback(async () => {\n    var _chat$composer;\n    if (recordingInterval) {\n      clearInterval(recordingInterval);\n    }\n    setRecordingInterval(null);\n    setRecordingRoomId(null);\n    setTime('00:00');\n    chat === null || chat === void 0 ? void 0 : chat.action.stop('recording');\n    chat === null || chat === void 0 ? void 0 : (_chat$composer = chat.composer) === null || _chat$composer === void 0 ? void 0 : _chat$composer.setRecordingMode(false);\n    const blob = await new Promise(resolve => audioRecorder.stop(resolve));\n    return blob;\n  });\n  const handleUnmount = useMutableCallback(async () => {\n    if (state === 'recording') {\n      await stopRecording();\n    }\n  });\n  const handleRecord = useMutableCallback(async () => {\n    if (recordingRoomId && recordingRoomId !== rid) {\n      return;\n    }\n    try {\n      await audioRecorder.start();\n      chat === null || chat === void 0 ? void 0 : chat.action.performContinuously('recording');\n      const startTime = new Date();\n      setRecordingInterval(setInterval(() => {\n        const now = new Date();\n        const distance = (now.getTime() - startTime.getTime()) / 1000;\n        const minutes = Math.floor(distance / 60);\n        const seconds = Math.floor(distance % 60);\n        setTime(\"\".concat(String(minutes).padStart(2, '0'), \":\").concat(String(seconds).padStart(2, '0')));\n      }, 1000));\n      setRecordingRoomId(rid);\n    } catch (error) {\n      var _chat$composer2;\n      console.log(error);\n      chat === null || chat === void 0 ? void 0 : (_chat$composer2 = chat.composer) === null || _chat$composer2 === void 0 ? void 0 : _chat$composer2.setRecordingMode(false);\n    }\n  });\n  const handleCancelButtonClick = useMutableCallback(async () => {\n    await stopRecording();\n  });\n  const chat = (_useChat = useChat()) !== null && _useChat !== void 0 ? _useChat : chatContext;\n  const handleDoneButtonClick = useMutableCallback(async () => {\n    setState('loading');\n    const blob = await stopRecording();\n    const fileName = \"\".concat(t('Audio_record'), \".mp3\");\n    const file = new File([blob], fileName, {\n      type: 'audio/mpeg'\n    });\n    await (chat === null || chat === void 0 ? void 0 : chat.flows.uploadFiles([file]));\n  });\n  useEffect(() => {\n    handleRecord();\n    return () => {\n      handleUnmount();\n    };\n  }, [handleUnmount, handleRecord]);\n  const stateClass = useMemo(() => {\n    if (recordingRoomId && recordingRoomId !== rid) {\n      return 'rc-message-box__audio-message--busy';\n    }\n    return state && \"rc-message-box__audio-message--\".concat(state);\n  }, [recordingRoomId, rid, state]);\n  if (isMicrophoneDenied) {\n    return null;\n  }\n  return /*#__PURE__*/React.createElement(Box, {\n    position: \"absolute\",\n    pi: 4,\n    pb: 12,\n    className: \"rc-message-box__audio-message \".concat(stateClass)\n  }, state === 'recording' && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(MessageComposerAction, {\n    icon: \"circle-cross\",\n    className: \"rc-message-box__icon rc-message-box__audio-message-cancel\",\n    onClick: handleCancelButtonClick\n  }), /*#__PURE__*/React.createElement(Box, {\n    className: \"rc-message-box__audio-message-timer\",\n    color: \"default\"\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"rc-message-box__audio-message-timer-dot\"\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"rc-message-box__audio-message-timer-text\"\n  }, time)), /*#__PURE__*/React.createElement(MessageComposerAction, {\n    icon: \"circle-check\",\n    className: \"rc-message-box__icon rc-message-box__audio-message-done\",\n    onClick: handleDoneButtonClick\n  })), state === 'loading' && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"rc-message-box__icon\"\n  }, /*#__PURE__*/React.createElement(Throbber, {\n    inheritColor: true,\n    size: \"x12\"\n  })));\n};\nmodule.exportDefault(AudioMessageRecorder);","map":{"version":3,"names":["Box","Throbber","module","link","v","useMutableCallback","MessageComposerAction","React","useEffect","useMemo","useState","default","useTranslation","AudioRecorder","useChat","audioRecorder","AudioMessageRecorder","_ref","_useChat","rid","chatContext","isMicrophoneDenied","t","state","setState","time","setTime","recordingInterval","setRecordingInterval","recordingRoomId","setRecordingRoomId","stopRecording","_chat$composer","clearInterval","chat","action","stop","composer","setRecordingMode","blob","Promise","resolve","handleUnmount","handleRecord","start","performContinuously","startTime","Date","setInterval","now","distance","getTime","minutes","Math","floor","seconds","concat","String","padStart","error","_chat$composer2","console","log","handleCancelButtonClick","handleDoneButtonClick","fileName","file","File","type","flows","uploadFiles","stateClass","createElement","position","pi","pb","className","Fragment","icon","onClick","color","inheritColor","size","exportDefault"],"sources":["client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx"],"sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport { Box, Throbber } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { MessageComposerAction } from '@rocket.chat/ui-composer';\nimport type { ReactElement } from 'react';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { AudioRecorder } from '../../../../app/ui/client/lib/recorderjs/AudioRecorder';\nimport type { ChatAPI } from '../../../lib/chats/ChatAPI';\nimport { useChat } from '../../room/contexts/ChatContext';\n\nconst audioRecorder = new AudioRecorder();\n\ntype AudioMessageRecorderProps = {\n\trid: IRoom['_id'];\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n\tisMicrophoneDenied?: boolean;\n};\n\nconst AudioMessageRecorder = ({ rid, chatContext, isMicrophoneDenied }: AudioMessageRecorderProps): ReactElement | null => {\n\tconst { t } = useTranslation();\n\n\tconst [state, setState] = useState<'loading' | 'recording'>('recording');\n\tconst [time, setTime] = useState('00:00');\n\tconst [recordingInterval, setRecordingInterval] = useState<ReturnType<typeof setInterval> | null>(null);\n\tconst [recordingRoomId, setRecordingRoomId] = useState<IRoom['_id'] | null>(null);\n\n\tconst stopRecording = useMutableCallback(async () => {\n\t\tif (recordingInterval) {\n\t\t\tclearInterval(recordingInterval);\n\t\t}\n\t\tsetRecordingInterval(null);\n\t\tsetRecordingRoomId(null);\n\n\t\tsetTime('00:00');\n\n\t\tchat?.action.stop('recording');\n\n\t\tchat?.composer?.setRecordingMode(false);\n\n\t\tconst blob = await new Promise<Blob>((resolve) => audioRecorder.stop(resolve));\n\n\t\treturn blob;\n\t});\n\n\tconst handleUnmount = useMutableCallback(async () => {\n\t\tif (state === 'recording') {\n\t\t\tawait stopRecording();\n\t\t}\n\t});\n\n\tconst handleRecord = useMutableCallback(async () => {\n\t\tif (recordingRoomId && recordingRoomId !== rid) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait audioRecorder.start();\n\t\t\tchat?.action.performContinuously('recording');\n\t\t\tconst startTime = new Date();\n\t\t\tsetRecordingInterval(\n\t\t\t\tsetInterval(() => {\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tconst distance = (now.getTime() - startTime.getTime()) / 1000;\n\t\t\t\t\tconst minutes = Math.floor(distance / 60);\n\t\t\t\t\tconst seconds = Math.floor(distance % 60);\n\t\t\t\t\tsetTime(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);\n\t\t\t\t}, 1000),\n\t\t\t);\n\t\t\tsetRecordingRoomId(rid);\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t\tchat?.composer?.setRecordingMode(false);\n\t\t}\n\t});\n\n\tconst handleCancelButtonClick = useMutableCallback(async () => {\n\t\tawait stopRecording();\n\t});\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst handleDoneButtonClick = useMutableCallback(async () => {\n\t\tsetState('loading');\n\n\t\tconst blob = await stopRecording();\n\n\t\tconst fileName = `${t('Audio_record')}.mp3`;\n\t\tconst file = new File([blob], fileName, { type: 'audio/mpeg' });\n\n\t\tawait chat?.flows.uploadFiles([file]);\n\t});\n\n\tuseEffect(() => {\n\t\thandleRecord();\n\n\t\treturn () => {\n\t\t\thandleUnmount();\n\t\t};\n\t}, [handleUnmount, handleRecord]);\n\n\tconst stateClass = useMemo(() => {\n\t\tif (recordingRoomId && recordingRoomId !== rid) {\n\t\t\treturn 'rc-message-box__audio-message--busy';\n\t\t}\n\n\t\treturn state && `rc-message-box__audio-message--${state}`;\n\t}, [recordingRoomId, rid, state]);\n\n\tif (isMicrophoneDenied) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<Box position='absolute' pi={4} pb={12} className={`rc-message-box__audio-message ${stateClass}`}>\n\t\t\t{state === 'recording' && (\n\t\t\t\t<>\n\t\t\t\t\t<MessageComposerAction\n\t\t\t\t\t\ticon='circle-cross'\n\t\t\t\t\t\tclassName='rc-message-box__icon rc-message-box__audio-message-cancel'\n\t\t\t\t\t\tonClick={handleCancelButtonClick}\n\t\t\t\t\t/>\n\t\t\t\t\t<Box className='rc-message-box__audio-message-timer' color='default'>\n\t\t\t\t\t\t<span className='rc-message-box__audio-message-timer-dot'></span>\n\t\t\t\t\t\t<span className='rc-message-box__audio-message-timer-text'>{time}</span>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<MessageComposerAction\n\t\t\t\t\t\ticon='circle-check'\n\t\t\t\t\t\tclassName='rc-message-box__icon rc-message-box__audio-message-done'\n\t\t\t\t\t\tonClick={handleDoneButtonClick}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{state === 'loading' && (\n\t\t\t\t<div className='rc-message-box__icon'>\n\t\t\t\t\t<Throbber inheritColor size='x12' />\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</Box>\n\t);\n};\n\nexport default AudioMessageRecorder;\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"400099368c067b7819f9b085f9941d38a574c72f"}
