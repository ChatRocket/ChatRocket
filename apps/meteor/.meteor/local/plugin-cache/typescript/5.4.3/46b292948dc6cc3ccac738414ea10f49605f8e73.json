{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/notifications/konchatNotifications.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/startup/notifications/konchatNotifications.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/notifications/konchatNotifications.ts","inputSourceMap":{"version":3,"file":"client/startup/notifications/konchatNotifications.ts","sourceRoot":"","sources":["client/startup/notifications/konchatNotifications.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AtLeast, ISubscription, IUser, ICalendarNotification } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\nimport { lazy } from 'react';\n\nimport { CachedChatSubscription } from '../../../app/models/client';\nimport { settings } from '../../../app/settings/client';\nimport { KonchatNotification } from '../../../app/ui/client/lib/KonchatNotification';\nimport { getUserPreference } from '../../../app/utils/client';\nimport { sdk } from '../../../app/utils/client/lib/SDKClient';\nimport { RoomManager } from '../../lib/RoomManager';\nimport { imperativeModal } from '../../lib/imperativeModal';\nimport { fireGlobalEvent } from '../../lib/utils/fireGlobalEvent';\nimport { isLayoutEmbedded } from '../../lib/utils/isLayoutEmbedded';\nimport { router } from '../../providers/RouterProvider';\n\nconst OutlookCalendarEventModal = lazy(() => import('../../views/outlookCalendar/OutlookCalendarEventModal'));\n\nconst notifyNewRoom = async (sub: AtLeast<ISubscription, 'rid'>): Promise<void> => {\n\tconst user = Meteor.user() as IUser | null;\n\tif (!user || user.status === 'busy') {\n\t\treturn;\n\t}\n\n\tif ((!router.getRouteParameters().name || router.getRouteParameters().name !== sub.name) && !sub.ls && sub.alert === true) {\n\t\tKonchatNotification.newRoom(sub.rid);\n\t}\n};\n\nfunction notifyNewMessageAudio(rid?: string): void {\n\t// This logic is duplicated in /client/startup/unread.coffee.\n\tconst hasFocus = document.hasFocus();\n\tconst messageIsInOpenedRoom = RoomManager.opened === rid;\n\tconst muteFocusedConversations = getUserPreference(Meteor.userId(), 'muteFocusedConversations');\n\n\tif (isLayoutEmbedded()) {\n\t\tif (!hasFocus && messageIsInOpenedRoom) {\n\t\t\t// Play a notification sound\n\t\t\tvoid KonchatNotification.newMessage(rid);\n\t\t}\n\t} else if (!hasFocus || !messageIsInOpenedRoom || !muteFocusedConversations) {\n\t\t// Play a notification sound\n\t\tvoid KonchatNotification.newMessage(rid);\n\t}\n}\n\nMeteor.startup(() => {\n\tconst notifyUserCalendar = async function (notification: ICalendarNotification): Promise<void> {\n\t\tconst user = Meteor.user() as IUser | null;\n\t\tif (!user || user.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst requireInteraction = getUserPreference<boolean>(Meteor.userId(), 'desktopNotificationRequireInteraction');\n\n\t\tconst n = new Notification(notification.title, {\n\t\t\tbody: notification.text,\n\t\t\ttag: notification.payload._id,\n\t\t\tsilent: true,\n\t\t\trequireInteraction,\n\t\t} as NotificationOptions);\n\n\t\tn.onclick = function () {\n\t\t\tthis.close();\n\t\t\twindow.focus();\n\t\t\timperativeModal.open({\n\t\t\t\tcomponent: OutlookCalendarEventModal,\n\t\t\t\tprops: { id: notification.payload._id, onClose: imperativeModal.close, onCancel: imperativeModal.close },\n\t\t\t});\n\t\t};\n\t};\n\n\tTracker.autorun(() => {\n\t\tif (!Meteor.userId() || !settings.get('Outlook_Calendar_Enabled')) {\n\t\t\tsdk.stop('notify-user', `${Meteor.userId()}/calendar`);\n\t\t\treturn;\n\t\t}\n\n\t\tsdk.stream('notify-user', [`${Meteor.userId()}/calendar`], notifyUserCalendar);\n\t});\n\n\tTracker.autorun(() => {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn;\n\t\t}\n\n\t\tsdk.stream('notify-user', [`${Meteor.userId()}/notification`], (notification) => {\n\t\t\tconst openedRoomId = ['channel', 'group', 'direct'].includes(router.getRouteName()!) ? RoomManager.opened : undefined;\n\n\t\t\t// This logic is duplicated in /client/startup/unread.coffee.\n\t\t\tconst hasFocus = document.hasFocus();\n\t\t\tconst messageIsInOpenedRoom = openedRoomId === notification.payload.rid;\n\n\t\t\tfireGlobalEvent('notification', {\n\t\t\t\tnotification,\n\t\t\t\tfromOpenedRoom: messageIsInOpenedRoom,\n\t\t\t\thasFocus,\n\t\t\t});\n\n\t\t\tif (isLayoutEmbedded()) {\n\t\t\t\tif (!hasFocus && messageIsInOpenedRoom) {\n\t\t\t\t\t// Show a notification.\n\t\t\t\t\tKonchatNotification.showDesktop(notification);\n\t\t\t\t}\n\t\t\t} else if (!hasFocus || !messageIsInOpenedRoom) {\n\t\t\t\t// Show a notification.\n\t\t\t\tKonchatNotification.showDesktop(notification);\n\t\t\t}\n\n\t\t\tnotifyNewMessageAudio(notification.payload.rid);\n\t\t});\n\n\t\tCachedChatSubscription.collection.find().observe({\n\t\t\tchanged: (sub) => {\n\t\t\t\tvoid notifyNewRoom(sub);\n\t\t\t},\n\t\t});\n\n\t\tsdk.stream('notify-user', [`${Meteor.userId()}/subscriptions-changed`], (action, sub) => {\n\t\t\tif (action === 'removed') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvoid notifyNewRoom(sub);\n\t\t});\n\t});\n});\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/notifications/konchatNotifications.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/startup/notifications/konchatNotifications.ts","inputSourceMap":{"version":3,"file":"client/startup/notifications/konchatNotifications.ts","sourceRoot":"","sources":["client/startup/notifications/konchatNotifications.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AtLeast, ISubscription, IUser, ICalendarNotification } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\nimport { lazy } from 'react';\n\nimport { CachedChatSubscription } from '../../../app/models/client';\nimport { settings } from '../../../app/settings/client';\nimport { KonchatNotification } from '../../../app/ui/client/lib/KonchatNotification';\nimport { getUserPreference } from '../../../app/utils/client';\nimport { sdk } from '../../../app/utils/client/lib/SDKClient';\nimport { RoomManager } from '../../lib/RoomManager';\nimport { imperativeModal } from '../../lib/imperativeModal';\nimport { fireGlobalEvent } from '../../lib/utils/fireGlobalEvent';\nimport { isLayoutEmbedded } from '../../lib/utils/isLayoutEmbedded';\nimport { router } from '../../providers/RouterProvider';\n\nconst OutlookCalendarEventModal = lazy(() => import('../../views/outlookCalendar/OutlookCalendarEventModal'));\n\nconst notifyNewRoom = async (sub: AtLeast<ISubscription, 'rid'>): Promise<void> => {\n\tconst user = Meteor.user() as IUser | null;\n\tif (!user || user.status === 'busy') {\n\t\treturn;\n\t}\n\n\tif ((!router.getRouteParameters().name || router.getRouteParameters().name !== sub.name) && !sub.ls && sub.alert === true) {\n\t\tKonchatNotification.newRoom(sub.rid);\n\t}\n};\n\nfunction notifyNewMessageAudio(rid?: string): void {\n\t// This logic is duplicated in /client/startup/unread.coffee.\n\tconst hasFocus = document.hasFocus();\n\tconst messageIsInOpenedRoom = RoomManager.opened === rid;\n\tconst muteFocusedConversations = getUserPreference(Meteor.userId(), 'muteFocusedConversations');\n\n\tif (isLayoutEmbedded()) {\n\t\tif (!hasFocus && messageIsInOpenedRoom) {\n\t\t\t// Play a notification sound\n\t\t\tvoid KonchatNotification.newMessage(rid);\n\t\t}\n\t} else if (!hasFocus || !messageIsInOpenedRoom || !muteFocusedConversations) {\n\t\t// Play a notification sound\n\t\tvoid KonchatNotification.newMessage(rid);\n\t}\n}\n\nMeteor.startup(() => {\n\tconst notifyUserCalendar = async function (notification: ICalendarNotification): Promise<void> {\n\t\tconst user = Meteor.user() as IUser | null;\n\t\tif (!user || user.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst requireInteraction = getUserPreference<boolean>(Meteor.userId(), 'desktopNotificationRequireInteraction');\n\n\t\tconst n = new Notification(notification.title, {\n\t\t\tbody: notification.text,\n\t\t\ttag: notification.payload._id,\n\t\t\tsilent: true,\n\t\t\trequireInteraction,\n\t\t} as NotificationOptions);\n\n\t\tn.onclick = function () {\n\t\t\tthis.close();\n\t\t\twindow.focus();\n\t\t\timperativeModal.open({\n\t\t\t\tcomponent: OutlookCalendarEventModal,\n\t\t\t\tprops: { id: notification.payload._id, onClose: imperativeModal.close, onCancel: imperativeModal.close },\n\t\t\t});\n\t\t};\n\t};\n\n\tTracker.autorun(() => {\n\t\tif (!Meteor.userId() || !settings.get('Outlook_Calendar_Enabled')) {\n\t\t\tsdk.stop('notify-user', `${Meteor.userId()}/calendar`);\n\t\t\treturn;\n\t\t}\n\n\t\tsdk.stream('notify-user', [`${Meteor.userId()}/calendar`], notifyUserCalendar);\n\t});\n\n\tTracker.autorun(() => {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn;\n\t\t}\n\n\t\tsdk.stream('notify-user', [`${Meteor.userId()}/notification`], (notification) => {\n\t\t\tconst openedRoomId = ['channel', 'group', 'direct'].includes(router.getRouteName()!) ? RoomManager.opened : undefined;\n\n\t\t\t// This logic is duplicated in /client/startup/unread.coffee.\n\t\t\tconst hasFocus = document.hasFocus();\n\t\t\tconst messageIsInOpenedRoom = openedRoomId === notification.payload.rid;\n\n\t\t\tfireGlobalEvent('notification', {\n\t\t\t\tnotification,\n\t\t\t\tfromOpenedRoom: messageIsInOpenedRoom,\n\t\t\t\thasFocus,\n\t\t\t});\n\n\t\t\tif (isLayoutEmbedded()) {\n\t\t\t\tif (!hasFocus && messageIsInOpenedRoom) {\n\t\t\t\t\t// Show a notification.\n\t\t\t\t\tKonchatNotification.showDesktop(notification);\n\t\t\t\t}\n\t\t\t} else if (!hasFocus || !messageIsInOpenedRoom) {\n\t\t\t\t// Show a notification.\n\t\t\t\tKonchatNotification.showDesktop(notification);\n\t\t\t}\n\n\t\t\tnotifyNewMessageAudio(notification.payload.rid);\n\t\t});\n\n\t\tCachedChatSubscription.collection.find().observe({\n\t\t\tchanged: (sub) => {\n\t\t\t\tvoid notifyNewRoom(sub);\n\t\t\t},\n\t\t});\n\n\t\tsdk.stream('notify-user', [`${Meteor.userId()}/subscriptions-changed`], (action, sub) => {\n\t\t\tif (action === 'removed') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvoid notifyNewRoom(sub);\n\t\t});\n\t});\n});\n"]}}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n}, 0);\nlet Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker(v) {\n    Tracker = v;\n  }\n}, 1);\nlet lazy;\nmodule.link(\"react\", {\n  lazy(v) {\n    lazy = v;\n  }\n}, 2);\nlet CachedChatSubscription;\nmodule.link(\"../../../app/models/client\", {\n  CachedChatSubscription(v) {\n    CachedChatSubscription = v;\n  }\n}, 3);\nlet settings;\nmodule.link(\"../../../app/settings/client\", {\n  settings(v) {\n    settings = v;\n  }\n}, 4);\nlet KonchatNotification;\nmodule.link(\"../../../app/ui/client/lib/KonchatNotification\", {\n  KonchatNotification(v) {\n    KonchatNotification = v;\n  }\n}, 5);\nlet getUserPreference;\nmodule.link(\"../../../app/utils/client\", {\n  getUserPreference(v) {\n    getUserPreference = v;\n  }\n}, 6);\nlet sdk;\nmodule.link(\"../../../app/utils/client/lib/SDKClient\", {\n  sdk(v) {\n    sdk = v;\n  }\n}, 7);\nlet RoomManager;\nmodule.link(\"../../lib/RoomManager\", {\n  RoomManager(v) {\n    RoomManager = v;\n  }\n}, 8);\nlet imperativeModal;\nmodule.link(\"../../lib/imperativeModal\", {\n  imperativeModal(v) {\n    imperativeModal = v;\n  }\n}, 9);\nlet fireGlobalEvent;\nmodule.link(\"../../lib/utils/fireGlobalEvent\", {\n  fireGlobalEvent(v) {\n    fireGlobalEvent = v;\n  }\n}, 10);\nlet isLayoutEmbedded;\nmodule.link(\"../../lib/utils/isLayoutEmbedded\", {\n  isLayoutEmbedded(v) {\n    isLayoutEmbedded = v;\n  }\n}, 11);\nlet router;\nmodule.link(\"../../providers/RouterProvider\", {\n  router(v) {\n    router = v;\n  }\n}, 12);\nconst OutlookCalendarEventModal = /*#__PURE__*/lazy(() => module.dynamicImport('../../views/outlookCalendar/OutlookCalendarEventModal'));\nconst notifyNewRoom = async sub => {\n  const user = Meteor.user();\n  if (!user || user.status === 'busy') {\n    return;\n  }\n  if ((!router.getRouteParameters().name || router.getRouteParameters().name !== sub.name) && !sub.ls && sub.alert === true) {\n    KonchatNotification.newRoom(sub.rid);\n  }\n};\nfunction notifyNewMessageAudio(rid) {\n  // This logic is duplicated in /client/startup/unread.coffee.\n  const hasFocus = document.hasFocus();\n  const messageIsInOpenedRoom = RoomManager.opened === rid;\n  const muteFocusedConversations = getUserPreference(Meteor.userId(), 'muteFocusedConversations');\n  if (isLayoutEmbedded()) {\n    if (!hasFocus && messageIsInOpenedRoom) {\n      // Play a notification sound\n      void KonchatNotification.newMessage(rid);\n    }\n  } else if (!hasFocus || !messageIsInOpenedRoom || !muteFocusedConversations) {\n    // Play a notification sound\n    void KonchatNotification.newMessage(rid);\n  }\n}\nMeteor.startup(() => {\n  const notifyUserCalendar = async function (notification) {\n    const user = Meteor.user();\n    if (!user || user.status === 'busy') {\n      return;\n    }\n    const requireInteraction = getUserPreference(Meteor.userId(), 'desktopNotificationRequireInteraction');\n    const n = new Notification(notification.title, {\n      body: notification.text,\n      tag: notification.payload._id,\n      silent: true,\n      requireInteraction\n    });\n    n.onclick = function () {\n      this.close();\n      window.focus();\n      imperativeModal.open({\n        component: OutlookCalendarEventModal,\n        props: {\n          id: notification.payload._id,\n          onClose: imperativeModal.close,\n          onCancel: imperativeModal.close\n        }\n      });\n    };\n  };\n  Tracker.autorun(() => {\n    if (!Meteor.userId() || !settings.get('Outlook_Calendar_Enabled')) {\n      sdk.stop('notify-user', \"\".concat(Meteor.userId(), \"/calendar\"));\n      return;\n    }\n    sdk.stream('notify-user', [\"\".concat(Meteor.userId(), \"/calendar\")], notifyUserCalendar);\n  });\n  Tracker.autorun(() => {\n    if (!Meteor.userId()) {\n      return;\n    }\n    sdk.stream('notify-user', [\"\".concat(Meteor.userId(), \"/notification\")], notification => {\n      const openedRoomId = ['channel', 'group', 'direct'].includes(router.getRouteName()) ? RoomManager.opened : undefined;\n      // This logic is duplicated in /client/startup/unread.coffee.\n      const hasFocus = document.hasFocus();\n      const messageIsInOpenedRoom = openedRoomId === notification.payload.rid;\n      fireGlobalEvent('notification', {\n        notification,\n        fromOpenedRoom: messageIsInOpenedRoom,\n        hasFocus\n      });\n      if (isLayoutEmbedded()) {\n        if (!hasFocus && messageIsInOpenedRoom) {\n          // Show a notification.\n          KonchatNotification.showDesktop(notification);\n        }\n      } else if (!hasFocus || !messageIsInOpenedRoom) {\n        // Show a notification.\n        KonchatNotification.showDesktop(notification);\n      }\n      notifyNewMessageAudio(notification.payload.rid);\n    });\n    CachedChatSubscription.collection.find().observe({\n      changed: sub => {\n        void notifyNewRoom(sub);\n      }\n    });\n    sdk.stream('notify-user', [\"\".concat(Meteor.userId(), \"/subscriptions-changed\")], (action, sub) => {\n      if (action === 'removed') {\n        return;\n      }\n      void notifyNewRoom(sub);\n    });\n  });\n});","map":{"version":3,"names":["Meteor","module","link","v","Tracker","lazy","CachedChatSubscription","settings","KonchatNotification","getUserPreference","sdk","RoomManager","imperativeModal","fireGlobalEvent","isLayoutEmbedded","router","OutlookCalendarEventModal","dynamicImport","notifyNewRoom","sub","user","status","getRouteParameters","name","ls","alert","newRoom","rid","notifyNewMessageAudio","hasFocus","document","messageIsInOpenedRoom","opened","muteFocusedConversations","userId","newMessage","startup","notifyUserCalendar","notification","requireInteraction","n","Notification","title","body","text","tag","payload","_id","silent","onclick","close","window","focus","open","component","props","id","onClose","onCancel","autorun","get","stop","concat","stream","openedRoomId","includes","getRouteName","undefined","fromOpenedRoom","showDesktop","collection","find","observe","changed","action"],"sources":["client/startup/notifications/konchatNotifications.ts"],"sourcesContent":["import type { AtLeast, ISubscription, IUser, ICalendarNotification } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\nimport { lazy } from 'react';\n\nimport { CachedChatSubscription } from '../../../app/models/client';\nimport { settings } from '../../../app/settings/client';\nimport { KonchatNotification } from '../../../app/ui/client/lib/KonchatNotification';\nimport { getUserPreference } from '../../../app/utils/client';\nimport { sdk } from '../../../app/utils/client/lib/SDKClient';\nimport { RoomManager } from '../../lib/RoomManager';\nimport { imperativeModal } from '../../lib/imperativeModal';\nimport { fireGlobalEvent } from '../../lib/utils/fireGlobalEvent';\nimport { isLayoutEmbedded } from '../../lib/utils/isLayoutEmbedded';\nimport { router } from '../../providers/RouterProvider';\n\nconst OutlookCalendarEventModal = lazy(() => import('../../views/outlookCalendar/OutlookCalendarEventModal'));\n\nconst notifyNewRoom = async (sub: AtLeast<ISubscription, 'rid'>): Promise<void> => {\n\tconst user = Meteor.user() as IUser | null;\n\tif (!user || user.status === 'busy') {\n\t\treturn;\n\t}\n\n\tif ((!router.getRouteParameters().name || router.getRouteParameters().name !== sub.name) && !sub.ls && sub.alert === true) {\n\t\tKonchatNotification.newRoom(sub.rid);\n\t}\n};\n\nfunction notifyNewMessageAudio(rid?: string): void {\n\t// This logic is duplicated in /client/startup/unread.coffee.\n\tconst hasFocus = document.hasFocus();\n\tconst messageIsInOpenedRoom = RoomManager.opened === rid;\n\tconst muteFocusedConversations = getUserPreference(Meteor.userId(), 'muteFocusedConversations');\n\n\tif (isLayoutEmbedded()) {\n\t\tif (!hasFocus && messageIsInOpenedRoom) {\n\t\t\t// Play a notification sound\n\t\t\tvoid KonchatNotification.newMessage(rid);\n\t\t}\n\t} else if (!hasFocus || !messageIsInOpenedRoom || !muteFocusedConversations) {\n\t\t// Play a notification sound\n\t\tvoid KonchatNotification.newMessage(rid);\n\t}\n}\n\nMeteor.startup(() => {\n\tconst notifyUserCalendar = async function (notification: ICalendarNotification): Promise<void> {\n\t\tconst user = Meteor.user() as IUser | null;\n\t\tif (!user || user.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst requireInteraction = getUserPreference<boolean>(Meteor.userId(), 'desktopNotificationRequireInteraction');\n\n\t\tconst n = new Notification(notification.title, {\n\t\t\tbody: notification.text,\n\t\t\ttag: notification.payload._id,\n\t\t\tsilent: true,\n\t\t\trequireInteraction,\n\t\t} as NotificationOptions);\n\n\t\tn.onclick = function () {\n\t\t\tthis.close();\n\t\t\twindow.focus();\n\t\t\timperativeModal.open({\n\t\t\t\tcomponent: OutlookCalendarEventModal,\n\t\t\t\tprops: { id: notification.payload._id, onClose: imperativeModal.close, onCancel: imperativeModal.close },\n\t\t\t});\n\t\t};\n\t};\n\n\tTracker.autorun(() => {\n\t\tif (!Meteor.userId() || !settings.get('Outlook_Calendar_Enabled')) {\n\t\t\tsdk.stop('notify-user', `${Meteor.userId()}/calendar`);\n\t\t\treturn;\n\t\t}\n\n\t\tsdk.stream('notify-user', [`${Meteor.userId()}/calendar`], notifyUserCalendar);\n\t});\n\n\tTracker.autorun(() => {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn;\n\t\t}\n\n\t\tsdk.stream('notify-user', [`${Meteor.userId()}/notification`], (notification) => {\n\t\t\tconst openedRoomId = ['channel', 'group', 'direct'].includes(router.getRouteName()!) ? RoomManager.opened : undefined;\n\n\t\t\t// This logic is duplicated in /client/startup/unread.coffee.\n\t\t\tconst hasFocus = document.hasFocus();\n\t\t\tconst messageIsInOpenedRoom = openedRoomId === notification.payload.rid;\n\n\t\t\tfireGlobalEvent('notification', {\n\t\t\t\tnotification,\n\t\t\t\tfromOpenedRoom: messageIsInOpenedRoom,\n\t\t\t\thasFocus,\n\t\t\t});\n\n\t\t\tif (isLayoutEmbedded()) {\n\t\t\t\tif (!hasFocus && messageIsInOpenedRoom) {\n\t\t\t\t\t// Show a notification.\n\t\t\t\t\tKonchatNotification.showDesktop(notification);\n\t\t\t\t}\n\t\t\t} else if (!hasFocus || !messageIsInOpenedRoom) {\n\t\t\t\t// Show a notification.\n\t\t\t\tKonchatNotification.showDesktop(notification);\n\t\t\t}\n\n\t\t\tnotifyNewMessageAudio(notification.payload.rid);\n\t\t});\n\n\t\tCachedChatSubscription.collection.find().observe({\n\t\t\tchanged: (sub) => {\n\t\t\t\tvoid notifyNewRoom(sub);\n\t\t\t},\n\t\t});\n\n\t\tsdk.stream('notify-user', [`${Meteor.userId()}/subscriptions-changed`], (action, sub) => {\n\t\t\tif (action === 'removed') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvoid notifyNewRoom(sub);\n\t\t});\n\t});\n});\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"46b292948dc6cc3ccac738414ea10f49605f8e73"}
