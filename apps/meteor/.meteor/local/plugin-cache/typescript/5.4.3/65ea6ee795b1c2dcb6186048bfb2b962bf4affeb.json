{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/providers/CallProvider/CallProvider.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/providers/CallProvider/CallProvider.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/providers/CallProvider/CallProvider.tsx","inputSourceMap":{"version":3,"file":"client/providers/CallProvider/CallProvider.tsx","sourceRoot":"","sources":["client/providers/CallProvider/CallProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IVoipRoom, VoipEventDataSignature, ICallerInfo, ICallDetails, ILivechatVisitor, Serialized } from '@rocket.chat/core-typings';\nimport {\n\tVoipClientEvents,\n\tisVoipEventAgentCalled,\n\tisVoipEventAgentConnected,\n\tisVoipEventCallerJoined,\n\tisVoipEventQueueMemberAdded,\n\tisVoipEventQueueMemberRemoved,\n\tisVoipEventCallAbandoned,\n\tUserState,\n} from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { Random } from '@rocket.chat/random';\nimport type { Device } from '@rocket.chat/ui-contexts';\nimport {\n\tuseRouter,\n\tuseUser,\n\tuseSetting,\n\tuseEndpoint,\n\tuseStream,\n\tuseSetOutputMediaDevice,\n\tuseSetInputMediaDevice,\n\tuseSetModal,\n\tuseTranslation,\n} from '@rocket.chat/ui-contexts';\nimport type { ReactNode } from 'react';\nimport React, { useMemo, useRef, useCallback, useEffect, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport type { OutgoingByeRequest } from 'sip.js/lib/core';\n\nimport type { CallContextValue } from '../../contexts/CallContext';\nimport { CallContext, useIsVoipEnterprise } from '../../contexts/CallContext';\nimport { useDialModal } from '../../hooks/useDialModal';\nimport { isOutboundClient, useVoipClient } from '../../hooks/useVoipClient';\nimport { roomCoordinator } from '../../lib/rooms/roomCoordinator';\nimport type { QueueAggregator } from '../../lib/voip/QueueAggregator';\nimport { parseOutboundPhoneNumber } from '../../lib/voip/parseOutboundPhoneNumber';\nimport { WrapUpCallModal } from '../../voip/components/modals/WrapUpCallModal';\nimport { useVoipSounds } from './hooks/useVoipSounds';\n\ntype NetworkState = 'online' | 'offline';\n\ntype CallProviderProps = {\n\tchildren?: ReactNode;\n};\n\nexport const CallProvider = ({ children }: CallProviderProps) => {\n\tconst [clientState, setClientState] = useState<'registered' | 'unregistered'>('unregistered');\n\n\tconst voipEnabled = useSetting('VoIP_Enabled');\n\tconst subscribeToNotifyUser = useStream('notify-user');\n\tconst dispatchEvent = useEndpoint('POST', '/v1/voip/events');\n\tconst visitorEndpoint = useEndpoint('POST', '/v1/livechat/visitor');\n\tconst voipEndpoint = useEndpoint('GET', '/v1/voip/room');\n\tconst voipCloseRoomEndpoint = useEndpoint('POST', '/v1/voip/room.close');\n\tconst getContactBy = useEndpoint('GET', '/v1/omnichannel/contact.search');\n\tconst setModal = useSetModal();\n\tconst t = useTranslation();\n\n\tconst result = useVoipClient();\n\tconst user = useUser();\n\tconst router = useRouter();\n\tconst setOutputMediaDevice = useSetOutputMediaDevice();\n\tconst setInputMediaDevice = useSetInputMediaDevice();\n\n\tconst hasVoIPEnterpriseLicense = useIsVoipEnterprise();\n\n\tconst remoteAudioMediaRef = useRef<HTMLAudioElement>(null); // TODO: Create a dedicated file for the AUDIO and make the controls accessible\n\n\tconst [queueCounter, setQueueCounter] = useState(0);\n\tconst [queueName, setQueueName] = useState('');\n\tconst [roomInfo, setRoomInfo] = useState<{ v: { token?: string }; rid: string }>({ v: {}, rid: '' });\n\n\tconst { openDialModal } = useDialModal();\n\n\tconst voipSounds = useVoipSounds();\n\n\tconst closeRoom = useCallback(\n\t\tasync (data = {}): Promise<void> => {\n\t\t\troomInfo &&\n\t\t\t\t(await voipCloseRoomEndpoint({\n\t\t\t\t\trid: roomInfo.rid,\n\t\t\t\t\ttoken: roomInfo.v.token || '',\n\t\t\t\t\toptions: { comment: data?.comment, tags: data?.tags },\n\t\t\t\t}));\n\t\t\trouter.navigate('/home');\n\n\t\t\tconst queueAggregator = result.voipClient?.getAggregator();\n\t\t\tif (queueAggregator) {\n\t\t\t\tqueueAggregator.callEnded();\n\t\t\t}\n\t\t},\n\t\t[router, result?.voipClient, roomInfo, voipCloseRoomEndpoint],\n\t);\n\n\tconst openWrapUpModal = useCallback((): void => {\n\t\tsetModal(() => <WrapUpCallModal closeRoom={closeRoom} />);\n\t}, [closeRoom, setModal]);\n\n\tconst changeAudioOutputDevice = useMutableCallback((selectedAudioDevice: Device): void => {\n\t\tremoteAudioMediaRef?.current &&\n\t\t\tsetOutputMediaDevice({ outputDevice: selectedAudioDevice, HTMLAudioElement: remoteAudioMediaRef.current });\n\t});\n\n\tconst changeAudioInputDevice = useMutableCallback((selectedAudioDevice: Device): void => {\n\t\tif (!result.voipClient) {\n\t\t\treturn;\n\t\t}\n\t\tconst constraints = { audio: { deviceId: { exact: selectedAudioDevice.id } } };\n\n\t\t// TODO: Migrate the classes that manage MediaStream to a more react based approach (using contexts/providers perhaps)\n\t\t// For now the MediaStream management is very coupled with the VoIP client,\n\t\t// decoupling it will make it usable by other areas of the project that needs to handle MediaStreams and avoid code duplication\n\t\tresult.voipClient.changeAudioInputDevice(constraints);\n\n\t\tsetInputMediaDevice(selectedAudioDevice);\n\t});\n\n\tconst [queueAggregator, setQueueAggregator] = useState<QueueAggregator>();\n\n\tconst [networkStatus, setNetworkStatus] = useState<NetworkState>('online');\n\n\tuseEffect(() => {\n\t\tconst { voipClient } = result || {};\n\n\t\tif (!voipClient) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetQueueAggregator(voipClient.getAggregator());\n\n\t\treturn (): void => {\n\t\t\tif (clientState === 'registered') {\n\t\t\t\treturn voipClient.unregister();\n\t\t\t}\n\t\t};\n\t}, [result, clientState]);\n\n\tconst openRoom = useCallback((rid: IVoipRoom['_id']): void => {\n\t\troomCoordinator.openRouteLink('v', { rid });\n\t}, []);\n\n\tconst findOrCreateVisitor = useCallback(\n\t\tasync (caller: ICallerInfo): Promise<Serialized<ILivechatVisitor>> => {\n\t\t\tconst phone = parseOutboundPhoneNumber(caller.callerId);\n\n\t\t\tconst { contact } = await getContactBy({ phone });\n\n\t\t\tif (contact) {\n\t\t\t\treturn contact;\n\t\t\t}\n\n\t\t\tconst { visitor } = await visitorEndpoint({\n\t\t\t\tvisitor: {\n\t\t\t\t\ttoken: Random.id(),\n\t\t\t\t\tphone,\n\t\t\t\t\tname: caller.callerName || phone,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn visitor;\n\t\t},\n\t\t[getContactBy, visitorEndpoint],\n\t);\n\n\tconst createRoom = useCallback(\n\t\tasync (caller: ICallerInfo, direction: IVoipRoom['direction'] = 'inbound'): Promise<IVoipRoom['_id']> => {\n\t\t\tif (!user) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tconst visitor = await findOrCreateVisitor(caller);\n\t\t\t\tconst voipRoom = await voipEndpoint({ token: visitor.token, agentId: user._id, direction });\n\t\t\t\topenRoom(voipRoom.room._id);\n\t\t\t\tvoipRoom.room && setRoomInfo({ v: { token: voipRoom.room.v.token }, rid: voipRoom.room._id });\n\t\t\t\tconst queueAggregator = result.voipClient?.getAggregator();\n\t\t\t\tif (queueAggregator) {\n\t\t\t\t\tqueueAggregator.callStarted();\n\t\t\t\t}\n\t\t\t\treturn voipRoom.room._id;\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(`Error while creating a visitor ${error}`);\n\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t\t[openRoom, result.voipClient, user, voipEndpoint, findOrCreateVisitor],\n\t);\n\n\tuseEffect(() => {\n\t\tif (!voipEnabled || !user || !queueAggregator) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst handleEventReceived = async (event: VoipEventDataSignature): Promise<void> => {\n\t\t\tif (isVoipEventAgentCalled(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.callRinging({ queuename: data.queue, callerid: data.callerId });\n\t\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventAgentConnected(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.callPickedup({ queuename: data.queue, queuedcalls: data.queuedCalls, waittimeinqueue: data.waitTimeInQueue });\n\t\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventCallerJoined(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.queueJoined({ queuename: data.queue, callerid: data.callerId, queuedcalls: data.queuedCalls });\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventQueueMemberAdded(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.memberAdded({ queuename: data.queue, queuedcalls: data.queuedCalls });\n\t\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventQueueMemberRemoved(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.memberRemoved({ queuename: data.queue, queuedcalls: data.queuedCalls });\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventCallAbandoned(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.queueAbandoned({ queuename: data.queue, queuedcallafterabandon: data.queuedCallAfterAbandon });\n\t\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconsole.warn('Unknown event received');\n\t\t};\n\n\t\treturn subscribeToNotifyUser(`${user._id}/voip.events`, handleEventReceived);\n\t}, [subscribeToNotifyUser, user, queueAggregator, voipEnabled]);\n\n\t// This was causing event duplication before, so we'll leave this here for now\n\tuseEffect(() => {\n\t\tif (!voipEnabled || !user || !queueAggregator) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn subscribeToNotifyUser(`${user._id}/call.hangup`, (event): void => {\n\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\n\t\t\tif (hasVoIPEnterpriseLicense) {\n\t\t\t\topenWrapUpModal();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcloseRoom();\n\n\t\t\tdispatchEvent({ event: VoipClientEvents['VOIP-CALL-ENDED'], rid: event.roomId });\n\t\t});\n\t}, [openWrapUpModal, queueAggregator, subscribeToNotifyUser, user, voipEnabled, dispatchEvent, hasVoIPEnterpriseLicense, closeRoom]);\n\n\tuseEffect(() => {\n\t\tif (!result.voipClient) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst offRegistered = result.voipClient.on('registered', (): void => setClientState('registered'));\n\t\tconst offUnregistered = result.voipClient.on('unregistered', (): void => setClientState('unregistered'));\n\n\t\treturn (): void => {\n\t\t\toffRegistered();\n\t\t\toffUnregistered();\n\t\t};\n\t}, [result.voipClient]);\n\n\tuseEffect(() => {\n\t\tif (!result.voipClient) {\n\t\t\treturn;\n\t\t}\n\n\t\t/*\n\t\t * This code may need a revisit when we handle callinqueue differently.\n\t\t * Check clickup tasks for more details\n\t\t * https://app.clickup.com/t/22hy1k4\n\t\t * When customer called a queue (Either using skype or using internal number), call would get established\n\t\t * customer would hear agent's voice but agent would not hear anything from customer.\n\t\t * This issue was observed on unstable. It was found to be inconsistent to reproduce.\n\t\t * On some developer env, it would happen randomly. On Safari it did not happen if\n\t\t * user refreshes before taking every call.\n\t\t *\n\t\t * The reason behind this was as soon as agent accepts a call, queueCounter would change.\n\t\t * This change will trigger re-rendering of media and creation of audio element.\n\t\t * This audio element gets used by voipClient to render the remote audio.\n\t\t * Because the re-render happened, it would hold a stale reference.\n\t\t *\n\t\t * If the dom is inspected, audio element just before body is usually created by this class.\n\t\t * this audio element.srcObject contains null value. In working case, it should display\n\t\t * valid stream object.\n\t\t *\n\t\t * Reason for inconsistencies :\n\t\t * This element is utilized in VoIPUser::setupRemoteMedia\n\t\t * This function is called when webRTC receives a remote track event. i.e when the webrtc's peer connection\n\t\t * starts receiving media. This event call back depends on several factors. How does asterisk setup streams.\n\t\t * How does it creates a bridge which patches up the agent and customer (Media is flowing thru asterisk).\n\t\t * When it works in de-environment, it was observed that the audio element in dom and the audio element hold\n\t\t * by VoIPUser is different. Nonetheless, this stale audio element holds valid media stream, which is being played.\n\t\t * Hence sometimes the audio is heard.\n\t\t *\n\t\t * Ideally call component once gets stable, should not get rerendered. Queue, Room creation are the parameters\n\t\t * which should be independent and should not control the call component.\n\t\t *\n\t\t * Solution :\n\t\t * Either make the audio elemenent rendered independent of rest of the DOM.\n\t\t * or implement useEffect. This useEffect will reset the rendering elements with the latest audio tag.\n\t\t *\n\t\t * Note : If this code gets refactor, revisit the line below to check if this call is needed.\n\t\t *\n\t\t */\n\t\tremoteAudioMediaRef.current && result.voipClient.switchMediaRenderer({ remoteMediaElement: remoteAudioMediaRef.current });\n\t}, [result.voipClient]);\n\n\tuseEffect(() => {\n\t\tif (!result.voipClient) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!user) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst onCallEstablished = async (callDetails: ICallDetails): Promise<undefined> => {\n\t\t\tif (!callDetails.callInfo) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvoipSounds.stopAll();\n\t\t\tif (callDetails.userState !== UserState.UAC) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Agent has sent Invite. So it must create a room.\n\t\t\tconst { callInfo } = callDetails;\n\t\t\t// While making the call, there is no remote media element available.\n\t\t\t// When the call is ringing we have that element created. But we still\n\t\t\t// do not want it to be attached.\n\t\t\t// When call gets established, then switch the media renderer.\n\t\t\tremoteAudioMediaRef.current && result.voipClient?.switchMediaRenderer({ remoteMediaElement: remoteAudioMediaRef.current });\n\t\t\tconst roomId = await createRoom(callInfo, 'outbound');\n\t\t\tdispatchEvent({ event: VoipClientEvents['VOIP-CALL-STARTED'], rid: roomId });\n\t\t};\n\n\t\tconst onNetworkConnected = (): void => {\n\t\t\tif (networkStatus === 'offline') {\n\t\t\t\tsetNetworkStatus('online');\n\t\t\t}\n\t\t};\n\n\t\tconst onNetworkDisconnected = (): void => {\n\t\t\t// Transitioning from online -> offline\n\t\t\t// If there is ongoing call, terminate it or if we are processing an incoming/outgoing call\n\t\t\t// reject it.\n\t\t\tif (networkStatus === 'online') {\n\t\t\t\tsetNetworkStatus('offline');\n\t\t\t\tswitch (result.voipClient?.callerInfo.state) {\n\t\t\t\t\tcase 'IN_CALL':\n\t\t\t\t\tcase 'ON_HOLD':\n\t\t\t\t\t\tresult.voipClient?.endCall();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'OFFER_RECEIVED':\n\t\t\t\t\tcase 'ANSWER_SENT':\n\t\t\t\t\t\tresult.voipClient?.rejectCall();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst onRinging = (): void => {\n\t\t\tvoipSounds.play('outbound-call-ringing');\n\t\t};\n\n\t\tconst onIncomingCallRinging = (): void => {\n\t\t\tvoipSounds.play('telephone');\n\t\t};\n\n\t\tconst onCallTerminated = (): void => {\n\t\t\tvoipSounds.play('call-ended', false);\n\t\t\tvoipSounds.stopAll();\n\t\t};\n\n\t\tconst onCallFailed = (reason: 'Not Found' | 'Address Incomplete' | 'Request Terminated' | string): void => {\n\t\t\tswitch (reason) {\n\t\t\t\tcase 'Not Found':\n\t\t\t\t\t// This happens when the call matches dialplan and goes to the world, but the trunk doesnt find the number.\n\t\t\t\t\topenDialModal({ errorMessage: t('Dialed_number_doesnt_exist') });\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Address Incomplete':\n\t\t\t\t\t// This happens when the dialed number doesnt match a valid asterisk dialplan pattern or the number is invalid.\n\t\t\t\t\topenDialModal({ errorMessage: t('Dialed_number_is_incomplete') });\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Request Terminated':\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\topenDialModal({ errorMessage: t('Something_went_wrong_try_again_later') });\n\t\t\t}\n\t\t};\n\n\t\tresult.voipClient.onNetworkEvent('connected', onNetworkConnected);\n\t\tresult.voipClient.onNetworkEvent('disconnected', onNetworkDisconnected);\n\t\tresult.voipClient.onNetworkEvent('connectionerror', onNetworkDisconnected);\n\t\tresult.voipClient.onNetworkEvent('localnetworkonline', onNetworkConnected);\n\t\tresult.voipClient.onNetworkEvent('localnetworkoffline', onNetworkDisconnected);\n\t\tresult.voipClient.on('callestablished', onCallEstablished);\n\t\tresult.voipClient.on('ringing', onRinging); // not called for incoming call\n\t\tresult.voipClient.on('incomingcall', onIncomingCallRinging);\n\t\tresult.voipClient.on('callterminated', onCallTerminated);\n\n\t\tif (isOutboundClient(result.voipClient)) {\n\t\t\tresult.voipClient.on('callfailed', onCallFailed);\n\t\t}\n\n\t\treturn (): void => {\n\t\t\tresult.voipClient?.offNetworkEvent('connected', onNetworkConnected);\n\t\t\tresult.voipClient?.offNetworkEvent('disconnected', onNetworkDisconnected);\n\t\t\tresult.voipClient?.offNetworkEvent('connectionerror', onNetworkDisconnected);\n\t\t\tresult.voipClient?.offNetworkEvent('localnetworkonline', onNetworkConnected);\n\t\t\tresult.voipClient?.offNetworkEvent('localnetworkoffline', onNetworkDisconnected);\n\t\t\tresult.voipClient?.off('incomingcall', onIncomingCallRinging);\n\t\t\tresult.voipClient?.off('ringing', onRinging);\n\t\t\tresult.voipClient?.off('callestablished', onCallEstablished);\n\t\t\tresult.voipClient?.off('callterminated', onCallTerminated);\n\n\t\t\tif (isOutboundClient(result.voipClient)) {\n\t\t\t\tresult.voipClient?.off('callfailed', onCallFailed);\n\t\t\t}\n\t\t};\n\t}, [createRoom, dispatchEvent, networkStatus, openDialModal, result.voipClient, voipSounds, t, user]);\n\n\tconst contextValue: CallContextValue = useMemo(() => {\n\t\tif (!voipEnabled) {\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\tready: false,\n\t\t\t\toutBoundCallsAllowed: undefined, // set to true only if enterprise license is present.\n\t\t\t\toutBoundCallsEnabled: undefined, // set to true even if enterprise license is not present.\n\t\t\t\toutBoundCallsEnabledForUser: undefined, // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\t\t\t};\n\t\t}\n\n\t\tif (!user?.extension) {\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\tready: false,\n\t\t\t\toutBoundCallsAllowed: undefined, // set to true only if enterprise license is present.\n\t\t\t\toutBoundCallsEnabled: undefined, // set to true even if enterprise license is not present.\n\t\t\t\toutBoundCallsEnabledForUser: undefined, // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\t\t\t};\n\t\t}\n\n\t\tif (result.error) {\n\t\t\treturn {\n\t\t\t\tenabled: true,\n\t\t\t\tready: false,\n\t\t\t\terror: result.error,\n\t\t\t\toutBoundCallsAllowed: undefined, // set to true only if enterprise license is present.\n\t\t\t\toutBoundCallsEnabled: undefined, // set to true even if enterprise license is not present.\n\t\t\t\toutBoundCallsEnabledForUser: undefined, // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\t\t\t};\n\t\t}\n\n\t\tif (!result.voipClient) {\n\t\t\treturn {\n\t\t\t\tenabled: true,\n\t\t\t\tready: false,\n\t\t\t\toutBoundCallsAllowed: undefined, // set to true only if enterprise license is present.\n\t\t\t\toutBoundCallsEnabled: undefined, // set to true even if enterprise license is not present.\n\t\t\t\toutBoundCallsEnabledForUser: undefined, // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\t\t\t};\n\t\t}\n\n\t\tconst { registrationInfo, voipClient } = result;\n\n\t\treturn {\n\t\t\toutBoundCallsAllowed: hasVoIPEnterpriseLicense, // set to true only if enterprise license is present.\n\t\t\toutBoundCallsEnabled: hasVoIPEnterpriseLicense, // set to true even if enterprise license is not present.\n\t\t\toutBoundCallsEnabledForUser:\n\t\t\t\thasVoIPEnterpriseLicense && clientState === 'registered' && !['IN_CALL', 'ON_HOLD'].includes(voipClient.callerInfo.state), // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\n\t\t\tenabled: true,\n\t\t\tready: true,\n\t\t\topenedRoomInfo: roomInfo,\n\t\t\tvoipClient,\n\t\t\tregistrationInfo,\n\t\t\tqueueCounter,\n\t\t\tqueueName,\n\t\t\tactions: {\n\t\t\t\tmute: (): Promise<void> => voipClient.muteCall(true), // voipClient.mute(),\n\t\t\t\tunmute: (): Promise<void> => voipClient.muteCall(false), // voipClient.unmute()\n\t\t\t\tpause: (): Promise<void> => voipClient.holdCall(true), // voipClient.pause()\n\t\t\t\tresume: (): Promise<void> => voipClient.holdCall(false), // voipClient.resume()\n\t\t\t\tend: (): Promise<OutgoingByeRequest | void> => voipClient.endCall(),\n\t\t\t\tpickUp: async (): Promise<void | null> =>\n\t\t\t\t\tremoteAudioMediaRef.current && voipClient.acceptCall({ remoteMediaElement: remoteAudioMediaRef.current }),\n\t\t\t\treject: (): Promise<void> => voipClient.rejectCall(),\n\t\t\t},\n\t\t\topenRoom,\n\t\t\tcreateRoom,\n\t\t\tcloseRoom,\n\t\t\tnetworkStatus,\n\t\t\topenWrapUpModal,\n\t\t\tchangeAudioOutputDevice,\n\t\t\tchangeAudioInputDevice,\n\t\t\tregister: (): void => voipClient.register(),\n\t\t\tunregister: (): void => voipClient.unregister(),\n\t\t};\n\t}, [\n\t\tvoipEnabled,\n\t\tuser?.extension,\n\t\tresult,\n\t\thasVoIPEnterpriseLicense,\n\t\tclientState,\n\t\troomInfo,\n\t\tqueueCounter,\n\t\tqueueName,\n\t\topenRoom,\n\t\tcreateRoom,\n\t\tcloseRoom,\n\t\topenWrapUpModal,\n\t\tchangeAudioOutputDevice,\n\t\tchangeAudioInputDevice,\n\t\tnetworkStatus,\n\t]);\n\n\treturn (\n\t\t<CallContext.Provider value={contextValue}>\n\t\t\t{children}\n\t\t\t{contextValue.enabled &&\n\t\t\t\tcreatePortal(\n\t\t\t\t\t<audio ref={remoteAudioMediaRef}>\n\t\t\t\t\t\t<track kind='captions' />\n\t\t\t\t\t</audio>,\n\t\t\t\t\tdocument.body,\n\t\t\t\t)}\n\t\t</CallContext.Provider>\n\t);\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/providers/CallProvider/CallProvider.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/providers/CallProvider/CallProvider.tsx","inputSourceMap":{"version":3,"file":"client/providers/CallProvider/CallProvider.tsx","sourceRoot":"","sources":["client/providers/CallProvider/CallProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IVoipRoom, VoipEventDataSignature, ICallerInfo, ICallDetails, ILivechatVisitor, Serialized } from '@rocket.chat/core-typings';\nimport {\n\tVoipClientEvents,\n\tisVoipEventAgentCalled,\n\tisVoipEventAgentConnected,\n\tisVoipEventCallerJoined,\n\tisVoipEventQueueMemberAdded,\n\tisVoipEventQueueMemberRemoved,\n\tisVoipEventCallAbandoned,\n\tUserState,\n} from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { Random } from '@rocket.chat/random';\nimport type { Device } from '@rocket.chat/ui-contexts';\nimport {\n\tuseRouter,\n\tuseUser,\n\tuseSetting,\n\tuseEndpoint,\n\tuseStream,\n\tuseSetOutputMediaDevice,\n\tuseSetInputMediaDevice,\n\tuseSetModal,\n\tuseTranslation,\n} from '@rocket.chat/ui-contexts';\nimport type { ReactNode } from 'react';\nimport React, { useMemo, useRef, useCallback, useEffect, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport type { OutgoingByeRequest } from 'sip.js/lib/core';\n\nimport type { CallContextValue } from '../../contexts/CallContext';\nimport { CallContext, useIsVoipEnterprise } from '../../contexts/CallContext';\nimport { useDialModal } from '../../hooks/useDialModal';\nimport { isOutboundClient, useVoipClient } from '../../hooks/useVoipClient';\nimport { roomCoordinator } from '../../lib/rooms/roomCoordinator';\nimport type { QueueAggregator } from '../../lib/voip/QueueAggregator';\nimport { parseOutboundPhoneNumber } from '../../lib/voip/parseOutboundPhoneNumber';\nimport { WrapUpCallModal } from '../../voip/components/modals/WrapUpCallModal';\nimport { useVoipSounds } from './hooks/useVoipSounds';\n\ntype NetworkState = 'online' | 'offline';\n\ntype CallProviderProps = {\n\tchildren?: ReactNode;\n};\n\nexport const CallProvider = ({ children }: CallProviderProps) => {\n\tconst [clientState, setClientState] = useState<'registered' | 'unregistered'>('unregistered');\n\n\tconst voipEnabled = useSetting('VoIP_Enabled');\n\tconst subscribeToNotifyUser = useStream('notify-user');\n\tconst dispatchEvent = useEndpoint('POST', '/v1/voip/events');\n\tconst visitorEndpoint = useEndpoint('POST', '/v1/livechat/visitor');\n\tconst voipEndpoint = useEndpoint('GET', '/v1/voip/room');\n\tconst voipCloseRoomEndpoint = useEndpoint('POST', '/v1/voip/room.close');\n\tconst getContactBy = useEndpoint('GET', '/v1/omnichannel/contact.search');\n\tconst setModal = useSetModal();\n\tconst t = useTranslation();\n\n\tconst result = useVoipClient();\n\tconst user = useUser();\n\tconst router = useRouter();\n\tconst setOutputMediaDevice = useSetOutputMediaDevice();\n\tconst setInputMediaDevice = useSetInputMediaDevice();\n\n\tconst hasVoIPEnterpriseLicense = useIsVoipEnterprise();\n\n\tconst remoteAudioMediaRef = useRef<HTMLAudioElement>(null); // TODO: Create a dedicated file for the AUDIO and make the controls accessible\n\n\tconst [queueCounter, setQueueCounter] = useState(0);\n\tconst [queueName, setQueueName] = useState('');\n\tconst [roomInfo, setRoomInfo] = useState<{ v: { token?: string }; rid: string }>({ v: {}, rid: '' });\n\n\tconst { openDialModal } = useDialModal();\n\n\tconst voipSounds = useVoipSounds();\n\n\tconst closeRoom = useCallback(\n\t\tasync (data = {}): Promise<void> => {\n\t\t\troomInfo &&\n\t\t\t\t(await voipCloseRoomEndpoint({\n\t\t\t\t\trid: roomInfo.rid,\n\t\t\t\t\ttoken: roomInfo.v.token || '',\n\t\t\t\t\toptions: { comment: data?.comment, tags: data?.tags },\n\t\t\t\t}));\n\t\t\trouter.navigate('/home');\n\n\t\t\tconst queueAggregator = result.voipClient?.getAggregator();\n\t\t\tif (queueAggregator) {\n\t\t\t\tqueueAggregator.callEnded();\n\t\t\t}\n\t\t},\n\t\t[router, result?.voipClient, roomInfo, voipCloseRoomEndpoint],\n\t);\n\n\tconst openWrapUpModal = useCallback((): void => {\n\t\tsetModal(() => <WrapUpCallModal closeRoom={closeRoom} />);\n\t}, [closeRoom, setModal]);\n\n\tconst changeAudioOutputDevice = useMutableCallback((selectedAudioDevice: Device): void => {\n\t\tremoteAudioMediaRef?.current &&\n\t\t\tsetOutputMediaDevice({ outputDevice: selectedAudioDevice, HTMLAudioElement: remoteAudioMediaRef.current });\n\t});\n\n\tconst changeAudioInputDevice = useMutableCallback((selectedAudioDevice: Device): void => {\n\t\tif (!result.voipClient) {\n\t\t\treturn;\n\t\t}\n\t\tconst constraints = { audio: { deviceId: { exact: selectedAudioDevice.id } } };\n\n\t\t// TODO: Migrate the classes that manage MediaStream to a more react based approach (using contexts/providers perhaps)\n\t\t// For now the MediaStream management is very coupled with the VoIP client,\n\t\t// decoupling it will make it usable by other areas of the project that needs to handle MediaStreams and avoid code duplication\n\t\tresult.voipClient.changeAudioInputDevice(constraints);\n\n\t\tsetInputMediaDevice(selectedAudioDevice);\n\t});\n\n\tconst [queueAggregator, setQueueAggregator] = useState<QueueAggregator>();\n\n\tconst [networkStatus, setNetworkStatus] = useState<NetworkState>('online');\n\n\tuseEffect(() => {\n\t\tconst { voipClient } = result || {};\n\n\t\tif (!voipClient) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetQueueAggregator(voipClient.getAggregator());\n\n\t\treturn (): void => {\n\t\t\tif (clientState === 'registered') {\n\t\t\t\treturn voipClient.unregister();\n\t\t\t}\n\t\t};\n\t}, [result, clientState]);\n\n\tconst openRoom = useCallback((rid: IVoipRoom['_id']): void => {\n\t\troomCoordinator.openRouteLink('v', { rid });\n\t}, []);\n\n\tconst findOrCreateVisitor = useCallback(\n\t\tasync (caller: ICallerInfo): Promise<Serialized<ILivechatVisitor>> => {\n\t\t\tconst phone = parseOutboundPhoneNumber(caller.callerId);\n\n\t\t\tconst { contact } = await getContactBy({ phone });\n\n\t\t\tif (contact) {\n\t\t\t\treturn contact;\n\t\t\t}\n\n\t\t\tconst { visitor } = await visitorEndpoint({\n\t\t\t\tvisitor: {\n\t\t\t\t\ttoken: Random.id(),\n\t\t\t\t\tphone,\n\t\t\t\t\tname: caller.callerName || phone,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn visitor;\n\t\t},\n\t\t[getContactBy, visitorEndpoint],\n\t);\n\n\tconst createRoom = useCallback(\n\t\tasync (caller: ICallerInfo, direction: IVoipRoom['direction'] = 'inbound'): Promise<IVoipRoom['_id']> => {\n\t\t\tif (!user) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tconst visitor = await findOrCreateVisitor(caller);\n\t\t\t\tconst voipRoom = await voipEndpoint({ token: visitor.token, agentId: user._id, direction });\n\t\t\t\topenRoom(voipRoom.room._id);\n\t\t\t\tvoipRoom.room && setRoomInfo({ v: { token: voipRoom.room.v.token }, rid: voipRoom.room._id });\n\t\t\t\tconst queueAggregator = result.voipClient?.getAggregator();\n\t\t\t\tif (queueAggregator) {\n\t\t\t\t\tqueueAggregator.callStarted();\n\t\t\t\t}\n\t\t\t\treturn voipRoom.room._id;\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(`Error while creating a visitor ${error}`);\n\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t\t[openRoom, result.voipClient, user, voipEndpoint, findOrCreateVisitor],\n\t);\n\n\tuseEffect(() => {\n\t\tif (!voipEnabled || !user || !queueAggregator) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst handleEventReceived = async (event: VoipEventDataSignature): Promise<void> => {\n\t\t\tif (isVoipEventAgentCalled(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.callRinging({ queuename: data.queue, callerid: data.callerId });\n\t\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventAgentConnected(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.callPickedup({ queuename: data.queue, queuedcalls: data.queuedCalls, waittimeinqueue: data.waitTimeInQueue });\n\t\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventCallerJoined(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.queueJoined({ queuename: data.queue, callerid: data.callerId, queuedcalls: data.queuedCalls });\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventQueueMemberAdded(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.memberAdded({ queuename: data.queue, queuedcalls: data.queuedCalls });\n\t\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventQueueMemberRemoved(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.memberRemoved({ queuename: data.queue, queuedcalls: data.queuedCalls });\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventCallAbandoned(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.queueAbandoned({ queuename: data.queue, queuedcallafterabandon: data.queuedCallAfterAbandon });\n\t\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconsole.warn('Unknown event received');\n\t\t};\n\n\t\treturn subscribeToNotifyUser(`${user._id}/voip.events`, handleEventReceived);\n\t}, [subscribeToNotifyUser, user, queueAggregator, voipEnabled]);\n\n\t// This was causing event duplication before, so we'll leave this here for now\n\tuseEffect(() => {\n\t\tif (!voipEnabled || !user || !queueAggregator) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn subscribeToNotifyUser(`${user._id}/call.hangup`, (event): void => {\n\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\n\t\t\tif (hasVoIPEnterpriseLicense) {\n\t\t\t\topenWrapUpModal();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcloseRoom();\n\n\t\t\tdispatchEvent({ event: VoipClientEvents['VOIP-CALL-ENDED'], rid: event.roomId });\n\t\t});\n\t}, [openWrapUpModal, queueAggregator, subscribeToNotifyUser, user, voipEnabled, dispatchEvent, hasVoIPEnterpriseLicense, closeRoom]);\n\n\tuseEffect(() => {\n\t\tif (!result.voipClient) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst offRegistered = result.voipClient.on('registered', (): void => setClientState('registered'));\n\t\tconst offUnregistered = result.voipClient.on('unregistered', (): void => setClientState('unregistered'));\n\n\t\treturn (): void => {\n\t\t\toffRegistered();\n\t\t\toffUnregistered();\n\t\t};\n\t}, [result.voipClient]);\n\n\tuseEffect(() => {\n\t\tif (!result.voipClient) {\n\t\t\treturn;\n\t\t}\n\n\t\t/*\n\t\t * This code may need a revisit when we handle callinqueue differently.\n\t\t * Check clickup tasks for more details\n\t\t * https://app.clickup.com/t/22hy1k4\n\t\t * When customer called a queue (Either using skype or using internal number), call would get established\n\t\t * customer would hear agent's voice but agent would not hear anything from customer.\n\t\t * This issue was observed on unstable. It was found to be inconsistent to reproduce.\n\t\t * On some developer env, it would happen randomly. On Safari it did not happen if\n\t\t * user refreshes before taking every call.\n\t\t *\n\t\t * The reason behind this was as soon as agent accepts a call, queueCounter would change.\n\t\t * This change will trigger re-rendering of media and creation of audio element.\n\t\t * This audio element gets used by voipClient to render the remote audio.\n\t\t * Because the re-render happened, it would hold a stale reference.\n\t\t *\n\t\t * If the dom is inspected, audio element just before body is usually created by this class.\n\t\t * this audio element.srcObject contains null value. In working case, it should display\n\t\t * valid stream object.\n\t\t *\n\t\t * Reason for inconsistencies :\n\t\t * This element is utilized in VoIPUser::setupRemoteMedia\n\t\t * This function is called when webRTC receives a remote track event. i.e when the webrtc's peer connection\n\t\t * starts receiving media. This event call back depends on several factors. How does asterisk setup streams.\n\t\t * How does it creates a bridge which patches up the agent and customer (Media is flowing thru asterisk).\n\t\t * When it works in de-environment, it was observed that the audio element in dom and the audio element hold\n\t\t * by VoIPUser is different. Nonetheless, this stale audio element holds valid media stream, which is being played.\n\t\t * Hence sometimes the audio is heard.\n\t\t *\n\t\t * Ideally call component once gets stable, should not get rerendered. Queue, Room creation are the parameters\n\t\t * which should be independent and should not control the call component.\n\t\t *\n\t\t * Solution :\n\t\t * Either make the audio elemenent rendered independent of rest of the DOM.\n\t\t * or implement useEffect. This useEffect will reset the rendering elements with the latest audio tag.\n\t\t *\n\t\t * Note : If this code gets refactor, revisit the line below to check if this call is needed.\n\t\t *\n\t\t */\n\t\tremoteAudioMediaRef.current && result.voipClient.switchMediaRenderer({ remoteMediaElement: remoteAudioMediaRef.current });\n\t}, [result.voipClient]);\n\n\tuseEffect(() => {\n\t\tif (!result.voipClient) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!user) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst onCallEstablished = async (callDetails: ICallDetails): Promise<undefined> => {\n\t\t\tif (!callDetails.callInfo) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvoipSounds.stopAll();\n\t\t\tif (callDetails.userState !== UserState.UAC) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Agent has sent Invite. So it must create a room.\n\t\t\tconst { callInfo } = callDetails;\n\t\t\t// While making the call, there is no remote media element available.\n\t\t\t// When the call is ringing we have that element created. But we still\n\t\t\t// do not want it to be attached.\n\t\t\t// When call gets established, then switch the media renderer.\n\t\t\tremoteAudioMediaRef.current && result.voipClient?.switchMediaRenderer({ remoteMediaElement: remoteAudioMediaRef.current });\n\t\t\tconst roomId = await createRoom(callInfo, 'outbound');\n\t\t\tdispatchEvent({ event: VoipClientEvents['VOIP-CALL-STARTED'], rid: roomId });\n\t\t};\n\n\t\tconst onNetworkConnected = (): void => {\n\t\t\tif (networkStatus === 'offline') {\n\t\t\t\tsetNetworkStatus('online');\n\t\t\t}\n\t\t};\n\n\t\tconst onNetworkDisconnected = (): void => {\n\t\t\t// Transitioning from online -> offline\n\t\t\t// If there is ongoing call, terminate it or if we are processing an incoming/outgoing call\n\t\t\t// reject it.\n\t\t\tif (networkStatus === 'online') {\n\t\t\t\tsetNetworkStatus('offline');\n\t\t\t\tswitch (result.voipClient?.callerInfo.state) {\n\t\t\t\t\tcase 'IN_CALL':\n\t\t\t\t\tcase 'ON_HOLD':\n\t\t\t\t\t\tresult.voipClient?.endCall();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'OFFER_RECEIVED':\n\t\t\t\t\tcase 'ANSWER_SENT':\n\t\t\t\t\t\tresult.voipClient?.rejectCall();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst onRinging = (): void => {\n\t\t\tvoipSounds.play('outbound-call-ringing');\n\t\t};\n\n\t\tconst onIncomingCallRinging = (): void => {\n\t\t\tvoipSounds.play('telephone');\n\t\t};\n\n\t\tconst onCallTerminated = (): void => {\n\t\t\tvoipSounds.play('call-ended', false);\n\t\t\tvoipSounds.stopAll();\n\t\t};\n\n\t\tconst onCallFailed = (reason: 'Not Found' | 'Address Incomplete' | 'Request Terminated' | string): void => {\n\t\t\tswitch (reason) {\n\t\t\t\tcase 'Not Found':\n\t\t\t\t\t// This happens when the call matches dialplan and goes to the world, but the trunk doesnt find the number.\n\t\t\t\t\topenDialModal({ errorMessage: t('Dialed_number_doesnt_exist') });\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Address Incomplete':\n\t\t\t\t\t// This happens when the dialed number doesnt match a valid asterisk dialplan pattern or the number is invalid.\n\t\t\t\t\topenDialModal({ errorMessage: t('Dialed_number_is_incomplete') });\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Request Terminated':\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\topenDialModal({ errorMessage: t('Something_went_wrong_try_again_later') });\n\t\t\t}\n\t\t};\n\n\t\tresult.voipClient.onNetworkEvent('connected', onNetworkConnected);\n\t\tresult.voipClient.onNetworkEvent('disconnected', onNetworkDisconnected);\n\t\tresult.voipClient.onNetworkEvent('connectionerror', onNetworkDisconnected);\n\t\tresult.voipClient.onNetworkEvent('localnetworkonline', onNetworkConnected);\n\t\tresult.voipClient.onNetworkEvent('localnetworkoffline', onNetworkDisconnected);\n\t\tresult.voipClient.on('callestablished', onCallEstablished);\n\t\tresult.voipClient.on('ringing', onRinging); // not called for incoming call\n\t\tresult.voipClient.on('incomingcall', onIncomingCallRinging);\n\t\tresult.voipClient.on('callterminated', onCallTerminated);\n\n\t\tif (isOutboundClient(result.voipClient)) {\n\t\t\tresult.voipClient.on('callfailed', onCallFailed);\n\t\t}\n\n\t\treturn (): void => {\n\t\t\tresult.voipClient?.offNetworkEvent('connected', onNetworkConnected);\n\t\t\tresult.voipClient?.offNetworkEvent('disconnected', onNetworkDisconnected);\n\t\t\tresult.voipClient?.offNetworkEvent('connectionerror', onNetworkDisconnected);\n\t\t\tresult.voipClient?.offNetworkEvent('localnetworkonline', onNetworkConnected);\n\t\t\tresult.voipClient?.offNetworkEvent('localnetworkoffline', onNetworkDisconnected);\n\t\t\tresult.voipClient?.off('incomingcall', onIncomingCallRinging);\n\t\t\tresult.voipClient?.off('ringing', onRinging);\n\t\t\tresult.voipClient?.off('callestablished', onCallEstablished);\n\t\t\tresult.voipClient?.off('callterminated', onCallTerminated);\n\n\t\t\tif (isOutboundClient(result.voipClient)) {\n\t\t\t\tresult.voipClient?.off('callfailed', onCallFailed);\n\t\t\t}\n\t\t};\n\t}, [createRoom, dispatchEvent, networkStatus, openDialModal, result.voipClient, voipSounds, t, user]);\n\n\tconst contextValue: CallContextValue = useMemo(() => {\n\t\tif (!voipEnabled) {\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\tready: false,\n\t\t\t\toutBoundCallsAllowed: undefined, // set to true only if enterprise license is present.\n\t\t\t\toutBoundCallsEnabled: undefined, // set to true even if enterprise license is not present.\n\t\t\t\toutBoundCallsEnabledForUser: undefined, // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\t\t\t};\n\t\t}\n\n\t\tif (!user?.extension) {\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\tready: false,\n\t\t\t\toutBoundCallsAllowed: undefined, // set to true only if enterprise license is present.\n\t\t\t\toutBoundCallsEnabled: undefined, // set to true even if enterprise license is not present.\n\t\t\t\toutBoundCallsEnabledForUser: undefined, // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\t\t\t};\n\t\t}\n\n\t\tif (result.error) {\n\t\t\treturn {\n\t\t\t\tenabled: true,\n\t\t\t\tready: false,\n\t\t\t\terror: result.error,\n\t\t\t\toutBoundCallsAllowed: undefined, // set to true only if enterprise license is present.\n\t\t\t\toutBoundCallsEnabled: undefined, // set to true even if enterprise license is not present.\n\t\t\t\toutBoundCallsEnabledForUser: undefined, // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\t\t\t};\n\t\t}\n\n\t\tif (!result.voipClient) {\n\t\t\treturn {\n\t\t\t\tenabled: true,\n\t\t\t\tready: false,\n\t\t\t\toutBoundCallsAllowed: undefined, // set to true only if enterprise license is present.\n\t\t\t\toutBoundCallsEnabled: undefined, // set to true even if enterprise license is not present.\n\t\t\t\toutBoundCallsEnabledForUser: undefined, // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\t\t\t};\n\t\t}\n\n\t\tconst { registrationInfo, voipClient } = result;\n\n\t\treturn {\n\t\t\toutBoundCallsAllowed: hasVoIPEnterpriseLicense, // set to true only if enterprise license is present.\n\t\t\toutBoundCallsEnabled: hasVoIPEnterpriseLicense, // set to true even if enterprise license is not present.\n\t\t\toutBoundCallsEnabledForUser:\n\t\t\t\thasVoIPEnterpriseLicense && clientState === 'registered' && !['IN_CALL', 'ON_HOLD'].includes(voipClient.callerInfo.state), // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\n\t\t\tenabled: true,\n\t\t\tready: true,\n\t\t\topenedRoomInfo: roomInfo,\n\t\t\tvoipClient,\n\t\t\tregistrationInfo,\n\t\t\tqueueCounter,\n\t\t\tqueueName,\n\t\t\tactions: {\n\t\t\t\tmute: (): Promise<void> => voipClient.muteCall(true), // voipClient.mute(),\n\t\t\t\tunmute: (): Promise<void> => voipClient.muteCall(false), // voipClient.unmute()\n\t\t\t\tpause: (): Promise<void> => voipClient.holdCall(true), // voipClient.pause()\n\t\t\t\tresume: (): Promise<void> => voipClient.holdCall(false), // voipClient.resume()\n\t\t\t\tend: (): Promise<OutgoingByeRequest | void> => voipClient.endCall(),\n\t\t\t\tpickUp: async (): Promise<void | null> =>\n\t\t\t\t\tremoteAudioMediaRef.current && voipClient.acceptCall({ remoteMediaElement: remoteAudioMediaRef.current }),\n\t\t\t\treject: (): Promise<void> => voipClient.rejectCall(),\n\t\t\t},\n\t\t\topenRoom,\n\t\t\tcreateRoom,\n\t\t\tcloseRoom,\n\t\t\tnetworkStatus,\n\t\t\topenWrapUpModal,\n\t\t\tchangeAudioOutputDevice,\n\t\t\tchangeAudioInputDevice,\n\t\t\tregister: (): void => voipClient.register(),\n\t\t\tunregister: (): void => voipClient.unregister(),\n\t\t};\n\t}, [\n\t\tvoipEnabled,\n\t\tuser?.extension,\n\t\tresult,\n\t\thasVoIPEnterpriseLicense,\n\t\tclientState,\n\t\troomInfo,\n\t\tqueueCounter,\n\t\tqueueName,\n\t\topenRoom,\n\t\tcreateRoom,\n\t\tcloseRoom,\n\t\topenWrapUpModal,\n\t\tchangeAudioOutputDevice,\n\t\tchangeAudioInputDevice,\n\t\tnetworkStatus,\n\t]);\n\n\treturn (\n\t\t<CallContext.Provider value={contextValue}>\n\t\t\t{children}\n\t\t\t{contextValue.enabled &&\n\t\t\t\tcreatePortal(\n\t\t\t\t\t<audio ref={remoteAudioMediaRef}>\n\t\t\t\t\t\t<track kind='captions' />\n\t\t\t\t\t</audio>,\n\t\t\t\t\tdocument.body,\n\t\t\t\t)}\n\t\t</CallContext.Provider>\n\t);\n};\n"]}}},"code":"var _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nvar _slicedToArray;\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 1);\nmodule.export({\n  CallProvider: function () {\n    return CallProvider;\n  }\n});\nvar VoipClientEvents, isVoipEventAgentCalled, isVoipEventAgentConnected, isVoipEventCallerJoined, isVoipEventQueueMemberAdded, isVoipEventQueueMemberRemoved, isVoipEventCallAbandoned, UserState;\nmodule.link(\"@rocket.chat/core-typings\", {\n  VoipClientEvents: function (v) {\n    VoipClientEvents = v;\n  },\n  isVoipEventAgentCalled: function (v) {\n    isVoipEventAgentCalled = v;\n  },\n  isVoipEventAgentConnected: function (v) {\n    isVoipEventAgentConnected = v;\n  },\n  isVoipEventCallerJoined: function (v) {\n    isVoipEventCallerJoined = v;\n  },\n  isVoipEventQueueMemberAdded: function (v) {\n    isVoipEventQueueMemberAdded = v;\n  },\n  isVoipEventQueueMemberRemoved: function (v) {\n    isVoipEventQueueMemberRemoved = v;\n  },\n  isVoipEventCallAbandoned: function (v) {\n    isVoipEventCallAbandoned = v;\n  },\n  UserState: function (v) {\n    UserState = v;\n  }\n}, 0);\nvar useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback: function (v) {\n    useMutableCallback = v;\n  }\n}, 1);\nvar Random;\nmodule.link(\"@rocket.chat/random\", {\n  Random: function (v) {\n    Random = v;\n  }\n}, 2);\nvar useRouter, useUser, useSetting, useEndpoint, useStream, useSetOutputMediaDevice, useSetInputMediaDevice, useSetModal, useTranslation;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useRouter: function (v) {\n    useRouter = v;\n  },\n  useUser: function (v) {\n    useUser = v;\n  },\n  useSetting: function (v) {\n    useSetting = v;\n  },\n  useEndpoint: function (v) {\n    useEndpoint = v;\n  },\n  useStream: function (v) {\n    useStream = v;\n  },\n  useSetOutputMediaDevice: function (v) {\n    useSetOutputMediaDevice = v;\n  },\n  useSetInputMediaDevice: function (v) {\n    useSetInputMediaDevice = v;\n  },\n  useSetModal: function (v) {\n    useSetModal = v;\n  },\n  useTranslation: function (v) {\n    useTranslation = v;\n  }\n}, 3);\nvar React, useMemo, useRef, useCallback, useEffect, useState;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useMemo: function (v) {\n    useMemo = v;\n  },\n  useRef: function (v) {\n    useRef = v;\n  },\n  useCallback: function (v) {\n    useCallback = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useState: function (v) {\n    useState = v;\n  }\n}, 4);\nvar createPortal;\nmodule.link(\"react-dom\", {\n  createPortal: function (v) {\n    createPortal = v;\n  }\n}, 5);\nvar CallContext, useIsVoipEnterprise;\nmodule.link(\"../../contexts/CallContext\", {\n  CallContext: function (v) {\n    CallContext = v;\n  },\n  useIsVoipEnterprise: function (v) {\n    useIsVoipEnterprise = v;\n  }\n}, 6);\nvar useDialModal;\nmodule.link(\"../../hooks/useDialModal\", {\n  useDialModal: function (v) {\n    useDialModal = v;\n  }\n}, 7);\nvar isOutboundClient, useVoipClient;\nmodule.link(\"../../hooks/useVoipClient\", {\n  isOutboundClient: function (v) {\n    isOutboundClient = v;\n  },\n  useVoipClient: function (v) {\n    useVoipClient = v;\n  }\n}, 8);\nvar roomCoordinator;\nmodule.link(\"../../lib/rooms/roomCoordinator\", {\n  roomCoordinator: function (v) {\n    roomCoordinator = v;\n  }\n}, 9);\nvar parseOutboundPhoneNumber;\nmodule.link(\"../../lib/voip/parseOutboundPhoneNumber\", {\n  parseOutboundPhoneNumber: function (v) {\n    parseOutboundPhoneNumber = v;\n  }\n}, 10);\nvar WrapUpCallModal;\nmodule.link(\"../../voip/components/modals/WrapUpCallModal\", {\n  WrapUpCallModal: function (v) {\n    WrapUpCallModal = v;\n  }\n}, 11);\nvar useVoipSounds;\nmodule.link(\"./hooks/useVoipSounds\", {\n  useVoipSounds: function (v) {\n    useVoipSounds = v;\n  }\n}, 12);\nvar CallProvider = function (_ref) {\n  var children = _ref.children;\n  var _useState = useState('unregistered'),\n    _useState2 = _slicedToArray(_useState, 2),\n    clientState = _useState2[0],\n    setClientState = _useState2[1];\n  var voipEnabled = useSetting('VoIP_Enabled');\n  var subscribeToNotifyUser = useStream('notify-user');\n  var dispatchEvent = useEndpoint('POST', '/v1/voip/events');\n  var visitorEndpoint = useEndpoint('POST', '/v1/livechat/visitor');\n  var voipEndpoint = useEndpoint('GET', '/v1/voip/room');\n  var voipCloseRoomEndpoint = useEndpoint('POST', '/v1/voip/room.close');\n  var getContactBy = useEndpoint('GET', '/v1/omnichannel/contact.search');\n  var setModal = useSetModal();\n  var t = useTranslation();\n  var result = useVoipClient();\n  var user = useUser();\n  var router = useRouter();\n  var setOutputMediaDevice = useSetOutputMediaDevice();\n  var setInputMediaDevice = useSetInputMediaDevice();\n  var hasVoIPEnterpriseLicense = useIsVoipEnterprise();\n  var remoteAudioMediaRef = useRef(null); // TODO: Create a dedicated file for the AUDIO and make the controls accessible\n  var _useState3 = useState(0),\n    _useState4 = _slicedToArray(_useState3, 2),\n    queueCounter = _useState4[0],\n    setQueueCounter = _useState4[1];\n  var _useState5 = useState(''),\n    _useState6 = _slicedToArray(_useState5, 2),\n    queueName = _useState6[0],\n    setQueueName = _useState6[1];\n  var _useState7 = useState({\n      v: {},\n      rid: ''\n    }),\n    _useState8 = _slicedToArray(_useState7, 2),\n    roomInfo = _useState8[0],\n    setRoomInfo = _useState8[1];\n  var _useDialModal = useDialModal(),\n    openDialModal = _useDialModal.openDialModal;\n  var voipSounds = useVoipSounds();\n  var closeRoom = useCallback(function () {\n    function _callee() {\n      var _result$voipClient;\n      var data,\n        queueAggregator,\n        _args = arguments;\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              data = _args.length > 0 && _args[0] !== undefined ? _args[0] : {};\n              _context.t0 = roomInfo;\n              if (!_context.t0) {\n                _context.next = 5;\n                break;\n              }\n              _context.next = 5;\n              return _regeneratorRuntime.awrap(voipCloseRoomEndpoint({\n                rid: roomInfo.rid,\n                token: roomInfo.v.token || '',\n                options: {\n                  comment: data === null || data === void 0 ? void 0 : data.comment,\n                  tags: data === null || data === void 0 ? void 0 : data.tags\n                }\n              }));\n            case 5:\n              router.navigate('/home');\n              queueAggregator = (_result$voipClient = result.voipClient) === null || _result$voipClient === void 0 ? void 0 : _result$voipClient.getAggregator();\n              if (queueAggregator) {\n                queueAggregator.callEnded();\n              }\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n        return _callee$;\n      }(), null, null, null, Promise);\n    }\n    return _callee;\n  }(), [router, result === null || result === void 0 ? void 0 : result.voipClient, roomInfo, voipCloseRoomEndpoint]);\n  var openWrapUpModal = useCallback(function () {\n    setModal(function () {\n      return /*#__PURE__*/React.createElement(WrapUpCallModal, {\n        closeRoom: closeRoom\n      });\n    });\n  }, [closeRoom, setModal]);\n  var changeAudioOutputDevice = useMutableCallback(function (selectedAudioDevice) {\n    (remoteAudioMediaRef === null || remoteAudioMediaRef === void 0 ? void 0 : remoteAudioMediaRef.current) && setOutputMediaDevice({\n      outputDevice: selectedAudioDevice,\n      HTMLAudioElement: remoteAudioMediaRef.current\n    });\n  });\n  var changeAudioInputDevice = useMutableCallback(function (selectedAudioDevice) {\n    if (!result.voipClient) {\n      return;\n    }\n    var constraints = {\n      audio: {\n        deviceId: {\n          exact: selectedAudioDevice.id\n        }\n      }\n    };\n    // TODO: Migrate the classes that manage MediaStream to a more react based approach (using contexts/providers perhaps)\n    // For now the MediaStream management is very coupled with the VoIP client,\n    // decoupling it will make it usable by other areas of the project that needs to handle MediaStreams and avoid code duplication\n    result.voipClient.changeAudioInputDevice(constraints);\n    setInputMediaDevice(selectedAudioDevice);\n  });\n  var _useState9 = useState(),\n    _useState10 = _slicedToArray(_useState9, 2),\n    queueAggregator = _useState10[0],\n    setQueueAggregator = _useState10[1];\n  var _useState11 = useState('online'),\n    _useState12 = _slicedToArray(_useState11, 2),\n    networkStatus = _useState12[0],\n    setNetworkStatus = _useState12[1];\n  useEffect(function () {\n    var _ref2 = result || {},\n      voipClient = _ref2.voipClient;\n    if (!voipClient) {\n      return;\n    }\n    setQueueAggregator(voipClient.getAggregator());\n    return function () {\n      if (clientState === 'registered') {\n        return voipClient.unregister();\n      }\n    };\n  }, [result, clientState]);\n  var openRoom = useCallback(function (rid) {\n    roomCoordinator.openRouteLink('v', {\n      rid: rid\n    });\n  }, []);\n  var findOrCreateVisitor = useCallback(function () {\n    function _callee2(caller) {\n      var phone, _await$getContactBy, contact, _await$visitorEndpoin, visitor;\n      return _regeneratorRuntime.async(function () {\n        function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              phone = parseOutboundPhoneNumber(caller.callerId);\n              _context2.next = 3;\n              return _regeneratorRuntime.awrap(getContactBy({\n                phone: phone\n              }));\n            case 3:\n              _await$getContactBy = _context2.sent;\n              contact = _await$getContactBy.contact;\n              if (!contact) {\n                _context2.next = 7;\n                break;\n              }\n              return _context2.abrupt(\"return\", contact);\n            case 7:\n              _context2.next = 9;\n              return _regeneratorRuntime.awrap(visitorEndpoint({\n                visitor: {\n                  token: Random.id(),\n                  phone: phone,\n                  name: caller.callerName || phone\n                }\n              }));\n            case 9:\n              _await$visitorEndpoin = _context2.sent;\n              visitor = _await$visitorEndpoin.visitor;\n              return _context2.abrupt(\"return\", visitor);\n            case 12:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n        return _callee2$;\n      }(), null, null, null, Promise);\n    }\n    return _callee2;\n  }(), [getContactBy, visitorEndpoint]);\n  var createRoom = useCallback(function () {\n    function _callee3(caller) {\n      var direction,\n        _result$voipClient2,\n        visitor,\n        voipRoom,\n        _queueAggregator,\n        _args3 = arguments;\n      return _regeneratorRuntime.async(function () {\n        function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              direction = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : 'inbound';\n              if (user) {\n                _context3.next = 3;\n                break;\n              }\n              return _context3.abrupt(\"return\", '');\n            case 3:\n              _context3.prev = 3;\n              _context3.next = 6;\n              return _regeneratorRuntime.awrap(findOrCreateVisitor(caller));\n            case 6:\n              visitor = _context3.sent;\n              _context3.next = 9;\n              return _regeneratorRuntime.awrap(voipEndpoint({\n                token: visitor.token,\n                agentId: user._id,\n                direction: direction\n              }));\n            case 9:\n              voipRoom = _context3.sent;\n              openRoom(voipRoom.room._id);\n              voipRoom.room && setRoomInfo({\n                v: {\n                  token: voipRoom.room.v.token\n                },\n                rid: voipRoom.room._id\n              });\n              _queueAggregator = (_result$voipClient2 = result.voipClient) === null || _result$voipClient2 === void 0 ? void 0 : _result$voipClient2.getAggregator();\n              if (_queueAggregator) {\n                _queueAggregator.callStarted();\n              }\n              return _context3.abrupt(\"return\", voipRoom.room._id);\n            case 17:\n              _context3.prev = 17;\n              _context3.t0 = _context3[\"catch\"](3);\n              console.error(\"Error while creating a visitor \" + _context3.t0);\n              return _context3.abrupt(\"return\", '');\n            case 21:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n        return _callee3$;\n      }(), null, null, [[3, 17]], Promise);\n    }\n    return _callee3;\n  }(), [openRoom, result.voipClient, user, voipEndpoint, findOrCreateVisitor]);\n  useEffect(function () {\n    if (!voipEnabled || !user || !queueAggregator) {\n      return;\n    }\n    var handleEventReceived = function () {\n      function _callee4(event) {\n        var data, _data, _data2, _data3, _data4, _data5;\n        return _regeneratorRuntime.async(function () {\n          function _callee4$(_context4) {\n            while (1) switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!isVoipEventAgentCalled(event)) {\n                  _context4.next = 5;\n                  break;\n                }\n                data = event.data;\n                queueAggregator.callRinging({\n                  queuename: data.queue,\n                  callerid: data.callerId\n                });\n                setQueueName(queueAggregator.getCurrentQueueName());\n                return _context4.abrupt(\"return\");\n              case 5:\n                if (!isVoipEventAgentConnected(event)) {\n                  _context4.next = 11;\n                  break;\n                }\n                _data = event.data;\n                queueAggregator.callPickedup({\n                  queuename: _data.queue,\n                  queuedcalls: _data.queuedCalls,\n                  waittimeinqueue: _data.waitTimeInQueue\n                });\n                setQueueName(queueAggregator.getCurrentQueueName());\n                setQueueCounter(queueAggregator.getCallWaitingCount());\n                return _context4.abrupt(\"return\");\n              case 11:\n                if (!isVoipEventCallerJoined(event)) {\n                  _context4.next = 16;\n                  break;\n                }\n                _data2 = event.data;\n                queueAggregator.queueJoined({\n                  queuename: _data2.queue,\n                  callerid: _data2.callerId,\n                  queuedcalls: _data2.queuedCalls\n                });\n                setQueueCounter(queueAggregator.getCallWaitingCount());\n                return _context4.abrupt(\"return\");\n              case 16:\n                if (!isVoipEventQueueMemberAdded(event)) {\n                  _context4.next = 22;\n                  break;\n                }\n                _data3 = event.data;\n                queueAggregator.memberAdded({\n                  queuename: _data3.queue,\n                  queuedcalls: _data3.queuedCalls\n                });\n                setQueueName(queueAggregator.getCurrentQueueName());\n                setQueueCounter(queueAggregator.getCallWaitingCount());\n                return _context4.abrupt(\"return\");\n              case 22:\n                if (!isVoipEventQueueMemberRemoved(event)) {\n                  _context4.next = 27;\n                  break;\n                }\n                _data4 = event.data;\n                queueAggregator.memberRemoved({\n                  queuename: _data4.queue,\n                  queuedcalls: _data4.queuedCalls\n                });\n                setQueueCounter(queueAggregator.getCallWaitingCount());\n                return _context4.abrupt(\"return\");\n              case 27:\n                if (!isVoipEventCallAbandoned(event)) {\n                  _context4.next = 33;\n                  break;\n                }\n                _data5 = event.data;\n                queueAggregator.queueAbandoned({\n                  queuename: _data5.queue,\n                  queuedcallafterabandon: _data5.queuedCallAfterAbandon\n                });\n                setQueueName(queueAggregator.getCurrentQueueName());\n                setQueueCounter(queueAggregator.getCallWaitingCount());\n                return _context4.abrupt(\"return\");\n              case 33:\n                console.warn('Unknown event received');\n              case 34:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n          return _callee4$;\n        }(), null, null, null, Promise);\n      }\n      return _callee4;\n    }();\n    return subscribeToNotifyUser(user._id + \"/voip.events\", handleEventReceived);\n  }, [subscribeToNotifyUser, user, queueAggregator, voipEnabled]);\n  // This was causing event duplication before, so we'll leave this here for now\n  useEffect(function () {\n    if (!voipEnabled || !user || !queueAggregator) {\n      return;\n    }\n    return subscribeToNotifyUser(user._id + \"/call.hangup\", function (event) {\n      setQueueName(queueAggregator.getCurrentQueueName());\n      if (hasVoIPEnterpriseLicense) {\n        openWrapUpModal();\n        return;\n      }\n      closeRoom();\n      dispatchEvent({\n        event: VoipClientEvents['VOIP-CALL-ENDED'],\n        rid: event.roomId\n      });\n    });\n  }, [openWrapUpModal, queueAggregator, subscribeToNotifyUser, user, voipEnabled, dispatchEvent, hasVoIPEnterpriseLicense, closeRoom]);\n  useEffect(function () {\n    if (!result.voipClient) {\n      return;\n    }\n    var offRegistered = result.voipClient.on('registered', function () {\n      return setClientState('registered');\n    });\n    var offUnregistered = result.voipClient.on('unregistered', function () {\n      return setClientState('unregistered');\n    });\n    return function () {\n      offRegistered();\n      offUnregistered();\n    };\n  }, [result.voipClient]);\n  useEffect(function () {\n    if (!result.voipClient) {\n      return;\n    }\n    /*\n     * This code may need a revisit when we handle callinqueue differently.\n     * Check clickup tasks for more details\n     * https://app.clickup.com/t/22hy1k4\n     * When customer called a queue (Either using skype or using internal number), call would get established\n     * customer would hear agent's voice but agent would not hear anything from customer.\n     * This issue was observed on unstable. It was found to be inconsistent to reproduce.\n     * On some developer env, it would happen randomly. On Safari it did not happen if\n     * user refreshes before taking every call.\n     *\n     * The reason behind this was as soon as agent accepts a call, queueCounter would change.\n     * This change will trigger re-rendering of media and creation of audio element.\n     * This audio element gets used by voipClient to render the remote audio.\n     * Because the re-render happened, it would hold a stale reference.\n     *\n     * If the dom is inspected, audio element just before body is usually created by this class.\n     * this audio element.srcObject contains null value. In working case, it should display\n     * valid stream object.\n     *\n     * Reason for inconsistencies :\n     * This element is utilized in VoIPUser::setupRemoteMedia\n     * This function is called when webRTC receives a remote track event. i.e when the webrtc's peer connection\n     * starts receiving media. This event call back depends on several factors. How does asterisk setup streams.\n     * How does it creates a bridge which patches up the agent and customer (Media is flowing thru asterisk).\n     * When it works in de-environment, it was observed that the audio element in dom and the audio element hold\n     * by VoIPUser is different. Nonetheless, this stale audio element holds valid media stream, which is being played.\n     * Hence sometimes the audio is heard.\n     *\n     * Ideally call component once gets stable, should not get rerendered. Queue, Room creation are the parameters\n     * which should be independent and should not control the call component.\n     *\n     * Solution :\n     * Either make the audio elemenent rendered independent of rest of the DOM.\n     * or implement useEffect. This useEffect will reset the rendering elements with the latest audio tag.\n     *\n     * Note : If this code gets refactor, revisit the line below to check if this call is needed.\n     *\n     */\n    remoteAudioMediaRef.current && result.voipClient.switchMediaRenderer({\n      remoteMediaElement: remoteAudioMediaRef.current\n    });\n  }, [result.voipClient]);\n  useEffect(function () {\n    if (!result.voipClient) {\n      return;\n    }\n    if (!user) {\n      return;\n    }\n    var onCallEstablished = function () {\n      function _callee5(callDetails) {\n        var _result$voipClient3;\n        var callInfo, roomId;\n        return _regeneratorRuntime.async(function () {\n          function _callee5$(_context5) {\n            while (1) switch (_context5.prev = _context5.next) {\n              case 0:\n                if (callDetails.callInfo) {\n                  _context5.next = 2;\n                  break;\n                }\n                return _context5.abrupt(\"return\");\n              case 2:\n                voipSounds.stopAll();\n                if (!(callDetails.userState !== UserState.UAC)) {\n                  _context5.next = 5;\n                  break;\n                }\n                return _context5.abrupt(\"return\");\n              case 5:\n                // Agent has sent Invite. So it must create a room.\n                callInfo = callDetails.callInfo; // While making the call, there is no remote media element available.\n                // When the call is ringing we have that element created. But we still\n                // do not want it to be attached.\n                // When call gets established, then switch the media renderer.\n                remoteAudioMediaRef.current && ((_result$voipClient3 = result.voipClient) === null || _result$voipClient3 === void 0 ? void 0 : _result$voipClient3.switchMediaRenderer({\n                  remoteMediaElement: remoteAudioMediaRef.current\n                }));\n                _context5.next = 9;\n                return _regeneratorRuntime.awrap(createRoom(callInfo, 'outbound'));\n              case 9:\n                roomId = _context5.sent;\n                dispatchEvent({\n                  event: VoipClientEvents['VOIP-CALL-STARTED'],\n                  rid: roomId\n                });\n              case 11:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n          return _callee5$;\n        }(), null, null, null, Promise);\n      }\n      return _callee5;\n    }();\n    var onNetworkConnected = function () {\n      if (networkStatus === 'offline') {\n        setNetworkStatus('online');\n      }\n    };\n    var onNetworkDisconnected = function () {\n      var _result$voipClient5, _result$voipClient6;\n      // Transitioning from online -> offline\n      // If there is ongoing call, terminate it or if we are processing an incoming/outgoing call\n      // reject it.\n      if (networkStatus === 'online') {\n        var _result$voipClient4;\n        setNetworkStatus('offline');\n        switch ((_result$voipClient4 = result.voipClient) === null || _result$voipClient4 === void 0 ? void 0 : _result$voipClient4.callerInfo.state) {\n          case 'IN_CALL':\n          case 'ON_HOLD':\n            (_result$voipClient5 = result.voipClient) === null || _result$voipClient5 === void 0 ? void 0 : _result$voipClient5.endCall();\n            break;\n          case 'OFFER_RECEIVED':\n          case 'ANSWER_SENT':\n            (_result$voipClient6 = result.voipClient) === null || _result$voipClient6 === void 0 ? void 0 : _result$voipClient6.rejectCall();\n            break;\n        }\n      }\n    };\n    var onRinging = function () {\n      voipSounds.play('outbound-call-ringing');\n    };\n    var onIncomingCallRinging = function () {\n      voipSounds.play('telephone');\n    };\n    var onCallTerminated = function () {\n      voipSounds.play('call-ended', false);\n      voipSounds.stopAll();\n    };\n    var onCallFailed = function (reason) {\n      switch (reason) {\n        case 'Not Found':\n          // This happens when the call matches dialplan and goes to the world, but the trunk doesnt find the number.\n          openDialModal({\n            errorMessage: t('Dialed_number_doesnt_exist')\n          });\n          break;\n        case 'Address Incomplete':\n          // This happens when the dialed number doesnt match a valid asterisk dialplan pattern or the number is invalid.\n          openDialModal({\n            errorMessage: t('Dialed_number_is_incomplete')\n          });\n          break;\n        case 'Request Terminated':\n          break;\n        default:\n          openDialModal({\n            errorMessage: t('Something_went_wrong_try_again_later')\n          });\n      }\n    };\n    result.voipClient.onNetworkEvent('connected', onNetworkConnected);\n    result.voipClient.onNetworkEvent('disconnected', onNetworkDisconnected);\n    result.voipClient.onNetworkEvent('connectionerror', onNetworkDisconnected);\n    result.voipClient.onNetworkEvent('localnetworkonline', onNetworkConnected);\n    result.voipClient.onNetworkEvent('localnetworkoffline', onNetworkDisconnected);\n    result.voipClient.on('callestablished', onCallEstablished);\n    result.voipClient.on('ringing', onRinging); // not called for incoming call\n    result.voipClient.on('incomingcall', onIncomingCallRinging);\n    result.voipClient.on('callterminated', onCallTerminated);\n    if (isOutboundClient(result.voipClient)) {\n      result.voipClient.on('callfailed', onCallFailed);\n    }\n    return function () {\n      var _result$voipClient7, _result$voipClient8, _result$voipClient9, _result$voipClient10, _result$voipClient11, _result$voipClient12, _result$voipClient13, _result$voipClient14, _result$voipClient15;\n      (_result$voipClient7 = result.voipClient) === null || _result$voipClient7 === void 0 ? void 0 : _result$voipClient7.offNetworkEvent('connected', onNetworkConnected);\n      (_result$voipClient8 = result.voipClient) === null || _result$voipClient8 === void 0 ? void 0 : _result$voipClient8.offNetworkEvent('disconnected', onNetworkDisconnected);\n      (_result$voipClient9 = result.voipClient) === null || _result$voipClient9 === void 0 ? void 0 : _result$voipClient9.offNetworkEvent('connectionerror', onNetworkDisconnected);\n      (_result$voipClient10 = result.voipClient) === null || _result$voipClient10 === void 0 ? void 0 : _result$voipClient10.offNetworkEvent('localnetworkonline', onNetworkConnected);\n      (_result$voipClient11 = result.voipClient) === null || _result$voipClient11 === void 0 ? void 0 : _result$voipClient11.offNetworkEvent('localnetworkoffline', onNetworkDisconnected);\n      (_result$voipClient12 = result.voipClient) === null || _result$voipClient12 === void 0 ? void 0 : _result$voipClient12.off('incomingcall', onIncomingCallRinging);\n      (_result$voipClient13 = result.voipClient) === null || _result$voipClient13 === void 0 ? void 0 : _result$voipClient13.off('ringing', onRinging);\n      (_result$voipClient14 = result.voipClient) === null || _result$voipClient14 === void 0 ? void 0 : _result$voipClient14.off('callestablished', onCallEstablished);\n      (_result$voipClient15 = result.voipClient) === null || _result$voipClient15 === void 0 ? void 0 : _result$voipClient15.off('callterminated', onCallTerminated);\n      if (isOutboundClient(result.voipClient)) {\n        var _result$voipClient16;\n        (_result$voipClient16 = result.voipClient) === null || _result$voipClient16 === void 0 ? void 0 : _result$voipClient16.off('callfailed', onCallFailed);\n      }\n    };\n  }, [createRoom, dispatchEvent, networkStatus, openDialModal, result.voipClient, voipSounds, t, user]);\n  var contextValue = useMemo(function () {\n    if (!voipEnabled) {\n      return {\n        enabled: false,\n        ready: false,\n        outBoundCallsAllowed: undefined,\n        // set to true only if enterprise license is present.\n        outBoundCallsEnabled: undefined,\n        // set to true even if enterprise license is not present.\n        outBoundCallsEnabledForUser: undefined // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n      };\n    }\n    if (!(user !== null && user !== void 0 && user.extension)) {\n      return {\n        enabled: false,\n        ready: false,\n        outBoundCallsAllowed: undefined,\n        // set to true only if enterprise license is present.\n        outBoundCallsEnabled: undefined,\n        // set to true even if enterprise license is not present.\n        outBoundCallsEnabledForUser: undefined // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n      };\n    }\n    if (result.error) {\n      return {\n        enabled: true,\n        ready: false,\n        error: result.error,\n        outBoundCallsAllowed: undefined,\n        // set to true only if enterprise license is present.\n        outBoundCallsEnabled: undefined,\n        // set to true even if enterprise license is not present.\n        outBoundCallsEnabledForUser: undefined // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n      };\n    }\n    if (!result.voipClient) {\n      return {\n        enabled: true,\n        ready: false,\n        outBoundCallsAllowed: undefined,\n        // set to true only if enterprise license is present.\n        outBoundCallsEnabled: undefined,\n        // set to true even if enterprise license is not present.\n        outBoundCallsEnabledForUser: undefined // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n      };\n    }\n    var registrationInfo = result.registrationInfo,\n      voipClient = result.voipClient;\n    return {\n      outBoundCallsAllowed: hasVoIPEnterpriseLicense,\n      // set to true only if enterprise license is present.\n      outBoundCallsEnabled: hasVoIPEnterpriseLicense,\n      // set to true even if enterprise license is not present.\n      outBoundCallsEnabledForUser: hasVoIPEnterpriseLicense && clientState === 'registered' && !['IN_CALL', 'ON_HOLD'].includes(voipClient.callerInfo.state),\n      // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n      enabled: true,\n      ready: true,\n      openedRoomInfo: roomInfo,\n      voipClient: voipClient,\n      registrationInfo: registrationInfo,\n      queueCounter: queueCounter,\n      queueName: queueName,\n      actions: {\n        mute: function () {\n          return voipClient.muteCall(true);\n        },\n        // voipClient.mute(),\n        unmute: function () {\n          return voipClient.muteCall(false);\n        },\n        // voipClient.unmute()\n        pause: function () {\n          return voipClient.holdCall(true);\n        },\n        // voipClient.pause()\n        resume: function () {\n          return voipClient.holdCall(false);\n        },\n        // voipClient.resume()\n        end: function () {\n          return voipClient.endCall();\n        },\n        pickUp: function () {\n          function _callee6() {\n            return _regeneratorRuntime.async(function () {\n              function _callee6$(_context6) {\n                while (1) switch (_context6.prev = _context6.next) {\n                  case 0:\n                    return _context6.abrupt(\"return\", remoteAudioMediaRef.current && voipClient.acceptCall({\n                      remoteMediaElement: remoteAudioMediaRef.current\n                    }));\n                  case 1:\n                  case \"end\":\n                    return _context6.stop();\n                }\n              }\n              return _callee6$;\n            }(), null, null, null, Promise);\n          }\n          return _callee6;\n        }(),\n        reject: function () {\n          return voipClient.rejectCall();\n        }\n      },\n      openRoom: openRoom,\n      createRoom: createRoom,\n      closeRoom: closeRoom,\n      networkStatus: networkStatus,\n      openWrapUpModal: openWrapUpModal,\n      changeAudioOutputDevice: changeAudioOutputDevice,\n      changeAudioInputDevice: changeAudioInputDevice,\n      register: function () {\n        return voipClient.register();\n      },\n      unregister: function () {\n        return voipClient.unregister();\n      }\n    };\n  }, [voipEnabled, user === null || user === void 0 ? void 0 : user.extension, result, hasVoIPEnterpriseLicense, clientState, roomInfo, queueCounter, queueName, openRoom, createRoom, closeRoom, openWrapUpModal, changeAudioOutputDevice, changeAudioInputDevice, networkStatus]);\n  return /*#__PURE__*/React.createElement(CallContext.Provider, {\n    value: contextValue\n  }, children, contextValue.enabled && /*#__PURE__*/createPortal( /*#__PURE__*/React.createElement(\"audio\", {\n    ref: remoteAudioMediaRef\n  }, /*#__PURE__*/React.createElement(\"track\", {\n    kind: \"captions\"\n  })), document.body));\n};","map":{"version":3,"names":["_regeneratorRuntime","module","link","default","v","_slicedToArray","export","CallProvider","VoipClientEvents","isVoipEventAgentCalled","isVoipEventAgentConnected","isVoipEventCallerJoined","isVoipEventQueueMemberAdded","isVoipEventQueueMemberRemoved","isVoipEventCallAbandoned","UserState","useMutableCallback","Random","useRouter","useUser","useSetting","useEndpoint","useStream","useSetOutputMediaDevice","useSetInputMediaDevice","useSetModal","useTranslation","React","useMemo","useRef","useCallback","useEffect","useState","createPortal","CallContext","useIsVoipEnterprise","useDialModal","isOutboundClient","useVoipClient","roomCoordinator","parseOutboundPhoneNumber","WrapUpCallModal","useVoipSounds","_ref","children","_useState","_useState2","clientState","setClientState","voipEnabled","subscribeToNotifyUser","dispatchEvent","visitorEndpoint","voipEndpoint","voipCloseRoomEndpoint","getContactBy","setModal","t","result","user","router","setOutputMediaDevice","setInputMediaDevice","hasVoIPEnterpriseLicense","remoteAudioMediaRef","_useState3","_useState4","queueCounter","setQueueCounter","_useState5","_useState6","queueName","setQueueName","_useState7","rid","_useState8","roomInfo","setRoomInfo","_useDialModal","openDialModal","voipSounds","closeRoom","_callee","_result$voipClient","data","queueAggregator","_args","arguments","async","_callee$","_context","prev","next","length","undefined","t0","awrap","token","options","comment","tags","navigate","voipClient","getAggregator","callEnded","stop","Promise","openWrapUpModal","createElement","changeAudioOutputDevice","selectedAudioDevice","current","outputDevice","HTMLAudioElement","changeAudioInputDevice","constraints","audio","deviceId","exact","id","_useState9","_useState10","setQueueAggregator","_useState11","_useState12","networkStatus","setNetworkStatus","_ref2","unregister","openRoom","openRouteLink","findOrCreateVisitor","_callee2","caller","phone","_await$getContactBy","contact","_await$visitorEndpoin","visitor","_callee2$","_context2","callerId","sent","abrupt","name","callerName","createRoom","_callee3","direction","_result$voipClient2","voipRoom","_queueAggregator","_args3","_callee3$","_context3","agentId","_id","room","callStarted","console","error","handleEventReceived","_callee4","event","_data","_data2","_data3","_data4","_data5","_callee4$","_context4","callRinging","queuename","queue","callerid","getCurrentQueueName","callPickedup","queuedcalls","queuedCalls","waittimeinqueue","waitTimeInQueue","getCallWaitingCount","queueJoined","memberAdded","memberRemoved","queueAbandoned","queuedcallafterabandon","queuedCallAfterAbandon","warn","roomId","offRegistered","on","offUnregistered","switchMediaRenderer","remoteMediaElement","onCallEstablished","_callee5","callDetails","_result$voipClient3","callInfo","_callee5$","_context5","stopAll","userState","UAC","onNetworkConnected","onNetworkDisconnected","_result$voipClient5","_result$voipClient6","_result$voipClient4","callerInfo","state","endCall","rejectCall","onRinging","play","onIncomingCallRinging","onCallTerminated","onCallFailed","reason","errorMessage","onNetworkEvent","_result$voipClient7","_result$voipClient8","_result$voipClient9","_result$voipClient10","_result$voipClient11","_result$voipClient12","_result$voipClient13","_result$voipClient14","_result$voipClient15","offNetworkEvent","off","_result$voipClient16","contextValue","enabled","ready","outBoundCallsAllowed","outBoundCallsEnabled","outBoundCallsEnabledForUser","extension","registrationInfo","includes","openedRoomInfo","actions","mute","muteCall","unmute","pause","holdCall","resume","end","pickUp","_callee6","_callee6$","_context6","acceptCall","reject","register","Provider","value","ref","kind","document","body"],"sources":["client/providers/CallProvider/CallProvider.tsx"],"sourcesContent":["import type { IVoipRoom, VoipEventDataSignature, ICallerInfo, ICallDetails, ILivechatVisitor, Serialized } from '@rocket.chat/core-typings';\nimport {\n\tVoipClientEvents,\n\tisVoipEventAgentCalled,\n\tisVoipEventAgentConnected,\n\tisVoipEventCallerJoined,\n\tisVoipEventQueueMemberAdded,\n\tisVoipEventQueueMemberRemoved,\n\tisVoipEventCallAbandoned,\n\tUserState,\n} from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { Random } from '@rocket.chat/random';\nimport type { Device } from '@rocket.chat/ui-contexts';\nimport {\n\tuseRouter,\n\tuseUser,\n\tuseSetting,\n\tuseEndpoint,\n\tuseStream,\n\tuseSetOutputMediaDevice,\n\tuseSetInputMediaDevice,\n\tuseSetModal,\n\tuseTranslation,\n} from '@rocket.chat/ui-contexts';\nimport type { ReactNode } from 'react';\nimport React, { useMemo, useRef, useCallback, useEffect, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport type { OutgoingByeRequest } from 'sip.js/lib/core';\n\nimport type { CallContextValue } from '../../contexts/CallContext';\nimport { CallContext, useIsVoipEnterprise } from '../../contexts/CallContext';\nimport { useDialModal } from '../../hooks/useDialModal';\nimport { isOutboundClient, useVoipClient } from '../../hooks/useVoipClient';\nimport { roomCoordinator } from '../../lib/rooms/roomCoordinator';\nimport type { QueueAggregator } from '../../lib/voip/QueueAggregator';\nimport { parseOutboundPhoneNumber } from '../../lib/voip/parseOutboundPhoneNumber';\nimport { WrapUpCallModal } from '../../voip/components/modals/WrapUpCallModal';\nimport { useVoipSounds } from './hooks/useVoipSounds';\n\ntype NetworkState = 'online' | 'offline';\n\ntype CallProviderProps = {\n\tchildren?: ReactNode;\n};\n\nexport const CallProvider = ({ children }: CallProviderProps) => {\n\tconst [clientState, setClientState] = useState<'registered' | 'unregistered'>('unregistered');\n\n\tconst voipEnabled = useSetting('VoIP_Enabled');\n\tconst subscribeToNotifyUser = useStream('notify-user');\n\tconst dispatchEvent = useEndpoint('POST', '/v1/voip/events');\n\tconst visitorEndpoint = useEndpoint('POST', '/v1/livechat/visitor');\n\tconst voipEndpoint = useEndpoint('GET', '/v1/voip/room');\n\tconst voipCloseRoomEndpoint = useEndpoint('POST', '/v1/voip/room.close');\n\tconst getContactBy = useEndpoint('GET', '/v1/omnichannel/contact.search');\n\tconst setModal = useSetModal();\n\tconst t = useTranslation();\n\n\tconst result = useVoipClient();\n\tconst user = useUser();\n\tconst router = useRouter();\n\tconst setOutputMediaDevice = useSetOutputMediaDevice();\n\tconst setInputMediaDevice = useSetInputMediaDevice();\n\n\tconst hasVoIPEnterpriseLicense = useIsVoipEnterprise();\n\n\tconst remoteAudioMediaRef = useRef<HTMLAudioElement>(null); // TODO: Create a dedicated file for the AUDIO and make the controls accessible\n\n\tconst [queueCounter, setQueueCounter] = useState(0);\n\tconst [queueName, setQueueName] = useState('');\n\tconst [roomInfo, setRoomInfo] = useState<{ v: { token?: string }; rid: string }>({ v: {}, rid: '' });\n\n\tconst { openDialModal } = useDialModal();\n\n\tconst voipSounds = useVoipSounds();\n\n\tconst closeRoom = useCallback(\n\t\tasync (data = {}): Promise<void> => {\n\t\t\troomInfo &&\n\t\t\t\t(await voipCloseRoomEndpoint({\n\t\t\t\t\trid: roomInfo.rid,\n\t\t\t\t\ttoken: roomInfo.v.token || '',\n\t\t\t\t\toptions: { comment: data?.comment, tags: data?.tags },\n\t\t\t\t}));\n\t\t\trouter.navigate('/home');\n\n\t\t\tconst queueAggregator = result.voipClient?.getAggregator();\n\t\t\tif (queueAggregator) {\n\t\t\t\tqueueAggregator.callEnded();\n\t\t\t}\n\t\t},\n\t\t[router, result?.voipClient, roomInfo, voipCloseRoomEndpoint],\n\t);\n\n\tconst openWrapUpModal = useCallback((): void => {\n\t\tsetModal(() => <WrapUpCallModal closeRoom={closeRoom} />);\n\t}, [closeRoom, setModal]);\n\n\tconst changeAudioOutputDevice = useMutableCallback((selectedAudioDevice: Device): void => {\n\t\tremoteAudioMediaRef?.current &&\n\t\t\tsetOutputMediaDevice({ outputDevice: selectedAudioDevice, HTMLAudioElement: remoteAudioMediaRef.current });\n\t});\n\n\tconst changeAudioInputDevice = useMutableCallback((selectedAudioDevice: Device): void => {\n\t\tif (!result.voipClient) {\n\t\t\treturn;\n\t\t}\n\t\tconst constraints = { audio: { deviceId: { exact: selectedAudioDevice.id } } };\n\n\t\t// TODO: Migrate the classes that manage MediaStream to a more react based approach (using contexts/providers perhaps)\n\t\t// For now the MediaStream management is very coupled with the VoIP client,\n\t\t// decoupling it will make it usable by other areas of the project that needs to handle MediaStreams and avoid code duplication\n\t\tresult.voipClient.changeAudioInputDevice(constraints);\n\n\t\tsetInputMediaDevice(selectedAudioDevice);\n\t});\n\n\tconst [queueAggregator, setQueueAggregator] = useState<QueueAggregator>();\n\n\tconst [networkStatus, setNetworkStatus] = useState<NetworkState>('online');\n\n\tuseEffect(() => {\n\t\tconst { voipClient } = result || {};\n\n\t\tif (!voipClient) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetQueueAggregator(voipClient.getAggregator());\n\n\t\treturn (): void => {\n\t\t\tif (clientState === 'registered') {\n\t\t\t\treturn voipClient.unregister();\n\t\t\t}\n\t\t};\n\t}, [result, clientState]);\n\n\tconst openRoom = useCallback((rid: IVoipRoom['_id']): void => {\n\t\troomCoordinator.openRouteLink('v', { rid });\n\t}, []);\n\n\tconst findOrCreateVisitor = useCallback(\n\t\tasync (caller: ICallerInfo): Promise<Serialized<ILivechatVisitor>> => {\n\t\t\tconst phone = parseOutboundPhoneNumber(caller.callerId);\n\n\t\t\tconst { contact } = await getContactBy({ phone });\n\n\t\t\tif (contact) {\n\t\t\t\treturn contact;\n\t\t\t}\n\n\t\t\tconst { visitor } = await visitorEndpoint({\n\t\t\t\tvisitor: {\n\t\t\t\t\ttoken: Random.id(),\n\t\t\t\t\tphone,\n\t\t\t\t\tname: caller.callerName || phone,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn visitor;\n\t\t},\n\t\t[getContactBy, visitorEndpoint],\n\t);\n\n\tconst createRoom = useCallback(\n\t\tasync (caller: ICallerInfo, direction: IVoipRoom['direction'] = 'inbound'): Promise<IVoipRoom['_id']> => {\n\t\t\tif (!user) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tconst visitor = await findOrCreateVisitor(caller);\n\t\t\t\tconst voipRoom = await voipEndpoint({ token: visitor.token, agentId: user._id, direction });\n\t\t\t\topenRoom(voipRoom.room._id);\n\t\t\t\tvoipRoom.room && setRoomInfo({ v: { token: voipRoom.room.v.token }, rid: voipRoom.room._id });\n\t\t\t\tconst queueAggregator = result.voipClient?.getAggregator();\n\t\t\t\tif (queueAggregator) {\n\t\t\t\t\tqueueAggregator.callStarted();\n\t\t\t\t}\n\t\t\t\treturn voipRoom.room._id;\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(`Error while creating a visitor ${error}`);\n\t\t\t\treturn '';\n\t\t\t}\n\t\t},\n\t\t[openRoom, result.voipClient, user, voipEndpoint, findOrCreateVisitor],\n\t);\n\n\tuseEffect(() => {\n\t\tif (!voipEnabled || !user || !queueAggregator) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst handleEventReceived = async (event: VoipEventDataSignature): Promise<void> => {\n\t\t\tif (isVoipEventAgentCalled(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.callRinging({ queuename: data.queue, callerid: data.callerId });\n\t\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventAgentConnected(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.callPickedup({ queuename: data.queue, queuedcalls: data.queuedCalls, waittimeinqueue: data.waitTimeInQueue });\n\t\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventCallerJoined(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.queueJoined({ queuename: data.queue, callerid: data.callerId, queuedcalls: data.queuedCalls });\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventQueueMemberAdded(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.memberAdded({ queuename: data.queue, queuedcalls: data.queuedCalls });\n\t\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventQueueMemberRemoved(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.memberRemoved({ queuename: data.queue, queuedcalls: data.queuedCalls });\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isVoipEventCallAbandoned(event)) {\n\t\t\t\tconst { data } = event;\n\t\t\t\tqueueAggregator.queueAbandoned({ queuename: data.queue, queuedcallafterabandon: data.queuedCallAfterAbandon });\n\t\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\t\t\t\tsetQueueCounter(queueAggregator.getCallWaitingCount());\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconsole.warn('Unknown event received');\n\t\t};\n\n\t\treturn subscribeToNotifyUser(`${user._id}/voip.events`, handleEventReceived);\n\t}, [subscribeToNotifyUser, user, queueAggregator, voipEnabled]);\n\n\t// This was causing event duplication before, so we'll leave this here for now\n\tuseEffect(() => {\n\t\tif (!voipEnabled || !user || !queueAggregator) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn subscribeToNotifyUser(`${user._id}/call.hangup`, (event): void => {\n\t\t\tsetQueueName(queueAggregator.getCurrentQueueName());\n\n\t\t\tif (hasVoIPEnterpriseLicense) {\n\t\t\t\topenWrapUpModal();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcloseRoom();\n\n\t\t\tdispatchEvent({ event: VoipClientEvents['VOIP-CALL-ENDED'], rid: event.roomId });\n\t\t});\n\t}, [openWrapUpModal, queueAggregator, subscribeToNotifyUser, user, voipEnabled, dispatchEvent, hasVoIPEnterpriseLicense, closeRoom]);\n\n\tuseEffect(() => {\n\t\tif (!result.voipClient) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst offRegistered = result.voipClient.on('registered', (): void => setClientState('registered'));\n\t\tconst offUnregistered = result.voipClient.on('unregistered', (): void => setClientState('unregistered'));\n\n\t\treturn (): void => {\n\t\t\toffRegistered();\n\t\t\toffUnregistered();\n\t\t};\n\t}, [result.voipClient]);\n\n\tuseEffect(() => {\n\t\tif (!result.voipClient) {\n\t\t\treturn;\n\t\t}\n\n\t\t/*\n\t\t * This code may need a revisit when we handle callinqueue differently.\n\t\t * Check clickup tasks for more details\n\t\t * https://app.clickup.com/t/22hy1k4\n\t\t * When customer called a queue (Either using skype or using internal number), call would get established\n\t\t * customer would hear agent's voice but agent would not hear anything from customer.\n\t\t * This issue was observed on unstable. It was found to be inconsistent to reproduce.\n\t\t * On some developer env, it would happen randomly. On Safari it did not happen if\n\t\t * user refreshes before taking every call.\n\t\t *\n\t\t * The reason behind this was as soon as agent accepts a call, queueCounter would change.\n\t\t * This change will trigger re-rendering of media and creation of audio element.\n\t\t * This audio element gets used by voipClient to render the remote audio.\n\t\t * Because the re-render happened, it would hold a stale reference.\n\t\t *\n\t\t * If the dom is inspected, audio element just before body is usually created by this class.\n\t\t * this audio element.srcObject contains null value. In working case, it should display\n\t\t * valid stream object.\n\t\t *\n\t\t * Reason for inconsistencies :\n\t\t * This element is utilized in VoIPUser::setupRemoteMedia\n\t\t * This function is called when webRTC receives a remote track event. i.e when the webrtc's peer connection\n\t\t * starts receiving media. This event call back depends on several factors. How does asterisk setup streams.\n\t\t * How does it creates a bridge which patches up the agent and customer (Media is flowing thru asterisk).\n\t\t * When it works in de-environment, it was observed that the audio element in dom and the audio element hold\n\t\t * by VoIPUser is different. Nonetheless, this stale audio element holds valid media stream, which is being played.\n\t\t * Hence sometimes the audio is heard.\n\t\t *\n\t\t * Ideally call component once gets stable, should not get rerendered. Queue, Room creation are the parameters\n\t\t * which should be independent and should not control the call component.\n\t\t *\n\t\t * Solution :\n\t\t * Either make the audio elemenent rendered independent of rest of the DOM.\n\t\t * or implement useEffect. This useEffect will reset the rendering elements with the latest audio tag.\n\t\t *\n\t\t * Note : If this code gets refactor, revisit the line below to check if this call is needed.\n\t\t *\n\t\t */\n\t\tremoteAudioMediaRef.current && result.voipClient.switchMediaRenderer({ remoteMediaElement: remoteAudioMediaRef.current });\n\t}, [result.voipClient]);\n\n\tuseEffect(() => {\n\t\tif (!result.voipClient) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!user) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst onCallEstablished = async (callDetails: ICallDetails): Promise<undefined> => {\n\t\t\tif (!callDetails.callInfo) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvoipSounds.stopAll();\n\t\t\tif (callDetails.userState !== UserState.UAC) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Agent has sent Invite. So it must create a room.\n\t\t\tconst { callInfo } = callDetails;\n\t\t\t// While making the call, there is no remote media element available.\n\t\t\t// When the call is ringing we have that element created. But we still\n\t\t\t// do not want it to be attached.\n\t\t\t// When call gets established, then switch the media renderer.\n\t\t\tremoteAudioMediaRef.current && result.voipClient?.switchMediaRenderer({ remoteMediaElement: remoteAudioMediaRef.current });\n\t\t\tconst roomId = await createRoom(callInfo, 'outbound');\n\t\t\tdispatchEvent({ event: VoipClientEvents['VOIP-CALL-STARTED'], rid: roomId });\n\t\t};\n\n\t\tconst onNetworkConnected = (): void => {\n\t\t\tif (networkStatus === 'offline') {\n\t\t\t\tsetNetworkStatus('online');\n\t\t\t}\n\t\t};\n\n\t\tconst onNetworkDisconnected = (): void => {\n\t\t\t// Transitioning from online -> offline\n\t\t\t// If there is ongoing call, terminate it or if we are processing an incoming/outgoing call\n\t\t\t// reject it.\n\t\t\tif (networkStatus === 'online') {\n\t\t\t\tsetNetworkStatus('offline');\n\t\t\t\tswitch (result.voipClient?.callerInfo.state) {\n\t\t\t\t\tcase 'IN_CALL':\n\t\t\t\t\tcase 'ON_HOLD':\n\t\t\t\t\t\tresult.voipClient?.endCall();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'OFFER_RECEIVED':\n\t\t\t\t\tcase 'ANSWER_SENT':\n\t\t\t\t\t\tresult.voipClient?.rejectCall();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst onRinging = (): void => {\n\t\t\tvoipSounds.play('outbound-call-ringing');\n\t\t};\n\n\t\tconst onIncomingCallRinging = (): void => {\n\t\t\tvoipSounds.play('telephone');\n\t\t};\n\n\t\tconst onCallTerminated = (): void => {\n\t\t\tvoipSounds.play('call-ended', false);\n\t\t\tvoipSounds.stopAll();\n\t\t};\n\n\t\tconst onCallFailed = (reason: 'Not Found' | 'Address Incomplete' | 'Request Terminated' | string): void => {\n\t\t\tswitch (reason) {\n\t\t\t\tcase 'Not Found':\n\t\t\t\t\t// This happens when the call matches dialplan and goes to the world, but the trunk doesnt find the number.\n\t\t\t\t\topenDialModal({ errorMessage: t('Dialed_number_doesnt_exist') });\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Address Incomplete':\n\t\t\t\t\t// This happens when the dialed number doesnt match a valid asterisk dialplan pattern or the number is invalid.\n\t\t\t\t\topenDialModal({ errorMessage: t('Dialed_number_is_incomplete') });\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Request Terminated':\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\topenDialModal({ errorMessage: t('Something_went_wrong_try_again_later') });\n\t\t\t}\n\t\t};\n\n\t\tresult.voipClient.onNetworkEvent('connected', onNetworkConnected);\n\t\tresult.voipClient.onNetworkEvent('disconnected', onNetworkDisconnected);\n\t\tresult.voipClient.onNetworkEvent('connectionerror', onNetworkDisconnected);\n\t\tresult.voipClient.onNetworkEvent('localnetworkonline', onNetworkConnected);\n\t\tresult.voipClient.onNetworkEvent('localnetworkoffline', onNetworkDisconnected);\n\t\tresult.voipClient.on('callestablished', onCallEstablished);\n\t\tresult.voipClient.on('ringing', onRinging); // not called for incoming call\n\t\tresult.voipClient.on('incomingcall', onIncomingCallRinging);\n\t\tresult.voipClient.on('callterminated', onCallTerminated);\n\n\t\tif (isOutboundClient(result.voipClient)) {\n\t\t\tresult.voipClient.on('callfailed', onCallFailed);\n\t\t}\n\n\t\treturn (): void => {\n\t\t\tresult.voipClient?.offNetworkEvent('connected', onNetworkConnected);\n\t\t\tresult.voipClient?.offNetworkEvent('disconnected', onNetworkDisconnected);\n\t\t\tresult.voipClient?.offNetworkEvent('connectionerror', onNetworkDisconnected);\n\t\t\tresult.voipClient?.offNetworkEvent('localnetworkonline', onNetworkConnected);\n\t\t\tresult.voipClient?.offNetworkEvent('localnetworkoffline', onNetworkDisconnected);\n\t\t\tresult.voipClient?.off('incomingcall', onIncomingCallRinging);\n\t\t\tresult.voipClient?.off('ringing', onRinging);\n\t\t\tresult.voipClient?.off('callestablished', onCallEstablished);\n\t\t\tresult.voipClient?.off('callterminated', onCallTerminated);\n\n\t\t\tif (isOutboundClient(result.voipClient)) {\n\t\t\t\tresult.voipClient?.off('callfailed', onCallFailed);\n\t\t\t}\n\t\t};\n\t}, [createRoom, dispatchEvent, networkStatus, openDialModal, result.voipClient, voipSounds, t, user]);\n\n\tconst contextValue: CallContextValue = useMemo(() => {\n\t\tif (!voipEnabled) {\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\tready: false,\n\t\t\t\toutBoundCallsAllowed: undefined, // set to true only if enterprise license is present.\n\t\t\t\toutBoundCallsEnabled: undefined, // set to true even if enterprise license is not present.\n\t\t\t\toutBoundCallsEnabledForUser: undefined, // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\t\t\t};\n\t\t}\n\n\t\tif (!user?.extension) {\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\tready: false,\n\t\t\t\toutBoundCallsAllowed: undefined, // set to true only if enterprise license is present.\n\t\t\t\toutBoundCallsEnabled: undefined, // set to true even if enterprise license is not present.\n\t\t\t\toutBoundCallsEnabledForUser: undefined, // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\t\t\t};\n\t\t}\n\n\t\tif (result.error) {\n\t\t\treturn {\n\t\t\t\tenabled: true,\n\t\t\t\tready: false,\n\t\t\t\terror: result.error,\n\t\t\t\toutBoundCallsAllowed: undefined, // set to true only if enterprise license is present.\n\t\t\t\toutBoundCallsEnabled: undefined, // set to true even if enterprise license is not present.\n\t\t\t\toutBoundCallsEnabledForUser: undefined, // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\t\t\t};\n\t\t}\n\n\t\tif (!result.voipClient) {\n\t\t\treturn {\n\t\t\t\tenabled: true,\n\t\t\t\tready: false,\n\t\t\t\toutBoundCallsAllowed: undefined, // set to true only if enterprise license is present.\n\t\t\t\toutBoundCallsEnabled: undefined, // set to true even if enterprise license is not present.\n\t\t\t\toutBoundCallsEnabledForUser: undefined, // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\t\t\t};\n\t\t}\n\n\t\tconst { registrationInfo, voipClient } = result;\n\n\t\treturn {\n\t\t\toutBoundCallsAllowed: hasVoIPEnterpriseLicense, // set to true only if enterprise license is present.\n\t\t\toutBoundCallsEnabled: hasVoIPEnterpriseLicense, // set to true even if enterprise license is not present.\n\t\t\toutBoundCallsEnabledForUser:\n\t\t\t\thasVoIPEnterpriseLicense && clientState === 'registered' && !['IN_CALL', 'ON_HOLD'].includes(voipClient.callerInfo.state), // set to true if the user has enterprise license, but is not able to make outbound calls. (busy, or disabled)\n\n\t\t\tenabled: true,\n\t\t\tready: true,\n\t\t\topenedRoomInfo: roomInfo,\n\t\t\tvoipClient,\n\t\t\tregistrationInfo,\n\t\t\tqueueCounter,\n\t\t\tqueueName,\n\t\t\tactions: {\n\t\t\t\tmute: (): Promise<void> => voipClient.muteCall(true), // voipClient.mute(),\n\t\t\t\tunmute: (): Promise<void> => voipClient.muteCall(false), // voipClient.unmute()\n\t\t\t\tpause: (): Promise<void> => voipClient.holdCall(true), // voipClient.pause()\n\t\t\t\tresume: (): Promise<void> => voipClient.holdCall(false), // voipClient.resume()\n\t\t\t\tend: (): Promise<OutgoingByeRequest | void> => voipClient.endCall(),\n\t\t\t\tpickUp: async (): Promise<void | null> =>\n\t\t\t\t\tremoteAudioMediaRef.current && voipClient.acceptCall({ remoteMediaElement: remoteAudioMediaRef.current }),\n\t\t\t\treject: (): Promise<void> => voipClient.rejectCall(),\n\t\t\t},\n\t\t\topenRoom,\n\t\t\tcreateRoom,\n\t\t\tcloseRoom,\n\t\t\tnetworkStatus,\n\t\t\topenWrapUpModal,\n\t\t\tchangeAudioOutputDevice,\n\t\t\tchangeAudioInputDevice,\n\t\t\tregister: (): void => voipClient.register(),\n\t\t\tunregister: (): void => voipClient.unregister(),\n\t\t};\n\t}, [\n\t\tvoipEnabled,\n\t\tuser?.extension,\n\t\tresult,\n\t\thasVoIPEnterpriseLicense,\n\t\tclientState,\n\t\troomInfo,\n\t\tqueueCounter,\n\t\tqueueName,\n\t\topenRoom,\n\t\tcreateRoom,\n\t\tcloseRoom,\n\t\topenWrapUpModal,\n\t\tchangeAudioOutputDevice,\n\t\tchangeAudioInputDevice,\n\t\tnetworkStatus,\n\t]);\n\n\treturn (\n\t\t<CallContext.Provider value={contextValue}>\n\t\t\t{children}\n\t\t\t{contextValue.enabled &&\n\t\t\t\tcreatePortal(\n\t\t\t\t\t<audio ref={remoteAudioMediaRef}>\n\t\t\t\t\t\t<track kind='captions' />\n\t\t\t\t\t</audio>,\n\t\t\t\t\tdocument.body,\n\t\t\t\t)}\n\t\t</CallContext.Provider>\n\t);\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"65ea6ee795b1c2dcb6186048bfb2b962bf4affeb"}
