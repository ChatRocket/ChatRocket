{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/ShareLocation/ShareLocationModal.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/room/ShareLocation/ShareLocationModal.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/ShareLocation/ShareLocationModal.tsx","inputSourceMap":{"version":3,"file":"client/views/room/ShareLocation/ShareLocationModal.tsx","sourceRoot":"","sources":["client/views/room/ShareLocation/ShareLocationModal.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage, IRoom } from '@rocket.chat/core-typings';\nimport { useEndpoint, useTranslation, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport type { ReactElement } from 'react';\nimport React from 'react';\n\nimport GenericModal from '../../../components/GenericModal';\nimport MapView from '../../../components/message/content/location/MapView';\nimport { getGeolocationPermission } from './getGeolocationPermission';\nimport { getGeolocationPosition } from './getGeolocationPosition';\n\ntype ShareLocationModalProps = {\n\trid: IRoom['_id'];\n\ttmid: IMessage['tmid'];\n\tonClose: () => void;\n};\n\nconst ShareLocationModal = ({ rid, tmid, onClose }: ShareLocationModalProps): ReactElement => {\n\tconst t = useTranslation();\n\tconst dispatchToast = useToastMessageDispatch();\n\tconst { data: permissionData, isLoading: permissionLoading } = useQuery(['geolocationPermission'], getGeolocationPermission);\n\tconst { data: positionData } = useQuery(['geolocationPosition', permissionData], async () => {\n\t\tif (permissionLoading || permissionData === 'prompt' || permissionData === 'denied') {\n\t\t\treturn;\n\t\t}\n\t\treturn getGeolocationPosition();\n\t});\n\n\tconst queryClient = useQueryClient();\n\n\tconst sendMessage = useEndpoint('POST', '/v1/chat.sendMessage');\n\n\tconst onConfirm = (): void => {\n\t\tif (!positionData) {\n\t\t\tthrow new Error('Failed to load position');\n\t\t}\n\t\ttry {\n\t\t\tsendMessage({\n\t\t\t\tmessage: {\n\t\t\t\t\trid,\n\t\t\t\t\ttmid,\n\t\t\t\t\tlocation: {\n\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\tcoordinates: [positionData.coords.longitude, positionData.coords.latitude],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tdispatchToast({ type: 'error', message: error });\n\t\t} finally {\n\t\t\tonClose();\n\t\t}\n\t};\n\n\tconst onConfirmRequestLocation = async (): Promise<void> => {\n\t\ttry {\n\t\t\tconst position = await getGeolocationPosition();\n\t\t\tqueryClient.setQueryData(['geolocationPosition', 'granted'], position);\n\t\t\tqueryClient.setQueryData(['geolocationPermission'], 'granted');\n\t\t} catch (e) {\n\t\t\tqueryClient.setQueryData(['geolocationPermission'], () => getGeolocationPermission);\n\t\t}\n\t};\n\n\tif (permissionLoading || permissionData === 'prompt') {\n\t\treturn (\n\t\t\t<GenericModal\n\t\t\t\ttitle={t('You_will_be_asked_for_permissions')}\n\t\t\t\tconfirmText={t('Continue')}\n\t\t\t\tonConfirm={onConfirmRequestLocation}\n\t\t\t\tonClose={onClose}\n\t\t\t\tonCancel={onClose}\n\t\t\t/>\n\t\t);\n\t}\n\n\tif (permissionData === 'denied' || !positionData) {\n\t\treturn (\n\t\t\t<GenericModal title={t('Cannot_share_your_location')} confirmText={t('Ok')} onConfirm={onClose} onClose={onClose}>\n\t\t\t\t{t('The_necessary_browser_permissions_for_location_sharing_are_not_granted')}\n\t\t\t</GenericModal>\n\t\t);\n\t}\n\n\treturn (\n\t\t<GenericModal title={t('Share_Location_Title')} confirmText={t('Share')} onConfirm={onConfirm} onClose={onClose} onCancel={onClose}>\n\t\t\t<MapView latitude={positionData.coords.latitude} longitude={positionData.coords.longitude} />\n\t\t</GenericModal>\n\t);\n};\n\nexport default ShareLocationModal;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/ShareLocation/ShareLocationModal.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/room/ShareLocation/ShareLocationModal.tsx","inputSourceMap":{"version":3,"file":"client/views/room/ShareLocation/ShareLocationModal.tsx","sourceRoot":"","sources":["client/views/room/ShareLocation/ShareLocationModal.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage, IRoom } from '@rocket.chat/core-typings';\nimport { useEndpoint, useTranslation, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport type { ReactElement } from 'react';\nimport React from 'react';\n\nimport GenericModal from '../../../components/GenericModal';\nimport MapView from '../../../components/message/content/location/MapView';\nimport { getGeolocationPermission } from './getGeolocationPermission';\nimport { getGeolocationPosition } from './getGeolocationPosition';\n\ntype ShareLocationModalProps = {\n\trid: IRoom['_id'];\n\ttmid: IMessage['tmid'];\n\tonClose: () => void;\n};\n\nconst ShareLocationModal = ({ rid, tmid, onClose }: ShareLocationModalProps): ReactElement => {\n\tconst t = useTranslation();\n\tconst dispatchToast = useToastMessageDispatch();\n\tconst { data: permissionData, isLoading: permissionLoading } = useQuery(['geolocationPermission'], getGeolocationPermission);\n\tconst { data: positionData } = useQuery(['geolocationPosition', permissionData], async () => {\n\t\tif (permissionLoading || permissionData === 'prompt' || permissionData === 'denied') {\n\t\t\treturn;\n\t\t}\n\t\treturn getGeolocationPosition();\n\t});\n\n\tconst queryClient = useQueryClient();\n\n\tconst sendMessage = useEndpoint('POST', '/v1/chat.sendMessage');\n\n\tconst onConfirm = (): void => {\n\t\tif (!positionData) {\n\t\t\tthrow new Error('Failed to load position');\n\t\t}\n\t\ttry {\n\t\t\tsendMessage({\n\t\t\t\tmessage: {\n\t\t\t\t\trid,\n\t\t\t\t\ttmid,\n\t\t\t\t\tlocation: {\n\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\tcoordinates: [positionData.coords.longitude, positionData.coords.latitude],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tdispatchToast({ type: 'error', message: error });\n\t\t} finally {\n\t\t\tonClose();\n\t\t}\n\t};\n\n\tconst onConfirmRequestLocation = async (): Promise<void> => {\n\t\ttry {\n\t\t\tconst position = await getGeolocationPosition();\n\t\t\tqueryClient.setQueryData(['geolocationPosition', 'granted'], position);\n\t\t\tqueryClient.setQueryData(['geolocationPermission'], 'granted');\n\t\t} catch (e) {\n\t\t\tqueryClient.setQueryData(['geolocationPermission'], () => getGeolocationPermission);\n\t\t}\n\t};\n\n\tif (permissionLoading || permissionData === 'prompt') {\n\t\treturn (\n\t\t\t<GenericModal\n\t\t\t\ttitle={t('You_will_be_asked_for_permissions')}\n\t\t\t\tconfirmText={t('Continue')}\n\t\t\t\tonConfirm={onConfirmRequestLocation}\n\t\t\t\tonClose={onClose}\n\t\t\t\tonCancel={onClose}\n\t\t\t/>\n\t\t);\n\t}\n\n\tif (permissionData === 'denied' || !positionData) {\n\t\treturn (\n\t\t\t<GenericModal title={t('Cannot_share_your_location')} confirmText={t('Ok')} onConfirm={onClose} onClose={onClose}>\n\t\t\t\t{t('The_necessary_browser_permissions_for_location_sharing_are_not_granted')}\n\t\t\t</GenericModal>\n\t\t);\n\t}\n\n\treturn (\n\t\t<GenericModal title={t('Share_Location_Title')} confirmText={t('Share')} onConfirm={onConfirm} onClose={onClose} onCancel={onClose}>\n\t\t\t<MapView latitude={positionData.coords.latitude} longitude={positionData.coords.longitude} />\n\t\t</GenericModal>\n\t);\n};\n\nexport default ShareLocationModal;\n"]}}},"code":"let useEndpoint, useTranslation, useToastMessageDispatch;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useEndpoint(v) {\n    useEndpoint = v;\n  },\n  useTranslation(v) {\n    useTranslation = v;\n  },\n  useToastMessageDispatch(v) {\n    useToastMessageDispatch = v;\n  }\n}, 0);\nlet useQuery, useQueryClient;\nmodule.link(\"@tanstack/react-query\", {\n  useQuery(v) {\n    useQuery = v;\n  },\n  useQueryClient(v) {\n    useQueryClient = v;\n  }\n}, 1);\nlet React;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  }\n}, 2);\nlet GenericModal;\nmodule.link(\"../../../components/GenericModal\", {\n  default(v) {\n    GenericModal = v;\n  }\n}, 3);\nlet MapView;\nmodule.link(\"../../../components/message/content/location/MapView\", {\n  default(v) {\n    MapView = v;\n  }\n}, 4);\nlet getGeolocationPermission;\nmodule.link(\"./getGeolocationPermission\", {\n  getGeolocationPermission(v) {\n    getGeolocationPermission = v;\n  }\n}, 5);\nlet getGeolocationPosition;\nmodule.link(\"./getGeolocationPosition\", {\n  getGeolocationPosition(v) {\n    getGeolocationPosition = v;\n  }\n}, 6);\nconst ShareLocationModal = _ref => {\n  let {\n    rid,\n    tmid,\n    onClose\n  } = _ref;\n  const t = useTranslation();\n  const dispatchToast = useToastMessageDispatch();\n  const {\n    data: permissionData,\n    isLoading: permissionLoading\n  } = useQuery(['geolocationPermission'], getGeolocationPermission);\n  const {\n    data: positionData\n  } = useQuery(['geolocationPosition', permissionData], async () => {\n    if (permissionLoading || permissionData === 'prompt' || permissionData === 'denied') {\n      return;\n    }\n    return getGeolocationPosition();\n  });\n  const queryClient = useQueryClient();\n  const sendMessage = useEndpoint('POST', '/v1/chat.sendMessage');\n  const onConfirm = () => {\n    if (!positionData) {\n      throw new Error('Failed to load position');\n    }\n    try {\n      sendMessage({\n        message: {\n          rid,\n          tmid,\n          location: {\n            type: 'Point',\n            coordinates: [positionData.coords.longitude, positionData.coords.latitude]\n          }\n        }\n      });\n    } catch (error) {\n      dispatchToast({\n        type: 'error',\n        message: error\n      });\n    } finally {\n      onClose();\n    }\n  };\n  const onConfirmRequestLocation = async () => {\n    try {\n      const position = await getGeolocationPosition();\n      queryClient.setQueryData(['geolocationPosition', 'granted'], position);\n      queryClient.setQueryData(['geolocationPermission'], 'granted');\n    } catch (e) {\n      queryClient.setQueryData(['geolocationPermission'], () => getGeolocationPermission);\n    }\n  };\n  if (permissionLoading || permissionData === 'prompt') {\n    return /*#__PURE__*/React.createElement(GenericModal, {\n      title: t('You_will_be_asked_for_permissions'),\n      confirmText: t('Continue'),\n      onConfirm: onConfirmRequestLocation,\n      onClose: onClose,\n      onCancel: onClose\n    });\n  }\n  if (permissionData === 'denied' || !positionData) {\n    return /*#__PURE__*/React.createElement(GenericModal, {\n      title: t('Cannot_share_your_location'),\n      confirmText: t('Ok'),\n      onConfirm: onClose,\n      onClose: onClose\n    }, t('The_necessary_browser_permissions_for_location_sharing_are_not_granted'));\n  }\n  return /*#__PURE__*/React.createElement(GenericModal, {\n    title: t('Share_Location_Title'),\n    confirmText: t('Share'),\n    onConfirm: onConfirm,\n    onClose: onClose,\n    onCancel: onClose\n  }, /*#__PURE__*/React.createElement(MapView, {\n    latitude: positionData.coords.latitude,\n    longitude: positionData.coords.longitude\n  }));\n};\nmodule.exportDefault(ShareLocationModal);","map":{"version":3,"names":["useEndpoint","useTranslation","useToastMessageDispatch","module","link","v","useQuery","useQueryClient","React","default","GenericModal","MapView","getGeolocationPermission","getGeolocationPosition","ShareLocationModal","_ref","rid","tmid","onClose","t","dispatchToast","data","permissionData","isLoading","permissionLoading","positionData","queryClient","sendMessage","onConfirm","Error","message","location","type","coordinates","coords","longitude","latitude","error","onConfirmRequestLocation","position","setQueryData","e","createElement","title","confirmText","onCancel","exportDefault"],"sources":["client/views/room/ShareLocation/ShareLocationModal.tsx"],"sourcesContent":["import type { IMessage, IRoom } from '@rocket.chat/core-typings';\nimport { useEndpoint, useTranslation, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport type { ReactElement } from 'react';\nimport React from 'react';\n\nimport GenericModal from '../../../components/GenericModal';\nimport MapView from '../../../components/message/content/location/MapView';\nimport { getGeolocationPermission } from './getGeolocationPermission';\nimport { getGeolocationPosition } from './getGeolocationPosition';\n\ntype ShareLocationModalProps = {\n\trid: IRoom['_id'];\n\ttmid: IMessage['tmid'];\n\tonClose: () => void;\n};\n\nconst ShareLocationModal = ({ rid, tmid, onClose }: ShareLocationModalProps): ReactElement => {\n\tconst t = useTranslation();\n\tconst dispatchToast = useToastMessageDispatch();\n\tconst { data: permissionData, isLoading: permissionLoading } = useQuery(['geolocationPermission'], getGeolocationPermission);\n\tconst { data: positionData } = useQuery(['geolocationPosition', permissionData], async () => {\n\t\tif (permissionLoading || permissionData === 'prompt' || permissionData === 'denied') {\n\t\t\treturn;\n\t\t}\n\t\treturn getGeolocationPosition();\n\t});\n\n\tconst queryClient = useQueryClient();\n\n\tconst sendMessage = useEndpoint('POST', '/v1/chat.sendMessage');\n\n\tconst onConfirm = (): void => {\n\t\tif (!positionData) {\n\t\t\tthrow new Error('Failed to load position');\n\t\t}\n\t\ttry {\n\t\t\tsendMessage({\n\t\t\t\tmessage: {\n\t\t\t\t\trid,\n\t\t\t\t\ttmid,\n\t\t\t\t\tlocation: {\n\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\tcoordinates: [positionData.coords.longitude, positionData.coords.latitude],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tdispatchToast({ type: 'error', message: error });\n\t\t} finally {\n\t\t\tonClose();\n\t\t}\n\t};\n\n\tconst onConfirmRequestLocation = async (): Promise<void> => {\n\t\ttry {\n\t\t\tconst position = await getGeolocationPosition();\n\t\t\tqueryClient.setQueryData(['geolocationPosition', 'granted'], position);\n\t\t\tqueryClient.setQueryData(['geolocationPermission'], 'granted');\n\t\t} catch (e) {\n\t\t\tqueryClient.setQueryData(['geolocationPermission'], () => getGeolocationPermission);\n\t\t}\n\t};\n\n\tif (permissionLoading || permissionData === 'prompt') {\n\t\treturn (\n\t\t\t<GenericModal\n\t\t\t\ttitle={t('You_will_be_asked_for_permissions')}\n\t\t\t\tconfirmText={t('Continue')}\n\t\t\t\tonConfirm={onConfirmRequestLocation}\n\t\t\t\tonClose={onClose}\n\t\t\t\tonCancel={onClose}\n\t\t\t/>\n\t\t);\n\t}\n\n\tif (permissionData === 'denied' || !positionData) {\n\t\treturn (\n\t\t\t<GenericModal title={t('Cannot_share_your_location')} confirmText={t('Ok')} onConfirm={onClose} onClose={onClose}>\n\t\t\t\t{t('The_necessary_browser_permissions_for_location_sharing_are_not_granted')}\n\t\t\t</GenericModal>\n\t\t);\n\t}\n\n\treturn (\n\t\t<GenericModal title={t('Share_Location_Title')} confirmText={t('Share')} onConfirm={onConfirm} onClose={onClose} onCancel={onClose}>\n\t\t\t<MapView latitude={positionData.coords.latitude} longitude={positionData.coords.longitude} />\n\t\t</GenericModal>\n\t);\n};\n\nexport default ShareLocationModal;\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"73a10799f46eeb83a8de793f491c0c405050e2d2"}
