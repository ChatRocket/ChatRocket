{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-message/client/ActionManager.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui-message/client/ActionManager.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-message/client/ActionManager.ts","inputSourceMap":{"version":3,"file":"app/ui-message/client/ActionManager.ts","sourceRoot":"","sources":["app/ui-message/client/ActionManager.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,OAAO,EAAE,MAAM,sBAAsB,CAAC;AAC/C,OAAO,EAAE,MAAM,EAAE,MAAM,qBAAqB,CAAC;AAG7C,OAAO,EAAE,CAAC,EAAE,MAAM,SAAS,CAAC;AAE5B,OAAO,EAAE,IAAI,EAAE,MAAM,OAAO,CAAC;AAE7B,OAAO,EAAE,wBAAwB,EAAE,MAAM,4BAA4B,CAAC;AACtE,OAAO,KAAK,OAAO,MAAM,6BAA6B,CAAC;AACvD,OAAO,EAAE,eAAe,EAAE,MAAM,qCAAqC,CAAC;AACtE,OAAO,EAAE,oBAAoB,EAAE,MAAM,2BAA2B,CAAC;AACjE,OAAO,EAAE,eAAe,EAAE,MAAM,oCAAoC,CAAC;AACrE,OAAO,EAAE,GAAG,EAAE,MAAM,kCAAkC,CAAC;AAEvD,MAAM,UAAU,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,8CAA8C,CAAC,CAAC,CAAC;AAEtF,MAAM,OAAO,aAAa;IAmBI;IAlBnB,MAAM,CAAC,eAAe,GAAG,IAAI,CAAC;IAE9B,MAAM,CAAC,qBAAqB,GAAG,uBAAuB,CAAC;IAEvD,MAAM,GAAG,IAAI,OAAO,EAAsD,CAAC;IAE3E,gBAAgB,GAAG,IAAI,GAAG,EAA8B,CAAC;IAEzD,aAAa,GAAG,IAAI,GAAG,EAQ9B,CAAC;IAEJ,YAA6B,MAAyC;QAAzC,WAAM,GAAN,MAAM,CAAmC;IAAG,CAAC;IAEhE,mBAAmB,CAAC,EAAU;QACvC,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;QAC5C,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QACjC,OAAO,KAAK,CAAC;IACd,CAAC;IAMM,EAAE,CAAC,SAAiB,EAAE,QAA6B;QACzD,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;IAC5C,CAAC;IAMM,GAAG,CAAC,SAAiB,EAAE,QAA6B;QAC1D,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;IAC7C,CAAC;IAEM,UAAU;QAChB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;IAC1C,CAAC;IAEM,UAAU;QAChB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC;IAC3C,CAAC;IAEM,iBAAiB,CAAC,KAAyB;QACjD,MAAM,SAAS,GAAG,MAAM,CAAC,EAAE,EAAE,CAAC;QAC9B,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;QAC5C,UAAU,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAC,EAAE,aAAa,CAAC,eAAe,CAAC,CAAC;QACrF,OAAO,SAAS,CAAC;IAClB,CAAC;IAEM,KAAK,CAAC,eAAe,CAAC,KAAa,EAAE,eAAqE;QAChH,MAAM,SAAS,GAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;QAEhD,OAAO,IAAI,CAAC,cAAc,CACzB,KAAK,IAAI,EAAE;YACV,IAAI,WAAgD,CAAC;YAErD,IAAI,CAAC;gBACJ,WAAW,GAAG,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,wBAAwB,KAAK,EAAE,EAAE;oBACnE,GAAG,eAAe;oBAClB,SAAS;iBACT,CAAC,CAA4B,CAAC;gBAE/B,IAAI,CAAC,uBAAuB,CAAC,WAAW,CAAC,CAAC;YAC3C,CAAC;oBAAS,CAAC;gBACV,QAAQ,eAAe,CAAC,IAAI,EAAE,CAAC;oBAC9B,KAAK,YAAY;wBAChB,IAAI,CAAC,CAAC,WAAW,IAAI,CAAC,CAAC,QAAQ,EAAE,cAAc,EAAE,uBAAuB,CAAC,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,CAAC;4BACnG,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;wBAC1C,MAAM;oBAEP,KAAK,YAAY;wBAChB,IAAI,CAAC,CAAC,WAAW,IAAI,WAAW,CAAC,IAAI,KAAK,QAAQ;4BAAE,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;wBACrG,MAAM;gBACR,CAAC;YACF,CAAC;QACF,CAAC,EACD,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,CAAC,QAAQ,IAAI,eAAe,CAAC,CAAC,CAAC,EAAE,MAAM,EAAE,eAAe,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAChG,CAAC;IACH,CAAC;IAES,KAAK,CAAC,cAAc,CAAI,IAAsB,EAAE,OAA8D;QACvH,IAAI,CAAC,UAAU,EAAE,CAAC;QAElB,IAAI,KAAgD,CAAC;QAErD,IAAI,CAAC;YACJ,MAAM,WAAW,GAAG,IAAI,EAAE,CAAC;YAC3B,MAAM,cAAc,GAAG,IAAI,OAAO,CAAI,CAAC,CAAC,EAAE,MAAM,EAAE,EAAE;gBACnD,KAAK,GAAG,UAAU,CAAC,GAAG,EAAE;oBACvB,MAAM,CAAC,IAAI,wBAAwB,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC,CAAC;gBAC1D,CAAC,EAAE,aAAa,CAAC,eAAe,CAAC,CAAC;YACnC,CAAC,CAAC,CAAC;YAEH,OAAO,MAAM,OAAO,CAAC,IAAI,CAAC,CAAC,WAAW,EAAE,cAAc,CAAC,CAAC,CAAC;QAC1D,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YAChB,IAAI,KAAK,YAAY,wBAAwB,EAAE,CAAC;gBAC/C,oBAAoB,CAAC;oBACpB,IAAI,EAAE,OAAO;oBACb,OAAO,EAAE,CAAC,CAAC,2BAA2B,CAAC;iBACvC,CAAC,CAAC;gBACH,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC;oBACpB,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;gBAClC,CAAC;YACF,CAAC;QACF,CAAC;gBAAS,CAAC;YACV,IAAI,KAAK;gBAAE,YAAY,CAAC,KAAK,CAAC,CAAC;YAC/B,IAAI,CAAC,UAAU,EAAE,CAAC;QACnB,CAAC;IACF,CAAC;IAEM,uBAAuB,CAAC,WAAoC;QAClE,MAAM,EAAE,SAAS,EAAE,GAAG,WAAW,CAAC;QAElC,MAAM,KAAK,GAAG,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAC,CAAC;QAClD,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,OAAO;QACR,CAAC;QAED,QAAQ,WAAW,CAAC,IAAI,EAAE,CAAC;YAC1B,KAAK,QAAQ,CAAC,CAAC,CAAC;gBACf,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,WAAW,CAAC;gBAC/D,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE;oBACpC,IAAI;oBACJ,SAAS;oBACT,MAAM;oBACN,KAAK;oBACL,MAAM;iBACN,CAAC,CAAC;gBACH,MAAM;YACP,CAAC;YAED,KAAK,YAAY,CAAC,CAAC,CAAC;gBACnB,MAAM,EAAE,IAAI,EAAE,GAAG,WAAW,CAAC;gBAC7B,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;gBACrB,MAAM;YACP,CAAC;YAED,KAAK,cAAc,CAAC;YACpB,KAAK,uBAAuB,CAAC,CAAC,CAAC;gBAC9B,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,WAAW,CAAC;gBACrD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE;oBACzB,IAAI;oBACJ,SAAS;oBACT,MAAM,EAAE,IAAI,CAAC,EAAE;oBACf,KAAK;oBACL,IAAI;iBACJ,CAAC,CAAC;gBACH,MAAM;YACP,CAAC;YAED,KAAK,aAAa,CAAC,CAAC,CAAC;gBACpB,MAAM;YACP,CAAC;YAED,KAAK,aAAa,CAAC,CAAC,CAAC;gBACpB,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG,IAAI,EAAE,GAAG,WAAW,CAAC;gBACjD,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;gBACtB,MAAM;YACP,CAAC;YAED,KAAK,eAAe,CAAC,CAAC,CAAC;gBACtB,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,WAAW,CAAC;gBACrD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;oBAC7B,IAAI;oBACJ,SAAS;oBACT,MAAM,EAAE,IAAI,CAAC,MAAM;oBACnB,KAAK;oBACL,IAAI;iBACJ,CAAC,CAAC;gBACH,MAAM;YACP,CAAC;YAED,KAAK,cAAc,CAAC,CAAC,CAAC;gBACrB,MAAM,EAAE,MAAM,EAAE,GAAG,WAAW,CAAC;gBAC/B,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;gBACzB,MAAM;YACP,CAAC;YAED,KAAK,qBAAqB,CAAC,CAAC,CAAC;gBAC5B,MAAM,EAAE,IAAI,EAAE,GAAG,WAAW,CAAC;gBAC7B,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;gBAC7B,MAAM;YACP,CAAC;YAED,KAAK,sBAAsB,CAAC,CAAC,CAAC;gBAC7B,MAAM,EAAE,IAAI,EAAE,GAAG,WAAW,CAAC;gBAC7B,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;gBAC1B,MAAM;YACP,CAAC;YAED;gBACC,eAAe,CAAC,WAAW,CAAC,CAAC;QAC/B,CAAC;QAED,OAAO,WAAW,CAAC,IAAI,CAAC;IACzB,CAAC;IAEM,6BAA6B,CAAC,MAAqC;QACzE,IAAI,CAAC,MAAM,EAAE,CAAC;YACb,MAAM,IAAI,KAAK,CAAC,iEAAiE,CAAC,CAAC;QACpF,CAAC;QAED,OAAO,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,OAAO,CAAC;IAChD,CAAC;IAQM,QAAQ,CAAC,OAAe,EAAE,IAAgB;QAChD,QAAQ,OAAO,EAAE,CAAC;YACjB,KAAK,OAAO;gBACX,IAAI,CAAC,SAAS,CAAC,IAAuB,CAAC,CAAC;gBACxC,MAAM;YAEP,KAAK,QAAQ;gBACZ,IAAI,CAAC,UAAU,CAAC,IAAwB,CAAC,CAAC;gBAC1C,MAAM;YAEP,KAAK,gBAAgB;gBACpB,IAAI,CAAC,iBAAiB,CAAC,IAA+B,CAAC,CAAC;gBACxD,MAAM;QACR,CAAC;IACF,CAAC;IAEO,SAAS,CAAC,IAAqB;QACtC,MAAM,QAAQ,GAAG,eAAe,CAAC,IAAI,CAAC;YACrC,SAAS,EAAE,UAAU;YACrB,KAAK,EAAE;gBACN,GAAG,EAAE,IAAI,CAAC,EAAE;gBACZ,WAAW,EAAE,IAAI;aACjB;SACD,CAAC,CAAC;QAEH,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE;YAC/B,KAAK,EAAE,GAAG,EAAE;gBACX,QAAQ,CAAC,KAAK,EAAE,CAAC;gBACjB,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YACpC,CAAC;SACD,CAAC,CAAC;IACJ,CAAC;IAEO,UAAU,CAAC,IAAsB;QACxC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACnB,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE;YACnC,KAAK,EAAE,GAAG,EAAE;gBACX,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAChC,CAAC;SACD,CAAC,CAAC;IACJ,CAAC;IAEO,iBAAiB,CAAC,IAA6B;QACtD,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE;YAC/B,OAAO,EAAE;gBACR,IAAI;aACJ;YACD,KAAK,EAAE,GAAG,EAAE;gBACX,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YACpC,CAAC;SACD,CAAC,CAAC;QAEH,MAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,CAAC;QAC7C,MAAM,WAAW,GAAG,IAAI,CAAC,MAAM,CAAC,kBAAkB,EAAE,CAAC;QAErD,IAAI,CAAC,SAAS,EAAE,CAAC;YAChB,OAAO;QACR,CAAC;QAED,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC;YACpB,IAAI,EAAE,SAAS;YACf,MAAM,EAAE;gBACP,GAAG,WAAW;gBACd,GAAG,EAAE,KAAK;gBACV,OAAO,EAAE,IAAI,CAAC,EAAE;aAChB;SACD,CAAC,CAAC;IACJ,CAAC;IAEM,WAAW,CAAC,MAA0F;QAC5G,MAAM,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAChD,QAAQ,EAAE,KAAK,EAAE,EAAE,CAAC;QACpB,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;IACnC,CAAC","sourcesContent":["import type { DistributiveOmit } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport { Random } from '@rocket.chat/random';\nimport type { RouterContext, IActionManager } from '@rocket.chat/ui-contexts';\nimport type * as UiKit from '@rocket.chat/ui-kit';\nimport { t } from 'i18next';\nimport type { ContextType } from 'react';\nimport { lazy } from 'react';\n\nimport { UiKitTriggerTimeoutError } from './UiKitTriggerTimeoutError';\nimport * as banners from '../../../client/lib/banners';\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\nimport { dispatchToastMessage } from '../../../client/lib/toast';\nimport { exhaustiveCheck } from '../../../lib/utils/exhaustiveCheck';\nimport { sdk } from '../../utils/client/lib/SDKClient';\n\nconst UiKitModal = lazy(() => import('../../../client/views/modal/uikit/UiKitModal'));\n\nexport class ActionManager implements IActionManager {\n\tprotected static TRIGGER_TIMEOUT = 5000;\n\n\tprotected static TRIGGER_TIMEOUT_ERROR = 'TRIGGER_TIMEOUT_ERROR';\n\n\tprotected events = new Emitter<{ busy: { busy: boolean }; [viewId: string]: any }>();\n\n\tprotected appIdByTriggerId = new Map<string, string | undefined>();\n\n\tprotected viewInstances = new Map<\n\t\tstring,\n\t\t{\n\t\t\tpayload?: {\n\t\t\t\tview: UiKit.ContextualBarView;\n\t\t\t};\n\t\t\tclose: () => void;\n\t\t}\n\t>();\n\n\tpublic constructor(protected router: ContextType<typeof RouterContext>) {}\n\n\tprotected invalidateTriggerId(id: string) {\n\t\tconst appId = this.appIdByTriggerId.get(id);\n\t\tthis.appIdByTriggerId.delete(id);\n\t\treturn appId;\n\t}\n\n\tpublic on(viewId: string, listener: (data: any) => void): void;\n\n\tpublic on(eventName: 'busy', listener: ({ busy }: { busy: boolean }) => void): void;\n\n\tpublic on(eventName: string, listener: (data: any) => void) {\n\t\treturn this.events.on(eventName, listener);\n\t}\n\n\tpublic off(viewId: string, listener: (data: any) => any): void;\n\n\tpublic off(eventName: 'busy', listener: ({ busy }: { busy: boolean }) => void): void;\n\n\tpublic off(eventName: string, listener: (data: any) => void) {\n\t\treturn this.events.off(eventName, listener);\n\t}\n\n\tpublic notifyBusy() {\n\t\tthis.events.emit('busy', { busy: true });\n\t}\n\n\tpublic notifyIdle() {\n\t\tthis.events.emit('busy', { busy: false });\n\t}\n\n\tpublic generateTriggerId(appId: string | undefined) {\n\t\tconst triggerId = Random.id();\n\t\tthis.appIdByTriggerId.set(triggerId, appId);\n\t\tsetTimeout(() => this.invalidateTriggerId(triggerId), ActionManager.TRIGGER_TIMEOUT);\n\t\treturn triggerId;\n\t}\n\n\tpublic async emitInteraction(appId: string, userInteraction: DistributiveOmit<UiKit.UserInteraction, 'triggerId'>) {\n\t\tconst triggerId = this.generateTriggerId(appId);\n\n\t\treturn this.runWithTimeout(\n\t\t\tasync () => {\n\t\t\t\tlet interaction: UiKit.ServerInteraction | undefined;\n\n\t\t\t\ttry {\n\t\t\t\t\tinteraction = (await sdk.rest.post(`/apps/ui.interaction/${appId}`, {\n\t\t\t\t\t\t...userInteraction,\n\t\t\t\t\t\ttriggerId,\n\t\t\t\t\t})) as UiKit.ServerInteraction;\n\n\t\t\t\t\tthis.handleServerInteraction(interaction);\n\t\t\t\t} finally {\n\t\t\t\t\tswitch (userInteraction.type) {\n\t\t\t\t\t\tcase 'viewSubmit':\n\t\t\t\t\t\t\tif (!!interaction && !['errors', 'modal.update', 'contextual_bar.update'].includes(interaction.type))\n\t\t\t\t\t\t\t\tthis.disposeView(userInteraction.viewId);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'viewClosed':\n\t\t\t\t\t\t\tif (!!interaction && interaction.type !== 'errors') this.disposeView(userInteraction.payload.viewId);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t{ triggerId, appId, ...('viewId' in userInteraction ? { viewId: userInteraction.viewId } : {}) },\n\t\t);\n\t}\n\n\tprotected async runWithTimeout<T>(task: () => Promise<T>, details: { triggerId: string; appId: string; viewId?: string }) {\n\t\tthis.notifyBusy();\n\n\t\tlet timer: ReturnType<typeof setTimeout> | undefined;\n\n\t\ttry {\n\t\t\tconst taskPromise = task();\n\t\t\tconst timeoutPromise = new Promise<T>((_, reject) => {\n\t\t\t\ttimer = setTimeout(() => {\n\t\t\t\t\treject(new UiKitTriggerTimeoutError('Timeout', details));\n\t\t\t\t}, ActionManager.TRIGGER_TIMEOUT);\n\t\t\t});\n\n\t\t\treturn await Promise.race([taskPromise, timeoutPromise]);\n\t\t} catch (error) {\n\t\t\tif (error instanceof UiKitTriggerTimeoutError) {\n\t\t\t\tdispatchToastMessage({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\tmessage: t('UIKit_Interaction_Timeout'),\n\t\t\t\t});\n\t\t\t\tif (details.viewId) {\n\t\t\t\t\tthis.disposeView(details.viewId);\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tif (timer) clearTimeout(timer);\n\t\t\tthis.notifyIdle();\n\t\t}\n\t}\n\n\tpublic handleServerInteraction(interaction: UiKit.ServerInteraction): UiKit.ServerInteraction['type'] | undefined {\n\t\tconst { triggerId } = interaction;\n\n\t\tconst appId = this.invalidateTriggerId(triggerId);\n\t\tif (!appId) {\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (interaction.type) {\n\t\t\tcase 'errors': {\n\t\t\t\tconst { type, triggerId, viewId, appId, errors } = interaction;\n\t\t\t\tthis.events.emit(interaction.viewId, {\n\t\t\t\t\ttype,\n\t\t\t\t\ttriggerId,\n\t\t\t\t\tviewId,\n\t\t\t\t\tappId,\n\t\t\t\t\terrors,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'modal.open': {\n\t\t\t\tconst { view } = interaction;\n\t\t\t\tthis.openModal(view);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'modal.update':\n\t\t\tcase 'contextual_bar.update': {\n\t\t\t\tconst { type, triggerId, appId, view } = interaction;\n\t\t\t\tthis.events.emit(view.id, {\n\t\t\t\t\ttype,\n\t\t\t\t\ttriggerId,\n\t\t\t\t\tviewId: view.id,\n\t\t\t\t\tappId,\n\t\t\t\t\tview,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'modal.close': {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'banner.open': {\n\t\t\t\tconst { type, triggerId, ...view } = interaction;\n\t\t\t\tthis.openBanner(view);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'banner.update': {\n\t\t\t\tconst { type, triggerId, appId, view } = interaction;\n\t\t\t\tthis.events.emit(view.viewId, {\n\t\t\t\t\ttype,\n\t\t\t\t\ttriggerId,\n\t\t\t\t\tviewId: view.viewId,\n\t\t\t\t\tappId,\n\t\t\t\t\tview,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'banner.close': {\n\t\t\t\tconst { viewId } = interaction;\n\t\t\t\tthis.disposeView(viewId);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'contextual_bar.open': {\n\t\t\t\tconst { view } = interaction;\n\t\t\t\tthis.openContextualBar(view);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'contextual_bar.close': {\n\t\t\t\tconst { view } = interaction;\n\t\t\t\tthis.disposeView(view.id);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\texhaustiveCheck(interaction);\n\t\t}\n\n\t\treturn interaction.type;\n\t}\n\n\tpublic getInteractionPayloadByViewId(viewId: UiKit.ContextualBarView['id']) {\n\t\tif (!viewId) {\n\t\t\tthrow new Error('No viewId provided when checking for `user interaction payload`');\n\t\t}\n\n\t\treturn this.viewInstances.get(viewId)?.payload;\n\t}\n\n\tpublic openView(surface: 'modal', view: UiKit.ModalView): void;\n\n\tpublic openView(surface: 'banner', view: UiKit.BannerView): void;\n\n\tpublic openView(surface: 'contextual_bar', view: UiKit.ContextualBarView): void;\n\n\tpublic openView(surface: string, view: UiKit.View) {\n\t\tswitch (surface) {\n\t\t\tcase 'modal':\n\t\t\t\tthis.openModal(view as UiKit.ModalView);\n\t\t\t\tbreak;\n\n\t\t\tcase 'banner':\n\t\t\t\tthis.openBanner(view as UiKit.BannerView);\n\t\t\t\tbreak;\n\n\t\t\tcase 'contextual_bar':\n\t\t\t\tthis.openContextualBar(view as UiKit.ContextualBarView);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate openModal(view: UiKit.ModalView) {\n\t\tconst instance = imperativeModal.open({\n\t\t\tcomponent: UiKitModal,\n\t\t\tprops: {\n\t\t\t\tkey: view.id,\n\t\t\t\tinitialView: view,\n\t\t\t},\n\t\t});\n\n\t\tthis.viewInstances.set(view.id, {\n\t\t\tclose: () => {\n\t\t\t\tinstance.close();\n\t\t\t\tthis.viewInstances.delete(view.id);\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate openBanner(view: UiKit.BannerView) {\n\t\tbanners.open(view);\n\t\tthis.viewInstances.set(view.viewId, {\n\t\t\tclose: () => {\n\t\t\t\tbanners.closeById(view.viewId);\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate openContextualBar(view: UiKit.ContextualBarView) {\n\t\tthis.viewInstances.set(view.id, {\n\t\t\tpayload: {\n\t\t\t\tview,\n\t\t\t},\n\t\t\tclose: () => {\n\t\t\t\tthis.viewInstances.delete(view.id);\n\t\t\t},\n\t\t});\n\n\t\tconst routeName = this.router.getRouteName();\n\t\tconst routeParams = this.router.getRouteParameters();\n\n\t\tif (!routeName) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.router.navigate({\n\t\t\tname: routeName,\n\t\t\tparams: {\n\t\t\t\t...routeParams,\n\t\t\t\ttab: 'app',\n\t\t\t\tcontext: view.id,\n\t\t\t},\n\t\t});\n\t}\n\n\tpublic disposeView(viewId: UiKit.ModalView['id'] | UiKit.BannerView['viewId'] | UiKit.ContextualBarView['id']) {\n\t\tconst instance = this.viewInstances.get(viewId);\n\t\tinstance?.close?.();\n\t\tthis.viewInstances.delete(viewId);\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-message/client/ActionManager.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-message/client/ActionManager.ts","inputSourceMap":{"version":3,"file":"app/ui-message/client/ActionManager.ts","sourceRoot":"","sources":["app/ui-message/client/ActionManager.ts"],"names":[],"mappings":"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","sourcesContent":["import type { DistributiveOmit } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport { Random } from '@rocket.chat/random';\nimport type { RouterContext, IActionManager } from '@rocket.chat/ui-contexts';\nimport type * as UiKit from '@rocket.chat/ui-kit';\nimport { t } from 'i18next';\nimport type { ContextType } from 'react';\nimport { lazy } from 'react';\n\nimport { UiKitTriggerTimeoutError } from './UiKitTriggerTimeoutError';\nimport * as banners from '../../../client/lib/banners';\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\nimport { dispatchToastMessage } from '../../../client/lib/toast';\nimport { exhaustiveCheck } from '../../../lib/utils/exhaustiveCheck';\nimport { sdk } from '../../utils/client/lib/SDKClient';\n\nconst UiKitModal = lazy(() => import('../../../client/views/modal/uikit/UiKitModal'));\n\nexport class ActionManager implements IActionManager {\n\tprotected static TRIGGER_TIMEOUT = 5000;\n\n\tprotected static TRIGGER_TIMEOUT_ERROR = 'TRIGGER_TIMEOUT_ERROR';\n\n\tprotected events = new Emitter<{ busy: { busy: boolean }; [viewId: string]: any }>();\n\n\tprotected appIdByTriggerId = new Map<string, string | undefined>();\n\n\tprotected viewInstances = new Map<\n\t\tstring,\n\t\t{\n\t\t\tpayload?: {\n\t\t\t\tview: UiKit.ContextualBarView;\n\t\t\t};\n\t\t\tclose: () => void;\n\t\t}\n\t>();\n\n\tpublic constructor(protected router: ContextType<typeof RouterContext>) {}\n\n\tprotected invalidateTriggerId(id: string) {\n\t\tconst appId = this.appIdByTriggerId.get(id);\n\t\tthis.appIdByTriggerId.delete(id);\n\t\treturn appId;\n\t}\n\n\tpublic on(viewId: string, listener: (data: any) => void): void;\n\n\tpublic on(eventName: 'busy', listener: ({ busy }: { busy: boolean }) => void): void;\n\n\tpublic on(eventName: string, listener: (data: any) => void) {\n\t\treturn this.events.on(eventName, listener);\n\t}\n\n\tpublic off(viewId: string, listener: (data: any) => any): void;\n\n\tpublic off(eventName: 'busy', listener: ({ busy }: { busy: boolean }) => void): void;\n\n\tpublic off(eventName: string, listener: (data: any) => void) {\n\t\treturn this.events.off(eventName, listener);\n\t}\n\n\tpublic notifyBusy() {\n\t\tthis.events.emit('busy', { busy: true });\n\t}\n\n\tpublic notifyIdle() {\n\t\tthis.events.emit('busy', { busy: false });\n\t}\n\n\tpublic generateTriggerId(appId: string | undefined) {\n\t\tconst triggerId = Random.id();\n\t\tthis.appIdByTriggerId.set(triggerId, appId);\n\t\tsetTimeout(() => this.invalidateTriggerId(triggerId), ActionManager.TRIGGER_TIMEOUT);\n\t\treturn triggerId;\n\t}\n\n\tpublic async emitInteraction(appId: string, userInteraction: DistributiveOmit<UiKit.UserInteraction, 'triggerId'>) {\n\t\tconst triggerId = this.generateTriggerId(appId);\n\n\t\treturn this.runWithTimeout(\n\t\t\tasync () => {\n\t\t\t\tlet interaction: UiKit.ServerInteraction | undefined;\n\n\t\t\t\ttry {\n\t\t\t\t\tinteraction = (await sdk.rest.post(`/apps/ui.interaction/${appId}`, {\n\t\t\t\t\t\t...userInteraction,\n\t\t\t\t\t\ttriggerId,\n\t\t\t\t\t})) as UiKit.ServerInteraction;\n\n\t\t\t\t\tthis.handleServerInteraction(interaction);\n\t\t\t\t} finally {\n\t\t\t\t\tswitch (userInteraction.type) {\n\t\t\t\t\t\tcase 'viewSubmit':\n\t\t\t\t\t\t\tif (!!interaction && !['errors', 'modal.update', 'contextual_bar.update'].includes(interaction.type))\n\t\t\t\t\t\t\t\tthis.disposeView(userInteraction.viewId);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'viewClosed':\n\t\t\t\t\t\t\tif (!!interaction && interaction.type !== 'errors') this.disposeView(userInteraction.payload.viewId);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t{ triggerId, appId, ...('viewId' in userInteraction ? { viewId: userInteraction.viewId } : {}) },\n\t\t);\n\t}\n\n\tprotected async runWithTimeout<T>(task: () => Promise<T>, details: { triggerId: string; appId: string; viewId?: string }) {\n\t\tthis.notifyBusy();\n\n\t\tlet timer: ReturnType<typeof setTimeout> | undefined;\n\n\t\ttry {\n\t\t\tconst taskPromise = task();\n\t\t\tconst timeoutPromise = new Promise<T>((_, reject) => {\n\t\t\t\ttimer = setTimeout(() => {\n\t\t\t\t\treject(new UiKitTriggerTimeoutError('Timeout', details));\n\t\t\t\t}, ActionManager.TRIGGER_TIMEOUT);\n\t\t\t});\n\n\t\t\treturn await Promise.race([taskPromise, timeoutPromise]);\n\t\t} catch (error) {\n\t\t\tif (error instanceof UiKitTriggerTimeoutError) {\n\t\t\t\tdispatchToastMessage({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\tmessage: t('UIKit_Interaction_Timeout'),\n\t\t\t\t});\n\t\t\t\tif (details.viewId) {\n\t\t\t\t\tthis.disposeView(details.viewId);\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tif (timer) clearTimeout(timer);\n\t\t\tthis.notifyIdle();\n\t\t}\n\t}\n\n\tpublic handleServerInteraction(interaction: UiKit.ServerInteraction): UiKit.ServerInteraction['type'] | undefined {\n\t\tconst { triggerId } = interaction;\n\n\t\tconst appId = this.invalidateTriggerId(triggerId);\n\t\tif (!appId) {\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (interaction.type) {\n\t\t\tcase 'errors': {\n\t\t\t\tconst { type, triggerId, viewId, appId, errors } = interaction;\n\t\t\t\tthis.events.emit(interaction.viewId, {\n\t\t\t\t\ttype,\n\t\t\t\t\ttriggerId,\n\t\t\t\t\tviewId,\n\t\t\t\t\tappId,\n\t\t\t\t\terrors,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'modal.open': {\n\t\t\t\tconst { view } = interaction;\n\t\t\t\tthis.openModal(view);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'modal.update':\n\t\t\tcase 'contextual_bar.update': {\n\t\t\t\tconst { type, triggerId, appId, view } = interaction;\n\t\t\t\tthis.events.emit(view.id, {\n\t\t\t\t\ttype,\n\t\t\t\t\ttriggerId,\n\t\t\t\t\tviewId: view.id,\n\t\t\t\t\tappId,\n\t\t\t\t\tview,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'modal.close': {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'banner.open': {\n\t\t\t\tconst { type, triggerId, ...view } = interaction;\n\t\t\t\tthis.openBanner(view);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'banner.update': {\n\t\t\t\tconst { type, triggerId, appId, view } = interaction;\n\t\t\t\tthis.events.emit(view.viewId, {\n\t\t\t\t\ttype,\n\t\t\t\t\ttriggerId,\n\t\t\t\t\tviewId: view.viewId,\n\t\t\t\t\tappId,\n\t\t\t\t\tview,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'banner.close': {\n\t\t\t\tconst { viewId } = interaction;\n\t\t\t\tthis.disposeView(viewId);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'contextual_bar.open': {\n\t\t\t\tconst { view } = interaction;\n\t\t\t\tthis.openContextualBar(view);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'contextual_bar.close': {\n\t\t\t\tconst { view } = interaction;\n\t\t\t\tthis.disposeView(view.id);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\texhaustiveCheck(interaction);\n\t\t}\n\n\t\treturn interaction.type;\n\t}\n\n\tpublic getInteractionPayloadByViewId(viewId: UiKit.ContextualBarView['id']) {\n\t\tif (!viewId) {\n\t\t\tthrow new Error('No viewId provided when checking for `user interaction payload`');\n\t\t}\n\n\t\treturn this.viewInstances.get(viewId)?.payload;\n\t}\n\n\tpublic openView(surface: 'modal', view: UiKit.ModalView): void;\n\n\tpublic openView(surface: 'banner', view: UiKit.BannerView): void;\n\n\tpublic openView(surface: 'contextual_bar', view: UiKit.ContextualBarView): void;\n\n\tpublic openView(surface: string, view: UiKit.View) {\n\t\tswitch (surface) {\n\t\t\tcase 'modal':\n\t\t\t\tthis.openModal(view as UiKit.ModalView);\n\t\t\t\tbreak;\n\n\t\t\tcase 'banner':\n\t\t\t\tthis.openBanner(view as UiKit.BannerView);\n\t\t\t\tbreak;\n\n\t\t\tcase 'contextual_bar':\n\t\t\t\tthis.openContextualBar(view as UiKit.ContextualBarView);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate openModal(view: UiKit.ModalView) {\n\t\tconst instance = imperativeModal.open({\n\t\t\tcomponent: UiKitModal,\n\t\t\tprops: {\n\t\t\t\tkey: view.id,\n\t\t\t\tinitialView: view,\n\t\t\t},\n\t\t});\n\n\t\tthis.viewInstances.set(view.id, {\n\t\t\tclose: () => {\n\t\t\t\tinstance.close();\n\t\t\t\tthis.viewInstances.delete(view.id);\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate openBanner(view: UiKit.BannerView) {\n\t\tbanners.open(view);\n\t\tthis.viewInstances.set(view.viewId, {\n\t\t\tclose: () => {\n\t\t\t\tbanners.closeById(view.viewId);\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate openContextualBar(view: UiKit.ContextualBarView) {\n\t\tthis.viewInstances.set(view.id, {\n\t\t\tpayload: {\n\t\t\t\tview,\n\t\t\t},\n\t\t\tclose: () => {\n\t\t\t\tthis.viewInstances.delete(view.id);\n\t\t\t},\n\t\t});\n\n\t\tconst routeName = this.router.getRouteName();\n\t\tconst routeParams = this.router.getRouteParameters();\n\n\t\tif (!routeName) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.router.navigate({\n\t\t\tname: routeName,\n\t\t\tparams: {\n\t\t\t\t...routeParams,\n\t\t\t\ttab: 'app',\n\t\t\t\tcontext: view.id,\n\t\t\t},\n\t\t});\n\t}\n\n\tpublic disposeView(viewId: UiKit.ModalView['id'] | UiKit.BannerView['viewId'] | UiKit.ContextualBarView['id']) {\n\t\tconst instance = this.viewInstances.get(viewId);\n\t\tinstance?.close?.();\n\t\tthis.viewInstances.delete(viewId);\n\t}\n}\n"]}}},"code":"const _excluded = [\"type\", \"triggerId\"];\nlet _objectWithoutProperties;\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default(v) {\n    _objectWithoutProperties = v;\n  }\n}, 0);\nlet _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n}, 1);\nmodule.export({\n  ActionManager: () => ActionManager\n});\nlet Emitter;\nmodule.link(\"@rocket.chat/emitter\", {\n  Emitter(v) {\n    Emitter = v;\n  }\n}, 0);\nlet Random;\nmodule.link(\"@rocket.chat/random\", {\n  Random(v) {\n    Random = v;\n  }\n}, 1);\nlet t;\nmodule.link(\"i18next\", {\n  t(v) {\n    t = v;\n  }\n}, 2);\nlet lazy;\nmodule.link(\"react\", {\n  lazy(v) {\n    lazy = v;\n  }\n}, 3);\nlet UiKitTriggerTimeoutError;\nmodule.link(\"./UiKitTriggerTimeoutError\", {\n  UiKitTriggerTimeoutError(v) {\n    UiKitTriggerTimeoutError = v;\n  }\n}, 4);\nlet banners;\nmodule.link(\"../../../client/lib/banners\", {\n  \"*\"(v) {\n    banners = v;\n  }\n}, 5);\nlet imperativeModal;\nmodule.link(\"../../../client/lib/imperativeModal\", {\n  imperativeModal(v) {\n    imperativeModal = v;\n  }\n}, 6);\nlet dispatchToastMessage;\nmodule.link(\"../../../client/lib/toast\", {\n  dispatchToastMessage(v) {\n    dispatchToastMessage = v;\n  }\n}, 7);\nlet exhaustiveCheck;\nmodule.link(\"../../../lib/utils/exhaustiveCheck\", {\n  exhaustiveCheck(v) {\n    exhaustiveCheck = v;\n  }\n}, 8);\nlet sdk;\nmodule.link(\"../../utils/client/lib/SDKClient\", {\n  sdk(v) {\n    sdk = v;\n  }\n}, 9);\nconst UiKitModal = /*#__PURE__*/lazy(() => module.dynamicImport('../../../client/views/modal/uikit/UiKitModal'));\nclass ActionManager {\n  constructor(router) {\n    this.router = void 0;\n    this.events = new Emitter();\n    this.appIdByTriggerId = new Map();\n    this.viewInstances = new Map();\n    this.router = router;\n  }\n  invalidateTriggerId(id) {\n    const appId = this.appIdByTriggerId.get(id);\n    this.appIdByTriggerId.delete(id);\n    return appId;\n  }\n  on(eventName, listener) {\n    return this.events.on(eventName, listener);\n  }\n  off(eventName, listener) {\n    return this.events.off(eventName, listener);\n  }\n  notifyBusy() {\n    this.events.emit('busy', {\n      busy: true\n    });\n  }\n  notifyIdle() {\n    this.events.emit('busy', {\n      busy: false\n    });\n  }\n  generateTriggerId(appId) {\n    const triggerId = Random.id();\n    this.appIdByTriggerId.set(triggerId, appId);\n    setTimeout(() => this.invalidateTriggerId(triggerId), ActionManager.TRIGGER_TIMEOUT);\n    return triggerId;\n  }\n  async emitInteraction(appId, userInteraction) {\n    const triggerId = this.generateTriggerId(appId);\n    return this.runWithTimeout(async () => {\n      let interaction;\n      try {\n        interaction = await sdk.rest.post(\"/apps/ui.interaction/\".concat(appId), _objectSpread(_objectSpread({}, userInteraction), {}, {\n          triggerId\n        }));\n        this.handleServerInteraction(interaction);\n      } finally {\n        switch (userInteraction.type) {\n          case 'viewSubmit':\n            if (!!interaction && !['errors', 'modal.update', 'contextual_bar.update'].includes(interaction.type)) this.disposeView(userInteraction.viewId);\n            break;\n          case 'viewClosed':\n            if (!!interaction && interaction.type !== 'errors') this.disposeView(userInteraction.payload.viewId);\n            break;\n        }\n      }\n    }, _objectSpread({\n      triggerId,\n      appId\n    }, 'viewId' in userInteraction ? {\n      viewId: userInteraction.viewId\n    } : {}));\n  }\n  async runWithTimeout(task, details) {\n    this.notifyBusy();\n    let timer;\n    try {\n      const taskPromise = task();\n      const timeoutPromise = new Promise((_, reject) => {\n        timer = setTimeout(() => {\n          reject(new UiKitTriggerTimeoutError('Timeout', details));\n        }, ActionManager.TRIGGER_TIMEOUT);\n      });\n      return await Promise.race([taskPromise, timeoutPromise]);\n    } catch (error) {\n      if (error instanceof UiKitTriggerTimeoutError) {\n        dispatchToastMessage({\n          type: 'error',\n          message: t('UIKit_Interaction_Timeout')\n        });\n        if (details.viewId) {\n          this.disposeView(details.viewId);\n        }\n      }\n    } finally {\n      if (timer) clearTimeout(timer);\n      this.notifyIdle();\n    }\n  }\n  handleServerInteraction(interaction) {\n    const {\n      triggerId\n    } = interaction;\n    const appId = this.invalidateTriggerId(triggerId);\n    if (!appId) {\n      return;\n    }\n    switch (interaction.type) {\n      case 'errors':\n        {\n          const {\n            type,\n            triggerId,\n            viewId,\n            appId,\n            errors\n          } = interaction;\n          this.events.emit(interaction.viewId, {\n            type,\n            triggerId,\n            viewId,\n            appId,\n            errors\n          });\n          break;\n        }\n      case 'modal.open':\n        {\n          const {\n            view\n          } = interaction;\n          this.openModal(view);\n          break;\n        }\n      case 'modal.update':\n      case 'contextual_bar.update':\n        {\n          const {\n            type,\n            triggerId,\n            appId,\n            view\n          } = interaction;\n          this.events.emit(view.id, {\n            type,\n            triggerId,\n            viewId: view.id,\n            appId,\n            view\n          });\n          break;\n        }\n      case 'modal.close':\n        {\n          break;\n        }\n      case 'banner.open':\n        {\n          const {\n              type,\n              triggerId\n            } = interaction,\n            view = _objectWithoutProperties(interaction, _excluded);\n          this.openBanner(view);\n          break;\n        }\n      case 'banner.update':\n        {\n          const {\n            type,\n            triggerId,\n            appId,\n            view\n          } = interaction;\n          this.events.emit(view.viewId, {\n            type,\n            triggerId,\n            viewId: view.viewId,\n            appId,\n            view\n          });\n          break;\n        }\n      case 'banner.close':\n        {\n          const {\n            viewId\n          } = interaction;\n          this.disposeView(viewId);\n          break;\n        }\n      case 'contextual_bar.open':\n        {\n          const {\n            view\n          } = interaction;\n          this.openContextualBar(view);\n          break;\n        }\n      case 'contextual_bar.close':\n        {\n          const {\n            view\n          } = interaction;\n          this.disposeView(view.id);\n          break;\n        }\n      default:\n        exhaustiveCheck(interaction);\n    }\n    return interaction.type;\n  }\n  getInteractionPayloadByViewId(viewId) {\n    var _this$viewInstances$g;\n    if (!viewId) {\n      throw new Error('No viewId provided when checking for `user interaction payload`');\n    }\n    return (_this$viewInstances$g = this.viewInstances.get(viewId)) === null || _this$viewInstances$g === void 0 ? void 0 : _this$viewInstances$g.payload;\n  }\n  openView(surface, view) {\n    switch (surface) {\n      case 'modal':\n        this.openModal(view);\n        break;\n      case 'banner':\n        this.openBanner(view);\n        break;\n      case 'contextual_bar':\n        this.openContextualBar(view);\n        break;\n    }\n  }\n  openModal(view) {\n    const instance = imperativeModal.open({\n      component: UiKitModal,\n      props: {\n        key: view.id,\n        initialView: view\n      }\n    });\n    this.viewInstances.set(view.id, {\n      close: () => {\n        instance.close();\n        this.viewInstances.delete(view.id);\n      }\n    });\n  }\n  openBanner(view) {\n    banners.open(view);\n    this.viewInstances.set(view.viewId, {\n      close: () => {\n        banners.closeById(view.viewId);\n      }\n    });\n  }\n  openContextualBar(view) {\n    this.viewInstances.set(view.id, {\n      payload: {\n        view\n      },\n      close: () => {\n        this.viewInstances.delete(view.id);\n      }\n    });\n    const routeName = this.router.getRouteName();\n    const routeParams = this.router.getRouteParameters();\n    if (!routeName) {\n      return;\n    }\n    this.router.navigate({\n      name: routeName,\n      params: _objectSpread(_objectSpread({}, routeParams), {}, {\n        tab: 'app',\n        context: view.id\n      })\n    });\n  }\n  disposeView(viewId) {\n    var _instance$close;\n    const instance = this.viewInstances.get(viewId);\n    instance === null || instance === void 0 ? void 0 : (_instance$close = instance.close) === null || _instance$close === void 0 ? void 0 : _instance$close.call(instance);\n    this.viewInstances.delete(viewId);\n  }\n}\nActionManager.TRIGGER_TIMEOUT = 5000;\nActionManager.TRIGGER_TIMEOUT_ERROR = 'TRIGGER_TIMEOUT_ERROR';","map":{"version":3,"names":["_objectWithoutProperties","module","link","default","v","_objectSpread","export","ActionManager","Emitter","Random","t","lazy","UiKitTriggerTimeoutError","banners","*","imperativeModal","dispatchToastMessage","exhaustiveCheck","sdk","UiKitModal","dynamicImport","constructor","router","events","appIdByTriggerId","Map","viewInstances","invalidateTriggerId","id","appId","get","delete","on","eventName","listener","off","notifyBusy","emit","busy","notifyIdle","generateTriggerId","triggerId","set","setTimeout","TRIGGER_TIMEOUT","emitInteraction","userInteraction","runWithTimeout","interaction","rest","post","concat","handleServerInteraction","type","includes","disposeView","viewId","payload","task","details","timer","taskPromise","timeoutPromise","Promise","_","reject","race","error","message","clearTimeout","errors","view","openModal","_excluded","openBanner","openContextualBar","getInteractionPayloadByViewId","_this$viewInstances$g","Error","openView","surface","instance","open","component","props","key","initialView","close","closeById","routeName","getRouteName","routeParams","getRouteParameters","navigate","name","params","tab","context","_instance$close","call","TRIGGER_TIMEOUT_ERROR"],"sources":["app/ui-message/client/ActionManager.ts"],"sourcesContent":["import type { DistributiveOmit } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport { Random } from '@rocket.chat/random';\nimport type { RouterContext, IActionManager } from '@rocket.chat/ui-contexts';\nimport type * as UiKit from '@rocket.chat/ui-kit';\nimport { t } from 'i18next';\nimport type { ContextType } from 'react';\nimport { lazy } from 'react';\n\nimport { UiKitTriggerTimeoutError } from './UiKitTriggerTimeoutError';\nimport * as banners from '../../../client/lib/banners';\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\nimport { dispatchToastMessage } from '../../../client/lib/toast';\nimport { exhaustiveCheck } from '../../../lib/utils/exhaustiveCheck';\nimport { sdk } from '../../utils/client/lib/SDKClient';\n\nconst UiKitModal = lazy(() => import('../../../client/views/modal/uikit/UiKitModal'));\n\nexport class ActionManager implements IActionManager {\n\tprotected static TRIGGER_TIMEOUT = 5000;\n\n\tprotected static TRIGGER_TIMEOUT_ERROR = 'TRIGGER_TIMEOUT_ERROR';\n\n\tprotected events = new Emitter<{ busy: { busy: boolean }; [viewId: string]: any }>();\n\n\tprotected appIdByTriggerId = new Map<string, string | undefined>();\n\n\tprotected viewInstances = new Map<\n\t\tstring,\n\t\t{\n\t\t\tpayload?: {\n\t\t\t\tview: UiKit.ContextualBarView;\n\t\t\t};\n\t\t\tclose: () => void;\n\t\t}\n\t>();\n\n\tpublic constructor(protected router: ContextType<typeof RouterContext>) {}\n\n\tprotected invalidateTriggerId(id: string) {\n\t\tconst appId = this.appIdByTriggerId.get(id);\n\t\tthis.appIdByTriggerId.delete(id);\n\t\treturn appId;\n\t}\n\n\tpublic on(viewId: string, listener: (data: any) => void): void;\n\n\tpublic on(eventName: 'busy', listener: ({ busy }: { busy: boolean }) => void): void;\n\n\tpublic on(eventName: string, listener: (data: any) => void) {\n\t\treturn this.events.on(eventName, listener);\n\t}\n\n\tpublic off(viewId: string, listener: (data: any) => any): void;\n\n\tpublic off(eventName: 'busy', listener: ({ busy }: { busy: boolean }) => void): void;\n\n\tpublic off(eventName: string, listener: (data: any) => void) {\n\t\treturn this.events.off(eventName, listener);\n\t}\n\n\tpublic notifyBusy() {\n\t\tthis.events.emit('busy', { busy: true });\n\t}\n\n\tpublic notifyIdle() {\n\t\tthis.events.emit('busy', { busy: false });\n\t}\n\n\tpublic generateTriggerId(appId: string | undefined) {\n\t\tconst triggerId = Random.id();\n\t\tthis.appIdByTriggerId.set(triggerId, appId);\n\t\tsetTimeout(() => this.invalidateTriggerId(triggerId), ActionManager.TRIGGER_TIMEOUT);\n\t\treturn triggerId;\n\t}\n\n\tpublic async emitInteraction(appId: string, userInteraction: DistributiveOmit<UiKit.UserInteraction, 'triggerId'>) {\n\t\tconst triggerId = this.generateTriggerId(appId);\n\n\t\treturn this.runWithTimeout(\n\t\t\tasync () => {\n\t\t\t\tlet interaction: UiKit.ServerInteraction | undefined;\n\n\t\t\t\ttry {\n\t\t\t\t\tinteraction = (await sdk.rest.post(`/apps/ui.interaction/${appId}`, {\n\t\t\t\t\t\t...userInteraction,\n\t\t\t\t\t\ttriggerId,\n\t\t\t\t\t})) as UiKit.ServerInteraction;\n\n\t\t\t\t\tthis.handleServerInteraction(interaction);\n\t\t\t\t} finally {\n\t\t\t\t\tswitch (userInteraction.type) {\n\t\t\t\t\t\tcase 'viewSubmit':\n\t\t\t\t\t\t\tif (!!interaction && !['errors', 'modal.update', 'contextual_bar.update'].includes(interaction.type))\n\t\t\t\t\t\t\t\tthis.disposeView(userInteraction.viewId);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'viewClosed':\n\t\t\t\t\t\t\tif (!!interaction && interaction.type !== 'errors') this.disposeView(userInteraction.payload.viewId);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t{ triggerId, appId, ...('viewId' in userInteraction ? { viewId: userInteraction.viewId } : {}) },\n\t\t);\n\t}\n\n\tprotected async runWithTimeout<T>(task: () => Promise<T>, details: { triggerId: string; appId: string; viewId?: string }) {\n\t\tthis.notifyBusy();\n\n\t\tlet timer: ReturnType<typeof setTimeout> | undefined;\n\n\t\ttry {\n\t\t\tconst taskPromise = task();\n\t\t\tconst timeoutPromise = new Promise<T>((_, reject) => {\n\t\t\t\ttimer = setTimeout(() => {\n\t\t\t\t\treject(new UiKitTriggerTimeoutError('Timeout', details));\n\t\t\t\t}, ActionManager.TRIGGER_TIMEOUT);\n\t\t\t});\n\n\t\t\treturn await Promise.race([taskPromise, timeoutPromise]);\n\t\t} catch (error) {\n\t\t\tif (error instanceof UiKitTriggerTimeoutError) {\n\t\t\t\tdispatchToastMessage({\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\tmessage: t('UIKit_Interaction_Timeout'),\n\t\t\t\t});\n\t\t\t\tif (details.viewId) {\n\t\t\t\t\tthis.disposeView(details.viewId);\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tif (timer) clearTimeout(timer);\n\t\t\tthis.notifyIdle();\n\t\t}\n\t}\n\n\tpublic handleServerInteraction(interaction: UiKit.ServerInteraction): UiKit.ServerInteraction['type'] | undefined {\n\t\tconst { triggerId } = interaction;\n\n\t\tconst appId = this.invalidateTriggerId(triggerId);\n\t\tif (!appId) {\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (interaction.type) {\n\t\t\tcase 'errors': {\n\t\t\t\tconst { type, triggerId, viewId, appId, errors } = interaction;\n\t\t\t\tthis.events.emit(interaction.viewId, {\n\t\t\t\t\ttype,\n\t\t\t\t\ttriggerId,\n\t\t\t\t\tviewId,\n\t\t\t\t\tappId,\n\t\t\t\t\terrors,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'modal.open': {\n\t\t\t\tconst { view } = interaction;\n\t\t\t\tthis.openModal(view);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'modal.update':\n\t\t\tcase 'contextual_bar.update': {\n\t\t\t\tconst { type, triggerId, appId, view } = interaction;\n\t\t\t\tthis.events.emit(view.id, {\n\t\t\t\t\ttype,\n\t\t\t\t\ttriggerId,\n\t\t\t\t\tviewId: view.id,\n\t\t\t\t\tappId,\n\t\t\t\t\tview,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'modal.close': {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'banner.open': {\n\t\t\t\tconst { type, triggerId, ...view } = interaction;\n\t\t\t\tthis.openBanner(view);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'banner.update': {\n\t\t\t\tconst { type, triggerId, appId, view } = interaction;\n\t\t\t\tthis.events.emit(view.viewId, {\n\t\t\t\t\ttype,\n\t\t\t\t\ttriggerId,\n\t\t\t\t\tviewId: view.viewId,\n\t\t\t\t\tappId,\n\t\t\t\t\tview,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'banner.close': {\n\t\t\t\tconst { viewId } = interaction;\n\t\t\t\tthis.disposeView(viewId);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'contextual_bar.open': {\n\t\t\t\tconst { view } = interaction;\n\t\t\t\tthis.openContextualBar(view);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'contextual_bar.close': {\n\t\t\t\tconst { view } = interaction;\n\t\t\t\tthis.disposeView(view.id);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\texhaustiveCheck(interaction);\n\t\t}\n\n\t\treturn interaction.type;\n\t}\n\n\tpublic getInteractionPayloadByViewId(viewId: UiKit.ContextualBarView['id']) {\n\t\tif (!viewId) {\n\t\t\tthrow new Error('No viewId provided when checking for `user interaction payload`');\n\t\t}\n\n\t\treturn this.viewInstances.get(viewId)?.payload;\n\t}\n\n\tpublic openView(surface: 'modal', view: UiKit.ModalView): void;\n\n\tpublic openView(surface: 'banner', view: UiKit.BannerView): void;\n\n\tpublic openView(surface: 'contextual_bar', view: UiKit.ContextualBarView): void;\n\n\tpublic openView(surface: string, view: UiKit.View) {\n\t\tswitch (surface) {\n\t\t\tcase 'modal':\n\t\t\t\tthis.openModal(view as UiKit.ModalView);\n\t\t\t\tbreak;\n\n\t\t\tcase 'banner':\n\t\t\t\tthis.openBanner(view as UiKit.BannerView);\n\t\t\t\tbreak;\n\n\t\t\tcase 'contextual_bar':\n\t\t\t\tthis.openContextualBar(view as UiKit.ContextualBarView);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate openModal(view: UiKit.ModalView) {\n\t\tconst instance = imperativeModal.open({\n\t\t\tcomponent: UiKitModal,\n\t\t\tprops: {\n\t\t\t\tkey: view.id,\n\t\t\t\tinitialView: view,\n\t\t\t},\n\t\t});\n\n\t\tthis.viewInstances.set(view.id, {\n\t\t\tclose: () => {\n\t\t\t\tinstance.close();\n\t\t\t\tthis.viewInstances.delete(view.id);\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate openBanner(view: UiKit.BannerView) {\n\t\tbanners.open(view);\n\t\tthis.viewInstances.set(view.viewId, {\n\t\t\tclose: () => {\n\t\t\t\tbanners.closeById(view.viewId);\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate openContextualBar(view: UiKit.ContextualBarView) {\n\t\tthis.viewInstances.set(view.id, {\n\t\t\tpayload: {\n\t\t\t\tview,\n\t\t\t},\n\t\t\tclose: () => {\n\t\t\t\tthis.viewInstances.delete(view.id);\n\t\t\t},\n\t\t});\n\n\t\tconst routeName = this.router.getRouteName();\n\t\tconst routeParams = this.router.getRouteParameters();\n\n\t\tif (!routeName) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.router.navigate({\n\t\t\tname: routeName,\n\t\t\tparams: {\n\t\t\t\t...routeParams,\n\t\t\t\ttab: 'app',\n\t\t\t\tcontext: view.id,\n\t\t\t},\n\t\t});\n\t}\n\n\tpublic disposeView(viewId: UiKit.ModalView['id'] | UiKit.BannerView['viewId'] | UiKit.ContextualBarView['id']) {\n\t\tconst instance = this.viewInstances.get(viewId);\n\t\tinstance?.close?.();\n\t\tthis.viewInstances.delete(viewId);\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"3acb01e00d98691306d3466f1d57c4f13e8d6304"}
