{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/cloud/server/functions/saveRegistrationData.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/cloud/server/functions/saveRegistrationData.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/cloud/server/functions/saveRegistrationData.ts","inputSourceMap":{"version":3,"file":"app/cloud/server/functions/saveRegistrationData.ts","sourceRoot":"","sources":["app/cloud/server/functions/saveRegistrationData.ts"],"names":[],"mappings":"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","sourcesContent":["import { applyLicense } from '@rocket.chat/license';\nimport { Settings, WorkspaceCredentials } from '@rocket.chat/models';\n\nimport { notifyOnSettingChangedById } from '../../../lib/server/lib/notifyListener';\nimport { settings } from '../../../settings/server';\nimport { syncCloudData } from './syncWorkspace/syncCloudData';\n\ntype SaveRegistrationDataDTO = {\n\tworkspaceId: string;\n\tclient_name: string;\n\tclient_id: string;\n\tclient_secret: string;\n\tclient_secret_expires_at: number;\n\tpublicKey: string;\n\tregistration_client_uri: string;\n};\n\ntype ManualSaveRegistrationDataDTO = SaveRegistrationDataDTO & { licenseData: { license: string } };\n\nexport async function saveRegistrationData({\n\tworkspaceId,\n\tclient_name,\n\tclient_id,\n\tclient_secret,\n\tclient_secret_expires_at,\n\tpublicKey,\n\tregistration_client_uri,\n}: SaveRegistrationDataDTO) {\n\tawait saveRegistrationDataBase({\n\t\tworkspaceId,\n\t\tclient_name,\n\t\tclient_id,\n\t\tclient_secret,\n\t\tclient_secret_expires_at,\n\t\tpublicKey,\n\t\tregistration_client_uri,\n\t});\n\n\tawait syncCloudData();\n}\n\nasync function saveRegistrationDataBase({\n\tworkspaceId,\n\tclient_name,\n\tclient_id,\n\tclient_secret,\n\tclient_secret_expires_at,\n\tpublicKey,\n\tregistration_client_uri,\n}: SaveRegistrationDataDTO) {\n\tconst settingsData = [\n\t\t{ _id: 'Register_Server', value: true },\n\t\t{ _id: 'Cloud_Workspace_Id', value: workspaceId },\n\t\t{ _id: 'Cloud_Workspace_Name', value: client_name },\n\t\t{ _id: 'Cloud_Workspace_Client_Id', value: client_id },\n\t\t{ _id: 'Cloud_Workspace_Client_Secret', value: client_secret },\n\t\t{ _id: 'Cloud_Workspace_Client_Secret_Expires_At', value: client_secret_expires_at },\n\t\t{ _id: 'Cloud_Workspace_PublicKey', value: publicKey },\n\t\t{ _id: 'Cloud_Workspace_Registration_Client_Uri', value: registration_client_uri },\n\t];\n\n\tawait WorkspaceCredentials.updateCredentialByScope({\n\t\tscope: '',\n\t\taccessToken: '',\n\t\texpirationDate: new Date(0),\n\t});\n\n\tconst promises = [...settingsData.map(({ _id, value }) => Settings.updateValueById(_id, value))];\n\n\t(await Promise.all(promises)).forEach((value, index) => {\n\t\tif (value?.modifiedCount) {\n\t\t\tvoid notifyOnSettingChangedById(settingsData[index]._id);\n\t\t}\n\t});\n\n\t// TODO: Why is this taking so long that needs a timeout?\n\tfor await (const retry of Array.from({ length: 10 })) {\n\t\tconst isSettingsUpdated =\n\t\t\tsettings.get('Register_Server') === true &&\n\t\t\tsettings.get('Cloud_Workspace_Id') === workspaceId &&\n\t\t\tsettings.get('Cloud_Workspace_Name') === client_name &&\n\t\t\tsettings.get('Cloud_Workspace_Client_Id') === client_id &&\n\t\t\tsettings.get('Cloud_Workspace_Client_Secret') === client_secret &&\n\t\t\tsettings.get('Cloud_Workspace_Client_Secret_Expires_At') === client_secret_expires_at &&\n\t\t\tsettings.get('Cloud_Workspace_PublicKey') === publicKey &&\n\t\t\tsettings.get('Cloud_Workspace_Registration_Client_Uri') === registration_client_uri;\n\n\t\tif (isSettingsUpdated) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (retry === 9) {\n\t\t\tthrow new Error('Failed to save registration data');\n\t\t}\n\n\t\tawait new Promise((resolve) => setTimeout(resolve, 1000));\n\t}\n}\n\nexport async function saveRegistrationDataManual({\n\tworkspaceId,\n\tclient_name,\n\tclient_id,\n\tclient_secret,\n\tclient_secret_expires_at,\n\tpublicKey,\n\tregistration_client_uri,\n\tlicenseData,\n}: ManualSaveRegistrationDataDTO) {\n\tawait saveRegistrationDataBase({\n\t\tworkspaceId,\n\t\tclient_name,\n\t\tclient_id,\n\t\tclient_secret,\n\t\tclient_secret_expires_at,\n\t\tpublicKey,\n\t\tregistration_client_uri,\n\t});\n\tawait applyLicense(licenseData.license, true);\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/cloud/server/functions/saveRegistrationData.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/cloud/server/functions/saveRegistrationData.ts","inputSourceMap":{"version":3,"file":"app/cloud/server/functions/saveRegistrationData.ts","sourceRoot":"","sources":["app/cloud/server/functions/saveRegistrationData.ts"],"names":[],"mappings":"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","sourcesContent":["import { applyLicense } from '@rocket.chat/license';\nimport { Settings, WorkspaceCredentials } from '@rocket.chat/models';\n\nimport { notifyOnSettingChangedById } from '../../../lib/server/lib/notifyListener';\nimport { settings } from '../../../settings/server';\nimport { syncCloudData } from './syncWorkspace/syncCloudData';\n\ntype SaveRegistrationDataDTO = {\n\tworkspaceId: string;\n\tclient_name: string;\n\tclient_id: string;\n\tclient_secret: string;\n\tclient_secret_expires_at: number;\n\tpublicKey: string;\n\tregistration_client_uri: string;\n};\n\ntype ManualSaveRegistrationDataDTO = SaveRegistrationDataDTO & { licenseData: { license: string } };\n\nexport async function saveRegistrationData({\n\tworkspaceId,\n\tclient_name,\n\tclient_id,\n\tclient_secret,\n\tclient_secret_expires_at,\n\tpublicKey,\n\tregistration_client_uri,\n}: SaveRegistrationDataDTO) {\n\tawait saveRegistrationDataBase({\n\t\tworkspaceId,\n\t\tclient_name,\n\t\tclient_id,\n\t\tclient_secret,\n\t\tclient_secret_expires_at,\n\t\tpublicKey,\n\t\tregistration_client_uri,\n\t});\n\n\tawait syncCloudData();\n}\n\nasync function saveRegistrationDataBase({\n\tworkspaceId,\n\tclient_name,\n\tclient_id,\n\tclient_secret,\n\tclient_secret_expires_at,\n\tpublicKey,\n\tregistration_client_uri,\n}: SaveRegistrationDataDTO) {\n\tconst settingsData = [\n\t\t{ _id: 'Register_Server', value: true },\n\t\t{ _id: 'Cloud_Workspace_Id', value: workspaceId },\n\t\t{ _id: 'Cloud_Workspace_Name', value: client_name },\n\t\t{ _id: 'Cloud_Workspace_Client_Id', value: client_id },\n\t\t{ _id: 'Cloud_Workspace_Client_Secret', value: client_secret },\n\t\t{ _id: 'Cloud_Workspace_Client_Secret_Expires_At', value: client_secret_expires_at },\n\t\t{ _id: 'Cloud_Workspace_PublicKey', value: publicKey },\n\t\t{ _id: 'Cloud_Workspace_Registration_Client_Uri', value: registration_client_uri },\n\t];\n\n\tawait WorkspaceCredentials.updateCredentialByScope({\n\t\tscope: '',\n\t\taccessToken: '',\n\t\texpirationDate: new Date(0),\n\t});\n\n\tconst promises = [...settingsData.map(({ _id, value }) => Settings.updateValueById(_id, value))];\n\n\t(await Promise.all(promises)).forEach((value, index) => {\n\t\tif (value?.modifiedCount) {\n\t\t\tvoid notifyOnSettingChangedById(settingsData[index]._id);\n\t\t}\n\t});\n\n\t// TODO: Why is this taking so long that needs a timeout?\n\tfor await (const retry of Array.from({ length: 10 })) {\n\t\tconst isSettingsUpdated =\n\t\t\tsettings.get('Register_Server') === true &&\n\t\t\tsettings.get('Cloud_Workspace_Id') === workspaceId &&\n\t\t\tsettings.get('Cloud_Workspace_Name') === client_name &&\n\t\t\tsettings.get('Cloud_Workspace_Client_Id') === client_id &&\n\t\t\tsettings.get('Cloud_Workspace_Client_Secret') === client_secret &&\n\t\t\tsettings.get('Cloud_Workspace_Client_Secret_Expires_At') === client_secret_expires_at &&\n\t\t\tsettings.get('Cloud_Workspace_PublicKey') === publicKey &&\n\t\t\tsettings.get('Cloud_Workspace_Registration_Client_Uri') === registration_client_uri;\n\n\t\tif (isSettingsUpdated) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (retry === 9) {\n\t\t\tthrow new Error('Failed to save registration data');\n\t\t}\n\n\t\tawait new Promise((resolve) => setTimeout(resolve, 1000));\n\t}\n}\n\nexport async function saveRegistrationDataManual({\n\tworkspaceId,\n\tclient_name,\n\tclient_id,\n\tclient_secret,\n\tclient_secret_expires_at,\n\tpublicKey,\n\tregistration_client_uri,\n\tlicenseData,\n}: ManualSaveRegistrationDataDTO) {\n\tawait saveRegistrationDataBase({\n\t\tworkspaceId,\n\t\tclient_name,\n\t\tclient_id,\n\t\tclient_secret,\n\t\tclient_secret_expires_at,\n\t\tpublicKey,\n\t\tregistration_client_uri,\n\t});\n\tawait applyLicense(licenseData.license, true);\n}\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let _asyncIterator;\n    module.link(\"@babel/runtime/helpers/asyncIterator\", {\n      default(v) {\n        _asyncIterator = v;\n      }\n    }, 0);\n    module.export({\n      saveRegistrationData: () => saveRegistrationData,\n      saveRegistrationDataManual: () => saveRegistrationDataManual\n    });\n    let applyLicense;\n    module.link(\"@rocket.chat/license\", {\n      applyLicense(v) {\n        applyLicense = v;\n      }\n    }, 0);\n    let Settings, WorkspaceCredentials;\n    module.link(\"@rocket.chat/models\", {\n      Settings(v) {\n        Settings = v;\n      },\n      WorkspaceCredentials(v) {\n        WorkspaceCredentials = v;\n      }\n    }, 1);\n    let notifyOnSettingChangedById;\n    module.link(\"../../../lib/server/lib/notifyListener\", {\n      notifyOnSettingChangedById(v) {\n        notifyOnSettingChangedById = v;\n      }\n    }, 2);\n    let settings;\n    module.link(\"../../../settings/server\", {\n      settings(v) {\n        settings = v;\n      }\n    }, 3);\n    let syncCloudData;\n    module.link(\"./syncWorkspace/syncCloudData\", {\n      syncCloudData(v) {\n        syncCloudData = v;\n      }\n    }, 4);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    async function saveRegistrationData(_ref) {\n      let {\n        workspaceId,\n        client_name,\n        client_id,\n        client_secret,\n        client_secret_expires_at,\n        publicKey,\n        registration_client_uri\n      } = _ref;\n      await saveRegistrationDataBase({\n        workspaceId,\n        client_name,\n        client_id,\n        client_secret,\n        client_secret_expires_at,\n        publicKey,\n        registration_client_uri\n      });\n      await syncCloudData();\n    }\n    async function saveRegistrationDataBase(_ref2) {\n      let {\n        workspaceId,\n        client_name,\n        client_id,\n        client_secret,\n        client_secret_expires_at,\n        publicKey,\n        registration_client_uri\n      } = _ref2;\n      const settingsData = [{\n        _id: 'Register_Server',\n        value: true\n      }, {\n        _id: 'Cloud_Workspace_Id',\n        value: workspaceId\n      }, {\n        _id: 'Cloud_Workspace_Name',\n        value: client_name\n      }, {\n        _id: 'Cloud_Workspace_Client_Id',\n        value: client_id\n      }, {\n        _id: 'Cloud_Workspace_Client_Secret',\n        value: client_secret\n      }, {\n        _id: 'Cloud_Workspace_Client_Secret_Expires_At',\n        value: client_secret_expires_at\n      }, {\n        _id: 'Cloud_Workspace_PublicKey',\n        value: publicKey\n      }, {\n        _id: 'Cloud_Workspace_Registration_Client_Uri',\n        value: registration_client_uri\n      }];\n      await WorkspaceCredentials.updateCredentialByScope({\n        scope: '',\n        accessToken: '',\n        expirationDate: new Date(0)\n      });\n      const promises = [...settingsData.map(_ref3 => {\n        let {\n          _id,\n          value\n        } = _ref3;\n        return Settings.updateValueById(_id, value);\n      })];\n      (await Promise.all(promises)).forEach((value, index) => {\n        if (value !== null && value !== void 0 && value.modifiedCount) {\n          void notifyOnSettingChangedById(settingsData[index]._id);\n        }\n      });\n      // TODO: Why is this taking so long that needs a timeout?\n      var _iteratorAbruptCompletion = false;\n      var _didIteratorError = false;\n      var _iteratorError;\n      try {\n        for (var _iterator = _asyncIterator(Array.from({\n            length: 10\n          })), _step; _iteratorAbruptCompletion = !(_step = await _iterator.next()).done; _iteratorAbruptCompletion = false) {\n          const retry = _step.value;\n          {\n            const isSettingsUpdated = settings.get('Register_Server') === true && settings.get('Cloud_Workspace_Id') === workspaceId && settings.get('Cloud_Workspace_Name') === client_name && settings.get('Cloud_Workspace_Client_Id') === client_id && settings.get('Cloud_Workspace_Client_Secret') === client_secret && settings.get('Cloud_Workspace_Client_Secret_Expires_At') === client_secret_expires_at && settings.get('Cloud_Workspace_PublicKey') === publicKey && settings.get('Cloud_Workspace_Registration_Client_Uri') === registration_client_uri;\n            if (isSettingsUpdated) {\n              return;\n            }\n            if (retry === 9) {\n              throw new Error('Failed to save registration data');\n            }\n            await new Promise(resolve => setTimeout(resolve, 1000));\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (_iteratorAbruptCompletion && _iterator.return != null) {\n            await _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n    }\n    async function saveRegistrationDataManual(_ref4) {\n      let {\n        workspaceId,\n        client_name,\n        client_id,\n        client_secret,\n        client_secret_expires_at,\n        publicKey,\n        registration_client_uri,\n        licenseData\n      } = _ref4;\n      await saveRegistrationDataBase({\n        workspaceId,\n        client_name,\n        client_id,\n        client_secret,\n        client_secret_expires_at,\n        publicKey,\n        registration_client_uri\n      });\n      await applyLicense(licenseData.license, true);\n    }\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["_asyncIterator","module","link","default","v","export","saveRegistrationData","saveRegistrationDataManual","applyLicense","Settings","WorkspaceCredentials","notifyOnSettingChangedById","settings","syncCloudData","__reifyWaitForDeps__","_ref","workspaceId","client_name","client_id","client_secret","client_secret_expires_at","publicKey","registration_client_uri","saveRegistrationDataBase","_ref2","settingsData","_id","value","updateCredentialByScope","scope","accessToken","expirationDate","Date","promises","map","_ref3","updateValueById","Promise","all","forEach","index","modifiedCount","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","Array","from","length","_step","next","done","retry","isSettingsUpdated","get","Error","resolve","setTimeout","err","return","_ref4","licenseData","license","__reify_async_result__","_reifyError","self","async"],"sources":["app/cloud/server/functions/saveRegistrationData.ts"],"sourcesContent":["import { applyLicense } from '@rocket.chat/license';\nimport { Settings, WorkspaceCredentials } from '@rocket.chat/models';\n\nimport { notifyOnSettingChangedById } from '../../../lib/server/lib/notifyListener';\nimport { settings } from '../../../settings/server';\nimport { syncCloudData } from './syncWorkspace/syncCloudData';\n\ntype SaveRegistrationDataDTO = {\n\tworkspaceId: string;\n\tclient_name: string;\n\tclient_id: string;\n\tclient_secret: string;\n\tclient_secret_expires_at: number;\n\tpublicKey: string;\n\tregistration_client_uri: string;\n};\n\ntype ManualSaveRegistrationDataDTO = SaveRegistrationDataDTO & { licenseData: { license: string } };\n\nexport async function saveRegistrationData({\n\tworkspaceId,\n\tclient_name,\n\tclient_id,\n\tclient_secret,\n\tclient_secret_expires_at,\n\tpublicKey,\n\tregistration_client_uri,\n}: SaveRegistrationDataDTO) {\n\tawait saveRegistrationDataBase({\n\t\tworkspaceId,\n\t\tclient_name,\n\t\tclient_id,\n\t\tclient_secret,\n\t\tclient_secret_expires_at,\n\t\tpublicKey,\n\t\tregistration_client_uri,\n\t});\n\n\tawait syncCloudData();\n}\n\nasync function saveRegistrationDataBase({\n\tworkspaceId,\n\tclient_name,\n\tclient_id,\n\tclient_secret,\n\tclient_secret_expires_at,\n\tpublicKey,\n\tregistration_client_uri,\n}: SaveRegistrationDataDTO) {\n\tconst settingsData = [\n\t\t{ _id: 'Register_Server', value: true },\n\t\t{ _id: 'Cloud_Workspace_Id', value: workspaceId },\n\t\t{ _id: 'Cloud_Workspace_Name', value: client_name },\n\t\t{ _id: 'Cloud_Workspace_Client_Id', value: client_id },\n\t\t{ _id: 'Cloud_Workspace_Client_Secret', value: client_secret },\n\t\t{ _id: 'Cloud_Workspace_Client_Secret_Expires_At', value: client_secret_expires_at },\n\t\t{ _id: 'Cloud_Workspace_PublicKey', value: publicKey },\n\t\t{ _id: 'Cloud_Workspace_Registration_Client_Uri', value: registration_client_uri },\n\t];\n\n\tawait WorkspaceCredentials.updateCredentialByScope({\n\t\tscope: '',\n\t\taccessToken: '',\n\t\texpirationDate: new Date(0),\n\t});\n\n\tconst promises = [...settingsData.map(({ _id, value }) => Settings.updateValueById(_id, value))];\n\n\t(await Promise.all(promises)).forEach((value, index) => {\n\t\tif (value?.modifiedCount) {\n\t\t\tvoid notifyOnSettingChangedById(settingsData[index]._id);\n\t\t}\n\t});\n\n\t// TODO: Why is this taking so long that needs a timeout?\n\tfor await (const retry of Array.from({ length: 10 })) {\n\t\tconst isSettingsUpdated =\n\t\t\tsettings.get('Register_Server') === true &&\n\t\t\tsettings.get('Cloud_Workspace_Id') === workspaceId &&\n\t\t\tsettings.get('Cloud_Workspace_Name') === client_name &&\n\t\t\tsettings.get('Cloud_Workspace_Client_Id') === client_id &&\n\t\t\tsettings.get('Cloud_Workspace_Client_Secret') === client_secret &&\n\t\t\tsettings.get('Cloud_Workspace_Client_Secret_Expires_At') === client_secret_expires_at &&\n\t\t\tsettings.get('Cloud_Workspace_PublicKey') === publicKey &&\n\t\t\tsettings.get('Cloud_Workspace_Registration_Client_Uri') === registration_client_uri;\n\n\t\tif (isSettingsUpdated) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (retry === 9) {\n\t\t\tthrow new Error('Failed to save registration data');\n\t\t}\n\n\t\tawait new Promise((resolve) => setTimeout(resolve, 1000));\n\t}\n}\n\nexport async function saveRegistrationDataManual({\n\tworkspaceId,\n\tclient_name,\n\tclient_id,\n\tclient_secret,\n\tclient_secret_expires_at,\n\tpublicKey,\n\tregistration_client_uri,\n\tlicenseData,\n}: ManualSaveRegistrationDataDTO) {\n\tawait saveRegistrationDataBase({\n\t\tworkspaceId,\n\t\tclient_name,\n\t\tclient_id,\n\t\tclient_secret,\n\t\tclient_secret_expires_at,\n\t\tpublicKey,\n\t\tregistration_client_uri,\n\t});\n\tawait applyLicense(licenseData.license, true);\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"e04556de62ec4909e3c70b7190f01ff9d6c88d86"}
