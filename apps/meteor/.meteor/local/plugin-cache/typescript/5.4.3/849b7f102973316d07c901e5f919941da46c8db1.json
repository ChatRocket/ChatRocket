{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-cached-collection/client/models/CachedCollectionManager.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui-cached-collection/client/models/CachedCollectionManager.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-cached-collection/client/models/CachedCollectionManager.ts","inputSourceMap":{"version":3,"file":"app/ui-cached-collection/client/models/CachedCollectionManager.ts","sourceRoot":"","sources":["app/ui-cached-collection/client/models/CachedCollectionManager.ts"],"names":[],"mappings":"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","sourcesContent":["import { Emitter } from '@rocket.chat/emitter';\nimport { Accounts } from 'meteor/accounts-base';\nimport { check } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport type { CachedCollection } from './CachedCollection';\n\nclass CachedCollectionManager extends Emitter<{ reconnect: void; login: string | null }> {\n\tprivate items: CachedCollection<any>[];\n\n\tprivate _syncEnabled: boolean;\n\n\tprivate logged: boolean;\n\n\tprivate step: number;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.items = [];\n\t\tthis._syncEnabled = false;\n\t\tthis.logged = false;\n\n\t\tconst { _unstoreLoginToken } = Accounts;\n\t\tAccounts._unstoreLoginToken = (...args) => {\n\t\t\t_unstoreLoginToken.apply(Accounts, args);\n\t\t\tthis.clearAllCacheOnLogout();\n\t\t};\n\n\t\tTracker.autorun(() => {\n\t\t\tconst [WAITING_FIRST_CONNECTION, WAITING_FIRST_DISCONNECTION, LISTENING_RECONNECTIONS] = [0, 1, 2];\n\t\t\tthis.step = this.step || WAITING_FIRST_CONNECTION;\n\t\t\tconst { connected } = Meteor.status();\n\t\t\tswitch (this.step) {\n\t\t\t\tcase WAITING_FIRST_CONNECTION:\n\t\t\t\t\treturn !connected || this.step++;\n\t\t\t\tcase WAITING_FIRST_DISCONNECTION:\n\t\t\t\t\treturn connected || this.step++;\n\t\t\t\tcase LISTENING_RECONNECTIONS:\n\t\t\t\t\treturn connected && this.emit('reconnect');\n\t\t\t}\n\t\t});\n\n\t\tAccounts.onLogin(() => {\n\t\t\tthis.emit('login', Meteor.userId());\n\t\t});\n\t\tTracker.autorun(() => {\n\t\t\tconst uid = Meteor.userId();\n\t\t\tthis.logged = uid !== null;\n\t\t});\n\t}\n\n\tregister(cachedCollection: CachedCollection<any>) {\n\t\tthis.items.push(cachedCollection);\n\t}\n\n\tclearAllCache() {\n\t\tfor (const item of this.items) {\n\t\t\tvoid item.clearCache();\n\t\t}\n\t}\n\n\tclearAllCacheOnLogout() {\n\t\tfor (const item of this.items) {\n\t\t\titem.clearCacheOnLogout();\n\t\t}\n\t}\n\n\tset syncEnabled(value) {\n\t\tcheck(value, Boolean);\n\t\tthis._syncEnabled = value;\n\t}\n\n\tget syncEnabled() {\n\t\treturn this._syncEnabled;\n\t}\n\n\tonReconnect(cb: () => void) {\n\t\tthis.on('reconnect', cb);\n\t}\n\n\tonLogin(cb: () => void) {\n\t\tthis.on('login', cb);\n\t\tif (this.logged) {\n\t\t\tcb();\n\t\t}\n\t}\n}\n\nconst instance = new CachedCollectionManager();\n\nexport {\n\t/** @deprecated */\n\tinstance as CachedCollectionManager,\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-cached-collection/client/models/CachedCollectionManager.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-cached-collection/client/models/CachedCollectionManager.ts","inputSourceMap":{"version":3,"file":"app/ui-cached-collection/client/models/CachedCollectionManager.ts","sourceRoot":"","sources":["app/ui-cached-collection/client/models/CachedCollectionManager.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,OAAO,EAAE,MAAM,sBAAsB,CAAC;AAC/C,OAAO,EAAE,QAAQ,EAAE,MAAM,sBAAsB,CAAC;AAChD,OAAO,EAAE,KAAK,EAAE,MAAM,cAAc,CAAC;AACrC,OAAO,EAAE,MAAM,EAAE,MAAM,eAAe,CAAC;AACvC,OAAO,EAAE,OAAO,EAAE,MAAM,gBAAgB,CAAC;AAIzC,MAAM,uBAAwB,SAAQ,OAAkD;IAC/E,KAAK,CAA0B;IAE/B,YAAY,CAAU;IAEtB,MAAM,CAAU;IAEhB,IAAI,CAAS;IAErB;QACC,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;QAChB,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;QAC1B,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QAEpB,MAAM,EAAE,kBAAkB,EAAE,GAAG,QAAQ,CAAC;QACxC,QAAQ,CAAC,kBAAkB,GAAG,CAAC,GAAG,IAAI,EAAE,EAAE;YACzC,kBAAkB,CAAC,KAAK,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;YACzC,IAAI,CAAC,qBAAqB,EAAE,CAAC;QAC9B,CAAC,CAAC;QAEF,OAAO,CAAC,OAAO,CAAC,GAAG,EAAE;YACpB,MAAM,CAAC,wBAAwB,EAAE,2BAA2B,EAAE,uBAAuB,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YACnG,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,IAAI,wBAAwB,CAAC;YAClD,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC;YACtC,QAAQ,IAAI,CAAC,IAAI,EAAE,CAAC;gBACnB,KAAK,wBAAwB;oBAC5B,OAAO,CAAC,SAAS,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;gBAClC,KAAK,2BAA2B;oBAC/B,OAAO,SAAS,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;gBACjC,KAAK,uBAAuB;oBAC3B,OAAO,SAAS,IAAI,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAC7C,CAAC;QACF,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,OAAO,CAAC,GAAG,EAAE;YACrB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QACH,OAAO,CAAC,OAAO,CAAC,GAAG,EAAE;YACpB,MAAM,GAAG,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC;YAC5B,IAAI,CAAC,MAAM,GAAG,GAAG,KAAK,IAAI,CAAC;QAC5B,CAAC,CAAC,CAAC;IACJ,CAAC;IAED,QAAQ,CAAC,gBAAuC;QAC/C,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;IACnC,CAAC;IAED,aAAa;QACZ,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE,CAAC;YAC/B,KAAK,IAAI,CAAC,UAAU,EAAE,CAAC;QACxB,CAAC;IACF,CAAC;IAED,qBAAqB;QACpB,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE,CAAC;YAC/B,IAAI,CAAC,kBAAkB,EAAE,CAAC;QAC3B,CAAC;IACF,CAAC;IAED,IAAI,WAAW,CAAC,KAAK;QACpB,KAAK,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QACtB,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;IAC3B,CAAC;IAED,IAAI,WAAW;QACd,OAAO,IAAI,CAAC,YAAY,CAAC;IAC1B,CAAC;IAED,WAAW,CAAC,EAAc;QACzB,IAAI,CAAC,EAAE,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;IAC1B,CAAC;IAED,OAAO,CAAC,EAAc;QACrB,IAAI,CAAC,EAAE,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;QACrB,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;YACjB,EAAE,EAAE,CAAC;QACN,CAAC;IACF,CAAC;CACD;AAED,MAAM,QAAQ,GAAG,IAAI,uBAAuB,EAAE,CAAC;AAE/C,OAAO;AACN,kBAAkB;AAClB,QAAQ,IAAI,uBAAuB,GACnC,CAAC","sourcesContent":["import { Emitter } from '@rocket.chat/emitter';\nimport { Accounts } from 'meteor/accounts-base';\nimport { check } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport type { CachedCollection } from './CachedCollection';\n\nclass CachedCollectionManager extends Emitter<{ reconnect: void; login: string | null }> {\n\tprivate items: CachedCollection<any>[];\n\n\tprivate _syncEnabled: boolean;\n\n\tprivate logged: boolean;\n\n\tprivate step: number;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.items = [];\n\t\tthis._syncEnabled = false;\n\t\tthis.logged = false;\n\n\t\tconst { _unstoreLoginToken } = Accounts;\n\t\tAccounts._unstoreLoginToken = (...args) => {\n\t\t\t_unstoreLoginToken.apply(Accounts, args);\n\t\t\tthis.clearAllCacheOnLogout();\n\t\t};\n\n\t\tTracker.autorun(() => {\n\t\t\tconst [WAITING_FIRST_CONNECTION, WAITING_FIRST_DISCONNECTION, LISTENING_RECONNECTIONS] = [0, 1, 2];\n\t\t\tthis.step = this.step || WAITING_FIRST_CONNECTION;\n\t\t\tconst { connected } = Meteor.status();\n\t\t\tswitch (this.step) {\n\t\t\t\tcase WAITING_FIRST_CONNECTION:\n\t\t\t\t\treturn !connected || this.step++;\n\t\t\t\tcase WAITING_FIRST_DISCONNECTION:\n\t\t\t\t\treturn connected || this.step++;\n\t\t\t\tcase LISTENING_RECONNECTIONS:\n\t\t\t\t\treturn connected && this.emit('reconnect');\n\t\t\t}\n\t\t});\n\n\t\tAccounts.onLogin(() => {\n\t\t\tthis.emit('login', Meteor.userId());\n\t\t});\n\t\tTracker.autorun(() => {\n\t\t\tconst uid = Meteor.userId();\n\t\t\tthis.logged = uid !== null;\n\t\t});\n\t}\n\n\tregister(cachedCollection: CachedCollection<any>) {\n\t\tthis.items.push(cachedCollection);\n\t}\n\n\tclearAllCache() {\n\t\tfor (const item of this.items) {\n\t\t\tvoid item.clearCache();\n\t\t}\n\t}\n\n\tclearAllCacheOnLogout() {\n\t\tfor (const item of this.items) {\n\t\t\titem.clearCacheOnLogout();\n\t\t}\n\t}\n\n\tset syncEnabled(value) {\n\t\tcheck(value, Boolean);\n\t\tthis._syncEnabled = value;\n\t}\n\n\tget syncEnabled() {\n\t\treturn this._syncEnabled;\n\t}\n\n\tonReconnect(cb: () => void) {\n\t\tthis.on('reconnect', cb);\n\t}\n\n\tonLogin(cb: () => void) {\n\t\tthis.on('login', cb);\n\t\tif (this.logged) {\n\t\t\tcb();\n\t\t}\n\t}\n}\n\nconst instance = new CachedCollectionManager();\n\nexport {\n\t/** @deprecated */\n\tinstance as CachedCollectionManager,\n};\n"]}}},"code":"var _createForOfIteratorHelperLoose;\nmodule.link(\"@babel/runtime/helpers/createForOfIteratorHelperLoose\", {\n  default: function (v) {\n    _createForOfIteratorHelperLoose = v;\n  }\n}, 0);\nvar _createClass;\nmodule.link(\"@babel/runtime/helpers/createClass\", {\n  default: function (v) {\n    _createClass = v;\n  }\n}, 1);\nvar _inheritsLoose;\nmodule.link(\"@babel/runtime/helpers/inheritsLoose\", {\n  default: function (v) {\n    _inheritsLoose = v;\n  }\n}, 2);\nmodule.export({\n  CachedCollectionManager: function () {\n    return instance;\n  }\n});\nvar Emitter;\nmodule.link(\"@rocket.chat/emitter\", {\n  Emitter: function (v) {\n    Emitter = v;\n  }\n}, 0);\nvar Accounts;\nmodule.link(\"meteor/accounts-base\", {\n  Accounts: function (v) {\n    Accounts = v;\n  }\n}, 1);\nvar check;\nmodule.link(\"meteor/check\", {\n  check: function (v) {\n    check = v;\n  }\n}, 2);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 3);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 4);\nvar CachedCollectionManager = /*#__PURE__*/function (_Emitter) {\n  function CachedCollectionManager() {\n    var _this;\n    _this = _Emitter.call(this) || this;\n    _this.items = void 0;\n    _this._syncEnabled = void 0;\n    _this.logged = void 0;\n    _this.step = void 0;\n    _this.items = [];\n    _this._syncEnabled = false;\n    _this.logged = false;\n    var _Accounts = Accounts,\n      _unstoreLoginToken = _Accounts._unstoreLoginToken;\n    Accounts._unstoreLoginToken = function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _unstoreLoginToken.apply(Accounts, args);\n      _this.clearAllCacheOnLogout();\n    };\n    Tracker.autorun(function () {\n      var WAITING_FIRST_CONNECTION = 0,\n        WAITING_FIRST_DISCONNECTION = 1,\n        LISTENING_RECONNECTIONS = 2;\n      _this.step = _this.step || WAITING_FIRST_CONNECTION;\n      var _Meteor$status = Meteor.status(),\n        connected = _Meteor$status.connected;\n      switch (_this.step) {\n        case WAITING_FIRST_CONNECTION:\n          return !connected || _this.step++;\n        case WAITING_FIRST_DISCONNECTION:\n          return connected || _this.step++;\n        case LISTENING_RECONNECTIONS:\n          return connected && _this.emit('reconnect');\n      }\n    });\n    Accounts.onLogin(function () {\n      _this.emit('login', Meteor.userId());\n    });\n    Tracker.autorun(function () {\n      var uid = Meteor.userId();\n      _this.logged = uid !== null;\n    });\n    return _this;\n  }\n  _inheritsLoose(CachedCollectionManager, _Emitter);\n  var _proto = CachedCollectionManager.prototype;\n  _proto.register = function () {\n    function register(cachedCollection) {\n      this.items.push(cachedCollection);\n    }\n    return register;\n  }();\n  _proto.clearAllCache = function () {\n    function clearAllCache() {\n      for (var _iterator = _createForOfIteratorHelperLoose(this.items), _step; !(_step = _iterator()).done;) {\n        var item = _step.value;\n        void item.clearCache();\n      }\n    }\n    return clearAllCache;\n  }();\n  _proto.clearAllCacheOnLogout = function () {\n    function clearAllCacheOnLogout() {\n      for (var _iterator2 = _createForOfIteratorHelperLoose(this.items), _step2; !(_step2 = _iterator2()).done;) {\n        var item = _step2.value;\n        item.clearCacheOnLogout();\n      }\n    }\n    return clearAllCacheOnLogout;\n  }();\n  _proto.onReconnect = function () {\n    function onReconnect(cb) {\n      this.on('reconnect', cb);\n    }\n    return onReconnect;\n  }();\n  _proto.onLogin = function () {\n    function onLogin(cb) {\n      this.on('login', cb);\n      if (this.logged) {\n        cb();\n      }\n    }\n    return onLogin;\n  }();\n  return _createClass(CachedCollectionManager, [{\n    key: \"syncEnabled\",\n    get: function () {\n      return this._syncEnabled;\n    },\n    set: function (value) {\n      check(value, Boolean);\n      this._syncEnabled = value;\n    }\n  }]);\n}(Emitter);\nvar instance = new CachedCollectionManager();","map":{"version":3,"names":["_createForOfIteratorHelperLoose","module","link","default","v","_createClass","_inheritsLoose","export","CachedCollectionManager","instance","Emitter","Accounts","check","Meteor","Tracker","_Emitter","_this","call","items","_syncEnabled","logged","step","_Accounts","_unstoreLoginToken","_len","arguments","length","args","Array","_key","apply","clearAllCacheOnLogout","autorun","WAITING_FIRST_CONNECTION","WAITING_FIRST_DISCONNECTION","LISTENING_RECONNECTIONS","_Meteor$status","status","connected","emit","onLogin","userId","uid","_proto","prototype","register","cachedCollection","push","clearAllCache","_iterator","_step","done","item","value","clearCache","_iterator2","_step2","clearCacheOnLogout","onReconnect","cb","on","key","get","set","Boolean"],"sources":["app/ui-cached-collection/client/models/CachedCollectionManager.ts"],"sourcesContent":["import { Emitter } from '@rocket.chat/emitter';\nimport { Accounts } from 'meteor/accounts-base';\nimport { check } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport type { CachedCollection } from './CachedCollection';\n\nclass CachedCollectionManager extends Emitter<{ reconnect: void; login: string | null }> {\n\tprivate items: CachedCollection<any>[];\n\n\tprivate _syncEnabled: boolean;\n\n\tprivate logged: boolean;\n\n\tprivate step: number;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.items = [];\n\t\tthis._syncEnabled = false;\n\t\tthis.logged = false;\n\n\t\tconst { _unstoreLoginToken } = Accounts;\n\t\tAccounts._unstoreLoginToken = (...args) => {\n\t\t\t_unstoreLoginToken.apply(Accounts, args);\n\t\t\tthis.clearAllCacheOnLogout();\n\t\t};\n\n\t\tTracker.autorun(() => {\n\t\t\tconst [WAITING_FIRST_CONNECTION, WAITING_FIRST_DISCONNECTION, LISTENING_RECONNECTIONS] = [0, 1, 2];\n\t\t\tthis.step = this.step || WAITING_FIRST_CONNECTION;\n\t\t\tconst { connected } = Meteor.status();\n\t\t\tswitch (this.step) {\n\t\t\t\tcase WAITING_FIRST_CONNECTION:\n\t\t\t\t\treturn !connected || this.step++;\n\t\t\t\tcase WAITING_FIRST_DISCONNECTION:\n\t\t\t\t\treturn connected || this.step++;\n\t\t\t\tcase LISTENING_RECONNECTIONS:\n\t\t\t\t\treturn connected && this.emit('reconnect');\n\t\t\t}\n\t\t});\n\n\t\tAccounts.onLogin(() => {\n\t\t\tthis.emit('login', Meteor.userId());\n\t\t});\n\t\tTracker.autorun(() => {\n\t\t\tconst uid = Meteor.userId();\n\t\t\tthis.logged = uid !== null;\n\t\t});\n\t}\n\n\tregister(cachedCollection: CachedCollection<any>) {\n\t\tthis.items.push(cachedCollection);\n\t}\n\n\tclearAllCache() {\n\t\tfor (const item of this.items) {\n\t\t\tvoid item.clearCache();\n\t\t}\n\t}\n\n\tclearAllCacheOnLogout() {\n\t\tfor (const item of this.items) {\n\t\t\titem.clearCacheOnLogout();\n\t\t}\n\t}\n\n\tset syncEnabled(value) {\n\t\tcheck(value, Boolean);\n\t\tthis._syncEnabled = value;\n\t}\n\n\tget syncEnabled() {\n\t\treturn this._syncEnabled;\n\t}\n\n\tonReconnect(cb: () => void) {\n\t\tthis.on('reconnect', cb);\n\t}\n\n\tonLogin(cb: () => void) {\n\t\tthis.on('login', cb);\n\t\tif (this.logged) {\n\t\t\tcb();\n\t\t}\n\t}\n}\n\nconst instance = new CachedCollectionManager();\n\nexport {\n\t/** @deprecated */\n\tinstance as CachedCollectionManager,\n};\n"],"mappings":"AAAA,IAAAA,+BAAwB;AAAAC,MAAA,CAAAC,IAAuB;EAAAC,OAAA,WAAAA,CAAAC,CAAA;IAAAJ,+BAAA,GAAAI,CAAA;EAAA;AAAA;AAAA,IAAAC,YAAA;AAAAJ,MAAA,CAAAC,IAAA;EAAAC,OAAA,WAAAA,CAAAC,CAAA;IAAAC,YAAA,GAAAD,CAAA;EAAA;AAAA;AAAA,IAAAE,cAAA;AAAAL,MAAA,CAAAC,IAAA;EAAAC,OAAA,WAAAA,CAAAC,CAAA;IAAAE,cAAA,GAAAF,CAAA;EAAA;AAAA;AAA/CH,MAAA,CAAOM,MAAE;EAAAC,uBAAe,WAAAA,CAAA,EAAuB;IAAA,OAAAC,QAAA;EAAA;AAAA;AAAA,IAAAC,OAAA;AAAAT,MAAA,CAAAC,IAAA;EAAAQ,OAAA,WAAAA,CAAAN,CAAA;IAAAM,OAAA,GAAAN,CAAA;EAAA;AAAA;AAAA,IAAAO,QAAA;AAAAV,MAAA,CAAAC,IAAA;EAAAS,QAAA,WAAAA,CAAAP,CAAA;IAAAO,QAAA,GAAAP,CAAA;EAAA;AAAA;AAAA,IAAAQ,KAAA;AAAAX,MAAA,CAAAC,IAAA;EAAAU,KAAA,WAAAA,CAAAR,CAAA;IAAAQ,KAAA,GAAAR,CAAA;EAAA;AAAA;AAAA,IAAAS,MAAA;AAAAZ,MAAA,CAAAC,IAAA;EAAAW,MAAA,WAAAA,CAAAT,CAAA;IAAAS,MAAA,GAAAT,CAAA;EAAA;AAAA;AAAA,IAAAU,OAAA;AAAAb,MAAA,CAAAC,IAAA;EAAAY,OAAA,WAAAA,CAAAV,CAAA;IAAAU,OAAA,GAAAV,CAAA;EAAA;AAAA;AAAA,IAQzCI,uBAAwB,0BAAAO,QAAA;EAS7B,SAAAP,wBAAA;IAAA,IAAAQ,KAAA;IACCA,KAAA,GAAAD,QAAA,CAAAE,IAAA,KAAK,CAAE;IAACD,KAAA,CATDE,KAAK;IAAAF,KAAA,CAELG,YAAY;IAAAH,KAAA,CAEZI,MAAM;IAAAJ,KAAA,CAENK,IAAI;IAIXL,KAAA,CAAKE,KAAK,GAAG,EAAE;IACfF,KAAA,CAAKG,YAAY,GAAG,KAAK;IACzBH,KAAA,CAAKI,MAAM,GAAG,KAAK;IAEnB,IAAAE,SAAA,GAA+BX,QAAQ;MAA/BY,kBAAkB,GAAAD,SAAA,CAAlBC,kBAAkB;IAC1BZ,QAAQ,CAACY,kBAAkB,GAAG,YAAY;MAAA,SAAAC,IAAA,GAAAC,SAAA,CAAAC,MAAA,EAARC,IAAI,OAAAC,KAAA,CAAAJ,IAAA,GAAAK,IAAA,MAAAA,IAAA,GAAAL,IAAA,EAAAK,IAAA;QAAJF,IAAI,CAAAE,IAAA,IAAAJ,SAAA,CAAAI,IAAA;MAAA;MACrCN,kBAAkB,CAACO,KAAK,CAACnB,QAAQ,EAAEgB,IAAI,CAAC;MACxCX,KAAA,CAAKe,qBAAqB,EAAE;IAC7B,CAAC;IAEDjB,OAAO,CAACkB,OAAO,CAAC,YAAK;MACpB,IAAOC,wBAAwB,GAA2D,CAAC;QAA1DC,2BAA2B,GAAiC,CAAC;QAAhCC,uBAAuB,GAAW,CAAC;MACjGnB,KAAA,CAAKK,IAAI,GAAGL,KAAA,CAAKK,IAAI,IAAIY,wBAAwB;MACjD,IAAAG,cAAA,GAAsBvB,MAAM,CAACwB,MAAM,EAAE;QAA7BC,SAAS,GAAAF,cAAA,CAATE,SAAS;MACjB,QAAQtB,KAAA,CAAKK,IAAI;QAChB,KAAKY,wBAAwB;UAC5B,OAAO,CAACK,SAAS,IAAItB,KAAA,CAAKK,IAAI,EAAE;QACjC,KAAKa,2BAA2B;UAC/B,OAAOI,SAAS,IAAItB,KAAA,CAAKK,IAAI,EAAE;QAChC,KAAKc,uBAAuB;UAC3B,OAAOG,SAAS,IAAItB,KAAA,CAAKuB,IAAI,CAAC,WAAW,CAAC;MAC5C;IACD,CAAC,CAAC;IAEF5B,QAAQ,CAAC6B,OAAO,CAAC,YAAK;MACrBxB,KAAA,CAAKuB,IAAI,CAAC,OAAO,EAAE1B,MAAM,CAAC4B,MAAM,EAAE,CAAC;IACpC,CAAC,CAAC;IACF3B,OAAO,CAACkB,OAAO,CAAC,YAAK;MACpB,IAAMU,GAAG,GAAG7B,MAAM,CAAC4B,MAAM,EAAE;MAC3BzB,KAAA,CAAKI,MAAM,GAAGsB,GAAG,KAAK,IAAI;IAC3B,CAAC,CAAC;IAAC,OAAA1B,KAAA;EACJ;EAACV,cAAA,CAAAE,uBAAA,EAAAO,QAAA;EAAA,IAAA4B,MAAA,GAAAnC,uBAAA,CAAAoC,SAAA;EAAAD,MAAA,CAEDE,QAAQ;IAAR,SAAAA,SAASC,gBAAuC;MAC/C,IAAI,CAAC5B,KAAK,CAAC6B,IAAI,CAACD,gBAAgB,CAAC;IAClC;IAAC,OAAAD,QAAA;EAAA;EAAAF,MAAA,CAEDK,aAAa;IAAb,SAAAA,cAAA,EAAa;MACZ,SAAAC,SAAA,GAAAjD,+BAAA,CAAmB,IAAI,CAACkB,KAAK,GAAAgC,KAAA,IAAAA,KAAA,GAAAD,SAAA,IAAAE,IAAA,GAAE;QAAA,IAApBC,IAAI,GAAAF,KAAA,CAAAG,KAAA;QACd,KAAKD,IAAI,CAACE,UAAU,EAAE;MACvB;IACD;IAAC,OAAAN,aAAA;EAAA;EAAAL,MAAA,CAEDZ,qBAAqB;IAArB,SAAAA,sBAAA,EAAqB;MACpB,SAAAwB,UAAA,GAAAvD,+BAAA,CAAmB,IAAI,CAACkB,KAAK,GAAAsC,MAAA,IAAAA,MAAA,GAAAD,UAAA,IAAAJ,IAAA,GAAE;QAAA,IAApBC,IAAI,GAAAI,MAAA,CAAAH,KAAA;QACdD,IAAI,CAACK,kBAAkB,EAAE;MAC1B;IACD;IAAC,OAAA1B,qBAAA;EAAA;EAAAY,MAAA,CAWDe,WAAW;IAAX,SAAAA,YAAYC,EAAc;MACzB,IAAI,CAACC,EAAE,CAAC,WAAW,EAAED,EAAE,CAAC;IACzB;IAAC,OAAAD,WAAA;EAAA;EAAAf,MAAA,CAEDH,OAAO;IAAP,SAAAA,QAAQmB,EAAc;MACrB,IAAI,CAACC,EAAE,CAAC,OAAO,EAAED,EAAE,CAAC;MACpB,IAAI,IAAI,CAACvC,MAAM,EAAE;QAChBuC,EAAE,EAAE;MACL;IACD;IAAC,OAAAnB,OAAA;EAAA;EAAA,OAAAnC,YAAA,CAAAG,uBAAA;IAAAqD,GAAA;IAAAC,GAAA,EAbD,SAAAA,CAAA,EAAe;MACd,OAAO,IAAI,CAAC3C,YAAY;IACzB,CAAC;IAAA4C,GAAA,EAPD,SAAAA,CAAgBV,KAAK;MACpBzC,KAAK,CAACyC,KAAK,EAAEW,OAAO,CAAC;MACrB,IAAI,CAAC7C,YAAY,GAAGkC,KAAK;IAC1B;EAAC;AAAA,EA/DoC3C,OAAkD;AAiFxF,IAAMD,QAAQ,GAAG,IAAID,uBAAuB,EAAE","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"849b7f102973316d07c901e5f919941da46c8db1"}
