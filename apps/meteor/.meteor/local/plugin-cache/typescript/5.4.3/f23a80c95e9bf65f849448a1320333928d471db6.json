{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-message/client/messageBox/createComposerAPI.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui-message/client/messageBox/createComposerAPI.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-message/client/messageBox/createComposerAPI.ts","inputSourceMap":{"version":3,"file":"app/ui-message/client/messageBox/createComposerAPI.ts","sourceRoot":"","sources":["app/ui-message/client/messageBox/createComposerAPI.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,OAAO,EAAE,MAAM,sBAAsB,CAAC;AAC/C,OAAO,EAAE,QAAQ,EAAE,MAAM,sBAAsB,CAAC;AAGhD,OAAO,EAAE,cAAc,EAAE,MAAM,0CAA0C,CAAC;AAE1E,OAAO,EAAE,iBAAiB,EAAE,MAAM,wBAAwB,CAAC;AAE3D,MAAM,CAAC,MAAM,iBAAiB,GAAG,CAAC,KAA0B,EAAE,SAAiB,EAAe,EAAE;IAC/F,MAAM,YAAY,GAAG,CAAC,KAA0B,EAAE,GAAW,EAAQ,EAAE;QACtE,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;QAChD,uDAAuD;QACvD,MAAM,OAAO,GAAI,KAAa,CAAC,aAAa,CAAC;QAC7C,IAAI,OAAO,EAAE,CAAC;YACb,OAAO,CAAC,QAAQ,CAAC,IAAI,IAAI,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC;QACzC,CAAC;QACD,KAAK,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;IAC5B,CAAC,CAAC;IAEF,MAAM,OAAO,GAAG,IAAI,OAAO,EAOvB,CAAC;IAEL,IAAI,eAAe,GAAe,EAAE,CAAC;IAErC,MAAM,OAAO,GAAG,cAAc,CAAC,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,EAAE;QAClD,IAAI,KAAK,CAAC,KAAK,EAAE,CAAC;YACjB,QAAQ,CAAC,eAAe,CAAC,OAAO,CAAC,SAAS,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;YACzD,OAAO;QACR,CAAC;QAED,QAAQ,CAAC,eAAe,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;IAChD,CAAC,CAAC,CAAC;IAEH,MAAM,0BAA0B,GAAG,GAAS,EAAE;QAC7C,OAAO,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;IACtC,CAAC,CAAC;IAEF,KAAK,CAAC,gBAAgB,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;IAEzC,MAAM,OAAO,GAAG,CACf,IAAY,EACZ,EACC,SAAS,EACT,SAAS,MAMN,EAAE,EACC,EAAE;QACT,CAAC,SAAS,IAAI,KAAK,EAAE,CAAC;QAEtB,MAAM,EAAE,cAAc,EAAE,YAAY,EAAE,GAAG,KAAK,CAAC;QAC/C,MAAM,WAAW,GAAG,KAAK,CAAC,KAAK,CAAC;QAEhC,IAAI,OAAO,SAAS,KAAK,UAAU,EAAE,CAAC;YACrC,SAAS,GAAG,SAAS,CAAC,EAAE,KAAK,EAAE,cAAc,EAAE,GAAG,EAAE,YAAY,EAAE,CAAC,CAAC;QACrE,CAAC;QAED,IAAI,SAAS,EAAE,CAAC;YACf,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,YAAY,EAAE,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC;gBACxD,KAAK,CAAC,KAAK,GAAG,WAAW,CAAC,SAAS,CAAC,CAAC,EAAE,cAAc,CAAC,GAAG,IAAI,GAAG,WAAW,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC;gBACtG,CAAC,SAAS,IAAI,KAAK,EAAE,CAAC;YACvB,CAAC;YACD,KAAK,CAAC,iBAAiB,CAAC,SAAS,CAAC,KAAK,IAAI,CAAC,EAAE,SAAS,CAAC,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC;QAC7E,CAAC;QAED,IAAI,CAAC,SAAS,EAAE,CAAC;YAChB,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC;QACpB,CAAC;QAED,YAAY,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QAC7B,YAAY,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QAE9B,CAAC,SAAS,IAAI,KAAK,EAAE,CAAC;IACvB,CAAC,CAAC;IAEF,MAAM,UAAU,GAAG,CAAC,IAAY,EAAQ,EAAE;QACzC,OAAO,CAAC,IAAI,EAAE;YACb,SAAS,EAAE,CAAC,EAAE,KAAK,EAAE,GAAG,EAAE,EAAE,EAAE,CAAC,CAAC;gBAC/B,KAAK,EAAE,KAAK,GAAG,IAAI,CAAC,MAAM;gBAC1B,GAAG,EAAE,GAAG,GAAG,IAAI,CAAC,MAAM;aACtB,CAAC;SACF,CAAC,CAAC;IACJ,CAAC,CAAC;IAEF,MAAM,KAAK,GAAG,GAAS,EAAE;QACxB,OAAO,CAAC,EAAE,CAAC,CAAC;IACb,CAAC,CAAC;IAEF,MAAM,KAAK,GAAG,GAAS,EAAE;QACxB,KAAK,CAAC,KAAK,EAAE,CAAC;IACf,CAAC,CAAC;IAEF,MAAM,SAAS,GAAG,KAAK,EAAE,IAAY,EAAiB,EAAE;QACvD,IAAI,KAAK,EAAE,CAAC;YACX,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC;YACnB,KAAK,CAAC,KAAK,EAAE,CAAC;QACf,CAAC;IACF,CAAC,CAAC;IAEF,MAAM,YAAY,GAAG,KAAK,EAAE,OAAiB,EAAiB,EAAE;QAC/D,eAAe,GAAG,CAAC,GAAG,eAAe,CAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,EAAE,CAAC,QAAQ,CAAC,GAAG,KAAK,OAAO,CAAC,GAAG,CAAC,EAAE,OAAO,CAAC,CAAC;QACnG,0BAA0B,EAAE,CAAC;QAC7B,KAAK,CAAC,KAAK,EAAE,CAAC;IACf,CAAC,CAAC;IAEF,MAAM,oBAAoB,GAAG,KAAK,EAAE,GAAoB,EAAiB,EAAE;QAC1E,eAAe,GAAG,eAAe,CAAC,MAAM,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,KAAK,GAAG,CAAC,CAAC;QAC3E,0BAA0B,EAAE,CAAC;IAC9B,CAAC,CAAC;IAEF,MAAM,wBAAwB,GAAG,KAAK,IAAmB,EAAE;QAC1D,eAAe,GAAG,EAAE,CAAC;QACrB,0BAA0B,EAAE,CAAC;IAC9B,CAAC,CAAC;IAEF,MAAM,cAAc,GAAG;QACtB,GAAG,EAAE,GAAG,EAAE,CAAC,eAAe;QAC1B,SAAS,EAAE,CAAC,QAAoB,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,sBAAsB,EAAE,QAAQ,CAAC;KACjF,CAAC;IAEF,MAAM,CAAC,OAAO,EAAE,UAAU,CAAC,GAAG,CAAC,GAAG,EAAE;QACnC,IAAI,OAAO,GAAG,KAAK,CAAC;QAEpB,OAAO;YACN;gBACC,GAAG,EAAE,GAAG,EAAE,CAAC,OAAO;gBAClB,SAAS,EAAE,CAAC,QAAoB,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,SAAS,EAAE,QAAQ,CAAC;aACpE;YACD,CAAC,KAAc,EAAE,EAAE;gBAClB,OAAO,GAAG,KAAK,CAAC;gBAChB,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YACzB,CAAC;SACD,CAAC;IACH,CAAC,CAAC,EAAE,CAAC;IAEL,MAAM,CAAC,SAAS,EAAE,gBAAgB,CAAC,GAAG,CAAC,GAAG,EAAE;QAC3C,IAAI,SAAS,GAAG,KAAK,CAAC;QAEtB,OAAO;YACN;gBACC,GAAG,EAAE,GAAG,EAAE,CAAC,SAAS;gBACpB,SAAS,EAAE,CAAC,QAAoB,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,WAAW,EAAE,QAAQ,CAAC;aACtE;YACD,CAAC,KAAc,EAAE,EAAE;gBAClB,SAAS,GAAG,KAAK,CAAC;gBAClB,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAC3B,CAAC;SACD,CAAC;IACH,CAAC,CAAC,EAAE,CAAC;IAEL,MAAM,CAAC,cAAc,EAAE,iBAAiB,CAAC,GAAG,CAAC,GAAG,EAAE;QACjD,IAAI,cAAc,GAAG,KAAK,CAAC;QAE3B,OAAO;YACN;gBACC,GAAG,EAAE,GAAG,EAAE,CAAC,cAAc;gBACzB,SAAS,EAAE,CAAC,QAAoB,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,gBAAgB,EAAE,QAAQ,CAAC;aAC3E;YACD,CAAC,KAAc,EAAE,EAAE;gBAClB,cAAc,GAAG,KAAK,CAAC;gBACvB,OAAO,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAChC,CAAC;SACD,CAAC;IACH,CAAC,CAAC,EAAE,CAAC;IAEL,MAAM,CAAC,kBAAkB,EAAE,qBAAqB,CAAC,GAAG,CAAC,GAAG,EAAE;QACzD,IAAI,kBAAkB,GAAG,KAAK,CAAC;QAE/B,OAAO;YACN;gBACC,GAAG,EAAE,GAAG,EAAE,CAAC,kBAAkB;gBAC7B,SAAS,EAAE,CAAC,QAAoB,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,kBAAkB,EAAE,QAAQ,CAAC;aAC7E;YACD,CAAC,KAAc,EAAE,EAAE;gBAClB,kBAAkB,GAAG,KAAK,CAAC;gBAC3B,OAAO,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;YAClC,CAAC;SACD,CAAC;IACH,CAAC,CAAC,EAAE,CAAC;IAEL,MAAM,cAAc,GAAG,CAAC,OAAgB,EAAQ,EAAE;QACjD,UAAU,CAAC,OAAO,CAAC,CAAC;IACrB,CAAC,CAAC;IAEF,MAAM,CAAC,UAAU,EAAE,oBAAoB,CAAC,GAAG,CAAC,GAAG,EAAE;QAChD,IAAI,OAAO,GAAuB,EAAE,CAAC;QAErC,MAAM,CAAC,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,EAAE;YAC9B,OAAO,GAAG,iBAAiB,CAAC,MAAM,CAAC,CAAC,EAAE,SAAS,EAAE,EAAE,EAAE,CAAC,CAAC,SAAS,IAAI,SAAS,EAAE,CAAC,CAAC;YACjF,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QAC5B,CAAC,CAAC,CAAC;QAEH,OAAO;YACN;gBACC,GAAG,EAAE,GAAG,EAAE,CAAC,OAAO;gBAClB,SAAS,EAAE,CAAC,QAAoB,EAAE,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,YAAY,EAAE,QAAQ,CAAC;aACvE;YACD,CAAC;SACD,CAAC;IACH,CAAC,CAAC,EAAE,CAAC;IAEL,MAAM,OAAO,GAAG,GAAS,EAAE;QAC1B,KAAK,CAAC,mBAAmB,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;QAC5C,oBAAoB,CAAC,IAAI,EAAE,CAAC;IAC7B,CAAC,CAAC;IAEF,MAAM,aAAa,GAAG,CAAC,OAAe,EAAQ,EAAE;QAC/C,MAAM,EAAE,YAAY,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,cAAc,GAAG,CAAC,EAAE,GAAG,KAAK,CAAC;QACxE,MAAM,QAAQ,GAAG,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,cAAc,CAAC,CAAC;QACtD,MAAM,YAAY,GAAG,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,cAAc,EAAE,YAAY,CAAC,CAAC;QACrE,MAAM,SAAS,GAAG,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,YAAY,EAAE,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAEtE,KAAK,EAAE,CAAC;QAER,MAAM,YAAY,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC;QACnE,MAAM,iBAAiB,GAAG,CAAC,GAAG,YAAY,CAAC,CAAC,OAAO,EAAE,CAAC,KAAK,CAAC,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,cAAc,GAAG,KAAK,GAAG,CAAC,EAAE,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC;QAExI,IAAI,iBAAiB,EAAE,CAAC;YACvB,MAAM,UAAU,GAAG,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC;YAClF,MAAM,eAAe,GAAG,CAAC,GAAG,UAAU,CAAC,CAAC,KAAK,CAAC,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,YAAY,GAAG,KAAK,EAAE,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC;YAEpH,IAAI,eAAe,EAAE,CAAC;gBACrB,UAAU,CAAC,YAAY,CAAC,CAAC;gBACzB,KAAK,CAAC,cAAc,GAAG,cAAc,GAAG,YAAY,CAAC,MAAM,CAAC;gBAC5D,KAAK,CAAC,YAAY,GAAG,YAAY,GAAG,UAAU,CAAC,MAAM,CAAC;gBAEtD,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,YAAY,EAAE,KAAK,EAAE,YAAY,CAAC,EAAE,CAAC;oBAChE,KAAK,CAAC,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE,QAAQ,CAAC,MAAM,GAAG,YAAY,CAAC,MAAM,CAAC,GAAG,YAAY,GAAG,SAAS,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;gBAC5H,CAAC;gBAED,KAAK,CAAC,cAAc,GAAG,cAAc,GAAG,YAAY,CAAC,MAAM,CAAC;gBAC5D,KAAK,CAAC,YAAY,GAAG,KAAK,CAAC,cAAc,GAAG,YAAY,CAAC,MAAM,CAAC;gBAChE,YAAY,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;gBAC7B,YAAY,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;gBAE9B,KAAK,EAAE,CAAC;gBACR,OAAO;YACR,CAAC;QACF,CAAC;QAED,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,YAAY,EAAE,KAAK,EAAE,OAAO,CAAC,OAAO,CAAC,UAAU,EAAE,YAAY,CAAC,CAAC,EAAE,CAAC;YAC7F,KAAK,CAAC,KAAK,GAAG,QAAQ,GAAG,OAAO,CAAC,OAAO,CAAC,UAAU,EAAE,YAAY,CAAC,GAAG,SAAS,CAAC;QAChF,CAAC;QAED,KAAK,CAAC,cAAc,GAAG,cAAc,GAAG,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QACpE,KAAK,CAAC,YAAY,GAAG,KAAK,CAAC,cAAc,GAAG,YAAY,CAAC,MAAM,CAAC;QAChE,YAAY,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QAC7B,YAAY,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QAE9B,KAAK,EAAE,CAAC;IACT,CAAC,CAAC;IAEF,MAAM,aAAa,GAAG,GAAS,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;IAEnD,OAAO,CAAC,QAAQ,CAAC,eAAe,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,EAAE,EAAE;QAC1D,SAAS,EAAE,IAAI;KACf,CAAC,CAAC;IAEH,oFAAoF;IACpF,MAAM,WAAW,GAAG,CAAC,IAAY,EAAE,SAA2D,EAAQ,EAAE;QACvG,MAAM,EAAE,cAAc,EAAE,YAAY,EAAE,GAAG,KAAK,CAAC;QAE/C,mDAAmD;QACnD,KAAK,CAAC,iBAAiB,CAAC,SAAS,CAAC,KAAK,IAAI,CAAC,EAAE,SAAS,CAAC,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC;QAC5E,MAAM,WAAW,GAAG,KAAK,CAAC,KAAK,CAAC;QAEhC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,YAAY,EAAE,KAAK,EAAE,IAAI,CAAC,EAAE,CAAC;YACxD,KAAK,CAAC,KAAK,GAAG,WAAW,CAAC,SAAS,CAAC,CAAC,EAAE,SAAS,CAAC,KAAK,CAAC,GAAG,IAAI,GAAG,WAAW,CAAC,SAAS,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;QACvG,CAAC;QAED,KAAK,CAAC,cAAc,GAAG,cAAc,GAAG,IAAI,CAAC,MAAM,CAAC;QACpD,KAAK,CAAC,YAAY,GAAG,cAAc,GAAG,IAAI,CAAC,MAAM,CAAC;QAClD,IAAI,cAAc,KAAK,YAAY,EAAE,CAAC;YACrC,KAAK,CAAC,cAAc,GAAG,cAAc,CAAC;QACvC,CAAC;QAED,YAAY,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QAC7B,YAAY,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QAE9B,KAAK,EAAE,CAAC;IACT,CAAC,CAAC;IAEF,OAAO;QACN,WAAW;QACX,aAAa;QACb,IAAI,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,IAAI,EAAE;QAExB,SAAS,EAAE,CAAC,KAAa,EAAE,GAAY,EAAE,EAAE;YAC1C,OAAO,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;QAC1C,CAAC;QAED,iBAAiB,EAAE,GAAG,EAAE;YACvB,OAAO,KAAK,CAAC,cAAc,CAAC;QAC7B,CAAC;QACD,cAAc,EAAE,GAAG,EAAE;YACpB,KAAK,CAAC,YAAY,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC;YACxC,KAAK,CAAC,cAAc,GAAG,KAAK,CAAC,YAAY,CAAC;YAC1C,KAAK,EAAE,CAAC;QACT,CAAC;QACD,gBAAgB,EAAE,GAAG,EAAE;YACtB,KAAK,CAAC,cAAc,GAAG,CAAC,CAAC;YACzB,KAAK,CAAC,YAAY,GAAG,KAAK,CAAC,cAAc,CAAC;YAC1C,KAAK,EAAE,CAAC;QACT,CAAC;QACD,OAAO;QACP,aAAa;QACb,IAAI,IAAI;YACP,OAAO,KAAK,CAAC,KAAK,CAAC;QACpB,CAAC;QACD,IAAI,SAAS;YACZ,OAAO;gBACN,KAAK,EAAE,KAAK,CAAC,cAAc;gBAC3B,GAAG,EAAE,KAAK,CAAC,YAAY;aACvB,CAAC;QACH,CAAC;QAED,OAAO;QACP,cAAc;QACd,SAAS;QACT,gBAAgB;QAChB,cAAc;QACd,iBAAiB;QACjB,UAAU;QACV,OAAO;QACP,KAAK;QACL,KAAK;QACL,SAAS;QACT,YAAY;QACZ,oBAAoB;QACpB,wBAAwB;QACxB,cAAc;QACd,UAAU;QACV,kBAAkB;QAClB,qBAAqB;KACrB,CAAC;AACH,CAAC,CAAC","sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport { Accounts } from 'meteor/accounts-base';\n\nimport type { ComposerAPI } from '../../../../client/lib/chats/ChatAPI';\nimport { withDebouncing } from '../../../../lib/utils/highOrderFunctions';\nimport type { FormattingButton } from './messageBoxFormatting';\nimport { formattingButtons } from './messageBoxFormatting';\n\nexport const createComposerAPI = (input: HTMLTextAreaElement, storageID: string): ComposerAPI => {\n\tconst triggerEvent = (input: HTMLTextAreaElement, evt: string): void => {\n\t\tconst event = new Event(evt, { bubbles: true });\n\t\t// TODO: Remove this hack for react to trigger onChange\n\t\tconst tracker = (input as any)._valueTracker;\n\t\tif (tracker) {\n\t\t\ttracker.setValue(new Date().toString());\n\t\t}\n\t\tinput.dispatchEvent(event);\n\t};\n\n\tconst emitter = new Emitter<{\n\t\tquotedMessagesUpdate: void;\n\t\tediting: void;\n\t\trecording: void;\n\t\trecordingVideo: void;\n\t\tformatting: void;\n\t\tmircophoneDenied: void;\n\t}>();\n\n\tlet _quotedMessages: IMessage[] = [];\n\n\tconst persist = withDebouncing({ wait: 300 })(() => {\n\t\tif (input.value) {\n\t\t\tAccounts.storageLocation.setItem(storageID, input.value);\n\t\t\treturn;\n\t\t}\n\n\t\tAccounts.storageLocation.removeItem(storageID);\n\t});\n\n\tconst notifyQuotedMessagesUpdate = (): void => {\n\t\temitter.emit('quotedMessagesUpdate');\n\t};\n\n\tinput.addEventListener('input', persist);\n\n\tconst setText = (\n\t\ttext: string,\n\t\t{\n\t\t\tselection,\n\t\t\tskipFocus,\n\t\t}: {\n\t\t\tselection?:\n\t\t\t\t| { readonly start?: number; readonly end?: number }\n\t\t\t\t| ((previous: { readonly start: number; readonly end: number }) => { readonly start?: number; readonly end?: number });\n\t\t\tskipFocus?: boolean;\n\t\t} = {},\n\t): void => {\n\t\t!skipFocus && focus();\n\n\t\tconst { selectionStart, selectionEnd } = input;\n\t\tconst textAreaTxt = input.value;\n\n\t\tif (typeof selection === 'function') {\n\t\t\tselection = selection({ start: selectionStart, end: selectionEnd });\n\t\t}\n\n\t\tif (selection) {\n\t\t\tif (!document.execCommand?.('insertText', false, text)) {\n\t\t\t\tinput.value = textAreaTxt.substring(0, selectionStart) + text + textAreaTxt.substring(selectionStart);\n\t\t\t\t!skipFocus && focus();\n\t\t\t}\n\t\t\tinput.setSelectionRange(selection.start ?? 0, selection.end ?? text.length);\n\t\t}\n\n\t\tif (!selection) {\n\t\t\tinput.value = text;\n\t\t}\n\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\t!skipFocus && focus();\n\t};\n\n\tconst insertText = (text: string): void => {\n\t\tsetText(text, {\n\t\t\tselection: ({ start, end }) => ({\n\t\t\t\tstart: start + text.length,\n\t\t\t\tend: end + text.length,\n\t\t\t}),\n\t\t});\n\t};\n\n\tconst clear = (): void => {\n\t\tsetText('');\n\t};\n\n\tconst focus = (): void => {\n\t\tinput.focus();\n\t};\n\n\tconst replyWith = async (text: string): Promise<void> => {\n\t\tif (input) {\n\t\t\tinput.value = text;\n\t\t\tinput.focus();\n\t\t}\n\t};\n\n\tconst quoteMessage = async (message: IMessage): Promise<void> => {\n\t\t_quotedMessages = [..._quotedMessages.filter((_message) => _message._id !== message._id), message];\n\t\tnotifyQuotedMessagesUpdate();\n\t\tinput.focus();\n\t};\n\n\tconst dismissQuotedMessage = async (mid: IMessage['_id']): Promise<void> => {\n\t\t_quotedMessages = _quotedMessages.filter((message) => message._id !== mid);\n\t\tnotifyQuotedMessagesUpdate();\n\t};\n\n\tconst dismissAllQuotedMessages = async (): Promise<void> => {\n\t\t_quotedMessages = [];\n\t\tnotifyQuotedMessagesUpdate();\n\t};\n\n\tconst quotedMessages = {\n\t\tget: () => _quotedMessages,\n\t\tsubscribe: (callback: () => void) => emitter.on('quotedMessagesUpdate', callback),\n\t};\n\n\tconst [editing, setEditing] = (() => {\n\t\tlet editing = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => editing,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('editing', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\tediting = value;\n\t\t\t\temitter.emit('editing');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [recording, setRecordingMode] = (() => {\n\t\tlet recording = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => recording,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('recording', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\trecording = value;\n\t\t\t\temitter.emit('recording');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [recordingVideo, setRecordingVideo] = (() => {\n\t\tlet recordingVideo = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => recordingVideo,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('recordingVideo', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\trecordingVideo = value;\n\t\t\t\temitter.emit('recordingVideo');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [isMicrophoneDenied, setIsMicrophoneDenied] = (() => {\n\t\tlet isMicrophoneDenied = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => isMicrophoneDenied,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('mircophoneDenied', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\tisMicrophoneDenied = value;\n\t\t\t\temitter.emit('mircophoneDenied');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst setEditingMode = (editing: boolean): void => {\n\t\tsetEditing(editing);\n\t};\n\n\tconst [formatters, stopFormatterTracker] = (() => {\n\t\tlet actions: FormattingButton[] = [];\n\n\t\tconst c = Tracker.autorun(() => {\n\t\t\tactions = formattingButtons.filter(({ condition }) => !condition || condition());\n\t\t\temitter.emit('formatting');\n\t\t});\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => actions,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('formatting', callback),\n\t\t\t},\n\t\t\tc,\n\t\t];\n\t})();\n\n\tconst release = (): void => {\n\t\tinput.removeEventListener('input', persist);\n\t\tstopFormatterTracker.stop();\n\t};\n\n\tconst wrapSelection = (pattern: string): void => {\n\t\tconst { selectionEnd = input.value.length, selectionStart = 0 } = input;\n\t\tconst initText = input.value.slice(0, selectionStart);\n\t\tconst selectedText = input.value.slice(selectionStart, selectionEnd);\n\t\tconst finalText = input.value.slice(selectionEnd, input.value.length);\n\n\t\tfocus();\n\n\t\tconst startPattern = pattern.slice(0, pattern.indexOf('{{text}}'));\n\t\tconst startPatternFound = [...startPattern].reverse().every((char, index) => input.value.slice(selectionStart - index - 1, 1) === char);\n\n\t\tif (startPatternFound) {\n\t\t\tconst endPattern = pattern.slice(pattern.indexOf('{{text}}') + '{{text}}'.length);\n\t\t\tconst endPatternFound = [...endPattern].every((char, index) => input.value.slice(selectionEnd + index, 1) === char);\n\n\t\t\tif (endPatternFound) {\n\t\t\t\tinsertText(selectedText);\n\t\t\t\tinput.selectionStart = selectionStart - startPattern.length;\n\t\t\t\tinput.selectionEnd = selectionEnd + endPattern.length;\n\n\t\t\t\tif (!document.execCommand?.('insertText', false, selectedText)) {\n\t\t\t\t\tinput.value = initText.slice(0, initText.length - startPattern.length) + selectedText + finalText.slice(endPattern.length);\n\t\t\t\t}\n\n\t\t\t\tinput.selectionStart = selectionStart - startPattern.length;\n\t\t\t\tinput.selectionEnd = input.selectionStart + selectedText.length;\n\t\t\t\ttriggerEvent(input, 'input');\n\t\t\t\ttriggerEvent(input, 'change');\n\n\t\t\t\tfocus();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (!document.execCommand?.('insertText', false, pattern.replace('{{text}}', selectedText))) {\n\t\t\tinput.value = initText + pattern.replace('{{text}}', selectedText) + finalText;\n\t\t}\n\n\t\tinput.selectionStart = selectionStart + pattern.indexOf('{{text}}');\n\t\tinput.selectionEnd = input.selectionStart + selectedText.length;\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\tfocus();\n\t};\n\n\tconst insertNewLine = (): void => insertText('\\n');\n\n\tsetText(Accounts.storageLocation.getItem(storageID) ?? '', {\n\t\tskipFocus: true,\n\t});\n\n\t// Gets the text that is connected to the cursor and replaces it with the given text\n\tconst replaceText = (text: string, selection: { readonly start: number; readonly end: number }): void => {\n\t\tconst { selectionStart, selectionEnd } = input;\n\n\t\t// Selects the text that is connected to the cursor\n\t\tinput.setSelectionRange(selection.start ?? 0, selection.end ?? text.length);\n\t\tconst textAreaTxt = input.value;\n\n\t\tif (!document.execCommand?.('insertText', false, text)) {\n\t\t\tinput.value = textAreaTxt.substring(0, selection.start) + text + textAreaTxt.substring(selection.end);\n\t\t}\n\n\t\tinput.selectionStart = selectionStart + text.length;\n\t\tinput.selectionEnd = selectionStart + text.length;\n\t\tif (selectionStart !== selectionEnd) {\n\t\t\tinput.selectionStart = selectionStart;\n\t\t}\n\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\tfocus();\n\t};\n\n\treturn {\n\t\treplaceText,\n\t\tinsertNewLine,\n\t\tblur: () => input.blur(),\n\n\t\tsubstring: (start: number, end?: number) => {\n\t\t\treturn input.value.substring(start, end);\n\t\t},\n\n\t\tgetCursorPosition: () => {\n\t\t\treturn input.selectionStart;\n\t\t},\n\t\tsetCursorToEnd: () => {\n\t\t\tinput.selectionEnd = input.value.length;\n\t\t\tinput.selectionStart = input.selectionEnd;\n\t\t\tfocus();\n\t\t},\n\t\tsetCursorToStart: () => {\n\t\t\tinput.selectionStart = 0;\n\t\t\tinput.selectionEnd = input.selectionStart;\n\t\t\tfocus();\n\t\t},\n\t\trelease,\n\t\twrapSelection,\n\t\tget text(): string {\n\t\t\treturn input.value;\n\t\t},\n\t\tget selection(): { start: number; end: number } {\n\t\t\treturn {\n\t\t\t\tstart: input.selectionStart,\n\t\t\t\tend: input.selectionEnd,\n\t\t\t};\n\t\t},\n\n\t\tediting,\n\t\tsetEditingMode,\n\t\trecording,\n\t\tsetRecordingMode,\n\t\trecordingVideo,\n\t\tsetRecordingVideo,\n\t\tinsertText,\n\t\tsetText,\n\t\tclear,\n\t\tfocus,\n\t\treplyWith,\n\t\tquoteMessage,\n\t\tdismissQuotedMessage,\n\t\tdismissAllQuotedMessages,\n\t\tquotedMessages,\n\t\tformatters,\n\t\tisMicrophoneDenied,\n\t\tsetIsMicrophoneDenied,\n\t};\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-message/client/messageBox/createComposerAPI.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-message/client/messageBox/createComposerAPI.ts","inputSourceMap":{"version":3,"file":"app/ui-message/client/messageBox/createComposerAPI.ts","sourceRoot":"","sources":["app/ui-message/client/messageBox/createComposerAPI.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport { Accounts } from 'meteor/accounts-base';\n\nimport type { ComposerAPI } from '../../../../client/lib/chats/ChatAPI';\nimport { withDebouncing } from '../../../../lib/utils/highOrderFunctions';\nimport type { FormattingButton } from './messageBoxFormatting';\nimport { formattingButtons } from './messageBoxFormatting';\n\nexport const createComposerAPI = (input: HTMLTextAreaElement, storageID: string): ComposerAPI => {\n\tconst triggerEvent = (input: HTMLTextAreaElement, evt: string): void => {\n\t\tconst event = new Event(evt, { bubbles: true });\n\t\t// TODO: Remove this hack for react to trigger onChange\n\t\tconst tracker = (input as any)._valueTracker;\n\t\tif (tracker) {\n\t\t\ttracker.setValue(new Date().toString());\n\t\t}\n\t\tinput.dispatchEvent(event);\n\t};\n\n\tconst emitter = new Emitter<{\n\t\tquotedMessagesUpdate: void;\n\t\tediting: void;\n\t\trecording: void;\n\t\trecordingVideo: void;\n\t\tformatting: void;\n\t\tmircophoneDenied: void;\n\t}>();\n\n\tlet _quotedMessages: IMessage[] = [];\n\n\tconst persist = withDebouncing({ wait: 300 })(() => {\n\t\tif (input.value) {\n\t\t\tAccounts.storageLocation.setItem(storageID, input.value);\n\t\t\treturn;\n\t\t}\n\n\t\tAccounts.storageLocation.removeItem(storageID);\n\t});\n\n\tconst notifyQuotedMessagesUpdate = (): void => {\n\t\temitter.emit('quotedMessagesUpdate');\n\t};\n\n\tinput.addEventListener('input', persist);\n\n\tconst setText = (\n\t\ttext: string,\n\t\t{\n\t\t\tselection,\n\t\t\tskipFocus,\n\t\t}: {\n\t\t\tselection?:\n\t\t\t\t| { readonly start?: number; readonly end?: number }\n\t\t\t\t| ((previous: { readonly start: number; readonly end: number }) => { readonly start?: number; readonly end?: number });\n\t\t\tskipFocus?: boolean;\n\t\t} = {},\n\t): void => {\n\t\t!skipFocus && focus();\n\n\t\tconst { selectionStart, selectionEnd } = input;\n\t\tconst textAreaTxt = input.value;\n\n\t\tif (typeof selection === 'function') {\n\t\t\tselection = selection({ start: selectionStart, end: selectionEnd });\n\t\t}\n\n\t\tif (selection) {\n\t\t\tif (!document.execCommand?.('insertText', false, text)) {\n\t\t\t\tinput.value = textAreaTxt.substring(0, selectionStart) + text + textAreaTxt.substring(selectionStart);\n\t\t\t\t!skipFocus && focus();\n\t\t\t}\n\t\t\tinput.setSelectionRange(selection.start ?? 0, selection.end ?? text.length);\n\t\t}\n\n\t\tif (!selection) {\n\t\t\tinput.value = text;\n\t\t}\n\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\t!skipFocus && focus();\n\t};\n\n\tconst insertText = (text: string): void => {\n\t\tsetText(text, {\n\t\t\tselection: ({ start, end }) => ({\n\t\t\t\tstart: start + text.length,\n\t\t\t\tend: end + text.length,\n\t\t\t}),\n\t\t});\n\t};\n\n\tconst clear = (): void => {\n\t\tsetText('');\n\t};\n\n\tconst focus = (): void => {\n\t\tinput.focus();\n\t};\n\n\tconst replyWith = async (text: string): Promise<void> => {\n\t\tif (input) {\n\t\t\tinput.value = text;\n\t\t\tinput.focus();\n\t\t}\n\t};\n\n\tconst quoteMessage = async (message: IMessage): Promise<void> => {\n\t\t_quotedMessages = [..._quotedMessages.filter((_message) => _message._id !== message._id), message];\n\t\tnotifyQuotedMessagesUpdate();\n\t\tinput.focus();\n\t};\n\n\tconst dismissQuotedMessage = async (mid: IMessage['_id']): Promise<void> => {\n\t\t_quotedMessages = _quotedMessages.filter((message) => message._id !== mid);\n\t\tnotifyQuotedMessagesUpdate();\n\t};\n\n\tconst dismissAllQuotedMessages = async (): Promise<void> => {\n\t\t_quotedMessages = [];\n\t\tnotifyQuotedMessagesUpdate();\n\t};\n\n\tconst quotedMessages = {\n\t\tget: () => _quotedMessages,\n\t\tsubscribe: (callback: () => void) => emitter.on('quotedMessagesUpdate', callback),\n\t};\n\n\tconst [editing, setEditing] = (() => {\n\t\tlet editing = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => editing,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('editing', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\tediting = value;\n\t\t\t\temitter.emit('editing');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [recording, setRecordingMode] = (() => {\n\t\tlet recording = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => recording,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('recording', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\trecording = value;\n\t\t\t\temitter.emit('recording');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [recordingVideo, setRecordingVideo] = (() => {\n\t\tlet recordingVideo = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => recordingVideo,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('recordingVideo', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\trecordingVideo = value;\n\t\t\t\temitter.emit('recordingVideo');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [isMicrophoneDenied, setIsMicrophoneDenied] = (() => {\n\t\tlet isMicrophoneDenied = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => isMicrophoneDenied,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('mircophoneDenied', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\tisMicrophoneDenied = value;\n\t\t\t\temitter.emit('mircophoneDenied');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst setEditingMode = (editing: boolean): void => {\n\t\tsetEditing(editing);\n\t};\n\n\tconst [formatters, stopFormatterTracker] = (() => {\n\t\tlet actions: FormattingButton[] = [];\n\n\t\tconst c = Tracker.autorun(() => {\n\t\t\tactions = formattingButtons.filter(({ condition }) => !condition || condition());\n\t\t\temitter.emit('formatting');\n\t\t});\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => actions,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('formatting', callback),\n\t\t\t},\n\t\t\tc,\n\t\t];\n\t})();\n\n\tconst release = (): void => {\n\t\tinput.removeEventListener('input', persist);\n\t\tstopFormatterTracker.stop();\n\t};\n\n\tconst wrapSelection = (pattern: string): void => {\n\t\tconst { selectionEnd = input.value.length, selectionStart = 0 } = input;\n\t\tconst initText = input.value.slice(0, selectionStart);\n\t\tconst selectedText = input.value.slice(selectionStart, selectionEnd);\n\t\tconst finalText = input.value.slice(selectionEnd, input.value.length);\n\n\t\tfocus();\n\n\t\tconst startPattern = pattern.slice(0, pattern.indexOf('{{text}}'));\n\t\tconst startPatternFound = [...startPattern].reverse().every((char, index) => input.value.slice(selectionStart - index - 1, 1) === char);\n\n\t\tif (startPatternFound) {\n\t\t\tconst endPattern = pattern.slice(pattern.indexOf('{{text}}') + '{{text}}'.length);\n\t\t\tconst endPatternFound = [...endPattern].every((char, index) => input.value.slice(selectionEnd + index, 1) === char);\n\n\t\t\tif (endPatternFound) {\n\t\t\t\tinsertText(selectedText);\n\t\t\t\tinput.selectionStart = selectionStart - startPattern.length;\n\t\t\t\tinput.selectionEnd = selectionEnd + endPattern.length;\n\n\t\t\t\tif (!document.execCommand?.('insertText', false, selectedText)) {\n\t\t\t\t\tinput.value = initText.slice(0, initText.length - startPattern.length) + selectedText + finalText.slice(endPattern.length);\n\t\t\t\t}\n\n\t\t\t\tinput.selectionStart = selectionStart - startPattern.length;\n\t\t\t\tinput.selectionEnd = input.selectionStart + selectedText.length;\n\t\t\t\ttriggerEvent(input, 'input');\n\t\t\t\ttriggerEvent(input, 'change');\n\n\t\t\t\tfocus();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (!document.execCommand?.('insertText', false, pattern.replace('{{text}}', selectedText))) {\n\t\t\tinput.value = initText + pattern.replace('{{text}}', selectedText) + finalText;\n\t\t}\n\n\t\tinput.selectionStart = selectionStart + pattern.indexOf('{{text}}');\n\t\tinput.selectionEnd = input.selectionStart + selectedText.length;\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\tfocus();\n\t};\n\n\tconst insertNewLine = (): void => insertText('\\n');\n\n\tsetText(Accounts.storageLocation.getItem(storageID) ?? '', {\n\t\tskipFocus: true,\n\t});\n\n\t// Gets the text that is connected to the cursor and replaces it with the given text\n\tconst replaceText = (text: string, selection: { readonly start: number; readonly end: number }): void => {\n\t\tconst { selectionStart, selectionEnd } = input;\n\n\t\t// Selects the text that is connected to the cursor\n\t\tinput.setSelectionRange(selection.start ?? 0, selection.end ?? text.length);\n\t\tconst textAreaTxt = input.value;\n\n\t\tif (!document.execCommand?.('insertText', false, text)) {\n\t\t\tinput.value = textAreaTxt.substring(0, selection.start) + text + textAreaTxt.substring(selection.end);\n\t\t}\n\n\t\tinput.selectionStart = selectionStart + text.length;\n\t\tinput.selectionEnd = selectionStart + text.length;\n\t\tif (selectionStart !== selectionEnd) {\n\t\t\tinput.selectionStart = selectionStart;\n\t\t}\n\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\tfocus();\n\t};\n\n\treturn {\n\t\treplaceText,\n\t\tinsertNewLine,\n\t\tblur: () => input.blur(),\n\n\t\tsubstring: (start: number, end?: number) => {\n\t\t\treturn input.value.substring(start, end);\n\t\t},\n\n\t\tgetCursorPosition: () => {\n\t\t\treturn input.selectionStart;\n\t\t},\n\t\tsetCursorToEnd: () => {\n\t\t\tinput.selectionEnd = input.value.length;\n\t\t\tinput.selectionStart = input.selectionEnd;\n\t\t\tfocus();\n\t\t},\n\t\tsetCursorToStart: () => {\n\t\t\tinput.selectionStart = 0;\n\t\t\tinput.selectionEnd = input.selectionStart;\n\t\t\tfocus();\n\t\t},\n\t\trelease,\n\t\twrapSelection,\n\t\tget text(): string {\n\t\t\treturn input.value;\n\t\t},\n\t\tget selection(): { start: number; end: number } {\n\t\t\treturn {\n\t\t\t\tstart: input.selectionStart,\n\t\t\t\tend: input.selectionEnd,\n\t\t\t};\n\t\t},\n\n\t\tediting,\n\t\tsetEditingMode,\n\t\trecording,\n\t\tsetRecordingMode,\n\t\trecordingVideo,\n\t\tsetRecordingVideo,\n\t\tinsertText,\n\t\tsetText,\n\t\tclear,\n\t\tfocus,\n\t\treplyWith,\n\t\tquoteMessage,\n\t\tdismissQuotedMessage,\n\t\tdismissAllQuotedMessages,\n\t\tquotedMessages,\n\t\tformatters,\n\t\tisMicrophoneDenied,\n\t\tsetIsMicrophoneDenied,\n\t};\n};\n"]}}},"code":"module.export({\n  createComposerAPI: () => createComposerAPI\n});\nlet Emitter;\nmodule.link(\"@rocket.chat/emitter\", {\n  Emitter(v) {\n    Emitter = v;\n  }\n}, 0);\nlet Accounts;\nmodule.link(\"meteor/accounts-base\", {\n  Accounts(v) {\n    Accounts = v;\n  }\n}, 1);\nlet withDebouncing;\nmodule.link(\"../../../../lib/utils/highOrderFunctions\", {\n  withDebouncing(v) {\n    withDebouncing = v;\n  }\n}, 2);\nlet formattingButtons;\nmodule.link(\"./messageBoxFormatting\", {\n  formattingButtons(v) {\n    formattingButtons = v;\n  }\n}, 3);\nconst createComposerAPI = (input, storageID) => {\n  var _Accounts$storageLoca;\n  const triggerEvent = (input, evt) => {\n    const event = new Event(evt, {\n      bubbles: true\n    });\n    // TODO: Remove this hack for react to trigger onChange\n    const tracker = input._valueTracker;\n    if (tracker) {\n      tracker.setValue(new Date().toString());\n    }\n    input.dispatchEvent(event);\n  };\n  const emitter = new Emitter();\n  let _quotedMessages = [];\n  const persist = withDebouncing({\n    wait: 300\n  })(() => {\n    if (input.value) {\n      Accounts.storageLocation.setItem(storageID, input.value);\n      return;\n    }\n    Accounts.storageLocation.removeItem(storageID);\n  });\n  const notifyQuotedMessagesUpdate = () => {\n    emitter.emit('quotedMessagesUpdate');\n  };\n  input.addEventListener('input', persist);\n  const setText = function (text) {\n    let {\n      selection,\n      skipFocus\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    !skipFocus && focus();\n    const {\n      selectionStart,\n      selectionEnd\n    } = input;\n    const textAreaTxt = input.value;\n    if (typeof selection === 'function') {\n      selection = selection({\n        start: selectionStart,\n        end: selectionEnd\n      });\n    }\n    if (selection) {\n      var _document$execCommand, _document, _selection$start, _selection$end;\n      if (!((_document$execCommand = (_document = document).execCommand) !== null && _document$execCommand !== void 0 && _document$execCommand.call(_document, 'insertText', false, text))) {\n        input.value = textAreaTxt.substring(0, selectionStart) + text + textAreaTxt.substring(selectionStart);\n        !skipFocus && focus();\n      }\n      input.setSelectionRange((_selection$start = selection.start) !== null && _selection$start !== void 0 ? _selection$start : 0, (_selection$end = selection.end) !== null && _selection$end !== void 0 ? _selection$end : text.length);\n    }\n    if (!selection) {\n      input.value = text;\n    }\n    triggerEvent(input, 'input');\n    triggerEvent(input, 'change');\n    !skipFocus && focus();\n  };\n  const insertText = text => {\n    setText(text, {\n      selection: _ref => {\n        let {\n          start,\n          end\n        } = _ref;\n        return {\n          start: start + text.length,\n          end: end + text.length\n        };\n      }\n    });\n  };\n  const clear = () => {\n    setText('');\n  };\n  const focus = () => {\n    input.focus();\n  };\n  const replyWith = async text => {\n    if (input) {\n      input.value = text;\n      input.focus();\n    }\n  };\n  const quoteMessage = async message => {\n    _quotedMessages = [..._quotedMessages.filter(_message => _message._id !== message._id), message];\n    notifyQuotedMessagesUpdate();\n    input.focus();\n  };\n  const dismissQuotedMessage = async mid => {\n    _quotedMessages = _quotedMessages.filter(message => message._id !== mid);\n    notifyQuotedMessagesUpdate();\n  };\n  const dismissAllQuotedMessages = async () => {\n    _quotedMessages = [];\n    notifyQuotedMessagesUpdate();\n  };\n  const quotedMessages = {\n    get: () => _quotedMessages,\n    subscribe: callback => emitter.on('quotedMessagesUpdate', callback)\n  };\n  const [editing, setEditing] = (() => {\n    let editing = false;\n    return [{\n      get: () => editing,\n      subscribe: callback => emitter.on('editing', callback)\n    }, value => {\n      editing = value;\n      emitter.emit('editing');\n    }];\n  })();\n  const [recording, setRecordingMode] = (() => {\n    let recording = false;\n    return [{\n      get: () => recording,\n      subscribe: callback => emitter.on('recording', callback)\n    }, value => {\n      recording = value;\n      emitter.emit('recording');\n    }];\n  })();\n  const [recordingVideo, setRecordingVideo] = (() => {\n    let recordingVideo = false;\n    return [{\n      get: () => recordingVideo,\n      subscribe: callback => emitter.on('recordingVideo', callback)\n    }, value => {\n      recordingVideo = value;\n      emitter.emit('recordingVideo');\n    }];\n  })();\n  const [isMicrophoneDenied, setIsMicrophoneDenied] = (() => {\n    let isMicrophoneDenied = false;\n    return [{\n      get: () => isMicrophoneDenied,\n      subscribe: callback => emitter.on('mircophoneDenied', callback)\n    }, value => {\n      isMicrophoneDenied = value;\n      emitter.emit('mircophoneDenied');\n    }];\n  })();\n  const setEditingMode = editing => {\n    setEditing(editing);\n  };\n  const [formatters, stopFormatterTracker] = (() => {\n    let actions = [];\n    const c = Tracker.autorun(() => {\n      actions = formattingButtons.filter(_ref2 => {\n        let {\n          condition\n        } = _ref2;\n        return !condition || condition();\n      });\n      emitter.emit('formatting');\n    });\n    return [{\n      get: () => actions,\n      subscribe: callback => emitter.on('formatting', callback)\n    }, c];\n  })();\n  const release = () => {\n    input.removeEventListener('input', persist);\n    stopFormatterTracker.stop();\n  };\n  const wrapSelection = pattern => {\n    var _document$execCommand3, _document3;\n    const {\n      selectionEnd = input.value.length,\n      selectionStart = 0\n    } = input;\n    const initText = input.value.slice(0, selectionStart);\n    const selectedText = input.value.slice(selectionStart, selectionEnd);\n    const finalText = input.value.slice(selectionEnd, input.value.length);\n    focus();\n    const startPattern = pattern.slice(0, pattern.indexOf('{{text}}'));\n    const startPatternFound = [...startPattern].reverse().every((char, index) => input.value.slice(selectionStart - index - 1, 1) === char);\n    if (startPatternFound) {\n      const endPattern = pattern.slice(pattern.indexOf('{{text}}') + '{{text}}'.length);\n      const endPatternFound = [...endPattern].every((char, index) => input.value.slice(selectionEnd + index, 1) === char);\n      if (endPatternFound) {\n        var _document$execCommand2, _document2;\n        insertText(selectedText);\n        input.selectionStart = selectionStart - startPattern.length;\n        input.selectionEnd = selectionEnd + endPattern.length;\n        if (!((_document$execCommand2 = (_document2 = document).execCommand) !== null && _document$execCommand2 !== void 0 && _document$execCommand2.call(_document2, 'insertText', false, selectedText))) {\n          input.value = initText.slice(0, initText.length - startPattern.length) + selectedText + finalText.slice(endPattern.length);\n        }\n        input.selectionStart = selectionStart - startPattern.length;\n        input.selectionEnd = input.selectionStart + selectedText.length;\n        triggerEvent(input, 'input');\n        triggerEvent(input, 'change');\n        focus();\n        return;\n      }\n    }\n    if (!((_document$execCommand3 = (_document3 = document).execCommand) !== null && _document$execCommand3 !== void 0 && _document$execCommand3.call(_document3, 'insertText', false, pattern.replace('{{text}}', selectedText)))) {\n      input.value = initText + pattern.replace('{{text}}', selectedText) + finalText;\n    }\n    input.selectionStart = selectionStart + pattern.indexOf('{{text}}');\n    input.selectionEnd = input.selectionStart + selectedText.length;\n    triggerEvent(input, 'input');\n    triggerEvent(input, 'change');\n    focus();\n  };\n  const insertNewLine = () => insertText('\\n');\n  setText((_Accounts$storageLoca = Accounts.storageLocation.getItem(storageID)) !== null && _Accounts$storageLoca !== void 0 ? _Accounts$storageLoca : '', {\n    skipFocus: true\n  });\n  // Gets the text that is connected to the cursor and replaces it with the given text\n  const replaceText = (text, selection) => {\n    var _selection$start2, _selection$end2, _document$execCommand4, _document4;\n    const {\n      selectionStart,\n      selectionEnd\n    } = input;\n    // Selects the text that is connected to the cursor\n    input.setSelectionRange((_selection$start2 = selection.start) !== null && _selection$start2 !== void 0 ? _selection$start2 : 0, (_selection$end2 = selection.end) !== null && _selection$end2 !== void 0 ? _selection$end2 : text.length);\n    const textAreaTxt = input.value;\n    if (!((_document$execCommand4 = (_document4 = document).execCommand) !== null && _document$execCommand4 !== void 0 && _document$execCommand4.call(_document4, 'insertText', false, text))) {\n      input.value = textAreaTxt.substring(0, selection.start) + text + textAreaTxt.substring(selection.end);\n    }\n    input.selectionStart = selectionStart + text.length;\n    input.selectionEnd = selectionStart + text.length;\n    if (selectionStart !== selectionEnd) {\n      input.selectionStart = selectionStart;\n    }\n    triggerEvent(input, 'input');\n    triggerEvent(input, 'change');\n    focus();\n  };\n  return {\n    replaceText,\n    insertNewLine,\n    blur: () => input.blur(),\n    substring: (start, end) => {\n      return input.value.substring(start, end);\n    },\n    getCursorPosition: () => {\n      return input.selectionStart;\n    },\n    setCursorToEnd: () => {\n      input.selectionEnd = input.value.length;\n      input.selectionStart = input.selectionEnd;\n      focus();\n    },\n    setCursorToStart: () => {\n      input.selectionStart = 0;\n      input.selectionEnd = input.selectionStart;\n      focus();\n    },\n    release,\n    wrapSelection,\n    get text() {\n      return input.value;\n    },\n    get selection() {\n      return {\n        start: input.selectionStart,\n        end: input.selectionEnd\n      };\n    },\n    editing,\n    setEditingMode,\n    recording,\n    setRecordingMode,\n    recordingVideo,\n    setRecordingVideo,\n    insertText,\n    setText,\n    clear,\n    focus,\n    replyWith,\n    quoteMessage,\n    dismissQuotedMessage,\n    dismissAllQuotedMessages,\n    quotedMessages,\n    formatters,\n    isMicrophoneDenied,\n    setIsMicrophoneDenied\n  };\n};","map":{"version":3,"names":["module","export","createComposerAPI","Emitter","link","v","Accounts","withDebouncing","formattingButtons","input","storageID","_Accounts$storageLoca","triggerEvent","evt","event","Event","bubbles","tracker","_valueTracker","setValue","Date","toString","dispatchEvent","emitter","_quotedMessages","persist","wait","value","storageLocation","setItem","removeItem","notifyQuotedMessagesUpdate","emit","addEventListener","setText","text","selection","skipFocus","arguments","length","undefined","focus","selectionStart","selectionEnd","textAreaTxt","start","end","_document$execCommand","_document","_selection$start","_selection$end","document","execCommand","call","substring","setSelectionRange","insertText","_ref","clear","replyWith","quoteMessage","message","filter","_message","_id","dismissQuotedMessage","mid","dismissAllQuotedMessages","quotedMessages","get","subscribe","callback","on","editing","setEditing","recording","setRecordingMode","recordingVideo","setRecordingVideo","isMicrophoneDenied","setIsMicrophoneDenied","setEditingMode","formatters","stopFormatterTracker","actions","c","Tracker","autorun","_ref2","condition","release","removeEventListener","stop","wrapSelection","pattern","_document$execCommand3","_document3","initText","slice","selectedText","finalText","startPattern","indexOf","startPatternFound","reverse","every","char","index","endPattern","endPatternFound","_document$execCommand2","_document2","replace","insertNewLine","getItem","replaceText","_selection$start2","_selection$end2","_document$execCommand4","_document4","blur","getCursorPosition","setCursorToEnd","setCursorToStart"],"sources":["app/ui-message/client/messageBox/createComposerAPI.ts"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport { Accounts } from 'meteor/accounts-base';\n\nimport type { ComposerAPI } from '../../../../client/lib/chats/ChatAPI';\nimport { withDebouncing } from '../../../../lib/utils/highOrderFunctions';\nimport type { FormattingButton } from './messageBoxFormatting';\nimport { formattingButtons } from './messageBoxFormatting';\n\nexport const createComposerAPI = (input: HTMLTextAreaElement, storageID: string): ComposerAPI => {\n\tconst triggerEvent = (input: HTMLTextAreaElement, evt: string): void => {\n\t\tconst event = new Event(evt, { bubbles: true });\n\t\t// TODO: Remove this hack for react to trigger onChange\n\t\tconst tracker = (input as any)._valueTracker;\n\t\tif (tracker) {\n\t\t\ttracker.setValue(new Date().toString());\n\t\t}\n\t\tinput.dispatchEvent(event);\n\t};\n\n\tconst emitter = new Emitter<{\n\t\tquotedMessagesUpdate: void;\n\t\tediting: void;\n\t\trecording: void;\n\t\trecordingVideo: void;\n\t\tformatting: void;\n\t\tmircophoneDenied: void;\n\t}>();\n\n\tlet _quotedMessages: IMessage[] = [];\n\n\tconst persist = withDebouncing({ wait: 300 })(() => {\n\t\tif (input.value) {\n\t\t\tAccounts.storageLocation.setItem(storageID, input.value);\n\t\t\treturn;\n\t\t}\n\n\t\tAccounts.storageLocation.removeItem(storageID);\n\t});\n\n\tconst notifyQuotedMessagesUpdate = (): void => {\n\t\temitter.emit('quotedMessagesUpdate');\n\t};\n\n\tinput.addEventListener('input', persist);\n\n\tconst setText = (\n\t\ttext: string,\n\t\t{\n\t\t\tselection,\n\t\t\tskipFocus,\n\t\t}: {\n\t\t\tselection?:\n\t\t\t\t| { readonly start?: number; readonly end?: number }\n\t\t\t\t| ((previous: { readonly start: number; readonly end: number }) => { readonly start?: number; readonly end?: number });\n\t\t\tskipFocus?: boolean;\n\t\t} = {},\n\t): void => {\n\t\t!skipFocus && focus();\n\n\t\tconst { selectionStart, selectionEnd } = input;\n\t\tconst textAreaTxt = input.value;\n\n\t\tif (typeof selection === 'function') {\n\t\t\tselection = selection({ start: selectionStart, end: selectionEnd });\n\t\t}\n\n\t\tif (selection) {\n\t\t\tif (!document.execCommand?.('insertText', false, text)) {\n\t\t\t\tinput.value = textAreaTxt.substring(0, selectionStart) + text + textAreaTxt.substring(selectionStart);\n\t\t\t\t!skipFocus && focus();\n\t\t\t}\n\t\t\tinput.setSelectionRange(selection.start ?? 0, selection.end ?? text.length);\n\t\t}\n\n\t\tif (!selection) {\n\t\t\tinput.value = text;\n\t\t}\n\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\t!skipFocus && focus();\n\t};\n\n\tconst insertText = (text: string): void => {\n\t\tsetText(text, {\n\t\t\tselection: ({ start, end }) => ({\n\t\t\t\tstart: start + text.length,\n\t\t\t\tend: end + text.length,\n\t\t\t}),\n\t\t});\n\t};\n\n\tconst clear = (): void => {\n\t\tsetText('');\n\t};\n\n\tconst focus = (): void => {\n\t\tinput.focus();\n\t};\n\n\tconst replyWith = async (text: string): Promise<void> => {\n\t\tif (input) {\n\t\t\tinput.value = text;\n\t\t\tinput.focus();\n\t\t}\n\t};\n\n\tconst quoteMessage = async (message: IMessage): Promise<void> => {\n\t\t_quotedMessages = [..._quotedMessages.filter((_message) => _message._id !== message._id), message];\n\t\tnotifyQuotedMessagesUpdate();\n\t\tinput.focus();\n\t};\n\n\tconst dismissQuotedMessage = async (mid: IMessage['_id']): Promise<void> => {\n\t\t_quotedMessages = _quotedMessages.filter((message) => message._id !== mid);\n\t\tnotifyQuotedMessagesUpdate();\n\t};\n\n\tconst dismissAllQuotedMessages = async (): Promise<void> => {\n\t\t_quotedMessages = [];\n\t\tnotifyQuotedMessagesUpdate();\n\t};\n\n\tconst quotedMessages = {\n\t\tget: () => _quotedMessages,\n\t\tsubscribe: (callback: () => void) => emitter.on('quotedMessagesUpdate', callback),\n\t};\n\n\tconst [editing, setEditing] = (() => {\n\t\tlet editing = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => editing,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('editing', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\tediting = value;\n\t\t\t\temitter.emit('editing');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [recording, setRecordingMode] = (() => {\n\t\tlet recording = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => recording,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('recording', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\trecording = value;\n\t\t\t\temitter.emit('recording');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [recordingVideo, setRecordingVideo] = (() => {\n\t\tlet recordingVideo = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => recordingVideo,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('recordingVideo', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\trecordingVideo = value;\n\t\t\t\temitter.emit('recordingVideo');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [isMicrophoneDenied, setIsMicrophoneDenied] = (() => {\n\t\tlet isMicrophoneDenied = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => isMicrophoneDenied,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('mircophoneDenied', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\tisMicrophoneDenied = value;\n\t\t\t\temitter.emit('mircophoneDenied');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst setEditingMode = (editing: boolean): void => {\n\t\tsetEditing(editing);\n\t};\n\n\tconst [formatters, stopFormatterTracker] = (() => {\n\t\tlet actions: FormattingButton[] = [];\n\n\t\tconst c = Tracker.autorun(() => {\n\t\t\tactions = formattingButtons.filter(({ condition }) => !condition || condition());\n\t\t\temitter.emit('formatting');\n\t\t});\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => actions,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('formatting', callback),\n\t\t\t},\n\t\t\tc,\n\t\t];\n\t})();\n\n\tconst release = (): void => {\n\t\tinput.removeEventListener('input', persist);\n\t\tstopFormatterTracker.stop();\n\t};\n\n\tconst wrapSelection = (pattern: string): void => {\n\t\tconst { selectionEnd = input.value.length, selectionStart = 0 } = input;\n\t\tconst initText = input.value.slice(0, selectionStart);\n\t\tconst selectedText = input.value.slice(selectionStart, selectionEnd);\n\t\tconst finalText = input.value.slice(selectionEnd, input.value.length);\n\n\t\tfocus();\n\n\t\tconst startPattern = pattern.slice(0, pattern.indexOf('{{text}}'));\n\t\tconst startPatternFound = [...startPattern].reverse().every((char, index) => input.value.slice(selectionStart - index - 1, 1) === char);\n\n\t\tif (startPatternFound) {\n\t\t\tconst endPattern = pattern.slice(pattern.indexOf('{{text}}') + '{{text}}'.length);\n\t\t\tconst endPatternFound = [...endPattern].every((char, index) => input.value.slice(selectionEnd + index, 1) === char);\n\n\t\t\tif (endPatternFound) {\n\t\t\t\tinsertText(selectedText);\n\t\t\t\tinput.selectionStart = selectionStart - startPattern.length;\n\t\t\t\tinput.selectionEnd = selectionEnd + endPattern.length;\n\n\t\t\t\tif (!document.execCommand?.('insertText', false, selectedText)) {\n\t\t\t\t\tinput.value = initText.slice(0, initText.length - startPattern.length) + selectedText + finalText.slice(endPattern.length);\n\t\t\t\t}\n\n\t\t\t\tinput.selectionStart = selectionStart - startPattern.length;\n\t\t\t\tinput.selectionEnd = input.selectionStart + selectedText.length;\n\t\t\t\ttriggerEvent(input, 'input');\n\t\t\t\ttriggerEvent(input, 'change');\n\n\t\t\t\tfocus();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (!document.execCommand?.('insertText', false, pattern.replace('{{text}}', selectedText))) {\n\t\t\tinput.value = initText + pattern.replace('{{text}}', selectedText) + finalText;\n\t\t}\n\n\t\tinput.selectionStart = selectionStart + pattern.indexOf('{{text}}');\n\t\tinput.selectionEnd = input.selectionStart + selectedText.length;\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\tfocus();\n\t};\n\n\tconst insertNewLine = (): void => insertText('\\n');\n\n\tsetText(Accounts.storageLocation.getItem(storageID) ?? '', {\n\t\tskipFocus: true,\n\t});\n\n\t// Gets the text that is connected to the cursor and replaces it with the given text\n\tconst replaceText = (text: string, selection: { readonly start: number; readonly end: number }): void => {\n\t\tconst { selectionStart, selectionEnd } = input;\n\n\t\t// Selects the text that is connected to the cursor\n\t\tinput.setSelectionRange(selection.start ?? 0, selection.end ?? text.length);\n\t\tconst textAreaTxt = input.value;\n\n\t\tif (!document.execCommand?.('insertText', false, text)) {\n\t\t\tinput.value = textAreaTxt.substring(0, selection.start) + text + textAreaTxt.substring(selection.end);\n\t\t}\n\n\t\tinput.selectionStart = selectionStart + text.length;\n\t\tinput.selectionEnd = selectionStart + text.length;\n\t\tif (selectionStart !== selectionEnd) {\n\t\t\tinput.selectionStart = selectionStart;\n\t\t}\n\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\tfocus();\n\t};\n\n\treturn {\n\t\treplaceText,\n\t\tinsertNewLine,\n\t\tblur: () => input.blur(),\n\n\t\tsubstring: (start: number, end?: number) => {\n\t\t\treturn input.value.substring(start, end);\n\t\t},\n\n\t\tgetCursorPosition: () => {\n\t\t\treturn input.selectionStart;\n\t\t},\n\t\tsetCursorToEnd: () => {\n\t\t\tinput.selectionEnd = input.value.length;\n\t\t\tinput.selectionStart = input.selectionEnd;\n\t\t\tfocus();\n\t\t},\n\t\tsetCursorToStart: () => {\n\t\t\tinput.selectionStart = 0;\n\t\t\tinput.selectionEnd = input.selectionStart;\n\t\t\tfocus();\n\t\t},\n\t\trelease,\n\t\twrapSelection,\n\t\tget text(): string {\n\t\t\treturn input.value;\n\t\t},\n\t\tget selection(): { start: number; end: number } {\n\t\t\treturn {\n\t\t\t\tstart: input.selectionStart,\n\t\t\t\tend: input.selectionEnd,\n\t\t\t};\n\t\t},\n\n\t\tediting,\n\t\tsetEditingMode,\n\t\trecording,\n\t\tsetRecordingMode,\n\t\trecordingVideo,\n\t\tsetRecordingVideo,\n\t\tinsertText,\n\t\tsetText,\n\t\tclear,\n\t\tfocus,\n\t\treplyWith,\n\t\tquoteMessage,\n\t\tdismissQuotedMessage,\n\t\tdismissAllQuotedMessages,\n\t\tquotedMessages,\n\t\tformatters,\n\t\tisMicrophoneDenied,\n\t\tsetIsMicrophoneDenied,\n\t};\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"f23a80c95e9bf65f849448a1320333928d471db6"}
