{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/Room.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"server/services/federation/infrastructure/matrix/handlers/Room.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/Room.ts","inputSourceMap":{"version":3,"file":"server/services/federation/infrastructure/matrix/handlers/Room.ts","sourceRoot":"","sources":["server/services/federation/infrastructure/matrix/handlers/Room.ts"],"names":[],"mappings":"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","sourcesContent":["import { MatrixBaseEventHandler } from './BaseEvent';\nimport type { FederationRoomServiceReceiver } from '../../../application/room/receiver/RoomServiceReceiver';\nimport type { RocketChatSettingsAdapter } from '../../rocket-chat/adapters/Settings';\nimport { MatrixRoomReceiverConverter } from '../converters/room/RoomReceiver';\nimport { MatrixEventType } from '../definitions/MatrixEventType';\nimport type { MatrixEventRoomCreated } from '../definitions/events/RoomCreated';\nimport type { MatrixEventRoomRedacted } from '../definitions/events/RoomEventRedacted';\nimport type { MatrixEventRoomJoinRulesChanged } from '../definitions/events/RoomJoinRulesChanged';\nimport type { MatrixEventRoomMembershipChanged } from '../definitions/events/RoomMembershipChanged';\nimport type { IMatrixEventContentRoomMessageSent, MatrixEventRoomMessageSent } from '../definitions/events/RoomMessageSent';\nimport { MatrixEnumRelatesToRelType, MatrixEnumSendMessageType } from '../definitions/events/RoomMessageSent';\nimport type { MatrixEventRoomNameChanged } from '../definitions/events/RoomNameChanged';\nimport type { MatrixEventRoomRoomPowerLevelsChanged } from '../definitions/events/RoomPowerLevelsChanged';\nimport type { MatrixEventRoomTopicChanged } from '../definitions/events/RoomTopicChanged';\n\nexport class MatrixRoomCreatedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_CREATED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomCreated): Promise<void> {\n\t\tawait this.roomService.onCreateRoom(MatrixRoomReceiverConverter.toRoomCreateDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomMembershipChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_MEMBERSHIP_CHANGED;\n\n\tconstructor(\n\t\tprivate roomService: FederationRoomServiceReceiver,\n\t\tprivate rocketSettingsAdapter: RocketChatSettingsAdapter,\n\t) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomMembershipChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomMembership(\n\t\t\tMatrixRoomReceiverConverter.toChangeRoomMembershipDto(externalEvent, this.rocketSettingsAdapter.getHomeServerDomain()),\n\t\t);\n\t}\n}\n\nexport class MatrixRoomMessageSentHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_MESSAGE_SENT;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tprivate executeTextMessageHandler(eventContent: IMatrixEventContentRoomMessageSent, externalEvent: MatrixEventRoomMessageSent): any {\n\t\tconst isAnEditionEvent =\n\t\t\teventContent['m.new_content'] &&\n\t\t\teventContent['m.relates_to'] &&\n\t\t\teventContent['m.relates_to'].rel_type === MatrixEnumRelatesToRelType.REPLACE;\n\t\treturn isAnEditionEvent\n\t\t\t? this.roomService.onExternalMessageEditedReceived(MatrixRoomReceiverConverter.toEditRoomMessageDto(externalEvent))\n\t\t\t: this.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\t}\n\n\tprivate executeThreadedTextMessageHandler(\n\t\teventContent: IMatrixEventContentRoomMessageSent,\n\t\texternalEvent: MatrixEventRoomMessageSent,\n\t): any {\n\t\tconst isAnEditionEvent =\n\t\t\teventContent['m.new_content'] &&\n\t\t\teventContent['m.relates_to'] &&\n\t\t\teventContent['m.relates_to'].rel_type === MatrixEnumRelatesToRelType.REPLACE;\n\t\treturn isAnEditionEvent\n\t\t\t? this.roomService.onExternalMessageEditedReceived(MatrixRoomReceiverConverter.toEditRoomMessageDto(externalEvent))\n\t\t\t: this.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomMessageSent): Promise<void> {\n\t\tconst handlers = {\n\t\t\t[MatrixEnumSendMessageType.TEXT]: () => this.executeTextMessageHandler(externalEvent.content, externalEvent),\n\t\t\t[MatrixEnumSendMessageType.AUDIO]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.FILE]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.IMAGE]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.NOTICE]: () =>\n\t\t\t\tthis.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.VIDEO]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.EMOTE]: () =>\n\t\t\t\tthis.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.LOCATION]: () => {\n\t\t\t\tthrow new Error('Location events are not supported yet');\n\t\t\t},\n\t\t};\n\n\t\tconst threadHandlers = {\n\t\t\t[MatrixEnumSendMessageType.TEXT]: () => this.executeThreadedTextMessageHandler(externalEvent.content, externalEvent),\n\t\t\t[MatrixEnumSendMessageType.AUDIO]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.FILE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.IMAGE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.NOTICE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.VIDEO]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.EMOTE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.LOCATION]: () => {\n\t\t\t\tthrow new Error('Location events are not supported yet');\n\t\t\t},\n\t\t};\n\n\t\tconst defaultHandler = () =>\n\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\t\tconst threadedDefaultHandler = () =>\n\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\n\t\tconst isThreadedMessage = Boolean(externalEvent.content?.['m.relates_to']?.rel_type === MatrixEventType.MESSAGE_ON_THREAD);\n\t\tif (isThreadedMessage) {\n\t\t\treturn (threadHandlers[externalEvent.content.msgtype as MatrixEnumSendMessageType] || threadedDefaultHandler)();\n\t\t}\n\t\tawait (handlers[externalEvent.content.msgtype as MatrixEnumSendMessageType] || defaultHandler)();\n\t}\n}\n\nexport class MatrixRoomJoinRulesChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_JOIN_RULES_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomJoinRulesChanged): Promise<void> {\n\t\tawait this.roomService.onChangeJoinRules(MatrixRoomReceiverConverter.toRoomChangeJoinRulesDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomNameChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_NAME_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomNameChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomName(MatrixRoomReceiverConverter.toRoomChangeNameDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomTopicChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_TOPIC_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomTopicChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomTopic(MatrixRoomReceiverConverter.toRoomChangeTopicDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomEventRedactedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_EVENT_REDACTED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomRedacted): Promise<void> {\n\t\tawait this.roomService.onRedactEvent(MatrixRoomReceiverConverter.toRoomRedactEventDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomPowerLevelsChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_POWER_LEVELS_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomRoomPowerLevelsChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomPowerLevels(MatrixRoomReceiverConverter.toRoomChangePowerLevelsEventDto(externalEvent));\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/matrix/handlers/Room.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"server/services/federation/infrastructure/matrix/handlers/Room.ts","inputSourceMap":{"version":3,"file":"server/services/federation/infrastructure/matrix/handlers/Room.ts","sourceRoot":"","sources":["server/services/federation/infrastructure/matrix/handlers/Room.ts"],"names":[],"mappings":"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","sourcesContent":["import { MatrixBaseEventHandler } from './BaseEvent';\nimport type { FederationRoomServiceReceiver } from '../../../application/room/receiver/RoomServiceReceiver';\nimport type { RocketChatSettingsAdapter } from '../../rocket-chat/adapters/Settings';\nimport { MatrixRoomReceiverConverter } from '../converters/room/RoomReceiver';\nimport { MatrixEventType } from '../definitions/MatrixEventType';\nimport type { MatrixEventRoomCreated } from '../definitions/events/RoomCreated';\nimport type { MatrixEventRoomRedacted } from '../definitions/events/RoomEventRedacted';\nimport type { MatrixEventRoomJoinRulesChanged } from '../definitions/events/RoomJoinRulesChanged';\nimport type { MatrixEventRoomMembershipChanged } from '../definitions/events/RoomMembershipChanged';\nimport type { IMatrixEventContentRoomMessageSent, MatrixEventRoomMessageSent } from '../definitions/events/RoomMessageSent';\nimport { MatrixEnumRelatesToRelType, MatrixEnumSendMessageType } from '../definitions/events/RoomMessageSent';\nimport type { MatrixEventRoomNameChanged } from '../definitions/events/RoomNameChanged';\nimport type { MatrixEventRoomRoomPowerLevelsChanged } from '../definitions/events/RoomPowerLevelsChanged';\nimport type { MatrixEventRoomTopicChanged } from '../definitions/events/RoomTopicChanged';\n\nexport class MatrixRoomCreatedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_CREATED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomCreated): Promise<void> {\n\t\tawait this.roomService.onCreateRoom(MatrixRoomReceiverConverter.toRoomCreateDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomMembershipChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_MEMBERSHIP_CHANGED;\n\n\tconstructor(\n\t\tprivate roomService: FederationRoomServiceReceiver,\n\t\tprivate rocketSettingsAdapter: RocketChatSettingsAdapter,\n\t) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomMembershipChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomMembership(\n\t\t\tMatrixRoomReceiverConverter.toChangeRoomMembershipDto(externalEvent, this.rocketSettingsAdapter.getHomeServerDomain()),\n\t\t);\n\t}\n}\n\nexport class MatrixRoomMessageSentHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_MESSAGE_SENT;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tprivate executeTextMessageHandler(eventContent: IMatrixEventContentRoomMessageSent, externalEvent: MatrixEventRoomMessageSent): any {\n\t\tconst isAnEditionEvent =\n\t\t\teventContent['m.new_content'] &&\n\t\t\teventContent['m.relates_to'] &&\n\t\t\teventContent['m.relates_to'].rel_type === MatrixEnumRelatesToRelType.REPLACE;\n\t\treturn isAnEditionEvent\n\t\t\t? this.roomService.onExternalMessageEditedReceived(MatrixRoomReceiverConverter.toEditRoomMessageDto(externalEvent))\n\t\t\t: this.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\t}\n\n\tprivate executeThreadedTextMessageHandler(\n\t\teventContent: IMatrixEventContentRoomMessageSent,\n\t\texternalEvent: MatrixEventRoomMessageSent,\n\t): any {\n\t\tconst isAnEditionEvent =\n\t\t\teventContent['m.new_content'] &&\n\t\t\teventContent['m.relates_to'] &&\n\t\t\teventContent['m.relates_to'].rel_type === MatrixEnumRelatesToRelType.REPLACE;\n\t\treturn isAnEditionEvent\n\t\t\t? this.roomService.onExternalMessageEditedReceived(MatrixRoomReceiverConverter.toEditRoomMessageDto(externalEvent))\n\t\t\t: this.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomMessageSent): Promise<void> {\n\t\tconst handlers = {\n\t\t\t[MatrixEnumSendMessageType.TEXT]: () => this.executeTextMessageHandler(externalEvent.content, externalEvent),\n\t\t\t[MatrixEnumSendMessageType.AUDIO]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.FILE]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.IMAGE]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.NOTICE]: () =>\n\t\t\t\tthis.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.VIDEO]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.EMOTE]: () =>\n\t\t\t\tthis.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.LOCATION]: () => {\n\t\t\t\tthrow new Error('Location events are not supported yet');\n\t\t\t},\n\t\t};\n\n\t\tconst threadHandlers = {\n\t\t\t[MatrixEnumSendMessageType.TEXT]: () => this.executeThreadedTextMessageHandler(externalEvent.content, externalEvent),\n\t\t\t[MatrixEnumSendMessageType.AUDIO]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.FILE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.IMAGE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.NOTICE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.VIDEO]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.EMOTE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.LOCATION]: () => {\n\t\t\t\tthrow new Error('Location events are not supported yet');\n\t\t\t},\n\t\t};\n\n\t\tconst defaultHandler = () =>\n\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\t\tconst threadedDefaultHandler = () =>\n\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\n\t\tconst isThreadedMessage = Boolean(externalEvent.content?.['m.relates_to']?.rel_type === MatrixEventType.MESSAGE_ON_THREAD);\n\t\tif (isThreadedMessage) {\n\t\t\treturn (threadHandlers[externalEvent.content.msgtype as MatrixEnumSendMessageType] || threadedDefaultHandler)();\n\t\t}\n\t\tawait (handlers[externalEvent.content.msgtype as MatrixEnumSendMessageType] || defaultHandler)();\n\t}\n}\n\nexport class MatrixRoomJoinRulesChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_JOIN_RULES_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomJoinRulesChanged): Promise<void> {\n\t\tawait this.roomService.onChangeJoinRules(MatrixRoomReceiverConverter.toRoomChangeJoinRulesDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomNameChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_NAME_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomNameChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomName(MatrixRoomReceiverConverter.toRoomChangeNameDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomTopicChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_TOPIC_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomTopicChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomTopic(MatrixRoomReceiverConverter.toRoomChangeTopicDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomEventRedactedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_EVENT_REDACTED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomRedacted): Promise<void> {\n\t\tawait this.roomService.onRedactEvent(MatrixRoomReceiverConverter.toRoomRedactEventDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomPowerLevelsChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_POWER_LEVELS_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomRoomPowerLevelsChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomPowerLevels(MatrixRoomReceiverConverter.toRoomChangePowerLevelsEventDto(externalEvent));\n\t}\n}\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    module.export({\n      MatrixRoomCreatedHandler: () => MatrixRoomCreatedHandler,\n      MatrixRoomMembershipChangedHandler: () => MatrixRoomMembershipChangedHandler,\n      MatrixRoomMessageSentHandler: () => MatrixRoomMessageSentHandler,\n      MatrixRoomJoinRulesChangedHandler: () => MatrixRoomJoinRulesChangedHandler,\n      MatrixRoomNameChangedHandler: () => MatrixRoomNameChangedHandler,\n      MatrixRoomTopicChangedHandler: () => MatrixRoomTopicChangedHandler,\n      MatrixRoomEventRedactedHandler: () => MatrixRoomEventRedactedHandler,\n      MatrixRoomPowerLevelsChangedHandler: () => MatrixRoomPowerLevelsChangedHandler\n    });\n    let MatrixBaseEventHandler;\n    module.link(\"./BaseEvent\", {\n      MatrixBaseEventHandler(v) {\n        MatrixBaseEventHandler = v;\n      }\n    }, 0);\n    let MatrixRoomReceiverConverter;\n    module.link(\"../converters/room/RoomReceiver\", {\n      MatrixRoomReceiverConverter(v) {\n        MatrixRoomReceiverConverter = v;\n      }\n    }, 1);\n    let MatrixEventType;\n    module.link(\"../definitions/MatrixEventType\", {\n      MatrixEventType(v) {\n        MatrixEventType = v;\n      }\n    }, 2);\n    let MatrixEnumRelatesToRelType, MatrixEnumSendMessageType;\n    module.link(\"../definitions/events/RoomMessageSent\", {\n      MatrixEnumRelatesToRelType(v) {\n        MatrixEnumRelatesToRelType = v;\n      },\n      MatrixEnumSendMessageType(v) {\n        MatrixEnumSendMessageType = v;\n      }\n    }, 3);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    class MatrixRoomCreatedHandler extends MatrixBaseEventHandler {\n      constructor(roomService) {\n        super();\n        this.roomService = void 0;\n        this.eventType = MatrixEventType.ROOM_CREATED;\n        this.roomService = roomService;\n      }\n      async handle(externalEvent) {\n        await this.roomService.onCreateRoom(MatrixRoomReceiverConverter.toRoomCreateDto(externalEvent));\n      }\n    }\n    class MatrixRoomMembershipChangedHandler extends MatrixBaseEventHandler {\n      constructor(roomService, rocketSettingsAdapter) {\n        super();\n        this.roomService = void 0;\n        this.rocketSettingsAdapter = void 0;\n        this.eventType = MatrixEventType.ROOM_MEMBERSHIP_CHANGED;\n        this.roomService = roomService;\n        this.rocketSettingsAdapter = rocketSettingsAdapter;\n      }\n      async handle(externalEvent) {\n        await this.roomService.onChangeRoomMembership(MatrixRoomReceiverConverter.toChangeRoomMembershipDto(externalEvent, this.rocketSettingsAdapter.getHomeServerDomain()));\n      }\n    }\n    class MatrixRoomMessageSentHandler extends MatrixBaseEventHandler {\n      constructor(roomService) {\n        super();\n        this.roomService = void 0;\n        this.eventType = MatrixEventType.ROOM_MESSAGE_SENT;\n        this.roomService = roomService;\n      }\n      executeTextMessageHandler(eventContent, externalEvent) {\n        const isAnEditionEvent = eventContent['m.new_content'] && eventContent['m.relates_to'] && eventContent['m.relates_to'].rel_type === MatrixEnumRelatesToRelType.REPLACE;\n        return isAnEditionEvent ? this.roomService.onExternalMessageEditedReceived(MatrixRoomReceiverConverter.toEditRoomMessageDto(externalEvent)) : this.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n      }\n      executeThreadedTextMessageHandler(eventContent, externalEvent) {\n        const isAnEditionEvent = eventContent['m.new_content'] && eventContent['m.relates_to'] && eventContent['m.relates_to'].rel_type === MatrixEnumRelatesToRelType.REPLACE;\n        return isAnEditionEvent ? this.roomService.onExternalMessageEditedReceived(MatrixRoomReceiverConverter.toEditRoomMessageDto(externalEvent)) : this.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n      }\n      async handle(externalEvent) {\n        var _externalEvent$conten, _externalEvent$conten2;\n        const handlers = {\n          [MatrixEnumSendMessageType.TEXT]: () => this.executeTextMessageHandler(externalEvent.content, externalEvent),\n          [MatrixEnumSendMessageType.AUDIO]: () => this.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n          [MatrixEnumSendMessageType.FILE]: () => this.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n          [MatrixEnumSendMessageType.IMAGE]: () => this.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n          [MatrixEnumSendMessageType.NOTICE]: () => this.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n          [MatrixEnumSendMessageType.VIDEO]: () => this.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n          [MatrixEnumSendMessageType.EMOTE]: () => this.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n          [MatrixEnumSendMessageType.LOCATION]: () => {\n            throw new Error('Location events are not supported yet');\n          }\n        };\n        const threadHandlers = {\n          [MatrixEnumSendMessageType.TEXT]: () => this.executeThreadedTextMessageHandler(externalEvent.content, externalEvent),\n          [MatrixEnumSendMessageType.AUDIO]: () => this.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n          [MatrixEnumSendMessageType.FILE]: () => this.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n          [MatrixEnumSendMessageType.IMAGE]: () => this.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n          [MatrixEnumSendMessageType.NOTICE]: () => this.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n          [MatrixEnumSendMessageType.VIDEO]: () => this.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n          [MatrixEnumSendMessageType.EMOTE]: () => this.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n          [MatrixEnumSendMessageType.LOCATION]: () => {\n            throw new Error('Location events are not supported yet');\n          }\n        };\n        const defaultHandler = () => this.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n        const threadedDefaultHandler = () => this.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n        const isThreadedMessage = Boolean(((_externalEvent$conten = externalEvent.content) === null || _externalEvent$conten === void 0 ? void 0 : (_externalEvent$conten2 = _externalEvent$conten['m.relates_to']) === null || _externalEvent$conten2 === void 0 ? void 0 : _externalEvent$conten2.rel_type) === MatrixEventType.MESSAGE_ON_THREAD);\n        if (isThreadedMessage) {\n          return (threadHandlers[externalEvent.content.msgtype] || threadedDefaultHandler)();\n        }\n        await (handlers[externalEvent.content.msgtype] || defaultHandler)();\n      }\n    }\n    class MatrixRoomJoinRulesChangedHandler extends MatrixBaseEventHandler {\n      constructor(roomService) {\n        super();\n        this.roomService = void 0;\n        this.eventType = MatrixEventType.ROOM_JOIN_RULES_CHANGED;\n        this.roomService = roomService;\n      }\n      async handle(externalEvent) {\n        await this.roomService.onChangeJoinRules(MatrixRoomReceiverConverter.toRoomChangeJoinRulesDto(externalEvent));\n      }\n    }\n    class MatrixRoomNameChangedHandler extends MatrixBaseEventHandler {\n      constructor(roomService) {\n        super();\n        this.roomService = void 0;\n        this.eventType = MatrixEventType.ROOM_NAME_CHANGED;\n        this.roomService = roomService;\n      }\n      async handle(externalEvent) {\n        await this.roomService.onChangeRoomName(MatrixRoomReceiverConverter.toRoomChangeNameDto(externalEvent));\n      }\n    }\n    class MatrixRoomTopicChangedHandler extends MatrixBaseEventHandler {\n      constructor(roomService) {\n        super();\n        this.roomService = void 0;\n        this.eventType = MatrixEventType.ROOM_TOPIC_CHANGED;\n        this.roomService = roomService;\n      }\n      async handle(externalEvent) {\n        await this.roomService.onChangeRoomTopic(MatrixRoomReceiverConverter.toRoomChangeTopicDto(externalEvent));\n      }\n    }\n    class MatrixRoomEventRedactedHandler extends MatrixBaseEventHandler {\n      constructor(roomService) {\n        super();\n        this.roomService = void 0;\n        this.eventType = MatrixEventType.ROOM_EVENT_REDACTED;\n        this.roomService = roomService;\n      }\n      async handle(externalEvent) {\n        await this.roomService.onRedactEvent(MatrixRoomReceiverConverter.toRoomRedactEventDto(externalEvent));\n      }\n    }\n    class MatrixRoomPowerLevelsChangedHandler extends MatrixBaseEventHandler {\n      constructor(roomService) {\n        super();\n        this.roomService = void 0;\n        this.eventType = MatrixEventType.ROOM_POWER_LEVELS_CHANGED;\n        this.roomService = roomService;\n      }\n      async handle(externalEvent) {\n        await this.roomService.onChangeRoomPowerLevels(MatrixRoomReceiverConverter.toRoomChangePowerLevelsEventDto(externalEvent));\n      }\n    }\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["module","export","MatrixRoomCreatedHandler","MatrixRoomMembershipChangedHandler","MatrixRoomMessageSentHandler","MatrixRoomJoinRulesChangedHandler","MatrixRoomNameChangedHandler","MatrixRoomTopicChangedHandler","MatrixRoomEventRedactedHandler","MatrixRoomPowerLevelsChangedHandler","MatrixBaseEventHandler","link","v","MatrixRoomReceiverConverter","MatrixEventType","MatrixEnumRelatesToRelType","MatrixEnumSendMessageType","__reifyWaitForDeps__","constructor","roomService","eventType","ROOM_CREATED","handle","externalEvent","onCreateRoom","toRoomCreateDto","rocketSettingsAdapter","ROOM_MEMBERSHIP_CHANGED","onChangeRoomMembership","toChangeRoomMembershipDto","getHomeServerDomain","ROOM_MESSAGE_SENT","executeTextMessageHandler","eventContent","isAnEditionEvent","rel_type","REPLACE","onExternalMessageEditedReceived","toEditRoomMessageDto","onExternalMessageReceived","toSendRoomMessageDto","executeThreadedTextMessageHandler","onExternalThreadedMessageReceived","_externalEvent$conten","_externalEvent$conten2","handlers","TEXT","content","AUDIO","onExternalFileMessageReceived","toSendRoomFileMessageDto","FILE","IMAGE","NOTICE","VIDEO","EMOTE","LOCATION","Error","threadHandlers","onExternalThreadedFileMessageReceived","defaultHandler","threadedDefaultHandler","isThreadedMessage","Boolean","MESSAGE_ON_THREAD","msgtype","ROOM_JOIN_RULES_CHANGED","onChangeJoinRules","toRoomChangeJoinRulesDto","ROOM_NAME_CHANGED","onChangeRoomName","toRoomChangeNameDto","ROOM_TOPIC_CHANGED","onChangeRoomTopic","toRoomChangeTopicDto","ROOM_EVENT_REDACTED","onRedactEvent","toRoomRedactEventDto","ROOM_POWER_LEVELS_CHANGED","onChangeRoomPowerLevels","toRoomChangePowerLevelsEventDto","__reify_async_result__","_reifyError","self","async"],"sources":["server/services/federation/infrastructure/matrix/handlers/Room.ts"],"sourcesContent":["import { MatrixBaseEventHandler } from './BaseEvent';\nimport type { FederationRoomServiceReceiver } from '../../../application/room/receiver/RoomServiceReceiver';\nimport type { RocketChatSettingsAdapter } from '../../rocket-chat/adapters/Settings';\nimport { MatrixRoomReceiverConverter } from '../converters/room/RoomReceiver';\nimport { MatrixEventType } from '../definitions/MatrixEventType';\nimport type { MatrixEventRoomCreated } from '../definitions/events/RoomCreated';\nimport type { MatrixEventRoomRedacted } from '../definitions/events/RoomEventRedacted';\nimport type { MatrixEventRoomJoinRulesChanged } from '../definitions/events/RoomJoinRulesChanged';\nimport type { MatrixEventRoomMembershipChanged } from '../definitions/events/RoomMembershipChanged';\nimport type { IMatrixEventContentRoomMessageSent, MatrixEventRoomMessageSent } from '../definitions/events/RoomMessageSent';\nimport { MatrixEnumRelatesToRelType, MatrixEnumSendMessageType } from '../definitions/events/RoomMessageSent';\nimport type { MatrixEventRoomNameChanged } from '../definitions/events/RoomNameChanged';\nimport type { MatrixEventRoomRoomPowerLevelsChanged } from '../definitions/events/RoomPowerLevelsChanged';\nimport type { MatrixEventRoomTopicChanged } from '../definitions/events/RoomTopicChanged';\n\nexport class MatrixRoomCreatedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_CREATED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomCreated): Promise<void> {\n\t\tawait this.roomService.onCreateRoom(MatrixRoomReceiverConverter.toRoomCreateDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomMembershipChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_MEMBERSHIP_CHANGED;\n\n\tconstructor(\n\t\tprivate roomService: FederationRoomServiceReceiver,\n\t\tprivate rocketSettingsAdapter: RocketChatSettingsAdapter,\n\t) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomMembershipChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomMembership(\n\t\t\tMatrixRoomReceiverConverter.toChangeRoomMembershipDto(externalEvent, this.rocketSettingsAdapter.getHomeServerDomain()),\n\t\t);\n\t}\n}\n\nexport class MatrixRoomMessageSentHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_MESSAGE_SENT;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tprivate executeTextMessageHandler(eventContent: IMatrixEventContentRoomMessageSent, externalEvent: MatrixEventRoomMessageSent): any {\n\t\tconst isAnEditionEvent =\n\t\t\teventContent['m.new_content'] &&\n\t\t\teventContent['m.relates_to'] &&\n\t\t\teventContent['m.relates_to'].rel_type === MatrixEnumRelatesToRelType.REPLACE;\n\t\treturn isAnEditionEvent\n\t\t\t? this.roomService.onExternalMessageEditedReceived(MatrixRoomReceiverConverter.toEditRoomMessageDto(externalEvent))\n\t\t\t: this.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\t}\n\n\tprivate executeThreadedTextMessageHandler(\n\t\teventContent: IMatrixEventContentRoomMessageSent,\n\t\texternalEvent: MatrixEventRoomMessageSent,\n\t): any {\n\t\tconst isAnEditionEvent =\n\t\t\teventContent['m.new_content'] &&\n\t\t\teventContent['m.relates_to'] &&\n\t\t\teventContent['m.relates_to'].rel_type === MatrixEnumRelatesToRelType.REPLACE;\n\t\treturn isAnEditionEvent\n\t\t\t? this.roomService.onExternalMessageEditedReceived(MatrixRoomReceiverConverter.toEditRoomMessageDto(externalEvent))\n\t\t\t: this.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomMessageSent): Promise<void> {\n\t\tconst handlers = {\n\t\t\t[MatrixEnumSendMessageType.TEXT]: () => this.executeTextMessageHandler(externalEvent.content, externalEvent),\n\t\t\t[MatrixEnumSendMessageType.AUDIO]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.FILE]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.IMAGE]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.NOTICE]: () =>\n\t\t\t\tthis.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.VIDEO]: () =>\n\t\t\t\tthis.roomService.onExternalFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.EMOTE]: () =>\n\t\t\t\tthis.roomService.onExternalMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.LOCATION]: () => {\n\t\t\t\tthrow new Error('Location events are not supported yet');\n\t\t\t},\n\t\t};\n\n\t\tconst threadHandlers = {\n\t\t\t[MatrixEnumSendMessageType.TEXT]: () => this.executeThreadedTextMessageHandler(externalEvent.content, externalEvent),\n\t\t\t[MatrixEnumSendMessageType.AUDIO]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.FILE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.IMAGE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.NOTICE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.VIDEO]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedFileMessageReceived(MatrixRoomReceiverConverter.toSendRoomFileMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.EMOTE]: () =>\n\t\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent)),\n\t\t\t[MatrixEnumSendMessageType.LOCATION]: () => {\n\t\t\t\tthrow new Error('Location events are not supported yet');\n\t\t\t},\n\t\t};\n\n\t\tconst defaultHandler = () =>\n\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\t\tconst threadedDefaultHandler = () =>\n\t\t\tthis.roomService.onExternalThreadedMessageReceived(MatrixRoomReceiverConverter.toSendRoomMessageDto(externalEvent));\n\n\t\tconst isThreadedMessage = Boolean(externalEvent.content?.['m.relates_to']?.rel_type === MatrixEventType.MESSAGE_ON_THREAD);\n\t\tif (isThreadedMessage) {\n\t\t\treturn (threadHandlers[externalEvent.content.msgtype as MatrixEnumSendMessageType] || threadedDefaultHandler)();\n\t\t}\n\t\tawait (handlers[externalEvent.content.msgtype as MatrixEnumSendMessageType] || defaultHandler)();\n\t}\n}\n\nexport class MatrixRoomJoinRulesChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_JOIN_RULES_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomJoinRulesChanged): Promise<void> {\n\t\tawait this.roomService.onChangeJoinRules(MatrixRoomReceiverConverter.toRoomChangeJoinRulesDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomNameChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_NAME_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomNameChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomName(MatrixRoomReceiverConverter.toRoomChangeNameDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomTopicChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_TOPIC_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomTopicChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomTopic(MatrixRoomReceiverConverter.toRoomChangeTopicDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomEventRedactedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_EVENT_REDACTED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomRedacted): Promise<void> {\n\t\tawait this.roomService.onRedactEvent(MatrixRoomReceiverConverter.toRoomRedactEventDto(externalEvent));\n\t}\n}\n\nexport class MatrixRoomPowerLevelsChangedHandler extends MatrixBaseEventHandler {\n\tpublic eventType: string = MatrixEventType.ROOM_POWER_LEVELS_CHANGED;\n\n\tconstructor(private roomService: FederationRoomServiceReceiver) {\n\t\tsuper();\n\t}\n\n\tpublic async handle(externalEvent: MatrixEventRoomRoomPowerLevelsChanged): Promise<void> {\n\t\tawait this.roomService.onChangeRoomPowerLevels(MatrixRoomReceiverConverter.toRoomChangePowerLevelsEventDto(externalEvent));\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"9e6b0b60d754dc8c75b6eb5ea63ec12c01af574d"}
