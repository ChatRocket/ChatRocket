{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/recorderjs/AudioRecorder.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui/client/lib/recorderjs/AudioRecorder.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/recorderjs/AudioRecorder.ts","inputSourceMap":{"version":3,"file":"app/ui/client/lib/recorderjs/AudioRecorder.ts","sourceRoot":"","sources":["app/ui/client/lib/recorderjs/AudioRecorder.ts"],"names":[],"mappings":"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","sourcesContent":["import { settings } from '../../../../settings/client';\nimport { AudioEncoder } from './AudioEncoder';\n\nexport class AudioRecorder {\n\tprivate audioContext: AudioContext | undefined;\n\n\tprivate stream: MediaStream | undefined;\n\n\tprivate encoder: AudioEncoder | undefined;\n\n\tisSupported() {\n\t\treturn Boolean(navigator.mediaDevices?.getUserMedia) && Boolean(AudioContext);\n\t}\n\n\tcreateAudioContext() {\n\t\tif (this.audioContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.audioContext = new AudioContext();\n\t}\n\n\tdestroyAudioContext() {\n\t\tif (!this.audioContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.audioContext.close();\n\t\tdelete this.audioContext;\n\t}\n\n\tasync createStream() {\n\t\tif (this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\t}\n\n\tdestroyStream() {\n\t\tif (!this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stream.getAudioTracks().forEach((track) => track.stop());\n\t\tdelete this.stream;\n\t}\n\n\tasync createEncoder() {\n\t\tif (this.encoder || !this.audioContext || !this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst input = this.audioContext?.createMediaStreamSource(this.stream);\n\t\tthis.encoder = new AudioEncoder(input, { bitRate: settings.get('Message_Audio_bitRate') || 32 });\n\t}\n\n\tdestroyEncoder() {\n\t\tif (!this.encoder) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.encoder.close();\n\t\tdelete this.encoder;\n\t}\n\n\tasync start(cb?: (this: this, done: boolean) => void) {\n\t\ttry {\n\t\t\tthis.createAudioContext();\n\t\t\tawait this.createStream();\n\t\t\tawait this.createEncoder();\n\t\t\tcb?.call(this, true);\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t\tthis.destroyEncoder();\n\t\t\tthis.destroyStream();\n\t\t\tthis.destroyAudioContext();\n\t\t\tcb?.call(this, false);\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tstop(cb: (data: Blob) => void) {\n\t\tthis.encoder?.on('encoded', cb);\n\t\tthis.encoder?.close();\n\n\t\tthis.destroyEncoder();\n\t\tthis.destroyStream();\n\t\tthis.destroyAudioContext();\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/recorderjs/AudioRecorder.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui/client/lib/recorderjs/AudioRecorder.ts","inputSourceMap":{"version":3,"file":"app/ui/client/lib/recorderjs/AudioRecorder.ts","sourceRoot":"","sources":["app/ui/client/lib/recorderjs/AudioRecorder.ts"],"names":[],"mappings":"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","sourcesContent":["import { settings } from '../../../../settings/client';\nimport { AudioEncoder } from './AudioEncoder';\n\nexport class AudioRecorder {\n\tprivate audioContext: AudioContext | undefined;\n\n\tprivate stream: MediaStream | undefined;\n\n\tprivate encoder: AudioEncoder | undefined;\n\n\tisSupported() {\n\t\treturn Boolean(navigator.mediaDevices?.getUserMedia) && Boolean(AudioContext);\n\t}\n\n\tcreateAudioContext() {\n\t\tif (this.audioContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.audioContext = new AudioContext();\n\t}\n\n\tdestroyAudioContext() {\n\t\tif (!this.audioContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.audioContext.close();\n\t\tdelete this.audioContext;\n\t}\n\n\tasync createStream() {\n\t\tif (this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\t}\n\n\tdestroyStream() {\n\t\tif (!this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stream.getAudioTracks().forEach((track) => track.stop());\n\t\tdelete this.stream;\n\t}\n\n\tasync createEncoder() {\n\t\tif (this.encoder || !this.audioContext || !this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst input = this.audioContext?.createMediaStreamSource(this.stream);\n\t\tthis.encoder = new AudioEncoder(input, { bitRate: settings.get('Message_Audio_bitRate') || 32 });\n\t}\n\n\tdestroyEncoder() {\n\t\tif (!this.encoder) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.encoder.close();\n\t\tdelete this.encoder;\n\t}\n\n\tasync start(cb?: (this: this, done: boolean) => void) {\n\t\ttry {\n\t\t\tthis.createAudioContext();\n\t\t\tawait this.createStream();\n\t\t\tawait this.createEncoder();\n\t\t\tcb?.call(this, true);\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t\tthis.destroyEncoder();\n\t\t\tthis.destroyStream();\n\t\t\tthis.destroyAudioContext();\n\t\t\tcb?.call(this, false);\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tstop(cb: (data: Blob) => void) {\n\t\tthis.encoder?.on('encoded', cb);\n\t\tthis.encoder?.close();\n\n\t\tthis.destroyEncoder();\n\t\tthis.destroyStream();\n\t\tthis.destroyAudioContext();\n\t}\n}\n"]}}},"code":"var _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nmodule.export({\n  AudioRecorder: function () {\n    return AudioRecorder;\n  }\n});\nvar settings;\nmodule.link(\"../../../../settings/client\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 0);\nvar AudioEncoder;\nmodule.link(\"./AudioEncoder\", {\n  AudioEncoder: function (v) {\n    AudioEncoder = v;\n  }\n}, 1);\nvar AudioRecorder = /*#__PURE__*/function () {\n  function AudioRecorder() {\n    this.audioContext = void 0;\n    this.stream = void 0;\n    this.encoder = void 0;\n  }\n  var _proto = AudioRecorder.prototype;\n  _proto.isSupported = function () {\n    function isSupported() {\n      var _navigator$mediaDevic;\n      return Boolean((_navigator$mediaDevic = navigator.mediaDevices) === null || _navigator$mediaDevic === void 0 ? void 0 : _navigator$mediaDevic.getUserMedia) && Boolean(AudioContext);\n    }\n    return isSupported;\n  }();\n  _proto.createAudioContext = function () {\n    function createAudioContext() {\n      if (this.audioContext) {\n        return;\n      }\n      this.audioContext = new AudioContext();\n    }\n    return createAudioContext;\n  }();\n  _proto.destroyAudioContext = function () {\n    function destroyAudioContext() {\n      if (!this.audioContext) {\n        return;\n      }\n      void this.audioContext.close();\n      delete this.audioContext;\n    }\n    return destroyAudioContext;\n  }();\n  _proto.createStream = function () {\n    function createStream() {\n      return _regeneratorRuntime.async(function () {\n        function createStream$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (!this.stream) {\n                _context.next = 2;\n                break;\n              }\n              return _context.abrupt(\"return\");\n            case 2:\n              _context.next = 4;\n              return _regeneratorRuntime.awrap(navigator.mediaDevices.getUserMedia({\n                audio: true\n              }));\n            case 4:\n              this.stream = _context.sent;\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n        return createStream$;\n      }(), null, this, null, Promise);\n    }\n    return createStream;\n  }();\n  _proto.destroyStream = function () {\n    function destroyStream() {\n      if (!this.stream) {\n        return;\n      }\n      this.stream.getAudioTracks().forEach(function (track) {\n        return track.stop();\n      });\n      delete this.stream;\n    }\n    return destroyStream;\n  }();\n  _proto.createEncoder = function () {\n    function createEncoder() {\n      var _this$audioContext;\n      var input;\n      return _regeneratorRuntime.async(function () {\n        function createEncoder$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(this.encoder || !this.audioContext || !this.stream)) {\n                _context2.next = 2;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 2:\n              input = (_this$audioContext = this.audioContext) === null || _this$audioContext === void 0 ? void 0 : _this$audioContext.createMediaStreamSource(this.stream);\n              this.encoder = new AudioEncoder(input, {\n                bitRate: settings.get('Message_Audio_bitRate') || 32\n              });\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n        return createEncoder$;\n      }(), null, this, null, Promise);\n    }\n    return createEncoder;\n  }();\n  _proto.destroyEncoder = function () {\n    function destroyEncoder() {\n      if (!this.encoder) {\n        return;\n      }\n      this.encoder.close();\n      delete this.encoder;\n    }\n    return destroyEncoder;\n  }();\n  _proto.start = function () {\n    function start(cb) {\n      return _regeneratorRuntime.async(function () {\n        function start$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              this.createAudioContext();\n              _context3.next = 4;\n              return _regeneratorRuntime.awrap(this.createStream());\n            case 4:\n              _context3.next = 6;\n              return _regeneratorRuntime.awrap(this.createEncoder());\n            case 6:\n              cb === null || cb === void 0 ? void 0 : cb.call(this, true);\n              _context3.next = 17;\n              break;\n            case 9:\n              _context3.prev = 9;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.error(_context3.t0);\n              this.destroyEncoder();\n              this.destroyStream();\n              this.destroyAudioContext();\n              cb === null || cb === void 0 ? void 0 : cb.call(this, false);\n              throw _context3.t0;\n            case 17:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n        return start$;\n      }(), null, this, [[0, 9]], Promise);\n    }\n    return start;\n  }();\n  _proto.stop = function () {\n    function stop(cb) {\n      var _this$encoder, _this$encoder2;\n      (_this$encoder = this.encoder) === null || _this$encoder === void 0 ? void 0 : _this$encoder.on('encoded', cb);\n      (_this$encoder2 = this.encoder) === null || _this$encoder2 === void 0 ? void 0 : _this$encoder2.close();\n      this.destroyEncoder();\n      this.destroyStream();\n      this.destroyAudioContext();\n    }\n    return stop;\n  }();\n  return AudioRecorder;\n}();","map":{"version":3,"names":["_regeneratorRuntime","module","link","default","v","export","AudioRecorder","settings","AudioEncoder","audioContext","stream","encoder","_proto","prototype","isSupported","_navigator$mediaDevic","Boolean","navigator","mediaDevices","getUserMedia","AudioContext","createAudioContext","destroyAudioContext","close","createStream","async","createStream$","_context","prev","next","abrupt","awrap","audio","sent","stop","Promise","destroyStream","getAudioTracks","forEach","track","createEncoder","_this$audioContext","input","createEncoder$","_context2","createMediaStreamSource","bitRate","get","destroyEncoder","start","cb","start$","_context3","call","t0","console","error","_this$encoder","_this$encoder2","on"],"sources":["app/ui/client/lib/recorderjs/AudioRecorder.ts"],"sourcesContent":["import { settings } from '../../../../settings/client';\nimport { AudioEncoder } from './AudioEncoder';\n\nexport class AudioRecorder {\n\tprivate audioContext: AudioContext | undefined;\n\n\tprivate stream: MediaStream | undefined;\n\n\tprivate encoder: AudioEncoder | undefined;\n\n\tisSupported() {\n\t\treturn Boolean(navigator.mediaDevices?.getUserMedia) && Boolean(AudioContext);\n\t}\n\n\tcreateAudioContext() {\n\t\tif (this.audioContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.audioContext = new AudioContext();\n\t}\n\n\tdestroyAudioContext() {\n\t\tif (!this.audioContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.audioContext.close();\n\t\tdelete this.audioContext;\n\t}\n\n\tasync createStream() {\n\t\tif (this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\t}\n\n\tdestroyStream() {\n\t\tif (!this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stream.getAudioTracks().forEach((track) => track.stop());\n\t\tdelete this.stream;\n\t}\n\n\tasync createEncoder() {\n\t\tif (this.encoder || !this.audioContext || !this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst input = this.audioContext?.createMediaStreamSource(this.stream);\n\t\tthis.encoder = new AudioEncoder(input, { bitRate: settings.get('Message_Audio_bitRate') || 32 });\n\t}\n\n\tdestroyEncoder() {\n\t\tif (!this.encoder) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.encoder.close();\n\t\tdelete this.encoder;\n\t}\n\n\tasync start(cb?: (this: this, done: boolean) => void) {\n\t\ttry {\n\t\t\tthis.createAudioContext();\n\t\t\tawait this.createStream();\n\t\t\tawait this.createEncoder();\n\t\t\tcb?.call(this, true);\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t\tthis.destroyEncoder();\n\t\t\tthis.destroyStream();\n\t\t\tthis.destroyAudioContext();\n\t\t\tcb?.call(this, false);\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tstop(cb: (data: Blob) => void) {\n\t\tthis.encoder?.on('encoded', cb);\n\t\tthis.encoder?.close();\n\n\t\tthis.destroyEncoder();\n\t\tthis.destroyStream();\n\t\tthis.destroyAudioContext();\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"a82146600d2972135bf1861bfbe208d75c501267"}
