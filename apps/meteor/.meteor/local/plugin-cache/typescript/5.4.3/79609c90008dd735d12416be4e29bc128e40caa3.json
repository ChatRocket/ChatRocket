{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/rooms/roomTypes/livechat.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"server/lib/rooms/roomTypes/livechat.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/rooms/roomTypes/livechat.ts","inputSourceMap":{"version":3,"file":"server/lib/rooms/roomTypes/livechat.ts","sourceRoot":"","sources":["server/lib/rooms/roomTypes/livechat.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,oBAAoB,EAAE,MAAM,2BAA2B,CAAC;AACjE,OAAO,EAAE,gBAAgB,EAAE,aAAa,EAAE,MAAM,qBAAqB,CAAC;AAEtE,OAAO,EAAE,gBAAgB,EAAE,iBAAiB,EAAE,MAAM,wCAAwC,CAAC;AAE7F,OAAO,EAAE,mBAAmB,EAAE,MAAM,0CAA0C,CAAC;AAC/E,OAAO,EAAE,eAAe,EAAE,MAAM,oBAAoB,CAAC;AAErD,MAAM,gBAAgB,GAAG,mBAAmB,CAAC,eAAe,CAAC,CAAC;AAE9D,eAAe,CAAC,GAAG,CAAC,gBAAgB,EAAE;IACrC,sBAAsB,CAAC,KAAK,EAAE,OAAO;QACpC,QAAQ,OAAO,EAAE,CAAC;YACjB,KAAK,gBAAgB,CAAC,SAAS;gBAC9B,OAAO,KAAK,CAAC;YACd;gBACC,OAAO,IAAI,CAAC;QACd,CAAC;IACF,CAAC;IAED,KAAK,CAAC,iBAAiB,CAAC,KAAK,EAAE,MAAM;QACpC,OAAQ,CAAC,iBAAiB,CAAC,MAAM,EAAE,iBAAiB,CAAC,IAAI,CAA8C,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;IAC1H,CAAC;IAED,KAAK,CAAC,QAAQ,CAAC,IAAI,EAAE,OAAQ;QAC5B,OAAO,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,KAAK,IAAK,IAAY,CAAC,KAAK,CAAC;IACvD,CAAC;IAED,KAAK,CAAC,qBAAqB,CAAC,EAAE,QAAQ,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,EAAE;QAC3D,OAAO,KAAK,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,MAAM,aAAa,CAAC,0BAA0B,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC;IACvF,CAAC;IAED,KAAK,CAAC,sBAAsB,CAAC,IAAI,EAAE,OAAO,EAAE,mBAAmB,EAAE,MAAM;QACtE,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;QACnD,MAAM,KAAK,GAAG,iBAAiB,QAAQ,EAAE,CAAC;QAC1C,MAAM,IAAI,GAAG,mBAAmB,CAAC;QAEjC,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC;IACxC,CAAC;IAED,KAAK,CAAC,YAAY,CAAC,OAAO;QACzB,IAAI,oBAAoB,CAAC,OAAO,CAAC,EAAE,CAAC;YACnC,OAAO,gBAAgB,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;QAC3D,CAAC;IACF,CAAC;IAED,wBAAwB,CAAC,OAAO;QAC/B,MAAM,EAAE,KAAK,EAAE,GAAG,OAAc,CAAC;QACjC,OAAO,EAAE,KAAK,EAAE,CAAC;IAClB,CAAC;CACiD,CAAC,CAAC","sourcesContent":["import type { AtLeast, ValueOf } from '@rocket.chat/core-typings';\nimport { isMessageFromVisitor } from '@rocket.chat/core-typings';\nimport { LivechatVisitors, LivechatRooms } from '@rocket.chat/models';\n\nimport { RoomSettingsEnum, RoomMemberActions } from '../../../../definition/IRoomTypeConfig';\nimport type { IRoomTypeServerDirectives } from '../../../../definition/IRoomTypeConfig';\nimport { getLivechatRoomType } from '../../../../lib/rooms/roomTypes/livechat';\nimport { roomCoordinator } from '../roomCoordinator';\n\nconst LivechatRoomType = getLivechatRoomType(roomCoordinator);\n\nroomCoordinator.add(LivechatRoomType, {\n\tallowRoomSettingChange(_room, setting) {\n\t\tswitch (setting) {\n\t\t\tcase RoomSettingsEnum.JOIN_CODE:\n\t\t\t\treturn false;\n\t\t\tdefault:\n\t\t\t\treturn true;\n\t\t}\n\t},\n\n\tasync allowMemberAction(_room, action) {\n\t\treturn ([RoomMemberActions.INVITE, RoomMemberActions.JOIN] as Array<ValueOf<typeof RoomMemberActions>>).includes(action);\n\t},\n\n\tasync roomName(room, _userId?) {\n\t\treturn room.name || room.fname || (room as any).label;\n\t},\n\n\tasync canAccessUploadedFile({ rc_token: token, rc_rid: rid }) {\n\t\treturn token && rid && !!(await LivechatRooms.findOneByIdAndVisitorToken(rid, token));\n\t},\n\n\tasync getNotificationDetails(room, _sender, notificationMessage, userId) {\n\t\tconst roomName = await this.roomName(room, userId);\n\t\tconst title = `[Omnichannel] ${roomName}`;\n\t\tconst text = notificationMessage;\n\n\t\treturn { title, text, name: roomName };\n\t},\n\n\tasync getMsgSender(message) {\n\t\tif (isMessageFromVisitor(message)) {\n\t\t\treturn LivechatVisitors.findOneEnabledById(message.u._id);\n\t\t}\n\t},\n\n\tgetReadReceiptsExtraData(message) {\n\t\tconst { token } = message as any;\n\t\treturn { token };\n\t},\n} as AtLeast<IRoomTypeServerDirectives, 'roomName'>);\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/lib/rooms/roomTypes/livechat.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"server/lib/rooms/roomTypes/livechat.ts","inputSourceMap":{"version":3,"file":"server/lib/rooms/roomTypes/livechat.ts","sourceRoot":"","sources":["server/lib/rooms/roomTypes/livechat.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,oBAAoB,EAAE,MAAM,2BAA2B,CAAC;AACjE,OAAO,EAAE,gBAAgB,EAAE,aAAa,EAAE,MAAM,qBAAqB,CAAC;AAEtE,OAAO,EAAE,gBAAgB,EAAE,iBAAiB,EAAE,MAAM,wCAAwC,CAAC;AAE7F,OAAO,EAAE,mBAAmB,EAAE,MAAM,0CAA0C,CAAC;AAC/E,OAAO,EAAE,eAAe,EAAE,MAAM,oBAAoB,CAAC;AAErD,MAAM,gBAAgB,GAAG,mBAAmB,CAAC,eAAe,CAAC,CAAC;AAE9D,eAAe,CAAC,GAAG,CAAC,gBAAgB,EAAE;IACrC,sBAAsB,CAAC,KAAK,EAAE,OAAO;QACpC,QAAQ,OAAO,EAAE,CAAC;YACjB,KAAK,gBAAgB,CAAC,SAAS;gBAC9B,OAAO,KAAK,CAAC;YACd;gBACC,OAAO,IAAI,CAAC;QACd,CAAC;IACF,CAAC;IAED,KAAK,CAAC,iBAAiB,CAAC,KAAK,EAAE,MAAM;QACpC,OAAQ,CAAC,iBAAiB,CAAC,MAAM,EAAE,iBAAiB,CAAC,IAAI,CAA8C,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;IAC1H,CAAC;IAED,KAAK,CAAC,QAAQ,CAAC,IAAI,EAAE,OAAQ;QAC5B,OAAO,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,KAAK,IAAK,IAAY,CAAC,KAAK,CAAC;IACvD,CAAC;IAED,KAAK,CAAC,qBAAqB,CAAC,EAAE,QAAQ,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,EAAE;QAC3D,OAAO,KAAK,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,MAAM,aAAa,CAAC,0BAA0B,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC;IACvF,CAAC;IAED,KAAK,CAAC,sBAAsB,CAAC,IAAI,EAAE,OAAO,EAAE,mBAAmB,EAAE,MAAM;QACtE,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;QACnD,MAAM,KAAK,GAAG,iBAAiB,QAAQ,EAAE,CAAC;QAC1C,MAAM,IAAI,GAAG,mBAAmB,CAAC;QAEjC,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC;IACxC,CAAC;IAED,KAAK,CAAC,YAAY,CAAC,OAAO;QACzB,IAAI,oBAAoB,CAAC,OAAO,CAAC,EAAE,CAAC;YACnC,OAAO,gBAAgB,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;QAC3D,CAAC;IACF,CAAC;IAED,wBAAwB,CAAC,OAAO;QAC/B,MAAM,EAAE,KAAK,EAAE,GAAG,OAAc,CAAC;QACjC,OAAO,EAAE,KAAK,EAAE,CAAC;IAClB,CAAC;CACiD,CAAC,CAAC","sourcesContent":["import type { AtLeast, ValueOf } from '@rocket.chat/core-typings';\nimport { isMessageFromVisitor } from '@rocket.chat/core-typings';\nimport { LivechatVisitors, LivechatRooms } from '@rocket.chat/models';\n\nimport { RoomSettingsEnum, RoomMemberActions } from '../../../../definition/IRoomTypeConfig';\nimport type { IRoomTypeServerDirectives } from '../../../../definition/IRoomTypeConfig';\nimport { getLivechatRoomType } from '../../../../lib/rooms/roomTypes/livechat';\nimport { roomCoordinator } from '../roomCoordinator';\n\nconst LivechatRoomType = getLivechatRoomType(roomCoordinator);\n\nroomCoordinator.add(LivechatRoomType, {\n\tallowRoomSettingChange(_room, setting) {\n\t\tswitch (setting) {\n\t\t\tcase RoomSettingsEnum.JOIN_CODE:\n\t\t\t\treturn false;\n\t\t\tdefault:\n\t\t\t\treturn true;\n\t\t}\n\t},\n\n\tasync allowMemberAction(_room, action) {\n\t\treturn ([RoomMemberActions.INVITE, RoomMemberActions.JOIN] as Array<ValueOf<typeof RoomMemberActions>>).includes(action);\n\t},\n\n\tasync roomName(room, _userId?) {\n\t\treturn room.name || room.fname || (room as any).label;\n\t},\n\n\tasync canAccessUploadedFile({ rc_token: token, rc_rid: rid }) {\n\t\treturn token && rid && !!(await LivechatRooms.findOneByIdAndVisitorToken(rid, token));\n\t},\n\n\tasync getNotificationDetails(room, _sender, notificationMessage, userId) {\n\t\tconst roomName = await this.roomName(room, userId);\n\t\tconst title = `[Omnichannel] ${roomName}`;\n\t\tconst text = notificationMessage;\n\n\t\treturn { title, text, name: roomName };\n\t},\n\n\tasync getMsgSender(message) {\n\t\tif (isMessageFromVisitor(message)) {\n\t\t\treturn LivechatVisitors.findOneEnabledById(message.u._id);\n\t\t}\n\t},\n\n\tgetReadReceiptsExtraData(message) {\n\t\tconst { token } = message as any;\n\t\treturn { token };\n\t},\n} as AtLeast<IRoomTypeServerDirectives, 'roomName'>);\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let isMessageFromVisitor;\n    module.link(\"@rocket.chat/core-typings\", {\n      isMessageFromVisitor(v) {\n        isMessageFromVisitor = v;\n      }\n    }, 0);\n    let LivechatVisitors, LivechatRooms;\n    module.link(\"@rocket.chat/models\", {\n      LivechatVisitors(v) {\n        LivechatVisitors = v;\n      },\n      LivechatRooms(v) {\n        LivechatRooms = v;\n      }\n    }, 1);\n    let RoomSettingsEnum, RoomMemberActions;\n    module.link(\"../../../../definition/IRoomTypeConfig\", {\n      RoomSettingsEnum(v) {\n        RoomSettingsEnum = v;\n      },\n      RoomMemberActions(v) {\n        RoomMemberActions = v;\n      }\n    }, 2);\n    let getLivechatRoomType;\n    module.link(\"../../../../lib/rooms/roomTypes/livechat\", {\n      getLivechatRoomType(v) {\n        getLivechatRoomType = v;\n      }\n    }, 3);\n    let roomCoordinator;\n    module.link(\"../roomCoordinator\", {\n      roomCoordinator(v) {\n        roomCoordinator = v;\n      }\n    }, 4);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    const LivechatRoomType = getLivechatRoomType(roomCoordinator);\n    roomCoordinator.add(LivechatRoomType, {\n      allowRoomSettingChange(_room, setting) {\n        switch (setting) {\n          case RoomSettingsEnum.JOIN_CODE:\n            return false;\n          default:\n            return true;\n        }\n      },\n      async allowMemberAction(_room, action) {\n        return [RoomMemberActions.INVITE, RoomMemberActions.JOIN].includes(action);\n      },\n      async roomName(room, _userId) {\n        return room.name || room.fname || room.label;\n      },\n      async canAccessUploadedFile(_ref) {\n        let {\n          rc_token: token,\n          rc_rid: rid\n        } = _ref;\n        return token && rid && !!(await LivechatRooms.findOneByIdAndVisitorToken(rid, token));\n      },\n      async getNotificationDetails(room, _sender, notificationMessage, userId) {\n        const roomName = await this.roomName(room, userId);\n        const title = \"[Omnichannel] \".concat(roomName);\n        const text = notificationMessage;\n        return {\n          title,\n          text,\n          name: roomName\n        };\n      },\n      async getMsgSender(message) {\n        if (isMessageFromVisitor(message)) {\n          return LivechatVisitors.findOneEnabledById(message.u._id);\n        }\n      },\n      getReadReceiptsExtraData(message) {\n        const {\n          token\n        } = message;\n        return {\n          token\n        };\n      }\n    });\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["isMessageFromVisitor","module","link","v","LivechatVisitors","LivechatRooms","RoomSettingsEnum","RoomMemberActions","getLivechatRoomType","roomCoordinator","__reifyWaitForDeps__","LivechatRoomType","add","allowRoomSettingChange","_room","setting","JOIN_CODE","allowMemberAction","action","INVITE","JOIN","includes","roomName","room","_userId","name","fname","label","canAccessUploadedFile","_ref","rc_token","token","rc_rid","rid","findOneByIdAndVisitorToken","getNotificationDetails","_sender","notificationMessage","userId","title","concat","text","getMsgSender","message","findOneEnabledById","u","_id","getReadReceiptsExtraData","__reify_async_result__","_reifyError","self","async"],"sources":["server/lib/rooms/roomTypes/livechat.ts"],"sourcesContent":["import type { AtLeast, ValueOf } from '@rocket.chat/core-typings';\nimport { isMessageFromVisitor } from '@rocket.chat/core-typings';\nimport { LivechatVisitors, LivechatRooms } from '@rocket.chat/models';\n\nimport { RoomSettingsEnum, RoomMemberActions } from '../../../../definition/IRoomTypeConfig';\nimport type { IRoomTypeServerDirectives } from '../../../../definition/IRoomTypeConfig';\nimport { getLivechatRoomType } from '../../../../lib/rooms/roomTypes/livechat';\nimport { roomCoordinator } from '../roomCoordinator';\n\nconst LivechatRoomType = getLivechatRoomType(roomCoordinator);\n\nroomCoordinator.add(LivechatRoomType, {\n\tallowRoomSettingChange(_room, setting) {\n\t\tswitch (setting) {\n\t\t\tcase RoomSettingsEnum.JOIN_CODE:\n\t\t\t\treturn false;\n\t\t\tdefault:\n\t\t\t\treturn true;\n\t\t}\n\t},\n\n\tasync allowMemberAction(_room, action) {\n\t\treturn ([RoomMemberActions.INVITE, RoomMemberActions.JOIN] as Array<ValueOf<typeof RoomMemberActions>>).includes(action);\n\t},\n\n\tasync roomName(room, _userId?) {\n\t\treturn room.name || room.fname || (room as any).label;\n\t},\n\n\tasync canAccessUploadedFile({ rc_token: token, rc_rid: rid }) {\n\t\treturn token && rid && !!(await LivechatRooms.findOneByIdAndVisitorToken(rid, token));\n\t},\n\n\tasync getNotificationDetails(room, _sender, notificationMessage, userId) {\n\t\tconst roomName = await this.roomName(room, userId);\n\t\tconst title = `[Omnichannel] ${roomName}`;\n\t\tconst text = notificationMessage;\n\n\t\treturn { title, text, name: roomName };\n\t},\n\n\tasync getMsgSender(message) {\n\t\tif (isMessageFromVisitor(message)) {\n\t\t\treturn LivechatVisitors.findOneEnabledById(message.u._id);\n\t\t}\n\t},\n\n\tgetReadReceiptsExtraData(message) {\n\t\tconst { token } = message as any;\n\t\treturn { token };\n\t},\n} as AtLeast<IRoomTypeServerDirectives, 'roomName'>);\n"],"mappings":";;;IACA,IAAAA,oBAAS;IAAAC,MAAsB,CAAAC,IAAA,CAAM,2BAA2B,EAAC;MAAAF,qBAAAG,CAAA;QAAAH,oBAAA,GAAAG,CAAA;MAAA;IAAA;IAAA,IAAAC,gBAAA,EAAAC,aAAA;IAAAJ,MAAA,CAAAC,IAAA;MAAAE,iBAAAD,CAAA;QAAAC,gBAAA,GAAAD,CAAA;MAAA;MAAAE,cAAAF,CAAA;QAAAE,aAAA,GAAAF,CAAA;MAAA;IAAA;IAAA,IAAAG,gBAAA,EAAAC,iBAAA;IAAAN,MAAA,CAAAC,IAAA;MAAAI,iBAAAH,CAAA;QAAAG,gBAAA,GAAAH,CAAA;MAAA;MAAAI,kBAAAJ,CAAA;QAAAI,iBAAA,GAAAJ,CAAA;MAAA;IAAA;IAAA,IAAAK,mBAAA;IAAAP,MAAA,CAAAC,IAAA;MAAAM,oBAAAL,CAAA;QAAAK,mBAAA,GAAAL,CAAA;MAAA;IAAA;IAAA,IAAAM,eAAA;IAAAR,MAAA,CAAAC,IAAA;MAAAO,gBAAAN,CAAA;QAAAM,eAAA,GAAAN,CAAA;MAAA;IAAA;IAAA,IAAAO,oBAAA,WAAAA,oBAAA;IAQjE,MAAMC,gBAAgB,GAAGH,mBAAmB,CAACC,eAAe,CAAC;IAE7DA,eAAe,CAACG,GAAG,CAACD,gBAAgB,EAAE;MACrCE,sBAAsBA,CAACC,KAAK,EAAEC,OAAO;QACpC,QAAQA,OAAO;UACd,KAAKT,gBAAgB,CAACU,SAAS;YAC9B,OAAO,KAAK;UACb;YACC,OAAO,IAAI;QACb;MACD,CAAC;MAED,MAAMC,iBAAiBA,CAACH,KAAK,EAAEI,MAAM;QACpC,OAAQ,CAACX,iBAAiB,CAACY,MAAM,EAAEZ,iBAAiB,CAACa,IAAI,CAA8C,CAACC,QAAQ,CAACH,MAAM,CAAC;MACzH,CAAC;MAED,MAAMI,QAAQA,CAACC,IAAI,EAAEC,OAAQ;QAC5B,OAAOD,IAAI,CAACE,IAAI,IAAIF,IAAI,CAACG,KAAK,IAAKH,IAAY,CAACI,KAAK;MACtD,CAAC;MAED,MAAMC,qBAAqBA,CAAAC,IAAA,EAAiC;QAAA,IAAhC;UAAEC,QAAQ,EAAEC,KAAK;UAAEC,MAAM,EAAEC;QAAG,CAAE,GAAAJ,IAAA;QAC3D,OAAOE,KAAK,IAAIE,GAAG,IAAI,CAAC,EAAE,MAAM5B,aAAa,CAAC6B,0BAA0B,CAACD,GAAG,EAAEF,KAAK,CAAC,CAAC;MACtF,CAAC;MAED,MAAMI,sBAAsBA,CAACZ,IAAI,EAAEa,OAAO,EAAEC,mBAAmB,EAAEC,MAAM;QACtE,MAAMhB,QAAQ,GAAG,MAAM,IAAI,CAACA,QAAQ,CAACC,IAAI,EAAEe,MAAM,CAAC;QAClD,MAAMC,KAAK,oBAAAC,MAAA,CAAoBlB,QAAQ,CAAE;QACzC,MAAMmB,IAAI,GAAGJ,mBAAmB;QAEhC,OAAO;UAAEE,KAAK;UAAEE,IAAI;UAAEhB,IAAI,EAAEH;QAAQ,CAAE;MACvC,CAAC;MAED,MAAMoB,YAAYA,CAACC,OAAO;QACzB,IAAI3C,oBAAoB,CAAC2C,OAAO,CAAC,EAAE;UAClC,OAAOvC,gBAAgB,CAACwC,kBAAkB,CAACD,OAAO,CAACE,CAAC,CAACC,GAAG,CAAC;QAC1D;MACD,CAAC;MAEDC,wBAAwBA,CAACJ,OAAO;QAC/B,MAAM;UAAEZ;QAAK,CAAE,GAAGY,OAAc;QAChC,OAAO;UAAEZ;QAAK,CAAE;MACjB;KACkD,CAAC;IAACiB,sBAAA;EAAA,SAAAC,WAAA;IAAA,OAAAD,sBAAA,CAAAC,WAAA;EAAA;EAAAD,sBAAA;AAAA;EAAAE,IAAA;EAAAC,KAAA;AAAA","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"79609c90008dd735d12416be4e29bc128e40caa3"}
