{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/hooks/roomActions/useDeleteRoom.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/hooks/roomActions/useDeleteRoom.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/hooks/roomActions/useDeleteRoom.tsx","inputSourceMap":{"version":3,"file":"client/views/hooks/roomActions/useDeleteRoom.tsx","sourceRoot":"","sources":["client/views/hooks/roomActions/useDeleteRoom.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom, RoomAdminFieldsType } from '@rocket.chat/core-typings';\nimport { isRoomFederated } from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useSetModal, useToastMessageDispatch, useRouter, usePermission, useEndpoint, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useMutation, useQuery } from '@tanstack/react-query';\nimport React from 'react';\n\nimport GenericModal from '../../../components/GenericModal';\nimport DeleteTeamModal from '../../teams/contextualBar/info/DeleteTeam';\n\nexport const useDeleteRoom = (room: IRoom | Pick<IRoom, RoomAdminFieldsType>, { reload }: { reload?: () => void } = {}) => {\n\tconst t = useTranslation();\n\tconst router = useRouter();\n\tconst setModal = useSetModal();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\t// eslint-disable-next-line no-nested-ternary\n\tconst roomType = 'prid' in room ? 'discussion' : room.teamId && room.teamMain ? 'team' : 'channel';\n\tconst isAdminRoute = router.getRouteName() === 'admin-rooms';\n\n\tconst deleteRoomEndpoint = useEndpoint('POST', '/v1/rooms.delete');\n\tconst deleteTeamEndpoint = useEndpoint('POST', '/v1/teams.delete');\n\tconst teamsInfoEndpoint = useEndpoint('GET', '/v1/teams.info');\n\n\tconst teamId = room.teamId || '';\n\tconst { data: teamInfoData } = useQuery(['teamId', teamId], async () => teamsInfoEndpoint({ teamId }), {\n\t\tkeepPreviousData: true,\n\t\tretry: false,\n\t\tenabled: room.teamId !== '',\n\t});\n\n\tconst hasPermissionToDeleteRoom = usePermission(`delete-${room.t}`, room._id);\n\tconst hasPermissionToDeleteTeamRoom = usePermission(`delete-team-${room.t === 'c' ? 'channel' : 'group'}`, teamInfoData?.teamInfo.roomId);\n\tconst isTeamRoom = room.teamId;\n\tconst canDeleteRoom = isRoomFederated(room) ? false : hasPermissionToDeleteRoom && (!isTeamRoom || hasPermissionToDeleteTeamRoom);\n\n\tconst deleteRoomMutation = useMutation({\n\t\tmutationFn: deleteRoomEndpoint,\n\t\tonSuccess: () => {\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Deleted_roomType', { roomName: room.name, roomType }) });\n\t\t\tif (isAdminRoute) {\n\t\t\t\treturn router.navigate('/admin/rooms');\n\t\t\t}\n\n\t\t\treturn router.navigate('/home');\n\t\t},\n\t\tonError: (error) => {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t\tonSettled: () => {\n\t\t\tsetModal(null);\n\t\t\treload?.();\n\t\t},\n\t});\n\n\tconst deleteTeamMutation = useMutation({\n\t\tmutationFn: deleteTeamEndpoint,\n\t\tonSuccess: () => {\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Team_has_been_deleted') });\n\t\t\tif (isAdminRoute) {\n\t\t\t\treturn router.navigate('/admin/rooms');\n\t\t\t}\n\n\t\t\treturn router.navigate('/home');\n\t\t},\n\t\tonError: (error) => {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t\tonSettled: () => {\n\t\t\tsetModal(null);\n\t\t\treload?.();\n\t\t},\n\t});\n\n\tconst isDeleting = deleteTeamMutation.isLoading || deleteRoomMutation.isLoading;\n\n\tconst handleDelete = useMutableCallback(() => {\n\t\tconst handleDeleteTeam = async (roomsToRemove: IRoom['_id'][]) => {\n\t\t\tif (!room.teamId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdeleteTeamMutation.mutateAsync({ teamId: room.teamId, ...(roomsToRemove.length && { roomsToRemove }) });\n\t\t};\n\n\t\tif (room.teamMain && room.teamId) {\n\t\t\treturn setModal(<DeleteTeamModal onConfirm={handleDeleteTeam} onCancel={(): void => setModal(null)} teamId={room.teamId} />);\n\t\t}\n\n\t\tconst handleDeleteRoom = async () => {\n\t\t\tdeleteRoomMutation.mutateAsync({ roomId: room._id });\n\t\t};\n\n\t\tsetModal(\n\t\t\t<GenericModal\n\t\t\t\ttitle={t('Delete_roomType', { roomType })}\n\t\t\t\tvariant='danger'\n\t\t\t\tonConfirm={handleDeleteRoom}\n\t\t\t\tonCancel={(): void => setModal(null)}\n\t\t\t\tconfirmText={t('Yes_delete_it')}\n\t\t\t>\n\t\t\t\t{t('Delete_Room_Warning', { roomType })}\n\t\t\t</GenericModal>,\n\t\t);\n\t});\n\n\treturn { handleDelete, canDeleteRoom, isDeleting };\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/hooks/roomActions/useDeleteRoom.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/hooks/roomActions/useDeleteRoom.tsx","inputSourceMap":{"version":3,"file":"client/views/hooks/roomActions/useDeleteRoom.tsx","sourceRoot":"","sources":["client/views/hooks/roomActions/useDeleteRoom.tsx"],"names":[],"mappings":"AACA,OAAO,EAAE,eAAe,EAAE,MAAM,2BAA2B,CAAC;AAC5D,OAAO,EAAE,kBAAkB,EAAE,MAAM,6BAA6B,CAAC;AACjE,OAAO,EAAE,WAAW,EAAE,uBAAuB,EAAE,SAAS,EAAE,aAAa,EAAE,WAAW,EAAE,cAAc,EAAE,MAAM,0BAA0B,CAAC;AACvI,OAAO,EAAE,WAAW,EAAE,QAAQ,EAAE,MAAM,uBAAuB,CAAC;AAC9D,OAAO,KAAK,MAAM,OAAO,CAAC;AAE1B,OAAO,YAAY,MAAM,kCAAkC,CAAC;AAC5D,OAAO,eAAe,MAAM,2CAA2C,CAAC;AAExE,MAAM,CAAC,MAAM,aAAa,GAAG,CAAC,IAA8C,EAAE,EAAE,MAAM,KAA8B,EAAE,EAAE,EAAE;IACzH,MAAM,CAAC,GAAG,cAAc,EAAE,CAAC;IAC3B,MAAM,MAAM,GAAG,SAAS,EAAE,CAAC;IAC3B,MAAM,QAAQ,GAAG,WAAW,EAAE,CAAC;IAC/B,MAAM,oBAAoB,GAAG,uBAAuB,EAAE,CAAC;IACvD,6CAA6C;IAC7C,MAAM,QAAQ,GAAG,MAAM,IAAI,IAAI,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC;IACnG,MAAM,YAAY,GAAG,MAAM,CAAC,YAAY,EAAE,KAAK,aAAa,CAAC;IAE7D,MAAM,kBAAkB,GAAG,WAAW,CAAC,MAAM,EAAE,kBAAkB,CAAC,CAAC;IACnE,MAAM,kBAAkB,GAAG,WAAW,CAAC,MAAM,EAAE,kBAAkB,CAAC,CAAC;IACnE,MAAM,iBAAiB,GAAG,WAAW,CAAC,KAAK,EAAE,gBAAgB,CAAC,CAAC;IAE/D,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,IAAI,EAAE,CAAC;IACjC,MAAM,EAAE,IAAI,EAAE,YAAY,EAAE,GAAG,QAAQ,CAAC,CAAC,QAAQ,EAAE,MAAM,CAAC,EAAE,KAAK,IAAI,EAAE,CAAC,iBAAiB,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE;QACtG,gBAAgB,EAAE,IAAI;QACtB,KAAK,EAAE,KAAK;QACZ,OAAO,EAAE,IAAI,CAAC,MAAM,KAAK,EAAE;KAC3B,CAAC,CAAC;IAEH,MAAM,yBAAyB,GAAG,aAAa,CAAC,UAAU,IAAI,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;IAC9E,MAAM,6BAA6B,GAAG,aAAa,CAAC,eAAe,IAAI,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,EAAE,EAAE,YAAY,EAAE,QAAQ,CAAC,MAAM,CAAC,CAAC;IAC1I,MAAM,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC;IAC/B,MAAM,aAAa,GAAG,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,yBAAyB,IAAI,CAAC,CAAC,UAAU,IAAI,6BAA6B,CAAC,CAAC;IAElI,MAAM,kBAAkB,GAAG,WAAW,CAAC;QACtC,UAAU,EAAE,kBAAkB;QAC9B,SAAS,EAAE,GAAG,EAAE;YACf,oBAAoB,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,CAAC,CAAC,kBAAkB,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,IAAI,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC;YAC7G,IAAI,YAAY,EAAE,CAAC;gBAClB,OAAO,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;YACxC,CAAC;YAED,OAAO,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;QACjC,CAAC;QACD,OAAO,EAAE,CAAC,KAAK,EAAE,EAAE;YAClB,oBAAoB,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;QACzD,CAAC;QACD,SAAS,EAAE,GAAG,EAAE;YACf,QAAQ,CAAC,IAAI,CAAC,CAAC;YACf,MAAM,EAAE,EAAE,CAAC;QACZ,CAAC;KACD,CAAC,CAAC;IAEH,MAAM,kBAAkB,GAAG,WAAW,CAAC;QACtC,UAAU,EAAE,kBAAkB;QAC9B,SAAS,EAAE,GAAG,EAAE;YACf,oBAAoB,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,CAAC,CAAC,uBAAuB,CAAC,EAAE,CAAC,CAAC;YAC/E,IAAI,YAAY,EAAE,CAAC;gBAClB,OAAO,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;YACxC,CAAC;YAED,OAAO,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;QACjC,CAAC;QACD,OAAO,EAAE,CAAC,KAAK,EAAE,EAAE;YAClB,oBAAoB,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;QACzD,CAAC;QACD,SAAS,EAAE,GAAG,EAAE;YACf,QAAQ,CAAC,IAAI,CAAC,CAAC;YACf,MAAM,EAAE,EAAE,CAAC;QACZ,CAAC;KACD,CAAC,CAAC;IAEH,MAAM,UAAU,GAAG,kBAAkB,CAAC,SAAS,IAAI,kBAAkB,CAAC,SAAS,CAAC;IAEhF,MAAM,YAAY,GAAG,kBAAkB,CAAC,GAAG,EAAE;QAC5C,MAAM,gBAAgB,GAAG,KAAK,EAAE,aAA6B,EAAE,EAAE;YAChE,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;gBAClB,OAAO;YACR,CAAC;YAED,kBAAkB,CAAC,WAAW,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,aAAa,CAAC,MAAM,IAAI,EAAE,aAAa,EAAE,CAAC,EAAE,CAAC,CAAC;QACzG,CAAC,CAAC;QAEF,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;YAClC,OAAO,QAAQ,CAAC,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC,gBAAgB,CAAC,CAAC,QAAQ,CAAC,CAAC,GAAS,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,EAAG,CAAC,CAAC;QAC9H,CAAC;QAED,MAAM,gBAAgB,GAAG,KAAK,IAAI,EAAE;YACnC,kBAAkB,CAAC,WAAW,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;QACtD,CAAC,CAAC;QAEF,QAAQ,CACP,CAAC,YAAY,CACZ,KAAK,CAAC,CAAC,CAAC,CAAC,iBAAiB,EAAE,EAAE,QAAQ,EAAE,CAAC,CAAC,CAC1C,OAAO,CAAC,QAAQ,CAChB,SAAS,CAAC,CAAC,gBAAgB,CAAC,CAC5B,QAAQ,CAAC,CAAC,GAAS,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CACrC,WAAW,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAEhC;IAAA,CAAC,CAAC,CAAC,qBAAqB,EAAE,EAAE,QAAQ,EAAE,CAAC,CACxC;GAAA,EAAE,YAAY,CAAC,CACf,CAAC;IACH,CAAC,CAAC,CAAC;IAEH,OAAO,EAAE,YAAY,EAAE,aAAa,EAAE,UAAU,EAAE,CAAC;AACpD,CAAC,CAAC","sourcesContent":["import type { IRoom, RoomAdminFieldsType } from '@rocket.chat/core-typings';\nimport { isRoomFederated } from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useSetModal, useToastMessageDispatch, useRouter, usePermission, useEndpoint, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useMutation, useQuery } from '@tanstack/react-query';\nimport React from 'react';\n\nimport GenericModal from '../../../components/GenericModal';\nimport DeleteTeamModal from '../../teams/contextualBar/info/DeleteTeam';\n\nexport const useDeleteRoom = (room: IRoom | Pick<IRoom, RoomAdminFieldsType>, { reload }: { reload?: () => void } = {}) => {\n\tconst t = useTranslation();\n\tconst router = useRouter();\n\tconst setModal = useSetModal();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\t// eslint-disable-next-line no-nested-ternary\n\tconst roomType = 'prid' in room ? 'discussion' : room.teamId && room.teamMain ? 'team' : 'channel';\n\tconst isAdminRoute = router.getRouteName() === 'admin-rooms';\n\n\tconst deleteRoomEndpoint = useEndpoint('POST', '/v1/rooms.delete');\n\tconst deleteTeamEndpoint = useEndpoint('POST', '/v1/teams.delete');\n\tconst teamsInfoEndpoint = useEndpoint('GET', '/v1/teams.info');\n\n\tconst teamId = room.teamId || '';\n\tconst { data: teamInfoData } = useQuery(['teamId', teamId], async () => teamsInfoEndpoint({ teamId }), {\n\t\tkeepPreviousData: true,\n\t\tretry: false,\n\t\tenabled: room.teamId !== '',\n\t});\n\n\tconst hasPermissionToDeleteRoom = usePermission(`delete-${room.t}`, room._id);\n\tconst hasPermissionToDeleteTeamRoom = usePermission(`delete-team-${room.t === 'c' ? 'channel' : 'group'}`, teamInfoData?.teamInfo.roomId);\n\tconst isTeamRoom = room.teamId;\n\tconst canDeleteRoom = isRoomFederated(room) ? false : hasPermissionToDeleteRoom && (!isTeamRoom || hasPermissionToDeleteTeamRoom);\n\n\tconst deleteRoomMutation = useMutation({\n\t\tmutationFn: deleteRoomEndpoint,\n\t\tonSuccess: () => {\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Deleted_roomType', { roomName: room.name, roomType }) });\n\t\t\tif (isAdminRoute) {\n\t\t\t\treturn router.navigate('/admin/rooms');\n\t\t\t}\n\n\t\t\treturn router.navigate('/home');\n\t\t},\n\t\tonError: (error) => {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t\tonSettled: () => {\n\t\t\tsetModal(null);\n\t\t\treload?.();\n\t\t},\n\t});\n\n\tconst deleteTeamMutation = useMutation({\n\t\tmutationFn: deleteTeamEndpoint,\n\t\tonSuccess: () => {\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Team_has_been_deleted') });\n\t\t\tif (isAdminRoute) {\n\t\t\t\treturn router.navigate('/admin/rooms');\n\t\t\t}\n\n\t\t\treturn router.navigate('/home');\n\t\t},\n\t\tonError: (error) => {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t\tonSettled: () => {\n\t\t\tsetModal(null);\n\t\t\treload?.();\n\t\t},\n\t});\n\n\tconst isDeleting = deleteTeamMutation.isLoading || deleteRoomMutation.isLoading;\n\n\tconst handleDelete = useMutableCallback(() => {\n\t\tconst handleDeleteTeam = async (roomsToRemove: IRoom['_id'][]) => {\n\t\t\tif (!room.teamId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdeleteTeamMutation.mutateAsync({ teamId: room.teamId, ...(roomsToRemove.length && { roomsToRemove }) });\n\t\t};\n\n\t\tif (room.teamMain && room.teamId) {\n\t\t\treturn setModal(<DeleteTeamModal onConfirm={handleDeleteTeam} onCancel={(): void => setModal(null)} teamId={room.teamId} />);\n\t\t}\n\n\t\tconst handleDeleteRoom = async () => {\n\t\t\tdeleteRoomMutation.mutateAsync({ roomId: room._id });\n\t\t};\n\n\t\tsetModal(\n\t\t\t<GenericModal\n\t\t\t\ttitle={t('Delete_roomType', { roomType })}\n\t\t\t\tvariant='danger'\n\t\t\t\tonConfirm={handleDeleteRoom}\n\t\t\t\tonCancel={(): void => setModal(null)}\n\t\t\t\tconfirmText={t('Yes_delete_it')}\n\t\t\t>\n\t\t\t\t{t('Delete_Room_Warning', { roomType })}\n\t\t\t</GenericModal>,\n\t\t);\n\t});\n\n\treturn { handleDelete, canDeleteRoom, isDeleting };\n};\n"]}}},"code":"var _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 0);\nvar _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 1);\nmodule.export({\n  useDeleteRoom: function () {\n    return useDeleteRoom;\n  }\n});\nvar isRoomFederated;\nmodule.link(\"@rocket.chat/core-typings\", {\n  isRoomFederated: function (v) {\n    isRoomFederated = v;\n  }\n}, 0);\nvar useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback: function (v) {\n    useMutableCallback = v;\n  }\n}, 1);\nvar useSetModal, useToastMessageDispatch, useRouter, usePermission, useEndpoint, useTranslation;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useSetModal: function (v) {\n    useSetModal = v;\n  },\n  useToastMessageDispatch: function (v) {\n    useToastMessageDispatch = v;\n  },\n  useRouter: function (v) {\n    useRouter = v;\n  },\n  usePermission: function (v) {\n    usePermission = v;\n  },\n  useEndpoint: function (v) {\n    useEndpoint = v;\n  },\n  useTranslation: function (v) {\n    useTranslation = v;\n  }\n}, 2);\nvar useMutation, useQuery;\nmodule.link(\"@tanstack/react-query\", {\n  useMutation: function (v) {\n    useMutation = v;\n  },\n  useQuery: function (v) {\n    useQuery = v;\n  }\n}, 3);\nvar React;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  }\n}, 4);\nvar GenericModal;\nmodule.link(\"../../../components/GenericModal\", {\n  \"default\": function (v) {\n    GenericModal = v;\n  }\n}, 5);\nvar DeleteTeamModal;\nmodule.link(\"../../teams/contextualBar/info/DeleteTeam\", {\n  \"default\": function (v) {\n    DeleteTeamModal = v;\n  }\n}, 6);\nvar useDeleteRoom = function (room) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n    reload = _ref.reload;\n  var t = useTranslation();\n  var router = useRouter();\n  var setModal = useSetModal();\n  var dispatchToastMessage = useToastMessageDispatch();\n  // eslint-disable-next-line no-nested-ternary\n  var roomType = 'prid' in room ? 'discussion' : room.teamId && room.teamMain ? 'team' : 'channel';\n  var isAdminRoute = router.getRouteName() === 'admin-rooms';\n  var deleteRoomEndpoint = useEndpoint('POST', '/v1/rooms.delete');\n  var deleteTeamEndpoint = useEndpoint('POST', '/v1/teams.delete');\n  var teamsInfoEndpoint = useEndpoint('GET', '/v1/teams.info');\n  var teamId = room.teamId || '';\n  var _useQuery = useQuery(['teamId', teamId], function () {\n      function _callee() {\n        return _regeneratorRuntime.async(function () {\n          function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                return _context.abrupt(\"return\", teamsInfoEndpoint({\n                  teamId: teamId\n                }));\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n          return _callee$;\n        }(), null, null, null, Promise);\n      }\n      return _callee;\n    }(), {\n      keepPreviousData: true,\n      retry: false,\n      enabled: room.teamId !== ''\n    }),\n    teamInfoData = _useQuery.data;\n  var hasPermissionToDeleteRoom = usePermission(\"delete-\" + room.t, room._id);\n  var hasPermissionToDeleteTeamRoom = usePermission(\"delete-team-\" + (room.t === 'c' ? 'channel' : 'group'), teamInfoData === null || teamInfoData === void 0 ? void 0 : teamInfoData.teamInfo.roomId);\n  var isTeamRoom = room.teamId;\n  var canDeleteRoom = isRoomFederated(room) ? false : hasPermissionToDeleteRoom && (!isTeamRoom || hasPermissionToDeleteTeamRoom);\n  var deleteRoomMutation = useMutation({\n    mutationFn: deleteRoomEndpoint,\n    onSuccess: function () {\n      dispatchToastMessage({\n        type: 'success',\n        message: t('Deleted_roomType', {\n          roomName: room.name,\n          roomType: roomType\n        })\n      });\n      if (isAdminRoute) {\n        return router.navigate('/admin/rooms');\n      }\n      return router.navigate('/home');\n    },\n    onError: function (error) {\n      dispatchToastMessage({\n        type: 'error',\n        message: error\n      });\n    },\n    onSettled: function () {\n      setModal(null);\n      reload === null || reload === void 0 ? void 0 : reload();\n    }\n  });\n  var deleteTeamMutation = useMutation({\n    mutationFn: deleteTeamEndpoint,\n    onSuccess: function () {\n      dispatchToastMessage({\n        type: 'success',\n        message: t('Team_has_been_deleted')\n      });\n      if (isAdminRoute) {\n        return router.navigate('/admin/rooms');\n      }\n      return router.navigate('/home');\n    },\n    onError: function (error) {\n      dispatchToastMessage({\n        type: 'error',\n        message: error\n      });\n    },\n    onSettled: function () {\n      setModal(null);\n      reload === null || reload === void 0 ? void 0 : reload();\n    }\n  });\n  var isDeleting = deleteTeamMutation.isLoading || deleteRoomMutation.isLoading;\n  var handleDelete = useMutableCallback(function () {\n    var handleDeleteTeam = function () {\n      function _callee2(roomsToRemove) {\n        return _regeneratorRuntime.async(function () {\n          function _callee2$(_context2) {\n            while (1) switch (_context2.prev = _context2.next) {\n              case 0:\n                if (room.teamId) {\n                  _context2.next = 2;\n                  break;\n                }\n                return _context2.abrupt(\"return\");\n              case 2:\n                deleteTeamMutation.mutateAsync(_objectSpread({\n                  teamId: room.teamId\n                }, roomsToRemove.length && {\n                  roomsToRemove: roomsToRemove\n                }));\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n          return _callee2$;\n        }(), null, null, null, Promise);\n      }\n      return _callee2;\n    }();\n    if (room.teamMain && room.teamId) {\n      return setModal( /*#__PURE__*/React.createElement(DeleteTeamModal, {\n        onConfirm: handleDeleteTeam,\n        onCancel: function () {\n          return setModal(null);\n        },\n        teamId: room.teamId\n      }));\n    }\n    var handleDeleteRoom = function () {\n      function _callee3() {\n        return _regeneratorRuntime.async(function () {\n          function _callee3$(_context3) {\n            while (1) switch (_context3.prev = _context3.next) {\n              case 0:\n                deleteRoomMutation.mutateAsync({\n                  roomId: room._id\n                });\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n          return _callee3$;\n        }(), null, null, null, Promise);\n      }\n      return _callee3;\n    }();\n    setModal( /*#__PURE__*/React.createElement(GenericModal, {\n      title: t('Delete_roomType', {\n        roomType: roomType\n      }),\n      variant: \"danger\",\n      onConfirm: handleDeleteRoom,\n      onCancel: function () {\n        return setModal(null);\n      },\n      confirmText: t('Yes_delete_it')\n    }, t('Delete_Room_Warning', {\n      roomType: roomType\n    })));\n  });\n  return {\n    handleDelete: handleDelete,\n    canDeleteRoom: canDeleteRoom,\n    isDeleting: isDeleting\n  };\n};","map":{"version":3,"names":["_objectSpread","module","link","default","v","_regeneratorRuntime","export","useDeleteRoom","isRoomFederated","useMutableCallback","useSetModal","useToastMessageDispatch","useRouter","usePermission","useEndpoint","useTranslation","useMutation","useQuery","React","GenericModal","DeleteTeamModal","room","_ref","arguments","length","undefined","reload","t","router","setModal","dispatchToastMessage","roomType","teamId","teamMain","isAdminRoute","getRouteName","deleteRoomEndpoint","deleteTeamEndpoint","teamsInfoEndpoint","_useQuery","_callee","async","_callee$","_context","prev","next","abrupt","stop","Promise","keepPreviousData","retry","enabled","teamInfoData","data","hasPermissionToDeleteRoom","_id","hasPermissionToDeleteTeamRoom","teamInfo","roomId","isTeamRoom","canDeleteRoom","deleteRoomMutation","mutationFn","onSuccess","type","message","roomName","name","navigate","onError","error","onSettled","deleteTeamMutation","isDeleting","isLoading","handleDelete","handleDeleteTeam","_callee2","roomsToRemove","_callee2$","_context2","mutateAsync","createElement","onConfirm","onCancel","handleDeleteRoom","_callee3","_callee3$","_context3","title","variant","confirmText"],"sources":["client/views/hooks/roomActions/useDeleteRoom.tsx"],"sourcesContent":["import type { IRoom, RoomAdminFieldsType } from '@rocket.chat/core-typings';\nimport { isRoomFederated } from '@rocket.chat/core-typings';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useSetModal, useToastMessageDispatch, useRouter, usePermission, useEndpoint, useTranslation } from '@rocket.chat/ui-contexts';\nimport { useMutation, useQuery } from '@tanstack/react-query';\nimport React from 'react';\n\nimport GenericModal from '../../../components/GenericModal';\nimport DeleteTeamModal from '../../teams/contextualBar/info/DeleteTeam';\n\nexport const useDeleteRoom = (room: IRoom | Pick<IRoom, RoomAdminFieldsType>, { reload }: { reload?: () => void } = {}) => {\n\tconst t = useTranslation();\n\tconst router = useRouter();\n\tconst setModal = useSetModal();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\t// eslint-disable-next-line no-nested-ternary\n\tconst roomType = 'prid' in room ? 'discussion' : room.teamId && room.teamMain ? 'team' : 'channel';\n\tconst isAdminRoute = router.getRouteName() === 'admin-rooms';\n\n\tconst deleteRoomEndpoint = useEndpoint('POST', '/v1/rooms.delete');\n\tconst deleteTeamEndpoint = useEndpoint('POST', '/v1/teams.delete');\n\tconst teamsInfoEndpoint = useEndpoint('GET', '/v1/teams.info');\n\n\tconst teamId = room.teamId || '';\n\tconst { data: teamInfoData } = useQuery(['teamId', teamId], async () => teamsInfoEndpoint({ teamId }), {\n\t\tkeepPreviousData: true,\n\t\tretry: false,\n\t\tenabled: room.teamId !== '',\n\t});\n\n\tconst hasPermissionToDeleteRoom = usePermission(`delete-${room.t}`, room._id);\n\tconst hasPermissionToDeleteTeamRoom = usePermission(`delete-team-${room.t === 'c' ? 'channel' : 'group'}`, teamInfoData?.teamInfo.roomId);\n\tconst isTeamRoom = room.teamId;\n\tconst canDeleteRoom = isRoomFederated(room) ? false : hasPermissionToDeleteRoom && (!isTeamRoom || hasPermissionToDeleteTeamRoom);\n\n\tconst deleteRoomMutation = useMutation({\n\t\tmutationFn: deleteRoomEndpoint,\n\t\tonSuccess: () => {\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Deleted_roomType', { roomName: room.name, roomType }) });\n\t\t\tif (isAdminRoute) {\n\t\t\t\treturn router.navigate('/admin/rooms');\n\t\t\t}\n\n\t\t\treturn router.navigate('/home');\n\t\t},\n\t\tonError: (error) => {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t\tonSettled: () => {\n\t\t\tsetModal(null);\n\t\t\treload?.();\n\t\t},\n\t});\n\n\tconst deleteTeamMutation = useMutation({\n\t\tmutationFn: deleteTeamEndpoint,\n\t\tonSuccess: () => {\n\t\t\tdispatchToastMessage({ type: 'success', message: t('Team_has_been_deleted') });\n\t\t\tif (isAdminRoute) {\n\t\t\t\treturn router.navigate('/admin/rooms');\n\t\t\t}\n\n\t\t\treturn router.navigate('/home');\n\t\t},\n\t\tonError: (error) => {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t\tonSettled: () => {\n\t\t\tsetModal(null);\n\t\t\treload?.();\n\t\t},\n\t});\n\n\tconst isDeleting = deleteTeamMutation.isLoading || deleteRoomMutation.isLoading;\n\n\tconst handleDelete = useMutableCallback(() => {\n\t\tconst handleDeleteTeam = async (roomsToRemove: IRoom['_id'][]) => {\n\t\t\tif (!room.teamId) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdeleteTeamMutation.mutateAsync({ teamId: room.teamId, ...(roomsToRemove.length && { roomsToRemove }) });\n\t\t};\n\n\t\tif (room.teamMain && room.teamId) {\n\t\t\treturn setModal(<DeleteTeamModal onConfirm={handleDeleteTeam} onCancel={(): void => setModal(null)} teamId={room.teamId} />);\n\t\t}\n\n\t\tconst handleDeleteRoom = async () => {\n\t\t\tdeleteRoomMutation.mutateAsync({ roomId: room._id });\n\t\t};\n\n\t\tsetModal(\n\t\t\t<GenericModal\n\t\t\t\ttitle={t('Delete_roomType', { roomType })}\n\t\t\t\tvariant='danger'\n\t\t\t\tonConfirm={handleDeleteRoom}\n\t\t\t\tonCancel={(): void => setModal(null)}\n\t\t\t\tconfirmText={t('Yes_delete_it')}\n\t\t\t>\n\t\t\t\t{t('Delete_Room_Warning', { roomType })}\n\t\t\t</GenericModal>,\n\t\t);\n\t});\n\n\treturn { handleDelete, canDeleteRoom, isDeleting };\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"a73f746b0894f79400a7381e0a28c0d17b7c21e8"}
