{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/webdav/SaveToWebdavModal.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/room/webdav/SaveToWebdavModal.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/webdav/SaveToWebdavModal.tsx","inputSourceMap":{"version":3,"file":"client/views/room/webdav/SaveToWebdavModal.tsx","sourceRoot":"","sources":["client/views/room/webdav/SaveToWebdavModal.tsx"],"names":[],"mappings":"AAEA,OAAO,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM,EAAE,UAAU,EAAE,KAAK,EAAE,UAAU,EAAE,QAAQ,EAAE,UAAU,EAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,uBAAuB,CAAC;AAClI,OAAO,EAAE,WAAW,EAAE,MAAM,6BAA6B,CAAC;AAC1D,OAAO,EAAE,SAAS,EAAE,UAAU,EAAE,uBAAuB,EAAE,MAAM,0BAA0B,CAAC;AAE1F,OAAO,KAAK,EAAE,EAAE,QAAQ,EAAE,OAAO,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,OAAO,CAAC;AACpE,OAAO,EAAE,OAAO,EAAE,UAAU,EAAE,MAAM,iBAAiB,CAAC;AACtD,OAAO,EAAE,cAAc,EAAE,MAAM,eAAe,CAAC;AAE/C,OAAO,EAAE,iCAAiC,EAAE,MAAM,yDAAyD,CAAC;AAC5G,OAAO,EAAE,mBAAmB,EAAE,MAAM,kCAAkC,CAAC;AAUvE,MAAM,iBAAiB,GAAG,CAAC,EAAE,OAAO,EAAE,IAAI,EAA0B,EAAgB,EAAE;IACrF,MAAM,EAAE,CAAC,EAAE,GAAG,cAAc,EAAE,CAAC;IAC/B,MAAM,CAAC,SAAS,EAAE,YAAY,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;IAClD,MAAM,oBAAoB,GAAG,uBAAuB,EAAE,CAAC;IACvD,MAAM,kBAAkB,GAAG,SAAS,CAAC,oBAAoB,CAAC,CAAC;IAC3D,MAAM,WAAW,GAAG,MAAM,CAAwB,IAAI,CAAC,CAAC;IACxD,MAAM,cAAc,GAAG,WAAW,EAAE,CAAC;IAErC,MAAM,EACL,OAAO,EACP,YAAY,EACZ,SAAS,EAAE,EAAE,MAAM,EAAE,GACrB,GAAG,OAAO,CAAwB,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC;IAEpD,MAAM,OAAO,GAAG,UAAU,CAAU,4BAA4B,EAAE,KAAK,CAAC,CAAC;IAEzE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,iCAAiC,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC;IAEvE,MAAM,eAAe,GAAmB,OAAO,CAAC,GAAG,EAAE;QACpD,OAAO,KAAK,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,EAAE,GAAG,OAAO,EAAE,EAAE,EAAE,CAAC,CAAC,GAAG,EAAE,mBAAmB,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;IACvF,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC;IAEZ,SAAS,CAAC,GAAG,EAAE,CAAC,WAAW,CAAC,OAAO,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC;IAEhD,MAAM,cAAc,GAAG,CAAC,EAAE,SAAS,EAAwC,EAAQ,EAAE;QACpF,YAAY,CAAC,IAAI,CAAC,CAAC;QAEnB,MAAM,EACL,GAAG,EACH,UAAU,EAAE,EAAE,KAAK,EAAE,GACrB,GAAG,IAAI,CAAC;QAET,WAAW,CAAC,OAAO,GAAG,IAAI,cAAc,EAAE,CAAC;QAC3C,WAAW,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;QAC3C,WAAW,CAAC,OAAO,CAAC,YAAY,GAAG,aAAa,CAAC;QACjD,WAAW,CAAC,OAAO,CAAC,MAAM,GAAG,KAAK,IAAmB,EAAE;YACtD,MAAM,WAAW,GAAG,WAAW,CAAC,OAAO,EAAE,QAAQ,CAAC;YAClD,IAAI,WAAW,EAAE,CAAC;gBACjB,MAAM,QAAQ,GAAG,IAAI,UAAU,CAAC,WAAW,CAAC,CAAC;gBAE7C,IAAI,CAAC;oBACJ,IAAI,CAAC,KAAK,EAAE,CAAC;wBACZ,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;oBAC1C,CAAC;oBACD,MAAM,QAAQ,GAAG,MAAM,kBAAkB,CAAC,SAAS,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;oBACtE,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;wBACvB,MAAM,IAAI,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,sBAAsB,CAAC,CAAC;oBAClF,CAAC;oBACD,OAAO,oBAAoB,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,CAAC,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;gBAC/E,CAAC;gBAAC,OAAO,KAAK,EAAE,CAAC;oBAChB,OAAO,oBAAoB,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;gBAChE,CAAC;wBAAS,CAAC;oBACV,YAAY,CAAC,KAAK,CAAC,CAAC;oBACpB,OAAO,EAAE,CAAC;gBACX,CAAC;YACF,CAAC;QACF,CAAC,CAAC;QACF,WAAW,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAChC,CAAC,CAAC;IAEF,OAAO,CACN,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,EAAG,CAAC,CACvG;GAAA,CAAC,KAAK,CAAC,MAAM,CACZ;IAAA,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,CAC/C;IAAA,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,EAClD;GAAA,EAAE,KAAK,CAAC,MAAM,CACd;GAAA,CAAC,KAAK,CAAC,OAAO,CACb;IAAA,CAAC,SAAS,IAAI,CACb,CAAC,GAAG,CAAC,UAAU,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,cAAc,CAAC,QAAQ,CAAC,SAAS,CAAC,KAAK,CAC9E;MAAA,CAAC,QAAQ,CAAC,AAAD,EACV;KAAA,EAAE,GAAG,CAAC,CACN,CACD;IAAA,CAAC,CAAC,SAAS,IAAI,CACd,CAAC,UAAU,CACV;MAAA,CAAC,KAAK,CACL;OAAA,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,wBAAwB,CAAC,CAAC,EAAE,UAAU,CACrD;OAAA,CAAC,QAAQ,CACR;QAAA,CAAC,UAAU,CACV,IAAI,CAAC,WAAW,CAChB,OAAO,CAAC,CAAC,OAAO,CAAC,CACjB,KAAK,CAAC,CAAC,EAAE,QAAQ,EAAE,CAAC,CAAC,gBAAgB,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC,wBAAwB,CAAC,EAAE,CAAC,EAAE,CAAC,CACjF,MAAM,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,EAAgB,EAAE,CAAC,CACpC,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,CAAC,OAAO,CAAC,CAAC,eAAe,CAAC,CAAC,EAAE,CAAC,CAAC,cAAc,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,kBAAkB,CAAC,CAAC,EAAG,CACvG,CAAC,EAEJ;OAAA,EAAE,QAAQ,CACV;OAAA,CAAC,MAAM,CAAC,SAAS,IAAI,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,EAAE,UAAU,CAAC,CACzE;MAAA,EAAE,KAAK,CACR;KAAA,EAAE,UAAU,CAAC,CACb,CACF;GAAA,EAAE,KAAK,CAAC,OAAO,CACf;GAAA,CAAC,KAAK,CAAC,MAAM,CACZ;IAAA,CAAC,KAAK,CAAC,iBAAiB,CACvB;KAAA,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,MAAM,CAC/C;KAAA,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,CAChD;MAAA,CAAC,CAAC,CAAC,gBAAgB,CAAC,CACrB;KAAA,EAAE,MAAM,CACT;IAAA,EAAE,KAAK,CAAC,iBAAiB,CAC1B;GAAA,EAAE,KAAK,CAAC,MAAM,CACf;EAAA,EAAE,KAAK,CAAC,CACR,CAAC;AACH,CAAC,CAAC;AACF,eAAe,iBAAiB,CAAC","sourcesContent":["import type { MessageAttachment, IWebdavAccount } from '@rocket.chat/core-typings';\nimport type { SelectOption } from '@rocket.chat/fuselage';\nimport { Modal, Box, Button, FieldGroup, Field, FieldLabel, FieldRow, FieldError, Select, Throbber } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { useMethod, useSetting, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useState, useMemo, useEffect, useRef } from 'react';\nimport { useForm, Controller } from 'react-hook-form';\nimport { useTranslation } from 'react-i18next';\n\nimport { useWebDAVAccountIntegrationsQuery } from '../../../hooks/webdav/useWebDAVAccountIntegrationsQuery';\nimport { getWebdavServerName } from '../../../lib/getWebdavServerName';\n\ntype SaveToWebdavModalProps = {\n\tonClose: () => void;\n\tdata: {\n\t\tattachment: MessageAttachment;\n\t\turl: string;\n\t};\n};\n\nconst SaveToWebdavModal = ({ onClose, data }: SaveToWebdavModalProps): ReactElement => {\n\tconst { t } = useTranslation();\n\tconst [isLoading, setIsLoading] = useState(false);\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst uploadFileToWebdav = useMethod('uploadFileToWebdav');\n\tconst fileRequest = useRef<XMLHttpRequest | null>(null);\n\tconst accountIdField = useUniqueId();\n\n\tconst {\n\t\tcontrol,\n\t\thandleSubmit,\n\t\tformState: { errors },\n\t} = useForm<{ accountId: string }>({ mode: 'all' });\n\n\tconst enabled = useSetting<boolean>('Webdav_Integration_Enabled', false);\n\n\tconst { data: value } = useWebDAVAccountIntegrationsQuery({ enabled });\n\n\tconst accountsOptions: SelectOption[] = useMemo(() => {\n\t\treturn value?.map(({ _id, ...current }) => [_id, getWebdavServerName(current)]) ?? [];\n\t}, [value]);\n\n\tuseEffect(() => fileRequest.current?.abort, []);\n\n\tconst handleSaveFile = ({ accountId }: { accountId: IWebdavAccount['_id'] }): void => {\n\t\tsetIsLoading(true);\n\n\t\tconst {\n\t\t\turl,\n\t\t\tattachment: { title },\n\t\t} = data;\n\n\t\tfileRequest.current = new XMLHttpRequest();\n\t\tfileRequest.current.open('GET', url, true);\n\t\tfileRequest.current.responseType = 'arraybuffer';\n\t\tfileRequest.current.onload = async (): Promise<void> => {\n\t\t\tconst arrayBuffer = fileRequest.current?.response;\n\t\t\tif (arrayBuffer) {\n\t\t\t\tconst fileData = new Uint8Array(arrayBuffer);\n\n\t\t\t\ttry {\n\t\t\t\t\tif (!title) {\n\t\t\t\t\t\tthrow new Error('File name is required');\n\t\t\t\t\t}\n\t\t\t\t\tconst response = await uploadFileToWebdav(accountId, fileData, title);\n\t\t\t\t\tif (!response.success) {\n\t\t\t\t\t\tthrow new Error(response.message ? t(response.message) : 'Error uploading file');\n\t\t\t\t\t}\n\t\t\t\t\treturn dispatchToastMessage({ type: 'success', message: t('File_uploaded') });\n\t\t\t\t} catch (error) {\n\t\t\t\t\treturn dispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t} finally {\n\t\t\t\t\tsetIsLoading(false);\n\t\t\t\t\tonClose();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tfileRequest.current.send(null);\n\t};\n\n\treturn (\n\t\t<Modal wrapperFunction={(props) => <Box is='form' onSubmit={handleSubmit(handleSaveFile)} {...props} />}>\n\t\t\t<Modal.Header>\n\t\t\t\t<Modal.Title>{t('Save_To_Webdav')}</Modal.Title>\n\t\t\t\t<Modal.Close title={t('Close')} onClick={onClose} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content>\n\t\t\t\t{isLoading && (\n\t\t\t\t\t<Box alignItems='center' display='flex' justifyContent='center' minHeight='x32'>\n\t\t\t\t\t\t<Throbber />\n\t\t\t\t\t</Box>\n\t\t\t\t)}\n\t\t\t\t{!isLoading && (\n\t\t\t\t\t<FieldGroup>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<FieldLabel>{t('Select_a_webdav_server')}</FieldLabel>\n\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t<Controller\n\t\t\t\t\t\t\t\t\tname='accountId'\n\t\t\t\t\t\t\t\t\tcontrol={control}\n\t\t\t\t\t\t\t\t\trules={{ required: t('Required_field', { field: t('Select_a_webdav_server') }) }}\n\t\t\t\t\t\t\t\t\trender={({ field }): ReactElement => (\n\t\t\t\t\t\t\t\t\t\t<Select {...field} options={accountsOptions} id={accountIdField} placeholder={t('Select_an_option')} />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t{errors.accountId && <FieldError>{errors.accountId.message}</FieldError>}\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t</FieldGroup>\n\t\t\t\t)}\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<Modal.FooterControllers>\n\t\t\t\t\t<Button onClick={onClose}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button primary type='submit' loading={isLoading}>\n\t\t\t\t\t\t{t('Save_To_Webdav')}\n\t\t\t\t\t</Button>\n\t\t\t\t</Modal.FooterControllers>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\nexport default SaveToWebdavModal;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/webdav/SaveToWebdavModal.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/room/webdav/SaveToWebdavModal.tsx","inputSourceMap":{"version":3,"file":"client/views/room/webdav/SaveToWebdavModal.tsx","sourceRoot":"","sources":["client/views/room/webdav/SaveToWebdavModal.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { MessageAttachment, IWebdavAccount } from '@rocket.chat/core-typings';\nimport type { SelectOption } from '@rocket.chat/fuselage';\nimport { Modal, Box, Button, FieldGroup, Field, FieldLabel, FieldRow, FieldError, Select, Throbber } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { useMethod, useSetting, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useState, useMemo, useEffect, useRef } from 'react';\nimport { useForm, Controller } from 'react-hook-form';\nimport { useTranslation } from 'react-i18next';\n\nimport { useWebDAVAccountIntegrationsQuery } from '../../../hooks/webdav/useWebDAVAccountIntegrationsQuery';\nimport { getWebdavServerName } from '../../../lib/getWebdavServerName';\n\ntype SaveToWebdavModalProps = {\n\tonClose: () => void;\n\tdata: {\n\t\tattachment: MessageAttachment;\n\t\turl: string;\n\t};\n};\n\nconst SaveToWebdavModal = ({ onClose, data }: SaveToWebdavModalProps): ReactElement => {\n\tconst { t } = useTranslation();\n\tconst [isLoading, setIsLoading] = useState(false);\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst uploadFileToWebdav = useMethod('uploadFileToWebdav');\n\tconst fileRequest = useRef<XMLHttpRequest | null>(null);\n\tconst accountIdField = useUniqueId();\n\n\tconst {\n\t\tcontrol,\n\t\thandleSubmit,\n\t\tformState: { errors },\n\t} = useForm<{ accountId: string }>({ mode: 'all' });\n\n\tconst enabled = useSetting<boolean>('Webdav_Integration_Enabled', false);\n\n\tconst { data: value } = useWebDAVAccountIntegrationsQuery({ enabled });\n\n\tconst accountsOptions: SelectOption[] = useMemo(() => {\n\t\treturn value?.map(({ _id, ...current }) => [_id, getWebdavServerName(current)]) ?? [];\n\t}, [value]);\n\n\tuseEffect(() => fileRequest.current?.abort, []);\n\n\tconst handleSaveFile = ({ accountId }: { accountId: IWebdavAccount['_id'] }): void => {\n\t\tsetIsLoading(true);\n\n\t\tconst {\n\t\t\turl,\n\t\t\tattachment: { title },\n\t\t} = data;\n\n\t\tfileRequest.current = new XMLHttpRequest();\n\t\tfileRequest.current.open('GET', url, true);\n\t\tfileRequest.current.responseType = 'arraybuffer';\n\t\tfileRequest.current.onload = async (): Promise<void> => {\n\t\t\tconst arrayBuffer = fileRequest.current?.response;\n\t\t\tif (arrayBuffer) {\n\t\t\t\tconst fileData = new Uint8Array(arrayBuffer);\n\n\t\t\t\ttry {\n\t\t\t\t\tif (!title) {\n\t\t\t\t\t\tthrow new Error('File name is required');\n\t\t\t\t\t}\n\t\t\t\t\tconst response = await uploadFileToWebdav(accountId, fileData, title);\n\t\t\t\t\tif (!response.success) {\n\t\t\t\t\t\tthrow new Error(response.message ? t(response.message) : 'Error uploading file');\n\t\t\t\t\t}\n\t\t\t\t\treturn dispatchToastMessage({ type: 'success', message: t('File_uploaded') });\n\t\t\t\t} catch (error) {\n\t\t\t\t\treturn dispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t} finally {\n\t\t\t\t\tsetIsLoading(false);\n\t\t\t\t\tonClose();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tfileRequest.current.send(null);\n\t};\n\n\treturn (\n\t\t<Modal wrapperFunction={(props) => <Box is='form' onSubmit={handleSubmit(handleSaveFile)} {...props} />}>\n\t\t\t<Modal.Header>\n\t\t\t\t<Modal.Title>{t('Save_To_Webdav')}</Modal.Title>\n\t\t\t\t<Modal.Close title={t('Close')} onClick={onClose} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content>\n\t\t\t\t{isLoading && (\n\t\t\t\t\t<Box alignItems='center' display='flex' justifyContent='center' minHeight='x32'>\n\t\t\t\t\t\t<Throbber />\n\t\t\t\t\t</Box>\n\t\t\t\t)}\n\t\t\t\t{!isLoading && (\n\t\t\t\t\t<FieldGroup>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<FieldLabel>{t('Select_a_webdav_server')}</FieldLabel>\n\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t<Controller\n\t\t\t\t\t\t\t\t\tname='accountId'\n\t\t\t\t\t\t\t\t\tcontrol={control}\n\t\t\t\t\t\t\t\t\trules={{ required: t('Required_field', { field: t('Select_a_webdav_server') }) }}\n\t\t\t\t\t\t\t\t\trender={({ field }): ReactElement => (\n\t\t\t\t\t\t\t\t\t\t<Select {...field} options={accountsOptions} id={accountIdField} placeholder={t('Select_an_option')} />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t{errors.accountId && <FieldError>{errors.accountId.message}</FieldError>}\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t</FieldGroup>\n\t\t\t\t)}\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<Modal.FooterControllers>\n\t\t\t\t\t<Button onClick={onClose}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button primary type='submit' loading={isLoading}>\n\t\t\t\t\t\t{t('Save_To_Webdav')}\n\t\t\t\t\t</Button>\n\t\t\t\t</Modal.FooterControllers>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\nexport default SaveToWebdavModal;\n"]}}},"code":"const _excluded = [\"_id\"];\nlet _extends;\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default(v) {\n    _extends = v;\n  }\n}, 0);\nlet _objectWithoutProperties;\nmodule.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n  default(v) {\n    _objectWithoutProperties = v;\n  }\n}, 1);\nlet Modal, Box, Button, FieldGroup, Field, FieldLabel, FieldRow, FieldError, Select, Throbber;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Modal(v) {\n    Modal = v;\n  },\n  Box(v) {\n    Box = v;\n  },\n  Button(v) {\n    Button = v;\n  },\n  FieldGroup(v) {\n    FieldGroup = v;\n  },\n  Field(v) {\n    Field = v;\n  },\n  FieldLabel(v) {\n    FieldLabel = v;\n  },\n  FieldRow(v) {\n    FieldRow = v;\n  },\n  FieldError(v) {\n    FieldError = v;\n  },\n  Select(v) {\n    Select = v;\n  },\n  Throbber(v) {\n    Throbber = v;\n  }\n}, 0);\nlet useUniqueId;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useUniqueId(v) {\n    useUniqueId = v;\n  }\n}, 1);\nlet useMethod, useSetting, useToastMessageDispatch;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useMethod(v) {\n    useMethod = v;\n  },\n  useSetting(v) {\n    useSetting = v;\n  },\n  useToastMessageDispatch(v) {\n    useToastMessageDispatch = v;\n  }\n}, 2);\nlet React, useState, useMemo, useEffect, useRef;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n  useState(v) {\n    useState = v;\n  },\n  useMemo(v) {\n    useMemo = v;\n  },\n  useEffect(v) {\n    useEffect = v;\n  },\n  useRef(v) {\n    useRef = v;\n  }\n}, 3);\nlet useForm, Controller;\nmodule.link(\"react-hook-form\", {\n  useForm(v) {\n    useForm = v;\n  },\n  Controller(v) {\n    Controller = v;\n  }\n}, 4);\nlet useTranslation;\nmodule.link(\"react-i18next\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n}, 5);\nlet useWebDAVAccountIntegrationsQuery;\nmodule.link(\"../../../hooks/webdav/useWebDAVAccountIntegrationsQuery\", {\n  useWebDAVAccountIntegrationsQuery(v) {\n    useWebDAVAccountIntegrationsQuery = v;\n  }\n}, 6);\nlet getWebdavServerName;\nmodule.link(\"../../../lib/getWebdavServerName\", {\n  getWebdavServerName(v) {\n    getWebdavServerName = v;\n  }\n}, 7);\nconst SaveToWebdavModal = _ref => {\n  let {\n    onClose,\n    data\n  } = _ref;\n  const {\n    t\n  } = useTranslation();\n  const [isLoading, setIsLoading] = useState(false);\n  const dispatchToastMessage = useToastMessageDispatch();\n  const uploadFileToWebdav = useMethod('uploadFileToWebdav');\n  const fileRequest = useRef(null);\n  const accountIdField = useUniqueId();\n  const {\n    control,\n    handleSubmit,\n    formState: {\n      errors\n    }\n  } = useForm({\n    mode: 'all'\n  });\n  const enabled = useSetting('Webdav_Integration_Enabled', false);\n  const {\n    data: value\n  } = useWebDAVAccountIntegrationsQuery({\n    enabled\n  });\n  const accountsOptions = useMemo(() => {\n    var _value$map;\n    return (_value$map = value === null || value === void 0 ? void 0 : value.map(_ref2 => {\n      let {\n          _id\n        } = _ref2,\n        current = _objectWithoutProperties(_ref2, _excluded);\n      return [_id, getWebdavServerName(current)];\n    })) !== null && _value$map !== void 0 ? _value$map : [];\n  }, [value]);\n  useEffect(() => {\n    var _fileRequest$current;\n    return (_fileRequest$current = fileRequest.current) === null || _fileRequest$current === void 0 ? void 0 : _fileRequest$current.abort;\n  }, []);\n  const handleSaveFile = _ref3 => {\n    let {\n      accountId\n    } = _ref3;\n    setIsLoading(true);\n    const {\n      url,\n      attachment: {\n        title\n      }\n    } = data;\n    fileRequest.current = new XMLHttpRequest();\n    fileRequest.current.open('GET', url, true);\n    fileRequest.current.responseType = 'arraybuffer';\n    fileRequest.current.onload = async () => {\n      var _fileRequest$current2;\n      const arrayBuffer = (_fileRequest$current2 = fileRequest.current) === null || _fileRequest$current2 === void 0 ? void 0 : _fileRequest$current2.response;\n      if (arrayBuffer) {\n        const fileData = new Uint8Array(arrayBuffer);\n        try {\n          if (!title) {\n            throw new Error('File name is required');\n          }\n          const response = await uploadFileToWebdav(accountId, fileData, title);\n          if (!response.success) {\n            throw new Error(response.message ? t(response.message) : 'Error uploading file');\n          }\n          return dispatchToastMessage({\n            type: 'success',\n            message: t('File_uploaded')\n          });\n        } catch (error) {\n          return dispatchToastMessage({\n            type: 'error',\n            message: error\n          });\n        } finally {\n          setIsLoading(false);\n          onClose();\n        }\n      }\n    };\n    fileRequest.current.send(null);\n  };\n  return /*#__PURE__*/React.createElement(Modal, {\n    wrapperFunction: props => /*#__PURE__*/React.createElement(Box, _extends({\n      is: \"form\",\n      onSubmit: handleSubmit(handleSaveFile)\n    }, props))\n  }, /*#__PURE__*/React.createElement(Modal.Header, null, /*#__PURE__*/React.createElement(Modal.Title, null, t('Save_To_Webdav')), /*#__PURE__*/React.createElement(Modal.Close, {\n    title: t('Close'),\n    onClick: onClose\n  })), /*#__PURE__*/React.createElement(Modal.Content, null, isLoading && /*#__PURE__*/React.createElement(Box, {\n    alignItems: \"center\",\n    display: \"flex\",\n    justifyContent: \"center\",\n    minHeight: \"x32\"\n  }, /*#__PURE__*/React.createElement(Throbber, null)), !isLoading && /*#__PURE__*/React.createElement(FieldGroup, null, /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(FieldLabel, null, t('Select_a_webdav_server')), /*#__PURE__*/React.createElement(FieldRow, null, /*#__PURE__*/React.createElement(Controller, {\n    name: \"accountId\",\n    control: control,\n    rules: {\n      required: t('Required_field', {\n        field: t('Select_a_webdav_server')\n      })\n    },\n    render: _ref4 => {\n      let {\n        field\n      } = _ref4;\n      return /*#__PURE__*/React.createElement(Select, _extends({}, field, {\n        options: accountsOptions,\n        id: accountIdField,\n        placeholder: t('Select_an_option')\n      }));\n    }\n  })), errors.accountId && /*#__PURE__*/React.createElement(FieldError, null, errors.accountId.message)))), /*#__PURE__*/React.createElement(Modal.Footer, null, /*#__PURE__*/React.createElement(Modal.FooterControllers, null, /*#__PURE__*/React.createElement(Button, {\n    onClick: onClose\n  }, t('Cancel')), /*#__PURE__*/React.createElement(Button, {\n    primary: true,\n    type: \"submit\",\n    loading: isLoading\n  }, t('Save_To_Webdav')))));\n};\nmodule.exportDefault(SaveToWebdavModal);","map":{"version":3,"names":["_extends","module","link","default","v","_objectWithoutProperties","Modal","Box","Button","FieldGroup","Field","FieldLabel","FieldRow","FieldError","Select","Throbber","useUniqueId","useMethod","useSetting","useToastMessageDispatch","React","useState","useMemo","useEffect","useRef","useForm","Controller","useTranslation","useWebDAVAccountIntegrationsQuery","getWebdavServerName","SaveToWebdavModal","_ref","onClose","data","t","isLoading","setIsLoading","dispatchToastMessage","uploadFileToWebdav","fileRequest","accountIdField","control","handleSubmit","formState","errors","mode","enabled","value","accountsOptions","_value$map","map","_ref2","_id","current","_excluded","_fileRequest$current","abort","handleSaveFile","_ref3","accountId","url","attachment","title","XMLHttpRequest","open","responseType","onload","_fileRequest$current2","arrayBuffer","response","fileData","Uint8Array","Error","success","message","type","error","send","createElement","wrapperFunction","props","is","onSubmit","Header","Title","Close","onClick","Content","alignItems","display","justifyContent","minHeight","name","rules","required","field","render","_ref4","options","id","placeholder","Footer","FooterControllers","primary","loading","exportDefault"],"sources":["client/views/room/webdav/SaveToWebdavModal.tsx"],"sourcesContent":["import type { MessageAttachment, IWebdavAccount } from '@rocket.chat/core-typings';\nimport type { SelectOption } from '@rocket.chat/fuselage';\nimport { Modal, Box, Button, FieldGroup, Field, FieldLabel, FieldRow, FieldError, Select, Throbber } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { useMethod, useSetting, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useState, useMemo, useEffect, useRef } from 'react';\nimport { useForm, Controller } from 'react-hook-form';\nimport { useTranslation } from 'react-i18next';\n\nimport { useWebDAVAccountIntegrationsQuery } from '../../../hooks/webdav/useWebDAVAccountIntegrationsQuery';\nimport { getWebdavServerName } from '../../../lib/getWebdavServerName';\n\ntype SaveToWebdavModalProps = {\n\tonClose: () => void;\n\tdata: {\n\t\tattachment: MessageAttachment;\n\t\turl: string;\n\t};\n};\n\nconst SaveToWebdavModal = ({ onClose, data }: SaveToWebdavModalProps): ReactElement => {\n\tconst { t } = useTranslation();\n\tconst [isLoading, setIsLoading] = useState(false);\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\tconst uploadFileToWebdav = useMethod('uploadFileToWebdav');\n\tconst fileRequest = useRef<XMLHttpRequest | null>(null);\n\tconst accountIdField = useUniqueId();\n\n\tconst {\n\t\tcontrol,\n\t\thandleSubmit,\n\t\tformState: { errors },\n\t} = useForm<{ accountId: string }>({ mode: 'all' });\n\n\tconst enabled = useSetting<boolean>('Webdav_Integration_Enabled', false);\n\n\tconst { data: value } = useWebDAVAccountIntegrationsQuery({ enabled });\n\n\tconst accountsOptions: SelectOption[] = useMemo(() => {\n\t\treturn value?.map(({ _id, ...current }) => [_id, getWebdavServerName(current)]) ?? [];\n\t}, [value]);\n\n\tuseEffect(() => fileRequest.current?.abort, []);\n\n\tconst handleSaveFile = ({ accountId }: { accountId: IWebdavAccount['_id'] }): void => {\n\t\tsetIsLoading(true);\n\n\t\tconst {\n\t\t\turl,\n\t\t\tattachment: { title },\n\t\t} = data;\n\n\t\tfileRequest.current = new XMLHttpRequest();\n\t\tfileRequest.current.open('GET', url, true);\n\t\tfileRequest.current.responseType = 'arraybuffer';\n\t\tfileRequest.current.onload = async (): Promise<void> => {\n\t\t\tconst arrayBuffer = fileRequest.current?.response;\n\t\t\tif (arrayBuffer) {\n\t\t\t\tconst fileData = new Uint8Array(arrayBuffer);\n\n\t\t\t\ttry {\n\t\t\t\t\tif (!title) {\n\t\t\t\t\t\tthrow new Error('File name is required');\n\t\t\t\t\t}\n\t\t\t\t\tconst response = await uploadFileToWebdav(accountId, fileData, title);\n\t\t\t\t\tif (!response.success) {\n\t\t\t\t\t\tthrow new Error(response.message ? t(response.message) : 'Error uploading file');\n\t\t\t\t\t}\n\t\t\t\t\treturn dispatchToastMessage({ type: 'success', message: t('File_uploaded') });\n\t\t\t\t} catch (error) {\n\t\t\t\t\treturn dispatchToastMessage({ type: 'error', message: error });\n\t\t\t\t} finally {\n\t\t\t\t\tsetIsLoading(false);\n\t\t\t\t\tonClose();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tfileRequest.current.send(null);\n\t};\n\n\treturn (\n\t\t<Modal wrapperFunction={(props) => <Box is='form' onSubmit={handleSubmit(handleSaveFile)} {...props} />}>\n\t\t\t<Modal.Header>\n\t\t\t\t<Modal.Title>{t('Save_To_Webdav')}</Modal.Title>\n\t\t\t\t<Modal.Close title={t('Close')} onClick={onClose} />\n\t\t\t</Modal.Header>\n\t\t\t<Modal.Content>\n\t\t\t\t{isLoading && (\n\t\t\t\t\t<Box alignItems='center' display='flex' justifyContent='center' minHeight='x32'>\n\t\t\t\t\t\t<Throbber />\n\t\t\t\t\t</Box>\n\t\t\t\t)}\n\t\t\t\t{!isLoading && (\n\t\t\t\t\t<FieldGroup>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<FieldLabel>{t('Select_a_webdav_server')}</FieldLabel>\n\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t<Controller\n\t\t\t\t\t\t\t\t\tname='accountId'\n\t\t\t\t\t\t\t\t\tcontrol={control}\n\t\t\t\t\t\t\t\t\trules={{ required: t('Required_field', { field: t('Select_a_webdav_server') }) }}\n\t\t\t\t\t\t\t\t\trender={({ field }): ReactElement => (\n\t\t\t\t\t\t\t\t\t\t<Select {...field} options={accountsOptions} id={accountIdField} placeholder={t('Select_an_option')} />\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t{errors.accountId && <FieldError>{errors.accountId.message}</FieldError>}\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t</FieldGroup>\n\t\t\t\t)}\n\t\t\t</Modal.Content>\n\t\t\t<Modal.Footer>\n\t\t\t\t<Modal.FooterControllers>\n\t\t\t\t\t<Button onClick={onClose}>{t('Cancel')}</Button>\n\t\t\t\t\t<Button primary type='submit' loading={isLoading}>\n\t\t\t\t\t\t{t('Save_To_Webdav')}\n\t\t\t\t\t</Button>\n\t\t\t\t</Modal.FooterControllers>\n\t\t\t</Modal.Footer>\n\t\t</Modal>\n\t);\n};\nexport default SaveToWebdavModal;\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"c20792961ec90e8daab6b331b8df05bd608df833"}
