{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/message/content/UrlPreviews.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/components/message/content/UrlPreviews.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/message/content/UrlPreviews.tsx","inputSourceMap":{"version":3,"file":"client/components/message/content/UrlPreviews.tsx","sourceRoot":"","sources":["client/components/message/content/UrlPreviews.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { MessageBlock } from '@rocket.chat/fuselage';\nimport type { ReactElement } from 'react';\nimport React from 'react';\n\nimport { useOembedLayout } from '../hooks/useOembedLayout';\nimport type { OEmbedPreviewMetadata } from './urlPreviews/OEmbedPreviewMetadata';\nimport OEmbedResolver from './urlPreviews/OEmbedResolver';\nimport UrlPreview from './urlPreviews/UrlPreview';\nimport type { UrlPreviewMetadata } from './urlPreviews/UrlPreviewMetadata';\nimport { buildImageURL } from './urlPreviews/buildImageURL';\n\ntype OembedUrlLegacy = Required<IMessage>['urls'][0];\n\ntype PreviewTypes = 'headers' | 'oembed';\n\ntype PreviewData = {\n\ttype: PreviewTypes;\n\tdata: OEmbedPreviewMetadata | UrlPreviewMetadata;\n};\n\nconst normalizeMeta = ({ url, meta }: { url: string; meta: Record<string, string> }): OEmbedPreviewMetadata => {\n\tconst image = meta.ogImage || meta.twitterImage || meta.msapplicationTileImage || meta.oembedThumbnailUrl || meta.oembedThumbnailUrl;\n\n\tconst imageHeight = meta.ogImageHeight || meta.oembedHeight || meta.oembedThumbnailHeight;\n\tconst imageWidth = meta.ogImageWidth || meta.oembedWidth || meta.oembedThumbnailWidth;\n\n\treturn Object.fromEntries(\n\t\tObject.entries({\n\t\t\tsiteName: meta.ogSiteName || meta.oembedProviderName,\n\t\t\tsiteUrl: meta.ogUrl || meta.oembedProviderUrl,\n\t\t\ttitle: meta.ogTitle || meta.twitterTitle || meta.title || meta.pageTitle || meta.oembedTitle,\n\t\t\tdescription: meta.ogDescription || meta.twitterDescription || meta.description,\n\t\t\tauthorName: meta.oembedAuthorName,\n\t\t\tauthorUrl: meta.oembedAuthorUrl,\n\t\t\t...(image && {\n\t\t\t\timage: {\n\t\t\t\t\turl: buildImageURL(url, image),\n\t\t\t\t\tdimensions: {\n\t\t\t\t\t\t...(imageHeight && { height: imageHeight }),\n\t\t\t\t\t\t...(imageWidth && { width: imageWidth }),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t\turl: meta.oembedUrl || url,\n\t\t\ttype: meta.ogType || meta.oembedType,\n\t\t\t...(meta.oembedHtml && { html: meta.oembedHtml }),\n\t\t}).filter(([, value]) => value),\n\t);\n};\n\nconst hasContentType = (headers: OembedUrlLegacy['headers']): headers is { contentType: string } =>\n\theaders ? 'contentType' in headers : false;\n\nconst getHeaderType = (headers: OembedUrlLegacy['headers']): UrlPreviewMetadata['type'] | undefined => {\n\tif (!hasContentType(headers)) {\n\t\treturn;\n\t}\n\tif (headers.contentType.match(/image\\/.*/)) {\n\t\treturn 'image';\n\t}\n\tif (headers.contentType.match(/audio\\/.*/)) {\n\t\treturn 'audio';\n\t}\n\tif (headers.contentType.match(/video\\/.*/)) {\n\t\treturn 'video';\n\t}\n};\n\nconst isValidPreviewMeta = ({\n\tsiteName,\n\tsiteUrl,\n\tauthorName,\n\tauthorUrl,\n\ttitle,\n\tdescription,\n\timage,\n\thtml,\n}: OEmbedPreviewMetadata): boolean =>\n\t!((!siteName || !siteUrl) && (!authorName || !authorUrl) && !title && !description && !image && !html);\n\nconst hasMeta = (url: OembedUrlLegacy): url is { url: string; meta: Record<string, string> } => !!url.meta && !!Object.values(url.meta);\n\nconst processMetaAndHeaders = (url: OembedUrlLegacy): PreviewData | false => {\n\tif (!url.headers && !url.meta) {\n\t\treturn false;\n\t}\n\n\tconst data = hasMeta(url) ? normalizeMeta(url) : undefined;\n\tif (data && isValidPreviewMeta(data)) {\n\t\treturn { type: 'oembed', data };\n\t}\n\n\tconst type = getHeaderType(url.headers);\n\tif (!type) {\n\t\treturn false;\n\t}\n\n\treturn {\n\t\ttype: 'headers',\n\t\tdata: { url: url.url, type, originalType: hasContentType(url.headers) ? url.headers?.contentType : '' },\n\t};\n};\n\nconst isPreviewData = (data: PreviewData | false): data is PreviewData => !!data;\n\nconst isMetaPreview = (_data: PreviewData['data'], type: PreviewTypes): _data is OEmbedPreviewMetadata => type === 'oembed';\n\ntype UrlPreviewsProps = { urls: OembedUrlLegacy[] };\n\nconst UrlPreviews = ({ urls }: UrlPreviewsProps): ReactElement | null => {\n\tconst { maxWidth: oembedMaxWidth } = useOembedLayout();\n\tconst metaAndHeaders = urls.map(processMetaAndHeaders).filter(isPreviewData);\n\n\treturn (\n\t\t<>\n\t\t\t{metaAndHeaders.map(({ type, data }, index) => {\n\t\t\t\tif (isMetaPreview(data, type)) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<MessageBlock width='100%' maxWidth={oembedMaxWidth} key={index}>\n\t\t\t\t\t\t\t<OEmbedResolver meta={data} />\n\t\t\t\t\t\t</MessageBlock>\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn (\n\t\t\t\t\t<MessageBlock width='100%' maxWidth={oembedMaxWidth} key={index}>\n\t\t\t\t\t\t<UrlPreview {...data} />\n\t\t\t\t\t</MessageBlock>\n\t\t\t\t);\n\t\t\t})}\n\t\t</>\n\t);\n};\n\nexport default UrlPreviews;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/message/content/UrlPreviews.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/components/message/content/UrlPreviews.tsx","inputSourceMap":{"version":3,"file":"client/components/message/content/UrlPreviews.tsx","sourceRoot":"","sources":["client/components/message/content/UrlPreviews.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { MessageBlock } from '@rocket.chat/fuselage';\nimport type { ReactElement } from 'react';\nimport React from 'react';\n\nimport { useOembedLayout } from '../hooks/useOembedLayout';\nimport type { OEmbedPreviewMetadata } from './urlPreviews/OEmbedPreviewMetadata';\nimport OEmbedResolver from './urlPreviews/OEmbedResolver';\nimport UrlPreview from './urlPreviews/UrlPreview';\nimport type { UrlPreviewMetadata } from './urlPreviews/UrlPreviewMetadata';\nimport { buildImageURL } from './urlPreviews/buildImageURL';\n\ntype OembedUrlLegacy = Required<IMessage>['urls'][0];\n\ntype PreviewTypes = 'headers' | 'oembed';\n\ntype PreviewData = {\n\ttype: PreviewTypes;\n\tdata: OEmbedPreviewMetadata | UrlPreviewMetadata;\n};\n\nconst normalizeMeta = ({ url, meta }: { url: string; meta: Record<string, string> }): OEmbedPreviewMetadata => {\n\tconst image = meta.ogImage || meta.twitterImage || meta.msapplicationTileImage || meta.oembedThumbnailUrl || meta.oembedThumbnailUrl;\n\n\tconst imageHeight = meta.ogImageHeight || meta.oembedHeight || meta.oembedThumbnailHeight;\n\tconst imageWidth = meta.ogImageWidth || meta.oembedWidth || meta.oembedThumbnailWidth;\n\n\treturn Object.fromEntries(\n\t\tObject.entries({\n\t\t\tsiteName: meta.ogSiteName || meta.oembedProviderName,\n\t\t\tsiteUrl: meta.ogUrl || meta.oembedProviderUrl,\n\t\t\ttitle: meta.ogTitle || meta.twitterTitle || meta.title || meta.pageTitle || meta.oembedTitle,\n\t\t\tdescription: meta.ogDescription || meta.twitterDescription || meta.description,\n\t\t\tauthorName: meta.oembedAuthorName,\n\t\t\tauthorUrl: meta.oembedAuthorUrl,\n\t\t\t...(image && {\n\t\t\t\timage: {\n\t\t\t\t\turl: buildImageURL(url, image),\n\t\t\t\t\tdimensions: {\n\t\t\t\t\t\t...(imageHeight && { height: imageHeight }),\n\t\t\t\t\t\t...(imageWidth && { width: imageWidth }),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t\turl: meta.oembedUrl || url,\n\t\t\ttype: meta.ogType || meta.oembedType,\n\t\t\t...(meta.oembedHtml && { html: meta.oembedHtml }),\n\t\t}).filter(([, value]) => value),\n\t);\n};\n\nconst hasContentType = (headers: OembedUrlLegacy['headers']): headers is { contentType: string } =>\n\theaders ? 'contentType' in headers : false;\n\nconst getHeaderType = (headers: OembedUrlLegacy['headers']): UrlPreviewMetadata['type'] | undefined => {\n\tif (!hasContentType(headers)) {\n\t\treturn;\n\t}\n\tif (headers.contentType.match(/image\\/.*/)) {\n\t\treturn 'image';\n\t}\n\tif (headers.contentType.match(/audio\\/.*/)) {\n\t\treturn 'audio';\n\t}\n\tif (headers.contentType.match(/video\\/.*/)) {\n\t\treturn 'video';\n\t}\n};\n\nconst isValidPreviewMeta = ({\n\tsiteName,\n\tsiteUrl,\n\tauthorName,\n\tauthorUrl,\n\ttitle,\n\tdescription,\n\timage,\n\thtml,\n}: OEmbedPreviewMetadata): boolean =>\n\t!((!siteName || !siteUrl) && (!authorName || !authorUrl) && !title && !description && !image && !html);\n\nconst hasMeta = (url: OembedUrlLegacy): url is { url: string; meta: Record<string, string> } => !!url.meta && !!Object.values(url.meta);\n\nconst processMetaAndHeaders = (url: OembedUrlLegacy): PreviewData | false => {\n\tif (!url.headers && !url.meta) {\n\t\treturn false;\n\t}\n\n\tconst data = hasMeta(url) ? normalizeMeta(url) : undefined;\n\tif (data && isValidPreviewMeta(data)) {\n\t\treturn { type: 'oembed', data };\n\t}\n\n\tconst type = getHeaderType(url.headers);\n\tif (!type) {\n\t\treturn false;\n\t}\n\n\treturn {\n\t\ttype: 'headers',\n\t\tdata: { url: url.url, type, originalType: hasContentType(url.headers) ? url.headers?.contentType : '' },\n\t};\n};\n\nconst isPreviewData = (data: PreviewData | false): data is PreviewData => !!data;\n\nconst isMetaPreview = (_data: PreviewData['data'], type: PreviewTypes): _data is OEmbedPreviewMetadata => type === 'oembed';\n\ntype UrlPreviewsProps = { urls: OembedUrlLegacy[] };\n\nconst UrlPreviews = ({ urls }: UrlPreviewsProps): ReactElement | null => {\n\tconst { maxWidth: oembedMaxWidth } = useOembedLayout();\n\tconst metaAndHeaders = urls.map(processMetaAndHeaders).filter(isPreviewData);\n\n\treturn (\n\t\t<>\n\t\t\t{metaAndHeaders.map(({ type, data }, index) => {\n\t\t\t\tif (isMetaPreview(data, type)) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<MessageBlock width='100%' maxWidth={oembedMaxWidth} key={index}>\n\t\t\t\t\t\t\t<OEmbedResolver meta={data} />\n\t\t\t\t\t\t</MessageBlock>\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn (\n\t\t\t\t\t<MessageBlock width='100%' maxWidth={oembedMaxWidth} key={index}>\n\t\t\t\t\t\t<UrlPreview {...data} />\n\t\t\t\t\t</MessageBlock>\n\t\t\t\t);\n\t\t\t})}\n\t\t</>\n\t);\n};\n\nexport default UrlPreviews;\n"]}}},"code":"var _slicedToArray;\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 0);\nvar _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 1);\nvar MessageBlock;\nmodule.link(\"@rocket.chat/fuselage\", {\n  MessageBlock: function (v) {\n    MessageBlock = v;\n  }\n}, 0);\nvar React;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  }\n}, 1);\nvar useOembedLayout;\nmodule.link(\"../hooks/useOembedLayout\", {\n  useOembedLayout: function (v) {\n    useOembedLayout = v;\n  }\n}, 2);\nvar OEmbedResolver;\nmodule.link(\"./urlPreviews/OEmbedResolver\", {\n  \"default\": function (v) {\n    OEmbedResolver = v;\n  }\n}, 3);\nvar UrlPreview;\nmodule.link(\"./urlPreviews/UrlPreview\", {\n  \"default\": function (v) {\n    UrlPreview = v;\n  }\n}, 4);\nvar buildImageURL;\nmodule.link(\"./urlPreviews/buildImageURL\", {\n  buildImageURL: function (v) {\n    buildImageURL = v;\n  }\n}, 5);\nvar normalizeMeta = function (_ref) {\n  var url = _ref.url,\n    meta = _ref.meta;\n  var image = meta.ogImage || meta.twitterImage || meta.msapplicationTileImage || meta.oembedThumbnailUrl || meta.oembedThumbnailUrl;\n  var imageHeight = meta.ogImageHeight || meta.oembedHeight || meta.oembedThumbnailHeight;\n  var imageWidth = meta.ogImageWidth || meta.oembedWidth || meta.oembedThumbnailWidth;\n  return Object.fromEntries(Object.entries(_objectSpread(_objectSpread({\n    siteName: meta.ogSiteName || meta.oembedProviderName,\n    siteUrl: meta.ogUrl || meta.oembedProviderUrl,\n    title: meta.ogTitle || meta.twitterTitle || meta.title || meta.pageTitle || meta.oembedTitle,\n    description: meta.ogDescription || meta.twitterDescription || meta.description,\n    authorName: meta.oembedAuthorName,\n    authorUrl: meta.oembedAuthorUrl\n  }, image && {\n    image: {\n      url: buildImageURL(url, image),\n      dimensions: _objectSpread(_objectSpread({}, imageHeight && {\n        height: imageHeight\n      }), imageWidth && {\n        width: imageWidth\n      })\n    }\n  }), {}, {\n    url: meta.oembedUrl || url,\n    type: meta.ogType || meta.oembedType\n  }, meta.oembedHtml && {\n    html: meta.oembedHtml\n  })).filter(function (_ref2) {\n    var _ref3 = _slicedToArray(_ref2, 2),\n      value = _ref3[1];\n    return value;\n  }));\n};\nvar hasContentType = function (headers) {\n  return headers ? 'contentType' in headers : false;\n};\nvar getHeaderType = function (headers) {\n  if (!hasContentType(headers)) {\n    return;\n  }\n  if (headers.contentType.match(/image\\/.*/)) {\n    return 'image';\n  }\n  if (headers.contentType.match(/audio\\/.*/)) {\n    return 'audio';\n  }\n  if (headers.contentType.match(/video\\/.*/)) {\n    return 'video';\n  }\n};\nvar isValidPreviewMeta = function (_ref4) {\n  var siteName = _ref4.siteName,\n    siteUrl = _ref4.siteUrl,\n    authorName = _ref4.authorName,\n    authorUrl = _ref4.authorUrl,\n    title = _ref4.title,\n    description = _ref4.description,\n    image = _ref4.image,\n    html = _ref4.html;\n  return !((!siteName || !siteUrl) && (!authorName || !authorUrl) && !title && !description && !image && !html);\n};\nvar hasMeta = function (url) {\n  return !!url.meta && !!Object.values(url.meta);\n};\nvar processMetaAndHeaders = function (url) {\n  var _url$headers;\n  if (!url.headers && !url.meta) {\n    return false;\n  }\n  var data = hasMeta(url) ? normalizeMeta(url) : undefined;\n  if (data && isValidPreviewMeta(data)) {\n    return {\n      type: 'oembed',\n      data: data\n    };\n  }\n  var type = getHeaderType(url.headers);\n  if (!type) {\n    return false;\n  }\n  return {\n    type: 'headers',\n    data: {\n      url: url.url,\n      type: type,\n      originalType: hasContentType(url.headers) ? (_url$headers = url.headers) === null || _url$headers === void 0 ? void 0 : _url$headers.contentType : ''\n    }\n  };\n};\nvar isPreviewData = function (data) {\n  return !!data;\n};\nvar isMetaPreview = function (_data, type) {\n  return type === 'oembed';\n};\nvar UrlPreviews = function (_ref5) {\n  var urls = _ref5.urls;\n  var _useOembedLayout = useOembedLayout(),\n    oembedMaxWidth = _useOembedLayout.maxWidth;\n  var metaAndHeaders = urls.map(processMetaAndHeaders).filter(isPreviewData);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, metaAndHeaders.map(function (_ref6, index) {\n    var type = _ref6.type,\n      data = _ref6.data;\n    if (isMetaPreview(data, type)) {\n      return /*#__PURE__*/React.createElement(MessageBlock, {\n        width: \"100%\",\n        maxWidth: oembedMaxWidth,\n        key: index\n      }, /*#__PURE__*/React.createElement(OEmbedResolver, {\n        meta: data\n      }));\n    }\n    return /*#__PURE__*/React.createElement(MessageBlock, {\n      width: \"100%\",\n      maxWidth: oembedMaxWidth,\n      key: index\n    }, /*#__PURE__*/React.createElement(UrlPreview, data));\n  }));\n};\nmodule.exportDefault(UrlPreviews);","map":{"version":3,"names":["_slicedToArray","module","link","default","v","_objectSpread","MessageBlock","React","useOembedLayout","OEmbedResolver","UrlPreview","buildImageURL","normalizeMeta","_ref","url","meta","image","ogImage","twitterImage","msapplicationTileImage","oembedThumbnailUrl","imageHeight","ogImageHeight","oembedHeight","oembedThumbnailHeight","imageWidth","ogImageWidth","oembedWidth","oembedThumbnailWidth","Object","fromEntries","entries","siteName","ogSiteName","oembedProviderName","siteUrl","ogUrl","oembedProviderUrl","title","ogTitle","twitterTitle","pageTitle","oembedTitle","description","ogDescription","twitterDescription","authorName","oembedAuthorName","authorUrl","oembedAuthorUrl","dimensions","height","width","oembedUrl","type","ogType","oembedType","oembedHtml","html","filter","_ref2","_ref3","value","hasContentType","headers","getHeaderType","contentType","match","isValidPreviewMeta","_ref4","hasMeta","values","processMetaAndHeaders","_url$headers","data","undefined","originalType","isPreviewData","isMetaPreview","_data","UrlPreviews","_ref5","urls","_useOembedLayout","oembedMaxWidth","maxWidth","metaAndHeaders","map","createElement","Fragment","_ref6","index","key","exportDefault"],"sources":["client/components/message/content/UrlPreviews.tsx"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { MessageBlock } from '@rocket.chat/fuselage';\nimport type { ReactElement } from 'react';\nimport React from 'react';\n\nimport { useOembedLayout } from '../hooks/useOembedLayout';\nimport type { OEmbedPreviewMetadata } from './urlPreviews/OEmbedPreviewMetadata';\nimport OEmbedResolver from './urlPreviews/OEmbedResolver';\nimport UrlPreview from './urlPreviews/UrlPreview';\nimport type { UrlPreviewMetadata } from './urlPreviews/UrlPreviewMetadata';\nimport { buildImageURL } from './urlPreviews/buildImageURL';\n\ntype OembedUrlLegacy = Required<IMessage>['urls'][0];\n\ntype PreviewTypes = 'headers' | 'oembed';\n\ntype PreviewData = {\n\ttype: PreviewTypes;\n\tdata: OEmbedPreviewMetadata | UrlPreviewMetadata;\n};\n\nconst normalizeMeta = ({ url, meta }: { url: string; meta: Record<string, string> }): OEmbedPreviewMetadata => {\n\tconst image = meta.ogImage || meta.twitterImage || meta.msapplicationTileImage || meta.oembedThumbnailUrl || meta.oembedThumbnailUrl;\n\n\tconst imageHeight = meta.ogImageHeight || meta.oembedHeight || meta.oembedThumbnailHeight;\n\tconst imageWidth = meta.ogImageWidth || meta.oembedWidth || meta.oembedThumbnailWidth;\n\n\treturn Object.fromEntries(\n\t\tObject.entries({\n\t\t\tsiteName: meta.ogSiteName || meta.oembedProviderName,\n\t\t\tsiteUrl: meta.ogUrl || meta.oembedProviderUrl,\n\t\t\ttitle: meta.ogTitle || meta.twitterTitle || meta.title || meta.pageTitle || meta.oembedTitle,\n\t\t\tdescription: meta.ogDescription || meta.twitterDescription || meta.description,\n\t\t\tauthorName: meta.oembedAuthorName,\n\t\t\tauthorUrl: meta.oembedAuthorUrl,\n\t\t\t...(image && {\n\t\t\t\timage: {\n\t\t\t\t\turl: buildImageURL(url, image),\n\t\t\t\t\tdimensions: {\n\t\t\t\t\t\t...(imageHeight && { height: imageHeight }),\n\t\t\t\t\t\t...(imageWidth && { width: imageWidth }),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t\turl: meta.oembedUrl || url,\n\t\t\ttype: meta.ogType || meta.oembedType,\n\t\t\t...(meta.oembedHtml && { html: meta.oembedHtml }),\n\t\t}).filter(([, value]) => value),\n\t);\n};\n\nconst hasContentType = (headers: OembedUrlLegacy['headers']): headers is { contentType: string } =>\n\theaders ? 'contentType' in headers : false;\n\nconst getHeaderType = (headers: OembedUrlLegacy['headers']): UrlPreviewMetadata['type'] | undefined => {\n\tif (!hasContentType(headers)) {\n\t\treturn;\n\t}\n\tif (headers.contentType.match(/image\\/.*/)) {\n\t\treturn 'image';\n\t}\n\tif (headers.contentType.match(/audio\\/.*/)) {\n\t\treturn 'audio';\n\t}\n\tif (headers.contentType.match(/video\\/.*/)) {\n\t\treturn 'video';\n\t}\n};\n\nconst isValidPreviewMeta = ({\n\tsiteName,\n\tsiteUrl,\n\tauthorName,\n\tauthorUrl,\n\ttitle,\n\tdescription,\n\timage,\n\thtml,\n}: OEmbedPreviewMetadata): boolean =>\n\t!((!siteName || !siteUrl) && (!authorName || !authorUrl) && !title && !description && !image && !html);\n\nconst hasMeta = (url: OembedUrlLegacy): url is { url: string; meta: Record<string, string> } => !!url.meta && !!Object.values(url.meta);\n\nconst processMetaAndHeaders = (url: OembedUrlLegacy): PreviewData | false => {\n\tif (!url.headers && !url.meta) {\n\t\treturn false;\n\t}\n\n\tconst data = hasMeta(url) ? normalizeMeta(url) : undefined;\n\tif (data && isValidPreviewMeta(data)) {\n\t\treturn { type: 'oembed', data };\n\t}\n\n\tconst type = getHeaderType(url.headers);\n\tif (!type) {\n\t\treturn false;\n\t}\n\n\treturn {\n\t\ttype: 'headers',\n\t\tdata: { url: url.url, type, originalType: hasContentType(url.headers) ? url.headers?.contentType : '' },\n\t};\n};\n\nconst isPreviewData = (data: PreviewData | false): data is PreviewData => !!data;\n\nconst isMetaPreview = (_data: PreviewData['data'], type: PreviewTypes): _data is OEmbedPreviewMetadata => type === 'oembed';\n\ntype UrlPreviewsProps = { urls: OembedUrlLegacy[] };\n\nconst UrlPreviews = ({ urls }: UrlPreviewsProps): ReactElement | null => {\n\tconst { maxWidth: oembedMaxWidth } = useOembedLayout();\n\tconst metaAndHeaders = urls.map(processMetaAndHeaders).filter(isPreviewData);\n\n\treturn (\n\t\t<>\n\t\t\t{metaAndHeaders.map(({ type, data }, index) => {\n\t\t\t\tif (isMetaPreview(data, type)) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<MessageBlock width='100%' maxWidth={oembedMaxWidth} key={index}>\n\t\t\t\t\t\t\t<OEmbedResolver meta={data} />\n\t\t\t\t\t\t</MessageBlock>\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn (\n\t\t\t\t\t<MessageBlock width='100%' maxWidth={oembedMaxWidth} key={index}>\n\t\t\t\t\t\t<UrlPreview {...data} />\n\t\t\t\t\t</MessageBlock>\n\t\t\t\t);\n\t\t\t})}\n\t\t</>\n\t);\n};\n\nexport default UrlPreviews;\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"caef39c5a1ae790b42dda6ed116829d11b1f5e49"}
