{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx","inputSourceMap":{"version":3,"file":"client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx","sourceRoot":"","sources":["client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage, IRoom } from '@rocket.chat/core-typings';\nimport { css } from '@rocket.chat/css-in-js';\nimport { Box, ButtonGroup, Button, Icon, PositionAnimated } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useTranslation, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport type { AllHTMLAttributes, RefObject } from 'react';\nimport React, { useRef, useEffect, useState } from 'react';\n\nimport { UserAction, USER_ACTIVITIES } from '../../../../app/ui/client/lib/UserAction';\nimport { VideoRecorder } from '../../../../app/ui/client/lib/recorderjs/videoRecorder';\nimport type { ChatAPI } from '../../../lib/chats/ChatAPI';\nimport { useChat } from '../../room/contexts/ChatContext';\n\ntype VideoMessageRecorderProps = {\n\trid: IRoom['_id'];\n\ttmid?: IMessage['_id'];\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n\treference: RefObject<HTMLElement>;\n} & Omit<AllHTMLAttributes<HTMLDivElement>, 'is'>;\n\nconst videoContainerClass = css`\n\ttransform: scaleX(-1);\n\tfilter: FlipH;\n\n\t@media (max-width: 500px) {\n\t\t& > video {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t}\n\t}\n`;\n\nconst getVideoRecordingExtension = () => {\n\tconst supported = VideoRecorder.getSupportedMimeTypes();\n\tif (supported.match(/video\\/webm/)) {\n\t\treturn 'webm';\n\t}\n\treturn 'mp4';\n};\n\nconst VideoMessageRecorder = ({ rid, tmid, chatContext, reference }: VideoMessageRecorderProps) => {\n\tconst t = useTranslation();\n\tconst videoRef = useRef<HTMLVideoElement>(null);\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst [time, setTime] = useState<string | undefined>();\n\tconst [recordingState, setRecordingState] = useState<'idle' | 'loading' | 'recording'>('idle');\n\tconst [recordingInterval, setRecordingInterval] = useState<ReturnType<typeof setInterval> | null>(null);\n\tconst isRecording = recordingState === 'recording';\n\tconst sendButtonDisabled = !(VideoRecorder.cameraStarted.get() && !(recordingState === 'recording'));\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst stopVideoRecording = async (rid: IRoom['_id'], tmid?: IMessage['_id']) => {\n\t\tif (recordingInterval) {\n\t\t\tclearInterval(recordingInterval);\n\t\t}\n\t\tsetRecordingInterval(null);\n\t\tVideoRecorder.stopRecording();\n\t\tUserAction.stop(rid, USER_ACTIVITIES.USER_RECORDING, { tmid });\n\t\tsetRecordingState('idle');\n\t};\n\n\tconst handleRecord = async () => {\n\t\tif (recordingState === 'recording') {\n\t\t\tstopVideoRecording(rid, tmid);\n\t\t} else {\n\t\t\tVideoRecorder.record();\n\t\t\tsetRecordingState('recording');\n\t\t\tUserAction.performContinuously(rid, USER_ACTIVITIES.USER_RECORDING, { tmid });\n\t\t\tsetTime('00:00');\n\t\t\tconst startTime = new Date();\n\t\t\tsetRecordingInterval(\n\t\t\t\tsetInterval(() => {\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tconst distance = (now.getTime() - startTime.getTime()) / 1000;\n\t\t\t\t\tconst minutes = Math.floor(distance / 60);\n\t\t\t\t\tconst seconds = Math.floor(distance % 60);\n\t\t\t\t\tsetTime(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);\n\t\t\t\t}, 1000),\n\t\t\t);\n\t\t}\n\t};\n\n\tconst handleSendRecord = async () => {\n\t\tconst cb = async (blob: Blob) => {\n\t\t\tconst fileName = `${t('Video_record')}.${getVideoRecordingExtension()}`;\n\t\t\tconst file = new File([blob], fileName, { type: VideoRecorder.getSupportedMimeTypes().split(';')[0] });\n\t\t\tawait chat?.flows.uploadFiles([file]);\n\t\t\tchat?.composer?.setRecordingVideo(false);\n\t\t};\n\n\t\tVideoRecorder.stop(cb);\n\t\tsetTime(undefined);\n\t\tstopVideoRecording(rid, tmid);\n\t};\n\n\tconst handleCancel = useMutableCallback(() => {\n\t\tVideoRecorder.stop();\n\t\tchat?.composer?.setRecordingVideo(false);\n\t\tsetTime(undefined);\n\t\tstopVideoRecording(rid, tmid);\n\t});\n\n\tuseEffect(() => {\n\t\tif (!VideoRecorder.getSupportedMimeTypes()) {\n\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Browser_does_not_support_recording_video') });\n\t\t}\n\n\t\tVideoRecorder.start(videoRef.current ?? undefined, (success) => (!success ? handleCancel() : undefined));\n\n\t\treturn () => {\n\t\t\tVideoRecorder.stop();\n\t\t};\n\t}, [dispatchToastMessage, handleCancel, t]);\n\n\treturn (\n\t\t<PositionAnimated visible='visible' anchor={reference} placement='top-end'>\n\t\t\t<Box bg='light' padding={4} borderRadius={4} elevation='2'>\n\t\t\t\t<Box className={videoContainerClass} overflow='hidden' height={240} borderRadius={4}>\n\t\t\t\t\t<video muted autoPlay playsInline ref={videoRef} width={320} height={240} />\n\t\t\t\t</Box>\n\t\t\t\t<Box mbs={4} display='flex' justifyContent='space-between'>\n\t\t\t\t\t<Button small onClick={handleRecord}>\n\t\t\t\t\t\t<Box is='span' display='flex' alignItems='center'>\n\t\t\t\t\t\t\t<Icon size='x16' mie={time ? 4 : undefined} name={isRecording ? 'stop-unfilled' : 'rec'} />\n\t\t\t\t\t\t\t{time && <span>{time}</span>}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Button>\n\t\t\t\t\t<ButtonGroup>\n\t\t\t\t\t\t<Button small onClick={handleCancel}>\n\t\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button primary small disabled={sendButtonDisabled} onClick={handleSendRecord}>\n\t\t\t\t\t\t\t{t('Send')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Box>\n\t\t\t</Box>\n\t\t</PositionAnimated>\n\t);\n};\n\nexport default VideoMessageRecorder;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx","inputSourceMap":{"version":3,"file":"client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx","sourceRoot":"","sources":["client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx"],"names":[],"mappings":"AACA,OAAO,EAAE,GAAG,EAAE,MAAM,wBAAwB,CAAC;AAC7C,OAAO,EAAE,GAAG,EAAE,WAAW,EAAE,MAAM,EAAE,IAAI,EAAE,gBAAgB,EAAE,MAAM,uBAAuB,CAAC;AACzF,OAAO,EAAE,kBAAkB,EAAE,MAAM,6BAA6B,CAAC;AACjE,OAAO,EAAE,cAAc,EAAE,uBAAuB,EAAE,MAAM,0BAA0B,CAAC;AAEnF,OAAO,KAAK,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,MAAM,OAAO,CAAC;AAE3D,OAAO,EAAE,UAAU,EAAE,eAAe,EAAE,MAAM,0CAA0C,CAAC;AACvF,OAAO,EAAE,aAAa,EAAE,MAAM,wDAAwD,CAAC;AAEvF,OAAO,EAAE,OAAO,EAAE,MAAM,iCAAiC,CAAC;AAS1D,MAAM,mBAAmB,GAAG,GAAG,CAAA;;;;;;;;;;CAU9B,CAAC;AAEF,MAAM,0BAA0B,GAAG,GAAG,EAAE;IACvC,MAAM,SAAS,GAAG,aAAa,CAAC,qBAAqB,EAAE,CAAC;IACxD,IAAI,SAAS,CAAC,KAAK,CAAC,aAAa,CAAC,EAAE,CAAC;QACpC,OAAO,MAAM,CAAC;IACf,CAAC;IACD,OAAO,KAAK,CAAC;AACd,CAAC,CAAC;AAEF,MAAM,oBAAoB,GAAG,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE,WAAW,EAAE,SAAS,EAA6B,EAAE,EAAE;IACjG,MAAM,CAAC,GAAG,cAAc,EAAE,CAAC;IAC3B,MAAM,QAAQ,GAAG,MAAM,CAAmB,IAAI,CAAC,CAAC;IAChD,MAAM,oBAAoB,GAAG,uBAAuB,EAAE,CAAC;IAEvD,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,GAAG,QAAQ,EAAsB,CAAC;IACvD,MAAM,CAAC,cAAc,EAAE,iBAAiB,CAAC,GAAG,QAAQ,CAAmC,MAAM,CAAC,CAAC;IAC/F,MAAM,CAAC,iBAAiB,EAAE,oBAAoB,CAAC,GAAG,QAAQ,CAAwC,IAAI,CAAC,CAAC;IACxG,MAAM,WAAW,GAAG,cAAc,KAAK,WAAW,CAAC;IACnD,MAAM,kBAAkB,GAAG,CAAC,CAAC,aAAa,CAAC,aAAa,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC,cAAc,KAAK,WAAW,CAAC,CAAC,CAAC;IAErG,MAAM,IAAI,GAAG,OAAO,EAAE,IAAI,WAAW,CAAC;IAEtC,MAAM,kBAAkB,GAAG,KAAK,EAAE,GAAiB,EAAE,IAAsB,EAAE,EAAE;QAC9E,IAAI,iBAAiB,EAAE,CAAC;YACvB,aAAa,CAAC,iBAAiB,CAAC,CAAC;QAClC,CAAC;QACD,oBAAoB,CAAC,IAAI,CAAC,CAAC;QAC3B,aAAa,CAAC,aAAa,EAAE,CAAC;QAC9B,UAAU,CAAC,IAAI,CAAC,GAAG,EAAE,eAAe,CAAC,cAAc,EAAE,EAAE,IAAI,EAAE,CAAC,CAAC;QAC/D,iBAAiB,CAAC,MAAM,CAAC,CAAC;IAC3B,CAAC,CAAC;IAEF,MAAM,YAAY,GAAG,KAAK,IAAI,EAAE;QAC/B,IAAI,cAAc,KAAK,WAAW,EAAE,CAAC;YACpC,kBAAkB,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QAC/B,CAAC;aAAM,CAAC;YACP,aAAa,CAAC,MAAM,EAAE,CAAC;YACvB,iBAAiB,CAAC,WAAW,CAAC,CAAC;YAC/B,UAAU,CAAC,mBAAmB,CAAC,GAAG,EAAE,eAAe,CAAC,cAAc,EAAE,EAAE,IAAI,EAAE,CAAC,CAAC;YAC9E,OAAO,CAAC,OAAO,CAAC,CAAC;YACjB,MAAM,SAAS,GAAG,IAAI,IAAI,EAAE,CAAC;YAC7B,oBAAoB,CACnB,WAAW,CAAC,GAAG,EAAE;gBAChB,MAAM,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC;gBACvB,MAAM,QAAQ,GAAG,CAAC,GAAG,CAAC,OAAO,EAAE,GAAG,SAAS,CAAC,OAAO,EAAE,CAAC,GAAG,IAAI,CAAC;gBAC9D,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,EAAE,CAAC,CAAC;gBAC1C,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,EAAE,CAAC,CAAC;gBAC1C,OAAO,CAAC,GAAG,MAAM,CAAC,OAAO,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,EAAE,CAAC,CAAC;YACpF,CAAC,EAAE,IAAI,CAAC,CACR,CAAC;QACH,CAAC;IACF,CAAC,CAAC;IAEF,MAAM,gBAAgB,GAAG,KAAK,IAAI,EAAE;QACnC,MAAM,EAAE,GAAG,KAAK,EAAE,IAAU,EAAE,EAAE;YAC/B,MAAM,QAAQ,GAAG,GAAG,CAAC,CAAC,cAAc,CAAC,IAAI,0BAA0B,EAAE,EAAE,CAAC;YACxE,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,EAAE,IAAI,EAAE,aAAa,CAAC,qBAAqB,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YACvG,MAAM,IAAI,EAAE,KAAK,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;YACtC,IAAI,EAAE,QAAQ,EAAE,iBAAiB,CAAC,KAAK,CAAC,CAAC;QAC1C,CAAC,CAAC;QAEF,aAAa,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;QACvB,OAAO,CAAC,SAAS,CAAC,CAAC;QACnB,kBAAkB,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;IAC/B,CAAC,CAAC;IAEF,MAAM,YAAY,GAAG,kBAAkB,CAAC,GAAG,EAAE;QAC5C,aAAa,CAAC,IAAI,EAAE,CAAC;QACrB,IAAI,EAAE,QAAQ,EAAE,iBAAiB,CAAC,KAAK,CAAC,CAAC;QACzC,OAAO,CAAC,SAAS,CAAC,CAAC;QACnB,kBAAkB,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;IAC/B,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE;QACd,IAAI,CAAC,aAAa,CAAC,qBAAqB,EAAE,EAAE,CAAC;YAC5C,OAAO,oBAAoB,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,CAAC,CAAC,0CAA0C,CAAC,EAAE,CAAC,CAAC;QACxG,CAAC;QAED,aAAa,CAAC,KAAK,CAAC,QAAQ,CAAC,OAAO,IAAI,SAAS,EAAE,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;QAEzG,OAAO,GAAG,EAAE;YACX,aAAa,CAAC,IAAI,EAAE,CAAC;QACtB,CAAC,CAAC;IACH,CAAC,EAAE,CAAC,oBAAoB,EAAE,YAAY,EAAE,CAAC,CAAC,CAAC,CAAC;IAE5C,OAAO,CACN,CAAC,gBAAgB,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,SAAS,CAAC,CAAC,SAAS,CAAC,SAAS,CACzE;GAAA,CAAC,GAAG,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,GAAG,CACzD;IAAA,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,mBAAmB,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CACnF;KAAA,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,EAC1E;IAAA,EAAE,GAAG,CACL;IAAA,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,cAAc,CAAC,eAAe,CACzD;KAAA,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,YAAY,CAAC,CACnC;MAAA,CAAC,GAAG,CAAC,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,UAAU,CAAC,QAAQ,CAChD;OAAA,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,KAAK,CAAC,EACxF;OAAA,CAAC,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,CAC7B;MAAA,EAAE,GAAG,CACN;KAAA,EAAE,MAAM,CACR;KAAA,CAAC,WAAW,CACX;MAAA,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,YAAY,CAAC,CACnC;OAAA,CAAC,CAAC,CAAC,QAAQ,CAAC,CACb;MAAA,EAAE,MAAM,CACR;MAAA,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,kBAAkB,CAAC,CAAC,OAAO,CAAC,CAAC,gBAAgB,CAAC,CAC7E;OAAA,CAAC,CAAC,CAAC,MAAM,CAAC,CACX;MAAA,EAAE,MAAM,CACT;KAAA,EAAE,WAAW,CACd;IAAA,EAAE,GAAG,CACN;GAAA,EAAE,GAAG,CACN;EAAA,EAAE,gBAAgB,CAAC,CACnB,CAAC;AACH,CAAC,CAAC;AAEF,eAAe,oBAAoB,CAAC","sourcesContent":["import type { IMessage, IRoom } from '@rocket.chat/core-typings';\nimport { css } from '@rocket.chat/css-in-js';\nimport { Box, ButtonGroup, Button, Icon, PositionAnimated } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useTranslation, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport type { AllHTMLAttributes, RefObject } from 'react';\nimport React, { useRef, useEffect, useState } from 'react';\n\nimport { UserAction, USER_ACTIVITIES } from '../../../../app/ui/client/lib/UserAction';\nimport { VideoRecorder } from '../../../../app/ui/client/lib/recorderjs/videoRecorder';\nimport type { ChatAPI } from '../../../lib/chats/ChatAPI';\nimport { useChat } from '../../room/contexts/ChatContext';\n\ntype VideoMessageRecorderProps = {\n\trid: IRoom['_id'];\n\ttmid?: IMessage['_id'];\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n\treference: RefObject<HTMLElement>;\n} & Omit<AllHTMLAttributes<HTMLDivElement>, 'is'>;\n\nconst videoContainerClass = css`\n\ttransform: scaleX(-1);\n\tfilter: FlipH;\n\n\t@media (max-width: 500px) {\n\t\t& > video {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t}\n\t}\n`;\n\nconst getVideoRecordingExtension = () => {\n\tconst supported = VideoRecorder.getSupportedMimeTypes();\n\tif (supported.match(/video\\/webm/)) {\n\t\treturn 'webm';\n\t}\n\treturn 'mp4';\n};\n\nconst VideoMessageRecorder = ({ rid, tmid, chatContext, reference }: VideoMessageRecorderProps) => {\n\tconst t = useTranslation();\n\tconst videoRef = useRef<HTMLVideoElement>(null);\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst [time, setTime] = useState<string | undefined>();\n\tconst [recordingState, setRecordingState] = useState<'idle' | 'loading' | 'recording'>('idle');\n\tconst [recordingInterval, setRecordingInterval] = useState<ReturnType<typeof setInterval> | null>(null);\n\tconst isRecording = recordingState === 'recording';\n\tconst sendButtonDisabled = !(VideoRecorder.cameraStarted.get() && !(recordingState === 'recording'));\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst stopVideoRecording = async (rid: IRoom['_id'], tmid?: IMessage['_id']) => {\n\t\tif (recordingInterval) {\n\t\t\tclearInterval(recordingInterval);\n\t\t}\n\t\tsetRecordingInterval(null);\n\t\tVideoRecorder.stopRecording();\n\t\tUserAction.stop(rid, USER_ACTIVITIES.USER_RECORDING, { tmid });\n\t\tsetRecordingState('idle');\n\t};\n\n\tconst handleRecord = async () => {\n\t\tif (recordingState === 'recording') {\n\t\t\tstopVideoRecording(rid, tmid);\n\t\t} else {\n\t\t\tVideoRecorder.record();\n\t\t\tsetRecordingState('recording');\n\t\t\tUserAction.performContinuously(rid, USER_ACTIVITIES.USER_RECORDING, { tmid });\n\t\t\tsetTime('00:00');\n\t\t\tconst startTime = new Date();\n\t\t\tsetRecordingInterval(\n\t\t\t\tsetInterval(() => {\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tconst distance = (now.getTime() - startTime.getTime()) / 1000;\n\t\t\t\t\tconst minutes = Math.floor(distance / 60);\n\t\t\t\t\tconst seconds = Math.floor(distance % 60);\n\t\t\t\t\tsetTime(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);\n\t\t\t\t}, 1000),\n\t\t\t);\n\t\t}\n\t};\n\n\tconst handleSendRecord = async () => {\n\t\tconst cb = async (blob: Blob) => {\n\t\t\tconst fileName = `${t('Video_record')}.${getVideoRecordingExtension()}`;\n\t\t\tconst file = new File([blob], fileName, { type: VideoRecorder.getSupportedMimeTypes().split(';')[0] });\n\t\t\tawait chat?.flows.uploadFiles([file]);\n\t\t\tchat?.composer?.setRecordingVideo(false);\n\t\t};\n\n\t\tVideoRecorder.stop(cb);\n\t\tsetTime(undefined);\n\t\tstopVideoRecording(rid, tmid);\n\t};\n\n\tconst handleCancel = useMutableCallback(() => {\n\t\tVideoRecorder.stop();\n\t\tchat?.composer?.setRecordingVideo(false);\n\t\tsetTime(undefined);\n\t\tstopVideoRecording(rid, tmid);\n\t});\n\n\tuseEffect(() => {\n\t\tif (!VideoRecorder.getSupportedMimeTypes()) {\n\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Browser_does_not_support_recording_video') });\n\t\t}\n\n\t\tVideoRecorder.start(videoRef.current ?? undefined, (success) => (!success ? handleCancel() : undefined));\n\n\t\treturn () => {\n\t\t\tVideoRecorder.stop();\n\t\t};\n\t}, [dispatchToastMessage, handleCancel, t]);\n\n\treturn (\n\t\t<PositionAnimated visible='visible' anchor={reference} placement='top-end'>\n\t\t\t<Box bg='light' padding={4} borderRadius={4} elevation='2'>\n\t\t\t\t<Box className={videoContainerClass} overflow='hidden' height={240} borderRadius={4}>\n\t\t\t\t\t<video muted autoPlay playsInline ref={videoRef} width={320} height={240} />\n\t\t\t\t</Box>\n\t\t\t\t<Box mbs={4} display='flex' justifyContent='space-between'>\n\t\t\t\t\t<Button small onClick={handleRecord}>\n\t\t\t\t\t\t<Box is='span' display='flex' alignItems='center'>\n\t\t\t\t\t\t\t<Icon size='x16' mie={time ? 4 : undefined} name={isRecording ? 'stop-unfilled' : 'rec'} />\n\t\t\t\t\t\t\t{time && <span>{time}</span>}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Button>\n\t\t\t\t\t<ButtonGroup>\n\t\t\t\t\t\t<Button small onClick={handleCancel}>\n\t\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button primary small disabled={sendButtonDisabled} onClick={handleSendRecord}>\n\t\t\t\t\t\t\t{t('Send')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Box>\n\t\t\t</Box>\n\t\t</PositionAnimated>\n\t);\n};\n\nexport default VideoMessageRecorder;\n"]}}},"code":"var _templateObject;\nlet _taggedTemplateLiteral;\nmodule.link(\"@babel/runtime/helpers/taggedTemplateLiteral\", {\n  default(v) {\n    _taggedTemplateLiteral = v;\n  }\n}, 0);\nlet css;\nmodule.link(\"@rocket.chat/css-in-js\", {\n  css(v) {\n    css = v;\n  }\n}, 0);\nlet Box, ButtonGroup, Button, Icon, PositionAnimated;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Box(v) {\n    Box = v;\n  },\n  ButtonGroup(v) {\n    ButtonGroup = v;\n  },\n  Button(v) {\n    Button = v;\n  },\n  Icon(v) {\n    Icon = v;\n  },\n  PositionAnimated(v) {\n    PositionAnimated = v;\n  }\n}, 1);\nlet useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback(v) {\n    useMutableCallback = v;\n  }\n}, 2);\nlet useTranslation, useToastMessageDispatch;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useTranslation(v) {\n    useTranslation = v;\n  },\n  useToastMessageDispatch(v) {\n    useToastMessageDispatch = v;\n  }\n}, 3);\nlet React, useRef, useEffect, useState;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n  useRef(v) {\n    useRef = v;\n  },\n  useEffect(v) {\n    useEffect = v;\n  },\n  useState(v) {\n    useState = v;\n  }\n}, 4);\nlet UserAction, USER_ACTIVITIES;\nmodule.link(\"../../../../app/ui/client/lib/UserAction\", {\n  UserAction(v) {\n    UserAction = v;\n  },\n  USER_ACTIVITIES(v) {\n    USER_ACTIVITIES = v;\n  }\n}, 5);\nlet VideoRecorder;\nmodule.link(\"../../../../app/ui/client/lib/recorderjs/videoRecorder\", {\n  VideoRecorder(v) {\n    VideoRecorder = v;\n  }\n}, 6);\nlet useChat;\nmodule.link(\"../../room/contexts/ChatContext\", {\n  useChat(v) {\n    useChat = v;\n  }\n}, 7);\nconst videoContainerClass = css(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n\\ttransform: scaleX(-1);\\n\\tfilter: FlipH;\\n\\n\\t@media (max-width: 500px) {\\n\\t\\t& > video {\\n\\t\\t\\twidth: 100%;\\n\\t\\t\\theight: 100%;\\n\\t\\t}\\n\\t}\\n\"])));\nconst getVideoRecordingExtension = () => {\n  const supported = VideoRecorder.getSupportedMimeTypes();\n  if (supported.match(/video\\/webm/)) {\n    return 'webm';\n  }\n  return 'mp4';\n};\nconst VideoMessageRecorder = _ref => {\n  var _useChat;\n  let {\n    rid,\n    tmid,\n    chatContext,\n    reference\n  } = _ref;\n  const t = useTranslation();\n  const videoRef = useRef(null);\n  const dispatchToastMessage = useToastMessageDispatch();\n  const [time, setTime] = useState();\n  const [recordingState, setRecordingState] = useState('idle');\n  const [recordingInterval, setRecordingInterval] = useState(null);\n  const isRecording = recordingState === 'recording';\n  const sendButtonDisabled = !(VideoRecorder.cameraStarted.get() && !(recordingState === 'recording'));\n  const chat = (_useChat = useChat()) !== null && _useChat !== void 0 ? _useChat : chatContext;\n  const stopVideoRecording = async (rid, tmid) => {\n    if (recordingInterval) {\n      clearInterval(recordingInterval);\n    }\n    setRecordingInterval(null);\n    VideoRecorder.stopRecording();\n    UserAction.stop(rid, USER_ACTIVITIES.USER_RECORDING, {\n      tmid\n    });\n    setRecordingState('idle');\n  };\n  const handleRecord = async () => {\n    if (recordingState === 'recording') {\n      stopVideoRecording(rid, tmid);\n    } else {\n      VideoRecorder.record();\n      setRecordingState('recording');\n      UserAction.performContinuously(rid, USER_ACTIVITIES.USER_RECORDING, {\n        tmid\n      });\n      setTime('00:00');\n      const startTime = new Date();\n      setRecordingInterval(setInterval(() => {\n        const now = new Date();\n        const distance = (now.getTime() - startTime.getTime()) / 1000;\n        const minutes = Math.floor(distance / 60);\n        const seconds = Math.floor(distance % 60);\n        setTime(\"\".concat(String(minutes).padStart(2, '0'), \":\").concat(String(seconds).padStart(2, '0')));\n      }, 1000));\n    }\n  };\n  const handleSendRecord = async () => {\n    const cb = async blob => {\n      var _chat$composer;\n      const fileName = \"\".concat(t('Video_record'), \".\").concat(getVideoRecordingExtension());\n      const file = new File([blob], fileName, {\n        type: VideoRecorder.getSupportedMimeTypes().split(';')[0]\n      });\n      await (chat === null || chat === void 0 ? void 0 : chat.flows.uploadFiles([file]));\n      chat === null || chat === void 0 ? void 0 : (_chat$composer = chat.composer) === null || _chat$composer === void 0 ? void 0 : _chat$composer.setRecordingVideo(false);\n    };\n    VideoRecorder.stop(cb);\n    setTime(undefined);\n    stopVideoRecording(rid, tmid);\n  };\n  const handleCancel = useMutableCallback(() => {\n    var _chat$composer2;\n    VideoRecorder.stop();\n    chat === null || chat === void 0 ? void 0 : (_chat$composer2 = chat.composer) === null || _chat$composer2 === void 0 ? void 0 : _chat$composer2.setRecordingVideo(false);\n    setTime(undefined);\n    stopVideoRecording(rid, tmid);\n  });\n  useEffect(() => {\n    var _videoRef$current;\n    if (!VideoRecorder.getSupportedMimeTypes()) {\n      return dispatchToastMessage({\n        type: 'error',\n        message: t('Browser_does_not_support_recording_video')\n      });\n    }\n    VideoRecorder.start((_videoRef$current = videoRef.current) !== null && _videoRef$current !== void 0 ? _videoRef$current : undefined, success => !success ? handleCancel() : undefined);\n    return () => {\n      VideoRecorder.stop();\n    };\n  }, [dispatchToastMessage, handleCancel, t]);\n  return /*#__PURE__*/React.createElement(PositionAnimated, {\n    visible: \"visible\",\n    anchor: reference,\n    placement: \"top-end\"\n  }, /*#__PURE__*/React.createElement(Box, {\n    bg: \"light\",\n    padding: 4,\n    borderRadius: 4,\n    elevation: \"2\"\n  }, /*#__PURE__*/React.createElement(Box, {\n    className: videoContainerClass,\n    overflow: \"hidden\",\n    height: 240,\n    borderRadius: 4\n  }, /*#__PURE__*/React.createElement(\"video\", {\n    muted: true,\n    autoPlay: true,\n    playsInline: true,\n    ref: videoRef,\n    width: 320,\n    height: 240\n  })), /*#__PURE__*/React.createElement(Box, {\n    mbs: 4,\n    display: \"flex\",\n    justifyContent: \"space-between\"\n  }, /*#__PURE__*/React.createElement(Button, {\n    small: true,\n    onClick: handleRecord\n  }, /*#__PURE__*/React.createElement(Box, {\n    is: \"span\",\n    display: \"flex\",\n    alignItems: \"center\"\n  }, /*#__PURE__*/React.createElement(Icon, {\n    size: \"x16\",\n    mie: time ? 4 : undefined,\n    name: isRecording ? 'stop-unfilled' : 'rec'\n  }), time && /*#__PURE__*/React.createElement(\"span\", null, time))), /*#__PURE__*/React.createElement(ButtonGroup, null, /*#__PURE__*/React.createElement(Button, {\n    small: true,\n    onClick: handleCancel\n  }, t('Cancel')), /*#__PURE__*/React.createElement(Button, {\n    primary: true,\n    small: true,\n    disabled: sendButtonDisabled,\n    onClick: handleSendRecord\n  }, t('Send'))))));\n};\nmodule.exportDefault(VideoMessageRecorder);","map":{"version":3,"names":["_taggedTemplateLiteral","module","link","default","v","css","Box","ButtonGroup","Button","Icon","PositionAnimated","useMutableCallback","useTranslation","useToastMessageDispatch","React","useRef","useEffect","useState","UserAction","USER_ACTIVITIES","VideoRecorder","useChat","videoContainerClass","_templateObject","getVideoRecordingExtension","supported","getSupportedMimeTypes","match","VideoMessageRecorder","_ref","_useChat","rid","tmid","chatContext","reference","t","videoRef","dispatchToastMessage","time","setTime","recordingState","setRecordingState","recordingInterval","setRecordingInterval","isRecording","sendButtonDisabled","cameraStarted","get","chat","stopVideoRecording","clearInterval","stopRecording","stop","USER_RECORDING","handleRecord","record","performContinuously","startTime","Date","setInterval","now","distance","getTime","minutes","Math","floor","seconds","concat","String","padStart","handleSendRecord","cb","blob","_chat$composer","fileName","file","File","type","split","flows","uploadFiles","composer","setRecordingVideo","undefined","handleCancel","_chat$composer2","_videoRef$current","message","start","current","success","createElement","visible","anchor","placement","bg","padding","borderRadius","elevation","className","overflow","height","muted","autoPlay","playsInline","ref","width","mbs","display","justifyContent","small","onClick","is","alignItems","size","mie","name","primary","disabled","exportDefault"],"sources":["client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx"],"sourcesContent":["import type { IMessage, IRoom } from '@rocket.chat/core-typings';\nimport { css } from '@rocket.chat/css-in-js';\nimport { Box, ButtonGroup, Button, Icon, PositionAnimated } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useTranslation, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport type { AllHTMLAttributes, RefObject } from 'react';\nimport React, { useRef, useEffect, useState } from 'react';\n\nimport { UserAction, USER_ACTIVITIES } from '../../../../app/ui/client/lib/UserAction';\nimport { VideoRecorder } from '../../../../app/ui/client/lib/recorderjs/videoRecorder';\nimport type { ChatAPI } from '../../../lib/chats/ChatAPI';\nimport { useChat } from '../../room/contexts/ChatContext';\n\ntype VideoMessageRecorderProps = {\n\trid: IRoom['_id'];\n\ttmid?: IMessage['_id'];\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n\treference: RefObject<HTMLElement>;\n} & Omit<AllHTMLAttributes<HTMLDivElement>, 'is'>;\n\nconst videoContainerClass = css`\n\ttransform: scaleX(-1);\n\tfilter: FlipH;\n\n\t@media (max-width: 500px) {\n\t\t& > video {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t}\n\t}\n`;\n\nconst getVideoRecordingExtension = () => {\n\tconst supported = VideoRecorder.getSupportedMimeTypes();\n\tif (supported.match(/video\\/webm/)) {\n\t\treturn 'webm';\n\t}\n\treturn 'mp4';\n};\n\nconst VideoMessageRecorder = ({ rid, tmid, chatContext, reference }: VideoMessageRecorderProps) => {\n\tconst t = useTranslation();\n\tconst videoRef = useRef<HTMLVideoElement>(null);\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst [time, setTime] = useState<string | undefined>();\n\tconst [recordingState, setRecordingState] = useState<'idle' | 'loading' | 'recording'>('idle');\n\tconst [recordingInterval, setRecordingInterval] = useState<ReturnType<typeof setInterval> | null>(null);\n\tconst isRecording = recordingState === 'recording';\n\tconst sendButtonDisabled = !(VideoRecorder.cameraStarted.get() && !(recordingState === 'recording'));\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst stopVideoRecording = async (rid: IRoom['_id'], tmid?: IMessage['_id']) => {\n\t\tif (recordingInterval) {\n\t\t\tclearInterval(recordingInterval);\n\t\t}\n\t\tsetRecordingInterval(null);\n\t\tVideoRecorder.stopRecording();\n\t\tUserAction.stop(rid, USER_ACTIVITIES.USER_RECORDING, { tmid });\n\t\tsetRecordingState('idle');\n\t};\n\n\tconst handleRecord = async () => {\n\t\tif (recordingState === 'recording') {\n\t\t\tstopVideoRecording(rid, tmid);\n\t\t} else {\n\t\t\tVideoRecorder.record();\n\t\t\tsetRecordingState('recording');\n\t\t\tUserAction.performContinuously(rid, USER_ACTIVITIES.USER_RECORDING, { tmid });\n\t\t\tsetTime('00:00');\n\t\t\tconst startTime = new Date();\n\t\t\tsetRecordingInterval(\n\t\t\t\tsetInterval(() => {\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tconst distance = (now.getTime() - startTime.getTime()) / 1000;\n\t\t\t\t\tconst minutes = Math.floor(distance / 60);\n\t\t\t\t\tconst seconds = Math.floor(distance % 60);\n\t\t\t\t\tsetTime(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);\n\t\t\t\t}, 1000),\n\t\t\t);\n\t\t}\n\t};\n\n\tconst handleSendRecord = async () => {\n\t\tconst cb = async (blob: Blob) => {\n\t\t\tconst fileName = `${t('Video_record')}.${getVideoRecordingExtension()}`;\n\t\t\tconst file = new File([blob], fileName, { type: VideoRecorder.getSupportedMimeTypes().split(';')[0] });\n\t\t\tawait chat?.flows.uploadFiles([file]);\n\t\t\tchat?.composer?.setRecordingVideo(false);\n\t\t};\n\n\t\tVideoRecorder.stop(cb);\n\t\tsetTime(undefined);\n\t\tstopVideoRecording(rid, tmid);\n\t};\n\n\tconst handleCancel = useMutableCallback(() => {\n\t\tVideoRecorder.stop();\n\t\tchat?.composer?.setRecordingVideo(false);\n\t\tsetTime(undefined);\n\t\tstopVideoRecording(rid, tmid);\n\t});\n\n\tuseEffect(() => {\n\t\tif (!VideoRecorder.getSupportedMimeTypes()) {\n\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Browser_does_not_support_recording_video') });\n\t\t}\n\n\t\tVideoRecorder.start(videoRef.current ?? undefined, (success) => (!success ? handleCancel() : undefined));\n\n\t\treturn () => {\n\t\t\tVideoRecorder.stop();\n\t\t};\n\t}, [dispatchToastMessage, handleCancel, t]);\n\n\treturn (\n\t\t<PositionAnimated visible='visible' anchor={reference} placement='top-end'>\n\t\t\t<Box bg='light' padding={4} borderRadius={4} elevation='2'>\n\t\t\t\t<Box className={videoContainerClass} overflow='hidden' height={240} borderRadius={4}>\n\t\t\t\t\t<video muted autoPlay playsInline ref={videoRef} width={320} height={240} />\n\t\t\t\t</Box>\n\t\t\t\t<Box mbs={4} display='flex' justifyContent='space-between'>\n\t\t\t\t\t<Button small onClick={handleRecord}>\n\t\t\t\t\t\t<Box is='span' display='flex' alignItems='center'>\n\t\t\t\t\t\t\t<Icon size='x16' mie={time ? 4 : undefined} name={isRecording ? 'stop-unfilled' : 'rec'} />\n\t\t\t\t\t\t\t{time && <span>{time}</span>}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Button>\n\t\t\t\t\t<ButtonGroup>\n\t\t\t\t\t\t<Button small onClick={handleCancel}>\n\t\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button primary small disabled={sendButtonDisabled} onClick={handleSendRecord}>\n\t\t\t\t\t\t\t{t('Send')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Box>\n\t\t\t</Box>\n\t\t</PositionAnimated>\n\t);\n};\n\nexport default VideoMessageRecorder;\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"f75564a73ce8bfed264cc55762ebc962c5dc6bd8"}
