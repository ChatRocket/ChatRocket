{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/methods/saveCustomField.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/livechat/server/methods/saveCustomField.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/methods/saveCustomField.ts","inputSourceMap":{"version":3,"file":"app/livechat/server/methods/saveCustomField.ts","sourceRoot":"","sources":["app/livechat/server/methods/saveCustomField.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,mBAAmB,EAAE,MAAM,qBAAqB,CAAC;AAC1D,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,cAAc,CAAC;AAC5C,OAAO,EAAE,MAAM,EAAE,MAAM,eAAe,CAAC;AAEvC,OAAO,EAAE,kBAAkB,EAAE,MAAM,uDAAuD,CAAC;AAmB3F,MAAM,CAAC,OAAO,CAAgB;IAC7B,KAAK,CAAC,0BAA0B,CAAC,GAAG,EAAE,eAAe;QACpD,MAAM,GAAG,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC;QAC5B,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC,MAAM,kBAAkB,CAAC,GAAG,EAAE,uBAAuB,CAAC,CAAC,EAAE,CAAC;YACvE,MAAM,IAAI,MAAM,CAAC,KAAK,CAAC,mBAAmB,EAAE,aAAa,EAAE;gBAC1D,MAAM,EAAE,0BAA0B;aAClC,CAAC,CAAC;QACJ,CAAC;QAED,IAAI,GAAG,EAAE,CAAC;YACT,KAAK,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;QACpB,CAAC;QAED,KAAK,CACJ,eAAe,EACf,KAAK,CAAC,eAAe,CAAC;YACrB,KAAK,EAAE,MAAM;YACb,KAAK,EAAE,MAAM;YACb,KAAK,EAAE,MAAM;YACb,UAAU,EAAE,MAAM;YAClB,MAAM,EAAE,MAAM;YACd,UAAU,EAAE,OAAO;SACnB,CAAC,CACF,CAAC;QAEF,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,EAAE,CAAC;YACrD,MAAM,IAAI,MAAM,CAAC,KAAK,CACrB,iCAAiC,EACjC,gFAAgF,EAChF,EAAE,MAAM,EAAE,0BAA0B,EAAE,CACtC,CAAC;QACH,CAAC;QAED,IAAI,GAAG,EAAE,CAAC;YACT,MAAM,WAAW,GAAG,MAAM,mBAAmB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;YAC/D,IAAI,CAAC,WAAW,EAAE,CAAC;gBAClB,MAAM,IAAI,MAAM,CAAC,KAAK,CAAC,4BAA4B,EAAE,wBAAwB,EAAE;oBAC9E,MAAM,EAAE,0BAA0B;iBAClC,CAAC,CAAC;YACJ,CAAC;QACF,CAAC;QAED,IAAI,CAAC,GAAG,EAAE,CAAC;YACV,MAAM,WAAW,GAAG,MAAM,mBAAmB,CAAC,WAAW,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;YACjF,IAAI,WAAW,EAAE,CAAC;gBACjB,MAAM,IAAI,MAAM,CAAC,KAAK,CAAC,wCAAwC,EAAE,kCAAkC,EAAE;oBACpG,MAAM,EAAE,0BAA0B;iBAClC,CAAC,CAAC;YACJ,CAAC;QACF,CAAC;QAED,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,UAAU,EAAE,GAAG,SAAS,EAAE,GAAG,eAAe,CAAC;QAC1E,OAAO,mBAAmB,CAAC,yBAAyB,CAAC,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,UAAU,EAAE;YAC1F,GAAG,SAAS;SACZ,CAAC,CAAC;IACJ,CAAC;CACD,CAAC,CAAC","sourcesContent":["import type { ILivechatCustomField } from '@rocket.chat/core-typings';\nimport type { ServerMethods } from '@rocket.chat/ddp-client';\nimport { LivechatCustomField } from '@rocket.chat/models';\nimport { Match, check } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\n\nimport { hasPermissionAsync } from '../../../authorization/server/functions/hasPermission';\n\ndeclare module '@rocket.chat/ddp-client' {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface ServerMethods {\n\t\t'livechat:saveCustomField'(\n\t\t\t_id: string,\n\t\t\tcustomFieldData: {\n\t\t\t\tfield: string;\n\t\t\t\tlabel: string;\n\t\t\t\tscope: 'visitor' | 'room';\n\t\t\t\tvisibility: string;\n\t\t\t\tregexp: string;\n\t\t\t\tsearchable: boolean;\n\t\t\t},\n\t\t): ILivechatCustomField;\n\t}\n}\n\nMeteor.methods<ServerMethods>({\n\tasync 'livechat:saveCustomField'(_id, customFieldData) {\n\t\tconst uid = Meteor.userId();\n\t\tif (!uid || !(await hasPermissionAsync(uid, 'view-livechat-manager'))) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'livechat:saveCustomField',\n\t\t\t});\n\t\t}\n\n\t\tif (_id) {\n\t\t\tcheck(_id, String);\n\t\t}\n\n\t\tcheck(\n\t\t\tcustomFieldData,\n\t\t\tMatch.ObjectIncluding({\n\t\t\t\tfield: String,\n\t\t\t\tlabel: String,\n\t\t\t\tscope: String,\n\t\t\t\tvisibility: String,\n\t\t\t\tregexp: String,\n\t\t\t\tsearchable: Boolean,\n\t\t\t}),\n\t\t);\n\n\t\tif (!/^[0-9a-zA-Z-_]+$/.test(customFieldData.field)) {\n\t\t\tthrow new Meteor.Error(\n\t\t\t\t'error-invalid-custom-field-name',\n\t\t\t\t'Invalid custom field name. Use only letters, numbers, hyphens and underscores.',\n\t\t\t\t{ method: 'livechat:saveCustomField' },\n\t\t\t);\n\t\t}\n\n\t\tif (_id) {\n\t\t\tconst customField = await LivechatCustomField.findOneById(_id);\n\t\t\tif (!customField) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-custom-field', 'Custom Field Not found', {\n\t\t\t\t\tmethod: 'livechat:saveCustomField',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!_id) {\n\t\t\tconst customField = await LivechatCustomField.findOneById(customFieldData.field);\n\t\t\tif (customField) {\n\t\t\t\tthrow new Meteor.Error('error-custom-field-name-already-exists', 'Custom field name already exists', {\n\t\t\t\t\tmethod: 'livechat:saveCustomField',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tconst { field, label, scope, visibility, ...extraData } = customFieldData;\n\t\treturn LivechatCustomField.createOrUpdateCustomField(_id, field, label, scope, visibility, {\n\t\t\t...extraData,\n\t\t});\n\t},\n});\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/server/methods/saveCustomField.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/livechat/server/methods/saveCustomField.ts","inputSourceMap":{"version":3,"file":"app/livechat/server/methods/saveCustomField.ts","sourceRoot":"","sources":["app/livechat/server/methods/saveCustomField.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,mBAAmB,EAAE,MAAM,qBAAqB,CAAC;AAC1D,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,cAAc,CAAC;AAC5C,OAAO,EAAE,MAAM,EAAE,MAAM,eAAe,CAAC;AAEvC,OAAO,EAAE,kBAAkB,EAAE,MAAM,uDAAuD,CAAC;AAmB3F,MAAM,CAAC,OAAO,CAAgB;IAC7B,KAAK,CAAC,0BAA0B,CAAC,GAAG,EAAE,eAAe;QACpD,MAAM,GAAG,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC;QAC5B,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC,MAAM,kBAAkB,CAAC,GAAG,EAAE,uBAAuB,CAAC,CAAC,EAAE,CAAC;YACvE,MAAM,IAAI,MAAM,CAAC,KAAK,CAAC,mBAAmB,EAAE,aAAa,EAAE;gBAC1D,MAAM,EAAE,0BAA0B;aAClC,CAAC,CAAC;QACJ,CAAC;QAED,IAAI,GAAG,EAAE,CAAC;YACT,KAAK,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;QACpB,CAAC;QAED,KAAK,CACJ,eAAe,EACf,KAAK,CAAC,eAAe,CAAC;YACrB,KAAK,EAAE,MAAM;YACb,KAAK,EAAE,MAAM;YACb,KAAK,EAAE,MAAM;YACb,UAAU,EAAE,MAAM;YAClB,MAAM,EAAE,MAAM;YACd,UAAU,EAAE,OAAO;SACnB,CAAC,CACF,CAAC;QAEF,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,EAAE,CAAC;YACrD,MAAM,IAAI,MAAM,CAAC,KAAK,CACrB,iCAAiC,EACjC,gFAAgF,EAChF,EAAE,MAAM,EAAE,0BAA0B,EAAE,CACtC,CAAC;QACH,CAAC;QAED,IAAI,GAAG,EAAE,CAAC;YACT,MAAM,WAAW,GAAG,MAAM,mBAAmB,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;YAC/D,IAAI,CAAC,WAAW,EAAE,CAAC;gBAClB,MAAM,IAAI,MAAM,CAAC,KAAK,CAAC,4BAA4B,EAAE,wBAAwB,EAAE;oBAC9E,MAAM,EAAE,0BAA0B;iBAClC,CAAC,CAAC;YACJ,CAAC;QACF,CAAC;QAED,IAAI,CAAC,GAAG,EAAE,CAAC;YACV,MAAM,WAAW,GAAG,MAAM,mBAAmB,CAAC,WAAW,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;YACjF,IAAI,WAAW,EAAE,CAAC;gBACjB,MAAM,IAAI,MAAM,CAAC,KAAK,CAAC,wCAAwC,EAAE,kCAAkC,EAAE;oBACpG,MAAM,EAAE,0BAA0B;iBAClC,CAAC,CAAC;YACJ,CAAC;QACF,CAAC;QAED,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,UAAU,EAAE,GAAG,SAAS,EAAE,GAAG,eAAe,CAAC;QAC1E,OAAO,mBAAmB,CAAC,yBAAyB,CAAC,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,UAAU,EAAE;YAC1F,GAAG,SAAS;SACZ,CAAC,CAAC;IACJ,CAAC;CACD,CAAC,CAAC","sourcesContent":["import type { ILivechatCustomField } from '@rocket.chat/core-typings';\nimport type { ServerMethods } from '@rocket.chat/ddp-client';\nimport { LivechatCustomField } from '@rocket.chat/models';\nimport { Match, check } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\n\nimport { hasPermissionAsync } from '../../../authorization/server/functions/hasPermission';\n\ndeclare module '@rocket.chat/ddp-client' {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface ServerMethods {\n\t\t'livechat:saveCustomField'(\n\t\t\t_id: string,\n\t\t\tcustomFieldData: {\n\t\t\t\tfield: string;\n\t\t\t\tlabel: string;\n\t\t\t\tscope: 'visitor' | 'room';\n\t\t\t\tvisibility: string;\n\t\t\t\tregexp: string;\n\t\t\t\tsearchable: boolean;\n\t\t\t},\n\t\t): ILivechatCustomField;\n\t}\n}\n\nMeteor.methods<ServerMethods>({\n\tasync 'livechat:saveCustomField'(_id, customFieldData) {\n\t\tconst uid = Meteor.userId();\n\t\tif (!uid || !(await hasPermissionAsync(uid, 'view-livechat-manager'))) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'livechat:saveCustomField',\n\t\t\t});\n\t\t}\n\n\t\tif (_id) {\n\t\t\tcheck(_id, String);\n\t\t}\n\n\t\tcheck(\n\t\t\tcustomFieldData,\n\t\t\tMatch.ObjectIncluding({\n\t\t\t\tfield: String,\n\t\t\t\tlabel: String,\n\t\t\t\tscope: String,\n\t\t\t\tvisibility: String,\n\t\t\t\tregexp: String,\n\t\t\t\tsearchable: Boolean,\n\t\t\t}),\n\t\t);\n\n\t\tif (!/^[0-9a-zA-Z-_]+$/.test(customFieldData.field)) {\n\t\t\tthrow new Meteor.Error(\n\t\t\t\t'error-invalid-custom-field-name',\n\t\t\t\t'Invalid custom field name. Use only letters, numbers, hyphens and underscores.',\n\t\t\t\t{ method: 'livechat:saveCustomField' },\n\t\t\t);\n\t\t}\n\n\t\tif (_id) {\n\t\t\tconst customField = await LivechatCustomField.findOneById(_id);\n\t\t\tif (!customField) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-custom-field', 'Custom Field Not found', {\n\t\t\t\t\tmethod: 'livechat:saveCustomField',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!_id) {\n\t\t\tconst customField = await LivechatCustomField.findOneById(customFieldData.field);\n\t\t\tif (customField) {\n\t\t\t\tthrow new Meteor.Error('error-custom-field-name-already-exists', 'Custom field name already exists', {\n\t\t\t\t\tmethod: 'livechat:saveCustomField',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tconst { field, label, scope, visibility, ...extraData } = customFieldData;\n\t\treturn LivechatCustomField.createOrUpdateCustomField(_id, field, label, scope, visibility, {\n\t\t\t...extraData,\n\t\t});\n\t},\n});\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let _objectSpread;\n    module.link(\"@babel/runtime/helpers/objectSpread2\", {\n      default(v) {\n        _objectSpread = v;\n      }\n    }, 0);\n    let _objectWithoutProperties;\n    module.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n      default(v) {\n        _objectWithoutProperties = v;\n      }\n    }, 1);\n    const _excluded = [\"field\", \"label\", \"scope\", \"visibility\"];\n    let LivechatCustomField;\n    module.link(\"@rocket.chat/models\", {\n      LivechatCustomField(v) {\n        LivechatCustomField = v;\n      }\n    }, 0);\n    let Match, check;\n    module.link(\"meteor/check\", {\n      Match(v) {\n        Match = v;\n      },\n      check(v) {\n        check = v;\n      }\n    }, 1);\n    let Meteor;\n    module.link(\"meteor/meteor\", {\n      Meteor(v) {\n        Meteor = v;\n      }\n    }, 2);\n    let hasPermissionAsync;\n    module.link(\"../../../authorization/server/functions/hasPermission\", {\n      hasPermissionAsync(v) {\n        hasPermissionAsync = v;\n      }\n    }, 3);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    Meteor.methods({\n      async 'livechat:saveCustomField'(_id, customFieldData) {\n        const uid = Meteor.userId();\n        if (!uid || !(await hasPermissionAsync(uid, 'view-livechat-manager'))) {\n          throw new Meteor.Error('error-not-allowed', 'Not allowed', {\n            method: 'livechat:saveCustomField'\n          });\n        }\n        if (_id) {\n          check(_id, String);\n        }\n        check(customFieldData, Match.ObjectIncluding({\n          field: String,\n          label: String,\n          scope: String,\n          visibility: String,\n          regexp: String,\n          searchable: Boolean\n        }));\n        if (!/^[0-9a-zA-Z-_]+$/.test(customFieldData.field)) {\n          throw new Meteor.Error('error-invalid-custom-field-name', 'Invalid custom field name. Use only letters, numbers, hyphens and underscores.', {\n            method: 'livechat:saveCustomField'\n          });\n        }\n        if (_id) {\n          const customField = await LivechatCustomField.findOneById(_id);\n          if (!customField) {\n            throw new Meteor.Error('error-invalid-custom-field', 'Custom Field Not found', {\n              method: 'livechat:saveCustomField'\n            });\n          }\n        }\n        if (!_id) {\n          const customField = await LivechatCustomField.findOneById(customFieldData.field);\n          if (customField) {\n            throw new Meteor.Error('error-custom-field-name-already-exists', 'Custom field name already exists', {\n              method: 'livechat:saveCustomField'\n            });\n          }\n        }\n        const {\n            field,\n            label,\n            scope,\n            visibility\n          } = customFieldData,\n          extraData = _objectWithoutProperties(customFieldData, _excluded);\n        return LivechatCustomField.createOrUpdateCustomField(_id, field, label, scope, visibility, _objectSpread({}, extraData));\n      }\n    });\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["_objectSpread","module","link","default","v","_objectWithoutProperties","_excluded","LivechatCustomField","Match","check","Meteor","hasPermissionAsync","__reifyWaitForDeps__","methods","livechat:saveCustomField","_id","customFieldData","uid","userId","Error","method","String","ObjectIncluding","field","label","scope","visibility","regexp","searchable","Boolean","test","customField","findOneById","extraData","createOrUpdateCustomField","__reify_async_result__","_reifyError","self","async"],"sources":["app/livechat/server/methods/saveCustomField.ts"],"sourcesContent":["import type { ILivechatCustomField } from '@rocket.chat/core-typings';\nimport type { ServerMethods } from '@rocket.chat/ddp-client';\nimport { LivechatCustomField } from '@rocket.chat/models';\nimport { Match, check } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\n\nimport { hasPermissionAsync } from '../../../authorization/server/functions/hasPermission';\n\ndeclare module '@rocket.chat/ddp-client' {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface ServerMethods {\n\t\t'livechat:saveCustomField'(\n\t\t\t_id: string,\n\t\t\tcustomFieldData: {\n\t\t\t\tfield: string;\n\t\t\t\tlabel: string;\n\t\t\t\tscope: 'visitor' | 'room';\n\t\t\t\tvisibility: string;\n\t\t\t\tregexp: string;\n\t\t\t\tsearchable: boolean;\n\t\t\t},\n\t\t): ILivechatCustomField;\n\t}\n}\n\nMeteor.methods<ServerMethods>({\n\tasync 'livechat:saveCustomField'(_id, customFieldData) {\n\t\tconst uid = Meteor.userId();\n\t\tif (!uid || !(await hasPermissionAsync(uid, 'view-livechat-manager'))) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'livechat:saveCustomField',\n\t\t\t});\n\t\t}\n\n\t\tif (_id) {\n\t\t\tcheck(_id, String);\n\t\t}\n\n\t\tcheck(\n\t\t\tcustomFieldData,\n\t\t\tMatch.ObjectIncluding({\n\t\t\t\tfield: String,\n\t\t\t\tlabel: String,\n\t\t\t\tscope: String,\n\t\t\t\tvisibility: String,\n\t\t\t\tregexp: String,\n\t\t\t\tsearchable: Boolean,\n\t\t\t}),\n\t\t);\n\n\t\tif (!/^[0-9a-zA-Z-_]+$/.test(customFieldData.field)) {\n\t\t\tthrow new Meteor.Error(\n\t\t\t\t'error-invalid-custom-field-name',\n\t\t\t\t'Invalid custom field name. Use only letters, numbers, hyphens and underscores.',\n\t\t\t\t{ method: 'livechat:saveCustomField' },\n\t\t\t);\n\t\t}\n\n\t\tif (_id) {\n\t\t\tconst customField = await LivechatCustomField.findOneById(_id);\n\t\t\tif (!customField) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-custom-field', 'Custom Field Not found', {\n\t\t\t\t\tmethod: 'livechat:saveCustomField',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!_id) {\n\t\t\tconst customField = await LivechatCustomField.findOneById(customFieldData.field);\n\t\t\tif (customField) {\n\t\t\t\tthrow new Meteor.Error('error-custom-field-name-already-exists', 'Custom field name already exists', {\n\t\t\t\t\tmethod: 'livechat:saveCustomField',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tconst { field, label, scope, visibility, ...extraData } = customFieldData;\n\t\treturn LivechatCustomField.createOrUpdateCustomField(_id, field, label, scope, visibility, {\n\t\t\t...extraData,\n\t\t});\n\t},\n});\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"cd99204ccfffb3eb7974baace42a490e55c118d4"}
