{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/configuration/oauth.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"ee/server/configuration/oauth.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/configuration/oauth.ts","inputSourceMap":{"version":3,"file":"ee/server/configuration/oauth.ts","sourceRoot":"","sources":["ee/server/configuration/oauth.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { License } from '@rocket.chat/license';\nimport { Logger } from '@rocket.chat/logger';\nimport { Roles } from '@rocket.chat/models';\nimport { capitalize } from '@rocket.chat/string-helpers';\n\nimport { settings } from '../../../app/settings/server';\nimport { callbacks } from '../../../lib/callbacks';\nimport { OAuthEEManager } from '../lib/oauth/Manager';\nimport { syncUserRoles } from '../lib/syncUserRoles';\n\ninterface IOAuthUserService {\n\tserviceName: string;\n\tserviceData: Record<string, any>;\n\tuser: IUser;\n}\n\ninterface IOAuthUserIdentity {\n\tserviceName: string;\n\tidentity: Record<string, any>;\n\tuser: IUser;\n}\n\ninterface IOAuthSettings {\n\tmapChannels: boolean;\n\tmergeRoles: boolean;\n\trolesToSync: string;\n\trolesClaim: string;\n\tgroupsClaim: string;\n\tchannelsAdmin: string;\n\tchannelsMap: string;\n}\n\nconst logger = new Logger('EECustomOAuth');\n\nfunction getOAuthSettings(serviceName: string): IOAuthSettings {\n\treturn {\n\t\tmapChannels: settings.get<boolean>(`Accounts_OAuth_Custom-${serviceName}-map_channels`),\n\t\tmergeRoles: settings.get<boolean>(`Accounts_OAuth_Custom-${serviceName}-merge_roles`),\n\t\trolesToSync: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-roles_to_sync`),\n\t\trolesClaim: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-roles_claim`),\n\t\tgroupsClaim: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-groups_claim`),\n\t\tchannelsAdmin: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-channels_admin`),\n\t\tchannelsMap: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-groups_channel_map`),\n\t};\n}\n\nfunction getChannelsMap(channelsMap: string): Record<string, any> | undefined {\n\tchannelsMap = (channelsMap || '{}').trim();\n\n\ttry {\n\t\treturn JSON.parse(channelsMap);\n\t} catch (err) {\n\t\tlogger.error({ msg: 'Unexpected error', err });\n\t}\n}\n\nawait License.onLicense('oauth-enterprise', () => {\n\tcallbacks.add('afterProcessOAuthUser', async (auth: IOAuthUserService) => {\n\t\tauth.serviceName = capitalize(auth.serviceName);\n\t\tconst settings = getOAuthSettings(auth.serviceName);\n\n\t\tif (settings.mapChannels) {\n\t\t\tconst channelsMap = getChannelsMap(settings.channelsMap);\n\t\t\tawait OAuthEEManager.mapSSOGroupsToChannels(auth.user, auth.serviceData, settings.groupsClaim, channelsMap, settings.channelsAdmin);\n\t\t}\n\n\t\tif (settings.mergeRoles) {\n\t\t\tawait OAuthEEManager.updateRolesFromSSO(\n\t\t\t\tauth.user,\n\t\t\t\tauth.serviceData,\n\t\t\t\tsettings.rolesClaim,\n\t\t\t\tsettings.rolesToSync.split(',').map((role) => role.trim()),\n\t\t\t);\n\t\t}\n\t});\n\n\tcallbacks.add('afterValidateNewOAuthUser', async (auth: IOAuthUserIdentity) => {\n\t\tauth.serviceName = capitalize(auth.serviceName);\n\t\tconst settings = getOAuthSettings(auth.serviceName);\n\n\t\tif (settings.mapChannels) {\n\t\t\tconst channelsMap = getChannelsMap(settings.channelsMap);\n\t\t\tawait OAuthEEManager.mapSSOGroupsToChannels(auth.user, auth.identity, settings.groupsClaim, channelsMap, settings.channelsAdmin);\n\t\t}\n\n\t\tif (settings.mergeRoles) {\n\t\t\tconst rolesFromSSO = await OAuthEEManager.mapRolesFromSSO(auth.identity, settings.rolesClaim);\n\t\t\tconst mappedRoles = (await Roles.findInIdsOrNames(rolesFromSSO).toArray()).map((role) => role._id);\n\t\t\tconst rolesToSync = settings.rolesToSync.split(',').map((role) => role.trim());\n\n\t\t\tconst allowedRoles = (await Roles.findInIdsOrNames(rolesToSync).toArray()).map((role) => role._id);\n\n\t\t\tawait syncUserRoles(auth.user._id, mappedRoles, {\n\t\t\t\tallowedRoles,\n\t\t\t});\n\t\t}\n\t});\n});\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/configuration/oauth.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"ee/server/configuration/oauth.ts","inputSourceMap":{"version":3,"file":"ee/server/configuration/oauth.ts","sourceRoot":"","sources":["ee/server/configuration/oauth.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { License } from '@rocket.chat/license';\nimport { Logger } from '@rocket.chat/logger';\nimport { Roles } from '@rocket.chat/models';\nimport { capitalize } from '@rocket.chat/string-helpers';\n\nimport { settings } from '../../../app/settings/server';\nimport { callbacks } from '../../../lib/callbacks';\nimport { OAuthEEManager } from '../lib/oauth/Manager';\nimport { syncUserRoles } from '../lib/syncUserRoles';\n\ninterface IOAuthUserService {\n\tserviceName: string;\n\tserviceData: Record<string, any>;\n\tuser: IUser;\n}\n\ninterface IOAuthUserIdentity {\n\tserviceName: string;\n\tidentity: Record<string, any>;\n\tuser: IUser;\n}\n\ninterface IOAuthSettings {\n\tmapChannels: boolean;\n\tmergeRoles: boolean;\n\trolesToSync: string;\n\trolesClaim: string;\n\tgroupsClaim: string;\n\tchannelsAdmin: string;\n\tchannelsMap: string;\n}\n\nconst logger = new Logger('EECustomOAuth');\n\nfunction getOAuthSettings(serviceName: string): IOAuthSettings {\n\treturn {\n\t\tmapChannels: settings.get<boolean>(`Accounts_OAuth_Custom-${serviceName}-map_channels`),\n\t\tmergeRoles: settings.get<boolean>(`Accounts_OAuth_Custom-${serviceName}-merge_roles`),\n\t\trolesToSync: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-roles_to_sync`),\n\t\trolesClaim: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-roles_claim`),\n\t\tgroupsClaim: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-groups_claim`),\n\t\tchannelsAdmin: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-channels_admin`),\n\t\tchannelsMap: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-groups_channel_map`),\n\t};\n}\n\nfunction getChannelsMap(channelsMap: string): Record<string, any> | undefined {\n\tchannelsMap = (channelsMap || '{}').trim();\n\n\ttry {\n\t\treturn JSON.parse(channelsMap);\n\t} catch (err) {\n\t\tlogger.error({ msg: 'Unexpected error', err });\n\t}\n}\n\nawait License.onLicense('oauth-enterprise', () => {\n\tcallbacks.add('afterProcessOAuthUser', async (auth: IOAuthUserService) => {\n\t\tauth.serviceName = capitalize(auth.serviceName);\n\t\tconst settings = getOAuthSettings(auth.serviceName);\n\n\t\tif (settings.mapChannels) {\n\t\t\tconst channelsMap = getChannelsMap(settings.channelsMap);\n\t\t\tawait OAuthEEManager.mapSSOGroupsToChannels(auth.user, auth.serviceData, settings.groupsClaim, channelsMap, settings.channelsAdmin);\n\t\t}\n\n\t\tif (settings.mergeRoles) {\n\t\t\tawait OAuthEEManager.updateRolesFromSSO(\n\t\t\t\tauth.user,\n\t\t\t\tauth.serviceData,\n\t\t\t\tsettings.rolesClaim,\n\t\t\t\tsettings.rolesToSync.split(',').map((role) => role.trim()),\n\t\t\t);\n\t\t}\n\t});\n\n\tcallbacks.add('afterValidateNewOAuthUser', async (auth: IOAuthUserIdentity) => {\n\t\tauth.serviceName = capitalize(auth.serviceName);\n\t\tconst settings = getOAuthSettings(auth.serviceName);\n\n\t\tif (settings.mapChannels) {\n\t\t\tconst channelsMap = getChannelsMap(settings.channelsMap);\n\t\t\tawait OAuthEEManager.mapSSOGroupsToChannels(auth.user, auth.identity, settings.groupsClaim, channelsMap, settings.channelsAdmin);\n\t\t}\n\n\t\tif (settings.mergeRoles) {\n\t\t\tconst rolesFromSSO = await OAuthEEManager.mapRolesFromSSO(auth.identity, settings.rolesClaim);\n\t\t\tconst mappedRoles = (await Roles.findInIdsOrNames(rolesFromSSO).toArray()).map((role) => role._id);\n\t\t\tconst rolesToSync = settings.rolesToSync.split(',').map((role) => role.trim());\n\n\t\t\tconst allowedRoles = (await Roles.findInIdsOrNames(rolesToSync).toArray()).map((role) => role._id);\n\n\t\t\tawait syncUserRoles(auth.user._id, mappedRoles, {\n\t\t\t\tallowedRoles,\n\t\t\t});\n\t\t}\n\t});\n});\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let License;\n    module.link(\"@rocket.chat/license\", {\n      License(v) {\n        License = v;\n      }\n    }, 0);\n    let Logger;\n    module.link(\"@rocket.chat/logger\", {\n      Logger(v) {\n        Logger = v;\n      }\n    }, 1);\n    let Roles;\n    module.link(\"@rocket.chat/models\", {\n      Roles(v) {\n        Roles = v;\n      }\n    }, 2);\n    let capitalize;\n    module.link(\"@rocket.chat/string-helpers\", {\n      capitalize(v) {\n        capitalize = v;\n      }\n    }, 3);\n    let settings;\n    module.link(\"../../../app/settings/server\", {\n      settings(v) {\n        settings = v;\n      }\n    }, 4);\n    let callbacks;\n    module.link(\"../../../lib/callbacks\", {\n      callbacks(v) {\n        callbacks = v;\n      }\n    }, 5);\n    let OAuthEEManager;\n    module.link(\"../lib/oauth/Manager\", {\n      OAuthEEManager(v) {\n        OAuthEEManager = v;\n      }\n    }, 6);\n    let syncUserRoles;\n    module.link(\"../lib/syncUserRoles\", {\n      syncUserRoles(v) {\n        syncUserRoles = v;\n      }\n    }, 7);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    const logger = new Logger('EECustomOAuth');\n    function getOAuthSettings(serviceName) {\n      return {\n        mapChannels: settings.get(\"Accounts_OAuth_Custom-\".concat(serviceName, \"-map_channels\")),\n        mergeRoles: settings.get(\"Accounts_OAuth_Custom-\".concat(serviceName, \"-merge_roles\")),\n        rolesToSync: settings.get(\"Accounts_OAuth_Custom-\".concat(serviceName, \"-roles_to_sync\")),\n        rolesClaim: settings.get(\"Accounts_OAuth_Custom-\".concat(serviceName, \"-roles_claim\")),\n        groupsClaim: settings.get(\"Accounts_OAuth_Custom-\".concat(serviceName, \"-groups_claim\")),\n        channelsAdmin: settings.get(\"Accounts_OAuth_Custom-\".concat(serviceName, \"-channels_admin\")),\n        channelsMap: settings.get(\"Accounts_OAuth_Custom-\".concat(serviceName, \"-groups_channel_map\"))\n      };\n    }\n    function getChannelsMap(channelsMap) {\n      channelsMap = (channelsMap || '{}').trim();\n      try {\n        return JSON.parse(channelsMap);\n      } catch (err) {\n        logger.error({\n          msg: 'Unexpected error',\n          err\n        });\n      }\n    }\n    await License.onLicense('oauth-enterprise', () => {\n      callbacks.add('afterProcessOAuthUser', async auth => {\n        auth.serviceName = capitalize(auth.serviceName);\n        const settings = getOAuthSettings(auth.serviceName);\n        if (settings.mapChannels) {\n          const channelsMap = getChannelsMap(settings.channelsMap);\n          await OAuthEEManager.mapSSOGroupsToChannels(auth.user, auth.serviceData, settings.groupsClaim, channelsMap, settings.channelsAdmin);\n        }\n        if (settings.mergeRoles) {\n          await OAuthEEManager.updateRolesFromSSO(auth.user, auth.serviceData, settings.rolesClaim, settings.rolesToSync.split(',').map(role => role.trim()));\n        }\n      });\n      callbacks.add('afterValidateNewOAuthUser', async auth => {\n        auth.serviceName = capitalize(auth.serviceName);\n        const settings = getOAuthSettings(auth.serviceName);\n        if (settings.mapChannels) {\n          const channelsMap = getChannelsMap(settings.channelsMap);\n          await OAuthEEManager.mapSSOGroupsToChannels(auth.user, auth.identity, settings.groupsClaim, channelsMap, settings.channelsAdmin);\n        }\n        if (settings.mergeRoles) {\n          const rolesFromSSO = await OAuthEEManager.mapRolesFromSSO(auth.identity, settings.rolesClaim);\n          const mappedRoles = (await Roles.findInIdsOrNames(rolesFromSSO).toArray()).map(role => role._id);\n          const rolesToSync = settings.rolesToSync.split(',').map(role => role.trim());\n          const allowedRoles = (await Roles.findInIdsOrNames(rolesToSync).toArray()).map(role => role._id);\n          await syncUserRoles(auth.user._id, mappedRoles, {\n            allowedRoles\n          });\n        }\n      });\n    });\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: true\n});","map":{"version":3,"names":["License","module","link","v","Logger","Roles","capitalize","settings","callbacks","OAuthEEManager","syncUserRoles","__reifyWaitForDeps__","logger","getOAuthSettings","serviceName","mapChannels","get","concat","mergeRoles","rolesToSync","rolesClaim","groupsClaim","channelsAdmin","channelsMap","getChannelsMap","trim","JSON","parse","err","error","msg","onLicense","add","auth","mapSSOGroupsToChannels","user","serviceData","updateRolesFromSSO","split","map","role","identity","rolesFromSSO","mapRolesFromSSO","mappedRoles","findInIdsOrNames","toArray","_id","allowedRoles","__reify_async_result__","_reifyError","self","async"],"sources":["ee/server/configuration/oauth.ts"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { License } from '@rocket.chat/license';\nimport { Logger } from '@rocket.chat/logger';\nimport { Roles } from '@rocket.chat/models';\nimport { capitalize } from '@rocket.chat/string-helpers';\n\nimport { settings } from '../../../app/settings/server';\nimport { callbacks } from '../../../lib/callbacks';\nimport { OAuthEEManager } from '../lib/oauth/Manager';\nimport { syncUserRoles } from '../lib/syncUserRoles';\n\ninterface IOAuthUserService {\n\tserviceName: string;\n\tserviceData: Record<string, any>;\n\tuser: IUser;\n}\n\ninterface IOAuthUserIdentity {\n\tserviceName: string;\n\tidentity: Record<string, any>;\n\tuser: IUser;\n}\n\ninterface IOAuthSettings {\n\tmapChannels: boolean;\n\tmergeRoles: boolean;\n\trolesToSync: string;\n\trolesClaim: string;\n\tgroupsClaim: string;\n\tchannelsAdmin: string;\n\tchannelsMap: string;\n}\n\nconst logger = new Logger('EECustomOAuth');\n\nfunction getOAuthSettings(serviceName: string): IOAuthSettings {\n\treturn {\n\t\tmapChannels: settings.get<boolean>(`Accounts_OAuth_Custom-${serviceName}-map_channels`),\n\t\tmergeRoles: settings.get<boolean>(`Accounts_OAuth_Custom-${serviceName}-merge_roles`),\n\t\trolesToSync: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-roles_to_sync`),\n\t\trolesClaim: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-roles_claim`),\n\t\tgroupsClaim: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-groups_claim`),\n\t\tchannelsAdmin: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-channels_admin`),\n\t\tchannelsMap: settings.get<string>(`Accounts_OAuth_Custom-${serviceName}-groups_channel_map`),\n\t};\n}\n\nfunction getChannelsMap(channelsMap: string): Record<string, any> | undefined {\n\tchannelsMap = (channelsMap || '{}').trim();\n\n\ttry {\n\t\treturn JSON.parse(channelsMap);\n\t} catch (err) {\n\t\tlogger.error({ msg: 'Unexpected error', err });\n\t}\n}\n\nawait License.onLicense('oauth-enterprise', () => {\n\tcallbacks.add('afterProcessOAuthUser', async (auth: IOAuthUserService) => {\n\t\tauth.serviceName = capitalize(auth.serviceName);\n\t\tconst settings = getOAuthSettings(auth.serviceName);\n\n\t\tif (settings.mapChannels) {\n\t\t\tconst channelsMap = getChannelsMap(settings.channelsMap);\n\t\t\tawait OAuthEEManager.mapSSOGroupsToChannels(auth.user, auth.serviceData, settings.groupsClaim, channelsMap, settings.channelsAdmin);\n\t\t}\n\n\t\tif (settings.mergeRoles) {\n\t\t\tawait OAuthEEManager.updateRolesFromSSO(\n\t\t\t\tauth.user,\n\t\t\t\tauth.serviceData,\n\t\t\t\tsettings.rolesClaim,\n\t\t\t\tsettings.rolesToSync.split(',').map((role) => role.trim()),\n\t\t\t);\n\t\t}\n\t});\n\n\tcallbacks.add('afterValidateNewOAuthUser', async (auth: IOAuthUserIdentity) => {\n\t\tauth.serviceName = capitalize(auth.serviceName);\n\t\tconst settings = getOAuthSettings(auth.serviceName);\n\n\t\tif (settings.mapChannels) {\n\t\t\tconst channelsMap = getChannelsMap(settings.channelsMap);\n\t\t\tawait OAuthEEManager.mapSSOGroupsToChannels(auth.user, auth.identity, settings.groupsClaim, channelsMap, settings.channelsAdmin);\n\t\t}\n\n\t\tif (settings.mergeRoles) {\n\t\t\tconst rolesFromSSO = await OAuthEEManager.mapRolesFromSSO(auth.identity, settings.rolesClaim);\n\t\t\tconst mappedRoles = (await Roles.findInIdsOrNames(rolesFromSSO).toArray()).map((role) => role._id);\n\t\t\tconst rolesToSync = settings.rolesToSync.split(',').map((role) => role.trim());\n\n\t\t\tconst allowedRoles = (await Roles.findInIdsOrNames(rolesToSync).toArray()).map((role) => role._id);\n\n\t\t\tawait syncUserRoles(auth.user._id, mappedRoles, {\n\t\t\t\tallowedRoles,\n\t\t\t});\n\t\t}\n\t});\n});\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"871d4a1c94c3803619aab0f4d69c3c7bdb3e6a04"}
