{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-message/client/popup/messagePopupConfig.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui-message/client/popup/messagePopupConfig.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-message/client/popup/messagePopupConfig.ts","inputSourceMap":{"version":3,"file":"app/ui-message/client/popup/messagePopupConfig.ts","sourceRoot":"","sources":["app/ui-message/client/popup/messagePopupConfig.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,MAAM,EAAE,MAAM,eAAe,CAAC;AACvC,OAAO,EAAE,KAAK,EAAE,MAAM,cAAc,CAAC;AACrC,OAAO,EAAE,OAAO,EAAE,MAAM,gBAAgB,CAAC;AAEzC,OAAO,EAAE,WAAW,EAAE,MAAM,oCAAoC,CAAC;AACjE,OAAO,EAAE,gBAAgB,EAAE,MAAM,gCAAgC,CAAC;AAClE,OAAO,EAAE,QAAQ,EAAE,MAAM,wBAAwB,CAAC;AAElD,MAAM,CAAC,MAAM,qBAAqB,GAAG,IAAI,KAAK,CAAC,UAAU,CAMtD,IAAI,CAAC,CAAC;AAET,MAAM,CAAC,OAAO,CAAC,GAAG,EAAE;IACnB,OAAO,CAAC,OAAO,CAAC,GAAG,EAAE;QACpB,MAAM,GAAG,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC;QAC5B,MAAM,GAAG,GAAG,gBAAgB,CAC3B,CAAC,EAAE,EAAE,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,SAAS,EAAE,EAAE,CAAC,EACrC,GAAG,EAAE,CAAC,WAAW,CAAC,MAAM,CACxB,CAAC;QACF,MAAM,IAAI,GAAG,GAAG,CAAC,CAAC,CAAE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,MAAM,EAAE,EAAE,QAAQ,EAAE,CAAC,EAAE,EAAE,CAAuB,CAAC,CAAC,CAAC,SAAS,CAAC;QAC7G,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,EAAE,CAAC;YACnB,OAAO;QACR,CAAC;QAED,qBAAqB,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QAEjC,MAAM,yBAAyB,GAA4B,EAAE,CAAC;QAE9D,QAAQ,CAAC,IAAI,CACZ;YACC,GAAG;YACH,YAAY,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,EAAE;YACpC,GAAG,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE;SACvB,EACD;YACC,MAAM,EAAE;gBACP,YAAY,EAAE,CAAC;gBACf,QAAQ,EAAE,CAAC;gBACX,OAAO,EAAE,CAAC;gBACV,IAAI,EAAE,CAAC;aACP;YACD,IAAI,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,EAAE;SAChB,CACD;aACC,KAAK,EAAE;aACP,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,QAAQ,EAAE,EAAE,EAAE,EAAE;YAC/B,MAAM,SAAS,GAAG,CAAC,yBAAyB,CAAC,QAAQ,CAAC,CAAC;YACvD,yBAAyB,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAC;YAC3C,OAAO,SAAS,CAAC;QAClB,CAAC,CAAC;aACD,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAC/C,qBAAqB,CAAC,MAAM,CAAC,GAAG,EAAE;YACjC,GAAG;YACH,QAAQ;YACR,IAAI;YACJ,EAAE;SACF,CAAC,CACF,CAAC;IACJ,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC,CAAC","sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\nimport { Mongo } from 'meteor/mongo';\nimport { Tracker } from 'meteor/tracker';\n\nimport { RoomManager } from '../../../../client/lib/RoomManager';\nimport { asReactiveSource } from '../../../../client/lib/tracker';\nimport { Messages } from '../../../models/client';\n\nexport const usersFromRoomMessages = new Mongo.Collection<{\n\t_id: string;\n\tusername: string;\n\tname: string | undefined;\n\tts: Date;\n\tsuggestion?: boolean;\n}>(null);\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst uid = Meteor.userId();\n\t\tconst rid = asReactiveSource(\n\t\t\t(cb) => RoomManager.on('changed', cb),\n\t\t\t() => RoomManager.opened,\n\t\t);\n\t\tconst user = uid ? (Meteor.users.findOne(uid, { fields: { username: 1 } }) as IUser | undefined) : undefined;\n\t\tif (!rid || !user) {\n\t\t\treturn;\n\t\t}\n\n\t\tusersFromRoomMessages.remove({});\n\n\t\tconst uniqueMessageUsersControl: Record<string, boolean> = {};\n\n\t\tMessages.find(\n\t\t\t{\n\t\t\t\trid,\n\t\t\t\t'u.username': { $ne: user.username },\n\t\t\t\t't': { $exists: false },\n\t\t\t},\n\t\t\t{\n\t\t\t\tfields: {\n\t\t\t\t\t'u.username': 1,\n\t\t\t\t\t'u.name': 1,\n\t\t\t\t\t'u._id': 1,\n\t\t\t\t\t'ts': 1,\n\t\t\t\t},\n\t\t\t\tsort: { ts: -1 },\n\t\t\t},\n\t\t)\n\t\t\t.fetch()\n\t\t\t.filter(({ u: { username } }) => {\n\t\t\t\tconst notMapped = !uniqueMessageUsersControl[username];\n\t\t\t\tuniqueMessageUsersControl[username] = true;\n\t\t\t\treturn notMapped;\n\t\t\t})\n\t\t\t.forEach(({ u: { username, name, _id }, ts }) =>\n\t\t\t\tusersFromRoomMessages.upsert(_id, {\n\t\t\t\t\t_id,\n\t\t\t\t\tusername,\n\t\t\t\t\tname,\n\t\t\t\t\tts,\n\t\t\t\t}),\n\t\t\t);\n\t});\n});\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-message/client/popup/messagePopupConfig.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-message/client/popup/messagePopupConfig.ts","inputSourceMap":{"version":3,"file":"app/ui-message/client/popup/messagePopupConfig.ts","sourceRoot":"","sources":["app/ui-message/client/popup/messagePopupConfig.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,MAAM,EAAE,MAAM,eAAe,CAAC;AACvC,OAAO,EAAE,KAAK,EAAE,MAAM,cAAc,CAAC;AACrC,OAAO,EAAE,OAAO,EAAE,MAAM,gBAAgB,CAAC;AAEzC,OAAO,EAAE,WAAW,EAAE,MAAM,oCAAoC,CAAC;AACjE,OAAO,EAAE,gBAAgB,EAAE,MAAM,gCAAgC,CAAC;AAClE,OAAO,EAAE,QAAQ,EAAE,MAAM,wBAAwB,CAAC;AAElD,MAAM,CAAC,MAAM,qBAAqB,GAAG,IAAI,KAAK,CAAC,UAAU,CAMtD,IAAI,CAAC,CAAC;AAET,MAAM,CAAC,OAAO,CAAC,GAAG,EAAE;IACnB,OAAO,CAAC,OAAO,CAAC,GAAG,EAAE;QACpB,MAAM,GAAG,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC;QAC5B,MAAM,GAAG,GAAG,gBAAgB,CAC3B,CAAC,EAAE,EAAE,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,SAAS,EAAE,EAAE,CAAC,EACrC,GAAG,EAAE,CAAC,WAAW,CAAC,MAAM,CACxB,CAAC;QACF,MAAM,IAAI,GAAG,GAAG,CAAC,CAAC,CAAE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,MAAM,EAAE,EAAE,QAAQ,EAAE,CAAC,EAAE,EAAE,CAAuB,CAAC,CAAC,CAAC,SAAS,CAAC;QAC7G,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,EAAE,CAAC;YACnB,OAAO;QACR,CAAC;QAED,qBAAqB,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QAEjC,MAAM,yBAAyB,GAA4B,EAAE,CAAC;QAE9D,QAAQ,CAAC,IAAI,CACZ;YACC,GAAG;YACH,YAAY,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,QAAQ,EAAE;YACpC,GAAG,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE;SACvB,EACD;YACC,MAAM,EAAE;gBACP,YAAY,EAAE,CAAC;gBACf,QAAQ,EAAE,CAAC;gBACX,OAAO,EAAE,CAAC;gBACV,IAAI,EAAE,CAAC;aACP;YACD,IAAI,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,EAAE;SAChB,CACD;aACC,KAAK,EAAE;aACP,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,QAAQ,EAAE,EAAE,EAAE,EAAE;YAC/B,MAAM,SAAS,GAAG,CAAC,yBAAyB,CAAC,QAAQ,CAAC,CAAC;YACvD,yBAAyB,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAC;YAC3C,OAAO,SAAS,CAAC;QAClB,CAAC,CAAC;aACD,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAC/C,qBAAqB,CAAC,MAAM,CAAC,GAAG,EAAE;YACjC,GAAG;YACH,QAAQ;YACR,IAAI;YACJ,EAAE;SACF,CAAC,CACF,CAAC;IACJ,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC,CAAC","sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\nimport { Mongo } from 'meteor/mongo';\nimport { Tracker } from 'meteor/tracker';\n\nimport { RoomManager } from '../../../../client/lib/RoomManager';\nimport { asReactiveSource } from '../../../../client/lib/tracker';\nimport { Messages } from '../../../models/client';\n\nexport const usersFromRoomMessages = new Mongo.Collection<{\n\t_id: string;\n\tusername: string;\n\tname: string | undefined;\n\tts: Date;\n\tsuggestion?: boolean;\n}>(null);\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst uid = Meteor.userId();\n\t\tconst rid = asReactiveSource(\n\t\t\t(cb) => RoomManager.on('changed', cb),\n\t\t\t() => RoomManager.opened,\n\t\t);\n\t\tconst user = uid ? (Meteor.users.findOne(uid, { fields: { username: 1 } }) as IUser | undefined) : undefined;\n\t\tif (!rid || !user) {\n\t\t\treturn;\n\t\t}\n\n\t\tusersFromRoomMessages.remove({});\n\n\t\tconst uniqueMessageUsersControl: Record<string, boolean> = {};\n\n\t\tMessages.find(\n\t\t\t{\n\t\t\t\trid,\n\t\t\t\t'u.username': { $ne: user.username },\n\t\t\t\t't': { $exists: false },\n\t\t\t},\n\t\t\t{\n\t\t\t\tfields: {\n\t\t\t\t\t'u.username': 1,\n\t\t\t\t\t'u.name': 1,\n\t\t\t\t\t'u._id': 1,\n\t\t\t\t\t'ts': 1,\n\t\t\t\t},\n\t\t\t\tsort: { ts: -1 },\n\t\t\t},\n\t\t)\n\t\t\t.fetch()\n\t\t\t.filter(({ u: { username } }) => {\n\t\t\t\tconst notMapped = !uniqueMessageUsersControl[username];\n\t\t\t\tuniqueMessageUsersControl[username] = true;\n\t\t\t\treturn notMapped;\n\t\t\t})\n\t\t\t.forEach(({ u: { username, name, _id }, ts }) =>\n\t\t\t\tusersFromRoomMessages.upsert(_id, {\n\t\t\t\t\t_id,\n\t\t\t\t\tusername,\n\t\t\t\t\tname,\n\t\t\t\t\tts,\n\t\t\t\t}),\n\t\t\t);\n\t});\n});\n"]}}},"code":"module.export({\n  usersFromRoomMessages: function () {\n    return usersFromRoomMessages;\n  }\n});\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar Mongo;\nmodule.link(\"meteor/mongo\", {\n  Mongo: function (v) {\n    Mongo = v;\n  }\n}, 1);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 2);\nvar RoomManager;\nmodule.link(\"../../../../client/lib/RoomManager\", {\n  RoomManager: function (v) {\n    RoomManager = v;\n  }\n}, 3);\nvar asReactiveSource;\nmodule.link(\"../../../../client/lib/tracker\", {\n  asReactiveSource: function (v) {\n    asReactiveSource = v;\n  }\n}, 4);\nvar Messages;\nmodule.link(\"../../../models/client\", {\n  Messages: function (v) {\n    Messages = v;\n  }\n}, 5);\nvar usersFromRoomMessages = new Mongo.Collection(null);\nMeteor.startup(function () {\n  Tracker.autorun(function () {\n    var uid = Meteor.userId();\n    var rid = asReactiveSource(function (cb) {\n      return RoomManager.on('changed', cb);\n    }, function () {\n      return RoomManager.opened;\n    });\n    var user = uid ? Meteor.users.findOne(uid, {\n      fields: {\n        username: 1\n      }\n    }) : undefined;\n    if (!rid || !user) {\n      return;\n    }\n    usersFromRoomMessages.remove({});\n    var uniqueMessageUsersControl = {};\n    Messages.find({\n      rid: rid,\n      'u.username': {\n        $ne: user.username\n      },\n      't': {\n        $exists: false\n      }\n    }, {\n      fields: {\n        'u.username': 1,\n        'u.name': 1,\n        'u._id': 1,\n        'ts': 1\n      },\n      sort: {\n        ts: -1\n      }\n    }).fetch().filter(function (_ref) {\n      var username = _ref.u.username;\n      var notMapped = !uniqueMessageUsersControl[username];\n      uniqueMessageUsersControl[username] = true;\n      return notMapped;\n    }).forEach(function (_ref2) {\n      var _ref2$u = _ref2.u,\n        username = _ref2$u.username,\n        name = _ref2$u.name,\n        _id = _ref2$u._id,\n        ts = _ref2.ts;\n      return usersFromRoomMessages.upsert(_id, {\n        _id: _id,\n        username: username,\n        name: name,\n        ts: ts\n      });\n    });\n  });\n});","map":{"version":3,"names":["module","export","usersFromRoomMessages","Meteor","link","v","Mongo","Tracker","RoomManager","asReactiveSource","Messages","Collection","startup","autorun","uid","userId","rid","cb","on","opened","user","users","findOne","fields","username","undefined","remove","uniqueMessageUsersControl","find","$ne","$exists","sort","ts","fetch","filter","_ref","u","notMapped","forEach","_ref2","_ref2$u","name","_id","upsert"],"sources":["app/ui-message/client/popup/messagePopupConfig.ts"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\nimport { Mongo } from 'meteor/mongo';\nimport { Tracker } from 'meteor/tracker';\n\nimport { RoomManager } from '../../../../client/lib/RoomManager';\nimport { asReactiveSource } from '../../../../client/lib/tracker';\nimport { Messages } from '../../../models/client';\n\nexport const usersFromRoomMessages = new Mongo.Collection<{\n\t_id: string;\n\tusername: string;\n\tname: string | undefined;\n\tts: Date;\n\tsuggestion?: boolean;\n}>(null);\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst uid = Meteor.userId();\n\t\tconst rid = asReactiveSource(\n\t\t\t(cb) => RoomManager.on('changed', cb),\n\t\t\t() => RoomManager.opened,\n\t\t);\n\t\tconst user = uid ? (Meteor.users.findOne(uid, { fields: { username: 1 } }) as IUser | undefined) : undefined;\n\t\tif (!rid || !user) {\n\t\t\treturn;\n\t\t}\n\n\t\tusersFromRoomMessages.remove({});\n\n\t\tconst uniqueMessageUsersControl: Record<string, boolean> = {};\n\n\t\tMessages.find(\n\t\t\t{\n\t\t\t\trid,\n\t\t\t\t'u.username': { $ne: user.username },\n\t\t\t\t't': { $exists: false },\n\t\t\t},\n\t\t\t{\n\t\t\t\tfields: {\n\t\t\t\t\t'u.username': 1,\n\t\t\t\t\t'u.name': 1,\n\t\t\t\t\t'u._id': 1,\n\t\t\t\t\t'ts': 1,\n\t\t\t\t},\n\t\t\t\tsort: { ts: -1 },\n\t\t\t},\n\t\t)\n\t\t\t.fetch()\n\t\t\t.filter(({ u: { username } }) => {\n\t\t\t\tconst notMapped = !uniqueMessageUsersControl[username];\n\t\t\t\tuniqueMessageUsersControl[username] = true;\n\t\t\t\treturn notMapped;\n\t\t\t})\n\t\t\t.forEach(({ u: { username, name, _id }, ts }) =>\n\t\t\t\tusersFromRoomMessages.upsert(_id, {\n\t\t\t\t\t_id,\n\t\t\t\t\tusername,\n\t\t\t\t\tname,\n\t\t\t\t\tts,\n\t\t\t\t}),\n\t\t\t);\n\t});\n});\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"c150713348423ce78ac0cb7858d7a8d132fe9618"}
