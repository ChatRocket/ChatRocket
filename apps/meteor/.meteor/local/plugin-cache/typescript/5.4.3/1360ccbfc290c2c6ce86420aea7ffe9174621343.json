{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/createDirectRoom.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/lib/server/functions/createDirectRoom.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/createDirectRoom.ts","inputSourceMap":{"version":3,"file":"app/lib/server/functions/createDirectRoom.ts","sourceRoot":"","sources":["app/lib/server/functions/createDirectRoom.ts"],"names":[],"mappings":"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","sourcesContent":["import { AppEvents, Apps } from '@rocket.chat/apps';\nimport { AppsEngineException } from '@rocket.chat/apps-engine/definition/exceptions';\nimport type { ISubscriptionExtraData } from '@rocket.chat/core-services';\nimport type { ICreatedRoom, IRoom, ISubscription, IUser } from '@rocket.chat/core-typings';\nimport { Rooms, Subscriptions, Users } from '@rocket.chat/models';\nimport { Random } from '@rocket.chat/random';\nimport { Meteor } from 'meteor/meteor';\nimport type { MatchKeysAndValues } from 'mongodb';\n\nimport { callbacks } from '../../../../lib/callbacks';\nimport { isTruthy } from '../../../../lib/isTruthy';\nimport { settings } from '../../../settings/server';\nimport { getDefaultSubscriptionPref } from '../../../utils/lib/getDefaultSubscriptionPref';\nimport { notifyOnRoomChangedById, notifyOnSubscriptionChangedByRoomIdAndUserId } from '../lib/notifyListener';\n\nconst generateSubscription = (\n\tfname: string,\n\tname: string,\n\tuser: IUser,\n\textra: MatchKeysAndValues<ISubscription>,\n): MatchKeysAndValues<ISubscription> => ({\n\t_id: Random.id(),\n\tts: new Date(),\n\talert: false,\n\tunread: 0,\n\tuserMentions: 0,\n\tgroupMentions: 0,\n\t...(user.customFields && { customFields: user.customFields }),\n\t...getDefaultSubscriptionPref(user),\n\t...extra,\n\tt: 'd',\n\tfname,\n\tname,\n\tu: {\n\t\t_id: user._id,\n\t\tusername: user.username,\n\t},\n});\n\nconst getFname = (members: IUser[]): string => members.map(({ name, username }) => name || username).join(', ');\nconst getName = (members: IUser[]): string => members.map(({ username }) => username).join(', ');\n\nexport async function createDirectRoom(\n\tmembers: IUser[] | string[],\n\troomExtraData = {},\n\toptions: {\n\t\tcreator?: string;\n\t\tsubscriptionExtra?: ISubscriptionExtraData;\n\t},\n): Promise<ICreatedRoom> {\n\tconst maxUsers = settings.get<number>('DirectMesssage_maxUsers') || 1;\n\tif (members.length > maxUsers) {\n\t\tthrow new Meteor.Error(\n\t\t\t'error-direct-message-max-user-exceeded',\n\t\t\t`You cannot add more than ${maxUsers} users, including yourself to a direct message`,\n\t\t\t{\n\t\t\t\tmethod: 'createDirectRoom',\n\t\t\t},\n\t\t);\n\t}\n\n\tawait callbacks.run('beforeCreateDirectRoom', members);\n\n\tconst membersUsernames: string[] = members\n\t\t.map((member) => {\n\t\t\tif (typeof member === 'string') {\n\t\t\t\treturn member.replace('@', '');\n\t\t\t}\n\t\t\treturn member.username;\n\t\t})\n\t\t.filter(isTruthy);\n\n\tconst roomMembers: IUser[] = await Users.findUsersByUsernames(membersUsernames, {\n\t\tprojection: { _id: 1, name: 1, username: 1, settings: 1, customFields: 1 },\n\t}).toArray();\n\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\tconst sortedMembers = roomMembers.sort((u1, u2) => (u1.name! || u1.username!).localeCompare(u2.name! || u2.username!));\n\n\tconst usernames: string[] = sortedMembers.map(({ username }) => username as string).filter(Boolean);\n\tconst uids = roomMembers.map(({ _id }) => _id).sort();\n\n\t// Deprecated: using users' _id to compose the room _id is deprecated\n\tconst room: IRoom | null =\n\t\tuids.length === 2\n\t\t\t? await Rooms.findOneById(uids.join(''), { projection: { _id: 1 } })\n\t\t\t: await Rooms.findOneDirectRoomContainingAllUserIDs(uids, { projection: { _id: 1 } });\n\n\tconst isNewRoom = !room;\n\n\tconst roomInfo = {\n\t\t...(uids.length === 2 && { _id: uids.join('') }), // Deprecated: using users' _id to compose the room _id is deprecated\n\t\tt: 'd',\n\t\tusernames,\n\t\tusersCount: members.length,\n\t\tmsgs: 0,\n\t\tts: new Date(),\n\t\tuids,\n\t\t...roomExtraData,\n\t};\n\n\tif (isNewRoom) {\n\t\tconst tmpRoom: { _USERNAMES?: (string | undefined)[] } & typeof roomInfo = {\n\t\t\t...roomInfo,\n\t\t\t_USERNAMES: usernames,\n\t\t};\n\n\t\tconst prevent = await Apps.self?.triggerEvent(AppEvents.IPreRoomCreatePrevent, tmpRoom).catch((error) => {\n\t\t\tif (error.name === AppsEngineException.name) {\n\t\t\t\tthrow new Meteor.Error('error-app-prevented', error.message);\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t});\n\n\t\tif (prevent) {\n\t\t\tthrow new Meteor.Error('error-app-prevented', 'A Rocket.Chat App prevented the room creation.');\n\t\t}\n\n\t\tconst result = await Apps.self?.triggerEvent(\n\t\t\tAppEvents.IPreRoomCreateModify,\n\t\t\tawait Apps.self?.triggerEvent(AppEvents.IPreRoomCreateExtend, tmpRoom),\n\t\t);\n\n\t\tif (typeof result === 'object') {\n\t\t\tObject.assign(roomInfo, result);\n\t\t}\n\n\t\tdelete tmpRoom._USERNAMES;\n\t}\n\n\t// @ts-expect-error - TODO: room expects `u` to be passed, but it's not part of the original object in here\n\tconst rid = room?._id || (await Rooms.insertOne(roomInfo)).insertedId;\n\n\tvoid notifyOnRoomChangedById(rid, isNewRoom ? 'inserted' : 'updated');\n\n\tif (roomMembers.length === 1) {\n\t\t// dm to yourself\n\t\tconst { modifiedCount, upsertedCount } = await Subscriptions.updateOne(\n\t\t\t{ rid, 'u._id': roomMembers[0]._id },\n\t\t\t{\n\t\t\t\t$set: { open: true },\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\t\t$setOnInsert: generateSubscription(roomMembers[0].name! || roomMembers[0].username!, roomMembers[0].username!, roomMembers[0], {\n\t\t\t\t\t...options?.subscriptionExtra,\n\t\t\t\t}),\n\t\t\t},\n\t\t\t{ upsert: true },\n\t\t);\n\t\tif (modifiedCount || upsertedCount) {\n\t\t\tvoid notifyOnSubscriptionChangedByRoomIdAndUserId(rid, roomMembers[0]._id, modifiedCount ? 'updated' : 'inserted');\n\t\t}\n\t} else {\n\t\tconst memberIds = roomMembers.map((member) => member._id);\n\t\tconst membersWithPreferences: IUser[] = await Users.find(\n\t\t\t{ _id: { $in: memberIds } },\n\t\t\t{ projection: { 'username': 1, 'settings.preferences': 1 } },\n\t\t).toArray();\n\n\t\tfor await (const member of membersWithPreferences) {\n\t\t\tconst otherMembers = sortedMembers.filter(({ _id }) => _id !== member._id);\n\t\t\tconst { modifiedCount, upsertedCount } = await Subscriptions.updateOne(\n\t\t\t\t{ rid, 'u._id': member._id },\n\t\t\t\t{\n\t\t\t\t\t...(options?.creator === member._id && { $set: { open: true } }),\n\t\t\t\t\t$setOnInsert: generateSubscription(getFname(otherMembers), getName(otherMembers), member, {\n\t\t\t\t\t\t...options?.subscriptionExtra,\n\t\t\t\t\t\t...(options?.creator !== member._id && { open: members.length > 2 }),\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\t{ upsert: true },\n\t\t\t);\n\t\t\tif (modifiedCount || upsertedCount) {\n\t\t\t\tvoid notifyOnSubscriptionChangedByRoomIdAndUserId(rid, member._id, modifiedCount ? 'updated' : 'inserted');\n\t\t\t}\n\t\t}\n\t}\n\n\t// If the room is new, run a callback\n\tif (isNewRoom) {\n\t\tconst insertedRoom = await Rooms.findOneById(rid);\n\n\t\tawait callbacks.run('afterCreateDirectRoom', insertedRoom, { members: roomMembers, creatorId: options?.creator });\n\n\t\tvoid Apps.self?.triggerEvent(AppEvents.IPostRoomCreate, insertedRoom);\n\t}\n\n\treturn {\n\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t...room!,\n\t\t_id: String(rid),\n\t\tusernames,\n\t\tt: 'd',\n\t\trid,\n\t\tinserted: isNewRoom,\n\t};\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/lib/server/functions/createDirectRoom.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/lib/server/functions/createDirectRoom.ts","inputSourceMap":{"version":3,"file":"app/lib/server/functions/createDirectRoom.ts","sourceRoot":"","sources":["app/lib/server/functions/createDirectRoom.ts"],"names":[],"mappings":"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","sourcesContent":["import { AppEvents, Apps } from '@rocket.chat/apps';\nimport { AppsEngineException } from '@rocket.chat/apps-engine/definition/exceptions';\nimport type { ISubscriptionExtraData } from '@rocket.chat/core-services';\nimport type { ICreatedRoom, IRoom, ISubscription, IUser } from '@rocket.chat/core-typings';\nimport { Rooms, Subscriptions, Users } from '@rocket.chat/models';\nimport { Random } from '@rocket.chat/random';\nimport { Meteor } from 'meteor/meteor';\nimport type { MatchKeysAndValues } from 'mongodb';\n\nimport { callbacks } from '../../../../lib/callbacks';\nimport { isTruthy } from '../../../../lib/isTruthy';\nimport { settings } from '../../../settings/server';\nimport { getDefaultSubscriptionPref } from '../../../utils/lib/getDefaultSubscriptionPref';\nimport { notifyOnRoomChangedById, notifyOnSubscriptionChangedByRoomIdAndUserId } from '../lib/notifyListener';\n\nconst generateSubscription = (\n\tfname: string,\n\tname: string,\n\tuser: IUser,\n\textra: MatchKeysAndValues<ISubscription>,\n): MatchKeysAndValues<ISubscription> => ({\n\t_id: Random.id(),\n\tts: new Date(),\n\talert: false,\n\tunread: 0,\n\tuserMentions: 0,\n\tgroupMentions: 0,\n\t...(user.customFields && { customFields: user.customFields }),\n\t...getDefaultSubscriptionPref(user),\n\t...extra,\n\tt: 'd',\n\tfname,\n\tname,\n\tu: {\n\t\t_id: user._id,\n\t\tusername: user.username,\n\t},\n});\n\nconst getFname = (members: IUser[]): string => members.map(({ name, username }) => name || username).join(', ');\nconst getName = (members: IUser[]): string => members.map(({ username }) => username).join(', ');\n\nexport async function createDirectRoom(\n\tmembers: IUser[] | string[],\n\troomExtraData = {},\n\toptions: {\n\t\tcreator?: string;\n\t\tsubscriptionExtra?: ISubscriptionExtraData;\n\t},\n): Promise<ICreatedRoom> {\n\tconst maxUsers = settings.get<number>('DirectMesssage_maxUsers') || 1;\n\tif (members.length > maxUsers) {\n\t\tthrow new Meteor.Error(\n\t\t\t'error-direct-message-max-user-exceeded',\n\t\t\t`You cannot add more than ${maxUsers} users, including yourself to a direct message`,\n\t\t\t{\n\t\t\t\tmethod: 'createDirectRoom',\n\t\t\t},\n\t\t);\n\t}\n\n\tawait callbacks.run('beforeCreateDirectRoom', members);\n\n\tconst membersUsernames: string[] = members\n\t\t.map((member) => {\n\t\t\tif (typeof member === 'string') {\n\t\t\t\treturn member.replace('@', '');\n\t\t\t}\n\t\t\treturn member.username;\n\t\t})\n\t\t.filter(isTruthy);\n\n\tconst roomMembers: IUser[] = await Users.findUsersByUsernames(membersUsernames, {\n\t\tprojection: { _id: 1, name: 1, username: 1, settings: 1, customFields: 1 },\n\t}).toArray();\n\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\tconst sortedMembers = roomMembers.sort((u1, u2) => (u1.name! || u1.username!).localeCompare(u2.name! || u2.username!));\n\n\tconst usernames: string[] = sortedMembers.map(({ username }) => username as string).filter(Boolean);\n\tconst uids = roomMembers.map(({ _id }) => _id).sort();\n\n\t// Deprecated: using users' _id to compose the room _id is deprecated\n\tconst room: IRoom | null =\n\t\tuids.length === 2\n\t\t\t? await Rooms.findOneById(uids.join(''), { projection: { _id: 1 } })\n\t\t\t: await Rooms.findOneDirectRoomContainingAllUserIDs(uids, { projection: { _id: 1 } });\n\n\tconst isNewRoom = !room;\n\n\tconst roomInfo = {\n\t\t...(uids.length === 2 && { _id: uids.join('') }), // Deprecated: using users' _id to compose the room _id is deprecated\n\t\tt: 'd',\n\t\tusernames,\n\t\tusersCount: members.length,\n\t\tmsgs: 0,\n\t\tts: new Date(),\n\t\tuids,\n\t\t...roomExtraData,\n\t};\n\n\tif (isNewRoom) {\n\t\tconst tmpRoom: { _USERNAMES?: (string | undefined)[] } & typeof roomInfo = {\n\t\t\t...roomInfo,\n\t\t\t_USERNAMES: usernames,\n\t\t};\n\n\t\tconst prevent = await Apps.self?.triggerEvent(AppEvents.IPreRoomCreatePrevent, tmpRoom).catch((error) => {\n\t\t\tif (error.name === AppsEngineException.name) {\n\t\t\t\tthrow new Meteor.Error('error-app-prevented', error.message);\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t});\n\n\t\tif (prevent) {\n\t\t\tthrow new Meteor.Error('error-app-prevented', 'A Rocket.Chat App prevented the room creation.');\n\t\t}\n\n\t\tconst result = await Apps.self?.triggerEvent(\n\t\t\tAppEvents.IPreRoomCreateModify,\n\t\t\tawait Apps.self?.triggerEvent(AppEvents.IPreRoomCreateExtend, tmpRoom),\n\t\t);\n\n\t\tif (typeof result === 'object') {\n\t\t\tObject.assign(roomInfo, result);\n\t\t}\n\n\t\tdelete tmpRoom._USERNAMES;\n\t}\n\n\t// @ts-expect-error - TODO: room expects `u` to be passed, but it's not part of the original object in here\n\tconst rid = room?._id || (await Rooms.insertOne(roomInfo)).insertedId;\n\n\tvoid notifyOnRoomChangedById(rid, isNewRoom ? 'inserted' : 'updated');\n\n\tif (roomMembers.length === 1) {\n\t\t// dm to yourself\n\t\tconst { modifiedCount, upsertedCount } = await Subscriptions.updateOne(\n\t\t\t{ rid, 'u._id': roomMembers[0]._id },\n\t\t\t{\n\t\t\t\t$set: { open: true },\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\t\t$setOnInsert: generateSubscription(roomMembers[0].name! || roomMembers[0].username!, roomMembers[0].username!, roomMembers[0], {\n\t\t\t\t\t...options?.subscriptionExtra,\n\t\t\t\t}),\n\t\t\t},\n\t\t\t{ upsert: true },\n\t\t);\n\t\tif (modifiedCount || upsertedCount) {\n\t\t\tvoid notifyOnSubscriptionChangedByRoomIdAndUserId(rid, roomMembers[0]._id, modifiedCount ? 'updated' : 'inserted');\n\t\t}\n\t} else {\n\t\tconst memberIds = roomMembers.map((member) => member._id);\n\t\tconst membersWithPreferences: IUser[] = await Users.find(\n\t\t\t{ _id: { $in: memberIds } },\n\t\t\t{ projection: { 'username': 1, 'settings.preferences': 1 } },\n\t\t).toArray();\n\n\t\tfor await (const member of membersWithPreferences) {\n\t\t\tconst otherMembers = sortedMembers.filter(({ _id }) => _id !== member._id);\n\t\t\tconst { modifiedCount, upsertedCount } = await Subscriptions.updateOne(\n\t\t\t\t{ rid, 'u._id': member._id },\n\t\t\t\t{\n\t\t\t\t\t...(options?.creator === member._id && { $set: { open: true } }),\n\t\t\t\t\t$setOnInsert: generateSubscription(getFname(otherMembers), getName(otherMembers), member, {\n\t\t\t\t\t\t...options?.subscriptionExtra,\n\t\t\t\t\t\t...(options?.creator !== member._id && { open: members.length > 2 }),\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\t{ upsert: true },\n\t\t\t);\n\t\t\tif (modifiedCount || upsertedCount) {\n\t\t\t\tvoid notifyOnSubscriptionChangedByRoomIdAndUserId(rid, member._id, modifiedCount ? 'updated' : 'inserted');\n\t\t\t}\n\t\t}\n\t}\n\n\t// If the room is new, run a callback\n\tif (isNewRoom) {\n\t\tconst insertedRoom = await Rooms.findOneById(rid);\n\n\t\tawait callbacks.run('afterCreateDirectRoom', insertedRoom, { members: roomMembers, creatorId: options?.creator });\n\n\t\tvoid Apps.self?.triggerEvent(AppEvents.IPostRoomCreate, insertedRoom);\n\t}\n\n\treturn {\n\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t...room!,\n\t\t_id: String(rid),\n\t\tusernames,\n\t\tt: 'd',\n\t\trid,\n\t\tinserted: isNewRoom,\n\t};\n}\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let _objectSpread;\n    module.link(\"@babel/runtime/helpers/objectSpread2\", {\n      default(v) {\n        _objectSpread = v;\n      }\n    }, 0);\n    let _asyncIterator;\n    module.link(\"@babel/runtime/helpers/asyncIterator\", {\n      default(v) {\n        _asyncIterator = v;\n      }\n    }, 1);\n    module.export({\n      createDirectRoom: () => createDirectRoom\n    });\n    let AppEvents, Apps;\n    module.link(\"@rocket.chat/apps\", {\n      AppEvents(v) {\n        AppEvents = v;\n      },\n      Apps(v) {\n        Apps = v;\n      }\n    }, 0);\n    let AppsEngineException;\n    module.link(\"@rocket.chat/apps-engine/definition/exceptions\", {\n      AppsEngineException(v) {\n        AppsEngineException = v;\n      }\n    }, 1);\n    let Rooms, Subscriptions, Users;\n    module.link(\"@rocket.chat/models\", {\n      Rooms(v) {\n        Rooms = v;\n      },\n      Subscriptions(v) {\n        Subscriptions = v;\n      },\n      Users(v) {\n        Users = v;\n      }\n    }, 2);\n    let Random;\n    module.link(\"@rocket.chat/random\", {\n      Random(v) {\n        Random = v;\n      }\n    }, 3);\n    let Meteor;\n    module.link(\"meteor/meteor\", {\n      Meteor(v) {\n        Meteor = v;\n      }\n    }, 4);\n    let callbacks;\n    module.link(\"../../../../lib/callbacks\", {\n      callbacks(v) {\n        callbacks = v;\n      }\n    }, 5);\n    let isTruthy;\n    module.link(\"../../../../lib/isTruthy\", {\n      isTruthy(v) {\n        isTruthy = v;\n      }\n    }, 6);\n    let settings;\n    module.link(\"../../../settings/server\", {\n      settings(v) {\n        settings = v;\n      }\n    }, 7);\n    let getDefaultSubscriptionPref;\n    module.link(\"../../../utils/lib/getDefaultSubscriptionPref\", {\n      getDefaultSubscriptionPref(v) {\n        getDefaultSubscriptionPref = v;\n      }\n    }, 8);\n    let notifyOnRoomChangedById, notifyOnSubscriptionChangedByRoomIdAndUserId;\n    module.link(\"../lib/notifyListener\", {\n      notifyOnRoomChangedById(v) {\n        notifyOnRoomChangedById = v;\n      },\n      notifyOnSubscriptionChangedByRoomIdAndUserId(v) {\n        notifyOnSubscriptionChangedByRoomIdAndUserId = v;\n      }\n    }, 9);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    const generateSubscription = (fname, name, user, extra) => _objectSpread(_objectSpread(_objectSpread(_objectSpread({\n      _id: Random.id(),\n      ts: new Date(),\n      alert: false,\n      unread: 0,\n      userMentions: 0,\n      groupMentions: 0\n    }, user.customFields && {\n      customFields: user.customFields\n    }), getDefaultSubscriptionPref(user)), extra), {}, {\n      t: 'd',\n      fname,\n      name,\n      u: {\n        _id: user._id,\n        username: user.username\n      }\n    });\n    const getFname = members => members.map(_ref => {\n      let {\n        name,\n        username\n      } = _ref;\n      return name || username;\n    }).join(', ');\n    const getName = members => members.map(_ref2 => {\n      let {\n        username\n      } = _ref2;\n      return username;\n    }).join(', ');\n    async function createDirectRoom(members) {\n      let roomExtraData = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      let options = arguments.length > 2 ? arguments[2] : undefined;\n      const maxUsers = settings.get('DirectMesssage_maxUsers') || 1;\n      if (members.length > maxUsers) {\n        throw new Meteor.Error('error-direct-message-max-user-exceeded', \"You cannot add more than \".concat(maxUsers, \" users, including yourself to a direct message\"), {\n          method: 'createDirectRoom'\n        });\n      }\n      await callbacks.run('beforeCreateDirectRoom', members);\n      const membersUsernames = members.map(member => {\n        if (typeof member === 'string') {\n          return member.replace('@', '');\n        }\n        return member.username;\n      }).filter(isTruthy);\n      const roomMembers = await Users.findUsersByUsernames(membersUsernames, {\n        projection: {\n          _id: 1,\n          name: 1,\n          username: 1,\n          settings: 1,\n          customFields: 1\n        }\n      }).toArray();\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      const sortedMembers = roomMembers.sort((u1, u2) => (u1.name || u1.username).localeCompare(u2.name || u2.username));\n      const usernames = sortedMembers.map(_ref3 => {\n        let {\n          username\n        } = _ref3;\n        return username;\n      }).filter(Boolean);\n      const uids = roomMembers.map(_ref4 => {\n        let {\n          _id\n        } = _ref4;\n        return _id;\n      }).sort();\n      // Deprecated: using users' _id to compose the room _id is deprecated\n      const room = uids.length === 2 ? await Rooms.findOneById(uids.join(''), {\n        projection: {\n          _id: 1\n        }\n      }) : await Rooms.findOneDirectRoomContainingAllUserIDs(uids, {\n        projection: {\n          _id: 1\n        }\n      });\n      const isNewRoom = !room;\n      const roomInfo = _objectSpread(_objectSpread({}, uids.length === 2 && {\n        _id: uids.join('')\n      }), {}, {\n        // Deprecated: using users' _id to compose the room _id is deprecated\n        t: 'd',\n        usernames,\n        usersCount: members.length,\n        msgs: 0,\n        ts: new Date(),\n        uids\n      }, roomExtraData);\n      if (isNewRoom) {\n        var _Apps$self, _Apps$self2, _Apps$self3;\n        const tmpRoom = _objectSpread(_objectSpread({}, roomInfo), {}, {\n          _USERNAMES: usernames\n        });\n        const prevent = await ((_Apps$self = Apps.self) === null || _Apps$self === void 0 ? void 0 : _Apps$self.triggerEvent(AppEvents.IPreRoomCreatePrevent, tmpRoom).catch(error => {\n          if (error.name === AppsEngineException.name) {\n            throw new Meteor.Error('error-app-prevented', error.message);\n          }\n          throw error;\n        }));\n        if (prevent) {\n          throw new Meteor.Error('error-app-prevented', 'A Rocket.Chat App prevented the room creation.');\n        }\n        const result = await ((_Apps$self2 = Apps.self) === null || _Apps$self2 === void 0 ? void 0 : _Apps$self2.triggerEvent(AppEvents.IPreRoomCreateModify, await ((_Apps$self3 = Apps.self) === null || _Apps$self3 === void 0 ? void 0 : _Apps$self3.triggerEvent(AppEvents.IPreRoomCreateExtend, tmpRoom))));\n        if (typeof result === 'object') {\n          Object.assign(roomInfo, result);\n        }\n        delete tmpRoom._USERNAMES;\n      }\n      // @ts-expect-error - TODO: room expects `u` to be passed, but it's not part of the original object in here\n      const rid = (room === null || room === void 0 ? void 0 : room._id) || (await Rooms.insertOne(roomInfo)).insertedId;\n      void notifyOnRoomChangedById(rid, isNewRoom ? 'inserted' : 'updated');\n      if (roomMembers.length === 1) {\n        // dm to yourself\n        const {\n          modifiedCount,\n          upsertedCount\n        } = await Subscriptions.updateOne({\n          rid,\n          'u._id': roomMembers[0]._id\n        }, {\n          $set: {\n            open: true\n          },\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          $setOnInsert: generateSubscription(roomMembers[0].name || roomMembers[0].username, roomMembers[0].username, roomMembers[0], _objectSpread({}, options === null || options === void 0 ? void 0 : options.subscriptionExtra))\n        }, {\n          upsert: true\n        });\n        if (modifiedCount || upsertedCount) {\n          void notifyOnSubscriptionChangedByRoomIdAndUserId(rid, roomMembers[0]._id, modifiedCount ? 'updated' : 'inserted');\n        }\n      } else {\n        const memberIds = roomMembers.map(member => member._id);\n        const membersWithPreferences = await Users.find({\n          _id: {\n            $in: memberIds\n          }\n        }, {\n          projection: {\n            'username': 1,\n            'settings.preferences': 1\n          }\n        }).toArray();\n        var _iteratorAbruptCompletion = false;\n        var _didIteratorError = false;\n        var _iteratorError;\n        try {\n          for (var _iterator = _asyncIterator(membersWithPreferences), _step; _iteratorAbruptCompletion = !(_step = await _iterator.next()).done; _iteratorAbruptCompletion = false) {\n            const member = _step.value;\n            {\n              const otherMembers = sortedMembers.filter(_ref5 => {\n                let {\n                  _id\n                } = _ref5;\n                return _id !== member._id;\n              });\n              const {\n                modifiedCount,\n                upsertedCount\n              } = await Subscriptions.updateOne({\n                rid,\n                'u._id': member._id\n              }, _objectSpread(_objectSpread({}, (options === null || options === void 0 ? void 0 : options.creator) === member._id && {\n                $set: {\n                  open: true\n                }\n              }), {}, {\n                $setOnInsert: generateSubscription(getFname(otherMembers), getName(otherMembers), member, _objectSpread(_objectSpread({}, options === null || options === void 0 ? void 0 : options.subscriptionExtra), (options === null || options === void 0 ? void 0 : options.creator) !== member._id && {\n                  open: members.length > 2\n                }))\n              }), {\n                upsert: true\n              });\n              if (modifiedCount || upsertedCount) {\n                void notifyOnSubscriptionChangedByRoomIdAndUserId(rid, member._id, modifiedCount ? 'updated' : 'inserted');\n              }\n            }\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (_iteratorAbruptCompletion && _iterator.return != null) {\n              await _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n      }\n      // If the room is new, run a callback\n      if (isNewRoom) {\n        var _Apps$self4;\n        const insertedRoom = await Rooms.findOneById(rid);\n        await callbacks.run('afterCreateDirectRoom', insertedRoom, {\n          members: roomMembers,\n          creatorId: options === null || options === void 0 ? void 0 : options.creator\n        });\n        void ((_Apps$self4 = Apps.self) === null || _Apps$self4 === void 0 ? void 0 : _Apps$self4.triggerEvent(AppEvents.IPostRoomCreate, insertedRoom));\n      }\n      return _objectSpread(_objectSpread({}, room), {}, {\n        _id: String(rid),\n        usernames,\n        t: 'd',\n        rid,\n        inserted: isNewRoom\n      });\n    }\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["_objectSpread","module","link","default","v","_asyncIterator","export","createDirectRoom","AppEvents","Apps","AppsEngineException","Rooms","Subscriptions","Users","Random","Meteor","callbacks","isTruthy","settings","getDefaultSubscriptionPref","notifyOnRoomChangedById","notifyOnSubscriptionChangedByRoomIdAndUserId","__reifyWaitForDeps__","generateSubscription","fname","name","user","extra","_id","id","ts","Date","alert","unread","userMentions","groupMentions","customFields","t","u","username","getFname","members","map","_ref","join","getName","_ref2","roomExtraData","arguments","length","undefined","options","maxUsers","get","Error","concat","method","run","membersUsernames","member","replace","filter","roomMembers","findUsersByUsernames","projection","toArray","sortedMembers","sort","u1","u2","localeCompare","usernames","_ref3","Boolean","uids","_ref4","room","findOneById","findOneDirectRoomContainingAllUserIDs","isNewRoom","roomInfo","usersCount","msgs","_Apps$self","_Apps$self2","_Apps$self3","tmpRoom","_USERNAMES","prevent","self","triggerEvent","IPreRoomCreatePrevent","catch","error","message","result","IPreRoomCreateModify","IPreRoomCreateExtend","Object","assign","rid","insertOne","insertedId","modifiedCount","upsertedCount","updateOne","$set","open","$setOnInsert","subscriptionExtra","upsert","memberIds","membersWithPreferences","find","$in","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","next","done","value","otherMembers","_ref5","creator","err","return","_Apps$self4","insertedRoom","creatorId","IPostRoomCreate","String","inserted","__reify_async_result__","_reifyError","async"],"sources":["app/lib/server/functions/createDirectRoom.ts"],"sourcesContent":["import { AppEvents, Apps } from '@rocket.chat/apps';\nimport { AppsEngineException } from '@rocket.chat/apps-engine/definition/exceptions';\nimport type { ISubscriptionExtraData } from '@rocket.chat/core-services';\nimport type { ICreatedRoom, IRoom, ISubscription, IUser } from '@rocket.chat/core-typings';\nimport { Rooms, Subscriptions, Users } from '@rocket.chat/models';\nimport { Random } from '@rocket.chat/random';\nimport { Meteor } from 'meteor/meteor';\nimport type { MatchKeysAndValues } from 'mongodb';\n\nimport { callbacks } from '../../../../lib/callbacks';\nimport { isTruthy } from '../../../../lib/isTruthy';\nimport { settings } from '../../../settings/server';\nimport { getDefaultSubscriptionPref } from '../../../utils/lib/getDefaultSubscriptionPref';\nimport { notifyOnRoomChangedById, notifyOnSubscriptionChangedByRoomIdAndUserId } from '../lib/notifyListener';\n\nconst generateSubscription = (\n\tfname: string,\n\tname: string,\n\tuser: IUser,\n\textra: MatchKeysAndValues<ISubscription>,\n): MatchKeysAndValues<ISubscription> => ({\n\t_id: Random.id(),\n\tts: new Date(),\n\talert: false,\n\tunread: 0,\n\tuserMentions: 0,\n\tgroupMentions: 0,\n\t...(user.customFields && { customFields: user.customFields }),\n\t...getDefaultSubscriptionPref(user),\n\t...extra,\n\tt: 'd',\n\tfname,\n\tname,\n\tu: {\n\t\t_id: user._id,\n\t\tusername: user.username,\n\t},\n});\n\nconst getFname = (members: IUser[]): string => members.map(({ name, username }) => name || username).join(', ');\nconst getName = (members: IUser[]): string => members.map(({ username }) => username).join(', ');\n\nexport async function createDirectRoom(\n\tmembers: IUser[] | string[],\n\troomExtraData = {},\n\toptions: {\n\t\tcreator?: string;\n\t\tsubscriptionExtra?: ISubscriptionExtraData;\n\t},\n): Promise<ICreatedRoom> {\n\tconst maxUsers = settings.get<number>('DirectMesssage_maxUsers') || 1;\n\tif (members.length > maxUsers) {\n\t\tthrow new Meteor.Error(\n\t\t\t'error-direct-message-max-user-exceeded',\n\t\t\t`You cannot add more than ${maxUsers} users, including yourself to a direct message`,\n\t\t\t{\n\t\t\t\tmethod: 'createDirectRoom',\n\t\t\t},\n\t\t);\n\t}\n\n\tawait callbacks.run('beforeCreateDirectRoom', members);\n\n\tconst membersUsernames: string[] = members\n\t\t.map((member) => {\n\t\t\tif (typeof member === 'string') {\n\t\t\t\treturn member.replace('@', '');\n\t\t\t}\n\t\t\treturn member.username;\n\t\t})\n\t\t.filter(isTruthy);\n\n\tconst roomMembers: IUser[] = await Users.findUsersByUsernames(membersUsernames, {\n\t\tprojection: { _id: 1, name: 1, username: 1, settings: 1, customFields: 1 },\n\t}).toArray();\n\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\tconst sortedMembers = roomMembers.sort((u1, u2) => (u1.name! || u1.username!).localeCompare(u2.name! || u2.username!));\n\n\tconst usernames: string[] = sortedMembers.map(({ username }) => username as string).filter(Boolean);\n\tconst uids = roomMembers.map(({ _id }) => _id).sort();\n\n\t// Deprecated: using users' _id to compose the room _id is deprecated\n\tconst room: IRoom | null =\n\t\tuids.length === 2\n\t\t\t? await Rooms.findOneById(uids.join(''), { projection: { _id: 1 } })\n\t\t\t: await Rooms.findOneDirectRoomContainingAllUserIDs(uids, { projection: { _id: 1 } });\n\n\tconst isNewRoom = !room;\n\n\tconst roomInfo = {\n\t\t...(uids.length === 2 && { _id: uids.join('') }), // Deprecated: using users' _id to compose the room _id is deprecated\n\t\tt: 'd',\n\t\tusernames,\n\t\tusersCount: members.length,\n\t\tmsgs: 0,\n\t\tts: new Date(),\n\t\tuids,\n\t\t...roomExtraData,\n\t};\n\n\tif (isNewRoom) {\n\t\tconst tmpRoom: { _USERNAMES?: (string | undefined)[] } & typeof roomInfo = {\n\t\t\t...roomInfo,\n\t\t\t_USERNAMES: usernames,\n\t\t};\n\n\t\tconst prevent = await Apps.self?.triggerEvent(AppEvents.IPreRoomCreatePrevent, tmpRoom).catch((error) => {\n\t\t\tif (error.name === AppsEngineException.name) {\n\t\t\t\tthrow new Meteor.Error('error-app-prevented', error.message);\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t});\n\n\t\tif (prevent) {\n\t\t\tthrow new Meteor.Error('error-app-prevented', 'A Rocket.Chat App prevented the room creation.');\n\t\t}\n\n\t\tconst result = await Apps.self?.triggerEvent(\n\t\t\tAppEvents.IPreRoomCreateModify,\n\t\t\tawait Apps.self?.triggerEvent(AppEvents.IPreRoomCreateExtend, tmpRoom),\n\t\t);\n\n\t\tif (typeof result === 'object') {\n\t\t\tObject.assign(roomInfo, result);\n\t\t}\n\n\t\tdelete tmpRoom._USERNAMES;\n\t}\n\n\t// @ts-expect-error - TODO: room expects `u` to be passed, but it's not part of the original object in here\n\tconst rid = room?._id || (await Rooms.insertOne(roomInfo)).insertedId;\n\n\tvoid notifyOnRoomChangedById(rid, isNewRoom ? 'inserted' : 'updated');\n\n\tif (roomMembers.length === 1) {\n\t\t// dm to yourself\n\t\tconst { modifiedCount, upsertedCount } = await Subscriptions.updateOne(\n\t\t\t{ rid, 'u._id': roomMembers[0]._id },\n\t\t\t{\n\t\t\t\t$set: { open: true },\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\t\t$setOnInsert: generateSubscription(roomMembers[0].name! || roomMembers[0].username!, roomMembers[0].username!, roomMembers[0], {\n\t\t\t\t\t...options?.subscriptionExtra,\n\t\t\t\t}),\n\t\t\t},\n\t\t\t{ upsert: true },\n\t\t);\n\t\tif (modifiedCount || upsertedCount) {\n\t\t\tvoid notifyOnSubscriptionChangedByRoomIdAndUserId(rid, roomMembers[0]._id, modifiedCount ? 'updated' : 'inserted');\n\t\t}\n\t} else {\n\t\tconst memberIds = roomMembers.map((member) => member._id);\n\t\tconst membersWithPreferences: IUser[] = await Users.find(\n\t\t\t{ _id: { $in: memberIds } },\n\t\t\t{ projection: { 'username': 1, 'settings.preferences': 1 } },\n\t\t).toArray();\n\n\t\tfor await (const member of membersWithPreferences) {\n\t\t\tconst otherMembers = sortedMembers.filter(({ _id }) => _id !== member._id);\n\t\t\tconst { modifiedCount, upsertedCount } = await Subscriptions.updateOne(\n\t\t\t\t{ rid, 'u._id': member._id },\n\t\t\t\t{\n\t\t\t\t\t...(options?.creator === member._id && { $set: { open: true } }),\n\t\t\t\t\t$setOnInsert: generateSubscription(getFname(otherMembers), getName(otherMembers), member, {\n\t\t\t\t\t\t...options?.subscriptionExtra,\n\t\t\t\t\t\t...(options?.creator !== member._id && { open: members.length > 2 }),\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\t{ upsert: true },\n\t\t\t);\n\t\t\tif (modifiedCount || upsertedCount) {\n\t\t\t\tvoid notifyOnSubscriptionChangedByRoomIdAndUserId(rid, member._id, modifiedCount ? 'updated' : 'inserted');\n\t\t\t}\n\t\t}\n\t}\n\n\t// If the room is new, run a callback\n\tif (isNewRoom) {\n\t\tconst insertedRoom = await Rooms.findOneById(rid);\n\n\t\tawait callbacks.run('afterCreateDirectRoom', insertedRoom, { members: roomMembers, creatorId: options?.creator });\n\n\t\tvoid Apps.self?.triggerEvent(AppEvents.IPostRoomCreate, insertedRoom);\n\t}\n\n\treturn {\n\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t...room!,\n\t\t_id: String(rid),\n\t\tusernames,\n\t\tt: 'd',\n\t\trid,\n\t\tinserted: isNewRoom,\n\t};\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"1360ccbfc290c2c6ce86420aea7ffe9174621343"}
