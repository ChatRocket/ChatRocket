{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/openCASLoginPopup.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/lib/openCASLoginPopup.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/openCASLoginPopup.ts","inputSourceMap":{"version":3,"file":"client/lib/openCASLoginPopup.ts","sourceRoot":"","sources":["client/lib/openCASLoginPopup.ts"],"names":[],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport { settings } from '../../app/settings/client';\n\nconst openCenteredPopup = (url: string, width: number, height: number) => {\n\tconst screenX = window.screenX ?? window.screenLeft;\n\tconst screenY = window.screenY ?? window.screenTop;\n\tconst outerWidth = window.outerWidth ?? document.body.clientWidth;\n\tconst outerHeight = window.outerHeight ?? document.body.clientHeight - 22;\n\t// XXX what is the 22? Probably the height of the title bar.\n\t// Use `outerWidth - width` and `outerHeight - height` for help in\n\t// positioning the popup centered relative to the current window\n\tconst left = screenX + (outerWidth - width) / 2;\n\tconst top = screenY + (outerHeight - height) / 2;\n\tconst features = `width=${width},height=${height},left=${left},top=${top},scrollbars=yes`;\n\n\tconst newwindow = window.open(url, 'Login', features);\n\n\tif (!newwindow) {\n\t\tthrow new Error('Could not open popup');\n\t}\n\n\tnewwindow.focus();\n\n\treturn newwindow;\n};\n\nconst getPopupUrl = (credentialToken: string): string => {\n\tconst loginUrl = settings.get<string | undefined>('CAS_login_url');\n\n\tif (!loginUrl) {\n\t\tthrow new Error('CAS_login_url not set');\n\t}\n\n\tconst appUrl = Meteor.absoluteUrl().replace(/\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\tconst serviceUrl = `${appUrl}/_cas/${credentialToken}`;\n\tconst url = new URL(loginUrl);\n\turl.searchParams.set('service', serviceUrl);\n\n\treturn url.href;\n};\n\nconst waitForPopupClose = (popup: Window) => {\n\treturn new Promise<void>((resolve) => {\n\t\tconst checkPopupOpen = setInterval(() => {\n\t\t\tif (popup.closed || popup.closed === undefined) {\n\t\t\t\tclearInterval(checkPopupOpen);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t}, 100);\n\t});\n};\n\nexport const openCASLoginPopup = async (credentialToken: string) => {\n\tconst popupWidth = settings.get<number>('CAS_popup_width') || 800;\n\tconst popupHeight = settings.get<number>('CAS_popup_height') || 600;\n\n\tconst popupUrl = getPopupUrl(credentialToken);\n\tconst popup = openCenteredPopup(popupUrl, popupWidth, popupHeight);\n\n\tawait waitForPopupClose(popup);\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/openCASLoginPopup.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/lib/openCASLoginPopup.ts","inputSourceMap":{"version":3,"file":"client/lib/openCASLoginPopup.ts","sourceRoot":"","sources":["client/lib/openCASLoginPopup.ts"],"names":[],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport { settings } from '../../app/settings/client';\n\nconst openCenteredPopup = (url: string, width: number, height: number) => {\n\tconst screenX = window.screenX ?? window.screenLeft;\n\tconst screenY = window.screenY ?? window.screenTop;\n\tconst outerWidth = window.outerWidth ?? document.body.clientWidth;\n\tconst outerHeight = window.outerHeight ?? document.body.clientHeight - 22;\n\t// XXX what is the 22? Probably the height of the title bar.\n\t// Use `outerWidth - width` and `outerHeight - height` for help in\n\t// positioning the popup centered relative to the current window\n\tconst left = screenX + (outerWidth - width) / 2;\n\tconst top = screenY + (outerHeight - height) / 2;\n\tconst features = `width=${width},height=${height},left=${left},top=${top},scrollbars=yes`;\n\n\tconst newwindow = window.open(url, 'Login', features);\n\n\tif (!newwindow) {\n\t\tthrow new Error('Could not open popup');\n\t}\n\n\tnewwindow.focus();\n\n\treturn newwindow;\n};\n\nconst getPopupUrl = (credentialToken: string): string => {\n\tconst loginUrl = settings.get<string | undefined>('CAS_login_url');\n\n\tif (!loginUrl) {\n\t\tthrow new Error('CAS_login_url not set');\n\t}\n\n\tconst appUrl = Meteor.absoluteUrl().replace(/\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\tconst serviceUrl = `${appUrl}/_cas/${credentialToken}`;\n\tconst url = new URL(loginUrl);\n\turl.searchParams.set('service', serviceUrl);\n\n\treturn url.href;\n};\n\nconst waitForPopupClose = (popup: Window) => {\n\treturn new Promise<void>((resolve) => {\n\t\tconst checkPopupOpen = setInterval(() => {\n\t\t\tif (popup.closed || popup.closed === undefined) {\n\t\t\t\tclearInterval(checkPopupOpen);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t}, 100);\n\t});\n};\n\nexport const openCASLoginPopup = async (credentialToken: string) => {\n\tconst popupWidth = settings.get<number>('CAS_popup_width') || 800;\n\tconst popupHeight = settings.get<number>('CAS_popup_height') || 600;\n\n\tconst popupUrl = getPopupUrl(credentialToken);\n\tconst popup = openCenteredPopup(popupUrl, popupWidth, popupHeight);\n\n\tawait waitForPopupClose(popup);\n};\n"]}}},"code":"module.export({\n  openCASLoginPopup: () => openCASLoginPopup\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n}, 0);\nlet settings;\nmodule.link(\"../../app/settings/client\", {\n  settings(v) {\n    settings = v;\n  }\n}, 1);\nconst openCenteredPopup = (url, width, height) => {\n  var _window$screenX, _window$screenY, _window$outerWidth, _window$outerHeight;\n  const screenX = (_window$screenX = window.screenX) !== null && _window$screenX !== void 0 ? _window$screenX : window.screenLeft;\n  const screenY = (_window$screenY = window.screenY) !== null && _window$screenY !== void 0 ? _window$screenY : window.screenTop;\n  const outerWidth = (_window$outerWidth = window.outerWidth) !== null && _window$outerWidth !== void 0 ? _window$outerWidth : document.body.clientWidth;\n  const outerHeight = (_window$outerHeight = window.outerHeight) !== null && _window$outerHeight !== void 0 ? _window$outerHeight : document.body.clientHeight - 22;\n  // XXX what is the 22? Probably the height of the title bar.\n  // Use `outerWidth - width` and `outerHeight - height` for help in\n  // positioning the popup centered relative to the current window\n  const left = screenX + (outerWidth - width) / 2;\n  const top = screenY + (outerHeight - height) / 2;\n  const features = \"width=\".concat(width, \",height=\").concat(height, \",left=\").concat(left, \",top=\").concat(top, \",scrollbars=yes\");\n  const newwindow = window.open(url, 'Login', features);\n  if (!newwindow) {\n    throw new Error('Could not open popup');\n  }\n  newwindow.focus();\n  return newwindow;\n};\nconst getPopupUrl = credentialToken => {\n  const loginUrl = settings.get('CAS_login_url');\n  if (!loginUrl) {\n    throw new Error('CAS_login_url not set');\n  }\n  const appUrl = Meteor.absoluteUrl().replace(/\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n  const serviceUrl = \"\".concat(appUrl, \"/_cas/\").concat(credentialToken);\n  const url = new URL(loginUrl);\n  url.searchParams.set('service', serviceUrl);\n  return url.href;\n};\nconst waitForPopupClose = popup => {\n  return new Promise(resolve => {\n    const checkPopupOpen = setInterval(() => {\n      if (popup.closed || popup.closed === undefined) {\n        clearInterval(checkPopupOpen);\n        resolve();\n      }\n    }, 100);\n  });\n};\nconst openCASLoginPopup = async credentialToken => {\n  const popupWidth = settings.get('CAS_popup_width') || 800;\n  const popupHeight = settings.get('CAS_popup_height') || 600;\n  const popupUrl = getPopupUrl(credentialToken);\n  const popup = openCenteredPopup(popupUrl, popupWidth, popupHeight);\n  await waitForPopupClose(popup);\n};","map":{"version":3,"names":["module","export","openCASLoginPopup","Meteor","link","v","settings","openCenteredPopup","url","width","height","_window$screenX","_window$screenY","_window$outerWidth","_window$outerHeight","screenX","window","screenLeft","screenY","screenTop","outerWidth","document","body","clientWidth","outerHeight","clientHeight","left","top","features","concat","newwindow","open","Error","focus","getPopupUrl","credentialToken","loginUrl","get","appUrl","absoluteUrl","replace","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","serviceUrl","URL","searchParams","set","href","waitForPopupClose","popup","Promise","resolve","checkPopupOpen","setInterval","closed","undefined","clearInterval","popupWidth","popupHeight","popupUrl"],"sources":["client/lib/openCASLoginPopup.ts"],"sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport { settings } from '../../app/settings/client';\n\nconst openCenteredPopup = (url: string, width: number, height: number) => {\n\tconst screenX = window.screenX ?? window.screenLeft;\n\tconst screenY = window.screenY ?? window.screenTop;\n\tconst outerWidth = window.outerWidth ?? document.body.clientWidth;\n\tconst outerHeight = window.outerHeight ?? document.body.clientHeight - 22;\n\t// XXX what is the 22? Probably the height of the title bar.\n\t// Use `outerWidth - width` and `outerHeight - height` for help in\n\t// positioning the popup centered relative to the current window\n\tconst left = screenX + (outerWidth - width) / 2;\n\tconst top = screenY + (outerHeight - height) / 2;\n\tconst features = `width=${width},height=${height},left=${left},top=${top},scrollbars=yes`;\n\n\tconst newwindow = window.open(url, 'Login', features);\n\n\tif (!newwindow) {\n\t\tthrow new Error('Could not open popup');\n\t}\n\n\tnewwindow.focus();\n\n\treturn newwindow;\n};\n\nconst getPopupUrl = (credentialToken: string): string => {\n\tconst loginUrl = settings.get<string | undefined>('CAS_login_url');\n\n\tif (!loginUrl) {\n\t\tthrow new Error('CAS_login_url not set');\n\t}\n\n\tconst appUrl = Meteor.absoluteUrl().replace(/\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\tconst serviceUrl = `${appUrl}/_cas/${credentialToken}`;\n\tconst url = new URL(loginUrl);\n\turl.searchParams.set('service', serviceUrl);\n\n\treturn url.href;\n};\n\nconst waitForPopupClose = (popup: Window) => {\n\treturn new Promise<void>((resolve) => {\n\t\tconst checkPopupOpen = setInterval(() => {\n\t\t\tif (popup.closed || popup.closed === undefined) {\n\t\t\t\tclearInterval(checkPopupOpen);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t}, 100);\n\t});\n};\n\nexport const openCASLoginPopup = async (credentialToken: string) => {\n\tconst popupWidth = settings.get<number>('CAS_popup_width') || 800;\n\tconst popupHeight = settings.get<number>('CAS_popup_height') || 600;\n\n\tconst popupUrl = getPopupUrl(credentialToken);\n\tconst popup = openCenteredPopup(popupUrl, popupWidth, popupHeight);\n\n\tawait waitForPopupClose(popup);\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"09014dada3b504385954c574926f350ca0446d16"}
