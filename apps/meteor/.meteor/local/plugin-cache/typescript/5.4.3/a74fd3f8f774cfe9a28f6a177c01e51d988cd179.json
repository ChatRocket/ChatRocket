{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/Factory.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"server/services/federation/infrastructure/Factory.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/Factory.ts","inputSourceMap":{"version":3,"file":"server/services/federation/infrastructure/Factory.ts","sourceRoot":"","sources":["server/services/federation/infrastructure/Factory.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage, IRoom, IUser } from '@rocket.chat/core-typings';\n\nimport { FederationMessageServiceReceiver } from '../application/room/message/receiver/MessageServiceReceiver';\nimport { FederationMessageServiceSender } from '../application/room/message/sender/MessageServiceSender';\nimport { FederationRoomServiceReceiver } from '../application/room/receiver/RoomServiceReceiver';\nimport { FederationRoomInternalValidator } from '../application/room/sender/RoomInternalValidator';\nimport { FederationRoomServiceSender } from '../application/room/sender/RoomServiceSender';\nimport { FederationUserServiceReceiver } from '../application/user/receiver/UserServiceReceiver';\nimport { FederationUserServiceSender } from '../application/user/sender/UserServiceSender';\nimport type { IFederationBridge } from '../domain/IFederationBridge';\nimport { MatrixBridge } from './matrix/Bridge';\nimport { MatrixEventsHandler } from './matrix/handlers';\nimport type { MatrixBaseEventHandler } from './matrix/handlers/BaseEvent';\nimport { MatrixMessageReactedHandler } from './matrix/handlers/Message';\nimport {\n\tMatrixRoomCreatedHandler,\n\tMatrixRoomEventRedactedHandler,\n\tMatrixRoomJoinRulesChangedHandler,\n\tMatrixRoomMembershipChangedHandler,\n\tMatrixRoomMessageSentHandler,\n\tMatrixRoomNameChangedHandler,\n\tMatrixRoomPowerLevelsChangedHandler,\n\tMatrixRoomTopicChangedHandler,\n} from './matrix/handlers/Room';\nimport { MatrixUserTypingStatusChangedHandler } from './matrix/handlers/User';\nimport { InMemoryQueue } from './queue/InMemoryQueue';\nimport { RocketChatFileAdapter } from './rocket-chat/adapters/File';\nimport { RocketChatMessageAdapter } from './rocket-chat/adapters/Message';\nimport { RocketChatNotificationAdapter } from './rocket-chat/adapters/Notification';\nimport { RocketChatRoomAdapter } from './rocket-chat/adapters/Room';\nimport { RocketChatSettingsAdapter } from './rocket-chat/adapters/Settings';\nimport { RocketChatUserAdapter } from './rocket-chat/adapters/User';\nimport { FederationRoomSenderConverter } from './rocket-chat/converters/RoomSender';\nimport { FederationHooks } from './rocket-chat/hooks';\n\nexport class FederationFactory {\n\tpublic static buildInternalSettingsAdapter(): RocketChatSettingsAdapter {\n\t\treturn new RocketChatSettingsAdapter();\n\t}\n\n\tpublic static buildInternalRoomAdapter(): RocketChatRoomAdapter {\n\t\treturn new RocketChatRoomAdapter();\n\t}\n\n\tpublic static buildInternalUserAdapter(): RocketChatUserAdapter {\n\t\treturn new RocketChatUserAdapter();\n\t}\n\n\tpublic static buildInternalMessageAdapter(): RocketChatMessageAdapter {\n\t\treturn new RocketChatMessageAdapter();\n\t}\n\n\tpublic static buildInternalFileAdapter(): RocketChatFileAdapter {\n\t\treturn new RocketChatFileAdapter();\n\t}\n\n\tpublic static buildInternalNotificationAdapter(): RocketChatNotificationAdapter {\n\t\treturn new RocketChatNotificationAdapter();\n\t}\n\n\tpublic static buildFederationQueue(): InMemoryQueue {\n\t\treturn new InMemoryQueue();\n\t}\n\n\tpublic static buildRoomServiceReceiver(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tfederationQueueInstance: InMemoryQueue,\n\t\tbridge: IFederationBridge,\n\t): FederationRoomServiceReceiver {\n\t\treturn new FederationRoomServiceReceiver(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tinternalNotificationAdapter,\n\t\t\tfederationQueueInstance,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildRoomServiceSender(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationRoomServiceSender {\n\t\treturn new FederationRoomServiceSender(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tinternalNotificationAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildUserServiceSender(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationUserServiceSender {\n\t\treturn new FederationUserServiceSender(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalSettingsAdapter, bridge);\n\t}\n\n\tpublic static buildMessageServiceSender(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationMessageServiceSender {\n\t\treturn new FederationMessageServiceSender(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildMessageServiceReceiver(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationMessageServiceReceiver {\n\t\treturn new FederationMessageServiceReceiver(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildUserServiceReceiver(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationUserServiceReceiver {\n\t\treturn new FederationUserServiceReceiver(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalNotificationAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildRoomInternalValidator(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationRoomInternalValidator {\n\t\treturn new FederationRoomInternalValidator(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildFederationBridge(internalSettingsAdapter: RocketChatSettingsAdapter, queue: InMemoryQueue): IFederationBridge {\n\t\treturn new MatrixBridge(internalSettingsAdapter, queue.addToQueue.bind(queue));\n\t}\n\n\tpublic static buildFederationEventHandler(\n\t\troomServiceReceive: FederationRoomServiceReceiver,\n\t\tmessageServiceReceiver: FederationMessageServiceReceiver,\n\t\tuserServiceReceiver: FederationUserServiceReceiver,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t): MatrixEventsHandler {\n\t\treturn new MatrixEventsHandler(\n\t\t\tFederationFactory.getEventHandlers(roomServiceReceive, messageServiceReceiver, userServiceReceiver, internalSettingsAdapter),\n\t\t);\n\t}\n\n\tpublic static getEventHandlers(\n\t\troomServiceReceiver: FederationRoomServiceReceiver,\n\t\tmessageServiceReceiver: FederationMessageServiceReceiver,\n\t\tuserServiceReceiver: FederationUserServiceReceiver,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t): MatrixBaseEventHandler[] {\n\t\treturn [\n\t\t\tnew MatrixRoomCreatedHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomMembershipChangedHandler(roomServiceReceiver, internalSettingsAdapter),\n\t\t\tnew MatrixRoomMessageSentHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomJoinRulesChangedHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomNameChangedHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomTopicChangedHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomEventRedactedHandler(roomServiceReceiver),\n\t\t\tnew MatrixMessageReactedHandler(messageServiceReceiver),\n\t\t\tnew MatrixUserTypingStatusChangedHandler(userServiceReceiver),\n\t\t\tnew MatrixRoomPowerLevelsChangedHandler(roomServiceReceiver),\n\t\t];\n\t}\n\n\tpublic static setupListenersForLocalActions(\n\t\troomServiceSender: FederationRoomServiceSender,\n\t\tmessageServiceSender: FederationMessageServiceSender,\n\t): void {\n\t\tFederationHooks.afterUserLeaveRoom((user: IUser, room: IRoom) =>\n\t\t\troomServiceSender.afterUserLeaveRoom(FederationRoomSenderConverter.toAfterUserLeaveRoom(user._id, room._id)),\n\t\t);\n\t\tFederationHooks.onUserRemovedFromRoom((user: IUser, room: IRoom, userWhoRemoved: IUser) =>\n\t\t\troomServiceSender.onUserRemovedFromRoom(\n\t\t\t\tFederationRoomSenderConverter.toOnUserRemovedFromRoom(user._id, room._id, userWhoRemoved._id),\n\t\t\t),\n\t\t);\n\t\tFederationHooks.afterMessageReacted((message: IMessage, user: IUser, reaction: string) =>\n\t\t\tmessageServiceSender.sendExternalMessageReaction(message, user, reaction),\n\t\t);\n\t\tFederationHooks.afterMessageunReacted((message: IMessage, user: IUser, reaction: string) =>\n\t\t\tmessageServiceSender.sendExternalMessageUnReaction(message, user, reaction),\n\t\t);\n\t\tFederationHooks.afterMessageDeleted((message: IMessage, roomId: string) => roomServiceSender.afterMessageDeleted(message, roomId));\n\t\tFederationHooks.afterMessageUpdated((message: IMessage, roomId: string, userId: string) =>\n\t\t\troomServiceSender.afterMessageUpdated(message, roomId, userId),\n\t\t);\n\t\tFederationHooks.afterMessageSent((message: IMessage, roomId: string, userId: string) =>\n\t\t\troomServiceSender.sendExternalMessage(FederationRoomSenderConverter.toSendExternalMessageDto(userId, roomId, message)),\n\t\t);\n\t\tFederationHooks.afterRoomNameChanged(async (roomId: string, roomName: string) =>\n\t\t\troomServiceSender.afterRoomNameChanged(roomId, roomName),\n\t\t);\n\t\tFederationHooks.afterRoomTopicChanged(async (roomId: string, roomTopic: string) =>\n\t\t\troomServiceSender.afterRoomTopicChanged(roomId, roomTopic),\n\t\t);\n\t}\n\n\tpublic static setupValidators(roomInternalHooksValidator: FederationRoomInternalValidator): void {\n\t\tFederationHooks.canAddFederatedUserToNonFederatedRoom((user: IUser | string, room: IRoom) =>\n\t\t\troomInternalHooksValidator.canAddFederatedUserToNonFederatedRoom(user, room),\n\t\t);\n\t\tFederationHooks.canAddFederatedUserToFederatedRoom((user: IUser | string, inviter: IUser, room: IRoom) =>\n\t\t\troomInternalHooksValidator.canAddFederatedUserToFederatedRoom(user, inviter, room),\n\t\t);\n\t\tFederationHooks.canCreateDirectMessageFromUI((members: (IUser | string)[]) =>\n\t\t\troomInternalHooksValidator.canCreateDirectMessageFromUI(members),\n\t\t);\n\t}\n\n\tpublic static removeCEValidators(): void {\n\t\tFederationHooks.removeCEValidation();\n\t}\n\n\tpublic static removeAllListeners(): void {\n\t\tFederationHooks.removeAllListeners();\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/services/federation/infrastructure/Factory.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"server/services/federation/infrastructure/Factory.ts","inputSourceMap":{"version":3,"file":"server/services/federation/infrastructure/Factory.ts","sourceRoot":"","sources":["server/services/federation/infrastructure/Factory.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,gCAAgC,EAAE,MAAM,6DAA6D,CAAC;AAC/G,OAAO,EAAE,8BAA8B,EAAE,MAAM,yDAAyD,CAAC;AACzG,OAAO,EAAE,6BAA6B,EAAE,MAAM,kDAAkD,CAAC;AACjG,OAAO,EAAE,+BAA+B,EAAE,MAAM,kDAAkD,CAAC;AACnG,OAAO,EAAE,2BAA2B,EAAE,MAAM,8CAA8C,CAAC;AAC3F,OAAO,EAAE,6BAA6B,EAAE,MAAM,kDAAkD,CAAC;AACjG,OAAO,EAAE,2BAA2B,EAAE,MAAM,8CAA8C,CAAC;AAE3F,OAAO,EAAE,YAAY,EAAE,MAAM,iBAAiB,CAAC;AAC/C,OAAO,EAAE,mBAAmB,EAAE,MAAM,mBAAmB,CAAC;AAExD,OAAO,EAAE,2BAA2B,EAAE,MAAM,2BAA2B,CAAC;AACxE,OAAO,EACN,wBAAwB,EACxB,8BAA8B,EAC9B,iCAAiC,EACjC,kCAAkC,EAClC,4BAA4B,EAC5B,4BAA4B,EAC5B,mCAAmC,EACnC,6BAA6B,GAC7B,MAAM,wBAAwB,CAAC;AAChC,OAAO,EAAE,oCAAoC,EAAE,MAAM,wBAAwB,CAAC;AAC9E,OAAO,EAAE,aAAa,EAAE,MAAM,uBAAuB,CAAC;AACtD,OAAO,EAAE,qBAAqB,EAAE,MAAM,6BAA6B,CAAC;AACpE,OAAO,EAAE,wBAAwB,EAAE,MAAM,gCAAgC,CAAC;AAC1E,OAAO,EAAE,6BAA6B,EAAE,MAAM,qCAAqC,CAAC;AACpF,OAAO,EAAE,qBAAqB,EAAE,MAAM,6BAA6B,CAAC;AACpE,OAAO,EAAE,yBAAyB,EAAE,MAAM,iCAAiC,CAAC;AAC5E,OAAO,EAAE,qBAAqB,EAAE,MAAM,6BAA6B,CAAC;AACpE,OAAO,EAAE,6BAA6B,EAAE,MAAM,qCAAqC,CAAC;AACpF,OAAO,EAAE,eAAe,EAAE,MAAM,qBAAqB,CAAC;AAEtD,MAAM,OAAO,iBAAiB;IACtB,MAAM,CAAC,4BAA4B;QACzC,OAAO,IAAI,yBAAyB,EAAE,CAAC;IACxC,CAAC;IAEM,MAAM,CAAC,wBAAwB;QACrC,OAAO,IAAI,qBAAqB,EAAE,CAAC;IACpC,CAAC;IAEM,MAAM,CAAC,wBAAwB;QACrC,OAAO,IAAI,qBAAqB,EAAE,CAAC;IACpC,CAAC;IAEM,MAAM,CAAC,2BAA2B;QACxC,OAAO,IAAI,wBAAwB,EAAE,CAAC;IACvC,CAAC;IAEM,MAAM,CAAC,wBAAwB;QACrC,OAAO,IAAI,qBAAqB,EAAE,CAAC;IACpC,CAAC;IAEM,MAAM,CAAC,gCAAgC;QAC7C,OAAO,IAAI,6BAA6B,EAAE,CAAC;IAC5C,CAAC;IAEM,MAAM,CAAC,oBAAoB;QACjC,OAAO,IAAI,aAAa,EAAE,CAAC;IAC5B,CAAC;IAEM,MAAM,CAAC,wBAAwB,CACrC,mBAA0C,EAC1C,mBAA0C,EAC1C,sBAAgD,EAChD,mBAA0C,EAC1C,uBAAkD,EAClD,2BAA0D,EAC1D,uBAAsC,EACtC,MAAyB;QAEzB,OAAO,IAAI,6BAA6B,CACvC,mBAAmB,EACnB,mBAAmB,EACnB,sBAAsB,EACtB,mBAAmB,EACnB,uBAAuB,EACvB,2BAA2B,EAC3B,uBAAuB,EACvB,MAAM,CACN,CAAC;IACH,CAAC;IAEM,MAAM,CAAC,sBAAsB,CACnC,mBAA0C,EAC1C,mBAA0C,EAC1C,mBAA0C,EAC1C,sBAAgD,EAChD,uBAAkD,EAClD,2BAA0D,EAC1D,MAAyB;QAEzB,OAAO,IAAI,2BAA2B,CACrC,mBAAmB,EACnB,mBAAmB,EACnB,mBAAmB,EACnB,sBAAsB,EACtB,uBAAuB,EACvB,2BAA2B,EAC3B,MAAM,CACN,CAAC;IACH,CAAC;IAEM,MAAM,CAAC,sBAAsB,CACnC,mBAA0C,EAC1C,mBAA0C,EAC1C,mBAA0C,EAC1C,uBAAkD,EAClD,MAAyB;QAEzB,OAAO,IAAI,2BAA2B,CAAC,mBAAmB,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,uBAAuB,EAAE,MAAM,CAAC,CAAC;IACxI,CAAC;IAEM,MAAM,CAAC,yBAAyB,CACtC,mBAA0C,EAC1C,mBAA0C,EAC1C,uBAAkD,EAClD,sBAAgD,EAChD,MAAyB;QAEzB,OAAO,IAAI,8BAA8B,CACxC,mBAAmB,EACnB,mBAAmB,EACnB,uBAAuB,EACvB,sBAAsB,EACtB,MAAM,CACN,CAAC;IACH,CAAC;IAEM,MAAM,CAAC,2BAA2B,CACxC,mBAA0C,EAC1C,mBAA0C,EAC1C,sBAAgD,EAChD,mBAA0C,EAC1C,uBAAkD,EAClD,MAAyB;QAEzB,OAAO,IAAI,gCAAgC,CAC1C,mBAAmB,EACnB,mBAAmB,EACnB,sBAAsB,EACtB,mBAAmB,EACnB,uBAAuB,EACvB,MAAM,CACN,CAAC;IACH,CAAC;IAEM,MAAM,CAAC,wBAAwB,CACrC,mBAA0C,EAC1C,mBAA0C,EAC1C,mBAA0C,EAC1C,2BAA0D,EAC1D,uBAAkD,EAClD,MAAyB;QAEzB,OAAO,IAAI,6BAA6B,CACvC,mBAAmB,EACnB,mBAAmB,EACnB,mBAAmB,EACnB,2BAA2B,EAC3B,uBAAuB,EACvB,MAAM,CACN,CAAC;IACH,CAAC;IAEM,MAAM,CAAC,0BAA0B,CACvC,mBAA0C,EAC1C,mBAA0C,EAC1C,mBAA0C,EAC1C,uBAAkD,EAClD,MAAyB;QAEzB,OAAO,IAAI,+BAA+B,CACzC,mBAAmB,EACnB,mBAAmB,EACnB,mBAAmB,EACnB,uBAAuB,EACvB,MAAM,CACN,CAAC;IACH,CAAC;IAEM,MAAM,CAAC,qBAAqB,CAAC,uBAAkD,EAAE,KAAoB;QAC3G,OAAO,IAAI,YAAY,CAAC,uBAAuB,EAAE,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;IAChF,CAAC;IAEM,MAAM,CAAC,2BAA2B,CACxC,kBAAiD,EACjD,sBAAwD,EACxD,mBAAkD,EAClD,uBAAkD;QAElD,OAAO,IAAI,mBAAmB,CAC7B,iBAAiB,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,sBAAsB,EAAE,mBAAmB,EAAE,uBAAuB,CAAC,CAC5H,CAAC;IACH,CAAC;IAEM,MAAM,CAAC,gBAAgB,CAC7B,mBAAkD,EAClD,sBAAwD,EACxD,mBAAkD,EAClD,uBAAkD;QAElD,OAAO;YACN,IAAI,wBAAwB,CAAC,mBAAmB,CAAC;YACjD,IAAI,kCAAkC,CAAC,mBAAmB,EAAE,uBAAuB,CAAC;YACpF,IAAI,4BAA4B,CAAC,mBAAmB,CAAC;YACrD,IAAI,iCAAiC,CAAC,mBAAmB,CAAC;YAC1D,IAAI,4BAA4B,CAAC,mBAAmB,CAAC;YACrD,IAAI,6BAA6B,CAAC,mBAAmB,CAAC;YACtD,IAAI,8BAA8B,CAAC,mBAAmB,CAAC;YACvD,IAAI,2BAA2B,CAAC,sBAAsB,CAAC;YACvD,IAAI,oCAAoC,CAAC,mBAAmB,CAAC;YAC7D,IAAI,mCAAmC,CAAC,mBAAmB,CAAC;SAC5D,CAAC;IACH,CAAC;IAEM,MAAM,CAAC,6BAA6B,CAC1C,iBAA8C,EAC9C,oBAAoD;QAEpD,eAAe,CAAC,kBAAkB,CAAC,CAAC,IAAW,EAAE,IAAW,EAAE,EAAE,CAC/D,iBAAiB,CAAC,kBAAkB,CAAC,6BAA6B,CAAC,oBAAoB,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAC5G,CAAC;QACF,eAAe,CAAC,qBAAqB,CAAC,CAAC,IAAW,EAAE,IAAW,EAAE,cAAqB,EAAE,EAAE,CACzF,iBAAiB,CAAC,qBAAqB,CACtC,6BAA6B,CAAC,uBAAuB,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,cAAc,CAAC,GAAG,CAAC,CAC7F,CACD,CAAC;QACF,eAAe,CAAC,mBAAmB,CAAC,CAAC,OAAiB,EAAE,IAAW,EAAE,QAAgB,EAAE,EAAE,CACxF,oBAAoB,CAAC,2BAA2B,CAAC,OAAO,EAAE,IAAI,EAAE,QAAQ,CAAC,CACzE,CAAC;QACF,eAAe,CAAC,qBAAqB,CAAC,CAAC,OAAiB,EAAE,IAAW,EAAE,QAAgB,EAAE,EAAE,CAC1F,oBAAoB,CAAC,6BAA6B,CAAC,OAAO,EAAE,IAAI,EAAE,QAAQ,CAAC,CAC3E,CAAC;QACF,eAAe,CAAC,mBAAmB,CAAC,CAAC,OAAiB,EAAE,MAAc,EAAE,EAAE,CAAC,iBAAiB,CAAC,mBAAmB,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC;QACnI,eAAe,CAAC,mBAAmB,CAAC,CAAC,OAAiB,EAAE,MAAc,EAAE,MAAc,EAAE,EAAE,CACzF,iBAAiB,CAAC,mBAAmB,CAAC,OAAO,EAAE,MAAM,EAAE,MAAM,CAAC,CAC9D,CAAC;QACF,eAAe,CAAC,gBAAgB,CAAC,CAAC,OAAiB,EAAE,MAAc,EAAE,MAAc,EAAE,EAAE,CACtF,iBAAiB,CAAC,mBAAmB,CAAC,6BAA6B,CAAC,wBAAwB,CAAC,MAAM,EAAE,MAAM,EAAE,OAAO,CAAC,CAAC,CACtH,CAAC;QACF,eAAe,CAAC,oBAAoB,CAAC,KAAK,EAAE,MAAc,EAAE,QAAgB,EAAE,EAAE,CAC/E,iBAAiB,CAAC,oBAAoB,CAAC,MAAM,EAAE,QAAQ,CAAC,CACxD,CAAC;QACF,eAAe,CAAC,qBAAqB,CAAC,KAAK,EAAE,MAAc,EAAE,SAAiB,EAAE,EAAE,CACjF,iBAAiB,CAAC,qBAAqB,CAAC,MAAM,EAAE,SAAS,CAAC,CAC1D,CAAC;IACH,CAAC;IAEM,MAAM,CAAC,eAAe,CAAC,0BAA2D;QACxF,eAAe,CAAC,qCAAqC,CAAC,CAAC,IAAoB,EAAE,IAAW,EAAE,EAAE,CAC3F,0BAA0B,CAAC,qCAAqC,CAAC,IAAI,EAAE,IAAI,CAAC,CAC5E,CAAC;QACF,eAAe,CAAC,kCAAkC,CAAC,CAAC,IAAoB,EAAE,OAAc,EAAE,IAAW,EAAE,EAAE,CACxG,0BAA0B,CAAC,kCAAkC,CAAC,IAAI,EAAE,OAAO,EAAE,IAAI,CAAC,CAClF,CAAC;QACF,eAAe,CAAC,4BAA4B,CAAC,CAAC,OAA2B,EAAE,EAAE,CAC5E,0BAA0B,CAAC,4BAA4B,CAAC,OAAO,CAAC,CAChE,CAAC;IACH,CAAC;IAEM,MAAM,CAAC,kBAAkB;QAC/B,eAAe,CAAC,kBAAkB,EAAE,CAAC;IACtC,CAAC;IAEM,MAAM,CAAC,kBAAkB;QAC/B,eAAe,CAAC,kBAAkB,EAAE,CAAC;IACtC,CAAC;CACD","sourcesContent":["import type { IMessage, IRoom, IUser } from '@rocket.chat/core-typings';\n\nimport { FederationMessageServiceReceiver } from '../application/room/message/receiver/MessageServiceReceiver';\nimport { FederationMessageServiceSender } from '../application/room/message/sender/MessageServiceSender';\nimport { FederationRoomServiceReceiver } from '../application/room/receiver/RoomServiceReceiver';\nimport { FederationRoomInternalValidator } from '../application/room/sender/RoomInternalValidator';\nimport { FederationRoomServiceSender } from '../application/room/sender/RoomServiceSender';\nimport { FederationUserServiceReceiver } from '../application/user/receiver/UserServiceReceiver';\nimport { FederationUserServiceSender } from '../application/user/sender/UserServiceSender';\nimport type { IFederationBridge } from '../domain/IFederationBridge';\nimport { MatrixBridge } from './matrix/Bridge';\nimport { MatrixEventsHandler } from './matrix/handlers';\nimport type { MatrixBaseEventHandler } from './matrix/handlers/BaseEvent';\nimport { MatrixMessageReactedHandler } from './matrix/handlers/Message';\nimport {\n\tMatrixRoomCreatedHandler,\n\tMatrixRoomEventRedactedHandler,\n\tMatrixRoomJoinRulesChangedHandler,\n\tMatrixRoomMembershipChangedHandler,\n\tMatrixRoomMessageSentHandler,\n\tMatrixRoomNameChangedHandler,\n\tMatrixRoomPowerLevelsChangedHandler,\n\tMatrixRoomTopicChangedHandler,\n} from './matrix/handlers/Room';\nimport { MatrixUserTypingStatusChangedHandler } from './matrix/handlers/User';\nimport { InMemoryQueue } from './queue/InMemoryQueue';\nimport { RocketChatFileAdapter } from './rocket-chat/adapters/File';\nimport { RocketChatMessageAdapter } from './rocket-chat/adapters/Message';\nimport { RocketChatNotificationAdapter } from './rocket-chat/adapters/Notification';\nimport { RocketChatRoomAdapter } from './rocket-chat/adapters/Room';\nimport { RocketChatSettingsAdapter } from './rocket-chat/adapters/Settings';\nimport { RocketChatUserAdapter } from './rocket-chat/adapters/User';\nimport { FederationRoomSenderConverter } from './rocket-chat/converters/RoomSender';\nimport { FederationHooks } from './rocket-chat/hooks';\n\nexport class FederationFactory {\n\tpublic static buildInternalSettingsAdapter(): RocketChatSettingsAdapter {\n\t\treturn new RocketChatSettingsAdapter();\n\t}\n\n\tpublic static buildInternalRoomAdapter(): RocketChatRoomAdapter {\n\t\treturn new RocketChatRoomAdapter();\n\t}\n\n\tpublic static buildInternalUserAdapter(): RocketChatUserAdapter {\n\t\treturn new RocketChatUserAdapter();\n\t}\n\n\tpublic static buildInternalMessageAdapter(): RocketChatMessageAdapter {\n\t\treturn new RocketChatMessageAdapter();\n\t}\n\n\tpublic static buildInternalFileAdapter(): RocketChatFileAdapter {\n\t\treturn new RocketChatFileAdapter();\n\t}\n\n\tpublic static buildInternalNotificationAdapter(): RocketChatNotificationAdapter {\n\t\treturn new RocketChatNotificationAdapter();\n\t}\n\n\tpublic static buildFederationQueue(): InMemoryQueue {\n\t\treturn new InMemoryQueue();\n\t}\n\n\tpublic static buildRoomServiceReceiver(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tfederationQueueInstance: InMemoryQueue,\n\t\tbridge: IFederationBridge,\n\t): FederationRoomServiceReceiver {\n\t\treturn new FederationRoomServiceReceiver(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tinternalNotificationAdapter,\n\t\t\tfederationQueueInstance,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildRoomServiceSender(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationRoomServiceSender {\n\t\treturn new FederationRoomServiceSender(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tinternalNotificationAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildUserServiceSender(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationUserServiceSender {\n\t\treturn new FederationUserServiceSender(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalSettingsAdapter, bridge);\n\t}\n\n\tpublic static buildMessageServiceSender(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationMessageServiceSender {\n\t\treturn new FederationMessageServiceSender(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildMessageServiceReceiver(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationMessageServiceReceiver {\n\t\treturn new FederationMessageServiceReceiver(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildUserServiceReceiver(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationUserServiceReceiver {\n\t\treturn new FederationUserServiceReceiver(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalNotificationAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildRoomInternalValidator(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationRoomInternalValidator {\n\t\treturn new FederationRoomInternalValidator(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildFederationBridge(internalSettingsAdapter: RocketChatSettingsAdapter, queue: InMemoryQueue): IFederationBridge {\n\t\treturn new MatrixBridge(internalSettingsAdapter, queue.addToQueue.bind(queue));\n\t}\n\n\tpublic static buildFederationEventHandler(\n\t\troomServiceReceive: FederationRoomServiceReceiver,\n\t\tmessageServiceReceiver: FederationMessageServiceReceiver,\n\t\tuserServiceReceiver: FederationUserServiceReceiver,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t): MatrixEventsHandler {\n\t\treturn new MatrixEventsHandler(\n\t\t\tFederationFactory.getEventHandlers(roomServiceReceive, messageServiceReceiver, userServiceReceiver, internalSettingsAdapter),\n\t\t);\n\t}\n\n\tpublic static getEventHandlers(\n\t\troomServiceReceiver: FederationRoomServiceReceiver,\n\t\tmessageServiceReceiver: FederationMessageServiceReceiver,\n\t\tuserServiceReceiver: FederationUserServiceReceiver,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t): MatrixBaseEventHandler[] {\n\t\treturn [\n\t\t\tnew MatrixRoomCreatedHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomMembershipChangedHandler(roomServiceReceiver, internalSettingsAdapter),\n\t\t\tnew MatrixRoomMessageSentHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomJoinRulesChangedHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomNameChangedHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomTopicChangedHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomEventRedactedHandler(roomServiceReceiver),\n\t\t\tnew MatrixMessageReactedHandler(messageServiceReceiver),\n\t\t\tnew MatrixUserTypingStatusChangedHandler(userServiceReceiver),\n\t\t\tnew MatrixRoomPowerLevelsChangedHandler(roomServiceReceiver),\n\t\t];\n\t}\n\n\tpublic static setupListenersForLocalActions(\n\t\troomServiceSender: FederationRoomServiceSender,\n\t\tmessageServiceSender: FederationMessageServiceSender,\n\t): void {\n\t\tFederationHooks.afterUserLeaveRoom((user: IUser, room: IRoom) =>\n\t\t\troomServiceSender.afterUserLeaveRoom(FederationRoomSenderConverter.toAfterUserLeaveRoom(user._id, room._id)),\n\t\t);\n\t\tFederationHooks.onUserRemovedFromRoom((user: IUser, room: IRoom, userWhoRemoved: IUser) =>\n\t\t\troomServiceSender.onUserRemovedFromRoom(\n\t\t\t\tFederationRoomSenderConverter.toOnUserRemovedFromRoom(user._id, room._id, userWhoRemoved._id),\n\t\t\t),\n\t\t);\n\t\tFederationHooks.afterMessageReacted((message: IMessage, user: IUser, reaction: string) =>\n\t\t\tmessageServiceSender.sendExternalMessageReaction(message, user, reaction),\n\t\t);\n\t\tFederationHooks.afterMessageunReacted((message: IMessage, user: IUser, reaction: string) =>\n\t\t\tmessageServiceSender.sendExternalMessageUnReaction(message, user, reaction),\n\t\t);\n\t\tFederationHooks.afterMessageDeleted((message: IMessage, roomId: string) => roomServiceSender.afterMessageDeleted(message, roomId));\n\t\tFederationHooks.afterMessageUpdated((message: IMessage, roomId: string, userId: string) =>\n\t\t\troomServiceSender.afterMessageUpdated(message, roomId, userId),\n\t\t);\n\t\tFederationHooks.afterMessageSent((message: IMessage, roomId: string, userId: string) =>\n\t\t\troomServiceSender.sendExternalMessage(FederationRoomSenderConverter.toSendExternalMessageDto(userId, roomId, message)),\n\t\t);\n\t\tFederationHooks.afterRoomNameChanged(async (roomId: string, roomName: string) =>\n\t\t\troomServiceSender.afterRoomNameChanged(roomId, roomName),\n\t\t);\n\t\tFederationHooks.afterRoomTopicChanged(async (roomId: string, roomTopic: string) =>\n\t\t\troomServiceSender.afterRoomTopicChanged(roomId, roomTopic),\n\t\t);\n\t}\n\n\tpublic static setupValidators(roomInternalHooksValidator: FederationRoomInternalValidator): void {\n\t\tFederationHooks.canAddFederatedUserToNonFederatedRoom((user: IUser | string, room: IRoom) =>\n\t\t\troomInternalHooksValidator.canAddFederatedUserToNonFederatedRoom(user, room),\n\t\t);\n\t\tFederationHooks.canAddFederatedUserToFederatedRoom((user: IUser | string, inviter: IUser, room: IRoom) =>\n\t\t\troomInternalHooksValidator.canAddFederatedUserToFederatedRoom(user, inviter, room),\n\t\t);\n\t\tFederationHooks.canCreateDirectMessageFromUI((members: (IUser | string)[]) =>\n\t\t\troomInternalHooksValidator.canCreateDirectMessageFromUI(members),\n\t\t);\n\t}\n\n\tpublic static removeCEValidators(): void {\n\t\tFederationHooks.removeCEValidation();\n\t}\n\n\tpublic static removeAllListeners(): void {\n\t\tFederationHooks.removeAllListeners();\n\t}\n}\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    module.export({\n      FederationFactory: () => FederationFactory\n    });\n    let FederationMessageServiceReceiver;\n    module.link(\"../application/room/message/receiver/MessageServiceReceiver\", {\n      FederationMessageServiceReceiver(v) {\n        FederationMessageServiceReceiver = v;\n      }\n    }, 0);\n    let FederationMessageServiceSender;\n    module.link(\"../application/room/message/sender/MessageServiceSender\", {\n      FederationMessageServiceSender(v) {\n        FederationMessageServiceSender = v;\n      }\n    }, 1);\n    let FederationRoomServiceReceiver;\n    module.link(\"../application/room/receiver/RoomServiceReceiver\", {\n      FederationRoomServiceReceiver(v) {\n        FederationRoomServiceReceiver = v;\n      }\n    }, 2);\n    let FederationRoomInternalValidator;\n    module.link(\"../application/room/sender/RoomInternalValidator\", {\n      FederationRoomInternalValidator(v) {\n        FederationRoomInternalValidator = v;\n      }\n    }, 3);\n    let FederationRoomServiceSender;\n    module.link(\"../application/room/sender/RoomServiceSender\", {\n      FederationRoomServiceSender(v) {\n        FederationRoomServiceSender = v;\n      }\n    }, 4);\n    let FederationUserServiceReceiver;\n    module.link(\"../application/user/receiver/UserServiceReceiver\", {\n      FederationUserServiceReceiver(v) {\n        FederationUserServiceReceiver = v;\n      }\n    }, 5);\n    let FederationUserServiceSender;\n    module.link(\"../application/user/sender/UserServiceSender\", {\n      FederationUserServiceSender(v) {\n        FederationUserServiceSender = v;\n      }\n    }, 6);\n    let MatrixBridge;\n    module.link(\"./matrix/Bridge\", {\n      MatrixBridge(v) {\n        MatrixBridge = v;\n      }\n    }, 7);\n    let MatrixEventsHandler;\n    module.link(\"./matrix/handlers\", {\n      MatrixEventsHandler(v) {\n        MatrixEventsHandler = v;\n      }\n    }, 8);\n    let MatrixMessageReactedHandler;\n    module.link(\"./matrix/handlers/Message\", {\n      MatrixMessageReactedHandler(v) {\n        MatrixMessageReactedHandler = v;\n      }\n    }, 9);\n    let MatrixRoomCreatedHandler, MatrixRoomEventRedactedHandler, MatrixRoomJoinRulesChangedHandler, MatrixRoomMembershipChangedHandler, MatrixRoomMessageSentHandler, MatrixRoomNameChangedHandler, MatrixRoomPowerLevelsChangedHandler, MatrixRoomTopicChangedHandler;\n    module.link(\"./matrix/handlers/Room\", {\n      MatrixRoomCreatedHandler(v) {\n        MatrixRoomCreatedHandler = v;\n      },\n      MatrixRoomEventRedactedHandler(v) {\n        MatrixRoomEventRedactedHandler = v;\n      },\n      MatrixRoomJoinRulesChangedHandler(v) {\n        MatrixRoomJoinRulesChangedHandler = v;\n      },\n      MatrixRoomMembershipChangedHandler(v) {\n        MatrixRoomMembershipChangedHandler = v;\n      },\n      MatrixRoomMessageSentHandler(v) {\n        MatrixRoomMessageSentHandler = v;\n      },\n      MatrixRoomNameChangedHandler(v) {\n        MatrixRoomNameChangedHandler = v;\n      },\n      MatrixRoomPowerLevelsChangedHandler(v) {\n        MatrixRoomPowerLevelsChangedHandler = v;\n      },\n      MatrixRoomTopicChangedHandler(v) {\n        MatrixRoomTopicChangedHandler = v;\n      }\n    }, 10);\n    let MatrixUserTypingStatusChangedHandler;\n    module.link(\"./matrix/handlers/User\", {\n      MatrixUserTypingStatusChangedHandler(v) {\n        MatrixUserTypingStatusChangedHandler = v;\n      }\n    }, 11);\n    let InMemoryQueue;\n    module.link(\"./queue/InMemoryQueue\", {\n      InMemoryQueue(v) {\n        InMemoryQueue = v;\n      }\n    }, 12);\n    let RocketChatFileAdapter;\n    module.link(\"./rocket-chat/adapters/File\", {\n      RocketChatFileAdapter(v) {\n        RocketChatFileAdapter = v;\n      }\n    }, 13);\n    let RocketChatMessageAdapter;\n    module.link(\"./rocket-chat/adapters/Message\", {\n      RocketChatMessageAdapter(v) {\n        RocketChatMessageAdapter = v;\n      }\n    }, 14);\n    let RocketChatNotificationAdapter;\n    module.link(\"./rocket-chat/adapters/Notification\", {\n      RocketChatNotificationAdapter(v) {\n        RocketChatNotificationAdapter = v;\n      }\n    }, 15);\n    let RocketChatRoomAdapter;\n    module.link(\"./rocket-chat/adapters/Room\", {\n      RocketChatRoomAdapter(v) {\n        RocketChatRoomAdapter = v;\n      }\n    }, 16);\n    let RocketChatSettingsAdapter;\n    module.link(\"./rocket-chat/adapters/Settings\", {\n      RocketChatSettingsAdapter(v) {\n        RocketChatSettingsAdapter = v;\n      }\n    }, 17);\n    let RocketChatUserAdapter;\n    module.link(\"./rocket-chat/adapters/User\", {\n      RocketChatUserAdapter(v) {\n        RocketChatUserAdapter = v;\n      }\n    }, 18);\n    let FederationRoomSenderConverter;\n    module.link(\"./rocket-chat/converters/RoomSender\", {\n      FederationRoomSenderConverter(v) {\n        FederationRoomSenderConverter = v;\n      }\n    }, 19);\n    let FederationHooks;\n    module.link(\"./rocket-chat/hooks\", {\n      FederationHooks(v) {\n        FederationHooks = v;\n      }\n    }, 20);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    class FederationFactory {\n      static buildInternalSettingsAdapter() {\n        return new RocketChatSettingsAdapter();\n      }\n      static buildInternalRoomAdapter() {\n        return new RocketChatRoomAdapter();\n      }\n      static buildInternalUserAdapter() {\n        return new RocketChatUserAdapter();\n      }\n      static buildInternalMessageAdapter() {\n        return new RocketChatMessageAdapter();\n      }\n      static buildInternalFileAdapter() {\n        return new RocketChatFileAdapter();\n      }\n      static buildInternalNotificationAdapter() {\n        return new RocketChatNotificationAdapter();\n      }\n      static buildFederationQueue() {\n        return new InMemoryQueue();\n      }\n      static buildRoomServiceReceiver(internalRoomAdapter, internalUserAdapter, internalMessageAdapter, internalFileAdapter, internalSettingsAdapter, internalNotificationAdapter, federationQueueInstance, bridge) {\n        return new FederationRoomServiceReceiver(internalRoomAdapter, internalUserAdapter, internalMessageAdapter, internalFileAdapter, internalSettingsAdapter, internalNotificationAdapter, federationQueueInstance, bridge);\n      }\n      static buildRoomServiceSender(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalMessageAdapter, internalSettingsAdapter, internalNotificationAdapter, bridge) {\n        return new FederationRoomServiceSender(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalMessageAdapter, internalSettingsAdapter, internalNotificationAdapter, bridge);\n      }\n      static buildUserServiceSender(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalSettingsAdapter, bridge) {\n        return new FederationUserServiceSender(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalSettingsAdapter, bridge);\n      }\n      static buildMessageServiceSender(internalRoomAdapter, internalUserAdapter, internalSettingsAdapter, internalMessageAdapter, bridge) {\n        return new FederationMessageServiceSender(internalRoomAdapter, internalUserAdapter, internalSettingsAdapter, internalMessageAdapter, bridge);\n      }\n      static buildMessageServiceReceiver(internalRoomAdapter, internalUserAdapter, internalMessageAdapter, internalFileAdapter, internalSettingsAdapter, bridge) {\n        return new FederationMessageServiceReceiver(internalRoomAdapter, internalUserAdapter, internalMessageAdapter, internalFileAdapter, internalSettingsAdapter, bridge);\n      }\n      static buildUserServiceReceiver(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalNotificationAdapter, internalSettingsAdapter, bridge) {\n        return new FederationUserServiceReceiver(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalNotificationAdapter, internalSettingsAdapter, bridge);\n      }\n      static buildRoomInternalValidator(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalSettingsAdapter, bridge) {\n        return new FederationRoomInternalValidator(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalSettingsAdapter, bridge);\n      }\n      static buildFederationBridge(internalSettingsAdapter, queue) {\n        return new MatrixBridge(internalSettingsAdapter, queue.addToQueue.bind(queue));\n      }\n      static buildFederationEventHandler(roomServiceReceive, messageServiceReceiver, userServiceReceiver, internalSettingsAdapter) {\n        return new MatrixEventsHandler(FederationFactory.getEventHandlers(roomServiceReceive, messageServiceReceiver, userServiceReceiver, internalSettingsAdapter));\n      }\n      static getEventHandlers(roomServiceReceiver, messageServiceReceiver, userServiceReceiver, internalSettingsAdapter) {\n        return [new MatrixRoomCreatedHandler(roomServiceReceiver), new MatrixRoomMembershipChangedHandler(roomServiceReceiver, internalSettingsAdapter), new MatrixRoomMessageSentHandler(roomServiceReceiver), new MatrixRoomJoinRulesChangedHandler(roomServiceReceiver), new MatrixRoomNameChangedHandler(roomServiceReceiver), new MatrixRoomTopicChangedHandler(roomServiceReceiver), new MatrixRoomEventRedactedHandler(roomServiceReceiver), new MatrixMessageReactedHandler(messageServiceReceiver), new MatrixUserTypingStatusChangedHandler(userServiceReceiver), new MatrixRoomPowerLevelsChangedHandler(roomServiceReceiver)];\n      }\n      static setupListenersForLocalActions(roomServiceSender, messageServiceSender) {\n        FederationHooks.afterUserLeaveRoom((user, room) => roomServiceSender.afterUserLeaveRoom(FederationRoomSenderConverter.toAfterUserLeaveRoom(user._id, room._id)));\n        FederationHooks.onUserRemovedFromRoom((user, room, userWhoRemoved) => roomServiceSender.onUserRemovedFromRoom(FederationRoomSenderConverter.toOnUserRemovedFromRoom(user._id, room._id, userWhoRemoved._id)));\n        FederationHooks.afterMessageReacted((message, user, reaction) => messageServiceSender.sendExternalMessageReaction(message, user, reaction));\n        FederationHooks.afterMessageunReacted((message, user, reaction) => messageServiceSender.sendExternalMessageUnReaction(message, user, reaction));\n        FederationHooks.afterMessageDeleted((message, roomId) => roomServiceSender.afterMessageDeleted(message, roomId));\n        FederationHooks.afterMessageUpdated((message, roomId, userId) => roomServiceSender.afterMessageUpdated(message, roomId, userId));\n        FederationHooks.afterMessageSent((message, roomId, userId) => roomServiceSender.sendExternalMessage(FederationRoomSenderConverter.toSendExternalMessageDto(userId, roomId, message)));\n        FederationHooks.afterRoomNameChanged(async (roomId, roomName) => roomServiceSender.afterRoomNameChanged(roomId, roomName));\n        FederationHooks.afterRoomTopicChanged(async (roomId, roomTopic) => roomServiceSender.afterRoomTopicChanged(roomId, roomTopic));\n      }\n      static setupValidators(roomInternalHooksValidator) {\n        FederationHooks.canAddFederatedUserToNonFederatedRoom((user, room) => roomInternalHooksValidator.canAddFederatedUserToNonFederatedRoom(user, room));\n        FederationHooks.canAddFederatedUserToFederatedRoom((user, inviter, room) => roomInternalHooksValidator.canAddFederatedUserToFederatedRoom(user, inviter, room));\n        FederationHooks.canCreateDirectMessageFromUI(members => roomInternalHooksValidator.canCreateDirectMessageFromUI(members));\n      }\n      static removeCEValidators() {\n        FederationHooks.removeCEValidation();\n      }\n      static removeAllListeners() {\n        FederationHooks.removeAllListeners();\n      }\n    }\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["module","export","FederationFactory","FederationMessageServiceReceiver","link","v","FederationMessageServiceSender","FederationRoomServiceReceiver","FederationRoomInternalValidator","FederationRoomServiceSender","FederationUserServiceReceiver","FederationUserServiceSender","MatrixBridge","MatrixEventsHandler","MatrixMessageReactedHandler","MatrixRoomCreatedHandler","MatrixRoomEventRedactedHandler","MatrixRoomJoinRulesChangedHandler","MatrixRoomMembershipChangedHandler","MatrixRoomMessageSentHandler","MatrixRoomNameChangedHandler","MatrixRoomPowerLevelsChangedHandler","MatrixRoomTopicChangedHandler","MatrixUserTypingStatusChangedHandler","InMemoryQueue","RocketChatFileAdapter","RocketChatMessageAdapter","RocketChatNotificationAdapter","RocketChatRoomAdapter","RocketChatSettingsAdapter","RocketChatUserAdapter","FederationRoomSenderConverter","FederationHooks","__reifyWaitForDeps__","buildInternalSettingsAdapter","buildInternalRoomAdapter","buildInternalUserAdapter","buildInternalMessageAdapter","buildInternalFileAdapter","buildInternalNotificationAdapter","buildFederationQueue","buildRoomServiceReceiver","internalRoomAdapter","internalUserAdapter","internalMessageAdapter","internalFileAdapter","internalSettingsAdapter","internalNotificationAdapter","federationQueueInstance","bridge","buildRoomServiceSender","buildUserServiceSender","buildMessageServiceSender","buildMessageServiceReceiver","buildUserServiceReceiver","buildRoomInternalValidator","buildFederationBridge","queue","addToQueue","bind","buildFederationEventHandler","roomServiceReceive","messageServiceReceiver","userServiceReceiver","getEventHandlers","roomServiceReceiver","setupListenersForLocalActions","roomServiceSender","messageServiceSender","afterUserLeaveRoom","user","room","toAfterUserLeaveRoom","_id","onUserRemovedFromRoom","userWhoRemoved","toOnUserRemovedFromRoom","afterMessageReacted","message","reaction","sendExternalMessageReaction","afterMessageunReacted","sendExternalMessageUnReaction","afterMessageDeleted","roomId","afterMessageUpdated","userId","afterMessageSent","sendExternalMessage","toSendExternalMessageDto","afterRoomNameChanged","roomName","afterRoomTopicChanged","roomTopic","setupValidators","roomInternalHooksValidator","canAddFederatedUserToNonFederatedRoom","canAddFederatedUserToFederatedRoom","inviter","canCreateDirectMessageFromUI","members","removeCEValidators","removeCEValidation","removeAllListeners","__reify_async_result__","_reifyError","self","async"],"sources":["server/services/federation/infrastructure/Factory.ts"],"sourcesContent":["import type { IMessage, IRoom, IUser } from '@rocket.chat/core-typings';\n\nimport { FederationMessageServiceReceiver } from '../application/room/message/receiver/MessageServiceReceiver';\nimport { FederationMessageServiceSender } from '../application/room/message/sender/MessageServiceSender';\nimport { FederationRoomServiceReceiver } from '../application/room/receiver/RoomServiceReceiver';\nimport { FederationRoomInternalValidator } from '../application/room/sender/RoomInternalValidator';\nimport { FederationRoomServiceSender } from '../application/room/sender/RoomServiceSender';\nimport { FederationUserServiceReceiver } from '../application/user/receiver/UserServiceReceiver';\nimport { FederationUserServiceSender } from '../application/user/sender/UserServiceSender';\nimport type { IFederationBridge } from '../domain/IFederationBridge';\nimport { MatrixBridge } from './matrix/Bridge';\nimport { MatrixEventsHandler } from './matrix/handlers';\nimport type { MatrixBaseEventHandler } from './matrix/handlers/BaseEvent';\nimport { MatrixMessageReactedHandler } from './matrix/handlers/Message';\nimport {\n\tMatrixRoomCreatedHandler,\n\tMatrixRoomEventRedactedHandler,\n\tMatrixRoomJoinRulesChangedHandler,\n\tMatrixRoomMembershipChangedHandler,\n\tMatrixRoomMessageSentHandler,\n\tMatrixRoomNameChangedHandler,\n\tMatrixRoomPowerLevelsChangedHandler,\n\tMatrixRoomTopicChangedHandler,\n} from './matrix/handlers/Room';\nimport { MatrixUserTypingStatusChangedHandler } from './matrix/handlers/User';\nimport { InMemoryQueue } from './queue/InMemoryQueue';\nimport { RocketChatFileAdapter } from './rocket-chat/adapters/File';\nimport { RocketChatMessageAdapter } from './rocket-chat/adapters/Message';\nimport { RocketChatNotificationAdapter } from './rocket-chat/adapters/Notification';\nimport { RocketChatRoomAdapter } from './rocket-chat/adapters/Room';\nimport { RocketChatSettingsAdapter } from './rocket-chat/adapters/Settings';\nimport { RocketChatUserAdapter } from './rocket-chat/adapters/User';\nimport { FederationRoomSenderConverter } from './rocket-chat/converters/RoomSender';\nimport { FederationHooks } from './rocket-chat/hooks';\n\nexport class FederationFactory {\n\tpublic static buildInternalSettingsAdapter(): RocketChatSettingsAdapter {\n\t\treturn new RocketChatSettingsAdapter();\n\t}\n\n\tpublic static buildInternalRoomAdapter(): RocketChatRoomAdapter {\n\t\treturn new RocketChatRoomAdapter();\n\t}\n\n\tpublic static buildInternalUserAdapter(): RocketChatUserAdapter {\n\t\treturn new RocketChatUserAdapter();\n\t}\n\n\tpublic static buildInternalMessageAdapter(): RocketChatMessageAdapter {\n\t\treturn new RocketChatMessageAdapter();\n\t}\n\n\tpublic static buildInternalFileAdapter(): RocketChatFileAdapter {\n\t\treturn new RocketChatFileAdapter();\n\t}\n\n\tpublic static buildInternalNotificationAdapter(): RocketChatNotificationAdapter {\n\t\treturn new RocketChatNotificationAdapter();\n\t}\n\n\tpublic static buildFederationQueue(): InMemoryQueue {\n\t\treturn new InMemoryQueue();\n\t}\n\n\tpublic static buildRoomServiceReceiver(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tfederationQueueInstance: InMemoryQueue,\n\t\tbridge: IFederationBridge,\n\t): FederationRoomServiceReceiver {\n\t\treturn new FederationRoomServiceReceiver(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tinternalNotificationAdapter,\n\t\t\tfederationQueueInstance,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildRoomServiceSender(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationRoomServiceSender {\n\t\treturn new FederationRoomServiceSender(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tinternalNotificationAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildUserServiceSender(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationUserServiceSender {\n\t\treturn new FederationUserServiceSender(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalSettingsAdapter, bridge);\n\t}\n\n\tpublic static buildMessageServiceSender(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationMessageServiceSender {\n\t\treturn new FederationMessageServiceSender(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildMessageServiceReceiver(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationMessageServiceReceiver {\n\t\treturn new FederationMessageServiceReceiver(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildUserServiceReceiver(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationUserServiceReceiver {\n\t\treturn new FederationUserServiceReceiver(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalNotificationAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildRoomInternalValidator(\n\t\tinternalRoomAdapter: RocketChatRoomAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapter,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridge,\n\t): FederationRoomInternalValidator {\n\t\treturn new FederationRoomInternalValidator(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildFederationBridge(internalSettingsAdapter: RocketChatSettingsAdapter, queue: InMemoryQueue): IFederationBridge {\n\t\treturn new MatrixBridge(internalSettingsAdapter, queue.addToQueue.bind(queue));\n\t}\n\n\tpublic static buildFederationEventHandler(\n\t\troomServiceReceive: FederationRoomServiceReceiver,\n\t\tmessageServiceReceiver: FederationMessageServiceReceiver,\n\t\tuserServiceReceiver: FederationUserServiceReceiver,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t): MatrixEventsHandler {\n\t\treturn new MatrixEventsHandler(\n\t\t\tFederationFactory.getEventHandlers(roomServiceReceive, messageServiceReceiver, userServiceReceiver, internalSettingsAdapter),\n\t\t);\n\t}\n\n\tpublic static getEventHandlers(\n\t\troomServiceReceiver: FederationRoomServiceReceiver,\n\t\tmessageServiceReceiver: FederationMessageServiceReceiver,\n\t\tuserServiceReceiver: FederationUserServiceReceiver,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t): MatrixBaseEventHandler[] {\n\t\treturn [\n\t\t\tnew MatrixRoomCreatedHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomMembershipChangedHandler(roomServiceReceiver, internalSettingsAdapter),\n\t\t\tnew MatrixRoomMessageSentHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomJoinRulesChangedHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomNameChangedHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomTopicChangedHandler(roomServiceReceiver),\n\t\t\tnew MatrixRoomEventRedactedHandler(roomServiceReceiver),\n\t\t\tnew MatrixMessageReactedHandler(messageServiceReceiver),\n\t\t\tnew MatrixUserTypingStatusChangedHandler(userServiceReceiver),\n\t\t\tnew MatrixRoomPowerLevelsChangedHandler(roomServiceReceiver),\n\t\t];\n\t}\n\n\tpublic static setupListenersForLocalActions(\n\t\troomServiceSender: FederationRoomServiceSender,\n\t\tmessageServiceSender: FederationMessageServiceSender,\n\t): void {\n\t\tFederationHooks.afterUserLeaveRoom((user: IUser, room: IRoom) =>\n\t\t\troomServiceSender.afterUserLeaveRoom(FederationRoomSenderConverter.toAfterUserLeaveRoom(user._id, room._id)),\n\t\t);\n\t\tFederationHooks.onUserRemovedFromRoom((user: IUser, room: IRoom, userWhoRemoved: IUser) =>\n\t\t\troomServiceSender.onUserRemovedFromRoom(\n\t\t\t\tFederationRoomSenderConverter.toOnUserRemovedFromRoom(user._id, room._id, userWhoRemoved._id),\n\t\t\t),\n\t\t);\n\t\tFederationHooks.afterMessageReacted((message: IMessage, user: IUser, reaction: string) =>\n\t\t\tmessageServiceSender.sendExternalMessageReaction(message, user, reaction),\n\t\t);\n\t\tFederationHooks.afterMessageunReacted((message: IMessage, user: IUser, reaction: string) =>\n\t\t\tmessageServiceSender.sendExternalMessageUnReaction(message, user, reaction),\n\t\t);\n\t\tFederationHooks.afterMessageDeleted((message: IMessage, roomId: string) => roomServiceSender.afterMessageDeleted(message, roomId));\n\t\tFederationHooks.afterMessageUpdated((message: IMessage, roomId: string, userId: string) =>\n\t\t\troomServiceSender.afterMessageUpdated(message, roomId, userId),\n\t\t);\n\t\tFederationHooks.afterMessageSent((message: IMessage, roomId: string, userId: string) =>\n\t\t\troomServiceSender.sendExternalMessage(FederationRoomSenderConverter.toSendExternalMessageDto(userId, roomId, message)),\n\t\t);\n\t\tFederationHooks.afterRoomNameChanged(async (roomId: string, roomName: string) =>\n\t\t\troomServiceSender.afterRoomNameChanged(roomId, roomName),\n\t\t);\n\t\tFederationHooks.afterRoomTopicChanged(async (roomId: string, roomTopic: string) =>\n\t\t\troomServiceSender.afterRoomTopicChanged(roomId, roomTopic),\n\t\t);\n\t}\n\n\tpublic static setupValidators(roomInternalHooksValidator: FederationRoomInternalValidator): void {\n\t\tFederationHooks.canAddFederatedUserToNonFederatedRoom((user: IUser | string, room: IRoom) =>\n\t\t\troomInternalHooksValidator.canAddFederatedUserToNonFederatedRoom(user, room),\n\t\t);\n\t\tFederationHooks.canAddFederatedUserToFederatedRoom((user: IUser | string, inviter: IUser, room: IRoom) =>\n\t\t\troomInternalHooksValidator.canAddFederatedUserToFederatedRoom(user, inviter, room),\n\t\t);\n\t\tFederationHooks.canCreateDirectMessageFromUI((members: (IUser | string)[]) =>\n\t\t\troomInternalHooksValidator.canCreateDirectMessageFromUI(members),\n\t\t);\n\t}\n\n\tpublic static removeCEValidators(): void {\n\t\tFederationHooks.removeCEValidation();\n\t}\n\n\tpublic static removeAllListeners(): void {\n\t\tFederationHooks.removeAllListeners();\n\t}\n}\n"],"mappings":";;;IAEAA,MAAA,CAAOC,MAAE;MAAAC,iBAAA,EAAAA,CAAA,KAAAA;IAAwC;IAAA,IAAAC,gCAAA;IAAAH,MAAA,CAAAI,IAAA,8DAA8D;MAAAD,iCAAAE,CAAA;QAAAF,gCAAA,GAAAE,CAAA;MAAA;IAAA;IAAA,IAAAC,8BAAA;IAAAN,MAAA,CAAAI,IAAA;MAAAE,+BAAAD,CAAA;QAAAC,8BAAA,GAAAD,CAAA;MAAA;IAAA;IAAA,IAAAE,6BAAA;IAAAP,MAAA,CAAAI,IAAA;MAAAG,8BAAAF,CAAA;QAAAE,6BAAA,GAAAF,CAAA;MAAA;IAAA;IAAA,IAAAG,+BAAA;IAAAR,MAAA,CAAAI,IAAA;MAAAI,gCAAAH,CAAA;QAAAG,+BAAA,GAAAH,CAAA;MAAA;IAAA;IAAA,IAAAI,2BAAA;IAAAT,MAAA,CAAAI,IAAA;MAAAK,4BAAAJ,CAAA;QAAAI,2BAAA,GAAAJ,CAAA;MAAA;IAAA;IAAA,IAAAK,6BAAA;IAAAV,MAAA,CAAAI,IAAA;MAAAM,8BAAAL,CAAA;QAAAK,6BAAA,GAAAL,CAAA;MAAA;IAAA;IAAA,IAAAM,2BAAA;IAAAX,MAAA,CAAAI,IAAA;MAAAO,4BAAAN,CAAA;QAAAM,2BAAA,GAAAN,CAAA;MAAA;IAAA;IAAA,IAAAO,YAAA;IAAAZ,MAAA,CAAAI,IAAA;MAAAQ,aAAAP,CAAA;QAAAO,YAAA,GAAAP,CAAA;MAAA;IAAA;IAAA,IAAAQ,mBAAA;IAAAb,MAAA,CAAAI,IAAA;MAAAS,oBAAAR,CAAA;QAAAQ,mBAAA,GAAAR,CAAA;MAAA;IAAA;IAAA,IAAAS,2BAAA;IAAAd,MAAA,CAAAI,IAAA;MAAAU,4BAAAT,CAAA;QAAAS,2BAAA,GAAAT,CAAA;MAAA;IAAA;IAAA,IAAAU,wBAAA,EAAAC,8BAAA,EAAAC,iCAAA,EAAAC,kCAAA,EAAAC,4BAAA,EAAAC,4BAAA,EAAAC,mCAAA,EAAAC,6BAAA;IAAAtB,MAAA,CAAAI,IAAA;MAAAW,yBAAAV,CAAA;QAAAU,wBAAA,GAAAV,CAAA;MAAA;MAAAW,+BAAAX,CAAA;QAAAW,8BAAA,GAAAX,CAAA;MAAA;MAAAY,kCAAAZ,CAAA;QAAAY,iCAAA,GAAAZ,CAAA;MAAA;MAAAa,mCAAAb,CAAA;QAAAa,kCAAA,GAAAb,CAAA;MAAA;MAAAc,6BAAAd,CAAA;QAAAc,4BAAA,GAAAd,CAAA;MAAA;MAAAe,6BAAAf,CAAA;QAAAe,4BAAA,GAAAf,CAAA;MAAA;MAAAgB,oCAAAhB,CAAA;QAAAgB,mCAAA,GAAAhB,CAAA;MAAA;MAAAiB,8BAAAjB,CAAA;QAAAiB,6BAAA,GAAAjB,CAAA;MAAA;IAAA;IAAA,IAAAkB,oCAAA;IAAAvB,MAAA,CAAAI,IAAA;MAAAmB,qCAAAlB,CAAA;QAAAkB,oCAAA,GAAAlB,CAAA;MAAA;IAAA;IAAA,IAAAmB,aAAA;IAAAxB,MAAA,CAAAI,IAAA;MAAAoB,cAAAnB,CAAA;QAAAmB,aAAA,GAAAnB,CAAA;MAAA;IAAA;IAAA,IAAAoB,qBAAA;IAAAzB,MAAA,CAAAI,IAAA;MAAAqB,sBAAApB,CAAA;QAAAoB,qBAAA,GAAApB,CAAA;MAAA;IAAA;IAAA,IAAAqB,wBAAA;IAAA1B,MAAA,CAAAI,IAAA;MAAAsB,yBAAArB,CAAA;QAAAqB,wBAAA,GAAArB,CAAA;MAAA;IAAA;IAAA,IAAAsB,6BAAA;IAAA3B,MAAA,CAAAI,IAAA;MAAAuB,8BAAAtB,CAAA;QAAAsB,6BAAA,GAAAtB,CAAA;MAAA;IAAA;IAAA,IAAAuB,qBAAA;IAAA5B,MAAA,CAAAI,IAAA;MAAAwB,sBAAAvB,CAAA;QAAAuB,qBAAA,GAAAvB,CAAA;MAAA;IAAA;IAAA,IAAAwB,yBAAA;IAAA7B,MAAA,CAAAI,IAAA;MAAAyB,0BAAAxB,CAAA;QAAAwB,yBAAA,GAAAxB,CAAA;MAAA;IAAA;IAAA,IAAAyB,qBAAA;IAAA9B,MAAA,CAAAI,IAAA;MAAA0B,sBAAAzB,CAAA;QAAAyB,qBAAA,GAAAzB,CAAA;MAAA;IAAA;IAAA,IAAA0B,6BAAA;IAAA/B,MAAA,CAAAI,IAAA;MAAA2B,8BAAA1B,CAAA;QAAA0B,6BAAA,GAAA1B,CAAA;MAAA;IAAA;IAAA,IAAA2B,eAAA;IAAAhC,MAAA,CAAAI,IAAA;MAAA4B,gBAAA3B,CAAA;QAAA2B,eAAA,GAAA3B,CAAA;MAAA;IAAA;IAAA,IAAA4B,oBAAA,WAAAA,oBAAA;IAiCzG,MAAO/B,iBAAiB;MACtB,OAAOgC,4BAA4BA,CAAA;QACzC,OAAO,IAAIL,yBAAyB,EAAE;MACvC;MAEO,OAAOM,wBAAwBA,CAAA;QACrC,OAAO,IAAIP,qBAAqB,EAAE;MACnC;MAEO,OAAOQ,wBAAwBA,CAAA;QACrC,OAAO,IAAIN,qBAAqB,EAAE;MACnC;MAEO,OAAOO,2BAA2BA,CAAA;QACxC,OAAO,IAAIX,wBAAwB,EAAE;MACtC;MAEO,OAAOY,wBAAwBA,CAAA;QACrC,OAAO,IAAIb,qBAAqB,EAAE;MACnC;MAEO,OAAOc,gCAAgCA,CAAA;QAC7C,OAAO,IAAIZ,6BAA6B,EAAE;MAC3C;MAEO,OAAOa,oBAAoBA,CAAA;QACjC,OAAO,IAAIhB,aAAa,EAAE;MAC3B;MAEO,OAAOiB,wBAAwBA,CACrCC,mBAA0C,EAC1CC,mBAA0C,EAC1CC,sBAAgD,EAChDC,mBAA0C,EAC1CC,uBAAkD,EAClDC,2BAA0D,EAC1DC,uBAAsC,EACtCC,MAAyB;QAEzB,OAAO,IAAI1C,6BAA6B,CACvCmC,mBAAmB,EACnBC,mBAAmB,EACnBC,sBAAsB,EACtBC,mBAAmB,EACnBC,uBAAuB,EACvBC,2BAA2B,EAC3BC,uBAAuB,EACvBC,MAAM,CACN;MACF;MAEO,OAAOC,sBAAsBA,CACnCR,mBAA0C,EAC1CC,mBAA0C,EAC1CE,mBAA0C,EAC1CD,sBAAgD,EAChDE,uBAAkD,EAClDC,2BAA0D,EAC1DE,MAAyB;QAEzB,OAAO,IAAIxC,2BAA2B,CACrCiC,mBAAmB,EACnBC,mBAAmB,EACnBE,mBAAmB,EACnBD,sBAAsB,EACtBE,uBAAuB,EACvBC,2BAA2B,EAC3BE,MAAM,CACN;MACF;MAEO,OAAOE,sBAAsBA,CACnCT,mBAA0C,EAC1CC,mBAA0C,EAC1CE,mBAA0C,EAC1CC,uBAAkD,EAClDG,MAAyB;QAEzB,OAAO,IAAItC,2BAA2B,CAAC+B,mBAAmB,EAAEC,mBAAmB,EAAEE,mBAAmB,EAAEC,uBAAuB,EAAEG,MAAM,CAAC;MACvI;MAEO,OAAOG,yBAAyBA,CACtCV,mBAA0C,EAC1CC,mBAA0C,EAC1CG,uBAAkD,EAClDF,sBAAgD,EAChDK,MAAyB;QAEzB,OAAO,IAAI3C,8BAA8B,CACxCoC,mBAAmB,EACnBC,mBAAmB,EACnBG,uBAAuB,EACvBF,sBAAsB,EACtBK,MAAM,CACN;MACF;MAEO,OAAOI,2BAA2BA,CACxCX,mBAA0C,EAC1CC,mBAA0C,EAC1CC,sBAAgD,EAChDC,mBAA0C,EAC1CC,uBAAkD,EAClDG,MAAyB;QAEzB,OAAO,IAAI9C,gCAAgC,CAC1CuC,mBAAmB,EACnBC,mBAAmB,EACnBC,sBAAsB,EACtBC,mBAAmB,EACnBC,uBAAuB,EACvBG,MAAM,CACN;MACF;MAEO,OAAOK,wBAAwBA,CACrCZ,mBAA0C,EAC1CC,mBAA0C,EAC1CE,mBAA0C,EAC1CE,2BAA0D,EAC1DD,uBAAkD,EAClDG,MAAyB;QAEzB,OAAO,IAAIvC,6BAA6B,CACvCgC,mBAAmB,EACnBC,mBAAmB,EACnBE,mBAAmB,EACnBE,2BAA2B,EAC3BD,uBAAuB,EACvBG,MAAM,CACN;MACF;MAEO,OAAOM,0BAA0BA,CACvCb,mBAA0C,EAC1CC,mBAA0C,EAC1CE,mBAA0C,EAC1CC,uBAAkD,EAClDG,MAAyB;QAEzB,OAAO,IAAIzC,+BAA+B,CACzCkC,mBAAmB,EACnBC,mBAAmB,EACnBE,mBAAmB,EACnBC,uBAAuB,EACvBG,MAAM,CACN;MACF;MAEO,OAAOO,qBAAqBA,CAACV,uBAAkD,EAAEW,KAAoB;QAC3G,OAAO,IAAI7C,YAAY,CAACkC,uBAAuB,EAAEW,KAAK,CAACC,UAAU,CAACC,IAAI,CAACF,KAAK,CAAC,CAAC;MAC/E;MAEO,OAAOG,2BAA2BA,CACxCC,kBAAiD,EACjDC,sBAAwD,EACxDC,mBAAkD,EAClDjB,uBAAkD;QAElD,OAAO,IAAIjC,mBAAmB,CAC7BX,iBAAiB,CAAC8D,gBAAgB,CAACH,kBAAkB,EAAEC,sBAAsB,EAAEC,mBAAmB,EAAEjB,uBAAuB,CAAC,CAC5H;MACF;MAEO,OAAOkB,gBAAgBA,CAC7BC,mBAAkD,EAClDH,sBAAwD,EACxDC,mBAAkD,EAClDjB,uBAAkD;QAElD,OAAO,CACN,IAAI/B,wBAAwB,CAACkD,mBAAmB,CAAC,EACjD,IAAI/C,kCAAkC,CAAC+C,mBAAmB,EAAEnB,uBAAuB,CAAC,EACpF,IAAI3B,4BAA4B,CAAC8C,mBAAmB,CAAC,EACrD,IAAIhD,iCAAiC,CAACgD,mBAAmB,CAAC,EAC1D,IAAI7C,4BAA4B,CAAC6C,mBAAmB,CAAC,EACrD,IAAI3C,6BAA6B,CAAC2C,mBAAmB,CAAC,EACtD,IAAIjD,8BAA8B,CAACiD,mBAAmB,CAAC,EACvD,IAAInD,2BAA2B,CAACgD,sBAAsB,CAAC,EACvD,IAAIvC,oCAAoC,CAACwC,mBAAmB,CAAC,EAC7D,IAAI1C,mCAAmC,CAAC4C,mBAAmB,CAAC,CAC5D;MACF;MAEO,OAAOC,6BAA6BA,CAC1CC,iBAA8C,EAC9CC,oBAAoD;QAEpDpC,eAAe,CAACqC,kBAAkB,CAAC,CAACC,IAAW,EAAEC,IAAW,KAC3DJ,iBAAiB,CAACE,kBAAkB,CAACtC,6BAA6B,CAACyC,oBAAoB,CAACF,IAAI,CAACG,GAAG,EAAEF,IAAI,CAACE,GAAG,CAAC,CAAC,CAC5G;QACDzC,eAAe,CAAC0C,qBAAqB,CAAC,CAACJ,IAAW,EAAEC,IAAW,EAAEI,cAAqB,KACrFR,iBAAiB,CAACO,qBAAqB,CACtC3C,6BAA6B,CAAC6C,uBAAuB,CAACN,IAAI,CAACG,GAAG,EAAEF,IAAI,CAACE,GAAG,EAAEE,cAAc,CAACF,GAAG,CAAC,CAC7F,CACD;QACDzC,eAAe,CAAC6C,mBAAmB,CAAC,CAACC,OAAiB,EAAER,IAAW,EAAES,QAAgB,KACpFX,oBAAoB,CAACY,2BAA2B,CAACF,OAAO,EAAER,IAAI,EAAES,QAAQ,CAAC,CACzE;QACD/C,eAAe,CAACiD,qBAAqB,CAAC,CAACH,OAAiB,EAAER,IAAW,EAAES,QAAgB,KACtFX,oBAAoB,CAACc,6BAA6B,CAACJ,OAAO,EAAER,IAAI,EAAES,QAAQ,CAAC,CAC3E;QACD/C,eAAe,CAACmD,mBAAmB,CAAC,CAACL,OAAiB,EAAEM,MAAc,KAAKjB,iBAAiB,CAACgB,mBAAmB,CAACL,OAAO,EAAEM,MAAM,CAAC,CAAC;QAClIpD,eAAe,CAACqD,mBAAmB,CAAC,CAACP,OAAiB,EAAEM,MAAc,EAAEE,MAAc,KACrFnB,iBAAiB,CAACkB,mBAAmB,CAACP,OAAO,EAAEM,MAAM,EAAEE,MAAM,CAAC,CAC9D;QACDtD,eAAe,CAACuD,gBAAgB,CAAC,CAACT,OAAiB,EAAEM,MAAc,EAAEE,MAAc,KAClFnB,iBAAiB,CAACqB,mBAAmB,CAACzD,6BAA6B,CAAC0D,wBAAwB,CAACH,MAAM,EAAEF,MAAM,EAAEN,OAAO,CAAC,CAAC,CACtH;QACD9C,eAAe,CAAC0D,oBAAoB,CAAC,OAAON,MAAc,EAAEO,QAAgB,KAC3ExB,iBAAiB,CAACuB,oBAAoB,CAACN,MAAM,EAAEO,QAAQ,CAAC,CACxD;QACD3D,eAAe,CAAC4D,qBAAqB,CAAC,OAAOR,MAAc,EAAES,SAAiB,KAC7E1B,iBAAiB,CAACyB,qBAAqB,CAACR,MAAM,EAAES,SAAS,CAAC,CAC1D;MACF;MAEO,OAAOC,eAAeA,CAACC,0BAA2D;QACxF/D,eAAe,CAACgE,qCAAqC,CAAC,CAAC1B,IAAoB,EAAEC,IAAW,KACvFwB,0BAA0B,CAACC,qCAAqC,CAAC1B,IAAI,EAAEC,IAAI,CAAC,CAC5E;QACDvC,eAAe,CAACiE,kCAAkC,CAAC,CAAC3B,IAAoB,EAAE4B,OAAc,EAAE3B,IAAW,KACpGwB,0BAA0B,CAACE,kCAAkC,CAAC3B,IAAI,EAAE4B,OAAO,EAAE3B,IAAI,CAAC,CAClF;QACDvC,eAAe,CAACmE,4BAA4B,CAAEC,OAA2B,IACxEL,0BAA0B,CAACI,4BAA4B,CAACC,OAAO,CAAC,CAChE;MACF;MAEO,OAAOC,kBAAkBA,CAAA;QAC/BrE,eAAe,CAACsE,kBAAkB,EAAE;MACrC;MAEO,OAAOC,kBAAkBA,CAAA;QAC/BvE,eAAe,CAACuE,kBAAkB,EAAE;MACrC;;IACAC,sBAAA;EAAA,SAAAC,WAAA;IAAA,OAAAD,sBAAA,CAAAC,WAAA;EAAA;EAAAD,sBAAA;AAAA;EAAAE,IAAA;EAAAC,KAAA;AAAA","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"a74fd3f8f774cfe9a28f6a177c01e51d988cd179"}
