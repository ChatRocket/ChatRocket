{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/startup.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/startup/startup.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/startup.ts","inputSourceMap":{"version":3,"file":"client/startup/startup.ts","sourceRoot":"","sources":["client/startup/startup.ts"],"names":[],"mappings":"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","sourcesContent":["import type { UserStatus } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\nimport { UserPresence } from 'meteor/rocketchat:user-presence';\nimport { Session } from 'meteor/session';\nimport { Tracker } from 'meteor/tracker';\nimport moment from 'moment';\n\nimport { register } from '../../app/markdown/lib/hljs';\nimport { settings } from '../../app/settings/client';\nimport { getUserPreference } from '../../app/utils/client';\nimport 'hljs9/styles/github.css';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { synchronizeUserData, removeLocalUserData } from '../lib/userData';\nimport { fireGlobalEvent } from '../lib/utils/fireGlobalEvent';\n\nMeteor.startup(() => {\n\tfireGlobalEvent('startup', true);\n\n\tSession.setDefault('AvatarRandom', 0);\n\n\twindow.lastMessageWindow = {};\n\twindow.lastMessageWindowHistory = {};\n\n\tlet status: UserStatus | undefined = undefined;\n\tTracker.autorun(async () => {\n\t\tconst uid = Meteor.userId();\n\t\tif (!uid) {\n\t\t\tremoveLocalUserData();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Meteor.status().connected) {\n\t\t\treturn;\n\t\t}\n\n\t\t// TODO: TEMPORARY UNTIL THIS IS FIXED\n\t\t// BACKEND MS SHOULD SEND USER DATA AFTER LOGIN\n\t\t// if (Meteor.loggingIn()) {\n\t\t// \treturn;\n\t\t// }\n\n\t\tconst user = await synchronizeUserData(uid);\n\t\tif (!user) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst utcOffset = moment().utcOffset() / 60;\n\t\tif (user.utcOffset !== utcOffset) {\n\t\t\tsdk.call('userSetUtcOffset', utcOffset);\n\t\t}\n\n\t\tif (getUserPreference(user, 'enableAutoAway')) {\n\t\t\tconst idleTimeLimit = (getUserPreference(user, 'idleTimeLimit') as number | null | undefined) || 300;\n\t\t\tUserPresence.awayTime = idleTimeLimit * 1000;\n\t\t} else {\n\t\t\tdelete UserPresence.awayTime;\n\t\t\tUserPresence.stopTimer();\n\t\t}\n\n\t\tUserPresence.start();\n\n\t\tif (user.status !== status) {\n\t\t\tstatus = user.status;\n\t\t\tfireGlobalEvent('status-changed', status);\n\t\t}\n\t});\n});\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst code = settings.get('Message_Code_highlight') as string | undefined;\n\t\tcode?.split(',').forEach((language: string) => {\n\t\t\tlanguage.trim() && register(language.trim());\n\t\t});\n\t});\n});\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/startup.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/startup/startup.ts","inputSourceMap":{"version":3,"file":"client/startup/startup.ts","sourceRoot":"","sources":["client/startup/startup.ts"],"names":[],"mappings":"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","sourcesContent":["import type { UserStatus } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\nimport { UserPresence } from 'meteor/rocketchat:user-presence';\nimport { Session } from 'meteor/session';\nimport { Tracker } from 'meteor/tracker';\nimport moment from 'moment';\n\nimport { register } from '../../app/markdown/lib/hljs';\nimport { settings } from '../../app/settings/client';\nimport { getUserPreference } from '../../app/utils/client';\nimport 'hljs9/styles/github.css';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { synchronizeUserData, removeLocalUserData } from '../lib/userData';\nimport { fireGlobalEvent } from '../lib/utils/fireGlobalEvent';\n\nMeteor.startup(() => {\n\tfireGlobalEvent('startup', true);\n\n\tSession.setDefault('AvatarRandom', 0);\n\n\twindow.lastMessageWindow = {};\n\twindow.lastMessageWindowHistory = {};\n\n\tlet status: UserStatus | undefined = undefined;\n\tTracker.autorun(async () => {\n\t\tconst uid = Meteor.userId();\n\t\tif (!uid) {\n\t\t\tremoveLocalUserData();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Meteor.status().connected) {\n\t\t\treturn;\n\t\t}\n\n\t\t// TODO: TEMPORARY UNTIL THIS IS FIXED\n\t\t// BACKEND MS SHOULD SEND USER DATA AFTER LOGIN\n\t\t// if (Meteor.loggingIn()) {\n\t\t// \treturn;\n\t\t// }\n\n\t\tconst user = await synchronizeUserData(uid);\n\t\tif (!user) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst utcOffset = moment().utcOffset() / 60;\n\t\tif (user.utcOffset !== utcOffset) {\n\t\t\tsdk.call('userSetUtcOffset', utcOffset);\n\t\t}\n\n\t\tif (getUserPreference(user, 'enableAutoAway')) {\n\t\t\tconst idleTimeLimit = (getUserPreference(user, 'idleTimeLimit') as number | null | undefined) || 300;\n\t\t\tUserPresence.awayTime = idleTimeLimit * 1000;\n\t\t} else {\n\t\t\tdelete UserPresence.awayTime;\n\t\t\tUserPresence.stopTimer();\n\t\t}\n\n\t\tUserPresence.start();\n\n\t\tif (user.status !== status) {\n\t\t\tstatus = user.status;\n\t\t\tfireGlobalEvent('status-changed', status);\n\t\t}\n\t});\n});\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst code = settings.get('Message_Code_highlight') as string | undefined;\n\t\tcode?.split(',').forEach((language: string) => {\n\t\t\tlanguage.trim() && register(language.trim());\n\t\t});\n\t});\n});\n"]}}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n}, 0);\nlet UserPresence;\nmodule.link(\"meteor/rocketchat:user-presence\", {\n  UserPresence(v) {\n    UserPresence = v;\n  }\n}, 1);\nlet Session;\nmodule.link(\"meteor/session\", {\n  Session(v) {\n    Session = v;\n  }\n}, 2);\nlet Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker(v) {\n    Tracker = v;\n  }\n}, 3);\nlet moment;\nmodule.link(\"moment\", {\n  default(v) {\n    moment = v;\n  }\n}, 4);\nlet register;\nmodule.link(\"../../app/markdown/lib/hljs\", {\n  register(v) {\n    register = v;\n  }\n}, 5);\nlet settings;\nmodule.link(\"../../app/settings/client\", {\n  settings(v) {\n    settings = v;\n  }\n}, 6);\nlet getUserPreference;\nmodule.link(\"../../app/utils/client\", {\n  getUserPreference(v) {\n    getUserPreference = v;\n  }\n}, 7);\nmodule.link(\"hljs9/styles/github.css\");\nlet sdk;\nmodule.link(\"../../app/utils/client/lib/SDKClient\", {\n  sdk(v) {\n    sdk = v;\n  }\n}, 8);\nlet synchronizeUserData, removeLocalUserData;\nmodule.link(\"../lib/userData\", {\n  synchronizeUserData(v) {\n    synchronizeUserData = v;\n  },\n  removeLocalUserData(v) {\n    removeLocalUserData = v;\n  }\n}, 9);\nlet fireGlobalEvent;\nmodule.link(\"../lib/utils/fireGlobalEvent\", {\n  fireGlobalEvent(v) {\n    fireGlobalEvent = v;\n  }\n}, 10);\nMeteor.startup(() => {\n  fireGlobalEvent('startup', true);\n  Session.setDefault('AvatarRandom', 0);\n  window.lastMessageWindow = {};\n  window.lastMessageWindowHistory = {};\n  let status = undefined;\n  Tracker.autorun(async () => {\n    const uid = Meteor.userId();\n    if (!uid) {\n      removeLocalUserData();\n      return;\n    }\n    if (!Meteor.status().connected) {\n      return;\n    }\n    // TODO: TEMPORARY UNTIL THIS IS FIXED\n    // BACKEND MS SHOULD SEND USER DATA AFTER LOGIN\n    // if (Meteor.loggingIn()) {\n    // \treturn;\n    // }\n    const user = await synchronizeUserData(uid);\n    if (!user) {\n      return;\n    }\n    const utcOffset = moment().utcOffset() / 60;\n    if (user.utcOffset !== utcOffset) {\n      sdk.call('userSetUtcOffset', utcOffset);\n    }\n    if (getUserPreference(user, 'enableAutoAway')) {\n      const idleTimeLimit = getUserPreference(user, 'idleTimeLimit') || 300;\n      UserPresence.awayTime = idleTimeLimit * 1000;\n    } else {\n      delete UserPresence.awayTime;\n      UserPresence.stopTimer();\n    }\n    UserPresence.start();\n    if (user.status !== status) {\n      status = user.status;\n      fireGlobalEvent('status-changed', status);\n    }\n  });\n});\nMeteor.startup(() => {\n  Tracker.autorun(() => {\n    const code = settings.get('Message_Code_highlight');\n    code === null || code === void 0 ? void 0 : code.split(',').forEach(language => {\n      language.trim() && register(language.trim());\n    });\n  });\n});","map":{"version":3,"names":["Meteor","module","link","v","UserPresence","Session","Tracker","moment","default","register","settings","getUserPreference","sdk","synchronizeUserData","removeLocalUserData","fireGlobalEvent","startup","setDefault","window","lastMessageWindow","lastMessageWindowHistory","status","undefined","autorun","uid","userId","connected","user","utcOffset","call","idleTimeLimit","awayTime","stopTimer","start","code","get","split","forEach","language","trim"],"sources":["client/startup/startup.ts"],"sourcesContent":["import type { UserStatus } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\nimport { UserPresence } from 'meteor/rocketchat:user-presence';\nimport { Session } from 'meteor/session';\nimport { Tracker } from 'meteor/tracker';\nimport moment from 'moment';\n\nimport { register } from '../../app/markdown/lib/hljs';\nimport { settings } from '../../app/settings/client';\nimport { getUserPreference } from '../../app/utils/client';\nimport 'hljs9/styles/github.css';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { synchronizeUserData, removeLocalUserData } from '../lib/userData';\nimport { fireGlobalEvent } from '../lib/utils/fireGlobalEvent';\n\nMeteor.startup(() => {\n\tfireGlobalEvent('startup', true);\n\n\tSession.setDefault('AvatarRandom', 0);\n\n\twindow.lastMessageWindow = {};\n\twindow.lastMessageWindowHistory = {};\n\n\tlet status: UserStatus | undefined = undefined;\n\tTracker.autorun(async () => {\n\t\tconst uid = Meteor.userId();\n\t\tif (!uid) {\n\t\t\tremoveLocalUserData();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Meteor.status().connected) {\n\t\t\treturn;\n\t\t}\n\n\t\t// TODO: TEMPORARY UNTIL THIS IS FIXED\n\t\t// BACKEND MS SHOULD SEND USER DATA AFTER LOGIN\n\t\t// if (Meteor.loggingIn()) {\n\t\t// \treturn;\n\t\t// }\n\n\t\tconst user = await synchronizeUserData(uid);\n\t\tif (!user) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst utcOffset = moment().utcOffset() / 60;\n\t\tif (user.utcOffset !== utcOffset) {\n\t\t\tsdk.call('userSetUtcOffset', utcOffset);\n\t\t}\n\n\t\tif (getUserPreference(user, 'enableAutoAway')) {\n\t\t\tconst idleTimeLimit = (getUserPreference(user, 'idleTimeLimit') as number | null | undefined) || 300;\n\t\t\tUserPresence.awayTime = idleTimeLimit * 1000;\n\t\t} else {\n\t\t\tdelete UserPresence.awayTime;\n\t\t\tUserPresence.stopTimer();\n\t\t}\n\n\t\tUserPresence.start();\n\n\t\tif (user.status !== status) {\n\t\t\tstatus = user.status;\n\t\t\tfireGlobalEvent('status-changed', status);\n\t\t}\n\t});\n});\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst code = settings.get('Message_Code_highlight') as string | undefined;\n\t\tcode?.split(',').forEach((language: string) => {\n\t\t\tlanguage.trim() && register(language.trim());\n\t\t});\n\t});\n});\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"2914918493a5d63a19b67c1ea9014e63e7f3562f"}
