{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/iframeCommands.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/startup/iframeCommands.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/iframeCommands.ts","inputSourceMap":{"version":3,"file":"client/startup/iframeCommands.ts","sourceRoot":"","sources":["client/startup/iframeCommands.ts"],"names":[],"mappings":"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","sourcesContent":["import type { UserStatus, IUser } from '@rocket.chat/core-typings';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\nimport type { LocationPathname } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\n\nimport { settings } from '../../app/settings/client';\nimport { AccountBox } from '../../app/ui-utils/client/lib/AccountBox';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { afterLogoutCleanUpCallback } from '../../lib/callbacks/afterLogoutCleanUpCallback';\nimport { capitalize, ltrim, rtrim } from '../../lib/utils/stringUtils';\nimport { baseURI } from '../lib/baseURI';\nimport { loginServices } from '../lib/loginServices';\nimport { router } from '../providers/RouterProvider';\n\nconst commands = {\n\t'go'(data: { path: string }) {\n\t\tif (typeof data.path !== 'string' || data.path.trim().length === 0) {\n\t\t\treturn console.error('`path` not defined');\n\t\t}\n\t\tconst newUrl = new URL(`${rtrim(baseURI, '/')}/${ltrim(data.path, '/')}`);\n\n\t\tconst newParams = Array.from(newUrl.searchParams.entries()).reduce((ret, [key, value]) => {\n\t\t\tret[key] = value;\n\t\t\treturn ret;\n\t\t}, {} as Record<string, string>);\n\n\t\tconst newPath = newUrl.pathname.replace(\n\t\t\tnew RegExp(`^${escapeRegExp(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX)}`),\n\t\t\t'',\n\t\t) as LocationPathname;\n\t\trouter.navigate({\n\t\t\tpathname: newPath,\n\t\t\tsearch: { ...router.getSearchParameters(), ...newParams },\n\t\t});\n\t},\n\n\t'set-user-status'(data: { status: UserStatus }) {\n\t\tAccountBox.setStatus(data.status);\n\t},\n\n\t'call-custom-oauth-login'(data: { service: string; redirectUrl?: string | null }, event: MessageEvent) {\n\t\tconst customOAuthCallback = (response: unknown) => {\n\t\t\tevent.source?.postMessage(\n\t\t\t\t{\n\t\t\t\t\tevent: 'custom-oauth-callback',\n\t\t\t\t\tresponse,\n\t\t\t\t},\n\t\t\t\t{ targetOrigin: event.origin },\n\t\t\t);\n\t\t};\n\n\t\tconst siteUrl = `${Meteor.settings.Site_Url}/`;\n\t\tif (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\n\t\t\tdata.redirectUrl = null;\n\t\t}\n\n\t\tif (typeof data.service === 'string' && window.ServiceConfiguration) {\n\t\t\tconst customOauth = loginServices.getLoginService(data.service);\n\n\t\t\tif (customOauth) {\n\t\t\t\tconst customLoginWith = (Meteor as any)[`loginWith${capitalize(customOauth.service, true)}`];\n\t\t\t\tconst customRedirectUri = data.redirectUrl || siteUrl;\n\t\t\t\tcustomLoginWith.call(Meteor, { redirectUrl: customRedirectUri }, customOAuthCallback);\n\t\t\t}\n\t\t}\n\t},\n\n\t'login-with-token'(data: { token: string }) {\n\t\tif (typeof data.token === 'string') {\n\t\t\tMeteor.loginWithToken(data.token, () => {\n\t\t\t\tconsole.log('Iframe command [login-with-token]: result', data);\n\t\t\t});\n\t\t}\n\t},\n\n\tasync 'logout'() {\n\t\tconst user = Meteor.user();\n\t\tMeteor.logout(() => {\n\t\t\tif (!user) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvoid afterLogoutCleanUpCallback.run(user);\n\t\t\tsdk.call('logoutCleanUp', user as unknown as IUser);\n\t\t\treturn router.navigate('/home');\n\t\t});\n\t},\n} as const;\n\ntype CommandMessage<TCommandName extends keyof typeof commands = keyof typeof commands> = {\n\texternalCommand: TCommandName;\n} & Parameters<(typeof commands)[TCommandName]>[0];\n\nwindow.addEventListener('message', <TCommandMessage extends CommandMessage>(e: MessageEvent<TCommandMessage>) => {\n\tif (!settings.get<boolean>('Iframe_Integration_receive_enable')) {\n\t\treturn;\n\t}\n\n\tif (typeof e.data !== 'object' || typeof e.data.externalCommand !== 'string') {\n\t\treturn;\n\t}\n\n\tconst origins = settings.get<string>('Iframe_Integration_receive_origin');\n\n\tif (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\n\t\tconsole.error('Origin not allowed', e.origin);\n\t\treturn;\n\t}\n\n\tif (!(e.data.externalCommand in commands)) {\n\t\tconsole.error('Command not allowed', e.data.externalCommand);\n\t\treturn;\n\t}\n\n\tconst command: (data: any, event: MessageEvent) => void = commands[e.data.externalCommand];\n\tcommand(e.data, e);\n});\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/iframeCommands.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/startup/iframeCommands.ts","inputSourceMap":{"version":3,"file":"client/startup/iframeCommands.ts","sourceRoot":"","sources":["client/startup/iframeCommands.ts"],"names":[],"mappings":"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","sourcesContent":["import type { UserStatus, IUser } from '@rocket.chat/core-typings';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\nimport type { LocationPathname } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\n\nimport { settings } from '../../app/settings/client';\nimport { AccountBox } from '../../app/ui-utils/client/lib/AccountBox';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { afterLogoutCleanUpCallback } from '../../lib/callbacks/afterLogoutCleanUpCallback';\nimport { capitalize, ltrim, rtrim } from '../../lib/utils/stringUtils';\nimport { baseURI } from '../lib/baseURI';\nimport { loginServices } from '../lib/loginServices';\nimport { router } from '../providers/RouterProvider';\n\nconst commands = {\n\t'go'(data: { path: string }) {\n\t\tif (typeof data.path !== 'string' || data.path.trim().length === 0) {\n\t\t\treturn console.error('`path` not defined');\n\t\t}\n\t\tconst newUrl = new URL(`${rtrim(baseURI, '/')}/${ltrim(data.path, '/')}`);\n\n\t\tconst newParams = Array.from(newUrl.searchParams.entries()).reduce((ret, [key, value]) => {\n\t\t\tret[key] = value;\n\t\t\treturn ret;\n\t\t}, {} as Record<string, string>);\n\n\t\tconst newPath = newUrl.pathname.replace(\n\t\t\tnew RegExp(`^${escapeRegExp(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX)}`),\n\t\t\t'',\n\t\t) as LocationPathname;\n\t\trouter.navigate({\n\t\t\tpathname: newPath,\n\t\t\tsearch: { ...router.getSearchParameters(), ...newParams },\n\t\t});\n\t},\n\n\t'set-user-status'(data: { status: UserStatus }) {\n\t\tAccountBox.setStatus(data.status);\n\t},\n\n\t'call-custom-oauth-login'(data: { service: string; redirectUrl?: string | null }, event: MessageEvent) {\n\t\tconst customOAuthCallback = (response: unknown) => {\n\t\t\tevent.source?.postMessage(\n\t\t\t\t{\n\t\t\t\t\tevent: 'custom-oauth-callback',\n\t\t\t\t\tresponse,\n\t\t\t\t},\n\t\t\t\t{ targetOrigin: event.origin },\n\t\t\t);\n\t\t};\n\n\t\tconst siteUrl = `${Meteor.settings.Site_Url}/`;\n\t\tif (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\n\t\t\tdata.redirectUrl = null;\n\t\t}\n\n\t\tif (typeof data.service === 'string' && window.ServiceConfiguration) {\n\t\t\tconst customOauth = loginServices.getLoginService(data.service);\n\n\t\t\tif (customOauth) {\n\t\t\t\tconst customLoginWith = (Meteor as any)[`loginWith${capitalize(customOauth.service, true)}`];\n\t\t\t\tconst customRedirectUri = data.redirectUrl || siteUrl;\n\t\t\t\tcustomLoginWith.call(Meteor, { redirectUrl: customRedirectUri }, customOAuthCallback);\n\t\t\t}\n\t\t}\n\t},\n\n\t'login-with-token'(data: { token: string }) {\n\t\tif (typeof data.token === 'string') {\n\t\t\tMeteor.loginWithToken(data.token, () => {\n\t\t\t\tconsole.log('Iframe command [login-with-token]: result', data);\n\t\t\t});\n\t\t}\n\t},\n\n\tasync 'logout'() {\n\t\tconst user = Meteor.user();\n\t\tMeteor.logout(() => {\n\t\t\tif (!user) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvoid afterLogoutCleanUpCallback.run(user);\n\t\t\tsdk.call('logoutCleanUp', user as unknown as IUser);\n\t\t\treturn router.navigate('/home');\n\t\t});\n\t},\n} as const;\n\ntype CommandMessage<TCommandName extends keyof typeof commands = keyof typeof commands> = {\n\texternalCommand: TCommandName;\n} & Parameters<(typeof commands)[TCommandName]>[0];\n\nwindow.addEventListener('message', <TCommandMessage extends CommandMessage>(e: MessageEvent<TCommandMessage>) => {\n\tif (!settings.get<boolean>('Iframe_Integration_receive_enable')) {\n\t\treturn;\n\t}\n\n\tif (typeof e.data !== 'object' || typeof e.data.externalCommand !== 'string') {\n\t\treturn;\n\t}\n\n\tconst origins = settings.get<string>('Iframe_Integration_receive_origin');\n\n\tif (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\n\t\tconsole.error('Origin not allowed', e.origin);\n\t\treturn;\n\t}\n\n\tif (!(e.data.externalCommand in commands)) {\n\t\tconsole.error('Command not allowed', e.data.externalCommand);\n\t\treturn;\n\t}\n\n\tconst command: (data: any, event: MessageEvent) => void = commands[e.data.externalCommand];\n\tcommand(e.data, e);\n});\n"]}}},"code":"var _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nvar _typeof;\nmodule.link(\"@babel/runtime/helpers/typeof\", {\n  default: function (v) {\n    _typeof = v;\n  }\n}, 1);\nvar _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 2);\nvar _slicedToArray;\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 3);\nvar escapeRegExp;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  escapeRegExp: function (v) {\n    escapeRegExp = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar settings;\nmodule.link(\"../../app/settings/client\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 2);\nvar AccountBox;\nmodule.link(\"../../app/ui-utils/client/lib/AccountBox\", {\n  AccountBox: function (v) {\n    AccountBox = v;\n  }\n}, 3);\nvar sdk;\nmodule.link(\"../../app/utils/client/lib/SDKClient\", {\n  sdk: function (v) {\n    sdk = v;\n  }\n}, 4);\nvar afterLogoutCleanUpCallback;\nmodule.link(\"../../lib/callbacks/afterLogoutCleanUpCallback\", {\n  afterLogoutCleanUpCallback: function (v) {\n    afterLogoutCleanUpCallback = v;\n  }\n}, 5);\nvar capitalize, ltrim, rtrim;\nmodule.link(\"../../lib/utils/stringUtils\", {\n  capitalize: function (v) {\n    capitalize = v;\n  },\n  ltrim: function (v) {\n    ltrim = v;\n  },\n  rtrim: function (v) {\n    rtrim = v;\n  }\n}, 6);\nvar baseURI;\nmodule.link(\"../lib/baseURI\", {\n  baseURI: function (v) {\n    baseURI = v;\n  }\n}, 7);\nvar loginServices;\nmodule.link(\"../lib/loginServices\", {\n  loginServices: function (v) {\n    loginServices = v;\n  }\n}, 8);\nvar router;\nmodule.link(\"../providers/RouterProvider\", {\n  router: function (v) {\n    router = v;\n  }\n}, 9);\nvar commands = {\n  'go': function (data) {\n    if (typeof data.path !== 'string' || data.path.trim().length === 0) {\n      return console.error('`path` not defined');\n    }\n    var newUrl = new URL(rtrim(baseURI, '/') + \"/\" + ltrim(data.path, '/'));\n    var newParams = Array.from(newUrl.searchParams.entries()).reduce(function (ret, _ref) {\n      var _ref2 = _slicedToArray(_ref, 2),\n        key = _ref2[0],\n        value = _ref2[1];\n      ret[key] = value;\n      return ret;\n    }, {});\n    var newPath = newUrl.pathname.replace(new RegExp(\"^\" + escapeRegExp(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX)), '');\n    router.navigate({\n      pathname: newPath,\n      search: _objectSpread(_objectSpread({}, router.getSearchParameters()), newParams)\n    });\n  },\n  'set-user-status': function (data) {\n    AccountBox.setStatus(data.status);\n  },\n  'call-custom-oauth-login': function (data, event) {\n    var customOAuthCallback = function (response) {\n      var _event$source;\n      (_event$source = event.source) === null || _event$source === void 0 ? void 0 : _event$source.postMessage({\n        event: 'custom-oauth-callback',\n        response: response\n      }, {\n        targetOrigin: event.origin\n      });\n    };\n    var siteUrl = Meteor.settings.Site_Url + \"/\";\n    if (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\n      data.redirectUrl = null;\n    }\n    if (typeof data.service === 'string' && window.ServiceConfiguration) {\n      var customOauth = loginServices.getLoginService(data.service);\n      if (customOauth) {\n        var customLoginWith = Meteor[\"loginWith\" + capitalize(customOauth.service, true)];\n        var customRedirectUri = data.redirectUrl || siteUrl;\n        customLoginWith.call(Meteor, {\n          redirectUrl: customRedirectUri\n        }, customOAuthCallback);\n      }\n    }\n  },\n  'login-with-token': function (data) {\n    if (typeof data.token === 'string') {\n      Meteor.loginWithToken(data.token, function () {\n        console.log('Iframe command [login-with-token]: result', data);\n      });\n    }\n  },\n  'logout': function () {\n    function _callee() {\n      var user;\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              user = Meteor.user();\n              Meteor.logout(function () {\n                if (!user) {\n                  return;\n                }\n                void afterLogoutCleanUpCallback.run(user);\n                sdk.call('logoutCleanUp', user);\n                return router.navigate('/home');\n              });\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n        return _callee$;\n      }(), null, null, null, Promise);\n    }\n    return _callee;\n  }()\n};\nwindow.addEventListener('message', function (e) {\n  if (!settings.get('Iframe_Integration_receive_enable')) {\n    return;\n  }\n  if (_typeof(e.data) !== 'object' || typeof e.data.externalCommand !== 'string') {\n    return;\n  }\n  var origins = settings.get('Iframe_Integration_receive_origin');\n  if (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\n    console.error('Origin not allowed', e.origin);\n    return;\n  }\n  if (!(e.data.externalCommand in commands)) {\n    console.error('Command not allowed', e.data.externalCommand);\n    return;\n  }\n  var command = commands[e.data.externalCommand];\n  command(e.data, e);\n});","map":{"version":3,"names":["_regeneratorRuntime","module","link","default","v","_typeof","_objectSpread","_slicedToArray","escapeRegExp","Meteor","settings","AccountBox","sdk","afterLogoutCleanUpCallback","capitalize","ltrim","rtrim","baseURI","loginServices","router","commands","go","data","path","trim","length","console","error","newUrl","URL","newParams","Array","from","searchParams","entries","reduce","ret","_ref","_ref2","key","value","newPath","pathname","replace","RegExp","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","navigate","search","getSearchParameters","set-user-status","setStatus","status","call-custom-oauth-login","event","customOAuthCallback","response","_event$source","source","postMessage","targetOrigin","origin","siteUrl","Site_Url","redirectUrl","startsWith","service","window","ServiceConfiguration","customOauth","getLoginService","customLoginWith","customRedirectUri","call","login-with-token","token","loginWithToken","log","_callee","user","async","_callee$","_context","prev","next","logout","run","stop","Promise","addEventListener","e","get","externalCommand","origins","split","indexOf","command"],"sources":["client/startup/iframeCommands.ts"],"sourcesContent":["import type { UserStatus, IUser } from '@rocket.chat/core-typings';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\nimport type { LocationPathname } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\n\nimport { settings } from '../../app/settings/client';\nimport { AccountBox } from '../../app/ui-utils/client/lib/AccountBox';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { afterLogoutCleanUpCallback } from '../../lib/callbacks/afterLogoutCleanUpCallback';\nimport { capitalize, ltrim, rtrim } from '../../lib/utils/stringUtils';\nimport { baseURI } from '../lib/baseURI';\nimport { loginServices } from '../lib/loginServices';\nimport { router } from '../providers/RouterProvider';\n\nconst commands = {\n\t'go'(data: { path: string }) {\n\t\tif (typeof data.path !== 'string' || data.path.trim().length === 0) {\n\t\t\treturn console.error('`path` not defined');\n\t\t}\n\t\tconst newUrl = new URL(`${rtrim(baseURI, '/')}/${ltrim(data.path, '/')}`);\n\n\t\tconst newParams = Array.from(newUrl.searchParams.entries()).reduce((ret, [key, value]) => {\n\t\t\tret[key] = value;\n\t\t\treturn ret;\n\t\t}, {} as Record<string, string>);\n\n\t\tconst newPath = newUrl.pathname.replace(\n\t\t\tnew RegExp(`^${escapeRegExp(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX)}`),\n\t\t\t'',\n\t\t) as LocationPathname;\n\t\trouter.navigate({\n\t\t\tpathname: newPath,\n\t\t\tsearch: { ...router.getSearchParameters(), ...newParams },\n\t\t});\n\t},\n\n\t'set-user-status'(data: { status: UserStatus }) {\n\t\tAccountBox.setStatus(data.status);\n\t},\n\n\t'call-custom-oauth-login'(data: { service: string; redirectUrl?: string | null }, event: MessageEvent) {\n\t\tconst customOAuthCallback = (response: unknown) => {\n\t\t\tevent.source?.postMessage(\n\t\t\t\t{\n\t\t\t\t\tevent: 'custom-oauth-callback',\n\t\t\t\t\tresponse,\n\t\t\t\t},\n\t\t\t\t{ targetOrigin: event.origin },\n\t\t\t);\n\t\t};\n\n\t\tconst siteUrl = `${Meteor.settings.Site_Url}/`;\n\t\tif (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\n\t\t\tdata.redirectUrl = null;\n\t\t}\n\n\t\tif (typeof data.service === 'string' && window.ServiceConfiguration) {\n\t\t\tconst customOauth = loginServices.getLoginService(data.service);\n\n\t\t\tif (customOauth) {\n\t\t\t\tconst customLoginWith = (Meteor as any)[`loginWith${capitalize(customOauth.service, true)}`];\n\t\t\t\tconst customRedirectUri = data.redirectUrl || siteUrl;\n\t\t\t\tcustomLoginWith.call(Meteor, { redirectUrl: customRedirectUri }, customOAuthCallback);\n\t\t\t}\n\t\t}\n\t},\n\n\t'login-with-token'(data: { token: string }) {\n\t\tif (typeof data.token === 'string') {\n\t\t\tMeteor.loginWithToken(data.token, () => {\n\t\t\t\tconsole.log('Iframe command [login-with-token]: result', data);\n\t\t\t});\n\t\t}\n\t},\n\n\tasync 'logout'() {\n\t\tconst user = Meteor.user();\n\t\tMeteor.logout(() => {\n\t\t\tif (!user) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvoid afterLogoutCleanUpCallback.run(user);\n\t\t\tsdk.call('logoutCleanUp', user as unknown as IUser);\n\t\t\treturn router.navigate('/home');\n\t\t});\n\t},\n} as const;\n\ntype CommandMessage<TCommandName extends keyof typeof commands = keyof typeof commands> = {\n\texternalCommand: TCommandName;\n} & Parameters<(typeof commands)[TCommandName]>[0];\n\nwindow.addEventListener('message', <TCommandMessage extends CommandMessage>(e: MessageEvent<TCommandMessage>) => {\n\tif (!settings.get<boolean>('Iframe_Integration_receive_enable')) {\n\t\treturn;\n\t}\n\n\tif (typeof e.data !== 'object' || typeof e.data.externalCommand !== 'string') {\n\t\treturn;\n\t}\n\n\tconst origins = settings.get<string>('Iframe_Integration_receive_origin');\n\n\tif (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\n\t\tconsole.error('Origin not allowed', e.origin);\n\t\treturn;\n\t}\n\n\tif (!(e.data.externalCommand in commands)) {\n\t\tconsole.error('Command not allowed', e.data.externalCommand);\n\t\treturn;\n\t}\n\n\tconst command: (data: any, event: MessageEvent) => void = commands[e.data.externalCommand];\n\tcommand(e.data, e);\n});\n"],"mappings":"AACA,IAAAA,mBAAuB;AAAAC,MAAM,CAAAC,IAAA,6BAA8B;EAAAC,OAAA,WAAAA,CAAAC,CAAA;IAAAJ,mBAAA,GAAAI,CAAA;EAAA;AAAA;AAAA,IAAAC,OAAA;AAAAJ,MAAA,CAAAC,IAAA;EAAAC,OAAA,WAAAA,CAAAC,CAAA;IAAAC,OAAA,GAAAD,CAAA;EAAA;AAAA;AAAA,IAAAE,aAAA;AAAAL,MAAA,CAAAC,IAAA;EAAAC,OAAA,WAAAA,CAAAC,CAAA;IAAAE,aAAA,GAAAF,CAAA;EAAA;AAAA;AAAA,IAAAG,cAAA;AAAAN,MAAA,CAAAC,IAAA;EAAAC,OAAA,WAAAA,CAAAC,CAAA;IAAAG,cAAA,GAAAH,CAAA;EAAA;AAAA;AAA3D,IAAAI,YAAS;AAAAP,MAAc,CAAAC,IAAA,CAAM,6BAA6B,EAAC;EAAAM,YAAA,WAAAA,CAAAJ,CAAA;IAAAI,YAAA,GAAAJ,CAAA;EAAA;AAAA;AAAA,IAAAK,MAAA;AAAAR,MAAA,CAAAC,IAAA;EAAAO,MAAA,WAAAA,CAAAL,CAAA;IAAAK,MAAA,GAAAL,CAAA;EAAA;AAAA;AAAA,IAAAM,QAAA;AAAAT,MAAA,CAAAC,IAAA;EAAAQ,QAAA,WAAAA,CAAAN,CAAA;IAAAM,QAAA,GAAAN,CAAA;EAAA;AAAA;AAAA,IAAAO,UAAA;AAAAV,MAAA,CAAAC,IAAA;EAAAS,UAAA,WAAAA,CAAAP,CAAA;IAAAO,UAAA,GAAAP,CAAA;EAAA;AAAA;AAAA,IAAAQ,GAAA;AAAAX,MAAA,CAAAC,IAAA;EAAAU,GAAA,WAAAA,CAAAR,CAAA;IAAAQ,GAAA,GAAAR,CAAA;EAAA;AAAA;AAAA,IAAAS,0BAAA;AAAAZ,MAAA,CAAAC,IAAA;EAAAW,0BAAA,WAAAA,CAAAT,CAAA;IAAAS,0BAAA,GAAAT,CAAA;EAAA;AAAA;AAAA,IAAAU,UAAA,EAAAC,KAAA,EAAAC,KAAA;AAAAf,MAAA,CAAAC,IAAA;EAAAY,UAAA,WAAAA,CAAAV,CAAA;IAAAU,UAAA,GAAAV,CAAA;EAAA;EAAAW,KAAA,WAAAA,CAAAX,CAAA;IAAAW,KAAA,GAAAX,CAAA;EAAA;EAAAY,KAAA,WAAAA,CAAAZ,CAAA;IAAAY,KAAA,GAAAZ,CAAA;EAAA;AAAA;AAAA,IAAAa,OAAA;AAAAhB,MAAA,CAAAC,IAAA;EAAAe,OAAA,WAAAA,CAAAb,CAAA;IAAAa,OAAA,GAAAb,CAAA;EAAA;AAAA;AAAA,IAAAc,aAAA;AAAAjB,MAAA,CAAAC,IAAA;EAAAgB,aAAA,WAAAA,CAAAd,CAAA;IAAAc,aAAA,GAAAd,CAAA;EAAA;AAAA;AAAA,IAAAe,MAAA;AAAAlB,MAAA,CAAAC,IAAA;EAAAiB,MAAA,WAAAA,CAAAf,CAAA;IAAAe,MAAA,GAAAf,CAAA;EAAA;AAAA;AAa3D,IAAMgB,QAAQ,GAAG;EAChB,IAAI,WAAAC,CAACC,IAAsB;IAC1B,IAAI,OAAOA,IAAI,CAACC,IAAI,KAAK,QAAQ,IAAID,IAAI,CAACC,IAAI,CAACC,IAAI,EAAE,CAACC,MAAM,KAAK,CAAC,EAAE;MACnE,OAAOC,OAAO,CAACC,KAAK,CAAC,oBAAoB,CAAC;IAC3C;IACA,IAAMC,MAAM,GAAG,IAAIC,GAAG,CAAIb,KAAK,CAACC,OAAO,EAAE,GAAG,CAAC,SAAIF,KAAK,CAACO,IAAI,CAACC,IAAI,EAAE,GAAG,CAAG,CAAC;IAEzE,IAAMO,SAAS,GAAGC,KAAK,CAACC,IAAI,CAACJ,MAAM,CAACK,YAAY,CAACC,OAAO,EAAE,CAAC,CAACC,MAAM,CAAC,UAACC,GAAG,EAAAC,IAAA,EAAkB;MAAA,IAAAC,KAAA,GAAA/B,cAAA,CAAA8B,IAAA;QAAfE,GAAG,GAAAD,KAAA;QAAEE,KAAK,GAAAF,KAAA;MACnFF,GAAG,CAACG,GAAG,CAAC,GAAGC,KAAK;MAChB,OAAOJ,GAAG;IACX,CAAC,EAAE,EAA4B,CAAC;IAEhC,IAAMK,OAAO,GAAGb,MAAM,CAACc,QAAQ,CAACC,OAAO,CACtC,IAAIC,MAAM,OAAKpC,YAAY,CAACqC,yBAAyB,CAACC,oBAAoB,CAAG,CAAC,EAC9E,EAAE,CACkB;IACrB3B,MAAM,CAAC4B,QAAQ,CAAC;MACfL,QAAQ,EAAED,OAAO;MACjBO,MAAM,EAAA1C,aAAA,CAAAA,aAAA,KAAOa,MAAM,CAAC8B,mBAAmB,EAAE,GAAKnB,SAAS;KACvD,CAAC;EACH,CAAC;EAED,iBAAiB,WAAAoB,CAAC5B,IAA4B;IAC7CX,UAAU,CAACwC,SAAS,CAAC7B,IAAI,CAAC8B,MAAM,CAAC;EAClC,CAAC;EAED,yBAAyB,WAAAC,CAAC/B,IAAsD,EAAEgC,KAAmB;IACpG,IAAMC,mBAAmB,GAAG,SAAAA,CAACC,QAAiB,EAAI;MAAA,IAAAC,aAAA;MACjD,CAAAA,aAAA,GAAAH,KAAK,CAACI,MAAM,cAAAD,aAAA,uBAAZA,aAAA,CAAcE,WAAW,CACxB;QACCL,KAAK,EAAE,uBAAuB;QAC9BE,QAAQ,EAARA;OACA,EACD;QAAEI,YAAY,EAAEN,KAAK,CAACO;MAAM,CAAE,CAC9B;IACF,CAAC;IAED,IAAMC,OAAO,GAAMrD,MAAM,CAACC,QAAQ,CAACqD,QAAQ,MAAG;IAC9C,IAAI,OAAOzC,IAAI,CAAC0C,WAAW,KAAK,QAAQ,IAAI,CAAC1C,IAAI,CAAC0C,WAAW,CAACC,UAAU,CAACH,OAAO,CAAC,EAAE;MAClFxC,IAAI,CAAC0C,WAAW,GAAG,IAAI;IACxB;IAEA,IAAI,OAAO1C,IAAI,CAAC4C,OAAO,KAAK,QAAQ,IAAIC,MAAM,CAACC,oBAAoB,EAAE;MACpE,IAAMC,WAAW,GAAGnD,aAAa,CAACoD,eAAe,CAAChD,IAAI,CAAC4C,OAAO,CAAC;MAE/D,IAAIG,WAAW,EAAE;QAChB,IAAME,eAAe,GAAI9D,MAAc,eAAaK,UAAU,CAACuD,WAAW,CAACH,OAAO,EAAE,IAAI,CAAC,CAAG;QAC5F,IAAMM,iBAAiB,GAAGlD,IAAI,CAAC0C,WAAW,IAAIF,OAAO;QACrDS,eAAe,CAACE,IAAI,CAAChE,MAAM,EAAE;UAAEuD,WAAW,EAAEQ;QAAiB,CAAE,EAAEjB,mBAAmB,CAAC;MACtF;IACD;EACD,CAAC;EAED,kBAAkB,WAAAmB,CAACpD,IAAuB;IACzC,IAAI,OAAOA,IAAI,CAACqD,KAAK,KAAK,QAAQ,EAAE;MACnClE,MAAM,CAACmE,cAAc,CAACtD,IAAI,CAACqD,KAAK,EAAE,YAAK;QACtCjD,OAAO,CAACmD,GAAG,CAAC,2CAA2C,EAAEvD,IAAI,CAAC;MAC/D,CAAC,CAAC;IACH;EACD,CAAC;EAEK,QAAQ;IAAA,SAAAwD,QAAA;MAAA,IAAAC,IAAA;MAAA,OAAA/E,mBAAA,CAAAgF,KAAA;QAAA,SAAAC,SAAAC,QAAA;UAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cACPL,IAAI,GAAGtE,MAAM,CAACsE,IAAI,EAAE;cAC1BtE,MAAM,CAAC4E,MAAM,CAAC,YAAK;gBAClB,IAAI,CAACN,IAAI,EAAE;kBACV;gBACD;gBACA,KAAKlE,0BAA0B,CAACyE,GAAG,CAACP,IAAI,CAAC;gBACzCnE,GAAG,CAAC6D,IAAI,CAAC,eAAe,EAAEM,IAAwB,CAAC;gBACnD,OAAO5D,MAAM,CAAC4B,QAAQ,CAAC,OAAO,CAAC;cAChC,CAAC,CAAC;YAAC;YAAA;cAAA,OAAAmC,QAAA,CAAAK,IAAA;UAAA;QAAA;QAAA,OAAAN,QAAA;MAAA,uBAAAO,OAAA;IAAA;IAAA,OAAAV,OAAA;EAAA;CAEK;AAMVX,MAAM,CAACsB,gBAAgB,CAAC,SAAS,EAAE,UAAyCC,CAAgC,EAAI;EAC/G,IAAI,CAAChF,QAAQ,CAACiF,GAAG,CAAU,mCAAmC,CAAC,EAAE;IAChE;EACD;EAEA,IAAItF,OAAA,CAAOqF,CAAC,CAACpE,IAAI,MAAK,QAAQ,IAAI,OAAOoE,CAAC,CAACpE,IAAI,CAACsE,eAAe,KAAK,QAAQ,EAAE;IAC7E;EACD;EAEA,IAAMC,OAAO,GAAGnF,QAAQ,CAACiF,GAAG,CAAS,mCAAmC,CAAC;EAEzE,IAAIE,OAAO,KAAK,GAAG,IAAIA,OAAO,CAACC,KAAK,CAAC,GAAG,CAAC,CAACC,OAAO,CAACL,CAAC,CAAC7B,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE;IACnEnC,OAAO,CAACC,KAAK,CAAC,oBAAoB,EAAE+D,CAAC,CAAC7B,MAAM,CAAC;IAC7C;EACD;EAEA,IAAI,EAAE6B,CAAC,CAACpE,IAAI,CAACsE,eAAe,IAAIxE,QAAQ,CAAC,EAAE;IAC1CM,OAAO,CAACC,KAAK,CAAC,qBAAqB,EAAE+D,CAAC,CAACpE,IAAI,CAACsE,eAAe,CAAC;IAC5D;EACD;EAEA,IAAMI,OAAO,GAA6C5E,QAAQ,CAACsE,CAAC,CAACpE,IAAI,CAACsE,eAAe,CAAC;EAC1FI,OAAO,CAACN,CAAC,CAACpE,IAAI,EAAEoE,CAAC,CAAC;AACnB,CAAC,CAAC","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"f9ec4c6c861bf71a769634d212334808f7ab5c96"}
