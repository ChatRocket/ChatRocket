{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/error-handler/server/lib/RocketChat.ErrorHandler.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/error-handler/server/lib/RocketChat.ErrorHandler.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/error-handler/server/lib/RocketChat.ErrorHandler.ts","inputSourceMap":{"version":3,"file":"app/error-handler/server/lib/RocketChat.ErrorHandler.ts","sourceRoot":"","sources":["app/error-handler/server/lib/RocketChat.ErrorHandler.ts"],"names":[],"mappings":"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","sourcesContent":["import { Settings, Users, Rooms } from '@rocket.chat/models';\nimport { Meteor } from 'meteor/meteor';\n\nimport { throttledCounter } from '../../../../lib/utils/throttledCounter';\nimport { sendMessage } from '../../../lib/server/functions/sendMessage';\nimport { settings } from '../../../settings/server';\n\nconst incException = throttledCounter((counter) => {\n\tSettings.incrementValueById('Uncaught_Exceptions_Count', counter, { returnDocument: 'after' })\n\t\t.then(({ value }) => {\n\t\t\tif (value) {\n\t\t\t\tsettings.set(value);\n\t\t\t}\n\t\t})\n\t\t.catch(console.error);\n}, 10000);\n\nclass ErrorHandler {\n\treporting: boolean;\n\n\trid: string | null;\n\n\tlastError: string | null;\n\n\tconstructor() {\n\t\tthis.reporting = false;\n\t\tthis.rid = null;\n\t\tthis.lastError = null;\n\t}\n\n\tasync getRoomId(roomName: string): Promise<string | null> {\n\t\tif (!roomName) {\n\t\t\treturn null;\n\t\t}\n\t\tconst room = await Rooms.findOneByName(roomName.replace('#', ''), { projection: { _id: 1, t: 1 } });\n\t\tif (!room || (room.t !== 'c' && room.t !== 'p')) {\n\t\t\treturn null;\n\t\t}\n\t\treturn room._id;\n\t}\n\n\tasync trackError(message: string, stack?: string): Promise<void> {\n\t\tif (!this.reporting || !this.rid || this.lastError === message) {\n\t\t\treturn;\n\t\t}\n\t\tthis.lastError = message;\n\t\tconst user = await Users.findOneById('rocket.cat');\n\n\t\tif (stack) {\n\t\t\tmessage = `${message}\\n\\`\\`\\`\\n${stack}\\n\\`\\`\\``;\n\t\t}\n\n\t\tawait sendMessage(user, { msg: message }, { _id: this.rid });\n\t}\n}\n\nconst errorHandler = new ErrorHandler();\n\nMeteor.startup(async () => {\n\tsettings.watch<string>('Log_Exceptions_to_Channel', async (value) => {\n\t\terrorHandler.rid = null;\n\t\tconst roomName = value.trim();\n\n\t\tconst rid = await errorHandler.getRoomId(roomName);\n\n\t\terrorHandler.reporting = Boolean(rid);\n\t\terrorHandler.rid = rid;\n\t});\n});\n\n// eslint-disable-next-line @typescript-eslint/no-this-alias\nconst originalMeteorDebug = Meteor._debug;\n\nMeteor._debug = function (message, stack, ...args) {\n\tif (!errorHandler.reporting) {\n\t\treturn originalMeteorDebug.call(this, message, stack);\n\t}\n\tvoid errorHandler.trackError(message, stack);\n\treturn originalMeteorDebug.apply(this, [message, stack, ...args]);\n};\n\n/**\n * If some promise is rejected and doesn't have a catch (unhandledRejection) it may cause this finally\n * here https://github.com/meteor/meteor/blob/be6e529a739f47446950e045f4547ee60e5de7ae/packages/mongo/oplog_tailing.js#L348\n * to not be executed never ending the oplog worker and freezing the entire process.\n *\n * The only way to release the process is executing the following code via inspect:\n *   MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle._workerActive = false\n *\n * Since unhandled rejections are deprecated in NodeJS:\n * (node:83382) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections\n * that are not handled will terminate the Node.js process with a non-zero exit code.\n * we will start respecting this and exit the process to prevent these kind of problems.\n */\n\nprocess.on('unhandledRejection', (error) => {\n\tincException();\n\n\tif (error instanceof Error) {\n\t\tvoid errorHandler.trackError(error.message, error.stack);\n\t}\n\n\tconsole.error('=== UnHandledPromiseRejection ===');\n\tconsole.error(error);\n\tconsole.error('---------------------------------');\n\tconsole.error('Errors like this can cause oplog processing errors.');\n\tconsole.error(\n\t\t'Setting EXIT_UNHANDLEDPROMISEREJECTION will cause the process to exit allowing your service to automatically restart the process',\n\t);\n\tconsole.error('Future node.js versions will automatically exit the process');\n\tconsole.error('=================================');\n\n\tif (process.env.NODE_ENV === 'development' || process.env.EXIT_UNHANDLEDPROMISEREJECTION || process.env.TEST_MODE) {\n\t\tprocess.exit(1);\n\t}\n});\n\nprocess.on('uncaughtException', async (error) => {\n\tincException();\n\n\tconsole.error('=== UnCaughtException ===');\n\tconsole.error(error);\n\tconsole.error('-------------------------');\n\tconsole.error('Errors like this can cause oplog processing errors.');\n\tconsole.error('===========================');\n\n\tvoid errorHandler.trackError(error.message, error.stack);\n});\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/error-handler/server/lib/RocketChat.ErrorHandler.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/error-handler/server/lib/RocketChat.ErrorHandler.ts","inputSourceMap":{"version":3,"file":"app/error-handler/server/lib/RocketChat.ErrorHandler.ts","sourceRoot":"","sources":["app/error-handler/server/lib/RocketChat.ErrorHandler.ts"],"names":[],"mappings":"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","sourcesContent":["import { Settings, Users, Rooms } from '@rocket.chat/models';\nimport { Meteor } from 'meteor/meteor';\n\nimport { throttledCounter } from '../../../../lib/utils/throttledCounter';\nimport { sendMessage } from '../../../lib/server/functions/sendMessage';\nimport { settings } from '../../../settings/server';\n\nconst incException = throttledCounter((counter) => {\n\tSettings.incrementValueById('Uncaught_Exceptions_Count', counter, { returnDocument: 'after' })\n\t\t.then(({ value }) => {\n\t\t\tif (value) {\n\t\t\t\tsettings.set(value);\n\t\t\t}\n\t\t})\n\t\t.catch(console.error);\n}, 10000);\n\nclass ErrorHandler {\n\treporting: boolean;\n\n\trid: string | null;\n\n\tlastError: string | null;\n\n\tconstructor() {\n\t\tthis.reporting = false;\n\t\tthis.rid = null;\n\t\tthis.lastError = null;\n\t}\n\n\tasync getRoomId(roomName: string): Promise<string | null> {\n\t\tif (!roomName) {\n\t\t\treturn null;\n\t\t}\n\t\tconst room = await Rooms.findOneByName(roomName.replace('#', ''), { projection: { _id: 1, t: 1 } });\n\t\tif (!room || (room.t !== 'c' && room.t !== 'p')) {\n\t\t\treturn null;\n\t\t}\n\t\treturn room._id;\n\t}\n\n\tasync trackError(message: string, stack?: string): Promise<void> {\n\t\tif (!this.reporting || !this.rid || this.lastError === message) {\n\t\t\treturn;\n\t\t}\n\t\tthis.lastError = message;\n\t\tconst user = await Users.findOneById('rocket.cat');\n\n\t\tif (stack) {\n\t\t\tmessage = `${message}\\n\\`\\`\\`\\n${stack}\\n\\`\\`\\``;\n\t\t}\n\n\t\tawait sendMessage(user, { msg: message }, { _id: this.rid });\n\t}\n}\n\nconst errorHandler = new ErrorHandler();\n\nMeteor.startup(async () => {\n\tsettings.watch<string>('Log_Exceptions_to_Channel', async (value) => {\n\t\terrorHandler.rid = null;\n\t\tconst roomName = value.trim();\n\n\t\tconst rid = await errorHandler.getRoomId(roomName);\n\n\t\terrorHandler.reporting = Boolean(rid);\n\t\terrorHandler.rid = rid;\n\t});\n});\n\n// eslint-disable-next-line @typescript-eslint/no-this-alias\nconst originalMeteorDebug = Meteor._debug;\n\nMeteor._debug = function (message, stack, ...args) {\n\tif (!errorHandler.reporting) {\n\t\treturn originalMeteorDebug.call(this, message, stack);\n\t}\n\tvoid errorHandler.trackError(message, stack);\n\treturn originalMeteorDebug.apply(this, [message, stack, ...args]);\n};\n\n/**\n * If some promise is rejected and doesn't have a catch (unhandledRejection) it may cause this finally\n * here https://github.com/meteor/meteor/blob/be6e529a739f47446950e045f4547ee60e5de7ae/packages/mongo/oplog_tailing.js#L348\n * to not be executed never ending the oplog worker and freezing the entire process.\n *\n * The only way to release the process is executing the following code via inspect:\n *   MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle._workerActive = false\n *\n * Since unhandled rejections are deprecated in NodeJS:\n * (node:83382) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections\n * that are not handled will terminate the Node.js process with a non-zero exit code.\n * we will start respecting this and exit the process to prevent these kind of problems.\n */\n\nprocess.on('unhandledRejection', (error) => {\n\tincException();\n\n\tif (error instanceof Error) {\n\t\tvoid errorHandler.trackError(error.message, error.stack);\n\t}\n\n\tconsole.error('=== UnHandledPromiseRejection ===');\n\tconsole.error(error);\n\tconsole.error('---------------------------------');\n\tconsole.error('Errors like this can cause oplog processing errors.');\n\tconsole.error(\n\t\t'Setting EXIT_UNHANDLEDPROMISEREJECTION will cause the process to exit allowing your service to automatically restart the process',\n\t);\n\tconsole.error('Future node.js versions will automatically exit the process');\n\tconsole.error('=================================');\n\n\tif (process.env.NODE_ENV === 'development' || process.env.EXIT_UNHANDLEDPROMISEREJECTION || process.env.TEST_MODE) {\n\t\tprocess.exit(1);\n\t}\n});\n\nprocess.on('uncaughtException', async (error) => {\n\tincException();\n\n\tconsole.error('=== UnCaughtException ===');\n\tconsole.error(error);\n\tconsole.error('-------------------------');\n\tconsole.error('Errors like this can cause oplog processing errors.');\n\tconsole.error('===========================');\n\n\tvoid errorHandler.trackError(error.message, error.stack);\n});\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let Settings, Users, Rooms;\n    module.link(\"@rocket.chat/models\", {\n      Settings(v) {\n        Settings = v;\n      },\n      Users(v) {\n        Users = v;\n      },\n      Rooms(v) {\n        Rooms = v;\n      }\n    }, 0);\n    let Meteor;\n    module.link(\"meteor/meteor\", {\n      Meteor(v) {\n        Meteor = v;\n      }\n    }, 1);\n    let throttledCounter;\n    module.link(\"../../../../lib/utils/throttledCounter\", {\n      throttledCounter(v) {\n        throttledCounter = v;\n      }\n    }, 2);\n    let sendMessage;\n    module.link(\"../../../lib/server/functions/sendMessage\", {\n      sendMessage(v) {\n        sendMessage = v;\n      }\n    }, 3);\n    let settings;\n    module.link(\"../../../settings/server\", {\n      settings(v) {\n        settings = v;\n      }\n    }, 4);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    const incException = throttledCounter(counter => {\n      Settings.incrementValueById('Uncaught_Exceptions_Count', counter, {\n        returnDocument: 'after'\n      }).then(_ref => {\n        let {\n          value\n        } = _ref;\n        if (value) {\n          settings.set(value);\n        }\n      }).catch(console.error);\n    }, 10000);\n    class ErrorHandler {\n      constructor() {\n        this.reporting = void 0;\n        this.rid = void 0;\n        this.lastError = void 0;\n        this.reporting = false;\n        this.rid = null;\n        this.lastError = null;\n      }\n      async getRoomId(roomName) {\n        if (!roomName) {\n          return null;\n        }\n        const room = await Rooms.findOneByName(roomName.replace('#', ''), {\n          projection: {\n            _id: 1,\n            t: 1\n          }\n        });\n        if (!room || room.t !== 'c' && room.t !== 'p') {\n          return null;\n        }\n        return room._id;\n      }\n      async trackError(message, stack) {\n        if (!this.reporting || !this.rid || this.lastError === message) {\n          return;\n        }\n        this.lastError = message;\n        const user = await Users.findOneById('rocket.cat');\n        if (stack) {\n          message = \"\".concat(message, \"\\n```\\n\").concat(stack, \"\\n```\");\n        }\n        await sendMessage(user, {\n          msg: message\n        }, {\n          _id: this.rid\n        });\n      }\n    }\n    const errorHandler = new ErrorHandler();\n    Meteor.startup(async () => {\n      settings.watch('Log_Exceptions_to_Channel', async value => {\n        errorHandler.rid = null;\n        const roomName = value.trim();\n        const rid = await errorHandler.getRoomId(roomName);\n        errorHandler.reporting = Boolean(rid);\n        errorHandler.rid = rid;\n      });\n    });\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const originalMeteorDebug = Meteor._debug;\n    Meteor._debug = function (message, stack) {\n      if (!errorHandler.reporting) {\n        return originalMeteorDebug.call(this, message, stack);\n      }\n      void errorHandler.trackError(message, stack);\n      for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n        args[_key - 2] = arguments[_key];\n      }\n      return originalMeteorDebug.apply(this, [message, stack, ...args]);\n    };\n    /**\n     * If some promise is rejected and doesn't have a catch (unhandledRejection) it may cause this finally\n     * here https://github.com/meteor/meteor/blob/be6e529a739f47446950e045f4547ee60e5de7ae/packages/mongo/oplog_tailing.js#L348\n     * to not be executed never ending the oplog worker and freezing the entire process.\n     *\n     * The only way to release the process is executing the following code via inspect:\n     *   MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle._workerActive = false\n     *\n     * Since unhandled rejections are deprecated in NodeJS:\n     * (node:83382) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections\n     * that are not handled will terminate the Node.js process with a non-zero exit code.\n     * we will start respecting this and exit the process to prevent these kind of problems.\n     */\n    process.on('unhandledRejection', error => {\n      incException();\n      if (error instanceof Error) {\n        void errorHandler.trackError(error.message, error.stack);\n      }\n      console.error('=== UnHandledPromiseRejection ===');\n      console.error(error);\n      console.error('---------------------------------');\n      console.error('Errors like this can cause oplog processing errors.');\n      console.error('Setting EXIT_UNHANDLEDPROMISEREJECTION will cause the process to exit allowing your service to automatically restart the process');\n      console.error('Future node.js versions will automatically exit the process');\n      console.error('=================================');\n      if (process.env.NODE_ENV === 'development' || process.env.EXIT_UNHANDLEDPROMISEREJECTION || process.env.TEST_MODE) {\n        process.exit(1);\n      }\n    });\n    process.on('uncaughtException', async error => {\n      incException();\n      console.error('=== UnCaughtException ===');\n      console.error(error);\n      console.error('-------------------------');\n      console.error('Errors like this can cause oplog processing errors.');\n      console.error('===========================');\n      void errorHandler.trackError(error.message, error.stack);\n    });\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["Settings","Users","Rooms","module","link","v","Meteor","throttledCounter","sendMessage","settings","__reifyWaitForDeps__","incException","counter","incrementValueById","returnDocument","then","_ref","value","set","catch","console","error","ErrorHandler","constructor","reporting","rid","lastError","getRoomId","roomName","room","findOneByName","replace","projection","_id","t","trackError","message","stack","user","findOneById","concat","msg","errorHandler","startup","watch","trim","Boolean","originalMeteorDebug","_debug","call","_len","arguments","length","args","Array","_key","apply","process","on","Error","env","NODE_ENV","EXIT_UNHANDLEDPROMISEREJECTION","TEST_MODE","exit","__reify_async_result__","_reifyError","self","async"],"sources":["app/error-handler/server/lib/RocketChat.ErrorHandler.ts"],"sourcesContent":["import { Settings, Users, Rooms } from '@rocket.chat/models';\nimport { Meteor } from 'meteor/meteor';\n\nimport { throttledCounter } from '../../../../lib/utils/throttledCounter';\nimport { sendMessage } from '../../../lib/server/functions/sendMessage';\nimport { settings } from '../../../settings/server';\n\nconst incException = throttledCounter((counter) => {\n\tSettings.incrementValueById('Uncaught_Exceptions_Count', counter, { returnDocument: 'after' })\n\t\t.then(({ value }) => {\n\t\t\tif (value) {\n\t\t\t\tsettings.set(value);\n\t\t\t}\n\t\t})\n\t\t.catch(console.error);\n}, 10000);\n\nclass ErrorHandler {\n\treporting: boolean;\n\n\trid: string | null;\n\n\tlastError: string | null;\n\n\tconstructor() {\n\t\tthis.reporting = false;\n\t\tthis.rid = null;\n\t\tthis.lastError = null;\n\t}\n\n\tasync getRoomId(roomName: string): Promise<string | null> {\n\t\tif (!roomName) {\n\t\t\treturn null;\n\t\t}\n\t\tconst room = await Rooms.findOneByName(roomName.replace('#', ''), { projection: { _id: 1, t: 1 } });\n\t\tif (!room || (room.t !== 'c' && room.t !== 'p')) {\n\t\t\treturn null;\n\t\t}\n\t\treturn room._id;\n\t}\n\n\tasync trackError(message: string, stack?: string): Promise<void> {\n\t\tif (!this.reporting || !this.rid || this.lastError === message) {\n\t\t\treturn;\n\t\t}\n\t\tthis.lastError = message;\n\t\tconst user = await Users.findOneById('rocket.cat');\n\n\t\tif (stack) {\n\t\t\tmessage = `${message}\\n\\`\\`\\`\\n${stack}\\n\\`\\`\\``;\n\t\t}\n\n\t\tawait sendMessage(user, { msg: message }, { _id: this.rid });\n\t}\n}\n\nconst errorHandler = new ErrorHandler();\n\nMeteor.startup(async () => {\n\tsettings.watch<string>('Log_Exceptions_to_Channel', async (value) => {\n\t\terrorHandler.rid = null;\n\t\tconst roomName = value.trim();\n\n\t\tconst rid = await errorHandler.getRoomId(roomName);\n\n\t\terrorHandler.reporting = Boolean(rid);\n\t\terrorHandler.rid = rid;\n\t});\n});\n\n// eslint-disable-next-line @typescript-eslint/no-this-alias\nconst originalMeteorDebug = Meteor._debug;\n\nMeteor._debug = function (message, stack, ...args) {\n\tif (!errorHandler.reporting) {\n\t\treturn originalMeteorDebug.call(this, message, stack);\n\t}\n\tvoid errorHandler.trackError(message, stack);\n\treturn originalMeteorDebug.apply(this, [message, stack, ...args]);\n};\n\n/**\n * If some promise is rejected and doesn't have a catch (unhandledRejection) it may cause this finally\n * here https://github.com/meteor/meteor/blob/be6e529a739f47446950e045f4547ee60e5de7ae/packages/mongo/oplog_tailing.js#L348\n * to not be executed never ending the oplog worker and freezing the entire process.\n *\n * The only way to release the process is executing the following code via inspect:\n *   MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle._workerActive = false\n *\n * Since unhandled rejections are deprecated in NodeJS:\n * (node:83382) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections\n * that are not handled will terminate the Node.js process with a non-zero exit code.\n * we will start respecting this and exit the process to prevent these kind of problems.\n */\n\nprocess.on('unhandledRejection', (error) => {\n\tincException();\n\n\tif (error instanceof Error) {\n\t\tvoid errorHandler.trackError(error.message, error.stack);\n\t}\n\n\tconsole.error('=== UnHandledPromiseRejection ===');\n\tconsole.error(error);\n\tconsole.error('---------------------------------');\n\tconsole.error('Errors like this can cause oplog processing errors.');\n\tconsole.error(\n\t\t'Setting EXIT_UNHANDLEDPROMISEREJECTION will cause the process to exit allowing your service to automatically restart the process',\n\t);\n\tconsole.error('Future node.js versions will automatically exit the process');\n\tconsole.error('=================================');\n\n\tif (process.env.NODE_ENV === 'development' || process.env.EXIT_UNHANDLEDPROMISEREJECTION || process.env.TEST_MODE) {\n\t\tprocess.exit(1);\n\t}\n});\n\nprocess.on('uncaughtException', async (error) => {\n\tincException();\n\n\tconsole.error('=== UnCaughtException ===');\n\tconsole.error(error);\n\tconsole.error('-------------------------');\n\tconsole.error('Errors like this can cause oplog processing errors.');\n\tconsole.error('===========================');\n\n\tvoid errorHandler.trackError(error.message, error.stack);\n});\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"d8f99934a27b2068bb12677d3fe75eb76447df45"}
