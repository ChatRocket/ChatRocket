{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/otr/lib/functions.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/otr/lib/functions.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/otr/lib/functions.ts","inputSourceMap":{"version":3,"file":"app/otr/lib/functions.ts","sourceRoot":"","sources":["app/otr/lib/functions.ts"],"names":[],"mappings":"AAEA,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,CAAC,MAAM,CAAC;AAEjC,MAAM,CAAC,MAAM,iBAAiB,GAAG,CAAC,EAAE,aAAa,EAAE,EAAE,EAAkD,EAAc,EAAE;IACtH,MAAM,UAAU,GAAG,IAAI,UAAU,CAAC,aAAa,CAAC,CAAC;IACjD,MAAM,MAAM,GAAG,IAAI,UAAU,CAAC,EAAE,CAAC,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC;IAC7D,MAAM,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;IAClB,MAAM,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC;IAClC,OAAO,MAAM,CAAC;AACf,CAAC,CAAC;AACF,MAAM,CAAC,MAAM,UAAU,GAAG,KAAK,EAAE,EAChC,EAAE,EACF,WAAW,EACX,IAAI,GAKJ,EAAwB,EAAE,CAC1B,MAAM,CAAC,OAAO,CACb;IACC,IAAI,EAAE,SAAS;IACf,EAAE;CACF,EACD,WAAW,EACX,IAAI,CACJ,CAAC;AACH,MAAM,CAAC,MAAM,MAAM,GAAG,KAAK,EAAE,IAAiB,EAAwB,EAAE,CACvE,MAAM,CAAC,MAAM,CACZ;IACC,IAAI,EAAE,SAAS;CACf,EACD,IAAI,CACJ,CAAC;AACH,MAAM,CAAC,MAAM,UAAU,GAAG,KAAK,EAAE,EAAE,OAAO,EAAE,QAAQ,EAAuD,EAAwB,EAAE;IACpI,IAAI,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC;QAC1B,MAAM,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC;IACnC,CAAC;IAED,OAAO,MAAM,CAAC,UAAU,CAAC,OAAO,EAAE,QAAQ,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC;AAC7D,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,SAAS,GAAG,KAAK,EAAE,eAA2B,EAAsB,EAAE,CAClF,MAAM,CAAC,SAAS,CACf,KAAK,EACL,eAAe,EACf;IACC,IAAI,EAAE,MAAM;IACZ,UAAU,EAAE,OAAO;CACnB,EACD,KAAK,EACL,EAAE,CACF,CAAC;AACH,MAAM,CAAC,MAAM,YAAY,GAAG,KAAK,EAAE,cAA0B,EAAsB,EAAE,CACpF,MAAM,CAAC,SAAS,CACf,KAAK,EACL,cAAc,EACd;IACC,IAAI,EAAE,SAAS;CACf,EACD,KAAK,EACL,CAAC,SAAS,EAAE,SAAS,CAAC,CACtB,CAAC;AACH,MAAM,CAAC,MAAM,SAAS,GAAG,KAAK,EAAE,QAAmB,EAAuB,EAAE,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;AAC/G,MAAM,CAAC,MAAM,eAAe,GAAG,KAAK,IAA4B,EAAE,CACjE,MAAM,CAAC,WAAW,CACjB;IACC,IAAI,EAAE,MAAM;IACZ,UAAU,EAAE,OAAO;CACnB,EACD,KAAK,EACL,CAAC,WAAW,EAAE,YAAY,CAAC,CAC3B,CAAC;AACH,MAAM,CAAC,MAAM,UAAU,GAAG,KAAK,EAAE,UAAsB,EAAE,WAAsB,EAAwB,EAAE;IACxG,MAAM,EAAE,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IACnC,UAAU,GAAG,UAAU,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;IAClC,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,OAAO,CAChC;QACC,IAAI,EAAE,SAAS;QACf,EAAE;KACF,EACD,WAAW,EACX,UAAU,CACV,CAAC;IACF,OAAO,IAAI,CAAC;AACb,CAAC,CAAC","sourcesContent":["import type { IOTRAlgorithm } from './IOTR';\n\nconst { subtle } = global.crypto;\n\nexport const joinEncryptedData = ({ encryptedData, iv }: { encryptedData: ArrayBuffer; iv: Uint8Array }): Uint8Array => {\n\tconst cipherText = new Uint8Array(encryptedData);\n\tconst output = new Uint8Array(iv.length + cipherText.length);\n\toutput.set(iv, 0);\n\toutput.set(cipherText, iv.length);\n\treturn output;\n};\nexport const encryptAES = async ({\n\tiv,\n\t_sessionKey,\n\tdata,\n}: {\n\tiv: Uint8Array;\n\t_sessionKey: CryptoKey;\n\tdata: Uint8Array;\n}): Promise<ArrayBuffer> =>\n\tsubtle.encrypt(\n\t\t{\n\t\t\tname: 'AES-GCM',\n\t\t\tiv,\n\t\t},\n\t\t_sessionKey,\n\t\tdata,\n\t);\nexport const digest = async (bits: ArrayBuffer): Promise<ArrayBuffer> =>\n\tsubtle.digest(\n\t\t{\n\t\t\tname: 'SHA-256',\n\t\t},\n\t\tbits,\n\t);\nexport const deriveBits = async ({ ecdhObj, _keyPair }: { ecdhObj: IOTRAlgorithm; _keyPair: CryptoKeyPair }): Promise<ArrayBuffer> => {\n\tif (!_keyPair.privateKey) {\n\t\tthrow new Error('No private key');\n\t}\n\n\treturn subtle.deriveBits(ecdhObj, _keyPair.privateKey, 256);\n};\n\nexport const importKey = async (publicKeyObject: JsonWebKey): Promise<CryptoKey> =>\n\tsubtle.importKey(\n\t\t'jwk',\n\t\tpublicKeyObject,\n\t\t{\n\t\t\tname: 'ECDH',\n\t\t\tnamedCurve: 'P-256',\n\t\t},\n\t\tfalse,\n\t\t[],\n\t);\nexport const importKeyRaw = async (sessionKeyData: Uint8Array): Promise<CryptoKey> =>\n\tsubtle.importKey(\n\t\t'raw',\n\t\tsessionKeyData,\n\t\t{\n\t\t\tname: 'AES-GCM',\n\t\t},\n\t\tfalse,\n\t\t['encrypt', 'decrypt'],\n\t);\nexport const exportKey = async (_keyPair: CryptoKey): Promise<JsonWebKey> => subtle.exportKey('jwk', _keyPair);\nexport const generateKeyPair = async (): Promise<CryptoKeyPair> =>\n\tsubtle.generateKey(\n\t\t{\n\t\t\tname: 'ECDH',\n\t\t\tnamedCurve: 'P-256',\n\t\t},\n\t\tfalse,\n\t\t['deriveKey', 'deriveBits'],\n\t);\nexport const decryptAES = async (cipherText: Uint8Array, _sessionKey: CryptoKey): Promise<ArrayBuffer> => {\n\tconst iv = cipherText.slice(0, 12);\n\tcipherText = cipherText.slice(12);\n\tconst data = await subtle.decrypt(\n\t\t{\n\t\t\tname: 'AES-GCM',\n\t\t\tiv,\n\t\t},\n\t\t_sessionKey,\n\t\tcipherText,\n\t);\n\treturn data;\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/otr/lib/functions.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/otr/lib/functions.ts","inputSourceMap":{"version":3,"file":"app/otr/lib/functions.ts","sourceRoot":"","sources":["app/otr/lib/functions.ts"],"names":[],"mappings":"AAEA,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,CAAC,MAAM,CAAC;AAEjC,MAAM,CAAC,MAAM,iBAAiB,GAAG,CAAC,EAAE,aAAa,EAAE,EAAE,EAAkD,EAAc,EAAE;IACtH,MAAM,UAAU,GAAG,IAAI,UAAU,CAAC,aAAa,CAAC,CAAC;IACjD,MAAM,MAAM,GAAG,IAAI,UAAU,CAAC,EAAE,CAAC,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC;IAC7D,MAAM,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;IAClB,MAAM,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC;IAClC,OAAO,MAAM,CAAC;AACf,CAAC,CAAC;AACF,MAAM,CAAC,MAAM,UAAU,GAAG,KAAK,EAAE,EAChC,EAAE,EACF,WAAW,EACX,IAAI,GAKJ,EAAwB,EAAE,CAC1B,MAAM,CAAC,OAAO,CACb;IACC,IAAI,EAAE,SAAS;IACf,EAAE;CACF,EACD,WAAW,EACX,IAAI,CACJ,CAAC;AACH,MAAM,CAAC,MAAM,MAAM,GAAG,KAAK,EAAE,IAAiB,EAAwB,EAAE,CACvE,MAAM,CAAC,MAAM,CACZ;IACC,IAAI,EAAE,SAAS;CACf,EACD,IAAI,CACJ,CAAC;AACH,MAAM,CAAC,MAAM,UAAU,GAAG,KAAK,EAAE,EAAE,OAAO,EAAE,QAAQ,EAAuD,EAAwB,EAAE;IACpI,IAAI,CAAC,QAAQ,CAAC,UAAU,EAAE,CAAC;QAC1B,MAAM,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC;IACnC,CAAC;IAED,OAAO,MAAM,CAAC,UAAU,CAAC,OAAO,EAAE,QAAQ,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC;AAC7D,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,SAAS,GAAG,KAAK,EAAE,eAA2B,EAAsB,EAAE,CAClF,MAAM,CAAC,SAAS,CACf,KAAK,EACL,eAAe,EACf;IACC,IAAI,EAAE,MAAM;IACZ,UAAU,EAAE,OAAO;CACnB,EACD,KAAK,EACL,EAAE,CACF,CAAC;AACH,MAAM,CAAC,MAAM,YAAY,GAAG,KAAK,EAAE,cAA0B,EAAsB,EAAE,CACpF,MAAM,CAAC,SAAS,CACf,KAAK,EACL,cAAc,EACd;IACC,IAAI,EAAE,SAAS;CACf,EACD,KAAK,EACL,CAAC,SAAS,EAAE,SAAS,CAAC,CACtB,CAAC;AACH,MAAM,CAAC,MAAM,SAAS,GAAG,KAAK,EAAE,QAAmB,EAAuB,EAAE,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;AAC/G,MAAM,CAAC,MAAM,eAAe,GAAG,KAAK,IAA4B,EAAE,CACjE,MAAM,CAAC,WAAW,CACjB;IACC,IAAI,EAAE,MAAM;IACZ,UAAU,EAAE,OAAO;CACnB,EACD,KAAK,EACL,CAAC,WAAW,EAAE,YAAY,CAAC,CAC3B,CAAC;AACH,MAAM,CAAC,MAAM,UAAU,GAAG,KAAK,EAAE,UAAsB,EAAE,WAAsB,EAAwB,EAAE;IACxG,MAAM,EAAE,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IACnC,UAAU,GAAG,UAAU,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;IAClC,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,OAAO,CAChC;QACC,IAAI,EAAE,SAAS;QACf,EAAE;KACF,EACD,WAAW,EACX,UAAU,CACV,CAAC;IACF,OAAO,IAAI,CAAC;AACb,CAAC,CAAC","sourcesContent":["import type { IOTRAlgorithm } from './IOTR';\n\nconst { subtle } = global.crypto;\n\nexport const joinEncryptedData = ({ encryptedData, iv }: { encryptedData: ArrayBuffer; iv: Uint8Array }): Uint8Array => {\n\tconst cipherText = new Uint8Array(encryptedData);\n\tconst output = new Uint8Array(iv.length + cipherText.length);\n\toutput.set(iv, 0);\n\toutput.set(cipherText, iv.length);\n\treturn output;\n};\nexport const encryptAES = async ({\n\tiv,\n\t_sessionKey,\n\tdata,\n}: {\n\tiv: Uint8Array;\n\t_sessionKey: CryptoKey;\n\tdata: Uint8Array;\n}): Promise<ArrayBuffer> =>\n\tsubtle.encrypt(\n\t\t{\n\t\t\tname: 'AES-GCM',\n\t\t\tiv,\n\t\t},\n\t\t_sessionKey,\n\t\tdata,\n\t);\nexport const digest = async (bits: ArrayBuffer): Promise<ArrayBuffer> =>\n\tsubtle.digest(\n\t\t{\n\t\t\tname: 'SHA-256',\n\t\t},\n\t\tbits,\n\t);\nexport const deriveBits = async ({ ecdhObj, _keyPair }: { ecdhObj: IOTRAlgorithm; _keyPair: CryptoKeyPair }): Promise<ArrayBuffer> => {\n\tif (!_keyPair.privateKey) {\n\t\tthrow new Error('No private key');\n\t}\n\n\treturn subtle.deriveBits(ecdhObj, _keyPair.privateKey, 256);\n};\n\nexport const importKey = async (publicKeyObject: JsonWebKey): Promise<CryptoKey> =>\n\tsubtle.importKey(\n\t\t'jwk',\n\t\tpublicKeyObject,\n\t\t{\n\t\t\tname: 'ECDH',\n\t\t\tnamedCurve: 'P-256',\n\t\t},\n\t\tfalse,\n\t\t[],\n\t);\nexport const importKeyRaw = async (sessionKeyData: Uint8Array): Promise<CryptoKey> =>\n\tsubtle.importKey(\n\t\t'raw',\n\t\tsessionKeyData,\n\t\t{\n\t\t\tname: 'AES-GCM',\n\t\t},\n\t\tfalse,\n\t\t['encrypt', 'decrypt'],\n\t);\nexport const exportKey = async (_keyPair: CryptoKey): Promise<JsonWebKey> => subtle.exportKey('jwk', _keyPair);\nexport const generateKeyPair = async (): Promise<CryptoKeyPair> =>\n\tsubtle.generateKey(\n\t\t{\n\t\t\tname: 'ECDH',\n\t\t\tnamedCurve: 'P-256',\n\t\t},\n\t\tfalse,\n\t\t['deriveKey', 'deriveBits'],\n\t);\nexport const decryptAES = async (cipherText: Uint8Array, _sessionKey: CryptoKey): Promise<ArrayBuffer> => {\n\tconst iv = cipherText.slice(0, 12);\n\tcipherText = cipherText.slice(12);\n\tconst data = await subtle.decrypt(\n\t\t{\n\t\t\tname: 'AES-GCM',\n\t\t\tiv,\n\t\t},\n\t\t_sessionKey,\n\t\tcipherText,\n\t);\n\treturn data;\n};\n"]}}},"code":"module.export({\n  joinEncryptedData: () => joinEncryptedData,\n  encryptAES: () => encryptAES,\n  digest: () => digest,\n  deriveBits: () => deriveBits,\n  importKey: () => importKey,\n  importKeyRaw: () => importKeyRaw,\n  exportKey: () => exportKey,\n  generateKeyPair: () => generateKeyPair,\n  decryptAES: () => decryptAES\n});\nconst {\n  subtle\n} = global.crypto;\nconst joinEncryptedData = _ref => {\n  let {\n    encryptedData,\n    iv\n  } = _ref;\n  const cipherText = new Uint8Array(encryptedData);\n  const output = new Uint8Array(iv.length + cipherText.length);\n  output.set(iv, 0);\n  output.set(cipherText, iv.length);\n  return output;\n};\nconst encryptAES = async _ref2 => {\n  let {\n    iv,\n    _sessionKey,\n    data\n  } = _ref2;\n  return subtle.encrypt({\n    name: 'AES-GCM',\n    iv\n  }, _sessionKey, data);\n};\nconst digest = async bits => subtle.digest({\n  name: 'SHA-256'\n}, bits);\nconst deriveBits = async _ref3 => {\n  let {\n    ecdhObj,\n    _keyPair\n  } = _ref3;\n  if (!_keyPair.privateKey) {\n    throw new Error('No private key');\n  }\n  return subtle.deriveBits(ecdhObj, _keyPair.privateKey, 256);\n};\nconst importKey = async publicKeyObject => subtle.importKey('jwk', publicKeyObject, {\n  name: 'ECDH',\n  namedCurve: 'P-256'\n}, false, []);\nconst importKeyRaw = async sessionKeyData => subtle.importKey('raw', sessionKeyData, {\n  name: 'AES-GCM'\n}, false, ['encrypt', 'decrypt']);\nconst exportKey = async _keyPair => subtle.exportKey('jwk', _keyPair);\nconst generateKeyPair = async () => subtle.generateKey({\n  name: 'ECDH',\n  namedCurve: 'P-256'\n}, false, ['deriveKey', 'deriveBits']);\nconst decryptAES = async (cipherText, _sessionKey) => {\n  const iv = cipherText.slice(0, 12);\n  cipherText = cipherText.slice(12);\n  const data = await subtle.decrypt({\n    name: 'AES-GCM',\n    iv\n  }, _sessionKey, cipherText);\n  return data;\n};","map":{"version":3,"names":["module","export","joinEncryptedData","encryptAES","digest","deriveBits","importKey","importKeyRaw","exportKey","generateKeyPair","decryptAES","subtle","global","crypto","_ref","encryptedData","iv","cipherText","Uint8Array","output","length","set","_ref2","_sessionKey","data","encrypt","name","bits","_ref3","ecdhObj","_keyPair","privateKey","Error","publicKeyObject","namedCurve","sessionKeyData","generateKey","slice","decrypt"],"sources":["app/otr/lib/functions.ts"],"sourcesContent":["import type { IOTRAlgorithm } from './IOTR';\n\nconst { subtle } = global.crypto;\n\nexport const joinEncryptedData = ({ encryptedData, iv }: { encryptedData: ArrayBuffer; iv: Uint8Array }): Uint8Array => {\n\tconst cipherText = new Uint8Array(encryptedData);\n\tconst output = new Uint8Array(iv.length + cipherText.length);\n\toutput.set(iv, 0);\n\toutput.set(cipherText, iv.length);\n\treturn output;\n};\nexport const encryptAES = async ({\n\tiv,\n\t_sessionKey,\n\tdata,\n}: {\n\tiv: Uint8Array;\n\t_sessionKey: CryptoKey;\n\tdata: Uint8Array;\n}): Promise<ArrayBuffer> =>\n\tsubtle.encrypt(\n\t\t{\n\t\t\tname: 'AES-GCM',\n\t\t\tiv,\n\t\t},\n\t\t_sessionKey,\n\t\tdata,\n\t);\nexport const digest = async (bits: ArrayBuffer): Promise<ArrayBuffer> =>\n\tsubtle.digest(\n\t\t{\n\t\t\tname: 'SHA-256',\n\t\t},\n\t\tbits,\n\t);\nexport const deriveBits = async ({ ecdhObj, _keyPair }: { ecdhObj: IOTRAlgorithm; _keyPair: CryptoKeyPair }): Promise<ArrayBuffer> => {\n\tif (!_keyPair.privateKey) {\n\t\tthrow new Error('No private key');\n\t}\n\n\treturn subtle.deriveBits(ecdhObj, _keyPair.privateKey, 256);\n};\n\nexport const importKey = async (publicKeyObject: JsonWebKey): Promise<CryptoKey> =>\n\tsubtle.importKey(\n\t\t'jwk',\n\t\tpublicKeyObject,\n\t\t{\n\t\t\tname: 'ECDH',\n\t\t\tnamedCurve: 'P-256',\n\t\t},\n\t\tfalse,\n\t\t[],\n\t);\nexport const importKeyRaw = async (sessionKeyData: Uint8Array): Promise<CryptoKey> =>\n\tsubtle.importKey(\n\t\t'raw',\n\t\tsessionKeyData,\n\t\t{\n\t\t\tname: 'AES-GCM',\n\t\t},\n\t\tfalse,\n\t\t['encrypt', 'decrypt'],\n\t);\nexport const exportKey = async (_keyPair: CryptoKey): Promise<JsonWebKey> => subtle.exportKey('jwk', _keyPair);\nexport const generateKeyPair = async (): Promise<CryptoKeyPair> =>\n\tsubtle.generateKey(\n\t\t{\n\t\t\tname: 'ECDH',\n\t\t\tnamedCurve: 'P-256',\n\t\t},\n\t\tfalse,\n\t\t['deriveKey', 'deriveBits'],\n\t);\nexport const decryptAES = async (cipherText: Uint8Array, _sessionKey: CryptoKey): Promise<ArrayBuffer> => {\n\tconst iv = cipherText.slice(0, 12);\n\tcipherText = cipherText.slice(12);\n\tconst data = await subtle.decrypt(\n\t\t{\n\t\t\tname: 'AES-GCM',\n\t\t\tiv,\n\t\t},\n\t\t_sessionKey,\n\t\tcipherText,\n\t);\n\treturn data;\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"b887177ce9798f2c3de14fb62da7fb4f25a248a1"}
