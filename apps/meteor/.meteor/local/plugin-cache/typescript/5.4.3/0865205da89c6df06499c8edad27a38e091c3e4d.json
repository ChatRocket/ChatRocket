{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/apps/orchestrator.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/apps/orchestrator.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/apps/orchestrator.ts","inputSourceMap":{"version":3,"file":"client/apps/orchestrator.ts","sourceRoot":"","sources":["client/apps/orchestrator.ts"],"names":[],"mappings":"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","sourcesContent":["import { AppClientManager } from '@rocket.chat/apps-engine/client/AppClientManager';\nimport type { AppsEngineUIHost } from '@rocket.chat/apps-engine/client/AppsEngineUIHost';\nimport type { IPermission } from '@rocket.chat/apps-engine/definition/permissions/IPermission';\nimport type { ISetting } from '@rocket.chat/apps-engine/definition/settings';\nimport type { Serialized } from '@rocket.chat/core-typings';\n\nimport { hasAtLeastOnePermission } from '../../app/authorization/client';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { dispatchToastMessage } from '../lib/toast';\nimport type { App } from '../views/marketplace/types';\nimport type { IAppExternalURL, ICategory } from './@types/IOrchestrator';\nimport { RealAppsEngineUIHost } from './RealAppsEngineUIHost';\n\nconst isErrorObject = (e: unknown): e is { error: string } =>\n\ttypeof e === 'object' && e !== null && 'error' in e && typeof e.error === 'string';\n\nclass AppClientOrchestrator {\n\tprivate _appClientUIHost: AppsEngineUIHost;\n\n\tprivate _manager: AppClientManager;\n\n\tprivate _isLoaded: boolean;\n\n\tconstructor() {\n\t\tthis._appClientUIHost = new RealAppsEngineUIHost();\n\t\tthis._manager = new AppClientManager(this._appClientUIHost);\n\t\tthis._isLoaded = false;\n\t}\n\n\tpublic async load(): Promise<void> {\n\t\tif (!this._isLoaded) {\n\t\t\tthis._isLoaded = true;\n\t\t}\n\t}\n\n\tpublic getAppClientManager(): AppClientManager {\n\t\treturn this._manager;\n\t}\n\n\tpublic handleError(error: unknown): void {\n\t\tif (hasAtLeastOnePermission(['manage-apps'])) {\n\t\t\tdispatchToastMessage({\n\t\t\t\ttype: 'error',\n\t\t\t\tmessage: error,\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic async getInstalledApps(): Promise<App[]> {\n\t\tconst result = await sdk.rest.get<'/apps/installed'>('/apps/installed');\n\n\t\tif ('apps' in result) {\n\t\t\t// TODO: chapter day: multiple results are returned, but we only need one\n\t\t\treturn result.apps as App[];\n\t\t}\n\t\tthrow new Error('Invalid response from API');\n\t}\n\n\tpublic async getAppsFromMarketplace(isAdminUser?: boolean): Promise<{ apps: App[]; error?: unknown }> {\n\t\tlet result: App[] = [];\n\t\ttry {\n\t\t\tresult = await sdk.rest.get('/apps/marketplace', { isAdminUser: isAdminUser ? isAdminUser.toString() : 'false' });\n\t\t} catch (e) {\n\t\t\tif (isErrorObject(e)) {\n\t\t\t\treturn { apps: [], error: e.error };\n\t\t\t}\n\t\t\tif (typeof e === 'string') {\n\t\t\t\treturn { apps: [], error: e };\n\t\t\t}\n\t\t}\n\n\t\tif (!Array.isArray(result)) {\n\t\t\t// TODO: chapter day: multiple results are returned, but we only need one\n\t\t\treturn { apps: [], error: 'Invalid response from API' };\n\t\t}\n\n\t\tconst apps = (result as App[]).map((app: App) => {\n\t\t\tconst { latest, appRequestStats, price, pricingPlans, purchaseType, isEnterpriseOnly, modifiedAt, bundledIn, requestedEndUser } = app;\n\t\t\treturn {\n\t\t\t\t...latest,\n\t\t\t\tappRequestStats,\n\t\t\t\tprice,\n\t\t\t\tpricingPlans,\n\t\t\t\tpurchaseType,\n\t\t\t\tisEnterpriseOnly,\n\t\t\t\tmodifiedAt,\n\t\t\t\tbundledIn,\n\t\t\t\trequestedEndUser,\n\t\t\t};\n\t\t});\n\n\t\treturn { apps, error: undefined };\n\t}\n\n\tpublic async getAppsOnBundle(bundleId: string): Promise<App[]> {\n\t\tconst { apps } = await sdk.rest.get(`/apps/bundles/${bundleId}/apps`);\n\t\treturn apps;\n\t}\n\n\tpublic async getApp(appId: string): Promise<App> {\n\t\tconst { app } = await sdk.rest.get(`/apps/${appId}` as any);\n\t\treturn app;\n\t}\n\n\tpublic async setAppSettings(appId: string, settings: ISetting[]): Promise<void> {\n\t\tawait sdk.rest.post(`/apps/${appId}/settings`, { settings });\n\t}\n\n\tpublic async installApp(appId: string, version: string, permissionsGranted?: IPermission[]): Promise<App> {\n\t\tconst { app } = (await sdk.rest.post<'/apps'>('/apps', {\n\t\t\tappId,\n\t\t\tmarketplace: true,\n\t\t\tversion,\n\t\t\tpermissionsGranted,\n\t\t})) as { app: App };\n\t\treturn app;\n\t}\n\n\tpublic async updateApp(appId: string, version: string, permissionsGranted?: IPermission[]): Promise<App> {\n\t\tconst result = await sdk.rest.post<'/apps/:id'>(`/apps/${appId}`, {\n\t\t\tappId,\n\t\t\tmarketplace: true,\n\t\t\tversion,\n\t\t\tpermissionsGranted,\n\t\t});\n\n\t\tif ('app' in result) {\n\t\t\treturn result.app;\n\t\t}\n\t\tthrow new Error('App not found');\n\t}\n\n\tpublic async buildExternalUrl(appId: string, purchaseType: 'buy' | 'subscription' = 'buy', details = false): Promise<IAppExternalURL> {\n\t\tconst result = await sdk.rest.get('/apps/buildExternalUrl', {\n\t\t\tappId,\n\t\t\tpurchaseType,\n\t\t\tdetails: `${details}`,\n\t\t});\n\n\t\tif ('url' in result) {\n\t\t\treturn result;\n\t\t}\n\n\t\tthrow new Error('Failed to build external url');\n\t}\n\n\tpublic async buildExternalAppRequest(appId: string) {\n\t\tconst result = await sdk.rest.get('/apps/buildExternalAppRequest', {\n\t\t\tappId,\n\t\t});\n\n\t\tif ('url' in result) {\n\t\t\treturn result;\n\t\t}\n\t\tthrow new Error('Failed to build App Request external url');\n\t}\n\n\tpublic async buildIncompatibleExternalUrl(appId: string, appVersion: string, action: string): Promise<IAppExternalURL> {\n\t\tconst result = await sdk.rest.get('/apps/incompatibleModal', {\n\t\t\tappId,\n\t\t\tappVersion,\n\t\t\taction,\n\t\t});\n\n\t\tif ('url' in result) {\n\t\t\treturn result;\n\t\t}\n\n\t\tthrow new Error('Failed to build external url');\n\t}\n\n\tpublic async getCategories(): Promise<Serialized<ICategory[]>> {\n\t\tconst result = await sdk.rest.get('/apps/categories');\n\n\t\tif (Array.isArray(result)) {\n\t\t\t// TODO: chapter day: multiple results are returned, but we only need one\n\t\t\treturn result as Serialized<ICategory>[];\n\t\t}\n\t\tthrow new Error('Failed to get categories');\n\t}\n}\n\nexport const AppClientOrchestratorInstance = new AppClientOrchestrator();\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/apps/orchestrator.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/apps/orchestrator.ts","inputSourceMap":{"version":3,"file":"client/apps/orchestrator.ts","sourceRoot":"","sources":["client/apps/orchestrator.ts"],"names":[],"mappings":"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","sourcesContent":["import { AppClientManager } from '@rocket.chat/apps-engine/client/AppClientManager';\nimport type { AppsEngineUIHost } from '@rocket.chat/apps-engine/client/AppsEngineUIHost';\nimport type { IPermission } from '@rocket.chat/apps-engine/definition/permissions/IPermission';\nimport type { ISetting } from '@rocket.chat/apps-engine/definition/settings';\nimport type { Serialized } from '@rocket.chat/core-typings';\n\nimport { hasAtLeastOnePermission } from '../../app/authorization/client';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { dispatchToastMessage } from '../lib/toast';\nimport type { App } from '../views/marketplace/types';\nimport type { IAppExternalURL, ICategory } from './@types/IOrchestrator';\nimport { RealAppsEngineUIHost } from './RealAppsEngineUIHost';\n\nconst isErrorObject = (e: unknown): e is { error: string } =>\n\ttypeof e === 'object' && e !== null && 'error' in e && typeof e.error === 'string';\n\nclass AppClientOrchestrator {\n\tprivate _appClientUIHost: AppsEngineUIHost;\n\n\tprivate _manager: AppClientManager;\n\n\tprivate _isLoaded: boolean;\n\n\tconstructor() {\n\t\tthis._appClientUIHost = new RealAppsEngineUIHost();\n\t\tthis._manager = new AppClientManager(this._appClientUIHost);\n\t\tthis._isLoaded = false;\n\t}\n\n\tpublic async load(): Promise<void> {\n\t\tif (!this._isLoaded) {\n\t\t\tthis._isLoaded = true;\n\t\t}\n\t}\n\n\tpublic getAppClientManager(): AppClientManager {\n\t\treturn this._manager;\n\t}\n\n\tpublic handleError(error: unknown): void {\n\t\tif (hasAtLeastOnePermission(['manage-apps'])) {\n\t\t\tdispatchToastMessage({\n\t\t\t\ttype: 'error',\n\t\t\t\tmessage: error,\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic async getInstalledApps(): Promise<App[]> {\n\t\tconst result = await sdk.rest.get<'/apps/installed'>('/apps/installed');\n\n\t\tif ('apps' in result) {\n\t\t\t// TODO: chapter day: multiple results are returned, but we only need one\n\t\t\treturn result.apps as App[];\n\t\t}\n\t\tthrow new Error('Invalid response from API');\n\t}\n\n\tpublic async getAppsFromMarketplace(isAdminUser?: boolean): Promise<{ apps: App[]; error?: unknown }> {\n\t\tlet result: App[] = [];\n\t\ttry {\n\t\t\tresult = await sdk.rest.get('/apps/marketplace', { isAdminUser: isAdminUser ? isAdminUser.toString() : 'false' });\n\t\t} catch (e) {\n\t\t\tif (isErrorObject(e)) {\n\t\t\t\treturn { apps: [], error: e.error };\n\t\t\t}\n\t\t\tif (typeof e === 'string') {\n\t\t\t\treturn { apps: [], error: e };\n\t\t\t}\n\t\t}\n\n\t\tif (!Array.isArray(result)) {\n\t\t\t// TODO: chapter day: multiple results are returned, but we only need one\n\t\t\treturn { apps: [], error: 'Invalid response from API' };\n\t\t}\n\n\t\tconst apps = (result as App[]).map((app: App) => {\n\t\t\tconst { latest, appRequestStats, price, pricingPlans, purchaseType, isEnterpriseOnly, modifiedAt, bundledIn, requestedEndUser } = app;\n\t\t\treturn {\n\t\t\t\t...latest,\n\t\t\t\tappRequestStats,\n\t\t\t\tprice,\n\t\t\t\tpricingPlans,\n\t\t\t\tpurchaseType,\n\t\t\t\tisEnterpriseOnly,\n\t\t\t\tmodifiedAt,\n\t\t\t\tbundledIn,\n\t\t\t\trequestedEndUser,\n\t\t\t};\n\t\t});\n\n\t\treturn { apps, error: undefined };\n\t}\n\n\tpublic async getAppsOnBundle(bundleId: string): Promise<App[]> {\n\t\tconst { apps } = await sdk.rest.get(`/apps/bundles/${bundleId}/apps`);\n\t\treturn apps;\n\t}\n\n\tpublic async getApp(appId: string): Promise<App> {\n\t\tconst { app } = await sdk.rest.get(`/apps/${appId}` as any);\n\t\treturn app;\n\t}\n\n\tpublic async setAppSettings(appId: string, settings: ISetting[]): Promise<void> {\n\t\tawait sdk.rest.post(`/apps/${appId}/settings`, { settings });\n\t}\n\n\tpublic async installApp(appId: string, version: string, permissionsGranted?: IPermission[]): Promise<App> {\n\t\tconst { app } = (await sdk.rest.post<'/apps'>('/apps', {\n\t\t\tappId,\n\t\t\tmarketplace: true,\n\t\t\tversion,\n\t\t\tpermissionsGranted,\n\t\t})) as { app: App };\n\t\treturn app;\n\t}\n\n\tpublic async updateApp(appId: string, version: string, permissionsGranted?: IPermission[]): Promise<App> {\n\t\tconst result = await sdk.rest.post<'/apps/:id'>(`/apps/${appId}`, {\n\t\t\tappId,\n\t\t\tmarketplace: true,\n\t\t\tversion,\n\t\t\tpermissionsGranted,\n\t\t});\n\n\t\tif ('app' in result) {\n\t\t\treturn result.app;\n\t\t}\n\t\tthrow new Error('App not found');\n\t}\n\n\tpublic async buildExternalUrl(appId: string, purchaseType: 'buy' | 'subscription' = 'buy', details = false): Promise<IAppExternalURL> {\n\t\tconst result = await sdk.rest.get('/apps/buildExternalUrl', {\n\t\t\tappId,\n\t\t\tpurchaseType,\n\t\t\tdetails: `${details}`,\n\t\t});\n\n\t\tif ('url' in result) {\n\t\t\treturn result;\n\t\t}\n\n\t\tthrow new Error('Failed to build external url');\n\t}\n\n\tpublic async buildExternalAppRequest(appId: string) {\n\t\tconst result = await sdk.rest.get('/apps/buildExternalAppRequest', {\n\t\t\tappId,\n\t\t});\n\n\t\tif ('url' in result) {\n\t\t\treturn result;\n\t\t}\n\t\tthrow new Error('Failed to build App Request external url');\n\t}\n\n\tpublic async buildIncompatibleExternalUrl(appId: string, appVersion: string, action: string): Promise<IAppExternalURL> {\n\t\tconst result = await sdk.rest.get('/apps/incompatibleModal', {\n\t\t\tappId,\n\t\t\tappVersion,\n\t\t\taction,\n\t\t});\n\n\t\tif ('url' in result) {\n\t\t\treturn result;\n\t\t}\n\n\t\tthrow new Error('Failed to build external url');\n\t}\n\n\tpublic async getCategories(): Promise<Serialized<ICategory[]>> {\n\t\tconst result = await sdk.rest.get('/apps/categories');\n\n\t\tif (Array.isArray(result)) {\n\t\t\t// TODO: chapter day: multiple results are returned, but we only need one\n\t\t\treturn result as Serialized<ICategory>[];\n\t\t}\n\t\tthrow new Error('Failed to get categories');\n\t}\n}\n\nexport const AppClientOrchestratorInstance = new AppClientOrchestrator();\n"]}}},"code":"var _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nvar _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 1);\nvar _typeof;\nmodule.link(\"@babel/runtime/helpers/typeof\", {\n  default: function (v) {\n    _typeof = v;\n  }\n}, 2);\nmodule.export({\n  AppClientOrchestratorInstance: function () {\n    return AppClientOrchestratorInstance;\n  }\n});\nvar AppClientManager;\nmodule.link(\"@rocket.chat/apps-engine/client/AppClientManager\", {\n  AppClientManager: function (v) {\n    AppClientManager = v;\n  }\n}, 0);\nvar hasAtLeastOnePermission;\nmodule.link(\"../../app/authorization/client\", {\n  hasAtLeastOnePermission: function (v) {\n    hasAtLeastOnePermission = v;\n  }\n}, 1);\nvar sdk;\nmodule.link(\"../../app/utils/client/lib/SDKClient\", {\n  sdk: function (v) {\n    sdk = v;\n  }\n}, 2);\nvar dispatchToastMessage;\nmodule.link(\"../lib/toast\", {\n  dispatchToastMessage: function (v) {\n    dispatchToastMessage = v;\n  }\n}, 3);\nvar RealAppsEngineUIHost;\nmodule.link(\"./RealAppsEngineUIHost\", {\n  RealAppsEngineUIHost: function (v) {\n    RealAppsEngineUIHost = v;\n  }\n}, 4);\nvar isErrorObject = function (e) {\n  return _typeof(e) === 'object' && e !== null && 'error' in e && typeof e.error === 'string';\n};\nvar AppClientOrchestrator = /*#__PURE__*/function () {\n  function AppClientOrchestrator() {\n    this._appClientUIHost = void 0;\n    this._manager = void 0;\n    this._isLoaded = void 0;\n    this._appClientUIHost = new RealAppsEngineUIHost();\n    this._manager = new AppClientManager(this._appClientUIHost);\n    this._isLoaded = false;\n  }\n  var _proto = AppClientOrchestrator.prototype;\n  _proto.load = function () {\n    function load() {\n      return _regeneratorRuntime.async(function () {\n        function load$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (!this._isLoaded) {\n                this._isLoaded = true;\n              }\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n        return load$;\n      }(), null, this, null, Promise);\n    }\n    return load;\n  }();\n  _proto.getAppClientManager = function () {\n    function getAppClientManager() {\n      return this._manager;\n    }\n    return getAppClientManager;\n  }();\n  _proto.handleError = function () {\n    function handleError(error) {\n      if (hasAtLeastOnePermission(['manage-apps'])) {\n        dispatchToastMessage({\n          type: 'error',\n          message: error\n        });\n      }\n    }\n    return handleError;\n  }();\n  _proto.getInstalledApps = function () {\n    function getInstalledApps() {\n      var result;\n      return _regeneratorRuntime.async(function () {\n        function getInstalledApps$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(sdk.rest.get('/apps/installed'));\n            case 2:\n              result = _context2.sent;\n              if (!('apps' in result)) {\n                _context2.next = 5;\n                break;\n              }\n              return _context2.abrupt(\"return\", result.apps);\n            case 5:\n              throw new Error('Invalid response from API');\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n        return getInstalledApps$;\n      }(), null, null, null, Promise);\n    }\n    return getInstalledApps;\n  }();\n  _proto.getAppsFromMarketplace = function () {\n    function getAppsFromMarketplace(isAdminUser) {\n      var result, apps;\n      return _regeneratorRuntime.async(function () {\n        function getAppsFromMarketplace$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              result = [];\n              _context3.prev = 1;\n              _context3.next = 4;\n              return _regeneratorRuntime.awrap(sdk.rest.get('/apps/marketplace', {\n                isAdminUser: isAdminUser ? isAdminUser.toString() : 'false'\n              }));\n            case 4:\n              result = _context3.sent;\n              _context3.next = 13;\n              break;\n            case 7:\n              _context3.prev = 7;\n              _context3.t0 = _context3[\"catch\"](1);\n              if (!isErrorObject(_context3.t0)) {\n                _context3.next = 11;\n                break;\n              }\n              return _context3.abrupt(\"return\", {\n                apps: [],\n                error: _context3.t0.error\n              });\n            case 11:\n              if (!(typeof _context3.t0 === 'string')) {\n                _context3.next = 13;\n                break;\n              }\n              return _context3.abrupt(\"return\", {\n                apps: [],\n                error: _context3.t0\n              });\n            case 13:\n              if (Array.isArray(result)) {\n                _context3.next = 15;\n                break;\n              }\n              return _context3.abrupt(\"return\", {\n                apps: [],\n                error: 'Invalid response from API'\n              });\n            case 15:\n              apps = result.map(function (app) {\n                var latest = app.latest,\n                  appRequestStats = app.appRequestStats,\n                  price = app.price,\n                  pricingPlans = app.pricingPlans,\n                  purchaseType = app.purchaseType,\n                  isEnterpriseOnly = app.isEnterpriseOnly,\n                  modifiedAt = app.modifiedAt,\n                  bundledIn = app.bundledIn,\n                  requestedEndUser = app.requestedEndUser;\n                return _objectSpread(_objectSpread({}, latest), {}, {\n                  appRequestStats: appRequestStats,\n                  price: price,\n                  pricingPlans: pricingPlans,\n                  purchaseType: purchaseType,\n                  isEnterpriseOnly: isEnterpriseOnly,\n                  modifiedAt: modifiedAt,\n                  bundledIn: bundledIn,\n                  requestedEndUser: requestedEndUser\n                });\n              });\n              return _context3.abrupt(\"return\", {\n                apps: apps,\n                error: undefined\n              });\n            case 17:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n        return getAppsFromMarketplace$;\n      }(), null, null, [[1, 7]], Promise);\n    }\n    return getAppsFromMarketplace;\n  }();\n  _proto.getAppsOnBundle = function () {\n    function getAppsOnBundle(bundleId) {\n      var _await$sdk$rest$get, apps;\n      return _regeneratorRuntime.async(function () {\n        function getAppsOnBundle$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return _regeneratorRuntime.awrap(sdk.rest.get(\"/apps/bundles/\" + bundleId + \"/apps\"));\n            case 2:\n              _await$sdk$rest$get = _context4.sent;\n              apps = _await$sdk$rest$get.apps;\n              return _context4.abrupt(\"return\", apps);\n            case 5:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n        return getAppsOnBundle$;\n      }(), null, null, null, Promise);\n    }\n    return getAppsOnBundle;\n  }();\n  _proto.getApp = function () {\n    function getApp(appId) {\n      var _await$sdk$rest$get2, app;\n      return _regeneratorRuntime.async(function () {\n        function getApp$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _regeneratorRuntime.awrap(sdk.rest.get(\"/apps/\" + appId));\n            case 2:\n              _await$sdk$rest$get2 = _context5.sent;\n              app = _await$sdk$rest$get2.app;\n              return _context5.abrupt(\"return\", app);\n            case 5:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n        return getApp$;\n      }(), null, null, null, Promise);\n    }\n    return getApp;\n  }();\n  _proto.setAppSettings = function () {\n    function setAppSettings(appId, settings) {\n      return _regeneratorRuntime.async(function () {\n        function setAppSettings$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return _regeneratorRuntime.awrap(sdk.rest.post(\"/apps/\" + appId + \"/settings\", {\n                settings: settings\n              }));\n            case 2:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n        return setAppSettings$;\n      }(), null, null, null, Promise);\n    }\n    return setAppSettings;\n  }();\n  _proto.installApp = function () {\n    function installApp(appId, version, permissionsGranted) {\n      var _await$sdk$rest$post, app;\n      return _regeneratorRuntime.async(function () {\n        function installApp$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.next = 2;\n              return _regeneratorRuntime.awrap(sdk.rest.post('/apps', {\n                appId: appId,\n                marketplace: true,\n                version: version,\n                permissionsGranted: permissionsGranted\n              }));\n            case 2:\n              _await$sdk$rest$post = _context7.sent;\n              app = _await$sdk$rest$post.app;\n              return _context7.abrupt(\"return\", app);\n            case 5:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n        return installApp$;\n      }(), null, null, null, Promise);\n    }\n    return installApp;\n  }();\n  _proto.updateApp = function () {\n    function updateApp(appId, version, permissionsGranted) {\n      var result;\n      return _regeneratorRuntime.async(function () {\n        function updateApp$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              _context8.next = 2;\n              return _regeneratorRuntime.awrap(sdk.rest.post(\"/apps/\" + appId, {\n                appId: appId,\n                marketplace: true,\n                version: version,\n                permissionsGranted: permissionsGranted\n              }));\n            case 2:\n              result = _context8.sent;\n              if (!('app' in result)) {\n                _context8.next = 5;\n                break;\n              }\n              return _context8.abrupt(\"return\", result.app);\n            case 5:\n              throw new Error('App not found');\n            case 6:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n        return updateApp$;\n      }(), null, null, null, Promise);\n    }\n    return updateApp;\n  }();\n  _proto.buildExternalUrl = function () {\n    function buildExternalUrl(appId) {\n      var purchaseType,\n        details,\n        result,\n        _args9 = arguments;\n      return _regeneratorRuntime.async(function () {\n        function buildExternalUrl$(_context9) {\n          while (1) switch (_context9.prev = _context9.next) {\n            case 0:\n              purchaseType = _args9.length > 1 && _args9[1] !== undefined ? _args9[1] : 'buy';\n              details = _args9.length > 2 && _args9[2] !== undefined ? _args9[2] : false;\n              _context9.next = 4;\n              return _regeneratorRuntime.awrap(sdk.rest.get('/apps/buildExternalUrl', {\n                appId: appId,\n                purchaseType: purchaseType,\n                details: \"\" + details\n              }));\n            case 4:\n              result = _context9.sent;\n              if (!('url' in result)) {\n                _context9.next = 7;\n                break;\n              }\n              return _context9.abrupt(\"return\", result);\n            case 7:\n              throw new Error('Failed to build external url');\n            case 8:\n            case \"end\":\n              return _context9.stop();\n          }\n        }\n        return buildExternalUrl$;\n      }(), null, null, null, Promise);\n    }\n    return buildExternalUrl;\n  }();\n  _proto.buildExternalAppRequest = function () {\n    function buildExternalAppRequest(appId) {\n      var result;\n      return _regeneratorRuntime.async(function () {\n        function buildExternalAppRequest$(_context10) {\n          while (1) switch (_context10.prev = _context10.next) {\n            case 0:\n              _context10.next = 2;\n              return _regeneratorRuntime.awrap(sdk.rest.get('/apps/buildExternalAppRequest', {\n                appId: appId\n              }));\n            case 2:\n              result = _context10.sent;\n              if (!('url' in result)) {\n                _context10.next = 5;\n                break;\n              }\n              return _context10.abrupt(\"return\", result);\n            case 5:\n              throw new Error('Failed to build App Request external url');\n            case 6:\n            case \"end\":\n              return _context10.stop();\n          }\n        }\n        return buildExternalAppRequest$;\n      }(), null, null, null, Promise);\n    }\n    return buildExternalAppRequest;\n  }();\n  _proto.buildIncompatibleExternalUrl = function () {\n    function buildIncompatibleExternalUrl(appId, appVersion, action) {\n      var result;\n      return _regeneratorRuntime.async(function () {\n        function buildIncompatibleExternalUrl$(_context11) {\n          while (1) switch (_context11.prev = _context11.next) {\n            case 0:\n              _context11.next = 2;\n              return _regeneratorRuntime.awrap(sdk.rest.get('/apps/incompatibleModal', {\n                appId: appId,\n                appVersion: appVersion,\n                action: action\n              }));\n            case 2:\n              result = _context11.sent;\n              if (!('url' in result)) {\n                _context11.next = 5;\n                break;\n              }\n              return _context11.abrupt(\"return\", result);\n            case 5:\n              throw new Error('Failed to build external url');\n            case 6:\n            case \"end\":\n              return _context11.stop();\n          }\n        }\n        return buildIncompatibleExternalUrl$;\n      }(), null, null, null, Promise);\n    }\n    return buildIncompatibleExternalUrl;\n  }();\n  _proto.getCategories = function () {\n    function getCategories() {\n      var result;\n      return _regeneratorRuntime.async(function () {\n        function getCategories$(_context12) {\n          while (1) switch (_context12.prev = _context12.next) {\n            case 0:\n              _context12.next = 2;\n              return _regeneratorRuntime.awrap(sdk.rest.get('/apps/categories'));\n            case 2:\n              result = _context12.sent;\n              if (!Array.isArray(result)) {\n                _context12.next = 5;\n                break;\n              }\n              return _context12.abrupt(\"return\", result);\n            case 5:\n              throw new Error('Failed to get categories');\n            case 6:\n            case \"end\":\n              return _context12.stop();\n          }\n        }\n        return getCategories$;\n      }(), null, null, null, Promise);\n    }\n    return getCategories;\n  }();\n  return AppClientOrchestrator;\n}();\nvar AppClientOrchestratorInstance = new AppClientOrchestrator();","map":{"version":3,"names":["_regeneratorRuntime","module","link","default","v","_objectSpread","_typeof","export","AppClientOrchestratorInstance","AppClientManager","hasAtLeastOnePermission","sdk","dispatchToastMessage","RealAppsEngineUIHost","isErrorObject","e","error","AppClientOrchestrator","_appClientUIHost","_manager","_isLoaded","_proto","prototype","load","async","load$","_context","prev","next","stop","Promise","getAppClientManager","handleError","type","message","getInstalledApps","result","getInstalledApps$","_context2","awrap","rest","get","sent","abrupt","apps","Error","getAppsFromMarketplace","isAdminUser","getAppsFromMarketplace$","_context3","toString","t0","Array","isArray","map","app","latest","appRequestStats","price","pricingPlans","purchaseType","isEnterpriseOnly","modifiedAt","bundledIn","requestedEndUser","undefined","getAppsOnBundle","bundleId","_await$sdk$rest$get","getAppsOnBundle$","_context4","getApp","appId","_await$sdk$rest$get2","getApp$","_context5","setAppSettings","settings","setAppSettings$","_context6","post","installApp","version","permissionsGranted","_await$sdk$rest$post","installApp$","_context7","marketplace","updateApp","updateApp$","_context8","buildExternalUrl","details","_args9","arguments","buildExternalUrl$","_context9","length","buildExternalAppRequest","buildExternalAppRequest$","_context10","buildIncompatibleExternalUrl","appVersion","action","buildIncompatibleExternalUrl$","_context11","getCategories","getCategories$","_context12"],"sources":["client/apps/orchestrator.ts"],"sourcesContent":["import { AppClientManager } from '@rocket.chat/apps-engine/client/AppClientManager';\nimport type { AppsEngineUIHost } from '@rocket.chat/apps-engine/client/AppsEngineUIHost';\nimport type { IPermission } from '@rocket.chat/apps-engine/definition/permissions/IPermission';\nimport type { ISetting } from '@rocket.chat/apps-engine/definition/settings';\nimport type { Serialized } from '@rocket.chat/core-typings';\n\nimport { hasAtLeastOnePermission } from '../../app/authorization/client';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { dispatchToastMessage } from '../lib/toast';\nimport type { App } from '../views/marketplace/types';\nimport type { IAppExternalURL, ICategory } from './@types/IOrchestrator';\nimport { RealAppsEngineUIHost } from './RealAppsEngineUIHost';\n\nconst isErrorObject = (e: unknown): e is { error: string } =>\n\ttypeof e === 'object' && e !== null && 'error' in e && typeof e.error === 'string';\n\nclass AppClientOrchestrator {\n\tprivate _appClientUIHost: AppsEngineUIHost;\n\n\tprivate _manager: AppClientManager;\n\n\tprivate _isLoaded: boolean;\n\n\tconstructor() {\n\t\tthis._appClientUIHost = new RealAppsEngineUIHost();\n\t\tthis._manager = new AppClientManager(this._appClientUIHost);\n\t\tthis._isLoaded = false;\n\t}\n\n\tpublic async load(): Promise<void> {\n\t\tif (!this._isLoaded) {\n\t\t\tthis._isLoaded = true;\n\t\t}\n\t}\n\n\tpublic getAppClientManager(): AppClientManager {\n\t\treturn this._manager;\n\t}\n\n\tpublic handleError(error: unknown): void {\n\t\tif (hasAtLeastOnePermission(['manage-apps'])) {\n\t\t\tdispatchToastMessage({\n\t\t\t\ttype: 'error',\n\t\t\t\tmessage: error,\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic async getInstalledApps(): Promise<App[]> {\n\t\tconst result = await sdk.rest.get<'/apps/installed'>('/apps/installed');\n\n\t\tif ('apps' in result) {\n\t\t\t// TODO: chapter day: multiple results are returned, but we only need one\n\t\t\treturn result.apps as App[];\n\t\t}\n\t\tthrow new Error('Invalid response from API');\n\t}\n\n\tpublic async getAppsFromMarketplace(isAdminUser?: boolean): Promise<{ apps: App[]; error?: unknown }> {\n\t\tlet result: App[] = [];\n\t\ttry {\n\t\t\tresult = await sdk.rest.get('/apps/marketplace', { isAdminUser: isAdminUser ? isAdminUser.toString() : 'false' });\n\t\t} catch (e) {\n\t\t\tif (isErrorObject(e)) {\n\t\t\t\treturn { apps: [], error: e.error };\n\t\t\t}\n\t\t\tif (typeof e === 'string') {\n\t\t\t\treturn { apps: [], error: e };\n\t\t\t}\n\t\t}\n\n\t\tif (!Array.isArray(result)) {\n\t\t\t// TODO: chapter day: multiple results are returned, but we only need one\n\t\t\treturn { apps: [], error: 'Invalid response from API' };\n\t\t}\n\n\t\tconst apps = (result as App[]).map((app: App) => {\n\t\t\tconst { latest, appRequestStats, price, pricingPlans, purchaseType, isEnterpriseOnly, modifiedAt, bundledIn, requestedEndUser } = app;\n\t\t\treturn {\n\t\t\t\t...latest,\n\t\t\t\tappRequestStats,\n\t\t\t\tprice,\n\t\t\t\tpricingPlans,\n\t\t\t\tpurchaseType,\n\t\t\t\tisEnterpriseOnly,\n\t\t\t\tmodifiedAt,\n\t\t\t\tbundledIn,\n\t\t\t\trequestedEndUser,\n\t\t\t};\n\t\t});\n\n\t\treturn { apps, error: undefined };\n\t}\n\n\tpublic async getAppsOnBundle(bundleId: string): Promise<App[]> {\n\t\tconst { apps } = await sdk.rest.get(`/apps/bundles/${bundleId}/apps`);\n\t\treturn apps;\n\t}\n\n\tpublic async getApp(appId: string): Promise<App> {\n\t\tconst { app } = await sdk.rest.get(`/apps/${appId}` as any);\n\t\treturn app;\n\t}\n\n\tpublic async setAppSettings(appId: string, settings: ISetting[]): Promise<void> {\n\t\tawait sdk.rest.post(`/apps/${appId}/settings`, { settings });\n\t}\n\n\tpublic async installApp(appId: string, version: string, permissionsGranted?: IPermission[]): Promise<App> {\n\t\tconst { app } = (await sdk.rest.post<'/apps'>('/apps', {\n\t\t\tappId,\n\t\t\tmarketplace: true,\n\t\t\tversion,\n\t\t\tpermissionsGranted,\n\t\t})) as { app: App };\n\t\treturn app;\n\t}\n\n\tpublic async updateApp(appId: string, version: string, permissionsGranted?: IPermission[]): Promise<App> {\n\t\tconst result = await sdk.rest.post<'/apps/:id'>(`/apps/${appId}`, {\n\t\t\tappId,\n\t\t\tmarketplace: true,\n\t\t\tversion,\n\t\t\tpermissionsGranted,\n\t\t});\n\n\t\tif ('app' in result) {\n\t\t\treturn result.app;\n\t\t}\n\t\tthrow new Error('App not found');\n\t}\n\n\tpublic async buildExternalUrl(appId: string, purchaseType: 'buy' | 'subscription' = 'buy', details = false): Promise<IAppExternalURL> {\n\t\tconst result = await sdk.rest.get('/apps/buildExternalUrl', {\n\t\t\tappId,\n\t\t\tpurchaseType,\n\t\t\tdetails: `${details}`,\n\t\t});\n\n\t\tif ('url' in result) {\n\t\t\treturn result;\n\t\t}\n\n\t\tthrow new Error('Failed to build external url');\n\t}\n\n\tpublic async buildExternalAppRequest(appId: string) {\n\t\tconst result = await sdk.rest.get('/apps/buildExternalAppRequest', {\n\t\t\tappId,\n\t\t});\n\n\t\tif ('url' in result) {\n\t\t\treturn result;\n\t\t}\n\t\tthrow new Error('Failed to build App Request external url');\n\t}\n\n\tpublic async buildIncompatibleExternalUrl(appId: string, appVersion: string, action: string): Promise<IAppExternalURL> {\n\t\tconst result = await sdk.rest.get('/apps/incompatibleModal', {\n\t\t\tappId,\n\t\t\tappVersion,\n\t\t\taction,\n\t\t});\n\n\t\tif ('url' in result) {\n\t\t\treturn result;\n\t\t}\n\n\t\tthrow new Error('Failed to build external url');\n\t}\n\n\tpublic async getCategories(): Promise<Serialized<ICategory[]>> {\n\t\tconst result = await sdk.rest.get('/apps/categories');\n\n\t\tif (Array.isArray(result)) {\n\t\t\t// TODO: chapter day: multiple results are returned, but we only need one\n\t\t\treturn result as Serialized<ICategory>[];\n\t\t}\n\t\tthrow new Error('Failed to get categories');\n\t}\n}\n\nexport const AppClientOrchestratorInstance = new AppClientOrchestrator();\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"0865205da89c6df06499c8edad27a38e091c3e4d"}
