{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/apps/communication/websockets.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"ee/server/apps/communication/websockets.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/apps/communication/websockets.ts","inputSourceMap":{"version":3,"file":"ee/server/apps/communication/websockets.ts","sourceRoot":"","sources":["ee/server/apps/communication/websockets.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport { AppStatusUtils } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport type { ISetting as AppsSetting } from '@rocket.chat/apps-engine/definition/settings';\nimport { api } from '@rocket.chat/core-services';\nimport type { IStreamer } from 'meteor/rocketchat:streamer';\n\nimport notifications from '../../../../app/notifications/server/lib/Notifications';\nimport { SystemLogger } from '../../../../server/lib/logger/system';\nimport type { AppServerOrchestrator } from '../orchestrator';\nimport { AppEvents } from './events';\n\nexport { AppEvents };\nexport class AppServerListener {\n\tprivate orch: AppServerOrchestrator;\n\n\tengineStreamer: IStreamer<'apps-engine'>;\n\n\tclientStreamer: IStreamer<'apps'>;\n\n\treceived;\n\n\tconstructor(\n\t\torch: AppServerOrchestrator,\n\t\tengineStreamer: IStreamer<'apps-engine'>,\n\t\tclientStreamer: IStreamer<'apps'>,\n\t\treceived: Map<any, any>,\n\t) {\n\t\tthis.orch = orch;\n\t\tthis.engineStreamer = engineStreamer;\n\t\tthis.clientStreamer = clientStreamer;\n\t\tthis.received = received;\n\n\t\tthis.engineStreamer.on(AppEvents.APP_STATUS_CHANGE, this.onAppStatusUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.APP_REMOVED, this.onAppRemoved.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.APP_UPDATED, this.onAppUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.APP_ADDED, this.onAppAdded.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.ACTIONS_CHANGED, this.onActionsChanged.bind(this));\n\n\t\tthis.engineStreamer.on(AppEvents.APP_SETTING_UPDATED, this.onAppSettingUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_ADDED, this.onCommandAdded.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_DISABLED, this.onCommandDisabled.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_UPDATED, this.onCommandUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_REMOVED, this.onCommandRemoved.bind(this));\n\t}\n\n\tasync onAppAdded(appId: string): Promise<void> {\n\t\tawait (this.orch.getManager()! as any).addLocal(appId); // TO-DO: fix type\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_ADDED, appId);\n\t}\n\n\tasync onAppStatusUpdated({ appId, status }: { appId: string; status: AppStatus }): Promise<void> {\n\t\tconst app = this.orch.getManager()?.getOneById(appId);\n\n\t\tif (!app || (await app.getStatus()) === status) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.received.set(`${AppEvents.APP_STATUS_CHANGE}_${appId}`, {\n\t\t\tappId,\n\t\t\tstatus,\n\t\t\twhen: new Date(),\n\t\t});\n\n\t\tif (AppStatusUtils.isEnabled(status)) {\n\t\t\tawait this.orch.getManager()?.enable(appId).catch(SystemLogger.error);\n\t\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_STATUS_CHANGE, { appId, status });\n\t\t} else if (AppStatusUtils.isDisabled(status)) {\n\t\t\tawait this.orch.getManager()?.disable(appId, status, true).catch(SystemLogger.error);\n\t\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_STATUS_CHANGE, { appId, status });\n\t\t}\n\t}\n\n\tasync onAppSettingUpdated({ appId, setting }: { appId: string; setting: AppsSetting }): Promise<void> {\n\t\tthis.received.set(`${AppEvents.APP_SETTING_UPDATED}_${appId}_${setting.id}`, {\n\t\t\tappId,\n\t\t\tsetting,\n\t\t\twhen: new Date(),\n\t\t});\n\n\t\tawait this.orch\n\t\t\t.getManager()!\n\t\t\t.getSettingsManager()\n\t\t\t.updateAppSetting(appId, setting as any); // TO-DO: fix type of `setting`\n\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_SETTING_UPDATED, { appId, setting });\n\t}\n\n\tasync onAppUpdated(appId: string): Promise<void> {\n\t\tthis.received.set(`${AppEvents.APP_UPDATED}_${appId}`, { appId, when: new Date() });\n\n\t\tconst storageItem = await this.orch.getStorage()!.retrieveOne(appId);\n\n\t\tconst appPackage = await this.orch.getAppSourceStorage()!.fetch(storageItem);\n\n\t\tconst isEnabled = AppStatusUtils.isEnabled(storageItem.status);\n\t\tif (isEnabled) {\n\t\t\tawait this.orch.getManager()!.updateAndStartupLocal(storageItem, appPackage);\n\t\t} else {\n\t\t\tawait this.orch.getManager()!.updateAndInitializeLocal(storageItem, appPackage);\n\t\t}\n\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_UPDATED, appId);\n\t}\n\n\tasync onAppRemoved(appId: string): Promise<void> {\n\t\tconst app = this.orch.getManager()!.getOneById(appId);\n\n\t\tif (!app) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.orch.getManager()!.removeLocal(appId);\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_REMOVED, appId);\n\t}\n\n\tasync onCommandAdded(command: string): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_ADDED, command);\n\t}\n\n\tasync onCommandDisabled(command: string): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_DISABLED, command);\n\t}\n\n\tasync onCommandUpdated(command: string): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_UPDATED, command);\n\t}\n\n\tasync onCommandRemoved(command: string): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_REMOVED, command);\n\t}\n\n\tasync onActionsChanged(): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.ACTIONS_CHANGED);\n\t}\n}\n\nexport class AppServerNotifier {\n\tengineStreamer: IStreamer<'apps-engine'>;\n\n\tclientStreamer: IStreamer<'apps'>;\n\n\treceived: Map<any, any>;\n\n\tlistener: AppServerListener;\n\n\tconstructor(orch: AppServerOrchestrator) {\n\t\tthis.engineStreamer = notifications.streamAppsEngine;\n\n\t\t// This is used to broadcast to the web clients\n\t\tthis.clientStreamer = notifications.streamApps;\n\n\t\tthis.received = new Map();\n\t\tthis.listener = new AppServerListener(orch, this.engineStreamer, this.clientStreamer, this.received);\n\t}\n\n\tasync appAdded(appId: string): Promise<void> {\n\t\tvoid api.broadcast('apps.added', appId);\n\t}\n\n\tasync appRemoved(appId: string): Promise<void> {\n\t\tvoid api.broadcast('apps.removed', appId);\n\t}\n\n\tasync appUpdated(appId: string): Promise<void> {\n\t\tif (this.received.has(`${AppEvents.APP_UPDATED}_${appId}`)) {\n\t\t\tthis.received.delete(`${AppEvents.APP_UPDATED}_${appId}`);\n\t\t\treturn;\n\t\t}\n\n\t\tvoid api.broadcast('apps.updated', appId);\n\t}\n\n\tasync appStatusUpdated(appId: string, status: AppStatus): Promise<void> {\n\t\tif (this.received.has(`${AppEvents.APP_STATUS_CHANGE}_${appId}`)) {\n\t\t\tconst details = this.received.get(`${AppEvents.APP_STATUS_CHANGE}_${appId}`);\n\t\t\tif (details.status === status) {\n\t\t\t\tthis.received.delete(`${AppEvents.APP_STATUS_CHANGE}_${appId}`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tvoid api.broadcast('apps.statusUpdate', appId, status);\n\t}\n\n\tasync appSettingsChange(appId: string, setting: AppsSetting): Promise<void> {\n\t\tif (this.received.has(`${AppEvents.APP_SETTING_UPDATED}_${appId}_${setting.id}`)) {\n\t\t\tthis.received.delete(`${AppEvents.APP_SETTING_UPDATED}_${appId}_${setting.id}`);\n\t\t\treturn;\n\t\t}\n\n\t\tvoid api.broadcast('apps.settingUpdated', appId, setting);\n\t}\n\n\tasync commandAdded(command: string): Promise<void> {\n\t\tvoid api.broadcast('command.added', command);\n\t}\n\n\tasync commandDisabled(command: string): Promise<void> {\n\t\tvoid api.broadcast('command.disabled', command);\n\t}\n\n\tasync commandUpdated(command: string): Promise<void> {\n\t\tvoid api.broadcast('command.updated', command);\n\t}\n\n\tasync commandRemoved(command: string): Promise<void> {\n\t\tvoid api.broadcast('command.removed', command);\n\t}\n\n\tasync actionsChanged(): Promise<void> {\n\t\tvoid api.broadcast('actions.changed');\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/apps/communication/websockets.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"ee/server/apps/communication/websockets.ts","inputSourceMap":{"version":3,"file":"ee/server/apps/communication/websockets.ts","sourceRoot":"","sources":["ee/server/apps/communication/websockets.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport { AppStatusUtils } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport type { ISetting as AppsSetting } from '@rocket.chat/apps-engine/definition/settings';\nimport { api } from '@rocket.chat/core-services';\nimport type { IStreamer } from 'meteor/rocketchat:streamer';\n\nimport notifications from '../../../../app/notifications/server/lib/Notifications';\nimport { SystemLogger } from '../../../../server/lib/logger/system';\nimport type { AppServerOrchestrator } from '../orchestrator';\nimport { AppEvents } from './events';\n\nexport { AppEvents };\nexport class AppServerListener {\n\tprivate orch: AppServerOrchestrator;\n\n\tengineStreamer: IStreamer<'apps-engine'>;\n\n\tclientStreamer: IStreamer<'apps'>;\n\n\treceived;\n\n\tconstructor(\n\t\torch: AppServerOrchestrator,\n\t\tengineStreamer: IStreamer<'apps-engine'>,\n\t\tclientStreamer: IStreamer<'apps'>,\n\t\treceived: Map<any, any>,\n\t) {\n\t\tthis.orch = orch;\n\t\tthis.engineStreamer = engineStreamer;\n\t\tthis.clientStreamer = clientStreamer;\n\t\tthis.received = received;\n\n\t\tthis.engineStreamer.on(AppEvents.APP_STATUS_CHANGE, this.onAppStatusUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.APP_REMOVED, this.onAppRemoved.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.APP_UPDATED, this.onAppUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.APP_ADDED, this.onAppAdded.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.ACTIONS_CHANGED, this.onActionsChanged.bind(this));\n\n\t\tthis.engineStreamer.on(AppEvents.APP_SETTING_UPDATED, this.onAppSettingUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_ADDED, this.onCommandAdded.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_DISABLED, this.onCommandDisabled.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_UPDATED, this.onCommandUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_REMOVED, this.onCommandRemoved.bind(this));\n\t}\n\n\tasync onAppAdded(appId: string): Promise<void> {\n\t\tawait (this.orch.getManager()! as any).addLocal(appId); // TO-DO: fix type\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_ADDED, appId);\n\t}\n\n\tasync onAppStatusUpdated({ appId, status }: { appId: string; status: AppStatus }): Promise<void> {\n\t\tconst app = this.orch.getManager()?.getOneById(appId);\n\n\t\tif (!app || (await app.getStatus()) === status) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.received.set(`${AppEvents.APP_STATUS_CHANGE}_${appId}`, {\n\t\t\tappId,\n\t\t\tstatus,\n\t\t\twhen: new Date(),\n\t\t});\n\n\t\tif (AppStatusUtils.isEnabled(status)) {\n\t\t\tawait this.orch.getManager()?.enable(appId).catch(SystemLogger.error);\n\t\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_STATUS_CHANGE, { appId, status });\n\t\t} else if (AppStatusUtils.isDisabled(status)) {\n\t\t\tawait this.orch.getManager()?.disable(appId, status, true).catch(SystemLogger.error);\n\t\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_STATUS_CHANGE, { appId, status });\n\t\t}\n\t}\n\n\tasync onAppSettingUpdated({ appId, setting }: { appId: string; setting: AppsSetting }): Promise<void> {\n\t\tthis.received.set(`${AppEvents.APP_SETTING_UPDATED}_${appId}_${setting.id}`, {\n\t\t\tappId,\n\t\t\tsetting,\n\t\t\twhen: new Date(),\n\t\t});\n\n\t\tawait this.orch\n\t\t\t.getManager()!\n\t\t\t.getSettingsManager()\n\t\t\t.updateAppSetting(appId, setting as any); // TO-DO: fix type of `setting`\n\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_SETTING_UPDATED, { appId, setting });\n\t}\n\n\tasync onAppUpdated(appId: string): Promise<void> {\n\t\tthis.received.set(`${AppEvents.APP_UPDATED}_${appId}`, { appId, when: new Date() });\n\n\t\tconst storageItem = await this.orch.getStorage()!.retrieveOne(appId);\n\n\t\tconst appPackage = await this.orch.getAppSourceStorage()!.fetch(storageItem);\n\n\t\tconst isEnabled = AppStatusUtils.isEnabled(storageItem.status);\n\t\tif (isEnabled) {\n\t\t\tawait this.orch.getManager()!.updateAndStartupLocal(storageItem, appPackage);\n\t\t} else {\n\t\t\tawait this.orch.getManager()!.updateAndInitializeLocal(storageItem, appPackage);\n\t\t}\n\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_UPDATED, appId);\n\t}\n\n\tasync onAppRemoved(appId: string): Promise<void> {\n\t\tconst app = this.orch.getManager()!.getOneById(appId);\n\n\t\tif (!app) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.orch.getManager()!.removeLocal(appId);\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_REMOVED, appId);\n\t}\n\n\tasync onCommandAdded(command: string): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_ADDED, command);\n\t}\n\n\tasync onCommandDisabled(command: string): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_DISABLED, command);\n\t}\n\n\tasync onCommandUpdated(command: string): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_UPDATED, command);\n\t}\n\n\tasync onCommandRemoved(command: string): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_REMOVED, command);\n\t}\n\n\tasync onActionsChanged(): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.ACTIONS_CHANGED);\n\t}\n}\n\nexport class AppServerNotifier {\n\tengineStreamer: IStreamer<'apps-engine'>;\n\n\tclientStreamer: IStreamer<'apps'>;\n\n\treceived: Map<any, any>;\n\n\tlistener: AppServerListener;\n\n\tconstructor(orch: AppServerOrchestrator) {\n\t\tthis.engineStreamer = notifications.streamAppsEngine;\n\n\t\t// This is used to broadcast to the web clients\n\t\tthis.clientStreamer = notifications.streamApps;\n\n\t\tthis.received = new Map();\n\t\tthis.listener = new AppServerListener(orch, this.engineStreamer, this.clientStreamer, this.received);\n\t}\n\n\tasync appAdded(appId: string): Promise<void> {\n\t\tvoid api.broadcast('apps.added', appId);\n\t}\n\n\tasync appRemoved(appId: string): Promise<void> {\n\t\tvoid api.broadcast('apps.removed', appId);\n\t}\n\n\tasync appUpdated(appId: string): Promise<void> {\n\t\tif (this.received.has(`${AppEvents.APP_UPDATED}_${appId}`)) {\n\t\t\tthis.received.delete(`${AppEvents.APP_UPDATED}_${appId}`);\n\t\t\treturn;\n\t\t}\n\n\t\tvoid api.broadcast('apps.updated', appId);\n\t}\n\n\tasync appStatusUpdated(appId: string, status: AppStatus): Promise<void> {\n\t\tif (this.received.has(`${AppEvents.APP_STATUS_CHANGE}_${appId}`)) {\n\t\t\tconst details = this.received.get(`${AppEvents.APP_STATUS_CHANGE}_${appId}`);\n\t\t\tif (details.status === status) {\n\t\t\t\tthis.received.delete(`${AppEvents.APP_STATUS_CHANGE}_${appId}`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tvoid api.broadcast('apps.statusUpdate', appId, status);\n\t}\n\n\tasync appSettingsChange(appId: string, setting: AppsSetting): Promise<void> {\n\t\tif (this.received.has(`${AppEvents.APP_SETTING_UPDATED}_${appId}_${setting.id}`)) {\n\t\t\tthis.received.delete(`${AppEvents.APP_SETTING_UPDATED}_${appId}_${setting.id}`);\n\t\t\treturn;\n\t\t}\n\n\t\tvoid api.broadcast('apps.settingUpdated', appId, setting);\n\t}\n\n\tasync commandAdded(command: string): Promise<void> {\n\t\tvoid api.broadcast('command.added', command);\n\t}\n\n\tasync commandDisabled(command: string): Promise<void> {\n\t\tvoid api.broadcast('command.disabled', command);\n\t}\n\n\tasync commandUpdated(command: string): Promise<void> {\n\t\tvoid api.broadcast('command.updated', command);\n\t}\n\n\tasync commandRemoved(command: string): Promise<void> {\n\t\tvoid api.broadcast('command.removed', command);\n\t}\n\n\tasync actionsChanged(): Promise<void> {\n\t\tvoid api.broadcast('actions.changed');\n\t}\n}\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    module.export({\n      AppEvents: () => AppEvents,\n      AppServerListener: () => AppServerListener,\n      AppServerNotifier: () => AppServerNotifier\n    });\n    let AppStatusUtils;\n    module.link(\"@rocket.chat/apps-engine/definition/AppStatus\", {\n      AppStatusUtils(v) {\n        AppStatusUtils = v;\n      }\n    }, 0);\n    let api;\n    module.link(\"@rocket.chat/core-services\", {\n      api(v) {\n        api = v;\n      }\n    }, 1);\n    let notifications;\n    module.link(\"../../../../app/notifications/server/lib/Notifications\", {\n      default(v) {\n        notifications = v;\n      }\n    }, 2);\n    let SystemLogger;\n    module.link(\"../../../../server/lib/logger/system\", {\n      SystemLogger(v) {\n        SystemLogger = v;\n      }\n    }, 3);\n    let AppEvents;\n    module.link(\"./events\", {\n      AppEvents(v) {\n        AppEvents = v;\n      }\n    }, 4);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    class AppServerListener {\n      constructor(orch, engineStreamer, clientStreamer, received) {\n        this.orch = void 0;\n        this.engineStreamer = void 0;\n        this.clientStreamer = void 0;\n        this.received = void 0;\n        this.orch = orch;\n        this.engineStreamer = engineStreamer;\n        this.clientStreamer = clientStreamer;\n        this.received = received;\n        this.engineStreamer.on(AppEvents.APP_STATUS_CHANGE, this.onAppStatusUpdated.bind(this));\n        this.engineStreamer.on(AppEvents.APP_REMOVED, this.onAppRemoved.bind(this));\n        this.engineStreamer.on(AppEvents.APP_UPDATED, this.onAppUpdated.bind(this));\n        this.engineStreamer.on(AppEvents.APP_ADDED, this.onAppAdded.bind(this));\n        this.engineStreamer.on(AppEvents.ACTIONS_CHANGED, this.onActionsChanged.bind(this));\n        this.engineStreamer.on(AppEvents.APP_SETTING_UPDATED, this.onAppSettingUpdated.bind(this));\n        this.engineStreamer.on(AppEvents.COMMAND_ADDED, this.onCommandAdded.bind(this));\n        this.engineStreamer.on(AppEvents.COMMAND_DISABLED, this.onCommandDisabled.bind(this));\n        this.engineStreamer.on(AppEvents.COMMAND_UPDATED, this.onCommandUpdated.bind(this));\n        this.engineStreamer.on(AppEvents.COMMAND_REMOVED, this.onCommandRemoved.bind(this));\n      }\n      async onAppAdded(appId) {\n        await this.orch.getManager().addLocal(appId); // TO-DO: fix type\n        this.clientStreamer.emitWithoutBroadcast(AppEvents.APP_ADDED, appId);\n      }\n      async onAppStatusUpdated(_ref) {\n        var _this$orch$getManager;\n        let {\n          appId,\n          status\n        } = _ref;\n        const app = (_this$orch$getManager = this.orch.getManager()) === null || _this$orch$getManager === void 0 ? void 0 : _this$orch$getManager.getOneById(appId);\n        if (!app || (await app.getStatus()) === status) {\n          return;\n        }\n        this.received.set(\"\".concat(AppEvents.APP_STATUS_CHANGE, \"_\").concat(appId), {\n          appId,\n          status,\n          when: new Date()\n        });\n        if (AppStatusUtils.isEnabled(status)) {\n          var _this$orch$getManager2;\n          await ((_this$orch$getManager2 = this.orch.getManager()) === null || _this$orch$getManager2 === void 0 ? void 0 : _this$orch$getManager2.enable(appId).catch(SystemLogger.error));\n          this.clientStreamer.emitWithoutBroadcast(AppEvents.APP_STATUS_CHANGE, {\n            appId,\n            status\n          });\n        } else if (AppStatusUtils.isDisabled(status)) {\n          var _this$orch$getManager3;\n          await ((_this$orch$getManager3 = this.orch.getManager()) === null || _this$orch$getManager3 === void 0 ? void 0 : _this$orch$getManager3.disable(appId, status, true).catch(SystemLogger.error));\n          this.clientStreamer.emitWithoutBroadcast(AppEvents.APP_STATUS_CHANGE, {\n            appId,\n            status\n          });\n        }\n      }\n      async onAppSettingUpdated(_ref2) {\n        let {\n          appId,\n          setting\n        } = _ref2;\n        this.received.set(\"\".concat(AppEvents.APP_SETTING_UPDATED, \"_\").concat(appId, \"_\").concat(setting.id), {\n          appId,\n          setting,\n          when: new Date()\n        });\n        await this.orch.getManager().getSettingsManager().updateAppSetting(appId, setting); // TO-DO: fix type of `setting`\n        this.clientStreamer.emitWithoutBroadcast(AppEvents.APP_SETTING_UPDATED, {\n          appId,\n          setting\n        });\n      }\n      async onAppUpdated(appId) {\n        this.received.set(\"\".concat(AppEvents.APP_UPDATED, \"_\").concat(appId), {\n          appId,\n          when: new Date()\n        });\n        const storageItem = await this.orch.getStorage().retrieveOne(appId);\n        const appPackage = await this.orch.getAppSourceStorage().fetch(storageItem);\n        const isEnabled = AppStatusUtils.isEnabled(storageItem.status);\n        if (isEnabled) {\n          await this.orch.getManager().updateAndStartupLocal(storageItem, appPackage);\n        } else {\n          await this.orch.getManager().updateAndInitializeLocal(storageItem, appPackage);\n        }\n        this.clientStreamer.emitWithoutBroadcast(AppEvents.APP_UPDATED, appId);\n      }\n      async onAppRemoved(appId) {\n        const app = this.orch.getManager().getOneById(appId);\n        if (!app) {\n          return;\n        }\n        await this.orch.getManager().removeLocal(appId);\n        this.clientStreamer.emitWithoutBroadcast(AppEvents.APP_REMOVED, appId);\n      }\n      async onCommandAdded(command) {\n        this.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_ADDED, command);\n      }\n      async onCommandDisabled(command) {\n        this.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_DISABLED, command);\n      }\n      async onCommandUpdated(command) {\n        this.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_UPDATED, command);\n      }\n      async onCommandRemoved(command) {\n        this.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_REMOVED, command);\n      }\n      async onActionsChanged() {\n        this.clientStreamer.emitWithoutBroadcast(AppEvents.ACTIONS_CHANGED);\n      }\n    }\n    class AppServerNotifier {\n      constructor(orch) {\n        this.engineStreamer = void 0;\n        this.clientStreamer = void 0;\n        this.received = void 0;\n        this.listener = void 0;\n        this.engineStreamer = notifications.streamAppsEngine;\n        // This is used to broadcast to the web clients\n        this.clientStreamer = notifications.streamApps;\n        this.received = new Map();\n        this.listener = new AppServerListener(orch, this.engineStreamer, this.clientStreamer, this.received);\n      }\n      async appAdded(appId) {\n        void api.broadcast('apps.added', appId);\n      }\n      async appRemoved(appId) {\n        void api.broadcast('apps.removed', appId);\n      }\n      async appUpdated(appId) {\n        if (this.received.has(\"\".concat(AppEvents.APP_UPDATED, \"_\").concat(appId))) {\n          this.received.delete(\"\".concat(AppEvents.APP_UPDATED, \"_\").concat(appId));\n          return;\n        }\n        void api.broadcast('apps.updated', appId);\n      }\n      async appStatusUpdated(appId, status) {\n        if (this.received.has(\"\".concat(AppEvents.APP_STATUS_CHANGE, \"_\").concat(appId))) {\n          const details = this.received.get(\"\".concat(AppEvents.APP_STATUS_CHANGE, \"_\").concat(appId));\n          if (details.status === status) {\n            this.received.delete(\"\".concat(AppEvents.APP_STATUS_CHANGE, \"_\").concat(appId));\n            return;\n          }\n        }\n        void api.broadcast('apps.statusUpdate', appId, status);\n      }\n      async appSettingsChange(appId, setting) {\n        if (this.received.has(\"\".concat(AppEvents.APP_SETTING_UPDATED, \"_\").concat(appId, \"_\").concat(setting.id))) {\n          this.received.delete(\"\".concat(AppEvents.APP_SETTING_UPDATED, \"_\").concat(appId, \"_\").concat(setting.id));\n          return;\n        }\n        void api.broadcast('apps.settingUpdated', appId, setting);\n      }\n      async commandAdded(command) {\n        void api.broadcast('command.added', command);\n      }\n      async commandDisabled(command) {\n        void api.broadcast('command.disabled', command);\n      }\n      async commandUpdated(command) {\n        void api.broadcast('command.updated', command);\n      }\n      async commandRemoved(command) {\n        void api.broadcast('command.removed', command);\n      }\n      async actionsChanged() {\n        void api.broadcast('actions.changed');\n      }\n    }\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["module","export","AppEvents","AppServerListener","AppServerNotifier","AppStatusUtils","link","v","api","notifications","default","SystemLogger","__reifyWaitForDeps__","constructor","orch","engineStreamer","clientStreamer","received","on","APP_STATUS_CHANGE","onAppStatusUpdated","bind","APP_REMOVED","onAppRemoved","APP_UPDATED","onAppUpdated","APP_ADDED","onAppAdded","ACTIONS_CHANGED","onActionsChanged","APP_SETTING_UPDATED","onAppSettingUpdated","COMMAND_ADDED","onCommandAdded","COMMAND_DISABLED","onCommandDisabled","COMMAND_UPDATED","onCommandUpdated","COMMAND_REMOVED","onCommandRemoved","appId","getManager","addLocal","emitWithoutBroadcast","_ref","_this$orch$getManager","status","app","getOneById","getStatus","set","concat","when","Date","isEnabled","_this$orch$getManager2","enable","catch","error","isDisabled","_this$orch$getManager3","disable","_ref2","setting","id","getSettingsManager","updateAppSetting","storageItem","getStorage","retrieveOne","appPackage","getAppSourceStorage","fetch","updateAndStartupLocal","updateAndInitializeLocal","removeLocal","command","listener","streamAppsEngine","streamApps","Map","appAdded","broadcast","appRemoved","appUpdated","has","delete","appStatusUpdated","details","get","appSettingsChange","commandAdded","commandDisabled","commandUpdated","commandRemoved","actionsChanged","__reify_async_result__","_reifyError","self","async"],"sources":["ee/server/apps/communication/websockets.ts"],"sourcesContent":["import type { AppStatus } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport { AppStatusUtils } from '@rocket.chat/apps-engine/definition/AppStatus';\nimport type { ISetting as AppsSetting } from '@rocket.chat/apps-engine/definition/settings';\nimport { api } from '@rocket.chat/core-services';\nimport type { IStreamer } from 'meteor/rocketchat:streamer';\n\nimport notifications from '../../../../app/notifications/server/lib/Notifications';\nimport { SystemLogger } from '../../../../server/lib/logger/system';\nimport type { AppServerOrchestrator } from '../orchestrator';\nimport { AppEvents } from './events';\n\nexport { AppEvents };\nexport class AppServerListener {\n\tprivate orch: AppServerOrchestrator;\n\n\tengineStreamer: IStreamer<'apps-engine'>;\n\n\tclientStreamer: IStreamer<'apps'>;\n\n\treceived;\n\n\tconstructor(\n\t\torch: AppServerOrchestrator,\n\t\tengineStreamer: IStreamer<'apps-engine'>,\n\t\tclientStreamer: IStreamer<'apps'>,\n\t\treceived: Map<any, any>,\n\t) {\n\t\tthis.orch = orch;\n\t\tthis.engineStreamer = engineStreamer;\n\t\tthis.clientStreamer = clientStreamer;\n\t\tthis.received = received;\n\n\t\tthis.engineStreamer.on(AppEvents.APP_STATUS_CHANGE, this.onAppStatusUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.APP_REMOVED, this.onAppRemoved.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.APP_UPDATED, this.onAppUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.APP_ADDED, this.onAppAdded.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.ACTIONS_CHANGED, this.onActionsChanged.bind(this));\n\n\t\tthis.engineStreamer.on(AppEvents.APP_SETTING_UPDATED, this.onAppSettingUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_ADDED, this.onCommandAdded.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_DISABLED, this.onCommandDisabled.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_UPDATED, this.onCommandUpdated.bind(this));\n\t\tthis.engineStreamer.on(AppEvents.COMMAND_REMOVED, this.onCommandRemoved.bind(this));\n\t}\n\n\tasync onAppAdded(appId: string): Promise<void> {\n\t\tawait (this.orch.getManager()! as any).addLocal(appId); // TO-DO: fix type\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_ADDED, appId);\n\t}\n\n\tasync onAppStatusUpdated({ appId, status }: { appId: string; status: AppStatus }): Promise<void> {\n\t\tconst app = this.orch.getManager()?.getOneById(appId);\n\n\t\tif (!app || (await app.getStatus()) === status) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.received.set(`${AppEvents.APP_STATUS_CHANGE}_${appId}`, {\n\t\t\tappId,\n\t\t\tstatus,\n\t\t\twhen: new Date(),\n\t\t});\n\n\t\tif (AppStatusUtils.isEnabled(status)) {\n\t\t\tawait this.orch.getManager()?.enable(appId).catch(SystemLogger.error);\n\t\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_STATUS_CHANGE, { appId, status });\n\t\t} else if (AppStatusUtils.isDisabled(status)) {\n\t\t\tawait this.orch.getManager()?.disable(appId, status, true).catch(SystemLogger.error);\n\t\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_STATUS_CHANGE, { appId, status });\n\t\t}\n\t}\n\n\tasync onAppSettingUpdated({ appId, setting }: { appId: string; setting: AppsSetting }): Promise<void> {\n\t\tthis.received.set(`${AppEvents.APP_SETTING_UPDATED}_${appId}_${setting.id}`, {\n\t\t\tappId,\n\t\t\tsetting,\n\t\t\twhen: new Date(),\n\t\t});\n\n\t\tawait this.orch\n\t\t\t.getManager()!\n\t\t\t.getSettingsManager()\n\t\t\t.updateAppSetting(appId, setting as any); // TO-DO: fix type of `setting`\n\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_SETTING_UPDATED, { appId, setting });\n\t}\n\n\tasync onAppUpdated(appId: string): Promise<void> {\n\t\tthis.received.set(`${AppEvents.APP_UPDATED}_${appId}`, { appId, when: new Date() });\n\n\t\tconst storageItem = await this.orch.getStorage()!.retrieveOne(appId);\n\n\t\tconst appPackage = await this.orch.getAppSourceStorage()!.fetch(storageItem);\n\n\t\tconst isEnabled = AppStatusUtils.isEnabled(storageItem.status);\n\t\tif (isEnabled) {\n\t\t\tawait this.orch.getManager()!.updateAndStartupLocal(storageItem, appPackage);\n\t\t} else {\n\t\t\tawait this.orch.getManager()!.updateAndInitializeLocal(storageItem, appPackage);\n\t\t}\n\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_UPDATED, appId);\n\t}\n\n\tasync onAppRemoved(appId: string): Promise<void> {\n\t\tconst app = this.orch.getManager()!.getOneById(appId);\n\n\t\tif (!app) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.orch.getManager()!.removeLocal(appId);\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.APP_REMOVED, appId);\n\t}\n\n\tasync onCommandAdded(command: string): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_ADDED, command);\n\t}\n\n\tasync onCommandDisabled(command: string): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_DISABLED, command);\n\t}\n\n\tasync onCommandUpdated(command: string): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_UPDATED, command);\n\t}\n\n\tasync onCommandRemoved(command: string): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.COMMAND_REMOVED, command);\n\t}\n\n\tasync onActionsChanged(): Promise<void> {\n\t\tthis.clientStreamer.emitWithoutBroadcast(AppEvents.ACTIONS_CHANGED);\n\t}\n}\n\nexport class AppServerNotifier {\n\tengineStreamer: IStreamer<'apps-engine'>;\n\n\tclientStreamer: IStreamer<'apps'>;\n\n\treceived: Map<any, any>;\n\n\tlistener: AppServerListener;\n\n\tconstructor(orch: AppServerOrchestrator) {\n\t\tthis.engineStreamer = notifications.streamAppsEngine;\n\n\t\t// This is used to broadcast to the web clients\n\t\tthis.clientStreamer = notifications.streamApps;\n\n\t\tthis.received = new Map();\n\t\tthis.listener = new AppServerListener(orch, this.engineStreamer, this.clientStreamer, this.received);\n\t}\n\n\tasync appAdded(appId: string): Promise<void> {\n\t\tvoid api.broadcast('apps.added', appId);\n\t}\n\n\tasync appRemoved(appId: string): Promise<void> {\n\t\tvoid api.broadcast('apps.removed', appId);\n\t}\n\n\tasync appUpdated(appId: string): Promise<void> {\n\t\tif (this.received.has(`${AppEvents.APP_UPDATED}_${appId}`)) {\n\t\t\tthis.received.delete(`${AppEvents.APP_UPDATED}_${appId}`);\n\t\t\treturn;\n\t\t}\n\n\t\tvoid api.broadcast('apps.updated', appId);\n\t}\n\n\tasync appStatusUpdated(appId: string, status: AppStatus): Promise<void> {\n\t\tif (this.received.has(`${AppEvents.APP_STATUS_CHANGE}_${appId}`)) {\n\t\t\tconst details = this.received.get(`${AppEvents.APP_STATUS_CHANGE}_${appId}`);\n\t\t\tif (details.status === status) {\n\t\t\t\tthis.received.delete(`${AppEvents.APP_STATUS_CHANGE}_${appId}`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tvoid api.broadcast('apps.statusUpdate', appId, status);\n\t}\n\n\tasync appSettingsChange(appId: string, setting: AppsSetting): Promise<void> {\n\t\tif (this.received.has(`${AppEvents.APP_SETTING_UPDATED}_${appId}_${setting.id}`)) {\n\t\t\tthis.received.delete(`${AppEvents.APP_SETTING_UPDATED}_${appId}_${setting.id}`);\n\t\t\treturn;\n\t\t}\n\n\t\tvoid api.broadcast('apps.settingUpdated', appId, setting);\n\t}\n\n\tasync commandAdded(command: string): Promise<void> {\n\t\tvoid api.broadcast('command.added', command);\n\t}\n\n\tasync commandDisabled(command: string): Promise<void> {\n\t\tvoid api.broadcast('command.disabled', command);\n\t}\n\n\tasync commandUpdated(command: string): Promise<void> {\n\t\tvoid api.broadcast('command.updated', command);\n\t}\n\n\tasync commandRemoved(command: string): Promise<void> {\n\t\tvoid api.broadcast('command.removed', command);\n\t}\n\n\tasync actionsChanged(): Promise<void> {\n\t\tvoid api.broadcast('actions.changed');\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"cd6a95a52b1d6d142d5925568ff98a5c157bbed7"}
