{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/ChatMessages.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui/client/lib/ChatMessages.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/ChatMessages.ts","inputSourceMap":{"version":3,"file":"app/ui/client/lib/ChatMessages.ts","sourceRoot":"","sources":["app/ui/client/lib/ChatMessages.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isVideoConfMessage } from '@rocket.chat/core-typings';\nimport type { IActionManager } from '@rocket.chat/ui-contexts';\n\nimport type { ChatAPI, ComposerAPI, DataAPI, UploadsAPI } from '../../../../client/lib/chats/ChatAPI';\nimport { createDataAPI } from '../../../../client/lib/chats/data';\nimport { processMessageEditing } from '../../../../client/lib/chats/flows/processMessageEditing';\nimport { processSetReaction } from '../../../../client/lib/chats/flows/processSetReaction';\nimport { processSlashCommand } from '../../../../client/lib/chats/flows/processSlashCommand';\nimport { processTooLongMessage } from '../../../../client/lib/chats/flows/processTooLongMessage';\nimport { replyBroadcast } from '../../../../client/lib/chats/flows/replyBroadcast';\nimport { requestMessageDeletion } from '../../../../client/lib/chats/flows/requestMessageDeletion';\nimport { sendMessage } from '../../../../client/lib/chats/flows/sendMessage';\nimport { uploadFiles } from '../../../../client/lib/chats/flows/uploadFiles';\nimport { ReadStateManager } from '../../../../client/lib/chats/readStateManager';\nimport { createUploadsAPI } from '../../../../client/lib/chats/uploads';\nimport {\n\tsetHighlightMessage,\n\tclearHighlightMessage,\n} from '../../../../client/views/room/MessageList/providers/messageHighlightSubscription';\nimport { UserAction } from './UserAction';\n\ntype DeepWritable<T> = T extends (...args: any) => any\n\t? T\n\t: {\n\t\t\t-readonly [P in keyof T]: DeepWritable<T[P]>;\n\t\t};\n\nexport class ChatMessages implements ChatAPI {\n\tpublic uid: string | null;\n\n\tpublic composer: ComposerAPI | undefined;\n\n\tpublic setComposerAPI = (composer: ComposerAPI): void => {\n\t\tthis.composer?.release();\n\t\tthis.composer = composer;\n\t};\n\n\tpublic data: DataAPI;\n\n\tpublic readStateManager: ReadStateManager;\n\n\tpublic uploads: UploadsAPI;\n\n\tpublic ActionManager: any;\n\n\tpublic emojiPicker: {\n\t\topen(el: Element, cb: (emoji: string) => void): void;\n\t\tclose(): void;\n\t};\n\n\tpublic action: {\n\t\tstart(action: 'typing'): Promise<void> | void;\n\t\tstop(action: 'typing' | 'recording' | 'uploading' | 'playing'): Promise<void> | void;\n\t\tperformContinuously(action: 'recording' | 'uploading' | 'playing'): Promise<void> | void;\n\t};\n\n\tprivate currentEditingMID?: string;\n\n\tpublic messageEditing: ChatAPI['messageEditing'] = {\n\t\ttoPreviousMessage: async () => {\n\t\t\tif (!this.composer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.currentEditing) {\n\t\t\t\tlet lastMessage = await this.data.findLastOwnMessage();\n\n\t\t\t\t// Videoconf messages should not be edited\n\t\t\t\tif (lastMessage && isVideoConfMessage(lastMessage)) {\n\t\t\t\t\tlastMessage = await this.data.findPreviousOwnMessage(lastMessage);\n\t\t\t\t}\n\n\t\t\t\tif (lastMessage) {\n\t\t\t\t\tawait this.data.saveDraft(undefined, this.composer.text);\n\t\t\t\t\tawait this.messageEditing.editMessage(lastMessage);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n\t\t\tlet previousMessage = currentMessage ? await this.data.findPreviousOwnMessage(currentMessage) : undefined;\n\n\t\t\t// Videoconf messages should not be edited\n\t\t\tif (previousMessage && isVideoConfMessage(previousMessage)) {\n\t\t\t\tpreviousMessage = await this.data.findPreviousOwnMessage(previousMessage);\n\t\t\t}\n\n\t\t\tif (previousMessage) {\n\t\t\t\tawait this.messageEditing.editMessage(previousMessage);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.currentEditing.cancel();\n\t\t},\n\t\ttoNextMessage: async () => {\n\t\t\tif (!this.composer || !this.currentEditing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n\t\t\tlet nextMessage = currentMessage ? await this.data.findNextOwnMessage(currentMessage) : undefined;\n\n\t\t\t// Videoconf messages should not be edited\n\t\t\tif (nextMessage && isVideoConfMessage(nextMessage)) {\n\t\t\t\tnextMessage = await this.data.findNextOwnMessage(nextMessage);\n\t\t\t}\n\n\t\t\tif (nextMessage) {\n\t\t\t\tawait this.messageEditing.editMessage(nextMessage, { cursorAtStart: true });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.currentEditing.cancel();\n\t\t},\n\t\teditMessage: async (message: IMessage, { cursorAtStart = false }: { cursorAtStart?: boolean } = {}) => {\n\t\t\tconst text = (await this.data.getDraft(message._id)) || message.attachments?.[0]?.description || message.msg;\n\n\t\t\tawait this.currentEditing?.stop();\n\n\t\t\tif (!this.composer || !(await this.data.canUpdateMessage(message))) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentEditingMID = message._id;\n\t\t\tsetHighlightMessage(message._id);\n\t\t\tthis.composer.setEditingMode(true);\n\n\t\t\tthis.composer.setText(text);\n\t\t\tcursorAtStart && this.composer.setCursorToStart();\n\t\t\t!cursorAtStart && this.composer.setCursorToEnd();\n\t\t\tthis.composer.focus();\n\t\t},\n\t};\n\n\tpublic flows: DeepWritable<ChatAPI['flows']>;\n\n\tpublic constructor(\n\t\tprivate params: {\n\t\t\trid: IRoom['_id'];\n\t\t\ttmid?: IMessage['_id'];\n\t\t\tuid: IUser['_id'] | null;\n\t\t\tactionManager: IActionManager;\n\t\t},\n\t) {\n\t\tconst { rid, tmid } = params;\n\t\tthis.uid = params.uid;\n\t\tthis.data = createDataAPI({ rid, tmid });\n\t\tthis.uploads = createUploadsAPI({ rid, tmid });\n\t\tthis.ActionManager = params.actionManager;\n\n\t\tconst unimplemented = () => {\n\t\t\tthrow new Error('Flow is not implemented');\n\t\t};\n\n\t\tthis.readStateManager = new ReadStateManager(rid);\n\n\t\tthis.emojiPicker = {\n\t\t\topen: unimplemented,\n\t\t\tclose: unimplemented,\n\t\t};\n\n\t\tthis.action = {\n\t\t\tstart: async (action: 'typing') => {\n\t\t\t\tUserAction.start(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t\tperformContinuously: async (action: 'recording' | 'uploading' | 'playing') => {\n\t\t\t\tUserAction.performContinuously(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t\tstop: async (action: 'typing' | 'recording' | 'uploading' | 'playing') => {\n\t\t\t\tUserAction.stop(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t};\n\n\t\tthis.flows = {\n\t\t\tuploadFiles: uploadFiles.bind(null, this),\n\t\t\tsendMessage: sendMessage.bind(this, this),\n\t\t\tprocessSlashCommand: processSlashCommand.bind(null, this),\n\t\t\tprocessTooLongMessage: processTooLongMessage.bind(null, this),\n\t\t\tprocessMessageEditing: processMessageEditing.bind(null, this),\n\t\t\tprocessSetReaction: processSetReaction.bind(null, this),\n\t\t\trequestMessageDeletion: requestMessageDeletion.bind(this, this),\n\t\t\treplyBroadcast: replyBroadcast.bind(null, this),\n\t\t};\n\t}\n\n\tpublic get currentEditing() {\n\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tmid: this.currentEditingMID,\n\t\t\treset: async (): Promise<boolean> => {\n\t\t\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst message = await this.data.findMessageByID(this.currentEditingMID);\n\t\t\t\tif (this.composer.text !== message?.msg) {\n\t\t\t\t\tthis.composer.setText(message?.msg ?? '');\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tstop: async (): Promise<void> => {\n\t\t\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst message = await this.data.findMessageByID(this.currentEditingMID);\n\t\t\t\tconst draft = this.composer.text;\n\n\t\t\t\tif (draft === message?.msg) {\n\t\t\t\t\tawait this.data.discardDraft(this.currentEditingMID);\n\t\t\t\t} else {\n\t\t\t\t\tawait this.data.saveDraft(this.currentEditingMID, (await this.data.getDraft(this.currentEditingMID)) || draft);\n\t\t\t\t}\n\n\t\t\t\tthis.composer.setEditingMode(false);\n\t\t\t\tthis.currentEditingMID = undefined;\n\t\t\t\tclearHighlightMessage();\n\t\t\t},\n\t\t\tcancel: async (): Promise<void> => {\n\t\t\t\tif (!this.currentEditingMID) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tawait this.data.discardDraft(this.currentEditingMID);\n\t\t\t\tawait this.currentEditing?.stop();\n\t\t\t\tthis.composer?.setText((await this.data.getDraft(undefined)) ?? '');\n\t\t\t},\n\t\t};\n\t}\n\n\tpublic async release() {\n\t\tif (this.currentEditing) {\n\t\t\tif (!this.params.tmid) {\n\t\t\t\tawait this.currentEditing.cancel();\n\t\t\t}\n\t\t\tthis.composer?.clear();\n\t\t}\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/ChatMessages.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui/client/lib/ChatMessages.ts","inputSourceMap":{"version":3,"file":"app/ui/client/lib/ChatMessages.ts","sourceRoot":"","sources":["app/ui/client/lib/ChatMessages.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isVideoConfMessage } from '@rocket.chat/core-typings';\nimport type { IActionManager } from '@rocket.chat/ui-contexts';\n\nimport type { ChatAPI, ComposerAPI, DataAPI, UploadsAPI } from '../../../../client/lib/chats/ChatAPI';\nimport { createDataAPI } from '../../../../client/lib/chats/data';\nimport { processMessageEditing } from '../../../../client/lib/chats/flows/processMessageEditing';\nimport { processSetReaction } from '../../../../client/lib/chats/flows/processSetReaction';\nimport { processSlashCommand } from '../../../../client/lib/chats/flows/processSlashCommand';\nimport { processTooLongMessage } from '../../../../client/lib/chats/flows/processTooLongMessage';\nimport { replyBroadcast } from '../../../../client/lib/chats/flows/replyBroadcast';\nimport { requestMessageDeletion } from '../../../../client/lib/chats/flows/requestMessageDeletion';\nimport { sendMessage } from '../../../../client/lib/chats/flows/sendMessage';\nimport { uploadFiles } from '../../../../client/lib/chats/flows/uploadFiles';\nimport { ReadStateManager } from '../../../../client/lib/chats/readStateManager';\nimport { createUploadsAPI } from '../../../../client/lib/chats/uploads';\nimport {\n\tsetHighlightMessage,\n\tclearHighlightMessage,\n} from '../../../../client/views/room/MessageList/providers/messageHighlightSubscription';\nimport { UserAction } from './UserAction';\n\ntype DeepWritable<T> = T extends (...args: any) => any\n\t? T\n\t: {\n\t\t\t-readonly [P in keyof T]: DeepWritable<T[P]>;\n\t\t};\n\nexport class ChatMessages implements ChatAPI {\n\tpublic uid: string | null;\n\n\tpublic composer: ComposerAPI | undefined;\n\n\tpublic setComposerAPI = (composer: ComposerAPI): void => {\n\t\tthis.composer?.release();\n\t\tthis.composer = composer;\n\t};\n\n\tpublic data: DataAPI;\n\n\tpublic readStateManager: ReadStateManager;\n\n\tpublic uploads: UploadsAPI;\n\n\tpublic ActionManager: any;\n\n\tpublic emojiPicker: {\n\t\topen(el: Element, cb: (emoji: string) => void): void;\n\t\tclose(): void;\n\t};\n\n\tpublic action: {\n\t\tstart(action: 'typing'): Promise<void> | void;\n\t\tstop(action: 'typing' | 'recording' | 'uploading' | 'playing'): Promise<void> | void;\n\t\tperformContinuously(action: 'recording' | 'uploading' | 'playing'): Promise<void> | void;\n\t};\n\n\tprivate currentEditingMID?: string;\n\n\tpublic messageEditing: ChatAPI['messageEditing'] = {\n\t\ttoPreviousMessage: async () => {\n\t\t\tif (!this.composer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.currentEditing) {\n\t\t\t\tlet lastMessage = await this.data.findLastOwnMessage();\n\n\t\t\t\t// Videoconf messages should not be edited\n\t\t\t\tif (lastMessage && isVideoConfMessage(lastMessage)) {\n\t\t\t\t\tlastMessage = await this.data.findPreviousOwnMessage(lastMessage);\n\t\t\t\t}\n\n\t\t\t\tif (lastMessage) {\n\t\t\t\t\tawait this.data.saveDraft(undefined, this.composer.text);\n\t\t\t\t\tawait this.messageEditing.editMessage(lastMessage);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n\t\t\tlet previousMessage = currentMessage ? await this.data.findPreviousOwnMessage(currentMessage) : undefined;\n\n\t\t\t// Videoconf messages should not be edited\n\t\t\tif (previousMessage && isVideoConfMessage(previousMessage)) {\n\t\t\t\tpreviousMessage = await this.data.findPreviousOwnMessage(previousMessage);\n\t\t\t}\n\n\t\t\tif (previousMessage) {\n\t\t\t\tawait this.messageEditing.editMessage(previousMessage);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.currentEditing.cancel();\n\t\t},\n\t\ttoNextMessage: async () => {\n\t\t\tif (!this.composer || !this.currentEditing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n\t\t\tlet nextMessage = currentMessage ? await this.data.findNextOwnMessage(currentMessage) : undefined;\n\n\t\t\t// Videoconf messages should not be edited\n\t\t\tif (nextMessage && isVideoConfMessage(nextMessage)) {\n\t\t\t\tnextMessage = await this.data.findNextOwnMessage(nextMessage);\n\t\t\t}\n\n\t\t\tif (nextMessage) {\n\t\t\t\tawait this.messageEditing.editMessage(nextMessage, { cursorAtStart: true });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.currentEditing.cancel();\n\t\t},\n\t\teditMessage: async (message: IMessage, { cursorAtStart = false }: { cursorAtStart?: boolean } = {}) => {\n\t\t\tconst text = (await this.data.getDraft(message._id)) || message.attachments?.[0]?.description || message.msg;\n\n\t\t\tawait this.currentEditing?.stop();\n\n\t\t\tif (!this.composer || !(await this.data.canUpdateMessage(message))) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentEditingMID = message._id;\n\t\t\tsetHighlightMessage(message._id);\n\t\t\tthis.composer.setEditingMode(true);\n\n\t\t\tthis.composer.setText(text);\n\t\t\tcursorAtStart && this.composer.setCursorToStart();\n\t\t\t!cursorAtStart && this.composer.setCursorToEnd();\n\t\t\tthis.composer.focus();\n\t\t},\n\t};\n\n\tpublic flows: DeepWritable<ChatAPI['flows']>;\n\n\tpublic constructor(\n\t\tprivate params: {\n\t\t\trid: IRoom['_id'];\n\t\t\ttmid?: IMessage['_id'];\n\t\t\tuid: IUser['_id'] | null;\n\t\t\tactionManager: IActionManager;\n\t\t},\n\t) {\n\t\tconst { rid, tmid } = params;\n\t\tthis.uid = params.uid;\n\t\tthis.data = createDataAPI({ rid, tmid });\n\t\tthis.uploads = createUploadsAPI({ rid, tmid });\n\t\tthis.ActionManager = params.actionManager;\n\n\t\tconst unimplemented = () => {\n\t\t\tthrow new Error('Flow is not implemented');\n\t\t};\n\n\t\tthis.readStateManager = new ReadStateManager(rid);\n\n\t\tthis.emojiPicker = {\n\t\t\topen: unimplemented,\n\t\t\tclose: unimplemented,\n\t\t};\n\n\t\tthis.action = {\n\t\t\tstart: async (action: 'typing') => {\n\t\t\t\tUserAction.start(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t\tperformContinuously: async (action: 'recording' | 'uploading' | 'playing') => {\n\t\t\t\tUserAction.performContinuously(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t\tstop: async (action: 'typing' | 'recording' | 'uploading' | 'playing') => {\n\t\t\t\tUserAction.stop(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t};\n\n\t\tthis.flows = {\n\t\t\tuploadFiles: uploadFiles.bind(null, this),\n\t\t\tsendMessage: sendMessage.bind(this, this),\n\t\t\tprocessSlashCommand: processSlashCommand.bind(null, this),\n\t\t\tprocessTooLongMessage: processTooLongMessage.bind(null, this),\n\t\t\tprocessMessageEditing: processMessageEditing.bind(null, this),\n\t\t\tprocessSetReaction: processSetReaction.bind(null, this),\n\t\t\trequestMessageDeletion: requestMessageDeletion.bind(this, this),\n\t\t\treplyBroadcast: replyBroadcast.bind(null, this),\n\t\t};\n\t}\n\n\tpublic get currentEditing() {\n\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tmid: this.currentEditingMID,\n\t\t\treset: async (): Promise<boolean> => {\n\t\t\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst message = await this.data.findMessageByID(this.currentEditingMID);\n\t\t\t\tif (this.composer.text !== message?.msg) {\n\t\t\t\t\tthis.composer.setText(message?.msg ?? '');\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tstop: async (): Promise<void> => {\n\t\t\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst message = await this.data.findMessageByID(this.currentEditingMID);\n\t\t\t\tconst draft = this.composer.text;\n\n\t\t\t\tif (draft === message?.msg) {\n\t\t\t\t\tawait this.data.discardDraft(this.currentEditingMID);\n\t\t\t\t} else {\n\t\t\t\t\tawait this.data.saveDraft(this.currentEditingMID, (await this.data.getDraft(this.currentEditingMID)) || draft);\n\t\t\t\t}\n\n\t\t\t\tthis.composer.setEditingMode(false);\n\t\t\t\tthis.currentEditingMID = undefined;\n\t\t\t\tclearHighlightMessage();\n\t\t\t},\n\t\t\tcancel: async (): Promise<void> => {\n\t\t\t\tif (!this.currentEditingMID) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tawait this.data.discardDraft(this.currentEditingMID);\n\t\t\t\tawait this.currentEditing?.stop();\n\t\t\t\tthis.composer?.setText((await this.data.getDraft(undefined)) ?? '');\n\t\t\t},\n\t\t};\n\t}\n\n\tpublic async release() {\n\t\tif (this.currentEditing) {\n\t\t\tif (!this.params.tmid) {\n\t\t\t\tawait this.currentEditing.cancel();\n\t\t\t}\n\t\t\tthis.composer?.clear();\n\t\t}\n\t}\n}\n"]}}},"code":"module.export({\n  ChatMessages: () => ChatMessages\n});\nlet isVideoConfMessage;\nmodule.link(\"@rocket.chat/core-typings\", {\n  isVideoConfMessage(v) {\n    isVideoConfMessage = v;\n  }\n}, 0);\nlet createDataAPI;\nmodule.link(\"../../../../client/lib/chats/data\", {\n  createDataAPI(v) {\n    createDataAPI = v;\n  }\n}, 1);\nlet processMessageEditing;\nmodule.link(\"../../../../client/lib/chats/flows/processMessageEditing\", {\n  processMessageEditing(v) {\n    processMessageEditing = v;\n  }\n}, 2);\nlet processSetReaction;\nmodule.link(\"../../../../client/lib/chats/flows/processSetReaction\", {\n  processSetReaction(v) {\n    processSetReaction = v;\n  }\n}, 3);\nlet processSlashCommand;\nmodule.link(\"../../../../client/lib/chats/flows/processSlashCommand\", {\n  processSlashCommand(v) {\n    processSlashCommand = v;\n  }\n}, 4);\nlet processTooLongMessage;\nmodule.link(\"../../../../client/lib/chats/flows/processTooLongMessage\", {\n  processTooLongMessage(v) {\n    processTooLongMessage = v;\n  }\n}, 5);\nlet replyBroadcast;\nmodule.link(\"../../../../client/lib/chats/flows/replyBroadcast\", {\n  replyBroadcast(v) {\n    replyBroadcast = v;\n  }\n}, 6);\nlet requestMessageDeletion;\nmodule.link(\"../../../../client/lib/chats/flows/requestMessageDeletion\", {\n  requestMessageDeletion(v) {\n    requestMessageDeletion = v;\n  }\n}, 7);\nlet sendMessage;\nmodule.link(\"../../../../client/lib/chats/flows/sendMessage\", {\n  sendMessage(v) {\n    sendMessage = v;\n  }\n}, 8);\nlet uploadFiles;\nmodule.link(\"../../../../client/lib/chats/flows/uploadFiles\", {\n  uploadFiles(v) {\n    uploadFiles = v;\n  }\n}, 9);\nlet ReadStateManager;\nmodule.link(\"../../../../client/lib/chats/readStateManager\", {\n  ReadStateManager(v) {\n    ReadStateManager = v;\n  }\n}, 10);\nlet createUploadsAPI;\nmodule.link(\"../../../../client/lib/chats/uploads\", {\n  createUploadsAPI(v) {\n    createUploadsAPI = v;\n  }\n}, 11);\nlet setHighlightMessage, clearHighlightMessage;\nmodule.link(\"../../../../client/views/room/MessageList/providers/messageHighlightSubscription\", {\n  setHighlightMessage(v) {\n    setHighlightMessage = v;\n  },\n  clearHighlightMessage(v) {\n    clearHighlightMessage = v;\n  }\n}, 12);\nlet UserAction;\nmodule.link(\"./UserAction\", {\n  UserAction(v) {\n    UserAction = v;\n  }\n}, 13);\nclass ChatMessages {\n  constructor(params) {\n    var _this = this;\n    this.params = void 0;\n    this.uid = void 0;\n    this.composer = void 0;\n    this.setComposerAPI = composer => {\n      var _this$composer;\n      (_this$composer = this.composer) === null || _this$composer === void 0 ? void 0 : _this$composer.release();\n      this.composer = composer;\n    };\n    this.data = void 0;\n    this.readStateManager = void 0;\n    this.uploads = void 0;\n    this.ActionManager = void 0;\n    this.emojiPicker = void 0;\n    this.action = void 0;\n    this.currentEditingMID = void 0;\n    this.messageEditing = {\n      toPreviousMessage: async () => {\n        if (!this.composer) {\n          return;\n        }\n        if (!this.currentEditing) {\n          let lastMessage = await this.data.findLastOwnMessage();\n          // Videoconf messages should not be edited\n          if (lastMessage && isVideoConfMessage(lastMessage)) {\n            lastMessage = await this.data.findPreviousOwnMessage(lastMessage);\n          }\n          if (lastMessage) {\n            await this.data.saveDraft(undefined, this.composer.text);\n            await this.messageEditing.editMessage(lastMessage);\n          }\n          return;\n        }\n        const currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n        let previousMessage = currentMessage ? await this.data.findPreviousOwnMessage(currentMessage) : undefined;\n        // Videoconf messages should not be edited\n        if (previousMessage && isVideoConfMessage(previousMessage)) {\n          previousMessage = await this.data.findPreviousOwnMessage(previousMessage);\n        }\n        if (previousMessage) {\n          await this.messageEditing.editMessage(previousMessage);\n          return;\n        }\n        await this.currentEditing.cancel();\n      },\n      toNextMessage: async () => {\n        if (!this.composer || !this.currentEditing) {\n          return;\n        }\n        const currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n        let nextMessage = currentMessage ? await this.data.findNextOwnMessage(currentMessage) : undefined;\n        // Videoconf messages should not be edited\n        if (nextMessage && isVideoConfMessage(nextMessage)) {\n          nextMessage = await this.data.findNextOwnMessage(nextMessage);\n        }\n        if (nextMessage) {\n          await this.messageEditing.editMessage(nextMessage, {\n            cursorAtStart: true\n          });\n          return;\n        }\n        await this.currentEditing.cancel();\n      },\n      editMessage: async function (message) {\n        var _message$attachments, _message$attachments$, _this$currentEditing;\n        let {\n          cursorAtStart = false\n        } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n        const text = (await _this.data.getDraft(message._id)) || ((_message$attachments = message.attachments) === null || _message$attachments === void 0 ? void 0 : (_message$attachments$ = _message$attachments[0]) === null || _message$attachments$ === void 0 ? void 0 : _message$attachments$.description) || message.msg;\n        await ((_this$currentEditing = _this.currentEditing) === null || _this$currentEditing === void 0 ? void 0 : _this$currentEditing.stop());\n        if (!_this.composer || !(await _this.data.canUpdateMessage(message))) {\n          return;\n        }\n        _this.currentEditingMID = message._id;\n        setHighlightMessage(message._id);\n        _this.composer.setEditingMode(true);\n        _this.composer.setText(text);\n        cursorAtStart && _this.composer.setCursorToStart();\n        !cursorAtStart && _this.composer.setCursorToEnd();\n        _this.composer.focus();\n      }\n    };\n    this.flows = void 0;\n    this.params = params;\n    const {\n      rid,\n      tmid\n    } = params;\n    this.uid = params.uid;\n    this.data = createDataAPI({\n      rid,\n      tmid\n    });\n    this.uploads = createUploadsAPI({\n      rid,\n      tmid\n    });\n    this.ActionManager = params.actionManager;\n    const unimplemented = () => {\n      throw new Error('Flow is not implemented');\n    };\n    this.readStateManager = new ReadStateManager(rid);\n    this.emojiPicker = {\n      open: unimplemented,\n      close: unimplemented\n    };\n    this.action = {\n      start: async action => {\n        UserAction.start(params.rid, \"user-\".concat(action), {\n          tmid: params.tmid\n        });\n      },\n      performContinuously: async action => {\n        UserAction.performContinuously(params.rid, \"user-\".concat(action), {\n          tmid: params.tmid\n        });\n      },\n      stop: async action => {\n        UserAction.stop(params.rid, \"user-\".concat(action), {\n          tmid: params.tmid\n        });\n      }\n    };\n    this.flows = {\n      uploadFiles: uploadFiles.bind(null, this),\n      sendMessage: sendMessage.bind(this, this),\n      processSlashCommand: processSlashCommand.bind(null, this),\n      processTooLongMessage: processTooLongMessage.bind(null, this),\n      processMessageEditing: processMessageEditing.bind(null, this),\n      processSetReaction: processSetReaction.bind(null, this),\n      requestMessageDeletion: requestMessageDeletion.bind(this, this),\n      replyBroadcast: replyBroadcast.bind(null, this)\n    };\n  }\n  get currentEditing() {\n    if (!this.composer || !this.currentEditingMID) {\n      return undefined;\n    }\n    return {\n      mid: this.currentEditingMID,\n      reset: async () => {\n        if (!this.composer || !this.currentEditingMID) {\n          return false;\n        }\n        const message = await this.data.findMessageByID(this.currentEditingMID);\n        if (this.composer.text !== (message === null || message === void 0 ? void 0 : message.msg)) {\n          var _message$msg;\n          this.composer.setText((_message$msg = message === null || message === void 0 ? void 0 : message.msg) !== null && _message$msg !== void 0 ? _message$msg : '');\n          return true;\n        }\n        return false;\n      },\n      stop: async () => {\n        if (!this.composer || !this.currentEditingMID) {\n          return;\n        }\n        const message = await this.data.findMessageByID(this.currentEditingMID);\n        const draft = this.composer.text;\n        if (draft === (message === null || message === void 0 ? void 0 : message.msg)) {\n          await this.data.discardDraft(this.currentEditingMID);\n        } else {\n          await this.data.saveDraft(this.currentEditingMID, (await this.data.getDraft(this.currentEditingMID)) || draft);\n        }\n        this.composer.setEditingMode(false);\n        this.currentEditingMID = undefined;\n        clearHighlightMessage();\n      },\n      cancel: async () => {\n        var _this$currentEditing2, _this$composer2, _await$this$data$getD;\n        if (!this.currentEditingMID) {\n          return;\n        }\n        await this.data.discardDraft(this.currentEditingMID);\n        await ((_this$currentEditing2 = this.currentEditing) === null || _this$currentEditing2 === void 0 ? void 0 : _this$currentEditing2.stop());\n        (_this$composer2 = this.composer) === null || _this$composer2 === void 0 ? void 0 : _this$composer2.setText((_await$this$data$getD = await this.data.getDraft(undefined)) !== null && _await$this$data$getD !== void 0 ? _await$this$data$getD : '');\n      }\n    };\n  }\n  async release() {\n    if (this.currentEditing) {\n      var _this$composer3;\n      if (!this.params.tmid) {\n        await this.currentEditing.cancel();\n      }\n      (_this$composer3 = this.composer) === null || _this$composer3 === void 0 ? void 0 : _this$composer3.clear();\n    }\n  }\n}","map":{"version":3,"names":["module","export","ChatMessages","isVideoConfMessage","link","v","createDataAPI","processMessageEditing","processSetReaction","processSlashCommand","processTooLongMessage","replyBroadcast","requestMessageDeletion","sendMessage","uploadFiles","ReadStateManager","createUploadsAPI","setHighlightMessage","clearHighlightMessage","UserAction","constructor","params","_this","uid","composer","setComposerAPI","_this$composer","release","data","readStateManager","uploads","ActionManager","emojiPicker","action","currentEditingMID","messageEditing","toPreviousMessage","currentEditing","lastMessage","findLastOwnMessage","findPreviousOwnMessage","saveDraft","undefined","text","editMessage","currentMessage","findMessageByID","mid","previousMessage","cancel","toNextMessage","nextMessage","findNextOwnMessage","cursorAtStart","message","_message$attachments","_message$attachments$","_this$currentEditing","arguments","length","getDraft","_id","attachments","description","msg","stop","canUpdateMessage","setEditingMode","setText","setCursorToStart","setCursorToEnd","focus","flows","rid","tmid","actionManager","unimplemented","Error","open","close","start","concat","performContinuously","bind","reset","_message$msg","draft","discardDraft","_this$currentEditing2","_this$composer2","_await$this$data$getD","_this$composer3","clear"],"sources":["app/ui/client/lib/ChatMessages.ts"],"sourcesContent":["import type { IMessage, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isVideoConfMessage } from '@rocket.chat/core-typings';\nimport type { IActionManager } from '@rocket.chat/ui-contexts';\n\nimport type { ChatAPI, ComposerAPI, DataAPI, UploadsAPI } from '../../../../client/lib/chats/ChatAPI';\nimport { createDataAPI } from '../../../../client/lib/chats/data';\nimport { processMessageEditing } from '../../../../client/lib/chats/flows/processMessageEditing';\nimport { processSetReaction } from '../../../../client/lib/chats/flows/processSetReaction';\nimport { processSlashCommand } from '../../../../client/lib/chats/flows/processSlashCommand';\nimport { processTooLongMessage } from '../../../../client/lib/chats/flows/processTooLongMessage';\nimport { replyBroadcast } from '../../../../client/lib/chats/flows/replyBroadcast';\nimport { requestMessageDeletion } from '../../../../client/lib/chats/flows/requestMessageDeletion';\nimport { sendMessage } from '../../../../client/lib/chats/flows/sendMessage';\nimport { uploadFiles } from '../../../../client/lib/chats/flows/uploadFiles';\nimport { ReadStateManager } from '../../../../client/lib/chats/readStateManager';\nimport { createUploadsAPI } from '../../../../client/lib/chats/uploads';\nimport {\n\tsetHighlightMessage,\n\tclearHighlightMessage,\n} from '../../../../client/views/room/MessageList/providers/messageHighlightSubscription';\nimport { UserAction } from './UserAction';\n\ntype DeepWritable<T> = T extends (...args: any) => any\n\t? T\n\t: {\n\t\t\t-readonly [P in keyof T]: DeepWritable<T[P]>;\n\t\t};\n\nexport class ChatMessages implements ChatAPI {\n\tpublic uid: string | null;\n\n\tpublic composer: ComposerAPI | undefined;\n\n\tpublic setComposerAPI = (composer: ComposerAPI): void => {\n\t\tthis.composer?.release();\n\t\tthis.composer = composer;\n\t};\n\n\tpublic data: DataAPI;\n\n\tpublic readStateManager: ReadStateManager;\n\n\tpublic uploads: UploadsAPI;\n\n\tpublic ActionManager: any;\n\n\tpublic emojiPicker: {\n\t\topen(el: Element, cb: (emoji: string) => void): void;\n\t\tclose(): void;\n\t};\n\n\tpublic action: {\n\t\tstart(action: 'typing'): Promise<void> | void;\n\t\tstop(action: 'typing' | 'recording' | 'uploading' | 'playing'): Promise<void> | void;\n\t\tperformContinuously(action: 'recording' | 'uploading' | 'playing'): Promise<void> | void;\n\t};\n\n\tprivate currentEditingMID?: string;\n\n\tpublic messageEditing: ChatAPI['messageEditing'] = {\n\t\ttoPreviousMessage: async () => {\n\t\t\tif (!this.composer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.currentEditing) {\n\t\t\t\tlet lastMessage = await this.data.findLastOwnMessage();\n\n\t\t\t\t// Videoconf messages should not be edited\n\t\t\t\tif (lastMessage && isVideoConfMessage(lastMessage)) {\n\t\t\t\t\tlastMessage = await this.data.findPreviousOwnMessage(lastMessage);\n\t\t\t\t}\n\n\t\t\t\tif (lastMessage) {\n\t\t\t\t\tawait this.data.saveDraft(undefined, this.composer.text);\n\t\t\t\t\tawait this.messageEditing.editMessage(lastMessage);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n\t\t\tlet previousMessage = currentMessage ? await this.data.findPreviousOwnMessage(currentMessage) : undefined;\n\n\t\t\t// Videoconf messages should not be edited\n\t\t\tif (previousMessage && isVideoConfMessage(previousMessage)) {\n\t\t\t\tpreviousMessage = await this.data.findPreviousOwnMessage(previousMessage);\n\t\t\t}\n\n\t\t\tif (previousMessage) {\n\t\t\t\tawait this.messageEditing.editMessage(previousMessage);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.currentEditing.cancel();\n\t\t},\n\t\ttoNextMessage: async () => {\n\t\t\tif (!this.composer || !this.currentEditing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentMessage = await this.data.findMessageByID(this.currentEditing.mid);\n\t\t\tlet nextMessage = currentMessage ? await this.data.findNextOwnMessage(currentMessage) : undefined;\n\n\t\t\t// Videoconf messages should not be edited\n\t\t\tif (nextMessage && isVideoConfMessage(nextMessage)) {\n\t\t\t\tnextMessage = await this.data.findNextOwnMessage(nextMessage);\n\t\t\t}\n\n\t\t\tif (nextMessage) {\n\t\t\t\tawait this.messageEditing.editMessage(nextMessage, { cursorAtStart: true });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.currentEditing.cancel();\n\t\t},\n\t\teditMessage: async (message: IMessage, { cursorAtStart = false }: { cursorAtStart?: boolean } = {}) => {\n\t\t\tconst text = (await this.data.getDraft(message._id)) || message.attachments?.[0]?.description || message.msg;\n\n\t\t\tawait this.currentEditing?.stop();\n\n\t\t\tif (!this.composer || !(await this.data.canUpdateMessage(message))) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentEditingMID = message._id;\n\t\t\tsetHighlightMessage(message._id);\n\t\t\tthis.composer.setEditingMode(true);\n\n\t\t\tthis.composer.setText(text);\n\t\t\tcursorAtStart && this.composer.setCursorToStart();\n\t\t\t!cursorAtStart && this.composer.setCursorToEnd();\n\t\t\tthis.composer.focus();\n\t\t},\n\t};\n\n\tpublic flows: DeepWritable<ChatAPI['flows']>;\n\n\tpublic constructor(\n\t\tprivate params: {\n\t\t\trid: IRoom['_id'];\n\t\t\ttmid?: IMessage['_id'];\n\t\t\tuid: IUser['_id'] | null;\n\t\t\tactionManager: IActionManager;\n\t\t},\n\t) {\n\t\tconst { rid, tmid } = params;\n\t\tthis.uid = params.uid;\n\t\tthis.data = createDataAPI({ rid, tmid });\n\t\tthis.uploads = createUploadsAPI({ rid, tmid });\n\t\tthis.ActionManager = params.actionManager;\n\n\t\tconst unimplemented = () => {\n\t\t\tthrow new Error('Flow is not implemented');\n\t\t};\n\n\t\tthis.readStateManager = new ReadStateManager(rid);\n\n\t\tthis.emojiPicker = {\n\t\t\topen: unimplemented,\n\t\t\tclose: unimplemented,\n\t\t};\n\n\t\tthis.action = {\n\t\t\tstart: async (action: 'typing') => {\n\t\t\t\tUserAction.start(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t\tperformContinuously: async (action: 'recording' | 'uploading' | 'playing') => {\n\t\t\t\tUserAction.performContinuously(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t\tstop: async (action: 'typing' | 'recording' | 'uploading' | 'playing') => {\n\t\t\t\tUserAction.stop(params.rid, `user-${action}`, { tmid: params.tmid });\n\t\t\t},\n\t\t};\n\n\t\tthis.flows = {\n\t\t\tuploadFiles: uploadFiles.bind(null, this),\n\t\t\tsendMessage: sendMessage.bind(this, this),\n\t\t\tprocessSlashCommand: processSlashCommand.bind(null, this),\n\t\t\tprocessTooLongMessage: processTooLongMessage.bind(null, this),\n\t\t\tprocessMessageEditing: processMessageEditing.bind(null, this),\n\t\t\tprocessSetReaction: processSetReaction.bind(null, this),\n\t\t\trequestMessageDeletion: requestMessageDeletion.bind(this, this),\n\t\t\treplyBroadcast: replyBroadcast.bind(null, this),\n\t\t};\n\t}\n\n\tpublic get currentEditing() {\n\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn {\n\t\t\tmid: this.currentEditingMID,\n\t\t\treset: async (): Promise<boolean> => {\n\t\t\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst message = await this.data.findMessageByID(this.currentEditingMID);\n\t\t\t\tif (this.composer.text !== message?.msg) {\n\t\t\t\t\tthis.composer.setText(message?.msg ?? '');\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tstop: async (): Promise<void> => {\n\t\t\t\tif (!this.composer || !this.currentEditingMID) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst message = await this.data.findMessageByID(this.currentEditingMID);\n\t\t\t\tconst draft = this.composer.text;\n\n\t\t\t\tif (draft === message?.msg) {\n\t\t\t\t\tawait this.data.discardDraft(this.currentEditingMID);\n\t\t\t\t} else {\n\t\t\t\t\tawait this.data.saveDraft(this.currentEditingMID, (await this.data.getDraft(this.currentEditingMID)) || draft);\n\t\t\t\t}\n\n\t\t\t\tthis.composer.setEditingMode(false);\n\t\t\t\tthis.currentEditingMID = undefined;\n\t\t\t\tclearHighlightMessage();\n\t\t\t},\n\t\t\tcancel: async (): Promise<void> => {\n\t\t\t\tif (!this.currentEditingMID) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tawait this.data.discardDraft(this.currentEditingMID);\n\t\t\t\tawait this.currentEditing?.stop();\n\t\t\t\tthis.composer?.setText((await this.data.getDraft(undefined)) ?? '');\n\t\t\t},\n\t\t};\n\t}\n\n\tpublic async release() {\n\t\tif (this.currentEditing) {\n\t\t\tif (!this.params.tmid) {\n\t\t\t\tawait this.currentEditing.cancel();\n\t\t\t}\n\t\t\tthis.composer?.clear();\n\t\t}\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"4dfae65942a75ed90637b6902e10737e7e6b5b1c"}
