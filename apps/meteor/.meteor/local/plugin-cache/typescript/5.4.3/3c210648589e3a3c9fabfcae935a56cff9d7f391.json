{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/lib/messageTypes.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/livechat/lib/messageTypes.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/lib/messageTypes.ts","inputSourceMap":{"version":3,"file":"app/livechat/lib/messageTypes.ts","sourceRoot":"","sources":["app/livechat/lib/messageTypes.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IOmnichannelSystemMessage } from '@rocket.chat/core-typings';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport formatDistance from 'date-fns/formatDistance';\nimport moment from 'moment';\n\nimport { MessageTypes } from '../../ui-utils/lib/MessageTypes';\nimport { t } from '../../utils/lib/i18n';\n\nMessageTypes.registerType({\n\tid: 'livechat_navigation_history',\n\tsystem: true,\n\tmessage: 'New_visitor_navigation',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\thistory: message.navigation\n\t\t\t\t? `${(message.navigation.page.title ? `${message.navigation.page.title} - ` : '') + message.navigation.page.location.href}`\n\t\t\t\t: '',\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_transfer_history',\n\tsystem: true,\n\tmessage: 'New_chat_transfer',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\tif (!message.transferData) {\n\t\t\treturn {\n\t\t\t\ttransfer: '',\n\t\t\t};\n\t\t}\n\n\t\tconst { comment } = message.transferData;\n\t\tconst commentLabel = comment && comment !== '' ? '_with_a_comment' : '';\n\t\tconst from =\n\t\t\tmessage.transferData.transferredBy && (message.transferData.transferredBy.name || message.transferData.transferredBy.username);\n\t\tconst transferTypes = {\n\t\t\tagent: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_agent${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.transferredTo?.name || message?.transferData?.transferredTo?.username || '',\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tdepartment: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_department${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.nextDepartment?.name || '',\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tqueue: (): string =>\n\t\t\t\tt(`Livechat_transfer_return_to_the_queue${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tautoTransferUnansweredChatsToAgent: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_agent_auto_transfer_unanswered_chat`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.transferredTo?.name || message?.transferData?.transferredTo?.username || '',\n\t\t\t\t\tduration: comment,\n\t\t\t\t}),\n\t\t\tautoTransferUnansweredChatsToQueue: (): string =>\n\t\t\t\tt(`Livechat_transfer_return_to_the_queue_auto_transfer_unanswered_chat`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tduration: comment,\n\t\t\t\t}),\n\t\t};\n\t\treturn {\n\t\t\ttransfer: transferTypes[message.transferData.scope](),\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_transcript_history',\n\tsystem: true,\n\tmessage: 'Livechat_chat_transcript_sent',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\tif (!message.requestData) {\n\t\t\treturn {\n\t\t\t\ttranscript: '',\n\t\t\t};\n\t\t}\n\n\t\tconst { requestData: { type, visitor, user } = { type: 'user' } } = message;\n\t\tconst requestTypes = {\n\t\t\tvisitor: (): string =>\n\t\t\t\tt('Livechat_visitor_transcript_request', {\n\t\t\t\t\tguest: visitor?.name || visitor?.username || '',\n\t\t\t\t}),\n\t\t\tuser: (): string =>\n\t\t\t\tt('Livechat_user_sent_chat_transcript_to_visitor', {\n\t\t\t\t\tagent: user?.name || user?.username || '',\n\t\t\t\t\tguest: visitor?.name || visitor?.username || '',\n\t\t\t\t}),\n\t\t};\n\n\t\treturn {\n\t\t\ttranscript: requestTypes[type](),\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_video_call',\n\tsystem: true,\n\tmessage: 'New_videocall_request',\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_webrtc_video_call',\n\tmessage: 'room_changed_type',\n\tdata(message) {\n\t\tif (message.msg === 'ended' && message.webRtcCallEndTs && message.ts) {\n\t\t\treturn {\n\t\t\t\tmessage: t('WebRTC_call_ended_message', {\n\t\t\t\t\tcallDuration: formatDistance(new Date(message.webRtcCallEndTs), new Date(message.ts)),\n\t\t\t\t\tendTime: moment(message.webRtcCallEndTs).format('h:mm A'),\n\t\t\t\t}),\n\t\t\t};\n\t\t}\n\t\tif (message.msg === 'declined' && message.webRtcCallEndTs) {\n\t\t\treturn {\n\t\t\t\tmessage: t('WebRTC_call_declined_message'),\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tmessage: escapeHTML(message.msg),\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'omnichannel_placed_chat_on_hold',\n\tsystem: true,\n\tmessage: 'Omnichannel_placed_chat_on_hold',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\tcomment: message.comment ? message.comment : 'No comment provided',\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'omnichannel_on_hold_chat_resumed',\n\tsystem: true,\n\tmessage: 'Omnichannel_on_hold_chat_resumed',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\tcomment: message.comment ? message.comment : 'No comment provided',\n\t\t};\n\t},\n});\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/livechat/lib/messageTypes.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/livechat/lib/messageTypes.ts","inputSourceMap":{"version":3,"file":"app/livechat/lib/messageTypes.ts","sourceRoot":"","sources":["app/livechat/lib/messageTypes.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IOmnichannelSystemMessage } from '@rocket.chat/core-typings';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport formatDistance from 'date-fns/formatDistance';\nimport moment from 'moment';\n\nimport { MessageTypes } from '../../ui-utils/lib/MessageTypes';\nimport { t } from '../../utils/lib/i18n';\n\nMessageTypes.registerType({\n\tid: 'livechat_navigation_history',\n\tsystem: true,\n\tmessage: 'New_visitor_navigation',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\thistory: message.navigation\n\t\t\t\t? `${(message.navigation.page.title ? `${message.navigation.page.title} - ` : '') + message.navigation.page.location.href}`\n\t\t\t\t: '',\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_transfer_history',\n\tsystem: true,\n\tmessage: 'New_chat_transfer',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\tif (!message.transferData) {\n\t\t\treturn {\n\t\t\t\ttransfer: '',\n\t\t\t};\n\t\t}\n\n\t\tconst { comment } = message.transferData;\n\t\tconst commentLabel = comment && comment !== '' ? '_with_a_comment' : '';\n\t\tconst from =\n\t\t\tmessage.transferData.transferredBy && (message.transferData.transferredBy.name || message.transferData.transferredBy.username);\n\t\tconst transferTypes = {\n\t\t\tagent: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_agent${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.transferredTo?.name || message?.transferData?.transferredTo?.username || '',\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tdepartment: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_department${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.nextDepartment?.name || '',\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tqueue: (): string =>\n\t\t\t\tt(`Livechat_transfer_return_to_the_queue${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tautoTransferUnansweredChatsToAgent: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_agent_auto_transfer_unanswered_chat`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.transferredTo?.name || message?.transferData?.transferredTo?.username || '',\n\t\t\t\t\tduration: comment,\n\t\t\t\t}),\n\t\t\tautoTransferUnansweredChatsToQueue: (): string =>\n\t\t\t\tt(`Livechat_transfer_return_to_the_queue_auto_transfer_unanswered_chat`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tduration: comment,\n\t\t\t\t}),\n\t\t};\n\t\treturn {\n\t\t\ttransfer: transferTypes[message.transferData.scope](),\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_transcript_history',\n\tsystem: true,\n\tmessage: 'Livechat_chat_transcript_sent',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\tif (!message.requestData) {\n\t\t\treturn {\n\t\t\t\ttranscript: '',\n\t\t\t};\n\t\t}\n\n\t\tconst { requestData: { type, visitor, user } = { type: 'user' } } = message;\n\t\tconst requestTypes = {\n\t\t\tvisitor: (): string =>\n\t\t\t\tt('Livechat_visitor_transcript_request', {\n\t\t\t\t\tguest: visitor?.name || visitor?.username || '',\n\t\t\t\t}),\n\t\t\tuser: (): string =>\n\t\t\t\tt('Livechat_user_sent_chat_transcript_to_visitor', {\n\t\t\t\t\tagent: user?.name || user?.username || '',\n\t\t\t\t\tguest: visitor?.name || visitor?.username || '',\n\t\t\t\t}),\n\t\t};\n\n\t\treturn {\n\t\t\ttranscript: requestTypes[type](),\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_video_call',\n\tsystem: true,\n\tmessage: 'New_videocall_request',\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_webrtc_video_call',\n\tmessage: 'room_changed_type',\n\tdata(message) {\n\t\tif (message.msg === 'ended' && message.webRtcCallEndTs && message.ts) {\n\t\t\treturn {\n\t\t\t\tmessage: t('WebRTC_call_ended_message', {\n\t\t\t\t\tcallDuration: formatDistance(new Date(message.webRtcCallEndTs), new Date(message.ts)),\n\t\t\t\t\tendTime: moment(message.webRtcCallEndTs).format('h:mm A'),\n\t\t\t\t}),\n\t\t\t};\n\t\t}\n\t\tif (message.msg === 'declined' && message.webRtcCallEndTs) {\n\t\t\treturn {\n\t\t\t\tmessage: t('WebRTC_call_declined_message'),\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tmessage: escapeHTML(message.msg),\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'omnichannel_placed_chat_on_hold',\n\tsystem: true,\n\tmessage: 'Omnichannel_placed_chat_on_hold',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\tcomment: message.comment ? message.comment : 'No comment provided',\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'omnichannel_on_hold_chat_resumed',\n\tsystem: true,\n\tmessage: 'Omnichannel_on_hold_chat_resumed',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\tcomment: message.comment ? message.comment : 'No comment provided',\n\t\t};\n\t},\n});\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let _objectSpread;\n    module.link(\"@babel/runtime/helpers/objectSpread2\", {\n      default(v) {\n        _objectSpread = v;\n      }\n    }, 0);\n    let escapeHTML;\n    module.link(\"@rocket.chat/string-helpers\", {\n      escapeHTML(v) {\n        escapeHTML = v;\n      }\n    }, 0);\n    let formatDistance;\n    module.link(\"date-fns/formatDistance\", {\n      default(v) {\n        formatDistance = v;\n      }\n    }, 1);\n    let moment;\n    module.link(\"moment\", {\n      default(v) {\n        moment = v;\n      }\n    }, 2);\n    let MessageTypes;\n    module.link(\"../../ui-utils/lib/MessageTypes\", {\n      MessageTypes(v) {\n        MessageTypes = v;\n      }\n    }, 3);\n    let t;\n    module.link(\"../../utils/lib/i18n\", {\n      t(v) {\n        t = v;\n      }\n    }, 4);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    MessageTypes.registerType({\n      id: 'livechat_navigation_history',\n      system: true,\n      message: 'New_visitor_navigation',\n      data(message) {\n        return {\n          history: message.navigation ? \"\".concat((message.navigation.page.title ? \"\".concat(message.navigation.page.title, \" - \") : '') + message.navigation.page.location.href) : ''\n        };\n      }\n    });\n    MessageTypes.registerType({\n      id: 'livechat_transfer_history',\n      system: true,\n      message: 'New_chat_transfer',\n      data(message) {\n        if (!message.transferData) {\n          return {\n            transfer: ''\n          };\n        }\n        const {\n          comment\n        } = message.transferData;\n        const commentLabel = comment && comment !== '' ? '_with_a_comment' : '';\n        const from = message.transferData.transferredBy && (message.transferData.transferredBy.name || message.transferData.transferredBy.username);\n        const transferTypes = {\n          agent: () => {\n            var _message$transferData, _message$transferData2, _message$transferData3, _message$transferData4;\n            return t(\"Livechat_transfer_to_agent\".concat(commentLabel), _objectSpread({\n              from,\n              to: (message === null || message === void 0 ? void 0 : (_message$transferData = message.transferData) === null || _message$transferData === void 0 ? void 0 : (_message$transferData2 = _message$transferData.transferredTo) === null || _message$transferData2 === void 0 ? void 0 : _message$transferData2.name) || (message === null || message === void 0 ? void 0 : (_message$transferData3 = message.transferData) === null || _message$transferData3 === void 0 ? void 0 : (_message$transferData4 = _message$transferData3.transferredTo) === null || _message$transferData4 === void 0 ? void 0 : _message$transferData4.username) || ''\n            }, comment && {\n              comment\n            }));\n          },\n          department: () => {\n            var _message$transferData5, _message$transferData6;\n            return t(\"Livechat_transfer_to_department\".concat(commentLabel), _objectSpread({\n              from,\n              to: (message === null || message === void 0 ? void 0 : (_message$transferData5 = message.transferData) === null || _message$transferData5 === void 0 ? void 0 : (_message$transferData6 = _message$transferData5.nextDepartment) === null || _message$transferData6 === void 0 ? void 0 : _message$transferData6.name) || ''\n            }, comment && {\n              comment\n            }));\n          },\n          queue: () => t(\"Livechat_transfer_return_to_the_queue\".concat(commentLabel), _objectSpread({\n            from\n          }, comment && {\n            comment\n          })),\n          autoTransferUnansweredChatsToAgent: () => {\n            var _message$transferData7, _message$transferData8, _message$transferData9, _message$transferData10;\n            return t(\"Livechat_transfer_to_agent_auto_transfer_unanswered_chat\", {\n              from,\n              to: (message === null || message === void 0 ? void 0 : (_message$transferData7 = message.transferData) === null || _message$transferData7 === void 0 ? void 0 : (_message$transferData8 = _message$transferData7.transferredTo) === null || _message$transferData8 === void 0 ? void 0 : _message$transferData8.name) || (message === null || message === void 0 ? void 0 : (_message$transferData9 = message.transferData) === null || _message$transferData9 === void 0 ? void 0 : (_message$transferData10 = _message$transferData9.transferredTo) === null || _message$transferData10 === void 0 ? void 0 : _message$transferData10.username) || '',\n              duration: comment\n            });\n          },\n          autoTransferUnansweredChatsToQueue: () => t(\"Livechat_transfer_return_to_the_queue_auto_transfer_unanswered_chat\", {\n            from,\n            duration: comment\n          })\n        };\n        return {\n          transfer: transferTypes[message.transferData.scope]()\n        };\n      }\n    });\n    MessageTypes.registerType({\n      id: 'livechat_transcript_history',\n      system: true,\n      message: 'Livechat_chat_transcript_sent',\n      data(message) {\n        if (!message.requestData) {\n          return {\n            transcript: ''\n          };\n        }\n        const {\n          requestData: {\n            type,\n            visitor,\n            user\n          } = {\n            type: 'user'\n          }\n        } = message;\n        const requestTypes = {\n          visitor: () => t('Livechat_visitor_transcript_request', {\n            guest: (visitor === null || visitor === void 0 ? void 0 : visitor.name) || (visitor === null || visitor === void 0 ? void 0 : visitor.username) || ''\n          }),\n          user: () => t('Livechat_user_sent_chat_transcript_to_visitor', {\n            agent: (user === null || user === void 0 ? void 0 : user.name) || (user === null || user === void 0 ? void 0 : user.username) || '',\n            guest: (visitor === null || visitor === void 0 ? void 0 : visitor.name) || (visitor === null || visitor === void 0 ? void 0 : visitor.username) || ''\n          })\n        };\n        return {\n          transcript: requestTypes[type]()\n        };\n      }\n    });\n    MessageTypes.registerType({\n      id: 'livechat_video_call',\n      system: true,\n      message: 'New_videocall_request'\n    });\n    MessageTypes.registerType({\n      id: 'livechat_webrtc_video_call',\n      message: 'room_changed_type',\n      data(message) {\n        if (message.msg === 'ended' && message.webRtcCallEndTs && message.ts) {\n          return {\n            message: t('WebRTC_call_ended_message', {\n              callDuration: formatDistance(new Date(message.webRtcCallEndTs), new Date(message.ts)),\n              endTime: moment(message.webRtcCallEndTs).format('h:mm A')\n            })\n          };\n        }\n        if (message.msg === 'declined' && message.webRtcCallEndTs) {\n          return {\n            message: t('WebRTC_call_declined_message')\n          };\n        }\n        return {\n          message: escapeHTML(message.msg)\n        };\n      }\n    });\n    MessageTypes.registerType({\n      id: 'omnichannel_placed_chat_on_hold',\n      system: true,\n      message: 'Omnichannel_placed_chat_on_hold',\n      data(message) {\n        return {\n          comment: message.comment ? message.comment : 'No comment provided'\n        };\n      }\n    });\n    MessageTypes.registerType({\n      id: 'omnichannel_on_hold_chat_resumed',\n      system: true,\n      message: 'Omnichannel_on_hold_chat_resumed',\n      data(message) {\n        return {\n          comment: message.comment ? message.comment : 'No comment provided'\n        };\n      }\n    });\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["_objectSpread","module","link","default","v","escapeHTML","formatDistance","moment","MessageTypes","t","__reifyWaitForDeps__","registerType","id","system","message","data","history","navigation","concat","page","title","location","href","transferData","transfer","comment","commentLabel","from","transferredBy","name","username","transferTypes","agent","_message$transferData","_message$transferData2","_message$transferData3","_message$transferData4","to","transferredTo","department","_message$transferData5","_message$transferData6","nextDepartment","queue","autoTransferUnansweredChatsToAgent","_message$transferData7","_message$transferData8","_message$transferData9","_message$transferData10","duration","autoTransferUnansweredChatsToQueue","scope","requestData","transcript","type","visitor","user","requestTypes","guest","msg","webRtcCallEndTs","ts","callDuration","Date","endTime","format","__reify_async_result__","_reifyError","self","async"],"sources":["app/livechat/lib/messageTypes.ts"],"sourcesContent":["import type { IOmnichannelSystemMessage } from '@rocket.chat/core-typings';\nimport { escapeHTML } from '@rocket.chat/string-helpers';\nimport formatDistance from 'date-fns/formatDistance';\nimport moment from 'moment';\n\nimport { MessageTypes } from '../../ui-utils/lib/MessageTypes';\nimport { t } from '../../utils/lib/i18n';\n\nMessageTypes.registerType({\n\tid: 'livechat_navigation_history',\n\tsystem: true,\n\tmessage: 'New_visitor_navigation',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\thistory: message.navigation\n\t\t\t\t? `${(message.navigation.page.title ? `${message.navigation.page.title} - ` : '') + message.navigation.page.location.href}`\n\t\t\t\t: '',\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_transfer_history',\n\tsystem: true,\n\tmessage: 'New_chat_transfer',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\tif (!message.transferData) {\n\t\t\treturn {\n\t\t\t\ttransfer: '',\n\t\t\t};\n\t\t}\n\n\t\tconst { comment } = message.transferData;\n\t\tconst commentLabel = comment && comment !== '' ? '_with_a_comment' : '';\n\t\tconst from =\n\t\t\tmessage.transferData.transferredBy && (message.transferData.transferredBy.name || message.transferData.transferredBy.username);\n\t\tconst transferTypes = {\n\t\t\tagent: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_agent${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.transferredTo?.name || message?.transferData?.transferredTo?.username || '',\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tdepartment: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_department${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.nextDepartment?.name || '',\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tqueue: (): string =>\n\t\t\t\tt(`Livechat_transfer_return_to_the_queue${commentLabel}`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\t...(comment && { comment }),\n\t\t\t\t}),\n\t\t\tautoTransferUnansweredChatsToAgent: (): string =>\n\t\t\t\tt(`Livechat_transfer_to_agent_auto_transfer_unanswered_chat`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tto: message?.transferData?.transferredTo?.name || message?.transferData?.transferredTo?.username || '',\n\t\t\t\t\tduration: comment,\n\t\t\t\t}),\n\t\t\tautoTransferUnansweredChatsToQueue: (): string =>\n\t\t\t\tt(`Livechat_transfer_return_to_the_queue_auto_transfer_unanswered_chat`, {\n\t\t\t\t\tfrom,\n\t\t\t\t\tduration: comment,\n\t\t\t\t}),\n\t\t};\n\t\treturn {\n\t\t\ttransfer: transferTypes[message.transferData.scope](),\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_transcript_history',\n\tsystem: true,\n\tmessage: 'Livechat_chat_transcript_sent',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\tif (!message.requestData) {\n\t\t\treturn {\n\t\t\t\ttranscript: '',\n\t\t\t};\n\t\t}\n\n\t\tconst { requestData: { type, visitor, user } = { type: 'user' } } = message;\n\t\tconst requestTypes = {\n\t\t\tvisitor: (): string =>\n\t\t\t\tt('Livechat_visitor_transcript_request', {\n\t\t\t\t\tguest: visitor?.name || visitor?.username || '',\n\t\t\t\t}),\n\t\t\tuser: (): string =>\n\t\t\t\tt('Livechat_user_sent_chat_transcript_to_visitor', {\n\t\t\t\t\tagent: user?.name || user?.username || '',\n\t\t\t\t\tguest: visitor?.name || visitor?.username || '',\n\t\t\t\t}),\n\t\t};\n\n\t\treturn {\n\t\t\ttranscript: requestTypes[type](),\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_video_call',\n\tsystem: true,\n\tmessage: 'New_videocall_request',\n});\n\nMessageTypes.registerType({\n\tid: 'livechat_webrtc_video_call',\n\tmessage: 'room_changed_type',\n\tdata(message) {\n\t\tif (message.msg === 'ended' && message.webRtcCallEndTs && message.ts) {\n\t\t\treturn {\n\t\t\t\tmessage: t('WebRTC_call_ended_message', {\n\t\t\t\t\tcallDuration: formatDistance(new Date(message.webRtcCallEndTs), new Date(message.ts)),\n\t\t\t\t\tendTime: moment(message.webRtcCallEndTs).format('h:mm A'),\n\t\t\t\t}),\n\t\t\t};\n\t\t}\n\t\tif (message.msg === 'declined' && message.webRtcCallEndTs) {\n\t\t\treturn {\n\t\t\t\tmessage: t('WebRTC_call_declined_message'),\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tmessage: escapeHTML(message.msg),\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'omnichannel_placed_chat_on_hold',\n\tsystem: true,\n\tmessage: 'Omnichannel_placed_chat_on_hold',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\tcomment: message.comment ? message.comment : 'No comment provided',\n\t\t};\n\t},\n});\n\nMessageTypes.registerType({\n\tid: 'omnichannel_on_hold_chat_resumed',\n\tsystem: true,\n\tmessage: 'Omnichannel_on_hold_chat_resumed',\n\tdata(message: IOmnichannelSystemMessage) {\n\t\treturn {\n\t\t\tcomment: message.comment ? message.comment : 'No comment provided',\n\t\t};\n\t},\n});\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"3c210648589e3a3c9fabfcae935a56cff9d7f391"}
