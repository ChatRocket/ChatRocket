{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/Omnichannel/modals/CloseChatModal.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/components/Omnichannel/modals/CloseChatModal.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/Omnichannel/modals/CloseChatModal.tsx","inputSourceMap":{"version":3,"file":"client/components/Omnichannel/modals/CloseChatModal.tsx","sourceRoot":"","sources":["client/components/Omnichannel/modals/CloseChatModal.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { ILivechatDepartment, Serialized } from '@rocket.chat/core-typings';\nimport {\n\tField,\n\tFieldGroup,\n\tButton,\n\tTextInput,\n\tModal,\n\tBox,\n\tCheckBox,\n\tDivider,\n\tEmailInput,\n\tFieldLabel,\n\tFieldRow,\n\tFieldError,\n} from '@rocket.chat/fuselage';\nimport { usePermission, useSetting, useTranslation, useUserPreference } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useState, useEffect, useMemo } from 'react';\nimport { useForm } from 'react-hook-form';\n\nimport { useHasLicenseModule } from '../../../hooks/useHasLicenseModule';\nimport { dispatchToastMessage } from '../../../lib/toast';\nimport GenericModal from '../../GenericModal';\nimport Tags from '../Tags';\n\nconst CloseChatModal = ({\n\tdepartment,\n\tvisitorEmail,\n\tonCancel,\n\tonConfirm,\n}: {\n\tdepartment?: Serialized<ILivechatDepartment | null>;\n\tvisitorEmail?: string;\n\tonCancel: () => void;\n\tonConfirm: (\n\t\tcomment?: string,\n\t\ttags?: string[],\n\t\tpreferences?: { omnichannelTranscriptPDF: boolean; omnichannelTranscriptEmail: boolean },\n\t\trequestData?: { email: string; subject: string },\n\t) => Promise<void>;\n}): ReactElement => {\n\tconst t = useTranslation();\n\n\tconst {\n\t\tformState: { errors },\n\t\thandleSubmit,\n\t\tregister,\n\t\tsetError,\n\t\tsetFocus,\n\t\tsetValue,\n\t\twatch,\n\t} = useForm();\n\n\tconst commentRequired = useSetting('Livechat_request_comment_when_closing_conversation') as boolean;\n\tconst alwaysSendTranscript = useSetting<boolean>('Livechat_transcript_send_always');\n\tconst customSubject = useSetting<string>('Livechat_transcript_email_subject');\n\tconst [tagRequired, setTagRequired] = useState(false);\n\n\tconst tags = watch('tags');\n\tconst comment = watch('comment');\n\tconst transcriptEmail = watch('transcriptEmail');\n\tconst subject = watch('subject');\n\n\tconst userTranscriptEmail = useUserPreference<boolean>('omnichannelTranscriptEmail') ?? false;\n\tconst userTranscriptPDF = useUserPreference<boolean>('omnichannelTranscriptPDF') ?? false;\n\tconst hasLicense = useHasLicenseModule('livechat-enterprise');\n\tconst transcriptPDFPermission = usePermission('request-pdf-transcript');\n\tconst transcriptEmailPermission = usePermission('send-omnichannel-chat-transcript');\n\n\tconst canSendTranscriptEmail = transcriptEmailPermission && visitorEmail && !alwaysSendTranscript;\n\tconst canSendTranscriptPDF = transcriptPDFPermission && hasLicense;\n\tconst canSendTranscript = canSendTranscriptEmail || canSendTranscriptPDF;\n\n\tconst handleTags = (value: string[]): void => {\n\t\tsetValue('tags', value);\n\t};\n\n\tconst onSubmit = useCallback(\n\t\t({ comment, tags, transcriptPDF, transcriptEmail, subject }): void => {\n\t\t\tconst preferences = {\n\t\t\t\tomnichannelTranscriptPDF: !!transcriptPDF,\n\t\t\t\tomnichannelTranscriptEmail: alwaysSendTranscript ? true : !!transcriptEmail,\n\t\t\t};\n\t\t\tconst requestData = transcriptEmail && visitorEmail ? { email: visitorEmail, subject } : undefined;\n\n\t\t\tif (!comment?.trim() && commentRequired) {\n\t\t\t\tsetError('comment', { type: 'custom', message: t('Required_field', { field: t('Comment') }) });\n\t\t\t}\n\n\t\t\tif (transcriptEmail && !subject) {\n\t\t\t\tsetError('subject', { type: 'custom', message: t('Required_field', { field: t('Subject') }) });\n\t\t\t}\n\n\t\t\tif (!tags?.length && tagRequired) {\n\t\t\t\tsetError('tags', { type: 'custom', message: t('error-tags-must-be-assigned-before-closing-chat') });\n\t\t\t}\n\n\t\t\tif (!errors.comment || errors.tags) {\n\t\t\t\tonConfirm(comment, tags, preferences, requestData);\n\t\t\t}\n\t\t},\n\t\t[commentRequired, tagRequired, visitorEmail, errors, setError, t, onConfirm, alwaysSendTranscript],\n\t);\n\n\tconst cannotSubmit = useMemo(() => {\n\t\tconst cannotSendTag = (tagRequired && !tags?.length) || errors.tags;\n\t\tconst cannotSendComment = (commentRequired && !comment?.trim()) || errors.comment;\n\t\tconst cannotSendTranscriptEmail = transcriptEmail && (!visitorEmail || !subject);\n\n\t\treturn Boolean(cannotSendTag || cannotSendComment || cannotSendTranscriptEmail);\n\t}, [comment, commentRequired, errors, tagRequired, tags, transcriptEmail, visitorEmail, subject]);\n\n\tuseEffect(() => {\n\t\tif (department?.requestTagBeforeClosingChat) {\n\t\t\tsetTagRequired(true);\n\t\t}\n\t}, [department]);\n\n\tuseEffect(() => {\n\t\tif (commentRequired) {\n\t\t\tsetFocus('comment');\n\t\t}\n\t}, [commentRequired, setFocus]);\n\n\tuseEffect(() => {\n\t\tif (tagRequired) {\n\t\t\tregister('tags');\n\t\t}\n\t}, [register, tagRequired]);\n\n\tuseEffect(() => {\n\t\tif (transcriptEmail) {\n\t\t\tif (!visitorEmail) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Customer_without_registered_email') });\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetValue('subject', subject || customSubject || t('Transcript_of_your_livechat_conversation'));\n\t\t}\n\t}, [transcriptEmail, setValue, visitorEmail, subject, t, customSubject]);\n\n\tif (commentRequired || tagRequired || canSendTranscript) {\n\t\treturn (\n\t\t\t<Modal wrapperFunction={(props) => <Box is='form' onSubmit={handleSubmit(onSubmit)} {...props} data-qa-id='close-chat-modal' />}>\n\t\t\t\t<Modal.Header>\n\t\t\t\t\t<Modal.Icon name='baloon-close-top-right' />\n\t\t\t\t\t<Modal.Title>{t('Wrap_up_conversation')}</Modal.Title>\n\t\t\t\t\t<Modal.Close onClick={onCancel} />\n\t\t\t\t</Modal.Header>\n\t\t\t\t<Modal.Content fontScale='p2'>\n\t\t\t\t\t<Box color='annotation'>{t('Close_room_description')}</Box>\n\t\t\t\t\t<FieldGroup>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<FieldLabel required={commentRequired}>{t('Comment')}</FieldLabel>\n\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\t\t\t{...register('comment')}\n\t\t\t\t\t\t\t\t\terror={errors.comment && t('Required_field', { field: t('Comment') })}\n\t\t\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\t\t\tplaceholder={t('Please_add_a_comment')}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t<FieldError>{errors.comment?.message}</FieldError>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Tags tagRequired={tagRequired} tags={tags} handler={handleTags} {...(department && { department: department._id })} />\n\t\t\t\t\t\t\t<FieldError>{errors.tags?.message}</FieldError>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t{canSendTranscript && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t\t\t<Divider />\n\t\t\t\t\t\t\t\t\t<FieldLabel marginBlockStart={8}>{t('Chat_transcript')}</FieldLabel>\n\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t{canSendTranscriptPDF && (\n\t\t\t\t\t\t\t\t\t<Field marginBlockStart={10}>\n\t\t\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t<FieldLabel htmlFor='transcript-pdf'>{t('Omnichannel_transcript_pdf')}</FieldLabel>\n\t\t\t\t\t\t\t\t\t\t\t<CheckBox id='transcript-pdf' {...register('transcriptPDF', { value: userTranscriptPDF })} />\n\t\t\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{canSendTranscriptEmail && (\n\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t<Field marginBlockStart={10}>\n\t\t\t\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t<FieldLabel htmlFor='transcript-email'>{t('Omnichannel_transcript_email')}</FieldLabel>\n\t\t\t\t\t\t\t\t\t\t\t\t<CheckBox id='transcript-email' {...register('transcriptEmail', { value: userTranscriptEmail })} />\n\t\t\t\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t\t\t{transcriptEmail && (\n\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t<Field marginBlockStart={14}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldLabel required>{t('Contact_email')}</FieldLabel>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<EmailInput value={visitorEmail} required disabled flexGrow={1} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t\t\t\t\t<Field marginBlockStart={12}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldLabel required>{t('Subject')}</FieldLabel>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{...register('subject', { required: true })}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName='active'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\terror={errors.subject && t('Required_field', { field: t('Subject') })}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldError>{errors.subject?.message}</FieldError>\n\t\t\t\t\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t<Field marginBlockStart={16}>\n\t\t\t\t\t\t\t\t\t<FieldLabel color='annotation' fontScale='c1'>\n\t\t\t\t\t\t\t\t\t\t{canSendTranscriptPDF && canSendTranscriptEmail\n\t\t\t\t\t\t\t\t\t\t\t? t('These_options_affect_this_conversation_only_To_set_default_selections_go_to_My_Account_Omnichannel')\n\t\t\t\t\t\t\t\t\t\t\t: t('This_option_affect_this_conversation_only_To_set_default_selection_go_to_My_Account_Omnichannel')}\n\t\t\t\t\t\t\t\t\t</FieldLabel>\n\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</FieldGroup>\n\t\t\t\t</Modal.Content>\n\t\t\t\t<Modal.Footer>\n\t\t\t\t\t<Modal.FooterControllers>\n\t\t\t\t\t\t<Button onClick={onCancel}>{t('Cancel')}</Button>\n\t\t\t\t\t\t<Button type='submit' disabled={cannotSubmit} primary>\n\t\t\t\t\t\t\t{t('Confirm')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</Modal.FooterControllers>\n\t\t\t\t</Modal.Footer>\n\t\t\t</Modal>\n\t\t);\n\t}\n\n\treturn (\n\t\t<GenericModal\n\t\t\tvariant='warning'\n\t\t\ttitle={t('Are_you_sure_you_want_to_close_this_chat')}\n\t\t\tonConfirm={(): Promise<void> => onConfirm()}\n\t\t\tonCancel={onCancel}\n\t\t\tonClose={onCancel}\n\t\t\tconfirmText={t('Confirm')}\n\t\t/>\n\t);\n};\n\nexport default CloseChatModal;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/Omnichannel/modals/CloseChatModal.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/components/Omnichannel/modals/CloseChatModal.tsx","inputSourceMap":{"version":3,"file":"client/components/Omnichannel/modals/CloseChatModal.tsx","sourceRoot":"","sources":["client/components/Omnichannel/modals/CloseChatModal.tsx"],"names":[],"mappings":"AACA,OAAO,EACN,KAAK,EACL,UAAU,EACV,MAAM,EACN,SAAS,EACT,KAAK,EACL,GAAG,EACH,QAAQ,EACR,OAAO,EACP,UAAU,EACV,UAAU,EACV,QAAQ,EACR,UAAU,GACV,MAAM,uBAAuB,CAAC;AAC/B,OAAO,EAAE,aAAa,EAAE,UAAU,EAAE,cAAc,EAAE,iBAAiB,EAAE,MAAM,0BAA0B,CAAC;AAExG,OAAO,KAAK,EAAE,EAAE,WAAW,EAAE,QAAQ,EAAE,SAAS,EAAE,OAAO,EAAE,MAAM,OAAO,CAAC;AACzE,OAAO,EAAE,OAAO,EAAE,MAAM,iBAAiB,CAAC;AAE1C,OAAO,EAAE,mBAAmB,EAAE,MAAM,oCAAoC,CAAC;AACzE,OAAO,EAAE,oBAAoB,EAAE,MAAM,oBAAoB,CAAC;AAC1D,OAAO,YAAY,MAAM,oBAAoB,CAAC;AAC9C,OAAO,IAAI,MAAM,SAAS,CAAC;AAE3B,MAAM,cAAc,GAAG,CAAC,EACvB,UAAU,EACV,YAAY,EACZ,QAAQ,EACR,SAAS,GAWT,EAAgB,EAAE;IAClB,MAAM,CAAC,GAAG,cAAc,EAAE,CAAC;IAE3B,MAAM,EACL,SAAS,EAAE,EAAE,MAAM,EAAE,EACrB,YAAY,EACZ,QAAQ,EACR,QAAQ,EACR,QAAQ,EACR,QAAQ,EACR,KAAK,GACL,GAAG,OAAO,EAAE,CAAC;IAEd,MAAM,eAAe,GAAG,UAAU,CAAC,oDAAoD,CAAY,CAAC;IACpG,MAAM,oBAAoB,GAAG,UAAU,CAAU,iCAAiC,CAAC,CAAC;IACpF,MAAM,aAAa,GAAG,UAAU,CAAS,mCAAmC,CAAC,CAAC;IAC9E,MAAM,CAAC,WAAW,EAAE,cAAc,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;IAEtD,MAAM,IAAI,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC;IAC3B,MAAM,OAAO,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC;IACjC,MAAM,eAAe,GAAG,KAAK,CAAC,iBAAiB,CAAC,CAAC;IACjD,MAAM,OAAO,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC;IAEjC,MAAM,mBAAmB,GAAG,iBAAiB,CAAU,4BAA4B,CAAC,IAAI,KAAK,CAAC;IAC9F,MAAM,iBAAiB,GAAG,iBAAiB,CAAU,0BAA0B,CAAC,IAAI,KAAK,CAAC;IAC1F,MAAM,UAAU,GAAG,mBAAmB,CAAC,qBAAqB,CAAC,CAAC;IAC9D,MAAM,uBAAuB,GAAG,aAAa,CAAC,wBAAwB,CAAC,CAAC;IACxE,MAAM,yBAAyB,GAAG,aAAa,CAAC,kCAAkC,CAAC,CAAC;IAEpF,MAAM,sBAAsB,GAAG,yBAAyB,IAAI,YAAY,IAAI,CAAC,oBAAoB,CAAC;IAClG,MAAM,oBAAoB,GAAG,uBAAuB,IAAI,UAAU,CAAC;IACnE,MAAM,iBAAiB,GAAG,sBAAsB,IAAI,oBAAoB,CAAC;IAEzE,MAAM,UAAU,GAAG,CAAC,KAAe,EAAQ,EAAE;QAC5C,QAAQ,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;IACzB,CAAC,CAAC;IAEF,MAAM,QAAQ,GAAG,WAAW,CAC3B,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,aAAa,EAAE,eAAe,EAAE,OAAO,EAAE,EAAQ,EAAE;QACpE,MAAM,WAAW,GAAG;YACnB,wBAAwB,EAAE,CAAC,CAAC,aAAa;YACzC,0BAA0B,EAAE,oBAAoB,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,eAAe;SAC3E,CAAC;QACF,MAAM,WAAW,GAAG,eAAe,IAAI,YAAY,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,YAAY,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;QAEnG,IAAI,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,eAAe,EAAE,CAAC;YACzC,QAAQ,CAAC,SAAS,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,CAAC,CAAC,gBAAgB,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;QAChG,CAAC;QAED,IAAI,eAAe,IAAI,CAAC,OAAO,EAAE,CAAC;YACjC,QAAQ,CAAC,SAAS,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,CAAC,CAAC,gBAAgB,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;QAChG,CAAC;QAED,IAAI,CAAC,IAAI,EAAE,MAAM,IAAI,WAAW,EAAE,CAAC;YAClC,QAAQ,CAAC,MAAM,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,OAAO,EAAE,CAAC,CAAC,iDAAiD,CAAC,EAAE,CAAC,CAAC;QACrG,CAAC;QAED,IAAI,CAAC,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,IAAI,EAAE,CAAC;YACpC,SAAS,CAAC,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,WAAW,CAAC,CAAC;QACpD,CAAC;IACF,CAAC,EACD,CAAC,eAAe,EAAE,WAAW,EAAE,YAAY,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC,EAAE,SAAS,EAAE,oBAAoB,CAAC,CAClG,CAAC;IAEF,MAAM,YAAY,GAAG,OAAO,CAAC,GAAG,EAAE;QACjC,MAAM,aAAa,GAAG,CAAC,WAAW,IAAI,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,MAAM,CAAC,IAAI,CAAC;QACpE,MAAM,iBAAiB,GAAG,CAAC,eAAe,IAAI,CAAC,OAAO,EAAE,IAAI,EAAE,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC;QAClF,MAAM,yBAAyB,GAAG,eAAe,IAAI,CAAC,CAAC,YAAY,IAAI,CAAC,OAAO,CAAC,CAAC;QAEjF,OAAO,OAAO,CAAC,aAAa,IAAI,iBAAiB,IAAI,yBAAyB,CAAC,CAAC;IACjF,CAAC,EAAE,CAAC,OAAO,EAAE,eAAe,EAAE,MAAM,EAAE,WAAW,EAAE,IAAI,EAAE,eAAe,EAAE,YAAY,EAAE,OAAO,CAAC,CAAC,CAAC;IAElG,SAAS,CAAC,GAAG,EAAE;QACd,IAAI,UAAU,EAAE,2BAA2B,EAAE,CAAC;YAC7C,cAAc,CAAC,IAAI,CAAC,CAAC;QACtB,CAAC;IACF,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC,CAAC;IAEjB,SAAS,CAAC,GAAG,EAAE;QACd,IAAI,eAAe,EAAE,CAAC;YACrB,QAAQ,CAAC,SAAS,CAAC,CAAC;QACrB,CAAC;IACF,CAAC,EAAE,CAAC,eAAe,EAAE,QAAQ,CAAC,CAAC,CAAC;IAEhC,SAAS,CAAC,GAAG,EAAE;QACd,IAAI,WAAW,EAAE,CAAC;YACjB,QAAQ,CAAC,MAAM,CAAC,CAAC;QAClB,CAAC;IACF,CAAC,EAAE,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC,CAAC;IAE5B,SAAS,CAAC,GAAG,EAAE;QACd,IAAI,eAAe,EAAE,CAAC;YACrB,IAAI,CAAC,YAAY,EAAE,CAAC;gBACnB,oBAAoB,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,CAAC,CAAC,mCAAmC,CAAC,EAAE,CAAC,CAAC;gBACzF,OAAO;YACR,CAAC;YACD,QAAQ,CAAC,SAAS,EAAE,OAAO,IAAI,aAAa,IAAI,CAAC,CAAC,0CAA0C,CAAC,CAAC,CAAC;QAChG,CAAC;IACF,CAAC,EAAE,CAAC,eAAe,EAAE,QAAQ,EAAE,YAAY,EAAE,OAAO,EAAE,CAAC,EAAE,aAAa,CAAC,CAAC,CAAC;IAEzE,IAAI,eAAe,IAAI,WAAW,IAAI,iBAAiB,EAAE,CAAC;QACzD,OAAO,CACN,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,UAAU,CAAC,kBAAkB,EAAG,CAAC,CAC/H;IAAA,CAAC,KAAK,CAAC,MAAM,CACZ;KAAA,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,wBAAwB,EACzC;KAAA,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,sBAAsB,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,CACrD;KAAA,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,QAAQ,CAAC,EAChC;IAAA,EAAE,KAAK,CAAC,MAAM,CACd;IAAA,CAAC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAC5B;KAAA,CAAC,GAAG,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,wBAAwB,CAAC,CAAC,EAAE,GAAG,CAC1D;KAAA,CAAC,UAAU,CACV;MAAA,CAAC,KAAK,CACL;OAAA,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,UAAU,CACjE;OAAA,CAAC,QAAQ,CACR;QAAA,CAAC,SAAS,CACT,IAAI,QAAQ,CAAC,SAAS,CAAC,CAAC,CACxB,KAAK,CAAC,CAAC,MAAM,CAAC,OAAO,IAAI,CAAC,CAAC,gBAAgB,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,CACtE,QAAQ,CAAC,CAAC,CAAC,CAAC,CACZ,WAAW,CAAC,CAAC,CAAC,CAAC,sBAAsB,CAAC,CAAC,EAEzC;OAAA,EAAE,QAAQ,CACV;OAAA,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,UAAU,CAClD;MAAA,EAAE,KAAK,CACP;MAAA,CAAC,KAAK,CACL;OAAA,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,UAAU,IAAI,EAAE,UAAU,EAAE,UAAU,CAAC,GAAG,EAAE,CAAC,CAAC,EACpH;OAAA,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,EAAE,UAAU,CAC/C;MAAA,EAAE,KAAK,CACP;MAAA,CAAC,iBAAiB,IAAI,CACrB,EACC;QAAA,CAAC,KAAK,CACL;SAAA,CAAC,OAAO,CAAC,AAAD,EACR;SAAA,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,iBAAiB,CAAC,CAAC,EAAE,UAAU,CACpE;QAAA,EAAE,KAAK,CACP;QAAA,CAAC,oBAAoB,IAAI,CACxB,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,CAC3B;UAAA,CAAC,QAAQ,CACR;WAAA,CAAC,UAAU,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,4BAA4B,CAAC,CAAC,EAAE,UAAU,CAClF;WAAA,CAAC,QAAQ,CAAC,EAAE,CAAC,gBAAgB,CAAC,IAAI,QAAQ,CAAC,eAAe,EAAE,EAAE,KAAK,EAAE,iBAAiB,EAAE,CAAC,CAAC,EAC3F;UAAA,EAAE,QAAQ,CACX;SAAA,EAAE,KAAK,CAAC,CACR,CACD;QAAA,CAAC,sBAAsB,IAAI,CAC1B,EACC;UAAA,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,CAC3B;WAAA,CAAC,QAAQ,CACR;YAAA,CAAC,UAAU,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC,8BAA8B,CAAC,CAAC,EAAE,UAAU,CACtF;YAAA,CAAC,QAAQ,CAAC,EAAE,CAAC,kBAAkB,CAAC,IAAI,QAAQ,CAAC,iBAAiB,EAAE,EAAE,KAAK,EAAE,mBAAmB,EAAE,CAAC,CAAC,EACjG;WAAA,EAAE,QAAQ,CACX;UAAA,EAAE,KAAK,CACP;UAAA,CAAC,eAAe,IAAI,CACnB,EACC;YAAA,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,CAC3B;aAAA,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,EAAE,UAAU,CACrD;aAAA,CAAC,QAAQ,CACR;cAAA,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,EAChE;aAAA,EAAE,QAAQ,CACX;YAAA,EAAE,KAAK,CACP;YAAA,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,CAC3B;aAAA,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,UAAU,CAC/C;aAAA,CAAC,QAAQ,CACR;cAAA,CAAC,SAAS,CACT,IAAI,QAAQ,CAAC,SAAS,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC,CAC5C,SAAS,CAAC,QAAQ,CAClB,KAAK,CAAC,CAAC,MAAM,CAAC,OAAO,IAAI,CAAC,CAAC,gBAAgB,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,CACtE,QAAQ,CAAC,CAAC,CAAC,CAAC,EAEd;aAAA,EAAE,QAAQ,CACV;aAAA,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,UAAU,CAClD;YAAA,EAAE,KAAK,CACR;WAAA,GAAG,CACH,CACF;SAAA,GAAG,CACH,CACD;QAAA,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,CAC3B;SAAA,CAAC,UAAU,CAAC,KAAK,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,CAC5C;UAAA,CAAC,oBAAoB,IAAI,sBAAsB;oBAC9C,CAAC,CAAC,CAAC,CAAC,oGAAoG,CAAC;oBACzG,CAAC,CAAC,CAAC,CAAC,iGAAiG,CAAC,CACxG;SAAA,EAAE,UAAU,CACb;QAAA,EAAE,KAAK,CACR;OAAA,GAAG,CACH,CACF;KAAA,EAAE,UAAU,CACb;IAAA,EAAE,KAAK,CAAC,OAAO,CACf;IAAA,CAAC,KAAK,CAAC,MAAM,CACZ;KAAA,CAAC,KAAK,CAAC,iBAAiB,CACvB;MAAA,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,MAAM,CAChD;MAAA,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,YAAY,CAAC,CAAC,OAAO,CACpD;OAAA,CAAC,CAAC,CAAC,SAAS,CAAC,CACd;MAAA,EAAE,MAAM,CACT;KAAA,EAAE,KAAK,CAAC,iBAAiB,CAC1B;IAAA,EAAE,KAAK,CAAC,MAAM,CACf;GAAA,EAAE,KAAK,CAAC,CACR,CAAC;IACH,CAAC;IAED,OAAO,CACN,CAAC,YAAY,CACZ,OAAO,CAAC,SAAS,CACjB,KAAK,CAAC,CAAC,CAAC,CAAC,0CAA0C,CAAC,CAAC,CACrD,SAAS,CAAC,CAAC,GAAkB,EAAE,CAAC,SAAS,EAAE,CAAC,CAC5C,QAAQ,CAAC,CAAC,QAAQ,CAAC,CACnB,OAAO,CAAC,CAAC,QAAQ,CAAC,CAClB,WAAW,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,EACzB,CACF,CAAC;AACH,CAAC,CAAC;AAEF,eAAe,cAAc,CAAC","sourcesContent":["import type { ILivechatDepartment, Serialized } from '@rocket.chat/core-typings';\nimport {\n\tField,\n\tFieldGroup,\n\tButton,\n\tTextInput,\n\tModal,\n\tBox,\n\tCheckBox,\n\tDivider,\n\tEmailInput,\n\tFieldLabel,\n\tFieldRow,\n\tFieldError,\n} from '@rocket.chat/fuselage';\nimport { usePermission, useSetting, useTranslation, useUserPreference } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useState, useEffect, useMemo } from 'react';\nimport { useForm } from 'react-hook-form';\n\nimport { useHasLicenseModule } from '../../../hooks/useHasLicenseModule';\nimport { dispatchToastMessage } from '../../../lib/toast';\nimport GenericModal from '../../GenericModal';\nimport Tags from '../Tags';\n\nconst CloseChatModal = ({\n\tdepartment,\n\tvisitorEmail,\n\tonCancel,\n\tonConfirm,\n}: {\n\tdepartment?: Serialized<ILivechatDepartment | null>;\n\tvisitorEmail?: string;\n\tonCancel: () => void;\n\tonConfirm: (\n\t\tcomment?: string,\n\t\ttags?: string[],\n\t\tpreferences?: { omnichannelTranscriptPDF: boolean; omnichannelTranscriptEmail: boolean },\n\t\trequestData?: { email: string; subject: string },\n\t) => Promise<void>;\n}): ReactElement => {\n\tconst t = useTranslation();\n\n\tconst {\n\t\tformState: { errors },\n\t\thandleSubmit,\n\t\tregister,\n\t\tsetError,\n\t\tsetFocus,\n\t\tsetValue,\n\t\twatch,\n\t} = useForm();\n\n\tconst commentRequired = useSetting('Livechat_request_comment_when_closing_conversation') as boolean;\n\tconst alwaysSendTranscript = useSetting<boolean>('Livechat_transcript_send_always');\n\tconst customSubject = useSetting<string>('Livechat_transcript_email_subject');\n\tconst [tagRequired, setTagRequired] = useState(false);\n\n\tconst tags = watch('tags');\n\tconst comment = watch('comment');\n\tconst transcriptEmail = watch('transcriptEmail');\n\tconst subject = watch('subject');\n\n\tconst userTranscriptEmail = useUserPreference<boolean>('omnichannelTranscriptEmail') ?? false;\n\tconst userTranscriptPDF = useUserPreference<boolean>('omnichannelTranscriptPDF') ?? false;\n\tconst hasLicense = useHasLicenseModule('livechat-enterprise');\n\tconst transcriptPDFPermission = usePermission('request-pdf-transcript');\n\tconst transcriptEmailPermission = usePermission('send-omnichannel-chat-transcript');\n\n\tconst canSendTranscriptEmail = transcriptEmailPermission && visitorEmail && !alwaysSendTranscript;\n\tconst canSendTranscriptPDF = transcriptPDFPermission && hasLicense;\n\tconst canSendTranscript = canSendTranscriptEmail || canSendTranscriptPDF;\n\n\tconst handleTags = (value: string[]): void => {\n\t\tsetValue('tags', value);\n\t};\n\n\tconst onSubmit = useCallback(\n\t\t({ comment, tags, transcriptPDF, transcriptEmail, subject }): void => {\n\t\t\tconst preferences = {\n\t\t\t\tomnichannelTranscriptPDF: !!transcriptPDF,\n\t\t\t\tomnichannelTranscriptEmail: alwaysSendTranscript ? true : !!transcriptEmail,\n\t\t\t};\n\t\t\tconst requestData = transcriptEmail && visitorEmail ? { email: visitorEmail, subject } : undefined;\n\n\t\t\tif (!comment?.trim() && commentRequired) {\n\t\t\t\tsetError('comment', { type: 'custom', message: t('Required_field', { field: t('Comment') }) });\n\t\t\t}\n\n\t\t\tif (transcriptEmail && !subject) {\n\t\t\t\tsetError('subject', { type: 'custom', message: t('Required_field', { field: t('Subject') }) });\n\t\t\t}\n\n\t\t\tif (!tags?.length && tagRequired) {\n\t\t\t\tsetError('tags', { type: 'custom', message: t('error-tags-must-be-assigned-before-closing-chat') });\n\t\t\t}\n\n\t\t\tif (!errors.comment || errors.tags) {\n\t\t\t\tonConfirm(comment, tags, preferences, requestData);\n\t\t\t}\n\t\t},\n\t\t[commentRequired, tagRequired, visitorEmail, errors, setError, t, onConfirm, alwaysSendTranscript],\n\t);\n\n\tconst cannotSubmit = useMemo(() => {\n\t\tconst cannotSendTag = (tagRequired && !tags?.length) || errors.tags;\n\t\tconst cannotSendComment = (commentRequired && !comment?.trim()) || errors.comment;\n\t\tconst cannotSendTranscriptEmail = transcriptEmail && (!visitorEmail || !subject);\n\n\t\treturn Boolean(cannotSendTag || cannotSendComment || cannotSendTranscriptEmail);\n\t}, [comment, commentRequired, errors, tagRequired, tags, transcriptEmail, visitorEmail, subject]);\n\n\tuseEffect(() => {\n\t\tif (department?.requestTagBeforeClosingChat) {\n\t\t\tsetTagRequired(true);\n\t\t}\n\t}, [department]);\n\n\tuseEffect(() => {\n\t\tif (commentRequired) {\n\t\t\tsetFocus('comment');\n\t\t}\n\t}, [commentRequired, setFocus]);\n\n\tuseEffect(() => {\n\t\tif (tagRequired) {\n\t\t\tregister('tags');\n\t\t}\n\t}, [register, tagRequired]);\n\n\tuseEffect(() => {\n\t\tif (transcriptEmail) {\n\t\t\tif (!visitorEmail) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Customer_without_registered_email') });\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetValue('subject', subject || customSubject || t('Transcript_of_your_livechat_conversation'));\n\t\t}\n\t}, [transcriptEmail, setValue, visitorEmail, subject, t, customSubject]);\n\n\tif (commentRequired || tagRequired || canSendTranscript) {\n\t\treturn (\n\t\t\t<Modal wrapperFunction={(props) => <Box is='form' onSubmit={handleSubmit(onSubmit)} {...props} data-qa-id='close-chat-modal' />}>\n\t\t\t\t<Modal.Header>\n\t\t\t\t\t<Modal.Icon name='baloon-close-top-right' />\n\t\t\t\t\t<Modal.Title>{t('Wrap_up_conversation')}</Modal.Title>\n\t\t\t\t\t<Modal.Close onClick={onCancel} />\n\t\t\t\t</Modal.Header>\n\t\t\t\t<Modal.Content fontScale='p2'>\n\t\t\t\t\t<Box color='annotation'>{t('Close_room_description')}</Box>\n\t\t\t\t\t<FieldGroup>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<FieldLabel required={commentRequired}>{t('Comment')}</FieldLabel>\n\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\t\t\t{...register('comment')}\n\t\t\t\t\t\t\t\t\terror={errors.comment && t('Required_field', { field: t('Comment') })}\n\t\t\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\t\t\tplaceholder={t('Please_add_a_comment')}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t<FieldError>{errors.comment?.message}</FieldError>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Tags tagRequired={tagRequired} tags={tags} handler={handleTags} {...(department && { department: department._id })} />\n\t\t\t\t\t\t\t<FieldError>{errors.tags?.message}</FieldError>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t{canSendTranscript && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t\t\t<Divider />\n\t\t\t\t\t\t\t\t\t<FieldLabel marginBlockStart={8}>{t('Chat_transcript')}</FieldLabel>\n\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t{canSendTranscriptPDF && (\n\t\t\t\t\t\t\t\t\t<Field marginBlockStart={10}>\n\t\t\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t<FieldLabel htmlFor='transcript-pdf'>{t('Omnichannel_transcript_pdf')}</FieldLabel>\n\t\t\t\t\t\t\t\t\t\t\t<CheckBox id='transcript-pdf' {...register('transcriptPDF', { value: userTranscriptPDF })} />\n\t\t\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{canSendTranscriptEmail && (\n\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t<Field marginBlockStart={10}>\n\t\t\t\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t<FieldLabel htmlFor='transcript-email'>{t('Omnichannel_transcript_email')}</FieldLabel>\n\t\t\t\t\t\t\t\t\t\t\t\t<CheckBox id='transcript-email' {...register('transcriptEmail', { value: userTranscriptEmail })} />\n\t\t\t\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t\t\t{transcriptEmail && (\n\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t<Field marginBlockStart={14}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldLabel required>{t('Contact_email')}</FieldLabel>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<EmailInput value={visitorEmail} required disabled flexGrow={1} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t\t\t\t\t<Field marginBlockStart={12}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldLabel required>{t('Subject')}</FieldLabel>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{...register('subject', { required: true })}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName='active'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\terror={errors.subject && t('Required_field', { field: t('Subject') })}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldError>{errors.subject?.message}</FieldError>\n\t\t\t\t\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t<Field marginBlockStart={16}>\n\t\t\t\t\t\t\t\t\t<FieldLabel color='annotation' fontScale='c1'>\n\t\t\t\t\t\t\t\t\t\t{canSendTranscriptPDF && canSendTranscriptEmail\n\t\t\t\t\t\t\t\t\t\t\t? t('These_options_affect_this_conversation_only_To_set_default_selections_go_to_My_Account_Omnichannel')\n\t\t\t\t\t\t\t\t\t\t\t: t('This_option_affect_this_conversation_only_To_set_default_selection_go_to_My_Account_Omnichannel')}\n\t\t\t\t\t\t\t\t\t</FieldLabel>\n\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</FieldGroup>\n\t\t\t\t</Modal.Content>\n\t\t\t\t<Modal.Footer>\n\t\t\t\t\t<Modal.FooterControllers>\n\t\t\t\t\t\t<Button onClick={onCancel}>{t('Cancel')}</Button>\n\t\t\t\t\t\t<Button type='submit' disabled={cannotSubmit} primary>\n\t\t\t\t\t\t\t{t('Confirm')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</Modal.FooterControllers>\n\t\t\t\t</Modal.Footer>\n\t\t\t</Modal>\n\t\t);\n\t}\n\n\treturn (\n\t\t<GenericModal\n\t\t\tvariant='warning'\n\t\t\ttitle={t('Are_you_sure_you_want_to_close_this_chat')}\n\t\t\tonConfirm={(): Promise<void> => onConfirm()}\n\t\t\tonCancel={onCancel}\n\t\t\tonClose={onCancel}\n\t\t\tconfirmText={t('Confirm')}\n\t\t/>\n\t);\n};\n\nexport default CloseChatModal;\n"]}}},"code":"var _extends;\nmodule.link(\"@babel/runtime/helpers/extends\", {\n  default: function (v) {\n    _extends = v;\n  }\n}, 0);\nvar _slicedToArray;\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 1);\nvar Field, FieldGroup, Button, TextInput, Modal, Box, CheckBox, Divider, EmailInput, FieldLabel, FieldRow, FieldError;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Field: function (v) {\n    Field = v;\n  },\n  FieldGroup: function (v) {\n    FieldGroup = v;\n  },\n  Button: function (v) {\n    Button = v;\n  },\n  TextInput: function (v) {\n    TextInput = v;\n  },\n  Modal: function (v) {\n    Modal = v;\n  },\n  Box: function (v) {\n    Box = v;\n  },\n  CheckBox: function (v) {\n    CheckBox = v;\n  },\n  Divider: function (v) {\n    Divider = v;\n  },\n  EmailInput: function (v) {\n    EmailInput = v;\n  },\n  FieldLabel: function (v) {\n    FieldLabel = v;\n  },\n  FieldRow: function (v) {\n    FieldRow = v;\n  },\n  FieldError: function (v) {\n    FieldError = v;\n  }\n}, 0);\nvar usePermission, useSetting, useTranslation, useUserPreference;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  usePermission: function (v) {\n    usePermission = v;\n  },\n  useSetting: function (v) {\n    useSetting = v;\n  },\n  useTranslation: function (v) {\n    useTranslation = v;\n  },\n  useUserPreference: function (v) {\n    useUserPreference = v;\n  }\n}, 1);\nvar React, useCallback, useState, useEffect, useMemo;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useCallback: function (v) {\n    useCallback = v;\n  },\n  useState: function (v) {\n    useState = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useMemo: function (v) {\n    useMemo = v;\n  }\n}, 2);\nvar useForm;\nmodule.link(\"react-hook-form\", {\n  useForm: function (v) {\n    useForm = v;\n  }\n}, 3);\nvar useHasLicenseModule;\nmodule.link(\"../../../hooks/useHasLicenseModule\", {\n  useHasLicenseModule: function (v) {\n    useHasLicenseModule = v;\n  }\n}, 4);\nvar dispatchToastMessage;\nmodule.link(\"../../../lib/toast\", {\n  dispatchToastMessage: function (v) {\n    dispatchToastMessage = v;\n  }\n}, 5);\nvar GenericModal;\nmodule.link(\"../../GenericModal\", {\n  \"default\": function (v) {\n    GenericModal = v;\n  }\n}, 6);\nvar Tags;\nmodule.link(\"../Tags\", {\n  \"default\": function (v) {\n    Tags = v;\n  }\n}, 7);\nvar CloseChatModal = function (_ref) {\n  var _useUserPreference, _useUserPreference2;\n  var department = _ref.department,\n    visitorEmail = _ref.visitorEmail,\n    onCancel = _ref.onCancel,\n    onConfirm = _ref.onConfirm;\n  var t = useTranslation();\n  var _useForm = useForm(),\n    errors = _useForm.formState.errors,\n    handleSubmit = _useForm.handleSubmit,\n    register = _useForm.register,\n    setError = _useForm.setError,\n    setFocus = _useForm.setFocus,\n    setValue = _useForm.setValue,\n    watch = _useForm.watch;\n  var commentRequired = useSetting('Livechat_request_comment_when_closing_conversation');\n  var alwaysSendTranscript = useSetting('Livechat_transcript_send_always');\n  var customSubject = useSetting('Livechat_transcript_email_subject');\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    tagRequired = _useState2[0],\n    setTagRequired = _useState2[1];\n  var tags = watch('tags');\n  var comment = watch('comment');\n  var transcriptEmail = watch('transcriptEmail');\n  var subject = watch('subject');\n  var userTranscriptEmail = (_useUserPreference = useUserPreference('omnichannelTranscriptEmail')) !== null && _useUserPreference !== void 0 ? _useUserPreference : false;\n  var userTranscriptPDF = (_useUserPreference2 = useUserPreference('omnichannelTranscriptPDF')) !== null && _useUserPreference2 !== void 0 ? _useUserPreference2 : false;\n  var hasLicense = useHasLicenseModule('livechat-enterprise');\n  var transcriptPDFPermission = usePermission('request-pdf-transcript');\n  var transcriptEmailPermission = usePermission('send-omnichannel-chat-transcript');\n  var canSendTranscriptEmail = transcriptEmailPermission && visitorEmail && !alwaysSendTranscript;\n  var canSendTranscriptPDF = transcriptPDFPermission && hasLicense;\n  var canSendTranscript = canSendTranscriptEmail || canSendTranscriptPDF;\n  var handleTags = function (value) {\n    setValue('tags', value);\n  };\n  var onSubmit = useCallback(function (_ref2) {\n    var comment = _ref2.comment,\n      tags = _ref2.tags,\n      transcriptPDF = _ref2.transcriptPDF,\n      transcriptEmail = _ref2.transcriptEmail,\n      subject = _ref2.subject;\n    var preferences = {\n      omnichannelTranscriptPDF: !!transcriptPDF,\n      omnichannelTranscriptEmail: alwaysSendTranscript ? true : !!transcriptEmail\n    };\n    var requestData = transcriptEmail && visitorEmail ? {\n      email: visitorEmail,\n      subject: subject\n    } : undefined;\n    if (!(comment !== null && comment !== void 0 && comment.trim()) && commentRequired) {\n      setError('comment', {\n        type: 'custom',\n        message: t('Required_field', {\n          field: t('Comment')\n        })\n      });\n    }\n    if (transcriptEmail && !subject) {\n      setError('subject', {\n        type: 'custom',\n        message: t('Required_field', {\n          field: t('Subject')\n        })\n      });\n    }\n    if (!(tags !== null && tags !== void 0 && tags.length) && tagRequired) {\n      setError('tags', {\n        type: 'custom',\n        message: t('error-tags-must-be-assigned-before-closing-chat')\n      });\n    }\n    if (!errors.comment || errors.tags) {\n      onConfirm(comment, tags, preferences, requestData);\n    }\n  }, [commentRequired, tagRequired, visitorEmail, errors, setError, t, onConfirm, alwaysSendTranscript]);\n  var cannotSubmit = useMemo(function () {\n    var cannotSendTag = tagRequired && !(tags !== null && tags !== void 0 && tags.length) || errors.tags;\n    var cannotSendComment = commentRequired && !(comment !== null && comment !== void 0 && comment.trim()) || errors.comment;\n    var cannotSendTranscriptEmail = transcriptEmail && (!visitorEmail || !subject);\n    return Boolean(cannotSendTag || cannotSendComment || cannotSendTranscriptEmail);\n  }, [comment, commentRequired, errors, tagRequired, tags, transcriptEmail, visitorEmail, subject]);\n  useEffect(function () {\n    if (department !== null && department !== void 0 && department.requestTagBeforeClosingChat) {\n      setTagRequired(true);\n    }\n  }, [department]);\n  useEffect(function () {\n    if (commentRequired) {\n      setFocus('comment');\n    }\n  }, [commentRequired, setFocus]);\n  useEffect(function () {\n    if (tagRequired) {\n      register('tags');\n    }\n  }, [register, tagRequired]);\n  useEffect(function () {\n    if (transcriptEmail) {\n      if (!visitorEmail) {\n        dispatchToastMessage({\n          type: 'error',\n          message: t('Customer_without_registered_email')\n        });\n        return;\n      }\n      setValue('subject', subject || customSubject || t('Transcript_of_your_livechat_conversation'));\n    }\n  }, [transcriptEmail, setValue, visitorEmail, subject, t, customSubject]);\n  if (commentRequired || tagRequired || canSendTranscript) {\n    var _errors$comment, _errors$tags, _errors$subject;\n    return /*#__PURE__*/React.createElement(Modal, {\n      wrapperFunction: function (props) {\n        return /*#__PURE__*/React.createElement(Box, _extends({\n          is: \"form\",\n          onSubmit: handleSubmit(onSubmit)\n        }, props, {\n          \"data-qa-id\": \"close-chat-modal\"\n        }));\n      }\n    }, /*#__PURE__*/React.createElement(Modal.Header, null, /*#__PURE__*/React.createElement(Modal.Icon, {\n      name: \"baloon-close-top-right\"\n    }), /*#__PURE__*/React.createElement(Modal.Title, null, t('Wrap_up_conversation')), /*#__PURE__*/React.createElement(Modal.Close, {\n      onClick: onCancel\n    })), /*#__PURE__*/React.createElement(Modal.Content, {\n      fontScale: \"p2\"\n    }, /*#__PURE__*/React.createElement(Box, {\n      color: \"annotation\"\n    }, t('Close_room_description')), /*#__PURE__*/React.createElement(FieldGroup, null, /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(FieldLabel, {\n      required: commentRequired\n    }, t('Comment')), /*#__PURE__*/React.createElement(FieldRow, null, /*#__PURE__*/React.createElement(TextInput, _extends({}, register('comment'), {\n      error: errors.comment && t('Required_field', {\n        field: t('Comment')\n      }),\n      flexGrow: 1,\n      placeholder: t('Please_add_a_comment')\n    }))), /*#__PURE__*/React.createElement(FieldError, null, (_errors$comment = errors.comment) === null || _errors$comment === void 0 ? void 0 : _errors$comment.message)), /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Tags, _extends({\n      tagRequired: tagRequired,\n      tags: tags,\n      handler: handleTags\n    }, department && {\n      department: department._id\n    })), /*#__PURE__*/React.createElement(FieldError, null, (_errors$tags = errors.tags) === null || _errors$tags === void 0 ? void 0 : _errors$tags.message)), canSendTranscript && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Field, null, /*#__PURE__*/React.createElement(Divider, null), /*#__PURE__*/React.createElement(FieldLabel, {\n      marginBlockStart: 8\n    }, t('Chat_transcript'))), canSendTranscriptPDF && /*#__PURE__*/React.createElement(Field, {\n      marginBlockStart: 10\n    }, /*#__PURE__*/React.createElement(FieldRow, null, /*#__PURE__*/React.createElement(FieldLabel, {\n      htmlFor: \"transcript-pdf\"\n    }, t('Omnichannel_transcript_pdf')), /*#__PURE__*/React.createElement(CheckBox, _extends({\n      id: \"transcript-pdf\"\n    }, register('transcriptPDF', {\n      value: userTranscriptPDF\n    }))))), canSendTranscriptEmail && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Field, {\n      marginBlockStart: 10\n    }, /*#__PURE__*/React.createElement(FieldRow, null, /*#__PURE__*/React.createElement(FieldLabel, {\n      htmlFor: \"transcript-email\"\n    }, t('Omnichannel_transcript_email')), /*#__PURE__*/React.createElement(CheckBox, _extends({\n      id: \"transcript-email\"\n    }, register('transcriptEmail', {\n      value: userTranscriptEmail\n    }))))), transcriptEmail && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Field, {\n      marginBlockStart: 14\n    }, /*#__PURE__*/React.createElement(FieldLabel, {\n      required: true\n    }, t('Contact_email')), /*#__PURE__*/React.createElement(FieldRow, null, /*#__PURE__*/React.createElement(EmailInput, {\n      value: visitorEmail,\n      required: true,\n      disabled: true,\n      flexGrow: 1\n    }))), /*#__PURE__*/React.createElement(Field, {\n      marginBlockStart: 12\n    }, /*#__PURE__*/React.createElement(FieldLabel, {\n      required: true\n    }, t('Subject')), /*#__PURE__*/React.createElement(FieldRow, null, /*#__PURE__*/React.createElement(TextInput, _extends({}, register('subject', {\n      required: true\n    }), {\n      className: \"active\",\n      error: errors.subject && t('Required_field', {\n        field: t('Subject')\n      }),\n      flexGrow: 1\n    }))), /*#__PURE__*/React.createElement(FieldError, null, (_errors$subject = errors.subject) === null || _errors$subject === void 0 ? void 0 : _errors$subject.message)))), /*#__PURE__*/React.createElement(Field, {\n      marginBlockStart: 16\n    }, /*#__PURE__*/React.createElement(FieldLabel, {\n      color: \"annotation\",\n      fontScale: \"c1\"\n    }, canSendTranscriptPDF && canSendTranscriptEmail ? t('These_options_affect_this_conversation_only_To_set_default_selections_go_to_My_Account_Omnichannel') : t('This_option_affect_this_conversation_only_To_set_default_selection_go_to_My_Account_Omnichannel')))))), /*#__PURE__*/React.createElement(Modal.Footer, null, /*#__PURE__*/React.createElement(Modal.FooterControllers, null, /*#__PURE__*/React.createElement(Button, {\n      onClick: onCancel\n    }, t('Cancel')), /*#__PURE__*/React.createElement(Button, {\n      type: \"submit\",\n      disabled: cannotSubmit,\n      primary: true\n    }, t('Confirm')))));\n  }\n  return /*#__PURE__*/React.createElement(GenericModal, {\n    variant: \"warning\",\n    title: t('Are_you_sure_you_want_to_close_this_chat'),\n    onConfirm: function () {\n      return onConfirm();\n    },\n    onCancel: onCancel,\n    onClose: onCancel,\n    confirmText: t('Confirm')\n  });\n};\nmodule.exportDefault(CloseChatModal);","map":{"version":3,"names":["_extends","module","link","default","v","_slicedToArray","Field","FieldGroup","Button","TextInput","Modal","Box","CheckBox","Divider","EmailInput","FieldLabel","FieldRow","FieldError","usePermission","useSetting","useTranslation","useUserPreference","React","useCallback","useState","useEffect","useMemo","useForm","useHasLicenseModule","dispatchToastMessage","GenericModal","Tags","CloseChatModal","_ref","_useUserPreference","_useUserPreference2","department","visitorEmail","onCancel","onConfirm","t","_useForm","errors","formState","handleSubmit","register","setError","setFocus","setValue","watch","commentRequired","alwaysSendTranscript","customSubject","_useState","_useState2","tagRequired","setTagRequired","tags","comment","transcriptEmail","subject","userTranscriptEmail","userTranscriptPDF","hasLicense","transcriptPDFPermission","transcriptEmailPermission","canSendTranscriptEmail","canSendTranscriptPDF","canSendTranscript","handleTags","value","onSubmit","_ref2","transcriptPDF","preferences","omnichannelTranscriptPDF","omnichannelTranscriptEmail","requestData","email","undefined","trim","type","message","field","length","cannotSubmit","cannotSendTag","cannotSendComment","cannotSendTranscriptEmail","Boolean","requestTagBeforeClosingChat","_errors$comment","_errors$tags","_errors$subject","createElement","wrapperFunction","props","is","Header","Icon","name","Title","Close","onClick","Content","fontScale","color","required","error","flexGrow","placeholder","handler","_id","Fragment","marginBlockStart","htmlFor","id","disabled","className","Footer","FooterControllers","primary","variant","title","onClose","confirmText","exportDefault"],"sources":["client/components/Omnichannel/modals/CloseChatModal.tsx"],"sourcesContent":["import type { ILivechatDepartment, Serialized } from '@rocket.chat/core-typings';\nimport {\n\tField,\n\tFieldGroup,\n\tButton,\n\tTextInput,\n\tModal,\n\tBox,\n\tCheckBox,\n\tDivider,\n\tEmailInput,\n\tFieldLabel,\n\tFieldRow,\n\tFieldError,\n} from '@rocket.chat/fuselage';\nimport { usePermission, useSetting, useTranslation, useUserPreference } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useState, useEffect, useMemo } from 'react';\nimport { useForm } from 'react-hook-form';\n\nimport { useHasLicenseModule } from '../../../hooks/useHasLicenseModule';\nimport { dispatchToastMessage } from '../../../lib/toast';\nimport GenericModal from '../../GenericModal';\nimport Tags from '../Tags';\n\nconst CloseChatModal = ({\n\tdepartment,\n\tvisitorEmail,\n\tonCancel,\n\tonConfirm,\n}: {\n\tdepartment?: Serialized<ILivechatDepartment | null>;\n\tvisitorEmail?: string;\n\tonCancel: () => void;\n\tonConfirm: (\n\t\tcomment?: string,\n\t\ttags?: string[],\n\t\tpreferences?: { omnichannelTranscriptPDF: boolean; omnichannelTranscriptEmail: boolean },\n\t\trequestData?: { email: string; subject: string },\n\t) => Promise<void>;\n}): ReactElement => {\n\tconst t = useTranslation();\n\n\tconst {\n\t\tformState: { errors },\n\t\thandleSubmit,\n\t\tregister,\n\t\tsetError,\n\t\tsetFocus,\n\t\tsetValue,\n\t\twatch,\n\t} = useForm();\n\n\tconst commentRequired = useSetting('Livechat_request_comment_when_closing_conversation') as boolean;\n\tconst alwaysSendTranscript = useSetting<boolean>('Livechat_transcript_send_always');\n\tconst customSubject = useSetting<string>('Livechat_transcript_email_subject');\n\tconst [tagRequired, setTagRequired] = useState(false);\n\n\tconst tags = watch('tags');\n\tconst comment = watch('comment');\n\tconst transcriptEmail = watch('transcriptEmail');\n\tconst subject = watch('subject');\n\n\tconst userTranscriptEmail = useUserPreference<boolean>('omnichannelTranscriptEmail') ?? false;\n\tconst userTranscriptPDF = useUserPreference<boolean>('omnichannelTranscriptPDF') ?? false;\n\tconst hasLicense = useHasLicenseModule('livechat-enterprise');\n\tconst transcriptPDFPermission = usePermission('request-pdf-transcript');\n\tconst transcriptEmailPermission = usePermission('send-omnichannel-chat-transcript');\n\n\tconst canSendTranscriptEmail = transcriptEmailPermission && visitorEmail && !alwaysSendTranscript;\n\tconst canSendTranscriptPDF = transcriptPDFPermission && hasLicense;\n\tconst canSendTranscript = canSendTranscriptEmail || canSendTranscriptPDF;\n\n\tconst handleTags = (value: string[]): void => {\n\t\tsetValue('tags', value);\n\t};\n\n\tconst onSubmit = useCallback(\n\t\t({ comment, tags, transcriptPDF, transcriptEmail, subject }): void => {\n\t\t\tconst preferences = {\n\t\t\t\tomnichannelTranscriptPDF: !!transcriptPDF,\n\t\t\t\tomnichannelTranscriptEmail: alwaysSendTranscript ? true : !!transcriptEmail,\n\t\t\t};\n\t\t\tconst requestData = transcriptEmail && visitorEmail ? { email: visitorEmail, subject } : undefined;\n\n\t\t\tif (!comment?.trim() && commentRequired) {\n\t\t\t\tsetError('comment', { type: 'custom', message: t('Required_field', { field: t('Comment') }) });\n\t\t\t}\n\n\t\t\tif (transcriptEmail && !subject) {\n\t\t\t\tsetError('subject', { type: 'custom', message: t('Required_field', { field: t('Subject') }) });\n\t\t\t}\n\n\t\t\tif (!tags?.length && tagRequired) {\n\t\t\t\tsetError('tags', { type: 'custom', message: t('error-tags-must-be-assigned-before-closing-chat') });\n\t\t\t}\n\n\t\t\tif (!errors.comment || errors.tags) {\n\t\t\t\tonConfirm(comment, tags, preferences, requestData);\n\t\t\t}\n\t\t},\n\t\t[commentRequired, tagRequired, visitorEmail, errors, setError, t, onConfirm, alwaysSendTranscript],\n\t);\n\n\tconst cannotSubmit = useMemo(() => {\n\t\tconst cannotSendTag = (tagRequired && !tags?.length) || errors.tags;\n\t\tconst cannotSendComment = (commentRequired && !comment?.trim()) || errors.comment;\n\t\tconst cannotSendTranscriptEmail = transcriptEmail && (!visitorEmail || !subject);\n\n\t\treturn Boolean(cannotSendTag || cannotSendComment || cannotSendTranscriptEmail);\n\t}, [comment, commentRequired, errors, tagRequired, tags, transcriptEmail, visitorEmail, subject]);\n\n\tuseEffect(() => {\n\t\tif (department?.requestTagBeforeClosingChat) {\n\t\t\tsetTagRequired(true);\n\t\t}\n\t}, [department]);\n\n\tuseEffect(() => {\n\t\tif (commentRequired) {\n\t\t\tsetFocus('comment');\n\t\t}\n\t}, [commentRequired, setFocus]);\n\n\tuseEffect(() => {\n\t\tif (tagRequired) {\n\t\t\tregister('tags');\n\t\t}\n\t}, [register, tagRequired]);\n\n\tuseEffect(() => {\n\t\tif (transcriptEmail) {\n\t\t\tif (!visitorEmail) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Customer_without_registered_email') });\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetValue('subject', subject || customSubject || t('Transcript_of_your_livechat_conversation'));\n\t\t}\n\t}, [transcriptEmail, setValue, visitorEmail, subject, t, customSubject]);\n\n\tif (commentRequired || tagRequired || canSendTranscript) {\n\t\treturn (\n\t\t\t<Modal wrapperFunction={(props) => <Box is='form' onSubmit={handleSubmit(onSubmit)} {...props} data-qa-id='close-chat-modal' />}>\n\t\t\t\t<Modal.Header>\n\t\t\t\t\t<Modal.Icon name='baloon-close-top-right' />\n\t\t\t\t\t<Modal.Title>{t('Wrap_up_conversation')}</Modal.Title>\n\t\t\t\t\t<Modal.Close onClick={onCancel} />\n\t\t\t\t</Modal.Header>\n\t\t\t\t<Modal.Content fontScale='p2'>\n\t\t\t\t\t<Box color='annotation'>{t('Close_room_description')}</Box>\n\t\t\t\t\t<FieldGroup>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<FieldLabel required={commentRequired}>{t('Comment')}</FieldLabel>\n\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\t\t\t{...register('comment')}\n\t\t\t\t\t\t\t\t\terror={errors.comment && t('Required_field', { field: t('Comment') })}\n\t\t\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\t\t\tplaceholder={t('Please_add_a_comment')}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t<FieldError>{errors.comment?.message}</FieldError>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t<Tags tagRequired={tagRequired} tags={tags} handler={handleTags} {...(department && { department: department._id })} />\n\t\t\t\t\t\t\t<FieldError>{errors.tags?.message}</FieldError>\n\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t{canSendTranscript && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Field>\n\t\t\t\t\t\t\t\t\t<Divider />\n\t\t\t\t\t\t\t\t\t<FieldLabel marginBlockStart={8}>{t('Chat_transcript')}</FieldLabel>\n\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t{canSendTranscriptPDF && (\n\t\t\t\t\t\t\t\t\t<Field marginBlockStart={10}>\n\t\t\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t<FieldLabel htmlFor='transcript-pdf'>{t('Omnichannel_transcript_pdf')}</FieldLabel>\n\t\t\t\t\t\t\t\t\t\t\t<CheckBox id='transcript-pdf' {...register('transcriptPDF', { value: userTranscriptPDF })} />\n\t\t\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{canSendTranscriptEmail && (\n\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t<Field marginBlockStart={10}>\n\t\t\t\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t<FieldLabel htmlFor='transcript-email'>{t('Omnichannel_transcript_email')}</FieldLabel>\n\t\t\t\t\t\t\t\t\t\t\t\t<CheckBox id='transcript-email' {...register('transcriptEmail', { value: userTranscriptEmail })} />\n\t\t\t\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t\t\t{transcriptEmail && (\n\t\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t\t<Field marginBlockStart={14}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldLabel required>{t('Contact_email')}</FieldLabel>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<EmailInput value={visitorEmail} required disabled flexGrow={1} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t\t\t\t\t<Field marginBlockStart={12}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldLabel required>{t('Subject')}</FieldLabel>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{...register('subject', { required: true })}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName='active'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\terror={errors.subject && t('Required_field', { field: t('Subject') })}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tflexGrow={1}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</FieldRow>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<FieldError>{errors.subject?.message}</FieldError>\n\t\t\t\t\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t<Field marginBlockStart={16}>\n\t\t\t\t\t\t\t\t\t<FieldLabel color='annotation' fontScale='c1'>\n\t\t\t\t\t\t\t\t\t\t{canSendTranscriptPDF && canSendTranscriptEmail\n\t\t\t\t\t\t\t\t\t\t\t? t('These_options_affect_this_conversation_only_To_set_default_selections_go_to_My_Account_Omnichannel')\n\t\t\t\t\t\t\t\t\t\t\t: t('This_option_affect_this_conversation_only_To_set_default_selection_go_to_My_Account_Omnichannel')}\n\t\t\t\t\t\t\t\t\t</FieldLabel>\n\t\t\t\t\t\t\t\t</Field>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</FieldGroup>\n\t\t\t\t</Modal.Content>\n\t\t\t\t<Modal.Footer>\n\t\t\t\t\t<Modal.FooterControllers>\n\t\t\t\t\t\t<Button onClick={onCancel}>{t('Cancel')}</Button>\n\t\t\t\t\t\t<Button type='submit' disabled={cannotSubmit} primary>\n\t\t\t\t\t\t\t{t('Confirm')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</Modal.FooterControllers>\n\t\t\t\t</Modal.Footer>\n\t\t\t</Modal>\n\t\t);\n\t}\n\n\treturn (\n\t\t<GenericModal\n\t\t\tvariant='warning'\n\t\t\ttitle={t('Are_you_sure_you_want_to_close_this_chat')}\n\t\t\tonConfirm={(): Promise<void> => onConfirm()}\n\t\t\tonCancel={onCancel}\n\t\t\tonClose={onCancel}\n\t\t\tconfirmText={t('Confirm')}\n\t\t/>\n\t);\n};\n\nexport default CloseChatModal;\n"],"mappings":"AACA,IAAAA,QACC;AAAAC,MACA,CAAAC,IAAA,iCAIG;EACHC,OAAA,EAAQ,SAAAA,CACDC,CAAA,EACP;IAAAJ,QAAA,GAAUI,CAAA;EAAA;AACV;AAAA,IAAAC,cAEA;AAAAJ,MAAA,CAAAC,IACA,uCAA8B;EAAAC,OAAA,WAAAA,CAAAC,CAAA;IAAAC,cAAA,GAAAD,CAAA;EAAA;AAAA;AAb/B,IAAAE,KACC,EAAAC,UACA,EAAAC,MAAU,EACVC,SACA,EAAAC,KAAA,EAAAC,GACA,EAAAC,QACA,EAAGC,OACH,EAAAC,UACA,EAAOC,UACP,EAAAC,QACA,EAAAC,UACA;AAAAhB,MACA,CAAAC,IAAA,wBACM;EAAAI,KAAA,WAAAA,CAAwBF,CAAA;IAAAE,KAAA,GAAAF,CAAA;EAAA;EAAAG,UAAA,WAAAA,CAAAH,CAAA;IAAAG,UAAA,GAAAH,CAAA;EAAA;EAAAI,MAAA,WAAAA,CAAAJ,CAAA;IAAAI,MAAA,GAAAJ,CAAA;EAAA;EAAAK,SAAA,WAAAA,CAAAL,CAAA;IAAAK,SAAA,GAAAL,CAAA;EAAA;EAAAM,KAAA,WAAAA,CAAAN,CAAA;IAAAM,KAAA,GAAAN,CAAA;EAAA;EAAAO,GAAA,WAAAA,CAAAP,CAAA;IAAAO,GAAA,GAAAP,CAAA;EAAA;EAAAQ,QAAA,WAAAA,CAAAR,CAAA;IAAAQ,QAAA,GAAAR,CAAA;EAAA;EAAAS,OAAA,WAAAA,CAAAT,CAAA;IAAAS,OAAA,GAAAT,CAAA;EAAA;EAAAU,UAAA,WAAAA,CAAAV,CAAA;IAAAU,UAAA,GAAAV,CAAA;EAAA;EAAAW,UAAA,WAAAA,CAAAX,CAAA;IAAAW,UAAA,GAAAX,CAAA;EAAA;EAAAY,QAAA,WAAAA,CAAAZ,CAAA;IAAAY,QAAA,GAAAZ,CAAA;EAAA;EAAAa,UAAA,WAAAA,CAAAb,CAAA;IAAAa,UAAA,GAAAb,CAAA;EAAA;AAAA;AAAA,IAAAc,aAAA,EAAAC,UAAA,EAAAC,cAAA,EAAAC,iBAAA;AAAApB,MAAA,CAAAC,IAAA;EAAAgB,aAAA,WAAAA,CAAAd,CAAA;IAAAc,aAAA,GAAAd,CAAA;EAAA;EAAAe,UAAA,WAAAA,CAAAf,CAAA;IAAAe,UAAA,GAAAf,CAAA;EAAA;EAAAgB,cAAA,WAAAA,CAAAhB,CAAA;IAAAgB,cAAA,GAAAhB,CAAA;EAAA;EAAAiB,iBAAA,WAAAA,CAAAjB,CAAA;IAAAiB,iBAAA,GAAAjB,CAAA;EAAA;AAAA;AAAA,IAAAkB,KAAA,EAAAC,WAAA,EAAAC,QAAA,EAAAC,SAAA,EAAAC,OAAA;AAAAzB,MAAA,CAAAC,IAAA;EAAA,oBAAAC,CAAAC,CAAA;IAAAkB,KAAA,GAAAlB,CAAA;EAAA;EAAAmB,WAAA,WAAAA,CAAAnB,CAAA;IAAAmB,WAAA,GAAAnB,CAAA;EAAA;EAAAoB,QAAA,WAAAA,CAAApB,CAAA;IAAAoB,QAAA,GAAApB,CAAA;EAAA;EAAAqB,SAAA,WAAAA,CAAArB,CAAA;IAAAqB,SAAA,GAAArB,CAAA;EAAA;EAAAsB,OAAA,WAAAA,CAAAtB,CAAA;IAAAsB,OAAA,GAAAtB,CAAA;EAAA;AAAA;AAAA,IAAAuB,OAAA;AAAA1B,MAAA,CAAAC,IAAA;EAAAyB,OAAA,WAAAA,CAAAvB,CAAA;IAAAuB,OAAA,GAAAvB,CAAA;EAAA;AAAA;AAAA,IAAAwB,mBAAA;AAAA3B,MAAA,CAAAC,IAAA;EAAA0B,mBAAA,WAAAA,CAAAxB,CAAA;IAAAwB,mBAAA,GAAAxB,CAAA;EAAA;AAAA;AAAA,IAAAyB,oBAAA;AAAA5B,MAAA,CAAAC,IAAA;EAAA2B,oBAAA,WAAAA,CAAAzB,CAAA;IAAAyB,oBAAA,GAAAzB,CAAA;EAAA;AAAA;AAAA,IAAA0B,YAAA;AAAA7B,MAAA,CAAAC,IAAA;EAAA,oBAAAC,CAAAC,CAAA;IAAA0B,YAAA,GAAA1B,CAAA;EAAA;AAAA;AAAA,IAAA2B,IAAA;AAAA9B,MAAA,CAAAC,IAAA;EAAA,oBAAAC,CAAAC,CAAA;IAAA2B,IAAA,GAAA3B,CAAA;EAAA;AAAA;AAW/B,IAAM4B,cAAc,GAAG,SAAAA,CAAAC,IAAA,EAeJ;EAAA,IAAAC,kBAAA,EAAAC,mBAAA;EAAA,IAdlBC,UAAU,GAAAH,IAAA,CAAVG,UAAU;IACVC,YAAY,GAAAJ,IAAA,CAAZI,YAAY;IACZC,QAAQ,GAAAL,IAAA,CAARK,QAAQ;IACRC,SAAS,GAAAN,IAAA,CAATM,SAAS;EAYT,IAAMC,CAAC,GAAGpB,cAAc,EAAE;EAE1B,IAAAqB,QAAA,GAQId,OAAO,EAAE;IAPCe,MAAM,GAAAD,QAAA,CAAnBE,SAAS,CAAID,MAAM;IACnBE,YAAY,GAAAH,QAAA,CAAZG,YAAY;IACZC,QAAQ,GAAAJ,QAAA,CAARI,QAAQ;IACRC,QAAQ,GAAAL,QAAA,CAARK,QAAQ;IACRC,QAAQ,GAAAN,QAAA,CAARM,QAAQ;IACRC,QAAQ,GAAAP,QAAA,CAARO,QAAQ;IACRC,KAAK,GAAAR,QAAA,CAALQ,KAAK;EAGN,IAAMC,eAAe,GAAG/B,UAAU,CAAC,oDAAoD,CAAY;EACnG,IAAMgC,oBAAoB,GAAGhC,UAAU,CAAU,iCAAiC,CAAC;EACnF,IAAMiC,aAAa,GAAGjC,UAAU,CAAS,mCAAmC,CAAC;EAC7E,IAAAkC,SAAA,GAAsC7B,QAAQ,CAAC,KAAK,CAAC;IAAA8B,UAAA,GAAAjD,cAAA,CAAAgD,SAAA;IAA9CE,WAAW,GAAAD,UAAA;IAAEE,cAAc,GAAAF,UAAA;EAElC,IAAMG,IAAI,GAAGR,KAAK,CAAC,MAAM,CAAC;EAC1B,IAAMS,OAAO,GAAGT,KAAK,CAAC,SAAS,CAAC;EAChC,IAAMU,eAAe,GAAGV,KAAK,CAAC,iBAAiB,CAAC;EAChD,IAAMW,OAAO,GAAGX,KAAK,CAAC,SAAS,CAAC;EAEhC,IAAMY,mBAAmB,IAAA3B,kBAAA,GAAGb,iBAAiB,CAAU,4BAA4B,CAAC,cAAAa,kBAAA,cAAAA,kBAAA,GAAI,KAAK;EAC7F,IAAM4B,iBAAiB,IAAA3B,mBAAA,GAAGd,iBAAiB,CAAU,0BAA0B,CAAC,cAAAc,mBAAA,cAAAA,mBAAA,GAAI,KAAK;EACzF,IAAM4B,UAAU,GAAGnC,mBAAmB,CAAC,qBAAqB,CAAC;EAC7D,IAAMoC,uBAAuB,GAAG9C,aAAa,CAAC,wBAAwB,CAAC;EACvE,IAAM+C,yBAAyB,GAAG/C,aAAa,CAAC,kCAAkC,CAAC;EAEnF,IAAMgD,sBAAsB,GAAGD,yBAAyB,IAAI5B,YAAY,IAAI,CAACc,oBAAoB;EACjG,IAAMgB,oBAAoB,GAAGH,uBAAuB,IAAID,UAAU;EAClE,IAAMK,iBAAiB,GAAGF,sBAAsB,IAAIC,oBAAoB;EAExE,IAAME,UAAU,GAAG,SAAAA,CAACC,KAAe,EAAU;IAC5CtB,QAAQ,CAAC,MAAM,EAAEsB,KAAK,CAAC;EACxB,CAAC;EAED,IAAMC,QAAQ,GAAGhD,WAAW,CAC3B,UAAAiD,KAAA,EAAqE;IAAA,IAAlEd,OAAO,GAAAc,KAAA,CAAPd,OAAO;MAAED,IAAI,GAAAe,KAAA,CAAJf,IAAI;MAAEgB,aAAa,GAAAD,KAAA,CAAbC,aAAa;MAAEd,eAAe,GAAAa,KAAA,CAAfb,eAAe;MAAEC,OAAO,GAAAY,KAAA,CAAPZ,OAAO;IACxD,IAAMc,WAAW,GAAG;MACnBC,wBAAwB,EAAE,CAAC,CAACF,aAAa;MACzCG,0BAA0B,EAAEzB,oBAAoB,GAAG,IAAI,GAAG,CAAC,CAACQ;KAC5D;IACD,IAAMkB,WAAW,GAAGlB,eAAe,IAAItB,YAAY,GAAG;MAAEyC,KAAK,EAAEzC,YAAY;MAAEuB,OAAO,EAAPA;IAAO,CAAE,GAAGmB,SAAS;IAElG,IAAI,EAACrB,OAAO,aAAPA,OAAO,eAAPA,OAAO,CAAEsB,IAAI,EAAE,KAAI9B,eAAe,EAAE;MACxCJ,QAAQ,CAAC,SAAS,EAAE;QAAEmC,IAAI,EAAE,QAAQ;QAAEC,OAAO,EAAE1C,CAAC,CAAC,gBAAgB,EAAE;UAAE2C,KAAK,EAAE3C,CAAC,CAAC,SAAS;QAAC,CAAE;MAAC,CAAE,CAAC;IAC/F;IAEA,IAAImB,eAAe,IAAI,CAACC,OAAO,EAAE;MAChCd,QAAQ,CAAC,SAAS,EAAE;QAAEmC,IAAI,EAAE,QAAQ;QAAEC,OAAO,EAAE1C,CAAC,CAAC,gBAAgB,EAAE;UAAE2C,KAAK,EAAE3C,CAAC,CAAC,SAAS;QAAC,CAAE;MAAC,CAAE,CAAC;IAC/F;IAEA,IAAI,EAACiB,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAE2B,MAAM,KAAI7B,WAAW,EAAE;MACjCT,QAAQ,CAAC,MAAM,EAAE;QAAEmC,IAAI,EAAE,QAAQ;QAAEC,OAAO,EAAE1C,CAAC,CAAC,iDAAiD;MAAC,CAAE,CAAC;IACpG;IAEA,IAAI,CAACE,MAAM,CAACgB,OAAO,IAAIhB,MAAM,CAACe,IAAI,EAAE;MACnClB,SAAS,CAACmB,OAAO,EAAED,IAAI,EAAEiB,WAAW,EAAEG,WAAW,CAAC;IACnD;EACD,CAAC,EACD,CAAC3B,eAAe,EAAEK,WAAW,EAAElB,YAAY,EAAEK,MAAM,EAAEI,QAAQ,EAAEN,CAAC,EAAED,SAAS,EAAEY,oBAAoB,CAAC,CAClG;EAED,IAAMkC,YAAY,GAAG3D,OAAO,CAAC,YAAK;IACjC,IAAM4D,aAAa,GAAI/B,WAAW,IAAI,EAACE,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAE2B,MAAM,KAAK1C,MAAM,CAACe,IAAI;IACnE,IAAM8B,iBAAiB,GAAIrC,eAAe,IAAI,EAACQ,OAAO,aAAPA,OAAO,eAAPA,OAAO,CAAEsB,IAAI,EAAE,KAAKtC,MAAM,CAACgB,OAAO;IACjF,IAAM8B,yBAAyB,GAAG7B,eAAe,KAAK,CAACtB,YAAY,IAAI,CAACuB,OAAO,CAAC;IAEhF,OAAO6B,OAAO,CAACH,aAAa,IAAIC,iBAAiB,IAAIC,yBAAyB,CAAC;EAChF,CAAC,EAAE,CAAC9B,OAAO,EAAER,eAAe,EAAER,MAAM,EAAEa,WAAW,EAAEE,IAAI,EAAEE,eAAe,EAAEtB,YAAY,EAAEuB,OAAO,CAAC,CAAC;EAEjGnC,SAAS,CAAC,YAAK;IACd,IAAIW,UAAU,aAAVA,UAAU,eAAVA,UAAU,CAAEsD,2BAA2B,EAAE;MAC5ClC,cAAc,CAAC,IAAI,CAAC;IACrB;EACD,CAAC,EAAE,CAACpB,UAAU,CAAC,CAAC;EAEhBX,SAAS,CAAC,YAAK;IACd,IAAIyB,eAAe,EAAE;MACpBH,QAAQ,CAAC,SAAS,CAAC;IACpB;EACD,CAAC,EAAE,CAACG,eAAe,EAAEH,QAAQ,CAAC,CAAC;EAE/BtB,SAAS,CAAC,YAAK;IACd,IAAI8B,WAAW,EAAE;MAChBV,QAAQ,CAAC,MAAM,CAAC;IACjB;EACD,CAAC,EAAE,CAACA,QAAQ,EAAEU,WAAW,CAAC,CAAC;EAE3B9B,SAAS,CAAC,YAAK;IACd,IAAIkC,eAAe,EAAE;MACpB,IAAI,CAACtB,YAAY,EAAE;QAClBR,oBAAoB,CAAC;UAAEoD,IAAI,EAAE,OAAO;UAAEC,OAAO,EAAE1C,CAAC,CAAC,mCAAmC;QAAC,CAAE,CAAC;QACxF;MACD;MACAQ,QAAQ,CAAC,SAAS,EAAEY,OAAO,IAAIR,aAAa,IAAIZ,CAAC,CAAC,0CAA0C,CAAC,CAAC;IAC/F;EACD,CAAC,EAAE,CAACmB,eAAe,EAAEX,QAAQ,EAAEX,YAAY,EAAEuB,OAAO,EAAEpB,CAAC,EAAEY,aAAa,CAAC,CAAC;EAExE,IAAIF,eAAe,IAAIK,WAAW,IAAIa,iBAAiB,EAAE;IAAA,IAAAuB,eAAA,EAAAC,YAAA,EAAAC,eAAA;IACxD,oBACCvE,KAAA,CAAAwE,aAAA,CAACpF,KAAK;MAACqF,eAAe,EAAE,SAAAA,CAACC,KAAK;QAAA,oBAAK1E,KAAA,CAAAwE,aAAA,CAACnF,GAAG,EAAAX,QAAA;UAACiG,EAAE,EAAC,MAAM;UAAC1B,QAAQ,EAAE3B,YAAY,CAAC2B,QAAQ;QAAE,GAAKyB,KAAK;UAAE,cAAW;QAAkB,GAAG;MAAA;IAAC,gBAC/H1E,KAAA,CAAAwE,aAAA,CAACpF,KAAK,CAACwF,MAAM,qBACZ5E,KAAA,CAAAwE,aAAA,CAACpF,KAAK,CAACyF,IAAI;MAACC,IAAI,EAAC;IAAwB,EACzC,eAAA9E,KAAA,CAAAwE,aAAA,CAACpF,KAAK,CAAC2F,KAAK,QAAE7D,CAAC,CAAC,sBAAsB,CAAe,CACrD,eAAAlB,KAAA,CAAAwE,aAAA,CAACpF,KAAK,CAAC4F,KAAK;MAACC,OAAO,EAAEjE;IAAS,EAClB,CACd,eAAAhB,KAAA,CAAAwE,aAAA,CAACpF,KAAK,CAAC8F,OAAO;MAACC,SAAS,EAAC;IAAI,gBAC5BnF,KAAA,CAAAwE,aAAA,CAACnF,GAAG;MAAC+F,KAAK,EAAC;IAAY,GAAElE,CAAC,CAAC,wBAAwB,CAAO,CAC1D,eAAAlB,KAAA,CAAAwE,aAAA,CAACvF,UAAU,qBACVe,KAAA,CAAAwE,aAAA,CAACxF,KAAK,qBACLgB,KAAA,CAAAwE,aAAA,CAAC/E,UAAU;MAAC4F,QAAQ,EAAEzD;IAAgB,GAAEV,CAAC,CAAC,SAAS,CAAc,CACjE,eAAAlB,KAAA,CAAAwE,aAAA,CAAC9E,QAAQ,qBACRM,KAAA,CAAAwE,aAAA,CAACrF,SAAS,EAAAT,QAAA,KACL6C,QAAQ,CAAC,SAAS,CAAC;MACvB+D,KAAK,EAAElE,MAAM,CAACgB,OAAO,IAAIlB,CAAC,CAAC,gBAAgB,EAAE;QAAE2C,KAAK,EAAE3C,CAAC,CAAC,SAAS;MAAC,CAAE,CAAE;MACtEqE,QAAQ,EAAE,CAAE;MACZC,WAAW,EAAEtE,CAAC,CAAC,sBAAsB;IAAE,GAE/B,CACV,eAAAlB,KAAA,CAAAwE,aAAA,CAAC7E,UAAU,SAAA0E,eAAA,GAAEjD,MAAM,CAACgB,OAAO,cAAAiC,eAAA,uBAAdA,eAAA,CAAgBT,OAAoB,CAC3C,CACP,eAAA5D,KAAA,CAAAwE,aAAA,CAACxF,KAAK,qBACLgB,KAAA,CAAAwE,aAAA,CAAC/D,IAAI,EAAA/B,QAAA;MAACuD,WAAW,EAAEA,WAAY;MAACE,IAAI,EAAEA,IAAK;MAACsD,OAAO,EAAE1C;IAAW,GAAMjC,UAAU,IAAI;MAAEA,UAAU,EAAEA,UAAU,CAAC4E;IAAG,CAAE,CAAE,CACpH,eAAA1F,KAAA,CAAAwE,aAAA,CAAC7E,UAAU,SAAA2E,YAAA,GAAElD,MAAM,CAACe,IAAI,cAAAmC,YAAA,uBAAXA,YAAA,CAAaV,OAAoB,CACxC,CACP,EAACd,iBAAiB,iBACjB9C,KAAA,CAAAwE,aAAA,CAAAxE,KAAA,CAAA2F,QAAA,qBACC3F,KAAA,CAAAwE,aAAA,CAACxF,KAAK,qBACLgB,KAAA,CAAAwE,aAAA,CAACjF,OAAO,OACR,eAAAS,KAAA,CAAAwE,aAAA,CAAC/E,UAAU;MAACmG,gBAAgB,EAAE;IAAE,GAAE1E,CAAC,CAAC,iBAAiB,CAAc,CAC7D,CACP,EAAC2B,oBAAoB,iBACpB7C,KAAA,CAAAwE,aAAA,CAACxF,KAAK;MAAC4G,gBAAgB,EAAE;IAAG,gBAC3B5F,KAAA,CAAAwE,aAAA,CAAC9E,QAAQ,qBACRM,KAAA,CAAAwE,aAAA,CAAC/E,UAAU;MAACoG,OAAO,EAAC;IAAgB,GAAE3E,CAAC,CAAC,4BAA4B,CAAc,CAClF,eAAAlB,KAAA,CAAAwE,aAAA,CAAClF,QAAQ,EAAAZ,QAAA;MAACoH,EAAE,EAAC;IAAgB,GAAKvE,QAAQ,CAAC,eAAe,EAAE;MAAEyB,KAAK,EAAER;IAAiB,CAAE,CAAC,CAAC,CACjF,CACJ,CACP,EACAI,sBAAsB,iBACtB5C,KAAA,CAAAwE,aAAA,CAAAxE,KAAA,CAAA2F,QAAA,qBACC3F,KAAA,CAAAwE,aAAA,CAACxF,KAAK;MAAC4G,gBAAgB,EAAE;IAAG,gBAC3B5F,KAAA,CAAAwE,aAAA,CAAC9E,QAAQ,qBACRM,KAAA,CAAAwE,aAAA,CAAC/E,UAAU;MAACoG,OAAO,EAAC;IAAkB,GAAE3E,CAAC,CAAC,8BAA8B,CAAc,CACtF,eAAAlB,KAAA,CAAAwE,aAAA,CAAClF,QAAQ,EAAAZ,QAAA;MAACoH,EAAE,EAAC;IAAkB,GAAKvE,QAAQ,CAAC,iBAAiB,EAAE;MAAEyB,KAAK,EAAET;IAAmB,CAAE,CAAC,CAAC,CACvF,CACJ,CACP,EAACF,eAAe,iBACfrC,KAAA,CAAAwE,aAAA,CAAAxE,KAAA,CAAA2F,QAAA,qBACC3F,KAAA,CAAAwE,aAAA,CAACxF,KAAK;MAAC4G,gBAAgB,EAAE;IAAG,gBAC3B5F,KAAA,CAAAwE,aAAA,CAAC/E,UAAU;MAAC4F,QAAQ;IAAA,GAAEnE,CAAC,CAAC,eAAe,CAAc,CACrD,eAAAlB,KAAA,CAAAwE,aAAA,CAAC9E,QAAQ,qBACRM,KAAA,CAAAwE,aAAA,CAAChF,UAAU;MAACwD,KAAK,EAAEjC,YAAa;MAACsE,QAAQ;MAACU,QAAQ;MAACR,QAAQ,EAAE;IAAE,EACtD,CACJ,CACP,eAAAvF,KAAA,CAAAwE,aAAA,CAACxF,KAAK;MAAC4G,gBAAgB,EAAE;IAAG,gBAC3B5F,KAAA,CAAAwE,aAAA,CAAC/E,UAAU;MAAC4F,QAAQ;IAAA,GAAEnE,CAAC,CAAC,SAAS,CAAc,CAC/C,eAAAlB,KAAA,CAAAwE,aAAA,CAAC9E,QAAQ,qBACRM,KAAA,CAAAwE,aAAA,CAACrF,SAAS,EAAAT,QAAA,KACL6C,QAAQ,CAAC,SAAS,EAAE;MAAE8D,QAAQ,EAAE;IAAI,CAAE,CAAC;MAC3CW,SAAS,EAAC,QAAQ;MAClBV,KAAK,EAAElE,MAAM,CAACkB,OAAO,IAAIpB,CAAC,CAAC,gBAAgB,EAAE;QAAE2C,KAAK,EAAE3C,CAAC,CAAC,SAAS;MAAC,CAAE,CAAE;MACtEqE,QAAQ,EAAE;IAAE,GAEJ,CACV,eAAAvF,KAAA,CAAAwE,aAAA,CAAC7E,UAAU,SAAA4E,eAAA,GAAEnD,MAAM,CAACkB,OAAO,cAAAiC,eAAA,uBAAdA,eAAA,CAAgBX,OAAoB,CAC3C,CACR,CAEF,CACA,eACD5D,KAAA,CAAAwE,aAAA,CAACxF,KAAK;MAAC4G,gBAAgB,EAAE;IAAG,gBAC3B5F,KAAA,CAAAwE,aAAA,CAAC/E,UAAU;MAAC2F,KAAK,EAAC,YAAY;MAACD,SAAS,EAAC;IAAI,GAC3CtC,oBAAoB,IAAID,sBAAsB,GAC5C1B,CAAC,CAAC,oGAAoG,CAAC,GACvGA,CAAC,CAAC,iGAAiG,CAC3F,CACN,CACR,CAEU,CACE,CACf,eAAAlB,KAAA,CAAAwE,aAAA,CAACpF,KAAK,CAAC6G,MAAM,qBACZjG,KAAA,CAAAwE,aAAA,CAACpF,KAAK,CAAC8G,iBAAiB,qBACvBlG,KAAA,CAAAwE,aAAA,CAACtF,MAAM;MAAC+F,OAAO,EAAEjE;IAAS,GAAEE,CAAC,CAAC,QAAQ,CAAU,CAChD,eAAAlB,KAAA,CAAAwE,aAAA,CAACtF,MAAM;MAACyE,IAAI,EAAC,QAAQ;MAACoC,QAAQ,EAAEhC,YAAa;MAACoC,OAAO;IAAA,GACnDjF,CAAC,CAAC,SAAS,CACL,CACgB,CACZ,CACR,CAAC;EAEV;EAEA,oBACClB,KAAA,CAAAwE,aAAA,CAAChE,YAAY;IACZ4F,OAAO,EAAC,SAAS;IACjBC,KAAK,EAAEnF,CAAC,CAAC,0CAA0C,CAAE;IACrDD,SAAS,EAAE,SAAAA,CAAA;MAAA,OAAqBA,SAAS,EAAE;IAAA,CAAC;IAC5CD,QAAQ,EAAEA,QAAS;IACnBsF,OAAO,EAAEtF,QAAS;IAClBuF,WAAW,EAAErF,CAAC,CAAC,SAAS;EAAE,EACzB;AAEJ,CAAC;AArPDvC,MAAA,CAAO6H,aAEN,CAqPc9F,cArPd","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"b1aae8f3ce9503565102f29d84198069f64f4a05"}
