{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-cached-collection/client/models/CachedCollectionManager.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"app/ui-cached-collection/client/models/CachedCollectionManager.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-cached-collection/client/models/CachedCollectionManager.ts","inputSourceMap":{"version":3,"file":"app/ui-cached-collection/client/models/CachedCollectionManager.ts","sourceRoot":"","sources":["app/ui-cached-collection/client/models/CachedCollectionManager.ts"],"names":[],"mappings":"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","sourcesContent":["import { Emitter } from '@rocket.chat/emitter';\nimport { Accounts } from 'meteor/accounts-base';\nimport { check } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport type { CachedCollection } from './CachedCollection';\n\nclass CachedCollectionManager extends Emitter<{ reconnect: void; login: string | null }> {\n\tprivate items: CachedCollection<any>[];\n\n\tprivate _syncEnabled: boolean;\n\n\tprivate logged: boolean;\n\n\tprivate step: number;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.items = [];\n\t\tthis._syncEnabled = false;\n\t\tthis.logged = false;\n\n\t\tconst { _unstoreLoginToken } = Accounts;\n\t\tAccounts._unstoreLoginToken = (...args) => {\n\t\t\t_unstoreLoginToken.apply(Accounts, args);\n\t\t\tthis.clearAllCacheOnLogout();\n\t\t};\n\n\t\tTracker.autorun(() => {\n\t\t\tconst [WAITING_FIRST_CONNECTION, WAITING_FIRST_DISCONNECTION, LISTENING_RECONNECTIONS] = [0, 1, 2];\n\t\t\tthis.step = this.step || WAITING_FIRST_CONNECTION;\n\t\t\tconst { connected } = Meteor.status();\n\t\t\tswitch (this.step) {\n\t\t\t\tcase WAITING_FIRST_CONNECTION:\n\t\t\t\t\treturn !connected || this.step++;\n\t\t\t\tcase WAITING_FIRST_DISCONNECTION:\n\t\t\t\t\treturn connected || this.step++;\n\t\t\t\tcase LISTENING_RECONNECTIONS:\n\t\t\t\t\treturn connected && this.emit('reconnect');\n\t\t\t}\n\t\t});\n\n\t\tAccounts.onLogin(() => {\n\t\t\tthis.emit('login', Meteor.userId());\n\t\t});\n\t\tTracker.autorun(() => {\n\t\t\tconst uid = Meteor.userId();\n\t\t\tthis.logged = uid !== null;\n\t\t});\n\t}\n\n\tregister(cachedCollection: CachedCollection<any>) {\n\t\tthis.items.push(cachedCollection);\n\t}\n\n\tclearAllCache() {\n\t\tfor (const item of this.items) {\n\t\t\tvoid item.clearCache();\n\t\t}\n\t}\n\n\tclearAllCacheOnLogout() {\n\t\tfor (const item of this.items) {\n\t\t\titem.clearCacheOnLogout();\n\t\t}\n\t}\n\n\tset syncEnabled(value) {\n\t\tcheck(value, Boolean);\n\t\tthis._syncEnabled = value;\n\t}\n\n\tget syncEnabled() {\n\t\treturn this._syncEnabled;\n\t}\n\n\tonReconnect(cb: () => void) {\n\t\tthis.on('reconnect', cb);\n\t}\n\n\tonLogin(cb: () => void) {\n\t\tthis.on('login', cb);\n\t\tif (this.logged) {\n\t\t\tcb();\n\t\t}\n\t}\n}\n\nconst instance = new CachedCollectionManager();\n\nexport {\n\t/** @deprecated */\n\tinstance as CachedCollectionManager,\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-cached-collection/client/models/CachedCollectionManager.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-cached-collection/client/models/CachedCollectionManager.ts","inputSourceMap":{"version":3,"file":"app/ui-cached-collection/client/models/CachedCollectionManager.ts","sourceRoot":"","sources":["app/ui-cached-collection/client/models/CachedCollectionManager.ts"],"names":[],"mappings":"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","sourcesContent":["import { Emitter } from '@rocket.chat/emitter';\nimport { Accounts } from 'meteor/accounts-base';\nimport { check } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport type { CachedCollection } from './CachedCollection';\n\nclass CachedCollectionManager extends Emitter<{ reconnect: void; login: string | null }> {\n\tprivate items: CachedCollection<any>[];\n\n\tprivate _syncEnabled: boolean;\n\n\tprivate logged: boolean;\n\n\tprivate step: number;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.items = [];\n\t\tthis._syncEnabled = false;\n\t\tthis.logged = false;\n\n\t\tconst { _unstoreLoginToken } = Accounts;\n\t\tAccounts._unstoreLoginToken = (...args) => {\n\t\t\t_unstoreLoginToken.apply(Accounts, args);\n\t\t\tthis.clearAllCacheOnLogout();\n\t\t};\n\n\t\tTracker.autorun(() => {\n\t\t\tconst [WAITING_FIRST_CONNECTION, WAITING_FIRST_DISCONNECTION, LISTENING_RECONNECTIONS] = [0, 1, 2];\n\t\t\tthis.step = this.step || WAITING_FIRST_CONNECTION;\n\t\t\tconst { connected } = Meteor.status();\n\t\t\tswitch (this.step) {\n\t\t\t\tcase WAITING_FIRST_CONNECTION:\n\t\t\t\t\treturn !connected || this.step++;\n\t\t\t\tcase WAITING_FIRST_DISCONNECTION:\n\t\t\t\t\treturn connected || this.step++;\n\t\t\t\tcase LISTENING_RECONNECTIONS:\n\t\t\t\t\treturn connected && this.emit('reconnect');\n\t\t\t}\n\t\t});\n\n\t\tAccounts.onLogin(() => {\n\t\t\tthis.emit('login', Meteor.userId());\n\t\t});\n\t\tTracker.autorun(() => {\n\t\t\tconst uid = Meteor.userId();\n\t\t\tthis.logged = uid !== null;\n\t\t});\n\t}\n\n\tregister(cachedCollection: CachedCollection<any>) {\n\t\tthis.items.push(cachedCollection);\n\t}\n\n\tclearAllCache() {\n\t\tfor (const item of this.items) {\n\t\t\tvoid item.clearCache();\n\t\t}\n\t}\n\n\tclearAllCacheOnLogout() {\n\t\tfor (const item of this.items) {\n\t\t\titem.clearCacheOnLogout();\n\t\t}\n\t}\n\n\tset syncEnabled(value) {\n\t\tcheck(value, Boolean);\n\t\tthis._syncEnabled = value;\n\t}\n\n\tget syncEnabled() {\n\t\treturn this._syncEnabled;\n\t}\n\n\tonReconnect(cb: () => void) {\n\t\tthis.on('reconnect', cb);\n\t}\n\n\tonLogin(cb: () => void) {\n\t\tthis.on('login', cb);\n\t\tif (this.logged) {\n\t\t\tcb();\n\t\t}\n\t}\n}\n\nconst instance = new CachedCollectionManager();\n\nexport {\n\t/** @deprecated */\n\tinstance as CachedCollectionManager,\n};\n"]}}},"code":"module.export({\n  CachedCollectionManager: () => instance\n});\nlet Emitter;\nmodule.link(\"@rocket.chat/emitter\", {\n  Emitter(v) {\n    Emitter = v;\n  }\n}, 0);\nlet Accounts;\nmodule.link(\"meteor/accounts-base\", {\n  Accounts(v) {\n    Accounts = v;\n  }\n}, 1);\nlet check;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  }\n}, 2);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n}, 3);\nlet Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker(v) {\n    Tracker = v;\n  }\n}, 4);\nclass CachedCollectionManager extends Emitter {\n  constructor() {\n    var _this;\n    super();\n    _this = this;\n    this.items = void 0;\n    this._syncEnabled = void 0;\n    this.logged = void 0;\n    this.step = void 0;\n    this.items = [];\n    this._syncEnabled = false;\n    this.logged = false;\n    const {\n      _unstoreLoginToken\n    } = Accounts;\n    Accounts._unstoreLoginToken = function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _unstoreLoginToken.apply(Accounts, args);\n      _this.clearAllCacheOnLogout();\n    };\n    Tracker.autorun(() => {\n      const [WAITING_FIRST_CONNECTION, WAITING_FIRST_DISCONNECTION, LISTENING_RECONNECTIONS] = [0, 1, 2];\n      this.step = this.step || WAITING_FIRST_CONNECTION;\n      const {\n        connected\n      } = Meteor.status();\n      switch (this.step) {\n        case WAITING_FIRST_CONNECTION:\n          return !connected || this.step++;\n        case WAITING_FIRST_DISCONNECTION:\n          return connected || this.step++;\n        case LISTENING_RECONNECTIONS:\n          return connected && this.emit('reconnect');\n      }\n    });\n    Accounts.onLogin(() => {\n      this.emit('login', Meteor.userId());\n    });\n    Tracker.autorun(() => {\n      const uid = Meteor.userId();\n      this.logged = uid !== null;\n    });\n  }\n  register(cachedCollection) {\n    this.items.push(cachedCollection);\n  }\n  clearAllCache() {\n    for (const item of this.items) {\n      void item.clearCache();\n    }\n  }\n  clearAllCacheOnLogout() {\n    for (const item of this.items) {\n      item.clearCacheOnLogout();\n    }\n  }\n  set syncEnabled(value) {\n    check(value, Boolean);\n    this._syncEnabled = value;\n  }\n  get syncEnabled() {\n    return this._syncEnabled;\n  }\n  onReconnect(cb) {\n    this.on('reconnect', cb);\n  }\n  onLogin(cb) {\n    this.on('login', cb);\n    if (this.logged) {\n      cb();\n    }\n  }\n}\nconst instance = new CachedCollectionManager();","map":{"version":3,"names":["module","export","CachedCollectionManager","instance","Emitter","link","v","Accounts","check","Meteor","Tracker","constructor","_this","this","items","_syncEnabled","logged","step","_unstoreLoginToken","_len","arguments","length","args","Array","_key","apply","clearAllCacheOnLogout","autorun","WAITING_FIRST_CONNECTION","WAITING_FIRST_DISCONNECTION","LISTENING_RECONNECTIONS","connected","status","emit","onLogin","userId","uid","register","cachedCollection","push","clearAllCache","item","clearCache","clearCacheOnLogout","syncEnabled","value","Boolean","onReconnect","cb","on"],"sources":["app/ui-cached-collection/client/models/CachedCollectionManager.ts"],"sourcesContent":["import { Emitter } from '@rocket.chat/emitter';\nimport { Accounts } from 'meteor/accounts-base';\nimport { check } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport type { CachedCollection } from './CachedCollection';\n\nclass CachedCollectionManager extends Emitter<{ reconnect: void; login: string | null }> {\n\tprivate items: CachedCollection<any>[];\n\n\tprivate _syncEnabled: boolean;\n\n\tprivate logged: boolean;\n\n\tprivate step: number;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.items = [];\n\t\tthis._syncEnabled = false;\n\t\tthis.logged = false;\n\n\t\tconst { _unstoreLoginToken } = Accounts;\n\t\tAccounts._unstoreLoginToken = (...args) => {\n\t\t\t_unstoreLoginToken.apply(Accounts, args);\n\t\t\tthis.clearAllCacheOnLogout();\n\t\t};\n\n\t\tTracker.autorun(() => {\n\t\t\tconst [WAITING_FIRST_CONNECTION, WAITING_FIRST_DISCONNECTION, LISTENING_RECONNECTIONS] = [0, 1, 2];\n\t\t\tthis.step = this.step || WAITING_FIRST_CONNECTION;\n\t\t\tconst { connected } = Meteor.status();\n\t\t\tswitch (this.step) {\n\t\t\t\tcase WAITING_FIRST_CONNECTION:\n\t\t\t\t\treturn !connected || this.step++;\n\t\t\t\tcase WAITING_FIRST_DISCONNECTION:\n\t\t\t\t\treturn connected || this.step++;\n\t\t\t\tcase LISTENING_RECONNECTIONS:\n\t\t\t\t\treturn connected && this.emit('reconnect');\n\t\t\t}\n\t\t});\n\n\t\tAccounts.onLogin(() => {\n\t\t\tthis.emit('login', Meteor.userId());\n\t\t});\n\t\tTracker.autorun(() => {\n\t\t\tconst uid = Meteor.userId();\n\t\t\tthis.logged = uid !== null;\n\t\t});\n\t}\n\n\tregister(cachedCollection: CachedCollection<any>) {\n\t\tthis.items.push(cachedCollection);\n\t}\n\n\tclearAllCache() {\n\t\tfor (const item of this.items) {\n\t\t\tvoid item.clearCache();\n\t\t}\n\t}\n\n\tclearAllCacheOnLogout() {\n\t\tfor (const item of this.items) {\n\t\t\titem.clearCacheOnLogout();\n\t\t}\n\t}\n\n\tset syncEnabled(value) {\n\t\tcheck(value, Boolean);\n\t\tthis._syncEnabled = value;\n\t}\n\n\tget syncEnabled() {\n\t\treturn this._syncEnabled;\n\t}\n\n\tonReconnect(cb: () => void) {\n\t\tthis.on('reconnect', cb);\n\t}\n\n\tonLogin(cb: () => void) {\n\t\tthis.on('login', cb);\n\t\tif (this.logged) {\n\t\t\tcb();\n\t\t}\n\t}\n}\n\nconst instance = new CachedCollectionManager();\n\nexport {\n\t/** @deprecated */\n\tinstance as CachedCollectionManager,\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"43a6f30cddc4534ef20e6e607bb33250f5dee48b"}
