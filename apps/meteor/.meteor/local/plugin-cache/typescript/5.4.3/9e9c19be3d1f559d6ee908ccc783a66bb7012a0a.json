{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/GazzodownText.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/components/GazzodownText.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/GazzodownText.tsx","inputSourceMap":{"version":3,"file":"client/components/GazzodownText.tsx","sourceRoot":"","sources":["client/components/GazzodownText.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport { useLocalStorage } from '@rocket.chat/fuselage-hooks';\nimport type { ChannelMention, UserMention } from '@rocket.chat/gazzodown';\nimport { MarkupInteractionContext } from '@rocket.chat/gazzodown';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\nimport { useFeaturePreview } from '@rocket.chat/ui-client';\nimport { useLayout, useRouter, useSetting, useUserPreference, useUserId } from '@rocket.chat/ui-contexts';\nimport type { UIEvent } from 'react';\nimport React, { useCallback, memo, useMemo } from 'react';\n\nimport { detectEmoji } from '../lib/utils/detectEmoji';\nimport { fireGlobalEvent } from '../lib/utils/fireGlobalEvent';\nimport { useUserCard } from '../views/room/contexts/UserCardContext';\nimport { useGoToRoom } from '../views/room/hooks/useGoToRoom';\nimport { useMessageListHighlights } from './message/list/MessageListContext';\n\ntype GazzodownTextProps = {\n\tchildren: JSX.Element;\n\tmentions?: {\n\t\ttype?: 'user' | 'team';\n\t\t_id: string;\n\t\tusername?: string;\n\t\tname?: string;\n\t}[];\n\tchannels?: Pick<IRoom, '_id' | 'name'>[];\n\tsearchText?: string;\n};\n\nconst GazzodownText = ({ mentions, channels, searchText, children }: GazzodownTextProps) => {\n\tconst enableTimestamp = useFeaturePreview('enable-timestamp-message-parser');\n\tconst [userLanguage] = useLocalStorage('userLanguage', 'en');\n\n\tconst highlights = useMessageListHighlights();\n\tconst { triggerProps, openUserCard } = useUserCard();\n\n\tconst highlightRegex = useMemo(() => {\n\t\tif (!highlights?.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst alternatives = highlights.map(({ highlight }) => escapeRegExp(highlight)).join('|');\n\t\tconst expression = `(?=^|\\\\b|[\\\\s\\\\n\\\\r\\\\t.,،'\\\\\\\"\\\\+!?:-])(${alternatives})(?=$|\\\\b|[\\\\s\\\\n\\\\r\\\\t.,،'\\\\\\\"\\\\+!?:-])`;\n\n\t\treturn (): RegExp => new RegExp(expression, 'gmi');\n\t}, [highlights]);\n\n\tconst markRegex = useMemo(() => {\n\t\tif (!searchText) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn (): RegExp => new RegExp(`(${searchText})(?![^<]*>)`, 'gi');\n\t}, [searchText]);\n\n\tconst convertAsciiToEmoji = useUserPreference<boolean>('convertAsciiEmoji', true);\n\tconst useEmoji = Boolean(useUserPreference('useEmojis'));\n\tconst useRealName = Boolean(useSetting('UI_Use_Real_Name'));\n\tconst ownUserId = useUserId();\n\tconst showMentionSymbol = Boolean(useUserPreference<boolean>('mentionsWithSymbol'));\n\n\tconst resolveUserMention = useCallback(\n\t\t(mention: string) => {\n\t\t\tif (mention === 'all' || mention === 'here') {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tconst filterUser = ({ username, type }: UserMention) => (!type || type === 'user') && username === mention;\n\t\t\tconst filterTeam = ({ name, type }: UserMention) => type === 'team' && name === mention;\n\n\t\t\treturn mentions?.find((mention) => filterUser(mention) || filterTeam(mention));\n\t\t},\n\t\t[mentions],\n\t);\n\n\tconst onUserMentionClick = useCallback(\n\t\t({ username }: UserMention) => {\n\t\t\tif (!username) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn (event: UIEvent): void => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\topenUserCard(event, username);\n\t\t\t};\n\t\t},\n\t\t[openUserCard],\n\t);\n\n\tconst goToRoom = useGoToRoom();\n\n\tconst { isEmbedded, isMobile } = useLayout();\n\n\tconst resolveChannelMention = useCallback((mention: string) => channels?.find(({ name }) => name === mention), [channels]);\n\n\tconst router = useRouter();\n\n\tconst onChannelMentionClick = useCallback(\n\t\t({ _id: rid }: ChannelMention) =>\n\t\t\t(event: UIEvent): void => {\n\t\t\t\tif (isEmbedded) {\n\t\t\t\t\tfireGlobalEvent('click-mention-link', {\n\t\t\t\t\t\tpath: router.buildRoutePath({\n\t\t\t\t\t\t\tpattern: '/channel/:name/:tab?/:context?',\n\t\t\t\t\t\t\tparams: { name: rid },\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tchannel: rid,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tgoToRoom(rid);\n\t\t\t},\n\t\t[router, isEmbedded, goToRoom],\n\t);\n\n\treturn (\n\t\t<MarkupInteractionContext.Provider\n\t\t\tvalue={{\n\t\t\t\tdetectEmoji,\n\t\t\t\thighlightRegex,\n\t\t\t\tmarkRegex,\n\t\t\t\tresolveUserMention,\n\t\t\t\tonUserMentionClick,\n\t\t\t\tresolveChannelMention,\n\t\t\t\tonChannelMentionClick,\n\t\t\t\tconvertAsciiToEmoji,\n\t\t\t\tuseEmoji,\n\t\t\t\tuseRealName,\n\t\t\t\tisMobile,\n\t\t\t\townUserId,\n\t\t\t\tshowMentionSymbol,\n\t\t\t\ttriggerProps,\n\t\t\t\tenableTimestamp,\n\t\t\t\tlanguage: userLanguage,\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</MarkupInteractionContext.Provider>\n\t);\n};\n\nexport default memo(GazzodownText);\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/GazzodownText.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/components/GazzodownText.tsx","inputSourceMap":{"version":3,"file":"client/components/GazzodownText.tsx","sourceRoot":"","sources":["client/components/GazzodownText.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport { useLocalStorage } from '@rocket.chat/fuselage-hooks';\nimport type { ChannelMention, UserMention } from '@rocket.chat/gazzodown';\nimport { MarkupInteractionContext } from '@rocket.chat/gazzodown';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\nimport { useFeaturePreview } from '@rocket.chat/ui-client';\nimport { useLayout, useRouter, useSetting, useUserPreference, useUserId } from '@rocket.chat/ui-contexts';\nimport type { UIEvent } from 'react';\nimport React, { useCallback, memo, useMemo } from 'react';\n\nimport { detectEmoji } from '../lib/utils/detectEmoji';\nimport { fireGlobalEvent } from '../lib/utils/fireGlobalEvent';\nimport { useUserCard } from '../views/room/contexts/UserCardContext';\nimport { useGoToRoom } from '../views/room/hooks/useGoToRoom';\nimport { useMessageListHighlights } from './message/list/MessageListContext';\n\ntype GazzodownTextProps = {\n\tchildren: JSX.Element;\n\tmentions?: {\n\t\ttype?: 'user' | 'team';\n\t\t_id: string;\n\t\tusername?: string;\n\t\tname?: string;\n\t}[];\n\tchannels?: Pick<IRoom, '_id' | 'name'>[];\n\tsearchText?: string;\n};\n\nconst GazzodownText = ({ mentions, channels, searchText, children }: GazzodownTextProps) => {\n\tconst enableTimestamp = useFeaturePreview('enable-timestamp-message-parser');\n\tconst [userLanguage] = useLocalStorage('userLanguage', 'en');\n\n\tconst highlights = useMessageListHighlights();\n\tconst { triggerProps, openUserCard } = useUserCard();\n\n\tconst highlightRegex = useMemo(() => {\n\t\tif (!highlights?.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst alternatives = highlights.map(({ highlight }) => escapeRegExp(highlight)).join('|');\n\t\tconst expression = `(?=^|\\\\b|[\\\\s\\\\n\\\\r\\\\t.,،'\\\\\\\"\\\\+!?:-])(${alternatives})(?=$|\\\\b|[\\\\s\\\\n\\\\r\\\\t.,،'\\\\\\\"\\\\+!?:-])`;\n\n\t\treturn (): RegExp => new RegExp(expression, 'gmi');\n\t}, [highlights]);\n\n\tconst markRegex = useMemo(() => {\n\t\tif (!searchText) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn (): RegExp => new RegExp(`(${searchText})(?![^<]*>)`, 'gi');\n\t}, [searchText]);\n\n\tconst convertAsciiToEmoji = useUserPreference<boolean>('convertAsciiEmoji', true);\n\tconst useEmoji = Boolean(useUserPreference('useEmojis'));\n\tconst useRealName = Boolean(useSetting('UI_Use_Real_Name'));\n\tconst ownUserId = useUserId();\n\tconst showMentionSymbol = Boolean(useUserPreference<boolean>('mentionsWithSymbol'));\n\n\tconst resolveUserMention = useCallback(\n\t\t(mention: string) => {\n\t\t\tif (mention === 'all' || mention === 'here') {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tconst filterUser = ({ username, type }: UserMention) => (!type || type === 'user') && username === mention;\n\t\t\tconst filterTeam = ({ name, type }: UserMention) => type === 'team' && name === mention;\n\n\t\t\treturn mentions?.find((mention) => filterUser(mention) || filterTeam(mention));\n\t\t},\n\t\t[mentions],\n\t);\n\n\tconst onUserMentionClick = useCallback(\n\t\t({ username }: UserMention) => {\n\t\t\tif (!username) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn (event: UIEvent): void => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\topenUserCard(event, username);\n\t\t\t};\n\t\t},\n\t\t[openUserCard],\n\t);\n\n\tconst goToRoom = useGoToRoom();\n\n\tconst { isEmbedded, isMobile } = useLayout();\n\n\tconst resolveChannelMention = useCallback((mention: string) => channels?.find(({ name }) => name === mention), [channels]);\n\n\tconst router = useRouter();\n\n\tconst onChannelMentionClick = useCallback(\n\t\t({ _id: rid }: ChannelMention) =>\n\t\t\t(event: UIEvent): void => {\n\t\t\t\tif (isEmbedded) {\n\t\t\t\t\tfireGlobalEvent('click-mention-link', {\n\t\t\t\t\t\tpath: router.buildRoutePath({\n\t\t\t\t\t\t\tpattern: '/channel/:name/:tab?/:context?',\n\t\t\t\t\t\t\tparams: { name: rid },\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tchannel: rid,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tgoToRoom(rid);\n\t\t\t},\n\t\t[router, isEmbedded, goToRoom],\n\t);\n\n\treturn (\n\t\t<MarkupInteractionContext.Provider\n\t\t\tvalue={{\n\t\t\t\tdetectEmoji,\n\t\t\t\thighlightRegex,\n\t\t\t\tmarkRegex,\n\t\t\t\tresolveUserMention,\n\t\t\t\tonUserMentionClick,\n\t\t\t\tresolveChannelMention,\n\t\t\t\tonChannelMentionClick,\n\t\t\t\tconvertAsciiToEmoji,\n\t\t\t\tuseEmoji,\n\t\t\t\tuseRealName,\n\t\t\t\tisMobile,\n\t\t\t\townUserId,\n\t\t\t\tshowMentionSymbol,\n\t\t\t\ttriggerProps,\n\t\t\t\tenableTimestamp,\n\t\t\t\tlanguage: userLanguage,\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</MarkupInteractionContext.Provider>\n\t);\n};\n\nexport default memo(GazzodownText);\n"]}}},"code":"var _slicedToArray;\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 0);\nvar useLocalStorage;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useLocalStorage: function (v) {\n    useLocalStorage = v;\n  }\n}, 0);\nvar MarkupInteractionContext;\nmodule.link(\"@rocket.chat/gazzodown\", {\n  MarkupInteractionContext: function (v) {\n    MarkupInteractionContext = v;\n  }\n}, 1);\nvar escapeRegExp;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  escapeRegExp: function (v) {\n    escapeRegExp = v;\n  }\n}, 2);\nvar useFeaturePreview;\nmodule.link(\"@rocket.chat/ui-client\", {\n  useFeaturePreview: function (v) {\n    useFeaturePreview = v;\n  }\n}, 3);\nvar useLayout, useRouter, useSetting, useUserPreference, useUserId;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useLayout: function (v) {\n    useLayout = v;\n  },\n  useRouter: function (v) {\n    useRouter = v;\n  },\n  useSetting: function (v) {\n    useSetting = v;\n  },\n  useUserPreference: function (v) {\n    useUserPreference = v;\n  },\n  useUserId: function (v) {\n    useUserId = v;\n  }\n}, 4);\nvar React, useCallback, memo, useMemo;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useCallback: function (v) {\n    useCallback = v;\n  },\n  memo: function (v) {\n    memo = v;\n  },\n  useMemo: function (v) {\n    useMemo = v;\n  }\n}, 5);\nvar detectEmoji;\nmodule.link(\"../lib/utils/detectEmoji\", {\n  detectEmoji: function (v) {\n    detectEmoji = v;\n  }\n}, 6);\nvar fireGlobalEvent;\nmodule.link(\"../lib/utils/fireGlobalEvent\", {\n  fireGlobalEvent: function (v) {\n    fireGlobalEvent = v;\n  }\n}, 7);\nvar useUserCard;\nmodule.link(\"../views/room/contexts/UserCardContext\", {\n  useUserCard: function (v) {\n    useUserCard = v;\n  }\n}, 8);\nvar useGoToRoom;\nmodule.link(\"../views/room/hooks/useGoToRoom\", {\n  useGoToRoom: function (v) {\n    useGoToRoom = v;\n  }\n}, 9);\nvar useMessageListHighlights;\nmodule.link(\"./message/list/MessageListContext\", {\n  useMessageListHighlights: function (v) {\n    useMessageListHighlights = v;\n  }\n}, 10);\nvar GazzodownText = function (_ref) {\n  var mentions = _ref.mentions,\n    channels = _ref.channels,\n    searchText = _ref.searchText,\n    children = _ref.children;\n  var enableTimestamp = useFeaturePreview('enable-timestamp-message-parser');\n  var _useLocalStorage = useLocalStorage('userLanguage', 'en'),\n    _useLocalStorage2 = _slicedToArray(_useLocalStorage, 1),\n    userLanguage = _useLocalStorage2[0];\n  var highlights = useMessageListHighlights();\n  var _useUserCard = useUserCard(),\n    triggerProps = _useUserCard.triggerProps,\n    openUserCard = _useUserCard.openUserCard;\n  var highlightRegex = useMemo(function () {\n    if (!(highlights !== null && highlights !== void 0 && highlights.length)) {\n      return;\n    }\n    var alternatives = highlights.map(function (_ref2) {\n      var highlight = _ref2.highlight;\n      return escapeRegExp(highlight);\n    }).join('|');\n    var expression = \"(?=^|\\\\b|[\\\\s\\\\n\\\\r\\\\t.,\\u060C'\\\\\\\"\\\\+!?:-])(\" + alternatives + \")(?=$|\\\\b|[\\\\s\\\\n\\\\r\\\\t.,\\u060C'\\\\\\\"\\\\+!?:-])\";\n    return function () {\n      return new RegExp(expression, 'gmi');\n    };\n  }, [highlights]);\n  var markRegex = useMemo(function () {\n    if (!searchText) {\n      return;\n    }\n    return function () {\n      return new RegExp(\"(\" + searchText + \")(?![^<]*>)\", 'gi');\n    };\n  }, [searchText]);\n  var convertAsciiToEmoji = useUserPreference('convertAsciiEmoji', true);\n  var useEmoji = Boolean(useUserPreference('useEmojis'));\n  var useRealName = Boolean(useSetting('UI_Use_Real_Name'));\n  var ownUserId = useUserId();\n  var showMentionSymbol = Boolean(useUserPreference('mentionsWithSymbol'));\n  var resolveUserMention = useCallback(function (mention) {\n    if (mention === 'all' || mention === 'here') {\n      return undefined;\n    }\n    var filterUser = function (_ref3) {\n      var username = _ref3.username,\n        type = _ref3.type;\n      return (!type || type === 'user') && username === mention;\n    };\n    var filterTeam = function (_ref4) {\n      var name = _ref4.name,\n        type = _ref4.type;\n      return type === 'team' && name === mention;\n    };\n    return mentions === null || mentions === void 0 ? void 0 : mentions.find(function (mention) {\n      return filterUser(mention) || filterTeam(mention);\n    });\n  }, [mentions]);\n  var onUserMentionClick = useCallback(function (_ref5) {\n    var username = _ref5.username;\n    if (!username) {\n      return;\n    }\n    return function (event) {\n      event.stopPropagation();\n      openUserCard(event, username);\n    };\n  }, [openUserCard]);\n  var goToRoom = useGoToRoom();\n  var _useLayout = useLayout(),\n    isEmbedded = _useLayout.isEmbedded,\n    isMobile = _useLayout.isMobile;\n  var resolveChannelMention = useCallback(function (mention) {\n    return channels === null || channels === void 0 ? void 0 : channels.find(function (_ref6) {\n      var name = _ref6.name;\n      return name === mention;\n    });\n  }, [channels]);\n  var router = useRouter();\n  var onChannelMentionClick = useCallback(function (_ref7) {\n    var rid = _ref7._id;\n    return function (event) {\n      if (isEmbedded) {\n        fireGlobalEvent('click-mention-link', {\n          path: router.buildRoutePath({\n            pattern: '/channel/:name/:tab?/:context?',\n            params: {\n              name: rid\n            }\n          }),\n          channel: rid\n        });\n      }\n      event.stopPropagation();\n      goToRoom(rid);\n    };\n  }, [router, isEmbedded, goToRoom]);\n  return /*#__PURE__*/React.createElement(MarkupInteractionContext.Provider, {\n    value: {\n      detectEmoji: detectEmoji,\n      highlightRegex: highlightRegex,\n      markRegex: markRegex,\n      resolveUserMention: resolveUserMention,\n      onUserMentionClick: onUserMentionClick,\n      resolveChannelMention: resolveChannelMention,\n      onChannelMentionClick: onChannelMentionClick,\n      convertAsciiToEmoji: convertAsciiToEmoji,\n      useEmoji: useEmoji,\n      useRealName: useRealName,\n      isMobile: isMobile,\n      ownUserId: ownUserId,\n      showMentionSymbol: showMentionSymbol,\n      triggerProps: triggerProps,\n      enableTimestamp: enableTimestamp,\n      language: userLanguage\n    }\n  }, children);\n};\nmodule.exportDefault( /*#__PURE__*/memo(GazzodownText));","map":{"version":3,"names":["_slicedToArray","module","link","default","v","useLocalStorage","MarkupInteractionContext","escapeRegExp","useFeaturePreview","useLayout","useRouter","useSetting","useUserPreference","useUserId","React","useCallback","memo","useMemo","detectEmoji","fireGlobalEvent","useUserCard","useGoToRoom","useMessageListHighlights","GazzodownText","_ref","mentions","channels","searchText","children","enableTimestamp","_useLocalStorage","_useLocalStorage2","userLanguage","highlights","_useUserCard","triggerProps","openUserCard","highlightRegex","length","alternatives","map","_ref2","highlight","join","expression","RegExp","markRegex","convertAsciiToEmoji","useEmoji","Boolean","useRealName","ownUserId","showMentionSymbol","resolveUserMention","mention","undefined","filterUser","_ref3","username","type","filterTeam","_ref4","name","find","onUserMentionClick","_ref5","event","stopPropagation","goToRoom","_useLayout","isEmbedded","isMobile","resolveChannelMention","_ref6","router","onChannelMentionClick","_ref7","rid","_id","path","buildRoutePath","pattern","params","channel","createElement","Provider","value","language","exportDefault"],"sources":["client/components/GazzodownText.tsx"],"sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport { useLocalStorage } from '@rocket.chat/fuselage-hooks';\nimport type { ChannelMention, UserMention } from '@rocket.chat/gazzodown';\nimport { MarkupInteractionContext } from '@rocket.chat/gazzodown';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\nimport { useFeaturePreview } from '@rocket.chat/ui-client';\nimport { useLayout, useRouter, useSetting, useUserPreference, useUserId } from '@rocket.chat/ui-contexts';\nimport type { UIEvent } from 'react';\nimport React, { useCallback, memo, useMemo } from 'react';\n\nimport { detectEmoji } from '../lib/utils/detectEmoji';\nimport { fireGlobalEvent } from '../lib/utils/fireGlobalEvent';\nimport { useUserCard } from '../views/room/contexts/UserCardContext';\nimport { useGoToRoom } from '../views/room/hooks/useGoToRoom';\nimport { useMessageListHighlights } from './message/list/MessageListContext';\n\ntype GazzodownTextProps = {\n\tchildren: JSX.Element;\n\tmentions?: {\n\t\ttype?: 'user' | 'team';\n\t\t_id: string;\n\t\tusername?: string;\n\t\tname?: string;\n\t}[];\n\tchannels?: Pick<IRoom, '_id' | 'name'>[];\n\tsearchText?: string;\n};\n\nconst GazzodownText = ({ mentions, channels, searchText, children }: GazzodownTextProps) => {\n\tconst enableTimestamp = useFeaturePreview('enable-timestamp-message-parser');\n\tconst [userLanguage] = useLocalStorage('userLanguage', 'en');\n\n\tconst highlights = useMessageListHighlights();\n\tconst { triggerProps, openUserCard } = useUserCard();\n\n\tconst highlightRegex = useMemo(() => {\n\t\tif (!highlights?.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst alternatives = highlights.map(({ highlight }) => escapeRegExp(highlight)).join('|');\n\t\tconst expression = `(?=^|\\\\b|[\\\\s\\\\n\\\\r\\\\t.,،'\\\\\\\"\\\\+!?:-])(${alternatives})(?=$|\\\\b|[\\\\s\\\\n\\\\r\\\\t.,،'\\\\\\\"\\\\+!?:-])`;\n\n\t\treturn (): RegExp => new RegExp(expression, 'gmi');\n\t}, [highlights]);\n\n\tconst markRegex = useMemo(() => {\n\t\tif (!searchText) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn (): RegExp => new RegExp(`(${searchText})(?![^<]*>)`, 'gi');\n\t}, [searchText]);\n\n\tconst convertAsciiToEmoji = useUserPreference<boolean>('convertAsciiEmoji', true);\n\tconst useEmoji = Boolean(useUserPreference('useEmojis'));\n\tconst useRealName = Boolean(useSetting('UI_Use_Real_Name'));\n\tconst ownUserId = useUserId();\n\tconst showMentionSymbol = Boolean(useUserPreference<boolean>('mentionsWithSymbol'));\n\n\tconst resolveUserMention = useCallback(\n\t\t(mention: string) => {\n\t\t\tif (mention === 'all' || mention === 'here') {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tconst filterUser = ({ username, type }: UserMention) => (!type || type === 'user') && username === mention;\n\t\t\tconst filterTeam = ({ name, type }: UserMention) => type === 'team' && name === mention;\n\n\t\t\treturn mentions?.find((mention) => filterUser(mention) || filterTeam(mention));\n\t\t},\n\t\t[mentions],\n\t);\n\n\tconst onUserMentionClick = useCallback(\n\t\t({ username }: UserMention) => {\n\t\t\tif (!username) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn (event: UIEvent): void => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\topenUserCard(event, username);\n\t\t\t};\n\t\t},\n\t\t[openUserCard],\n\t);\n\n\tconst goToRoom = useGoToRoom();\n\n\tconst { isEmbedded, isMobile } = useLayout();\n\n\tconst resolveChannelMention = useCallback((mention: string) => channels?.find(({ name }) => name === mention), [channels]);\n\n\tconst router = useRouter();\n\n\tconst onChannelMentionClick = useCallback(\n\t\t({ _id: rid }: ChannelMention) =>\n\t\t\t(event: UIEvent): void => {\n\t\t\t\tif (isEmbedded) {\n\t\t\t\t\tfireGlobalEvent('click-mention-link', {\n\t\t\t\t\t\tpath: router.buildRoutePath({\n\t\t\t\t\t\t\tpattern: '/channel/:name/:tab?/:context?',\n\t\t\t\t\t\t\tparams: { name: rid },\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tchannel: rid,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tgoToRoom(rid);\n\t\t\t},\n\t\t[router, isEmbedded, goToRoom],\n\t);\n\n\treturn (\n\t\t<MarkupInteractionContext.Provider\n\t\t\tvalue={{\n\t\t\t\tdetectEmoji,\n\t\t\t\thighlightRegex,\n\t\t\t\tmarkRegex,\n\t\t\t\tresolveUserMention,\n\t\t\t\tonUserMentionClick,\n\t\t\t\tresolveChannelMention,\n\t\t\t\tonChannelMentionClick,\n\t\t\t\tconvertAsciiToEmoji,\n\t\t\t\tuseEmoji,\n\t\t\t\tuseRealName,\n\t\t\t\tisMobile,\n\t\t\t\townUserId,\n\t\t\t\tshowMentionSymbol,\n\t\t\t\ttriggerProps,\n\t\t\t\tenableTimestamp,\n\t\t\t\tlanguage: userLanguage,\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</MarkupInteractionContext.Provider>\n\t);\n};\n\nexport default memo(GazzodownText);\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"9e9c19be3d1f559d6ee908ccc783a66bb7012a0a"}
