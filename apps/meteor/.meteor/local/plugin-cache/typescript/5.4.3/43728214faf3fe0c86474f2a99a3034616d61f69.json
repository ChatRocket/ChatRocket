{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/message/hooks/useNormalizedMessage.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/components/message/hooks/useNormalizedMessage.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/message/hooks/useNormalizedMessage.ts","inputSourceMap":{"version":3,"file":"client/components/message/hooks/useNormalizedMessage.ts","sourceRoot":"","sources":["client/components/message/hooks/useNormalizedMessage.ts"],"names":[],"mappings":"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","sourcesContent":["import { Base64 } from '@rocket.chat/base64';\nimport type { IMessage, MessageAttachment } from '@rocket.chat/core-typings';\nimport {\n\tisFileImageAttachment,\n\tisFileAttachment,\n\tisFileAudioAttachment,\n\tisFileVideoAttachment,\n\tisQuoteAttachment,\n} from '@rocket.chat/core-typings';\nimport type { Options } from '@rocket.chat/message-parser';\nimport { useSetting } from '@rocket.chat/ui-contexts';\nimport { useMemo } from 'react';\n\nimport type { MessageWithMdEnforced } from '../../../lib/parseMessageTextToAstMarkdown';\nimport { parseMessageTextToAstMarkdown } from '../../../lib/parseMessageTextToAstMarkdown';\nimport { useAutoLinkDomains } from '../../../views/room/MessageList/hooks/useAutoLinkDomains';\nimport { useAutoTranslate } from '../../../views/room/MessageList/hooks/useAutoTranslate';\nimport { useKatex } from '../../../views/room/MessageList/hooks/useKatex';\nimport { useSubscriptionFromMessageQuery } from './useSubscriptionFromMessageQuery';\n\nconst normalizeAttachments = (attachments: MessageAttachment[], name?: string, type?: string): MessageAttachment[] => {\n\tif (name) {\n\t\tname = String.fromCharCode(...new TextEncoder().encode(name));\n\t}\n\n\treturn attachments.map((attachment) => {\n\t\tif (isQuoteAttachment(attachment) && attachment.attachments) {\n\t\t\tattachment.attachments = normalizeAttachments(attachment.attachments);\n\t\t\treturn attachment;\n\t\t}\n\n\t\tif (!attachment.encryption) {\n\t\t\treturn attachment;\n\t\t}\n\n\t\tconst key = Base64.encode(\n\t\t\tJSON.stringify({\n\t\t\t\t...attachment.encryption,\n\t\t\t\tname,\n\t\t\t\ttype,\n\t\t\t}),\n\t\t);\n\n\t\tif (isFileAttachment(attachment)) {\n\t\t\tif (attachment.title_link && !attachment.title_link.startsWith('/file-decrypt/')) {\n\t\t\t\tattachment.title_link = `/file-decrypt${attachment.title_link}?key=${key}`;\n\t\t\t}\n\t\t\tif (isFileImageAttachment(attachment) && !attachment.image_url.startsWith('/file-decrypt/')) {\n\t\t\t\tattachment.image_url = `/file-decrypt${attachment.image_url}?key=${key}`;\n\t\t\t}\n\t\t\tif (isFileAudioAttachment(attachment) && !attachment.audio_url.startsWith('/file-decrypt/')) {\n\t\t\t\tattachment.audio_url = `/file-decrypt${attachment.audio_url}?key=${key}`;\n\t\t\t}\n\t\t\tif (isFileVideoAttachment(attachment) && !attachment.video_url.startsWith('/file-decrypt/')) {\n\t\t\t\tattachment.video_url = `/file-decrypt${attachment.video_url}?key=${key}`;\n\t\t\t}\n\t\t}\n\n\t\treturn attachment;\n\t});\n};\n\nexport const useNormalizedMessage = <TMessage extends IMessage>(message: TMessage): MessageWithMdEnforced => {\n\tconst { katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled } = useKatex();\n\tconst customDomains = useAutoLinkDomains();\n\tconst subscription = useSubscriptionFromMessageQuery(message).data ?? undefined;\n\tconst autoTranslateOptions = useAutoTranslate(subscription);\n\tconst showColors = useSetting<boolean>('HexColorPreview_Enabled');\n\n\treturn useMemo(() => {\n\t\tconst parseOptions: Options = {\n\t\t\tcolors: showColors,\n\t\t\temoticons: true,\n\t\t\tcustomDomains,\n\t\t\t...(katexEnabled && {\n\t\t\t\tkatex: {\n\t\t\t\t\tdollarSyntax: katexDollarSyntaxEnabled,\n\t\t\t\t\tparenthesisSyntax: katexParenthesisSyntaxEnabled,\n\t\t\t\t},\n\t\t\t}),\n\t\t};\n\n\t\tconst normalizedMessage = parseMessageTextToAstMarkdown(message, parseOptions, autoTranslateOptions);\n\n\t\tif (normalizedMessage.attachments) {\n\t\t\tnormalizedMessage.attachments = normalizeAttachments(\n\t\t\t\tnormalizedMessage.attachments,\n\t\t\t\tnormalizedMessage.file?.name,\n\t\t\t\tnormalizedMessage.file?.type,\n\t\t\t);\n\t\t}\n\n\t\treturn normalizedMessage;\n\t}, [showColors, customDomains, katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled, message, autoTranslateOptions]);\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/message/hooks/useNormalizedMessage.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/components/message/hooks/useNormalizedMessage.ts","inputSourceMap":{"version":3,"file":"client/components/message/hooks/useNormalizedMessage.ts","sourceRoot":"","sources":["client/components/message/hooks/useNormalizedMessage.ts"],"names":[],"mappings":"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","sourcesContent":["import { Base64 } from '@rocket.chat/base64';\nimport type { IMessage, MessageAttachment } from '@rocket.chat/core-typings';\nimport {\n\tisFileImageAttachment,\n\tisFileAttachment,\n\tisFileAudioAttachment,\n\tisFileVideoAttachment,\n\tisQuoteAttachment,\n} from '@rocket.chat/core-typings';\nimport type { Options } from '@rocket.chat/message-parser';\nimport { useSetting } from '@rocket.chat/ui-contexts';\nimport { useMemo } from 'react';\n\nimport type { MessageWithMdEnforced } from '../../../lib/parseMessageTextToAstMarkdown';\nimport { parseMessageTextToAstMarkdown } from '../../../lib/parseMessageTextToAstMarkdown';\nimport { useAutoLinkDomains } from '../../../views/room/MessageList/hooks/useAutoLinkDomains';\nimport { useAutoTranslate } from '../../../views/room/MessageList/hooks/useAutoTranslate';\nimport { useKatex } from '../../../views/room/MessageList/hooks/useKatex';\nimport { useSubscriptionFromMessageQuery } from './useSubscriptionFromMessageQuery';\n\nconst normalizeAttachments = (attachments: MessageAttachment[], name?: string, type?: string): MessageAttachment[] => {\n\tif (name) {\n\t\tname = String.fromCharCode(...new TextEncoder().encode(name));\n\t}\n\n\treturn attachments.map((attachment) => {\n\t\tif (isQuoteAttachment(attachment) && attachment.attachments) {\n\t\t\tattachment.attachments = normalizeAttachments(attachment.attachments);\n\t\t\treturn attachment;\n\t\t}\n\n\t\tif (!attachment.encryption) {\n\t\t\treturn attachment;\n\t\t}\n\n\t\tconst key = Base64.encode(\n\t\t\tJSON.stringify({\n\t\t\t\t...attachment.encryption,\n\t\t\t\tname,\n\t\t\t\ttype,\n\t\t\t}),\n\t\t);\n\n\t\tif (isFileAttachment(attachment)) {\n\t\t\tif (attachment.title_link && !attachment.title_link.startsWith('/file-decrypt/')) {\n\t\t\t\tattachment.title_link = `/file-decrypt${attachment.title_link}?key=${key}`;\n\t\t\t}\n\t\t\tif (isFileImageAttachment(attachment) && !attachment.image_url.startsWith('/file-decrypt/')) {\n\t\t\t\tattachment.image_url = `/file-decrypt${attachment.image_url}?key=${key}`;\n\t\t\t}\n\t\t\tif (isFileAudioAttachment(attachment) && !attachment.audio_url.startsWith('/file-decrypt/')) {\n\t\t\t\tattachment.audio_url = `/file-decrypt${attachment.audio_url}?key=${key}`;\n\t\t\t}\n\t\t\tif (isFileVideoAttachment(attachment) && !attachment.video_url.startsWith('/file-decrypt/')) {\n\t\t\t\tattachment.video_url = `/file-decrypt${attachment.video_url}?key=${key}`;\n\t\t\t}\n\t\t}\n\n\t\treturn attachment;\n\t});\n};\n\nexport const useNormalizedMessage = <TMessage extends IMessage>(message: TMessage): MessageWithMdEnforced => {\n\tconst { katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled } = useKatex();\n\tconst customDomains = useAutoLinkDomains();\n\tconst subscription = useSubscriptionFromMessageQuery(message).data ?? undefined;\n\tconst autoTranslateOptions = useAutoTranslate(subscription);\n\tconst showColors = useSetting<boolean>('HexColorPreview_Enabled');\n\n\treturn useMemo(() => {\n\t\tconst parseOptions: Options = {\n\t\t\tcolors: showColors,\n\t\t\temoticons: true,\n\t\t\tcustomDomains,\n\t\t\t...(katexEnabled && {\n\t\t\t\tkatex: {\n\t\t\t\t\tdollarSyntax: katexDollarSyntaxEnabled,\n\t\t\t\t\tparenthesisSyntax: katexParenthesisSyntaxEnabled,\n\t\t\t\t},\n\t\t\t}),\n\t\t};\n\n\t\tconst normalizedMessage = parseMessageTextToAstMarkdown(message, parseOptions, autoTranslateOptions);\n\n\t\tif (normalizedMessage.attachments) {\n\t\t\tnormalizedMessage.attachments = normalizeAttachments(\n\t\t\t\tnormalizedMessage.attachments,\n\t\t\t\tnormalizedMessage.file?.name,\n\t\t\t\tnormalizedMessage.file?.type,\n\t\t\t);\n\t\t}\n\n\t\treturn normalizedMessage;\n\t}, [showColors, customDomains, katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled, message, autoTranslateOptions]);\n};\n"]}}},"code":"var _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 0);\nvar _toConsumableArray;\nmodule.link(\"@babel/runtime/helpers/toConsumableArray\", {\n  default: function (v) {\n    _toConsumableArray = v;\n  }\n}, 1);\nmodule.export({\n  useNormalizedMessage: function () {\n    return useNormalizedMessage;\n  }\n});\nvar Base64;\nmodule.link(\"@rocket.chat/base64\", {\n  Base64: function (v) {\n    Base64 = v;\n  }\n}, 0);\nvar isFileImageAttachment, isFileAttachment, isFileAudioAttachment, isFileVideoAttachment, isQuoteAttachment;\nmodule.link(\"@rocket.chat/core-typings\", {\n  isFileImageAttachment: function (v) {\n    isFileImageAttachment = v;\n  },\n  isFileAttachment: function (v) {\n    isFileAttachment = v;\n  },\n  isFileAudioAttachment: function (v) {\n    isFileAudioAttachment = v;\n  },\n  isFileVideoAttachment: function (v) {\n    isFileVideoAttachment = v;\n  },\n  isQuoteAttachment: function (v) {\n    isQuoteAttachment = v;\n  }\n}, 1);\nvar useSetting;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useSetting: function (v) {\n    useSetting = v;\n  }\n}, 2);\nvar useMemo;\nmodule.link(\"react\", {\n  useMemo: function (v) {\n    useMemo = v;\n  }\n}, 3);\nvar parseMessageTextToAstMarkdown;\nmodule.link(\"../../../lib/parseMessageTextToAstMarkdown\", {\n  parseMessageTextToAstMarkdown: function (v) {\n    parseMessageTextToAstMarkdown = v;\n  }\n}, 4);\nvar useAutoLinkDomains;\nmodule.link(\"../../../views/room/MessageList/hooks/useAutoLinkDomains\", {\n  useAutoLinkDomains: function (v) {\n    useAutoLinkDomains = v;\n  }\n}, 5);\nvar useAutoTranslate;\nmodule.link(\"../../../views/room/MessageList/hooks/useAutoTranslate\", {\n  useAutoTranslate: function (v) {\n    useAutoTranslate = v;\n  }\n}, 6);\nvar useKatex;\nmodule.link(\"../../../views/room/MessageList/hooks/useKatex\", {\n  useKatex: function (v) {\n    useKatex = v;\n  }\n}, 7);\nvar useSubscriptionFromMessageQuery;\nmodule.link(\"./useSubscriptionFromMessageQuery\", {\n  useSubscriptionFromMessageQuery: function (v) {\n    useSubscriptionFromMessageQuery = v;\n  }\n}, 8);\nvar normalizeAttachments = function (attachments, name, type) {\n  if (name) {\n    name = String.fromCharCode.apply(String, _toConsumableArray(new TextEncoder().encode(name)));\n  }\n  return attachments.map(function (attachment) {\n    if (isQuoteAttachment(attachment) && attachment.attachments) {\n      attachment.attachments = normalizeAttachments(attachment.attachments);\n      return attachment;\n    }\n    if (!attachment.encryption) {\n      return attachment;\n    }\n    var key = Base64.encode(JSON.stringify(_objectSpread(_objectSpread({}, attachment.encryption), {}, {\n      name: name,\n      type: type\n    })));\n    if (isFileAttachment(attachment)) {\n      if (attachment.title_link && !attachment.title_link.startsWith('/file-decrypt/')) {\n        attachment.title_link = \"/file-decrypt\" + attachment.title_link + \"?key=\" + key;\n      }\n      if (isFileImageAttachment(attachment) && !attachment.image_url.startsWith('/file-decrypt/')) {\n        attachment.image_url = \"/file-decrypt\" + attachment.image_url + \"?key=\" + key;\n      }\n      if (isFileAudioAttachment(attachment) && !attachment.audio_url.startsWith('/file-decrypt/')) {\n        attachment.audio_url = \"/file-decrypt\" + attachment.audio_url + \"?key=\" + key;\n      }\n      if (isFileVideoAttachment(attachment) && !attachment.video_url.startsWith('/file-decrypt/')) {\n        attachment.video_url = \"/file-decrypt\" + attachment.video_url + \"?key=\" + key;\n      }\n    }\n    return attachment;\n  });\n};\nvar useNormalizedMessage = function (message) {\n  var _useSubscriptionFromM;\n  var _useKatex = useKatex(),\n    katexEnabled = _useKatex.katexEnabled,\n    katexDollarSyntaxEnabled = _useKatex.katexDollarSyntaxEnabled,\n    katexParenthesisSyntaxEnabled = _useKatex.katexParenthesisSyntaxEnabled;\n  var customDomains = useAutoLinkDomains();\n  var subscription = (_useSubscriptionFromM = useSubscriptionFromMessageQuery(message).data) !== null && _useSubscriptionFromM !== void 0 ? _useSubscriptionFromM : undefined;\n  var autoTranslateOptions = useAutoTranslate(subscription);\n  var showColors = useSetting('HexColorPreview_Enabled');\n  return useMemo(function () {\n    var parseOptions = _objectSpread({\n      colors: showColors,\n      emoticons: true,\n      customDomains: customDomains\n    }, katexEnabled && {\n      katex: {\n        dollarSyntax: katexDollarSyntaxEnabled,\n        parenthesisSyntax: katexParenthesisSyntaxEnabled\n      }\n    });\n    var normalizedMessage = parseMessageTextToAstMarkdown(message, parseOptions, autoTranslateOptions);\n    if (normalizedMessage.attachments) {\n      var _normalizedMessage$fi, _normalizedMessage$fi2;\n      normalizedMessage.attachments = normalizeAttachments(normalizedMessage.attachments, (_normalizedMessage$fi = normalizedMessage.file) === null || _normalizedMessage$fi === void 0 ? void 0 : _normalizedMessage$fi.name, (_normalizedMessage$fi2 = normalizedMessage.file) === null || _normalizedMessage$fi2 === void 0 ? void 0 : _normalizedMessage$fi2.type);\n    }\n    return normalizedMessage;\n  }, [showColors, customDomains, katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled, message, autoTranslateOptions]);\n};","map":{"version":3,"names":["_objectSpread","module","link","default","v","_toConsumableArray","export","useNormalizedMessage","Base64","isFileImageAttachment","isFileAttachment","isFileAudioAttachment","isFileVideoAttachment","isQuoteAttachment","useSetting","useMemo","parseMessageTextToAstMarkdown","useAutoLinkDomains","useAutoTranslate","useKatex","useSubscriptionFromMessageQuery","normalizeAttachments","attachments","name","type","String","fromCharCode","apply","TextEncoder","encode","map","attachment","encryption","key","JSON","stringify","title_link","startsWith","image_url","audio_url","video_url","message","_useSubscriptionFromM","_useKatex","katexEnabled","katexDollarSyntaxEnabled","katexParenthesisSyntaxEnabled","customDomains","subscription","data","undefined","autoTranslateOptions","showColors","parseOptions","colors","emoticons","katex","dollarSyntax","parenthesisSyntax","normalizedMessage","_normalizedMessage$fi","_normalizedMessage$fi2","file"],"sources":["client/components/message/hooks/useNormalizedMessage.ts"],"sourcesContent":["import { Base64 } from '@rocket.chat/base64';\nimport type { IMessage, MessageAttachment } from '@rocket.chat/core-typings';\nimport {\n\tisFileImageAttachment,\n\tisFileAttachment,\n\tisFileAudioAttachment,\n\tisFileVideoAttachment,\n\tisQuoteAttachment,\n} from '@rocket.chat/core-typings';\nimport type { Options } from '@rocket.chat/message-parser';\nimport { useSetting } from '@rocket.chat/ui-contexts';\nimport { useMemo } from 'react';\n\nimport type { MessageWithMdEnforced } from '../../../lib/parseMessageTextToAstMarkdown';\nimport { parseMessageTextToAstMarkdown } from '../../../lib/parseMessageTextToAstMarkdown';\nimport { useAutoLinkDomains } from '../../../views/room/MessageList/hooks/useAutoLinkDomains';\nimport { useAutoTranslate } from '../../../views/room/MessageList/hooks/useAutoTranslate';\nimport { useKatex } from '../../../views/room/MessageList/hooks/useKatex';\nimport { useSubscriptionFromMessageQuery } from './useSubscriptionFromMessageQuery';\n\nconst normalizeAttachments = (attachments: MessageAttachment[], name?: string, type?: string): MessageAttachment[] => {\n\tif (name) {\n\t\tname = String.fromCharCode(...new TextEncoder().encode(name));\n\t}\n\n\treturn attachments.map((attachment) => {\n\t\tif (isQuoteAttachment(attachment) && attachment.attachments) {\n\t\t\tattachment.attachments = normalizeAttachments(attachment.attachments);\n\t\t\treturn attachment;\n\t\t}\n\n\t\tif (!attachment.encryption) {\n\t\t\treturn attachment;\n\t\t}\n\n\t\tconst key = Base64.encode(\n\t\t\tJSON.stringify({\n\t\t\t\t...attachment.encryption,\n\t\t\t\tname,\n\t\t\t\ttype,\n\t\t\t}),\n\t\t);\n\n\t\tif (isFileAttachment(attachment)) {\n\t\t\tif (attachment.title_link && !attachment.title_link.startsWith('/file-decrypt/')) {\n\t\t\t\tattachment.title_link = `/file-decrypt${attachment.title_link}?key=${key}`;\n\t\t\t}\n\t\t\tif (isFileImageAttachment(attachment) && !attachment.image_url.startsWith('/file-decrypt/')) {\n\t\t\t\tattachment.image_url = `/file-decrypt${attachment.image_url}?key=${key}`;\n\t\t\t}\n\t\t\tif (isFileAudioAttachment(attachment) && !attachment.audio_url.startsWith('/file-decrypt/')) {\n\t\t\t\tattachment.audio_url = `/file-decrypt${attachment.audio_url}?key=${key}`;\n\t\t\t}\n\t\t\tif (isFileVideoAttachment(attachment) && !attachment.video_url.startsWith('/file-decrypt/')) {\n\t\t\t\tattachment.video_url = `/file-decrypt${attachment.video_url}?key=${key}`;\n\t\t\t}\n\t\t}\n\n\t\treturn attachment;\n\t});\n};\n\nexport const useNormalizedMessage = <TMessage extends IMessage>(message: TMessage): MessageWithMdEnforced => {\n\tconst { katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled } = useKatex();\n\tconst customDomains = useAutoLinkDomains();\n\tconst subscription = useSubscriptionFromMessageQuery(message).data ?? undefined;\n\tconst autoTranslateOptions = useAutoTranslate(subscription);\n\tconst showColors = useSetting<boolean>('HexColorPreview_Enabled');\n\n\treturn useMemo(() => {\n\t\tconst parseOptions: Options = {\n\t\t\tcolors: showColors,\n\t\t\temoticons: true,\n\t\t\tcustomDomains,\n\t\t\t...(katexEnabled && {\n\t\t\t\tkatex: {\n\t\t\t\t\tdollarSyntax: katexDollarSyntaxEnabled,\n\t\t\t\t\tparenthesisSyntax: katexParenthesisSyntaxEnabled,\n\t\t\t\t},\n\t\t\t}),\n\t\t};\n\n\t\tconst normalizedMessage = parseMessageTextToAstMarkdown(message, parseOptions, autoTranslateOptions);\n\n\t\tif (normalizedMessage.attachments) {\n\t\t\tnormalizedMessage.attachments = normalizeAttachments(\n\t\t\t\tnormalizedMessage.attachments,\n\t\t\t\tnormalizedMessage.file?.name,\n\t\t\t\tnormalizedMessage.file?.type,\n\t\t\t);\n\t\t}\n\n\t\treturn normalizedMessage;\n\t}, [showColors, customDomains, katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled, message, autoTranslateOptions]);\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"43728214faf3fe0c86474f2a99a3034616d61f69"}
