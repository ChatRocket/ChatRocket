{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx","inputSourceMap":{"version":3,"file":"client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx","sourceRoot":"","sources":["client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport { Box, Throbber } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { MessageComposerAction } from '@rocket.chat/ui-composer';\nimport type { ReactElement } from 'react';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { AudioRecorder } from '../../../../app/ui/client/lib/recorderjs/AudioRecorder';\nimport type { ChatAPI } from '../../../lib/chats/ChatAPI';\nimport { useChat } from '../../room/contexts/ChatContext';\n\nconst audioRecorder = new AudioRecorder();\n\ntype AudioMessageRecorderProps = {\n\trid: IRoom['_id'];\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n\tisMicrophoneDenied?: boolean;\n};\n\nconst AudioMessageRecorder = ({ rid, chatContext, isMicrophoneDenied }: AudioMessageRecorderProps): ReactElement | null => {\n\tconst { t } = useTranslation();\n\n\tconst [state, setState] = useState<'loading' | 'recording'>('recording');\n\tconst [time, setTime] = useState('00:00');\n\tconst [recordingInterval, setRecordingInterval] = useState<ReturnType<typeof setInterval> | null>(null);\n\tconst [recordingRoomId, setRecordingRoomId] = useState<IRoom['_id'] | null>(null);\n\n\tconst stopRecording = useMutableCallback(async () => {\n\t\tif (recordingInterval) {\n\t\t\tclearInterval(recordingInterval);\n\t\t}\n\t\tsetRecordingInterval(null);\n\t\tsetRecordingRoomId(null);\n\n\t\tsetTime('00:00');\n\n\t\tchat?.action.stop('recording');\n\n\t\tchat?.composer?.setRecordingMode(false);\n\n\t\tconst blob = await new Promise<Blob>((resolve) => audioRecorder.stop(resolve));\n\n\t\treturn blob;\n\t});\n\n\tconst handleUnmount = useMutableCallback(async () => {\n\t\tif (state === 'recording') {\n\t\t\tawait stopRecording();\n\t\t}\n\t});\n\n\tconst handleRecord = useMutableCallback(async () => {\n\t\tif (recordingRoomId && recordingRoomId !== rid) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait audioRecorder.start();\n\t\t\tchat?.action.performContinuously('recording');\n\t\t\tconst startTime = new Date();\n\t\t\tsetRecordingInterval(\n\t\t\t\tsetInterval(() => {\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tconst distance = (now.getTime() - startTime.getTime()) / 1000;\n\t\t\t\t\tconst minutes = Math.floor(distance / 60);\n\t\t\t\t\tconst seconds = Math.floor(distance % 60);\n\t\t\t\t\tsetTime(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);\n\t\t\t\t}, 1000),\n\t\t\t);\n\t\t\tsetRecordingRoomId(rid);\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t\tchat?.composer?.setRecordingMode(false);\n\t\t}\n\t});\n\n\tconst handleCancelButtonClick = useMutableCallback(async () => {\n\t\tawait stopRecording();\n\t});\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst handleDoneButtonClick = useMutableCallback(async () => {\n\t\tsetState('loading');\n\n\t\tconst blob = await stopRecording();\n\n\t\tconst fileName = `${t('Audio_record')}.mp3`;\n\t\tconst file = new File([blob], fileName, { type: 'audio/mpeg' });\n\n\t\tawait chat?.flows.uploadFiles([file]);\n\t});\n\n\tuseEffect(() => {\n\t\thandleRecord();\n\n\t\treturn () => {\n\t\t\thandleUnmount();\n\t\t};\n\t}, [handleUnmount, handleRecord]);\n\n\tconst stateClass = useMemo(() => {\n\t\tif (recordingRoomId && recordingRoomId !== rid) {\n\t\t\treturn 'rc-message-box__audio-message--busy';\n\t\t}\n\n\t\treturn state && `rc-message-box__audio-message--${state}`;\n\t}, [recordingRoomId, rid, state]);\n\n\tif (isMicrophoneDenied) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<Box position='absolute' pi={4} pb={12} className={`rc-message-box__audio-message ${stateClass}`}>\n\t\t\t{state === 'recording' && (\n\t\t\t\t<>\n\t\t\t\t\t<MessageComposerAction\n\t\t\t\t\t\ticon='circle-cross'\n\t\t\t\t\t\tclassName='rc-message-box__icon rc-message-box__audio-message-cancel'\n\t\t\t\t\t\tonClick={handleCancelButtonClick}\n\t\t\t\t\t/>\n\t\t\t\t\t<Box className='rc-message-box__audio-message-timer' color='default'>\n\t\t\t\t\t\t<span className='rc-message-box__audio-message-timer-dot'></span>\n\t\t\t\t\t\t<span className='rc-message-box__audio-message-timer-text'>{time}</span>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<MessageComposerAction\n\t\t\t\t\t\ticon='circle-check'\n\t\t\t\t\t\tclassName='rc-message-box__icon rc-message-box__audio-message-done'\n\t\t\t\t\t\tonClick={handleDoneButtonClick}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{state === 'loading' && (\n\t\t\t\t<div className='rc-message-box__icon'>\n\t\t\t\t\t<Throbber inheritColor size='x12' />\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</Box>\n\t);\n};\n\nexport default AudioMessageRecorder;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx","inputSourceMap":{"version":3,"file":"client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx","sourceRoot":"","sources":["client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport { Box, Throbber } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { MessageComposerAction } from '@rocket.chat/ui-composer';\nimport type { ReactElement } from 'react';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { AudioRecorder } from '../../../../app/ui/client/lib/recorderjs/AudioRecorder';\nimport type { ChatAPI } from '../../../lib/chats/ChatAPI';\nimport { useChat } from '../../room/contexts/ChatContext';\n\nconst audioRecorder = new AudioRecorder();\n\ntype AudioMessageRecorderProps = {\n\trid: IRoom['_id'];\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n\tisMicrophoneDenied?: boolean;\n};\n\nconst AudioMessageRecorder = ({ rid, chatContext, isMicrophoneDenied }: AudioMessageRecorderProps): ReactElement | null => {\n\tconst { t } = useTranslation();\n\n\tconst [state, setState] = useState<'loading' | 'recording'>('recording');\n\tconst [time, setTime] = useState('00:00');\n\tconst [recordingInterval, setRecordingInterval] = useState<ReturnType<typeof setInterval> | null>(null);\n\tconst [recordingRoomId, setRecordingRoomId] = useState<IRoom['_id'] | null>(null);\n\n\tconst stopRecording = useMutableCallback(async () => {\n\t\tif (recordingInterval) {\n\t\t\tclearInterval(recordingInterval);\n\t\t}\n\t\tsetRecordingInterval(null);\n\t\tsetRecordingRoomId(null);\n\n\t\tsetTime('00:00');\n\n\t\tchat?.action.stop('recording');\n\n\t\tchat?.composer?.setRecordingMode(false);\n\n\t\tconst blob = await new Promise<Blob>((resolve) => audioRecorder.stop(resolve));\n\n\t\treturn blob;\n\t});\n\n\tconst handleUnmount = useMutableCallback(async () => {\n\t\tif (state === 'recording') {\n\t\t\tawait stopRecording();\n\t\t}\n\t});\n\n\tconst handleRecord = useMutableCallback(async () => {\n\t\tif (recordingRoomId && recordingRoomId !== rid) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait audioRecorder.start();\n\t\t\tchat?.action.performContinuously('recording');\n\t\t\tconst startTime = new Date();\n\t\t\tsetRecordingInterval(\n\t\t\t\tsetInterval(() => {\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tconst distance = (now.getTime() - startTime.getTime()) / 1000;\n\t\t\t\t\tconst minutes = Math.floor(distance / 60);\n\t\t\t\t\tconst seconds = Math.floor(distance % 60);\n\t\t\t\t\tsetTime(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);\n\t\t\t\t}, 1000),\n\t\t\t);\n\t\t\tsetRecordingRoomId(rid);\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t\tchat?.composer?.setRecordingMode(false);\n\t\t}\n\t});\n\n\tconst handleCancelButtonClick = useMutableCallback(async () => {\n\t\tawait stopRecording();\n\t});\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst handleDoneButtonClick = useMutableCallback(async () => {\n\t\tsetState('loading');\n\n\t\tconst blob = await stopRecording();\n\n\t\tconst fileName = `${t('Audio_record')}.mp3`;\n\t\tconst file = new File([blob], fileName, { type: 'audio/mpeg' });\n\n\t\tawait chat?.flows.uploadFiles([file]);\n\t});\n\n\tuseEffect(() => {\n\t\thandleRecord();\n\n\t\treturn () => {\n\t\t\thandleUnmount();\n\t\t};\n\t}, [handleUnmount, handleRecord]);\n\n\tconst stateClass = useMemo(() => {\n\t\tif (recordingRoomId && recordingRoomId !== rid) {\n\t\t\treturn 'rc-message-box__audio-message--busy';\n\t\t}\n\n\t\treturn state && `rc-message-box__audio-message--${state}`;\n\t}, [recordingRoomId, rid, state]);\n\n\tif (isMicrophoneDenied) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<Box position='absolute' pi={4} pb={12} className={`rc-message-box__audio-message ${stateClass}`}>\n\t\t\t{state === 'recording' && (\n\t\t\t\t<>\n\t\t\t\t\t<MessageComposerAction\n\t\t\t\t\t\ticon='circle-cross'\n\t\t\t\t\t\tclassName='rc-message-box__icon rc-message-box__audio-message-cancel'\n\t\t\t\t\t\tonClick={handleCancelButtonClick}\n\t\t\t\t\t/>\n\t\t\t\t\t<Box className='rc-message-box__audio-message-timer' color='default'>\n\t\t\t\t\t\t<span className='rc-message-box__audio-message-timer-dot'></span>\n\t\t\t\t\t\t<span className='rc-message-box__audio-message-timer-text'>{time}</span>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<MessageComposerAction\n\t\t\t\t\t\ticon='circle-check'\n\t\t\t\t\t\tclassName='rc-message-box__icon rc-message-box__audio-message-done'\n\t\t\t\t\t\tonClick={handleDoneButtonClick}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{state === 'loading' && (\n\t\t\t\t<div className='rc-message-box__icon'>\n\t\t\t\t\t<Throbber inheritColor size='x12' />\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</Box>\n\t);\n};\n\nexport default AudioMessageRecorder;\n"]}}},"code":"var _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nvar _slicedToArray;\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 1);\nvar Box, Throbber;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Box: function (v) {\n    Box = v;\n  },\n  Throbber: function (v) {\n    Throbber = v;\n  }\n}, 0);\nvar useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback: function (v) {\n    useMutableCallback = v;\n  }\n}, 1);\nvar MessageComposerAction;\nmodule.link(\"@rocket.chat/ui-composer\", {\n  MessageComposerAction: function (v) {\n    MessageComposerAction = v;\n  }\n}, 2);\nvar React, useEffect, useMemo, useState;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useMemo: function (v) {\n    useMemo = v;\n  },\n  useState: function (v) {\n    useState = v;\n  }\n}, 3);\nvar useTranslation;\nmodule.link(\"react-i18next\", {\n  useTranslation: function (v) {\n    useTranslation = v;\n  }\n}, 4);\nvar AudioRecorder;\nmodule.link(\"../../../../app/ui/client/lib/recorderjs/AudioRecorder\", {\n  AudioRecorder: function (v) {\n    AudioRecorder = v;\n  }\n}, 5);\nvar useChat;\nmodule.link(\"../../room/contexts/ChatContext\", {\n  useChat: function (v) {\n    useChat = v;\n  }\n}, 6);\nvar audioRecorder = new AudioRecorder();\nvar AudioMessageRecorder = function (_ref) {\n  var _useChat;\n  var rid = _ref.rid,\n    chatContext = _ref.chatContext,\n    isMicrophoneDenied = _ref.isMicrophoneDenied;\n  var _useTranslation = useTranslation(),\n    t = _useTranslation.t;\n  var _useState = useState('recording'),\n    _useState2 = _slicedToArray(_useState, 2),\n    state = _useState2[0],\n    setState = _useState2[1];\n  var _useState3 = useState('00:00'),\n    _useState4 = _slicedToArray(_useState3, 2),\n    time = _useState4[0],\n    setTime = _useState4[1];\n  var _useState5 = useState(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    recordingInterval = _useState6[0],\n    setRecordingInterval = _useState6[1];\n  var _useState7 = useState(null),\n    _useState8 = _slicedToArray(_useState7, 2),\n    recordingRoomId = _useState8[0],\n    setRecordingRoomId = _useState8[1];\n  var stopRecording = useMutableCallback(function () {\n    function _callee() {\n      var _chat$composer;\n      var blob;\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (recordingInterval) {\n                clearInterval(recordingInterval);\n              }\n              setRecordingInterval(null);\n              setRecordingRoomId(null);\n              setTime('00:00');\n              chat === null || chat === void 0 ? void 0 : chat.action.stop('recording');\n              chat === null || chat === void 0 ? void 0 : (_chat$composer = chat.composer) === null || _chat$composer === void 0 ? void 0 : _chat$composer.setRecordingMode(false);\n              _context.next = 8;\n              return _regeneratorRuntime.awrap(new Promise(function (resolve) {\n                return audioRecorder.stop(resolve);\n              }));\n            case 8:\n              blob = _context.sent;\n              return _context.abrupt(\"return\", blob);\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n        return _callee$;\n      }(), null, null, null, Promise);\n    }\n    return _callee;\n  }());\n  var handleUnmount = useMutableCallback(function () {\n    function _callee2() {\n      return _regeneratorRuntime.async(function () {\n        function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(state === 'recording')) {\n                _context2.next = 3;\n                break;\n              }\n              _context2.next = 3;\n              return _regeneratorRuntime.awrap(stopRecording());\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n        return _callee2$;\n      }(), null, null, null, Promise);\n    }\n    return _callee2;\n  }());\n  var handleRecord = useMutableCallback(function () {\n    function _callee3() {\n      var startTime, _chat$composer2;\n      return _regeneratorRuntime.async(function () {\n        function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!(recordingRoomId && recordingRoomId !== rid)) {\n                _context3.next = 2;\n                break;\n              }\n              return _context3.abrupt(\"return\");\n            case 2:\n              _context3.prev = 2;\n              _context3.next = 5;\n              return _regeneratorRuntime.awrap(audioRecorder.start());\n            case 5:\n              chat === null || chat === void 0 ? void 0 : chat.action.performContinuously('recording');\n              startTime = new Date();\n              setRecordingInterval(setInterval(function () {\n                var now = new Date();\n                var distance = (now.getTime() - startTime.getTime()) / 1000;\n                var minutes = Math.floor(distance / 60);\n                var seconds = Math.floor(distance % 60);\n                setTime(String(minutes).padStart(2, '0') + \":\" + String(seconds).padStart(2, '0'));\n              }, 1000));\n              setRecordingRoomId(rid);\n              _context3.next = 15;\n              break;\n            case 11:\n              _context3.prev = 11;\n              _context3.t0 = _context3[\"catch\"](2);\n              console.log(_context3.t0);\n              chat === null || chat === void 0 ? void 0 : (_chat$composer2 = chat.composer) === null || _chat$composer2 === void 0 ? void 0 : _chat$composer2.setRecordingMode(false);\n            case 15:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n        return _callee3$;\n      }(), null, null, [[2, 11]], Promise);\n    }\n    return _callee3;\n  }());\n  var handleCancelButtonClick = useMutableCallback(function () {\n    function _callee4() {\n      return _regeneratorRuntime.async(function () {\n        function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return _regeneratorRuntime.awrap(stopRecording());\n            case 2:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n        return _callee4$;\n      }(), null, null, null, Promise);\n    }\n    return _callee4;\n  }());\n  var chat = (_useChat = useChat()) !== null && _useChat !== void 0 ? _useChat : chatContext;\n  var handleDoneButtonClick = useMutableCallback(function () {\n    function _callee5() {\n      var blob, fileName, file;\n      return _regeneratorRuntime.async(function () {\n        function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              setState('loading');\n              _context5.next = 3;\n              return _regeneratorRuntime.awrap(stopRecording());\n            case 3:\n              blob = _context5.sent;\n              fileName = t('Audio_record') + \".mp3\";\n              file = new File([blob], fileName, {\n                type: 'audio/mpeg'\n              });\n              _context5.next = 8;\n              return _regeneratorRuntime.awrap(chat === null || chat === void 0 ? void 0 : chat.flows.uploadFiles([file]));\n            case 8:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n        return _callee5$;\n      }(), null, null, null, Promise);\n    }\n    return _callee5;\n  }());\n  useEffect(function () {\n    handleRecord();\n    return function () {\n      handleUnmount();\n    };\n  }, [handleUnmount, handleRecord]);\n  var stateClass = useMemo(function () {\n    if (recordingRoomId && recordingRoomId !== rid) {\n      return 'rc-message-box__audio-message--busy';\n    }\n    return state && \"rc-message-box__audio-message--\" + state;\n  }, [recordingRoomId, rid, state]);\n  if (isMicrophoneDenied) {\n    return null;\n  }\n  return /*#__PURE__*/React.createElement(Box, {\n    position: \"absolute\",\n    pi: 4,\n    pb: 12,\n    className: \"rc-message-box__audio-message \" + stateClass\n  }, state === 'recording' && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(MessageComposerAction, {\n    icon: \"circle-cross\",\n    className: \"rc-message-box__icon rc-message-box__audio-message-cancel\",\n    onClick: handleCancelButtonClick\n  }), /*#__PURE__*/React.createElement(Box, {\n    className: \"rc-message-box__audio-message-timer\",\n    color: \"default\"\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"rc-message-box__audio-message-timer-dot\"\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"rc-message-box__audio-message-timer-text\"\n  }, time)), /*#__PURE__*/React.createElement(MessageComposerAction, {\n    icon: \"circle-check\",\n    className: \"rc-message-box__icon rc-message-box__audio-message-done\",\n    onClick: handleDoneButtonClick\n  })), state === 'loading' && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"rc-message-box__icon\"\n  }, /*#__PURE__*/React.createElement(Throbber, {\n    inheritColor: true,\n    size: \"x12\"\n  })));\n};\nmodule.exportDefault(AudioMessageRecorder);","map":{"version":3,"names":["_regeneratorRuntime","module","link","default","v","_slicedToArray","Box","Throbber","useMutableCallback","MessageComposerAction","React","useEffect","useMemo","useState","useTranslation","AudioRecorder","useChat","audioRecorder","AudioMessageRecorder","_ref","_useChat","rid","chatContext","isMicrophoneDenied","_useTranslation","t","_useState","_useState2","state","setState","_useState3","_useState4","time","setTime","_useState5","_useState6","recordingInterval","setRecordingInterval","_useState7","_useState8","recordingRoomId","setRecordingRoomId","stopRecording","_callee","_chat$composer","blob","async","_callee$","_context","prev","next","clearInterval","chat","action","stop","composer","setRecordingMode","awrap","Promise","resolve","sent","abrupt","handleUnmount","_callee2","_callee2$","_context2","handleRecord","_callee3","startTime","_chat$composer2","_callee3$","_context3","start","performContinuously","Date","setInterval","now","distance","getTime","minutes","Math","floor","seconds","String","padStart","t0","console","log","handleCancelButtonClick","_callee4","_callee4$","_context4","handleDoneButtonClick","_callee5","fileName","file","_callee5$","_context5","File","type","flows","uploadFiles","stateClass","createElement","position","pi","pb","className","Fragment","icon","onClick","color","inheritColor","size","exportDefault"],"sources":["client/views/composer/AudioMessageRecorder/AudioMessageRecorder.tsx"],"sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport { Box, Throbber } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { MessageComposerAction } from '@rocket.chat/ui-composer';\nimport type { ReactElement } from 'react';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { AudioRecorder } from '../../../../app/ui/client/lib/recorderjs/AudioRecorder';\nimport type { ChatAPI } from '../../../lib/chats/ChatAPI';\nimport { useChat } from '../../room/contexts/ChatContext';\n\nconst audioRecorder = new AudioRecorder();\n\ntype AudioMessageRecorderProps = {\n\trid: IRoom['_id'];\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n\tisMicrophoneDenied?: boolean;\n};\n\nconst AudioMessageRecorder = ({ rid, chatContext, isMicrophoneDenied }: AudioMessageRecorderProps): ReactElement | null => {\n\tconst { t } = useTranslation();\n\n\tconst [state, setState] = useState<'loading' | 'recording'>('recording');\n\tconst [time, setTime] = useState('00:00');\n\tconst [recordingInterval, setRecordingInterval] = useState<ReturnType<typeof setInterval> | null>(null);\n\tconst [recordingRoomId, setRecordingRoomId] = useState<IRoom['_id'] | null>(null);\n\n\tconst stopRecording = useMutableCallback(async () => {\n\t\tif (recordingInterval) {\n\t\t\tclearInterval(recordingInterval);\n\t\t}\n\t\tsetRecordingInterval(null);\n\t\tsetRecordingRoomId(null);\n\n\t\tsetTime('00:00');\n\n\t\tchat?.action.stop('recording');\n\n\t\tchat?.composer?.setRecordingMode(false);\n\n\t\tconst blob = await new Promise<Blob>((resolve) => audioRecorder.stop(resolve));\n\n\t\treturn blob;\n\t});\n\n\tconst handleUnmount = useMutableCallback(async () => {\n\t\tif (state === 'recording') {\n\t\t\tawait stopRecording();\n\t\t}\n\t});\n\n\tconst handleRecord = useMutableCallback(async () => {\n\t\tif (recordingRoomId && recordingRoomId !== rid) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tawait audioRecorder.start();\n\t\t\tchat?.action.performContinuously('recording');\n\t\t\tconst startTime = new Date();\n\t\t\tsetRecordingInterval(\n\t\t\t\tsetInterval(() => {\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tconst distance = (now.getTime() - startTime.getTime()) / 1000;\n\t\t\t\t\tconst minutes = Math.floor(distance / 60);\n\t\t\t\t\tconst seconds = Math.floor(distance % 60);\n\t\t\t\t\tsetTime(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);\n\t\t\t\t}, 1000),\n\t\t\t);\n\t\t\tsetRecordingRoomId(rid);\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t\tchat?.composer?.setRecordingMode(false);\n\t\t}\n\t});\n\n\tconst handleCancelButtonClick = useMutableCallback(async () => {\n\t\tawait stopRecording();\n\t});\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst handleDoneButtonClick = useMutableCallback(async () => {\n\t\tsetState('loading');\n\n\t\tconst blob = await stopRecording();\n\n\t\tconst fileName = `${t('Audio_record')}.mp3`;\n\t\tconst file = new File([blob], fileName, { type: 'audio/mpeg' });\n\n\t\tawait chat?.flows.uploadFiles([file]);\n\t});\n\n\tuseEffect(() => {\n\t\thandleRecord();\n\n\t\treturn () => {\n\t\t\thandleUnmount();\n\t\t};\n\t}, [handleUnmount, handleRecord]);\n\n\tconst stateClass = useMemo(() => {\n\t\tif (recordingRoomId && recordingRoomId !== rid) {\n\t\t\treturn 'rc-message-box__audio-message--busy';\n\t\t}\n\n\t\treturn state && `rc-message-box__audio-message--${state}`;\n\t}, [recordingRoomId, rid, state]);\n\n\tif (isMicrophoneDenied) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<Box position='absolute' pi={4} pb={12} className={`rc-message-box__audio-message ${stateClass}`}>\n\t\t\t{state === 'recording' && (\n\t\t\t\t<>\n\t\t\t\t\t<MessageComposerAction\n\t\t\t\t\t\ticon='circle-cross'\n\t\t\t\t\t\tclassName='rc-message-box__icon rc-message-box__audio-message-cancel'\n\t\t\t\t\t\tonClick={handleCancelButtonClick}\n\t\t\t\t\t/>\n\t\t\t\t\t<Box className='rc-message-box__audio-message-timer' color='default'>\n\t\t\t\t\t\t<span className='rc-message-box__audio-message-timer-dot'></span>\n\t\t\t\t\t\t<span className='rc-message-box__audio-message-timer-text'>{time}</span>\n\t\t\t\t\t</Box>\n\t\t\t\t\t<MessageComposerAction\n\t\t\t\t\t\ticon='circle-check'\n\t\t\t\t\t\tclassName='rc-message-box__icon rc-message-box__audio-message-done'\n\t\t\t\t\t\tonClick={handleDoneButtonClick}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{state === 'loading' && (\n\t\t\t\t<div className='rc-message-box__icon'>\n\t\t\t\t\t<Throbber inheritColor size='x12' />\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</Box>\n\t);\n};\n\nexport default AudioMessageRecorder;\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"a3d41a3e3f4f6b74c0cc95c0461dab5696d12054"}
