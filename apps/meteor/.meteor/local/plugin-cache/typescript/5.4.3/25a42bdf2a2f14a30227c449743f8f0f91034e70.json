{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/ufs/ufs-local.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"server/ufs/ufs-local.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/ufs/ufs-local.ts","inputSourceMap":{"version":3,"file":"server/ufs/ufs-local.ts","sourceRoot":"","sources":["server/ufs/ufs-local.ts"],"names":[],"mappings":"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","sourcesContent":["import fs from 'fs';\nimport { stat, unlink } from 'fs/promises';\n\nimport type { IUpload } from '@rocket.chat/core-typings';\nimport mkdirp from 'mkdirp';\n\nimport { UploadFS } from './ufs';\nimport type { StoreOptions } from './ufs-store';\nimport { Store } from './ufs-store';\n\ntype LocalStoreOptions = StoreOptions & {\n\tmode?: string;\n\tpath?: string;\n\twriteMode?: number;\n};\n\nexport class LocalStore extends Store {\n\tprotected getPath: (file: string) => string;\n\n\tconstructor(options: LocalStoreOptions) {\n\t\t// Default options\n\t\toptions = {\n\t\t\tmode: '0744',\n\t\t\tpath: 'ufs/uploads',\n\t\t\twriteMode: 0o744,\n\t\t\t...options,\n\t\t};\n\n\t\t// Check options\n\t\tif (typeof options.mode !== 'string') {\n\t\t\tthrow new TypeError('LocalStore: mode is not a string');\n\t\t}\n\t\tif (typeof options.path !== 'string') {\n\t\t\tthrow new TypeError('LocalStore: path is not a string');\n\t\t}\n\t\tif (typeof options.writeMode !== 'number') {\n\t\t\tthrow new TypeError('LocalStore: writeMode is not a string');\n\t\t}\n\n\t\tsuper(options);\n\n\t\t// Private attributes\n\t\tconst { mode } = options;\n\t\tconst { path } = options;\n\t\tconst { writeMode } = options;\n\n\t\tfs.stat(path, (err) => {\n\t\t\tif (err) {\n\t\t\t\t// Create the directory\n\t\t\t\tmkdirp(path, { mode })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tconsole.info(`LocalStore: store created at ${path}`);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\tconsole.error(`LocalStore: cannot create store at ${path} (${err.message})`);\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Set directory permissions\n\t\t\t\tfs.chmod(path, mode, (err) => {\n\t\t\t\t\terr && console.error(`LocalStore: cannot set store permissions ${mode} (${err.message})`);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.getPath = function (file) {\n\t\t\treturn path + (file ? `/${file}` : '');\n\t\t};\n\n\t\tthis.delete = async (fileId) => {\n\t\t\tconst path = await this.getFilePath(fileId);\n\n\t\t\ttry {\n\t\t\t\tif (!(await stat(path)).isFile()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} catch (_e) {\n\t\t\t\t// FIXME(user) don't ignore, rather this block shouldn't run twice like it does now\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait unlink(path);\n\t\t\tawait this.removeById(fileId);\n\t\t};\n\n\t\tthis.getReadStream = async (fileId: string, file: IUpload, options?: { start?: number; end?: number }) => {\n\t\t\toptions = Object.assign({}, options);\n\t\t\treturn fs.createReadStream(await this.getFilePath(fileId, file), {\n\t\t\t\tflags: 'r',\n\t\t\t\tencoding: undefined,\n\t\t\t\tautoClose: true,\n\t\t\t\tstart: options.start,\n\t\t\t\tend: options.end,\n\t\t\t});\n\t\t};\n\n\t\tthis.getWriteStream = async (fileId: string, file: IUpload, options?: { start?: number }) => {\n\t\t\toptions = Object.assign({}, options);\n\t\t\treturn fs.createWriteStream(await this.getFilePath(fileId, file), {\n\t\t\t\tflags: 'a',\n\t\t\t\tencoding: undefined,\n\t\t\t\tmode: writeMode,\n\t\t\t\tstart: options.start,\n\t\t\t});\n\t\t};\n\t}\n\n\tasync getFilePath(fileId: string, fileParam?: IUpload): Promise<string> {\n\t\tconst file = fileParam || (await this.getCollection().findOne(fileId, { projection: { extension: 1 } }));\n\t\treturn (file && this.getPath(fileId + (file.extension ? `.${file.extension}` : ''))) || '';\n\t}\n}\n\n// Add store to UFS namespace\nUploadFS.store.Local = LocalStore;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/server/ufs/ufs-local.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"server/ufs/ufs-local.ts","inputSourceMap":{"version":3,"file":"server/ufs/ufs-local.ts","sourceRoot":"","sources":["server/ufs/ufs-local.ts"],"names":[],"mappings":"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","sourcesContent":["import fs from 'fs';\nimport { stat, unlink } from 'fs/promises';\n\nimport type { IUpload } from '@rocket.chat/core-typings';\nimport mkdirp from 'mkdirp';\n\nimport { UploadFS } from './ufs';\nimport type { StoreOptions } from './ufs-store';\nimport { Store } from './ufs-store';\n\ntype LocalStoreOptions = StoreOptions & {\n\tmode?: string;\n\tpath?: string;\n\twriteMode?: number;\n};\n\nexport class LocalStore extends Store {\n\tprotected getPath: (file: string) => string;\n\n\tconstructor(options: LocalStoreOptions) {\n\t\t// Default options\n\t\toptions = {\n\t\t\tmode: '0744',\n\t\t\tpath: 'ufs/uploads',\n\t\t\twriteMode: 0o744,\n\t\t\t...options,\n\t\t};\n\n\t\t// Check options\n\t\tif (typeof options.mode !== 'string') {\n\t\t\tthrow new TypeError('LocalStore: mode is not a string');\n\t\t}\n\t\tif (typeof options.path !== 'string') {\n\t\t\tthrow new TypeError('LocalStore: path is not a string');\n\t\t}\n\t\tif (typeof options.writeMode !== 'number') {\n\t\t\tthrow new TypeError('LocalStore: writeMode is not a string');\n\t\t}\n\n\t\tsuper(options);\n\n\t\t// Private attributes\n\t\tconst { mode } = options;\n\t\tconst { path } = options;\n\t\tconst { writeMode } = options;\n\n\t\tfs.stat(path, (err) => {\n\t\t\tif (err) {\n\t\t\t\t// Create the directory\n\t\t\t\tmkdirp(path, { mode })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tconsole.info(`LocalStore: store created at ${path}`);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\tconsole.error(`LocalStore: cannot create store at ${path} (${err.message})`);\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Set directory permissions\n\t\t\t\tfs.chmod(path, mode, (err) => {\n\t\t\t\t\terr && console.error(`LocalStore: cannot set store permissions ${mode} (${err.message})`);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.getPath = function (file) {\n\t\t\treturn path + (file ? `/${file}` : '');\n\t\t};\n\n\t\tthis.delete = async (fileId) => {\n\t\t\tconst path = await this.getFilePath(fileId);\n\n\t\t\ttry {\n\t\t\t\tif (!(await stat(path)).isFile()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} catch (_e) {\n\t\t\t\t// FIXME(user) don't ignore, rather this block shouldn't run twice like it does now\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait unlink(path);\n\t\t\tawait this.removeById(fileId);\n\t\t};\n\n\t\tthis.getReadStream = async (fileId: string, file: IUpload, options?: { start?: number; end?: number }) => {\n\t\t\toptions = Object.assign({}, options);\n\t\t\treturn fs.createReadStream(await this.getFilePath(fileId, file), {\n\t\t\t\tflags: 'r',\n\t\t\t\tencoding: undefined,\n\t\t\t\tautoClose: true,\n\t\t\t\tstart: options.start,\n\t\t\t\tend: options.end,\n\t\t\t});\n\t\t};\n\n\t\tthis.getWriteStream = async (fileId: string, file: IUpload, options?: { start?: number }) => {\n\t\t\toptions = Object.assign({}, options);\n\t\t\treturn fs.createWriteStream(await this.getFilePath(fileId, file), {\n\t\t\t\tflags: 'a',\n\t\t\t\tencoding: undefined,\n\t\t\t\tmode: writeMode,\n\t\t\t\tstart: options.start,\n\t\t\t});\n\t\t};\n\t}\n\n\tasync getFilePath(fileId: string, fileParam?: IUpload): Promise<string> {\n\t\tconst file = fileParam || (await this.getCollection().findOne(fileId, { projection: { extension: 1 } }));\n\t\treturn (file && this.getPath(fileId + (file.extension ? `.${file.extension}` : ''))) || '';\n\t}\n}\n\n// Add store to UFS namespace\nUploadFS.store.Local = LocalStore;\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let _objectSpread;\n    module.link(\"@babel/runtime/helpers/objectSpread2\", {\n      default(v) {\n        _objectSpread = v;\n      }\n    }, 0);\n    module.export({\n      LocalStore: () => LocalStore\n    });\n    let fs;\n    module.link(\"fs\", {\n      default(v) {\n        fs = v;\n      }\n    }, 0);\n    let stat, unlink;\n    module.link(\"fs/promises\", {\n      stat(v) {\n        stat = v;\n      },\n      unlink(v) {\n        unlink = v;\n      }\n    }, 1);\n    let mkdirp;\n    module.link(\"mkdirp\", {\n      default(v) {\n        mkdirp = v;\n      }\n    }, 2);\n    let UploadFS;\n    module.link(\"./ufs\", {\n      UploadFS(v) {\n        UploadFS = v;\n      }\n    }, 3);\n    let Store;\n    module.link(\"./ufs-store\", {\n      Store(v) {\n        Store = v;\n      }\n    }, 4);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    class LocalStore extends Store {\n      constructor(options) {\n        // Default options\n        options = _objectSpread({\n          mode: '0744',\n          path: 'ufs/uploads',\n          writeMode: 484\n        }, options);\n        // Check options\n        if (typeof options.mode !== 'string') {\n          throw new TypeError('LocalStore: mode is not a string');\n        }\n        if (typeof options.path !== 'string') {\n          throw new TypeError('LocalStore: path is not a string');\n        }\n        if (typeof options.writeMode !== 'number') {\n          throw new TypeError('LocalStore: writeMode is not a string');\n        }\n        super(options);\n        // Private attributes\n        this.getPath = void 0;\n        const {\n          mode\n        } = options;\n        const {\n          path\n        } = options;\n        const {\n          writeMode\n        } = options;\n        fs.stat(path, err => {\n          if (err) {\n            // Create the directory\n            mkdirp(path, {\n              mode\n            }).then(() => {\n              console.info(\"LocalStore: store created at \".concat(path));\n            }).catch(err => {\n              console.error(\"LocalStore: cannot create store at \".concat(path, \" (\").concat(err.message, \")\"));\n            });\n          } else {\n            // Set directory permissions\n            fs.chmod(path, mode, err => {\n              err && console.error(\"LocalStore: cannot set store permissions \".concat(mode, \" (\").concat(err.message, \")\"));\n            });\n          }\n        });\n        this.getPath = function (file) {\n          return path + (file ? \"/\".concat(file) : '');\n        };\n        this.delete = async fileId => {\n          const path = await this.getFilePath(fileId);\n          try {\n            if (!(await stat(path)).isFile()) {\n              return;\n            }\n          } catch (_e) {\n            // FIXME(user) don't ignore, rather this block shouldn't run twice like it does now\n            return;\n          }\n          await unlink(path);\n          await this.removeById(fileId);\n        };\n        this.getReadStream = async (fileId, file, options) => {\n          options = Object.assign({}, options);\n          return fs.createReadStream(await this.getFilePath(fileId, file), {\n            flags: 'r',\n            encoding: undefined,\n            autoClose: true,\n            start: options.start,\n            end: options.end\n          });\n        };\n        this.getWriteStream = async (fileId, file, options) => {\n          options = Object.assign({}, options);\n          return fs.createWriteStream(await this.getFilePath(fileId, file), {\n            flags: 'a',\n            encoding: undefined,\n            mode: writeMode,\n            start: options.start\n          });\n        };\n      }\n      async getFilePath(fileId, fileParam) {\n        const file = fileParam || (await this.getCollection().findOne(fileId, {\n          projection: {\n            extension: 1\n          }\n        }));\n        return file && this.getPath(fileId + (file.extension ? \".\".concat(file.extension) : '')) || '';\n      }\n    }\n    // Add store to UFS namespace\n    UploadFS.store.Local = LocalStore;\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["_objectSpread","module","link","default","v","export","LocalStore","fs","stat","unlink","mkdirp","UploadFS","Store","__reifyWaitForDeps__","constructor","options","mode","path","writeMode","TypeError","getPath","err","then","console","info","concat","catch","error","message","chmod","file","delete","fileId","getFilePath","isFile","_e","removeById","getReadStream","Object","assign","createReadStream","flags","encoding","undefined","autoClose","start","end","getWriteStream","createWriteStream","fileParam","getCollection","findOne","projection","extension","store","Local","__reify_async_result__","_reifyError","self","async"],"sources":["server/ufs/ufs-local.ts"],"sourcesContent":["import fs from 'fs';\nimport { stat, unlink } from 'fs/promises';\n\nimport type { IUpload } from '@rocket.chat/core-typings';\nimport mkdirp from 'mkdirp';\n\nimport { UploadFS } from './ufs';\nimport type { StoreOptions } from './ufs-store';\nimport { Store } from './ufs-store';\n\ntype LocalStoreOptions = StoreOptions & {\n\tmode?: string;\n\tpath?: string;\n\twriteMode?: number;\n};\n\nexport class LocalStore extends Store {\n\tprotected getPath: (file: string) => string;\n\n\tconstructor(options: LocalStoreOptions) {\n\t\t// Default options\n\t\toptions = {\n\t\t\tmode: '0744',\n\t\t\tpath: 'ufs/uploads',\n\t\t\twriteMode: 0o744,\n\t\t\t...options,\n\t\t};\n\n\t\t// Check options\n\t\tif (typeof options.mode !== 'string') {\n\t\t\tthrow new TypeError('LocalStore: mode is not a string');\n\t\t}\n\t\tif (typeof options.path !== 'string') {\n\t\t\tthrow new TypeError('LocalStore: path is not a string');\n\t\t}\n\t\tif (typeof options.writeMode !== 'number') {\n\t\t\tthrow new TypeError('LocalStore: writeMode is not a string');\n\t\t}\n\n\t\tsuper(options);\n\n\t\t// Private attributes\n\t\tconst { mode } = options;\n\t\tconst { path } = options;\n\t\tconst { writeMode } = options;\n\n\t\tfs.stat(path, (err) => {\n\t\t\tif (err) {\n\t\t\t\t// Create the directory\n\t\t\t\tmkdirp(path, { mode })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tconsole.info(`LocalStore: store created at ${path}`);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\tconsole.error(`LocalStore: cannot create store at ${path} (${err.message})`);\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Set directory permissions\n\t\t\t\tfs.chmod(path, mode, (err) => {\n\t\t\t\t\terr && console.error(`LocalStore: cannot set store permissions ${mode} (${err.message})`);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.getPath = function (file) {\n\t\t\treturn path + (file ? `/${file}` : '');\n\t\t};\n\n\t\tthis.delete = async (fileId) => {\n\t\t\tconst path = await this.getFilePath(fileId);\n\n\t\t\ttry {\n\t\t\t\tif (!(await stat(path)).isFile()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} catch (_e) {\n\t\t\t\t// FIXME(user) don't ignore, rather this block shouldn't run twice like it does now\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait unlink(path);\n\t\t\tawait this.removeById(fileId);\n\t\t};\n\n\t\tthis.getReadStream = async (fileId: string, file: IUpload, options?: { start?: number; end?: number }) => {\n\t\t\toptions = Object.assign({}, options);\n\t\t\treturn fs.createReadStream(await this.getFilePath(fileId, file), {\n\t\t\t\tflags: 'r',\n\t\t\t\tencoding: undefined,\n\t\t\t\tautoClose: true,\n\t\t\t\tstart: options.start,\n\t\t\t\tend: options.end,\n\t\t\t});\n\t\t};\n\n\t\tthis.getWriteStream = async (fileId: string, file: IUpload, options?: { start?: number }) => {\n\t\t\toptions = Object.assign({}, options);\n\t\t\treturn fs.createWriteStream(await this.getFilePath(fileId, file), {\n\t\t\t\tflags: 'a',\n\t\t\t\tencoding: undefined,\n\t\t\t\tmode: writeMode,\n\t\t\t\tstart: options.start,\n\t\t\t});\n\t\t};\n\t}\n\n\tasync getFilePath(fileId: string, fileParam?: IUpload): Promise<string> {\n\t\tconst file = fileParam || (await this.getCollection().findOne(fileId, { projection: { extension: 1 } }));\n\t\treturn (file && this.getPath(fileId + (file.extension ? `.${file.extension}` : ''))) || '';\n\t}\n}\n\n// Add store to UFS namespace\nUploadFS.store.Local = LocalStore;\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"25a42bdf2a2f14a30227c449743f8f0f91034e70"}
