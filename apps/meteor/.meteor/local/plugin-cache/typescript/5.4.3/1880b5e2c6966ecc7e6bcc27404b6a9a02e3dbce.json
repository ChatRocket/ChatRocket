{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/federation/Federation.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/lib/federation/Federation.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/federation/Federation.ts","inputSourceMap":{"version":3,"file":"client/lib/federation/Federation.ts","sourceRoot":"","sources":["client/lib/federation/Federation.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom, ISubscription, IUser, ValueOf } from '@rocket.chat/core-typings';\nimport { isRoomFederated, isDirectMessageRoom, isPublicRoom } from '@rocket.chat/core-typings';\n\nimport { RoomRoles } from '../../../app/models/client';\nimport { RoomMemberActions, RoomSettingsEnum } from '../../../definition/IRoomTypeConfig';\n\nconst allowedUserActionsInFederatedRooms: ValueOf<typeof RoomMemberActions>[] = [\n\tRoomMemberActions.REMOVE_USER,\n\tRoomMemberActions.SET_AS_OWNER,\n\tRoomMemberActions.SET_AS_MODERATOR,\n];\n\nconst allowedRoomSettingsChangesInFederatedRooms: ValueOf<typeof RoomSettingsEnum>[] = [RoomSettingsEnum.NAME, RoomSettingsEnum.TOPIC];\n\nexport const actionAllowed = (\n\troom: Partial<IRoom>,\n\taction: ValueOf<typeof RoomMemberActions>,\n\tdisplayingUserId: IUser['_id'],\n\tuserSubscription?: ISubscription,\n): boolean => {\n\tif (!isRoomFederated(room)) {\n\t\treturn false;\n\t}\n\n\tif (isDirectMessageRoom(room)) {\n\t\treturn false;\n\t}\n\n\tconst subscribed = Boolean(userSubscription);\n\tconst defaultUser = !userSubscription?.roles;\n\tif (!subscribed || defaultUser) {\n\t\treturn false;\n\t}\n\n\tconst myself = userSubscription.u?._id === displayingUserId;\n\tconst removingMyself = action === RoomMemberActions.REMOVE_USER && myself;\n\n\tif (removingMyself) {\n\t\treturn false;\n\t}\n\n\tconst displayingUserRoomRoles = RoomRoles.findOne({ 'rid': room._id, 'u._id': displayingUserId })?.roles || [];\n\tconst loggedInUserRoomRoles = userSubscription.roles || [];\n\n\tif (loggedInUserRoomRoles.includes('owner')) {\n\t\tif (action === RoomMemberActions.SET_AS_OWNER || action === RoomMemberActions.SET_AS_MODERATOR) {\n\t\t\treturn displayingUserRoomRoles.includes('owner') ? myself : true;\n\t\t}\n\n\t\tif (action === RoomMemberActions.REMOVE_USER) {\n\t\t\treturn !displayingUserRoomRoles.includes('owner');\n\t\t}\n\t\tconst allowedForOwnersOverDefaultUsers = allowedUserActionsInFederatedRooms.includes(action);\n\n\t\treturn allowedForOwnersOverDefaultUsers;\n\t}\n\n\tif (loggedInUserRoomRoles.includes('moderator')) {\n\t\tif (displayingUserRoomRoles.includes('owner')) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (displayingUserRoomRoles.includes('moderator')) {\n\t\t\tif (action === RoomMemberActions.SET_AS_MODERATOR) {\n\t\t\t\treturn myself;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tconst allowedForModeratorsOverDefaultUsers = action === RoomMemberActions.SET_AS_MODERATOR || action === RoomMemberActions.REMOVE_USER;\n\n\t\treturn allowedForModeratorsOverDefaultUsers;\n\t}\n\n\treturn false;\n};\n\nexport const isEditableByTheUser = (user?: IUser, room?: IRoom, subscription?: ISubscription): boolean => {\n\tif (!user || !room || !subscription) {\n\t\treturn false;\n\t}\n\treturn isRoomFederated(room) && Boolean(subscription.roles?.includes('owner') || subscription.roles?.includes('moderator'));\n};\n\nexport const canCreateInviteLinks = (user?: IUser, room?: IRoom, subscription?: ISubscription): boolean => {\n\tif (!user || !room || !subscription) {\n\t\treturn false;\n\t}\n\treturn (\n\t\tisRoomFederated(room) &&\n\t\tisPublicRoom(room) &&\n\t\tBoolean(subscription.roles?.includes('owner') || subscription.roles?.includes('moderator'))\n\t);\n};\n\nexport const isRoomSettingAllowed = (room: Partial<IRoom>, setting: ValueOf<typeof RoomSettingsEnum>): boolean => {\n\tif (!isRoomFederated(room)) {\n\t\treturn false;\n\t}\n\n\tif (isDirectMessageRoom(room)) {\n\t\treturn false;\n\t}\n\treturn allowedRoomSettingsChangesInFederatedRooms.includes(setting);\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/federation/Federation.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/lib/federation/Federation.ts","inputSourceMap":{"version":3,"file":"client/lib/federation/Federation.ts","sourceRoot":"","sources":["client/lib/federation/Federation.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom, ISubscription, IUser, ValueOf } from '@rocket.chat/core-typings';\nimport { isRoomFederated, isDirectMessageRoom, isPublicRoom } from '@rocket.chat/core-typings';\n\nimport { RoomRoles } from '../../../app/models/client';\nimport { RoomMemberActions, RoomSettingsEnum } from '../../../definition/IRoomTypeConfig';\n\nconst allowedUserActionsInFederatedRooms: ValueOf<typeof RoomMemberActions>[] = [\n\tRoomMemberActions.REMOVE_USER,\n\tRoomMemberActions.SET_AS_OWNER,\n\tRoomMemberActions.SET_AS_MODERATOR,\n];\n\nconst allowedRoomSettingsChangesInFederatedRooms: ValueOf<typeof RoomSettingsEnum>[] = [RoomSettingsEnum.NAME, RoomSettingsEnum.TOPIC];\n\nexport const actionAllowed = (\n\troom: Partial<IRoom>,\n\taction: ValueOf<typeof RoomMemberActions>,\n\tdisplayingUserId: IUser['_id'],\n\tuserSubscription?: ISubscription,\n): boolean => {\n\tif (!isRoomFederated(room)) {\n\t\treturn false;\n\t}\n\n\tif (isDirectMessageRoom(room)) {\n\t\treturn false;\n\t}\n\n\tconst subscribed = Boolean(userSubscription);\n\tconst defaultUser = !userSubscription?.roles;\n\tif (!subscribed || defaultUser) {\n\t\treturn false;\n\t}\n\n\tconst myself = userSubscription.u?._id === displayingUserId;\n\tconst removingMyself = action === RoomMemberActions.REMOVE_USER && myself;\n\n\tif (removingMyself) {\n\t\treturn false;\n\t}\n\n\tconst displayingUserRoomRoles = RoomRoles.findOne({ 'rid': room._id, 'u._id': displayingUserId })?.roles || [];\n\tconst loggedInUserRoomRoles = userSubscription.roles || [];\n\n\tif (loggedInUserRoomRoles.includes('owner')) {\n\t\tif (action === RoomMemberActions.SET_AS_OWNER || action === RoomMemberActions.SET_AS_MODERATOR) {\n\t\t\treturn displayingUserRoomRoles.includes('owner') ? myself : true;\n\t\t}\n\n\t\tif (action === RoomMemberActions.REMOVE_USER) {\n\t\t\treturn !displayingUserRoomRoles.includes('owner');\n\t\t}\n\t\tconst allowedForOwnersOverDefaultUsers = allowedUserActionsInFederatedRooms.includes(action);\n\n\t\treturn allowedForOwnersOverDefaultUsers;\n\t}\n\n\tif (loggedInUserRoomRoles.includes('moderator')) {\n\t\tif (displayingUserRoomRoles.includes('owner')) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (displayingUserRoomRoles.includes('moderator')) {\n\t\t\tif (action === RoomMemberActions.SET_AS_MODERATOR) {\n\t\t\t\treturn myself;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tconst allowedForModeratorsOverDefaultUsers = action === RoomMemberActions.SET_AS_MODERATOR || action === RoomMemberActions.REMOVE_USER;\n\n\t\treturn allowedForModeratorsOverDefaultUsers;\n\t}\n\n\treturn false;\n};\n\nexport const isEditableByTheUser = (user?: IUser, room?: IRoom, subscription?: ISubscription): boolean => {\n\tif (!user || !room || !subscription) {\n\t\treturn false;\n\t}\n\treturn isRoomFederated(room) && Boolean(subscription.roles?.includes('owner') || subscription.roles?.includes('moderator'));\n};\n\nexport const canCreateInviteLinks = (user?: IUser, room?: IRoom, subscription?: ISubscription): boolean => {\n\tif (!user || !room || !subscription) {\n\t\treturn false;\n\t}\n\treturn (\n\t\tisRoomFederated(room) &&\n\t\tisPublicRoom(room) &&\n\t\tBoolean(subscription.roles?.includes('owner') || subscription.roles?.includes('moderator'))\n\t);\n};\n\nexport const isRoomSettingAllowed = (room: Partial<IRoom>, setting: ValueOf<typeof RoomSettingsEnum>): boolean => {\n\tif (!isRoomFederated(room)) {\n\t\treturn false;\n\t}\n\n\tif (isDirectMessageRoom(room)) {\n\t\treturn false;\n\t}\n\treturn allowedRoomSettingsChangesInFederatedRooms.includes(setting);\n};\n"]}}},"code":"module.export({\n  actionAllowed: function () {\n    return actionAllowed;\n  },\n  isEditableByTheUser: function () {\n    return isEditableByTheUser;\n  },\n  canCreateInviteLinks: function () {\n    return canCreateInviteLinks;\n  },\n  isRoomSettingAllowed: function () {\n    return isRoomSettingAllowed;\n  }\n});\nvar isRoomFederated, isDirectMessageRoom, isPublicRoom;\nmodule.link(\"@rocket.chat/core-typings\", {\n  isRoomFederated: function (v) {\n    isRoomFederated = v;\n  },\n  isDirectMessageRoom: function (v) {\n    isDirectMessageRoom = v;\n  },\n  isPublicRoom: function (v) {\n    isPublicRoom = v;\n  }\n}, 0);\nvar RoomRoles;\nmodule.link(\"../../../app/models/client\", {\n  RoomRoles: function (v) {\n    RoomRoles = v;\n  }\n}, 1);\nvar RoomMemberActions, RoomSettingsEnum;\nmodule.link(\"../../../definition/IRoomTypeConfig\", {\n  RoomMemberActions: function (v) {\n    RoomMemberActions = v;\n  },\n  RoomSettingsEnum: function (v) {\n    RoomSettingsEnum = v;\n  }\n}, 2);\nvar allowedUserActionsInFederatedRooms = [RoomMemberActions.REMOVE_USER, RoomMemberActions.SET_AS_OWNER, RoomMemberActions.SET_AS_MODERATOR];\nvar allowedRoomSettingsChangesInFederatedRooms = [RoomSettingsEnum.NAME, RoomSettingsEnum.TOPIC];\nvar actionAllowed = function (room, action, displayingUserId, userSubscription) {\n  var _userSubscription$u, _RoomRoles$findOne;\n  if (!isRoomFederated(room)) {\n    return false;\n  }\n  if (isDirectMessageRoom(room)) {\n    return false;\n  }\n  var subscribed = Boolean(userSubscription);\n  var defaultUser = !(userSubscription !== null && userSubscription !== void 0 && userSubscription.roles);\n  if (!subscribed || defaultUser) {\n    return false;\n  }\n  var myself = ((_userSubscription$u = userSubscription.u) === null || _userSubscription$u === void 0 ? void 0 : _userSubscription$u._id) === displayingUserId;\n  var removingMyself = action === RoomMemberActions.REMOVE_USER && myself;\n  if (removingMyself) {\n    return false;\n  }\n  var displayingUserRoomRoles = ((_RoomRoles$findOne = RoomRoles.findOne({\n    'rid': room._id,\n    'u._id': displayingUserId\n  })) === null || _RoomRoles$findOne === void 0 ? void 0 : _RoomRoles$findOne.roles) || [];\n  var loggedInUserRoomRoles = userSubscription.roles || [];\n  if (loggedInUserRoomRoles.includes('owner')) {\n    if (action === RoomMemberActions.SET_AS_OWNER || action === RoomMemberActions.SET_AS_MODERATOR) {\n      return displayingUserRoomRoles.includes('owner') ? myself : true;\n    }\n    if (action === RoomMemberActions.REMOVE_USER) {\n      return !displayingUserRoomRoles.includes('owner');\n    }\n    var allowedForOwnersOverDefaultUsers = allowedUserActionsInFederatedRooms.includes(action);\n    return allowedForOwnersOverDefaultUsers;\n  }\n  if (loggedInUserRoomRoles.includes('moderator')) {\n    if (displayingUserRoomRoles.includes('owner')) {\n      return false;\n    }\n    if (displayingUserRoomRoles.includes('moderator')) {\n      if (action === RoomMemberActions.SET_AS_MODERATOR) {\n        return myself;\n      }\n      return false;\n    }\n    var allowedForModeratorsOverDefaultUsers = action === RoomMemberActions.SET_AS_MODERATOR || action === RoomMemberActions.REMOVE_USER;\n    return allowedForModeratorsOverDefaultUsers;\n  }\n  return false;\n};\nvar isEditableByTheUser = function (user, room, subscription) {\n  var _subscription$roles, _subscription$roles2;\n  if (!user || !room || !subscription) {\n    return false;\n  }\n  return isRoomFederated(room) && Boolean(((_subscription$roles = subscription.roles) === null || _subscription$roles === void 0 ? void 0 : _subscription$roles.includes('owner')) || ((_subscription$roles2 = subscription.roles) === null || _subscription$roles2 === void 0 ? void 0 : _subscription$roles2.includes('moderator')));\n};\nvar canCreateInviteLinks = function (user, room, subscription) {\n  var _subscription$roles3, _subscription$roles4;\n  if (!user || !room || !subscription) {\n    return false;\n  }\n  return isRoomFederated(room) && isPublicRoom(room) && Boolean(((_subscription$roles3 = subscription.roles) === null || _subscription$roles3 === void 0 ? void 0 : _subscription$roles3.includes('owner')) || ((_subscription$roles4 = subscription.roles) === null || _subscription$roles4 === void 0 ? void 0 : _subscription$roles4.includes('moderator')));\n};\nvar isRoomSettingAllowed = function (room, setting) {\n  if (!isRoomFederated(room)) {\n    return false;\n  }\n  if (isDirectMessageRoom(room)) {\n    return false;\n  }\n  return allowedRoomSettingsChangesInFederatedRooms.includes(setting);\n};","map":{"version":3,"names":["module","export","actionAllowed","isEditableByTheUser","canCreateInviteLinks","isRoomSettingAllowed","isRoomFederated","isDirectMessageRoom","isPublicRoom","link","v","RoomRoles","RoomMemberActions","RoomSettingsEnum","allowedUserActionsInFederatedRooms","REMOVE_USER","SET_AS_OWNER","SET_AS_MODERATOR","allowedRoomSettingsChangesInFederatedRooms","NAME","TOPIC","room","action","displayingUserId","userSubscription","_userSubscription$u","_RoomRoles$findOne","subscribed","Boolean","defaultUser","roles","myself","u","_id","removingMyself","displayingUserRoomRoles","findOne","loggedInUserRoomRoles","includes","allowedForOwnersOverDefaultUsers","allowedForModeratorsOverDefaultUsers","user","subscription","_subscription$roles","_subscription$roles2","_subscription$roles3","_subscription$roles4","setting"],"sources":["client/lib/federation/Federation.ts"],"sourcesContent":["import type { IRoom, ISubscription, IUser, ValueOf } from '@rocket.chat/core-typings';\nimport { isRoomFederated, isDirectMessageRoom, isPublicRoom } from '@rocket.chat/core-typings';\n\nimport { RoomRoles } from '../../../app/models/client';\nimport { RoomMemberActions, RoomSettingsEnum } from '../../../definition/IRoomTypeConfig';\n\nconst allowedUserActionsInFederatedRooms: ValueOf<typeof RoomMemberActions>[] = [\n\tRoomMemberActions.REMOVE_USER,\n\tRoomMemberActions.SET_AS_OWNER,\n\tRoomMemberActions.SET_AS_MODERATOR,\n];\n\nconst allowedRoomSettingsChangesInFederatedRooms: ValueOf<typeof RoomSettingsEnum>[] = [RoomSettingsEnum.NAME, RoomSettingsEnum.TOPIC];\n\nexport const actionAllowed = (\n\troom: Partial<IRoom>,\n\taction: ValueOf<typeof RoomMemberActions>,\n\tdisplayingUserId: IUser['_id'],\n\tuserSubscription?: ISubscription,\n): boolean => {\n\tif (!isRoomFederated(room)) {\n\t\treturn false;\n\t}\n\n\tif (isDirectMessageRoom(room)) {\n\t\treturn false;\n\t}\n\n\tconst subscribed = Boolean(userSubscription);\n\tconst defaultUser = !userSubscription?.roles;\n\tif (!subscribed || defaultUser) {\n\t\treturn false;\n\t}\n\n\tconst myself = userSubscription.u?._id === displayingUserId;\n\tconst removingMyself = action === RoomMemberActions.REMOVE_USER && myself;\n\n\tif (removingMyself) {\n\t\treturn false;\n\t}\n\n\tconst displayingUserRoomRoles = RoomRoles.findOne({ 'rid': room._id, 'u._id': displayingUserId })?.roles || [];\n\tconst loggedInUserRoomRoles = userSubscription.roles || [];\n\n\tif (loggedInUserRoomRoles.includes('owner')) {\n\t\tif (action === RoomMemberActions.SET_AS_OWNER || action === RoomMemberActions.SET_AS_MODERATOR) {\n\t\t\treturn displayingUserRoomRoles.includes('owner') ? myself : true;\n\t\t}\n\n\t\tif (action === RoomMemberActions.REMOVE_USER) {\n\t\t\treturn !displayingUserRoomRoles.includes('owner');\n\t\t}\n\t\tconst allowedForOwnersOverDefaultUsers = allowedUserActionsInFederatedRooms.includes(action);\n\n\t\treturn allowedForOwnersOverDefaultUsers;\n\t}\n\n\tif (loggedInUserRoomRoles.includes('moderator')) {\n\t\tif (displayingUserRoomRoles.includes('owner')) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (displayingUserRoomRoles.includes('moderator')) {\n\t\t\tif (action === RoomMemberActions.SET_AS_MODERATOR) {\n\t\t\t\treturn myself;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tconst allowedForModeratorsOverDefaultUsers = action === RoomMemberActions.SET_AS_MODERATOR || action === RoomMemberActions.REMOVE_USER;\n\n\t\treturn allowedForModeratorsOverDefaultUsers;\n\t}\n\n\treturn false;\n};\n\nexport const isEditableByTheUser = (user?: IUser, room?: IRoom, subscription?: ISubscription): boolean => {\n\tif (!user || !room || !subscription) {\n\t\treturn false;\n\t}\n\treturn isRoomFederated(room) && Boolean(subscription.roles?.includes('owner') || subscription.roles?.includes('moderator'));\n};\n\nexport const canCreateInviteLinks = (user?: IUser, room?: IRoom, subscription?: ISubscription): boolean => {\n\tif (!user || !room || !subscription) {\n\t\treturn false;\n\t}\n\treturn (\n\t\tisRoomFederated(room) &&\n\t\tisPublicRoom(room) &&\n\t\tBoolean(subscription.roles?.includes('owner') || subscription.roles?.includes('moderator'))\n\t);\n};\n\nexport const isRoomSettingAllowed = (room: Partial<IRoom>, setting: ValueOf<typeof RoomSettingsEnum>): boolean => {\n\tif (!isRoomFederated(room)) {\n\t\treturn false;\n\t}\n\n\tif (isDirectMessageRoom(room)) {\n\t\treturn false;\n\t}\n\treturn allowedRoomSettingsChangesInFederatedRooms.includes(setting);\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"1880b5e2c6966ecc7e6bcc27404b6a9a02e3dbce"}
