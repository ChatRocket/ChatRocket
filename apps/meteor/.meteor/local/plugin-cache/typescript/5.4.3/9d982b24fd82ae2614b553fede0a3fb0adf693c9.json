{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/providers/RoomProvider.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/room/providers/RoomProvider.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/providers/RoomProvider.tsx","inputSourceMap":{"version":3,"file":"client/views/room/providers/RoomProvider.tsx","sourceRoot":"","sources":["client/views/room/providers/RoomProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport { useRouter } from '@rocket.chat/ui-contexts';\nimport type { ReactNode, ContextType, ReactElement } from 'react';\nimport React, { useMemo, memo, useEffect, useCallback } from 'react';\n\nimport ComposerPopupProvider from './ComposerPopupProvider';\nimport RoomToolboxProvider from './RoomToolboxProvider';\nimport UserCardProvider from './UserCardProvider';\nimport { useRedirectOnSettingsChanged } from './hooks/useRedirectOnSettingsChanged';\nimport { useRoomQuery } from './hooks/useRoomQuery';\nimport { useUsersNameChanged } from './hooks/useUsersNameChanged';\nimport { ChatSubscription } from '../../../../app/models/client';\nimport { UserAction } from '../../../../app/ui/client/lib/UserAction';\nimport { RoomHistoryManager } from '../../../../app/ui-utils/client';\nimport { useReactiveQuery } from '../../../hooks/useReactiveQuery';\nimport { useReactiveValue } from '../../../hooks/useReactiveValue';\nimport { useRoomInfoEndpoint } from '../../../hooks/useRoomInfoEndpoint';\nimport { useSidePanelNavigation } from '../../../hooks/useSidePanelNavigation';\nimport { RoomManager } from '../../../lib/RoomManager';\nimport { roomCoordinator } from '../../../lib/rooms/roomCoordinator';\nimport ImageGalleryProvider from '../../../providers/ImageGalleryProvider';\nimport RoomNotFound from '../RoomNotFound';\nimport RoomSkeleton from '../RoomSkeleton';\nimport { useRoomRolesManagement } from '../body/hooks/useRoomRolesManagement';\nimport type { IRoomWithFederationOriginalName } from '../contexts/RoomContext';\nimport { RoomContext } from '../contexts/RoomContext';\n\ntype RoomProviderProps = {\n\tchildren: ReactNode;\n\trid: IRoom['_id'];\n};\n\nconst RoomProvider = ({ rid, children }: RoomProviderProps): ReactElement => {\n\tuseRoomRolesManagement(rid);\n\n\tconst resultFromServer = useRoomInfoEndpoint(rid);\n\n\tconst resultFromLocal = useRoomQuery(rid);\n\n\t// TODO: the following effect is a workaround while we don't have a general and definitive solution for it\n\tconst router = useRouter();\n\tuseEffect(() => {\n\t\tif (resultFromLocal.isSuccess && !resultFromLocal.data) {\n\t\t\trouter.navigate('/home');\n\t\t}\n\t}, [resultFromLocal.data, resultFromLocal.isSuccess, resultFromServer, router]);\n\n\tconst subscriptionQuery = useReactiveQuery(['subscriptions', { rid }], () => ChatSubscription.findOne({ rid }) ?? null);\n\n\tuseRedirectOnSettingsChanged(subscriptionQuery.data);\n\n\tuseUsersNameChanged();\n\n\tconst pseudoRoom: IRoomWithFederationOriginalName | null = useMemo(() => {\n\t\tconst room = resultFromLocal.data;\n\t\tif (!room) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\t...subscriptionQuery.data,\n\t\t\t...room,\n\t\t\tname: roomCoordinator.getRoomName(room.t, room),\n\t\t\tfederationOriginalName: room.name,\n\t\t};\n\t}, [resultFromLocal.data, subscriptionQuery.data]);\n\n\tconst { hasMorePreviousMessages, hasMoreNextMessages, isLoadingMoreMessages } = useReactiveValue(\n\t\tuseCallback(() => {\n\t\t\tconst { hasMore, hasMoreNext, isLoading } = RoomHistoryManager.getRoom(rid);\n\n\t\t\treturn {\n\t\t\t\thasMorePreviousMessages: hasMore.get(),\n\t\t\t\thasMoreNextMessages: hasMoreNext.get(),\n\t\t\t\tisLoadingMoreMessages: isLoading.get(),\n\t\t\t};\n\t\t}, [rid]),\n\t);\n\n\tconst context = useMemo((): ContextType<typeof RoomContext> => {\n\t\tif (!pseudoRoom) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\trid,\n\t\t\troom: pseudoRoom,\n\t\t\tsubscription: subscriptionQuery.data ?? undefined,\n\t\t\thasMorePreviousMessages,\n\t\t\thasMoreNextMessages,\n\t\t\tisLoadingMoreMessages,\n\t\t};\n\t}, [hasMoreNextMessages, hasMorePreviousMessages, isLoadingMoreMessages, pseudoRoom, rid, subscriptionQuery.data]);\n\n\tconst isSidepanelFeatureEnabled = useSidePanelNavigation();\n\n\tuseEffect(() => {\n\t\tif (isSidepanelFeatureEnabled) {\n\t\t\tif (resultFromServer.isSuccess) {\n\t\t\t\tif (resultFromServer.data.room?.teamMain) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tresultFromServer.data.room.sidepanel?.items.includes('channels') ||\n\t\t\t\t\t\tresultFromServer.data.room?.sidepanel?.items.includes('discussions')\n\t\t\t\t\t) {\n\t\t\t\t\t\tRoomManager.openSecondLevel(rid, rid);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tRoomManager.open(rid);\n\t\t\t\t\t}\n\t\t\t\t\treturn (): void => {\n\t\t\t\t\t\tRoomManager.back(rid);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tswitch (true) {\n\t\t\t\t\tcase resultFromServer.data.room?.prid &&\n\t\t\t\t\t\tresultFromServer.data.parent &&\n\t\t\t\t\t\tresultFromServer.data.parent.sidepanel?.items.includes('discussions'):\n\t\t\t\t\t\tRoomManager.openSecondLevel(resultFromServer.data.parent._id, rid);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase resultFromServer.data.team?.roomId &&\n\t\t\t\t\t\t!resultFromServer.data.room?.teamMain &&\n\t\t\t\t\t\tresultFromServer.data.parent?.sidepanel?.items.includes('channels'):\n\t\t\t\t\t\tRoomManager.openSecondLevel(resultFromServer.data.team.roomId, rid);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tresultFromServer.data.parent?.sidepanel?.items.includes('channels') ||\n\t\t\t\t\t\t\tresultFromServer.data.parent?.sidepanel?.items.includes('discussions')\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tRoomManager.openSecondLevel(rid, rid);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tRoomManager.open(rid);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn (): void => {\n\t\t\t\tRoomManager.back(rid);\n\t\t\t};\n\t\t}\n\n\t\tRoomManager.open(rid);\n\t\treturn (): void => {\n\t\t\tRoomManager.back(rid);\n\t\t};\n\t}, [\n\t\tisSidepanelFeatureEnabled,\n\t\trid,\n\t\tresultFromServer.data?.room?.prid,\n\t\tresultFromServer.data?.room?.teamId,\n\t\tresultFromServer.data?.room?.teamMain,\n\t\tresultFromServer.isSuccess,\n\t\tresultFromServer.data?.parent,\n\t\tresultFromServer.data?.team?.roomId,\n\t\tresultFromServer.data,\n\t]);\n\n\tconst subscribed = !!subscriptionQuery.data;\n\n\tuseEffect(() => {\n\t\tif (!subscribed) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn UserAction.addStream(rid);\n\t}, [rid, subscribed]);\n\n\tif (!pseudoRoom) {\n\t\treturn resultFromLocal.isSuccess && !resultFromLocal.data ? <RoomNotFound /> : <RoomSkeleton />;\n\t}\n\n\treturn (\n\t\t<RoomContext.Provider value={context}>\n\t\t\t<RoomToolboxProvider>\n\t\t\t\t<ImageGalleryProvider>\n\t\t\t\t\t<UserCardProvider>\n\t\t\t\t\t\t<ComposerPopupProvider room={pseudoRoom}>{children}</ComposerPopupProvider>\n\t\t\t\t\t</UserCardProvider>\n\t\t\t\t</ImageGalleryProvider>\n\t\t\t</RoomToolboxProvider>\n\t\t</RoomContext.Provider>\n\t);\n};\n\nexport default memo(RoomProvider);\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/providers/RoomProvider.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/room/providers/RoomProvider.tsx","inputSourceMap":{"version":3,"file":"client/views/room/providers/RoomProvider.tsx","sourceRoot":"","sources":["client/views/room/providers/RoomProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport { useRouter } from '@rocket.chat/ui-contexts';\nimport type { ReactNode, ContextType, ReactElement } from 'react';\nimport React, { useMemo, memo, useEffect, useCallback } from 'react';\n\nimport ComposerPopupProvider from './ComposerPopupProvider';\nimport RoomToolboxProvider from './RoomToolboxProvider';\nimport UserCardProvider from './UserCardProvider';\nimport { useRedirectOnSettingsChanged } from './hooks/useRedirectOnSettingsChanged';\nimport { useRoomQuery } from './hooks/useRoomQuery';\nimport { useUsersNameChanged } from './hooks/useUsersNameChanged';\nimport { ChatSubscription } from '../../../../app/models/client';\nimport { UserAction } from '../../../../app/ui/client/lib/UserAction';\nimport { RoomHistoryManager } from '../../../../app/ui-utils/client';\nimport { useReactiveQuery } from '../../../hooks/useReactiveQuery';\nimport { useReactiveValue } from '../../../hooks/useReactiveValue';\nimport { useRoomInfoEndpoint } from '../../../hooks/useRoomInfoEndpoint';\nimport { useSidePanelNavigation } from '../../../hooks/useSidePanelNavigation';\nimport { RoomManager } from '../../../lib/RoomManager';\nimport { roomCoordinator } from '../../../lib/rooms/roomCoordinator';\nimport ImageGalleryProvider from '../../../providers/ImageGalleryProvider';\nimport RoomNotFound from '../RoomNotFound';\nimport RoomSkeleton from '../RoomSkeleton';\nimport { useRoomRolesManagement } from '../body/hooks/useRoomRolesManagement';\nimport type { IRoomWithFederationOriginalName } from '../contexts/RoomContext';\nimport { RoomContext } from '../contexts/RoomContext';\n\ntype RoomProviderProps = {\n\tchildren: ReactNode;\n\trid: IRoom['_id'];\n};\n\nconst RoomProvider = ({ rid, children }: RoomProviderProps): ReactElement => {\n\tuseRoomRolesManagement(rid);\n\n\tconst resultFromServer = useRoomInfoEndpoint(rid);\n\n\tconst resultFromLocal = useRoomQuery(rid);\n\n\t// TODO: the following effect is a workaround while we don't have a general and definitive solution for it\n\tconst router = useRouter();\n\tuseEffect(() => {\n\t\tif (resultFromLocal.isSuccess && !resultFromLocal.data) {\n\t\t\trouter.navigate('/home');\n\t\t}\n\t}, [resultFromLocal.data, resultFromLocal.isSuccess, resultFromServer, router]);\n\n\tconst subscriptionQuery = useReactiveQuery(['subscriptions', { rid }], () => ChatSubscription.findOne({ rid }) ?? null);\n\n\tuseRedirectOnSettingsChanged(subscriptionQuery.data);\n\n\tuseUsersNameChanged();\n\n\tconst pseudoRoom: IRoomWithFederationOriginalName | null = useMemo(() => {\n\t\tconst room = resultFromLocal.data;\n\t\tif (!room) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\t...subscriptionQuery.data,\n\t\t\t...room,\n\t\t\tname: roomCoordinator.getRoomName(room.t, room),\n\t\t\tfederationOriginalName: room.name,\n\t\t};\n\t}, [resultFromLocal.data, subscriptionQuery.data]);\n\n\tconst { hasMorePreviousMessages, hasMoreNextMessages, isLoadingMoreMessages } = useReactiveValue(\n\t\tuseCallback(() => {\n\t\t\tconst { hasMore, hasMoreNext, isLoading } = RoomHistoryManager.getRoom(rid);\n\n\t\t\treturn {\n\t\t\t\thasMorePreviousMessages: hasMore.get(),\n\t\t\t\thasMoreNextMessages: hasMoreNext.get(),\n\t\t\t\tisLoadingMoreMessages: isLoading.get(),\n\t\t\t};\n\t\t}, [rid]),\n\t);\n\n\tconst context = useMemo((): ContextType<typeof RoomContext> => {\n\t\tif (!pseudoRoom) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\trid,\n\t\t\troom: pseudoRoom,\n\t\t\tsubscription: subscriptionQuery.data ?? undefined,\n\t\t\thasMorePreviousMessages,\n\t\t\thasMoreNextMessages,\n\t\t\tisLoadingMoreMessages,\n\t\t};\n\t}, [hasMoreNextMessages, hasMorePreviousMessages, isLoadingMoreMessages, pseudoRoom, rid, subscriptionQuery.data]);\n\n\tconst isSidepanelFeatureEnabled = useSidePanelNavigation();\n\n\tuseEffect(() => {\n\t\tif (isSidepanelFeatureEnabled) {\n\t\t\tif (resultFromServer.isSuccess) {\n\t\t\t\tif (resultFromServer.data.room?.teamMain) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tresultFromServer.data.room.sidepanel?.items.includes('channels') ||\n\t\t\t\t\t\tresultFromServer.data.room?.sidepanel?.items.includes('discussions')\n\t\t\t\t\t) {\n\t\t\t\t\t\tRoomManager.openSecondLevel(rid, rid);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tRoomManager.open(rid);\n\t\t\t\t\t}\n\t\t\t\t\treturn (): void => {\n\t\t\t\t\t\tRoomManager.back(rid);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tswitch (true) {\n\t\t\t\t\tcase resultFromServer.data.room?.prid &&\n\t\t\t\t\t\tresultFromServer.data.parent &&\n\t\t\t\t\t\tresultFromServer.data.parent.sidepanel?.items.includes('discussions'):\n\t\t\t\t\t\tRoomManager.openSecondLevel(resultFromServer.data.parent._id, rid);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase resultFromServer.data.team?.roomId &&\n\t\t\t\t\t\t!resultFromServer.data.room?.teamMain &&\n\t\t\t\t\t\tresultFromServer.data.parent?.sidepanel?.items.includes('channels'):\n\t\t\t\t\t\tRoomManager.openSecondLevel(resultFromServer.data.team.roomId, rid);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tresultFromServer.data.parent?.sidepanel?.items.includes('channels') ||\n\t\t\t\t\t\t\tresultFromServer.data.parent?.sidepanel?.items.includes('discussions')\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tRoomManager.openSecondLevel(rid, rid);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tRoomManager.open(rid);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn (): void => {\n\t\t\t\tRoomManager.back(rid);\n\t\t\t};\n\t\t}\n\n\t\tRoomManager.open(rid);\n\t\treturn (): void => {\n\t\t\tRoomManager.back(rid);\n\t\t};\n\t}, [\n\t\tisSidepanelFeatureEnabled,\n\t\trid,\n\t\tresultFromServer.data?.room?.prid,\n\t\tresultFromServer.data?.room?.teamId,\n\t\tresultFromServer.data?.room?.teamMain,\n\t\tresultFromServer.isSuccess,\n\t\tresultFromServer.data?.parent,\n\t\tresultFromServer.data?.team?.roomId,\n\t\tresultFromServer.data,\n\t]);\n\n\tconst subscribed = !!subscriptionQuery.data;\n\n\tuseEffect(() => {\n\t\tif (!subscribed) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn UserAction.addStream(rid);\n\t}, [rid, subscribed]);\n\n\tif (!pseudoRoom) {\n\t\treturn resultFromLocal.isSuccess && !resultFromLocal.data ? <RoomNotFound /> : <RoomSkeleton />;\n\t}\n\n\treturn (\n\t\t<RoomContext.Provider value={context}>\n\t\t\t<RoomToolboxProvider>\n\t\t\t\t<ImageGalleryProvider>\n\t\t\t\t\t<UserCardProvider>\n\t\t\t\t\t\t<ComposerPopupProvider room={pseudoRoom}>{children}</ComposerPopupProvider>\n\t\t\t\t\t</UserCardProvider>\n\t\t\t\t</ImageGalleryProvider>\n\t\t\t</RoomToolboxProvider>\n\t\t</RoomContext.Provider>\n\t);\n};\n\nexport default memo(RoomProvider);\n"]}}},"code":"let _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n}, 0);\nlet useRouter;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useRouter(v) {\n    useRouter = v;\n  }\n}, 0);\nlet React, useMemo, memo, useEffect, useCallback;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n  useMemo(v) {\n    useMemo = v;\n  },\n  memo(v) {\n    memo = v;\n  },\n  useEffect(v) {\n    useEffect = v;\n  },\n  useCallback(v) {\n    useCallback = v;\n  }\n}, 1);\nlet ComposerPopupProvider;\nmodule.link(\"./ComposerPopupProvider\", {\n  default(v) {\n    ComposerPopupProvider = v;\n  }\n}, 2);\nlet RoomToolboxProvider;\nmodule.link(\"./RoomToolboxProvider\", {\n  default(v) {\n    RoomToolboxProvider = v;\n  }\n}, 3);\nlet UserCardProvider;\nmodule.link(\"./UserCardProvider\", {\n  default(v) {\n    UserCardProvider = v;\n  }\n}, 4);\nlet useRedirectOnSettingsChanged;\nmodule.link(\"./hooks/useRedirectOnSettingsChanged\", {\n  useRedirectOnSettingsChanged(v) {\n    useRedirectOnSettingsChanged = v;\n  }\n}, 5);\nlet useRoomQuery;\nmodule.link(\"./hooks/useRoomQuery\", {\n  useRoomQuery(v) {\n    useRoomQuery = v;\n  }\n}, 6);\nlet useUsersNameChanged;\nmodule.link(\"./hooks/useUsersNameChanged\", {\n  useUsersNameChanged(v) {\n    useUsersNameChanged = v;\n  }\n}, 7);\nlet ChatSubscription;\nmodule.link(\"../../../../app/models/client\", {\n  ChatSubscription(v) {\n    ChatSubscription = v;\n  }\n}, 8);\nlet UserAction;\nmodule.link(\"../../../../app/ui/client/lib/UserAction\", {\n  UserAction(v) {\n    UserAction = v;\n  }\n}, 9);\nlet RoomHistoryManager;\nmodule.link(\"../../../../app/ui-utils/client\", {\n  RoomHistoryManager(v) {\n    RoomHistoryManager = v;\n  }\n}, 10);\nlet useReactiveQuery;\nmodule.link(\"../../../hooks/useReactiveQuery\", {\n  useReactiveQuery(v) {\n    useReactiveQuery = v;\n  }\n}, 11);\nlet useReactiveValue;\nmodule.link(\"../../../hooks/useReactiveValue\", {\n  useReactiveValue(v) {\n    useReactiveValue = v;\n  }\n}, 12);\nlet useRoomInfoEndpoint;\nmodule.link(\"../../../hooks/useRoomInfoEndpoint\", {\n  useRoomInfoEndpoint(v) {\n    useRoomInfoEndpoint = v;\n  }\n}, 13);\nlet useSidePanelNavigation;\nmodule.link(\"../../../hooks/useSidePanelNavigation\", {\n  useSidePanelNavigation(v) {\n    useSidePanelNavigation = v;\n  }\n}, 14);\nlet RoomManager;\nmodule.link(\"../../../lib/RoomManager\", {\n  RoomManager(v) {\n    RoomManager = v;\n  }\n}, 15);\nlet roomCoordinator;\nmodule.link(\"../../../lib/rooms/roomCoordinator\", {\n  roomCoordinator(v) {\n    roomCoordinator = v;\n  }\n}, 16);\nlet ImageGalleryProvider;\nmodule.link(\"../../../providers/ImageGalleryProvider\", {\n  default(v) {\n    ImageGalleryProvider = v;\n  }\n}, 17);\nlet RoomNotFound;\nmodule.link(\"../RoomNotFound\", {\n  default(v) {\n    RoomNotFound = v;\n  }\n}, 18);\nlet RoomSkeleton;\nmodule.link(\"../RoomSkeleton\", {\n  default(v) {\n    RoomSkeleton = v;\n  }\n}, 19);\nlet useRoomRolesManagement;\nmodule.link(\"../body/hooks/useRoomRolesManagement\", {\n  useRoomRolesManagement(v) {\n    useRoomRolesManagement = v;\n  }\n}, 20);\nlet RoomContext;\nmodule.link(\"../contexts/RoomContext\", {\n  RoomContext(v) {\n    RoomContext = v;\n  }\n}, 21);\nconst RoomProvider = _ref => {\n  var _resultFromServer$dat15, _resultFromServer$dat16, _resultFromServer$dat17, _resultFromServer$dat18, _resultFromServer$dat19, _resultFromServer$dat20, _resultFromServer$dat21, _resultFromServer$dat22, _resultFromServer$dat23;\n  let {\n    rid,\n    children\n  } = _ref;\n  useRoomRolesManagement(rid);\n  const resultFromServer = useRoomInfoEndpoint(rid);\n  const resultFromLocal = useRoomQuery(rid);\n  // TODO: the following effect is a workaround while we don't have a general and definitive solution for it\n  const router = useRouter();\n  useEffect(() => {\n    if (resultFromLocal.isSuccess && !resultFromLocal.data) {\n      router.navigate('/home');\n    }\n  }, [resultFromLocal.data, resultFromLocal.isSuccess, resultFromServer, router]);\n  const subscriptionQuery = useReactiveQuery(['subscriptions', {\n    rid\n  }], () => {\n    var _ChatSubscription$fin;\n    return (_ChatSubscription$fin = ChatSubscription.findOne({\n      rid\n    })) !== null && _ChatSubscription$fin !== void 0 ? _ChatSubscription$fin : null;\n  });\n  useRedirectOnSettingsChanged(subscriptionQuery.data);\n  useUsersNameChanged();\n  const pseudoRoom = useMemo(() => {\n    const room = resultFromLocal.data;\n    if (!room) {\n      return null;\n    }\n    return _objectSpread(_objectSpread(_objectSpread({}, subscriptionQuery.data), room), {}, {\n      name: roomCoordinator.getRoomName(room.t, room),\n      federationOriginalName: room.name\n    });\n  }, [resultFromLocal.data, subscriptionQuery.data]);\n  const {\n    hasMorePreviousMessages,\n    hasMoreNextMessages,\n    isLoadingMoreMessages\n  } = useReactiveValue(useCallback(() => {\n    const {\n      hasMore,\n      hasMoreNext,\n      isLoading\n    } = RoomHistoryManager.getRoom(rid);\n    return {\n      hasMorePreviousMessages: hasMore.get(),\n      hasMoreNextMessages: hasMoreNext.get(),\n      isLoadingMoreMessages: isLoading.get()\n    };\n  }, [rid]));\n  const context = useMemo(() => {\n    var _subscriptionQuery$da;\n    if (!pseudoRoom) {\n      return null;\n    }\n    return {\n      rid,\n      room: pseudoRoom,\n      subscription: (_subscriptionQuery$da = subscriptionQuery.data) !== null && _subscriptionQuery$da !== void 0 ? _subscriptionQuery$da : undefined,\n      hasMorePreviousMessages,\n      hasMoreNextMessages,\n      isLoadingMoreMessages\n    };\n  }, [hasMoreNextMessages, hasMorePreviousMessages, isLoadingMoreMessages, pseudoRoom, rid, subscriptionQuery.data]);\n  const isSidepanelFeatureEnabled = useSidePanelNavigation();\n  useEffect(() => {\n    var _resultFromServer$dat5, _resultFromServer$dat6, _resultFromServer$dat7, _resultFromServer$dat8, _resultFromServer$dat9, _resultFromServer$dat10, _resultFromServer$dat11, _resultFromServer$dat12, _resultFromServer$dat13, _resultFromServer$dat14;\n    if (isSidepanelFeatureEnabled) {\n      if (resultFromServer.isSuccess) {\n        var _resultFromServer$dat;\n        if ((_resultFromServer$dat = resultFromServer.data.room) !== null && _resultFromServer$dat !== void 0 && _resultFromServer$dat.teamMain) {\n          var _resultFromServer$dat2, _resultFromServer$dat3, _resultFromServer$dat4;\n          if ((_resultFromServer$dat2 = resultFromServer.data.room.sidepanel) !== null && _resultFromServer$dat2 !== void 0 && _resultFromServer$dat2.items.includes('channels') || (_resultFromServer$dat3 = resultFromServer.data.room) !== null && _resultFromServer$dat3 !== void 0 && (_resultFromServer$dat4 = _resultFromServer$dat3.sidepanel) !== null && _resultFromServer$dat4 !== void 0 && _resultFromServer$dat4.items.includes('discussions')) {\n            RoomManager.openSecondLevel(rid, rid);\n          } else {\n            RoomManager.open(rid);\n          }\n          return () => {\n            RoomManager.back(rid);\n          };\n        }\n        switch (true) {\n          case ((_resultFromServer$dat5 = resultFromServer.data.room) === null || _resultFromServer$dat5 === void 0 ? void 0 : _resultFromServer$dat5.prid) && resultFromServer.data.parent && ((_resultFromServer$dat6 = resultFromServer.data.parent.sidepanel) === null || _resultFromServer$dat6 === void 0 ? void 0 : _resultFromServer$dat6.items.includes('discussions')):\n            RoomManager.openSecondLevel(resultFromServer.data.parent._id, rid);\n            break;\n          case ((_resultFromServer$dat7 = resultFromServer.data.team) === null || _resultFromServer$dat7 === void 0 ? void 0 : _resultFromServer$dat7.roomId) && !((_resultFromServer$dat8 = resultFromServer.data.room) !== null && _resultFromServer$dat8 !== void 0 && _resultFromServer$dat8.teamMain) && ((_resultFromServer$dat9 = resultFromServer.data.parent) === null || _resultFromServer$dat9 === void 0 ? void 0 : (_resultFromServer$dat10 = _resultFromServer$dat9.sidepanel) === null || _resultFromServer$dat10 === void 0 ? void 0 : _resultFromServer$dat10.items.includes('channels')):\n            RoomManager.openSecondLevel(resultFromServer.data.team.roomId, rid);\n            break;\n          default:\n            if ((_resultFromServer$dat11 = resultFromServer.data.parent) !== null && _resultFromServer$dat11 !== void 0 && (_resultFromServer$dat12 = _resultFromServer$dat11.sidepanel) !== null && _resultFromServer$dat12 !== void 0 && _resultFromServer$dat12.items.includes('channels') || (_resultFromServer$dat13 = resultFromServer.data.parent) !== null && _resultFromServer$dat13 !== void 0 && (_resultFromServer$dat14 = _resultFromServer$dat13.sidepanel) !== null && _resultFromServer$dat14 !== void 0 && _resultFromServer$dat14.items.includes('discussions')) {\n              RoomManager.openSecondLevel(rid, rid);\n            } else {\n              RoomManager.open(rid);\n            }\n            break;\n        }\n      }\n      return () => {\n        RoomManager.back(rid);\n      };\n    }\n    RoomManager.open(rid);\n    return () => {\n      RoomManager.back(rid);\n    };\n  }, [isSidepanelFeatureEnabled, rid, (_resultFromServer$dat15 = resultFromServer.data) === null || _resultFromServer$dat15 === void 0 ? void 0 : (_resultFromServer$dat16 = _resultFromServer$dat15.room) === null || _resultFromServer$dat16 === void 0 ? void 0 : _resultFromServer$dat16.prid, (_resultFromServer$dat17 = resultFromServer.data) === null || _resultFromServer$dat17 === void 0 ? void 0 : (_resultFromServer$dat18 = _resultFromServer$dat17.room) === null || _resultFromServer$dat18 === void 0 ? void 0 : _resultFromServer$dat18.teamId, (_resultFromServer$dat19 = resultFromServer.data) === null || _resultFromServer$dat19 === void 0 ? void 0 : (_resultFromServer$dat20 = _resultFromServer$dat19.room) === null || _resultFromServer$dat20 === void 0 ? void 0 : _resultFromServer$dat20.teamMain, resultFromServer.isSuccess, (_resultFromServer$dat21 = resultFromServer.data) === null || _resultFromServer$dat21 === void 0 ? void 0 : _resultFromServer$dat21.parent, (_resultFromServer$dat22 = resultFromServer.data) === null || _resultFromServer$dat22 === void 0 ? void 0 : (_resultFromServer$dat23 = _resultFromServer$dat22.team) === null || _resultFromServer$dat23 === void 0 ? void 0 : _resultFromServer$dat23.roomId, resultFromServer.data]);\n  const subscribed = !!subscriptionQuery.data;\n  useEffect(() => {\n    if (!subscribed) {\n      return;\n    }\n    return UserAction.addStream(rid);\n  }, [rid, subscribed]);\n  if (!pseudoRoom) {\n    return resultFromLocal.isSuccess && !resultFromLocal.data ? /*#__PURE__*/React.createElement(RoomNotFound, null) : /*#__PURE__*/React.createElement(RoomSkeleton, null);\n  }\n  return /*#__PURE__*/React.createElement(RoomContext.Provider, {\n    value: context\n  }, /*#__PURE__*/React.createElement(RoomToolboxProvider, null, /*#__PURE__*/React.createElement(ImageGalleryProvider, null, /*#__PURE__*/React.createElement(UserCardProvider, null, /*#__PURE__*/React.createElement(ComposerPopupProvider, {\n    room: pseudoRoom\n  }, children)))));\n};\nmodule.exportDefault( /*#__PURE__*/memo(RoomProvider));","map":{"version":3,"names":["_objectSpread","module","link","default","v","useRouter","React","useMemo","memo","useEffect","useCallback","ComposerPopupProvider","RoomToolboxProvider","UserCardProvider","useRedirectOnSettingsChanged","useRoomQuery","useUsersNameChanged","ChatSubscription","UserAction","RoomHistoryManager","useReactiveQuery","useReactiveValue","useRoomInfoEndpoint","useSidePanelNavigation","RoomManager","roomCoordinator","ImageGalleryProvider","RoomNotFound","RoomSkeleton","useRoomRolesManagement","RoomContext","RoomProvider","_ref","_resultFromServer$dat15","_resultFromServer$dat16","_resultFromServer$dat17","_resultFromServer$dat18","_resultFromServer$dat19","_resultFromServer$dat20","_resultFromServer$dat21","_resultFromServer$dat22","_resultFromServer$dat23","rid","children","resultFromServer","resultFromLocal","router","isSuccess","data","navigate","subscriptionQuery","_ChatSubscription$fin","findOne","pseudoRoom","room","name","getRoomName","t","federationOriginalName","hasMorePreviousMessages","hasMoreNextMessages","isLoadingMoreMessages","hasMore","hasMoreNext","isLoading","getRoom","get","context","_subscriptionQuery$da","subscription","undefined","isSidepanelFeatureEnabled","_resultFromServer$dat5","_resultFromServer$dat6","_resultFromServer$dat7","_resultFromServer$dat8","_resultFromServer$dat9","_resultFromServer$dat10","_resultFromServer$dat11","_resultFromServer$dat12","_resultFromServer$dat13","_resultFromServer$dat14","_resultFromServer$dat","teamMain","_resultFromServer$dat2","_resultFromServer$dat3","_resultFromServer$dat4","sidepanel","items","includes","openSecondLevel","open","back","prid","parent","_id","team","roomId","teamId","subscribed","addStream","createElement","Provider","value","exportDefault"],"sources":["client/views/room/providers/RoomProvider.tsx"],"sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport { useRouter } from '@rocket.chat/ui-contexts';\nimport type { ReactNode, ContextType, ReactElement } from 'react';\nimport React, { useMemo, memo, useEffect, useCallback } from 'react';\n\nimport ComposerPopupProvider from './ComposerPopupProvider';\nimport RoomToolboxProvider from './RoomToolboxProvider';\nimport UserCardProvider from './UserCardProvider';\nimport { useRedirectOnSettingsChanged } from './hooks/useRedirectOnSettingsChanged';\nimport { useRoomQuery } from './hooks/useRoomQuery';\nimport { useUsersNameChanged } from './hooks/useUsersNameChanged';\nimport { ChatSubscription } from '../../../../app/models/client';\nimport { UserAction } from '../../../../app/ui/client/lib/UserAction';\nimport { RoomHistoryManager } from '../../../../app/ui-utils/client';\nimport { useReactiveQuery } from '../../../hooks/useReactiveQuery';\nimport { useReactiveValue } from '../../../hooks/useReactiveValue';\nimport { useRoomInfoEndpoint } from '../../../hooks/useRoomInfoEndpoint';\nimport { useSidePanelNavigation } from '../../../hooks/useSidePanelNavigation';\nimport { RoomManager } from '../../../lib/RoomManager';\nimport { roomCoordinator } from '../../../lib/rooms/roomCoordinator';\nimport ImageGalleryProvider from '../../../providers/ImageGalleryProvider';\nimport RoomNotFound from '../RoomNotFound';\nimport RoomSkeleton from '../RoomSkeleton';\nimport { useRoomRolesManagement } from '../body/hooks/useRoomRolesManagement';\nimport type { IRoomWithFederationOriginalName } from '../contexts/RoomContext';\nimport { RoomContext } from '../contexts/RoomContext';\n\ntype RoomProviderProps = {\n\tchildren: ReactNode;\n\trid: IRoom['_id'];\n};\n\nconst RoomProvider = ({ rid, children }: RoomProviderProps): ReactElement => {\n\tuseRoomRolesManagement(rid);\n\n\tconst resultFromServer = useRoomInfoEndpoint(rid);\n\n\tconst resultFromLocal = useRoomQuery(rid);\n\n\t// TODO: the following effect is a workaround while we don't have a general and definitive solution for it\n\tconst router = useRouter();\n\tuseEffect(() => {\n\t\tif (resultFromLocal.isSuccess && !resultFromLocal.data) {\n\t\t\trouter.navigate('/home');\n\t\t}\n\t}, [resultFromLocal.data, resultFromLocal.isSuccess, resultFromServer, router]);\n\n\tconst subscriptionQuery = useReactiveQuery(['subscriptions', { rid }], () => ChatSubscription.findOne({ rid }) ?? null);\n\n\tuseRedirectOnSettingsChanged(subscriptionQuery.data);\n\n\tuseUsersNameChanged();\n\n\tconst pseudoRoom: IRoomWithFederationOriginalName | null = useMemo(() => {\n\t\tconst room = resultFromLocal.data;\n\t\tif (!room) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\t...subscriptionQuery.data,\n\t\t\t...room,\n\t\t\tname: roomCoordinator.getRoomName(room.t, room),\n\t\t\tfederationOriginalName: room.name,\n\t\t};\n\t}, [resultFromLocal.data, subscriptionQuery.data]);\n\n\tconst { hasMorePreviousMessages, hasMoreNextMessages, isLoadingMoreMessages } = useReactiveValue(\n\t\tuseCallback(() => {\n\t\t\tconst { hasMore, hasMoreNext, isLoading } = RoomHistoryManager.getRoom(rid);\n\n\t\t\treturn {\n\t\t\t\thasMorePreviousMessages: hasMore.get(),\n\t\t\t\thasMoreNextMessages: hasMoreNext.get(),\n\t\t\t\tisLoadingMoreMessages: isLoading.get(),\n\t\t\t};\n\t\t}, [rid]),\n\t);\n\n\tconst context = useMemo((): ContextType<typeof RoomContext> => {\n\t\tif (!pseudoRoom) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\trid,\n\t\t\troom: pseudoRoom,\n\t\t\tsubscription: subscriptionQuery.data ?? undefined,\n\t\t\thasMorePreviousMessages,\n\t\t\thasMoreNextMessages,\n\t\t\tisLoadingMoreMessages,\n\t\t};\n\t}, [hasMoreNextMessages, hasMorePreviousMessages, isLoadingMoreMessages, pseudoRoom, rid, subscriptionQuery.data]);\n\n\tconst isSidepanelFeatureEnabled = useSidePanelNavigation();\n\n\tuseEffect(() => {\n\t\tif (isSidepanelFeatureEnabled) {\n\t\t\tif (resultFromServer.isSuccess) {\n\t\t\t\tif (resultFromServer.data.room?.teamMain) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tresultFromServer.data.room.sidepanel?.items.includes('channels') ||\n\t\t\t\t\t\tresultFromServer.data.room?.sidepanel?.items.includes('discussions')\n\t\t\t\t\t) {\n\t\t\t\t\t\tRoomManager.openSecondLevel(rid, rid);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tRoomManager.open(rid);\n\t\t\t\t\t}\n\t\t\t\t\treturn (): void => {\n\t\t\t\t\t\tRoomManager.back(rid);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tswitch (true) {\n\t\t\t\t\tcase resultFromServer.data.room?.prid &&\n\t\t\t\t\t\tresultFromServer.data.parent &&\n\t\t\t\t\t\tresultFromServer.data.parent.sidepanel?.items.includes('discussions'):\n\t\t\t\t\t\tRoomManager.openSecondLevel(resultFromServer.data.parent._id, rid);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase resultFromServer.data.team?.roomId &&\n\t\t\t\t\t\t!resultFromServer.data.room?.teamMain &&\n\t\t\t\t\t\tresultFromServer.data.parent?.sidepanel?.items.includes('channels'):\n\t\t\t\t\t\tRoomManager.openSecondLevel(resultFromServer.data.team.roomId, rid);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tresultFromServer.data.parent?.sidepanel?.items.includes('channels') ||\n\t\t\t\t\t\t\tresultFromServer.data.parent?.sidepanel?.items.includes('discussions')\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tRoomManager.openSecondLevel(rid, rid);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tRoomManager.open(rid);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn (): void => {\n\t\t\t\tRoomManager.back(rid);\n\t\t\t};\n\t\t}\n\n\t\tRoomManager.open(rid);\n\t\treturn (): void => {\n\t\t\tRoomManager.back(rid);\n\t\t};\n\t}, [\n\t\tisSidepanelFeatureEnabled,\n\t\trid,\n\t\tresultFromServer.data?.room?.prid,\n\t\tresultFromServer.data?.room?.teamId,\n\t\tresultFromServer.data?.room?.teamMain,\n\t\tresultFromServer.isSuccess,\n\t\tresultFromServer.data?.parent,\n\t\tresultFromServer.data?.team?.roomId,\n\t\tresultFromServer.data,\n\t]);\n\n\tconst subscribed = !!subscriptionQuery.data;\n\n\tuseEffect(() => {\n\t\tif (!subscribed) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn UserAction.addStream(rid);\n\t}, [rid, subscribed]);\n\n\tif (!pseudoRoom) {\n\t\treturn resultFromLocal.isSuccess && !resultFromLocal.data ? <RoomNotFound /> : <RoomSkeleton />;\n\t}\n\n\treturn (\n\t\t<RoomContext.Provider value={context}>\n\t\t\t<RoomToolboxProvider>\n\t\t\t\t<ImageGalleryProvider>\n\t\t\t\t\t<UserCardProvider>\n\t\t\t\t\t\t<ComposerPopupProvider room={pseudoRoom}>{children}</ComposerPopupProvider>\n\t\t\t\t\t</UserCardProvider>\n\t\t\t\t</ImageGalleryProvider>\n\t\t\t</RoomToolboxProvider>\n\t\t</RoomContext.Provider>\n\t);\n};\n\nexport default memo(RoomProvider);\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"9d982b24fd82ae2614b553fede0a3fb0adf693c9"}
