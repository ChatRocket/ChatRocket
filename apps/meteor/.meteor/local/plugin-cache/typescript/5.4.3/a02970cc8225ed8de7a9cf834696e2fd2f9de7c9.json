{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/uikit/hooks/useUiKitView.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/uikit/hooks/useUiKitView.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/uikit/hooks/useUiKitView.ts","inputSourceMap":{"version":3,"file":"client/uikit/hooks/useUiKitView.ts","sourceRoot":"","sources":["client/uikit/hooks/useUiKitView.ts"],"names":[],"mappings":"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","sourcesContent":["import { useSafely } from '@rocket.chat/fuselage-hooks';\nimport { extractInitialStateFromLayout } from '@rocket.chat/fuselage-ui-kit';\nimport type * as UiKit from '@rocket.chat/ui-kit';\nimport type { Dispatch } from 'react';\nimport { useEffect, useMemo, useReducer, useState } from 'react';\n\nimport { useUiKitActionManager } from './useUiKitActionManager';\n\nconst reduceValues = (\n\tvalues: { [actionId: string]: { value: unknown; blockId?: string } },\n\t{ actionId, payload }: { actionId: string; payload: { value: unknown; blockId?: string } },\n): { [actionId: string]: { value: unknown; blockId?: string } } => ({\n\t...values,\n\t[actionId]: payload,\n});\n\nconst getViewId = (view: UiKit.View): string => {\n\tif ('id' in view && typeof view.id === 'string') {\n\t\treturn view.id;\n\t}\n\n\tif ('viewId' in view && typeof view.viewId === 'string') {\n\t\treturn view.viewId;\n\t}\n\n\tthrow new Error('Invalid view');\n};\n\nconst getViewFromInteraction = (interaction: UiKit.ServerInteraction): UiKit.View | undefined => {\n\tif ('view' in interaction && typeof interaction.view === 'object') {\n\t\treturn interaction.view;\n\t}\n\n\tif (interaction.type === 'banner.open') {\n\t\treturn interaction;\n\t}\n\n\treturn undefined;\n};\n\ntype UseUiKitViewReturnType<TView extends UiKit.View> = {\n\tview: TView;\n\terrors?: { [field: string]: string }[];\n\tvalues: { [actionId: string]: { value: unknown; blockId?: string } };\n\tupdateValues: Dispatch<{ actionId: string; payload: { value: unknown; blockId?: string } }>;\n\tstate: {\n\t\t[blockId: string]: {\n\t\t\t[key: string]: unknown;\n\t\t};\n\t};\n};\n\nexport function useUiKitView<S extends UiKit.View>(initialView: S): UseUiKitViewReturnType<S> {\n\tconst [errors, setErrors] = useSafely(useState<{ [field: string]: string }[] | undefined>());\n\tconst [values, updateValues] = useSafely(useReducer(reduceValues, initialView.blocks, extractInitialStateFromLayout));\n\tconst [view, updateView] = useSafely(useState(initialView));\n\tconst actionManager = useUiKitActionManager();\n\n\tconst state = useMemo(() => {\n\t\treturn Object.entries(values).reduce<{ [blockId: string]: { [actionId: string]: unknown } }>((obj, [key, payload]) => {\n\t\t\tif (!payload?.blockId) {\n\t\t\t\treturn obj;\n\t\t\t}\n\n\t\t\tconst { blockId, value } = payload;\n\t\t\tobj[blockId] = obj[blockId] || {};\n\t\t\tobj[blockId][key] = value;\n\n\t\t\treturn obj;\n\t\t}, {});\n\t}, [values]);\n\n\tconst viewId = getViewId(view);\n\n\tuseEffect(() => {\n\t\tconst handleUpdate = (interaction: UiKit.ServerInteraction): void => {\n\t\t\tif (interaction.type === 'errors') {\n\t\t\t\tsetErrors(interaction.errors);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdateView((view) => ({ ...view, ...getViewFromInteraction(interaction) }));\n\t\t};\n\n\t\tactionManager.on(viewId, handleUpdate);\n\n\t\treturn (): void => {\n\t\t\tactionManager.off(viewId, handleUpdate);\n\t\t};\n\t}, [actionManager, setErrors, updateView, viewId]);\n\n\treturn { view, errors, values, updateValues, state };\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/uikit/hooks/useUiKitView.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/uikit/hooks/useUiKitView.ts","inputSourceMap":{"version":3,"file":"client/uikit/hooks/useUiKitView.ts","sourceRoot":"","sources":["client/uikit/hooks/useUiKitView.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,MAAM,6BAA6B,CAAC;AACxD,OAAO,EAAE,6BAA6B,EAAE,MAAM,8BAA8B,CAAC;AAG7E,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,UAAU,EAAE,QAAQ,EAAE,MAAM,OAAO,CAAC;AAEjE,OAAO,EAAE,qBAAqB,EAAE,MAAM,yBAAyB,CAAC;AAEhE,MAAM,YAAY,GAAG,CACpB,MAAoE,EACpE,EAAE,QAAQ,EAAE,OAAO,EAAuE,EAC3B,EAAE,CAAC,CAAC;IACnE,GAAG,MAAM;IACT,CAAC,QAAQ,CAAC,EAAE,OAAO;CACnB,CAAC,CAAC;AAEH,MAAM,SAAS,GAAG,CAAC,IAAgB,EAAU,EAAE;IAC9C,IAAI,IAAI,IAAI,IAAI,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,QAAQ,EAAE,CAAC;QACjD,OAAO,IAAI,CAAC,EAAE,CAAC;IAChB,CAAC;IAED,IAAI,QAAQ,IAAI,IAAI,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,QAAQ,EAAE,CAAC;QACzD,OAAO,IAAI,CAAC,MAAM,CAAC;IACpB,CAAC;IAED,MAAM,IAAI,KAAK,CAAC,cAAc,CAAC,CAAC;AACjC,CAAC,CAAC;AAEF,MAAM,sBAAsB,GAAG,CAAC,WAAoC,EAA0B,EAAE;IAC/F,IAAI,MAAM,IAAI,WAAW,IAAI,OAAO,WAAW,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;QACnE,OAAO,WAAW,CAAC,IAAI,CAAC;IACzB,CAAC;IAED,IAAI,WAAW,CAAC,IAAI,KAAK,aAAa,EAAE,CAAC;QACxC,OAAO,WAAW,CAAC;IACpB,CAAC;IAED,OAAO,SAAS,CAAC;AAClB,CAAC,CAAC;AAcF,MAAM,UAAU,YAAY,CAAuB,WAAc;IAChE,MAAM,CAAC,MAAM,EAAE,SAAS,CAAC,GAAG,SAAS,CAAC,QAAQ,EAA6C,CAAC,CAAC;IAC7F,MAAM,CAAC,MAAM,EAAE,YAAY,CAAC,GAAG,SAAS,CAAC,UAAU,CAAC,YAAY,EAAE,WAAW,CAAC,MAAM,EAAE,6BAA6B,CAAC,CAAC,CAAC;IACtH,MAAM,CAAC,IAAI,EAAE,UAAU,CAAC,GAAG,SAAS,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC,CAAC;IAC5D,MAAM,aAAa,GAAG,qBAAqB,EAAE,CAAC;IAE9C,MAAM,KAAK,GAAG,OAAO,CAAC,GAAG,EAAE;QAC1B,OAAO,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,MAAM,CAAyD,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,OAAO,CAAC,EAAE,EAAE;YACpH,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE,CAAC;gBACvB,OAAO,GAAG,CAAC;YACZ,CAAC;YAED,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,OAAO,CAAC;YACnC,GAAG,CAAC,OAAO,CAAC,GAAG,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;YAClC,GAAG,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;YAE1B,OAAO,GAAG,CAAC;QACZ,CAAC,EAAE,EAAE,CAAC,CAAC;IACR,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC;IAEb,MAAM,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC;IAE/B,SAAS,CAAC,GAAG,EAAE;QACd,MAAM,YAAY,GAAG,CAAC,WAAoC,EAAQ,EAAE;YACnE,IAAI,WAAW,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;gBACnC,SAAS,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;gBAC9B,OAAO;YACR,CAAC;YAED,UAAU,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,EAAE,GAAG,IAAI,EAAE,GAAG,sBAAsB,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC,CAAC;QAC7E,CAAC,CAAC;QAEF,aAAa,CAAC,EAAE,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC;QAEvC,OAAO,GAAS,EAAE;YACjB,aAAa,CAAC,GAAG,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC;QACzC,CAAC,CAAC;IACH,CAAC,EAAE,CAAC,aAAa,EAAE,SAAS,EAAE,UAAU,EAAE,MAAM,CAAC,CAAC,CAAC;IAEnD,OAAO,EAAE,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE,YAAY,EAAE,KAAK,EAAE,CAAC;AACtD,CAAC","sourcesContent":["import { useSafely } from '@rocket.chat/fuselage-hooks';\nimport { extractInitialStateFromLayout } from '@rocket.chat/fuselage-ui-kit';\nimport type * as UiKit from '@rocket.chat/ui-kit';\nimport type { Dispatch } from 'react';\nimport { useEffect, useMemo, useReducer, useState } from 'react';\n\nimport { useUiKitActionManager } from './useUiKitActionManager';\n\nconst reduceValues = (\n\tvalues: { [actionId: string]: { value: unknown; blockId?: string } },\n\t{ actionId, payload }: { actionId: string; payload: { value: unknown; blockId?: string } },\n): { [actionId: string]: { value: unknown; blockId?: string } } => ({\n\t...values,\n\t[actionId]: payload,\n});\n\nconst getViewId = (view: UiKit.View): string => {\n\tif ('id' in view && typeof view.id === 'string') {\n\t\treturn view.id;\n\t}\n\n\tif ('viewId' in view && typeof view.viewId === 'string') {\n\t\treturn view.viewId;\n\t}\n\n\tthrow new Error('Invalid view');\n};\n\nconst getViewFromInteraction = (interaction: UiKit.ServerInteraction): UiKit.View | undefined => {\n\tif ('view' in interaction && typeof interaction.view === 'object') {\n\t\treturn interaction.view;\n\t}\n\n\tif (interaction.type === 'banner.open') {\n\t\treturn interaction;\n\t}\n\n\treturn undefined;\n};\n\ntype UseUiKitViewReturnType<TView extends UiKit.View> = {\n\tview: TView;\n\terrors?: { [field: string]: string }[];\n\tvalues: { [actionId: string]: { value: unknown; blockId?: string } };\n\tupdateValues: Dispatch<{ actionId: string; payload: { value: unknown; blockId?: string } }>;\n\tstate: {\n\t\t[blockId: string]: {\n\t\t\t[key: string]: unknown;\n\t\t};\n\t};\n};\n\nexport function useUiKitView<S extends UiKit.View>(initialView: S): UseUiKitViewReturnType<S> {\n\tconst [errors, setErrors] = useSafely(useState<{ [field: string]: string }[] | undefined>());\n\tconst [values, updateValues] = useSafely(useReducer(reduceValues, initialView.blocks, extractInitialStateFromLayout));\n\tconst [view, updateView] = useSafely(useState(initialView));\n\tconst actionManager = useUiKitActionManager();\n\n\tconst state = useMemo(() => {\n\t\treturn Object.entries(values).reduce<{ [blockId: string]: { [actionId: string]: unknown } }>((obj, [key, payload]) => {\n\t\t\tif (!payload?.blockId) {\n\t\t\t\treturn obj;\n\t\t\t}\n\n\t\t\tconst { blockId, value } = payload;\n\t\t\tobj[blockId] = obj[blockId] || {};\n\t\t\tobj[blockId][key] = value;\n\n\t\t\treturn obj;\n\t\t}, {});\n\t}, [values]);\n\n\tconst viewId = getViewId(view);\n\n\tuseEffect(() => {\n\t\tconst handleUpdate = (interaction: UiKit.ServerInteraction): void => {\n\t\t\tif (interaction.type === 'errors') {\n\t\t\t\tsetErrors(interaction.errors);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdateView((view) => ({ ...view, ...getViewFromInteraction(interaction) }));\n\t\t};\n\n\t\tactionManager.on(viewId, handleUpdate);\n\n\t\treturn (): void => {\n\t\t\tactionManager.off(viewId, handleUpdate);\n\t\t};\n\t}, [actionManager, setErrors, updateView, viewId]);\n\n\treturn { view, errors, values, updateValues, state };\n}\n"]}}},"code":"let _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n}, 0);\nmodule.export({\n  useUiKitView: () => useUiKitView\n});\nlet useSafely;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useSafely(v) {\n    useSafely = v;\n  }\n}, 0);\nlet extractInitialStateFromLayout;\nmodule.link(\"@rocket.chat/fuselage-ui-kit\", {\n  extractInitialStateFromLayout(v) {\n    extractInitialStateFromLayout = v;\n  }\n}, 1);\nlet useEffect, useMemo, useReducer, useState;\nmodule.link(\"react\", {\n  useEffect(v) {\n    useEffect = v;\n  },\n  useMemo(v) {\n    useMemo = v;\n  },\n  useReducer(v) {\n    useReducer = v;\n  },\n  useState(v) {\n    useState = v;\n  }\n}, 2);\nlet useUiKitActionManager;\nmodule.link(\"./useUiKitActionManager\", {\n  useUiKitActionManager(v) {\n    useUiKitActionManager = v;\n  }\n}, 3);\nconst reduceValues = (values, _ref) => {\n  let {\n    actionId,\n    payload\n  } = _ref;\n  return _objectSpread(_objectSpread({}, values), {}, {\n    [actionId]: payload\n  });\n};\nconst getViewId = view => {\n  if ('id' in view && typeof view.id === 'string') {\n    return view.id;\n  }\n  if ('viewId' in view && typeof view.viewId === 'string') {\n    return view.viewId;\n  }\n  throw new Error('Invalid view');\n};\nconst getViewFromInteraction = interaction => {\n  if ('view' in interaction && typeof interaction.view === 'object') {\n    return interaction.view;\n  }\n  if (interaction.type === 'banner.open') {\n    return interaction;\n  }\n  return undefined;\n};\nfunction useUiKitView(initialView) {\n  const [errors, setErrors] = useSafely(useState());\n  const [values, updateValues] = useSafely(useReducer(reduceValues, initialView.blocks, extractInitialStateFromLayout));\n  const [view, updateView] = useSafely(useState(initialView));\n  const actionManager = useUiKitActionManager();\n  const state = useMemo(() => {\n    return Object.entries(values).reduce((obj, _ref2) => {\n      let [key, payload] = _ref2;\n      if (!(payload !== null && payload !== void 0 && payload.blockId)) {\n        return obj;\n      }\n      const {\n        blockId,\n        value\n      } = payload;\n      obj[blockId] = obj[blockId] || {};\n      obj[blockId][key] = value;\n      return obj;\n    }, {});\n  }, [values]);\n  const viewId = getViewId(view);\n  useEffect(() => {\n    const handleUpdate = interaction => {\n      if (interaction.type === 'errors') {\n        setErrors(interaction.errors);\n        return;\n      }\n      updateView(view => _objectSpread(_objectSpread({}, view), getViewFromInteraction(interaction)));\n    };\n    actionManager.on(viewId, handleUpdate);\n    return () => {\n      actionManager.off(viewId, handleUpdate);\n    };\n  }, [actionManager, setErrors, updateView, viewId]);\n  return {\n    view,\n    errors,\n    values,\n    updateValues,\n    state\n  };\n}","map":{"version":3,"names":["_objectSpread","module","link","default","v","export","useUiKitView","useSafely","extractInitialStateFromLayout","useEffect","useMemo","useReducer","useState","useUiKitActionManager","reduceValues","values","_ref","actionId","payload","getViewId","view","id","viewId","Error","getViewFromInteraction","interaction","type","undefined","initialView","errors","setErrors","updateValues","blocks","updateView","actionManager","state","Object","entries","reduce","obj","_ref2","key","blockId","value","handleUpdate","on","off"],"sources":["client/uikit/hooks/useUiKitView.ts"],"sourcesContent":["import { useSafely } from '@rocket.chat/fuselage-hooks';\nimport { extractInitialStateFromLayout } from '@rocket.chat/fuselage-ui-kit';\nimport type * as UiKit from '@rocket.chat/ui-kit';\nimport type { Dispatch } from 'react';\nimport { useEffect, useMemo, useReducer, useState } from 'react';\n\nimport { useUiKitActionManager } from './useUiKitActionManager';\n\nconst reduceValues = (\n\tvalues: { [actionId: string]: { value: unknown; blockId?: string } },\n\t{ actionId, payload }: { actionId: string; payload: { value: unknown; blockId?: string } },\n): { [actionId: string]: { value: unknown; blockId?: string } } => ({\n\t...values,\n\t[actionId]: payload,\n});\n\nconst getViewId = (view: UiKit.View): string => {\n\tif ('id' in view && typeof view.id === 'string') {\n\t\treturn view.id;\n\t}\n\n\tif ('viewId' in view && typeof view.viewId === 'string') {\n\t\treturn view.viewId;\n\t}\n\n\tthrow new Error('Invalid view');\n};\n\nconst getViewFromInteraction = (interaction: UiKit.ServerInteraction): UiKit.View | undefined => {\n\tif ('view' in interaction && typeof interaction.view === 'object') {\n\t\treturn interaction.view;\n\t}\n\n\tif (interaction.type === 'banner.open') {\n\t\treturn interaction;\n\t}\n\n\treturn undefined;\n};\n\ntype UseUiKitViewReturnType<TView extends UiKit.View> = {\n\tview: TView;\n\terrors?: { [field: string]: string }[];\n\tvalues: { [actionId: string]: { value: unknown; blockId?: string } };\n\tupdateValues: Dispatch<{ actionId: string; payload: { value: unknown; blockId?: string } }>;\n\tstate: {\n\t\t[blockId: string]: {\n\t\t\t[key: string]: unknown;\n\t\t};\n\t};\n};\n\nexport function useUiKitView<S extends UiKit.View>(initialView: S): UseUiKitViewReturnType<S> {\n\tconst [errors, setErrors] = useSafely(useState<{ [field: string]: string }[] | undefined>());\n\tconst [values, updateValues] = useSafely(useReducer(reduceValues, initialView.blocks, extractInitialStateFromLayout));\n\tconst [view, updateView] = useSafely(useState(initialView));\n\tconst actionManager = useUiKitActionManager();\n\n\tconst state = useMemo(() => {\n\t\treturn Object.entries(values).reduce<{ [blockId: string]: { [actionId: string]: unknown } }>((obj, [key, payload]) => {\n\t\t\tif (!payload?.blockId) {\n\t\t\t\treturn obj;\n\t\t\t}\n\n\t\t\tconst { blockId, value } = payload;\n\t\t\tobj[blockId] = obj[blockId] || {};\n\t\t\tobj[blockId][key] = value;\n\n\t\t\treturn obj;\n\t\t}, {});\n\t}, [values]);\n\n\tconst viewId = getViewId(view);\n\n\tuseEffect(() => {\n\t\tconst handleUpdate = (interaction: UiKit.ServerInteraction): void => {\n\t\t\tif (interaction.type === 'errors') {\n\t\t\t\tsetErrors(interaction.errors);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdateView((view) => ({ ...view, ...getViewFromInteraction(interaction) }));\n\t\t};\n\n\t\tactionManager.on(viewId, handleUpdate);\n\n\t\treturn (): void => {\n\t\t\tactionManager.off(viewId, handleUpdate);\n\t\t};\n\t}, [actionManager, setErrors, updateView, viewId]);\n\n\treturn { view, errors, values, updateValues, state };\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"a02970cc8225ed8de7a9cf834696e2fd2f9de7c9"}
