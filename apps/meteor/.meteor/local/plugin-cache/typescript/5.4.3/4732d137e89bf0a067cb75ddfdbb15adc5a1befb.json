{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/version-check/server/functions/checkVersionUpdate.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/version-check/server/functions/checkVersionUpdate.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/version-check/server/functions/checkVersionUpdate.ts","inputSourceMap":{"version":3,"file":"app/version-check/server/functions/checkVersionUpdate.ts","sourceRoot":"","sources":["app/version-check/server/functions/checkVersionUpdate.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { Users } from '@rocket.chat/models';\n\nimport { i18n } from '../../../../server/lib/i18n';\nimport { sendMessagesToAdmins } from '../../../../server/lib/sendMessagesToAdmins';\nimport logger from '../logger';\nimport { buildVersionUpdateMessage } from './buildVersionUpdateMessage';\nimport { getNewUpdates } from './getNewUpdates';\n\nconst getMessagesToSendToAdmins = async (\n\talerts: {\n\t\tid: string;\n\t\tpriority: number;\n\t\ttitle: string;\n\t\ttext: string;\n\t\ttextArguments?: string[];\n\t\tmodifiers: string[];\n\t\tinfoUrl: string;\n\t}[],\n\tadminUser: IUser,\n): Promise<{ msg: string }[]> => {\n\tconst msgs = [];\n\tfor await (const alert of alerts) {\n\t\tif (!(await Users.bannerExistsById(adminUser._id, `alert-${alert.id}`))) {\n\t\t\tcontinue;\n\t\t}\n\t\tmsgs.push({\n\t\t\tmsg: `*${i18n.t('Rocket_Chat_Alert', { ...(adminUser.language && { lng: adminUser.language }) })}:*\\n\\n*${i18n.t(alert.title, {\n\t\t\t\t...(adminUser.language && { lng: adminUser.language }),\n\t\t\t})}*\\n${i18n.t(alert.text, {\n\t\t\t\t...(adminUser.language && { lng: adminUser.language }),\n\t\t\t\t...(Array.isArray(alert.textArguments) && {\n\t\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\t\tsprintf: alert.textArguments,\n\t\t\t\t}),\n\t\t\t\t...((!Array.isArray(alert.textArguments) && alert.textArguments) || {}), // bien dormido\n\t\t\t})}\\n${alert.infoUrl}`,\n\t\t});\n\t}\n\treturn msgs;\n};\n/**\n * @deprecated\n */\nexport const checkVersionUpdate = async () => {\n\tlogger.info('Checking for version updates');\n\n\tconst { versions, alerts } = await getNewUpdates();\n\n\tawait buildVersionUpdateMessage(versions);\n\n\tawait showAlertsFromCloud(alerts);\n};\n\nconst showAlertsFromCloud = async (\n\talerts?: {\n\t\tid: string;\n\t\tpriority: number;\n\t\ttitle: string;\n\t\ttext: string;\n\t\ttextArguments?: string[];\n\t\tmodifiers: string[];\n\t\tinfoUrl: string;\n\t}[],\n) => {\n\tif (!alerts?.length) {\n\t\treturn;\n\t}\n\treturn sendMessagesToAdmins({\n\t\tmsgs: async ({ adminUser }) => getMessagesToSendToAdmins(alerts, adminUser),\n\t\tbanners: alerts.map((alert) => ({\n\t\t\tid: `alert-${alert.id}`.replace(/\\./g, '_'),\n\t\t\tpriority: 10,\n\t\t\ttitle: alert.title,\n\t\t\ttext: alert.text,\n\t\t\ttextArguments: alert.textArguments,\n\t\t\tmodifiers: alert.modifiers,\n\t\t\tlink: alert.infoUrl,\n\t\t})),\n\t});\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/version-check/server/functions/checkVersionUpdate.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/version-check/server/functions/checkVersionUpdate.ts","inputSourceMap":{"version":3,"file":"app/version-check/server/functions/checkVersionUpdate.ts","sourceRoot":"","sources":["app/version-check/server/functions/checkVersionUpdate.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { Users } from '@rocket.chat/models';\n\nimport { i18n } from '../../../../server/lib/i18n';\nimport { sendMessagesToAdmins } from '../../../../server/lib/sendMessagesToAdmins';\nimport logger from '../logger';\nimport { buildVersionUpdateMessage } from './buildVersionUpdateMessage';\nimport { getNewUpdates } from './getNewUpdates';\n\nconst getMessagesToSendToAdmins = async (\n\talerts: {\n\t\tid: string;\n\t\tpriority: number;\n\t\ttitle: string;\n\t\ttext: string;\n\t\ttextArguments?: string[];\n\t\tmodifiers: string[];\n\t\tinfoUrl: string;\n\t}[],\n\tadminUser: IUser,\n): Promise<{ msg: string }[]> => {\n\tconst msgs = [];\n\tfor await (const alert of alerts) {\n\t\tif (!(await Users.bannerExistsById(adminUser._id, `alert-${alert.id}`))) {\n\t\t\tcontinue;\n\t\t}\n\t\tmsgs.push({\n\t\t\tmsg: `*${i18n.t('Rocket_Chat_Alert', { ...(adminUser.language && { lng: adminUser.language }) })}:*\\n\\n*${i18n.t(alert.title, {\n\t\t\t\t...(adminUser.language && { lng: adminUser.language }),\n\t\t\t})}*\\n${i18n.t(alert.text, {\n\t\t\t\t...(adminUser.language && { lng: adminUser.language }),\n\t\t\t\t...(Array.isArray(alert.textArguments) && {\n\t\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\t\tsprintf: alert.textArguments,\n\t\t\t\t}),\n\t\t\t\t...((!Array.isArray(alert.textArguments) && alert.textArguments) || {}), // bien dormido\n\t\t\t})}\\n${alert.infoUrl}`,\n\t\t});\n\t}\n\treturn msgs;\n};\n/**\n * @deprecated\n */\nexport const checkVersionUpdate = async () => {\n\tlogger.info('Checking for version updates');\n\n\tconst { versions, alerts } = await getNewUpdates();\n\n\tawait buildVersionUpdateMessage(versions);\n\n\tawait showAlertsFromCloud(alerts);\n};\n\nconst showAlertsFromCloud = async (\n\talerts?: {\n\t\tid: string;\n\t\tpriority: number;\n\t\ttitle: string;\n\t\ttext: string;\n\t\ttextArguments?: string[];\n\t\tmodifiers: string[];\n\t\tinfoUrl: string;\n\t}[],\n) => {\n\tif (!alerts?.length) {\n\t\treturn;\n\t}\n\treturn sendMessagesToAdmins({\n\t\tmsgs: async ({ adminUser }) => getMessagesToSendToAdmins(alerts, adminUser),\n\t\tbanners: alerts.map((alert) => ({\n\t\t\tid: `alert-${alert.id}`.replace(/\\./g, '_'),\n\t\t\tpriority: 10,\n\t\t\ttitle: alert.title,\n\t\t\ttext: alert.text,\n\t\t\ttextArguments: alert.textArguments,\n\t\t\tmodifiers: alert.modifiers,\n\t\t\tlink: alert.infoUrl,\n\t\t})),\n\t});\n};\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let _objectSpread;\n    module.link(\"@babel/runtime/helpers/objectSpread2\", {\n      default(v) {\n        _objectSpread = v;\n      }\n    }, 0);\n    let _asyncIterator;\n    module.link(\"@babel/runtime/helpers/asyncIterator\", {\n      default(v) {\n        _asyncIterator = v;\n      }\n    }, 1);\n    module.export({\n      checkVersionUpdate: () => checkVersionUpdate\n    });\n    let Users;\n    module.link(\"@rocket.chat/models\", {\n      Users(v) {\n        Users = v;\n      }\n    }, 0);\n    let i18n;\n    module.link(\"../../../../server/lib/i18n\", {\n      i18n(v) {\n        i18n = v;\n      }\n    }, 1);\n    let sendMessagesToAdmins;\n    module.link(\"../../../../server/lib/sendMessagesToAdmins\", {\n      sendMessagesToAdmins(v) {\n        sendMessagesToAdmins = v;\n      }\n    }, 2);\n    let logger;\n    module.link(\"../logger\", {\n      default(v) {\n        logger = v;\n      }\n    }, 3);\n    let buildVersionUpdateMessage;\n    module.link(\"./buildVersionUpdateMessage\", {\n      buildVersionUpdateMessage(v) {\n        buildVersionUpdateMessage = v;\n      }\n    }, 4);\n    let getNewUpdates;\n    module.link(\"./getNewUpdates\", {\n      getNewUpdates(v) {\n        getNewUpdates = v;\n      }\n    }, 5);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    const getMessagesToSendToAdmins = async (alerts, adminUser) => {\n      const msgs = [];\n      var _iteratorAbruptCompletion = false;\n      var _didIteratorError = false;\n      var _iteratorError;\n      try {\n        for (var _iterator = _asyncIterator(alerts), _step; _iteratorAbruptCompletion = !(_step = await _iterator.next()).done; _iteratorAbruptCompletion = false) {\n          const alert = _step.value;\n          {\n            if (!(await Users.bannerExistsById(adminUser._id, \"alert-\".concat(alert.id)))) {\n              continue;\n            }\n            msgs.push({\n              msg: \"*\".concat(i18n.t('Rocket_Chat_Alert', _objectSpread({}, adminUser.language && {\n                lng: adminUser.language\n              })), \":*\\n\\n*\").concat(i18n.t(alert.title, _objectSpread({}, adminUser.language && {\n                lng: adminUser.language\n              })), \"*\\n\").concat(i18n.t(alert.text, _objectSpread(_objectSpread(_objectSpread({}, adminUser.language && {\n                lng: adminUser.language\n              }), Array.isArray(alert.textArguments) && {\n                postProcess: 'sprintf',\n                sprintf: alert.textArguments\n              }), !Array.isArray(alert.textArguments) && alert.textArguments || {})), \"\\n\").concat(alert.infoUrl)\n            });\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (_iteratorAbruptCompletion && _iterator.return != null) {\n            await _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n      return msgs;\n    };\n    /**\n     * @deprecated\n     */\n    const checkVersionUpdate = async () => {\n      logger.info('Checking for version updates');\n      const {\n        versions,\n        alerts\n      } = await getNewUpdates();\n      await buildVersionUpdateMessage(versions);\n      await showAlertsFromCloud(alerts);\n    };\n    const showAlertsFromCloud = async alerts => {\n      if (!(alerts !== null && alerts !== void 0 && alerts.length)) {\n        return;\n      }\n      return sendMessagesToAdmins({\n        msgs: async _ref => {\n          let {\n            adminUser\n          } = _ref;\n          return getMessagesToSendToAdmins(alerts, adminUser);\n        },\n        banners: alerts.map(alert => ({\n          id: \"alert-\".concat(alert.id).replace(/\\./g, '_'),\n          priority: 10,\n          title: alert.title,\n          text: alert.text,\n          textArguments: alert.textArguments,\n          modifiers: alert.modifiers,\n          link: alert.infoUrl\n        }))\n      });\n    };\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["_objectSpread","module","link","default","v","_asyncIterator","export","checkVersionUpdate","Users","i18n","sendMessagesToAdmins","logger","buildVersionUpdateMessage","getNewUpdates","__reifyWaitForDeps__","getMessagesToSendToAdmins","alerts","adminUser","msgs","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","next","done","alert","value","bannerExistsById","_id","concat","id","push","msg","t","language","lng","title","text","Array","isArray","textArguments","postProcess","sprintf","infoUrl","err","return","info","versions","showAlertsFromCloud","length","_ref","banners","map","replace","priority","modifiers","__reify_async_result__","_reifyError","self","async"],"sources":["app/version-check/server/functions/checkVersionUpdate.ts"],"sourcesContent":["import type { IUser } from '@rocket.chat/core-typings';\nimport { Users } from '@rocket.chat/models';\n\nimport { i18n } from '../../../../server/lib/i18n';\nimport { sendMessagesToAdmins } from '../../../../server/lib/sendMessagesToAdmins';\nimport logger from '../logger';\nimport { buildVersionUpdateMessage } from './buildVersionUpdateMessage';\nimport { getNewUpdates } from './getNewUpdates';\n\nconst getMessagesToSendToAdmins = async (\n\talerts: {\n\t\tid: string;\n\t\tpriority: number;\n\t\ttitle: string;\n\t\ttext: string;\n\t\ttextArguments?: string[];\n\t\tmodifiers: string[];\n\t\tinfoUrl: string;\n\t}[],\n\tadminUser: IUser,\n): Promise<{ msg: string }[]> => {\n\tconst msgs = [];\n\tfor await (const alert of alerts) {\n\t\tif (!(await Users.bannerExistsById(adminUser._id, `alert-${alert.id}`))) {\n\t\t\tcontinue;\n\t\t}\n\t\tmsgs.push({\n\t\t\tmsg: `*${i18n.t('Rocket_Chat_Alert', { ...(adminUser.language && { lng: adminUser.language }) })}:*\\n\\n*${i18n.t(alert.title, {\n\t\t\t\t...(adminUser.language && { lng: adminUser.language }),\n\t\t\t})}*\\n${i18n.t(alert.text, {\n\t\t\t\t...(adminUser.language && { lng: adminUser.language }),\n\t\t\t\t...(Array.isArray(alert.textArguments) && {\n\t\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\t\tsprintf: alert.textArguments,\n\t\t\t\t}),\n\t\t\t\t...((!Array.isArray(alert.textArguments) && alert.textArguments) || {}), // bien dormido\n\t\t\t})}\\n${alert.infoUrl}`,\n\t\t});\n\t}\n\treturn msgs;\n};\n/**\n * @deprecated\n */\nexport const checkVersionUpdate = async () => {\n\tlogger.info('Checking for version updates');\n\n\tconst { versions, alerts } = await getNewUpdates();\n\n\tawait buildVersionUpdateMessage(versions);\n\n\tawait showAlertsFromCloud(alerts);\n};\n\nconst showAlertsFromCloud = async (\n\talerts?: {\n\t\tid: string;\n\t\tpriority: number;\n\t\ttitle: string;\n\t\ttext: string;\n\t\ttextArguments?: string[];\n\t\tmodifiers: string[];\n\t\tinfoUrl: string;\n\t}[],\n) => {\n\tif (!alerts?.length) {\n\t\treturn;\n\t}\n\treturn sendMessagesToAdmins({\n\t\tmsgs: async ({ adminUser }) => getMessagesToSendToAdmins(alerts, adminUser),\n\t\tbanners: alerts.map((alert) => ({\n\t\t\tid: `alert-${alert.id}`.replace(/\\./g, '_'),\n\t\t\tpriority: 10,\n\t\t\ttitle: alert.title,\n\t\t\ttext: alert.text,\n\t\t\ttextArguments: alert.textArguments,\n\t\t\tmodifiers: alert.modifiers,\n\t\t\tlink: alert.infoUrl,\n\t\t})),\n\t});\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"4732d137e89bf0a067cb75ddfdbb15adc5a1befb"}
