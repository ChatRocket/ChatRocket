{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/Factory.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"ee/server/local-services/federation/infrastructure/Factory.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/Factory.ts","inputSourceMap":{"version":3,"file":"ee/server/local-services/federation/infrastructure/Factory.ts","sourceRoot":"","sources":["ee/server/local-services/federation/infrastructure/Factory.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom, IUser, Username } from '@rocket.chat/core-typings';\n\nimport { FederationFactory } from '../../../../../server/services/federation/infrastructure/Factory';\nimport type { InMemoryQueue } from '../../../../../server/services/federation/infrastructure/queue/InMemoryQueue';\nimport type { RocketChatFileAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatMessageAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Message';\nimport { RocketChatNotificationAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Notification';\nimport type { RocketChatSettingsAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Settings';\nimport { FederationUserServiceEE } from '../application/UserService';\nimport { FederationDirectMessageRoomServiceSender } from '../application/room/sender/DirectMessageRoomServiceSender';\nimport { FederationRoomServiceSender } from '../application/room/sender/RoomServiceSender';\nimport type { IFederationBridgeEE } from '../domain/IFederationBridge';\nimport { MatrixBridgeEE } from './matrix/Bridge';\nimport { RocketChatQueueAdapterEE } from './rocket-chat/adapters/Queue';\nimport { RocketChatRoomAdapterEE } from './rocket-chat/adapters/Room';\nimport { RocketChatUserAdapterEE } from './rocket-chat/adapters/User';\nimport { FederationRoomSenderConverterEE } from './rocket-chat/converters/RoomSender';\nimport { FederationHooksEE } from './rocket-chat/hooks';\n\nexport class FederationFactoryEE extends FederationFactory {\n\tpublic static buildFederationBridge(internalSettingsAdapter: RocketChatSettingsAdapter, queue: InMemoryQueue): IFederationBridgeEE {\n\t\treturn new MatrixBridgeEE(internalSettingsAdapter, queue.addToQueue.bind(queue));\n\t}\n\n\tpublic static buildInternalRoomAdapter(): RocketChatRoomAdapterEE {\n\t\treturn new RocketChatRoomAdapterEE();\n\t}\n\n\tpublic static buildInternalNotificationAdapter(): RocketChatNotificationAdapter {\n\t\treturn new RocketChatNotificationAdapter();\n\t}\n\n\tpublic static buildInternalUserAdapter(): RocketChatUserAdapterEE {\n\t\treturn new RocketChatUserAdapterEE();\n\t}\n\n\tpublic static buildInternalQueueAdapter(): RocketChatQueueAdapterEE {\n\t\treturn new RocketChatQueueAdapterEE();\n\t}\n\n\tpublic static buildRoomServiceSenderEE(\n\t\tinternalRoomAdapter: RocketChatRoomAdapterEE,\n\t\tinternalUserAdapter: RocketChatUserAdapterEE,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tinternalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tinternalQueueAdapter: RocketChatQueueAdapterEE,\n\t\tbridge: IFederationBridgeEE,\n\t): FederationRoomServiceSender {\n\t\treturn new FederationRoomServiceSender(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tinternalNotificationAdapter,\n\t\t\tinternalQueueAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildDirectMessageRoomServiceSender(\n\t\tinternalRoomAdapter: RocketChatRoomAdapterEE,\n\t\tinternalUserAdapter: RocketChatUserAdapterEE,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridgeEE,\n\t): FederationDirectMessageRoomServiceSender {\n\t\treturn new FederationDirectMessageRoomServiceSender(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildRoomApplicationService(\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapterEE,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tbridge: IFederationBridgeEE,\n\t): FederationUserServiceEE {\n\t\treturn new FederationUserServiceEE(internalSettingsAdapter, internalFileAdapter, internalUserAdapter, bridge);\n\t}\n\n\tpublic static setupListenersForLocalActionsEE(\n\t\troomInternalHooksServiceSender: FederationRoomServiceSender,\n\t\tdmRoomInternalHooksServiceSender: FederationDirectMessageRoomServiceSender,\n\t\tsettingsAdapter: RocketChatSettingsAdapter,\n\t): void {\n\t\tconst homeServerDomain = settingsAdapter.getHomeServerDomain();\n\t\tFederationHooksEE.onFederatedRoomCreated(async (room: IRoom, owner: IUser, originalMemberList: string[]) =>\n\t\t\troomInternalHooksServiceSender.onRoomCreated(\n\t\t\t\tFederationRoomSenderConverterEE.toOnRoomCreationDto(\n\t\t\t\t\towner._id,\n\t\t\t\t\towner.username || '',\n\t\t\t\t\troom._id,\n\t\t\t\t\toriginalMemberList,\n\t\t\t\t\thomeServerDomain,\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t\tFederationHooksEE.onUsersAddedToARoom(async (room: IRoom, members: IUser[] | Username[], owner?: IUser) =>\n\t\t\troomInternalHooksServiceSender.onUsersAddedToARoom(\n\t\t\t\tFederationRoomSenderConverterEE.toOnAddedUsersToARoomDto(\n\t\t\t\t\towner?._id || '',\n\t\t\t\t\towner?.username || '',\n\t\t\t\t\troom._id,\n\t\t\t\t\tmembers,\n\t\t\t\t\thomeServerDomain,\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t\tFederationHooksEE.beforeDirectMessageRoomCreate(async (members: IUser[] | string[]) =>\n\t\t\tdmRoomInternalHooksServiceSender.beforeDirectMessageRoomCreation(\n\t\t\t\tFederationRoomSenderConverterEE.toBeforeDirectMessageCreatedDto(members, homeServerDomain),\n\t\t\t),\n\t\t);\n\t\tFederationHooksEE.onDirectMessageRoomCreated(async (room: IRoom, ownerId: IUser['_id'], members: IUser[] | string[]) =>\n\t\t\tdmRoomInternalHooksServiceSender.onDirectMessageRoomCreation(\n\t\t\t\tFederationRoomSenderConverterEE.toOnDirectMessageCreatedDto(ownerId, room._id, members, homeServerDomain),\n\t\t\t),\n\t\t);\n\t\tFederationHooksEE.beforeAddUserToARoom(async (user: IUser | string, room: IRoom, inviter?: IUser) =>\n\t\t\troomInternalHooksServiceSender.beforeAddUserToARoom(\n\t\t\t\tFederationRoomSenderConverterEE.toBeforeAddUserToARoomDto([user], room, homeServerDomain, inviter),\n\t\t\t),\n\t\t);\n\t}\n\n\tpublic static removeAllListeners(): void {\n\t\tsuper.removeAllListeners();\n\t\tFederationHooksEE.removeAllListeners();\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/ee/server/local-services/federation/infrastructure/Factory.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"ee/server/local-services/federation/infrastructure/Factory.ts","inputSourceMap":{"version":3,"file":"ee/server/local-services/federation/infrastructure/Factory.ts","sourceRoot":"","sources":["ee/server/local-services/federation/infrastructure/Factory.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom, IUser, Username } from '@rocket.chat/core-typings';\n\nimport { FederationFactory } from '../../../../../server/services/federation/infrastructure/Factory';\nimport type { InMemoryQueue } from '../../../../../server/services/federation/infrastructure/queue/InMemoryQueue';\nimport type { RocketChatFileAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatMessageAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Message';\nimport { RocketChatNotificationAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Notification';\nimport type { RocketChatSettingsAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Settings';\nimport { FederationUserServiceEE } from '../application/UserService';\nimport { FederationDirectMessageRoomServiceSender } from '../application/room/sender/DirectMessageRoomServiceSender';\nimport { FederationRoomServiceSender } from '../application/room/sender/RoomServiceSender';\nimport type { IFederationBridgeEE } from '../domain/IFederationBridge';\nimport { MatrixBridgeEE } from './matrix/Bridge';\nimport { RocketChatQueueAdapterEE } from './rocket-chat/adapters/Queue';\nimport { RocketChatRoomAdapterEE } from './rocket-chat/adapters/Room';\nimport { RocketChatUserAdapterEE } from './rocket-chat/adapters/User';\nimport { FederationRoomSenderConverterEE } from './rocket-chat/converters/RoomSender';\nimport { FederationHooksEE } from './rocket-chat/hooks';\n\nexport class FederationFactoryEE extends FederationFactory {\n\tpublic static buildFederationBridge(internalSettingsAdapter: RocketChatSettingsAdapter, queue: InMemoryQueue): IFederationBridgeEE {\n\t\treturn new MatrixBridgeEE(internalSettingsAdapter, queue.addToQueue.bind(queue));\n\t}\n\n\tpublic static buildInternalRoomAdapter(): RocketChatRoomAdapterEE {\n\t\treturn new RocketChatRoomAdapterEE();\n\t}\n\n\tpublic static buildInternalNotificationAdapter(): RocketChatNotificationAdapter {\n\t\treturn new RocketChatNotificationAdapter();\n\t}\n\n\tpublic static buildInternalUserAdapter(): RocketChatUserAdapterEE {\n\t\treturn new RocketChatUserAdapterEE();\n\t}\n\n\tpublic static buildInternalQueueAdapter(): RocketChatQueueAdapterEE {\n\t\treturn new RocketChatQueueAdapterEE();\n\t}\n\n\tpublic static buildRoomServiceSenderEE(\n\t\tinternalRoomAdapter: RocketChatRoomAdapterEE,\n\t\tinternalUserAdapter: RocketChatUserAdapterEE,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tinternalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tinternalQueueAdapter: RocketChatQueueAdapterEE,\n\t\tbridge: IFederationBridgeEE,\n\t): FederationRoomServiceSender {\n\t\treturn new FederationRoomServiceSender(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tinternalNotificationAdapter,\n\t\t\tinternalQueueAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildDirectMessageRoomServiceSender(\n\t\tinternalRoomAdapter: RocketChatRoomAdapterEE,\n\t\tinternalUserAdapter: RocketChatUserAdapterEE,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridgeEE,\n\t): FederationDirectMessageRoomServiceSender {\n\t\treturn new FederationDirectMessageRoomServiceSender(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildRoomApplicationService(\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapterEE,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tbridge: IFederationBridgeEE,\n\t): FederationUserServiceEE {\n\t\treturn new FederationUserServiceEE(internalSettingsAdapter, internalFileAdapter, internalUserAdapter, bridge);\n\t}\n\n\tpublic static setupListenersForLocalActionsEE(\n\t\troomInternalHooksServiceSender: FederationRoomServiceSender,\n\t\tdmRoomInternalHooksServiceSender: FederationDirectMessageRoomServiceSender,\n\t\tsettingsAdapter: RocketChatSettingsAdapter,\n\t): void {\n\t\tconst homeServerDomain = settingsAdapter.getHomeServerDomain();\n\t\tFederationHooksEE.onFederatedRoomCreated(async (room: IRoom, owner: IUser, originalMemberList: string[]) =>\n\t\t\troomInternalHooksServiceSender.onRoomCreated(\n\t\t\t\tFederationRoomSenderConverterEE.toOnRoomCreationDto(\n\t\t\t\t\towner._id,\n\t\t\t\t\towner.username || '',\n\t\t\t\t\troom._id,\n\t\t\t\t\toriginalMemberList,\n\t\t\t\t\thomeServerDomain,\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t\tFederationHooksEE.onUsersAddedToARoom(async (room: IRoom, members: IUser[] | Username[], owner?: IUser) =>\n\t\t\troomInternalHooksServiceSender.onUsersAddedToARoom(\n\t\t\t\tFederationRoomSenderConverterEE.toOnAddedUsersToARoomDto(\n\t\t\t\t\towner?._id || '',\n\t\t\t\t\towner?.username || '',\n\t\t\t\t\troom._id,\n\t\t\t\t\tmembers,\n\t\t\t\t\thomeServerDomain,\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t\tFederationHooksEE.beforeDirectMessageRoomCreate(async (members: IUser[] | string[]) =>\n\t\t\tdmRoomInternalHooksServiceSender.beforeDirectMessageRoomCreation(\n\t\t\t\tFederationRoomSenderConverterEE.toBeforeDirectMessageCreatedDto(members, homeServerDomain),\n\t\t\t),\n\t\t);\n\t\tFederationHooksEE.onDirectMessageRoomCreated(async (room: IRoom, ownerId: IUser['_id'], members: IUser[] | string[]) =>\n\t\t\tdmRoomInternalHooksServiceSender.onDirectMessageRoomCreation(\n\t\t\t\tFederationRoomSenderConverterEE.toOnDirectMessageCreatedDto(ownerId, room._id, members, homeServerDomain),\n\t\t\t),\n\t\t);\n\t\tFederationHooksEE.beforeAddUserToARoom(async (user: IUser | string, room: IRoom, inviter?: IUser) =>\n\t\t\troomInternalHooksServiceSender.beforeAddUserToARoom(\n\t\t\t\tFederationRoomSenderConverterEE.toBeforeAddUserToARoomDto([user], room, homeServerDomain, inviter),\n\t\t\t),\n\t\t);\n\t}\n\n\tpublic static removeAllListeners(): void {\n\t\tsuper.removeAllListeners();\n\t\tFederationHooksEE.removeAllListeners();\n\t}\n}\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    module.export({\n      FederationFactoryEE: () => FederationFactoryEE\n    });\n    let FederationFactory;\n    module.link(\"../../../../../server/services/federation/infrastructure/Factory\", {\n      FederationFactory(v) {\n        FederationFactory = v;\n      }\n    }, 0);\n    let RocketChatNotificationAdapter;\n    module.link(\"../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Notification\", {\n      RocketChatNotificationAdapter(v) {\n        RocketChatNotificationAdapter = v;\n      }\n    }, 1);\n    let FederationUserServiceEE;\n    module.link(\"../application/UserService\", {\n      FederationUserServiceEE(v) {\n        FederationUserServiceEE = v;\n      }\n    }, 2);\n    let FederationDirectMessageRoomServiceSender;\n    module.link(\"../application/room/sender/DirectMessageRoomServiceSender\", {\n      FederationDirectMessageRoomServiceSender(v) {\n        FederationDirectMessageRoomServiceSender = v;\n      }\n    }, 3);\n    let FederationRoomServiceSender;\n    module.link(\"../application/room/sender/RoomServiceSender\", {\n      FederationRoomServiceSender(v) {\n        FederationRoomServiceSender = v;\n      }\n    }, 4);\n    let MatrixBridgeEE;\n    module.link(\"./matrix/Bridge\", {\n      MatrixBridgeEE(v) {\n        MatrixBridgeEE = v;\n      }\n    }, 5);\n    let RocketChatQueueAdapterEE;\n    module.link(\"./rocket-chat/adapters/Queue\", {\n      RocketChatQueueAdapterEE(v) {\n        RocketChatQueueAdapterEE = v;\n      }\n    }, 6);\n    let RocketChatRoomAdapterEE;\n    module.link(\"./rocket-chat/adapters/Room\", {\n      RocketChatRoomAdapterEE(v) {\n        RocketChatRoomAdapterEE = v;\n      }\n    }, 7);\n    let RocketChatUserAdapterEE;\n    module.link(\"./rocket-chat/adapters/User\", {\n      RocketChatUserAdapterEE(v) {\n        RocketChatUserAdapterEE = v;\n      }\n    }, 8);\n    let FederationRoomSenderConverterEE;\n    module.link(\"./rocket-chat/converters/RoomSender\", {\n      FederationRoomSenderConverterEE(v) {\n        FederationRoomSenderConverterEE = v;\n      }\n    }, 9);\n    let FederationHooksEE;\n    module.link(\"./rocket-chat/hooks\", {\n      FederationHooksEE(v) {\n        FederationHooksEE = v;\n      }\n    }, 10);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    class FederationFactoryEE extends FederationFactory {\n      static buildFederationBridge(internalSettingsAdapter, queue) {\n        return new MatrixBridgeEE(internalSettingsAdapter, queue.addToQueue.bind(queue));\n      }\n      static buildInternalRoomAdapter() {\n        return new RocketChatRoomAdapterEE();\n      }\n      static buildInternalNotificationAdapter() {\n        return new RocketChatNotificationAdapter();\n      }\n      static buildInternalUserAdapter() {\n        return new RocketChatUserAdapterEE();\n      }\n      static buildInternalQueueAdapter() {\n        return new RocketChatQueueAdapterEE();\n      }\n      static buildRoomServiceSenderEE(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalSettingsAdapter, internalMessageAdapter, internalNotificationAdapter, internalQueueAdapter, bridge) {\n        return new FederationRoomServiceSender(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalSettingsAdapter, internalMessageAdapter, internalNotificationAdapter, internalQueueAdapter, bridge);\n      }\n      static buildDirectMessageRoomServiceSender(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalSettingsAdapter, bridge) {\n        return new FederationDirectMessageRoomServiceSender(internalRoomAdapter, internalUserAdapter, internalFileAdapter, internalSettingsAdapter, bridge);\n      }\n      static buildRoomApplicationService(internalSettingsAdapter, internalUserAdapter, internalFileAdapter, bridge) {\n        return new FederationUserServiceEE(internalSettingsAdapter, internalFileAdapter, internalUserAdapter, bridge);\n      }\n      static setupListenersForLocalActionsEE(roomInternalHooksServiceSender, dmRoomInternalHooksServiceSender, settingsAdapter) {\n        const homeServerDomain = settingsAdapter.getHomeServerDomain();\n        FederationHooksEE.onFederatedRoomCreated(async (room, owner, originalMemberList) => roomInternalHooksServiceSender.onRoomCreated(FederationRoomSenderConverterEE.toOnRoomCreationDto(owner._id, owner.username || '', room._id, originalMemberList, homeServerDomain)));\n        FederationHooksEE.onUsersAddedToARoom(async (room, members, owner) => roomInternalHooksServiceSender.onUsersAddedToARoom(FederationRoomSenderConverterEE.toOnAddedUsersToARoomDto((owner === null || owner === void 0 ? void 0 : owner._id) || '', (owner === null || owner === void 0 ? void 0 : owner.username) || '', room._id, members, homeServerDomain)));\n        FederationHooksEE.beforeDirectMessageRoomCreate(async members => dmRoomInternalHooksServiceSender.beforeDirectMessageRoomCreation(FederationRoomSenderConverterEE.toBeforeDirectMessageCreatedDto(members, homeServerDomain)));\n        FederationHooksEE.onDirectMessageRoomCreated(async (room, ownerId, members) => dmRoomInternalHooksServiceSender.onDirectMessageRoomCreation(FederationRoomSenderConverterEE.toOnDirectMessageCreatedDto(ownerId, room._id, members, homeServerDomain)));\n        FederationHooksEE.beforeAddUserToARoom(async (user, room, inviter) => roomInternalHooksServiceSender.beforeAddUserToARoom(FederationRoomSenderConverterEE.toBeforeAddUserToARoomDto([user], room, homeServerDomain, inviter)));\n      }\n      static removeAllListeners() {\n        super.removeAllListeners();\n        FederationHooksEE.removeAllListeners();\n      }\n    }\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["module","export","FederationFactoryEE","FederationFactory","link","v","RocketChatNotificationAdapter","FederationUserServiceEE","FederationDirectMessageRoomServiceSender","FederationRoomServiceSender","MatrixBridgeEE","RocketChatQueueAdapterEE","RocketChatRoomAdapterEE","RocketChatUserAdapterEE","FederationRoomSenderConverterEE","FederationHooksEE","__reifyWaitForDeps__","buildFederationBridge","internalSettingsAdapter","queue","addToQueue","bind","buildInternalRoomAdapter","buildInternalNotificationAdapter","buildInternalUserAdapter","buildInternalQueueAdapter","buildRoomServiceSenderEE","internalRoomAdapter","internalUserAdapter","internalFileAdapter","internalMessageAdapter","internalNotificationAdapter","internalQueueAdapter","bridge","buildDirectMessageRoomServiceSender","buildRoomApplicationService","setupListenersForLocalActionsEE","roomInternalHooksServiceSender","dmRoomInternalHooksServiceSender","settingsAdapter","homeServerDomain","getHomeServerDomain","onFederatedRoomCreated","room","owner","originalMemberList","onRoomCreated","toOnRoomCreationDto","_id","username","onUsersAddedToARoom","members","toOnAddedUsersToARoomDto","beforeDirectMessageRoomCreate","beforeDirectMessageRoomCreation","toBeforeDirectMessageCreatedDto","onDirectMessageRoomCreated","ownerId","onDirectMessageRoomCreation","toOnDirectMessageCreatedDto","beforeAddUserToARoom","user","inviter","toBeforeAddUserToARoomDto","removeAllListeners","__reify_async_result__","_reifyError","self","async"],"sources":["ee/server/local-services/federation/infrastructure/Factory.ts"],"sourcesContent":["import type { IRoom, IUser, Username } from '@rocket.chat/core-typings';\n\nimport { FederationFactory } from '../../../../../server/services/federation/infrastructure/Factory';\nimport type { InMemoryQueue } from '../../../../../server/services/federation/infrastructure/queue/InMemoryQueue';\nimport type { RocketChatFileAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/File';\nimport type { RocketChatMessageAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Message';\nimport { RocketChatNotificationAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Notification';\nimport type { RocketChatSettingsAdapter } from '../../../../../server/services/federation/infrastructure/rocket-chat/adapters/Settings';\nimport { FederationUserServiceEE } from '../application/UserService';\nimport { FederationDirectMessageRoomServiceSender } from '../application/room/sender/DirectMessageRoomServiceSender';\nimport { FederationRoomServiceSender } from '../application/room/sender/RoomServiceSender';\nimport type { IFederationBridgeEE } from '../domain/IFederationBridge';\nimport { MatrixBridgeEE } from './matrix/Bridge';\nimport { RocketChatQueueAdapterEE } from './rocket-chat/adapters/Queue';\nimport { RocketChatRoomAdapterEE } from './rocket-chat/adapters/Room';\nimport { RocketChatUserAdapterEE } from './rocket-chat/adapters/User';\nimport { FederationRoomSenderConverterEE } from './rocket-chat/converters/RoomSender';\nimport { FederationHooksEE } from './rocket-chat/hooks';\n\nexport class FederationFactoryEE extends FederationFactory {\n\tpublic static buildFederationBridge(internalSettingsAdapter: RocketChatSettingsAdapter, queue: InMemoryQueue): IFederationBridgeEE {\n\t\treturn new MatrixBridgeEE(internalSettingsAdapter, queue.addToQueue.bind(queue));\n\t}\n\n\tpublic static buildInternalRoomAdapter(): RocketChatRoomAdapterEE {\n\t\treturn new RocketChatRoomAdapterEE();\n\t}\n\n\tpublic static buildInternalNotificationAdapter(): RocketChatNotificationAdapter {\n\t\treturn new RocketChatNotificationAdapter();\n\t}\n\n\tpublic static buildInternalUserAdapter(): RocketChatUserAdapterEE {\n\t\treturn new RocketChatUserAdapterEE();\n\t}\n\n\tpublic static buildInternalQueueAdapter(): RocketChatQueueAdapterEE {\n\t\treturn new RocketChatQueueAdapterEE();\n\t}\n\n\tpublic static buildRoomServiceSenderEE(\n\t\tinternalRoomAdapter: RocketChatRoomAdapterEE,\n\t\tinternalUserAdapter: RocketChatUserAdapterEE,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalMessageAdapter: RocketChatMessageAdapter,\n\t\tinternalNotificationAdapter: RocketChatNotificationAdapter,\n\t\tinternalQueueAdapter: RocketChatQueueAdapterEE,\n\t\tbridge: IFederationBridgeEE,\n\t): FederationRoomServiceSender {\n\t\treturn new FederationRoomServiceSender(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tinternalMessageAdapter,\n\t\t\tinternalNotificationAdapter,\n\t\t\tinternalQueueAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildDirectMessageRoomServiceSender(\n\t\tinternalRoomAdapter: RocketChatRoomAdapterEE,\n\t\tinternalUserAdapter: RocketChatUserAdapterEE,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tbridge: IFederationBridgeEE,\n\t): FederationDirectMessageRoomServiceSender {\n\t\treturn new FederationDirectMessageRoomServiceSender(\n\t\t\tinternalRoomAdapter,\n\t\t\tinternalUserAdapter,\n\t\t\tinternalFileAdapter,\n\t\t\tinternalSettingsAdapter,\n\t\t\tbridge,\n\t\t);\n\t}\n\n\tpublic static buildRoomApplicationService(\n\t\tinternalSettingsAdapter: RocketChatSettingsAdapter,\n\t\tinternalUserAdapter: RocketChatUserAdapterEE,\n\t\tinternalFileAdapter: RocketChatFileAdapter,\n\t\tbridge: IFederationBridgeEE,\n\t): FederationUserServiceEE {\n\t\treturn new FederationUserServiceEE(internalSettingsAdapter, internalFileAdapter, internalUserAdapter, bridge);\n\t}\n\n\tpublic static setupListenersForLocalActionsEE(\n\t\troomInternalHooksServiceSender: FederationRoomServiceSender,\n\t\tdmRoomInternalHooksServiceSender: FederationDirectMessageRoomServiceSender,\n\t\tsettingsAdapter: RocketChatSettingsAdapter,\n\t): void {\n\t\tconst homeServerDomain = settingsAdapter.getHomeServerDomain();\n\t\tFederationHooksEE.onFederatedRoomCreated(async (room: IRoom, owner: IUser, originalMemberList: string[]) =>\n\t\t\troomInternalHooksServiceSender.onRoomCreated(\n\t\t\t\tFederationRoomSenderConverterEE.toOnRoomCreationDto(\n\t\t\t\t\towner._id,\n\t\t\t\t\towner.username || '',\n\t\t\t\t\troom._id,\n\t\t\t\t\toriginalMemberList,\n\t\t\t\t\thomeServerDomain,\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t\tFederationHooksEE.onUsersAddedToARoom(async (room: IRoom, members: IUser[] | Username[], owner?: IUser) =>\n\t\t\troomInternalHooksServiceSender.onUsersAddedToARoom(\n\t\t\t\tFederationRoomSenderConverterEE.toOnAddedUsersToARoomDto(\n\t\t\t\t\towner?._id || '',\n\t\t\t\t\towner?.username || '',\n\t\t\t\t\troom._id,\n\t\t\t\t\tmembers,\n\t\t\t\t\thomeServerDomain,\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t\tFederationHooksEE.beforeDirectMessageRoomCreate(async (members: IUser[] | string[]) =>\n\t\t\tdmRoomInternalHooksServiceSender.beforeDirectMessageRoomCreation(\n\t\t\t\tFederationRoomSenderConverterEE.toBeforeDirectMessageCreatedDto(members, homeServerDomain),\n\t\t\t),\n\t\t);\n\t\tFederationHooksEE.onDirectMessageRoomCreated(async (room: IRoom, ownerId: IUser['_id'], members: IUser[] | string[]) =>\n\t\t\tdmRoomInternalHooksServiceSender.onDirectMessageRoomCreation(\n\t\t\t\tFederationRoomSenderConverterEE.toOnDirectMessageCreatedDto(ownerId, room._id, members, homeServerDomain),\n\t\t\t),\n\t\t);\n\t\tFederationHooksEE.beforeAddUserToARoom(async (user: IUser | string, room: IRoom, inviter?: IUser) =>\n\t\t\troomInternalHooksServiceSender.beforeAddUserToARoom(\n\t\t\t\tFederationRoomSenderConverterEE.toBeforeAddUserToARoomDto([user], room, homeServerDomain, inviter),\n\t\t\t),\n\t\t);\n\t}\n\n\tpublic static removeAllListeners(): void {\n\t\tsuper.removeAllListeners();\n\t\tFederationHooksEE.removeAllListeners();\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"ad714536153cd0ca2f8895ad0190413483f68ad7"}
