{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/recorderjs/videoRecorder.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui/client/lib/recorderjs/videoRecorder.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/recorderjs/videoRecorder.ts","inputSourceMap":{"version":3,"file":"app/ui/client/lib/recorderjs/videoRecorder.ts","sourceRoot":"","sources":["app/ui/client/lib/recorderjs/videoRecorder.ts"],"names":[],"mappings":"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","sourcesContent":["import { ReactiveVar } from 'meteor/reactive-var';\n\nclass VideoRecorder {\n\tpublic cameraStarted = new ReactiveVar(false);\n\n\tprivate started = false;\n\n\tprivate recording = new ReactiveVar(false);\n\n\tprivate recordingAvailable = new ReactiveVar(false);\n\n\tprivate videoel: HTMLVideoElement | undefined;\n\n\tprivate chunks: Blob[] = [];\n\n\tprivate stream: MediaStream | undefined;\n\n\tprivate mediaRecorder: MediaRecorder | undefined;\n\n\tpublic getSupportedMimeTypes() {\n\t\tif (window.MediaRecorder.isTypeSupported('video/webm')) {\n\t\t\treturn 'video/webm; codecs=vp8,opus';\n\t\t}\n\t\tif (window.MediaRecorder.isTypeSupported('video/mp4')) {\n\t\t\treturn 'video/mp4';\n\t\t}\n\t\treturn '';\n\t}\n\n\tpublic start(videoel?: HTMLVideoElement, cb?: (this: this, success: boolean) => void) {\n\t\tthis.videoel = videoel;\n\n\t\tconst handleSuccess = (stream: MediaStream) => {\n\t\t\tthis.startUserMedia(stream);\n\t\t\tcb?.call(this, true);\n\t\t};\n\n\t\tconst handleError = (error: any) => {\n\t\t\tconsole.error(error);\n\t\t\tcb?.call(this, false);\n\t\t};\n\n\t\tif (navigator.mediaDevices) {\n\t\t\tnavigator.mediaDevices.getUserMedia({ audio: true, video: true }).then(handleSuccess, handleError);\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldGetUserMedia = navigator.getUserMedia ?? navigator.webkitGetUserMedia ?? navigator.mozGetUserMedia ?? navigator.msGetUserMedia;\n\n\t\tif (oldGetUserMedia) {\n\t\t\toldGetUserMedia.call(navigator, { audio: true, video: true }, handleSuccess, handleError);\n\t\t\treturn;\n\t\t}\n\n\t\tcb?.call(this, false);\n\t}\n\n\tpublic record() {\n\t\tthis.chunks = [];\n\t\tif (!this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mediaRecorder = new MediaRecorder(this.stream, { mimeType: this.getSupportedMimeTypes() });\n\t\tthis.mediaRecorder.ondataavailable = (blobev) => {\n\t\t\tthis.chunks.push(blobev.data);\n\t\t\tif (!this.recordingAvailable.get()) {\n\t\t\t\treturn this.recordingAvailable.set(true);\n\t\t\t}\n\t\t};\n\t\tthis.mediaRecorder.start();\n\t\treturn this.recording.set(true);\n\t}\n\n\tprivate startUserMedia(stream: MediaStream) {\n\t\tif (!this.videoel) {\n\t\t\treturn;\n\t\t}\n\t\tthis.stream = stream;\n\n\t\ttry {\n\t\t\tthis.videoel.srcObject = stream;\n\t\t} catch (error) {\n\t\t\tconst URL = window.URL || window.webkitURL;\n\t\t\tthis.videoel.src = URL.createObjectURL(stream as unknown as MediaSource | Blob);\n\t\t}\n\n\t\tthis.started = true;\n\t\treturn this.cameraStarted.set(true);\n\t}\n\n\tpublic stop(cb?: (blob: Blob) => void) {\n\t\tif (!this.started) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stopRecording();\n\n\t\tif (this.stream) {\n\t\t\tconst vtracks = this.stream.getVideoTracks();\n\t\t\tfor (const vtrack of Array.from(vtracks)) {\n\t\t\t\tvtrack.stop();\n\t\t\t}\n\n\t\t\tconst atracks = this.stream.getAudioTracks();\n\t\t\tfor (const atrack of Array.from(atracks)) {\n\t\t\t\tatrack.stop();\n\t\t\t}\n\t\t}\n\n\t\tif (this.videoel) {\n\t\t\tthis.videoel.pause;\n\t\t\tthis.videoel.src = '';\n\t\t}\n\n\t\tthis.started = false;\n\t\tthis.cameraStarted.set(false);\n\t\tthis.recordingAvailable.set(false);\n\n\t\tif (cb && this.chunks) {\n\t\t\tconst blob = new Blob(this.chunks);\n\t\t\tcb(blob);\n\t\t}\n\n\t\tdelete this.stream;\n\t\tdelete this.videoel;\n\t}\n\n\tpublic stopRecording() {\n\t\tif (!this.started || !this.recording || !this.mediaRecorder) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mediaRecorder.stop();\n\t\tthis.recording.set(false);\n\t\tdelete this.mediaRecorder;\n\t}\n}\n\nconst instance = new VideoRecorder();\n\nexport { instance as VideoRecorder };\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/recorderjs/videoRecorder.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui/client/lib/recorderjs/videoRecorder.ts","inputSourceMap":{"version":3,"file":"app/ui/client/lib/recorderjs/videoRecorder.ts","sourceRoot":"","sources":["app/ui/client/lib/recorderjs/videoRecorder.ts"],"names":[],"mappings":"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","sourcesContent":["import { ReactiveVar } from 'meteor/reactive-var';\n\nclass VideoRecorder {\n\tpublic cameraStarted = new ReactiveVar(false);\n\n\tprivate started = false;\n\n\tprivate recording = new ReactiveVar(false);\n\n\tprivate recordingAvailable = new ReactiveVar(false);\n\n\tprivate videoel: HTMLVideoElement | undefined;\n\n\tprivate chunks: Blob[] = [];\n\n\tprivate stream: MediaStream | undefined;\n\n\tprivate mediaRecorder: MediaRecorder | undefined;\n\n\tpublic getSupportedMimeTypes() {\n\t\tif (window.MediaRecorder.isTypeSupported('video/webm')) {\n\t\t\treturn 'video/webm; codecs=vp8,opus';\n\t\t}\n\t\tif (window.MediaRecorder.isTypeSupported('video/mp4')) {\n\t\t\treturn 'video/mp4';\n\t\t}\n\t\treturn '';\n\t}\n\n\tpublic start(videoel?: HTMLVideoElement, cb?: (this: this, success: boolean) => void) {\n\t\tthis.videoel = videoel;\n\n\t\tconst handleSuccess = (stream: MediaStream) => {\n\t\t\tthis.startUserMedia(stream);\n\t\t\tcb?.call(this, true);\n\t\t};\n\n\t\tconst handleError = (error: any) => {\n\t\t\tconsole.error(error);\n\t\t\tcb?.call(this, false);\n\t\t};\n\n\t\tif (navigator.mediaDevices) {\n\t\t\tnavigator.mediaDevices.getUserMedia({ audio: true, video: true }).then(handleSuccess, handleError);\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldGetUserMedia = navigator.getUserMedia ?? navigator.webkitGetUserMedia ?? navigator.mozGetUserMedia ?? navigator.msGetUserMedia;\n\n\t\tif (oldGetUserMedia) {\n\t\t\toldGetUserMedia.call(navigator, { audio: true, video: true }, handleSuccess, handleError);\n\t\t\treturn;\n\t\t}\n\n\t\tcb?.call(this, false);\n\t}\n\n\tpublic record() {\n\t\tthis.chunks = [];\n\t\tif (!this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mediaRecorder = new MediaRecorder(this.stream, { mimeType: this.getSupportedMimeTypes() });\n\t\tthis.mediaRecorder.ondataavailable = (blobev) => {\n\t\t\tthis.chunks.push(blobev.data);\n\t\t\tif (!this.recordingAvailable.get()) {\n\t\t\t\treturn this.recordingAvailable.set(true);\n\t\t\t}\n\t\t};\n\t\tthis.mediaRecorder.start();\n\t\treturn this.recording.set(true);\n\t}\n\n\tprivate startUserMedia(stream: MediaStream) {\n\t\tif (!this.videoel) {\n\t\t\treturn;\n\t\t}\n\t\tthis.stream = stream;\n\n\t\ttry {\n\t\t\tthis.videoel.srcObject = stream;\n\t\t} catch (error) {\n\t\t\tconst URL = window.URL || window.webkitURL;\n\t\t\tthis.videoel.src = URL.createObjectURL(stream as unknown as MediaSource | Blob);\n\t\t}\n\n\t\tthis.started = true;\n\t\treturn this.cameraStarted.set(true);\n\t}\n\n\tpublic stop(cb?: (blob: Blob) => void) {\n\t\tif (!this.started) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stopRecording();\n\n\t\tif (this.stream) {\n\t\t\tconst vtracks = this.stream.getVideoTracks();\n\t\t\tfor (const vtrack of Array.from(vtracks)) {\n\t\t\t\tvtrack.stop();\n\t\t\t}\n\n\t\t\tconst atracks = this.stream.getAudioTracks();\n\t\t\tfor (const atrack of Array.from(atracks)) {\n\t\t\t\tatrack.stop();\n\t\t\t}\n\t\t}\n\n\t\tif (this.videoel) {\n\t\t\tthis.videoel.pause;\n\t\t\tthis.videoel.src = '';\n\t\t}\n\n\t\tthis.started = false;\n\t\tthis.cameraStarted.set(false);\n\t\tthis.recordingAvailable.set(false);\n\n\t\tif (cb && this.chunks) {\n\t\t\tconst blob = new Blob(this.chunks);\n\t\t\tcb(blob);\n\t\t}\n\n\t\tdelete this.stream;\n\t\tdelete this.videoel;\n\t}\n\n\tpublic stopRecording() {\n\t\tif (!this.started || !this.recording || !this.mediaRecorder) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mediaRecorder.stop();\n\t\tthis.recording.set(false);\n\t\tdelete this.mediaRecorder;\n\t}\n}\n\nconst instance = new VideoRecorder();\n\nexport { instance as VideoRecorder };\n"]}}},"code":"module.export({\n  VideoRecorder: function () {\n    return instance;\n  }\n});\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 0);\nvar VideoRecorder = /*#__PURE__*/function () {\n  function VideoRecorder() {\n    this.cameraStarted = new ReactiveVar(false);\n    this.started = false;\n    this.recording = new ReactiveVar(false);\n    this.recordingAvailable = new ReactiveVar(false);\n    this.videoel = void 0;\n    this.chunks = [];\n    this.stream = void 0;\n    this.mediaRecorder = void 0;\n  }\n  var _proto = VideoRecorder.prototype;\n  _proto.getSupportedMimeTypes = function () {\n    function getSupportedMimeTypes() {\n      if (window.MediaRecorder.isTypeSupported('video/webm')) {\n        return 'video/webm; codecs=vp8,opus';\n      }\n      if (window.MediaRecorder.isTypeSupported('video/mp4')) {\n        return 'video/mp4';\n      }\n      return '';\n    }\n    return getSupportedMimeTypes;\n  }();\n  _proto.start = function () {\n    function start(videoel, cb) {\n      var _this = this,\n        _ref,\n        _ref2,\n        _navigator$getUserMed;\n      this.videoel = videoel;\n      var handleSuccess = function (stream) {\n        _this.startUserMedia(stream);\n        cb === null || cb === void 0 ? void 0 : cb.call(_this, true);\n      };\n      var handleError = function (error) {\n        console.error(error);\n        cb === null || cb === void 0 ? void 0 : cb.call(_this, false);\n      };\n      if (navigator.mediaDevices) {\n        navigator.mediaDevices.getUserMedia({\n          audio: true,\n          video: true\n        }).then(handleSuccess, handleError);\n        return;\n      }\n      var oldGetUserMedia = (_ref = (_ref2 = (_navigator$getUserMed = navigator.getUserMedia) !== null && _navigator$getUserMed !== void 0 ? _navigator$getUserMed : navigator.webkitGetUserMedia) !== null && _ref2 !== void 0 ? _ref2 : navigator.mozGetUserMedia) !== null && _ref !== void 0 ? _ref : navigator.msGetUserMedia;\n      if (oldGetUserMedia) {\n        oldGetUserMedia.call(navigator, {\n          audio: true,\n          video: true\n        }, handleSuccess, handleError);\n        return;\n      }\n      cb === null || cb === void 0 ? void 0 : cb.call(this, false);\n    }\n    return start;\n  }();\n  _proto.record = function () {\n    function record() {\n      var _this2 = this;\n      this.chunks = [];\n      if (!this.stream) {\n        return;\n      }\n      this.mediaRecorder = new MediaRecorder(this.stream, {\n        mimeType: this.getSupportedMimeTypes()\n      });\n      this.mediaRecorder.ondataavailable = function (blobev) {\n        _this2.chunks.push(blobev.data);\n        if (!_this2.recordingAvailable.get()) {\n          return _this2.recordingAvailable.set(true);\n        }\n      };\n      this.mediaRecorder.start();\n      return this.recording.set(true);\n    }\n    return record;\n  }();\n  _proto.startUserMedia = function () {\n    function startUserMedia(stream) {\n      if (!this.videoel) {\n        return;\n      }\n      this.stream = stream;\n      try {\n        this.videoel.srcObject = stream;\n      } catch (error) {\n        var URL = window.URL || window.webkitURL;\n        this.videoel.src = URL.createObjectURL(stream);\n      }\n      this.started = true;\n      return this.cameraStarted.set(true);\n    }\n    return startUserMedia;\n  }();\n  _proto.stop = function () {\n    function stop(cb) {\n      if (!this.started) {\n        return;\n      }\n      this.stopRecording();\n      if (this.stream) {\n        var vtracks = this.stream.getVideoTracks();\n        for (var _i = 0, _Array$from = Array.from(vtracks); _i < _Array$from.length; _i++) {\n          var vtrack = _Array$from[_i];\n          vtrack.stop();\n        }\n        var atracks = this.stream.getAudioTracks();\n        for (var _i2 = 0, _Array$from2 = Array.from(atracks); _i2 < _Array$from2.length; _i2++) {\n          var atrack = _Array$from2[_i2];\n          atrack.stop();\n        }\n      }\n      if (this.videoel) {\n        this.videoel.pause;\n        this.videoel.src = '';\n      }\n      this.started = false;\n      this.cameraStarted.set(false);\n      this.recordingAvailable.set(false);\n      if (cb && this.chunks) {\n        var blob = new Blob(this.chunks);\n        cb(blob);\n      }\n      delete this.stream;\n      delete this.videoel;\n    }\n    return stop;\n  }();\n  _proto.stopRecording = function () {\n    function stopRecording() {\n      if (!this.started || !this.recording || !this.mediaRecorder) {\n        return;\n      }\n      this.mediaRecorder.stop();\n      this.recording.set(false);\n      delete this.mediaRecorder;\n    }\n    return stopRecording;\n  }();\n  return VideoRecorder;\n}();\nvar instance = new VideoRecorder();","map":{"version":3,"names":["module","export","VideoRecorder","instance","ReactiveVar","link","v","cameraStarted","started","recording","recordingAvailable","videoel","chunks","stream","mediaRecorder","_proto","prototype","getSupportedMimeTypes","window","MediaRecorder","isTypeSupported","start","cb","_this","_ref","_ref2","_navigator$getUserMed","handleSuccess","startUserMedia","call","handleError","error","console","navigator","mediaDevices","getUserMedia","audio","video","then","oldGetUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","record","_this2","mimeType","ondataavailable","blobev","push","data","get","set","srcObject","URL","webkitURL","src","createObjectURL","stop","stopRecording","vtracks","getVideoTracks","_i","_Array$from","Array","from","length","vtrack","atracks","getAudioTracks","_i2","_Array$from2","atrack","pause","blob","Blob"],"sources":["app/ui/client/lib/recorderjs/videoRecorder.ts"],"sourcesContent":["import { ReactiveVar } from 'meteor/reactive-var';\n\nclass VideoRecorder {\n\tpublic cameraStarted = new ReactiveVar(false);\n\n\tprivate started = false;\n\n\tprivate recording = new ReactiveVar(false);\n\n\tprivate recordingAvailable = new ReactiveVar(false);\n\n\tprivate videoel: HTMLVideoElement | undefined;\n\n\tprivate chunks: Blob[] = [];\n\n\tprivate stream: MediaStream | undefined;\n\n\tprivate mediaRecorder: MediaRecorder | undefined;\n\n\tpublic getSupportedMimeTypes() {\n\t\tif (window.MediaRecorder.isTypeSupported('video/webm')) {\n\t\t\treturn 'video/webm; codecs=vp8,opus';\n\t\t}\n\t\tif (window.MediaRecorder.isTypeSupported('video/mp4')) {\n\t\t\treturn 'video/mp4';\n\t\t}\n\t\treturn '';\n\t}\n\n\tpublic start(videoel?: HTMLVideoElement, cb?: (this: this, success: boolean) => void) {\n\t\tthis.videoel = videoel;\n\n\t\tconst handleSuccess = (stream: MediaStream) => {\n\t\t\tthis.startUserMedia(stream);\n\t\t\tcb?.call(this, true);\n\t\t};\n\n\t\tconst handleError = (error: any) => {\n\t\t\tconsole.error(error);\n\t\t\tcb?.call(this, false);\n\t\t};\n\n\t\tif (navigator.mediaDevices) {\n\t\t\tnavigator.mediaDevices.getUserMedia({ audio: true, video: true }).then(handleSuccess, handleError);\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldGetUserMedia = navigator.getUserMedia ?? navigator.webkitGetUserMedia ?? navigator.mozGetUserMedia ?? navigator.msGetUserMedia;\n\n\t\tif (oldGetUserMedia) {\n\t\t\toldGetUserMedia.call(navigator, { audio: true, video: true }, handleSuccess, handleError);\n\t\t\treturn;\n\t\t}\n\n\t\tcb?.call(this, false);\n\t}\n\n\tpublic record() {\n\t\tthis.chunks = [];\n\t\tif (!this.stream) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mediaRecorder = new MediaRecorder(this.stream, { mimeType: this.getSupportedMimeTypes() });\n\t\tthis.mediaRecorder.ondataavailable = (blobev) => {\n\t\t\tthis.chunks.push(blobev.data);\n\t\t\tif (!this.recordingAvailable.get()) {\n\t\t\t\treturn this.recordingAvailable.set(true);\n\t\t\t}\n\t\t};\n\t\tthis.mediaRecorder.start();\n\t\treturn this.recording.set(true);\n\t}\n\n\tprivate startUserMedia(stream: MediaStream) {\n\t\tif (!this.videoel) {\n\t\t\treturn;\n\t\t}\n\t\tthis.stream = stream;\n\n\t\ttry {\n\t\t\tthis.videoel.srcObject = stream;\n\t\t} catch (error) {\n\t\t\tconst URL = window.URL || window.webkitURL;\n\t\t\tthis.videoel.src = URL.createObjectURL(stream as unknown as MediaSource | Blob);\n\t\t}\n\n\t\tthis.started = true;\n\t\treturn this.cameraStarted.set(true);\n\t}\n\n\tpublic stop(cb?: (blob: Blob) => void) {\n\t\tif (!this.started) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stopRecording();\n\n\t\tif (this.stream) {\n\t\t\tconst vtracks = this.stream.getVideoTracks();\n\t\t\tfor (const vtrack of Array.from(vtracks)) {\n\t\t\t\tvtrack.stop();\n\t\t\t}\n\n\t\t\tconst atracks = this.stream.getAudioTracks();\n\t\t\tfor (const atrack of Array.from(atracks)) {\n\t\t\t\tatrack.stop();\n\t\t\t}\n\t\t}\n\n\t\tif (this.videoel) {\n\t\t\tthis.videoel.pause;\n\t\t\tthis.videoel.src = '';\n\t\t}\n\n\t\tthis.started = false;\n\t\tthis.cameraStarted.set(false);\n\t\tthis.recordingAvailable.set(false);\n\n\t\tif (cb && this.chunks) {\n\t\t\tconst blob = new Blob(this.chunks);\n\t\t\tcb(blob);\n\t\t}\n\n\t\tdelete this.stream;\n\t\tdelete this.videoel;\n\t}\n\n\tpublic stopRecording() {\n\t\tif (!this.started || !this.recording || !this.mediaRecorder) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mediaRecorder.stop();\n\t\tthis.recording.set(false);\n\t\tdelete this.mediaRecorder;\n\t}\n}\n\nconst instance = new VideoRecorder();\n\nexport { instance as VideoRecorder };\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"9c8b79e7a4f4f8c6a6aeaafafa0036570ed8448e"}
