{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/composer/hooks/useComposerBoxPopup.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/room/composer/hooks/useComposerBoxPopup.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/composer/hooks/useComposerBoxPopup.ts","inputSourceMap":{"version":3,"file":"client/views/room/composer/hooks/useComposerBoxPopup.ts","sourceRoot":"","sources":["client/views/room/composer/hooks/useComposerBoxPopup.ts"],"names":[],"mappings":"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","sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport type { UseQueryResult } from '@tanstack/react-query';\nimport type { MutableRefObject } from 'react';\nimport { useEffect, useCallback, useState, useRef } from 'react';\n\nimport { useChat } from '../../contexts/ChatContext';\nimport type { ComposerPopupOption } from '../../contexts/ComposerPopupContext';\nimport { useComposerBoxPopupQueries } from './useComposerBoxPopupQueries';\n\ntype ComposerBoxPopupImperativeCommands<T> = MutableRefObject<\n\t| {\n\t\t\tgetFilter?: () => unknown;\n\t\t\tselect?: (s: T) => void;\n\t  }\n\t| undefined\n>;\n\ntype ComposerBoxPopupOptions<T extends { _id: string; sort?: number | undefined }> = ComposerPopupOption<T>;\n\ntype ComposerBoxPopupResult<T extends { _id: string; sort?: number }> =\n\t| {\n\t\t\tpopup: ComposerPopupOption<T>;\n\t\t\titems: UseQueryResult<T[]>[];\n\t\t\tfocused: T | undefined;\n\t\t\tariaActiveDescendant: string | undefined;\n\t\t\tselect: (item: T) => void;\n\t\t\tcallbackRef: (node: HTMLElement) => void;\n\t\t\tcommandsRef: ComposerBoxPopupImperativeCommands<T>;\n\t\t\tsuspended: boolean;\n\t\t\tfilter: unknown;\n\t\t\tclearPopup: () => void;\n\t  }\n\t| {\n\t\t\tpopup: undefined;\n\t\t\titems: undefined;\n\t\t\tfocused: undefined;\n\t\t\tariaActiveDescendant: undefined;\n\t\t\tcallbackRef: (node: HTMLElement) => void;\n\t\t\tselect: undefined;\n\t\t\tcommandsRef: ComposerBoxPopupImperativeCommands<T>;\n\t\t\tsuspended: boolean;\n\t\t\tfilter: unknown;\n\t\t\tclearPopup: () => void;\n\t  };\n\nconst keys = {\n\tTAB: 9,\n\tENTER: 13,\n\tESC: 27,\n\tARROW_LEFT: 37,\n\tARROW_UP: 38,\n\tARROW_RIGHT: 39,\n\tARROW_DOWN: 40,\n};\n\nexport const useComposerBoxPopup = <T extends { _id: string; sort?: number }>({\n\tconfigurations,\n}: {\n\tconfigurations: ComposerBoxPopupOptions<T>[];\n}): ComposerBoxPopupResult<T> => {\n\tconst [popup, setPopup] = useState<ComposerBoxPopupOptions<T> | undefined>(undefined);\n\tconst [focused, setFocused] = useState<T | undefined>(undefined);\n\tconst [filter, setFilter] = useState<unknown>('');\n\n\tconst commandsRef: ComposerBoxPopupImperativeCommands<T> = useRef();\n\n\tconst { queries: items, suspended } = useComposerBoxPopupQueries(filter, popup) as {\n\t\tqueries: UseQueryResult<T[]>[];\n\t\tsuspended: boolean;\n\t};\n\n\tconst chat = useChat();\n\n\tconst ariaActiveDescendant = focused ? `popup-item-${focused._id}` : undefined;\n\n\tuseEffect(() => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (popup?.preview && suspended) {\n\t\t\tsetFocused(undefined);\n\t\t\treturn;\n\t\t}\n\t\tsetFocused((focused) => {\n\t\t\tconst sortedItems = items\n\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\t\t\treturn sortedItems.find((item) => item._id === focused?._id) ?? sortedItems[0];\n\t\t});\n\t}, [items, popup, suspended]);\n\n\tconst select = useMutableCallback((item: T) => {\n\t\tif (!popup) {\n\t\t\tthrow new Error('No popup is open');\n\t\t}\n\n\t\tif (commandsRef.current?.select) {\n\t\t\tcommandsRef.current.select(item);\n\t\t} else {\n\t\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\t\t\tconst selector =\n\t\t\t\tpopup.matchSelectorRegex ??\n\t\t\t\t(popup.triggerAnywhere ? new RegExp(`(?:^| |\\n)(${popup.trigger})([^\\\\s]*$)`) : new RegExp(`(?:^)(${popup.trigger})([^\\\\s]*$)`));\n\n\t\t\tconst result = value?.match(selector);\n\t\t\tif (!result || !value) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tchat?.composer?.replaceText((popup.prefix ?? popup.trigger ?? '') + popup.getValue(item) + (popup.suffix ?? ''), {\n\t\t\t\tstart: value.lastIndexOf(result[1] + result[2]),\n\t\t\t\tend: chat?.composer?.selection.start,\n\t\t\t});\n\t\t}\n\t\tsetPopup(undefined);\n\t\tsetFocused(undefined);\n\t});\n\n\tconst setConfigByInput = useMutableCallback((): ComposerBoxPopupOptions<T> | undefined => {\n\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\n\t\tif (!value) {\n\t\t\tsetPopup(undefined);\n\t\t\tsetFocused(undefined);\n\t\t\treturn;\n\t\t}\n\n\t\tconst configuration = configurations.find(({ trigger, matchSelectorRegex, triggerAnywhere, triggerLength }) => {\n\t\t\tconst selector =\n\t\t\t\tmatchSelectorRegex ?? (triggerAnywhere ? new RegExp(`(?:^| |\\n)(${trigger})[^\\\\s]*$`) : new RegExp(`(?:^)(${trigger})[^\\\\s]*$`));\n\t\t\tconst result = selector.test(value);\n\t\t\tif (!triggerLength || !result) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\tconst filter = value.match(selector);\n\t\t\treturn filter && triggerLength < filter[0].length;\n\t\t});\n\t\tsetPopup(configuration);\n\t\tif (!configuration) {\n\t\t\tsetFocused(undefined);\n\t\t\tsetFilter('');\n\t\t}\n\n\t\tif (configuration) {\n\t\t\tconst selector =\n\t\t\t\tconfiguration.matchSelectorRegex ??\n\t\t\t\t(configuration.triggerAnywhere\n\t\t\t\t\t? new RegExp(`(?:^| |\\n)(${configuration.trigger})([^\\\\s]*$)`)\n\t\t\t\t\t: new RegExp(`(?:^)(${configuration.trigger})([^\\\\s]*$)`));\n\t\t\tconst result = value.match(selector);\n\t\t\tsetFilter(commandsRef.current?.getFilter?.() ?? (result ? result[2] : ''));\n\t\t}\n\t\treturn configuration;\n\t});\n\n\tconst onFocus = useMutableCallback(() => {\n\t\tif (popup) {\n\t\t\treturn;\n\t\t}\n\t\tsetConfigByInput();\n\t});\n\n\tconst keyup = useMutableCallback((event: KeyboardEvent) => {\n\t\tif (!setConfigByInput()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (popup.closeOnEsc === true && event.which === keys.ESC) {\n\t\t\tsetPopup(undefined);\n\t\t\tsetFocused(undefined);\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t}\n\t});\n\n\tconst keydown = useMutableCallback((event: KeyboardEvent) => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.which === keys.ENTER || event.which === keys.TAB) {\n\t\t\tif (!focused) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tselect(focused);\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t\tif (event.which === keys.ARROW_UP && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n\t\t\tsetFocused((focused) => {\n\t\t\t\tconst list = items\n\t\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\n\t\t\t\tif (!list) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst focusedIndex = list.findIndex((item) => item === focused);\n\n\t\t\t\treturn (focusedIndex > 0 ? list[focusedIndex - 1] : list[list.length - 1]) as T;\n\t\t\t});\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t\tif (event.which === keys.ARROW_DOWN && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n\t\t\tsetFocused((focused) => {\n\t\t\t\tconst list = items\n\t\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\n\t\t\t\tif (!list) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst focusedIndex = list.findIndex((item) => item === focused);\n\n\t\t\t\treturn (focusedIndex < list.length - 1 ? list[focusedIndex + 1] : list[0]) as T;\n\t\t\t});\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t});\n\n\tconst clearPopup = useMutableCallback(() => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetPopup(undefined);\n\t\tsetFocused(undefined);\n\t\tsetFilter('');\n\t});\n\n\tconst callbackRef = useCallback(\n\t\t(node: HTMLElement | null) => {\n\t\t\tif (!node) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnode.addEventListener('keyup', keyup);\n\t\t\tnode.addEventListener('keydown', keydown);\n\t\t\tnode.addEventListener('focus', onFocus);\n\t\t},\n\t\t[keyup, keydown, onFocus],\n\t);\n\n\tif (!popup) {\n\t\treturn {\n\t\t\tcallbackRef,\n\t\t\tfocused: undefined,\n\t\t\titems: undefined,\n\t\t\tariaActiveDescendant: undefined,\n\t\t\tpopup: undefined,\n\t\t\tselect: undefined,\n\t\t\tsuspended: true,\n\t\t\tcommandsRef,\n\t\t\tfilter: undefined,\n\t\t\tclearPopup,\n\t\t};\n\t}\n\n\treturn {\n\t\tfocused,\n\t\titems,\n\t\tariaActiveDescendant,\n\t\tpopup,\n\t\tselect,\n\t\tfilter,\n\t\tsuspended,\n\t\tcommandsRef,\n\t\tcallbackRef,\n\t\tclearPopup,\n\t};\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/composer/hooks/useComposerBoxPopup.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/room/composer/hooks/useComposerBoxPopup.ts","inputSourceMap":{"version":3,"file":"client/views/room/composer/hooks/useComposerBoxPopup.ts","sourceRoot":"","sources":["client/views/room/composer/hooks/useComposerBoxPopup.ts"],"names":[],"mappings":"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","sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport type { UseQueryResult } from '@tanstack/react-query';\nimport type { MutableRefObject } from 'react';\nimport { useEffect, useCallback, useState, useRef } from 'react';\n\nimport { useChat } from '../../contexts/ChatContext';\nimport type { ComposerPopupOption } from '../../contexts/ComposerPopupContext';\nimport { useComposerBoxPopupQueries } from './useComposerBoxPopupQueries';\n\ntype ComposerBoxPopupImperativeCommands<T> = MutableRefObject<\n\t| {\n\t\t\tgetFilter?: () => unknown;\n\t\t\tselect?: (s: T) => void;\n\t  }\n\t| undefined\n>;\n\ntype ComposerBoxPopupOptions<T extends { _id: string; sort?: number | undefined }> = ComposerPopupOption<T>;\n\ntype ComposerBoxPopupResult<T extends { _id: string; sort?: number }> =\n\t| {\n\t\t\tpopup: ComposerPopupOption<T>;\n\t\t\titems: UseQueryResult<T[]>[];\n\t\t\tfocused: T | undefined;\n\t\t\tariaActiveDescendant: string | undefined;\n\t\t\tselect: (item: T) => void;\n\t\t\tcallbackRef: (node: HTMLElement) => void;\n\t\t\tcommandsRef: ComposerBoxPopupImperativeCommands<T>;\n\t\t\tsuspended: boolean;\n\t\t\tfilter: unknown;\n\t\t\tclearPopup: () => void;\n\t  }\n\t| {\n\t\t\tpopup: undefined;\n\t\t\titems: undefined;\n\t\t\tfocused: undefined;\n\t\t\tariaActiveDescendant: undefined;\n\t\t\tcallbackRef: (node: HTMLElement) => void;\n\t\t\tselect: undefined;\n\t\t\tcommandsRef: ComposerBoxPopupImperativeCommands<T>;\n\t\t\tsuspended: boolean;\n\t\t\tfilter: unknown;\n\t\t\tclearPopup: () => void;\n\t  };\n\nconst keys = {\n\tTAB: 9,\n\tENTER: 13,\n\tESC: 27,\n\tARROW_LEFT: 37,\n\tARROW_UP: 38,\n\tARROW_RIGHT: 39,\n\tARROW_DOWN: 40,\n};\n\nexport const useComposerBoxPopup = <T extends { _id: string; sort?: number }>({\n\tconfigurations,\n}: {\n\tconfigurations: ComposerBoxPopupOptions<T>[];\n}): ComposerBoxPopupResult<T> => {\n\tconst [popup, setPopup] = useState<ComposerBoxPopupOptions<T> | undefined>(undefined);\n\tconst [focused, setFocused] = useState<T | undefined>(undefined);\n\tconst [filter, setFilter] = useState<unknown>('');\n\n\tconst commandsRef: ComposerBoxPopupImperativeCommands<T> = useRef();\n\n\tconst { queries: items, suspended } = useComposerBoxPopupQueries(filter, popup) as {\n\t\tqueries: UseQueryResult<T[]>[];\n\t\tsuspended: boolean;\n\t};\n\n\tconst chat = useChat();\n\n\tconst ariaActiveDescendant = focused ? `popup-item-${focused._id}` : undefined;\n\n\tuseEffect(() => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (popup?.preview && suspended) {\n\t\t\tsetFocused(undefined);\n\t\t\treturn;\n\t\t}\n\t\tsetFocused((focused) => {\n\t\t\tconst sortedItems = items\n\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\t\t\treturn sortedItems.find((item) => item._id === focused?._id) ?? sortedItems[0];\n\t\t});\n\t}, [items, popup, suspended]);\n\n\tconst select = useMutableCallback((item: T) => {\n\t\tif (!popup) {\n\t\t\tthrow new Error('No popup is open');\n\t\t}\n\n\t\tif (commandsRef.current?.select) {\n\t\t\tcommandsRef.current.select(item);\n\t\t} else {\n\t\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\t\t\tconst selector =\n\t\t\t\tpopup.matchSelectorRegex ??\n\t\t\t\t(popup.triggerAnywhere ? new RegExp(`(?:^| |\\n)(${popup.trigger})([^\\\\s]*$)`) : new RegExp(`(?:^)(${popup.trigger})([^\\\\s]*$)`));\n\n\t\t\tconst result = value?.match(selector);\n\t\t\tif (!result || !value) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tchat?.composer?.replaceText((popup.prefix ?? popup.trigger ?? '') + popup.getValue(item) + (popup.suffix ?? ''), {\n\t\t\t\tstart: value.lastIndexOf(result[1] + result[2]),\n\t\t\t\tend: chat?.composer?.selection.start,\n\t\t\t});\n\t\t}\n\t\tsetPopup(undefined);\n\t\tsetFocused(undefined);\n\t});\n\n\tconst setConfigByInput = useMutableCallback((): ComposerBoxPopupOptions<T> | undefined => {\n\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\n\t\tif (!value) {\n\t\t\tsetPopup(undefined);\n\t\t\tsetFocused(undefined);\n\t\t\treturn;\n\t\t}\n\n\t\tconst configuration = configurations.find(({ trigger, matchSelectorRegex, triggerAnywhere, triggerLength }) => {\n\t\t\tconst selector =\n\t\t\t\tmatchSelectorRegex ?? (triggerAnywhere ? new RegExp(`(?:^| |\\n)(${trigger})[^\\\\s]*$`) : new RegExp(`(?:^)(${trigger})[^\\\\s]*$`));\n\t\t\tconst result = selector.test(value);\n\t\t\tif (!triggerLength || !result) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\tconst filter = value.match(selector);\n\t\t\treturn filter && triggerLength < filter[0].length;\n\t\t});\n\t\tsetPopup(configuration);\n\t\tif (!configuration) {\n\t\t\tsetFocused(undefined);\n\t\t\tsetFilter('');\n\t\t}\n\n\t\tif (configuration) {\n\t\t\tconst selector =\n\t\t\t\tconfiguration.matchSelectorRegex ??\n\t\t\t\t(configuration.triggerAnywhere\n\t\t\t\t\t? new RegExp(`(?:^| |\\n)(${configuration.trigger})([^\\\\s]*$)`)\n\t\t\t\t\t: new RegExp(`(?:^)(${configuration.trigger})([^\\\\s]*$)`));\n\t\t\tconst result = value.match(selector);\n\t\t\tsetFilter(commandsRef.current?.getFilter?.() ?? (result ? result[2] : ''));\n\t\t}\n\t\treturn configuration;\n\t});\n\n\tconst onFocus = useMutableCallback(() => {\n\t\tif (popup) {\n\t\t\treturn;\n\t\t}\n\t\tsetConfigByInput();\n\t});\n\n\tconst keyup = useMutableCallback((event: KeyboardEvent) => {\n\t\tif (!setConfigByInput()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (popup.closeOnEsc === true && event.which === keys.ESC) {\n\t\t\tsetPopup(undefined);\n\t\t\tsetFocused(undefined);\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t}\n\t});\n\n\tconst keydown = useMutableCallback((event: KeyboardEvent) => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.which === keys.ENTER || event.which === keys.TAB) {\n\t\t\tif (!focused) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tselect(focused);\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t\tif (event.which === keys.ARROW_UP && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n\t\t\tsetFocused((focused) => {\n\t\t\t\tconst list = items\n\t\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\n\t\t\t\tif (!list) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst focusedIndex = list.findIndex((item) => item === focused);\n\n\t\t\t\treturn (focusedIndex > 0 ? list[focusedIndex - 1] : list[list.length - 1]) as T;\n\t\t\t});\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t\tif (event.which === keys.ARROW_DOWN && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n\t\t\tsetFocused((focused) => {\n\t\t\t\tconst list = items\n\t\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\n\t\t\t\tif (!list) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst focusedIndex = list.findIndex((item) => item === focused);\n\n\t\t\t\treturn (focusedIndex < list.length - 1 ? list[focusedIndex + 1] : list[0]) as T;\n\t\t\t});\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t});\n\n\tconst clearPopup = useMutableCallback(() => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetPopup(undefined);\n\t\tsetFocused(undefined);\n\t\tsetFilter('');\n\t});\n\n\tconst callbackRef = useCallback(\n\t\t(node: HTMLElement | null) => {\n\t\t\tif (!node) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnode.addEventListener('keyup', keyup);\n\t\t\tnode.addEventListener('keydown', keydown);\n\t\t\tnode.addEventListener('focus', onFocus);\n\t\t},\n\t\t[keyup, keydown, onFocus],\n\t);\n\n\tif (!popup) {\n\t\treturn {\n\t\t\tcallbackRef,\n\t\t\tfocused: undefined,\n\t\t\titems: undefined,\n\t\t\tariaActiveDescendant: undefined,\n\t\t\tpopup: undefined,\n\t\t\tselect: undefined,\n\t\t\tsuspended: true,\n\t\t\tcommandsRef,\n\t\t\tfilter: undefined,\n\t\t\tclearPopup,\n\t\t};\n\t}\n\n\treturn {\n\t\tfocused,\n\t\titems,\n\t\tariaActiveDescendant,\n\t\tpopup,\n\t\tselect,\n\t\tfilter,\n\t\tsuspended,\n\t\tcommandsRef,\n\t\tcallbackRef,\n\t\tclearPopup,\n\t};\n};\n"]}}},"code":"var _slicedToArray;\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 0);\nmodule.export({\n  useComposerBoxPopup: function () {\n    return useComposerBoxPopup;\n  }\n});\nvar useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback: function (v) {\n    useMutableCallback = v;\n  }\n}, 0);\nvar useEffect, useCallback, useState, useRef;\nmodule.link(\"react\", {\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useCallback: function (v) {\n    useCallback = v;\n  },\n  useState: function (v) {\n    useState = v;\n  },\n  useRef: function (v) {\n    useRef = v;\n  }\n}, 1);\nvar useChat;\nmodule.link(\"../../contexts/ChatContext\", {\n  useChat: function (v) {\n    useChat = v;\n  }\n}, 2);\nvar useComposerBoxPopupQueries;\nmodule.link(\"./useComposerBoxPopupQueries\", {\n  useComposerBoxPopupQueries: function (v) {\n    useComposerBoxPopupQueries = v;\n  }\n}, 3);\nvar keys = {\n  TAB: 9,\n  ENTER: 13,\n  ESC: 27,\n  ARROW_LEFT: 37,\n  ARROW_UP: 38,\n  ARROW_RIGHT: 39,\n  ARROW_DOWN: 40\n};\nvar useComposerBoxPopup = function (_ref) {\n  var configurations = _ref.configurations;\n  var _useState = useState(undefined),\n    _useState2 = _slicedToArray(_useState, 2),\n    popup = _useState2[0],\n    setPopup = _useState2[1];\n  var _useState3 = useState(undefined),\n    _useState4 = _slicedToArray(_useState3, 2),\n    focused = _useState4[0],\n    setFocused = _useState4[1];\n  var _useState5 = useState(''),\n    _useState6 = _slicedToArray(_useState5, 2),\n    filter = _useState6[0],\n    setFilter = _useState6[1];\n  var commandsRef = useRef();\n  var _useComposerBoxPopupQ = useComposerBoxPopupQueries(filter, popup),\n    items = _useComposerBoxPopupQ.queries,\n    suspended = _useComposerBoxPopupQ.suspended;\n  var chat = useChat();\n  var ariaActiveDescendant = focused ? \"popup-item-\" + focused._id : undefined;\n  useEffect(function () {\n    if (!popup) {\n      return;\n    }\n    if (popup !== null && popup !== void 0 && popup.preview && suspended) {\n      setFocused(undefined);\n      return;\n    }\n    setFocused(function (focused) {\n      var _sortedItems$find;\n      var sortedItems = items.filter(function (item) {\n        return item.isSuccess;\n      }).flatMap(function (item) {\n        return item.data;\n      }).sort(function (a, b) {\n        return ('sort' in a && a.sort || 0) - ('sort' in b && b.sort || 0);\n      });\n      return (_sortedItems$find = sortedItems.find(function (item) {\n        return item._id === (focused === null || focused === void 0 ? void 0 : focused._id);\n      })) !== null && _sortedItems$find !== void 0 ? _sortedItems$find : sortedItems[0];\n    });\n  }, [items, popup, suspended]);\n  var select = useMutableCallback(function (item) {\n    var _commandsRef$current;\n    if (!popup) {\n      throw new Error('No popup is open');\n    }\n    if ((_commandsRef$current = commandsRef.current) !== null && _commandsRef$current !== void 0 && _commandsRef$current.select) {\n      commandsRef.current.select(item);\n    } else {\n      var _chat$composer, _chat$composer2, _popup$matchSelectorR, _chat$composer3, _ref2, _popup$prefix, _popup$suffix, _chat$composer4;\n      var value = chat === null || chat === void 0 ? void 0 : (_chat$composer = chat.composer) === null || _chat$composer === void 0 ? void 0 : _chat$composer.substring(0, chat === null || chat === void 0 ? void 0 : (_chat$composer2 = chat.composer) === null || _chat$composer2 === void 0 ? void 0 : _chat$composer2.selection.start);\n      var selector = (_popup$matchSelectorR = popup.matchSelectorRegex) !== null && _popup$matchSelectorR !== void 0 ? _popup$matchSelectorR : popup.triggerAnywhere ? new RegExp(\"(?:^| |\\n)(\" + popup.trigger + \")([^\\\\s]*$)\") : new RegExp(\"(?:^)(\" + popup.trigger + \")([^\\\\s]*$)\");\n      var result = value === null || value === void 0 ? void 0 : value.match(selector);\n      if (!result || !value) {\n        return;\n      }\n      chat === null || chat === void 0 ? void 0 : (_chat$composer3 = chat.composer) === null || _chat$composer3 === void 0 ? void 0 : _chat$composer3.replaceText(((_ref2 = (_popup$prefix = popup.prefix) !== null && _popup$prefix !== void 0 ? _popup$prefix : popup.trigger) !== null && _ref2 !== void 0 ? _ref2 : '') + popup.getValue(item) + ((_popup$suffix = popup.suffix) !== null && _popup$suffix !== void 0 ? _popup$suffix : ''), {\n        start: value.lastIndexOf(result[1] + result[2]),\n        end: chat === null || chat === void 0 ? void 0 : (_chat$composer4 = chat.composer) === null || _chat$composer4 === void 0 ? void 0 : _chat$composer4.selection.start\n      });\n    }\n    setPopup(undefined);\n    setFocused(undefined);\n  });\n  var setConfigByInput = useMutableCallback(function () {\n    var _chat$composer5, _chat$composer6;\n    var value = chat === null || chat === void 0 ? void 0 : (_chat$composer5 = chat.composer) === null || _chat$composer5 === void 0 ? void 0 : _chat$composer5.substring(0, chat === null || chat === void 0 ? void 0 : (_chat$composer6 = chat.composer) === null || _chat$composer6 === void 0 ? void 0 : _chat$composer6.selection.start);\n    if (!value) {\n      setPopup(undefined);\n      setFocused(undefined);\n      return;\n    }\n    var configuration = configurations.find(function (_ref3) {\n      var trigger = _ref3.trigger,\n        matchSelectorRegex = _ref3.matchSelectorRegex,\n        triggerAnywhere = _ref3.triggerAnywhere,\n        triggerLength = _ref3.triggerLength;\n      var selector = matchSelectorRegex !== null && matchSelectorRegex !== void 0 ? matchSelectorRegex : triggerAnywhere ? new RegExp(\"(?:^| |\\n)(\" + trigger + \")[^\\\\s]*$\") : new RegExp(\"(?:^)(\" + trigger + \")[^\\\\s]*$\");\n      var result = selector.test(value);\n      if (!triggerLength || !result) {\n        return result;\n      }\n      var filter = value.match(selector);\n      return filter && triggerLength < filter[0].length;\n    });\n    setPopup(configuration);\n    if (!configuration) {\n      setFocused(undefined);\n      setFilter('');\n    }\n    if (configuration) {\n      var _configuration$matchS, _commandsRef$current$, _commandsRef$current2, _commandsRef$current3;\n      var selector = (_configuration$matchS = configuration.matchSelectorRegex) !== null && _configuration$matchS !== void 0 ? _configuration$matchS : configuration.triggerAnywhere ? new RegExp(\"(?:^| |\\n)(\" + configuration.trigger + \")([^\\\\s]*$)\") : new RegExp(\"(?:^)(\" + configuration.trigger + \")([^\\\\s]*$)\");\n      var result = value.match(selector);\n      setFilter((_commandsRef$current$ = (_commandsRef$current2 = commandsRef.current) === null || _commandsRef$current2 === void 0 ? void 0 : (_commandsRef$current3 = _commandsRef$current2.getFilter) === null || _commandsRef$current3 === void 0 ? void 0 : _commandsRef$current3.call(_commandsRef$current2)) !== null && _commandsRef$current$ !== void 0 ? _commandsRef$current$ : result ? result[2] : '');\n    }\n    return configuration;\n  });\n  var onFocus = useMutableCallback(function () {\n    if (popup) {\n      return;\n    }\n    setConfigByInput();\n  });\n  var keyup = useMutableCallback(function (event) {\n    if (!setConfigByInput()) {\n      return;\n    }\n    if (!popup) {\n      return;\n    }\n    if (popup.closeOnEsc === true && event.which === keys.ESC) {\n      setPopup(undefined);\n      setFocused(undefined);\n      event.preventDefault();\n      event.stopImmediatePropagation();\n    }\n  });\n  var keydown = useMutableCallback(function (event) {\n    if (!popup) {\n      return;\n    }\n    if (event.which === keys.ENTER || event.which === keys.TAB) {\n      if (!focused) {\n        return;\n      }\n      select(focused);\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      return true;\n    }\n    if (event.which === keys.ARROW_UP && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n      setFocused(function (focused) {\n        var list = items.filter(function (item) {\n          return item.isSuccess;\n        }).flatMap(function (item) {\n          return item.data;\n        }).sort(function (a, b) {\n          return ('sort' in a && a.sort || 0) - ('sort' in b && b.sort || 0);\n        });\n        if (!list) {\n          return;\n        }\n        var focusedIndex = list.findIndex(function (item) {\n          return item === focused;\n        });\n        return focusedIndex > 0 ? list[focusedIndex - 1] : list[list.length - 1];\n      });\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      return true;\n    }\n    if (event.which === keys.ARROW_DOWN && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n      setFocused(function (focused) {\n        var list = items.filter(function (item) {\n          return item.isSuccess;\n        }).flatMap(function (item) {\n          return item.data;\n        }).sort(function (a, b) {\n          return ('sort' in a && a.sort || 0) - ('sort' in b && b.sort || 0);\n        });\n        if (!list) {\n          return undefined;\n        }\n        var focusedIndex = list.findIndex(function (item) {\n          return item === focused;\n        });\n        return focusedIndex < list.length - 1 ? list[focusedIndex + 1] : list[0];\n      });\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      return true;\n    }\n  });\n  var clearPopup = useMutableCallback(function () {\n    if (!popup) {\n      return;\n    }\n    setPopup(undefined);\n    setFocused(undefined);\n    setFilter('');\n  });\n  var callbackRef = useCallback(function (node) {\n    if (!node) {\n      return;\n    }\n    node.addEventListener('keyup', keyup);\n    node.addEventListener('keydown', keydown);\n    node.addEventListener('focus', onFocus);\n  }, [keyup, keydown, onFocus]);\n  if (!popup) {\n    return {\n      callbackRef: callbackRef,\n      focused: undefined,\n      items: undefined,\n      ariaActiveDescendant: undefined,\n      popup: undefined,\n      select: undefined,\n      suspended: true,\n      commandsRef: commandsRef,\n      filter: undefined,\n      clearPopup: clearPopup\n    };\n  }\n  return {\n    focused: focused,\n    items: items,\n    ariaActiveDescendant: ariaActiveDescendant,\n    popup: popup,\n    select: select,\n    filter: filter,\n    suspended: suspended,\n    commandsRef: commandsRef,\n    callbackRef: callbackRef,\n    clearPopup: clearPopup\n  };\n};","map":{"version":3,"names":["_slicedToArray","module","link","default","v","export","useComposerBoxPopup","useMutableCallback","useEffect","useCallback","useState","useRef","useChat","useComposerBoxPopupQueries","keys","TAB","ENTER","ESC","ARROW_LEFT","ARROW_UP","ARROW_RIGHT","ARROW_DOWN","_ref","configurations","_useState","undefined","_useState2","popup","setPopup","_useState3","_useState4","focused","setFocused","_useState5","_useState6","filter","setFilter","commandsRef","_useComposerBoxPopupQ","items","queries","suspended","chat","ariaActiveDescendant","_id","preview","_sortedItems$find","sortedItems","item","isSuccess","flatMap","data","sort","a","b","find","select","_commandsRef$current","Error","current","_chat$composer","_chat$composer2","_popup$matchSelectorR","_chat$composer3","_ref2","_popup$prefix","_popup$suffix","_chat$composer4","value","composer","substring","selection","start","selector","matchSelectorRegex","triggerAnywhere","RegExp","trigger","result","match","replaceText","prefix","getValue","suffix","lastIndexOf","end","setConfigByInput","_chat$composer5","_chat$composer6","configuration","_ref3","triggerLength","test","length","_configuration$matchS","_commandsRef$current$","_commandsRef$current2","_commandsRef$current3","getFilter","call","onFocus","keyup","event","closeOnEsc","which","preventDefault","stopImmediatePropagation","keydown","shiftKey","ctrlKey","altKey","metaKey","list","focusedIndex","findIndex","clearPopup","callbackRef","node","addEventListener"],"sources":["client/views/room/composer/hooks/useComposerBoxPopup.ts"],"sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport type { UseQueryResult } from '@tanstack/react-query';\nimport type { MutableRefObject } from 'react';\nimport { useEffect, useCallback, useState, useRef } from 'react';\n\nimport { useChat } from '../../contexts/ChatContext';\nimport type { ComposerPopupOption } from '../../contexts/ComposerPopupContext';\nimport { useComposerBoxPopupQueries } from './useComposerBoxPopupQueries';\n\ntype ComposerBoxPopupImperativeCommands<T> = MutableRefObject<\n\t| {\n\t\t\tgetFilter?: () => unknown;\n\t\t\tselect?: (s: T) => void;\n\t  }\n\t| undefined\n>;\n\ntype ComposerBoxPopupOptions<T extends { _id: string; sort?: number | undefined }> = ComposerPopupOption<T>;\n\ntype ComposerBoxPopupResult<T extends { _id: string; sort?: number }> =\n\t| {\n\t\t\tpopup: ComposerPopupOption<T>;\n\t\t\titems: UseQueryResult<T[]>[];\n\t\t\tfocused: T | undefined;\n\t\t\tariaActiveDescendant: string | undefined;\n\t\t\tselect: (item: T) => void;\n\t\t\tcallbackRef: (node: HTMLElement) => void;\n\t\t\tcommandsRef: ComposerBoxPopupImperativeCommands<T>;\n\t\t\tsuspended: boolean;\n\t\t\tfilter: unknown;\n\t\t\tclearPopup: () => void;\n\t  }\n\t| {\n\t\t\tpopup: undefined;\n\t\t\titems: undefined;\n\t\t\tfocused: undefined;\n\t\t\tariaActiveDescendant: undefined;\n\t\t\tcallbackRef: (node: HTMLElement) => void;\n\t\t\tselect: undefined;\n\t\t\tcommandsRef: ComposerBoxPopupImperativeCommands<T>;\n\t\t\tsuspended: boolean;\n\t\t\tfilter: unknown;\n\t\t\tclearPopup: () => void;\n\t  };\n\nconst keys = {\n\tTAB: 9,\n\tENTER: 13,\n\tESC: 27,\n\tARROW_LEFT: 37,\n\tARROW_UP: 38,\n\tARROW_RIGHT: 39,\n\tARROW_DOWN: 40,\n};\n\nexport const useComposerBoxPopup = <T extends { _id: string; sort?: number }>({\n\tconfigurations,\n}: {\n\tconfigurations: ComposerBoxPopupOptions<T>[];\n}): ComposerBoxPopupResult<T> => {\n\tconst [popup, setPopup] = useState<ComposerBoxPopupOptions<T> | undefined>(undefined);\n\tconst [focused, setFocused] = useState<T | undefined>(undefined);\n\tconst [filter, setFilter] = useState<unknown>('');\n\n\tconst commandsRef: ComposerBoxPopupImperativeCommands<T> = useRef();\n\n\tconst { queries: items, suspended } = useComposerBoxPopupQueries(filter, popup) as {\n\t\tqueries: UseQueryResult<T[]>[];\n\t\tsuspended: boolean;\n\t};\n\n\tconst chat = useChat();\n\n\tconst ariaActiveDescendant = focused ? `popup-item-${focused._id}` : undefined;\n\n\tuseEffect(() => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (popup?.preview && suspended) {\n\t\t\tsetFocused(undefined);\n\t\t\treturn;\n\t\t}\n\t\tsetFocused((focused) => {\n\t\t\tconst sortedItems = items\n\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\t\t\treturn sortedItems.find((item) => item._id === focused?._id) ?? sortedItems[0];\n\t\t});\n\t}, [items, popup, suspended]);\n\n\tconst select = useMutableCallback((item: T) => {\n\t\tif (!popup) {\n\t\t\tthrow new Error('No popup is open');\n\t\t}\n\n\t\tif (commandsRef.current?.select) {\n\t\t\tcommandsRef.current.select(item);\n\t\t} else {\n\t\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\t\t\tconst selector =\n\t\t\t\tpopup.matchSelectorRegex ??\n\t\t\t\t(popup.triggerAnywhere ? new RegExp(`(?:^| |\\n)(${popup.trigger})([^\\\\s]*$)`) : new RegExp(`(?:^)(${popup.trigger})([^\\\\s]*$)`));\n\n\t\t\tconst result = value?.match(selector);\n\t\t\tif (!result || !value) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tchat?.composer?.replaceText((popup.prefix ?? popup.trigger ?? '') + popup.getValue(item) + (popup.suffix ?? ''), {\n\t\t\t\tstart: value.lastIndexOf(result[1] + result[2]),\n\t\t\t\tend: chat?.composer?.selection.start,\n\t\t\t});\n\t\t}\n\t\tsetPopup(undefined);\n\t\tsetFocused(undefined);\n\t});\n\n\tconst setConfigByInput = useMutableCallback((): ComposerBoxPopupOptions<T> | undefined => {\n\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\n\t\tif (!value) {\n\t\t\tsetPopup(undefined);\n\t\t\tsetFocused(undefined);\n\t\t\treturn;\n\t\t}\n\n\t\tconst configuration = configurations.find(({ trigger, matchSelectorRegex, triggerAnywhere, triggerLength }) => {\n\t\t\tconst selector =\n\t\t\t\tmatchSelectorRegex ?? (triggerAnywhere ? new RegExp(`(?:^| |\\n)(${trigger})[^\\\\s]*$`) : new RegExp(`(?:^)(${trigger})[^\\\\s]*$`));\n\t\t\tconst result = selector.test(value);\n\t\t\tif (!triggerLength || !result) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\tconst filter = value.match(selector);\n\t\t\treturn filter && triggerLength < filter[0].length;\n\t\t});\n\t\tsetPopup(configuration);\n\t\tif (!configuration) {\n\t\t\tsetFocused(undefined);\n\t\t\tsetFilter('');\n\t\t}\n\n\t\tif (configuration) {\n\t\t\tconst selector =\n\t\t\t\tconfiguration.matchSelectorRegex ??\n\t\t\t\t(configuration.triggerAnywhere\n\t\t\t\t\t? new RegExp(`(?:^| |\\n)(${configuration.trigger})([^\\\\s]*$)`)\n\t\t\t\t\t: new RegExp(`(?:^)(${configuration.trigger})([^\\\\s]*$)`));\n\t\t\tconst result = value.match(selector);\n\t\t\tsetFilter(commandsRef.current?.getFilter?.() ?? (result ? result[2] : ''));\n\t\t}\n\t\treturn configuration;\n\t});\n\n\tconst onFocus = useMutableCallback(() => {\n\t\tif (popup) {\n\t\t\treturn;\n\t\t}\n\t\tsetConfigByInput();\n\t});\n\n\tconst keyup = useMutableCallback((event: KeyboardEvent) => {\n\t\tif (!setConfigByInput()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (popup.closeOnEsc === true && event.which === keys.ESC) {\n\t\t\tsetPopup(undefined);\n\t\t\tsetFocused(undefined);\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t}\n\t});\n\n\tconst keydown = useMutableCallback((event: KeyboardEvent) => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.which === keys.ENTER || event.which === keys.TAB) {\n\t\t\tif (!focused) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tselect(focused);\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t\tif (event.which === keys.ARROW_UP && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n\t\t\tsetFocused((focused) => {\n\t\t\t\tconst list = items\n\t\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\n\t\t\t\tif (!list) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst focusedIndex = list.findIndex((item) => item === focused);\n\n\t\t\t\treturn (focusedIndex > 0 ? list[focusedIndex - 1] : list[list.length - 1]) as T;\n\t\t\t});\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t\tif (event.which === keys.ARROW_DOWN && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n\t\t\tsetFocused((focused) => {\n\t\t\t\tconst list = items\n\t\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\n\t\t\t\tif (!list) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst focusedIndex = list.findIndex((item) => item === focused);\n\n\t\t\t\treturn (focusedIndex < list.length - 1 ? list[focusedIndex + 1] : list[0]) as T;\n\t\t\t});\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t});\n\n\tconst clearPopup = useMutableCallback(() => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetPopup(undefined);\n\t\tsetFocused(undefined);\n\t\tsetFilter('');\n\t});\n\n\tconst callbackRef = useCallback(\n\t\t(node: HTMLElement | null) => {\n\t\t\tif (!node) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnode.addEventListener('keyup', keyup);\n\t\t\tnode.addEventListener('keydown', keydown);\n\t\t\tnode.addEventListener('focus', onFocus);\n\t\t},\n\t\t[keyup, keydown, onFocus],\n\t);\n\n\tif (!popup) {\n\t\treturn {\n\t\t\tcallbackRef,\n\t\t\tfocused: undefined,\n\t\t\titems: undefined,\n\t\t\tariaActiveDescendant: undefined,\n\t\t\tpopup: undefined,\n\t\t\tselect: undefined,\n\t\t\tsuspended: true,\n\t\t\tcommandsRef,\n\t\t\tfilter: undefined,\n\t\t\tclearPopup,\n\t\t};\n\t}\n\n\treturn {\n\t\tfocused,\n\t\titems,\n\t\tariaActiveDescendant,\n\t\tpopup,\n\t\tselect,\n\t\tfilter,\n\t\tsuspended,\n\t\tcommandsRef,\n\t\tcallbackRef,\n\t\tclearPopup,\n\t};\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"d6090206edf9d1ad28ea7d2f1f128f2a47e5e8ae"}
