{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/composer/hooks/useComposerBoxPopup.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/room/composer/hooks/useComposerBoxPopup.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/composer/hooks/useComposerBoxPopup.ts","inputSourceMap":{"version":3,"file":"client/views/room/composer/hooks/useComposerBoxPopup.ts","sourceRoot":"","sources":["client/views/room/composer/hooks/useComposerBoxPopup.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,kBAAkB,EAAE,MAAM,6BAA6B,CAAC;AAGjE,OAAO,EAAE,SAAS,EAAE,WAAW,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,OAAO,CAAC;AAEjE,OAAO,EAAE,0BAA0B,EAAE,MAAM,8BAA8B,CAAC;AAC1E,OAAO,EAAE,OAAO,EAAE,MAAM,4BAA4B,CAAC;AAuCrD,MAAM,IAAI,GAAG;IACZ,GAAG,EAAE,CAAC;IACN,KAAK,EAAE,EAAE;IACT,GAAG,EAAE,EAAE;IACP,UAAU,EAAE,EAAE;IACd,QAAQ,EAAE,EAAE;IACZ,WAAW,EAAE,EAAE;IACf,UAAU,EAAE,EAAE;CACd,CAAC;AAEF,MAAM,CAAC,MAAM,mBAAmB,GAAG,CAA2C,EAC7E,cAAc,GAGd,EAA6B,EAAE;IAC/B,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,GAAG,QAAQ,CAAyC,SAAS,CAAC,CAAC;IACtF,MAAM,CAAC,OAAO,EAAE,UAAU,CAAC,GAAG,QAAQ,CAAgB,SAAS,CAAC,CAAC;IACjE,MAAM,CAAC,MAAM,EAAE,SAAS,CAAC,GAAG,QAAQ,CAAU,EAAE,CAAC,CAAC;IAElD,MAAM,WAAW,GAA0C,MAAM,EAAE,CAAC;IAEpE,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,0BAA0B,CAAC,MAAM,EAAE,KAAK,CAG7E,CAAC;IAEF,MAAM,IAAI,GAAG,OAAO,EAAE,CAAC;IAEvB,MAAM,oBAAoB,GAAG,OAAO,CAAC,CAAC,CAAC,cAAc,OAAO,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;IAE/E,SAAS,CAAC,GAAG,EAAE;QACd,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,OAAO;QACR,CAAC;QAED,IAAI,KAAK,EAAE,OAAO,IAAI,SAAS,EAAE,CAAC;YACjC,UAAU,CAAC,SAAS,CAAC,CAAC;YACtB,OAAO;QACR,CAAC;QACD,UAAU,CAAC,CAAC,OAAO,EAAE,EAAE;YACtB,MAAM,WAAW,GAAG,KAAK;iBACvB,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC;iBAChC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAW,CAAC;iBACnC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAClF,OAAO,WAAW,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,GAAG,KAAK,OAAO,EAAE,GAAG,CAAC,IAAI,WAAW,CAAC,CAAC,CAAC,CAAC;QAChF,CAAC,CAAC,CAAC;IACJ,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,EAAE,SAAS,CAAC,CAAC,CAAC;IAE9B,MAAM,MAAM,GAAG,kBAAkB,CAAC,CAAC,IAAO,EAAE,EAAE;QAC7C,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,MAAM,IAAI,KAAK,CAAC,kBAAkB,CAAC,CAAC;QACrC,CAAC;QAED,IAAI,WAAW,CAAC,OAAO,EAAE,MAAM,EAAE,CAAC;YACjC,WAAW,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAClC,CAAC;aAAM,CAAC;YACP,MAAM,KAAK,GAAG,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC,KAAK,CAAC,CAAC;YAC5E,MAAM,QAAQ,GACb,KAAK,CAAC,kBAAkB;gBACxB,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,cAAc,KAAK,CAAC,OAAO,aAAa,CAAC,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,SAAS,KAAK,CAAC,OAAO,aAAa,CAAC,CAAC,CAAC;YAElI,MAAM,MAAM,GAAG,KAAK,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC;YACtC,IAAI,CAAC,MAAM,IAAI,CAAC,KAAK,EAAE,CAAC;gBACvB,OAAO;YACR,CAAC;YAED,IAAI,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAC,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,OAAO,IAAI,EAAE,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,IAAI,EAAE,CAAC,EAAE;gBAChH,KAAK,EAAE,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;gBAC/C,GAAG,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC,KAAK;aACpC,CAAC,CAAC;QACJ,CAAC;QACD,QAAQ,CAAC,SAAS,CAAC,CAAC;QACpB,UAAU,CAAC,SAAS,CAAC,CAAC;IACvB,CAAC,CAAC,CAAC;IAEH,MAAM,gBAAgB,GAAG,kBAAkB,CAAC,GAA2C,EAAE;QACxF,MAAM,KAAK,GAAG,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC,KAAK,CAAC,CAAC;QAE5E,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,QAAQ,CAAC,SAAS,CAAC,CAAC;YACpB,UAAU,CAAC,SAAS,CAAC,CAAC;YACtB,OAAO;QACR,CAAC;QAED,MAAM,aAAa,GAAG,cAAc,CAAC,IAAI,CAAC,CAAC,EAAE,OAAO,EAAE,kBAAkB,EAAE,eAAe,EAAE,aAAa,EAAE,EAAE,EAAE;YAC7G,MAAM,QAAQ,GACb,kBAAkB,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,cAAc,OAAO,WAAW,CAAC,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,SAAS,OAAO,WAAW,CAAC,CAAC,CAAC;YAClI,MAAM,MAAM,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACpC,IAAI,CAAC,aAAa,IAAI,CAAC,MAAM,EAAE,CAAC;gBAC/B,OAAO,MAAM,CAAC;YACf,CAAC;YACD,MAAM,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;YACrC,OAAO,MAAM,IAAI,aAAa,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;QACnD,CAAC,CAAC,CAAC;QACH,QAAQ,CAAC,aAAa,CAAC,CAAC;QACxB,IAAI,CAAC,aAAa,EAAE,CAAC;YACpB,UAAU,CAAC,SAAS,CAAC,CAAC;YACtB,SAAS,CAAC,EAAE,CAAC,CAAC;QACf,CAAC;QAED,IAAI,aAAa,EAAE,CAAC;YACnB,MAAM,QAAQ,GACb,aAAa,CAAC,kBAAkB;gBAChC,CAAC,aAAa,CAAC,eAAe;oBAC7B,CAAC,CAAC,IAAI,MAAM,CAAC,cAAc,aAAa,CAAC,OAAO,aAAa,CAAC;oBAC9D,CAAC,CAAC,IAAI,MAAM,CAAC,SAAS,aAAa,CAAC,OAAO,aAAa,CAAC,CAAC,CAAC;YAC7D,MAAM,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;YACrC,SAAS,CAAC,WAAW,CAAC,OAAO,EAAE,SAAS,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC5E,CAAC;QACD,OAAO,aAAa,CAAC;IACtB,CAAC,CAAC,CAAC;IAEH,MAAM,OAAO,GAAG,kBAAkB,CAAC,GAAG,EAAE;QACvC,IAAI,KAAK,EAAE,CAAC;YACX,OAAO;QACR,CAAC;QACD,gBAAgB,EAAE,CAAC;IACpB,CAAC,CAAC,CAAC;IAEH,MAAM,KAAK,GAAG,kBAAkB,CAAC,CAAC,KAAoB,EAAE,EAAE;QACzD,IAAI,CAAC,gBAAgB,EAAE,EAAE,CAAC;YACzB,OAAO;QACR,CAAC;QAED,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,OAAO;QACR,CAAC;QAED,IAAI,KAAK,CAAC,UAAU,KAAK,IAAI,IAAI,KAAK,CAAC,KAAK,KAAK,IAAI,CAAC,GAAG,EAAE,CAAC;YAC3D,QAAQ,CAAC,SAAS,CAAC,CAAC;YACpB,UAAU,CAAC,SAAS,CAAC,CAAC;YACtB,KAAK,CAAC,cAAc,EAAE,CAAC;YACvB,KAAK,CAAC,wBAAwB,EAAE,CAAC;QAClC,CAAC;IACF,CAAC,CAAC,CAAC;IAEH,MAAM,OAAO,GAAG,kBAAkB,CAAC,CAAC,KAAoB,EAAE,EAAE;QAC3D,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,OAAO;QACR,CAAC;QAED,IAAI,KAAK,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,KAAK,IAAI,CAAC,GAAG,EAAE,CAAC;YAC5D,IAAI,CAAC,OAAO,EAAE,CAAC;gBACd,OAAO;YACR,CAAC;YAED,MAAM,CAAC,OAAO,CAAC,CAAC;YAEhB,KAAK,CAAC,cAAc,EAAE,CAAC;YACvB,KAAK,CAAC,wBAAwB,EAAE,CAAC;YACjC,OAAO,IAAI,CAAC;QACb,CAAC;QACD,IAAI,KAAK,CAAC,KAAK,KAAK,IAAI,CAAC,QAAQ,IAAI,CAAC,CAAC,KAAK,CAAC,QAAQ,IAAI,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,OAAO,CAAC,EAAE,CAAC;YAC1G,UAAU,CAAC,CAAC,OAAO,EAAE,EAAE;gBACtB,MAAM,IAAI,GAAG,KAAK;qBAChB,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC;qBAChC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAW,CAAC;qBACnC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gBAElF,IAAI,CAAC,IAAI,EAAE,CAAC;oBACX,OAAO;gBACR,CAAC;gBAED,MAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,KAAK,OAAO,CAAC,CAAC;gBAEhE,OAAO,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAM,CAAC;YACjF,CAAC,CAAC,CAAC;YACH,KAAK,CAAC,cAAc,EAAE,CAAC;YACvB,KAAK,CAAC,wBAAwB,EAAE,CAAC;YACjC,OAAO,IAAI,CAAC;QACb,CAAC;QACD,IAAI,KAAK,CAAC,KAAK,KAAK,IAAI,CAAC,UAAU,IAAI,CAAC,CAAC,KAAK,CAAC,QAAQ,IAAI,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,OAAO,CAAC,EAAE,CAAC;YAC5G,UAAU,CAAC,CAAC,OAAO,EAAE,EAAE;gBACtB,MAAM,IAAI,GAAG,KAAK;qBAChB,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC;qBAChC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAW,CAAC;qBACnC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gBAElF,IAAI,CAAC,IAAI,EAAE,CAAC;oBACX,OAAO,SAAS,CAAC;gBAClB,CAAC;gBAED,MAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,KAAK,OAAO,CAAC,CAAC;gBAEhE,OAAO,CAAC,YAAY,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAM,CAAC;YACjF,CAAC,CAAC,CAAC;YACH,KAAK,CAAC,cAAc,EAAE,CAAC;YACvB,KAAK,CAAC,wBAAwB,EAAE,CAAC;YACjC,OAAO,IAAI,CAAC;QACb,CAAC;IACF,CAAC,CAAC,CAAC;IAEH,MAAM,UAAU,GAAG,kBAAkB,CAAC,GAAG,EAAE;QAC1C,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,OAAO;QACR,CAAC;QAED,QAAQ,CAAC,SAAS,CAAC,CAAC;QACpB,UAAU,CAAC,SAAS,CAAC,CAAC;QACtB,SAAS,CAAC,EAAE,CAAC,CAAC;IACf,CAAC,CAAC,CAAC;IAEH,MAAM,WAAW,GAAG,WAAW,CAC9B,CAAC,IAAwB,EAAE,EAAE;QAC5B,IAAI,CAAC,IAAI,EAAE,CAAC;YACX,OAAO;QACR,CAAC;QAED,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QACtC,IAAI,CAAC,gBAAgB,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;QAC1C,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;IACzC,CAAC,EACD,CAAC,KAAK,EAAE,OAAO,EAAE,OAAO,CAAC,CACzB,CAAC;IAEF,IAAI,CAAC,KAAK,EAAE,CAAC;QACZ,OAAO;YACN,WAAW;YACX,OAAO,EAAE,SAAS;YAClB,KAAK,EAAE,SAAS;YAChB,oBAAoB,EAAE,SAAS;YAC/B,KAAK,EAAE,SAAS;YAChB,MAAM,EAAE,SAAS;YACjB,SAAS,EAAE,IAAI;YACf,WAAW;YACX,MAAM,EAAE,SAAS;YACjB,UAAU;SACV,CAAC;IACH,CAAC;IAED,OAAO;QACN,OAAO;QACP,KAAK;QACL,oBAAoB;QACpB,KAAK;QACL,MAAM;QACN,MAAM;QACN,SAAS;QACT,WAAW;QACX,WAAW;QACX,UAAU;KACV,CAAC;AACH,CAAC,CAAC","sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport type { UseQueryResult } from '@tanstack/react-query';\nimport type { MutableRefObject } from 'react';\nimport { useEffect, useCallback, useState, useRef } from 'react';\n\nimport { useComposerBoxPopupQueries } from './useComposerBoxPopupQueries';\nimport { useChat } from '../../contexts/ChatContext';\nimport type { ComposerPopupOption } from '../../contexts/ComposerPopupContext';\n\ntype ComposerBoxPopupImperativeCommands<T> = MutableRefObject<\n\t| {\n\t\t\tgetFilter?: () => unknown;\n\t\t\tselect?: (s: T) => void;\n\t  }\n\t| undefined\n>;\n\ntype ComposerBoxPopupOptions<T extends { _id: string; sort?: number | undefined }> = ComposerPopupOption<T>;\n\ntype ComposerBoxPopupResult<T extends { _id: string; sort?: number }> =\n\t| {\n\t\t\tpopup: ComposerPopupOption<T>;\n\t\t\titems: UseQueryResult<T[]>[];\n\t\t\tfocused: T | undefined;\n\t\t\tariaActiveDescendant: string | undefined;\n\t\t\tselect: (item: T) => void;\n\t\t\tcallbackRef: (node: HTMLElement) => void;\n\t\t\tcommandsRef: ComposerBoxPopupImperativeCommands<T>;\n\t\t\tsuspended: boolean;\n\t\t\tfilter: unknown;\n\t\t\tclearPopup: () => void;\n\t  }\n\t| {\n\t\t\tpopup: undefined;\n\t\t\titems: undefined;\n\t\t\tfocused: undefined;\n\t\t\tariaActiveDescendant: undefined;\n\t\t\tcallbackRef: (node: HTMLElement) => void;\n\t\t\tselect: undefined;\n\t\t\tcommandsRef: ComposerBoxPopupImperativeCommands<T>;\n\t\t\tsuspended: boolean;\n\t\t\tfilter: unknown;\n\t\t\tclearPopup: () => void;\n\t  };\n\nconst keys = {\n\tTAB: 9,\n\tENTER: 13,\n\tESC: 27,\n\tARROW_LEFT: 37,\n\tARROW_UP: 38,\n\tARROW_RIGHT: 39,\n\tARROW_DOWN: 40,\n};\n\nexport const useComposerBoxPopup = <T extends { _id: string; sort?: number }>({\n\tconfigurations,\n}: {\n\tconfigurations: ComposerBoxPopupOptions<T>[];\n}): ComposerBoxPopupResult<T> => {\n\tconst [popup, setPopup] = useState<ComposerBoxPopupOptions<T> | undefined>(undefined);\n\tconst [focused, setFocused] = useState<T | undefined>(undefined);\n\tconst [filter, setFilter] = useState<unknown>('');\n\n\tconst commandsRef: ComposerBoxPopupImperativeCommands<T> = useRef();\n\n\tconst { queries: items, suspended } = useComposerBoxPopupQueries(filter, popup) as {\n\t\tqueries: UseQueryResult<T[]>[];\n\t\tsuspended: boolean;\n\t};\n\n\tconst chat = useChat();\n\n\tconst ariaActiveDescendant = focused ? `popup-item-${focused._id}` : undefined;\n\n\tuseEffect(() => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (popup?.preview && suspended) {\n\t\t\tsetFocused(undefined);\n\t\t\treturn;\n\t\t}\n\t\tsetFocused((focused) => {\n\t\t\tconst sortedItems = items\n\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\t\t\treturn sortedItems.find((item) => item._id === focused?._id) ?? sortedItems[0];\n\t\t});\n\t}, [items, popup, suspended]);\n\n\tconst select = useMutableCallback((item: T) => {\n\t\tif (!popup) {\n\t\t\tthrow new Error('No popup is open');\n\t\t}\n\n\t\tif (commandsRef.current?.select) {\n\t\t\tcommandsRef.current.select(item);\n\t\t} else {\n\t\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\t\t\tconst selector =\n\t\t\t\tpopup.matchSelectorRegex ??\n\t\t\t\t(popup.triggerAnywhere ? new RegExp(`(?:^| |\\n)(${popup.trigger})([^\\\\s]*$)`) : new RegExp(`(?:^)(${popup.trigger})([^\\\\s]*$)`));\n\n\t\t\tconst result = value?.match(selector);\n\t\t\tif (!result || !value) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tchat?.composer?.replaceText((popup.prefix ?? popup.trigger ?? '') + popup.getValue(item) + (popup.suffix ?? ''), {\n\t\t\t\tstart: value.lastIndexOf(result[1] + result[2]),\n\t\t\t\tend: chat?.composer?.selection.start,\n\t\t\t});\n\t\t}\n\t\tsetPopup(undefined);\n\t\tsetFocused(undefined);\n\t});\n\n\tconst setConfigByInput = useMutableCallback((): ComposerBoxPopupOptions<T> | undefined => {\n\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\n\t\tif (!value) {\n\t\t\tsetPopup(undefined);\n\t\t\tsetFocused(undefined);\n\t\t\treturn;\n\t\t}\n\n\t\tconst configuration = configurations.find(({ trigger, matchSelectorRegex, triggerAnywhere, triggerLength }) => {\n\t\t\tconst selector =\n\t\t\t\tmatchSelectorRegex ?? (triggerAnywhere ? new RegExp(`(?:^| |\\n)(${trigger})[^\\\\s]*$`) : new RegExp(`(?:^)(${trigger})[^\\\\s]*$`));\n\t\t\tconst result = selector.test(value);\n\t\t\tif (!triggerLength || !result) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\tconst filter = value.match(selector);\n\t\t\treturn filter && triggerLength < filter[0].length;\n\t\t});\n\t\tsetPopup(configuration);\n\t\tif (!configuration) {\n\t\t\tsetFocused(undefined);\n\t\t\tsetFilter('');\n\t\t}\n\n\t\tif (configuration) {\n\t\t\tconst selector =\n\t\t\t\tconfiguration.matchSelectorRegex ??\n\t\t\t\t(configuration.triggerAnywhere\n\t\t\t\t\t? new RegExp(`(?:^| |\\n)(${configuration.trigger})([^\\\\s]*$)`)\n\t\t\t\t\t: new RegExp(`(?:^)(${configuration.trigger})([^\\\\s]*$)`));\n\t\t\tconst result = value.match(selector);\n\t\t\tsetFilter(commandsRef.current?.getFilter?.() ?? (result ? result[2] : ''));\n\t\t}\n\t\treturn configuration;\n\t});\n\n\tconst onFocus = useMutableCallback(() => {\n\t\tif (popup) {\n\t\t\treturn;\n\t\t}\n\t\tsetConfigByInput();\n\t});\n\n\tconst keyup = useMutableCallback((event: KeyboardEvent) => {\n\t\tif (!setConfigByInput()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (popup.closeOnEsc === true && event.which === keys.ESC) {\n\t\t\tsetPopup(undefined);\n\t\t\tsetFocused(undefined);\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t}\n\t});\n\n\tconst keydown = useMutableCallback((event: KeyboardEvent) => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.which === keys.ENTER || event.which === keys.TAB) {\n\t\t\tif (!focused) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tselect(focused);\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t\tif (event.which === keys.ARROW_UP && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n\t\t\tsetFocused((focused) => {\n\t\t\t\tconst list = items\n\t\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\n\t\t\t\tif (!list) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst focusedIndex = list.findIndex((item) => item === focused);\n\n\t\t\t\treturn (focusedIndex > 0 ? list[focusedIndex - 1] : list[list.length - 1]) as T;\n\t\t\t});\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t\tif (event.which === keys.ARROW_DOWN && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n\t\t\tsetFocused((focused) => {\n\t\t\t\tconst list = items\n\t\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\n\t\t\t\tif (!list) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst focusedIndex = list.findIndex((item) => item === focused);\n\n\t\t\t\treturn (focusedIndex < list.length - 1 ? list[focusedIndex + 1] : list[0]) as T;\n\t\t\t});\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t});\n\n\tconst clearPopup = useMutableCallback(() => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetPopup(undefined);\n\t\tsetFocused(undefined);\n\t\tsetFilter('');\n\t});\n\n\tconst callbackRef = useCallback(\n\t\t(node: HTMLElement | null) => {\n\t\t\tif (!node) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnode.addEventListener('keyup', keyup);\n\t\t\tnode.addEventListener('keydown', keydown);\n\t\t\tnode.addEventListener('focus', onFocus);\n\t\t},\n\t\t[keyup, keydown, onFocus],\n\t);\n\n\tif (!popup) {\n\t\treturn {\n\t\t\tcallbackRef,\n\t\t\tfocused: undefined,\n\t\t\titems: undefined,\n\t\t\tariaActiveDescendant: undefined,\n\t\t\tpopup: undefined,\n\t\t\tselect: undefined,\n\t\t\tsuspended: true,\n\t\t\tcommandsRef,\n\t\t\tfilter: undefined,\n\t\t\tclearPopup,\n\t\t};\n\t}\n\n\treturn {\n\t\tfocused,\n\t\titems,\n\t\tariaActiveDescendant,\n\t\tpopup,\n\t\tselect,\n\t\tfilter,\n\t\tsuspended,\n\t\tcommandsRef,\n\t\tcallbackRef,\n\t\tclearPopup,\n\t};\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/composer/hooks/useComposerBoxPopup.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/room/composer/hooks/useComposerBoxPopup.ts","inputSourceMap":{"version":3,"file":"client/views/room/composer/hooks/useComposerBoxPopup.ts","sourceRoot":"","sources":["client/views/room/composer/hooks/useComposerBoxPopup.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,kBAAkB,EAAE,MAAM,6BAA6B,CAAC;AAGjE,OAAO,EAAE,SAAS,EAAE,WAAW,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,OAAO,CAAC;AAEjE,OAAO,EAAE,0BAA0B,EAAE,MAAM,8BAA8B,CAAC;AAC1E,OAAO,EAAE,OAAO,EAAE,MAAM,4BAA4B,CAAC;AAuCrD,MAAM,IAAI,GAAG;IACZ,GAAG,EAAE,CAAC;IACN,KAAK,EAAE,EAAE;IACT,GAAG,EAAE,EAAE;IACP,UAAU,EAAE,EAAE;IACd,QAAQ,EAAE,EAAE;IACZ,WAAW,EAAE,EAAE;IACf,UAAU,EAAE,EAAE;CACd,CAAC;AAEF,MAAM,CAAC,MAAM,mBAAmB,GAAG,CAA2C,EAC7E,cAAc,GAGd,EAA6B,EAAE;IAC/B,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,GAAG,QAAQ,CAAyC,SAAS,CAAC,CAAC;IACtF,MAAM,CAAC,OAAO,EAAE,UAAU,CAAC,GAAG,QAAQ,CAAgB,SAAS,CAAC,CAAC;IACjE,MAAM,CAAC,MAAM,EAAE,SAAS,CAAC,GAAG,QAAQ,CAAU,EAAE,CAAC,CAAC;IAElD,MAAM,WAAW,GAA0C,MAAM,EAAE,CAAC;IAEpE,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,0BAA0B,CAAC,MAAM,EAAE,KAAK,CAG7E,CAAC;IAEF,MAAM,IAAI,GAAG,OAAO,EAAE,CAAC;IAEvB,MAAM,oBAAoB,GAAG,OAAO,CAAC,CAAC,CAAC,cAAc,OAAO,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;IAE/E,SAAS,CAAC,GAAG,EAAE;QACd,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,OAAO;QACR,CAAC;QAED,IAAI,KAAK,EAAE,OAAO,IAAI,SAAS,EAAE,CAAC;YACjC,UAAU,CAAC,SAAS,CAAC,CAAC;YACtB,OAAO;QACR,CAAC;QACD,UAAU,CAAC,CAAC,OAAO,EAAE,EAAE;YACtB,MAAM,WAAW,GAAG,KAAK;iBACvB,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC;iBAChC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAW,CAAC;iBACnC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAClF,OAAO,WAAW,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,GAAG,KAAK,OAAO,EAAE,GAAG,CAAC,IAAI,WAAW,CAAC,CAAC,CAAC,CAAC;QAChF,CAAC,CAAC,CAAC;IACJ,CAAC,EAAE,CAAC,KAAK,EAAE,KAAK,EAAE,SAAS,CAAC,CAAC,CAAC;IAE9B,MAAM,MAAM,GAAG,kBAAkB,CAAC,CAAC,IAAO,EAAE,EAAE;QAC7C,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,MAAM,IAAI,KAAK,CAAC,kBAAkB,CAAC,CAAC;QACrC,CAAC;QAED,IAAI,WAAW,CAAC,OAAO,EAAE,MAAM,EAAE,CAAC;YACjC,WAAW,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAClC,CAAC;aAAM,CAAC;YACP,MAAM,KAAK,GAAG,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC,KAAK,CAAC,CAAC;YAC5E,MAAM,QAAQ,GACb,KAAK,CAAC,kBAAkB;gBACxB,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,cAAc,KAAK,CAAC,OAAO,aAAa,CAAC,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,SAAS,KAAK,CAAC,OAAO,aAAa,CAAC,CAAC,CAAC;YAElI,MAAM,MAAM,GAAG,KAAK,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC;YACtC,IAAI,CAAC,MAAM,IAAI,CAAC,KAAK,EAAE,CAAC;gBACvB,OAAO;YACR,CAAC;YAED,IAAI,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAC,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,OAAO,IAAI,EAAE,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,IAAI,EAAE,CAAC,EAAE;gBAChH,KAAK,EAAE,KAAK,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;gBAC/C,GAAG,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC,KAAK;aACpC,CAAC,CAAC;QACJ,CAAC;QACD,QAAQ,CAAC,SAAS,CAAC,CAAC;QACpB,UAAU,CAAC,SAAS,CAAC,CAAC;IACvB,CAAC,CAAC,CAAC;IAEH,MAAM,gBAAgB,GAAG,kBAAkB,CAAC,GAA2C,EAAE;QACxF,MAAM,KAAK,GAAG,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC,KAAK,CAAC,CAAC;QAE5E,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,QAAQ,CAAC,SAAS,CAAC,CAAC;YACpB,UAAU,CAAC,SAAS,CAAC,CAAC;YACtB,OAAO;QACR,CAAC;QAED,MAAM,aAAa,GAAG,cAAc,CAAC,IAAI,CAAC,CAAC,EAAE,OAAO,EAAE,kBAAkB,EAAE,eAAe,EAAE,aAAa,EAAE,EAAE,EAAE;YAC7G,MAAM,QAAQ,GACb,kBAAkB,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,cAAc,OAAO,WAAW,CAAC,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,SAAS,OAAO,WAAW,CAAC,CAAC,CAAC;YAClI,MAAM,MAAM,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACpC,IAAI,CAAC,aAAa,IAAI,CAAC,MAAM,EAAE,CAAC;gBAC/B,OAAO,MAAM,CAAC;YACf,CAAC;YACD,MAAM,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;YACrC,OAAO,MAAM,IAAI,aAAa,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;QACnD,CAAC,CAAC,CAAC;QACH,QAAQ,CAAC,aAAa,CAAC,CAAC;QACxB,IAAI,CAAC,aAAa,EAAE,CAAC;YACpB,UAAU,CAAC,SAAS,CAAC,CAAC;YACtB,SAAS,CAAC,EAAE,CAAC,CAAC;QACf,CAAC;QAED,IAAI,aAAa,EAAE,CAAC;YACnB,MAAM,QAAQ,GACb,aAAa,CAAC,kBAAkB;gBAChC,CAAC,aAAa,CAAC,eAAe;oBAC7B,CAAC,CAAC,IAAI,MAAM,CAAC,cAAc,aAAa,CAAC,OAAO,aAAa,CAAC;oBAC9D,CAAC,CAAC,IAAI,MAAM,CAAC,SAAS,aAAa,CAAC,OAAO,aAAa,CAAC,CAAC,CAAC;YAC7D,MAAM,MAAM,GAAG,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;YACrC,SAAS,CAAC,WAAW,CAAC,OAAO,EAAE,SAAS,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC5E,CAAC;QACD,OAAO,aAAa,CAAC;IACtB,CAAC,CAAC,CAAC;IAEH,MAAM,OAAO,GAAG,kBAAkB,CAAC,GAAG,EAAE;QACvC,IAAI,KAAK,EAAE,CAAC;YACX,OAAO;QACR,CAAC;QACD,gBAAgB,EAAE,CAAC;IACpB,CAAC,CAAC,CAAC;IAEH,MAAM,KAAK,GAAG,kBAAkB,CAAC,CAAC,KAAoB,EAAE,EAAE;QACzD,IAAI,CAAC,gBAAgB,EAAE,EAAE,CAAC;YACzB,OAAO;QACR,CAAC;QAED,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,OAAO;QACR,CAAC;QAED,IAAI,KAAK,CAAC,UAAU,KAAK,IAAI,IAAI,KAAK,CAAC,KAAK,KAAK,IAAI,CAAC,GAAG,EAAE,CAAC;YAC3D,QAAQ,CAAC,SAAS,CAAC,CAAC;YACpB,UAAU,CAAC,SAAS,CAAC,CAAC;YACtB,KAAK,CAAC,cAAc,EAAE,CAAC;YACvB,KAAK,CAAC,wBAAwB,EAAE,CAAC;QAClC,CAAC;IACF,CAAC,CAAC,CAAC;IAEH,MAAM,OAAO,GAAG,kBAAkB,CAAC,CAAC,KAAoB,EAAE,EAAE;QAC3D,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,OAAO;QACR,CAAC;QAED,IAAI,KAAK,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,KAAK,IAAI,CAAC,GAAG,EAAE,CAAC;YAC5D,IAAI,CAAC,OAAO,EAAE,CAAC;gBACd,OAAO;YACR,CAAC;YAED,MAAM,CAAC,OAAO,CAAC,CAAC;YAEhB,KAAK,CAAC,cAAc,EAAE,CAAC;YACvB,KAAK,CAAC,wBAAwB,EAAE,CAAC;YACjC,OAAO,IAAI,CAAC;QACb,CAAC;QACD,IAAI,KAAK,CAAC,KAAK,KAAK,IAAI,CAAC,QAAQ,IAAI,CAAC,CAAC,KAAK,CAAC,QAAQ,IAAI,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,OAAO,CAAC,EAAE,CAAC;YAC1G,UAAU,CAAC,CAAC,OAAO,EAAE,EAAE;gBACtB,MAAM,IAAI,GAAG,KAAK;qBAChB,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC;qBAChC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAW,CAAC;qBACnC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gBAElF,IAAI,CAAC,IAAI,EAAE,CAAC;oBACX,OAAO;gBACR,CAAC;gBAED,MAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,KAAK,OAAO,CAAC,CAAC;gBAEhE,OAAO,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAM,CAAC;YACjF,CAAC,CAAC,CAAC;YACH,KAAK,CAAC,cAAc,EAAE,CAAC;YACvB,KAAK,CAAC,wBAAwB,EAAE,CAAC;YACjC,OAAO,IAAI,CAAC;QACb,CAAC;QACD,IAAI,KAAK,CAAC,KAAK,KAAK,IAAI,CAAC,UAAU,IAAI,CAAC,CAAC,KAAK,CAAC,QAAQ,IAAI,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,OAAO,CAAC,EAAE,CAAC;YAC5G,UAAU,CAAC,CAAC,OAAO,EAAE,EAAE;gBACtB,MAAM,IAAI,GAAG,KAAK;qBAChB,MAAM,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC;qBAChC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAW,CAAC;qBACnC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gBAElF,IAAI,CAAC,IAAI,EAAE,CAAC;oBACX,OAAO,SAAS,CAAC;gBAClB,CAAC;gBAED,MAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,KAAK,OAAO,CAAC,CAAC;gBAEhE,OAAO,CAAC,YAAY,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAM,CAAC;YACjF,CAAC,CAAC,CAAC;YACH,KAAK,CAAC,cAAc,EAAE,CAAC;YACvB,KAAK,CAAC,wBAAwB,EAAE,CAAC;YACjC,OAAO,IAAI,CAAC;QACb,CAAC;IACF,CAAC,CAAC,CAAC;IAEH,MAAM,UAAU,GAAG,kBAAkB,CAAC,GAAG,EAAE;QAC1C,IAAI,CAAC,KAAK,EAAE,CAAC;YACZ,OAAO;QACR,CAAC;QAED,QAAQ,CAAC,SAAS,CAAC,CAAC;QACpB,UAAU,CAAC,SAAS,CAAC,CAAC;QACtB,SAAS,CAAC,EAAE,CAAC,CAAC;IACf,CAAC,CAAC,CAAC;IAEH,MAAM,WAAW,GAAG,WAAW,CAC9B,CAAC,IAAwB,EAAE,EAAE;QAC5B,IAAI,CAAC,IAAI,EAAE,CAAC;YACX,OAAO;QACR,CAAC;QAED,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QACtC,IAAI,CAAC,gBAAgB,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;QAC1C,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;IACzC,CAAC,EACD,CAAC,KAAK,EAAE,OAAO,EAAE,OAAO,CAAC,CACzB,CAAC;IAEF,IAAI,CAAC,KAAK,EAAE,CAAC;QACZ,OAAO;YACN,WAAW;YACX,OAAO,EAAE,SAAS;YAClB,KAAK,EAAE,SAAS;YAChB,oBAAoB,EAAE,SAAS;YAC/B,KAAK,EAAE,SAAS;YAChB,MAAM,EAAE,SAAS;YACjB,SAAS,EAAE,IAAI;YACf,WAAW;YACX,MAAM,EAAE,SAAS;YACjB,UAAU;SACV,CAAC;IACH,CAAC;IAED,OAAO;QACN,OAAO;QACP,KAAK;QACL,oBAAoB;QACpB,KAAK;QACL,MAAM;QACN,MAAM;QACN,SAAS;QACT,WAAW;QACX,WAAW;QACX,UAAU;KACV,CAAC;AACH,CAAC,CAAC","sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport type { UseQueryResult } from '@tanstack/react-query';\nimport type { MutableRefObject } from 'react';\nimport { useEffect, useCallback, useState, useRef } from 'react';\n\nimport { useComposerBoxPopupQueries } from './useComposerBoxPopupQueries';\nimport { useChat } from '../../contexts/ChatContext';\nimport type { ComposerPopupOption } from '../../contexts/ComposerPopupContext';\n\ntype ComposerBoxPopupImperativeCommands<T> = MutableRefObject<\n\t| {\n\t\t\tgetFilter?: () => unknown;\n\t\t\tselect?: (s: T) => void;\n\t  }\n\t| undefined\n>;\n\ntype ComposerBoxPopupOptions<T extends { _id: string; sort?: number | undefined }> = ComposerPopupOption<T>;\n\ntype ComposerBoxPopupResult<T extends { _id: string; sort?: number }> =\n\t| {\n\t\t\tpopup: ComposerPopupOption<T>;\n\t\t\titems: UseQueryResult<T[]>[];\n\t\t\tfocused: T | undefined;\n\t\t\tariaActiveDescendant: string | undefined;\n\t\t\tselect: (item: T) => void;\n\t\t\tcallbackRef: (node: HTMLElement) => void;\n\t\t\tcommandsRef: ComposerBoxPopupImperativeCommands<T>;\n\t\t\tsuspended: boolean;\n\t\t\tfilter: unknown;\n\t\t\tclearPopup: () => void;\n\t  }\n\t| {\n\t\t\tpopup: undefined;\n\t\t\titems: undefined;\n\t\t\tfocused: undefined;\n\t\t\tariaActiveDescendant: undefined;\n\t\t\tcallbackRef: (node: HTMLElement) => void;\n\t\t\tselect: undefined;\n\t\t\tcommandsRef: ComposerBoxPopupImperativeCommands<T>;\n\t\t\tsuspended: boolean;\n\t\t\tfilter: unknown;\n\t\t\tclearPopup: () => void;\n\t  };\n\nconst keys = {\n\tTAB: 9,\n\tENTER: 13,\n\tESC: 27,\n\tARROW_LEFT: 37,\n\tARROW_UP: 38,\n\tARROW_RIGHT: 39,\n\tARROW_DOWN: 40,\n};\n\nexport const useComposerBoxPopup = <T extends { _id: string; sort?: number }>({\n\tconfigurations,\n}: {\n\tconfigurations: ComposerBoxPopupOptions<T>[];\n}): ComposerBoxPopupResult<T> => {\n\tconst [popup, setPopup] = useState<ComposerBoxPopupOptions<T> | undefined>(undefined);\n\tconst [focused, setFocused] = useState<T | undefined>(undefined);\n\tconst [filter, setFilter] = useState<unknown>('');\n\n\tconst commandsRef: ComposerBoxPopupImperativeCommands<T> = useRef();\n\n\tconst { queries: items, suspended } = useComposerBoxPopupQueries(filter, popup) as {\n\t\tqueries: UseQueryResult<T[]>[];\n\t\tsuspended: boolean;\n\t};\n\n\tconst chat = useChat();\n\n\tconst ariaActiveDescendant = focused ? `popup-item-${focused._id}` : undefined;\n\n\tuseEffect(() => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (popup?.preview && suspended) {\n\t\t\tsetFocused(undefined);\n\t\t\treturn;\n\t\t}\n\t\tsetFocused((focused) => {\n\t\t\tconst sortedItems = items\n\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\t\t\treturn sortedItems.find((item) => item._id === focused?._id) ?? sortedItems[0];\n\t\t});\n\t}, [items, popup, suspended]);\n\n\tconst select = useMutableCallback((item: T) => {\n\t\tif (!popup) {\n\t\t\tthrow new Error('No popup is open');\n\t\t}\n\n\t\tif (commandsRef.current?.select) {\n\t\t\tcommandsRef.current.select(item);\n\t\t} else {\n\t\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\t\t\tconst selector =\n\t\t\t\tpopup.matchSelectorRegex ??\n\t\t\t\t(popup.triggerAnywhere ? new RegExp(`(?:^| |\\n)(${popup.trigger})([^\\\\s]*$)`) : new RegExp(`(?:^)(${popup.trigger})([^\\\\s]*$)`));\n\n\t\t\tconst result = value?.match(selector);\n\t\t\tif (!result || !value) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tchat?.composer?.replaceText((popup.prefix ?? popup.trigger ?? '') + popup.getValue(item) + (popup.suffix ?? ''), {\n\t\t\t\tstart: value.lastIndexOf(result[1] + result[2]),\n\t\t\t\tend: chat?.composer?.selection.start,\n\t\t\t});\n\t\t}\n\t\tsetPopup(undefined);\n\t\tsetFocused(undefined);\n\t});\n\n\tconst setConfigByInput = useMutableCallback((): ComposerBoxPopupOptions<T> | undefined => {\n\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\n\t\tif (!value) {\n\t\t\tsetPopup(undefined);\n\t\t\tsetFocused(undefined);\n\t\t\treturn;\n\t\t}\n\n\t\tconst configuration = configurations.find(({ trigger, matchSelectorRegex, triggerAnywhere, triggerLength }) => {\n\t\t\tconst selector =\n\t\t\t\tmatchSelectorRegex ?? (triggerAnywhere ? new RegExp(`(?:^| |\\n)(${trigger})[^\\\\s]*$`) : new RegExp(`(?:^)(${trigger})[^\\\\s]*$`));\n\t\t\tconst result = selector.test(value);\n\t\t\tif (!triggerLength || !result) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\tconst filter = value.match(selector);\n\t\t\treturn filter && triggerLength < filter[0].length;\n\t\t});\n\t\tsetPopup(configuration);\n\t\tif (!configuration) {\n\t\t\tsetFocused(undefined);\n\t\t\tsetFilter('');\n\t\t}\n\n\t\tif (configuration) {\n\t\t\tconst selector =\n\t\t\t\tconfiguration.matchSelectorRegex ??\n\t\t\t\t(configuration.triggerAnywhere\n\t\t\t\t\t? new RegExp(`(?:^| |\\n)(${configuration.trigger})([^\\\\s]*$)`)\n\t\t\t\t\t: new RegExp(`(?:^)(${configuration.trigger})([^\\\\s]*$)`));\n\t\t\tconst result = value.match(selector);\n\t\t\tsetFilter(commandsRef.current?.getFilter?.() ?? (result ? result[2] : ''));\n\t\t}\n\t\treturn configuration;\n\t});\n\n\tconst onFocus = useMutableCallback(() => {\n\t\tif (popup) {\n\t\t\treturn;\n\t\t}\n\t\tsetConfigByInput();\n\t});\n\n\tconst keyup = useMutableCallback((event: KeyboardEvent) => {\n\t\tif (!setConfigByInput()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (popup.closeOnEsc === true && event.which === keys.ESC) {\n\t\t\tsetPopup(undefined);\n\t\t\tsetFocused(undefined);\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t}\n\t});\n\n\tconst keydown = useMutableCallback((event: KeyboardEvent) => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.which === keys.ENTER || event.which === keys.TAB) {\n\t\t\tif (!focused) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tselect(focused);\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t\tif (event.which === keys.ARROW_UP && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n\t\t\tsetFocused((focused) => {\n\t\t\t\tconst list = items\n\t\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\n\t\t\t\tif (!list) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst focusedIndex = list.findIndex((item) => item === focused);\n\n\t\t\t\treturn (focusedIndex > 0 ? list[focusedIndex - 1] : list[list.length - 1]) as T;\n\t\t\t});\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t\tif (event.which === keys.ARROW_DOWN && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n\t\t\tsetFocused((focused) => {\n\t\t\t\tconst list = items\n\t\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\n\t\t\t\tif (!list) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst focusedIndex = list.findIndex((item) => item === focused);\n\n\t\t\t\treturn (focusedIndex < list.length - 1 ? list[focusedIndex + 1] : list[0]) as T;\n\t\t\t});\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t});\n\n\tconst clearPopup = useMutableCallback(() => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetPopup(undefined);\n\t\tsetFocused(undefined);\n\t\tsetFilter('');\n\t});\n\n\tconst callbackRef = useCallback(\n\t\t(node: HTMLElement | null) => {\n\t\t\tif (!node) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnode.addEventListener('keyup', keyup);\n\t\t\tnode.addEventListener('keydown', keydown);\n\t\t\tnode.addEventListener('focus', onFocus);\n\t\t},\n\t\t[keyup, keydown, onFocus],\n\t);\n\n\tif (!popup) {\n\t\treturn {\n\t\t\tcallbackRef,\n\t\t\tfocused: undefined,\n\t\t\titems: undefined,\n\t\t\tariaActiveDescendant: undefined,\n\t\t\tpopup: undefined,\n\t\t\tselect: undefined,\n\t\t\tsuspended: true,\n\t\t\tcommandsRef,\n\t\t\tfilter: undefined,\n\t\t\tclearPopup,\n\t\t};\n\t}\n\n\treturn {\n\t\tfocused,\n\t\titems,\n\t\tariaActiveDescendant,\n\t\tpopup,\n\t\tselect,\n\t\tfilter,\n\t\tsuspended,\n\t\tcommandsRef,\n\t\tcallbackRef,\n\t\tclearPopup,\n\t};\n};\n"]}}},"code":"module.export({\n  useComposerBoxPopup: () => useComposerBoxPopup\n});\nlet useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback(v) {\n    useMutableCallback = v;\n  }\n}, 0);\nlet useEffect, useCallback, useState, useRef;\nmodule.link(\"react\", {\n  useEffect(v) {\n    useEffect = v;\n  },\n  useCallback(v) {\n    useCallback = v;\n  },\n  useState(v) {\n    useState = v;\n  },\n  useRef(v) {\n    useRef = v;\n  }\n}, 1);\nlet useComposerBoxPopupQueries;\nmodule.link(\"./useComposerBoxPopupQueries\", {\n  useComposerBoxPopupQueries(v) {\n    useComposerBoxPopupQueries = v;\n  }\n}, 2);\nlet useChat;\nmodule.link(\"../../contexts/ChatContext\", {\n  useChat(v) {\n    useChat = v;\n  }\n}, 3);\nconst keys = {\n  TAB: 9,\n  ENTER: 13,\n  ESC: 27,\n  ARROW_LEFT: 37,\n  ARROW_UP: 38,\n  ARROW_RIGHT: 39,\n  ARROW_DOWN: 40\n};\nconst useComposerBoxPopup = _ref => {\n  let {\n    configurations\n  } = _ref;\n  const [popup, setPopup] = useState(undefined);\n  const [focused, setFocused] = useState(undefined);\n  const [filter, setFilter] = useState('');\n  const commandsRef = useRef();\n  const {\n    queries: items,\n    suspended\n  } = useComposerBoxPopupQueries(filter, popup);\n  const chat = useChat();\n  const ariaActiveDescendant = focused ? \"popup-item-\".concat(focused._id) : undefined;\n  useEffect(() => {\n    if (!popup) {\n      return;\n    }\n    if (popup !== null && popup !== void 0 && popup.preview && suspended) {\n      setFocused(undefined);\n      return;\n    }\n    setFocused(focused => {\n      var _sortedItems$find;\n      const sortedItems = items.filter(item => item.isSuccess).flatMap(item => item.data).sort((a, b) => ('sort' in a && a.sort || 0) - ('sort' in b && b.sort || 0));\n      return (_sortedItems$find = sortedItems.find(item => item._id === (focused === null || focused === void 0 ? void 0 : focused._id))) !== null && _sortedItems$find !== void 0 ? _sortedItems$find : sortedItems[0];\n    });\n  }, [items, popup, suspended]);\n  const select = useMutableCallback(item => {\n    var _commandsRef$current;\n    if (!popup) {\n      throw new Error('No popup is open');\n    }\n    if ((_commandsRef$current = commandsRef.current) !== null && _commandsRef$current !== void 0 && _commandsRef$current.select) {\n      commandsRef.current.select(item);\n    } else {\n      var _chat$composer, _chat$composer2, _popup$matchSelectorR, _chat$composer3, _ref2, _popup$prefix, _popup$suffix, _chat$composer4;\n      const value = chat === null || chat === void 0 ? void 0 : (_chat$composer = chat.composer) === null || _chat$composer === void 0 ? void 0 : _chat$composer.substring(0, chat === null || chat === void 0 ? void 0 : (_chat$composer2 = chat.composer) === null || _chat$composer2 === void 0 ? void 0 : _chat$composer2.selection.start);\n      const selector = (_popup$matchSelectorR = popup.matchSelectorRegex) !== null && _popup$matchSelectorR !== void 0 ? _popup$matchSelectorR : popup.triggerAnywhere ? new RegExp(\"(?:^| |\\n)(\".concat(popup.trigger, \")([^\\\\s]*$)\")) : new RegExp(\"(?:^)(\".concat(popup.trigger, \")([^\\\\s]*$)\"));\n      const result = value === null || value === void 0 ? void 0 : value.match(selector);\n      if (!result || !value) {\n        return;\n      }\n      chat === null || chat === void 0 ? void 0 : (_chat$composer3 = chat.composer) === null || _chat$composer3 === void 0 ? void 0 : _chat$composer3.replaceText(((_ref2 = (_popup$prefix = popup.prefix) !== null && _popup$prefix !== void 0 ? _popup$prefix : popup.trigger) !== null && _ref2 !== void 0 ? _ref2 : '') + popup.getValue(item) + ((_popup$suffix = popup.suffix) !== null && _popup$suffix !== void 0 ? _popup$suffix : ''), {\n        start: value.lastIndexOf(result[1] + result[2]),\n        end: chat === null || chat === void 0 ? void 0 : (_chat$composer4 = chat.composer) === null || _chat$composer4 === void 0 ? void 0 : _chat$composer4.selection.start\n      });\n    }\n    setPopup(undefined);\n    setFocused(undefined);\n  });\n  const setConfigByInput = useMutableCallback(() => {\n    var _chat$composer5, _chat$composer6;\n    const value = chat === null || chat === void 0 ? void 0 : (_chat$composer5 = chat.composer) === null || _chat$composer5 === void 0 ? void 0 : _chat$composer5.substring(0, chat === null || chat === void 0 ? void 0 : (_chat$composer6 = chat.composer) === null || _chat$composer6 === void 0 ? void 0 : _chat$composer6.selection.start);\n    if (!value) {\n      setPopup(undefined);\n      setFocused(undefined);\n      return;\n    }\n    const configuration = configurations.find(_ref3 => {\n      let {\n        trigger,\n        matchSelectorRegex,\n        triggerAnywhere,\n        triggerLength\n      } = _ref3;\n      const selector = matchSelectorRegex !== null && matchSelectorRegex !== void 0 ? matchSelectorRegex : triggerAnywhere ? new RegExp(\"(?:^| |\\n)(\".concat(trigger, \")[^\\\\s]*$\")) : new RegExp(\"(?:^)(\".concat(trigger, \")[^\\\\s]*$\"));\n      const result = selector.test(value);\n      if (!triggerLength || !result) {\n        return result;\n      }\n      const filter = value.match(selector);\n      return filter && triggerLength < filter[0].length;\n    });\n    setPopup(configuration);\n    if (!configuration) {\n      setFocused(undefined);\n      setFilter('');\n    }\n    if (configuration) {\n      var _configuration$matchS, _commandsRef$current$, _commandsRef$current2, _commandsRef$current3;\n      const selector = (_configuration$matchS = configuration.matchSelectorRegex) !== null && _configuration$matchS !== void 0 ? _configuration$matchS : configuration.triggerAnywhere ? new RegExp(\"(?:^| |\\n)(\".concat(configuration.trigger, \")([^\\\\s]*$)\")) : new RegExp(\"(?:^)(\".concat(configuration.trigger, \")([^\\\\s]*$)\"));\n      const result = value.match(selector);\n      setFilter((_commandsRef$current$ = (_commandsRef$current2 = commandsRef.current) === null || _commandsRef$current2 === void 0 ? void 0 : (_commandsRef$current3 = _commandsRef$current2.getFilter) === null || _commandsRef$current3 === void 0 ? void 0 : _commandsRef$current3.call(_commandsRef$current2)) !== null && _commandsRef$current$ !== void 0 ? _commandsRef$current$ : result ? result[2] : '');\n    }\n    return configuration;\n  });\n  const onFocus = useMutableCallback(() => {\n    if (popup) {\n      return;\n    }\n    setConfigByInput();\n  });\n  const keyup = useMutableCallback(event => {\n    if (!setConfigByInput()) {\n      return;\n    }\n    if (!popup) {\n      return;\n    }\n    if (popup.closeOnEsc === true && event.which === keys.ESC) {\n      setPopup(undefined);\n      setFocused(undefined);\n      event.preventDefault();\n      event.stopImmediatePropagation();\n    }\n  });\n  const keydown = useMutableCallback(event => {\n    if (!popup) {\n      return;\n    }\n    if (event.which === keys.ENTER || event.which === keys.TAB) {\n      if (!focused) {\n        return;\n      }\n      select(focused);\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      return true;\n    }\n    if (event.which === keys.ARROW_UP && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n      setFocused(focused => {\n        const list = items.filter(item => item.isSuccess).flatMap(item => item.data).sort((a, b) => ('sort' in a && a.sort || 0) - ('sort' in b && b.sort || 0));\n        if (!list) {\n          return;\n        }\n        const focusedIndex = list.findIndex(item => item === focused);\n        return focusedIndex > 0 ? list[focusedIndex - 1] : list[list.length - 1];\n      });\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      return true;\n    }\n    if (event.which === keys.ARROW_DOWN && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n      setFocused(focused => {\n        const list = items.filter(item => item.isSuccess).flatMap(item => item.data).sort((a, b) => ('sort' in a && a.sort || 0) - ('sort' in b && b.sort || 0));\n        if (!list) {\n          return undefined;\n        }\n        const focusedIndex = list.findIndex(item => item === focused);\n        return focusedIndex < list.length - 1 ? list[focusedIndex + 1] : list[0];\n      });\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      return true;\n    }\n  });\n  const clearPopup = useMutableCallback(() => {\n    if (!popup) {\n      return;\n    }\n    setPopup(undefined);\n    setFocused(undefined);\n    setFilter('');\n  });\n  const callbackRef = useCallback(node => {\n    if (!node) {\n      return;\n    }\n    node.addEventListener('keyup', keyup);\n    node.addEventListener('keydown', keydown);\n    node.addEventListener('focus', onFocus);\n  }, [keyup, keydown, onFocus]);\n  if (!popup) {\n    return {\n      callbackRef,\n      focused: undefined,\n      items: undefined,\n      ariaActiveDescendant: undefined,\n      popup: undefined,\n      select: undefined,\n      suspended: true,\n      commandsRef,\n      filter: undefined,\n      clearPopup\n    };\n  }\n  return {\n    focused,\n    items,\n    ariaActiveDescendant,\n    popup,\n    select,\n    filter,\n    suspended,\n    commandsRef,\n    callbackRef,\n    clearPopup\n  };\n};","map":{"version":3,"names":["module","export","useComposerBoxPopup","useMutableCallback","link","v","useEffect","useCallback","useState","useRef","useComposerBoxPopupQueries","useChat","keys","TAB","ENTER","ESC","ARROW_LEFT","ARROW_UP","ARROW_RIGHT","ARROW_DOWN","_ref","configurations","popup","setPopup","undefined","focused","setFocused","filter","setFilter","commandsRef","queries","items","suspended","chat","ariaActiveDescendant","concat","_id","preview","_sortedItems$find","sortedItems","item","isSuccess","flatMap","data","sort","a","b","find","select","_commandsRef$current","Error","current","_chat$composer","_chat$composer2","_popup$matchSelectorR","_chat$composer3","_ref2","_popup$prefix","_popup$suffix","_chat$composer4","value","composer","substring","selection","start","selector","matchSelectorRegex","triggerAnywhere","RegExp","trigger","result","match","replaceText","prefix","getValue","suffix","lastIndexOf","end","setConfigByInput","_chat$composer5","_chat$composer6","configuration","_ref3","triggerLength","test","length","_configuration$matchS","_commandsRef$current$","_commandsRef$current2","_commandsRef$current3","getFilter","call","onFocus","keyup","event","closeOnEsc","which","preventDefault","stopImmediatePropagation","keydown","shiftKey","ctrlKey","altKey","metaKey","list","focusedIndex","findIndex","clearPopup","callbackRef","node","addEventListener"],"sources":["client/views/room/composer/hooks/useComposerBoxPopup.ts"],"sourcesContent":["import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport type { UseQueryResult } from '@tanstack/react-query';\nimport type { MutableRefObject } from 'react';\nimport { useEffect, useCallback, useState, useRef } from 'react';\n\nimport { useComposerBoxPopupQueries } from './useComposerBoxPopupQueries';\nimport { useChat } from '../../contexts/ChatContext';\nimport type { ComposerPopupOption } from '../../contexts/ComposerPopupContext';\n\ntype ComposerBoxPopupImperativeCommands<T> = MutableRefObject<\n\t| {\n\t\t\tgetFilter?: () => unknown;\n\t\t\tselect?: (s: T) => void;\n\t  }\n\t| undefined\n>;\n\ntype ComposerBoxPopupOptions<T extends { _id: string; sort?: number | undefined }> = ComposerPopupOption<T>;\n\ntype ComposerBoxPopupResult<T extends { _id: string; sort?: number }> =\n\t| {\n\t\t\tpopup: ComposerPopupOption<T>;\n\t\t\titems: UseQueryResult<T[]>[];\n\t\t\tfocused: T | undefined;\n\t\t\tariaActiveDescendant: string | undefined;\n\t\t\tselect: (item: T) => void;\n\t\t\tcallbackRef: (node: HTMLElement) => void;\n\t\t\tcommandsRef: ComposerBoxPopupImperativeCommands<T>;\n\t\t\tsuspended: boolean;\n\t\t\tfilter: unknown;\n\t\t\tclearPopup: () => void;\n\t  }\n\t| {\n\t\t\tpopup: undefined;\n\t\t\titems: undefined;\n\t\t\tfocused: undefined;\n\t\t\tariaActiveDescendant: undefined;\n\t\t\tcallbackRef: (node: HTMLElement) => void;\n\t\t\tselect: undefined;\n\t\t\tcommandsRef: ComposerBoxPopupImperativeCommands<T>;\n\t\t\tsuspended: boolean;\n\t\t\tfilter: unknown;\n\t\t\tclearPopup: () => void;\n\t  };\n\nconst keys = {\n\tTAB: 9,\n\tENTER: 13,\n\tESC: 27,\n\tARROW_LEFT: 37,\n\tARROW_UP: 38,\n\tARROW_RIGHT: 39,\n\tARROW_DOWN: 40,\n};\n\nexport const useComposerBoxPopup = <T extends { _id: string; sort?: number }>({\n\tconfigurations,\n}: {\n\tconfigurations: ComposerBoxPopupOptions<T>[];\n}): ComposerBoxPopupResult<T> => {\n\tconst [popup, setPopup] = useState<ComposerBoxPopupOptions<T> | undefined>(undefined);\n\tconst [focused, setFocused] = useState<T | undefined>(undefined);\n\tconst [filter, setFilter] = useState<unknown>('');\n\n\tconst commandsRef: ComposerBoxPopupImperativeCommands<T> = useRef();\n\n\tconst { queries: items, suspended } = useComposerBoxPopupQueries(filter, popup) as {\n\t\tqueries: UseQueryResult<T[]>[];\n\t\tsuspended: boolean;\n\t};\n\n\tconst chat = useChat();\n\n\tconst ariaActiveDescendant = focused ? `popup-item-${focused._id}` : undefined;\n\n\tuseEffect(() => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (popup?.preview && suspended) {\n\t\t\tsetFocused(undefined);\n\t\t\treturn;\n\t\t}\n\t\tsetFocused((focused) => {\n\t\t\tconst sortedItems = items\n\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\t\t\treturn sortedItems.find((item) => item._id === focused?._id) ?? sortedItems[0];\n\t\t});\n\t}, [items, popup, suspended]);\n\n\tconst select = useMutableCallback((item: T) => {\n\t\tif (!popup) {\n\t\t\tthrow new Error('No popup is open');\n\t\t}\n\n\t\tif (commandsRef.current?.select) {\n\t\t\tcommandsRef.current.select(item);\n\t\t} else {\n\t\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\t\t\tconst selector =\n\t\t\t\tpopup.matchSelectorRegex ??\n\t\t\t\t(popup.triggerAnywhere ? new RegExp(`(?:^| |\\n)(${popup.trigger})([^\\\\s]*$)`) : new RegExp(`(?:^)(${popup.trigger})([^\\\\s]*$)`));\n\n\t\t\tconst result = value?.match(selector);\n\t\t\tif (!result || !value) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tchat?.composer?.replaceText((popup.prefix ?? popup.trigger ?? '') + popup.getValue(item) + (popup.suffix ?? ''), {\n\t\t\t\tstart: value.lastIndexOf(result[1] + result[2]),\n\t\t\t\tend: chat?.composer?.selection.start,\n\t\t\t});\n\t\t}\n\t\tsetPopup(undefined);\n\t\tsetFocused(undefined);\n\t});\n\n\tconst setConfigByInput = useMutableCallback((): ComposerBoxPopupOptions<T> | undefined => {\n\t\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\n\n\t\tif (!value) {\n\t\t\tsetPopup(undefined);\n\t\t\tsetFocused(undefined);\n\t\t\treturn;\n\t\t}\n\n\t\tconst configuration = configurations.find(({ trigger, matchSelectorRegex, triggerAnywhere, triggerLength }) => {\n\t\t\tconst selector =\n\t\t\t\tmatchSelectorRegex ?? (triggerAnywhere ? new RegExp(`(?:^| |\\n)(${trigger})[^\\\\s]*$`) : new RegExp(`(?:^)(${trigger})[^\\\\s]*$`));\n\t\t\tconst result = selector.test(value);\n\t\t\tif (!triggerLength || !result) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\tconst filter = value.match(selector);\n\t\t\treturn filter && triggerLength < filter[0].length;\n\t\t});\n\t\tsetPopup(configuration);\n\t\tif (!configuration) {\n\t\t\tsetFocused(undefined);\n\t\t\tsetFilter('');\n\t\t}\n\n\t\tif (configuration) {\n\t\t\tconst selector =\n\t\t\t\tconfiguration.matchSelectorRegex ??\n\t\t\t\t(configuration.triggerAnywhere\n\t\t\t\t\t? new RegExp(`(?:^| |\\n)(${configuration.trigger})([^\\\\s]*$)`)\n\t\t\t\t\t: new RegExp(`(?:^)(${configuration.trigger})([^\\\\s]*$)`));\n\t\t\tconst result = value.match(selector);\n\t\t\tsetFilter(commandsRef.current?.getFilter?.() ?? (result ? result[2] : ''));\n\t\t}\n\t\treturn configuration;\n\t});\n\n\tconst onFocus = useMutableCallback(() => {\n\t\tif (popup) {\n\t\t\treturn;\n\t\t}\n\t\tsetConfigByInput();\n\t});\n\n\tconst keyup = useMutableCallback((event: KeyboardEvent) => {\n\t\tif (!setConfigByInput()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (popup.closeOnEsc === true && event.which === keys.ESC) {\n\t\t\tsetPopup(undefined);\n\t\t\tsetFocused(undefined);\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t}\n\t});\n\n\tconst keydown = useMutableCallback((event: KeyboardEvent) => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.which === keys.ENTER || event.which === keys.TAB) {\n\t\t\tif (!focused) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tselect(focused);\n\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t\tif (event.which === keys.ARROW_UP && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n\t\t\tsetFocused((focused) => {\n\t\t\t\tconst list = items\n\t\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\n\t\t\t\tif (!list) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst focusedIndex = list.findIndex((item) => item === focused);\n\n\t\t\t\treturn (focusedIndex > 0 ? list[focusedIndex - 1] : list[list.length - 1]) as T;\n\t\t\t});\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t\tif (event.which === keys.ARROW_DOWN && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\n\t\t\tsetFocused((focused) => {\n\t\t\t\tconst list = items\n\t\t\t\t\t.filter((item) => item.isSuccess)\n\t\t\t\t\t.flatMap((item) => item.data as T[])\n\t\t\t\t\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\n\n\t\t\t\tif (!list) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst focusedIndex = list.findIndex((item) => item === focused);\n\n\t\t\t\treturn (focusedIndex < list.length - 1 ? list[focusedIndex + 1] : list[0]) as T;\n\t\t\t});\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopImmediatePropagation();\n\t\t\treturn true;\n\t\t}\n\t});\n\n\tconst clearPopup = useMutableCallback(() => {\n\t\tif (!popup) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetPopup(undefined);\n\t\tsetFocused(undefined);\n\t\tsetFilter('');\n\t});\n\n\tconst callbackRef = useCallback(\n\t\t(node: HTMLElement | null) => {\n\t\t\tif (!node) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnode.addEventListener('keyup', keyup);\n\t\t\tnode.addEventListener('keydown', keydown);\n\t\t\tnode.addEventListener('focus', onFocus);\n\t\t},\n\t\t[keyup, keydown, onFocus],\n\t);\n\n\tif (!popup) {\n\t\treturn {\n\t\t\tcallbackRef,\n\t\t\tfocused: undefined,\n\t\t\titems: undefined,\n\t\t\tariaActiveDescendant: undefined,\n\t\t\tpopup: undefined,\n\t\t\tselect: undefined,\n\t\t\tsuspended: true,\n\t\t\tcommandsRef,\n\t\t\tfilter: undefined,\n\t\t\tclearPopup,\n\t\t};\n\t}\n\n\treturn {\n\t\tfocused,\n\t\titems,\n\t\tariaActiveDescendant,\n\t\tpopup,\n\t\tselect,\n\t\tfilter,\n\t\tsuspended,\n\t\tcommandsRef,\n\t\tcallbackRef,\n\t\tclearPopup,\n\t};\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"0dd276ab625c87f9d80383b9b0d11649f0e16fa0"}
