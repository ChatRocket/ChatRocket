{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/providers/VideoConfProvider.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/providers/VideoConfProvider.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/providers/VideoConfProvider.tsx","inputSourceMap":{"version":3,"file":"client/providers/VideoConfProvider.tsx","sourceRoot":"","sources":["client/providers/VideoConfProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport type { ReactElement, ReactNode } from 'react';\nimport React, { useState, useMemo, useEffect } from 'react';\nimport type { Unsubscribe } from 'use-subscription';\n\nimport type { VideoConfPopupPayload } from '../contexts/VideoConfContext';\nimport { VideoConfContext } from '../contexts/VideoConfContext';\nimport type { DirectCallData, ProviderCapabilities, CallPreferences } from '../lib/VideoConfManager';\nimport { VideoConfManager } from '../lib/VideoConfManager';\nimport VideoConfPopups from '../views/room/contextualBar/VideoConference/VideoConfPopups';\nimport { useVideoConfOpenCall } from '../views/room/contextualBar/VideoConference/hooks/useVideoConfOpenCall';\n\nconst VideoConfContextProvider = ({ children }: { children: ReactNode }): ReactElement => {\n\tconst [outgoing, setOutgoing] = useState<VideoConfPopupPayload | undefined>();\n\tconst handleOpenCall = useVideoConfOpenCall();\n\n\tuseEffect(\n\t\t() =>\n\t\t\tVideoConfManager.on('call/join', (props) => {\n\t\t\t\thandleOpenCall(props.url, props.providerName);\n\t\t\t}),\n\t\t[handleOpenCall],\n\t);\n\n\tuseEffect(() => {\n\t\tVideoConfManager.on('direct/stopped', () => setOutgoing(undefined));\n\t\tVideoConfManager.on('calling/ended', () => setOutgoing(undefined));\n\t}, []);\n\n\tconst contextValue = useMemo(\n\t\t() => ({\n\t\t\tmanager: VideoConfManager,\n\t\t\tdispatchOutgoing: (option: Omit<VideoConfPopupPayload, 'id'>): void => setOutgoing({ ...option, id: option.rid }),\n\t\t\tdismissOutgoing: (): void => setOutgoing(undefined),\n\t\t\tstartCall: (rid: IRoom['_id'], confTitle?: string): Promise<void> => VideoConfManager.startCall(rid, confTitle),\n\t\t\tacceptCall: (callId: string): void => VideoConfManager.acceptIncomingCall(callId),\n\t\t\tjoinCall: (callId: string): Promise<void> => VideoConfManager.joinCall(callId),\n\t\t\tdismissCall: (callId: string): void => {\n\t\t\t\tVideoConfManager.dismissIncomingCall(callId);\n\t\t\t},\n\t\t\trejectIncomingCall: (callId: string): void => VideoConfManager.rejectIncomingCall(callId),\n\t\t\tabortCall: (): void => VideoConfManager.abortCall(),\n\t\t\tsetPreferences: (prefs: Partial<(typeof VideoConfManager)['preferences']>): void => VideoConfManager.setPreferences(prefs),\n\t\t\tqueryIncomingCalls: {\n\t\t\t\tgetCurrentValue: (): DirectCallData[] => [], // VideoConfManager.getIncomingDirectCalls(),\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('incoming/changed', cb),\n\t\t\t},\n\t\t\tqueryRinging: {\n\t\t\t\tgetCurrentValue: (): boolean => VideoConfManager.isRinging(),\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('ringing/changed', cb),\n\t\t\t},\n\t\t\tqueryCalling: {\n\t\t\t\tgetCurrentValue: (): boolean => VideoConfManager.isCalling(),\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('calling/changed', cb),\n\t\t\t},\n\t\t\tqueryCapabilities: {\n\t\t\t\tgetCurrentValue: (): ProviderCapabilities => VideoConfManager.capabilities,\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('capabilities/changed', cb),\n\t\t\t},\n\t\t\tqueryPreferences: {\n\t\t\t\tgetCurrentValue: (): CallPreferences => VideoConfManager.preferences,\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('preference/changed', cb),\n\t\t\t},\n\t\t}),\n\t\t[],\n\t);\n\n\treturn (\n\t\t<VideoConfContext.Provider value={contextValue}>\n\t\t\t{children}\n\t\t\t<VideoConfPopups>{outgoing}</VideoConfPopups>\n\t\t</VideoConfContext.Provider>\n\t);\n};\n\nexport default VideoConfContextProvider;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/providers/VideoConfProvider.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/providers/VideoConfProvider.tsx","inputSourceMap":{"version":3,"file":"client/providers/VideoConfProvider.tsx","sourceRoot":"","sources":["client/providers/VideoConfProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport type { ReactElement, ReactNode } from 'react';\nimport React, { useState, useMemo, useEffect } from 'react';\nimport type { Unsubscribe } from 'use-subscription';\n\nimport type { VideoConfPopupPayload } from '../contexts/VideoConfContext';\nimport { VideoConfContext } from '../contexts/VideoConfContext';\nimport type { DirectCallData, ProviderCapabilities, CallPreferences } from '../lib/VideoConfManager';\nimport { VideoConfManager } from '../lib/VideoConfManager';\nimport VideoConfPopups from '../views/room/contextualBar/VideoConference/VideoConfPopups';\nimport { useVideoConfOpenCall } from '../views/room/contextualBar/VideoConference/hooks/useVideoConfOpenCall';\n\nconst VideoConfContextProvider = ({ children }: { children: ReactNode }): ReactElement => {\n\tconst [outgoing, setOutgoing] = useState<VideoConfPopupPayload | undefined>();\n\tconst handleOpenCall = useVideoConfOpenCall();\n\n\tuseEffect(\n\t\t() =>\n\t\t\tVideoConfManager.on('call/join', (props) => {\n\t\t\t\thandleOpenCall(props.url, props.providerName);\n\t\t\t}),\n\t\t[handleOpenCall],\n\t);\n\n\tuseEffect(() => {\n\t\tVideoConfManager.on('direct/stopped', () => setOutgoing(undefined));\n\t\tVideoConfManager.on('calling/ended', () => setOutgoing(undefined));\n\t}, []);\n\n\tconst contextValue = useMemo(\n\t\t() => ({\n\t\t\tmanager: VideoConfManager,\n\t\t\tdispatchOutgoing: (option: Omit<VideoConfPopupPayload, 'id'>): void => setOutgoing({ ...option, id: option.rid }),\n\t\t\tdismissOutgoing: (): void => setOutgoing(undefined),\n\t\t\tstartCall: (rid: IRoom['_id'], confTitle?: string): Promise<void> => VideoConfManager.startCall(rid, confTitle),\n\t\t\tacceptCall: (callId: string): void => VideoConfManager.acceptIncomingCall(callId),\n\t\t\tjoinCall: (callId: string): Promise<void> => VideoConfManager.joinCall(callId),\n\t\t\tdismissCall: (callId: string): void => {\n\t\t\t\tVideoConfManager.dismissIncomingCall(callId);\n\t\t\t},\n\t\t\trejectIncomingCall: (callId: string): void => VideoConfManager.rejectIncomingCall(callId),\n\t\t\tabortCall: (): void => VideoConfManager.abortCall(),\n\t\t\tsetPreferences: (prefs: Partial<(typeof VideoConfManager)['preferences']>): void => VideoConfManager.setPreferences(prefs),\n\t\t\tqueryIncomingCalls: {\n\t\t\t\tgetCurrentValue: (): DirectCallData[] => [], // VideoConfManager.getIncomingDirectCalls(),\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('incoming/changed', cb),\n\t\t\t},\n\t\t\tqueryRinging: {\n\t\t\t\tgetCurrentValue: (): boolean => VideoConfManager.isRinging(),\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('ringing/changed', cb),\n\t\t\t},\n\t\t\tqueryCalling: {\n\t\t\t\tgetCurrentValue: (): boolean => VideoConfManager.isCalling(),\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('calling/changed', cb),\n\t\t\t},\n\t\t\tqueryCapabilities: {\n\t\t\t\tgetCurrentValue: (): ProviderCapabilities => VideoConfManager.capabilities,\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('capabilities/changed', cb),\n\t\t\t},\n\t\t\tqueryPreferences: {\n\t\t\t\tgetCurrentValue: (): CallPreferences => VideoConfManager.preferences,\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('preference/changed', cb),\n\t\t\t},\n\t\t}),\n\t\t[],\n\t);\n\n\treturn (\n\t\t<VideoConfContext.Provider value={contextValue}>\n\t\t\t{children}\n\t\t\t<VideoConfPopups>{outgoing}</VideoConfPopups>\n\t\t</VideoConfContext.Provider>\n\t);\n};\n\nexport default VideoConfContextProvider;\n"]}}},"code":"let _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n}, 0);\nlet React, useState, useMemo, useEffect;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n  useState(v) {\n    useState = v;\n  },\n  useMemo(v) {\n    useMemo = v;\n  },\n  useEffect(v) {\n    useEffect = v;\n  }\n}, 0);\nlet VideoConfContext;\nmodule.link(\"../contexts/VideoConfContext\", {\n  VideoConfContext(v) {\n    VideoConfContext = v;\n  }\n}, 1);\nlet VideoConfManager;\nmodule.link(\"../lib/VideoConfManager\", {\n  VideoConfManager(v) {\n    VideoConfManager = v;\n  }\n}, 2);\nlet VideoConfPopups;\nmodule.link(\"../views/room/contextualBar/VideoConference/VideoConfPopups\", {\n  default(v) {\n    VideoConfPopups = v;\n  }\n}, 3);\nlet useVideoConfOpenCall;\nmodule.link(\"../views/room/contextualBar/VideoConference/hooks/useVideoConfOpenCall\", {\n  useVideoConfOpenCall(v) {\n    useVideoConfOpenCall = v;\n  }\n}, 4);\nconst VideoConfContextProvider = _ref => {\n  let {\n    children\n  } = _ref;\n  const [outgoing, setOutgoing] = useState();\n  const handleOpenCall = useVideoConfOpenCall();\n  useEffect(() => VideoConfManager.on('call/join', props => {\n    handleOpenCall(props.url, props.providerName);\n  }), [handleOpenCall]);\n  useEffect(() => {\n    VideoConfManager.on('direct/stopped', () => setOutgoing(undefined));\n    VideoConfManager.on('calling/ended', () => setOutgoing(undefined));\n  }, []);\n  const contextValue = useMemo(() => ({\n    manager: VideoConfManager,\n    dispatchOutgoing: option => setOutgoing(_objectSpread(_objectSpread({}, option), {}, {\n      id: option.rid\n    })),\n    dismissOutgoing: () => setOutgoing(undefined),\n    startCall: (rid, confTitle) => VideoConfManager.startCall(rid, confTitle),\n    acceptCall: callId => VideoConfManager.acceptIncomingCall(callId),\n    joinCall: callId => VideoConfManager.joinCall(callId),\n    dismissCall: callId => {\n      VideoConfManager.dismissIncomingCall(callId);\n    },\n    rejectIncomingCall: callId => VideoConfManager.rejectIncomingCall(callId),\n    abortCall: () => VideoConfManager.abortCall(),\n    setPreferences: prefs => VideoConfManager.setPreferences(prefs),\n    queryIncomingCalls: {\n      getCurrentValue: () => [],\n      // VideoConfManager.getIncomingDirectCalls(),\n      subscribe: cb => VideoConfManager.on('incoming/changed', cb)\n    },\n    queryRinging: {\n      getCurrentValue: () => VideoConfManager.isRinging(),\n      subscribe: cb => VideoConfManager.on('ringing/changed', cb)\n    },\n    queryCalling: {\n      getCurrentValue: () => VideoConfManager.isCalling(),\n      subscribe: cb => VideoConfManager.on('calling/changed', cb)\n    },\n    queryCapabilities: {\n      getCurrentValue: () => VideoConfManager.capabilities,\n      subscribe: cb => VideoConfManager.on('capabilities/changed', cb)\n    },\n    queryPreferences: {\n      getCurrentValue: () => VideoConfManager.preferences,\n      subscribe: cb => VideoConfManager.on('preference/changed', cb)\n    }\n  }), []);\n  return /*#__PURE__*/React.createElement(VideoConfContext.Provider, {\n    value: contextValue\n  }, children, /*#__PURE__*/React.createElement(VideoConfPopups, null, outgoing));\n};\nmodule.exportDefault(VideoConfContextProvider);","map":{"version":3,"names":["_objectSpread","module","link","default","v","React","useState","useMemo","useEffect","VideoConfContext","VideoConfManager","VideoConfPopups","useVideoConfOpenCall","VideoConfContextProvider","_ref","children","outgoing","setOutgoing","handleOpenCall","on","props","url","providerName","undefined","contextValue","manager","dispatchOutgoing","option","id","rid","dismissOutgoing","startCall","confTitle","acceptCall","callId","acceptIncomingCall","joinCall","dismissCall","dismissIncomingCall","rejectIncomingCall","abortCall","setPreferences","prefs","queryIncomingCalls","getCurrentValue","subscribe","cb","queryRinging","isRinging","queryCalling","isCalling","queryCapabilities","capabilities","queryPreferences","preferences","createElement","Provider","value","exportDefault"],"sources":["client/providers/VideoConfProvider.tsx"],"sourcesContent":["import type { IRoom } from '@rocket.chat/core-typings';\nimport type { ReactElement, ReactNode } from 'react';\nimport React, { useState, useMemo, useEffect } from 'react';\nimport type { Unsubscribe } from 'use-subscription';\n\nimport type { VideoConfPopupPayload } from '../contexts/VideoConfContext';\nimport { VideoConfContext } from '../contexts/VideoConfContext';\nimport type { DirectCallData, ProviderCapabilities, CallPreferences } from '../lib/VideoConfManager';\nimport { VideoConfManager } from '../lib/VideoConfManager';\nimport VideoConfPopups from '../views/room/contextualBar/VideoConference/VideoConfPopups';\nimport { useVideoConfOpenCall } from '../views/room/contextualBar/VideoConference/hooks/useVideoConfOpenCall';\n\nconst VideoConfContextProvider = ({ children }: { children: ReactNode }): ReactElement => {\n\tconst [outgoing, setOutgoing] = useState<VideoConfPopupPayload | undefined>();\n\tconst handleOpenCall = useVideoConfOpenCall();\n\n\tuseEffect(\n\t\t() =>\n\t\t\tVideoConfManager.on('call/join', (props) => {\n\t\t\t\thandleOpenCall(props.url, props.providerName);\n\t\t\t}),\n\t\t[handleOpenCall],\n\t);\n\n\tuseEffect(() => {\n\t\tVideoConfManager.on('direct/stopped', () => setOutgoing(undefined));\n\t\tVideoConfManager.on('calling/ended', () => setOutgoing(undefined));\n\t}, []);\n\n\tconst contextValue = useMemo(\n\t\t() => ({\n\t\t\tmanager: VideoConfManager,\n\t\t\tdispatchOutgoing: (option: Omit<VideoConfPopupPayload, 'id'>): void => setOutgoing({ ...option, id: option.rid }),\n\t\t\tdismissOutgoing: (): void => setOutgoing(undefined),\n\t\t\tstartCall: (rid: IRoom['_id'], confTitle?: string): Promise<void> => VideoConfManager.startCall(rid, confTitle),\n\t\t\tacceptCall: (callId: string): void => VideoConfManager.acceptIncomingCall(callId),\n\t\t\tjoinCall: (callId: string): Promise<void> => VideoConfManager.joinCall(callId),\n\t\t\tdismissCall: (callId: string): void => {\n\t\t\t\tVideoConfManager.dismissIncomingCall(callId);\n\t\t\t},\n\t\t\trejectIncomingCall: (callId: string): void => VideoConfManager.rejectIncomingCall(callId),\n\t\t\tabortCall: (): void => VideoConfManager.abortCall(),\n\t\t\tsetPreferences: (prefs: Partial<(typeof VideoConfManager)['preferences']>): void => VideoConfManager.setPreferences(prefs),\n\t\t\tqueryIncomingCalls: {\n\t\t\t\tgetCurrentValue: (): DirectCallData[] => [], // VideoConfManager.getIncomingDirectCalls(),\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('incoming/changed', cb),\n\t\t\t},\n\t\t\tqueryRinging: {\n\t\t\t\tgetCurrentValue: (): boolean => VideoConfManager.isRinging(),\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('ringing/changed', cb),\n\t\t\t},\n\t\t\tqueryCalling: {\n\t\t\t\tgetCurrentValue: (): boolean => VideoConfManager.isCalling(),\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('calling/changed', cb),\n\t\t\t},\n\t\t\tqueryCapabilities: {\n\t\t\t\tgetCurrentValue: (): ProviderCapabilities => VideoConfManager.capabilities,\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('capabilities/changed', cb),\n\t\t\t},\n\t\t\tqueryPreferences: {\n\t\t\t\tgetCurrentValue: (): CallPreferences => VideoConfManager.preferences,\n\t\t\t\tsubscribe: (cb: () => void): Unsubscribe => VideoConfManager.on('preference/changed', cb),\n\t\t\t},\n\t\t}),\n\t\t[],\n\t);\n\n\treturn (\n\t\t<VideoConfContext.Provider value={contextValue}>\n\t\t\t{children}\n\t\t\t<VideoConfPopups>{outgoing}</VideoConfPopups>\n\t\t</VideoConfContext.Provider>\n\t);\n};\n\nexport default VideoConfContextProvider;\n"],"mappings":"AAEA,IAAAA,aAAgB;AAAAC,MAAQ,CAAAC,IAAE,uCAAkC;EAAAC,QAAAC,CAAA;IAAAJ,aAAA,GAAAI,CAAA;EAAA;AAAA;AAA5D,IAAAC,KAAO,EAAAC,QAAS,EAAAC,OAAU,EAAAC,SAAS;AAAAP,MAAA,CAASC,IAAE,QAAM;EAAAC,OAAQA,CAAAC,CAAA;IAAAC,KAAA,GAAAD,CAAA;EAAA;EAAAE,SAAAF,CAAA;IAAAE,QAAA,GAAAF,CAAA;EAAA;EAAAG,QAAAH,CAAA;IAAAG,OAAA,GAAAH,CAAA;EAAA;EAAAI,UAAAJ,CAAA;IAAAI,SAAA,GAAAJ,CAAA;EAAA;AAAA;AAAA,IAAAK,gBAAA;AAAAR,MAAA,CAAAC,IAAA;EAAAO,iBAAAL,CAAA;IAAAK,gBAAA,GAAAL,CAAA;EAAA;AAAA;AAAA,IAAAM,gBAAA;AAAAT,MAAA,CAAAC,IAAA;EAAAQ,iBAAAN,CAAA;IAAAM,gBAAA,GAAAN,CAAA;EAAA;AAAA;AAAA,IAAAO,eAAA;AAAAV,MAAA,CAAAC,IAAA;EAAAC,QAAAC,CAAA;IAAAO,eAAA,GAAAP,CAAA;EAAA;AAAA;AAAA,IAAAQ,oBAAA;AAAAX,MAAA,CAAAC,IAAA;EAAAU,qBAAAR,CAAA;IAAAQ,oBAAA,GAAAR,CAAA;EAAA;AAAA;AAU5D,MAAMS,wBAAwB,GAAGC,IAAA,IAAwD;EAAA,IAAvD;IAAEC;EAAQ,CAA2B,GAAAD,IAAA;EACtE,MAAM,CAACE,QAAQ,EAAEC,WAAW,CAAC,GAAGX,QAAQ,EAAqC;EAC7E,MAAMY,cAAc,GAAGN,oBAAoB,EAAE;EAE7CJ,SAAS,CACR,MACCE,gBAAgB,CAACS,EAAE,CAAC,WAAW,EAAGC,KAAK,IAAI;IAC1CF,cAAc,CAACE,KAAK,CAACC,GAAG,EAAED,KAAK,CAACE,YAAY,CAAC;EAC9C,CAAC,CAAC,EACH,CAACJ,cAAc,CAAC,CAChB;EAEDV,SAAS,CAAC,MAAK;IACdE,gBAAgB,CAACS,EAAE,CAAC,gBAAgB,EAAE,MAAMF,WAAW,CAACM,SAAS,CAAC,CAAC;IACnEb,gBAAgB,CAACS,EAAE,CAAC,eAAe,EAAE,MAAMF,WAAW,CAACM,SAAS,CAAC,CAAC;EACnE,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMC,YAAY,GAAGjB,OAAO,CAC3B,OAAO;IACNkB,OAAO,EAAEf,gBAAgB;IACzBgB,gBAAgB,EAAGC,MAAyC,IAAWV,WAAW,CAAAjB,aAAA,CAAAA,aAAA,KAAM2B,MAAM;MAAEC,EAAE,EAAED,MAAM,CAACE;IAAG,EAAE,CAAC;IACjHC,eAAe,EAAEA,CAAA,KAAYb,WAAW,CAACM,SAAS,CAAC;IACnDQ,SAAS,EAAEA,CAACF,GAAiB,EAAEG,SAAkB,KAAoBtB,gBAAgB,CAACqB,SAAS,CAACF,GAAG,EAAEG,SAAS,CAAC;IAC/GC,UAAU,EAAGC,MAAc,IAAWxB,gBAAgB,CAACyB,kBAAkB,CAACD,MAAM,CAAC;IACjFE,QAAQ,EAAGF,MAAc,IAAoBxB,gBAAgB,CAAC0B,QAAQ,CAACF,MAAM,CAAC;IAC9EG,WAAW,EAAGH,MAAc,IAAU;MACrCxB,gBAAgB,CAAC4B,mBAAmB,CAACJ,MAAM,CAAC;IAC7C,CAAC;IACDK,kBAAkB,EAAGL,MAAc,IAAWxB,gBAAgB,CAAC6B,kBAAkB,CAACL,MAAM,CAAC;IACzFM,SAAS,EAAEA,CAAA,KAAY9B,gBAAgB,CAAC8B,SAAS,EAAE;IACnDC,cAAc,EAAGC,KAAwD,IAAWhC,gBAAgB,CAAC+B,cAAc,CAACC,KAAK,CAAC;IAC1HC,kBAAkB,EAAE;MACnBC,eAAe,EAAEA,CAAA,KAAwB,EAAE;MAAE;MAC7CC,SAAS,EAAGC,EAAc,IAAkBpC,gBAAgB,CAACS,EAAE,CAAC,kBAAkB,EAAE2B,EAAE;KACtF;IACDC,YAAY,EAAE;MACbH,eAAe,EAAEA,CAAA,KAAelC,gBAAgB,CAACsC,SAAS,EAAE;MAC5DH,SAAS,EAAGC,EAAc,IAAkBpC,gBAAgB,CAACS,EAAE,CAAC,iBAAiB,EAAE2B,EAAE;KACrF;IACDG,YAAY,EAAE;MACbL,eAAe,EAAEA,CAAA,KAAelC,gBAAgB,CAACwC,SAAS,EAAE;MAC5DL,SAAS,EAAGC,EAAc,IAAkBpC,gBAAgB,CAACS,EAAE,CAAC,iBAAiB,EAAE2B,EAAE;KACrF;IACDK,iBAAiB,EAAE;MAClBP,eAAe,EAAEA,CAAA,KAA4BlC,gBAAgB,CAAC0C,YAAY;MAC1EP,SAAS,EAAGC,EAAc,IAAkBpC,gBAAgB,CAACS,EAAE,CAAC,sBAAsB,EAAE2B,EAAE;KAC1F;IACDO,gBAAgB,EAAE;MACjBT,eAAe,EAAEA,CAAA,KAAuBlC,gBAAgB,CAAC4C,WAAW;MACpET,SAAS,EAAGC,EAAc,IAAkBpC,gBAAgB,CAACS,EAAE,CAAC,oBAAoB,EAAE2B,EAAE;;GAEzF,CAAC,EACF,EAAE,CACF;EAED,oBACCzC,KAAA,CAAAkD,aAAA,CAAC9C,gBAAgB,CAAC+C,QAAQ;IAACC,KAAK,EAAEjC;EAAa,GAC7CT,QAAQ,eACTV,KAAA,CAAAkD,aAAA,CAAC5C,eAAe,QAAEK,QAA0B,CAClB,CAAC;AAE9B,CAAC;AAvEDf,MAAA,CAAOyD,aAAS,CAyED7C,wBAzES","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"2e76791624abf5478d33ecbb67f2bd91b2890ddd"}
