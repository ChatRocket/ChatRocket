{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/contextualBar/Threads/Thread.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/room/contextualBar/Threads/Thread.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/contextualBar/Threads/Thread.tsx","inputSourceMap":{"version":3,"file":"client/views/room/contextualBar/Threads/Thread.tsx","sourceRoot":"","sources":["client/views/room/contextualBar/Threads/Thread.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { css } from '@rocket.chat/css-in-js';\nimport { Box, Modal, Skeleton } from '@rocket.chat/fuselage';\nimport { useLocalStorage } from '@rocket.chat/fuselage-hooks';\nimport { useLayoutContextualBarExpanded, useToastMessageDispatch, useTranslation, useUserId } from '@rocket.chat/ui-contexts';\nimport React from 'react';\n\nimport ThreadChat from './components/ThreadChat';\nimport ThreadSkeleton from './components/ThreadSkeleton';\nimport ThreadTitle from './components/ThreadTitle';\nimport { useThreadMainMessageQuery } from './hooks/useThreadMainMessageQuery';\nimport { useToggleFollowingThreadMutation } from './hooks/useToggleFollowingThreadMutation';\nimport {\n\tContextualbar,\n\tContextualbarHeader,\n\tContextualbarAction,\n\tContextualbarActions,\n\tContextualbarClose,\n\tContextualbarBack,\n\tContextualbarInnerContent,\n} from '../../../../components/Contextualbar';\nimport { useRoomToolbox } from '../../contexts/RoomToolboxContext';\nimport { useGoToThreadList } from '../../hooks/useGoToThreadList';\nimport ChatProvider from '../../providers/ChatProvider';\n\ntype ThreadProps = {\n\ttmid: IMessage['_id'];\n};\n\nconst Thread = ({ tmid }: ThreadProps) => {\n\tconst goToThreadList = useGoToThreadList({ replace: true });\n\tconst { closeTab } = useRoomToolbox();\n\n\tconst mainMessageQueryResult = useThreadMainMessageQuery(tmid, {\n\t\tonDelete: () => {\n\t\t\tcloseTab();\n\t\t},\n\t});\n\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst canExpand = useLayoutContextualBarExpanded();\n\tconst [expanded, setExpanded] = useLocalStorage('expand-threads', false);\n\n\tconst uid = useUserId();\n\tconst following = uid ? (mainMessageQueryResult.data?.replies?.includes(uid) ?? false) : false;\n\tconst toggleFollowingMutation = useToggleFollowingThreadMutation({\n\t\tonError: (error) => {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t});\n\n\tconst handleBackdropClick = () => {\n\t\tcloseTab();\n\t};\n\n\tconst handleGoBack = () => {\n\t\tgoToThreadList();\n\t};\n\n\tconst handleToggleExpand = () => {\n\t\tsetExpanded((expanded) => !expanded);\n\t};\n\n\tconst handleToggleFollowing = () => {\n\t\tconst rid = mainMessageQueryResult.data?.rid;\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\n\t\ttoggleFollowingMutation.mutate({ rid, tmid, follow: !following });\n\t};\n\n\tconst handleClose = () => {\n\t\tcloseTab();\n\t};\n\n\treturn (\n\t\t<ContextualbarInnerContent>\n\t\t\t{canExpand && expanded && <Modal.Backdrop onClick={handleBackdropClick} />}\n\t\t\t<Box flexGrow={1} position={expanded ? 'static' : 'relative'}>\n\t\t\t\t<Contextualbar\n\t\t\t\t\trcx-thread-view\n\t\t\t\t\tclassName={\n\t\t\t\t\t\tcanExpand && expanded\n\t\t\t\t\t\t\t? css`\n\t\t\t\t\t\t\t\t\tmax-width: 855px !important;\n\t\t\t\t\t\t\t\t\t@media (min-width: 780px) and (max-width: 1135px) {\n\t\t\t\t\t\t\t\t\t\tmax-width: calc(100% - var(--sidebar-width)) !important;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t`\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t}\n\t\t\t\t\tposition={expanded ? 'fixed' : 'absolute'}\n\t\t\t\t\tdisplay='flex'\n\t\t\t\t\tflexDirection='column'\n\t\t\t\t\twidth='full'\n\t\t\t\t\toverflow='hidden'\n\t\t\t\t\tzIndex={100}\n\t\t\t\t\tinsetBlock={0}\n\t\t\t\t\tborder='none'\n\t\t\t\t>\n\t\t\t\t\t<ContextualbarHeader expanded={expanded}>\n\t\t\t\t\t\t<ContextualbarBack onClick={handleGoBack} />\n\t\t\t\t\t\t{(mainMessageQueryResult.isLoading && <Skeleton width='100%' />) ||\n\t\t\t\t\t\t\t(mainMessageQueryResult.isSuccess && <ThreadTitle mainMessage={mainMessageQueryResult.data} />) ||\n\t\t\t\t\t\t\tnull}\n\t\t\t\t\t\t<ContextualbarActions>\n\t\t\t\t\t\t\t{canExpand && (\n\t\t\t\t\t\t\t\t<ContextualbarAction\n\t\t\t\t\t\t\t\t\tname={expanded ? 'arrow-collapse' : 'arrow-expand'}\n\t\t\t\t\t\t\t\t\ttitle={expanded ? t('Collapse') : t('Expand')}\n\t\t\t\t\t\t\t\t\tonClick={handleToggleExpand}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t<ContextualbarAction\n\t\t\t\t\t\t\t\tname={following ? 'bell' : 'bell-off'}\n\t\t\t\t\t\t\t\ttitle={following ? t('Following') : t('Not_Following')}\n\t\t\t\t\t\t\t\tdisabled={!mainMessageQueryResult.isSuccess || toggleFollowingMutation.isLoading}\n\t\t\t\t\t\t\t\tonClick={handleToggleFollowing}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<ContextualbarClose onClick={handleClose} />\n\t\t\t\t\t\t</ContextualbarActions>\n\t\t\t\t\t</ContextualbarHeader>\n\n\t\t\t\t\t{(mainMessageQueryResult.isLoading && <ThreadSkeleton />) ||\n\t\t\t\t\t\t(mainMessageQueryResult.isSuccess && (\n\t\t\t\t\t\t\t<ChatProvider tmid={tmid}>\n\t\t\t\t\t\t\t\t<ThreadChat mainMessage={mainMessageQueryResult.data} />\n\t\t\t\t\t\t\t</ChatProvider>\n\t\t\t\t\t\t)) ||\n\t\t\t\t\t\tnull}\n\t\t\t\t</Contextualbar>\n\t\t\t</Box>\n\t\t</ContextualbarInnerContent>\n\t);\n};\n\nexport default Thread;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/contextualBar/Threads/Thread.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/room/contextualBar/Threads/Thread.tsx","inputSourceMap":{"version":3,"file":"client/views/room/contextualBar/Threads/Thread.tsx","sourceRoot":"","sources":["client/views/room/contextualBar/Threads/Thread.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { css } from '@rocket.chat/css-in-js';\nimport { Box, Modal, Skeleton } from '@rocket.chat/fuselage';\nimport { useLocalStorage } from '@rocket.chat/fuselage-hooks';\nimport { useLayoutContextualBarExpanded, useToastMessageDispatch, useTranslation, useUserId } from '@rocket.chat/ui-contexts';\nimport React from 'react';\n\nimport ThreadChat from './components/ThreadChat';\nimport ThreadSkeleton from './components/ThreadSkeleton';\nimport ThreadTitle from './components/ThreadTitle';\nimport { useThreadMainMessageQuery } from './hooks/useThreadMainMessageQuery';\nimport { useToggleFollowingThreadMutation } from './hooks/useToggleFollowingThreadMutation';\nimport {\n\tContextualbar,\n\tContextualbarHeader,\n\tContextualbarAction,\n\tContextualbarActions,\n\tContextualbarClose,\n\tContextualbarBack,\n\tContextualbarInnerContent,\n} from '../../../../components/Contextualbar';\nimport { useRoomToolbox } from '../../contexts/RoomToolboxContext';\nimport { useGoToThreadList } from '../../hooks/useGoToThreadList';\nimport ChatProvider from '../../providers/ChatProvider';\n\ntype ThreadProps = {\n\ttmid: IMessage['_id'];\n};\n\nconst Thread = ({ tmid }: ThreadProps) => {\n\tconst goToThreadList = useGoToThreadList({ replace: true });\n\tconst { closeTab } = useRoomToolbox();\n\n\tconst mainMessageQueryResult = useThreadMainMessageQuery(tmid, {\n\t\tonDelete: () => {\n\t\t\tcloseTab();\n\t\t},\n\t});\n\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst canExpand = useLayoutContextualBarExpanded();\n\tconst [expanded, setExpanded] = useLocalStorage('expand-threads', false);\n\n\tconst uid = useUserId();\n\tconst following = uid ? (mainMessageQueryResult.data?.replies?.includes(uid) ?? false) : false;\n\tconst toggleFollowingMutation = useToggleFollowingThreadMutation({\n\t\tonError: (error) => {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t});\n\n\tconst handleBackdropClick = () => {\n\t\tcloseTab();\n\t};\n\n\tconst handleGoBack = () => {\n\t\tgoToThreadList();\n\t};\n\n\tconst handleToggleExpand = () => {\n\t\tsetExpanded((expanded) => !expanded);\n\t};\n\n\tconst handleToggleFollowing = () => {\n\t\tconst rid = mainMessageQueryResult.data?.rid;\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\n\t\ttoggleFollowingMutation.mutate({ rid, tmid, follow: !following });\n\t};\n\n\tconst handleClose = () => {\n\t\tcloseTab();\n\t};\n\n\treturn (\n\t\t<ContextualbarInnerContent>\n\t\t\t{canExpand && expanded && <Modal.Backdrop onClick={handleBackdropClick} />}\n\t\t\t<Box flexGrow={1} position={expanded ? 'static' : 'relative'}>\n\t\t\t\t<Contextualbar\n\t\t\t\t\trcx-thread-view\n\t\t\t\t\tclassName={\n\t\t\t\t\t\tcanExpand && expanded\n\t\t\t\t\t\t\t? css`\n\t\t\t\t\t\t\t\t\tmax-width: 855px !important;\n\t\t\t\t\t\t\t\t\t@media (min-width: 780px) and (max-width: 1135px) {\n\t\t\t\t\t\t\t\t\t\tmax-width: calc(100% - var(--sidebar-width)) !important;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t`\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t}\n\t\t\t\t\tposition={expanded ? 'fixed' : 'absolute'}\n\t\t\t\t\tdisplay='flex'\n\t\t\t\t\tflexDirection='column'\n\t\t\t\t\twidth='full'\n\t\t\t\t\toverflow='hidden'\n\t\t\t\t\tzIndex={100}\n\t\t\t\t\tinsetBlock={0}\n\t\t\t\t\tborder='none'\n\t\t\t\t>\n\t\t\t\t\t<ContextualbarHeader expanded={expanded}>\n\t\t\t\t\t\t<ContextualbarBack onClick={handleGoBack} />\n\t\t\t\t\t\t{(mainMessageQueryResult.isLoading && <Skeleton width='100%' />) ||\n\t\t\t\t\t\t\t(mainMessageQueryResult.isSuccess && <ThreadTitle mainMessage={mainMessageQueryResult.data} />) ||\n\t\t\t\t\t\t\tnull}\n\t\t\t\t\t\t<ContextualbarActions>\n\t\t\t\t\t\t\t{canExpand && (\n\t\t\t\t\t\t\t\t<ContextualbarAction\n\t\t\t\t\t\t\t\t\tname={expanded ? 'arrow-collapse' : 'arrow-expand'}\n\t\t\t\t\t\t\t\t\ttitle={expanded ? t('Collapse') : t('Expand')}\n\t\t\t\t\t\t\t\t\tonClick={handleToggleExpand}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t<ContextualbarAction\n\t\t\t\t\t\t\t\tname={following ? 'bell' : 'bell-off'}\n\t\t\t\t\t\t\t\ttitle={following ? t('Following') : t('Not_Following')}\n\t\t\t\t\t\t\t\tdisabled={!mainMessageQueryResult.isSuccess || toggleFollowingMutation.isLoading}\n\t\t\t\t\t\t\t\tonClick={handleToggleFollowing}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<ContextualbarClose onClick={handleClose} />\n\t\t\t\t\t\t</ContextualbarActions>\n\t\t\t\t\t</ContextualbarHeader>\n\n\t\t\t\t\t{(mainMessageQueryResult.isLoading && <ThreadSkeleton />) ||\n\t\t\t\t\t\t(mainMessageQueryResult.isSuccess && (\n\t\t\t\t\t\t\t<ChatProvider tmid={tmid}>\n\t\t\t\t\t\t\t\t<ThreadChat mainMessage={mainMessageQueryResult.data} />\n\t\t\t\t\t\t\t</ChatProvider>\n\t\t\t\t\t\t)) ||\n\t\t\t\t\t\tnull}\n\t\t\t\t</Contextualbar>\n\t\t\t</Box>\n\t\t</ContextualbarInnerContent>\n\t);\n};\n\nexport default Thread;\n"]}}},"code":"var _templateObject;\nlet _taggedTemplateLiteral;\nmodule.link(\"@babel/runtime/helpers/taggedTemplateLiteral\", {\n  default(v) {\n    _taggedTemplateLiteral = v;\n  }\n}, 0);\nlet css;\nmodule.link(\"@rocket.chat/css-in-js\", {\n  css(v) {\n    css = v;\n  }\n}, 0);\nlet Box, Modal, Skeleton;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Box(v) {\n    Box = v;\n  },\n  Modal(v) {\n    Modal = v;\n  },\n  Skeleton(v) {\n    Skeleton = v;\n  }\n}, 1);\nlet useLocalStorage;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useLocalStorage(v) {\n    useLocalStorage = v;\n  }\n}, 2);\nlet useLayoutContextualBarExpanded, useToastMessageDispatch, useTranslation, useUserId;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useLayoutContextualBarExpanded(v) {\n    useLayoutContextualBarExpanded = v;\n  },\n  useToastMessageDispatch(v) {\n    useToastMessageDispatch = v;\n  },\n  useTranslation(v) {\n    useTranslation = v;\n  },\n  useUserId(v) {\n    useUserId = v;\n  }\n}, 3);\nlet React;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  }\n}, 4);\nlet ThreadChat;\nmodule.link(\"./components/ThreadChat\", {\n  default(v) {\n    ThreadChat = v;\n  }\n}, 5);\nlet ThreadSkeleton;\nmodule.link(\"./components/ThreadSkeleton\", {\n  default(v) {\n    ThreadSkeleton = v;\n  }\n}, 6);\nlet ThreadTitle;\nmodule.link(\"./components/ThreadTitle\", {\n  default(v) {\n    ThreadTitle = v;\n  }\n}, 7);\nlet useThreadMainMessageQuery;\nmodule.link(\"./hooks/useThreadMainMessageQuery\", {\n  useThreadMainMessageQuery(v) {\n    useThreadMainMessageQuery = v;\n  }\n}, 8);\nlet useToggleFollowingThreadMutation;\nmodule.link(\"./hooks/useToggleFollowingThreadMutation\", {\n  useToggleFollowingThreadMutation(v) {\n    useToggleFollowingThreadMutation = v;\n  }\n}, 9);\nlet Contextualbar, ContextualbarHeader, ContextualbarAction, ContextualbarActions, ContextualbarClose, ContextualbarBack, ContextualbarInnerContent;\nmodule.link(\"../../../../components/Contextualbar\", {\n  Contextualbar(v) {\n    Contextualbar = v;\n  },\n  ContextualbarHeader(v) {\n    ContextualbarHeader = v;\n  },\n  ContextualbarAction(v) {\n    ContextualbarAction = v;\n  },\n  ContextualbarActions(v) {\n    ContextualbarActions = v;\n  },\n  ContextualbarClose(v) {\n    ContextualbarClose = v;\n  },\n  ContextualbarBack(v) {\n    ContextualbarBack = v;\n  },\n  ContextualbarInnerContent(v) {\n    ContextualbarInnerContent = v;\n  }\n}, 10);\nlet useRoomToolbox;\nmodule.link(\"../../contexts/RoomToolboxContext\", {\n  useRoomToolbox(v) {\n    useRoomToolbox = v;\n  }\n}, 11);\nlet useGoToThreadList;\nmodule.link(\"../../hooks/useGoToThreadList\", {\n  useGoToThreadList(v) {\n    useGoToThreadList = v;\n  }\n}, 12);\nlet ChatProvider;\nmodule.link(\"../../providers/ChatProvider\", {\n  default(v) {\n    ChatProvider = v;\n  }\n}, 13);\nconst Thread = _ref => {\n  var _mainMessageQueryResu, _mainMessageQueryResu2, _mainMessageQueryResu3;\n  let {\n    tmid\n  } = _ref;\n  const goToThreadList = useGoToThreadList({\n    replace: true\n  });\n  const {\n    closeTab\n  } = useRoomToolbox();\n  const mainMessageQueryResult = useThreadMainMessageQuery(tmid, {\n    onDelete: () => {\n      closeTab();\n    }\n  });\n  const t = useTranslation();\n  const dispatchToastMessage = useToastMessageDispatch();\n  const canExpand = useLayoutContextualBarExpanded();\n  const [expanded, setExpanded] = useLocalStorage('expand-threads', false);\n  const uid = useUserId();\n  const following = uid ? (_mainMessageQueryResu = (_mainMessageQueryResu2 = mainMessageQueryResult.data) === null || _mainMessageQueryResu2 === void 0 ? void 0 : (_mainMessageQueryResu3 = _mainMessageQueryResu2.replies) === null || _mainMessageQueryResu3 === void 0 ? void 0 : _mainMessageQueryResu3.includes(uid)) !== null && _mainMessageQueryResu !== void 0 ? _mainMessageQueryResu : false : false;\n  const toggleFollowingMutation = useToggleFollowingThreadMutation({\n    onError: error => {\n      dispatchToastMessage({\n        type: 'error',\n        message: error\n      });\n    }\n  });\n  const handleBackdropClick = () => {\n    closeTab();\n  };\n  const handleGoBack = () => {\n    goToThreadList();\n  };\n  const handleToggleExpand = () => {\n    setExpanded(expanded => !expanded);\n  };\n  const handleToggleFollowing = () => {\n    var _mainMessageQueryResu4;\n    const rid = (_mainMessageQueryResu4 = mainMessageQueryResult.data) === null || _mainMessageQueryResu4 === void 0 ? void 0 : _mainMessageQueryResu4.rid;\n    if (!rid) {\n      return;\n    }\n    toggleFollowingMutation.mutate({\n      rid,\n      tmid,\n      follow: !following\n    });\n  };\n  const handleClose = () => {\n    closeTab();\n  };\n  return /*#__PURE__*/React.createElement(ContextualbarInnerContent, null, canExpand && expanded && /*#__PURE__*/React.createElement(Modal.Backdrop, {\n    onClick: handleBackdropClick\n  }), /*#__PURE__*/React.createElement(Box, {\n    flexGrow: 1,\n    position: expanded ? 'static' : 'relative'\n  }, /*#__PURE__*/React.createElement(Contextualbar, {\n    \"rcx-thread-view\": true,\n    className: canExpand && expanded ? css(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tmax-width: 855px !important;\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t@media (min-width: 780px) and (max-width: 1135px) {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tmax-width: calc(100% - var(--sidebar-width)) !important;\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t\\t\\t\"]))) : undefined,\n    position: expanded ? 'fixed' : 'absolute',\n    display: \"flex\",\n    flexDirection: \"column\",\n    width: \"full\",\n    overflow: \"hidden\",\n    zIndex: 100,\n    insetBlock: 0,\n    border: \"none\"\n  }, /*#__PURE__*/React.createElement(ContextualbarHeader, {\n    expanded: expanded\n  }, /*#__PURE__*/React.createElement(ContextualbarBack, {\n    onClick: handleGoBack\n  }), mainMessageQueryResult.isLoading && /*#__PURE__*/React.createElement(Skeleton, {\n    width: \"100%\"\n  }) || mainMessageQueryResult.isSuccess && /*#__PURE__*/React.createElement(ThreadTitle, {\n    mainMessage: mainMessageQueryResult.data\n  }) || null, /*#__PURE__*/React.createElement(ContextualbarActions, null, canExpand && /*#__PURE__*/React.createElement(ContextualbarAction, {\n    name: expanded ? 'arrow-collapse' : 'arrow-expand',\n    title: expanded ? t('Collapse') : t('Expand'),\n    onClick: handleToggleExpand\n  }), /*#__PURE__*/React.createElement(ContextualbarAction, {\n    name: following ? 'bell' : 'bell-off',\n    title: following ? t('Following') : t('Not_Following'),\n    disabled: !mainMessageQueryResult.isSuccess || toggleFollowingMutation.isLoading,\n    onClick: handleToggleFollowing\n  }), /*#__PURE__*/React.createElement(ContextualbarClose, {\n    onClick: handleClose\n  }))), mainMessageQueryResult.isLoading && /*#__PURE__*/React.createElement(ThreadSkeleton, null) || mainMessageQueryResult.isSuccess && /*#__PURE__*/React.createElement(ChatProvider, {\n    tmid: tmid\n  }, /*#__PURE__*/React.createElement(ThreadChat, {\n    mainMessage: mainMessageQueryResult.data\n  })) || null)));\n};\nmodule.exportDefault(Thread);","map":{"version":3,"names":["_taggedTemplateLiteral","module","link","default","v","css","Box","Modal","Skeleton","useLocalStorage","useLayoutContextualBarExpanded","useToastMessageDispatch","useTranslation","useUserId","React","ThreadChat","ThreadSkeleton","ThreadTitle","useThreadMainMessageQuery","useToggleFollowingThreadMutation","Contextualbar","ContextualbarHeader","ContextualbarAction","ContextualbarActions","ContextualbarClose","ContextualbarBack","ContextualbarInnerContent","useRoomToolbox","useGoToThreadList","ChatProvider","Thread","_ref","_mainMessageQueryResu","_mainMessageQueryResu2","_mainMessageQueryResu3","tmid","goToThreadList","replace","closeTab","mainMessageQueryResult","onDelete","t","dispatchToastMessage","canExpand","expanded","setExpanded","uid","following","data","replies","includes","toggleFollowingMutation","onError","error","type","message","handleBackdropClick","handleGoBack","handleToggleExpand","handleToggleFollowing","_mainMessageQueryResu4","rid","mutate","follow","handleClose","createElement","Backdrop","onClick","flexGrow","position","className","_templateObject","undefined","display","flexDirection","width","overflow","zIndex","insetBlock","border","isLoading","isSuccess","mainMessage","name","title","disabled","exportDefault"],"sources":["client/views/room/contextualBar/Threads/Thread.tsx"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { css } from '@rocket.chat/css-in-js';\nimport { Box, Modal, Skeleton } from '@rocket.chat/fuselage';\nimport { useLocalStorage } from '@rocket.chat/fuselage-hooks';\nimport { useLayoutContextualBarExpanded, useToastMessageDispatch, useTranslation, useUserId } from '@rocket.chat/ui-contexts';\nimport React from 'react';\n\nimport ThreadChat from './components/ThreadChat';\nimport ThreadSkeleton from './components/ThreadSkeleton';\nimport ThreadTitle from './components/ThreadTitle';\nimport { useThreadMainMessageQuery } from './hooks/useThreadMainMessageQuery';\nimport { useToggleFollowingThreadMutation } from './hooks/useToggleFollowingThreadMutation';\nimport {\n\tContextualbar,\n\tContextualbarHeader,\n\tContextualbarAction,\n\tContextualbarActions,\n\tContextualbarClose,\n\tContextualbarBack,\n\tContextualbarInnerContent,\n} from '../../../../components/Contextualbar';\nimport { useRoomToolbox } from '../../contexts/RoomToolboxContext';\nimport { useGoToThreadList } from '../../hooks/useGoToThreadList';\nimport ChatProvider from '../../providers/ChatProvider';\n\ntype ThreadProps = {\n\ttmid: IMessage['_id'];\n};\n\nconst Thread = ({ tmid }: ThreadProps) => {\n\tconst goToThreadList = useGoToThreadList({ replace: true });\n\tconst { closeTab } = useRoomToolbox();\n\n\tconst mainMessageQueryResult = useThreadMainMessageQuery(tmid, {\n\t\tonDelete: () => {\n\t\t\tcloseTab();\n\t\t},\n\t});\n\n\tconst t = useTranslation();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst canExpand = useLayoutContextualBarExpanded();\n\tconst [expanded, setExpanded] = useLocalStorage('expand-threads', false);\n\n\tconst uid = useUserId();\n\tconst following = uid ? (mainMessageQueryResult.data?.replies?.includes(uid) ?? false) : false;\n\tconst toggleFollowingMutation = useToggleFollowingThreadMutation({\n\t\tonError: (error) => {\n\t\t\tdispatchToastMessage({ type: 'error', message: error });\n\t\t},\n\t});\n\n\tconst handleBackdropClick = () => {\n\t\tcloseTab();\n\t};\n\n\tconst handleGoBack = () => {\n\t\tgoToThreadList();\n\t};\n\n\tconst handleToggleExpand = () => {\n\t\tsetExpanded((expanded) => !expanded);\n\t};\n\n\tconst handleToggleFollowing = () => {\n\t\tconst rid = mainMessageQueryResult.data?.rid;\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\n\t\ttoggleFollowingMutation.mutate({ rid, tmid, follow: !following });\n\t};\n\n\tconst handleClose = () => {\n\t\tcloseTab();\n\t};\n\n\treturn (\n\t\t<ContextualbarInnerContent>\n\t\t\t{canExpand && expanded && <Modal.Backdrop onClick={handleBackdropClick} />}\n\t\t\t<Box flexGrow={1} position={expanded ? 'static' : 'relative'}>\n\t\t\t\t<Contextualbar\n\t\t\t\t\trcx-thread-view\n\t\t\t\t\tclassName={\n\t\t\t\t\t\tcanExpand && expanded\n\t\t\t\t\t\t\t? css`\n\t\t\t\t\t\t\t\t\tmax-width: 855px !important;\n\t\t\t\t\t\t\t\t\t@media (min-width: 780px) and (max-width: 1135px) {\n\t\t\t\t\t\t\t\t\t\tmax-width: calc(100% - var(--sidebar-width)) !important;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t`\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t}\n\t\t\t\t\tposition={expanded ? 'fixed' : 'absolute'}\n\t\t\t\t\tdisplay='flex'\n\t\t\t\t\tflexDirection='column'\n\t\t\t\t\twidth='full'\n\t\t\t\t\toverflow='hidden'\n\t\t\t\t\tzIndex={100}\n\t\t\t\t\tinsetBlock={0}\n\t\t\t\t\tborder='none'\n\t\t\t\t>\n\t\t\t\t\t<ContextualbarHeader expanded={expanded}>\n\t\t\t\t\t\t<ContextualbarBack onClick={handleGoBack} />\n\t\t\t\t\t\t{(mainMessageQueryResult.isLoading && <Skeleton width='100%' />) ||\n\t\t\t\t\t\t\t(mainMessageQueryResult.isSuccess && <ThreadTitle mainMessage={mainMessageQueryResult.data} />) ||\n\t\t\t\t\t\t\tnull}\n\t\t\t\t\t\t<ContextualbarActions>\n\t\t\t\t\t\t\t{canExpand && (\n\t\t\t\t\t\t\t\t<ContextualbarAction\n\t\t\t\t\t\t\t\t\tname={expanded ? 'arrow-collapse' : 'arrow-expand'}\n\t\t\t\t\t\t\t\t\ttitle={expanded ? t('Collapse') : t('Expand')}\n\t\t\t\t\t\t\t\t\tonClick={handleToggleExpand}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t<ContextualbarAction\n\t\t\t\t\t\t\t\tname={following ? 'bell' : 'bell-off'}\n\t\t\t\t\t\t\t\ttitle={following ? t('Following') : t('Not_Following')}\n\t\t\t\t\t\t\t\tdisabled={!mainMessageQueryResult.isSuccess || toggleFollowingMutation.isLoading}\n\t\t\t\t\t\t\t\tonClick={handleToggleFollowing}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<ContextualbarClose onClick={handleClose} />\n\t\t\t\t\t\t</ContextualbarActions>\n\t\t\t\t\t</ContextualbarHeader>\n\n\t\t\t\t\t{(mainMessageQueryResult.isLoading && <ThreadSkeleton />) ||\n\t\t\t\t\t\t(mainMessageQueryResult.isSuccess && (\n\t\t\t\t\t\t\t<ChatProvider tmid={tmid}>\n\t\t\t\t\t\t\t\t<ThreadChat mainMessage={mainMessageQueryResult.data} />\n\t\t\t\t\t\t\t</ChatProvider>\n\t\t\t\t\t\t)) ||\n\t\t\t\t\t\tnull}\n\t\t\t\t</Contextualbar>\n\t\t\t</Box>\n\t\t</ContextualbarInnerContent>\n\t);\n};\n\nexport default Thread;\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"1841a13f1c7b5d7f2036c4a6c8ff505ee43400dd"}
