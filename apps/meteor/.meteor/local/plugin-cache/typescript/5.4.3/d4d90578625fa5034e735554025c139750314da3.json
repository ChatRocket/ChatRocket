{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/iframeCommands.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/startup/iframeCommands.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/iframeCommands.ts","inputSourceMap":{"version":3,"file":"client/startup/iframeCommands.ts","sourceRoot":"","sources":["client/startup/iframeCommands.ts"],"names":[],"mappings":"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","sourcesContent":["import type { UserStatus, IUser } from '@rocket.chat/core-typings';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\nimport type { LocationPathname } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\n\nimport { settings } from '../../app/settings/client';\nimport { AccountBox } from '../../app/ui-utils/client/lib/AccountBox';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { afterLogoutCleanUpCallback } from '../../lib/callbacks/afterLogoutCleanUpCallback';\nimport { capitalize, ltrim, rtrim } from '../../lib/utils/stringUtils';\nimport { baseURI } from '../lib/baseURI';\nimport { loginServices } from '../lib/loginServices';\nimport { router } from '../providers/RouterProvider';\n\nconst commands = {\n\t'go'(data: { path: string }) {\n\t\tif (typeof data.path !== 'string' || data.path.trim().length === 0) {\n\t\t\treturn console.error('`path` not defined');\n\t\t}\n\t\tconst newUrl = new URL(`${rtrim(baseURI, '/')}/${ltrim(data.path, '/')}`);\n\n\t\tconst newParams = Array.from(newUrl.searchParams.entries()).reduce(\n\t\t\t(ret, [key, value]) => {\n\t\t\t\tret[key] = value;\n\t\t\t\treturn ret;\n\t\t\t},\n\t\t\t{} as Record<string, string>,\n\t\t);\n\n\t\tconst newPath = newUrl.pathname.replace(\n\t\t\tnew RegExp(`^${escapeRegExp(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX)}`),\n\t\t\t'',\n\t\t) as LocationPathname;\n\t\trouter.navigate({\n\t\t\tpathname: newPath,\n\t\t\tsearch: { ...router.getSearchParameters(), ...newParams },\n\t\t});\n\t},\n\n\t'set-user-status'(data: { status: UserStatus }) {\n\t\tAccountBox.setStatus(data.status);\n\t},\n\n\t'call-custom-oauth-login'(data: { service: string; redirectUrl?: string | null }, event: MessageEvent) {\n\t\tconst customOAuthCallback = (response: unknown) => {\n\t\t\tevent.source?.postMessage(\n\t\t\t\t{\n\t\t\t\t\tevent: 'custom-oauth-callback',\n\t\t\t\t\tresponse,\n\t\t\t\t},\n\t\t\t\t{ targetOrigin: event.origin },\n\t\t\t);\n\t\t};\n\n\t\tconst siteUrl = `${Meteor.settings.Site_Url}/`;\n\t\tif (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\n\t\t\tdata.redirectUrl = null;\n\t\t}\n\n\t\tif (typeof data.service === 'string' && window.ServiceConfiguration) {\n\t\t\tconst customOauth = loginServices.getLoginService(data.service);\n\n\t\t\tif (customOauth) {\n\t\t\t\tconst customLoginWith = (Meteor as any)[`loginWith${capitalize(customOauth.service, true)}`];\n\t\t\t\tconst customRedirectUri = data.redirectUrl || siteUrl;\n\t\t\t\tcustomLoginWith.call(Meteor, { redirectUrl: customRedirectUri }, customOAuthCallback);\n\t\t\t}\n\t\t}\n\t},\n\n\t'login-with-token'(data: { token: string }) {\n\t\tif (typeof data.token === 'string') {\n\t\t\tMeteor.loginWithToken(data.token, () => {\n\t\t\t\tconsole.log('Iframe command [login-with-token]: result', data);\n\t\t\t});\n\t\t}\n\t},\n\n\tasync 'logout'() {\n\t\tconst user = Meteor.user();\n\t\tMeteor.logout(() => {\n\t\t\tif (!user) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvoid afterLogoutCleanUpCallback.run(user);\n\t\t\tsdk.call('logoutCleanUp', user as unknown as IUser);\n\t\t\treturn router.navigate('/home');\n\t\t});\n\t},\n} as const;\n\ntype CommandMessage<TCommandName extends keyof typeof commands = keyof typeof commands> = {\n\texternalCommand: TCommandName;\n} & Parameters<(typeof commands)[TCommandName]>[0];\n\nwindow.addEventListener('message', <TCommandMessage extends CommandMessage>(e: MessageEvent<TCommandMessage>) => {\n\tif (!settings.get<boolean>('Iframe_Integration_receive_enable')) {\n\t\treturn;\n\t}\n\n\tif (typeof e.data !== 'object' || typeof e.data.externalCommand !== 'string') {\n\t\treturn;\n\t}\n\n\tconst origins = settings.get<string>('Iframe_Integration_receive_origin');\n\n\tif (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\n\t\tconsole.error('Origin not allowed', e.origin);\n\t\treturn;\n\t}\n\n\tif (!(e.data.externalCommand in commands)) {\n\t\tconsole.error('Command not allowed', e.data.externalCommand);\n\t\treturn;\n\t}\n\n\tconst command: (data: any, event: MessageEvent) => void = commands[e.data.externalCommand];\n\tcommand(e.data, e);\n});\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/iframeCommands.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/startup/iframeCommands.ts","inputSourceMap":{"version":3,"file":"client/startup/iframeCommands.ts","sourceRoot":"","sources":["client/startup/iframeCommands.ts"],"names":[],"mappings":"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","sourcesContent":["import type { UserStatus, IUser } from '@rocket.chat/core-typings';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\nimport type { LocationPathname } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\n\nimport { settings } from '../../app/settings/client';\nimport { AccountBox } from '../../app/ui-utils/client/lib/AccountBox';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { afterLogoutCleanUpCallback } from '../../lib/callbacks/afterLogoutCleanUpCallback';\nimport { capitalize, ltrim, rtrim } from '../../lib/utils/stringUtils';\nimport { baseURI } from '../lib/baseURI';\nimport { loginServices } from '../lib/loginServices';\nimport { router } from '../providers/RouterProvider';\n\nconst commands = {\n\t'go'(data: { path: string }) {\n\t\tif (typeof data.path !== 'string' || data.path.trim().length === 0) {\n\t\t\treturn console.error('`path` not defined');\n\t\t}\n\t\tconst newUrl = new URL(`${rtrim(baseURI, '/')}/${ltrim(data.path, '/')}`);\n\n\t\tconst newParams = Array.from(newUrl.searchParams.entries()).reduce(\n\t\t\t(ret, [key, value]) => {\n\t\t\t\tret[key] = value;\n\t\t\t\treturn ret;\n\t\t\t},\n\t\t\t{} as Record<string, string>,\n\t\t);\n\n\t\tconst newPath = newUrl.pathname.replace(\n\t\t\tnew RegExp(`^${escapeRegExp(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX)}`),\n\t\t\t'',\n\t\t) as LocationPathname;\n\t\trouter.navigate({\n\t\t\tpathname: newPath,\n\t\t\tsearch: { ...router.getSearchParameters(), ...newParams },\n\t\t});\n\t},\n\n\t'set-user-status'(data: { status: UserStatus }) {\n\t\tAccountBox.setStatus(data.status);\n\t},\n\n\t'call-custom-oauth-login'(data: { service: string; redirectUrl?: string | null }, event: MessageEvent) {\n\t\tconst customOAuthCallback = (response: unknown) => {\n\t\t\tevent.source?.postMessage(\n\t\t\t\t{\n\t\t\t\t\tevent: 'custom-oauth-callback',\n\t\t\t\t\tresponse,\n\t\t\t\t},\n\t\t\t\t{ targetOrigin: event.origin },\n\t\t\t);\n\t\t};\n\n\t\tconst siteUrl = `${Meteor.settings.Site_Url}/`;\n\t\tif (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\n\t\t\tdata.redirectUrl = null;\n\t\t}\n\n\t\tif (typeof data.service === 'string' && window.ServiceConfiguration) {\n\t\t\tconst customOauth = loginServices.getLoginService(data.service);\n\n\t\t\tif (customOauth) {\n\t\t\t\tconst customLoginWith = (Meteor as any)[`loginWith${capitalize(customOauth.service, true)}`];\n\t\t\t\tconst customRedirectUri = data.redirectUrl || siteUrl;\n\t\t\t\tcustomLoginWith.call(Meteor, { redirectUrl: customRedirectUri }, customOAuthCallback);\n\t\t\t}\n\t\t}\n\t},\n\n\t'login-with-token'(data: { token: string }) {\n\t\tif (typeof data.token === 'string') {\n\t\t\tMeteor.loginWithToken(data.token, () => {\n\t\t\t\tconsole.log('Iframe command [login-with-token]: result', data);\n\t\t\t});\n\t\t}\n\t},\n\n\tasync 'logout'() {\n\t\tconst user = Meteor.user();\n\t\tMeteor.logout(() => {\n\t\t\tif (!user) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvoid afterLogoutCleanUpCallback.run(user);\n\t\t\tsdk.call('logoutCleanUp', user as unknown as IUser);\n\t\t\treturn router.navigate('/home');\n\t\t});\n\t},\n} as const;\n\ntype CommandMessage<TCommandName extends keyof typeof commands = keyof typeof commands> = {\n\texternalCommand: TCommandName;\n} & Parameters<(typeof commands)[TCommandName]>[0];\n\nwindow.addEventListener('message', <TCommandMessage extends CommandMessage>(e: MessageEvent<TCommandMessage>) => {\n\tif (!settings.get<boolean>('Iframe_Integration_receive_enable')) {\n\t\treturn;\n\t}\n\n\tif (typeof e.data !== 'object' || typeof e.data.externalCommand !== 'string') {\n\t\treturn;\n\t}\n\n\tconst origins = settings.get<string>('Iframe_Integration_receive_origin');\n\n\tif (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\n\t\tconsole.error('Origin not allowed', e.origin);\n\t\treturn;\n\t}\n\n\tif (!(e.data.externalCommand in commands)) {\n\t\tconsole.error('Command not allowed', e.data.externalCommand);\n\t\treturn;\n\t}\n\n\tconst command: (data: any, event: MessageEvent) => void = commands[e.data.externalCommand];\n\tcommand(e.data, e);\n});\n"]}}},"code":"let _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n}, 0);\nlet escapeRegExp;\nmodule.link(\"@rocket.chat/string-helpers\", {\n  escapeRegExp(v) {\n    escapeRegExp = v;\n  }\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n}, 1);\nlet settings;\nmodule.link(\"../../app/settings/client\", {\n  settings(v) {\n    settings = v;\n  }\n}, 2);\nlet AccountBox;\nmodule.link(\"../../app/ui-utils/client/lib/AccountBox\", {\n  AccountBox(v) {\n    AccountBox = v;\n  }\n}, 3);\nlet sdk;\nmodule.link(\"../../app/utils/client/lib/SDKClient\", {\n  sdk(v) {\n    sdk = v;\n  }\n}, 4);\nlet afterLogoutCleanUpCallback;\nmodule.link(\"../../lib/callbacks/afterLogoutCleanUpCallback\", {\n  afterLogoutCleanUpCallback(v) {\n    afterLogoutCleanUpCallback = v;\n  }\n}, 5);\nlet capitalize, ltrim, rtrim;\nmodule.link(\"../../lib/utils/stringUtils\", {\n  capitalize(v) {\n    capitalize = v;\n  },\n  ltrim(v) {\n    ltrim = v;\n  },\n  rtrim(v) {\n    rtrim = v;\n  }\n}, 6);\nlet baseURI;\nmodule.link(\"../lib/baseURI\", {\n  baseURI(v) {\n    baseURI = v;\n  }\n}, 7);\nlet loginServices;\nmodule.link(\"../lib/loginServices\", {\n  loginServices(v) {\n    loginServices = v;\n  }\n}, 8);\nlet router;\nmodule.link(\"../providers/RouterProvider\", {\n  router(v) {\n    router = v;\n  }\n}, 9);\nconst commands = {\n  'go'(data) {\n    if (typeof data.path !== 'string' || data.path.trim().length === 0) {\n      return console.error('`path` not defined');\n    }\n    const newUrl = new URL(\"\".concat(rtrim(baseURI, '/'), \"/\").concat(ltrim(data.path, '/')));\n    const newParams = Array.from(newUrl.searchParams.entries()).reduce((ret, _ref) => {\n      let [key, value] = _ref;\n      ret[key] = value;\n      return ret;\n    }, {});\n    const newPath = newUrl.pathname.replace(new RegExp(\"^\".concat(escapeRegExp(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX))), '');\n    router.navigate({\n      pathname: newPath,\n      search: _objectSpread(_objectSpread({}, router.getSearchParameters()), newParams)\n    });\n  },\n  'set-user-status'(data) {\n    AccountBox.setStatus(data.status);\n  },\n  'call-custom-oauth-login'(data, event) {\n    const customOAuthCallback = response => {\n      var _event$source;\n      (_event$source = event.source) === null || _event$source === void 0 ? void 0 : _event$source.postMessage({\n        event: 'custom-oauth-callback',\n        response\n      }, {\n        targetOrigin: event.origin\n      });\n    };\n    const siteUrl = \"\".concat(Meteor.settings.Site_Url, \"/\");\n    if (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\n      data.redirectUrl = null;\n    }\n    if (typeof data.service === 'string' && window.ServiceConfiguration) {\n      const customOauth = loginServices.getLoginService(data.service);\n      if (customOauth) {\n        const customLoginWith = Meteor[\"loginWith\".concat(capitalize(customOauth.service, true))];\n        const customRedirectUri = data.redirectUrl || siteUrl;\n        customLoginWith.call(Meteor, {\n          redirectUrl: customRedirectUri\n        }, customOAuthCallback);\n      }\n    }\n  },\n  'login-with-token'(data) {\n    if (typeof data.token === 'string') {\n      Meteor.loginWithToken(data.token, () => {\n        console.log('Iframe command [login-with-token]: result', data);\n      });\n    }\n  },\n  async 'logout'() {\n    const user = Meteor.user();\n    Meteor.logout(() => {\n      if (!user) {\n        return;\n      }\n      void afterLogoutCleanUpCallback.run(user);\n      sdk.call('logoutCleanUp', user);\n      return router.navigate('/home');\n    });\n  }\n};\nwindow.addEventListener('message', e => {\n  if (!settings.get('Iframe_Integration_receive_enable')) {\n    return;\n  }\n  if (typeof e.data !== 'object' || typeof e.data.externalCommand !== 'string') {\n    return;\n  }\n  const origins = settings.get('Iframe_Integration_receive_origin');\n  if (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\n    console.error('Origin not allowed', e.origin);\n    return;\n  }\n  if (!(e.data.externalCommand in commands)) {\n    console.error('Command not allowed', e.data.externalCommand);\n    return;\n  }\n  const command = commands[e.data.externalCommand];\n  command(e.data, e);\n});","map":{"version":3,"names":["_objectSpread","module","link","default","v","escapeRegExp","Meteor","settings","AccountBox","sdk","afterLogoutCleanUpCallback","capitalize","ltrim","rtrim","baseURI","loginServices","router","commands","go","data","path","trim","length","console","error","newUrl","URL","concat","newParams","Array","from","searchParams","entries","reduce","ret","_ref","key","value","newPath","pathname","replace","RegExp","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","navigate","search","getSearchParameters","set-user-status","setStatus","status","call-custom-oauth-login","event","customOAuthCallback","response","_event$source","source","postMessage","targetOrigin","origin","siteUrl","Site_Url","redirectUrl","startsWith","service","window","ServiceConfiguration","customOauth","getLoginService","customLoginWith","customRedirectUri","call","login-with-token","token","loginWithToken","log","logout","user","run","addEventListener","e","get","externalCommand","origins","split","indexOf","command"],"sources":["client/startup/iframeCommands.ts"],"sourcesContent":["import type { UserStatus, IUser } from '@rocket.chat/core-typings';\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\nimport type { LocationPathname } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\n\nimport { settings } from '../../app/settings/client';\nimport { AccountBox } from '../../app/ui-utils/client/lib/AccountBox';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { afterLogoutCleanUpCallback } from '../../lib/callbacks/afterLogoutCleanUpCallback';\nimport { capitalize, ltrim, rtrim } from '../../lib/utils/stringUtils';\nimport { baseURI } from '../lib/baseURI';\nimport { loginServices } from '../lib/loginServices';\nimport { router } from '../providers/RouterProvider';\n\nconst commands = {\n\t'go'(data: { path: string }) {\n\t\tif (typeof data.path !== 'string' || data.path.trim().length === 0) {\n\t\t\treturn console.error('`path` not defined');\n\t\t}\n\t\tconst newUrl = new URL(`${rtrim(baseURI, '/')}/${ltrim(data.path, '/')}`);\n\n\t\tconst newParams = Array.from(newUrl.searchParams.entries()).reduce(\n\t\t\t(ret, [key, value]) => {\n\t\t\t\tret[key] = value;\n\t\t\t\treturn ret;\n\t\t\t},\n\t\t\t{} as Record<string, string>,\n\t\t);\n\n\t\tconst newPath = newUrl.pathname.replace(\n\t\t\tnew RegExp(`^${escapeRegExp(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX)}`),\n\t\t\t'',\n\t\t) as LocationPathname;\n\t\trouter.navigate({\n\t\t\tpathname: newPath,\n\t\t\tsearch: { ...router.getSearchParameters(), ...newParams },\n\t\t});\n\t},\n\n\t'set-user-status'(data: { status: UserStatus }) {\n\t\tAccountBox.setStatus(data.status);\n\t},\n\n\t'call-custom-oauth-login'(data: { service: string; redirectUrl?: string | null }, event: MessageEvent) {\n\t\tconst customOAuthCallback = (response: unknown) => {\n\t\t\tevent.source?.postMessage(\n\t\t\t\t{\n\t\t\t\t\tevent: 'custom-oauth-callback',\n\t\t\t\t\tresponse,\n\t\t\t\t},\n\t\t\t\t{ targetOrigin: event.origin },\n\t\t\t);\n\t\t};\n\n\t\tconst siteUrl = `${Meteor.settings.Site_Url}/`;\n\t\tif (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\n\t\t\tdata.redirectUrl = null;\n\t\t}\n\n\t\tif (typeof data.service === 'string' && window.ServiceConfiguration) {\n\t\t\tconst customOauth = loginServices.getLoginService(data.service);\n\n\t\t\tif (customOauth) {\n\t\t\t\tconst customLoginWith = (Meteor as any)[`loginWith${capitalize(customOauth.service, true)}`];\n\t\t\t\tconst customRedirectUri = data.redirectUrl || siteUrl;\n\t\t\t\tcustomLoginWith.call(Meteor, { redirectUrl: customRedirectUri }, customOAuthCallback);\n\t\t\t}\n\t\t}\n\t},\n\n\t'login-with-token'(data: { token: string }) {\n\t\tif (typeof data.token === 'string') {\n\t\t\tMeteor.loginWithToken(data.token, () => {\n\t\t\t\tconsole.log('Iframe command [login-with-token]: result', data);\n\t\t\t});\n\t\t}\n\t},\n\n\tasync 'logout'() {\n\t\tconst user = Meteor.user();\n\t\tMeteor.logout(() => {\n\t\t\tif (!user) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvoid afterLogoutCleanUpCallback.run(user);\n\t\t\tsdk.call('logoutCleanUp', user as unknown as IUser);\n\t\t\treturn router.navigate('/home');\n\t\t});\n\t},\n} as const;\n\ntype CommandMessage<TCommandName extends keyof typeof commands = keyof typeof commands> = {\n\texternalCommand: TCommandName;\n} & Parameters<(typeof commands)[TCommandName]>[0];\n\nwindow.addEventListener('message', <TCommandMessage extends CommandMessage>(e: MessageEvent<TCommandMessage>) => {\n\tif (!settings.get<boolean>('Iframe_Integration_receive_enable')) {\n\t\treturn;\n\t}\n\n\tif (typeof e.data !== 'object' || typeof e.data.externalCommand !== 'string') {\n\t\treturn;\n\t}\n\n\tconst origins = settings.get<string>('Iframe_Integration_receive_origin');\n\n\tif (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\n\t\tconsole.error('Origin not allowed', e.origin);\n\t\treturn;\n\t}\n\n\tif (!(e.data.externalCommand in commands)) {\n\t\tconsole.error('Command not allowed', e.data.externalCommand);\n\t\treturn;\n\t}\n\n\tconst command: (data: any, event: MessageEvent) => void = commands[e.data.externalCommand];\n\tcommand(e.data, e);\n});\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"d4d90578625fa5034e735554025c139750314da3"}
