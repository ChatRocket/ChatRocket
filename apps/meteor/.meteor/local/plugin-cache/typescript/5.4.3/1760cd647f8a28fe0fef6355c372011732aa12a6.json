{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/openCASLoginPopup.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/lib/openCASLoginPopup.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/openCASLoginPopup.ts","inputSourceMap":{"version":3,"file":"client/lib/openCASLoginPopup.ts","sourceRoot":"","sources":["client/lib/openCASLoginPopup.ts"],"names":[],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport { settings } from '../../app/settings/client';\n\nconst openCenteredPopup = (url: string, width: number, height: number) => {\n\tconst screenX = window.screenX ?? window.screenLeft;\n\tconst screenY = window.screenY ?? window.screenTop;\n\tconst outerWidth = window.outerWidth ?? document.body.clientWidth;\n\tconst outerHeight = window.outerHeight ?? document.body.clientHeight - 22;\n\t// XXX what is the 22? Probably the height of the title bar.\n\t// Use `outerWidth - width` and `outerHeight - height` for help in\n\t// positioning the popup centered relative to the current window\n\tconst left = screenX + (outerWidth - width) / 2;\n\tconst top = screenY + (outerHeight - height) / 2;\n\tconst features = `width=${width},height=${height},left=${left},top=${top},scrollbars=yes`;\n\n\tconst newwindow = window.open(url, 'Login', features);\n\n\tif (!newwindow) {\n\t\tthrow new Error('Could not open popup');\n\t}\n\n\tnewwindow.focus();\n\n\treturn newwindow;\n};\n\nconst getPopupUrl = (credentialToken: string): string => {\n\tconst loginUrl = settings.get<string | undefined>('CAS_login_url');\n\n\tif (!loginUrl) {\n\t\tthrow new Error('CAS_login_url not set');\n\t}\n\n\tconst appUrl = Meteor.absoluteUrl().replace(/\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\tconst serviceUrl = `${appUrl}/_cas/${credentialToken}`;\n\tconst url = new URL(loginUrl);\n\turl.searchParams.set('service', serviceUrl);\n\n\treturn url.href;\n};\n\nconst waitForPopupClose = (popup: Window) => {\n\treturn new Promise<void>((resolve) => {\n\t\tconst checkPopupOpen = setInterval(() => {\n\t\t\tif (popup.closed || popup.closed === undefined) {\n\t\t\t\tclearInterval(checkPopupOpen);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t}, 100);\n\t});\n};\n\nexport const openCASLoginPopup = async (credentialToken: string) => {\n\tconst popupWidth = settings.get<number>('CAS_popup_width') || 800;\n\tconst popupHeight = settings.get<number>('CAS_popup_height') || 600;\n\n\tconst popupUrl = getPopupUrl(credentialToken);\n\tconst popup = openCenteredPopup(popupUrl, popupWidth, popupHeight);\n\n\tawait waitForPopupClose(popup);\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/openCASLoginPopup.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/lib/openCASLoginPopup.ts","inputSourceMap":{"version":3,"file":"client/lib/openCASLoginPopup.ts","sourceRoot":"","sources":["client/lib/openCASLoginPopup.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,MAAM,eAAe,CAAC;AAEvC,OAAO,EAAE,QAAQ,EAAE,MAAM,2BAA2B,CAAC;AAErD,MAAM,iBAAiB,GAAG,CAAC,GAAW,EAAE,KAAa,EAAE,MAAc,EAAE,EAAE;IACxE,MAAM,OAAO,GAAG,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,UAAU,CAAC;IACpD,MAAM,OAAO,GAAG,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,SAAS,CAAC;IACnD,MAAM,UAAU,GAAG,MAAM,CAAC,UAAU,IAAI,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC;IAClE,MAAM,WAAW,GAAG,MAAM,CAAC,WAAW,IAAI,QAAQ,CAAC,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;IAC1E,4DAA4D;IAC5D,kEAAkE;IAClE,gEAAgE;IAChE,MAAM,IAAI,GAAG,OAAO,GAAG,CAAC,UAAU,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC;IAChD,MAAM,GAAG,GAAG,OAAO,GAAG,CAAC,WAAW,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;IACjD,MAAM,QAAQ,GAAG,SAAS,KAAK,WAAW,MAAM,SAAS,IAAI,QAAQ,GAAG,iBAAiB,CAAC;IAE1F,MAAM,SAAS,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,OAAO,EAAE,QAAQ,CAAC,CAAC;IAEtD,IAAI,CAAC,SAAS,EAAE,CAAC;QAChB,MAAM,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC;IACzC,CAAC;IAED,SAAS,CAAC,KAAK,EAAE,CAAC;IAElB,OAAO,SAAS,CAAC;AAClB,CAAC,CAAC;AAEF,MAAM,WAAW,GAAG,CAAC,eAAuB,EAAU,EAAE;IACvD,MAAM,QAAQ,GAAG,QAAQ,CAAC,GAAG,CAAqB,eAAe,CAAC,CAAC;IAEnE,IAAI,CAAC,QAAQ,EAAE,CAAC;QACf,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;IAC1C,CAAC;IAED,MAAM,MAAM,GAAG,MAAM,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,GAAG,yBAAyB,CAAC,oBAAoB,CAAC;IACxG,MAAM,UAAU,GAAG,GAAG,MAAM,SAAS,eAAe,EAAE,CAAC;IACvD,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,QAAQ,CAAC,CAAC;IAC9B,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC;IAE5C,OAAO,GAAG,CAAC,IAAI,CAAC;AACjB,CAAC,CAAC;AAEF,MAAM,iBAAiB,GAAG,CAAC,KAAa,EAAE,EAAE;IAC3C,OAAO,IAAI,OAAO,CAAO,CAAC,OAAO,EAAE,EAAE;QACpC,MAAM,cAAc,GAAG,WAAW,CAAC,GAAG,EAAE;YACvC,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,MAAM,KAAK,SAAS,EAAE,CAAC;gBAChD,aAAa,CAAC,cAAc,CAAC,CAAC;gBAC9B,OAAO,EAAE,CAAC;YACX,CAAC;QACF,CAAC,EAAE,GAAG,CAAC,CAAC;IACT,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,iBAAiB,GAAG,KAAK,EAAE,eAAuB,EAAE,EAAE;IAClE,MAAM,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAS,iBAAiB,CAAC,IAAI,GAAG,CAAC;IAClE,MAAM,WAAW,GAAG,QAAQ,CAAC,GAAG,CAAS,kBAAkB,CAAC,IAAI,GAAG,CAAC;IAEpE,MAAM,QAAQ,GAAG,WAAW,CAAC,eAAe,CAAC,CAAC;IAC9C,MAAM,KAAK,GAAG,iBAAiB,CAAC,QAAQ,EAAE,UAAU,EAAE,WAAW,CAAC,CAAC;IAEnE,MAAM,iBAAiB,CAAC,KAAK,CAAC,CAAC;AAChC,CAAC,CAAC","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport { settings } from '../../app/settings/client';\n\nconst openCenteredPopup = (url: string, width: number, height: number) => {\n\tconst screenX = window.screenX ?? window.screenLeft;\n\tconst screenY = window.screenY ?? window.screenTop;\n\tconst outerWidth = window.outerWidth ?? document.body.clientWidth;\n\tconst outerHeight = window.outerHeight ?? document.body.clientHeight - 22;\n\t// XXX what is the 22? Probably the height of the title bar.\n\t// Use `outerWidth - width` and `outerHeight - height` for help in\n\t// positioning the popup centered relative to the current window\n\tconst left = screenX + (outerWidth - width) / 2;\n\tconst top = screenY + (outerHeight - height) / 2;\n\tconst features = `width=${width},height=${height},left=${left},top=${top},scrollbars=yes`;\n\n\tconst newwindow = window.open(url, 'Login', features);\n\n\tif (!newwindow) {\n\t\tthrow new Error('Could not open popup');\n\t}\n\n\tnewwindow.focus();\n\n\treturn newwindow;\n};\n\nconst getPopupUrl = (credentialToken: string): string => {\n\tconst loginUrl = settings.get<string | undefined>('CAS_login_url');\n\n\tif (!loginUrl) {\n\t\tthrow new Error('CAS_login_url not set');\n\t}\n\n\tconst appUrl = Meteor.absoluteUrl().replace(/\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\tconst serviceUrl = `${appUrl}/_cas/${credentialToken}`;\n\tconst url = new URL(loginUrl);\n\turl.searchParams.set('service', serviceUrl);\n\n\treturn url.href;\n};\n\nconst waitForPopupClose = (popup: Window) => {\n\treturn new Promise<void>((resolve) => {\n\t\tconst checkPopupOpen = setInterval(() => {\n\t\t\tif (popup.closed || popup.closed === undefined) {\n\t\t\t\tclearInterval(checkPopupOpen);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t}, 100);\n\t});\n};\n\nexport const openCASLoginPopup = async (credentialToken: string) => {\n\tconst popupWidth = settings.get<number>('CAS_popup_width') || 800;\n\tconst popupHeight = settings.get<number>('CAS_popup_height') || 600;\n\n\tconst popupUrl = getPopupUrl(credentialToken);\n\tconst popup = openCenteredPopup(popupUrl, popupWidth, popupHeight);\n\n\tawait waitForPopupClose(popup);\n};\n"]}}},"code":"var _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nmodule.export({\n  openCASLoginPopup: function () {\n    return openCASLoginPopup;\n  }\n});\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar settings;\nmodule.link(\"../../app/settings/client\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 1);\nvar openCenteredPopup = function (url, width, height) {\n  var _window$screenX, _window$screenY, _window$outerWidth, _window$outerHeight;\n  var screenX = (_window$screenX = window.screenX) !== null && _window$screenX !== void 0 ? _window$screenX : window.screenLeft;\n  var screenY = (_window$screenY = window.screenY) !== null && _window$screenY !== void 0 ? _window$screenY : window.screenTop;\n  var outerWidth = (_window$outerWidth = window.outerWidth) !== null && _window$outerWidth !== void 0 ? _window$outerWidth : document.body.clientWidth;\n  var outerHeight = (_window$outerHeight = window.outerHeight) !== null && _window$outerHeight !== void 0 ? _window$outerHeight : document.body.clientHeight - 22;\n  // XXX what is the 22? Probably the height of the title bar.\n  // Use `outerWidth - width` and `outerHeight - height` for help in\n  // positioning the popup centered relative to the current window\n  var left = screenX + (outerWidth - width) / 2;\n  var top = screenY + (outerHeight - height) / 2;\n  var features = \"width=\" + width + \",height=\" + height + \",left=\" + left + \",top=\" + top + \",scrollbars=yes\";\n  var newwindow = window.open(url, 'Login', features);\n  if (!newwindow) {\n    throw new Error('Could not open popup');\n  }\n  newwindow.focus();\n  return newwindow;\n};\nvar getPopupUrl = function (credentialToken) {\n  var loginUrl = settings.get('CAS_login_url');\n  if (!loginUrl) {\n    throw new Error('CAS_login_url not set');\n  }\n  var appUrl = Meteor.absoluteUrl().replace(/\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n  var serviceUrl = appUrl + \"/_cas/\" + credentialToken;\n  var url = new URL(loginUrl);\n  url.searchParams.set('service', serviceUrl);\n  return url.href;\n};\nvar waitForPopupClose = function (popup) {\n  return new Promise(function (resolve) {\n    var checkPopupOpen = setInterval(function () {\n      if (popup.closed || popup.closed === undefined) {\n        clearInterval(checkPopupOpen);\n        resolve();\n      }\n    }, 100);\n  });\n};\nvar openCASLoginPopup = function () {\n  function _callee(credentialToken) {\n    var popupWidth, popupHeight, popupUrl, popup;\n    return _regeneratorRuntime.async(function () {\n      function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            popupWidth = settings.get('CAS_popup_width') || 800;\n            popupHeight = settings.get('CAS_popup_height') || 600;\n            popupUrl = getPopupUrl(credentialToken);\n            popup = openCenteredPopup(popupUrl, popupWidth, popupHeight);\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(waitForPopupClose(popup));\n          case 6:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n      return _callee$;\n    }(), null, null, null, Promise);\n  }\n  return _callee;\n}();","map":{"version":3,"names":["_regeneratorRuntime","module","link","default","v","export","openCASLoginPopup","Meteor","settings","openCenteredPopup","url","width","height","_window$screenX","_window$screenY","_window$outerWidth","_window$outerHeight","screenX","window","screenLeft","screenY","screenTop","outerWidth","document","body","clientWidth","outerHeight","clientHeight","left","top","features","newwindow","open","Error","focus","getPopupUrl","credentialToken","loginUrl","get","appUrl","absoluteUrl","replace","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","serviceUrl","URL","searchParams","set","href","waitForPopupClose","popup","Promise","resolve","checkPopupOpen","setInterval","closed","undefined","clearInterval","_callee","popupWidth","popupHeight","popupUrl","async","_callee$","_context","prev","next","awrap","stop"],"sources":["client/lib/openCASLoginPopup.ts"],"sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nimport { settings } from '../../app/settings/client';\n\nconst openCenteredPopup = (url: string, width: number, height: number) => {\n\tconst screenX = window.screenX ?? window.screenLeft;\n\tconst screenY = window.screenY ?? window.screenTop;\n\tconst outerWidth = window.outerWidth ?? document.body.clientWidth;\n\tconst outerHeight = window.outerHeight ?? document.body.clientHeight - 22;\n\t// XXX what is the 22? Probably the height of the title bar.\n\t// Use `outerWidth - width` and `outerHeight - height` for help in\n\t// positioning the popup centered relative to the current window\n\tconst left = screenX + (outerWidth - width) / 2;\n\tconst top = screenY + (outerHeight - height) / 2;\n\tconst features = `width=${width},height=${height},left=${left},top=${top},scrollbars=yes`;\n\n\tconst newwindow = window.open(url, 'Login', features);\n\n\tif (!newwindow) {\n\t\tthrow new Error('Could not open popup');\n\t}\n\n\tnewwindow.focus();\n\n\treturn newwindow;\n};\n\nconst getPopupUrl = (credentialToken: string): string => {\n\tconst loginUrl = settings.get<string | undefined>('CAS_login_url');\n\n\tif (!loginUrl) {\n\t\tthrow new Error('CAS_login_url not set');\n\t}\n\n\tconst appUrl = Meteor.absoluteUrl().replace(/\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\tconst serviceUrl = `${appUrl}/_cas/${credentialToken}`;\n\tconst url = new URL(loginUrl);\n\turl.searchParams.set('service', serviceUrl);\n\n\treturn url.href;\n};\n\nconst waitForPopupClose = (popup: Window) => {\n\treturn new Promise<void>((resolve) => {\n\t\tconst checkPopupOpen = setInterval(() => {\n\t\t\tif (popup.closed || popup.closed === undefined) {\n\t\t\t\tclearInterval(checkPopupOpen);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t}, 100);\n\t});\n};\n\nexport const openCASLoginPopup = async (credentialToken: string) => {\n\tconst popupWidth = settings.get<number>('CAS_popup_width') || 800;\n\tconst popupHeight = settings.get<number>('CAS_popup_height') || 600;\n\n\tconst popupUrl = getPopupUrl(credentialToken);\n\tconst popup = openCenteredPopup(popupUrl, popupWidth, popupHeight);\n\n\tawait waitForPopupClose(popup);\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"1760cd647f8a28fe0fef6355c372011732aa12a6"}
