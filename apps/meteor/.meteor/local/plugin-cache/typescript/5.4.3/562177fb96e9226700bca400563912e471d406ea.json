{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/contextualBar/RoomMembers/RoomMembersWithData.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/room/contextualBar/RoomMembers/RoomMembersWithData.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/contextualBar/RoomMembers/RoomMembersWithData.tsx","inputSourceMap":{"version":3,"file":"client/views/room/contextualBar/RoomMembers/RoomMembersWithData.tsx","sourceRoot":"","sources":["client/views/room/contextualBar/RoomMembers/RoomMembersWithData.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isRoomFederated, isDirectMessageRoom, isTeamRoom } from '@rocket.chat/core-typings';\nimport { useMutableCallback, useDebouncedValue, useLocalStorage } from '@rocket.chat/fuselage-hooks';\nimport { useUserRoom, useAtLeastOnePermission, useUser, usePermission, useUserSubscription } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useMemo, useState } from 'react';\n\nimport * as Federation from '../../../../lib/federation/Federation';\nimport { useMembersList } from '../../../hooks/useMembersList';\nimport { useRoomToolbox } from '../../contexts/RoomToolboxContext';\nimport UserInfoWithData from '../UserInfo';\nimport AddUsers from './AddUsers';\nimport InviteUsers from './InviteUsers';\nimport RoomMembers from './RoomMembers';\n\nenum ROOM_MEMBERS_TABS {\n\tINFO = 'user-info',\n\tINVITE = 'invite-users',\n\tADD = 'add-users',\n\tLIST = 'users-list',\n}\n\ntype validRoomType = 'd' | 'p' | 'c';\n\nconst RoomMembersWithData = ({ rid }: { rid: IRoom['_id'] }): ReactElement => {\n\tconst user = useUser();\n\tconst room = useUserRoom(rid);\n\tconst { closeTab } = useRoomToolbox();\n\tconst [type, setType] = useLocalStorage<'online' | 'all'>('members-list-type', 'online');\n\tconst [text, setText] = useState('');\n\tconst subscription = useUserSubscription(rid);\n\n\tconst isTeam = room && isTeamRoom(room);\n\tconst isDirect = room && isDirectMessageRoom(room);\n\tconst hasPermissionToCreateInviteLinks = usePermission('create-invite-links', rid);\n\tconst isFederated = room && isRoomFederated(room);\n\n\tconst canCreateInviteLinks =\n\t\troom && user && isFederated ? Federation.canCreateInviteLinks(user, room, subscription) : hasPermissionToCreateInviteLinks;\n\n\tconst [state, setState] = useState<{ tab: ROOM_MEMBERS_TABS; userId?: IUser['_id'] }>({\n\t\ttab: ROOM_MEMBERS_TABS.LIST,\n\t\tuserId: undefined,\n\t});\n\n\tconst debouncedText = useDebouncedValue(text, 800);\n\n\tconst { data, fetchNextPage, isLoading, refetch, hasNextPage } = useMembersList(\n\t\tuseMemo(() => ({ rid, type, limit: 50, debouncedText, roomType: room?.t as validRoomType }), [rid, type, debouncedText, room?.t]),\n\t);\n\n\tconst hasPermissionToAddUsers = useAtLeastOnePermission(\n\t\tuseMemo(() => [room?.t === 'p' ? 'add-user-to-any-p-room' : 'add-user-to-any-c-room', 'add-user-to-joined-room'], [room?.t]),\n\t\trid,\n\t);\n\n\tconst canAddUsers = room && user && isFederated ? Federation.isEditableByTheUser(user, room, subscription) : hasPermissionToAddUsers;\n\n\tconst handleTextChange = useCallback((event) => {\n\t\tsetText(event.currentTarget.value);\n\t}, []);\n\n\tconst openUserInfo = useMutableCallback((e) => {\n\t\tconst { userid } = e.currentTarget.dataset;\n\t\tsetState({\n\t\t\ttab: ROOM_MEMBERS_TABS.INFO,\n\t\t\tuserId: userid,\n\t\t});\n\t});\n\n\tconst openInvite = useMutableCallback(() => {\n\t\tsetState({ tab: ROOM_MEMBERS_TABS.INVITE });\n\t});\n\n\tconst openAddUser = useMutableCallback(() => {\n\t\tsetState({ tab: ROOM_MEMBERS_TABS.ADD });\n\t});\n\n\tconst handleBack = useCallback(() => {\n\t\tsetState({ tab: ROOM_MEMBERS_TABS.LIST });\n\t}, [setState]);\n\n\tif (state.tab === ROOM_MEMBERS_TABS.INFO && state.userId) {\n\t\treturn <UserInfoWithData rid={rid} uid={state.userId} onClose={closeTab} onClickBack={handleBack} />;\n\t}\n\n\tif (state.tab === ROOM_MEMBERS_TABS.INVITE) {\n\t\treturn <InviteUsers rid={rid} onClickBack={handleBack} />;\n\t}\n\n\tif (state.tab === ROOM_MEMBERS_TABS.ADD) {\n\t\treturn <AddUsers rid={rid} onClickBack={handleBack} reload={refetch} />;\n\t}\n\n\treturn (\n\t\t<RoomMembers\n\t\t\trid={rid}\n\t\t\tisTeam={isTeam}\n\t\t\tisDirect={isDirect}\n\t\t\tloading={isLoading}\n\t\t\ttype={type}\n\t\t\ttext={text}\n\t\t\tsetText={handleTextChange}\n\t\t\tsetType={setType}\n\t\t\tmembers={data?.pages?.flatMap((page) => page.members) ?? []}\n\t\t\ttotal={data?.pages[data.pages.length - 1].total ?? 0}\n\t\t\tonClickClose={closeTab}\n\t\t\tonClickView={openUserInfo}\n\t\t\tloadMoreItems={hasNextPage ? fetchNextPage : () => undefined}\n\t\t\treload={refetch}\n\t\t\tonClickInvite={canCreateInviteLinks && canAddUsers ? openInvite : undefined}\n\t\t\tonClickAdd={canAddUsers ? openAddUser : undefined}\n\t\t/>\n\t);\n};\n\nexport default RoomMembersWithData;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/contextualBar/RoomMembers/RoomMembersWithData.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/room/contextualBar/RoomMembers/RoomMembersWithData.tsx","inputSourceMap":{"version":3,"file":"client/views/room/contextualBar/RoomMembers/RoomMembersWithData.tsx","sourceRoot":"","sources":["client/views/room/contextualBar/RoomMembers/RoomMembersWithData.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isRoomFederated, isDirectMessageRoom, isTeamRoom } from '@rocket.chat/core-typings';\nimport { useMutableCallback, useDebouncedValue, useLocalStorage } from '@rocket.chat/fuselage-hooks';\nimport { useUserRoom, useAtLeastOnePermission, useUser, usePermission, useUserSubscription } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useMemo, useState } from 'react';\n\nimport * as Federation from '../../../../lib/federation/Federation';\nimport { useMembersList } from '../../../hooks/useMembersList';\nimport { useRoomToolbox } from '../../contexts/RoomToolboxContext';\nimport UserInfoWithData from '../UserInfo';\nimport AddUsers from './AddUsers';\nimport InviteUsers from './InviteUsers';\nimport RoomMembers from './RoomMembers';\n\nenum ROOM_MEMBERS_TABS {\n\tINFO = 'user-info',\n\tINVITE = 'invite-users',\n\tADD = 'add-users',\n\tLIST = 'users-list',\n}\n\ntype validRoomType = 'd' | 'p' | 'c';\n\nconst RoomMembersWithData = ({ rid }: { rid: IRoom['_id'] }): ReactElement => {\n\tconst user = useUser();\n\tconst room = useUserRoom(rid);\n\tconst { closeTab } = useRoomToolbox();\n\tconst [type, setType] = useLocalStorage<'online' | 'all'>('members-list-type', 'online');\n\tconst [text, setText] = useState('');\n\tconst subscription = useUserSubscription(rid);\n\n\tconst isTeam = room && isTeamRoom(room);\n\tconst isDirect = room && isDirectMessageRoom(room);\n\tconst hasPermissionToCreateInviteLinks = usePermission('create-invite-links', rid);\n\tconst isFederated = room && isRoomFederated(room);\n\n\tconst canCreateInviteLinks =\n\t\troom && user && isFederated ? Federation.canCreateInviteLinks(user, room, subscription) : hasPermissionToCreateInviteLinks;\n\n\tconst [state, setState] = useState<{ tab: ROOM_MEMBERS_TABS; userId?: IUser['_id'] }>({\n\t\ttab: ROOM_MEMBERS_TABS.LIST,\n\t\tuserId: undefined,\n\t});\n\n\tconst debouncedText = useDebouncedValue(text, 800);\n\n\tconst { data, fetchNextPage, isLoading, refetch, hasNextPage } = useMembersList(\n\t\tuseMemo(() => ({ rid, type, limit: 50, debouncedText, roomType: room?.t as validRoomType }), [rid, type, debouncedText, room?.t]),\n\t);\n\n\tconst hasPermissionToAddUsers = useAtLeastOnePermission(\n\t\tuseMemo(() => [room?.t === 'p' ? 'add-user-to-any-p-room' : 'add-user-to-any-c-room', 'add-user-to-joined-room'], [room?.t]),\n\t\trid,\n\t);\n\n\tconst canAddUsers = room && user && isFederated ? Federation.isEditableByTheUser(user, room, subscription) : hasPermissionToAddUsers;\n\n\tconst handleTextChange = useCallback((event) => {\n\t\tsetText(event.currentTarget.value);\n\t}, []);\n\n\tconst openUserInfo = useMutableCallback((e) => {\n\t\tconst { userid } = e.currentTarget.dataset;\n\t\tsetState({\n\t\t\ttab: ROOM_MEMBERS_TABS.INFO,\n\t\t\tuserId: userid,\n\t\t});\n\t});\n\n\tconst openInvite = useMutableCallback(() => {\n\t\tsetState({ tab: ROOM_MEMBERS_TABS.INVITE });\n\t});\n\n\tconst openAddUser = useMutableCallback(() => {\n\t\tsetState({ tab: ROOM_MEMBERS_TABS.ADD });\n\t});\n\n\tconst handleBack = useCallback(() => {\n\t\tsetState({ tab: ROOM_MEMBERS_TABS.LIST });\n\t}, [setState]);\n\n\tif (state.tab === ROOM_MEMBERS_TABS.INFO && state.userId) {\n\t\treturn <UserInfoWithData rid={rid} uid={state.userId} onClose={closeTab} onClickBack={handleBack} />;\n\t}\n\n\tif (state.tab === ROOM_MEMBERS_TABS.INVITE) {\n\t\treturn <InviteUsers rid={rid} onClickBack={handleBack} />;\n\t}\n\n\tif (state.tab === ROOM_MEMBERS_TABS.ADD) {\n\t\treturn <AddUsers rid={rid} onClickBack={handleBack} reload={refetch} />;\n\t}\n\n\treturn (\n\t\t<RoomMembers\n\t\t\trid={rid}\n\t\t\tisTeam={isTeam}\n\t\t\tisDirect={isDirect}\n\t\t\tloading={isLoading}\n\t\t\ttype={type}\n\t\t\ttext={text}\n\t\t\tsetText={handleTextChange}\n\t\t\tsetType={setType}\n\t\t\tmembers={data?.pages?.flatMap((page) => page.members) ?? []}\n\t\t\ttotal={data?.pages[data.pages.length - 1].total ?? 0}\n\t\t\tonClickClose={closeTab}\n\t\t\tonClickView={openUserInfo}\n\t\t\tloadMoreItems={hasNextPage ? fetchNextPage : () => undefined}\n\t\t\treload={refetch}\n\t\t\tonClickInvite={canCreateInviteLinks && canAddUsers ? openInvite : undefined}\n\t\t\tonClickAdd={canAddUsers ? openAddUser : undefined}\n\t\t/>\n\t);\n};\n\nexport default RoomMembersWithData;\n"]}}},"code":"let isRoomFederated, isDirectMessageRoom, isTeamRoom;\nmodule.link(\"@rocket.chat/core-typings\", {\n  isRoomFederated(v) {\n    isRoomFederated = v;\n  },\n  isDirectMessageRoom(v) {\n    isDirectMessageRoom = v;\n  },\n  isTeamRoom(v) {\n    isTeamRoom = v;\n  }\n}, 0);\nlet useMutableCallback, useDebouncedValue, useLocalStorage;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback(v) {\n    useMutableCallback = v;\n  },\n  useDebouncedValue(v) {\n    useDebouncedValue = v;\n  },\n  useLocalStorage(v) {\n    useLocalStorage = v;\n  }\n}, 1);\nlet useUserRoom, useAtLeastOnePermission, useUser, usePermission, useUserSubscription;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useUserRoom(v) {\n    useUserRoom = v;\n  },\n  useAtLeastOnePermission(v) {\n    useAtLeastOnePermission = v;\n  },\n  useUser(v) {\n    useUser = v;\n  },\n  usePermission(v) {\n    usePermission = v;\n  },\n  useUserSubscription(v) {\n    useUserSubscription = v;\n  }\n}, 2);\nlet React, useCallback, useMemo, useState;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n  useCallback(v) {\n    useCallback = v;\n  },\n  useMemo(v) {\n    useMemo = v;\n  },\n  useState(v) {\n    useState = v;\n  }\n}, 3);\nlet Federation;\nmodule.link(\"../../../../lib/federation/Federation\", {\n  \"*\"(v) {\n    Federation = v;\n  }\n}, 4);\nlet useMembersList;\nmodule.link(\"../../../hooks/useMembersList\", {\n  useMembersList(v) {\n    useMembersList = v;\n  }\n}, 5);\nlet useRoomToolbox;\nmodule.link(\"../../contexts/RoomToolboxContext\", {\n  useRoomToolbox(v) {\n    useRoomToolbox = v;\n  }\n}, 6);\nlet UserInfoWithData;\nmodule.link(\"../UserInfo\", {\n  default(v) {\n    UserInfoWithData = v;\n  }\n}, 7);\nlet AddUsers;\nmodule.link(\"./AddUsers\", {\n  default(v) {\n    AddUsers = v;\n  }\n}, 8);\nlet InviteUsers;\nmodule.link(\"./InviteUsers\", {\n  default(v) {\n    InviteUsers = v;\n  }\n}, 9);\nlet RoomMembers;\nmodule.link(\"./RoomMembers\", {\n  default(v) {\n    RoomMembers = v;\n  }\n}, 10);\nvar ROOM_MEMBERS_TABS;\n(function (ROOM_MEMBERS_TABS) {\n  ROOM_MEMBERS_TABS[\"INFO\"] = \"user-info\";\n  ROOM_MEMBERS_TABS[\"INVITE\"] = \"invite-users\";\n  ROOM_MEMBERS_TABS[\"ADD\"] = \"add-users\";\n  ROOM_MEMBERS_TABS[\"LIST\"] = \"users-list\";\n})(ROOM_MEMBERS_TABS || (ROOM_MEMBERS_TABS = {}));\nconst RoomMembersWithData = _ref => {\n  var _data$pages$flatMap, _data$pages, _data$pages$total;\n  let {\n    rid\n  } = _ref;\n  const user = useUser();\n  const room = useUserRoom(rid);\n  const {\n    closeTab\n  } = useRoomToolbox();\n  const [type, setType] = useLocalStorage('members-list-type', 'online');\n  const [text, setText] = useState('');\n  const subscription = useUserSubscription(rid);\n  const isTeam = room && isTeamRoom(room);\n  const isDirect = room && isDirectMessageRoom(room);\n  const hasPermissionToCreateInviteLinks = usePermission('create-invite-links', rid);\n  const isFederated = room && isRoomFederated(room);\n  const canCreateInviteLinks = room && user && isFederated ? Federation.canCreateInviteLinks(user, room, subscription) : hasPermissionToCreateInviteLinks;\n  const [state, setState] = useState({\n    tab: ROOM_MEMBERS_TABS.LIST,\n    userId: undefined\n  });\n  const debouncedText = useDebouncedValue(text, 800);\n  const {\n    data,\n    fetchNextPage,\n    isLoading,\n    refetch,\n    hasNextPage\n  } = useMembersList(useMemo(() => ({\n    rid,\n    type,\n    limit: 50,\n    debouncedText,\n    roomType: room === null || room === void 0 ? void 0 : room.t\n  }), [rid, type, debouncedText, room === null || room === void 0 ? void 0 : room.t]));\n  const hasPermissionToAddUsers = useAtLeastOnePermission(useMemo(() => [(room === null || room === void 0 ? void 0 : room.t) === 'p' ? 'add-user-to-any-p-room' : 'add-user-to-any-c-room', 'add-user-to-joined-room'], [room === null || room === void 0 ? void 0 : room.t]), rid);\n  const canAddUsers = room && user && isFederated ? Federation.isEditableByTheUser(user, room, subscription) : hasPermissionToAddUsers;\n  const handleTextChange = useCallback(event => {\n    setText(event.currentTarget.value);\n  }, []);\n  const openUserInfo = useMutableCallback(e => {\n    const {\n      userid\n    } = e.currentTarget.dataset;\n    setState({\n      tab: ROOM_MEMBERS_TABS.INFO,\n      userId: userid\n    });\n  });\n  const openInvite = useMutableCallback(() => {\n    setState({\n      tab: ROOM_MEMBERS_TABS.INVITE\n    });\n  });\n  const openAddUser = useMutableCallback(() => {\n    setState({\n      tab: ROOM_MEMBERS_TABS.ADD\n    });\n  });\n  const handleBack = useCallback(() => {\n    setState({\n      tab: ROOM_MEMBERS_TABS.LIST\n    });\n  }, [setState]);\n  if (state.tab === ROOM_MEMBERS_TABS.INFO && state.userId) {\n    return /*#__PURE__*/React.createElement(UserInfoWithData, {\n      rid: rid,\n      uid: state.userId,\n      onClose: closeTab,\n      onClickBack: handleBack\n    });\n  }\n  if (state.tab === ROOM_MEMBERS_TABS.INVITE) {\n    return /*#__PURE__*/React.createElement(InviteUsers, {\n      rid: rid,\n      onClickBack: handleBack\n    });\n  }\n  if (state.tab === ROOM_MEMBERS_TABS.ADD) {\n    return /*#__PURE__*/React.createElement(AddUsers, {\n      rid: rid,\n      onClickBack: handleBack,\n      reload: refetch\n    });\n  }\n  return /*#__PURE__*/React.createElement(RoomMembers, {\n    rid: rid,\n    isTeam: isTeam,\n    isDirect: isDirect,\n    loading: isLoading,\n    type: type,\n    text: text,\n    setText: handleTextChange,\n    setType: setType,\n    members: (_data$pages$flatMap = data === null || data === void 0 ? void 0 : (_data$pages = data.pages) === null || _data$pages === void 0 ? void 0 : _data$pages.flatMap(page => page.members)) !== null && _data$pages$flatMap !== void 0 ? _data$pages$flatMap : [],\n    total: (_data$pages$total = data === null || data === void 0 ? void 0 : data.pages[data.pages.length - 1].total) !== null && _data$pages$total !== void 0 ? _data$pages$total : 0,\n    onClickClose: closeTab,\n    onClickView: openUserInfo,\n    loadMoreItems: hasNextPage ? fetchNextPage : () => undefined,\n    reload: refetch,\n    onClickInvite: canCreateInviteLinks && canAddUsers ? openInvite : undefined,\n    onClickAdd: canAddUsers ? openAddUser : undefined\n  });\n};\nmodule.exportDefault(RoomMembersWithData);","map":{"version":3,"names":["isRoomFederated","isDirectMessageRoom","isTeamRoom","module","link","v","useMutableCallback","useDebouncedValue","useLocalStorage","useUserRoom","useAtLeastOnePermission","useUser","usePermission","useUserSubscription","React","useCallback","useMemo","useState","default","Federation","*","useMembersList","useRoomToolbox","UserInfoWithData","AddUsers","InviteUsers","RoomMembers","ROOM_MEMBERS_TABS","RoomMembersWithData","_ref","_data$pages$flatMap","_data$pages","_data$pages$total","rid","user","room","closeTab","type","setType","text","setText","subscription","isTeam","isDirect","hasPermissionToCreateInviteLinks","isFederated","canCreateInviteLinks","state","setState","tab","LIST","userId","undefined","debouncedText","data","fetchNextPage","isLoading","refetch","hasNextPage","limit","roomType","t","hasPermissionToAddUsers","canAddUsers","isEditableByTheUser","handleTextChange","event","currentTarget","value","openUserInfo","e","userid","dataset","INFO","openInvite","INVITE","openAddUser","ADD","handleBack","createElement","uid","onClose","onClickBack","reload","loading","members","pages","flatMap","page","total","length","onClickClose","onClickView","loadMoreItems","onClickInvite","onClickAdd","exportDefault"],"sources":["client/views/room/contextualBar/RoomMembers/RoomMembersWithData.tsx"],"sourcesContent":["import type { IRoom, IUser } from '@rocket.chat/core-typings';\nimport { isRoomFederated, isDirectMessageRoom, isTeamRoom } from '@rocket.chat/core-typings';\nimport { useMutableCallback, useDebouncedValue, useLocalStorage } from '@rocket.chat/fuselage-hooks';\nimport { useUserRoom, useAtLeastOnePermission, useUser, usePermission, useUserSubscription } from '@rocket.chat/ui-contexts';\nimport type { ReactElement } from 'react';\nimport React, { useCallback, useMemo, useState } from 'react';\n\nimport * as Federation from '../../../../lib/federation/Federation';\nimport { useMembersList } from '../../../hooks/useMembersList';\nimport { useRoomToolbox } from '../../contexts/RoomToolboxContext';\nimport UserInfoWithData from '../UserInfo';\nimport AddUsers from './AddUsers';\nimport InviteUsers from './InviteUsers';\nimport RoomMembers from './RoomMembers';\n\nenum ROOM_MEMBERS_TABS {\n\tINFO = 'user-info',\n\tINVITE = 'invite-users',\n\tADD = 'add-users',\n\tLIST = 'users-list',\n}\n\ntype validRoomType = 'd' | 'p' | 'c';\n\nconst RoomMembersWithData = ({ rid }: { rid: IRoom['_id'] }): ReactElement => {\n\tconst user = useUser();\n\tconst room = useUserRoom(rid);\n\tconst { closeTab } = useRoomToolbox();\n\tconst [type, setType] = useLocalStorage<'online' | 'all'>('members-list-type', 'online');\n\tconst [text, setText] = useState('');\n\tconst subscription = useUserSubscription(rid);\n\n\tconst isTeam = room && isTeamRoom(room);\n\tconst isDirect = room && isDirectMessageRoom(room);\n\tconst hasPermissionToCreateInviteLinks = usePermission('create-invite-links', rid);\n\tconst isFederated = room && isRoomFederated(room);\n\n\tconst canCreateInviteLinks =\n\t\troom && user && isFederated ? Federation.canCreateInviteLinks(user, room, subscription) : hasPermissionToCreateInviteLinks;\n\n\tconst [state, setState] = useState<{ tab: ROOM_MEMBERS_TABS; userId?: IUser['_id'] }>({\n\t\ttab: ROOM_MEMBERS_TABS.LIST,\n\t\tuserId: undefined,\n\t});\n\n\tconst debouncedText = useDebouncedValue(text, 800);\n\n\tconst { data, fetchNextPage, isLoading, refetch, hasNextPage } = useMembersList(\n\t\tuseMemo(() => ({ rid, type, limit: 50, debouncedText, roomType: room?.t as validRoomType }), [rid, type, debouncedText, room?.t]),\n\t);\n\n\tconst hasPermissionToAddUsers = useAtLeastOnePermission(\n\t\tuseMemo(() => [room?.t === 'p' ? 'add-user-to-any-p-room' : 'add-user-to-any-c-room', 'add-user-to-joined-room'], [room?.t]),\n\t\trid,\n\t);\n\n\tconst canAddUsers = room && user && isFederated ? Federation.isEditableByTheUser(user, room, subscription) : hasPermissionToAddUsers;\n\n\tconst handleTextChange = useCallback((event) => {\n\t\tsetText(event.currentTarget.value);\n\t}, []);\n\n\tconst openUserInfo = useMutableCallback((e) => {\n\t\tconst { userid } = e.currentTarget.dataset;\n\t\tsetState({\n\t\t\ttab: ROOM_MEMBERS_TABS.INFO,\n\t\t\tuserId: userid,\n\t\t});\n\t});\n\n\tconst openInvite = useMutableCallback(() => {\n\t\tsetState({ tab: ROOM_MEMBERS_TABS.INVITE });\n\t});\n\n\tconst openAddUser = useMutableCallback(() => {\n\t\tsetState({ tab: ROOM_MEMBERS_TABS.ADD });\n\t});\n\n\tconst handleBack = useCallback(() => {\n\t\tsetState({ tab: ROOM_MEMBERS_TABS.LIST });\n\t}, [setState]);\n\n\tif (state.tab === ROOM_MEMBERS_TABS.INFO && state.userId) {\n\t\treturn <UserInfoWithData rid={rid} uid={state.userId} onClose={closeTab} onClickBack={handleBack} />;\n\t}\n\n\tif (state.tab === ROOM_MEMBERS_TABS.INVITE) {\n\t\treturn <InviteUsers rid={rid} onClickBack={handleBack} />;\n\t}\n\n\tif (state.tab === ROOM_MEMBERS_TABS.ADD) {\n\t\treturn <AddUsers rid={rid} onClickBack={handleBack} reload={refetch} />;\n\t}\n\n\treturn (\n\t\t<RoomMembers\n\t\t\trid={rid}\n\t\t\tisTeam={isTeam}\n\t\t\tisDirect={isDirect}\n\t\t\tloading={isLoading}\n\t\t\ttype={type}\n\t\t\ttext={text}\n\t\t\tsetText={handleTextChange}\n\t\t\tsetType={setType}\n\t\t\tmembers={data?.pages?.flatMap((page) => page.members) ?? []}\n\t\t\ttotal={data?.pages[data.pages.length - 1].total ?? 0}\n\t\t\tonClickClose={closeTab}\n\t\t\tonClickView={openUserInfo}\n\t\t\tloadMoreItems={hasNextPage ? fetchNextPage : () => undefined}\n\t\t\treload={refetch}\n\t\t\tonClickInvite={canCreateInviteLinks && canAddUsers ? openInvite : undefined}\n\t\t\tonClickAdd={canAddUsers ? openAddUser : undefined}\n\t\t/>\n\t);\n};\n\nexport default RoomMembersWithData;\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"562177fb96e9226700bca400563912e471d406ea"}
