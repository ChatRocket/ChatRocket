{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/MessageList/providers/MessageListProvider.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/views/room/MessageList/providers/MessageListProvider.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/MessageList/providers/MessageListProvider.tsx","inputSourceMap":{"version":3,"file":"client/views/room/MessageList/providers/MessageListProvider.tsx","sourceRoot":"","sources":["client/views/room/MessageList/providers/MessageListProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import { isThreadMainMessage } from '@rocket.chat/core-typings';\nimport { useLayout, useUser, useUserPreference, useSetting, useEndpoint, useSearchParameter } from '@rocket.chat/ui-contexts';\nimport type { ReactNode } from 'react';\nimport React, { useMemo, memo } from 'react';\n\nimport { getRegexHighlight, getRegexHighlightUrl } from '../../../../../app/highlight-words/client/helper';\nimport type { MessageListContextValue } from '../../../../components/message/list/MessageListContext';\nimport { MessageListContext } from '../../../../components/message/list/MessageListContext';\nimport AttachmentProvider from '../../../../providers/AttachmentProvider';\nimport { useChat } from '../../contexts/ChatContext';\nimport { useRoom, useRoomSubscription } from '../../contexts/RoomContext';\nimport { useAutoTranslate } from '../hooks/useAutoTranslate';\nimport { useKatex } from '../hooks/useKatex';\nimport { useLoadSurroundingMessages } from '../hooks/useLoadSurroundingMessages';\n\ntype MessageListProviderProps = {\n\tchildren: ReactNode;\n\tmessageListRef?: React.RefObject<HTMLElement>;\n\tattachmentDimension?: {\n\t\twidth?: number;\n\t\theight?: number;\n\t};\n};\n\nconst MessageListProvider = ({ children, messageListRef, attachmentDimension }: MessageListProviderProps) => {\n\tconst room = useRoom();\n\n\tif (!room) {\n\t\tthrow new Error('Room not found');\n\t}\n\n\tconst reactToMessage = useEndpoint('POST', '/v1/chat.react');\n\tconst user = useUser();\n\tconst uid = user?._id;\n\tconst username = user?.username;\n\tconst subscription = useRoomSubscription();\n\n\tconst { isMobile } = useLayout();\n\n\tconst showRealName = useSetting('UI_Use_Real_Name', false);\n\tconst showColors = useSetting('HexColorPreview_Enabled', false);\n\n\tconst displayRolesGlobal = useSetting('UI_DisplayRoles', true);\n\tconst hideRolesPreference = Boolean(!useUserPreference<boolean>('hideRoles') && !isMobile);\n\tconst showRoles = displayRolesGlobal && hideRolesPreference;\n\tconst showUsername = Boolean(!useUserPreference<boolean>('hideUsernames') && !isMobile);\n\tconst highlights = useUserPreference<string[]>('highlights');\n\n\tconst { showAutoTranslate, autoTranslateLanguage } = useAutoTranslate(subscription);\n\tconst { katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled } = useKatex();\n\n\tconst hasSubscription = Boolean(subscription);\n\tconst msgParameter = useSearchParameter('msg');\n\n\tuseLoadSurroundingMessages(msgParameter);\n\n\tconst chat = useChat();\n\n\tconst context: MessageListContextValue = useMemo(\n\t\t() => ({\n\t\t\tshowColors,\n\t\t\tuseUserHasReacted: username\n\t\t\t\t? (message) =>\n\t\t\t\t\t\t(reaction): boolean =>\n\t\t\t\t\t\t\tBoolean(message.reactions?.[reaction].usernames.includes(username))\n\t\t\t\t: () => (): boolean => false,\n\t\t\tuseShowFollowing: uid\n\t\t\t\t? ({ message }): boolean => Boolean(message.replies && message.replies.indexOf(uid) > -1 && !isThreadMainMessage(message))\n\t\t\t\t: (): boolean => false,\n\t\t\tautoTranslateLanguage,\n\t\t\tuseShowTranslated: showAutoTranslate,\n\t\t\tuseShowStarred: hasSubscription\n\t\t\t\t? ({ message }): boolean => Boolean(Array.isArray(message.starred) && message.starred.find((star) => star._id === uid))\n\t\t\t\t: (): boolean => false,\n\t\t\tuseMessageDateFormatter:\n\t\t\t\t() =>\n\t\t\t\t(date: Date): string =>\n\t\t\t\t\tdate.toLocaleString(),\n\t\t\tshowRoles,\n\t\t\tshowRealName,\n\t\t\tshowUsername,\n\t\t\tmessageListRef,\n\t\t\tjumpToMessageParam: msgParameter,\n\t\t\t...(katexEnabled && {\n\t\t\t\tkatex: {\n\t\t\t\t\tdollarSyntaxEnabled: katexDollarSyntaxEnabled,\n\t\t\t\t\tparenthesisSyntaxEnabled: katexParenthesisSyntaxEnabled,\n\t\t\t\t},\n\t\t\t}),\n\t\t\thighlights: highlights\n\t\t\t\t?.map((str) => str.trim())\n\t\t\t\t.map((highlight) => ({\n\t\t\t\t\thighlight,\n\t\t\t\t\tregex: getRegexHighlight(highlight),\n\t\t\t\t\turlRegex: getRegexHighlightUrl(highlight),\n\t\t\t\t})),\n\n\t\t\tuseOpenEmojiPicker: uid\n\t\t\t\t? (message) =>\n\t\t\t\t\t\t(e): void => {\n\t\t\t\t\t\t\te.nativeEvent.stopImmediatePropagation();\n\t\t\t\t\t\t\tchat?.emojiPicker.open(e.currentTarget, (emoji: string) => reactToMessage({ messageId: message._id, reaction: emoji }));\n\t\t\t\t\t\t}\n\t\t\t\t: () => (): void => undefined,\n\t\t\tusername,\n\t\t}),\n\t\t[\n\t\t\tusername,\n\t\t\tuid,\n\t\t\tshowAutoTranslate,\n\t\t\thasSubscription,\n\t\t\tautoTranslateLanguage,\n\t\t\tshowRoles,\n\t\t\tshowRealName,\n\t\t\tshowUsername,\n\t\t\tkatexEnabled,\n\t\t\tkatexDollarSyntaxEnabled,\n\t\t\tkatexParenthesisSyntaxEnabled,\n\t\t\thighlights,\n\t\t\treactToMessage,\n\t\t\tshowColors,\n\t\t\tmsgParameter,\n\t\t\tmessageListRef,\n\t\t\tchat?.emojiPicker,\n\t\t],\n\t);\n\n\treturn (\n\t\t<AttachmentProvider width={attachmentDimension?.width} height={attachmentDimension?.height}>\n\t\t\t<MessageListContext.Provider value={context}>{children}</MessageListContext.Provider>\n\t\t</AttachmentProvider>\n\t);\n};\n\nexport default memo(MessageListProvider);\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/MessageList/providers/MessageListProvider.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/room/MessageList/providers/MessageListProvider.tsx","inputSourceMap":{"version":3,"file":"client/views/room/MessageList/providers/MessageListProvider.tsx","sourceRoot":"","sources":["client/views/room/MessageList/providers/MessageListProvider.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,mBAAmB,EAAE,MAAM,2BAA2B,CAAC;AAChE,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,iBAAiB,EAAE,UAAU,EAAE,WAAW,EAAE,kBAAkB,EAAE,MAAM,0BAA0B,CAAC;AAE9H,OAAO,KAAK,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,MAAM,OAAO,CAAC;AAE7C,OAAO,EAAE,iBAAiB,EAAE,oBAAoB,EAAE,MAAM,kDAAkD,CAAC;AAE3G,OAAO,EAAE,kBAAkB,EAAE,MAAM,wDAAwD,CAAC;AAC5F,OAAO,kBAAkB,MAAM,0CAA0C,CAAC;AAC1E,OAAO,EAAE,OAAO,EAAE,MAAM,4BAA4B,CAAC;AACrD,OAAO,EAAE,OAAO,EAAE,mBAAmB,EAAE,MAAM,4BAA4B,CAAC;AAC1E,OAAO,EAAE,gBAAgB,EAAE,MAAM,2BAA2B,CAAC;AAC7D,OAAO,EAAE,QAAQ,EAAE,MAAM,mBAAmB,CAAC;AAC7C,OAAO,EAAE,0BAA0B,EAAE,MAAM,qCAAqC,CAAC;AAWjF,MAAM,mBAAmB,GAAG,CAAC,EAAE,QAAQ,EAAE,cAAc,EAAE,mBAAmB,EAA4B,EAAE,EAAE;IAC3G,MAAM,IAAI,GAAG,OAAO,EAAE,CAAC;IAEvB,IAAI,CAAC,IAAI,EAAE,CAAC;QACX,MAAM,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC;IACnC,CAAC;IAED,MAAM,cAAc,GAAG,WAAW,CAAC,MAAM,EAAE,gBAAgB,CAAC,CAAC;IAC7D,MAAM,IAAI,GAAG,OAAO,EAAE,CAAC;IACvB,MAAM,GAAG,GAAG,IAAI,EAAE,GAAG,CAAC;IACtB,MAAM,QAAQ,GAAG,IAAI,EAAE,QAAQ,CAAC;IAChC,MAAM,YAAY,GAAG,mBAAmB,EAAE,CAAC;IAE3C,MAAM,EAAE,QAAQ,EAAE,GAAG,SAAS,EAAE,CAAC;IAEjC,MAAM,YAAY,GAAG,UAAU,CAAC,kBAAkB,EAAE,KAAK,CAAC,CAAC;IAC3D,MAAM,UAAU,GAAG,UAAU,CAAC,yBAAyB,EAAE,KAAK,CAAC,CAAC;IAEhE,MAAM,kBAAkB,GAAG,UAAU,CAAC,iBAAiB,EAAE,IAAI,CAAC,CAAC;IAC/D,MAAM,mBAAmB,GAAG,OAAO,CAAC,CAAC,iBAAiB,CAAU,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC3F,MAAM,SAAS,GAAG,kBAAkB,IAAI,mBAAmB,CAAC;IAC5D,MAAM,YAAY,GAAG,OAAO,CAAC,CAAC,iBAAiB,CAAU,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACxF,MAAM,UAAU,GAAG,iBAAiB,CAAW,YAAY,CAAC,CAAC;IAE7D,MAAM,EAAE,iBAAiB,EAAE,qBAAqB,EAAE,GAAG,gBAAgB,CAAC,YAAY,CAAC,CAAC;IACpF,MAAM,EAAE,YAAY,EAAE,wBAAwB,EAAE,6BAA6B,EAAE,GAAG,QAAQ,EAAE,CAAC;IAE7F,MAAM,eAAe,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;IAC9C,MAAM,YAAY,GAAG,kBAAkB,CAAC,KAAK,CAAC,CAAC;IAE/C,0BAA0B,CAAC,YAAY,CAAC,CAAC;IAEzC,MAAM,IAAI,GAAG,OAAO,EAAE,CAAC;IAEvB,MAAM,OAAO,GAA4B,OAAO,CAC/C,GAAG,EAAE,CAAC,CAAC;QACN,UAAU;QACV,iBAAiB,EAAE,QAAQ;YAC1B,CAAC,CAAC,CAAC,OAAO,EAAE,EAAE,CACZ,CAAC,QAAQ,EAAW,EAAE,CACrB,OAAO,CAAC,OAAO,CAAC,SAAS,EAAE,CAAC,QAAQ,CAAC,CAAC,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;YACtE,CAAC,CAAC,GAAG,EAAE,CAAC,GAAY,EAAE,CAAC,KAAK;QAC7B,gBAAgB,EAAE,GAAG;YACpB,CAAC,CAAC,CAAC,EAAE,OAAO,EAAE,EAAW,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,IAAI,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;YAC1H,CAAC,CAAC,GAAY,EAAE,CAAC,KAAK;QACvB,qBAAqB;QACrB,iBAAiB,EAAE,iBAAiB;QACpC,cAAc,EAAE,eAAe;YAC9B,CAAC,CAAC,CAAC,EAAE,OAAO,EAAE,EAAW,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,GAAG,KAAK,GAAG,CAAC,CAAC;YACvH,CAAC,CAAC,GAAY,EAAE,CAAC,KAAK;QACvB,uBAAuB,EACtB,GAAG,EAAE,CACL,CAAC,IAAU,EAAU,EAAE,CACtB,IAAI,CAAC,cAAc,EAAE;QACvB,SAAS;QACT,YAAY;QACZ,YAAY;QACZ,cAAc;QACd,kBAAkB,EAAE,YAAY;QAChC,GAAG,CAAC,YAAY,IAAI;YACnB,KAAK,EAAE;gBACN,mBAAmB,EAAE,wBAAwB;gBAC7C,wBAAwB,EAAE,6BAA6B;aACvD;SACD,CAAC;QACF,UAAU,EAAE,UAAU;YACrB,EAAE,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;aACzB,GAAG,CAAC,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YACpB,SAAS;YACT,KAAK,EAAE,iBAAiB,CAAC,SAAS,CAAC;YACnC,QAAQ,EAAE,oBAAoB,CAAC,SAAS,CAAC;SACzC,CAAC,CAAC;QAEJ,kBAAkB,EAAE,GAAG;YACtB,CAAC,CAAC,CAAC,OAAO,EAAE,EAAE,CACZ,CAAC,CAAC,EAAQ,EAAE;gBACX,CAAC,CAAC,WAAW,CAAC,wBAAwB,EAAE,CAAC;gBACzC,IAAI,EAAE,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,aAAa,EAAE,CAAC,KAAa,EAAE,EAAE,CAAC,cAAc,CAAC,EAAE,SAAS,EAAE,OAAO,CAAC,GAAG,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;YACzH,CAAC;YACH,CAAC,CAAC,GAAG,EAAE,CAAC,GAAS,EAAE,CAAC,SAAS;QAC9B,QAAQ;KACR,CAAC,EACF;QACC,QAAQ;QACR,GAAG;QACH,iBAAiB;QACjB,eAAe;QACf,qBAAqB;QACrB,SAAS;QACT,YAAY;QACZ,YAAY;QACZ,YAAY;QACZ,wBAAwB;QACxB,6BAA6B;QAC7B,UAAU;QACV,cAAc;QACd,UAAU;QACV,YAAY;QACZ,cAAc;QACd,IAAI,EAAE,WAAW;KACjB,CACD,CAAC;IAEF,OAAO,CACN,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,mBAAmB,EAAE,KAAK,CAAC,CAAC,MAAM,CAAC,CAAC,mBAAmB,EAAE,MAAM,CAAC,CAC1F;GAAA,CAAC,kBAAkB,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,QAAQ,CAAC,EAAE,kBAAkB,CAAC,QAAQ,CACrF;EAAA,EAAE,kBAAkB,CAAC,CACrB,CAAC;AACH,CAAC,CAAC;AAEF,eAAe,IAAI,CAAC,mBAAmB,CAAC,CAAC","sourcesContent":["import { isThreadMainMessage } from '@rocket.chat/core-typings';\nimport { useLayout, useUser, useUserPreference, useSetting, useEndpoint, useSearchParameter } from '@rocket.chat/ui-contexts';\nimport type { ReactNode } from 'react';\nimport React, { useMemo, memo } from 'react';\n\nimport { getRegexHighlight, getRegexHighlightUrl } from '../../../../../app/highlight-words/client/helper';\nimport type { MessageListContextValue } from '../../../../components/message/list/MessageListContext';\nimport { MessageListContext } from '../../../../components/message/list/MessageListContext';\nimport AttachmentProvider from '../../../../providers/AttachmentProvider';\nimport { useChat } from '../../contexts/ChatContext';\nimport { useRoom, useRoomSubscription } from '../../contexts/RoomContext';\nimport { useAutoTranslate } from '../hooks/useAutoTranslate';\nimport { useKatex } from '../hooks/useKatex';\nimport { useLoadSurroundingMessages } from '../hooks/useLoadSurroundingMessages';\n\ntype MessageListProviderProps = {\n\tchildren: ReactNode;\n\tmessageListRef?: React.RefObject<HTMLElement>;\n\tattachmentDimension?: {\n\t\twidth?: number;\n\t\theight?: number;\n\t};\n};\n\nconst MessageListProvider = ({ children, messageListRef, attachmentDimension }: MessageListProviderProps) => {\n\tconst room = useRoom();\n\n\tif (!room) {\n\t\tthrow new Error('Room not found');\n\t}\n\n\tconst reactToMessage = useEndpoint('POST', '/v1/chat.react');\n\tconst user = useUser();\n\tconst uid = user?._id;\n\tconst username = user?.username;\n\tconst subscription = useRoomSubscription();\n\n\tconst { isMobile } = useLayout();\n\n\tconst showRealName = useSetting('UI_Use_Real_Name', false);\n\tconst showColors = useSetting('HexColorPreview_Enabled', false);\n\n\tconst displayRolesGlobal = useSetting('UI_DisplayRoles', true);\n\tconst hideRolesPreference = Boolean(!useUserPreference<boolean>('hideRoles') && !isMobile);\n\tconst showRoles = displayRolesGlobal && hideRolesPreference;\n\tconst showUsername = Boolean(!useUserPreference<boolean>('hideUsernames') && !isMobile);\n\tconst highlights = useUserPreference<string[]>('highlights');\n\n\tconst { showAutoTranslate, autoTranslateLanguage } = useAutoTranslate(subscription);\n\tconst { katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled } = useKatex();\n\n\tconst hasSubscription = Boolean(subscription);\n\tconst msgParameter = useSearchParameter('msg');\n\n\tuseLoadSurroundingMessages(msgParameter);\n\n\tconst chat = useChat();\n\n\tconst context: MessageListContextValue = useMemo(\n\t\t() => ({\n\t\t\tshowColors,\n\t\t\tuseUserHasReacted: username\n\t\t\t\t? (message) =>\n\t\t\t\t\t\t(reaction): boolean =>\n\t\t\t\t\t\t\tBoolean(message.reactions?.[reaction].usernames.includes(username))\n\t\t\t\t: () => (): boolean => false,\n\t\t\tuseShowFollowing: uid\n\t\t\t\t? ({ message }): boolean => Boolean(message.replies && message.replies.indexOf(uid) > -1 && !isThreadMainMessage(message))\n\t\t\t\t: (): boolean => false,\n\t\t\tautoTranslateLanguage,\n\t\t\tuseShowTranslated: showAutoTranslate,\n\t\t\tuseShowStarred: hasSubscription\n\t\t\t\t? ({ message }): boolean => Boolean(Array.isArray(message.starred) && message.starred.find((star) => star._id === uid))\n\t\t\t\t: (): boolean => false,\n\t\t\tuseMessageDateFormatter:\n\t\t\t\t() =>\n\t\t\t\t(date: Date): string =>\n\t\t\t\t\tdate.toLocaleString(),\n\t\t\tshowRoles,\n\t\t\tshowRealName,\n\t\t\tshowUsername,\n\t\t\tmessageListRef,\n\t\t\tjumpToMessageParam: msgParameter,\n\t\t\t...(katexEnabled && {\n\t\t\t\tkatex: {\n\t\t\t\t\tdollarSyntaxEnabled: katexDollarSyntaxEnabled,\n\t\t\t\t\tparenthesisSyntaxEnabled: katexParenthesisSyntaxEnabled,\n\t\t\t\t},\n\t\t\t}),\n\t\t\thighlights: highlights\n\t\t\t\t?.map((str) => str.trim())\n\t\t\t\t.map((highlight) => ({\n\t\t\t\t\thighlight,\n\t\t\t\t\tregex: getRegexHighlight(highlight),\n\t\t\t\t\turlRegex: getRegexHighlightUrl(highlight),\n\t\t\t\t})),\n\n\t\t\tuseOpenEmojiPicker: uid\n\t\t\t\t? (message) =>\n\t\t\t\t\t\t(e): void => {\n\t\t\t\t\t\t\te.nativeEvent.stopImmediatePropagation();\n\t\t\t\t\t\t\tchat?.emojiPicker.open(e.currentTarget, (emoji: string) => reactToMessage({ messageId: message._id, reaction: emoji }));\n\t\t\t\t\t\t}\n\t\t\t\t: () => (): void => undefined,\n\t\t\tusername,\n\t\t}),\n\t\t[\n\t\t\tusername,\n\t\t\tuid,\n\t\t\tshowAutoTranslate,\n\t\t\thasSubscription,\n\t\t\tautoTranslateLanguage,\n\t\t\tshowRoles,\n\t\t\tshowRealName,\n\t\t\tshowUsername,\n\t\t\tkatexEnabled,\n\t\t\tkatexDollarSyntaxEnabled,\n\t\t\tkatexParenthesisSyntaxEnabled,\n\t\t\thighlights,\n\t\t\treactToMessage,\n\t\t\tshowColors,\n\t\t\tmsgParameter,\n\t\t\tmessageListRef,\n\t\t\tchat?.emojiPicker,\n\t\t],\n\t);\n\n\treturn (\n\t\t<AttachmentProvider width={attachmentDimension?.width} height={attachmentDimension?.height}>\n\t\t\t<MessageListContext.Provider value={context}>{children}</MessageListContext.Provider>\n\t\t</AttachmentProvider>\n\t);\n};\n\nexport default memo(MessageListProvider);\n"]}}},"code":"let _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n}, 0);\nlet isThreadMainMessage;\nmodule.link(\"@rocket.chat/core-typings\", {\n  isThreadMainMessage(v) {\n    isThreadMainMessage = v;\n  }\n}, 0);\nlet useLayout, useUser, useUserPreference, useSetting, useEndpoint, useSearchParameter;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useLayout(v) {\n    useLayout = v;\n  },\n  useUser(v) {\n    useUser = v;\n  },\n  useUserPreference(v) {\n    useUserPreference = v;\n  },\n  useSetting(v) {\n    useSetting = v;\n  },\n  useEndpoint(v) {\n    useEndpoint = v;\n  },\n  useSearchParameter(v) {\n    useSearchParameter = v;\n  }\n}, 1);\nlet React, useMemo, memo;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n  useMemo(v) {\n    useMemo = v;\n  },\n  memo(v) {\n    memo = v;\n  }\n}, 2);\nlet getRegexHighlight, getRegexHighlightUrl;\nmodule.link(\"../../../../../app/highlight-words/client/helper\", {\n  getRegexHighlight(v) {\n    getRegexHighlight = v;\n  },\n  getRegexHighlightUrl(v) {\n    getRegexHighlightUrl = v;\n  }\n}, 3);\nlet MessageListContext;\nmodule.link(\"../../../../components/message/list/MessageListContext\", {\n  MessageListContext(v) {\n    MessageListContext = v;\n  }\n}, 4);\nlet AttachmentProvider;\nmodule.link(\"../../../../providers/AttachmentProvider\", {\n  default(v) {\n    AttachmentProvider = v;\n  }\n}, 5);\nlet useChat;\nmodule.link(\"../../contexts/ChatContext\", {\n  useChat(v) {\n    useChat = v;\n  }\n}, 6);\nlet useRoom, useRoomSubscription;\nmodule.link(\"../../contexts/RoomContext\", {\n  useRoom(v) {\n    useRoom = v;\n  },\n  useRoomSubscription(v) {\n    useRoomSubscription = v;\n  }\n}, 7);\nlet useAutoTranslate;\nmodule.link(\"../hooks/useAutoTranslate\", {\n  useAutoTranslate(v) {\n    useAutoTranslate = v;\n  }\n}, 8);\nlet useKatex;\nmodule.link(\"../hooks/useKatex\", {\n  useKatex(v) {\n    useKatex = v;\n  }\n}, 9);\nlet useLoadSurroundingMessages;\nmodule.link(\"../hooks/useLoadSurroundingMessages\", {\n  useLoadSurroundingMessages(v) {\n    useLoadSurroundingMessages = v;\n  }\n}, 10);\nconst MessageListProvider = _ref => {\n  let {\n    children,\n    messageListRef,\n    attachmentDimension\n  } = _ref;\n  const room = useRoom();\n  if (!room) {\n    throw new Error('Room not found');\n  }\n  const reactToMessage = useEndpoint('POST', '/v1/chat.react');\n  const user = useUser();\n  const uid = user === null || user === void 0 ? void 0 : user._id;\n  const username = user === null || user === void 0 ? void 0 : user.username;\n  const subscription = useRoomSubscription();\n  const {\n    isMobile\n  } = useLayout();\n  const showRealName = useSetting('UI_Use_Real_Name', false);\n  const showColors = useSetting('HexColorPreview_Enabled', false);\n  const displayRolesGlobal = useSetting('UI_DisplayRoles', true);\n  const hideRolesPreference = Boolean(!useUserPreference('hideRoles') && !isMobile);\n  const showRoles = displayRolesGlobal && hideRolesPreference;\n  const showUsername = Boolean(!useUserPreference('hideUsernames') && !isMobile);\n  const highlights = useUserPreference('highlights');\n  const {\n    showAutoTranslate,\n    autoTranslateLanguage\n  } = useAutoTranslate(subscription);\n  const {\n    katexEnabled,\n    katexDollarSyntaxEnabled,\n    katexParenthesisSyntaxEnabled\n  } = useKatex();\n  const hasSubscription = Boolean(subscription);\n  const msgParameter = useSearchParameter('msg');\n  useLoadSurroundingMessages(msgParameter);\n  const chat = useChat();\n  const context = useMemo(() => _objectSpread(_objectSpread({\n    showColors,\n    useUserHasReacted: username ? message => reaction => {\n      var _message$reactions;\n      return Boolean((_message$reactions = message.reactions) === null || _message$reactions === void 0 ? void 0 : _message$reactions[reaction].usernames.includes(username));\n    } : () => () => false,\n    useShowFollowing: uid ? _ref2 => {\n      let {\n        message\n      } = _ref2;\n      return Boolean(message.replies && message.replies.indexOf(uid) > -1 && !isThreadMainMessage(message));\n    } : () => false,\n    autoTranslateLanguage,\n    useShowTranslated: showAutoTranslate,\n    useShowStarred: hasSubscription ? _ref3 => {\n      let {\n        message\n      } = _ref3;\n      return Boolean(Array.isArray(message.starred) && message.starred.find(star => star._id === uid));\n    } : () => false,\n    useMessageDateFormatter: () => date => date.toLocaleString(),\n    showRoles,\n    showRealName,\n    showUsername,\n    messageListRef,\n    jumpToMessageParam: msgParameter\n  }, katexEnabled && {\n    katex: {\n      dollarSyntaxEnabled: katexDollarSyntaxEnabled,\n      parenthesisSyntaxEnabled: katexParenthesisSyntaxEnabled\n    }\n  }), {}, {\n    highlights: highlights === null || highlights === void 0 ? void 0 : highlights.map(str => str.trim()).map(highlight => ({\n      highlight,\n      regex: getRegexHighlight(highlight),\n      urlRegex: getRegexHighlightUrl(highlight)\n    })),\n    useOpenEmojiPicker: uid ? message => e => {\n      e.nativeEvent.stopImmediatePropagation();\n      chat === null || chat === void 0 ? void 0 : chat.emojiPicker.open(e.currentTarget, emoji => reactToMessage({\n        messageId: message._id,\n        reaction: emoji\n      }));\n    } : () => () => undefined,\n    username\n  }), [username, uid, showAutoTranslate, hasSubscription, autoTranslateLanguage, showRoles, showRealName, showUsername, katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled, highlights, reactToMessage, showColors, msgParameter, messageListRef, chat === null || chat === void 0 ? void 0 : chat.emojiPicker]);\n  return /*#__PURE__*/React.createElement(AttachmentProvider, {\n    width: attachmentDimension === null || attachmentDimension === void 0 ? void 0 : attachmentDimension.width,\n    height: attachmentDimension === null || attachmentDimension === void 0 ? void 0 : attachmentDimension.height\n  }, /*#__PURE__*/React.createElement(MessageListContext.Provider, {\n    value: context\n  }, children));\n};\nmodule.exportDefault( /*#__PURE__*/memo(MessageListProvider));","map":{"version":3,"names":["_objectSpread","module","link","default","v","isThreadMainMessage","useLayout","useUser","useUserPreference","useSetting","useEndpoint","useSearchParameter","React","useMemo","memo","getRegexHighlight","getRegexHighlightUrl","MessageListContext","AttachmentProvider","useChat","useRoom","useRoomSubscription","useAutoTranslate","useKatex","useLoadSurroundingMessages","MessageListProvider","_ref","children","messageListRef","attachmentDimension","room","Error","reactToMessage","user","uid","_id","username","subscription","isMobile","showRealName","showColors","displayRolesGlobal","hideRolesPreference","Boolean","showRoles","showUsername","highlights","showAutoTranslate","autoTranslateLanguage","katexEnabled","katexDollarSyntaxEnabled","katexParenthesisSyntaxEnabled","hasSubscription","msgParameter","chat","context","useUserHasReacted","message","reaction","_message$reactions","reactions","usernames","includes","useShowFollowing","_ref2","replies","indexOf","useShowTranslated","useShowStarred","_ref3","Array","isArray","starred","find","star","useMessageDateFormatter","date","toLocaleString","jumpToMessageParam","katex","dollarSyntaxEnabled","parenthesisSyntaxEnabled","map","str","trim","highlight","regex","urlRegex","useOpenEmojiPicker","e","nativeEvent","stopImmediatePropagation","emojiPicker","open","currentTarget","emoji","messageId","undefined","createElement","width","height","Provider","value","exportDefault"],"sources":["client/views/room/MessageList/providers/MessageListProvider.tsx"],"sourcesContent":["import { isThreadMainMessage } from '@rocket.chat/core-typings';\nimport { useLayout, useUser, useUserPreference, useSetting, useEndpoint, useSearchParameter } from '@rocket.chat/ui-contexts';\nimport type { ReactNode } from 'react';\nimport React, { useMemo, memo } from 'react';\n\nimport { getRegexHighlight, getRegexHighlightUrl } from '../../../../../app/highlight-words/client/helper';\nimport type { MessageListContextValue } from '../../../../components/message/list/MessageListContext';\nimport { MessageListContext } from '../../../../components/message/list/MessageListContext';\nimport AttachmentProvider from '../../../../providers/AttachmentProvider';\nimport { useChat } from '../../contexts/ChatContext';\nimport { useRoom, useRoomSubscription } from '../../contexts/RoomContext';\nimport { useAutoTranslate } from '../hooks/useAutoTranslate';\nimport { useKatex } from '../hooks/useKatex';\nimport { useLoadSurroundingMessages } from '../hooks/useLoadSurroundingMessages';\n\ntype MessageListProviderProps = {\n\tchildren: ReactNode;\n\tmessageListRef?: React.RefObject<HTMLElement>;\n\tattachmentDimension?: {\n\t\twidth?: number;\n\t\theight?: number;\n\t};\n};\n\nconst MessageListProvider = ({ children, messageListRef, attachmentDimension }: MessageListProviderProps) => {\n\tconst room = useRoom();\n\n\tif (!room) {\n\t\tthrow new Error('Room not found');\n\t}\n\n\tconst reactToMessage = useEndpoint('POST', '/v1/chat.react');\n\tconst user = useUser();\n\tconst uid = user?._id;\n\tconst username = user?.username;\n\tconst subscription = useRoomSubscription();\n\n\tconst { isMobile } = useLayout();\n\n\tconst showRealName = useSetting('UI_Use_Real_Name', false);\n\tconst showColors = useSetting('HexColorPreview_Enabled', false);\n\n\tconst displayRolesGlobal = useSetting('UI_DisplayRoles', true);\n\tconst hideRolesPreference = Boolean(!useUserPreference<boolean>('hideRoles') && !isMobile);\n\tconst showRoles = displayRolesGlobal && hideRolesPreference;\n\tconst showUsername = Boolean(!useUserPreference<boolean>('hideUsernames') && !isMobile);\n\tconst highlights = useUserPreference<string[]>('highlights');\n\n\tconst { showAutoTranslate, autoTranslateLanguage } = useAutoTranslate(subscription);\n\tconst { katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled } = useKatex();\n\n\tconst hasSubscription = Boolean(subscription);\n\tconst msgParameter = useSearchParameter('msg');\n\n\tuseLoadSurroundingMessages(msgParameter);\n\n\tconst chat = useChat();\n\n\tconst context: MessageListContextValue = useMemo(\n\t\t() => ({\n\t\t\tshowColors,\n\t\t\tuseUserHasReacted: username\n\t\t\t\t? (message) =>\n\t\t\t\t\t\t(reaction): boolean =>\n\t\t\t\t\t\t\tBoolean(message.reactions?.[reaction].usernames.includes(username))\n\t\t\t\t: () => (): boolean => false,\n\t\t\tuseShowFollowing: uid\n\t\t\t\t? ({ message }): boolean => Boolean(message.replies && message.replies.indexOf(uid) > -1 && !isThreadMainMessage(message))\n\t\t\t\t: (): boolean => false,\n\t\t\tautoTranslateLanguage,\n\t\t\tuseShowTranslated: showAutoTranslate,\n\t\t\tuseShowStarred: hasSubscription\n\t\t\t\t? ({ message }): boolean => Boolean(Array.isArray(message.starred) && message.starred.find((star) => star._id === uid))\n\t\t\t\t: (): boolean => false,\n\t\t\tuseMessageDateFormatter:\n\t\t\t\t() =>\n\t\t\t\t(date: Date): string =>\n\t\t\t\t\tdate.toLocaleString(),\n\t\t\tshowRoles,\n\t\t\tshowRealName,\n\t\t\tshowUsername,\n\t\t\tmessageListRef,\n\t\t\tjumpToMessageParam: msgParameter,\n\t\t\t...(katexEnabled && {\n\t\t\t\tkatex: {\n\t\t\t\t\tdollarSyntaxEnabled: katexDollarSyntaxEnabled,\n\t\t\t\t\tparenthesisSyntaxEnabled: katexParenthesisSyntaxEnabled,\n\t\t\t\t},\n\t\t\t}),\n\t\t\thighlights: highlights\n\t\t\t\t?.map((str) => str.trim())\n\t\t\t\t.map((highlight) => ({\n\t\t\t\t\thighlight,\n\t\t\t\t\tregex: getRegexHighlight(highlight),\n\t\t\t\t\turlRegex: getRegexHighlightUrl(highlight),\n\t\t\t\t})),\n\n\t\t\tuseOpenEmojiPicker: uid\n\t\t\t\t? (message) =>\n\t\t\t\t\t\t(e): void => {\n\t\t\t\t\t\t\te.nativeEvent.stopImmediatePropagation();\n\t\t\t\t\t\t\tchat?.emojiPicker.open(e.currentTarget, (emoji: string) => reactToMessage({ messageId: message._id, reaction: emoji }));\n\t\t\t\t\t\t}\n\t\t\t\t: () => (): void => undefined,\n\t\t\tusername,\n\t\t}),\n\t\t[\n\t\t\tusername,\n\t\t\tuid,\n\t\t\tshowAutoTranslate,\n\t\t\thasSubscription,\n\t\t\tautoTranslateLanguage,\n\t\t\tshowRoles,\n\t\t\tshowRealName,\n\t\t\tshowUsername,\n\t\t\tkatexEnabled,\n\t\t\tkatexDollarSyntaxEnabled,\n\t\t\tkatexParenthesisSyntaxEnabled,\n\t\t\thighlights,\n\t\t\treactToMessage,\n\t\t\tshowColors,\n\t\t\tmsgParameter,\n\t\t\tmessageListRef,\n\t\t\tchat?.emojiPicker,\n\t\t],\n\t);\n\n\treturn (\n\t\t<AttachmentProvider width={attachmentDimension?.width} height={attachmentDimension?.height}>\n\t\t\t<MessageListContext.Provider value={context}>{children}</MessageListContext.Provider>\n\t\t</AttachmentProvider>\n\t);\n};\n\nexport default memo(MessageListProvider);\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"1efd34ba8ff4f6fdc4f79a5cadf3079f1484d3bb"}
