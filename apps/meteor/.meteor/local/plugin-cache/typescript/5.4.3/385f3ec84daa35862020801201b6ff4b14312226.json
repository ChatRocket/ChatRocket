{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/providers/OmnichannelProvider.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/providers/OmnichannelProvider.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/providers/OmnichannelProvider.tsx","inputSourceMap":{"version":3,"file":"client/providers/OmnichannelProvider.tsx","sourceRoot":"","sources":["client/providers/OmnichannelProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n\ttype IOmnichannelAgent,\n\ttype OmichannelRoutingConfig,\n\ttype OmnichannelSortingMechanismSettingType,\n\ttype ILivechatInquiryRecord,\n\tLivechatInquiryStatus,\n} from '@rocket.chat/core-typings';\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\nimport { useUser, useSetting, usePermission, useMethod, useEndpoint, useStream } from '@rocket.chat/ui-contexts';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport type { ReactNode } from 'react';\nimport React, { useState, useEffect, useMemo, useCallback, memo, useRef } from 'react';\n\nimport { LivechatInquiry } from '../../app/livechat/client/collections/LivechatInquiry';\nimport { initializeLivechatInquiryStream } from '../../app/livechat/client/lib/stream/queueManager';\nimport { getOmniChatSortQuery } from '../../app/livechat/lib/inquiries';\nimport { KonchatNotification } from '../../app/ui/client/lib/KonchatNotification';\nimport { ClientLogger } from '../../lib/ClientLogger';\nimport type { OmnichannelContextValue } from '../contexts/OmnichannelContext';\nimport { OmnichannelContext } from '../contexts/OmnichannelContext';\nimport { useHasLicenseModule } from '../hooks/useHasLicenseModule';\nimport { useReactiveValue } from '../hooks/useReactiveValue';\nimport { useShouldPreventAction } from '../hooks/useShouldPreventAction';\n\nconst emptyContextValue: OmnichannelContextValue = {\n\tinquiries: { enabled: false },\n\tenabled: false,\n\tisEnterprise: false,\n\tagentAvailable: false,\n\tshowOmnichannelQueueLink: false,\n\tisOverMacLimit: false,\n\tlivechatPriorities: {\n\t\tenabled: false,\n\t\tdata: [],\n\t\tisLoading: false,\n\t\tisError: false,\n\t},\n};\n\ntype OmnichannelProviderProps = {\n\tchildren?: ReactNode;\n};\n\nconst OmnichannelProvider = ({ children }: OmnichannelProviderProps) => {\n\tconst omniChannelEnabled = useSetting('Livechat_enabled') as boolean;\n\tconst omnichannelRouting = useSetting('Livechat_Routing_Method');\n\tconst showOmnichannelQueueLink = useSetting('Livechat_show_queue_list_link') as boolean;\n\tconst omnichannelPoolMaxIncoming = useSetting<number>('Livechat_guest_pool_max_number_incoming_livechats_displayed') ?? 0;\n\tconst omnichannelSortingMechanism = useSetting('Omnichannel_sorting_mechanism') as OmnichannelSortingMechanismSettingType;\n\n\tconst loggerRef = useRef(new ClientLogger('OmnichannelProvider'));\n\tconst hasAccess = usePermission('view-l-room');\n\tconst canViewOmnichannelQueue = usePermission('view-livechat-queue');\n\tconst user = useUser() as IOmnichannelAgent;\n\n\tconst agentAvailable = user?.statusLivechat === 'available';\n\tconst voipCallAvailable = true; // TODO: use backend check;\n\n\tconst getRoutingConfig = useMethod('livechat:getRoutingConfig');\n\n\tconst [routeConfig, setRouteConfig] = useSafely(useState<OmichannelRoutingConfig | undefined>(undefined));\n\tconst [queueNotification, setQueueNotification] = useState(new Set());\n\n\tconst accessible = hasAccess && omniChannelEnabled;\n\tconst iceServersSetting: any = useSetting('WebRTC_Servers');\n\tconst isEnterprise = useHasLicenseModule('livechat-enterprise') === true;\n\n\tconst getPriorities = useEndpoint('GET', '/v1/livechat/priorities');\n\tconst subscribe = useStream('notify-logged');\n\tconst queryClient = useQueryClient();\n\tconst isPrioritiesEnabled = isEnterprise && accessible;\n\tconst enabled = accessible && !!user && !!routeConfig;\n\n\tconst {\n\t\tdata: { priorities = [] } = {},\n\t\tisInitialLoading: isLoadingPriorities,\n\t\tisError: isErrorPriorities,\n\t} = useQuery(['/v1/livechat/priorities'], () => getPriorities({ sort: JSON.stringify({ sortItem: 1 }) }), {\n\t\tstaleTime: Infinity,\n\t\tenabled: isPrioritiesEnabled,\n\t});\n\n\tconst isOverMacLimit = useShouldPreventAction('monthlyActiveContacts');\n\n\tuseEffect(() => {\n\t\tif (!isPrioritiesEnabled) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn subscribe('omnichannel.priority-changed', () => {\n\t\t\tqueryClient.invalidateQueries(['/v1/livechat/priorities']);\n\t\t});\n\t}, [isPrioritiesEnabled, queryClient, subscribe]);\n\n\tuseEffect(() => {\n\t\tif (!accessible) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst update = async (): Promise<void> => {\n\t\t\ttry {\n\t\t\t\tconst routeConfig = await getRoutingConfig();\n\t\t\t\tsetRouteConfig(routeConfig);\n\t\t\t} catch (error) {\n\t\t\t\tloggerRef.current.error(`update() error in routeConfig ${error}`);\n\t\t\t}\n\t\t};\n\n\t\tif (omnichannelRouting || !omnichannelRouting) {\n\t\t\tupdate();\n\t\t}\n\t}, [accessible, getRoutingConfig, iceServersSetting, omnichannelRouting, setRouteConfig, voipCallAvailable]);\n\n\tconst manuallySelected =\n\t\tenabled && canViewOmnichannelQueue && !!routeConfig && routeConfig.showQueue && !routeConfig.autoAssignAgent && agentAvailable;\n\n\tconst streamNotifyUser = useStream('notify-user');\n\tuseEffect(() => {\n\t\tif (!manuallySelected) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst handleDepartmentAgentData = (): void => {\n\t\t\tinitializeLivechatInquiryStream(user?._id);\n\t\t};\n\n\t\tinitializeLivechatInquiryStream(user?._id);\n\t\tif (!user?._id) {\n\t\t\treturn;\n\t\t}\n\t\treturn streamNotifyUser(`${user._id}/departmentAgentData`, handleDepartmentAgentData);\n\t}, [manuallySelected, streamNotifyUser, user?._id]);\n\n\tconst queue = useReactiveValue<ILivechatInquiryRecord[] | undefined>(\n\t\tuseCallback(() => {\n\t\t\tif (!manuallySelected) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\treturn LivechatInquiry.find(\n\t\t\t\t{ status: LivechatInquiryStatus.QUEUED },\n\t\t\t\t{\n\t\t\t\t\tsort: getOmniChatSortQuery(omnichannelSortingMechanism),\n\t\t\t\t\tlimit: omnichannelPoolMaxIncoming,\n\t\t\t\t},\n\t\t\t).fetch();\n\t\t}, [manuallySelected, omnichannelPoolMaxIncoming, omnichannelSortingMechanism]),\n\t);\n\n\tqueue?.map(({ rid }) => {\n\t\tif (queueNotification.has(rid)) {\n\t\t\treturn;\n\t\t}\n\t\tsetQueueNotification((prev) => new Set([...prev, rid]));\n\t\treturn KonchatNotification.newRoom(rid);\n\t});\n\n\tconst contextValue = useMemo<OmnichannelContextValue>(() => {\n\t\tif (!enabled) {\n\t\t\treturn emptyContextValue;\n\t\t}\n\n\t\tconst livechatPriorities = {\n\t\t\tenabled: isPrioritiesEnabled,\n\t\t\tdata: priorities,\n\t\t\tisLoading: isLoadingPriorities,\n\t\t\tisError: isErrorPriorities,\n\t\t};\n\n\t\tif (!manuallySelected) {\n\t\t\treturn {\n\t\t\t\t...emptyContextValue,\n\t\t\t\tenabled: true,\n\t\t\t\tisEnterprise,\n\t\t\t\tagentAvailable,\n\t\t\t\tvoipCallAvailable,\n\t\t\t\trouteConfig,\n\t\t\t\tlivechatPriorities,\n\t\t\t\tisOverMacLimit,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\t...emptyContextValue,\n\t\t\tenabled: true,\n\t\t\tisEnterprise,\n\t\t\tagentAvailable,\n\t\t\tvoipCallAvailable,\n\t\t\trouteConfig,\n\t\t\tinquiries: queue\n\t\t\t\t? {\n\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\tqueue,\n\t\t\t\t\t}\n\t\t\t\t: { enabled: false },\n\t\t\tshowOmnichannelQueueLink: showOmnichannelQueueLink && !!agentAvailable,\n\t\t\tlivechatPriorities,\n\t\t\tisOverMacLimit,\n\t\t};\n\t}, [\n\t\tenabled,\n\t\tisPrioritiesEnabled,\n\t\tpriorities,\n\t\tisLoadingPriorities,\n\t\tisErrorPriorities,\n\t\tmanuallySelected,\n\t\tisEnterprise,\n\t\tagentAvailable,\n\t\tvoipCallAvailable,\n\t\trouteConfig,\n\t\tqueue,\n\t\tshowOmnichannelQueueLink,\n\t\tisOverMacLimit,\n\t]);\n\n\treturn <OmnichannelContext.Provider children={children} value={contextValue} />;\n};\n\nexport default memo<typeof OmnichannelProvider>(OmnichannelProvider);\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/providers/OmnichannelProvider.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/providers/OmnichannelProvider.tsx","inputSourceMap":{"version":3,"file":"client/providers/OmnichannelProvider.tsx","sourceRoot":"","sources":["client/providers/OmnichannelProvider.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n\ttype IOmnichannelAgent,\n\ttype OmichannelRoutingConfig,\n\ttype OmnichannelSortingMechanismSettingType,\n\ttype ILivechatInquiryRecord,\n\tLivechatInquiryStatus,\n} from '@rocket.chat/core-typings';\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\nimport { useUser, useSetting, usePermission, useMethod, useEndpoint, useStream } from '@rocket.chat/ui-contexts';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport type { ReactNode } from 'react';\nimport React, { useState, useEffect, useMemo, useCallback, memo, useRef } from 'react';\n\nimport { LivechatInquiry } from '../../app/livechat/client/collections/LivechatInquiry';\nimport { initializeLivechatInquiryStream } from '../../app/livechat/client/lib/stream/queueManager';\nimport { getOmniChatSortQuery } from '../../app/livechat/lib/inquiries';\nimport { KonchatNotification } from '../../app/ui/client/lib/KonchatNotification';\nimport { ClientLogger } from '../../lib/ClientLogger';\nimport type { OmnichannelContextValue } from '../contexts/OmnichannelContext';\nimport { OmnichannelContext } from '../contexts/OmnichannelContext';\nimport { useHasLicenseModule } from '../hooks/useHasLicenseModule';\nimport { useReactiveValue } from '../hooks/useReactiveValue';\nimport { useShouldPreventAction } from '../hooks/useShouldPreventAction';\n\nconst emptyContextValue: OmnichannelContextValue = {\n\tinquiries: { enabled: false },\n\tenabled: false,\n\tisEnterprise: false,\n\tagentAvailable: false,\n\tshowOmnichannelQueueLink: false,\n\tisOverMacLimit: false,\n\tlivechatPriorities: {\n\t\tenabled: false,\n\t\tdata: [],\n\t\tisLoading: false,\n\t\tisError: false,\n\t},\n};\n\ntype OmnichannelProviderProps = {\n\tchildren?: ReactNode;\n};\n\nconst OmnichannelProvider = ({ children }: OmnichannelProviderProps) => {\n\tconst omniChannelEnabled = useSetting('Livechat_enabled') as boolean;\n\tconst omnichannelRouting = useSetting('Livechat_Routing_Method');\n\tconst showOmnichannelQueueLink = useSetting('Livechat_show_queue_list_link') as boolean;\n\tconst omnichannelPoolMaxIncoming = useSetting<number>('Livechat_guest_pool_max_number_incoming_livechats_displayed') ?? 0;\n\tconst omnichannelSortingMechanism = useSetting('Omnichannel_sorting_mechanism') as OmnichannelSortingMechanismSettingType;\n\n\tconst loggerRef = useRef(new ClientLogger('OmnichannelProvider'));\n\tconst hasAccess = usePermission('view-l-room');\n\tconst canViewOmnichannelQueue = usePermission('view-livechat-queue');\n\tconst user = useUser() as IOmnichannelAgent;\n\n\tconst agentAvailable = user?.statusLivechat === 'available';\n\tconst voipCallAvailable = true; // TODO: use backend check;\n\n\tconst getRoutingConfig = useMethod('livechat:getRoutingConfig');\n\n\tconst [routeConfig, setRouteConfig] = useSafely(useState<OmichannelRoutingConfig | undefined>(undefined));\n\tconst [queueNotification, setQueueNotification] = useState(new Set());\n\n\tconst accessible = hasAccess && omniChannelEnabled;\n\tconst iceServersSetting: any = useSetting('WebRTC_Servers');\n\tconst isEnterprise = useHasLicenseModule('livechat-enterprise') === true;\n\n\tconst getPriorities = useEndpoint('GET', '/v1/livechat/priorities');\n\tconst subscribe = useStream('notify-logged');\n\tconst queryClient = useQueryClient();\n\tconst isPrioritiesEnabled = isEnterprise && accessible;\n\tconst enabled = accessible && !!user && !!routeConfig;\n\n\tconst {\n\t\tdata: { priorities = [] } = {},\n\t\tisInitialLoading: isLoadingPriorities,\n\t\tisError: isErrorPriorities,\n\t} = useQuery(['/v1/livechat/priorities'], () => getPriorities({ sort: JSON.stringify({ sortItem: 1 }) }), {\n\t\tstaleTime: Infinity,\n\t\tenabled: isPrioritiesEnabled,\n\t});\n\n\tconst isOverMacLimit = useShouldPreventAction('monthlyActiveContacts');\n\n\tuseEffect(() => {\n\t\tif (!isPrioritiesEnabled) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn subscribe('omnichannel.priority-changed', () => {\n\t\t\tqueryClient.invalidateQueries(['/v1/livechat/priorities']);\n\t\t});\n\t}, [isPrioritiesEnabled, queryClient, subscribe]);\n\n\tuseEffect(() => {\n\t\tif (!accessible) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst update = async (): Promise<void> => {\n\t\t\ttry {\n\t\t\t\tconst routeConfig = await getRoutingConfig();\n\t\t\t\tsetRouteConfig(routeConfig);\n\t\t\t} catch (error) {\n\t\t\t\tloggerRef.current.error(`update() error in routeConfig ${error}`);\n\t\t\t}\n\t\t};\n\n\t\tif (omnichannelRouting || !omnichannelRouting) {\n\t\t\tupdate();\n\t\t}\n\t}, [accessible, getRoutingConfig, iceServersSetting, omnichannelRouting, setRouteConfig, voipCallAvailable]);\n\n\tconst manuallySelected =\n\t\tenabled && canViewOmnichannelQueue && !!routeConfig && routeConfig.showQueue && !routeConfig.autoAssignAgent && agentAvailable;\n\n\tconst streamNotifyUser = useStream('notify-user');\n\tuseEffect(() => {\n\t\tif (!manuallySelected) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst handleDepartmentAgentData = (): void => {\n\t\t\tinitializeLivechatInquiryStream(user?._id);\n\t\t};\n\n\t\tinitializeLivechatInquiryStream(user?._id);\n\t\tif (!user?._id) {\n\t\t\treturn;\n\t\t}\n\t\treturn streamNotifyUser(`${user._id}/departmentAgentData`, handleDepartmentAgentData);\n\t}, [manuallySelected, streamNotifyUser, user?._id]);\n\n\tconst queue = useReactiveValue<ILivechatInquiryRecord[] | undefined>(\n\t\tuseCallback(() => {\n\t\t\tif (!manuallySelected) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\treturn LivechatInquiry.find(\n\t\t\t\t{ status: LivechatInquiryStatus.QUEUED },\n\t\t\t\t{\n\t\t\t\t\tsort: getOmniChatSortQuery(omnichannelSortingMechanism),\n\t\t\t\t\tlimit: omnichannelPoolMaxIncoming,\n\t\t\t\t},\n\t\t\t).fetch();\n\t\t}, [manuallySelected, omnichannelPoolMaxIncoming, omnichannelSortingMechanism]),\n\t);\n\n\tqueue?.map(({ rid }) => {\n\t\tif (queueNotification.has(rid)) {\n\t\t\treturn;\n\t\t}\n\t\tsetQueueNotification((prev) => new Set([...prev, rid]));\n\t\treturn KonchatNotification.newRoom(rid);\n\t});\n\n\tconst contextValue = useMemo<OmnichannelContextValue>(() => {\n\t\tif (!enabled) {\n\t\t\treturn emptyContextValue;\n\t\t}\n\n\t\tconst livechatPriorities = {\n\t\t\tenabled: isPrioritiesEnabled,\n\t\t\tdata: priorities,\n\t\t\tisLoading: isLoadingPriorities,\n\t\t\tisError: isErrorPriorities,\n\t\t};\n\n\t\tif (!manuallySelected) {\n\t\t\treturn {\n\t\t\t\t...emptyContextValue,\n\t\t\t\tenabled: true,\n\t\t\t\tisEnterprise,\n\t\t\t\tagentAvailable,\n\t\t\t\tvoipCallAvailable,\n\t\t\t\trouteConfig,\n\t\t\t\tlivechatPriorities,\n\t\t\t\tisOverMacLimit,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\t...emptyContextValue,\n\t\t\tenabled: true,\n\t\t\tisEnterprise,\n\t\t\tagentAvailable,\n\t\t\tvoipCallAvailable,\n\t\t\trouteConfig,\n\t\t\tinquiries: queue\n\t\t\t\t? {\n\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\tqueue,\n\t\t\t\t\t}\n\t\t\t\t: { enabled: false },\n\t\t\tshowOmnichannelQueueLink: showOmnichannelQueueLink && !!agentAvailable,\n\t\t\tlivechatPriorities,\n\t\t\tisOverMacLimit,\n\t\t};\n\t}, [\n\t\tenabled,\n\t\tisPrioritiesEnabled,\n\t\tpriorities,\n\t\tisLoadingPriorities,\n\t\tisErrorPriorities,\n\t\tmanuallySelected,\n\t\tisEnterprise,\n\t\tagentAvailable,\n\t\tvoipCallAvailable,\n\t\trouteConfig,\n\t\tqueue,\n\t\tshowOmnichannelQueueLink,\n\t\tisOverMacLimit,\n\t]);\n\n\treturn <OmnichannelContext.Provider children={children} value={contextValue} />;\n};\n\nexport default memo<typeof OmnichannelProvider>(OmnichannelProvider);\n"]}}},"code":"let _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n}, 0);\nlet LivechatInquiryStatus;\nmodule.link(\"@rocket.chat/core-typings\", {\n  LivechatInquiryStatus(v) {\n    LivechatInquiryStatus = v;\n  }\n}, 0);\nlet useSafely;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useSafely(v) {\n    useSafely = v;\n  }\n}, 1);\nlet useUser, useSetting, usePermission, useMethod, useEndpoint, useStream;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useUser(v) {\n    useUser = v;\n  },\n  useSetting(v) {\n    useSetting = v;\n  },\n  usePermission(v) {\n    usePermission = v;\n  },\n  useMethod(v) {\n    useMethod = v;\n  },\n  useEndpoint(v) {\n    useEndpoint = v;\n  },\n  useStream(v) {\n    useStream = v;\n  }\n}, 2);\nlet useQuery, useQueryClient;\nmodule.link(\"@tanstack/react-query\", {\n  useQuery(v) {\n    useQuery = v;\n  },\n  useQueryClient(v) {\n    useQueryClient = v;\n  }\n}, 3);\nlet React, useState, useEffect, useMemo, useCallback, memo, useRef;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n  useState(v) {\n    useState = v;\n  },\n  useEffect(v) {\n    useEffect = v;\n  },\n  useMemo(v) {\n    useMemo = v;\n  },\n  useCallback(v) {\n    useCallback = v;\n  },\n  memo(v) {\n    memo = v;\n  },\n  useRef(v) {\n    useRef = v;\n  }\n}, 4);\nlet LivechatInquiry;\nmodule.link(\"../../app/livechat/client/collections/LivechatInquiry\", {\n  LivechatInquiry(v) {\n    LivechatInquiry = v;\n  }\n}, 5);\nlet initializeLivechatInquiryStream;\nmodule.link(\"../../app/livechat/client/lib/stream/queueManager\", {\n  initializeLivechatInquiryStream(v) {\n    initializeLivechatInquiryStream = v;\n  }\n}, 6);\nlet getOmniChatSortQuery;\nmodule.link(\"../../app/livechat/lib/inquiries\", {\n  getOmniChatSortQuery(v) {\n    getOmniChatSortQuery = v;\n  }\n}, 7);\nlet KonchatNotification;\nmodule.link(\"../../app/ui/client/lib/KonchatNotification\", {\n  KonchatNotification(v) {\n    KonchatNotification = v;\n  }\n}, 8);\nlet ClientLogger;\nmodule.link(\"../../lib/ClientLogger\", {\n  ClientLogger(v) {\n    ClientLogger = v;\n  }\n}, 9);\nlet OmnichannelContext;\nmodule.link(\"../contexts/OmnichannelContext\", {\n  OmnichannelContext(v) {\n    OmnichannelContext = v;\n  }\n}, 10);\nlet useHasLicenseModule;\nmodule.link(\"../hooks/useHasLicenseModule\", {\n  useHasLicenseModule(v) {\n    useHasLicenseModule = v;\n  }\n}, 11);\nlet useReactiveValue;\nmodule.link(\"../hooks/useReactiveValue\", {\n  useReactiveValue(v) {\n    useReactiveValue = v;\n  }\n}, 12);\nlet useShouldPreventAction;\nmodule.link(\"../hooks/useShouldPreventAction\", {\n  useShouldPreventAction(v) {\n    useShouldPreventAction = v;\n  }\n}, 13);\nconst emptyContextValue = {\n  inquiries: {\n    enabled: false\n  },\n  enabled: false,\n  isEnterprise: false,\n  agentAvailable: false,\n  showOmnichannelQueueLink: false,\n  isOverMacLimit: false,\n  livechatPriorities: {\n    enabled: false,\n    data: [],\n    isLoading: false,\n    isError: false\n  }\n};\nconst OmnichannelProvider = _ref => {\n  var _useSetting;\n  let {\n    children\n  } = _ref;\n  const omniChannelEnabled = useSetting('Livechat_enabled');\n  const omnichannelRouting = useSetting('Livechat_Routing_Method');\n  const showOmnichannelQueueLink = useSetting('Livechat_show_queue_list_link');\n  const omnichannelPoolMaxIncoming = (_useSetting = useSetting('Livechat_guest_pool_max_number_incoming_livechats_displayed')) !== null && _useSetting !== void 0 ? _useSetting : 0;\n  const omnichannelSortingMechanism = useSetting('Omnichannel_sorting_mechanism');\n  const loggerRef = useRef(new ClientLogger('OmnichannelProvider'));\n  const hasAccess = usePermission('view-l-room');\n  const canViewOmnichannelQueue = usePermission('view-livechat-queue');\n  const user = useUser();\n  const agentAvailable = (user === null || user === void 0 ? void 0 : user.statusLivechat) === 'available';\n  const voipCallAvailable = true; // TODO: use backend check;\n  const getRoutingConfig = useMethod('livechat:getRoutingConfig');\n  const [routeConfig, setRouteConfig] = useSafely(useState(undefined));\n  const [queueNotification, setQueueNotification] = useState(new Set());\n  const accessible = hasAccess && omniChannelEnabled;\n  const iceServersSetting = useSetting('WebRTC_Servers');\n  const isEnterprise = useHasLicenseModule('livechat-enterprise') === true;\n  const getPriorities = useEndpoint('GET', '/v1/livechat/priorities');\n  const subscribe = useStream('notify-logged');\n  const queryClient = useQueryClient();\n  const isPrioritiesEnabled = isEnterprise && accessible;\n  const enabled = accessible && !!user && !!routeConfig;\n  const {\n    data: {\n      priorities = []\n    } = {},\n    isInitialLoading: isLoadingPriorities,\n    isError: isErrorPriorities\n  } = useQuery(['/v1/livechat/priorities'], () => getPriorities({\n    sort: JSON.stringify({\n      sortItem: 1\n    })\n  }), {\n    staleTime: Infinity,\n    enabled: isPrioritiesEnabled\n  });\n  const isOverMacLimit = useShouldPreventAction('monthlyActiveContacts');\n  useEffect(() => {\n    if (!isPrioritiesEnabled) {\n      return;\n    }\n    return subscribe('omnichannel.priority-changed', () => {\n      queryClient.invalidateQueries(['/v1/livechat/priorities']);\n    });\n  }, [isPrioritiesEnabled, queryClient, subscribe]);\n  useEffect(() => {\n    if (!accessible) {\n      return;\n    }\n    const update = async () => {\n      try {\n        const routeConfig = await getRoutingConfig();\n        setRouteConfig(routeConfig);\n      } catch (error) {\n        loggerRef.current.error(\"update() error in routeConfig \".concat(error));\n      }\n    };\n    if (omnichannelRouting || !omnichannelRouting) {\n      update();\n    }\n  }, [accessible, getRoutingConfig, iceServersSetting, omnichannelRouting, setRouteConfig, voipCallAvailable]);\n  const manuallySelected = enabled && canViewOmnichannelQueue && !!routeConfig && routeConfig.showQueue && !routeConfig.autoAssignAgent && agentAvailable;\n  const streamNotifyUser = useStream('notify-user');\n  useEffect(() => {\n    if (!manuallySelected) {\n      return;\n    }\n    const handleDepartmentAgentData = () => {\n      initializeLivechatInquiryStream(user === null || user === void 0 ? void 0 : user._id);\n    };\n    initializeLivechatInquiryStream(user === null || user === void 0 ? void 0 : user._id);\n    if (!(user !== null && user !== void 0 && user._id)) {\n      return;\n    }\n    return streamNotifyUser(\"\".concat(user._id, \"/departmentAgentData\"), handleDepartmentAgentData);\n  }, [manuallySelected, streamNotifyUser, user === null || user === void 0 ? void 0 : user._id]);\n  const queue = useReactiveValue(useCallback(() => {\n    if (!manuallySelected) {\n      return undefined;\n    }\n    return LivechatInquiry.find({\n      status: LivechatInquiryStatus.QUEUED\n    }, {\n      sort: getOmniChatSortQuery(omnichannelSortingMechanism),\n      limit: omnichannelPoolMaxIncoming\n    }).fetch();\n  }, [manuallySelected, omnichannelPoolMaxIncoming, omnichannelSortingMechanism]));\n  queue === null || queue === void 0 ? void 0 : queue.map(_ref2 => {\n    let {\n      rid\n    } = _ref2;\n    if (queueNotification.has(rid)) {\n      return;\n    }\n    setQueueNotification(prev => new Set([...prev, rid]));\n    return KonchatNotification.newRoom(rid);\n  });\n  const contextValue = useMemo(() => {\n    if (!enabled) {\n      return emptyContextValue;\n    }\n    const livechatPriorities = {\n      enabled: isPrioritiesEnabled,\n      data: priorities,\n      isLoading: isLoadingPriorities,\n      isError: isErrorPriorities\n    };\n    if (!manuallySelected) {\n      return _objectSpread(_objectSpread({}, emptyContextValue), {}, {\n        enabled: true,\n        isEnterprise,\n        agentAvailable,\n        voipCallAvailable,\n        routeConfig,\n        livechatPriorities,\n        isOverMacLimit\n      });\n    }\n    return _objectSpread(_objectSpread({}, emptyContextValue), {}, {\n      enabled: true,\n      isEnterprise,\n      agentAvailable,\n      voipCallAvailable,\n      routeConfig,\n      inquiries: queue ? {\n        enabled: true,\n        queue\n      } : {\n        enabled: false\n      },\n      showOmnichannelQueueLink: showOmnichannelQueueLink && !!agentAvailable,\n      livechatPriorities,\n      isOverMacLimit\n    });\n  }, [enabled, isPrioritiesEnabled, priorities, isLoadingPriorities, isErrorPriorities, manuallySelected, isEnterprise, agentAvailable, voipCallAvailable, routeConfig, queue, showOmnichannelQueueLink, isOverMacLimit]);\n  return /*#__PURE__*/React.createElement(OmnichannelContext.Provider, {\n    children: children,\n    value: contextValue\n  });\n};\nmodule.exportDefault( /*#__PURE__*/memo(OmnichannelProvider));","map":{"version":3,"names":["_objectSpread","module","link","default","v","LivechatInquiryStatus","useSafely","useUser","useSetting","usePermission","useMethod","useEndpoint","useStream","useQuery","useQueryClient","React","useState","useEffect","useMemo","useCallback","memo","useRef","LivechatInquiry","initializeLivechatInquiryStream","getOmniChatSortQuery","KonchatNotification","ClientLogger","OmnichannelContext","useHasLicenseModule","useReactiveValue","useShouldPreventAction","emptyContextValue","inquiries","enabled","isEnterprise","agentAvailable","showOmnichannelQueueLink","isOverMacLimit","livechatPriorities","data","isLoading","isError","OmnichannelProvider","_ref","_useSetting","children","omniChannelEnabled","omnichannelRouting","omnichannelPoolMaxIncoming","omnichannelSortingMechanism","loggerRef","hasAccess","canViewOmnichannelQueue","user","statusLivechat","voipCallAvailable","getRoutingConfig","routeConfig","setRouteConfig","undefined","queueNotification","setQueueNotification","Set","accessible","iceServersSetting","getPriorities","subscribe","queryClient","isPrioritiesEnabled","priorities","isInitialLoading","isLoadingPriorities","isErrorPriorities","sort","JSON","stringify","sortItem","staleTime","Infinity","invalidateQueries","update","error","current","concat","manuallySelected","showQueue","autoAssignAgent","streamNotifyUser","handleDepartmentAgentData","_id","queue","find","status","QUEUED","limit","fetch","map","_ref2","rid","has","prev","newRoom","contextValue","createElement","Provider","value","exportDefault"],"sources":["client/providers/OmnichannelProvider.tsx"],"sourcesContent":["import {\n\ttype IOmnichannelAgent,\n\ttype OmichannelRoutingConfig,\n\ttype OmnichannelSortingMechanismSettingType,\n\ttype ILivechatInquiryRecord,\n\tLivechatInquiryStatus,\n} from '@rocket.chat/core-typings';\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\nimport { useUser, useSetting, usePermission, useMethod, useEndpoint, useStream } from '@rocket.chat/ui-contexts';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport type { ReactNode } from 'react';\nimport React, { useState, useEffect, useMemo, useCallback, memo, useRef } from 'react';\n\nimport { LivechatInquiry } from '../../app/livechat/client/collections/LivechatInquiry';\nimport { initializeLivechatInquiryStream } from '../../app/livechat/client/lib/stream/queueManager';\nimport { getOmniChatSortQuery } from '../../app/livechat/lib/inquiries';\nimport { KonchatNotification } from '../../app/ui/client/lib/KonchatNotification';\nimport { ClientLogger } from '../../lib/ClientLogger';\nimport type { OmnichannelContextValue } from '../contexts/OmnichannelContext';\nimport { OmnichannelContext } from '../contexts/OmnichannelContext';\nimport { useHasLicenseModule } from '../hooks/useHasLicenseModule';\nimport { useReactiveValue } from '../hooks/useReactiveValue';\nimport { useShouldPreventAction } from '../hooks/useShouldPreventAction';\n\nconst emptyContextValue: OmnichannelContextValue = {\n\tinquiries: { enabled: false },\n\tenabled: false,\n\tisEnterprise: false,\n\tagentAvailable: false,\n\tshowOmnichannelQueueLink: false,\n\tisOverMacLimit: false,\n\tlivechatPriorities: {\n\t\tenabled: false,\n\t\tdata: [],\n\t\tisLoading: false,\n\t\tisError: false,\n\t},\n};\n\ntype OmnichannelProviderProps = {\n\tchildren?: ReactNode;\n};\n\nconst OmnichannelProvider = ({ children }: OmnichannelProviderProps) => {\n\tconst omniChannelEnabled = useSetting('Livechat_enabled') as boolean;\n\tconst omnichannelRouting = useSetting('Livechat_Routing_Method');\n\tconst showOmnichannelQueueLink = useSetting('Livechat_show_queue_list_link') as boolean;\n\tconst omnichannelPoolMaxIncoming = useSetting<number>('Livechat_guest_pool_max_number_incoming_livechats_displayed') ?? 0;\n\tconst omnichannelSortingMechanism = useSetting('Omnichannel_sorting_mechanism') as OmnichannelSortingMechanismSettingType;\n\n\tconst loggerRef = useRef(new ClientLogger('OmnichannelProvider'));\n\tconst hasAccess = usePermission('view-l-room');\n\tconst canViewOmnichannelQueue = usePermission('view-livechat-queue');\n\tconst user = useUser() as IOmnichannelAgent;\n\n\tconst agentAvailable = user?.statusLivechat === 'available';\n\tconst voipCallAvailable = true; // TODO: use backend check;\n\n\tconst getRoutingConfig = useMethod('livechat:getRoutingConfig');\n\n\tconst [routeConfig, setRouteConfig] = useSafely(useState<OmichannelRoutingConfig | undefined>(undefined));\n\tconst [queueNotification, setQueueNotification] = useState(new Set());\n\n\tconst accessible = hasAccess && omniChannelEnabled;\n\tconst iceServersSetting: any = useSetting('WebRTC_Servers');\n\tconst isEnterprise = useHasLicenseModule('livechat-enterprise') === true;\n\n\tconst getPriorities = useEndpoint('GET', '/v1/livechat/priorities');\n\tconst subscribe = useStream('notify-logged');\n\tconst queryClient = useQueryClient();\n\tconst isPrioritiesEnabled = isEnterprise && accessible;\n\tconst enabled = accessible && !!user && !!routeConfig;\n\n\tconst {\n\t\tdata: { priorities = [] } = {},\n\t\tisInitialLoading: isLoadingPriorities,\n\t\tisError: isErrorPriorities,\n\t} = useQuery(['/v1/livechat/priorities'], () => getPriorities({ sort: JSON.stringify({ sortItem: 1 }) }), {\n\t\tstaleTime: Infinity,\n\t\tenabled: isPrioritiesEnabled,\n\t});\n\n\tconst isOverMacLimit = useShouldPreventAction('monthlyActiveContacts');\n\n\tuseEffect(() => {\n\t\tif (!isPrioritiesEnabled) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn subscribe('omnichannel.priority-changed', () => {\n\t\t\tqueryClient.invalidateQueries(['/v1/livechat/priorities']);\n\t\t});\n\t}, [isPrioritiesEnabled, queryClient, subscribe]);\n\n\tuseEffect(() => {\n\t\tif (!accessible) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst update = async (): Promise<void> => {\n\t\t\ttry {\n\t\t\t\tconst routeConfig = await getRoutingConfig();\n\t\t\t\tsetRouteConfig(routeConfig);\n\t\t\t} catch (error) {\n\t\t\t\tloggerRef.current.error(`update() error in routeConfig ${error}`);\n\t\t\t}\n\t\t};\n\n\t\tif (omnichannelRouting || !omnichannelRouting) {\n\t\t\tupdate();\n\t\t}\n\t}, [accessible, getRoutingConfig, iceServersSetting, omnichannelRouting, setRouteConfig, voipCallAvailable]);\n\n\tconst manuallySelected =\n\t\tenabled && canViewOmnichannelQueue && !!routeConfig && routeConfig.showQueue && !routeConfig.autoAssignAgent && agentAvailable;\n\n\tconst streamNotifyUser = useStream('notify-user');\n\tuseEffect(() => {\n\t\tif (!manuallySelected) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst handleDepartmentAgentData = (): void => {\n\t\t\tinitializeLivechatInquiryStream(user?._id);\n\t\t};\n\n\t\tinitializeLivechatInquiryStream(user?._id);\n\t\tif (!user?._id) {\n\t\t\treturn;\n\t\t}\n\t\treturn streamNotifyUser(`${user._id}/departmentAgentData`, handleDepartmentAgentData);\n\t}, [manuallySelected, streamNotifyUser, user?._id]);\n\n\tconst queue = useReactiveValue<ILivechatInquiryRecord[] | undefined>(\n\t\tuseCallback(() => {\n\t\t\tif (!manuallySelected) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\treturn LivechatInquiry.find(\n\t\t\t\t{ status: LivechatInquiryStatus.QUEUED },\n\t\t\t\t{\n\t\t\t\t\tsort: getOmniChatSortQuery(omnichannelSortingMechanism),\n\t\t\t\t\tlimit: omnichannelPoolMaxIncoming,\n\t\t\t\t},\n\t\t\t).fetch();\n\t\t}, [manuallySelected, omnichannelPoolMaxIncoming, omnichannelSortingMechanism]),\n\t);\n\n\tqueue?.map(({ rid }) => {\n\t\tif (queueNotification.has(rid)) {\n\t\t\treturn;\n\t\t}\n\t\tsetQueueNotification((prev) => new Set([...prev, rid]));\n\t\treturn KonchatNotification.newRoom(rid);\n\t});\n\n\tconst contextValue = useMemo<OmnichannelContextValue>(() => {\n\t\tif (!enabled) {\n\t\t\treturn emptyContextValue;\n\t\t}\n\n\t\tconst livechatPriorities = {\n\t\t\tenabled: isPrioritiesEnabled,\n\t\t\tdata: priorities,\n\t\t\tisLoading: isLoadingPriorities,\n\t\t\tisError: isErrorPriorities,\n\t\t};\n\n\t\tif (!manuallySelected) {\n\t\t\treturn {\n\t\t\t\t...emptyContextValue,\n\t\t\t\tenabled: true,\n\t\t\t\tisEnterprise,\n\t\t\t\tagentAvailable,\n\t\t\t\tvoipCallAvailable,\n\t\t\t\trouteConfig,\n\t\t\t\tlivechatPriorities,\n\t\t\t\tisOverMacLimit,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\t...emptyContextValue,\n\t\t\tenabled: true,\n\t\t\tisEnterprise,\n\t\t\tagentAvailable,\n\t\t\tvoipCallAvailable,\n\t\t\trouteConfig,\n\t\t\tinquiries: queue\n\t\t\t\t? {\n\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\tqueue,\n\t\t\t\t\t}\n\t\t\t\t: { enabled: false },\n\t\t\tshowOmnichannelQueueLink: showOmnichannelQueueLink && !!agentAvailable,\n\t\t\tlivechatPriorities,\n\t\t\tisOverMacLimit,\n\t\t};\n\t}, [\n\t\tenabled,\n\t\tisPrioritiesEnabled,\n\t\tpriorities,\n\t\tisLoadingPriorities,\n\t\tisErrorPriorities,\n\t\tmanuallySelected,\n\t\tisEnterprise,\n\t\tagentAvailable,\n\t\tvoipCallAvailable,\n\t\trouteConfig,\n\t\tqueue,\n\t\tshowOmnichannelQueueLink,\n\t\tisOverMacLimit,\n\t]);\n\n\treturn <OmnichannelContext.Provider children={children} value={contextValue} />;\n};\n\nexport default memo<typeof OmnichannelProvider>(OmnichannelProvider);\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"385f3ec84daa35862020801201b6ff4b14312226"}
