{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/bridges/commands.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/apps/server/bridges/commands.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/bridges/commands.ts","inputSourceMap":{"version":3,"file":"app/apps/server/bridges/commands.ts","sourceRoot":"","sources":["app/apps/server/bridges/commands.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IAppServerOrchestrator, IAppsRoom, IAppsUser } from '@rocket.chat/apps';\nimport type { ISlashCommand, ISlashCommandPreview, ISlashCommandPreviewItem } from '@rocket.chat/apps-engine/definition/slashcommands';\nimport { SlashCommandContext } from '@rocket.chat/apps-engine/definition/slashcommands';\nimport { CommandBridge } from '@rocket.chat/apps-engine/server/bridges/CommandBridge';\nimport type { IMessage, RequiredField, SlashCommand, SlashCommandCallbackParams } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\n\nimport { Utilities } from '../../../../ee/lib/misc/Utilities';\nimport { parseParameters } from '../../../../lib/utils/parseParameters';\nimport { slashCommands } from '../../../utils/server/slashCommand';\n\nexport class AppCommandsBridge extends CommandBridge {\n\tdisabledCommands: Map<string, (typeof slashCommands.commands)[string]>;\n\n\tconstructor(private readonly orch: IAppServerOrchestrator) {\n\t\tsuper();\n\t\tthis.disabledCommands = new Map();\n\t}\n\n\tprotected async doesCommandExist(command: string, appId: string): Promise<boolean> {\n\t\tthis.orch.debugLog(`The App ${appId} is checking if \"${command}\" command exists.`);\n\n\t\tif (typeof command !== 'string' || command.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\n\t\treturn typeof slashCommands.commands[cmd] === 'object' || this.disabledCommands.has(cmd);\n\t}\n\n\tprotected async enableCommand(command: string, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to enable the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tif (!this.disabledCommands.has(cmd)) {\n\t\t\tthrow new Error(`The command is not currently disabled: \"${cmd}\"`);\n\t\t}\n\n\t\tslashCommands.commands[cmd] = this.disabledCommands.get(cmd) as (typeof slashCommands.commands)[string];\n\t\tthis.disabledCommands.delete(cmd);\n\n\t\tvoid this.orch.getNotifier().commandUpdated(cmd);\n\t}\n\n\tprotected async disableCommand(command: string, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to disable the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tif (this.disabledCommands.has(cmd)) {\n\t\t\t// The command is already disabled, no need to disable it yet again\n\t\t\treturn;\n\t\t}\n\n\t\tconst commandObj = slashCommands.commands[cmd];\n\n\t\tif (typeof commandObj === 'undefined') {\n\t\t\tthrow new Error(`Command does not exist in the system currently: \"${cmd}\"`);\n\t\t}\n\n\t\tthis.disabledCommands.set(cmd, commandObj);\n\t\tdelete slashCommands.commands[cmd];\n\n\t\tvoid this.orch.getNotifier().commandDisabled(cmd);\n\t}\n\n\t// command: { command, paramsExample, i18nDescription, executor: function }\n\tprotected async modifyCommand(command: ISlashCommand, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to modify the command: \"${command}\"`);\n\n\t\tthis._verifyCommand(command);\n\n\t\tconst cmd = command.command.toLowerCase();\n\t\tif (typeof slashCommands.commands[cmd] === 'undefined') {\n\t\t\tthrow new Error(`Command does not exist in the system currently (or it is disabled): \"${cmd}\"`);\n\t\t}\n\n\t\tconst item = slashCommands.commands[cmd];\n\n\t\titem.params = command.i18nParamsExample ? command.i18nParamsExample : item.params;\n\t\titem.description = command.i18nDescription ? command.i18nDescription : item.params;\n\t\titem.callback = this._appCommandExecutor.bind(this);\n\t\titem.providesPreview = command.providesPreview;\n\t\titem.previewer = command.previewer ? this._appCommandPreviewer.bind(this) : item.previewer;\n\t\titem.previewCallback = (\n\t\t\tcommand.executePreviewItem ? this._appCommandPreviewExecutor.bind(this) : item.previewCallback\n\t\t) as (typeof slashCommands.commands)[string]['previewCallback'];\n\n\t\tslashCommands.commands[cmd] = item;\n\t\tvoid this.orch.getNotifier().commandUpdated(cmd);\n\t}\n\n\tprotected async registerCommand(command: ISlashCommand, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is registering the command: \"${command.command}\"`);\n\n\t\tthis._verifyCommand(command);\n\n\t\tconst item = {\n\t\t\tappId,\n\t\t\tcommand: command.command.toLowerCase(),\n\t\t\tparams: Utilities.getI18nKeyForApp(command.i18nParamsExample, appId),\n\t\t\tdescription: Utilities.getI18nKeyForApp(command.i18nDescription, appId),\n\t\t\tpermission: command.permission,\n\t\t\tcallback: this._appCommandExecutor.bind(this),\n\t\t\tprovidesPreview: command.providesPreview,\n\t\t\tpreviewer: command.providesPreview ? this._appCommandPreviewer.bind(this) : undefined,\n\t\t\tpreviewCallback: (command.providesPreview ? this._appCommandPreviewExecutor.bind(this) : undefined) as\n\t\t\t\t| (typeof slashCommands.commands)[string]['previewCallback']\n\t\t\t\t| undefined,\n\t\t} as SlashCommand;\n\n\t\tslashCommands.commands[command.command.toLowerCase()] = item;\n\t\tvoid this.orch.getNotifier().commandAdded(command.command.toLowerCase());\n\t}\n\n\tprotected async unregisterCommand(command: string, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is unregistering the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tthis.disabledCommands.delete(cmd);\n\t\tdelete slashCommands.commands[cmd];\n\n\t\tvoid this.orch.getNotifier().commandRemoved(cmd);\n\t}\n\n\tprivate _verifyCommand(command: ISlashCommand): void {\n\t\tif (typeof command !== 'object') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.command !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (command.i18nParamsExample && typeof command.i18nParamsExample !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (command.i18nDescription && typeof command.i18nDescription !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.providesPreview !== 'boolean') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\t}\n\n\tprivate async _appCommandExecutor({ command, message, params, triggerId, userId }: SlashCommandCallbackParams<string>): Promise<void> {\n\t\t// #TODO: #AppsEngineTypes - Remove explicit types and typecasts once the apps-engine definition/implementation mismatch is fixed.\n\t\tconst user: IAppsUser | undefined = await this.orch.getConverters()?.get('users').convertById(userId);\n\t\tconst room: IAppsRoom | undefined = await this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst parameters = parseParameters(params);\n\n\t\tconst context = new SlashCommandContext(\n\t\t\tObject.freeze(user as IAppsUser),\n\t\t\tObject.freeze(room as IAppsRoom),\n\t\t\tObject.freeze(parameters) as string[],\n\t\t\tthreadId,\n\t\t\ttriggerId,\n\t\t);\n\n\t\tawait this.orch.getManager()?.getCommandManager().executeCommand(command, context);\n\t}\n\n\tprivate async _appCommandPreviewer(\n\t\tcommand: string,\n\t\tparameters: any,\n\t\tmessage: RequiredField<Partial<IMessage>, 'rid'>,\n\t): Promise<ISlashCommandPreview | undefined> {\n\t\t// #TODO: #AppsEngineTypes - Remove explicit types and typecasts once the apps-engine definition/implementation mismatch is fixed.\n\t\tconst uid = Meteor.userId() as string;\n\t\tconst user: IAppsUser | undefined = await this.orch.getConverters()?.get('users').convertById(uid);\n\t\tconst room: IAppsRoom | undefined = await this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst params = parseParameters(parameters);\n\n\t\tconst context = new SlashCommandContext(\n\t\t\tObject.freeze(user as IAppsUser),\n\t\t\tObject.freeze(room as IAppsRoom),\n\t\t\tObject.freeze(params) as string[],\n\t\t\tthreadId,\n\t\t);\n\t\treturn this.orch.getManager()?.getCommandManager().getPreviews(command, context);\n\t}\n\n\tprivate async _appCommandPreviewExecutor(\n\t\tcommand: string,\n\t\tparameters: any,\n\t\tmessage: IMessage,\n\t\tpreview: ISlashCommandPreviewItem,\n\t\ttriggerId: string,\n\t): Promise<void> {\n\t\t// #TODO: #AppsEngineTypes - Remove explicit types and typecasts once the apps-engine definition/implementation mismatch is fixed.\n\t\tconst uid = Meteor.userId() as string;\n\t\tconst user: IAppsUser | undefined = await this.orch.getConverters()?.get('users').convertById(uid);\n\t\tconst room: IAppsRoom | undefined = await this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst params = parseParameters(parameters);\n\n\t\tconst context = new SlashCommandContext(\n\t\t\tObject.freeze(user as IAppsUser),\n\t\t\tObject.freeze(room as IAppsRoom),\n\t\t\tObject.freeze(params) as string[],\n\t\t\tthreadId,\n\t\t\ttriggerId,\n\t\t);\n\n\t\tawait this.orch.getManager()?.getCommandManager().executePreview(command, preview, context);\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/bridges/commands.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/apps/server/bridges/commands.ts","inputSourceMap":{"version":3,"file":"app/apps/server/bridges/commands.ts","sourceRoot":"","sources":["app/apps/server/bridges/commands.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IAppServerOrchestrator, IAppsRoom, IAppsUser } from '@rocket.chat/apps';\nimport type { ISlashCommand, ISlashCommandPreview, ISlashCommandPreviewItem } from '@rocket.chat/apps-engine/definition/slashcommands';\nimport { SlashCommandContext } from '@rocket.chat/apps-engine/definition/slashcommands';\nimport { CommandBridge } from '@rocket.chat/apps-engine/server/bridges/CommandBridge';\nimport type { IMessage, RequiredField, SlashCommand, SlashCommandCallbackParams } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\n\nimport { Utilities } from '../../../../ee/lib/misc/Utilities';\nimport { parseParameters } from '../../../../lib/utils/parseParameters';\nimport { slashCommands } from '../../../utils/server/slashCommand';\n\nexport class AppCommandsBridge extends CommandBridge {\n\tdisabledCommands: Map<string, (typeof slashCommands.commands)[string]>;\n\n\tconstructor(private readonly orch: IAppServerOrchestrator) {\n\t\tsuper();\n\t\tthis.disabledCommands = new Map();\n\t}\n\n\tprotected async doesCommandExist(command: string, appId: string): Promise<boolean> {\n\t\tthis.orch.debugLog(`The App ${appId} is checking if \"${command}\" command exists.`);\n\n\t\tif (typeof command !== 'string' || command.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\n\t\treturn typeof slashCommands.commands[cmd] === 'object' || this.disabledCommands.has(cmd);\n\t}\n\n\tprotected async enableCommand(command: string, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to enable the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tif (!this.disabledCommands.has(cmd)) {\n\t\t\tthrow new Error(`The command is not currently disabled: \"${cmd}\"`);\n\t\t}\n\n\t\tslashCommands.commands[cmd] = this.disabledCommands.get(cmd) as (typeof slashCommands.commands)[string];\n\t\tthis.disabledCommands.delete(cmd);\n\n\t\tvoid this.orch.getNotifier().commandUpdated(cmd);\n\t}\n\n\tprotected async disableCommand(command: string, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to disable the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tif (this.disabledCommands.has(cmd)) {\n\t\t\t// The command is already disabled, no need to disable it yet again\n\t\t\treturn;\n\t\t}\n\n\t\tconst commandObj = slashCommands.commands[cmd];\n\n\t\tif (typeof commandObj === 'undefined') {\n\t\t\tthrow new Error(`Command does not exist in the system currently: \"${cmd}\"`);\n\t\t}\n\n\t\tthis.disabledCommands.set(cmd, commandObj);\n\t\tdelete slashCommands.commands[cmd];\n\n\t\tvoid this.orch.getNotifier().commandDisabled(cmd);\n\t}\n\n\t// command: { command, paramsExample, i18nDescription, executor: function }\n\tprotected async modifyCommand(command: ISlashCommand, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to modify the command: \"${command}\"`);\n\n\t\tthis._verifyCommand(command);\n\n\t\tconst cmd = command.command.toLowerCase();\n\t\tif (typeof slashCommands.commands[cmd] === 'undefined') {\n\t\t\tthrow new Error(`Command does not exist in the system currently (or it is disabled): \"${cmd}\"`);\n\t\t}\n\n\t\tconst item = slashCommands.commands[cmd];\n\n\t\titem.params = command.i18nParamsExample ? command.i18nParamsExample : item.params;\n\t\titem.description = command.i18nDescription ? command.i18nDescription : item.params;\n\t\titem.callback = this._appCommandExecutor.bind(this);\n\t\titem.providesPreview = command.providesPreview;\n\t\titem.previewer = command.previewer ? this._appCommandPreviewer.bind(this) : item.previewer;\n\t\titem.previewCallback = (\n\t\t\tcommand.executePreviewItem ? this._appCommandPreviewExecutor.bind(this) : item.previewCallback\n\t\t) as (typeof slashCommands.commands)[string]['previewCallback'];\n\n\t\tslashCommands.commands[cmd] = item;\n\t\tvoid this.orch.getNotifier().commandUpdated(cmd);\n\t}\n\n\tprotected async registerCommand(command: ISlashCommand, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is registering the command: \"${command.command}\"`);\n\n\t\tthis._verifyCommand(command);\n\n\t\tconst item = {\n\t\t\tappId,\n\t\t\tcommand: command.command.toLowerCase(),\n\t\t\tparams: Utilities.getI18nKeyForApp(command.i18nParamsExample, appId),\n\t\t\tdescription: Utilities.getI18nKeyForApp(command.i18nDescription, appId),\n\t\t\tpermission: command.permission,\n\t\t\tcallback: this._appCommandExecutor.bind(this),\n\t\t\tprovidesPreview: command.providesPreview,\n\t\t\tpreviewer: command.providesPreview ? this._appCommandPreviewer.bind(this) : undefined,\n\t\t\tpreviewCallback: (command.providesPreview ? this._appCommandPreviewExecutor.bind(this) : undefined) as\n\t\t\t\t| (typeof slashCommands.commands)[string]['previewCallback']\n\t\t\t\t| undefined,\n\t\t} as SlashCommand;\n\n\t\tslashCommands.commands[command.command.toLowerCase()] = item;\n\t\tvoid this.orch.getNotifier().commandAdded(command.command.toLowerCase());\n\t}\n\n\tprotected async unregisterCommand(command: string, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is unregistering the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tthis.disabledCommands.delete(cmd);\n\t\tdelete slashCommands.commands[cmd];\n\n\t\tvoid this.orch.getNotifier().commandRemoved(cmd);\n\t}\n\n\tprivate _verifyCommand(command: ISlashCommand): void {\n\t\tif (typeof command !== 'object') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.command !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (command.i18nParamsExample && typeof command.i18nParamsExample !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (command.i18nDescription && typeof command.i18nDescription !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.providesPreview !== 'boolean') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\t}\n\n\tprivate async _appCommandExecutor({ command, message, params, triggerId, userId }: SlashCommandCallbackParams<string>): Promise<void> {\n\t\t// #TODO: #AppsEngineTypes - Remove explicit types and typecasts once the apps-engine definition/implementation mismatch is fixed.\n\t\tconst user: IAppsUser | undefined = await this.orch.getConverters()?.get('users').convertById(userId);\n\t\tconst room: IAppsRoom | undefined = await this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst parameters = parseParameters(params);\n\n\t\tconst context = new SlashCommandContext(\n\t\t\tObject.freeze(user as IAppsUser),\n\t\t\tObject.freeze(room as IAppsRoom),\n\t\t\tObject.freeze(parameters) as string[],\n\t\t\tthreadId,\n\t\t\ttriggerId,\n\t\t);\n\n\t\tawait this.orch.getManager()?.getCommandManager().executeCommand(command, context);\n\t}\n\n\tprivate async _appCommandPreviewer(\n\t\tcommand: string,\n\t\tparameters: any,\n\t\tmessage: RequiredField<Partial<IMessage>, 'rid'>,\n\t): Promise<ISlashCommandPreview | undefined> {\n\t\t// #TODO: #AppsEngineTypes - Remove explicit types and typecasts once the apps-engine definition/implementation mismatch is fixed.\n\t\tconst uid = Meteor.userId() as string;\n\t\tconst user: IAppsUser | undefined = await this.orch.getConverters()?.get('users').convertById(uid);\n\t\tconst room: IAppsRoom | undefined = await this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst params = parseParameters(parameters);\n\n\t\tconst context = new SlashCommandContext(\n\t\t\tObject.freeze(user as IAppsUser),\n\t\t\tObject.freeze(room as IAppsRoom),\n\t\t\tObject.freeze(params) as string[],\n\t\t\tthreadId,\n\t\t);\n\t\treturn this.orch.getManager()?.getCommandManager().getPreviews(command, context);\n\t}\n\n\tprivate async _appCommandPreviewExecutor(\n\t\tcommand: string,\n\t\tparameters: any,\n\t\tmessage: IMessage,\n\t\tpreview: ISlashCommandPreviewItem,\n\t\ttriggerId: string,\n\t): Promise<void> {\n\t\t// #TODO: #AppsEngineTypes - Remove explicit types and typecasts once the apps-engine definition/implementation mismatch is fixed.\n\t\tconst uid = Meteor.userId() as string;\n\t\tconst user: IAppsUser | undefined = await this.orch.getConverters()?.get('users').convertById(uid);\n\t\tconst room: IAppsRoom | undefined = await this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst params = parseParameters(parameters);\n\n\t\tconst context = new SlashCommandContext(\n\t\t\tObject.freeze(user as IAppsUser),\n\t\t\tObject.freeze(room as IAppsRoom),\n\t\t\tObject.freeze(params) as string[],\n\t\t\tthreadId,\n\t\t\ttriggerId,\n\t\t);\n\n\t\tawait this.orch.getManager()?.getCommandManager().executePreview(command, preview, context);\n\t}\n}\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    module.export({\n      AppCommandsBridge: () => AppCommandsBridge\n    });\n    let SlashCommandContext;\n    module.link(\"@rocket.chat/apps-engine/definition/slashcommands\", {\n      SlashCommandContext(v) {\n        SlashCommandContext = v;\n      }\n    }, 0);\n    let CommandBridge;\n    module.link(\"@rocket.chat/apps-engine/server/bridges/CommandBridge\", {\n      CommandBridge(v) {\n        CommandBridge = v;\n      }\n    }, 1);\n    let Meteor;\n    module.link(\"meteor/meteor\", {\n      Meteor(v) {\n        Meteor = v;\n      }\n    }, 2);\n    let Utilities;\n    module.link(\"../../../../ee/lib/misc/Utilities\", {\n      Utilities(v) {\n        Utilities = v;\n      }\n    }, 3);\n    let parseParameters;\n    module.link(\"../../../../lib/utils/parseParameters\", {\n      parseParameters(v) {\n        parseParameters = v;\n      }\n    }, 4);\n    let slashCommands;\n    module.link(\"../../../utils/server/slashCommand\", {\n      slashCommands(v) {\n        slashCommands = v;\n      }\n    }, 5);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    class AppCommandsBridge extends CommandBridge {\n      constructor(orch) {\n        super();\n        this.orch = void 0;\n        this.disabledCommands = void 0;\n        this.orch = orch;\n        this.disabledCommands = new Map();\n      }\n      async doesCommandExist(command, appId) {\n        this.orch.debugLog(\"The App \".concat(appId, \" is checking if \\\"\").concat(command, \"\\\" command exists.\"));\n        if (typeof command !== 'string' || command.length === 0) {\n          return false;\n        }\n        const cmd = command.toLowerCase();\n        return typeof slashCommands.commands[cmd] === 'object' || this.disabledCommands.has(cmd);\n      }\n      async enableCommand(command, appId) {\n        this.orch.debugLog(\"The App \".concat(appId, \" is attempting to enable the command: \\\"\").concat(command, \"\\\"\"));\n        if (typeof command !== 'string' || command.trim().length === 0) {\n          throw new Error('Invalid command parameter provided, must be a string.');\n        }\n        const cmd = command.toLowerCase();\n        if (!this.disabledCommands.has(cmd)) {\n          throw new Error(\"The command is not currently disabled: \\\"\".concat(cmd, \"\\\"\"));\n        }\n        slashCommands.commands[cmd] = this.disabledCommands.get(cmd);\n        this.disabledCommands.delete(cmd);\n        void this.orch.getNotifier().commandUpdated(cmd);\n      }\n      async disableCommand(command, appId) {\n        this.orch.debugLog(\"The App \".concat(appId, \" is attempting to disable the command: \\\"\").concat(command, \"\\\"\"));\n        if (typeof command !== 'string' || command.trim().length === 0) {\n          throw new Error('Invalid command parameter provided, must be a string.');\n        }\n        const cmd = command.toLowerCase();\n        if (this.disabledCommands.has(cmd)) {\n          // The command is already disabled, no need to disable it yet again\n          return;\n        }\n        const commandObj = slashCommands.commands[cmd];\n        if (typeof commandObj === 'undefined') {\n          throw new Error(\"Command does not exist in the system currently: \\\"\".concat(cmd, \"\\\"\"));\n        }\n        this.disabledCommands.set(cmd, commandObj);\n        delete slashCommands.commands[cmd];\n        void this.orch.getNotifier().commandDisabled(cmd);\n      }\n      // command: { command, paramsExample, i18nDescription, executor: function }\n      async modifyCommand(command, appId) {\n        this.orch.debugLog(\"The App \".concat(appId, \" is attempting to modify the command: \\\"\").concat(command, \"\\\"\"));\n        this._verifyCommand(command);\n        const cmd = command.command.toLowerCase();\n        if (typeof slashCommands.commands[cmd] === 'undefined') {\n          throw new Error(\"Command does not exist in the system currently (or it is disabled): \\\"\".concat(cmd, \"\\\"\"));\n        }\n        const item = slashCommands.commands[cmd];\n        item.params = command.i18nParamsExample ? command.i18nParamsExample : item.params;\n        item.description = command.i18nDescription ? command.i18nDescription : item.params;\n        item.callback = this._appCommandExecutor.bind(this);\n        item.providesPreview = command.providesPreview;\n        item.previewer = command.previewer ? this._appCommandPreviewer.bind(this) : item.previewer;\n        item.previewCallback = command.executePreviewItem ? this._appCommandPreviewExecutor.bind(this) : item.previewCallback;\n        slashCommands.commands[cmd] = item;\n        void this.orch.getNotifier().commandUpdated(cmd);\n      }\n      async registerCommand(command, appId) {\n        this.orch.debugLog(\"The App \".concat(appId, \" is registering the command: \\\"\").concat(command.command, \"\\\"\"));\n        this._verifyCommand(command);\n        const item = {\n          appId,\n          command: command.command.toLowerCase(),\n          params: Utilities.getI18nKeyForApp(command.i18nParamsExample, appId),\n          description: Utilities.getI18nKeyForApp(command.i18nDescription, appId),\n          permission: command.permission,\n          callback: this._appCommandExecutor.bind(this),\n          providesPreview: command.providesPreview,\n          previewer: command.providesPreview ? this._appCommandPreviewer.bind(this) : undefined,\n          previewCallback: command.providesPreview ? this._appCommandPreviewExecutor.bind(this) : undefined\n        };\n        slashCommands.commands[command.command.toLowerCase()] = item;\n        void this.orch.getNotifier().commandAdded(command.command.toLowerCase());\n      }\n      async unregisterCommand(command, appId) {\n        this.orch.debugLog(\"The App \".concat(appId, \" is unregistering the command: \\\"\").concat(command, \"\\\"\"));\n        if (typeof command !== 'string' || command.trim().length === 0) {\n          throw new Error('Invalid command parameter provided, must be a string.');\n        }\n        const cmd = command.toLowerCase();\n        this.disabledCommands.delete(cmd);\n        delete slashCommands.commands[cmd];\n        void this.orch.getNotifier().commandRemoved(cmd);\n      }\n      _verifyCommand(command) {\n        if (typeof command !== 'object') {\n          throw new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n        }\n        if (typeof command.command !== 'string') {\n          throw new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n        }\n        if (command.i18nParamsExample && typeof command.i18nParamsExample !== 'string') {\n          throw new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n        }\n        if (command.i18nDescription && typeof command.i18nDescription !== 'string') {\n          throw new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n        }\n        if (typeof command.providesPreview !== 'boolean') {\n          throw new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n        }\n      }\n      async _appCommandExecutor(_ref) {\n        var _this$orch$getConvert, _this$orch$getConvert2, _this$orch$getManager;\n        let {\n          command,\n          message,\n          params,\n          triggerId,\n          userId\n        } = _ref;\n        // #TODO: #AppsEngineTypes - Remove explicit types and typecasts once the apps-engine definition/implementation mismatch is fixed.\n        const user = await ((_this$orch$getConvert = this.orch.getConverters()) === null || _this$orch$getConvert === void 0 ? void 0 : _this$orch$getConvert.get('users').convertById(userId));\n        const room = await ((_this$orch$getConvert2 = this.orch.getConverters()) === null || _this$orch$getConvert2 === void 0 ? void 0 : _this$orch$getConvert2.get('rooms').convertById(message.rid));\n        const threadId = message.tmid;\n        const parameters = parseParameters(params);\n        const context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(parameters), threadId, triggerId);\n        await ((_this$orch$getManager = this.orch.getManager()) === null || _this$orch$getManager === void 0 ? void 0 : _this$orch$getManager.getCommandManager().executeCommand(command, context));\n      }\n      async _appCommandPreviewer(command, parameters, message) {\n        var _this$orch$getConvert3, _this$orch$getConvert4, _this$orch$getManager2;\n        // #TODO: #AppsEngineTypes - Remove explicit types and typecasts once the apps-engine definition/implementation mismatch is fixed.\n        const uid = Meteor.userId();\n        const user = await ((_this$orch$getConvert3 = this.orch.getConverters()) === null || _this$orch$getConvert3 === void 0 ? void 0 : _this$orch$getConvert3.get('users').convertById(uid));\n        const room = await ((_this$orch$getConvert4 = this.orch.getConverters()) === null || _this$orch$getConvert4 === void 0 ? void 0 : _this$orch$getConvert4.get('rooms').convertById(message.rid));\n        const threadId = message.tmid;\n        const params = parseParameters(parameters);\n        const context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(params), threadId);\n        return (_this$orch$getManager2 = this.orch.getManager()) === null || _this$orch$getManager2 === void 0 ? void 0 : _this$orch$getManager2.getCommandManager().getPreviews(command, context);\n      }\n      async _appCommandPreviewExecutor(command, parameters, message, preview, triggerId) {\n        var _this$orch$getConvert5, _this$orch$getConvert6, _this$orch$getManager3;\n        // #TODO: #AppsEngineTypes - Remove explicit types and typecasts once the apps-engine definition/implementation mismatch is fixed.\n        const uid = Meteor.userId();\n        const user = await ((_this$orch$getConvert5 = this.orch.getConverters()) === null || _this$orch$getConvert5 === void 0 ? void 0 : _this$orch$getConvert5.get('users').convertById(uid));\n        const room = await ((_this$orch$getConvert6 = this.orch.getConverters()) === null || _this$orch$getConvert6 === void 0 ? void 0 : _this$orch$getConvert6.get('rooms').convertById(message.rid));\n        const threadId = message.tmid;\n        const params = parseParameters(parameters);\n        const context = new SlashCommandContext(Object.freeze(user), Object.freeze(room), Object.freeze(params), threadId, triggerId);\n        await ((_this$orch$getManager3 = this.orch.getManager()) === null || _this$orch$getManager3 === void 0 ? void 0 : _this$orch$getManager3.getCommandManager().executePreview(command, preview, context));\n      }\n    }\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["module","export","AppCommandsBridge","SlashCommandContext","link","v","CommandBridge","Meteor","Utilities","parseParameters","slashCommands","__reifyWaitForDeps__","constructor","orch","disabledCommands","Map","doesCommandExist","command","appId","debugLog","concat","length","cmd","toLowerCase","commands","has","enableCommand","trim","Error","get","delete","getNotifier","commandUpdated","disableCommand","commandObj","set","commandDisabled","modifyCommand","_verifyCommand","item","params","i18nParamsExample","description","i18nDescription","callback","_appCommandExecutor","bind","providesPreview","previewer","_appCommandPreviewer","previewCallback","executePreviewItem","_appCommandPreviewExecutor","registerCommand","getI18nKeyForApp","permission","undefined","commandAdded","unregisterCommand","commandRemoved","_ref","_this$orch$getConvert","_this$orch$getConvert2","_this$orch$getManager","message","triggerId","userId","user","getConverters","convertById","room","rid","threadId","tmid","parameters","context","Object","freeze","getManager","getCommandManager","executeCommand","_this$orch$getConvert3","_this$orch$getConvert4","_this$orch$getManager2","uid","getPreviews","preview","_this$orch$getConvert5","_this$orch$getConvert6","_this$orch$getManager3","executePreview","__reify_async_result__","_reifyError","self","async"],"sources":["app/apps/server/bridges/commands.ts"],"sourcesContent":["import type { IAppServerOrchestrator, IAppsRoom, IAppsUser } from '@rocket.chat/apps';\nimport type { ISlashCommand, ISlashCommandPreview, ISlashCommandPreviewItem } from '@rocket.chat/apps-engine/definition/slashcommands';\nimport { SlashCommandContext } from '@rocket.chat/apps-engine/definition/slashcommands';\nimport { CommandBridge } from '@rocket.chat/apps-engine/server/bridges/CommandBridge';\nimport type { IMessage, RequiredField, SlashCommand, SlashCommandCallbackParams } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\n\nimport { Utilities } from '../../../../ee/lib/misc/Utilities';\nimport { parseParameters } from '../../../../lib/utils/parseParameters';\nimport { slashCommands } from '../../../utils/server/slashCommand';\n\nexport class AppCommandsBridge extends CommandBridge {\n\tdisabledCommands: Map<string, (typeof slashCommands.commands)[string]>;\n\n\tconstructor(private readonly orch: IAppServerOrchestrator) {\n\t\tsuper();\n\t\tthis.disabledCommands = new Map();\n\t}\n\n\tprotected async doesCommandExist(command: string, appId: string): Promise<boolean> {\n\t\tthis.orch.debugLog(`The App ${appId} is checking if \"${command}\" command exists.`);\n\n\t\tif (typeof command !== 'string' || command.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\n\t\treturn typeof slashCommands.commands[cmd] === 'object' || this.disabledCommands.has(cmd);\n\t}\n\n\tprotected async enableCommand(command: string, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to enable the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tif (!this.disabledCommands.has(cmd)) {\n\t\t\tthrow new Error(`The command is not currently disabled: \"${cmd}\"`);\n\t\t}\n\n\t\tslashCommands.commands[cmd] = this.disabledCommands.get(cmd) as (typeof slashCommands.commands)[string];\n\t\tthis.disabledCommands.delete(cmd);\n\n\t\tvoid this.orch.getNotifier().commandUpdated(cmd);\n\t}\n\n\tprotected async disableCommand(command: string, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to disable the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tif (this.disabledCommands.has(cmd)) {\n\t\t\t// The command is already disabled, no need to disable it yet again\n\t\t\treturn;\n\t\t}\n\n\t\tconst commandObj = slashCommands.commands[cmd];\n\n\t\tif (typeof commandObj === 'undefined') {\n\t\t\tthrow new Error(`Command does not exist in the system currently: \"${cmd}\"`);\n\t\t}\n\n\t\tthis.disabledCommands.set(cmd, commandObj);\n\t\tdelete slashCommands.commands[cmd];\n\n\t\tvoid this.orch.getNotifier().commandDisabled(cmd);\n\t}\n\n\t// command: { command, paramsExample, i18nDescription, executor: function }\n\tprotected async modifyCommand(command: ISlashCommand, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is attempting to modify the command: \"${command}\"`);\n\n\t\tthis._verifyCommand(command);\n\n\t\tconst cmd = command.command.toLowerCase();\n\t\tif (typeof slashCommands.commands[cmd] === 'undefined') {\n\t\t\tthrow new Error(`Command does not exist in the system currently (or it is disabled): \"${cmd}\"`);\n\t\t}\n\n\t\tconst item = slashCommands.commands[cmd];\n\n\t\titem.params = command.i18nParamsExample ? command.i18nParamsExample : item.params;\n\t\titem.description = command.i18nDescription ? command.i18nDescription : item.params;\n\t\titem.callback = this._appCommandExecutor.bind(this);\n\t\titem.providesPreview = command.providesPreview;\n\t\titem.previewer = command.previewer ? this._appCommandPreviewer.bind(this) : item.previewer;\n\t\titem.previewCallback = (\n\t\t\tcommand.executePreviewItem ? this._appCommandPreviewExecutor.bind(this) : item.previewCallback\n\t\t) as (typeof slashCommands.commands)[string]['previewCallback'];\n\n\t\tslashCommands.commands[cmd] = item;\n\t\tvoid this.orch.getNotifier().commandUpdated(cmd);\n\t}\n\n\tprotected async registerCommand(command: ISlashCommand, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is registering the command: \"${command.command}\"`);\n\n\t\tthis._verifyCommand(command);\n\n\t\tconst item = {\n\t\t\tappId,\n\t\t\tcommand: command.command.toLowerCase(),\n\t\t\tparams: Utilities.getI18nKeyForApp(command.i18nParamsExample, appId),\n\t\t\tdescription: Utilities.getI18nKeyForApp(command.i18nDescription, appId),\n\t\t\tpermission: command.permission,\n\t\t\tcallback: this._appCommandExecutor.bind(this),\n\t\t\tprovidesPreview: command.providesPreview,\n\t\t\tpreviewer: command.providesPreview ? this._appCommandPreviewer.bind(this) : undefined,\n\t\t\tpreviewCallback: (command.providesPreview ? this._appCommandPreviewExecutor.bind(this) : undefined) as\n\t\t\t\t| (typeof slashCommands.commands)[string]['previewCallback']\n\t\t\t\t| undefined,\n\t\t} as SlashCommand;\n\n\t\tslashCommands.commands[command.command.toLowerCase()] = item;\n\t\tvoid this.orch.getNotifier().commandAdded(command.command.toLowerCase());\n\t}\n\n\tprotected async unregisterCommand(command: string, appId: string): Promise<void> {\n\t\tthis.orch.debugLog(`The App ${appId} is unregistering the command: \"${command}\"`);\n\n\t\tif (typeof command !== 'string' || command.trim().length === 0) {\n\t\t\tthrow new Error('Invalid command parameter provided, must be a string.');\n\t\t}\n\n\t\tconst cmd = command.toLowerCase();\n\t\tthis.disabledCommands.delete(cmd);\n\t\tdelete slashCommands.commands[cmd];\n\n\t\tvoid this.orch.getNotifier().commandRemoved(cmd);\n\t}\n\n\tprivate _verifyCommand(command: ISlashCommand): void {\n\t\tif (typeof command !== 'object') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.command !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (command.i18nParamsExample && typeof command.i18nParamsExample !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (command.i18nDescription && typeof command.i18nDescription !== 'string') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\n\t\tif (typeof command.providesPreview !== 'boolean') {\n\t\t\tthrow new Error('Invalid Slash Command parameter provided, it must be a valid ISlashCommand object.');\n\t\t}\n\t}\n\n\tprivate async _appCommandExecutor({ command, message, params, triggerId, userId }: SlashCommandCallbackParams<string>): Promise<void> {\n\t\t// #TODO: #AppsEngineTypes - Remove explicit types and typecasts once the apps-engine definition/implementation mismatch is fixed.\n\t\tconst user: IAppsUser | undefined = await this.orch.getConverters()?.get('users').convertById(userId);\n\t\tconst room: IAppsRoom | undefined = await this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst parameters = parseParameters(params);\n\n\t\tconst context = new SlashCommandContext(\n\t\t\tObject.freeze(user as IAppsUser),\n\t\t\tObject.freeze(room as IAppsRoom),\n\t\t\tObject.freeze(parameters) as string[],\n\t\t\tthreadId,\n\t\t\ttriggerId,\n\t\t);\n\n\t\tawait this.orch.getManager()?.getCommandManager().executeCommand(command, context);\n\t}\n\n\tprivate async _appCommandPreviewer(\n\t\tcommand: string,\n\t\tparameters: any,\n\t\tmessage: RequiredField<Partial<IMessage>, 'rid'>,\n\t): Promise<ISlashCommandPreview | undefined> {\n\t\t// #TODO: #AppsEngineTypes - Remove explicit types and typecasts once the apps-engine definition/implementation mismatch is fixed.\n\t\tconst uid = Meteor.userId() as string;\n\t\tconst user: IAppsUser | undefined = await this.orch.getConverters()?.get('users').convertById(uid);\n\t\tconst room: IAppsRoom | undefined = await this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst params = parseParameters(parameters);\n\n\t\tconst context = new SlashCommandContext(\n\t\t\tObject.freeze(user as IAppsUser),\n\t\t\tObject.freeze(room as IAppsRoom),\n\t\t\tObject.freeze(params) as string[],\n\t\t\tthreadId,\n\t\t);\n\t\treturn this.orch.getManager()?.getCommandManager().getPreviews(command, context);\n\t}\n\n\tprivate async _appCommandPreviewExecutor(\n\t\tcommand: string,\n\t\tparameters: any,\n\t\tmessage: IMessage,\n\t\tpreview: ISlashCommandPreviewItem,\n\t\ttriggerId: string,\n\t): Promise<void> {\n\t\t// #TODO: #AppsEngineTypes - Remove explicit types and typecasts once the apps-engine definition/implementation mismatch is fixed.\n\t\tconst uid = Meteor.userId() as string;\n\t\tconst user: IAppsUser | undefined = await this.orch.getConverters()?.get('users').convertById(uid);\n\t\tconst room: IAppsRoom | undefined = await this.orch.getConverters()?.get('rooms').convertById(message.rid);\n\t\tconst threadId = message.tmid;\n\t\tconst params = parseParameters(parameters);\n\n\t\tconst context = new SlashCommandContext(\n\t\t\tObject.freeze(user as IAppsUser),\n\t\t\tObject.freeze(room as IAppsRoom),\n\t\t\tObject.freeze(params) as string[],\n\t\t\tthreadId,\n\t\t\ttriggerId,\n\t\t);\n\n\t\tawait this.orch.getManager()?.getCommandManager().executePreview(command, preview, context);\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"0ba20492b18298ab9227c3cc1dfad59f8fc85529"}
