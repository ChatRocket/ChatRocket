{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-message/client/messageBox/createComposerAPI.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui-message/client/messageBox/createComposerAPI.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-message/client/messageBox/createComposerAPI.ts","inputSourceMap":{"version":3,"file":"app/ui-message/client/messageBox/createComposerAPI.ts","sourceRoot":"","sources":["app/ui-message/client/messageBox/createComposerAPI.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport { Accounts } from 'meteor/accounts-base';\n\nimport type { ComposerAPI } from '../../../../client/lib/chats/ChatAPI';\nimport { withDebouncing } from '../../../../lib/utils/highOrderFunctions';\nimport type { FormattingButton } from './messageBoxFormatting';\nimport { formattingButtons } from './messageBoxFormatting';\n\nexport const createComposerAPI = (input: HTMLTextAreaElement, storageID: string): ComposerAPI => {\n\tconst triggerEvent = (input: HTMLTextAreaElement, evt: string): void => {\n\t\tconst event = new Event(evt, { bubbles: true });\n\t\t// TODO: Remove this hack for react to trigger onChange\n\t\tconst tracker = (input as any)._valueTracker;\n\t\tif (tracker) {\n\t\t\ttracker.setValue(new Date().toString());\n\t\t}\n\t\tinput.dispatchEvent(event);\n\t};\n\n\tconst emitter = new Emitter<{\n\t\tquotedMessagesUpdate: void;\n\t\tediting: void;\n\t\trecording: void;\n\t\trecordingVideo: void;\n\t\tformatting: void;\n\t\tmircophoneDenied: void;\n\t}>();\n\n\tlet _quotedMessages: IMessage[] = [];\n\n\tconst persist = withDebouncing({ wait: 300 })(() => {\n\t\tif (input.value) {\n\t\t\tAccounts.storageLocation.setItem(storageID, input.value);\n\t\t\treturn;\n\t\t}\n\n\t\tAccounts.storageLocation.removeItem(storageID);\n\t});\n\n\tconst notifyQuotedMessagesUpdate = (): void => {\n\t\temitter.emit('quotedMessagesUpdate');\n\t};\n\n\tinput.addEventListener('input', persist);\n\n\tconst setText = (\n\t\ttext: string,\n\t\t{\n\t\t\tselection,\n\t\t\tskipFocus,\n\t\t}: {\n\t\t\tselection?:\n\t\t\t\t| { readonly start?: number; readonly end?: number }\n\t\t\t\t| ((previous: { readonly start: number; readonly end: number }) => { readonly start?: number; readonly end?: number });\n\t\t\tskipFocus?: boolean;\n\t\t} = {},\n\t): void => {\n\t\t!skipFocus && focus();\n\n\t\tconst { selectionStart, selectionEnd } = input;\n\t\tconst textAreaTxt = input.value;\n\n\t\tif (typeof selection === 'function') {\n\t\t\tselection = selection({ start: selectionStart, end: selectionEnd });\n\t\t}\n\n\t\tif (selection) {\n\t\t\tif (!document.execCommand?.('insertText', false, text)) {\n\t\t\t\tinput.value = textAreaTxt.substring(0, selectionStart) + text + textAreaTxt.substring(selectionStart);\n\t\t\t\t!skipFocus && focus();\n\t\t\t}\n\t\t\tinput.setSelectionRange(selection.start ?? 0, selection.end ?? text.length);\n\t\t}\n\n\t\tif (!selection) {\n\t\t\tinput.value = text;\n\t\t}\n\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\t!skipFocus && focus();\n\t};\n\n\tconst insertText = (text: string): void => {\n\t\tsetText(text, {\n\t\t\tselection: ({ start, end }) => ({\n\t\t\t\tstart: start + text.length,\n\t\t\t\tend: end + text.length,\n\t\t\t}),\n\t\t});\n\t};\n\n\tconst clear = (): void => {\n\t\tsetText('');\n\t};\n\n\tconst focus = (): void => {\n\t\tinput.focus();\n\t};\n\n\tconst replyWith = async (text: string): Promise<void> => {\n\t\tif (input) {\n\t\t\tinput.value = text;\n\t\t\tinput.focus();\n\t\t}\n\t};\n\n\tconst quoteMessage = async (message: IMessage): Promise<void> => {\n\t\t_quotedMessages = [..._quotedMessages.filter((_message) => _message._id !== message._id), message];\n\t\tnotifyQuotedMessagesUpdate();\n\t\tinput.focus();\n\t};\n\n\tconst dismissQuotedMessage = async (mid: IMessage['_id']): Promise<void> => {\n\t\t_quotedMessages = _quotedMessages.filter((message) => message._id !== mid);\n\t\tnotifyQuotedMessagesUpdate();\n\t};\n\n\tconst dismissAllQuotedMessages = async (): Promise<void> => {\n\t\t_quotedMessages = [];\n\t\tnotifyQuotedMessagesUpdate();\n\t};\n\n\tconst quotedMessages = {\n\t\tget: () => _quotedMessages,\n\t\tsubscribe: (callback: () => void) => emitter.on('quotedMessagesUpdate', callback),\n\t};\n\n\tconst [editing, setEditing] = (() => {\n\t\tlet editing = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => editing,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('editing', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\tediting = value;\n\t\t\t\temitter.emit('editing');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [recording, setRecordingMode] = (() => {\n\t\tlet recording = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => recording,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('recording', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\trecording = value;\n\t\t\t\temitter.emit('recording');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [recordingVideo, setRecordingVideo] = (() => {\n\t\tlet recordingVideo = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => recordingVideo,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('recordingVideo', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\trecordingVideo = value;\n\t\t\t\temitter.emit('recordingVideo');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [isMicrophoneDenied, setIsMicrophoneDenied] = (() => {\n\t\tlet isMicrophoneDenied = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => isMicrophoneDenied,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('mircophoneDenied', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\tisMicrophoneDenied = value;\n\t\t\t\temitter.emit('mircophoneDenied');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst setEditingMode = (editing: boolean): void => {\n\t\tsetEditing(editing);\n\t};\n\n\tconst [formatters, stopFormatterTracker] = (() => {\n\t\tlet actions: FormattingButton[] = [];\n\n\t\tconst c = Tracker.autorun(() => {\n\t\t\tactions = formattingButtons.filter(({ condition }) => !condition || condition());\n\t\t\temitter.emit('formatting');\n\t\t});\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => actions,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('formatting', callback),\n\t\t\t},\n\t\t\tc,\n\t\t];\n\t})();\n\n\tconst release = (): void => {\n\t\tinput.removeEventListener('input', persist);\n\t\tstopFormatterTracker.stop();\n\t};\n\n\tconst wrapSelection = (pattern: string): void => {\n\t\tconst { selectionEnd = input.value.length, selectionStart = 0 } = input;\n\t\tconst initText = input.value.slice(0, selectionStart);\n\t\tconst selectedText = input.value.slice(selectionStart, selectionEnd);\n\t\tconst finalText = input.value.slice(selectionEnd, input.value.length);\n\n\t\tfocus();\n\n\t\tconst startPattern = pattern.slice(0, pattern.indexOf('{{text}}'));\n\t\tconst startPatternFound = [...startPattern].reverse().every((char, index) => input.value.slice(selectionStart - index - 1, 1) === char);\n\n\t\tif (startPatternFound) {\n\t\t\tconst endPattern = pattern.slice(pattern.indexOf('{{text}}') + '{{text}}'.length);\n\t\t\tconst endPatternFound = [...endPattern].every((char, index) => input.value.slice(selectionEnd + index, 1) === char);\n\n\t\t\tif (endPatternFound) {\n\t\t\t\tinsertText(selectedText);\n\t\t\t\tinput.selectionStart = selectionStart - startPattern.length;\n\t\t\t\tinput.selectionEnd = selectionEnd + endPattern.length;\n\n\t\t\t\tif (!document.execCommand?.('insertText', false, selectedText)) {\n\t\t\t\t\tinput.value = initText.slice(0, initText.length - startPattern.length) + selectedText + finalText.slice(endPattern.length);\n\t\t\t\t}\n\n\t\t\t\tinput.selectionStart = selectionStart - startPattern.length;\n\t\t\t\tinput.selectionEnd = input.selectionStart + selectedText.length;\n\t\t\t\ttriggerEvent(input, 'input');\n\t\t\t\ttriggerEvent(input, 'change');\n\n\t\t\t\tfocus();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (!document.execCommand?.('insertText', false, pattern.replace('{{text}}', selectedText))) {\n\t\t\tinput.value = initText + pattern.replace('{{text}}', selectedText) + finalText;\n\t\t}\n\n\t\tinput.selectionStart = selectionStart + pattern.indexOf('{{text}}');\n\t\tinput.selectionEnd = input.selectionStart + selectedText.length;\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\tfocus();\n\t};\n\n\tconst insertNewLine = (): void => insertText('\\n');\n\n\tsetText(Accounts.storageLocation.getItem(storageID) ?? '', {\n\t\tskipFocus: true,\n\t});\n\n\t// Gets the text that is connected to the cursor and replaces it with the given text\n\tconst replaceText = (text: string, selection: { readonly start: number; readonly end: number }): void => {\n\t\tconst { selectionStart, selectionEnd } = input;\n\n\t\t// Selects the text that is connected to the cursor\n\t\tinput.setSelectionRange(selection.start ?? 0, selection.end ?? text.length);\n\t\tconst textAreaTxt = input.value;\n\n\t\tif (!document.execCommand?.('insertText', false, text)) {\n\t\t\tinput.value = textAreaTxt.substring(0, selection.start) + text + textAreaTxt.substring(selection.end);\n\t\t}\n\n\t\tinput.selectionStart = selectionStart + text.length;\n\t\tinput.selectionEnd = selectionStart + text.length;\n\t\tif (selectionStart !== selectionEnd) {\n\t\t\tinput.selectionStart = selectionStart;\n\t\t}\n\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\tfocus();\n\t};\n\n\treturn {\n\t\treplaceText,\n\t\tinsertNewLine,\n\t\tblur: () => input.blur(),\n\n\t\tsubstring: (start: number, end?: number) => {\n\t\t\treturn input.value.substring(start, end);\n\t\t},\n\n\t\tgetCursorPosition: () => {\n\t\t\treturn input.selectionStart;\n\t\t},\n\t\tsetCursorToEnd: () => {\n\t\t\tinput.selectionEnd = input.value.length;\n\t\t\tinput.selectionStart = input.selectionEnd;\n\t\t\tfocus();\n\t\t},\n\t\tsetCursorToStart: () => {\n\t\t\tinput.selectionStart = 0;\n\t\t\tinput.selectionEnd = input.selectionStart;\n\t\t\tfocus();\n\t\t},\n\t\trelease,\n\t\twrapSelection,\n\t\tget text(): string {\n\t\t\treturn input.value;\n\t\t},\n\t\tget selection(): { start: number; end: number } {\n\t\t\treturn {\n\t\t\t\tstart: input.selectionStart,\n\t\t\t\tend: input.selectionEnd,\n\t\t\t};\n\t\t},\n\n\t\tediting,\n\t\tsetEditingMode,\n\t\trecording,\n\t\tsetRecordingMode,\n\t\trecordingVideo,\n\t\tsetRecordingVideo,\n\t\tinsertText,\n\t\tsetText,\n\t\tclear,\n\t\tfocus,\n\t\treplyWith,\n\t\tquoteMessage,\n\t\tdismissQuotedMessage,\n\t\tdismissAllQuotedMessages,\n\t\tquotedMessages,\n\t\tformatters,\n\t\tisMicrophoneDenied,\n\t\tsetIsMicrophoneDenied,\n\t};\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui-message/client/messageBox/createComposerAPI.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui-message/client/messageBox/createComposerAPI.ts","inputSourceMap":{"version":3,"file":"app/ui-message/client/messageBox/createComposerAPI.ts","sourceRoot":"","sources":["app/ui-message/client/messageBox/createComposerAPI.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport { Accounts } from 'meteor/accounts-base';\n\nimport type { ComposerAPI } from '../../../../client/lib/chats/ChatAPI';\nimport { withDebouncing } from '../../../../lib/utils/highOrderFunctions';\nimport type { FormattingButton } from './messageBoxFormatting';\nimport { formattingButtons } from './messageBoxFormatting';\n\nexport const createComposerAPI = (input: HTMLTextAreaElement, storageID: string): ComposerAPI => {\n\tconst triggerEvent = (input: HTMLTextAreaElement, evt: string): void => {\n\t\tconst event = new Event(evt, { bubbles: true });\n\t\t// TODO: Remove this hack for react to trigger onChange\n\t\tconst tracker = (input as any)._valueTracker;\n\t\tif (tracker) {\n\t\t\ttracker.setValue(new Date().toString());\n\t\t}\n\t\tinput.dispatchEvent(event);\n\t};\n\n\tconst emitter = new Emitter<{\n\t\tquotedMessagesUpdate: void;\n\t\tediting: void;\n\t\trecording: void;\n\t\trecordingVideo: void;\n\t\tformatting: void;\n\t\tmircophoneDenied: void;\n\t}>();\n\n\tlet _quotedMessages: IMessage[] = [];\n\n\tconst persist = withDebouncing({ wait: 300 })(() => {\n\t\tif (input.value) {\n\t\t\tAccounts.storageLocation.setItem(storageID, input.value);\n\t\t\treturn;\n\t\t}\n\n\t\tAccounts.storageLocation.removeItem(storageID);\n\t});\n\n\tconst notifyQuotedMessagesUpdate = (): void => {\n\t\temitter.emit('quotedMessagesUpdate');\n\t};\n\n\tinput.addEventListener('input', persist);\n\n\tconst setText = (\n\t\ttext: string,\n\t\t{\n\t\t\tselection,\n\t\t\tskipFocus,\n\t\t}: {\n\t\t\tselection?:\n\t\t\t\t| { readonly start?: number; readonly end?: number }\n\t\t\t\t| ((previous: { readonly start: number; readonly end: number }) => { readonly start?: number; readonly end?: number });\n\t\t\tskipFocus?: boolean;\n\t\t} = {},\n\t): void => {\n\t\t!skipFocus && focus();\n\n\t\tconst { selectionStart, selectionEnd } = input;\n\t\tconst textAreaTxt = input.value;\n\n\t\tif (typeof selection === 'function') {\n\t\t\tselection = selection({ start: selectionStart, end: selectionEnd });\n\t\t}\n\n\t\tif (selection) {\n\t\t\tif (!document.execCommand?.('insertText', false, text)) {\n\t\t\t\tinput.value = textAreaTxt.substring(0, selectionStart) + text + textAreaTxt.substring(selectionStart);\n\t\t\t\t!skipFocus && focus();\n\t\t\t}\n\t\t\tinput.setSelectionRange(selection.start ?? 0, selection.end ?? text.length);\n\t\t}\n\n\t\tif (!selection) {\n\t\t\tinput.value = text;\n\t\t}\n\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\t!skipFocus && focus();\n\t};\n\n\tconst insertText = (text: string): void => {\n\t\tsetText(text, {\n\t\t\tselection: ({ start, end }) => ({\n\t\t\t\tstart: start + text.length,\n\t\t\t\tend: end + text.length,\n\t\t\t}),\n\t\t});\n\t};\n\n\tconst clear = (): void => {\n\t\tsetText('');\n\t};\n\n\tconst focus = (): void => {\n\t\tinput.focus();\n\t};\n\n\tconst replyWith = async (text: string): Promise<void> => {\n\t\tif (input) {\n\t\t\tinput.value = text;\n\t\t\tinput.focus();\n\t\t}\n\t};\n\n\tconst quoteMessage = async (message: IMessage): Promise<void> => {\n\t\t_quotedMessages = [..._quotedMessages.filter((_message) => _message._id !== message._id), message];\n\t\tnotifyQuotedMessagesUpdate();\n\t\tinput.focus();\n\t};\n\n\tconst dismissQuotedMessage = async (mid: IMessage['_id']): Promise<void> => {\n\t\t_quotedMessages = _quotedMessages.filter((message) => message._id !== mid);\n\t\tnotifyQuotedMessagesUpdate();\n\t};\n\n\tconst dismissAllQuotedMessages = async (): Promise<void> => {\n\t\t_quotedMessages = [];\n\t\tnotifyQuotedMessagesUpdate();\n\t};\n\n\tconst quotedMessages = {\n\t\tget: () => _quotedMessages,\n\t\tsubscribe: (callback: () => void) => emitter.on('quotedMessagesUpdate', callback),\n\t};\n\n\tconst [editing, setEditing] = (() => {\n\t\tlet editing = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => editing,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('editing', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\tediting = value;\n\t\t\t\temitter.emit('editing');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [recording, setRecordingMode] = (() => {\n\t\tlet recording = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => recording,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('recording', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\trecording = value;\n\t\t\t\temitter.emit('recording');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [recordingVideo, setRecordingVideo] = (() => {\n\t\tlet recordingVideo = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => recordingVideo,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('recordingVideo', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\trecordingVideo = value;\n\t\t\t\temitter.emit('recordingVideo');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [isMicrophoneDenied, setIsMicrophoneDenied] = (() => {\n\t\tlet isMicrophoneDenied = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => isMicrophoneDenied,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('mircophoneDenied', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\tisMicrophoneDenied = value;\n\t\t\t\temitter.emit('mircophoneDenied');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst setEditingMode = (editing: boolean): void => {\n\t\tsetEditing(editing);\n\t};\n\n\tconst [formatters, stopFormatterTracker] = (() => {\n\t\tlet actions: FormattingButton[] = [];\n\n\t\tconst c = Tracker.autorun(() => {\n\t\t\tactions = formattingButtons.filter(({ condition }) => !condition || condition());\n\t\t\temitter.emit('formatting');\n\t\t});\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => actions,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('formatting', callback),\n\t\t\t},\n\t\t\tc,\n\t\t];\n\t})();\n\n\tconst release = (): void => {\n\t\tinput.removeEventListener('input', persist);\n\t\tstopFormatterTracker.stop();\n\t};\n\n\tconst wrapSelection = (pattern: string): void => {\n\t\tconst { selectionEnd = input.value.length, selectionStart = 0 } = input;\n\t\tconst initText = input.value.slice(0, selectionStart);\n\t\tconst selectedText = input.value.slice(selectionStart, selectionEnd);\n\t\tconst finalText = input.value.slice(selectionEnd, input.value.length);\n\n\t\tfocus();\n\n\t\tconst startPattern = pattern.slice(0, pattern.indexOf('{{text}}'));\n\t\tconst startPatternFound = [...startPattern].reverse().every((char, index) => input.value.slice(selectionStart - index - 1, 1) === char);\n\n\t\tif (startPatternFound) {\n\t\t\tconst endPattern = pattern.slice(pattern.indexOf('{{text}}') + '{{text}}'.length);\n\t\t\tconst endPatternFound = [...endPattern].every((char, index) => input.value.slice(selectionEnd + index, 1) === char);\n\n\t\t\tif (endPatternFound) {\n\t\t\t\tinsertText(selectedText);\n\t\t\t\tinput.selectionStart = selectionStart - startPattern.length;\n\t\t\t\tinput.selectionEnd = selectionEnd + endPattern.length;\n\n\t\t\t\tif (!document.execCommand?.('insertText', false, selectedText)) {\n\t\t\t\t\tinput.value = initText.slice(0, initText.length - startPattern.length) + selectedText + finalText.slice(endPattern.length);\n\t\t\t\t}\n\n\t\t\t\tinput.selectionStart = selectionStart - startPattern.length;\n\t\t\t\tinput.selectionEnd = input.selectionStart + selectedText.length;\n\t\t\t\ttriggerEvent(input, 'input');\n\t\t\t\ttriggerEvent(input, 'change');\n\n\t\t\t\tfocus();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (!document.execCommand?.('insertText', false, pattern.replace('{{text}}', selectedText))) {\n\t\t\tinput.value = initText + pattern.replace('{{text}}', selectedText) + finalText;\n\t\t}\n\n\t\tinput.selectionStart = selectionStart + pattern.indexOf('{{text}}');\n\t\tinput.selectionEnd = input.selectionStart + selectedText.length;\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\tfocus();\n\t};\n\n\tconst insertNewLine = (): void => insertText('\\n');\n\n\tsetText(Accounts.storageLocation.getItem(storageID) ?? '', {\n\t\tskipFocus: true,\n\t});\n\n\t// Gets the text that is connected to the cursor and replaces it with the given text\n\tconst replaceText = (text: string, selection: { readonly start: number; readonly end: number }): void => {\n\t\tconst { selectionStart, selectionEnd } = input;\n\n\t\t// Selects the text that is connected to the cursor\n\t\tinput.setSelectionRange(selection.start ?? 0, selection.end ?? text.length);\n\t\tconst textAreaTxt = input.value;\n\n\t\tif (!document.execCommand?.('insertText', false, text)) {\n\t\t\tinput.value = textAreaTxt.substring(0, selection.start) + text + textAreaTxt.substring(selection.end);\n\t\t}\n\n\t\tinput.selectionStart = selectionStart + text.length;\n\t\tinput.selectionEnd = selectionStart + text.length;\n\t\tif (selectionStart !== selectionEnd) {\n\t\t\tinput.selectionStart = selectionStart;\n\t\t}\n\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\tfocus();\n\t};\n\n\treturn {\n\t\treplaceText,\n\t\tinsertNewLine,\n\t\tblur: () => input.blur(),\n\n\t\tsubstring: (start: number, end?: number) => {\n\t\t\treturn input.value.substring(start, end);\n\t\t},\n\n\t\tgetCursorPosition: () => {\n\t\t\treturn input.selectionStart;\n\t\t},\n\t\tsetCursorToEnd: () => {\n\t\t\tinput.selectionEnd = input.value.length;\n\t\t\tinput.selectionStart = input.selectionEnd;\n\t\t\tfocus();\n\t\t},\n\t\tsetCursorToStart: () => {\n\t\t\tinput.selectionStart = 0;\n\t\t\tinput.selectionEnd = input.selectionStart;\n\t\t\tfocus();\n\t\t},\n\t\trelease,\n\t\twrapSelection,\n\t\tget text(): string {\n\t\t\treturn input.value;\n\t\t},\n\t\tget selection(): { start: number; end: number } {\n\t\t\treturn {\n\t\t\t\tstart: input.selectionStart,\n\t\t\t\tend: input.selectionEnd,\n\t\t\t};\n\t\t},\n\n\t\tediting,\n\t\tsetEditingMode,\n\t\trecording,\n\t\tsetRecordingMode,\n\t\trecordingVideo,\n\t\tsetRecordingVideo,\n\t\tinsertText,\n\t\tsetText,\n\t\tclear,\n\t\tfocus,\n\t\treplyWith,\n\t\tquoteMessage,\n\t\tdismissQuotedMessage,\n\t\tdismissAllQuotedMessages,\n\t\tquotedMessages,\n\t\tformatters,\n\t\tisMicrophoneDenied,\n\t\tsetIsMicrophoneDenied,\n\t};\n};\n"]}}},"code":"var _slicedToArray;\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 0);\nvar _toConsumableArray;\nmodule.link(\"@babel/runtime/helpers/toConsumableArray\", {\n  default: function (v) {\n    _toConsumableArray = v;\n  }\n}, 1);\nvar _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 2);\nmodule.export({\n  createComposerAPI: function () {\n    return createComposerAPI;\n  }\n});\nvar Emitter;\nmodule.link(\"@rocket.chat/emitter\", {\n  Emitter: function (v) {\n    Emitter = v;\n  }\n}, 0);\nvar Accounts;\nmodule.link(\"meteor/accounts-base\", {\n  Accounts: function (v) {\n    Accounts = v;\n  }\n}, 1);\nvar withDebouncing;\nmodule.link(\"../../../../lib/utils/highOrderFunctions\", {\n  withDebouncing: function (v) {\n    withDebouncing = v;\n  }\n}, 2);\nvar formattingButtons;\nmodule.link(\"./messageBoxFormatting\", {\n  formattingButtons: function (v) {\n    formattingButtons = v;\n  }\n}, 3);\nvar createComposerAPI = function (input, storageID) {\n  var _Accounts$storageLoca;\n  var triggerEvent = function (input, evt) {\n    var event = new Event(evt, {\n      bubbles: true\n    });\n    // TODO: Remove this hack for react to trigger onChange\n    var tracker = input._valueTracker;\n    if (tracker) {\n      tracker.setValue(new Date().toString());\n    }\n    input.dispatchEvent(event);\n  };\n  var emitter = new Emitter();\n  var _quotedMessages = [];\n  var persist = withDebouncing({\n    wait: 300\n  })(function () {\n    if (input.value) {\n      Accounts.storageLocation.setItem(storageID, input.value);\n      return;\n    }\n    Accounts.storageLocation.removeItem(storageID);\n  });\n  var notifyQuotedMessagesUpdate = function () {\n    emitter.emit('quotedMessagesUpdate');\n  };\n  input.addEventListener('input', persist);\n  var setText = function (text) {\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      selection = _ref.selection,\n      skipFocus = _ref.skipFocus;\n    !skipFocus && focus();\n    var selectionStart = input.selectionStart,\n      selectionEnd = input.selectionEnd;\n    var textAreaTxt = input.value;\n    if (typeof selection === 'function') {\n      selection = selection({\n        start: selectionStart,\n        end: selectionEnd\n      });\n    }\n    if (selection) {\n      var _document$execCommand, _document, _selection$start, _selection$end;\n      if (!((_document$execCommand = (_document = document).execCommand) !== null && _document$execCommand !== void 0 && _document$execCommand.call(_document, 'insertText', false, text))) {\n        input.value = textAreaTxt.substring(0, selectionStart) + text + textAreaTxt.substring(selectionStart);\n        !skipFocus && focus();\n      }\n      input.setSelectionRange((_selection$start = selection.start) !== null && _selection$start !== void 0 ? _selection$start : 0, (_selection$end = selection.end) !== null && _selection$end !== void 0 ? _selection$end : text.length);\n    }\n    if (!selection) {\n      input.value = text;\n    }\n    triggerEvent(input, 'input');\n    triggerEvent(input, 'change');\n    !skipFocus && focus();\n  };\n  var insertText = function (text) {\n    setText(text, {\n      selection: function (_ref2) {\n        var start = _ref2.start,\n          end = _ref2.end;\n        return {\n          start: start + text.length,\n          end: end + text.length\n        };\n      }\n    });\n  };\n  var clear = function () {\n    setText('');\n  };\n  var focus = function () {\n    input.focus();\n  };\n  var replyWith = function () {\n    function _callee(text) {\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (input) {\n                input.value = text;\n                input.focus();\n              }\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n        return _callee$;\n      }(), null, null, null, Promise);\n    }\n    return _callee;\n  }();\n  var quoteMessage = function () {\n    function _callee2(message) {\n      return _regeneratorRuntime.async(function () {\n        function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _quotedMessages = [].concat(_toConsumableArray(_quotedMessages.filter(function (_message) {\n                return _message._id !== message._id;\n              })), [message]);\n              notifyQuotedMessagesUpdate();\n              input.focus();\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n        return _callee2$;\n      }(), null, null, null, Promise);\n    }\n    return _callee2;\n  }();\n  var dismissQuotedMessage = function () {\n    function _callee3(mid) {\n      return _regeneratorRuntime.async(function () {\n        function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _quotedMessages = _quotedMessages.filter(function (message) {\n                return message._id !== mid;\n              });\n              notifyQuotedMessagesUpdate();\n            case 2:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n        return _callee3$;\n      }(), null, null, null, Promise);\n    }\n    return _callee3;\n  }();\n  var dismissAllQuotedMessages = function () {\n    function _callee4() {\n      return _regeneratorRuntime.async(function () {\n        function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _quotedMessages = [];\n              notifyQuotedMessagesUpdate();\n            case 2:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n        return _callee4$;\n      }(), null, null, null, Promise);\n    }\n    return _callee4;\n  }();\n  var quotedMessages = {\n    get: function () {\n      return _quotedMessages;\n    },\n    subscribe: function (callback) {\n      return emitter.on('quotedMessagesUpdate', callback);\n    }\n  };\n  var _ref3 = function () {\n      var editing = false;\n      return [{\n        get: function () {\n          return editing;\n        },\n        subscribe: function (callback) {\n          return emitter.on('editing', callback);\n        }\n      }, function (value) {\n        editing = value;\n        emitter.emit('editing');\n      }];\n    }(),\n    _ref4 = _slicedToArray(_ref3, 2),\n    editing = _ref4[0],\n    setEditing = _ref4[1];\n  var _ref5 = function () {\n      var recording = false;\n      return [{\n        get: function () {\n          return recording;\n        },\n        subscribe: function (callback) {\n          return emitter.on('recording', callback);\n        }\n      }, function (value) {\n        recording = value;\n        emitter.emit('recording');\n      }];\n    }(),\n    _ref6 = _slicedToArray(_ref5, 2),\n    recording = _ref6[0],\n    setRecordingMode = _ref6[1];\n  var _ref7 = function () {\n      var recordingVideo = false;\n      return [{\n        get: function () {\n          return recordingVideo;\n        },\n        subscribe: function (callback) {\n          return emitter.on('recordingVideo', callback);\n        }\n      }, function (value) {\n        recordingVideo = value;\n        emitter.emit('recordingVideo');\n      }];\n    }(),\n    _ref8 = _slicedToArray(_ref7, 2),\n    recordingVideo = _ref8[0],\n    setRecordingVideo = _ref8[1];\n  var _ref9 = function () {\n      var isMicrophoneDenied = false;\n      return [{\n        get: function () {\n          return isMicrophoneDenied;\n        },\n        subscribe: function (callback) {\n          return emitter.on('mircophoneDenied', callback);\n        }\n      }, function (value) {\n        isMicrophoneDenied = value;\n        emitter.emit('mircophoneDenied');\n      }];\n    }(),\n    _ref10 = _slicedToArray(_ref9, 2),\n    isMicrophoneDenied = _ref10[0],\n    setIsMicrophoneDenied = _ref10[1];\n  var setEditingMode = function (editing) {\n    setEditing(editing);\n  };\n  var _ref11 = function () {\n      var actions = [];\n      var c = Tracker.autorun(function () {\n        actions = formattingButtons.filter(function (_ref13) {\n          var condition = _ref13.condition;\n          return !condition || condition();\n        });\n        emitter.emit('formatting');\n      });\n      return [{\n        get: function () {\n          return actions;\n        },\n        subscribe: function (callback) {\n          return emitter.on('formatting', callback);\n        }\n      }, c];\n    }(),\n    _ref12 = _slicedToArray(_ref11, 2),\n    formatters = _ref12[0],\n    stopFormatterTracker = _ref12[1];\n  var release = function () {\n    input.removeEventListener('input', persist);\n    stopFormatterTracker.stop();\n  };\n  var wrapSelection = function (pattern) {\n    var _document$execCommand3, _document3;\n    var _input$selectionEnd = input.selectionEnd,\n      selectionEnd = _input$selectionEnd === void 0 ? input.value.length : _input$selectionEnd,\n      _input$selectionStart = input.selectionStart,\n      selectionStart = _input$selectionStart === void 0 ? 0 : _input$selectionStart;\n    var initText = input.value.slice(0, selectionStart);\n    var selectedText = input.value.slice(selectionStart, selectionEnd);\n    var finalText = input.value.slice(selectionEnd, input.value.length);\n    focus();\n    var startPattern = pattern.slice(0, pattern.indexOf('{{text}}'));\n    var startPatternFound = _toConsumableArray(startPattern).reverse().every(function (char, index) {\n      return input.value.slice(selectionStart - index - 1, 1) === char;\n    });\n    if (startPatternFound) {\n      var endPattern = pattern.slice(pattern.indexOf('{{text}}') + '{{text}}'.length);\n      var endPatternFound = _toConsumableArray(endPattern).every(function (char, index) {\n        return input.value.slice(selectionEnd + index, 1) === char;\n      });\n      if (endPatternFound) {\n        var _document$execCommand2, _document2;\n        insertText(selectedText);\n        input.selectionStart = selectionStart - startPattern.length;\n        input.selectionEnd = selectionEnd + endPattern.length;\n        if (!((_document$execCommand2 = (_document2 = document).execCommand) !== null && _document$execCommand2 !== void 0 && _document$execCommand2.call(_document2, 'insertText', false, selectedText))) {\n          input.value = initText.slice(0, initText.length - startPattern.length) + selectedText + finalText.slice(endPattern.length);\n        }\n        input.selectionStart = selectionStart - startPattern.length;\n        input.selectionEnd = input.selectionStart + selectedText.length;\n        triggerEvent(input, 'input');\n        triggerEvent(input, 'change');\n        focus();\n        return;\n      }\n    }\n    if (!((_document$execCommand3 = (_document3 = document).execCommand) !== null && _document$execCommand3 !== void 0 && _document$execCommand3.call(_document3, 'insertText', false, pattern.replace('{{text}}', selectedText)))) {\n      input.value = initText + pattern.replace('{{text}}', selectedText) + finalText;\n    }\n    input.selectionStart = selectionStart + pattern.indexOf('{{text}}');\n    input.selectionEnd = input.selectionStart + selectedText.length;\n    triggerEvent(input, 'input');\n    triggerEvent(input, 'change');\n    focus();\n  };\n  var insertNewLine = function () {\n    return insertText('\\n');\n  };\n  setText((_Accounts$storageLoca = Accounts.storageLocation.getItem(storageID)) !== null && _Accounts$storageLoca !== void 0 ? _Accounts$storageLoca : '', {\n    skipFocus: true\n  });\n  // Gets the text that is connected to the cursor and replaces it with the given text\n  var replaceText = function (text, selection) {\n    var _selection$start2, _selection$end2, _document$execCommand4, _document4;\n    var selectionStart = input.selectionStart,\n      selectionEnd = input.selectionEnd;\n    // Selects the text that is connected to the cursor\n    input.setSelectionRange((_selection$start2 = selection.start) !== null && _selection$start2 !== void 0 ? _selection$start2 : 0, (_selection$end2 = selection.end) !== null && _selection$end2 !== void 0 ? _selection$end2 : text.length);\n    var textAreaTxt = input.value;\n    if (!((_document$execCommand4 = (_document4 = document).execCommand) !== null && _document$execCommand4 !== void 0 && _document$execCommand4.call(_document4, 'insertText', false, text))) {\n      input.value = textAreaTxt.substring(0, selection.start) + text + textAreaTxt.substring(selection.end);\n    }\n    input.selectionStart = selectionStart + text.length;\n    input.selectionEnd = selectionStart + text.length;\n    if (selectionStart !== selectionEnd) {\n      input.selectionStart = selectionStart;\n    }\n    triggerEvent(input, 'input');\n    triggerEvent(input, 'change');\n    focus();\n  };\n  return {\n    replaceText: replaceText,\n    insertNewLine: insertNewLine,\n    blur: function () {\n      return input.blur();\n    },\n    substring: function (start, end) {\n      return input.value.substring(start, end);\n    },\n    getCursorPosition: function () {\n      return input.selectionStart;\n    },\n    setCursorToEnd: function () {\n      input.selectionEnd = input.value.length;\n      input.selectionStart = input.selectionEnd;\n      focus();\n    },\n    setCursorToStart: function () {\n      input.selectionStart = 0;\n      input.selectionEnd = input.selectionStart;\n      focus();\n    },\n    release: release,\n    wrapSelection: wrapSelection,\n    get text() {\n      return input.value;\n    },\n    get selection() {\n      return {\n        start: input.selectionStart,\n        end: input.selectionEnd\n      };\n    },\n    editing: editing,\n    setEditingMode: setEditingMode,\n    recording: recording,\n    setRecordingMode: setRecordingMode,\n    recordingVideo: recordingVideo,\n    setRecordingVideo: setRecordingVideo,\n    insertText: insertText,\n    setText: setText,\n    clear: clear,\n    focus: focus,\n    replyWith: replyWith,\n    quoteMessage: quoteMessage,\n    dismissQuotedMessage: dismissQuotedMessage,\n    dismissAllQuotedMessages: dismissAllQuotedMessages,\n    quotedMessages: quotedMessages,\n    formatters: formatters,\n    isMicrophoneDenied: isMicrophoneDenied,\n    setIsMicrophoneDenied: setIsMicrophoneDenied\n  };\n};","map":{"version":3,"names":["_slicedToArray","module","link","default","v","_toConsumableArray","_regeneratorRuntime","export","createComposerAPI","Emitter","Accounts","withDebouncing","formattingButtons","input","storageID","_Accounts$storageLoca","triggerEvent","evt","event","Event","bubbles","tracker","_valueTracker","setValue","Date","toString","dispatchEvent","emitter","_quotedMessages","persist","wait","value","storageLocation","setItem","removeItem","notifyQuotedMessagesUpdate","emit","addEventListener","setText","text","_ref","arguments","length","undefined","selection","skipFocus","focus","selectionStart","selectionEnd","textAreaTxt","start","end","_document$execCommand","_document","_selection$start","_selection$end","document","execCommand","call","substring","setSelectionRange","insertText","_ref2","clear","replyWith","_callee","async","_callee$","_context","prev","next","stop","Promise","quoteMessage","_callee2","message","_callee2$","_context2","concat","filter","_message","_id","dismissQuotedMessage","_callee3","mid","_callee3$","_context3","dismissAllQuotedMessages","_callee4","_callee4$","_context4","quotedMessages","get","subscribe","callback","on","_ref3","editing","_ref4","setEditing","_ref5","recording","_ref6","setRecordingMode","_ref7","recordingVideo","_ref8","setRecordingVideo","_ref9","isMicrophoneDenied","_ref10","setIsMicrophoneDenied","setEditingMode","_ref11","actions","c","Tracker","autorun","_ref13","condition","_ref12","formatters","stopFormatterTracker","release","removeEventListener","wrapSelection","pattern","_document$execCommand3","_document3","_input$selectionEnd","_input$selectionStart","initText","slice","selectedText","finalText","startPattern","indexOf","startPatternFound","reverse","every","char","index","endPattern","endPatternFound","_document$execCommand2","_document2","replace","insertNewLine","getItem","replaceText","_selection$start2","_selection$end2","_document$execCommand4","_document4","blur","getCursorPosition","setCursorToEnd","setCursorToStart"],"sources":["app/ui-message/client/messageBox/createComposerAPI.ts"],"sourcesContent":["import type { IMessage } from '@rocket.chat/core-typings';\nimport { Emitter } from '@rocket.chat/emitter';\nimport { Accounts } from 'meteor/accounts-base';\n\nimport type { ComposerAPI } from '../../../../client/lib/chats/ChatAPI';\nimport { withDebouncing } from '../../../../lib/utils/highOrderFunctions';\nimport type { FormattingButton } from './messageBoxFormatting';\nimport { formattingButtons } from './messageBoxFormatting';\n\nexport const createComposerAPI = (input: HTMLTextAreaElement, storageID: string): ComposerAPI => {\n\tconst triggerEvent = (input: HTMLTextAreaElement, evt: string): void => {\n\t\tconst event = new Event(evt, { bubbles: true });\n\t\t// TODO: Remove this hack for react to trigger onChange\n\t\tconst tracker = (input as any)._valueTracker;\n\t\tif (tracker) {\n\t\t\ttracker.setValue(new Date().toString());\n\t\t}\n\t\tinput.dispatchEvent(event);\n\t};\n\n\tconst emitter = new Emitter<{\n\t\tquotedMessagesUpdate: void;\n\t\tediting: void;\n\t\trecording: void;\n\t\trecordingVideo: void;\n\t\tformatting: void;\n\t\tmircophoneDenied: void;\n\t}>();\n\n\tlet _quotedMessages: IMessage[] = [];\n\n\tconst persist = withDebouncing({ wait: 300 })(() => {\n\t\tif (input.value) {\n\t\t\tAccounts.storageLocation.setItem(storageID, input.value);\n\t\t\treturn;\n\t\t}\n\n\t\tAccounts.storageLocation.removeItem(storageID);\n\t});\n\n\tconst notifyQuotedMessagesUpdate = (): void => {\n\t\temitter.emit('quotedMessagesUpdate');\n\t};\n\n\tinput.addEventListener('input', persist);\n\n\tconst setText = (\n\t\ttext: string,\n\t\t{\n\t\t\tselection,\n\t\t\tskipFocus,\n\t\t}: {\n\t\t\tselection?:\n\t\t\t\t| { readonly start?: number; readonly end?: number }\n\t\t\t\t| ((previous: { readonly start: number; readonly end: number }) => { readonly start?: number; readonly end?: number });\n\t\t\tskipFocus?: boolean;\n\t\t} = {},\n\t): void => {\n\t\t!skipFocus && focus();\n\n\t\tconst { selectionStart, selectionEnd } = input;\n\t\tconst textAreaTxt = input.value;\n\n\t\tif (typeof selection === 'function') {\n\t\t\tselection = selection({ start: selectionStart, end: selectionEnd });\n\t\t}\n\n\t\tif (selection) {\n\t\t\tif (!document.execCommand?.('insertText', false, text)) {\n\t\t\t\tinput.value = textAreaTxt.substring(0, selectionStart) + text + textAreaTxt.substring(selectionStart);\n\t\t\t\t!skipFocus && focus();\n\t\t\t}\n\t\t\tinput.setSelectionRange(selection.start ?? 0, selection.end ?? text.length);\n\t\t}\n\n\t\tif (!selection) {\n\t\t\tinput.value = text;\n\t\t}\n\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\t!skipFocus && focus();\n\t};\n\n\tconst insertText = (text: string): void => {\n\t\tsetText(text, {\n\t\t\tselection: ({ start, end }) => ({\n\t\t\t\tstart: start + text.length,\n\t\t\t\tend: end + text.length,\n\t\t\t}),\n\t\t});\n\t};\n\n\tconst clear = (): void => {\n\t\tsetText('');\n\t};\n\n\tconst focus = (): void => {\n\t\tinput.focus();\n\t};\n\n\tconst replyWith = async (text: string): Promise<void> => {\n\t\tif (input) {\n\t\t\tinput.value = text;\n\t\t\tinput.focus();\n\t\t}\n\t};\n\n\tconst quoteMessage = async (message: IMessage): Promise<void> => {\n\t\t_quotedMessages = [..._quotedMessages.filter((_message) => _message._id !== message._id), message];\n\t\tnotifyQuotedMessagesUpdate();\n\t\tinput.focus();\n\t};\n\n\tconst dismissQuotedMessage = async (mid: IMessage['_id']): Promise<void> => {\n\t\t_quotedMessages = _quotedMessages.filter((message) => message._id !== mid);\n\t\tnotifyQuotedMessagesUpdate();\n\t};\n\n\tconst dismissAllQuotedMessages = async (): Promise<void> => {\n\t\t_quotedMessages = [];\n\t\tnotifyQuotedMessagesUpdate();\n\t};\n\n\tconst quotedMessages = {\n\t\tget: () => _quotedMessages,\n\t\tsubscribe: (callback: () => void) => emitter.on('quotedMessagesUpdate', callback),\n\t};\n\n\tconst [editing, setEditing] = (() => {\n\t\tlet editing = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => editing,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('editing', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\tediting = value;\n\t\t\t\temitter.emit('editing');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [recording, setRecordingMode] = (() => {\n\t\tlet recording = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => recording,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('recording', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\trecording = value;\n\t\t\t\temitter.emit('recording');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [recordingVideo, setRecordingVideo] = (() => {\n\t\tlet recordingVideo = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => recordingVideo,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('recordingVideo', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\trecordingVideo = value;\n\t\t\t\temitter.emit('recordingVideo');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst [isMicrophoneDenied, setIsMicrophoneDenied] = (() => {\n\t\tlet isMicrophoneDenied = false;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => isMicrophoneDenied,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('mircophoneDenied', callback),\n\t\t\t},\n\t\t\t(value: boolean) => {\n\t\t\t\tisMicrophoneDenied = value;\n\t\t\t\temitter.emit('mircophoneDenied');\n\t\t\t},\n\t\t];\n\t})();\n\n\tconst setEditingMode = (editing: boolean): void => {\n\t\tsetEditing(editing);\n\t};\n\n\tconst [formatters, stopFormatterTracker] = (() => {\n\t\tlet actions: FormattingButton[] = [];\n\n\t\tconst c = Tracker.autorun(() => {\n\t\t\tactions = formattingButtons.filter(({ condition }) => !condition || condition());\n\t\t\temitter.emit('formatting');\n\t\t});\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tget: () => actions,\n\t\t\t\tsubscribe: (callback: () => void) => emitter.on('formatting', callback),\n\t\t\t},\n\t\t\tc,\n\t\t];\n\t})();\n\n\tconst release = (): void => {\n\t\tinput.removeEventListener('input', persist);\n\t\tstopFormatterTracker.stop();\n\t};\n\n\tconst wrapSelection = (pattern: string): void => {\n\t\tconst { selectionEnd = input.value.length, selectionStart = 0 } = input;\n\t\tconst initText = input.value.slice(0, selectionStart);\n\t\tconst selectedText = input.value.slice(selectionStart, selectionEnd);\n\t\tconst finalText = input.value.slice(selectionEnd, input.value.length);\n\n\t\tfocus();\n\n\t\tconst startPattern = pattern.slice(0, pattern.indexOf('{{text}}'));\n\t\tconst startPatternFound = [...startPattern].reverse().every((char, index) => input.value.slice(selectionStart - index - 1, 1) === char);\n\n\t\tif (startPatternFound) {\n\t\t\tconst endPattern = pattern.slice(pattern.indexOf('{{text}}') + '{{text}}'.length);\n\t\t\tconst endPatternFound = [...endPattern].every((char, index) => input.value.slice(selectionEnd + index, 1) === char);\n\n\t\t\tif (endPatternFound) {\n\t\t\t\tinsertText(selectedText);\n\t\t\t\tinput.selectionStart = selectionStart - startPattern.length;\n\t\t\t\tinput.selectionEnd = selectionEnd + endPattern.length;\n\n\t\t\t\tif (!document.execCommand?.('insertText', false, selectedText)) {\n\t\t\t\t\tinput.value = initText.slice(0, initText.length - startPattern.length) + selectedText + finalText.slice(endPattern.length);\n\t\t\t\t}\n\n\t\t\t\tinput.selectionStart = selectionStart - startPattern.length;\n\t\t\t\tinput.selectionEnd = input.selectionStart + selectedText.length;\n\t\t\t\ttriggerEvent(input, 'input');\n\t\t\t\ttriggerEvent(input, 'change');\n\n\t\t\t\tfocus();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (!document.execCommand?.('insertText', false, pattern.replace('{{text}}', selectedText))) {\n\t\t\tinput.value = initText + pattern.replace('{{text}}', selectedText) + finalText;\n\t\t}\n\n\t\tinput.selectionStart = selectionStart + pattern.indexOf('{{text}}');\n\t\tinput.selectionEnd = input.selectionStart + selectedText.length;\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\tfocus();\n\t};\n\n\tconst insertNewLine = (): void => insertText('\\n');\n\n\tsetText(Accounts.storageLocation.getItem(storageID) ?? '', {\n\t\tskipFocus: true,\n\t});\n\n\t// Gets the text that is connected to the cursor and replaces it with the given text\n\tconst replaceText = (text: string, selection: { readonly start: number; readonly end: number }): void => {\n\t\tconst { selectionStart, selectionEnd } = input;\n\n\t\t// Selects the text that is connected to the cursor\n\t\tinput.setSelectionRange(selection.start ?? 0, selection.end ?? text.length);\n\t\tconst textAreaTxt = input.value;\n\n\t\tif (!document.execCommand?.('insertText', false, text)) {\n\t\t\tinput.value = textAreaTxt.substring(0, selection.start) + text + textAreaTxt.substring(selection.end);\n\t\t}\n\n\t\tinput.selectionStart = selectionStart + text.length;\n\t\tinput.selectionEnd = selectionStart + text.length;\n\t\tif (selectionStart !== selectionEnd) {\n\t\t\tinput.selectionStart = selectionStart;\n\t\t}\n\n\t\ttriggerEvent(input, 'input');\n\t\ttriggerEvent(input, 'change');\n\n\t\tfocus();\n\t};\n\n\treturn {\n\t\treplaceText,\n\t\tinsertNewLine,\n\t\tblur: () => input.blur(),\n\n\t\tsubstring: (start: number, end?: number) => {\n\t\t\treturn input.value.substring(start, end);\n\t\t},\n\n\t\tgetCursorPosition: () => {\n\t\t\treturn input.selectionStart;\n\t\t},\n\t\tsetCursorToEnd: () => {\n\t\t\tinput.selectionEnd = input.value.length;\n\t\t\tinput.selectionStart = input.selectionEnd;\n\t\t\tfocus();\n\t\t},\n\t\tsetCursorToStart: () => {\n\t\t\tinput.selectionStart = 0;\n\t\t\tinput.selectionEnd = input.selectionStart;\n\t\t\tfocus();\n\t\t},\n\t\trelease,\n\t\twrapSelection,\n\t\tget text(): string {\n\t\t\treturn input.value;\n\t\t},\n\t\tget selection(): { start: number; end: number } {\n\t\t\treturn {\n\t\t\t\tstart: input.selectionStart,\n\t\t\t\tend: input.selectionEnd,\n\t\t\t};\n\t\t},\n\n\t\tediting,\n\t\tsetEditingMode,\n\t\trecording,\n\t\tsetRecordingMode,\n\t\trecordingVideo,\n\t\tsetRecordingVideo,\n\t\tinsertText,\n\t\tsetText,\n\t\tclear,\n\t\tfocus,\n\t\treplyWith,\n\t\tquoteMessage,\n\t\tdismissQuotedMessage,\n\t\tdismissAllQuotedMessages,\n\t\tquotedMessages,\n\t\tformatters,\n\t\tisMicrophoneDenied,\n\t\tsetIsMicrophoneDenied,\n\t};\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"a852d96c2af7a3ee2d3a6cf6c55ad3a73d0b648e"}
