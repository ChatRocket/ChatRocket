{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/body/hooks/useListIsAtBottom.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/room/body/hooks/useListIsAtBottom.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/body/hooks/useListIsAtBottom.ts","inputSourceMap":{"version":3,"file":"client/views/room/body/hooks/useListIsAtBottom.ts","sourceRoot":"","sources":["client/views/room/body/hooks/useListIsAtBottom.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,aAAa,EAAE,MAAM,6BAA6B,CAAC;AAC5D,OAAO,EAAE,WAAW,EAAE,MAAM,EAAE,MAAM,OAAO,CAAC;AAE5C,OAAO,EAAE,UAAU,IAAI,aAAa,EAAE,MAAM,sDAAsD,CAAC;AACnG,OAAO,EAAE,cAAc,EAAE,MAAM,6CAA6C,CAAC;AAE7E,MAAM,CAAC,MAAM,iBAAiB,GAAG,GAAG,EAAE;IACrC,MAAM,WAAW,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IAEjC,MAAM,WAAW,GAAG,MAAM,CAAwB,IAAI,CAAC,CAAC;IAExD,MAAM,YAAY,GAAG,WAAW,CAAC,GAAG,EAAE;QACrC,WAAW,CAAC,OAAO,EAAE,QAAQ,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,GAAG,EAAE,WAAW,CAAC,OAAO,EAAE,YAAY,EAAE,CAAC,CAAC;IACrF,CAAC,EAAE,EAAE,CAAC,CAAC;IAEP,MAAM,uBAAuB,GAAG,WAAW,CAAC,GAAG,EAAE;QAChD,IAAI,WAAW,CAAC,OAAO,KAAK,IAAI,EAAE,CAAC;YAClC,YAAY,EAAE,CAAC;QAChB,CAAC;IACF,CAAC,EAAE,CAAC,WAAW,EAAE,YAAY,CAAC,CAAC,CAAC;IAEhC,MAAM,UAAU,GAAG,WAAW,CAAC,CAAC,SAAS,GAAG,CAAC,EAAE,EAAE;QAChD,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE,CAAC;YAC1B,OAAO,IAAI,CAAC;QACb,CAAC;QACD,OAAO,aAAa,CAAC,WAAW,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;IACtD,CAAC,EAAE,EAAE,CAAC,CAAC;IAEP,MAAM,GAAG,GAAG,WAAW,CACtB,CAAC,IAAwB,EAAE,EAAE;QAC5B,IAAI,CAAC,IAAI,EAAE,CAAC;YACX,OAAO;QACR,CAAC;QAED,MAAM,WAAW,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QAE7C,IAAI,CAAC,WAAW,EAAE,CAAC;YAClB,OAAO;QACR,CAAC;QAED,MAAM,QAAQ,GAAG,IAAI,cAAc,CAAC,GAAG,EAAE;YACxC,IAAI,WAAW,CAAC,OAAO,KAAK,IAAI,EAAE,CAAC;gBAClC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,YAAY,EAAE,CAAC,CAAC;YACrD,CAAC;QACF,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;QAE9B,IAAI,CAAC,gBAAgB,CACpB,QAAQ,EACR,cAAc,CAAC,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,EAAE;YAClC,WAAW,CAAC,OAAO,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC;QACvC,CAAC,CAAC,EACF;YACC,OAAO,EAAE,IAAI;SACb,CACD,CAAC;IACH,CAAC,EACD,CAAC,UAAU,CAAC,CACZ,CAAC;IAEF,OAAO;QACN,WAAW;QACX,QAAQ,EAAE,aAAa,CAAC,GAAG,EAAE,WAAW,CAA6D;QACrG,YAAY;QACZ,uBAAuB;QACvB,UAAU;KACV,CAAC;AACH,CAAC,CAAC","sourcesContent":["import { useMergedRefs } from '@rocket.chat/fuselage-hooks';\nimport { useCallback, useRef } from 'react';\n\nimport { isAtBottom as isAtBottomLib } from '../../../../../app/ui/client/views/app/lib/scrolling';\nimport { withThrottling } from '../../../../../lib/utils/highOrderFunctions';\n\nexport const useListIsAtBottom = () => {\n\tconst atBottomRef = useRef(true);\n\n\tconst innerBoxRef = useRef<HTMLDivElement | null>(null);\n\n\tconst sendToBottom = useCallback(() => {\n\t\tinnerBoxRef.current?.scrollTo({ left: 30, top: innerBoxRef.current?.scrollHeight });\n\t}, []);\n\n\tconst sendToBottomIfNecessary = useCallback(() => {\n\t\tif (atBottomRef.current === true) {\n\t\t\tsendToBottom();\n\t\t}\n\t}, [atBottomRef, sendToBottom]);\n\n\tconst isAtBottom = useCallback((threshold = 0) => {\n\t\tif (!innerBoxRef.current) {\n\t\t\treturn true;\n\t\t}\n\t\treturn isAtBottomLib(innerBoxRef.current, threshold);\n\t}, []);\n\n\tconst ref = useCallback(\n\t\t(node: HTMLElement | null) => {\n\t\t\tif (!node) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst messageList = node.querySelector('ul');\n\n\t\t\tif (!messageList) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst observer = new ResizeObserver(() => {\n\t\t\t\tif (atBottomRef.current === true) {\n\t\t\t\t\tnode.scrollTo({ left: 30, top: node.scrollHeight });\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tobserver.observe(messageList);\n\n\t\t\tnode.addEventListener(\n\t\t\t\t'scroll',\n\t\t\t\twithThrottling({ wait: 100 })(() => {\n\t\t\t\t\tatBottomRef.current = isAtBottom(100);\n\t\t\t\t}),\n\t\t\t\t{\n\t\t\t\t\tpassive: true,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\t[isAtBottom],\n\t);\n\n\treturn {\n\t\tatBottomRef,\n\t\tinnerRef: useMergedRefs(ref, innerBoxRef) as unknown as React.MutableRefObject<HTMLDivElement | null>,\n\t\tsendToBottom,\n\t\tsendToBottomIfNecessary,\n\t\tisAtBottom,\n\t};\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/room/body/hooks/useListIsAtBottom.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/room/body/hooks/useListIsAtBottom.ts","inputSourceMap":{"version":3,"file":"client/views/room/body/hooks/useListIsAtBottom.ts","sourceRoot":"","sources":["client/views/room/body/hooks/useListIsAtBottom.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,aAAa,EAAE,MAAM,6BAA6B,CAAC;AAC5D,OAAO,EAAE,WAAW,EAAE,MAAM,EAAE,MAAM,OAAO,CAAC;AAE5C,OAAO,EAAE,UAAU,IAAI,aAAa,EAAE,MAAM,sDAAsD,CAAC;AACnG,OAAO,EAAE,cAAc,EAAE,MAAM,6CAA6C,CAAC;AAE7E,MAAM,CAAC,MAAM,iBAAiB,GAAG,GAAG,EAAE;IACrC,MAAM,WAAW,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;IAEjC,MAAM,WAAW,GAAG,MAAM,CAAwB,IAAI,CAAC,CAAC;IAExD,MAAM,YAAY,GAAG,WAAW,CAAC,GAAG,EAAE;QACrC,WAAW,CAAC,OAAO,EAAE,QAAQ,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,GAAG,EAAE,WAAW,CAAC,OAAO,EAAE,YAAY,EAAE,CAAC,CAAC;IACrF,CAAC,EAAE,EAAE,CAAC,CAAC;IAEP,MAAM,uBAAuB,GAAG,WAAW,CAAC,GAAG,EAAE;QAChD,IAAI,WAAW,CAAC,OAAO,KAAK,IAAI,EAAE,CAAC;YAClC,YAAY,EAAE,CAAC;QAChB,CAAC;IACF,CAAC,EAAE,CAAC,WAAW,EAAE,YAAY,CAAC,CAAC,CAAC;IAEhC,MAAM,UAAU,GAAG,WAAW,CAAC,CAAC,SAAS,GAAG,CAAC,EAAE,EAAE;QAChD,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE,CAAC;YAC1B,OAAO,IAAI,CAAC;QACb,CAAC;QACD,OAAO,aAAa,CAAC,WAAW,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;IACtD,CAAC,EAAE,EAAE,CAAC,CAAC;IAEP,MAAM,GAAG,GAAG,WAAW,CACtB,CAAC,IAAwB,EAAE,EAAE;QAC5B,IAAI,CAAC,IAAI,EAAE,CAAC;YACX,OAAO;QACR,CAAC;QAED,MAAM,WAAW,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QAE7C,IAAI,CAAC,WAAW,EAAE,CAAC;YAClB,OAAO;QACR,CAAC;QAED,MAAM,QAAQ,GAAG,IAAI,cAAc,CAAC,GAAG,EAAE;YACxC,IAAI,WAAW,CAAC,OAAO,KAAK,IAAI,EAAE,CAAC;gBAClC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,YAAY,EAAE,CAAC,CAAC;YACrD,CAAC;QACF,CAAC,CAAC,CAAC;QAEH,QAAQ,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;QAE9B,IAAI,CAAC,gBAAgB,CACpB,QAAQ,EACR,cAAc,CAAC,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,EAAE;YAClC,WAAW,CAAC,OAAO,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC;QACvC,CAAC,CAAC,EACF;YACC,OAAO,EAAE,IAAI;SACb,CACD,CAAC;IACH,CAAC,EACD,CAAC,UAAU,CAAC,CACZ,CAAC;IAEF,OAAO;QACN,WAAW;QACX,QAAQ,EAAE,aAAa,CAAC,GAAG,EAAE,WAAW,CAA6D;QACrG,YAAY;QACZ,uBAAuB;QACvB,UAAU;KACV,CAAC;AACH,CAAC,CAAC","sourcesContent":["import { useMergedRefs } from '@rocket.chat/fuselage-hooks';\nimport { useCallback, useRef } from 'react';\n\nimport { isAtBottom as isAtBottomLib } from '../../../../../app/ui/client/views/app/lib/scrolling';\nimport { withThrottling } from '../../../../../lib/utils/highOrderFunctions';\n\nexport const useListIsAtBottom = () => {\n\tconst atBottomRef = useRef(true);\n\n\tconst innerBoxRef = useRef<HTMLDivElement | null>(null);\n\n\tconst sendToBottom = useCallback(() => {\n\t\tinnerBoxRef.current?.scrollTo({ left: 30, top: innerBoxRef.current?.scrollHeight });\n\t}, []);\n\n\tconst sendToBottomIfNecessary = useCallback(() => {\n\t\tif (atBottomRef.current === true) {\n\t\t\tsendToBottom();\n\t\t}\n\t}, [atBottomRef, sendToBottom]);\n\n\tconst isAtBottom = useCallback((threshold = 0) => {\n\t\tif (!innerBoxRef.current) {\n\t\t\treturn true;\n\t\t}\n\t\treturn isAtBottomLib(innerBoxRef.current, threshold);\n\t}, []);\n\n\tconst ref = useCallback(\n\t\t(node: HTMLElement | null) => {\n\t\t\tif (!node) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst messageList = node.querySelector('ul');\n\n\t\t\tif (!messageList) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst observer = new ResizeObserver(() => {\n\t\t\t\tif (atBottomRef.current === true) {\n\t\t\t\t\tnode.scrollTo({ left: 30, top: node.scrollHeight });\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tobserver.observe(messageList);\n\n\t\t\tnode.addEventListener(\n\t\t\t\t'scroll',\n\t\t\t\twithThrottling({ wait: 100 })(() => {\n\t\t\t\t\tatBottomRef.current = isAtBottom(100);\n\t\t\t\t}),\n\t\t\t\t{\n\t\t\t\t\tpassive: true,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\t[isAtBottom],\n\t);\n\n\treturn {\n\t\tatBottomRef,\n\t\tinnerRef: useMergedRefs(ref, innerBoxRef) as unknown as React.MutableRefObject<HTMLDivElement | null>,\n\t\tsendToBottom,\n\t\tsendToBottomIfNecessary,\n\t\tisAtBottom,\n\t};\n};\n"]}}},"code":"module.export({\n  useListIsAtBottom: function () {\n    return useListIsAtBottom;\n  }\n});\nvar useMergedRefs;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMergedRefs: function (v) {\n    useMergedRefs = v;\n  }\n}, 0);\nvar useCallback, useRef;\nmodule.link(\"react\", {\n  useCallback: function (v) {\n    useCallback = v;\n  },\n  useRef: function (v) {\n    useRef = v;\n  }\n}, 1);\nvar isAtBottomLib;\nmodule.link(\"../../../../../app/ui/client/views/app/lib/scrolling\", {\n  isAtBottom: function (v) {\n    isAtBottomLib = v;\n  }\n}, 2);\nvar withThrottling;\nmodule.link(\"../../../../../lib/utils/highOrderFunctions\", {\n  withThrottling: function (v) {\n    withThrottling = v;\n  }\n}, 3);\nvar useListIsAtBottom = function () {\n  var atBottomRef = useRef(true);\n  var innerBoxRef = useRef(null);\n  var sendToBottom = useCallback(function () {\n    var _innerBoxRef$current, _innerBoxRef$current2;\n    (_innerBoxRef$current = innerBoxRef.current) === null || _innerBoxRef$current === void 0 ? void 0 : _innerBoxRef$current.scrollTo({\n      left: 30,\n      top: (_innerBoxRef$current2 = innerBoxRef.current) === null || _innerBoxRef$current2 === void 0 ? void 0 : _innerBoxRef$current2.scrollHeight\n    });\n  }, []);\n  var sendToBottomIfNecessary = useCallback(function () {\n    if (atBottomRef.current === true) {\n      sendToBottom();\n    }\n  }, [atBottomRef, sendToBottom]);\n  var isAtBottom = useCallback(function () {\n    var threshold = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    if (!innerBoxRef.current) {\n      return true;\n    }\n    return isAtBottomLib(innerBoxRef.current, threshold);\n  }, []);\n  var ref = useCallback(function (node) {\n    if (!node) {\n      return;\n    }\n    var messageList = node.querySelector('ul');\n    if (!messageList) {\n      return;\n    }\n    var observer = new ResizeObserver(function () {\n      if (atBottomRef.current === true) {\n        node.scrollTo({\n          left: 30,\n          top: node.scrollHeight\n        });\n      }\n    });\n    observer.observe(messageList);\n    node.addEventListener('scroll', withThrottling({\n      wait: 100\n    })(function () {\n      atBottomRef.current = isAtBottom(100);\n    }), {\n      passive: true\n    });\n  }, [isAtBottom]);\n  return {\n    atBottomRef: atBottomRef,\n    innerRef: useMergedRefs(ref, innerBoxRef),\n    sendToBottom: sendToBottom,\n    sendToBottomIfNecessary: sendToBottomIfNecessary,\n    isAtBottom: isAtBottom\n  };\n};","map":{"version":3,"names":["module","export","useListIsAtBottom","useMergedRefs","link","v","useCallback","useRef","isAtBottomLib","isAtBottom","withThrottling","atBottomRef","innerBoxRef","sendToBottom","_innerBoxRef$current","_innerBoxRef$current2","current","scrollTo","left","top","scrollHeight","sendToBottomIfNecessary","threshold","arguments","length","undefined","ref","node","messageList","querySelector","observer","ResizeObserver","observe","addEventListener","wait","passive","innerRef"],"sources":["client/views/room/body/hooks/useListIsAtBottom.ts"],"sourcesContent":["import { useMergedRefs } from '@rocket.chat/fuselage-hooks';\nimport { useCallback, useRef } from 'react';\n\nimport { isAtBottom as isAtBottomLib } from '../../../../../app/ui/client/views/app/lib/scrolling';\nimport { withThrottling } from '../../../../../lib/utils/highOrderFunctions';\n\nexport const useListIsAtBottom = () => {\n\tconst atBottomRef = useRef(true);\n\n\tconst innerBoxRef = useRef<HTMLDivElement | null>(null);\n\n\tconst sendToBottom = useCallback(() => {\n\t\tinnerBoxRef.current?.scrollTo({ left: 30, top: innerBoxRef.current?.scrollHeight });\n\t}, []);\n\n\tconst sendToBottomIfNecessary = useCallback(() => {\n\t\tif (atBottomRef.current === true) {\n\t\t\tsendToBottom();\n\t\t}\n\t}, [atBottomRef, sendToBottom]);\n\n\tconst isAtBottom = useCallback((threshold = 0) => {\n\t\tif (!innerBoxRef.current) {\n\t\t\treturn true;\n\t\t}\n\t\treturn isAtBottomLib(innerBoxRef.current, threshold);\n\t}, []);\n\n\tconst ref = useCallback(\n\t\t(node: HTMLElement | null) => {\n\t\t\tif (!node) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst messageList = node.querySelector('ul');\n\n\t\t\tif (!messageList) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst observer = new ResizeObserver(() => {\n\t\t\t\tif (atBottomRef.current === true) {\n\t\t\t\t\tnode.scrollTo({ left: 30, top: node.scrollHeight });\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tobserver.observe(messageList);\n\n\t\t\tnode.addEventListener(\n\t\t\t\t'scroll',\n\t\t\t\twithThrottling({ wait: 100 })(() => {\n\t\t\t\t\tatBottomRef.current = isAtBottom(100);\n\t\t\t\t}),\n\t\t\t\t{\n\t\t\t\t\tpassive: true,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\t[isAtBottom],\n\t);\n\n\treturn {\n\t\tatBottomRef,\n\t\tinnerRef: useMergedRefs(ref, innerBoxRef) as unknown as React.MutableRefObject<HTMLDivElement | null>,\n\t\tsendToBottom,\n\t\tsendToBottomIfNecessary,\n\t\tisAtBottom,\n\t};\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"a836069ef237aed2a33996be044c8b5286a3e15e"}
