{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/avatar/UserAvatarEditor/UserAvatarEditor.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/components/avatar/UserAvatarEditor/UserAvatarEditor.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/avatar/UserAvatarEditor/UserAvatarEditor.tsx","inputSourceMap":{"version":3,"file":"client/components/avatar/UserAvatarEditor/UserAvatarEditor.tsx","sourceRoot":"","sources":["client/components/avatar/UserAvatarEditor/UserAvatarEditor.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IUser, AvatarObject } from '@rocket.chat/core-typings';\nimport { Box, Button, Avatar, TextInput, IconButton, Label } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { UserAvatar } from '@rocket.chat/ui-avatar';\nimport { useToastMessageDispatch, useSetting } from '@rocket.chat/ui-contexts';\nimport type { ReactElement, ChangeEvent } from 'react';\nimport React, { useState, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport type { UserAvatarSuggestion } from './UserAvatarSuggestion';\nimport UserAvatarSuggestions from './UserAvatarSuggestions';\nimport { readFileAsDataURL } from './readFileAsDataURL';\nimport { useSingleFileInput } from '../../../hooks/useSingleFileInput';\nimport { isValidImageFormat } from '../../../lib/utils/isValidImageFormat';\n\ntype UserAvatarEditorProps = {\n\tcurrentUsername: IUser['username'];\n\tusername: IUser['username'];\n\tsetAvatarObj: (obj: AvatarObject) => void;\n\tdisabled?: boolean;\n\tetag: IUser['avatarETag'];\n};\n\nfunction UserAvatarEditor({ currentUsername, username, setAvatarObj, disabled, etag }: UserAvatarEditorProps): ReactElement {\n\tconst { t } = useTranslation();\n\tconst rotateImages = useSetting('FileUpload_RotateImages');\n\tconst [avatarFromUrl, setAvatarFromUrl] = useState('');\n\tconst [newAvatarSource, setNewAvatarSource] = useState<string>();\n\tconst imageUrlField = useUniqueId();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst setUploadedPreview = useCallback(\n\t\tasync (file, avatarObj) => {\n\t\t\tsetAvatarObj(avatarObj);\n\t\t\ttry {\n\t\t\t\tconst dataURL = await readFileAsDataURL(file);\n\n\t\t\t\tif (await isValidImageFormat(dataURL)) {\n\t\t\t\t\tsetNewAvatarSource(dataURL);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Avatar_format_invalid') });\n\t\t\t}\n\t\t},\n\t\t[setAvatarObj, t, dispatchToastMessage],\n\t);\n\n\tconst [clickUpload] = useSingleFileInput(setUploadedPreview);\n\n\tconst handleAddUrl = (): void => {\n\t\tsetNewAvatarSource(avatarFromUrl);\n\t\tsetAvatarObj({ avatarUrl: avatarFromUrl });\n\t};\n\n\tconst clickReset = (): void => {\n\t\tsetNewAvatarSource(`/avatar/%40${username}`);\n\t\tsetAvatarObj('reset');\n\t};\n\n\tconst url = newAvatarSource;\n\n\tconst handleAvatarFromUrlChange = (event: ChangeEvent<HTMLInputElement>): void => {\n\t\tsetAvatarFromUrl(event.currentTarget.value);\n\t};\n\n\tconst handleSelectSuggestion = useCallback(\n\t\t(suggestion: UserAvatarSuggestion) => {\n\t\t\tsetAvatarObj(suggestion as unknown as AvatarObject);\n\t\t\tsetNewAvatarSource(suggestion.blob);\n\t\t},\n\t\t[setAvatarObj, setNewAvatarSource],\n\t);\n\n\treturn (\n\t\t<Box display='flex' flexDirection='column' fontScale='p2m' color='default'>\n\t\t\t{t('Profile_picture')}\n\t\t\t<Box display='flex' flexDirection='row' mbs={4}>\n\t\t\t\t<UserAvatar\n\t\t\t\t\tsize='x124'\n\t\t\t\t\turl={url}\n\t\t\t\t\tkey={url}\n\t\t\t\t\tdata-qa-id='UserAvatarEditor'\n\t\t\t\t\tusername={currentUsername || ''}\n\t\t\t\t\tetag={etag}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\timageOrientation: rotateImages ? 'from-image' : 'none',\n\t\t\t\t\t\tobjectFit: 'contain',\n\t\t\t\t\t}}\n\t\t\t\t\tonError={() => dispatchToastMessage({ type: 'error', message: t('error-invalid-image-url') })}\n\t\t\t\t/>\n\t\t\t\t<Box display='flex' flexDirection='column' flexGrow='1' justifyContent='space-between' mis={4}>\n\t\t\t\t\t<Box display='flex' flexDirection='row' mbs='none'>\n\t\t\t\t\t\t<Button square disabled={disabled} mi={4} title={t('Accounts_SetDefaultAvatar')} onClick={clickReset}>\n\t\t\t\t\t\t\t<Avatar url={`/avatar/%40${username}`} />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<IconButton icon='upload' secondary disabled={disabled} title={t('Upload')} mi={4} onClick={clickUpload} />\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\ticon='permalink'\n\t\t\t\t\t\t\tsecondary\n\t\t\t\t\t\t\tdisabled={disabled || !avatarFromUrl}\n\t\t\t\t\t\t\ttitle={t('Add_URL')}\n\t\t\t\t\t\t\tmi={4}\n\t\t\t\t\t\t\tonClick={handleAddUrl}\n\t\t\t\t\t\t\tdata-qa-id='UserAvatarEditorSetAvatarLink'\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<UserAvatarSuggestions disabled={disabled} onSelectOne={handleSelectSuggestion} />\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Label htmlFor={imageUrlField} mis={4}>\n\t\t\t\t\t\t{t('Use_url_for_avatar')}\n\t\t\t\t\t</Label>\n\t\t\t\t\t<TextInput\n\t\t\t\t\t\tdata-qa-id='UserAvatarEditorLink'\n\t\t\t\t\t\tid={imageUrlField}\n\t\t\t\t\t\tflexGrow={0}\n\t\t\t\t\t\tplaceholder={t('Use_url_for_avatar')}\n\t\t\t\t\t\tvalue={avatarFromUrl}\n\t\t\t\t\t\tmis={4}\n\t\t\t\t\t\tonChange={handleAvatarFromUrlChange}\n\t\t\t\t\t/>\n\t\t\t\t</Box>\n\t\t\t</Box>\n\t\t</Box>\n\t);\n}\n\nexport default UserAvatarEditor;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/components/avatar/UserAvatarEditor/UserAvatarEditor.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/components/avatar/UserAvatarEditor/UserAvatarEditor.tsx","inputSourceMap":{"version":3,"file":"client/components/avatar/UserAvatarEditor/UserAvatarEditor.tsx","sourceRoot":"","sources":["client/components/avatar/UserAvatarEditor/UserAvatarEditor.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IUser, AvatarObject } from '@rocket.chat/core-typings';\nimport { Box, Button, Avatar, TextInput, IconButton, Label } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { UserAvatar } from '@rocket.chat/ui-avatar';\nimport { useToastMessageDispatch, useSetting } from '@rocket.chat/ui-contexts';\nimport type { ReactElement, ChangeEvent } from 'react';\nimport React, { useState, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport type { UserAvatarSuggestion } from './UserAvatarSuggestion';\nimport UserAvatarSuggestions from './UserAvatarSuggestions';\nimport { readFileAsDataURL } from './readFileAsDataURL';\nimport { useSingleFileInput } from '../../../hooks/useSingleFileInput';\nimport { isValidImageFormat } from '../../../lib/utils/isValidImageFormat';\n\ntype UserAvatarEditorProps = {\n\tcurrentUsername: IUser['username'];\n\tusername: IUser['username'];\n\tsetAvatarObj: (obj: AvatarObject) => void;\n\tdisabled?: boolean;\n\tetag: IUser['avatarETag'];\n};\n\nfunction UserAvatarEditor({ currentUsername, username, setAvatarObj, disabled, etag }: UserAvatarEditorProps): ReactElement {\n\tconst { t } = useTranslation();\n\tconst rotateImages = useSetting('FileUpload_RotateImages');\n\tconst [avatarFromUrl, setAvatarFromUrl] = useState('');\n\tconst [newAvatarSource, setNewAvatarSource] = useState<string>();\n\tconst imageUrlField = useUniqueId();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst setUploadedPreview = useCallback(\n\t\tasync (file, avatarObj) => {\n\t\t\tsetAvatarObj(avatarObj);\n\t\t\ttry {\n\t\t\t\tconst dataURL = await readFileAsDataURL(file);\n\n\t\t\t\tif (await isValidImageFormat(dataURL)) {\n\t\t\t\t\tsetNewAvatarSource(dataURL);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Avatar_format_invalid') });\n\t\t\t}\n\t\t},\n\t\t[setAvatarObj, t, dispatchToastMessage],\n\t);\n\n\tconst [clickUpload] = useSingleFileInput(setUploadedPreview);\n\n\tconst handleAddUrl = (): void => {\n\t\tsetNewAvatarSource(avatarFromUrl);\n\t\tsetAvatarObj({ avatarUrl: avatarFromUrl });\n\t};\n\n\tconst clickReset = (): void => {\n\t\tsetNewAvatarSource(`/avatar/%40${username}`);\n\t\tsetAvatarObj('reset');\n\t};\n\n\tconst url = newAvatarSource;\n\n\tconst handleAvatarFromUrlChange = (event: ChangeEvent<HTMLInputElement>): void => {\n\t\tsetAvatarFromUrl(event.currentTarget.value);\n\t};\n\n\tconst handleSelectSuggestion = useCallback(\n\t\t(suggestion: UserAvatarSuggestion) => {\n\t\t\tsetAvatarObj(suggestion as unknown as AvatarObject);\n\t\t\tsetNewAvatarSource(suggestion.blob);\n\t\t},\n\t\t[setAvatarObj, setNewAvatarSource],\n\t);\n\n\treturn (\n\t\t<Box display='flex' flexDirection='column' fontScale='p2m' color='default'>\n\t\t\t{t('Profile_picture')}\n\t\t\t<Box display='flex' flexDirection='row' mbs={4}>\n\t\t\t\t<UserAvatar\n\t\t\t\t\tsize='x124'\n\t\t\t\t\turl={url}\n\t\t\t\t\tkey={url}\n\t\t\t\t\tdata-qa-id='UserAvatarEditor'\n\t\t\t\t\tusername={currentUsername || ''}\n\t\t\t\t\tetag={etag}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\timageOrientation: rotateImages ? 'from-image' : 'none',\n\t\t\t\t\t\tobjectFit: 'contain',\n\t\t\t\t\t}}\n\t\t\t\t\tonError={() => dispatchToastMessage({ type: 'error', message: t('error-invalid-image-url') })}\n\t\t\t\t/>\n\t\t\t\t<Box display='flex' flexDirection='column' flexGrow='1' justifyContent='space-between' mis={4}>\n\t\t\t\t\t<Box display='flex' flexDirection='row' mbs='none'>\n\t\t\t\t\t\t<Button square disabled={disabled} mi={4} title={t('Accounts_SetDefaultAvatar')} onClick={clickReset}>\n\t\t\t\t\t\t\t<Avatar url={`/avatar/%40${username}`} />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<IconButton icon='upload' secondary disabled={disabled} title={t('Upload')} mi={4} onClick={clickUpload} />\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\ticon='permalink'\n\t\t\t\t\t\t\tsecondary\n\t\t\t\t\t\t\tdisabled={disabled || !avatarFromUrl}\n\t\t\t\t\t\t\ttitle={t('Add_URL')}\n\t\t\t\t\t\t\tmi={4}\n\t\t\t\t\t\t\tonClick={handleAddUrl}\n\t\t\t\t\t\t\tdata-qa-id='UserAvatarEditorSetAvatarLink'\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<UserAvatarSuggestions disabled={disabled} onSelectOne={handleSelectSuggestion} />\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Label htmlFor={imageUrlField} mis={4}>\n\t\t\t\t\t\t{t('Use_url_for_avatar')}\n\t\t\t\t\t</Label>\n\t\t\t\t\t<TextInput\n\t\t\t\t\t\tdata-qa-id='UserAvatarEditorLink'\n\t\t\t\t\t\tid={imageUrlField}\n\t\t\t\t\t\tflexGrow={0}\n\t\t\t\t\t\tplaceholder={t('Use_url_for_avatar')}\n\t\t\t\t\t\tvalue={avatarFromUrl}\n\t\t\t\t\t\tmis={4}\n\t\t\t\t\t\tonChange={handleAvatarFromUrlChange}\n\t\t\t\t\t/>\n\t\t\t\t</Box>\n\t\t\t</Box>\n\t\t</Box>\n\t);\n}\n\nexport default UserAvatarEditor;\n"]}}},"code":"let Box, Button, Avatar, TextInput, IconButton, Label;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Box(v) {\n    Box = v;\n  },\n  Button(v) {\n    Button = v;\n  },\n  Avatar(v) {\n    Avatar = v;\n  },\n  TextInput(v) {\n    TextInput = v;\n  },\n  IconButton(v) {\n    IconButton = v;\n  },\n  Label(v) {\n    Label = v;\n  }\n}, 0);\nlet useUniqueId;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useUniqueId(v) {\n    useUniqueId = v;\n  }\n}, 1);\nlet UserAvatar;\nmodule.link(\"@rocket.chat/ui-avatar\", {\n  UserAvatar(v) {\n    UserAvatar = v;\n  }\n}, 2);\nlet useToastMessageDispatch, useSetting;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useToastMessageDispatch(v) {\n    useToastMessageDispatch = v;\n  },\n  useSetting(v) {\n    useSetting = v;\n  }\n}, 3);\nlet React, useState, useCallback;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  },\n  useState(v) {\n    useState = v;\n  },\n  useCallback(v) {\n    useCallback = v;\n  }\n}, 4);\nlet useTranslation;\nmodule.link(\"react-i18next\", {\n  useTranslation(v) {\n    useTranslation = v;\n  }\n}, 5);\nlet UserAvatarSuggestions;\nmodule.link(\"./UserAvatarSuggestions\", {\n  default(v) {\n    UserAvatarSuggestions = v;\n  }\n}, 6);\nlet readFileAsDataURL;\nmodule.link(\"./readFileAsDataURL\", {\n  readFileAsDataURL(v) {\n    readFileAsDataURL = v;\n  }\n}, 7);\nlet useSingleFileInput;\nmodule.link(\"../../../hooks/useSingleFileInput\", {\n  useSingleFileInput(v) {\n    useSingleFileInput = v;\n  }\n}, 8);\nlet isValidImageFormat;\nmodule.link(\"../../../lib/utils/isValidImageFormat\", {\n  isValidImageFormat(v) {\n    isValidImageFormat = v;\n  }\n}, 9);\nfunction UserAvatarEditor(_ref) {\n  let {\n    currentUsername,\n    username,\n    setAvatarObj,\n    disabled,\n    etag\n  } = _ref;\n  const {\n    t\n  } = useTranslation();\n  const rotateImages = useSetting('FileUpload_RotateImages');\n  const [avatarFromUrl, setAvatarFromUrl] = useState('');\n  const [newAvatarSource, setNewAvatarSource] = useState();\n  const imageUrlField = useUniqueId();\n  const dispatchToastMessage = useToastMessageDispatch();\n  const setUploadedPreview = useCallback(async (file, avatarObj) => {\n    setAvatarObj(avatarObj);\n    try {\n      const dataURL = await readFileAsDataURL(file);\n      if (await isValidImageFormat(dataURL)) {\n        setNewAvatarSource(dataURL);\n      }\n    } catch (error) {\n      dispatchToastMessage({\n        type: 'error',\n        message: t('Avatar_format_invalid')\n      });\n    }\n  }, [setAvatarObj, t, dispatchToastMessage]);\n  const [clickUpload] = useSingleFileInput(setUploadedPreview);\n  const handleAddUrl = () => {\n    setNewAvatarSource(avatarFromUrl);\n    setAvatarObj({\n      avatarUrl: avatarFromUrl\n    });\n  };\n  const clickReset = () => {\n    setNewAvatarSource(\"/avatar/%40\".concat(username));\n    setAvatarObj('reset');\n  };\n  const url = newAvatarSource;\n  const handleAvatarFromUrlChange = event => {\n    setAvatarFromUrl(event.currentTarget.value);\n  };\n  const handleSelectSuggestion = useCallback(suggestion => {\n    setAvatarObj(suggestion);\n    setNewAvatarSource(suggestion.blob);\n  }, [setAvatarObj, setNewAvatarSource]);\n  return /*#__PURE__*/React.createElement(Box, {\n    display: \"flex\",\n    flexDirection: \"column\",\n    fontScale: \"p2m\",\n    color: \"default\"\n  }, t('Profile_picture'), /*#__PURE__*/React.createElement(Box, {\n    display: \"flex\",\n    flexDirection: \"row\",\n    mbs: 4\n  }, /*#__PURE__*/React.createElement(UserAvatar, {\n    size: \"x124\",\n    url: url,\n    key: url,\n    \"data-qa-id\": \"UserAvatarEditor\",\n    username: currentUsername || '',\n    etag: etag,\n    style: {\n      imageOrientation: rotateImages ? 'from-image' : 'none',\n      objectFit: 'contain'\n    },\n    onError: () => dispatchToastMessage({\n      type: 'error',\n      message: t('error-invalid-image-url')\n    })\n  }), /*#__PURE__*/React.createElement(Box, {\n    display: \"flex\",\n    flexDirection: \"column\",\n    flexGrow: \"1\",\n    justifyContent: \"space-between\",\n    mis: 4\n  }, /*#__PURE__*/React.createElement(Box, {\n    display: \"flex\",\n    flexDirection: \"row\",\n    mbs: \"none\"\n  }, /*#__PURE__*/React.createElement(Button, {\n    square: true,\n    disabled: disabled,\n    mi: 4,\n    title: t('Accounts_SetDefaultAvatar'),\n    onClick: clickReset\n  }, /*#__PURE__*/React.createElement(Avatar, {\n    url: \"/avatar/%40\".concat(username)\n  })), /*#__PURE__*/React.createElement(IconButton, {\n    icon: \"upload\",\n    secondary: true,\n    disabled: disabled,\n    title: t('Upload'),\n    mi: 4,\n    onClick: clickUpload\n  }), /*#__PURE__*/React.createElement(IconButton, {\n    icon: \"permalink\",\n    secondary: true,\n    disabled: disabled || !avatarFromUrl,\n    title: t('Add_URL'),\n    mi: 4,\n    onClick: handleAddUrl,\n    \"data-qa-id\": \"UserAvatarEditorSetAvatarLink\"\n  }), /*#__PURE__*/React.createElement(UserAvatarSuggestions, {\n    disabled: disabled,\n    onSelectOne: handleSelectSuggestion\n  })), /*#__PURE__*/React.createElement(Label, {\n    htmlFor: imageUrlField,\n    mis: 4\n  }, t('Use_url_for_avatar')), /*#__PURE__*/React.createElement(TextInput, {\n    \"data-qa-id\": \"UserAvatarEditorLink\",\n    id: imageUrlField,\n    flexGrow: 0,\n    placeholder: t('Use_url_for_avatar'),\n    value: avatarFromUrl,\n    mis: 4,\n    onChange: handleAvatarFromUrlChange\n  }))));\n}\nmodule.exportDefault(UserAvatarEditor);","map":{"version":3,"names":["Box","Button","Avatar","TextInput","IconButton","Label","module","link","v","useUniqueId","UserAvatar","useToastMessageDispatch","useSetting","React","useState","useCallback","default","useTranslation","UserAvatarSuggestions","readFileAsDataURL","useSingleFileInput","isValidImageFormat","UserAvatarEditor","_ref","currentUsername","username","setAvatarObj","disabled","etag","t","rotateImages","avatarFromUrl","setAvatarFromUrl","newAvatarSource","setNewAvatarSource","imageUrlField","dispatchToastMessage","setUploadedPreview","file","avatarObj","dataURL","error","type","message","clickUpload","handleAddUrl","avatarUrl","clickReset","concat","url","handleAvatarFromUrlChange","event","currentTarget","value","handleSelectSuggestion","suggestion","blob","createElement","display","flexDirection","fontScale","color","mbs","size","key","style","imageOrientation","objectFit","onError","flexGrow","justifyContent","mis","square","mi","title","onClick","icon","secondary","onSelectOne","htmlFor","id","placeholder","onChange","exportDefault"],"sources":["client/components/avatar/UserAvatarEditor/UserAvatarEditor.tsx"],"sourcesContent":["import type { IUser, AvatarObject } from '@rocket.chat/core-typings';\nimport { Box, Button, Avatar, TextInput, IconButton, Label } from '@rocket.chat/fuselage';\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\nimport { UserAvatar } from '@rocket.chat/ui-avatar';\nimport { useToastMessageDispatch, useSetting } from '@rocket.chat/ui-contexts';\nimport type { ReactElement, ChangeEvent } from 'react';\nimport React, { useState, useCallback } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport type { UserAvatarSuggestion } from './UserAvatarSuggestion';\nimport UserAvatarSuggestions from './UserAvatarSuggestions';\nimport { readFileAsDataURL } from './readFileAsDataURL';\nimport { useSingleFileInput } from '../../../hooks/useSingleFileInput';\nimport { isValidImageFormat } from '../../../lib/utils/isValidImageFormat';\n\ntype UserAvatarEditorProps = {\n\tcurrentUsername: IUser['username'];\n\tusername: IUser['username'];\n\tsetAvatarObj: (obj: AvatarObject) => void;\n\tdisabled?: boolean;\n\tetag: IUser['avatarETag'];\n};\n\nfunction UserAvatarEditor({ currentUsername, username, setAvatarObj, disabled, etag }: UserAvatarEditorProps): ReactElement {\n\tconst { t } = useTranslation();\n\tconst rotateImages = useSetting('FileUpload_RotateImages');\n\tconst [avatarFromUrl, setAvatarFromUrl] = useState('');\n\tconst [newAvatarSource, setNewAvatarSource] = useState<string>();\n\tconst imageUrlField = useUniqueId();\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst setUploadedPreview = useCallback(\n\t\tasync (file, avatarObj) => {\n\t\t\tsetAvatarObj(avatarObj);\n\t\t\ttry {\n\t\t\t\tconst dataURL = await readFileAsDataURL(file);\n\n\t\t\t\tif (await isValidImageFormat(dataURL)) {\n\t\t\t\t\tsetNewAvatarSource(dataURL);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tdispatchToastMessage({ type: 'error', message: t('Avatar_format_invalid') });\n\t\t\t}\n\t\t},\n\t\t[setAvatarObj, t, dispatchToastMessage],\n\t);\n\n\tconst [clickUpload] = useSingleFileInput(setUploadedPreview);\n\n\tconst handleAddUrl = (): void => {\n\t\tsetNewAvatarSource(avatarFromUrl);\n\t\tsetAvatarObj({ avatarUrl: avatarFromUrl });\n\t};\n\n\tconst clickReset = (): void => {\n\t\tsetNewAvatarSource(`/avatar/%40${username}`);\n\t\tsetAvatarObj('reset');\n\t};\n\n\tconst url = newAvatarSource;\n\n\tconst handleAvatarFromUrlChange = (event: ChangeEvent<HTMLInputElement>): void => {\n\t\tsetAvatarFromUrl(event.currentTarget.value);\n\t};\n\n\tconst handleSelectSuggestion = useCallback(\n\t\t(suggestion: UserAvatarSuggestion) => {\n\t\t\tsetAvatarObj(suggestion as unknown as AvatarObject);\n\t\t\tsetNewAvatarSource(suggestion.blob);\n\t\t},\n\t\t[setAvatarObj, setNewAvatarSource],\n\t);\n\n\treturn (\n\t\t<Box display='flex' flexDirection='column' fontScale='p2m' color='default'>\n\t\t\t{t('Profile_picture')}\n\t\t\t<Box display='flex' flexDirection='row' mbs={4}>\n\t\t\t\t<UserAvatar\n\t\t\t\t\tsize='x124'\n\t\t\t\t\turl={url}\n\t\t\t\t\tkey={url}\n\t\t\t\t\tdata-qa-id='UserAvatarEditor'\n\t\t\t\t\tusername={currentUsername || ''}\n\t\t\t\t\tetag={etag}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\timageOrientation: rotateImages ? 'from-image' : 'none',\n\t\t\t\t\t\tobjectFit: 'contain',\n\t\t\t\t\t}}\n\t\t\t\t\tonError={() => dispatchToastMessage({ type: 'error', message: t('error-invalid-image-url') })}\n\t\t\t\t/>\n\t\t\t\t<Box display='flex' flexDirection='column' flexGrow='1' justifyContent='space-between' mis={4}>\n\t\t\t\t\t<Box display='flex' flexDirection='row' mbs='none'>\n\t\t\t\t\t\t<Button square disabled={disabled} mi={4} title={t('Accounts_SetDefaultAvatar')} onClick={clickReset}>\n\t\t\t\t\t\t\t<Avatar url={`/avatar/%40${username}`} />\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<IconButton icon='upload' secondary disabled={disabled} title={t('Upload')} mi={4} onClick={clickUpload} />\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\ticon='permalink'\n\t\t\t\t\t\t\tsecondary\n\t\t\t\t\t\t\tdisabled={disabled || !avatarFromUrl}\n\t\t\t\t\t\t\ttitle={t('Add_URL')}\n\t\t\t\t\t\t\tmi={4}\n\t\t\t\t\t\t\tonClick={handleAddUrl}\n\t\t\t\t\t\t\tdata-qa-id='UserAvatarEditorSetAvatarLink'\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<UserAvatarSuggestions disabled={disabled} onSelectOne={handleSelectSuggestion} />\n\t\t\t\t\t</Box>\n\t\t\t\t\t<Label htmlFor={imageUrlField} mis={4}>\n\t\t\t\t\t\t{t('Use_url_for_avatar')}\n\t\t\t\t\t</Label>\n\t\t\t\t\t<TextInput\n\t\t\t\t\t\tdata-qa-id='UserAvatarEditorLink'\n\t\t\t\t\t\tid={imageUrlField}\n\t\t\t\t\t\tflexGrow={0}\n\t\t\t\t\t\tplaceholder={t('Use_url_for_avatar')}\n\t\t\t\t\t\tvalue={avatarFromUrl}\n\t\t\t\t\t\tmis={4}\n\t\t\t\t\t\tonChange={handleAvatarFromUrlChange}\n\t\t\t\t\t/>\n\t\t\t\t</Box>\n\t\t\t</Box>\n\t\t</Box>\n\t);\n}\n\nexport default UserAvatarEditor;\n"],"mappings":"AACA,IAAAA,GAAO,EAAAC,MAAO,EAAAC,MAAM,EAAEC,SAAQ,EAAAC,UAAW,EAAAC,KAAA;AAAAC,MAAY,CAAAC,IAAO,wBAAM;EAAAP,GAAuBA,CAACQ,CAAA;IAAAR,GAAA,GAAAQ,CAAA;EAAA;EAAAP,OAAAO,CAAA;IAAAP,MAAA,GAAAO,CAAA;EAAA;EAAAN,OAAAM,CAAA;IAAAN,MAAA,GAAAM,CAAA;EAAA;EAAAL,UAAAK,CAAA;IAAAL,SAAA,GAAAK,CAAA;EAAA;EAAAJ,WAAAI,CAAA;IAAAJ,UAAA,GAAAI,CAAA;EAAA;EAAAH,MAAAG,CAAA;IAAAH,KAAA,GAAAG,CAAA;EAAA;AAAA;AAAA,IAAAC,WAAA;AAAAH,MAAA,CAAAC,IAAA;EAAAE,YAAAD,CAAA;IAAAC,WAAA,GAAAD,CAAA;EAAA;AAAA;AAAA,IAAAE,UAAA;AAAAJ,MAAA,CAAAC,IAAA;EAAAG,WAAAF,CAAA;IAAAE,UAAA,GAAAF,CAAA;EAAA;AAAA;AAAA,IAAAG,uBAAA,EAAAC,UAAA;AAAAN,MAAA,CAAAC,IAAA;EAAAI,wBAAAH,CAAA;IAAAG,uBAAA,GAAAH,CAAA;EAAA;EAAAI,WAAAJ,CAAA;IAAAI,UAAA,GAAAJ,CAAA;EAAA;AAAA;AAAA,IAAAK,KAAA,EAAAC,QAAA,EAAAC,WAAA;AAAAT,MAAA,CAAAC,IAAA;EAAAS,QAAAR,CAAA;IAAAK,KAAA,GAAAL,CAAA;EAAA;EAAAM,SAAAN,CAAA;IAAAM,QAAA,GAAAN,CAAA;EAAA;EAAAO,YAAAP,CAAA;IAAAO,WAAA,GAAAP,CAAA;EAAA;AAAA;AAAA,IAAAS,cAAA;AAAAX,MAAA,CAAAC,IAAA;EAAAU,eAAAT,CAAA;IAAAS,cAAA,GAAAT,CAAA;EAAA;AAAA;AAAA,IAAAU,qBAAA;AAAAZ,MAAA,CAAAC,IAAA;EAAAS,QAAAR,CAAA;IAAAU,qBAAA,GAAAV,CAAA;EAAA;AAAA;AAAA,IAAAW,iBAAA;AAAAb,MAAA,CAAAC,IAAA;EAAAY,kBAAAX,CAAA;IAAAW,iBAAA,GAAAX,CAAA;EAAA;AAAA;AAAA,IAAAY,kBAAA;AAAAd,MAAA,CAAAC,IAAA;EAAAa,mBAAAZ,CAAA;IAAAY,kBAAA,GAAAZ,CAAA;EAAA;AAAA;AAAA,IAAAa,kBAAA;AAAAf,MAAA,CAAAC,IAAA;EAAAc,mBAAAb,CAAA;IAAAa,kBAAA,GAAAb,CAAA;EAAA;AAAA;AAsB1F,SAASc,gBAAgBA,CAAAC,IAAA,EAAmF;EAAA,IAAlF;IAAEC,eAAe;IAAEC,QAAQ;IAAEC,YAAY;IAAEC,QAAQ;IAAEC;EAAI,CAAyB,GAAAL,IAAA;EAC3G,MAAM;IAAEM;EAAC,CAAE,GAAGZ,cAAc,EAAE;EAC9B,MAAMa,YAAY,GAAGlB,UAAU,CAAC,yBAAyB,CAAC;EAC1D,MAAM,CAACmB,aAAa,EAAEC,gBAAgB,CAAC,GAAGlB,QAAQ,CAAC,EAAE,CAAC;EACtD,MAAM,CAACmB,eAAe,EAAEC,kBAAkB,CAAC,GAAGpB,QAAQ,EAAU;EAChE,MAAMqB,aAAa,GAAG1B,WAAW,EAAE;EACnC,MAAM2B,oBAAoB,GAAGzB,uBAAuB,EAAE;EAEtD,MAAM0B,kBAAkB,GAAGtB,WAAW,CACrC,OAAOuB,IAAI,EAAEC,SAAS,KAAI;IACzBb,YAAY,CAACa,SAAS,CAAC;IACvB,IAAI;MACH,MAAMC,OAAO,GAAG,MAAMrB,iBAAiB,CAACmB,IAAI,CAAC;MAE7C,IAAI,MAAMjB,kBAAkB,CAACmB,OAAO,CAAC,EAAE;QACtCN,kBAAkB,CAACM,OAAO,CAAC;MAC5B;IACD,CAAC,CAAC,OAAOC,KAAK,EAAE;MACfL,oBAAoB,CAAC;QAAEM,IAAI,EAAE,OAAO;QAAEC,OAAO,EAAEd,CAAC,CAAC,uBAAuB;MAAC,CAAE,CAAC;IAC7E;EACD,CAAC,EACD,CAACH,YAAY,EAAEG,CAAC,EAAEO,oBAAoB,CAAC,CACvC;EAED,MAAM,CAACQ,WAAW,CAAC,GAAGxB,kBAAkB,CAACiB,kBAAkB,CAAC;EAE5D,MAAMQ,YAAY,GAAGA,CAAA,KAAW;IAC/BX,kBAAkB,CAACH,aAAa,CAAC;IACjCL,YAAY,CAAC;MAAEoB,SAAS,EAAEf;IAAa,CAAE,CAAC;EAC3C,CAAC;EAED,MAAMgB,UAAU,GAAGA,CAAA,KAAW;IAC7Bb,kBAAkB,eAAAc,MAAA,CAAevB,QAAQ,CAAE,CAAC;IAC5CC,YAAY,CAAC,OAAO,CAAC;EACtB,CAAC;EAED,MAAMuB,GAAG,GAAGhB,eAAe;EAE3B,MAAMiB,yBAAyB,GAAIC,KAAoC,IAAU;IAChFnB,gBAAgB,CAACmB,KAAK,CAACC,aAAa,CAACC,KAAK,CAAC;EAC5C,CAAC;EAED,MAAMC,sBAAsB,GAAGvC,WAAW,CACxCwC,UAAgC,IAAI;IACpC7B,YAAY,CAAC6B,UAAqC,CAAC;IACnDrB,kBAAkB,CAACqB,UAAU,CAACC,IAAI,CAAC;EACpC,CAAC,EACD,CAAC9B,YAAY,EAAEQ,kBAAkB,CAAC,CAClC;EAED,oBACCrB,KAAA,CAAA4C,aAAA,CAACzD,GAAG;IAAC0D,OAAO,EAAC,MAAM;IAACC,aAAa,EAAC,QAAQ;IAACC,SAAS,EAAC,KAAK;IAACC,KAAK,EAAC;EAAS,GACxEhC,CAAC,CAAC,iBAAiB,CAAC,eACrBhB,KAAA,CAAA4C,aAAA,CAACzD,GAAG;IAAC0D,OAAO,EAAC,MAAM;IAACC,aAAa,EAAC,KAAK;IAACG,GAAG,EAAE;EAAE,gBAC9CjD,KAAA,CAAA4C,aAAA,CAAC/C,UAAU;IACVqD,IAAI,EAAC,MAAM;IACXd,GAAG,EAAEA,GAAI;IACTe,GAAG,EAAEf,GAAI;IACT,cAAW,kBAAkB;IAC7BxB,QAAQ,EAAED,eAAe,IAAI,EAAG;IAChCI,IAAI,EAAEA,IAAK;IACXqC,KAAK,EAAE;MACNC,gBAAgB,EAAEpC,YAAY,GAAG,YAAY,GAAG,MAAM;MACtDqC,SAAS,EAAE;KACV;IACFC,OAAO,EAAEA,CAAA,KAAMhC,oBAAoB,CAAC;MAAEM,IAAI,EAAE,OAAO;MAAEC,OAAO,EAAEd,CAAC,CAAC,yBAAyB;IAAC,CAAE;EAAE,EAE/F,eAAAhB,KAAA,CAAA4C,aAAA,CAACzD,GAAG;IAAC0D,OAAO,EAAC,MAAM;IAACC,aAAa,EAAC,QAAQ;IAACU,QAAQ,EAAC,GAAG;IAACC,cAAc,EAAC,eAAe;IAACC,GAAG,EAAE;EAAE,gBAC7F1D,KAAA,CAAA4C,aAAA,CAACzD,GAAG;IAAC0D,OAAO,EAAC,MAAM;IAACC,aAAa,EAAC,KAAK;IAACG,GAAG,EAAC;EAAM,gBACjDjD,KAAA,CAAA4C,aAAA,CAACxD,MAAM;IAACuE,MAAM;IAAC7C,QAAQ,EAAEA,QAAS;IAAC8C,EAAE,EAAE,CAAE;IAACC,KAAK,EAAE7C,CAAC,CAAC,2BAA2B,CAAE;IAAC8C,OAAO,EAAE5B;EAAW,gBACpGlC,KAAA,CAAA4C,aAAA,CAACvD,MAAM;IAAC+C,GAAG,gBAAAD,MAAA,CAAgBvB,QAAQ;EAAG,EAC/B,CACR,eAAAZ,KAAA,CAAA4C,aAAA,CAACrD,UAAU;IAACwE,IAAI,EAAC,QAAQ;IAACC,SAAS;IAAClD,QAAQ,EAAEA,QAAS;IAAC+C,KAAK,EAAE7C,CAAC,CAAC,QAAQ,CAAE;IAAC4C,EAAE,EAAE,CAAE;IAACE,OAAO,EAAE/B;EAAY,EACxG,eAAA/B,KAAA,CAAA4C,aAAA,CAACrD,UAAU;IACVwE,IAAI,EAAC,WAAW;IAChBC,SAAS;IACTlD,QAAQ,EAAEA,QAAQ,IAAI,CAACI,aAAc;IACrC2C,KAAK,EAAE7C,CAAC,CAAC,SAAS,CAAE;IACpB4C,EAAE,EAAE,CAAE;IACNE,OAAO,EAAE9B,YAAa;IACtB,cAAW;EAA+B,EAE3C,eAAAhC,KAAA,CAAA4C,aAAA,CAACvC,qBAAqB;IAACS,QAAQ,EAAEA,QAAS;IAACmD,WAAW,EAAExB;EAAuB,EAC3E,CACL,eAAAzC,KAAA,CAAA4C,aAAA,CAACpD,KAAK;IAAC0E,OAAO,EAAE5C,aAAc;IAACoC,GAAG,EAAE;EAAE,GACpC1C,CAAC,CAAC,oBAAoB,CACjB,CACP,eAAAhB,KAAA,CAAA4C,aAAA,CAACtD,SAAS;IACT,cAAW,sBAAsB;IACjC6E,EAAE,EAAE7C,aAAc;IAClBkC,QAAQ,EAAE,CAAE;IACZY,WAAW,EAAEpD,CAAC,CAAC,oBAAoB,CAAE;IACrCwB,KAAK,EAAEtB,aAAc;IACrBwC,GAAG,EAAE,CAAE;IACPW,QAAQ,EAAEhC;EAA0B,EAEjC,CACD,CACD,CAAC;AAER;AA1HA5C,MAAA,CAAO6E,aAAa,CA4HL7D,gBA5HO","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"74a0c138bce71d733d272d3f668c4dd971f5995b"}
