{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/otr.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/startup/otr.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/otr.ts","inputSourceMap":{"version":3,"file":"client/startup/otr.ts","sourceRoot":"","sources":["client/startup/otr.ts"],"names":[],"mappings":"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","sourcesContent":["import { isOTRMessage } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport OTR from '../../app/otr/client/OTR';\nimport { OtrRoomState } from '../../app/otr/lib/OtrRoomState';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { t } from '../../app/utils/lib/i18n';\nimport { onClientBeforeSendMessage } from '../lib/onClientBeforeSendMessage';\nimport { onClientMessageReceived } from '../lib/onClientMessageReceived';\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn;\n\t\t}\n\n\t\tsdk.stream('notify-user', [`${uid}/otr`], (type, data) => {\n\t\t\tif (!data.roomId || !data.userId || data.userId === uid) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst otrRoom = OTR.getInstanceByRoomId(uid, data.roomId);\n\t\t\totrRoom?.onUserStream(type, data);\n\t\t});\n\t});\n\n\tonClientBeforeSendMessage.use(async (message) => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn message;\n\t\t}\n\n\t\tconst otrRoom = OTR.getInstanceByRoomId(uid, message.rid);\n\n\t\tif (otrRoom && otrRoom.getState() === OtrRoomState.ESTABLISHED) {\n\t\t\tconst msg = await otrRoom.encrypt(message);\n\t\t\treturn { ...message, msg, t: 'otr' };\n\t\t}\n\t\treturn message;\n\t});\n\n\tonClientMessageReceived.use(async (message) => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn message;\n\t\t}\n\n\t\tif (!isOTRMessage(message)) {\n\t\t\treturn message;\n\t\t}\n\n\t\tif ('notification' in message) {\n\t\t\treturn { ...message, msg: t('Encrypted_message') };\n\t\t}\n\n\t\tconst otrRoom = OTR.getInstanceByRoomId(uid, message.rid);\n\n\t\tif (otrRoom && otrRoom.getState() === OtrRoomState.ESTABLISHED) {\n\t\t\tconst decrypted = await otrRoom.decrypt(message.msg);\n\t\t\tif (typeof decrypted === 'string') {\n\t\t\t\treturn { ...message, msg: decrypted };\n\t\t\t}\n\t\t\tconst { _id, text: msg, ack, ts, userId } = decrypted;\n\n\t\t\tif (ts) message.ts = ts;\n\n\t\t\tif (message.otrAck) {\n\t\t\t\tconst otrAck = await otrRoom.decrypt(message.otrAck);\n\t\t\t\tif (typeof otrAck === 'string') {\n\t\t\t\t\treturn { ...message, msg: otrAck };\n\t\t\t\t}\n\n\t\t\t\tif (ack === otrAck.text) {\n\t\t\t\t\treturn { ...message, _id, t: 'otr-ack', msg };\n\t\t\t\t}\n\t\t\t} else if (userId !== Meteor.userId()) {\n\t\t\t\tconst encryptedAck = await otrRoom.encryptText(ack);\n\n\t\t\t\tvoid sdk.call('updateOTRAck', { message, ack: encryptedAck });\n\t\t\t}\n\n\t\t\treturn { ...message, _id, msg };\n\t\t}\n\t\tif (message.t === 'otr') message.msg = '';\n\n\t\treturn message;\n\t});\n});\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/startup/otr.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/startup/otr.ts","inputSourceMap":{"version":3,"file":"client/startup/otr.ts","sourceRoot":"","sources":["client/startup/otr.ts"],"names":[],"mappings":"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","sourcesContent":["import { isOTRMessage } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport OTR from '../../app/otr/client/OTR';\nimport { OtrRoomState } from '../../app/otr/lib/OtrRoomState';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { t } from '../../app/utils/lib/i18n';\nimport { onClientBeforeSendMessage } from '../lib/onClientBeforeSendMessage';\nimport { onClientMessageReceived } from '../lib/onClientMessageReceived';\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn;\n\t\t}\n\n\t\tsdk.stream('notify-user', [`${uid}/otr`], (type, data) => {\n\t\t\tif (!data.roomId || !data.userId || data.userId === uid) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst otrRoom = OTR.getInstanceByRoomId(uid, data.roomId);\n\t\t\totrRoom?.onUserStream(type, data);\n\t\t});\n\t});\n\n\tonClientBeforeSendMessage.use(async (message) => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn message;\n\t\t}\n\n\t\tconst otrRoom = OTR.getInstanceByRoomId(uid, message.rid);\n\n\t\tif (otrRoom && otrRoom.getState() === OtrRoomState.ESTABLISHED) {\n\t\t\tconst msg = await otrRoom.encrypt(message);\n\t\t\treturn { ...message, msg, t: 'otr' };\n\t\t}\n\t\treturn message;\n\t});\n\n\tonClientMessageReceived.use(async (message) => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn message;\n\t\t}\n\n\t\tif (!isOTRMessage(message)) {\n\t\t\treturn message;\n\t\t}\n\n\t\tif ('notification' in message) {\n\t\t\treturn { ...message, msg: t('Encrypted_message') };\n\t\t}\n\n\t\tconst otrRoom = OTR.getInstanceByRoomId(uid, message.rid);\n\n\t\tif (otrRoom && otrRoom.getState() === OtrRoomState.ESTABLISHED) {\n\t\t\tconst decrypted = await otrRoom.decrypt(message.msg);\n\t\t\tif (typeof decrypted === 'string') {\n\t\t\t\treturn { ...message, msg: decrypted };\n\t\t\t}\n\t\t\tconst { _id, text: msg, ack, ts, userId } = decrypted;\n\n\t\t\tif (ts) message.ts = ts;\n\n\t\t\tif (message.otrAck) {\n\t\t\t\tconst otrAck = await otrRoom.decrypt(message.otrAck);\n\t\t\t\tif (typeof otrAck === 'string') {\n\t\t\t\t\treturn { ...message, msg: otrAck };\n\t\t\t\t}\n\n\t\t\t\tif (ack === otrAck.text) {\n\t\t\t\t\treturn { ...message, _id, t: 'otr-ack', msg };\n\t\t\t\t}\n\t\t\t} else if (userId !== Meteor.userId()) {\n\t\t\t\tconst encryptedAck = await otrRoom.encryptText(ack);\n\n\t\t\t\tvoid sdk.call('updateOTRAck', { message, ack: encryptedAck });\n\t\t\t}\n\n\t\t\treturn { ...message, _id, msg };\n\t\t}\n\t\tif (message.t === 'otr') message.msg = '';\n\n\t\treturn message;\n\t});\n});\n"]}}},"code":"var _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nvar _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 1);\nvar isOTRMessage;\nmodule.link(\"@rocket.chat/core-typings\", {\n  isOTRMessage: function (v) {\n    isOTRMessage = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 2);\nvar OTR;\nmodule.link(\"../../app/otr/client/OTR\", {\n  \"default\": function (v) {\n    OTR = v;\n  }\n}, 3);\nvar OtrRoomState;\nmodule.link(\"../../app/otr/lib/OtrRoomState\", {\n  OtrRoomState: function (v) {\n    OtrRoomState = v;\n  }\n}, 4);\nvar sdk;\nmodule.link(\"../../app/utils/client/lib/SDKClient\", {\n  sdk: function (v) {\n    sdk = v;\n  }\n}, 5);\nvar t;\nmodule.link(\"../../app/utils/lib/i18n\", {\n  t: function (v) {\n    t = v;\n  }\n}, 6);\nvar onClientBeforeSendMessage;\nmodule.link(\"../lib/onClientBeforeSendMessage\", {\n  onClientBeforeSendMessage: function (v) {\n    onClientBeforeSendMessage = v;\n  }\n}, 7);\nvar onClientMessageReceived;\nmodule.link(\"../lib/onClientMessageReceived\", {\n  onClientMessageReceived: function (v) {\n    onClientMessageReceived = v;\n  }\n}, 8);\nMeteor.startup(function () {\n  Tracker.autorun(function () {\n    var uid = Meteor.userId();\n    if (!uid) {\n      return;\n    }\n    sdk.stream('notify-user', [uid + \"/otr\"], function (type, data) {\n      if (!data.roomId || !data.userId || data.userId === uid) {\n        return;\n      }\n      var otrRoom = OTR.getInstanceByRoomId(uid, data.roomId);\n      otrRoom === null || otrRoom === void 0 ? void 0 : otrRoom.onUserStream(type, data);\n    });\n  });\n  onClientBeforeSendMessage.use(function () {\n    function _callee(message) {\n      var uid, otrRoom, msg;\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              uid = Meteor.userId();\n              if (uid) {\n                _context.next = 3;\n                break;\n              }\n              return _context.abrupt(\"return\", message);\n            case 3:\n              otrRoom = OTR.getInstanceByRoomId(uid, message.rid);\n              if (!(otrRoom && otrRoom.getState() === OtrRoomState.ESTABLISHED)) {\n                _context.next = 9;\n                break;\n              }\n              _context.next = 7;\n              return _regeneratorRuntime.awrap(otrRoom.encrypt(message));\n            case 7:\n              msg = _context.sent;\n              return _context.abrupt(\"return\", _objectSpread(_objectSpread({}, message), {}, {\n                msg: msg,\n                t: 'otr'\n              }));\n            case 9:\n              return _context.abrupt(\"return\", message);\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n        return _callee$;\n      }(), null, null, null, Promise);\n    }\n    return _callee;\n  }());\n  onClientMessageReceived.use(function () {\n    function _callee2(message) {\n      var uid, otrRoom, decrypted, _id, msg, ack, ts, userId, otrAck, encryptedAck;\n      return _regeneratorRuntime.async(function () {\n        function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              uid = Meteor.userId();\n              if (uid) {\n                _context2.next = 3;\n                break;\n              }\n              return _context2.abrupt(\"return\", message);\n            case 3:\n              if (isOTRMessage(message)) {\n                _context2.next = 5;\n                break;\n              }\n              return _context2.abrupt(\"return\", message);\n            case 5:\n              if (!('notification' in message)) {\n                _context2.next = 7;\n                break;\n              }\n              return _context2.abrupt(\"return\", _objectSpread(_objectSpread({}, message), {}, {\n                msg: t('Encrypted_message')\n              }));\n            case 7:\n              otrRoom = OTR.getInstanceByRoomId(uid, message.rid);\n              if (!(otrRoom && otrRoom.getState() === OtrRoomState.ESTABLISHED)) {\n                _context2.next = 32;\n                break;\n              }\n              _context2.next = 11;\n              return _regeneratorRuntime.awrap(otrRoom.decrypt(message.msg));\n            case 11:\n              decrypted = _context2.sent;\n              if (!(typeof decrypted === 'string')) {\n                _context2.next = 14;\n                break;\n              }\n              return _context2.abrupt(\"return\", _objectSpread(_objectSpread({}, message), {}, {\n                msg: decrypted\n              }));\n            case 14:\n              _id = decrypted._id, msg = decrypted.text, ack = decrypted.ack, ts = decrypted.ts, userId = decrypted.userId;\n              if (ts) message.ts = ts;\n              if (!message.otrAck) {\n                _context2.next = 26;\n                break;\n              }\n              _context2.next = 19;\n              return _regeneratorRuntime.awrap(otrRoom.decrypt(message.otrAck));\n            case 19:\n              otrAck = _context2.sent;\n              if (!(typeof otrAck === 'string')) {\n                _context2.next = 22;\n                break;\n              }\n              return _context2.abrupt(\"return\", _objectSpread(_objectSpread({}, message), {}, {\n                msg: otrAck\n              }));\n            case 22:\n              if (!(ack === otrAck.text)) {\n                _context2.next = 24;\n                break;\n              }\n              return _context2.abrupt(\"return\", _objectSpread(_objectSpread({}, message), {}, {\n                _id: _id,\n                t: 'otr-ack',\n                msg: msg\n              }));\n            case 24:\n              _context2.next = 31;\n              break;\n            case 26:\n              if (!(userId !== Meteor.userId())) {\n                _context2.next = 31;\n                break;\n              }\n              _context2.next = 29;\n              return _regeneratorRuntime.awrap(otrRoom.encryptText(ack));\n            case 29:\n              encryptedAck = _context2.sent;\n              void sdk.call('updateOTRAck', {\n                message: message,\n                ack: encryptedAck\n              });\n            case 31:\n              return _context2.abrupt(\"return\", _objectSpread(_objectSpread({}, message), {}, {\n                _id: _id,\n                msg: msg\n              }));\n            case 32:\n              if (message.t === 'otr') message.msg = '';\n              return _context2.abrupt(\"return\", message);\n            case 34:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n        return _callee2$;\n      }(), null, null, null, Promise);\n    }\n    return _callee2;\n  }());\n});","map":{"version":3,"names":["_regeneratorRuntime","module","link","default","v","_objectSpread","isOTRMessage","Meteor","Tracker","OTR","OtrRoomState","sdk","t","onClientBeforeSendMessage","onClientMessageReceived","startup","autorun","uid","userId","stream","type","data","roomId","otrRoom","getInstanceByRoomId","onUserStream","use","_callee","message","msg","async","_callee$","_context","prev","next","abrupt","rid","getState","ESTABLISHED","awrap","encrypt","sent","stop","Promise","_callee2","decrypted","_id","ack","ts","otrAck","encryptedAck","_callee2$","_context2","decrypt","text","encryptText","call"],"sources":["client/startup/otr.ts"],"sourcesContent":["import { isOTRMessage } from '@rocket.chat/core-typings';\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\n\nimport OTR from '../../app/otr/client/OTR';\nimport { OtrRoomState } from '../../app/otr/lib/OtrRoomState';\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\nimport { t } from '../../app/utils/lib/i18n';\nimport { onClientBeforeSendMessage } from '../lib/onClientBeforeSendMessage';\nimport { onClientMessageReceived } from '../lib/onClientMessageReceived';\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn;\n\t\t}\n\n\t\tsdk.stream('notify-user', [`${uid}/otr`], (type, data) => {\n\t\t\tif (!data.roomId || !data.userId || data.userId === uid) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst otrRoom = OTR.getInstanceByRoomId(uid, data.roomId);\n\t\t\totrRoom?.onUserStream(type, data);\n\t\t});\n\t});\n\n\tonClientBeforeSendMessage.use(async (message) => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn message;\n\t\t}\n\n\t\tconst otrRoom = OTR.getInstanceByRoomId(uid, message.rid);\n\n\t\tif (otrRoom && otrRoom.getState() === OtrRoomState.ESTABLISHED) {\n\t\t\tconst msg = await otrRoom.encrypt(message);\n\t\t\treturn { ...message, msg, t: 'otr' };\n\t\t}\n\t\treturn message;\n\t});\n\n\tonClientMessageReceived.use(async (message) => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn message;\n\t\t}\n\n\t\tif (!isOTRMessage(message)) {\n\t\t\treturn message;\n\t\t}\n\n\t\tif ('notification' in message) {\n\t\t\treturn { ...message, msg: t('Encrypted_message') };\n\t\t}\n\n\t\tconst otrRoom = OTR.getInstanceByRoomId(uid, message.rid);\n\n\t\tif (otrRoom && otrRoom.getState() === OtrRoomState.ESTABLISHED) {\n\t\t\tconst decrypted = await otrRoom.decrypt(message.msg);\n\t\t\tif (typeof decrypted === 'string') {\n\t\t\t\treturn { ...message, msg: decrypted };\n\t\t\t}\n\t\t\tconst { _id, text: msg, ack, ts, userId } = decrypted;\n\n\t\t\tif (ts) message.ts = ts;\n\n\t\t\tif (message.otrAck) {\n\t\t\t\tconst otrAck = await otrRoom.decrypt(message.otrAck);\n\t\t\t\tif (typeof otrAck === 'string') {\n\t\t\t\t\treturn { ...message, msg: otrAck };\n\t\t\t\t}\n\n\t\t\t\tif (ack === otrAck.text) {\n\t\t\t\t\treturn { ...message, _id, t: 'otr-ack', msg };\n\t\t\t\t}\n\t\t\t} else if (userId !== Meteor.userId()) {\n\t\t\t\tconst encryptedAck = await otrRoom.encryptText(ack);\n\n\t\t\t\tvoid sdk.call('updateOTRAck', { message, ack: encryptedAck });\n\t\t\t}\n\n\t\t\treturn { ...message, _id, msg };\n\t\t}\n\t\tif (message.t === 'otr') message.msg = '';\n\n\t\treturn message;\n\t});\n});\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"7696df826824916cb085c710258863ad7dc84ead"}
