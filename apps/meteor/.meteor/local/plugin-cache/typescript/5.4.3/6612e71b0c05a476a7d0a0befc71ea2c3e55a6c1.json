{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx","inputSourceMap":{"version":3,"file":"client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx","sourceRoot":"","sources":["client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage, IRoom } from '@rocket.chat/core-typings';\nimport { css } from '@rocket.chat/css-in-js';\nimport { Box, ButtonGroup, Button, Icon, PositionAnimated } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useTranslation, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport type { AllHTMLAttributes, RefObject } from 'react';\nimport React, { useRef, useEffect, useState } from 'react';\n\nimport { UserAction, USER_ACTIVITIES } from '../../../../app/ui/client/lib/UserAction';\nimport { VideoRecorder } from '../../../../app/ui/client/lib/recorderjs/videoRecorder';\nimport type { ChatAPI } from '../../../lib/chats/ChatAPI';\nimport { useChat } from '../../room/contexts/ChatContext';\n\ntype VideoMessageRecorderProps = {\n\trid: IRoom['_id'];\n\ttmid?: IMessage['_id'];\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n\treference: RefObject<HTMLElement>;\n} & Omit<AllHTMLAttributes<HTMLDivElement>, 'is'>;\n\nconst videoContainerClass = css`\n\ttransform: scaleX(-1);\n\tfilter: FlipH;\n\n\t@media (max-width: 500px) {\n\t\t& > video {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t}\n\t}\n`;\n\nconst getVideoRecordingExtension = () => {\n\tconst supported = VideoRecorder.getSupportedMimeTypes();\n\tif (supported.match(/video\\/webm/)) {\n\t\treturn 'webm';\n\t}\n\treturn 'mp4';\n};\n\nconst VideoMessageRecorder = ({ rid, tmid, chatContext, reference }: VideoMessageRecorderProps) => {\n\tconst t = useTranslation();\n\tconst videoRef = useRef<HTMLVideoElement>(null);\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst [time, setTime] = useState<string | undefined>();\n\tconst [recordingState, setRecordingState] = useState<'idle' | 'loading' | 'recording'>('idle');\n\tconst [recordingInterval, setRecordingInterval] = useState<ReturnType<typeof setInterval> | null>(null);\n\tconst isRecording = recordingState === 'recording';\n\tconst sendButtonDisabled = !(VideoRecorder.cameraStarted.get() && !(recordingState === 'recording'));\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst stopVideoRecording = async (rid: IRoom['_id'], tmid?: IMessage['_id']) => {\n\t\tif (recordingInterval) {\n\t\t\tclearInterval(recordingInterval);\n\t\t}\n\t\tsetRecordingInterval(null);\n\t\tVideoRecorder.stopRecording();\n\t\tUserAction.stop(rid, USER_ACTIVITIES.USER_RECORDING, { tmid });\n\t\tsetRecordingState('idle');\n\t};\n\n\tconst handleRecord = async () => {\n\t\tif (recordingState === 'recording') {\n\t\t\tstopVideoRecording(rid, tmid);\n\t\t} else {\n\t\t\tVideoRecorder.record();\n\t\t\tsetRecordingState('recording');\n\t\t\tUserAction.performContinuously(rid, USER_ACTIVITIES.USER_RECORDING, { tmid });\n\t\t\tsetTime('00:00');\n\t\t\tconst startTime = new Date();\n\t\t\tsetRecordingInterval(\n\t\t\t\tsetInterval(() => {\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tconst distance = (now.getTime() - startTime.getTime()) / 1000;\n\t\t\t\t\tconst minutes = Math.floor(distance / 60);\n\t\t\t\t\tconst seconds = Math.floor(distance % 60);\n\t\t\t\t\tsetTime(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);\n\t\t\t\t}, 1000),\n\t\t\t);\n\t\t}\n\t};\n\n\tconst handleSendRecord = async () => {\n\t\tconst cb = async (blob: Blob) => {\n\t\t\tconst fileName = `${t('Video_record')}.${getVideoRecordingExtension()}`;\n\t\t\tconst file = new File([blob], fileName, { type: VideoRecorder.getSupportedMimeTypes().split(';')[0] });\n\t\t\tawait chat?.flows.uploadFiles([file]);\n\t\t\tchat?.composer?.setRecordingVideo(false);\n\t\t};\n\n\t\tVideoRecorder.stop(cb);\n\t\tsetTime(undefined);\n\t\tstopVideoRecording(rid, tmid);\n\t};\n\n\tconst handleCancel = useMutableCallback(() => {\n\t\tVideoRecorder.stop();\n\t\tchat?.composer?.setRecordingVideo(false);\n\t\tsetTime(undefined);\n\t\tstopVideoRecording(rid, tmid);\n\t});\n\n\tuseEffect(() => {\n\t\tif (!VideoRecorder.getSupportedMimeTypes()) {\n\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Browser_does_not_support_recording_video') });\n\t\t}\n\n\t\tVideoRecorder.start(videoRef.current ?? undefined, (success) => (!success ? handleCancel() : undefined));\n\n\t\treturn () => {\n\t\t\tVideoRecorder.stop();\n\t\t};\n\t}, [dispatchToastMessage, handleCancel, t]);\n\n\treturn (\n\t\t<PositionAnimated visible='visible' anchor={reference} placement='top-end'>\n\t\t\t<Box bg='light' padding={4} borderRadius={4} elevation='2'>\n\t\t\t\t<Box className={videoContainerClass} overflow='hidden' height={240} borderRadius={4}>\n\t\t\t\t\t<video muted autoPlay playsInline ref={videoRef} width={320} height={240} />\n\t\t\t\t</Box>\n\t\t\t\t<Box mbs={4} display='flex' justifyContent='space-between'>\n\t\t\t\t\t<Button small onClick={handleRecord}>\n\t\t\t\t\t\t<Box is='span' display='flex' alignItems='center'>\n\t\t\t\t\t\t\t<Icon size='x16' mie={time ? 4 : undefined} name={isRecording ? 'stop-unfilled' : 'rec'} />\n\t\t\t\t\t\t\t{time && <span>{time}</span>}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Button>\n\t\t\t\t\t<ButtonGroup>\n\t\t\t\t\t\t<Button small onClick={handleCancel}>\n\t\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button primary small disabled={sendButtonDisabled} onClick={handleSendRecord}>\n\t\t\t\t\t\t\t{t('Send')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Box>\n\t\t\t</Box>\n\t\t</PositionAnimated>\n\t);\n};\n\nexport default VideoMessageRecorder;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx","inputSourceMap":{"version":3,"file":"client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx","sourceRoot":"","sources":["client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IMessage, IRoom } from '@rocket.chat/core-typings';\nimport { css } from '@rocket.chat/css-in-js';\nimport { Box, ButtonGroup, Button, Icon, PositionAnimated } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useTranslation, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport type { AllHTMLAttributes, RefObject } from 'react';\nimport React, { useRef, useEffect, useState } from 'react';\n\nimport { UserAction, USER_ACTIVITIES } from '../../../../app/ui/client/lib/UserAction';\nimport { VideoRecorder } from '../../../../app/ui/client/lib/recorderjs/videoRecorder';\nimport type { ChatAPI } from '../../../lib/chats/ChatAPI';\nimport { useChat } from '../../room/contexts/ChatContext';\n\ntype VideoMessageRecorderProps = {\n\trid: IRoom['_id'];\n\ttmid?: IMessage['_id'];\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n\treference: RefObject<HTMLElement>;\n} & Omit<AllHTMLAttributes<HTMLDivElement>, 'is'>;\n\nconst videoContainerClass = css`\n\ttransform: scaleX(-1);\n\tfilter: FlipH;\n\n\t@media (max-width: 500px) {\n\t\t& > video {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t}\n\t}\n`;\n\nconst getVideoRecordingExtension = () => {\n\tconst supported = VideoRecorder.getSupportedMimeTypes();\n\tif (supported.match(/video\\/webm/)) {\n\t\treturn 'webm';\n\t}\n\treturn 'mp4';\n};\n\nconst VideoMessageRecorder = ({ rid, tmid, chatContext, reference }: VideoMessageRecorderProps) => {\n\tconst t = useTranslation();\n\tconst videoRef = useRef<HTMLVideoElement>(null);\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst [time, setTime] = useState<string | undefined>();\n\tconst [recordingState, setRecordingState] = useState<'idle' | 'loading' | 'recording'>('idle');\n\tconst [recordingInterval, setRecordingInterval] = useState<ReturnType<typeof setInterval> | null>(null);\n\tconst isRecording = recordingState === 'recording';\n\tconst sendButtonDisabled = !(VideoRecorder.cameraStarted.get() && !(recordingState === 'recording'));\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst stopVideoRecording = async (rid: IRoom['_id'], tmid?: IMessage['_id']) => {\n\t\tif (recordingInterval) {\n\t\t\tclearInterval(recordingInterval);\n\t\t}\n\t\tsetRecordingInterval(null);\n\t\tVideoRecorder.stopRecording();\n\t\tUserAction.stop(rid, USER_ACTIVITIES.USER_RECORDING, { tmid });\n\t\tsetRecordingState('idle');\n\t};\n\n\tconst handleRecord = async () => {\n\t\tif (recordingState === 'recording') {\n\t\t\tstopVideoRecording(rid, tmid);\n\t\t} else {\n\t\t\tVideoRecorder.record();\n\t\t\tsetRecordingState('recording');\n\t\t\tUserAction.performContinuously(rid, USER_ACTIVITIES.USER_RECORDING, { tmid });\n\t\t\tsetTime('00:00');\n\t\t\tconst startTime = new Date();\n\t\t\tsetRecordingInterval(\n\t\t\t\tsetInterval(() => {\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tconst distance = (now.getTime() - startTime.getTime()) / 1000;\n\t\t\t\t\tconst minutes = Math.floor(distance / 60);\n\t\t\t\t\tconst seconds = Math.floor(distance % 60);\n\t\t\t\t\tsetTime(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);\n\t\t\t\t}, 1000),\n\t\t\t);\n\t\t}\n\t};\n\n\tconst handleSendRecord = async () => {\n\t\tconst cb = async (blob: Blob) => {\n\t\t\tconst fileName = `${t('Video_record')}.${getVideoRecordingExtension()}`;\n\t\t\tconst file = new File([blob], fileName, { type: VideoRecorder.getSupportedMimeTypes().split(';')[0] });\n\t\t\tawait chat?.flows.uploadFiles([file]);\n\t\t\tchat?.composer?.setRecordingVideo(false);\n\t\t};\n\n\t\tVideoRecorder.stop(cb);\n\t\tsetTime(undefined);\n\t\tstopVideoRecording(rid, tmid);\n\t};\n\n\tconst handleCancel = useMutableCallback(() => {\n\t\tVideoRecorder.stop();\n\t\tchat?.composer?.setRecordingVideo(false);\n\t\tsetTime(undefined);\n\t\tstopVideoRecording(rid, tmid);\n\t});\n\n\tuseEffect(() => {\n\t\tif (!VideoRecorder.getSupportedMimeTypes()) {\n\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Browser_does_not_support_recording_video') });\n\t\t}\n\n\t\tVideoRecorder.start(videoRef.current ?? undefined, (success) => (!success ? handleCancel() : undefined));\n\n\t\treturn () => {\n\t\t\tVideoRecorder.stop();\n\t\t};\n\t}, [dispatchToastMessage, handleCancel, t]);\n\n\treturn (\n\t\t<PositionAnimated visible='visible' anchor={reference} placement='top-end'>\n\t\t\t<Box bg='light' padding={4} borderRadius={4} elevation='2'>\n\t\t\t\t<Box className={videoContainerClass} overflow='hidden' height={240} borderRadius={4}>\n\t\t\t\t\t<video muted autoPlay playsInline ref={videoRef} width={320} height={240} />\n\t\t\t\t</Box>\n\t\t\t\t<Box mbs={4} display='flex' justifyContent='space-between'>\n\t\t\t\t\t<Button small onClick={handleRecord}>\n\t\t\t\t\t\t<Box is='span' display='flex' alignItems='center'>\n\t\t\t\t\t\t\t<Icon size='x16' mie={time ? 4 : undefined} name={isRecording ? 'stop-unfilled' : 'rec'} />\n\t\t\t\t\t\t\t{time && <span>{time}</span>}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Button>\n\t\t\t\t\t<ButtonGroup>\n\t\t\t\t\t\t<Button small onClick={handleCancel}>\n\t\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button primary small disabled={sendButtonDisabled} onClick={handleSendRecord}>\n\t\t\t\t\t\t\t{t('Send')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Box>\n\t\t\t</Box>\n\t\t</PositionAnimated>\n\t);\n};\n\nexport default VideoMessageRecorder;\n"]}}},"code":"var _templateObject;\nvar _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nvar _slicedToArray;\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 1);\nvar _taggedTemplateLiteralLoose;\nmodule.link(\"@babel/runtime/helpers/taggedTemplateLiteralLoose\", {\n  default: function (v) {\n    _taggedTemplateLiteralLoose = v;\n  }\n}, 2);\nvar css;\nmodule.link(\"@rocket.chat/css-in-js\", {\n  css: function (v) {\n    css = v;\n  }\n}, 0);\nvar Box, ButtonGroup, Button, Icon, PositionAnimated;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Box: function (v) {\n    Box = v;\n  },\n  ButtonGroup: function (v) {\n    ButtonGroup = v;\n  },\n  Button: function (v) {\n    Button = v;\n  },\n  Icon: function (v) {\n    Icon = v;\n  },\n  PositionAnimated: function (v) {\n    PositionAnimated = v;\n  }\n}, 1);\nvar useMutableCallback;\nmodule.link(\"@rocket.chat/fuselage-hooks\", {\n  useMutableCallback: function (v) {\n    useMutableCallback = v;\n  }\n}, 2);\nvar useTranslation, useToastMessageDispatch;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useTranslation: function (v) {\n    useTranslation = v;\n  },\n  useToastMessageDispatch: function (v) {\n    useToastMessageDispatch = v;\n  }\n}, 3);\nvar React, useRef, useEffect, useState;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useRef: function (v) {\n    useRef = v;\n  },\n  useEffect: function (v) {\n    useEffect = v;\n  },\n  useState: function (v) {\n    useState = v;\n  }\n}, 4);\nvar UserAction, USER_ACTIVITIES;\nmodule.link(\"../../../../app/ui/client/lib/UserAction\", {\n  UserAction: function (v) {\n    UserAction = v;\n  },\n  USER_ACTIVITIES: function (v) {\n    USER_ACTIVITIES = v;\n  }\n}, 5);\nvar VideoRecorder;\nmodule.link(\"../../../../app/ui/client/lib/recorderjs/videoRecorder\", {\n  VideoRecorder: function (v) {\n    VideoRecorder = v;\n  }\n}, 6);\nvar useChat;\nmodule.link(\"../../room/contexts/ChatContext\", {\n  useChat: function (v) {\n    useChat = v;\n  }\n}, 7);\nvar videoContainerClass = css(_templateObject || (_templateObject = _taggedTemplateLiteralLoose([\"\\n\\ttransform: scaleX(-1);\\n\\tfilter: FlipH;\\n\\n\\t@media (max-width: 500px) {\\n\\t\\t& > video {\\n\\t\\t\\twidth: 100%;\\n\\t\\t\\theight: 100%;\\n\\t\\t}\\n\\t}\\n\"])));\nvar getVideoRecordingExtension = function () {\n  var supported = VideoRecorder.getSupportedMimeTypes();\n  if (supported.match(/video\\/webm/)) {\n    return 'webm';\n  }\n  return 'mp4';\n};\nvar VideoMessageRecorder = function (_ref) {\n  var _useChat;\n  var rid = _ref.rid,\n    tmid = _ref.tmid,\n    chatContext = _ref.chatContext,\n    reference = _ref.reference;\n  var t = useTranslation();\n  var videoRef = useRef(null);\n  var dispatchToastMessage = useToastMessageDispatch();\n  var _useState = useState(),\n    _useState2 = _slicedToArray(_useState, 2),\n    time = _useState2[0],\n    setTime = _useState2[1];\n  var _useState3 = useState('idle'),\n    _useState4 = _slicedToArray(_useState3, 2),\n    recordingState = _useState4[0],\n    setRecordingState = _useState4[1];\n  var _useState5 = useState(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    recordingInterval = _useState6[0],\n    setRecordingInterval = _useState6[1];\n  var isRecording = recordingState === 'recording';\n  var sendButtonDisabled = !(VideoRecorder.cameraStarted.get() && !(recordingState === 'recording'));\n  var chat = (_useChat = useChat()) !== null && _useChat !== void 0 ? _useChat : chatContext;\n  var stopVideoRecording = function () {\n    function _callee(rid, tmid) {\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (recordingInterval) {\n                clearInterval(recordingInterval);\n              }\n              setRecordingInterval(null);\n              VideoRecorder.stopRecording();\n              UserAction.stop(rid, USER_ACTIVITIES.USER_RECORDING, {\n                tmid: tmid\n              });\n              setRecordingState('idle');\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n        return _callee$;\n      }(), null, null, null, Promise);\n    }\n    return _callee;\n  }();\n  var handleRecord = function () {\n    function _callee2() {\n      var startTime;\n      return _regeneratorRuntime.async(function () {\n        function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (recordingState === 'recording') {\n                stopVideoRecording(rid, tmid);\n              } else {\n                VideoRecorder.record();\n                setRecordingState('recording');\n                UserAction.performContinuously(rid, USER_ACTIVITIES.USER_RECORDING, {\n                  tmid: tmid\n                });\n                setTime('00:00');\n                startTime = new Date();\n                setRecordingInterval(setInterval(function () {\n                  var now = new Date();\n                  var distance = (now.getTime() - startTime.getTime()) / 1000;\n                  var minutes = Math.floor(distance / 60);\n                  var seconds = Math.floor(distance % 60);\n                  setTime(String(minutes).padStart(2, '0') + \":\" + String(seconds).padStart(2, '0'));\n                }, 1000));\n              }\n            case 1:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n        return _callee2$;\n      }(), null, null, null, Promise);\n    }\n    return _callee2;\n  }();\n  var handleSendRecord = function () {\n    function _callee4() {\n      var cb;\n      return _regeneratorRuntime.async(function () {\n        function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              cb = function () {\n                function _callee3(blob) {\n                  var _chat$composer;\n                  var fileName, file;\n                  return _regeneratorRuntime.async(function () {\n                    function _callee3$(_context3) {\n                      while (1) switch (_context3.prev = _context3.next) {\n                        case 0:\n                          fileName = t('Video_record') + \".\" + getVideoRecordingExtension();\n                          file = new File([blob], fileName, {\n                            type: VideoRecorder.getSupportedMimeTypes().split(';')[0]\n                          });\n                          _context3.next = 4;\n                          return _regeneratorRuntime.awrap(chat === null || chat === void 0 ? void 0 : chat.flows.uploadFiles([file]));\n                        case 4:\n                          chat === null || chat === void 0 ? void 0 : (_chat$composer = chat.composer) === null || _chat$composer === void 0 ? void 0 : _chat$composer.setRecordingVideo(false);\n                        case 5:\n                        case \"end\":\n                          return _context3.stop();\n                      }\n                    }\n                    return _callee3$;\n                  }(), null, null, null, Promise);\n                }\n                return _callee3;\n              }();\n              VideoRecorder.stop(cb);\n              setTime(undefined);\n              stopVideoRecording(rid, tmid);\n            case 4:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n        return _callee4$;\n      }(), null, null, null, Promise);\n    }\n    return _callee4;\n  }();\n  var handleCancel = useMutableCallback(function () {\n    var _chat$composer2;\n    VideoRecorder.stop();\n    chat === null || chat === void 0 ? void 0 : (_chat$composer2 = chat.composer) === null || _chat$composer2 === void 0 ? void 0 : _chat$composer2.setRecordingVideo(false);\n    setTime(undefined);\n    stopVideoRecording(rid, tmid);\n  });\n  useEffect(function () {\n    var _videoRef$current;\n    if (!VideoRecorder.getSupportedMimeTypes()) {\n      return dispatchToastMessage({\n        type: 'error',\n        message: t('Browser_does_not_support_recording_video')\n      });\n    }\n    VideoRecorder.start((_videoRef$current = videoRef.current) !== null && _videoRef$current !== void 0 ? _videoRef$current : undefined, function (success) {\n      return !success ? handleCancel() : undefined;\n    });\n    return function () {\n      VideoRecorder.stop();\n    };\n  }, [dispatchToastMessage, handleCancel, t]);\n  return /*#__PURE__*/React.createElement(PositionAnimated, {\n    visible: \"visible\",\n    anchor: reference,\n    placement: \"top-end\"\n  }, /*#__PURE__*/React.createElement(Box, {\n    bg: \"light\",\n    padding: 4,\n    borderRadius: 4,\n    elevation: \"2\"\n  }, /*#__PURE__*/React.createElement(Box, {\n    className: videoContainerClass,\n    overflow: \"hidden\",\n    height: 240,\n    borderRadius: 4\n  }, /*#__PURE__*/React.createElement(\"video\", {\n    muted: true,\n    autoPlay: true,\n    playsInline: true,\n    ref: videoRef,\n    width: 320,\n    height: 240\n  })), /*#__PURE__*/React.createElement(Box, {\n    mbs: 4,\n    display: \"flex\",\n    justifyContent: \"space-between\"\n  }, /*#__PURE__*/React.createElement(Button, {\n    small: true,\n    onClick: handleRecord\n  }, /*#__PURE__*/React.createElement(Box, {\n    is: \"span\",\n    display: \"flex\",\n    alignItems: \"center\"\n  }, /*#__PURE__*/React.createElement(Icon, {\n    size: \"x16\",\n    mie: time ? 4 : undefined,\n    name: isRecording ? 'stop-unfilled' : 'rec'\n  }), time && /*#__PURE__*/React.createElement(\"span\", null, time))), /*#__PURE__*/React.createElement(ButtonGroup, null, /*#__PURE__*/React.createElement(Button, {\n    small: true,\n    onClick: handleCancel\n  }, t('Cancel')), /*#__PURE__*/React.createElement(Button, {\n    primary: true,\n    small: true,\n    disabled: sendButtonDisabled,\n    onClick: handleSendRecord\n  }, t('Send'))))));\n};\nmodule.exportDefault(VideoMessageRecorder);","map":{"version":3,"names":["_regeneratorRuntime","module","link","default","v","_slicedToArray","_taggedTemplateLiteralLoose","css","Box","ButtonGroup","Button","Icon","PositionAnimated","useMutableCallback","useTranslation","useToastMessageDispatch","React","useRef","useEffect","useState","UserAction","USER_ACTIVITIES","VideoRecorder","useChat","videoContainerClass","_templateObject","getVideoRecordingExtension","supported","getSupportedMimeTypes","match","VideoMessageRecorder","_ref","_useChat","rid","tmid","chatContext","reference","t","videoRef","dispatchToastMessage","_useState","_useState2","time","setTime","_useState3","_useState4","recordingState","setRecordingState","_useState5","_useState6","recordingInterval","setRecordingInterval","isRecording","sendButtonDisabled","cameraStarted","get","chat","stopVideoRecording","_callee","async","_callee$","_context","prev","next","clearInterval","stopRecording","stop","USER_RECORDING","Promise","handleRecord","_callee2","startTime","_callee2$","_context2","record","performContinuously","Date","setInterval","now","distance","getTime","minutes","Math","floor","seconds","String","padStart","handleSendRecord","_callee4","cb","_callee4$","_context4","_callee3","blob","_chat$composer","fileName","file","_callee3$","_context3","File","type","split","awrap","flows","uploadFiles","composer","setRecordingVideo","undefined","handleCancel","_chat$composer2","_videoRef$current","message","start","current","success","createElement","visible","anchor","placement","bg","padding","borderRadius","elevation","className","overflow","height","muted","autoPlay","playsInline","ref","width","mbs","display","justifyContent","small","onClick","is","alignItems","size","mie","name","primary","disabled","exportDefault"],"sources":["client/views/composer/VideoMessageRecorder/VideoMessageRecorder.tsx"],"sourcesContent":["import type { IMessage, IRoom } from '@rocket.chat/core-typings';\nimport { css } from '@rocket.chat/css-in-js';\nimport { Box, ButtonGroup, Button, Icon, PositionAnimated } from '@rocket.chat/fuselage';\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\nimport { useTranslation, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\nimport type { AllHTMLAttributes, RefObject } from 'react';\nimport React, { useRef, useEffect, useState } from 'react';\n\nimport { UserAction, USER_ACTIVITIES } from '../../../../app/ui/client/lib/UserAction';\nimport { VideoRecorder } from '../../../../app/ui/client/lib/recorderjs/videoRecorder';\nimport type { ChatAPI } from '../../../lib/chats/ChatAPI';\nimport { useChat } from '../../room/contexts/ChatContext';\n\ntype VideoMessageRecorderProps = {\n\trid: IRoom['_id'];\n\ttmid?: IMessage['_id'];\n\tchatContext?: ChatAPI; // TODO: remove this when the composer is migrated to React\n\treference: RefObject<HTMLElement>;\n} & Omit<AllHTMLAttributes<HTMLDivElement>, 'is'>;\n\nconst videoContainerClass = css`\n\ttransform: scaleX(-1);\n\tfilter: FlipH;\n\n\t@media (max-width: 500px) {\n\t\t& > video {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t}\n\t}\n`;\n\nconst getVideoRecordingExtension = () => {\n\tconst supported = VideoRecorder.getSupportedMimeTypes();\n\tif (supported.match(/video\\/webm/)) {\n\t\treturn 'webm';\n\t}\n\treturn 'mp4';\n};\n\nconst VideoMessageRecorder = ({ rid, tmid, chatContext, reference }: VideoMessageRecorderProps) => {\n\tconst t = useTranslation();\n\tconst videoRef = useRef<HTMLVideoElement>(null);\n\tconst dispatchToastMessage = useToastMessageDispatch();\n\n\tconst [time, setTime] = useState<string | undefined>();\n\tconst [recordingState, setRecordingState] = useState<'idle' | 'loading' | 'recording'>('idle');\n\tconst [recordingInterval, setRecordingInterval] = useState<ReturnType<typeof setInterval> | null>(null);\n\tconst isRecording = recordingState === 'recording';\n\tconst sendButtonDisabled = !(VideoRecorder.cameraStarted.get() && !(recordingState === 'recording'));\n\n\tconst chat = useChat() ?? chatContext;\n\n\tconst stopVideoRecording = async (rid: IRoom['_id'], tmid?: IMessage['_id']) => {\n\t\tif (recordingInterval) {\n\t\t\tclearInterval(recordingInterval);\n\t\t}\n\t\tsetRecordingInterval(null);\n\t\tVideoRecorder.stopRecording();\n\t\tUserAction.stop(rid, USER_ACTIVITIES.USER_RECORDING, { tmid });\n\t\tsetRecordingState('idle');\n\t};\n\n\tconst handleRecord = async () => {\n\t\tif (recordingState === 'recording') {\n\t\t\tstopVideoRecording(rid, tmid);\n\t\t} else {\n\t\t\tVideoRecorder.record();\n\t\t\tsetRecordingState('recording');\n\t\t\tUserAction.performContinuously(rid, USER_ACTIVITIES.USER_RECORDING, { tmid });\n\t\t\tsetTime('00:00');\n\t\t\tconst startTime = new Date();\n\t\t\tsetRecordingInterval(\n\t\t\t\tsetInterval(() => {\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tconst distance = (now.getTime() - startTime.getTime()) / 1000;\n\t\t\t\t\tconst minutes = Math.floor(distance / 60);\n\t\t\t\t\tconst seconds = Math.floor(distance % 60);\n\t\t\t\t\tsetTime(`${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`);\n\t\t\t\t}, 1000),\n\t\t\t);\n\t\t}\n\t};\n\n\tconst handleSendRecord = async () => {\n\t\tconst cb = async (blob: Blob) => {\n\t\t\tconst fileName = `${t('Video_record')}.${getVideoRecordingExtension()}`;\n\t\t\tconst file = new File([blob], fileName, { type: VideoRecorder.getSupportedMimeTypes().split(';')[0] });\n\t\t\tawait chat?.flows.uploadFiles([file]);\n\t\t\tchat?.composer?.setRecordingVideo(false);\n\t\t};\n\n\t\tVideoRecorder.stop(cb);\n\t\tsetTime(undefined);\n\t\tstopVideoRecording(rid, tmid);\n\t};\n\n\tconst handleCancel = useMutableCallback(() => {\n\t\tVideoRecorder.stop();\n\t\tchat?.composer?.setRecordingVideo(false);\n\t\tsetTime(undefined);\n\t\tstopVideoRecording(rid, tmid);\n\t});\n\n\tuseEffect(() => {\n\t\tif (!VideoRecorder.getSupportedMimeTypes()) {\n\t\t\treturn dispatchToastMessage({ type: 'error', message: t('Browser_does_not_support_recording_video') });\n\t\t}\n\n\t\tVideoRecorder.start(videoRef.current ?? undefined, (success) => (!success ? handleCancel() : undefined));\n\n\t\treturn () => {\n\t\t\tVideoRecorder.stop();\n\t\t};\n\t}, [dispatchToastMessage, handleCancel, t]);\n\n\treturn (\n\t\t<PositionAnimated visible='visible' anchor={reference} placement='top-end'>\n\t\t\t<Box bg='light' padding={4} borderRadius={4} elevation='2'>\n\t\t\t\t<Box className={videoContainerClass} overflow='hidden' height={240} borderRadius={4}>\n\t\t\t\t\t<video muted autoPlay playsInline ref={videoRef} width={320} height={240} />\n\t\t\t\t</Box>\n\t\t\t\t<Box mbs={4} display='flex' justifyContent='space-between'>\n\t\t\t\t\t<Button small onClick={handleRecord}>\n\t\t\t\t\t\t<Box is='span' display='flex' alignItems='center'>\n\t\t\t\t\t\t\t<Icon size='x16' mie={time ? 4 : undefined} name={isRecording ? 'stop-unfilled' : 'rec'} />\n\t\t\t\t\t\t\t{time && <span>{time}</span>}\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t</Button>\n\t\t\t\t\t<ButtonGroup>\n\t\t\t\t\t\t<Button small onClick={handleCancel}>\n\t\t\t\t\t\t\t{t('Cancel')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button primary small disabled={sendButtonDisabled} onClick={handleSendRecord}>\n\t\t\t\t\t\t\t{t('Send')}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</ButtonGroup>\n\t\t\t\t</Box>\n\t\t\t</Box>\n\t\t</PositionAnimated>\n\t);\n};\n\nexport default VideoMessageRecorder;\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"6612e71b0c05a476a7d0a0befc71ea2c3e55a6c1"}
