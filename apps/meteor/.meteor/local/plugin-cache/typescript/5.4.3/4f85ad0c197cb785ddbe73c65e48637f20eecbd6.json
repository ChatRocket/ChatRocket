{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/rooms/roomCoordinator.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"client/lib/rooms/roomCoordinator.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/rooms/roomCoordinator.tsx","inputSourceMap":{"version":3,"file":"client/lib/rooms/roomCoordinator.tsx","sourceRoot":"","sources":["client/lib/rooms/roomCoordinator.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom, RoomType, IUser, AtLeast, ValueOf, ISubscription } from '@rocket.chat/core-typings';\nimport { isRoomFederated } from '@rocket.chat/core-typings';\nimport type { RouteName } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\nimport React from 'react';\n\nimport { hasPermission } from '../../../app/authorization/client';\nimport { ChatRoom, ChatSubscription } from '../../../app/models/client';\nimport { settings } from '../../../app/settings/client';\nimport type {\n\tRoomSettingsEnum,\n\tRoomMemberActions,\n\tUiTextContext,\n\tIRoomTypeClientDirectives,\n\tRoomIdentification,\n\tIRoomTypeRouteConfig,\n\tIRoomTypeClientConfig,\n} from '../../../definition/IRoomTypeConfig';\nimport { RoomCoordinator } from '../../../lib/rooms/coordinator';\nimport { router } from '../../providers/RouterProvider';\nimport RoomRoute from '../../views/room/RoomRoute';\nimport MainLayout from '../../views/root/MainLayout';\nimport { appLayout } from '../appLayout';\n\nclass RoomCoordinatorClient extends RoomCoordinator {\n\tpublic add(roomConfig: IRoomTypeClientConfig, directives: Partial<IRoomTypeClientDirectives>): void {\n\t\tthis.addRoomType(roomConfig, {\n\t\t\tallowRoomSettingChange(_room: Partial<IRoom>, _setting: ValueOf<typeof RoomSettingsEnum>): boolean {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tallowMemberAction(\n\t\t\t\t_room: Partial<IRoom>,\n\t\t\t\t_action: ValueOf<typeof RoomMemberActions>,\n\t\t\t\t_showingUserId: IUser['_id'],\n\t\t\t\t_userSubscription?: ISubscription,\n\t\t\t): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\troomName(_room: AtLeast<IRoom, '_id' | 'name' | 'fname' | 'prid'>): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tisGroupChat(_room: Partial<IRoom>): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tgetUiText(_context: ValueOf<typeof UiTextContext>): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tcondition(): boolean {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tgetAvatarPath(_room): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tfindRoom(_identifier: string): IRoom | undefined {\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tshowJoinLink(_roomId: string): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tisLivechatRoom(): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tcanSendMessage(rid: string): boolean {\n\t\t\t\treturn ChatSubscription.find({ rid }).count() > 0;\n\t\t\t},\n\t\t\t...directives,\n\t\t\tconfig: roomConfig,\n\t\t});\n\t}\n\n\tpublic getRoomDirectives(roomType: string): IRoomTypeClientDirectives {\n\t\treturn this.roomTypes[roomType].directives as IRoomTypeClientDirectives;\n\t}\n\n\tpublic openRouteLink(\n\t\troomType: RoomType,\n\t\tsubData: RoomIdentification,\n\t\tqueryParams?: Record<string, string>,\n\t\toptions: { replace?: boolean } = {},\n\t): void {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet routeData = {};\n\t\tif (config.route.link) {\n\t\t\trouteData = config.route.link(subData);\n\t\t} else if (subData?.name) {\n\t\t\trouteData = {\n\t\t\t\tname: subData.name,\n\t\t\t};\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\trouter.navigate(\n\t\t\t{\n\t\t\t\tpattern: config.route.path ?? '/home',\n\t\t\t\tparams: routeData,\n\t\t\t\tsearch: queryParams,\n\t\t\t},\n\t\t\toptions,\n\t\t);\n\t}\n\n\tpublic isLivechatRoom(roomType: string): boolean {\n\t\treturn Boolean(this.getRoomDirectives(roomType).isLivechatRoom());\n\t}\n\n\tpublic getRoomName(roomType: string, roomData: AtLeast<IRoom, '_id' | 'name' | 'fname' | 'prid'>): string {\n\t\treturn this.getRoomDirectives(roomType).roomName(roomData) ?? '';\n\t}\n\n\tpublic readOnly(rid: string, user: AtLeast<IUser, 'username'>): boolean {\n\t\tconst fields = {\n\t\t\tro: 1,\n\t\t\tt: 1,\n\t\t\t...(user && { muted: 1, unmuted: 1 }),\n\t\t};\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields });\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst directives = this.getRoomDirectives(room.t);\n\t\tif (directives?.readOnly) {\n\t\t\treturn directives.readOnly(rid, user);\n\t\t}\n\n\t\tif (!user?.username) {\n\t\t\treturn Boolean(room.ro);\n\t\t}\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Array.isArray(room.muted) && room.muted.indexOf(user.username) !== -1) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (room.ro) {\n\t\t\tif (Array.isArray(room.unmuted) && room.unmuted.indexOf(user.username) !== -1) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (hasPermission('post-readonly', room._id)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t// #ToDo: Move this out of the RoomCoordinator\n\tpublic archived(rid: string): boolean {\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { archived: 1 } });\n\t\treturn Boolean(room?.archived);\n\t}\n\n\tpublic verifyCanSendMessage(rid: string): boolean {\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { t: 1, federated: 1 } });\n\t\tif (!room?.t) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!this.getRoomDirectives(room.t).canSendMessage(rid)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (isRoomFederated(room)) {\n\t\t\treturn settings.get('Federation_Matrix_enabled');\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate validateRoute<TRouteName extends RouteName>(route: IRoomTypeRouteConfig<TRouteName>): void {\n\t\tconst { name, path, link } = route;\n\n\t\tif (typeof name !== 'string' || name.length === 0) {\n\t\t\tthrow new Error('The route name must be a string.');\n\t\t}\n\n\t\tif (path !== undefined && (typeof path !== 'string' || path.length === 0)) {\n\t\t\tthrow new Error('The route path must be a string.');\n\t\t}\n\n\t\tif (!['undefined', 'function'].includes(typeof link)) {\n\t\t\tthrow new Error('The route link must be a function.');\n\t\t}\n\t}\n\n\tprotected validateRoomConfig(roomConfig: IRoomTypeClientConfig): void {\n\t\tsuper.validateRoomConfig(roomConfig);\n\n\t\tconst { route, label } = roomConfig;\n\n\t\tif (route !== undefined) {\n\t\t\tthis.validateRoute(route);\n\t\t}\n\n\t\tif (label !== undefined && (typeof label !== 'string' || label.length === 0)) {\n\t\t\tthrow new Error('The label must be a string.');\n\t\t}\n\t}\n\n\tprotected addRoomType(roomConfig: IRoomTypeClientConfig, directives: IRoomTypeClientDirectives): void {\n\t\tsuper.addRoomType(roomConfig, directives);\n\n\t\tif (roomConfig.route?.path && roomConfig.route.name && directives.extractOpenRoomParams) {\n\t\t\tconst {\n\t\t\t\troute: { name, path },\n\t\t\t} = roomConfig;\n\t\t\tconst { extractOpenRoomParams } = directives;\n\t\t\trouter.defineRoutes([\n\t\t\t\t{\n\t\t\t\t\tpath,\n\t\t\t\t\tid: name,\n\t\t\t\t\telement: appLayout.wrap(\n\t\t\t\t\t\t<MainLayout>\n\t\t\t\t\t\t\t<RoomRoute extractOpenRoomParams={extractOpenRoomParams} />\n\t\t\t\t\t\t</MainLayout>,\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t]);\n\t\t}\n\t}\n\n\tpublic getURL(roomType: string, subData: RoomIdentification): string | false {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst routeData = this.getRouteData(roomType, subData);\n\t\tif (!routeData) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Meteor.absoluteUrl(\n\t\t\trouter.buildRoutePath({\n\t\t\t\tname: config.route.name,\n\t\t\t\tparams: routeData,\n\t\t\t}),\n\t\t);\n\t}\n\n\tpublic isRouteNameKnown(routeName: string): boolean {\n\t\treturn Boolean(this.getRouteNameIdentifier(routeName));\n\t}\n\n\tpublic getRouteNameIdentifier(routeName: string): string | undefined {\n\t\tif (!routeName) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn Object.keys(this.roomTypes).find((key) => this.roomTypes[key].config.route?.name === routeName);\n\t}\n}\n\nexport const roomCoordinator = new RoomCoordinatorClient();\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/rooms/roomCoordinator.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/lib/rooms/roomCoordinator.tsx","inputSourceMap":{"version":3,"file":"client/lib/rooms/roomCoordinator.tsx","sourceRoot":"","sources":["client/lib/rooms/roomCoordinator.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { IRoom, RoomType, IUser, AtLeast, ValueOf, ISubscription } from '@rocket.chat/core-typings';\nimport { isRoomFederated } from '@rocket.chat/core-typings';\nimport type { RouteName } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\nimport React from 'react';\n\nimport { hasPermission } from '../../../app/authorization/client';\nimport { ChatRoom, ChatSubscription } from '../../../app/models/client';\nimport { settings } from '../../../app/settings/client';\nimport type {\n\tRoomSettingsEnum,\n\tRoomMemberActions,\n\tUiTextContext,\n\tIRoomTypeClientDirectives,\n\tRoomIdentification,\n\tIRoomTypeRouteConfig,\n\tIRoomTypeClientConfig,\n} from '../../../definition/IRoomTypeConfig';\nimport { RoomCoordinator } from '../../../lib/rooms/coordinator';\nimport { router } from '../../providers/RouterProvider';\nimport RoomRoute from '../../views/room/RoomRoute';\nimport MainLayout from '../../views/root/MainLayout';\nimport { appLayout } from '../appLayout';\n\nclass RoomCoordinatorClient extends RoomCoordinator {\n\tpublic add(roomConfig: IRoomTypeClientConfig, directives: Partial<IRoomTypeClientDirectives>): void {\n\t\tthis.addRoomType(roomConfig, {\n\t\t\tallowRoomSettingChange(_room: Partial<IRoom>, _setting: ValueOf<typeof RoomSettingsEnum>): boolean {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tallowMemberAction(\n\t\t\t\t_room: Partial<IRoom>,\n\t\t\t\t_action: ValueOf<typeof RoomMemberActions>,\n\t\t\t\t_showingUserId: IUser['_id'],\n\t\t\t\t_userSubscription?: ISubscription,\n\t\t\t): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\troomName(_room: AtLeast<IRoom, '_id' | 'name' | 'fname' | 'prid'>): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tisGroupChat(_room: Partial<IRoom>): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tgetUiText(_context: ValueOf<typeof UiTextContext>): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tcondition(): boolean {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tgetAvatarPath(_room): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tfindRoom(_identifier: string): IRoom | undefined {\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tshowJoinLink(_roomId: string): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tisLivechatRoom(): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tcanSendMessage(rid: string): boolean {\n\t\t\t\treturn ChatSubscription.find({ rid }).count() > 0;\n\t\t\t},\n\t\t\t...directives,\n\t\t\tconfig: roomConfig,\n\t\t});\n\t}\n\n\tpublic getRoomDirectives(roomType: string): IRoomTypeClientDirectives {\n\t\treturn this.roomTypes[roomType].directives as IRoomTypeClientDirectives;\n\t}\n\n\tpublic openRouteLink(\n\t\troomType: RoomType,\n\t\tsubData: RoomIdentification,\n\t\tqueryParams?: Record<string, string>,\n\t\toptions: { replace?: boolean } = {},\n\t): void {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet routeData = {};\n\t\tif (config.route.link) {\n\t\t\trouteData = config.route.link(subData);\n\t\t} else if (subData?.name) {\n\t\t\trouteData = {\n\t\t\t\tname: subData.name,\n\t\t\t};\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\trouter.navigate(\n\t\t\t{\n\t\t\t\tpattern: config.route.path ?? '/home',\n\t\t\t\tparams: routeData,\n\t\t\t\tsearch: queryParams,\n\t\t\t},\n\t\t\toptions,\n\t\t);\n\t}\n\n\tpublic isLivechatRoom(roomType: string): boolean {\n\t\treturn Boolean(this.getRoomDirectives(roomType).isLivechatRoom());\n\t}\n\n\tpublic getRoomName(roomType: string, roomData: AtLeast<IRoom, '_id' | 'name' | 'fname' | 'prid'>): string {\n\t\treturn this.getRoomDirectives(roomType).roomName(roomData) ?? '';\n\t}\n\n\tpublic readOnly(rid: string, user: AtLeast<IUser, 'username'>): boolean {\n\t\tconst fields = {\n\t\t\tro: 1,\n\t\t\tt: 1,\n\t\t\t...(user && { muted: 1, unmuted: 1 }),\n\t\t};\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields });\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst directives = this.getRoomDirectives(room.t);\n\t\tif (directives?.readOnly) {\n\t\t\treturn directives.readOnly(rid, user);\n\t\t}\n\n\t\tif (!user?.username) {\n\t\t\treturn Boolean(room.ro);\n\t\t}\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Array.isArray(room.muted) && room.muted.indexOf(user.username) !== -1) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (room.ro) {\n\t\t\tif (Array.isArray(room.unmuted) && room.unmuted.indexOf(user.username) !== -1) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (hasPermission('post-readonly', room._id)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t// #ToDo: Move this out of the RoomCoordinator\n\tpublic archived(rid: string): boolean {\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { archived: 1 } });\n\t\treturn Boolean(room?.archived);\n\t}\n\n\tpublic verifyCanSendMessage(rid: string): boolean {\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { t: 1, federated: 1 } });\n\t\tif (!room?.t) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!this.getRoomDirectives(room.t).canSendMessage(rid)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (isRoomFederated(room)) {\n\t\t\treturn settings.get('Federation_Matrix_enabled');\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate validateRoute<TRouteName extends RouteName>(route: IRoomTypeRouteConfig<TRouteName>): void {\n\t\tconst { name, path, link } = route;\n\n\t\tif (typeof name !== 'string' || name.length === 0) {\n\t\t\tthrow new Error('The route name must be a string.');\n\t\t}\n\n\t\tif (path !== undefined && (typeof path !== 'string' || path.length === 0)) {\n\t\t\tthrow new Error('The route path must be a string.');\n\t\t}\n\n\t\tif (!['undefined', 'function'].includes(typeof link)) {\n\t\t\tthrow new Error('The route link must be a function.');\n\t\t}\n\t}\n\n\tprotected validateRoomConfig(roomConfig: IRoomTypeClientConfig): void {\n\t\tsuper.validateRoomConfig(roomConfig);\n\n\t\tconst { route, label } = roomConfig;\n\n\t\tif (route !== undefined) {\n\t\t\tthis.validateRoute(route);\n\t\t}\n\n\t\tif (label !== undefined && (typeof label !== 'string' || label.length === 0)) {\n\t\t\tthrow new Error('The label must be a string.');\n\t\t}\n\t}\n\n\tprotected addRoomType(roomConfig: IRoomTypeClientConfig, directives: IRoomTypeClientDirectives): void {\n\t\tsuper.addRoomType(roomConfig, directives);\n\n\t\tif (roomConfig.route?.path && roomConfig.route.name && directives.extractOpenRoomParams) {\n\t\t\tconst {\n\t\t\t\troute: { name, path },\n\t\t\t} = roomConfig;\n\t\t\tconst { extractOpenRoomParams } = directives;\n\t\t\trouter.defineRoutes([\n\t\t\t\t{\n\t\t\t\t\tpath,\n\t\t\t\t\tid: name,\n\t\t\t\t\telement: appLayout.wrap(\n\t\t\t\t\t\t<MainLayout>\n\t\t\t\t\t\t\t<RoomRoute extractOpenRoomParams={extractOpenRoomParams} />\n\t\t\t\t\t\t</MainLayout>,\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t]);\n\t\t}\n\t}\n\n\tpublic getURL(roomType: string, subData: RoomIdentification): string | false {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst routeData = this.getRouteData(roomType, subData);\n\t\tif (!routeData) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Meteor.absoluteUrl(\n\t\t\trouter.buildRoutePath({\n\t\t\t\tname: config.route.name,\n\t\t\t\tparams: routeData,\n\t\t\t}),\n\t\t);\n\t}\n\n\tpublic isRouteNameKnown(routeName: string): boolean {\n\t\treturn Boolean(this.getRouteNameIdentifier(routeName));\n\t}\n\n\tpublic getRouteNameIdentifier(routeName: string): string | undefined {\n\t\tif (!routeName) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn Object.keys(this.roomTypes).find((key) => this.roomTypes[key].config.route?.name === routeName);\n\t}\n}\n\nexport const roomCoordinator = new RoomCoordinatorClient();\n"]}}},"code":"let _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n}, 0);\nmodule.export({\n  roomCoordinator: () => roomCoordinator\n});\nlet isRoomFederated;\nmodule.link(\"@rocket.chat/core-typings\", {\n  isRoomFederated(v) {\n    isRoomFederated = v;\n  }\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n}, 1);\nlet React;\nmodule.link(\"react\", {\n  default(v) {\n    React = v;\n  }\n}, 2);\nlet hasPermission;\nmodule.link(\"../../../app/authorization/client\", {\n  hasPermission(v) {\n    hasPermission = v;\n  }\n}, 3);\nlet ChatRoom, ChatSubscription;\nmodule.link(\"../../../app/models/client\", {\n  ChatRoom(v) {\n    ChatRoom = v;\n  },\n  ChatSubscription(v) {\n    ChatSubscription = v;\n  }\n}, 4);\nlet settings;\nmodule.link(\"../../../app/settings/client\", {\n  settings(v) {\n    settings = v;\n  }\n}, 5);\nlet RoomCoordinator;\nmodule.link(\"../../../lib/rooms/coordinator\", {\n  RoomCoordinator(v) {\n    RoomCoordinator = v;\n  }\n}, 6);\nlet router;\nmodule.link(\"../../providers/RouterProvider\", {\n  router(v) {\n    router = v;\n  }\n}, 7);\nlet RoomRoute;\nmodule.link(\"../../views/room/RoomRoute\", {\n  default(v) {\n    RoomRoute = v;\n  }\n}, 8);\nlet MainLayout;\nmodule.link(\"../../views/root/MainLayout\", {\n  default(v) {\n    MainLayout = v;\n  }\n}, 9);\nlet appLayout;\nmodule.link(\"../appLayout\", {\n  appLayout(v) {\n    appLayout = v;\n  }\n}, 10);\nclass RoomCoordinatorClient extends RoomCoordinator {\n  add(roomConfig, directives) {\n    this.addRoomType(roomConfig, _objectSpread(_objectSpread({\n      allowRoomSettingChange(_room, _setting) {\n        return true;\n      },\n      allowMemberAction(_room, _action, _showingUserId, _userSubscription) {\n        return false;\n      },\n      roomName(_room) {\n        return '';\n      },\n      isGroupChat(_room) {\n        return false;\n      },\n      getUiText(_context) {\n        return '';\n      },\n      condition() {\n        return true;\n      },\n      getAvatarPath(_room) {\n        return '';\n      },\n      findRoom(_identifier) {\n        return undefined;\n      },\n      showJoinLink(_roomId) {\n        return false;\n      },\n      isLivechatRoom() {\n        return false;\n      },\n      canSendMessage(rid) {\n        return ChatSubscription.find({\n          rid\n        }).count() > 0;\n      }\n    }, directives), {}, {\n      config: roomConfig\n    }));\n  }\n  getRoomDirectives(roomType) {\n    return this.roomTypes[roomType].directives;\n  }\n  openRouteLink(roomType, subData, queryParams) {\n    var _config$route$path;\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    const config = this.getRoomTypeConfig(roomType);\n    if (!(config !== null && config !== void 0 && config.route)) {\n      return;\n    }\n    let routeData = {};\n    if (config.route.link) {\n      routeData = config.route.link(subData);\n    } else if (subData !== null && subData !== void 0 && subData.name) {\n      routeData = {\n        name: subData.name\n      };\n    } else {\n      return;\n    }\n    router.navigate({\n      pattern: (_config$route$path = config.route.path) !== null && _config$route$path !== void 0 ? _config$route$path : '/home',\n      params: routeData,\n      search: queryParams\n    }, options);\n  }\n  isLivechatRoom(roomType) {\n    return Boolean(this.getRoomDirectives(roomType).isLivechatRoom());\n  }\n  getRoomName(roomType, roomData) {\n    var _this$getRoomDirectiv;\n    return (_this$getRoomDirectiv = this.getRoomDirectives(roomType).roomName(roomData)) !== null && _this$getRoomDirectiv !== void 0 ? _this$getRoomDirectiv : '';\n  }\n  readOnly(rid, user) {\n    const fields = _objectSpread({\n      ro: 1,\n      t: 1\n    }, user && {\n      muted: 1,\n      unmuted: 1\n    });\n    const room = ChatRoom.findOne({\n      _id: rid\n    }, {\n      fields\n    });\n    if (!room) {\n      return false;\n    }\n    const directives = this.getRoomDirectives(room.t);\n    if (directives !== null && directives !== void 0 && directives.readOnly) {\n      return directives.readOnly(rid, user);\n    }\n    if (!(user !== null && user !== void 0 && user.username)) {\n      return Boolean(room.ro);\n    }\n    if (!room) {\n      return false;\n    }\n    if (Array.isArray(room.muted) && room.muted.indexOf(user.username) !== -1) {\n      return true;\n    }\n    if (room.ro) {\n      if (Array.isArray(room.unmuted) && room.unmuted.indexOf(user.username) !== -1) {\n        return false;\n      }\n      if (hasPermission('post-readonly', room._id)) {\n        return false;\n      }\n      return true;\n    }\n    return false;\n  }\n  // #ToDo: Move this out of the RoomCoordinator\n  archived(rid) {\n    const room = ChatRoom.findOne({\n      _id: rid\n    }, {\n      fields: {\n        archived: 1\n      }\n    });\n    return Boolean(room === null || room === void 0 ? void 0 : room.archived);\n  }\n  verifyCanSendMessage(rid) {\n    const room = ChatRoom.findOne({\n      _id: rid\n    }, {\n      fields: {\n        t: 1,\n        federated: 1\n      }\n    });\n    if (!(room !== null && room !== void 0 && room.t)) {\n      return false;\n    }\n    if (!this.getRoomDirectives(room.t).canSendMessage(rid)) {\n      return false;\n    }\n    if (isRoomFederated(room)) {\n      return settings.get('Federation_Matrix_enabled');\n    }\n    return true;\n  }\n  validateRoute(route) {\n    const {\n      name,\n      path,\n      link\n    } = route;\n    if (typeof name !== 'string' || name.length === 0) {\n      throw new Error('The route name must be a string.');\n    }\n    if (path !== undefined && (typeof path !== 'string' || path.length === 0)) {\n      throw new Error('The route path must be a string.');\n    }\n    if (!['undefined', 'function'].includes(typeof link)) {\n      throw new Error('The route link must be a function.');\n    }\n  }\n  validateRoomConfig(roomConfig) {\n    super.validateRoomConfig(roomConfig);\n    const {\n      route,\n      label\n    } = roomConfig;\n    if (route !== undefined) {\n      this.validateRoute(route);\n    }\n    if (label !== undefined && (typeof label !== 'string' || label.length === 0)) {\n      throw new Error('The label must be a string.');\n    }\n  }\n  addRoomType(roomConfig, directives) {\n    var _roomConfig$route;\n    super.addRoomType(roomConfig, directives);\n    if ((_roomConfig$route = roomConfig.route) !== null && _roomConfig$route !== void 0 && _roomConfig$route.path && roomConfig.route.name && directives.extractOpenRoomParams) {\n      const {\n        route: {\n          name,\n          path\n        }\n      } = roomConfig;\n      const {\n        extractOpenRoomParams\n      } = directives;\n      router.defineRoutes([{\n        path,\n        id: name,\n        element: appLayout.wrap( /*#__PURE__*/React.createElement(MainLayout, null, /*#__PURE__*/React.createElement(RoomRoute, {\n          extractOpenRoomParams: extractOpenRoomParams\n        })))\n      }]);\n    }\n  }\n  getURL(roomType, subData) {\n    const config = this.getRoomTypeConfig(roomType);\n    if (!(config !== null && config !== void 0 && config.route)) {\n      return false;\n    }\n    const routeData = this.getRouteData(roomType, subData);\n    if (!routeData) {\n      return false;\n    }\n    return Meteor.absoluteUrl(router.buildRoutePath({\n      name: config.route.name,\n      params: routeData\n    }));\n  }\n  isRouteNameKnown(routeName) {\n    return Boolean(this.getRouteNameIdentifier(routeName));\n  }\n  getRouteNameIdentifier(routeName) {\n    if (!routeName) {\n      return;\n    }\n    return Object.keys(this.roomTypes).find(key => {\n      var _this$roomTypes$key$c;\n      return ((_this$roomTypes$key$c = this.roomTypes[key].config.route) === null || _this$roomTypes$key$c === void 0 ? void 0 : _this$roomTypes$key$c.name) === routeName;\n    });\n  }\n}\nconst roomCoordinator = new RoomCoordinatorClient();","map":{"version":3,"names":["_objectSpread","module","link","default","v","export","roomCoordinator","isRoomFederated","Meteor","React","hasPermission","ChatRoom","ChatSubscription","settings","RoomCoordinator","router","RoomRoute","MainLayout","appLayout","RoomCoordinatorClient","add","roomConfig","directives","addRoomType","allowRoomSettingChange","_room","_setting","allowMemberAction","_action","_showingUserId","_userSubscription","roomName","isGroupChat","getUiText","_context","condition","getAvatarPath","findRoom","_identifier","undefined","showJoinLink","_roomId","isLivechatRoom","canSendMessage","rid","find","count","config","getRoomDirectives","roomType","roomTypes","openRouteLink","subData","queryParams","_config$route$path","options","arguments","length","getRoomTypeConfig","route","routeData","name","navigate","pattern","path","params","search","Boolean","getRoomName","roomData","_this$getRoomDirectiv","readOnly","user","fields","ro","t","muted","unmuted","room","findOne","_id","username","Array","isArray","indexOf","archived","verifyCanSendMessage","federated","get","validateRoute","Error","includes","validateRoomConfig","label","_roomConfig$route","extractOpenRoomParams","defineRoutes","id","element","wrap","createElement","getURL","getRouteData","absoluteUrl","buildRoutePath","isRouteNameKnown","routeName","getRouteNameIdentifier","Object","keys","key","_this$roomTypes$key$c"],"sources":["client/lib/rooms/roomCoordinator.tsx"],"sourcesContent":["import type { IRoom, RoomType, IUser, AtLeast, ValueOf, ISubscription } from '@rocket.chat/core-typings';\nimport { isRoomFederated } from '@rocket.chat/core-typings';\nimport type { RouteName } from '@rocket.chat/ui-contexts';\nimport { Meteor } from 'meteor/meteor';\nimport React from 'react';\n\nimport { hasPermission } from '../../../app/authorization/client';\nimport { ChatRoom, ChatSubscription } from '../../../app/models/client';\nimport { settings } from '../../../app/settings/client';\nimport type {\n\tRoomSettingsEnum,\n\tRoomMemberActions,\n\tUiTextContext,\n\tIRoomTypeClientDirectives,\n\tRoomIdentification,\n\tIRoomTypeRouteConfig,\n\tIRoomTypeClientConfig,\n} from '../../../definition/IRoomTypeConfig';\nimport { RoomCoordinator } from '../../../lib/rooms/coordinator';\nimport { router } from '../../providers/RouterProvider';\nimport RoomRoute from '../../views/room/RoomRoute';\nimport MainLayout from '../../views/root/MainLayout';\nimport { appLayout } from '../appLayout';\n\nclass RoomCoordinatorClient extends RoomCoordinator {\n\tpublic add(roomConfig: IRoomTypeClientConfig, directives: Partial<IRoomTypeClientDirectives>): void {\n\t\tthis.addRoomType(roomConfig, {\n\t\t\tallowRoomSettingChange(_room: Partial<IRoom>, _setting: ValueOf<typeof RoomSettingsEnum>): boolean {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tallowMemberAction(\n\t\t\t\t_room: Partial<IRoom>,\n\t\t\t\t_action: ValueOf<typeof RoomMemberActions>,\n\t\t\t\t_showingUserId: IUser['_id'],\n\t\t\t\t_userSubscription?: ISubscription,\n\t\t\t): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\troomName(_room: AtLeast<IRoom, '_id' | 'name' | 'fname' | 'prid'>): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tisGroupChat(_room: Partial<IRoom>): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tgetUiText(_context: ValueOf<typeof UiTextContext>): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tcondition(): boolean {\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tgetAvatarPath(_room): string {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tfindRoom(_identifier: string): IRoom | undefined {\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tshowJoinLink(_roomId: string): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tisLivechatRoom(): boolean {\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tcanSendMessage(rid: string): boolean {\n\t\t\t\treturn ChatSubscription.find({ rid }).count() > 0;\n\t\t\t},\n\t\t\t...directives,\n\t\t\tconfig: roomConfig,\n\t\t});\n\t}\n\n\tpublic getRoomDirectives(roomType: string): IRoomTypeClientDirectives {\n\t\treturn this.roomTypes[roomType].directives as IRoomTypeClientDirectives;\n\t}\n\n\tpublic openRouteLink(\n\t\troomType: RoomType,\n\t\tsubData: RoomIdentification,\n\t\tqueryParams?: Record<string, string>,\n\t\toptions: { replace?: boolean } = {},\n\t): void {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet routeData = {};\n\t\tif (config.route.link) {\n\t\t\trouteData = config.route.link(subData);\n\t\t} else if (subData?.name) {\n\t\t\trouteData = {\n\t\t\t\tname: subData.name,\n\t\t\t};\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\trouter.navigate(\n\t\t\t{\n\t\t\t\tpattern: config.route.path ?? '/home',\n\t\t\t\tparams: routeData,\n\t\t\t\tsearch: queryParams,\n\t\t\t},\n\t\t\toptions,\n\t\t);\n\t}\n\n\tpublic isLivechatRoom(roomType: string): boolean {\n\t\treturn Boolean(this.getRoomDirectives(roomType).isLivechatRoom());\n\t}\n\n\tpublic getRoomName(roomType: string, roomData: AtLeast<IRoom, '_id' | 'name' | 'fname' | 'prid'>): string {\n\t\treturn this.getRoomDirectives(roomType).roomName(roomData) ?? '';\n\t}\n\n\tpublic readOnly(rid: string, user: AtLeast<IUser, 'username'>): boolean {\n\t\tconst fields = {\n\t\t\tro: 1,\n\t\t\tt: 1,\n\t\t\t...(user && { muted: 1, unmuted: 1 }),\n\t\t};\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields });\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst directives = this.getRoomDirectives(room.t);\n\t\tif (directives?.readOnly) {\n\t\t\treturn directives.readOnly(rid, user);\n\t\t}\n\n\t\tif (!user?.username) {\n\t\t\treturn Boolean(room.ro);\n\t\t}\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Array.isArray(room.muted) && room.muted.indexOf(user.username) !== -1) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (room.ro) {\n\t\t\tif (Array.isArray(room.unmuted) && room.unmuted.indexOf(user.username) !== -1) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (hasPermission('post-readonly', room._id)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t// #ToDo: Move this out of the RoomCoordinator\n\tpublic archived(rid: string): boolean {\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { archived: 1 } });\n\t\treturn Boolean(room?.archived);\n\t}\n\n\tpublic verifyCanSendMessage(rid: string): boolean {\n\t\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { t: 1, federated: 1 } });\n\t\tif (!room?.t) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!this.getRoomDirectives(room.t).canSendMessage(rid)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (isRoomFederated(room)) {\n\t\t\treturn settings.get('Federation_Matrix_enabled');\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate validateRoute<TRouteName extends RouteName>(route: IRoomTypeRouteConfig<TRouteName>): void {\n\t\tconst { name, path, link } = route;\n\n\t\tif (typeof name !== 'string' || name.length === 0) {\n\t\t\tthrow new Error('The route name must be a string.');\n\t\t}\n\n\t\tif (path !== undefined && (typeof path !== 'string' || path.length === 0)) {\n\t\t\tthrow new Error('The route path must be a string.');\n\t\t}\n\n\t\tif (!['undefined', 'function'].includes(typeof link)) {\n\t\t\tthrow new Error('The route link must be a function.');\n\t\t}\n\t}\n\n\tprotected validateRoomConfig(roomConfig: IRoomTypeClientConfig): void {\n\t\tsuper.validateRoomConfig(roomConfig);\n\n\t\tconst { route, label } = roomConfig;\n\n\t\tif (route !== undefined) {\n\t\t\tthis.validateRoute(route);\n\t\t}\n\n\t\tif (label !== undefined && (typeof label !== 'string' || label.length === 0)) {\n\t\t\tthrow new Error('The label must be a string.');\n\t\t}\n\t}\n\n\tprotected addRoomType(roomConfig: IRoomTypeClientConfig, directives: IRoomTypeClientDirectives): void {\n\t\tsuper.addRoomType(roomConfig, directives);\n\n\t\tif (roomConfig.route?.path && roomConfig.route.name && directives.extractOpenRoomParams) {\n\t\t\tconst {\n\t\t\t\troute: { name, path },\n\t\t\t} = roomConfig;\n\t\t\tconst { extractOpenRoomParams } = directives;\n\t\t\trouter.defineRoutes([\n\t\t\t\t{\n\t\t\t\t\tpath,\n\t\t\t\t\tid: name,\n\t\t\t\t\telement: appLayout.wrap(\n\t\t\t\t\t\t<MainLayout>\n\t\t\t\t\t\t\t<RoomRoute extractOpenRoomParams={extractOpenRoomParams} />\n\t\t\t\t\t\t</MainLayout>,\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t]);\n\t\t}\n\t}\n\n\tpublic getURL(roomType: string, subData: RoomIdentification): string | false {\n\t\tconst config = this.getRoomTypeConfig(roomType);\n\t\tif (!config?.route) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst routeData = this.getRouteData(roomType, subData);\n\t\tif (!routeData) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Meteor.absoluteUrl(\n\t\t\trouter.buildRoutePath({\n\t\t\t\tname: config.route.name,\n\t\t\t\tparams: routeData,\n\t\t\t}),\n\t\t);\n\t}\n\n\tpublic isRouteNameKnown(routeName: string): boolean {\n\t\treturn Boolean(this.getRouteNameIdentifier(routeName));\n\t}\n\n\tpublic getRouteNameIdentifier(routeName: string): string | undefined {\n\t\tif (!routeName) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn Object.keys(this.roomTypes).find((key) => this.roomTypes[key].config.route?.name === routeName);\n\t}\n}\n\nexport const roomCoordinator = new RoomCoordinatorClient();\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"4f85ad0c197cb785ddbe73c65e48637f20eecbd6"}
