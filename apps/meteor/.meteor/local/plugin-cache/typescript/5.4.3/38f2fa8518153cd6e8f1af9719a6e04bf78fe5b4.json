{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/bridges/http.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/apps/server/bridges/http.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/bridges/http.ts","inputSourceMap":{"version":3,"file":"app/apps/server/bridges/http.ts","sourceRoot":"","sources":["app/apps/server/bridges/http.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IAppServerOrchestrator } from '@rocket.chat/apps';\nimport type { IHttpResponse } from '@rocket.chat/apps-engine/definition/accessors';\nimport type { IHttpBridgeRequestInfo } from '@rocket.chat/apps-engine/server/bridges';\nimport { HttpBridge } from '@rocket.chat/apps-engine/server/bridges/HttpBridge';\nimport { serverFetch as fetch } from '@rocket.chat/server-fetch';\n\nconst isGetOrHead = (method: string): boolean => ['GET', 'HEAD'].includes(method.toUpperCase());\n\n// Previously, there was no timeout for HTTP requests.\n// We're setting the default timeout now to 3 minutes as it\n// seems to be a good balance\nconst DEFAULT_TIMEOUT = 3 * 60 * 1000;\n\nexport class AppHttpBridge extends HttpBridge {\n\tconstructor(private readonly orch: IAppServerOrchestrator) {\n\t\tsuper();\n\t}\n\n\tprotected async call(info: IHttpBridgeRequestInfo): Promise<IHttpResponse> {\n\t\t// begin comptability with old HTTP.call API\n\t\tconst url = new URL(info.url);\n\n\t\tconst { request, method } = info;\n\n\t\tconst { headers = {} } = request;\n\n\t\tlet { content } = request;\n\n\t\tif (!content && typeof request.data === 'object') {\n\t\t\tcontent = request.data;\n\t\t}\n\n\t\tif (request.auth) {\n\t\t\tif (request.auth.indexOf(':') < 0) {\n\t\t\t\tthrow new Error('auth option should be of the form \"username:password\"');\n\t\t\t}\n\n\t\t\tconst base64 = Buffer.from(request.auth, 'ascii').toString('base64');\n\t\t\theaders.Authorization = `Basic ${base64}`;\n\t\t}\n\n\t\tlet paramsForBody;\n\n\t\tif (content || isGetOrHead(method)) {\n\t\t\tif (request.params) {\n\t\t\t\tObject.keys(request.params).forEach((key) => {\n\t\t\t\t\tif (request.params?.[key]) {\n\t\t\t\t\t\turl.searchParams.append(key, request.params?.[key]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tparamsForBody = request.params;\n\t\t}\n\n\t\tif (paramsForBody) {\n\t\t\tconst data = new URLSearchParams();\n\t\t\tObject.entries(paramsForBody).forEach(([key, value]) => {\n\t\t\t\tdata.append(key, value);\n\t\t\t});\n\t\t\tcontent = data.toString();\n\t\t\theaders['Content-Type'] = 'application/x-www-form-urlencoded';\n\t\t}\n\n\t\tif (isGetOrHead(method)) {\n\t\t\tcontent = undefined;\n\t\t}\n\n\t\tconst timeout = request.timeout || DEFAULT_TIMEOUT;\n\n\t\t// end comptability with old HTTP.call API\n\n\t\tthis.orch.debugLog(`The App ${info.appId} is requesting from the outter webs:`, info);\n\n\t\tconst response = await fetch(\n\t\t\turl.href,\n\t\t\t{\n\t\t\t\tmethod,\n\t\t\t\tbody: content,\n\t\t\t\theaders,\n\t\t\t\ttimeout,\n\t\t\t},\n\t\t\t(request.hasOwnProperty('strictSSL') && !request.strictSSL) ||\n\t\t\t\t(request.hasOwnProperty('rejectUnauthorized') && request.rejectUnauthorized),\n\t\t);\n\n\t\tconst result: IHttpResponse = {\n\t\t\turl: info.url,\n\t\t\tmethod: info.method,\n\t\t\tstatusCode: response.status,\n\t\t\theaders: Object.fromEntries(response.headers as unknown as any),\n\t\t};\n\n\t\tconst body = Buffer.from(await response.arrayBuffer());\n\n\t\tif (request.encoding === null) {\n\t\t\t/**\n\t\t\t * The property `content` is not appropriately typed in the\n\t\t\t * Apps-engine definition, and we can't simply change it there\n\t\t\t * as it would be a breaking change. Thus, we're left with this\n\t\t\t * type assertion.\n\t\t\t */\n\t\t\tresult.content = body as any;\n\t\t} else {\n\t\t\tresult.content = body.toString(request.encoding as BufferEncoding);\n\t\t\tresult.data = ((): any => {\n\t\t\t\tconst contentType = (response.headers.get('content-type') || '').split(';')[0];\n\t\t\t\tif (!['application/json', 'text/javascript', 'application/javascript', 'application/x-javascript'].includes(contentType)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(result.content);\n\t\t\t\t} catch {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\n\t\treturn result;\n\t}\n}\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/bridges/http.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/apps/server/bridges/http.ts","inputSourceMap":{"version":3,"file":"app/apps/server/bridges/http.ts","sourceRoot":"","sources":["app/apps/server/bridges/http.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IAppServerOrchestrator } from '@rocket.chat/apps';\nimport type { IHttpResponse } from '@rocket.chat/apps-engine/definition/accessors';\nimport type { IHttpBridgeRequestInfo } from '@rocket.chat/apps-engine/server/bridges';\nimport { HttpBridge } from '@rocket.chat/apps-engine/server/bridges/HttpBridge';\nimport { serverFetch as fetch } from '@rocket.chat/server-fetch';\n\nconst isGetOrHead = (method: string): boolean => ['GET', 'HEAD'].includes(method.toUpperCase());\n\n// Previously, there was no timeout for HTTP requests.\n// We're setting the default timeout now to 3 minutes as it\n// seems to be a good balance\nconst DEFAULT_TIMEOUT = 3 * 60 * 1000;\n\nexport class AppHttpBridge extends HttpBridge {\n\tconstructor(private readonly orch: IAppServerOrchestrator) {\n\t\tsuper();\n\t}\n\n\tprotected async call(info: IHttpBridgeRequestInfo): Promise<IHttpResponse> {\n\t\t// begin comptability with old HTTP.call API\n\t\tconst url = new URL(info.url);\n\n\t\tconst { request, method } = info;\n\n\t\tconst { headers = {} } = request;\n\n\t\tlet { content } = request;\n\n\t\tif (!content && typeof request.data === 'object') {\n\t\t\tcontent = request.data;\n\t\t}\n\n\t\tif (request.auth) {\n\t\t\tif (request.auth.indexOf(':') < 0) {\n\t\t\t\tthrow new Error('auth option should be of the form \"username:password\"');\n\t\t\t}\n\n\t\t\tconst base64 = Buffer.from(request.auth, 'ascii').toString('base64');\n\t\t\theaders.Authorization = `Basic ${base64}`;\n\t\t}\n\n\t\tlet paramsForBody;\n\n\t\tif (content || isGetOrHead(method)) {\n\t\t\tif (request.params) {\n\t\t\t\tObject.keys(request.params).forEach((key) => {\n\t\t\t\t\tif (request.params?.[key]) {\n\t\t\t\t\t\turl.searchParams.append(key, request.params?.[key]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tparamsForBody = request.params;\n\t\t}\n\n\t\tif (paramsForBody) {\n\t\t\tconst data = new URLSearchParams();\n\t\t\tObject.entries(paramsForBody).forEach(([key, value]) => {\n\t\t\t\tdata.append(key, value);\n\t\t\t});\n\t\t\tcontent = data.toString();\n\t\t\theaders['Content-Type'] = 'application/x-www-form-urlencoded';\n\t\t}\n\n\t\tif (isGetOrHead(method)) {\n\t\t\tcontent = undefined;\n\t\t}\n\n\t\tconst timeout = request.timeout || DEFAULT_TIMEOUT;\n\n\t\t// end comptability with old HTTP.call API\n\n\t\tthis.orch.debugLog(`The App ${info.appId} is requesting from the outter webs:`, info);\n\n\t\tconst response = await fetch(\n\t\t\turl.href,\n\t\t\t{\n\t\t\t\tmethod,\n\t\t\t\tbody: content,\n\t\t\t\theaders,\n\t\t\t\ttimeout,\n\t\t\t},\n\t\t\t(request.hasOwnProperty('strictSSL') && !request.strictSSL) ||\n\t\t\t\t(request.hasOwnProperty('rejectUnauthorized') && request.rejectUnauthorized),\n\t\t);\n\n\t\tconst result: IHttpResponse = {\n\t\t\turl: info.url,\n\t\t\tmethod: info.method,\n\t\t\tstatusCode: response.status,\n\t\t\theaders: Object.fromEntries(response.headers as unknown as any),\n\t\t};\n\n\t\tconst body = Buffer.from(await response.arrayBuffer());\n\n\t\tif (request.encoding === null) {\n\t\t\t/**\n\t\t\t * The property `content` is not appropriately typed in the\n\t\t\t * Apps-engine definition, and we can't simply change it there\n\t\t\t * as it would be a breaking change. Thus, we're left with this\n\t\t\t * type assertion.\n\t\t\t */\n\t\t\tresult.content = body as any;\n\t\t} else {\n\t\t\tresult.content = body.toString(request.encoding as BufferEncoding);\n\t\t\tresult.data = ((): any => {\n\t\t\t\tconst contentType = (response.headers.get('content-type') || '').split(';')[0];\n\t\t\t\tif (!['application/json', 'text/javascript', 'application/javascript', 'application/x-javascript'].includes(contentType)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(result.content);\n\t\t\t\t} catch {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\n\t\treturn result;\n\t}\n}\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    module.export({\n      AppHttpBridge: () => AppHttpBridge\n    });\n    let HttpBridge;\n    module.link(\"@rocket.chat/apps-engine/server/bridges/HttpBridge\", {\n      HttpBridge(v) {\n        HttpBridge = v;\n      }\n    }, 0);\n    let fetch;\n    module.link(\"@rocket.chat/server-fetch\", {\n      serverFetch(v) {\n        fetch = v;\n      }\n    }, 1);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    const isGetOrHead = method => ['GET', 'HEAD'].includes(method.toUpperCase());\n    // Previously, there was no timeout for HTTP requests.\n    // We're setting the default timeout now to 3 minutes as it\n    // seems to be a good balance\n    const DEFAULT_TIMEOUT = 3 * 60 * 1000;\n    class AppHttpBridge extends HttpBridge {\n      constructor(orch) {\n        super();\n        this.orch = void 0;\n        this.orch = orch;\n      }\n      async call(info) {\n        // begin comptability with old HTTP.call API\n        const url = new URL(info.url);\n        const {\n          request,\n          method\n        } = info;\n        const {\n          headers = {}\n        } = request;\n        let {\n          content\n        } = request;\n        if (!content && typeof request.data === 'object') {\n          content = request.data;\n        }\n        if (request.auth) {\n          if (request.auth.indexOf(':') < 0) {\n            throw new Error('auth option should be of the form \"username:password\"');\n          }\n          const base64 = Buffer.from(request.auth, 'ascii').toString('base64');\n          headers.Authorization = \"Basic \".concat(base64);\n        }\n        let paramsForBody;\n        if (content || isGetOrHead(method)) {\n          if (request.params) {\n            Object.keys(request.params).forEach(key => {\n              var _request$params;\n              if ((_request$params = request.params) !== null && _request$params !== void 0 && _request$params[key]) {\n                var _request$params2;\n                url.searchParams.append(key, (_request$params2 = request.params) === null || _request$params2 === void 0 ? void 0 : _request$params2[key]);\n              }\n            });\n          }\n        } else {\n          paramsForBody = request.params;\n        }\n        if (paramsForBody) {\n          const data = new URLSearchParams();\n          Object.entries(paramsForBody).forEach(_ref => {\n            let [key, value] = _ref;\n            data.append(key, value);\n          });\n          content = data.toString();\n          headers['Content-Type'] = 'application/x-www-form-urlencoded';\n        }\n        if (isGetOrHead(method)) {\n          content = undefined;\n        }\n        const timeout = request.timeout || DEFAULT_TIMEOUT;\n        // end comptability with old HTTP.call API\n        this.orch.debugLog(\"The App \".concat(info.appId, \" is requesting from the outter webs:\"), info);\n        const response = await fetch(url.href, {\n          method,\n          body: content,\n          headers,\n          timeout\n        }, request.hasOwnProperty('strictSSL') && !request.strictSSL || request.hasOwnProperty('rejectUnauthorized') && request.rejectUnauthorized);\n        const result = {\n          url: info.url,\n          method: info.method,\n          statusCode: response.status,\n          headers: Object.fromEntries(response.headers)\n        };\n        const body = Buffer.from(await response.arrayBuffer());\n        if (request.encoding === null) {\n          /**\n           * The property `content` is not appropriately typed in the\n           * Apps-engine definition, and we can't simply change it there\n           * as it would be a breaking change. Thus, we're left with this\n           * type assertion.\n           */\n          result.content = body;\n        } else {\n          result.content = body.toString(request.encoding);\n          result.data = (() => {\n            const contentType = (response.headers.get('content-type') || '').split(';')[0];\n            if (!['application/json', 'text/javascript', 'application/javascript', 'application/x-javascript'].includes(contentType)) {\n              return null;\n            }\n            try {\n              return JSON.parse(result.content);\n            } catch (_unused) {\n              return null;\n            }\n          })();\n        }\n        return result;\n      }\n    }\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["module","export","AppHttpBridge","HttpBridge","link","v","fetch","serverFetch","__reifyWaitForDeps__","isGetOrHead","method","includes","toUpperCase","DEFAULT_TIMEOUT","constructor","orch","call","info","url","URL","request","headers","content","data","auth","indexOf","Error","base64","Buffer","from","toString","Authorization","concat","paramsForBody","params","Object","keys","forEach","key","_request$params","_request$params2","searchParams","append","URLSearchParams","entries","_ref","value","undefined","timeout","debugLog","appId","response","href","body","hasOwnProperty","strictSSL","rejectUnauthorized","result","statusCode","status","fromEntries","arrayBuffer","encoding","contentType","get","split","JSON","parse","_unused","__reify_async_result__","_reifyError","self","async"],"sources":["app/apps/server/bridges/http.ts"],"sourcesContent":["import type { IAppServerOrchestrator } from '@rocket.chat/apps';\nimport type { IHttpResponse } from '@rocket.chat/apps-engine/definition/accessors';\nimport type { IHttpBridgeRequestInfo } from '@rocket.chat/apps-engine/server/bridges';\nimport { HttpBridge } from '@rocket.chat/apps-engine/server/bridges/HttpBridge';\nimport { serverFetch as fetch } from '@rocket.chat/server-fetch';\n\nconst isGetOrHead = (method: string): boolean => ['GET', 'HEAD'].includes(method.toUpperCase());\n\n// Previously, there was no timeout for HTTP requests.\n// We're setting the default timeout now to 3 minutes as it\n// seems to be a good balance\nconst DEFAULT_TIMEOUT = 3 * 60 * 1000;\n\nexport class AppHttpBridge extends HttpBridge {\n\tconstructor(private readonly orch: IAppServerOrchestrator) {\n\t\tsuper();\n\t}\n\n\tprotected async call(info: IHttpBridgeRequestInfo): Promise<IHttpResponse> {\n\t\t// begin comptability with old HTTP.call API\n\t\tconst url = new URL(info.url);\n\n\t\tconst { request, method } = info;\n\n\t\tconst { headers = {} } = request;\n\n\t\tlet { content } = request;\n\n\t\tif (!content && typeof request.data === 'object') {\n\t\t\tcontent = request.data;\n\t\t}\n\n\t\tif (request.auth) {\n\t\t\tif (request.auth.indexOf(':') < 0) {\n\t\t\t\tthrow new Error('auth option should be of the form \"username:password\"');\n\t\t\t}\n\n\t\t\tconst base64 = Buffer.from(request.auth, 'ascii').toString('base64');\n\t\t\theaders.Authorization = `Basic ${base64}`;\n\t\t}\n\n\t\tlet paramsForBody;\n\n\t\tif (content || isGetOrHead(method)) {\n\t\t\tif (request.params) {\n\t\t\t\tObject.keys(request.params).forEach((key) => {\n\t\t\t\t\tif (request.params?.[key]) {\n\t\t\t\t\t\turl.searchParams.append(key, request.params?.[key]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tparamsForBody = request.params;\n\t\t}\n\n\t\tif (paramsForBody) {\n\t\t\tconst data = new URLSearchParams();\n\t\t\tObject.entries(paramsForBody).forEach(([key, value]) => {\n\t\t\t\tdata.append(key, value);\n\t\t\t});\n\t\t\tcontent = data.toString();\n\t\t\theaders['Content-Type'] = 'application/x-www-form-urlencoded';\n\t\t}\n\n\t\tif (isGetOrHead(method)) {\n\t\t\tcontent = undefined;\n\t\t}\n\n\t\tconst timeout = request.timeout || DEFAULT_TIMEOUT;\n\n\t\t// end comptability with old HTTP.call API\n\n\t\tthis.orch.debugLog(`The App ${info.appId} is requesting from the outter webs:`, info);\n\n\t\tconst response = await fetch(\n\t\t\turl.href,\n\t\t\t{\n\t\t\t\tmethod,\n\t\t\t\tbody: content,\n\t\t\t\theaders,\n\t\t\t\ttimeout,\n\t\t\t},\n\t\t\t(request.hasOwnProperty('strictSSL') && !request.strictSSL) ||\n\t\t\t\t(request.hasOwnProperty('rejectUnauthorized') && request.rejectUnauthorized),\n\t\t);\n\n\t\tconst result: IHttpResponse = {\n\t\t\turl: info.url,\n\t\t\tmethod: info.method,\n\t\t\tstatusCode: response.status,\n\t\t\theaders: Object.fromEntries(response.headers as unknown as any),\n\t\t};\n\n\t\tconst body = Buffer.from(await response.arrayBuffer());\n\n\t\tif (request.encoding === null) {\n\t\t\t/**\n\t\t\t * The property `content` is not appropriately typed in the\n\t\t\t * Apps-engine definition, and we can't simply change it there\n\t\t\t * as it would be a breaking change. Thus, we're left with this\n\t\t\t * type assertion.\n\t\t\t */\n\t\t\tresult.content = body as any;\n\t\t} else {\n\t\t\tresult.content = body.toString(request.encoding as BufferEncoding);\n\t\t\tresult.data = ((): any => {\n\t\t\t\tconst contentType = (response.headers.get('content-type') || '').split(';')[0];\n\t\t\t\tif (!['application/json', 'text/javascript', 'application/javascript', 'application/x-javascript'].includes(contentType)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(result.content);\n\t\t\t\t} catch {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t})();\n\t\t}\n\n\t\treturn result;\n\t}\n}\n"],"mappings":";;;IAGAA,MAAA,CAAOC,MAAE;MAAAC,aAAkB,EAAAA,CAAA,KAAAA;IAAA;IAAA,IAAAC,UAAA;IAAAH,MAAA,CAAAI,IAAA,qDAAqD;MAAAD,WAAAE,CAAA;QAAAF,UAAA,GAAAE,CAAA;MAAA;IAAA;IAAA,IAAAC,KAAA;IAAAN,MAAA,CAAAI,IAAA;MAAAG,YAAAF,CAAA;QAAAC,KAAA,GAAAD,CAAA;MAAA;IAAA;IAAA,IAAAG,oBAAA,WAAAA,oBAAA;IAGhF,MAAMC,WAAW,GAAIC,MAAc,IAAc,CAAC,KAAK,EAAE,MAAM,CAAC,CAACC,QAAQ,CAACD,MAAM,CAACE,WAAW,EAAE,CAAC;IAE/F;IACA;IACA;IACA,MAAMC,eAAe,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI;IAE/B,MAAOX,aAAc,SAAQC,UAAU;MAC5CW,YAA6BC,IAA4B;QACxD,KAAK,EAAE;QAAC,KADoBA,IAAA;QAAA,KAAAA,IAAI,GAAJA,IAAI;MAEjC;MAEU,MAAMC,IAAIA,CAACC,IAA4B;QAChD;QACA,MAAMC,GAAG,GAAG,IAAIC,GAAG,CAACF,IAAI,CAACC,GAAG,CAAC;QAE7B,MAAM;UAAEE,OAAO;UAAEV;QAAM,CAAE,GAAGO,IAAI;QAEhC,MAAM;UAAEI,OAAO,GAAG;QAAE,CAAE,GAAGD,OAAO;QAEhC,IAAI;UAAEE;QAAO,CAAE,GAAGF,OAAO;QAEzB,IAAI,CAACE,OAAO,IAAI,OAAOF,OAAO,CAACG,IAAI,KAAK,QAAQ,EAAE;UACjDD,OAAO,GAAGF,OAAO,CAACG,IAAI;QACvB;QAEA,IAAIH,OAAO,CAACI,IAAI,EAAE;UACjB,IAAIJ,OAAO,CAACI,IAAI,CAACC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;YAClC,MAAM,IAAIC,KAAK,CAAC,uDAAuD,CAAC;UACzE;UAEA,MAAMC,MAAM,GAAGC,MAAM,CAACC,IAAI,CAACT,OAAO,CAACI,IAAI,EAAE,OAAO,CAAC,CAACM,QAAQ,CAAC,QAAQ,CAAC;UACpET,OAAO,CAACU,aAAa,YAAAC,MAAA,CAAYL,MAAM,CAAE;QAC1C;QAEA,IAAIM,aAAa;QAEjB,IAAIX,OAAO,IAAIb,WAAW,CAACC,MAAM,CAAC,EAAE;UACnC,IAAIU,OAAO,CAACc,MAAM,EAAE;YACnBC,MAAM,CAACC,IAAI,CAAChB,OAAO,CAACc,MAAM,CAAC,CAACG,OAAO,CAAEC,GAAG,IAAI;cAAA,IAAAC,eAAA;cAC3C,KAAAA,eAAA,GAAInB,OAAO,CAACc,MAAM,cAAAK,eAAA,eAAdA,eAAA,CAAiBD,GAAG,CAAC,EAAE;gBAAA,IAAAE,gBAAA;gBAC1BtB,GAAG,CAACuB,YAAY,CAACC,MAAM,CAACJ,GAAG,GAAAE,gBAAA,GAAEpB,OAAO,CAACc,MAAM,cAAAM,gBAAA,uBAAdA,gBAAA,CAAiBF,GAAG,CAAC,CAAC;cACpD;YACD,CAAC,CAAC;UACH;QACD,CAAC,MAAM;UACNL,aAAa,GAAGb,OAAO,CAACc,MAAM;QAC/B;QAEA,IAAID,aAAa,EAAE;UAClB,MAAMV,IAAI,GAAG,IAAIoB,eAAe,EAAE;UAClCR,MAAM,CAACS,OAAO,CAACX,aAAa,CAAC,CAACI,OAAO,CAACQ,IAAA,IAAiB;YAAA,IAAhB,CAACP,GAAG,EAAEQ,KAAK,CAAC,GAAAD,IAAA;YAClDtB,IAAI,CAACmB,MAAM,CAACJ,GAAG,EAAEQ,KAAK,CAAC;UACxB,CAAC,CAAC;UACFxB,OAAO,GAAGC,IAAI,CAACO,QAAQ,EAAE;UACzBT,OAAO,CAAC,cAAc,CAAC,GAAG,mCAAmC;QAC9D;QAEA,IAAIZ,WAAW,CAACC,MAAM,CAAC,EAAE;UACxBY,OAAO,GAAGyB,SAAS;QACpB;QAEA,MAAMC,OAAO,GAAG5B,OAAO,CAAC4B,OAAO,IAAInC,eAAe;QAElD;QAEA,IAAI,CAACE,IAAI,CAACkC,QAAQ,YAAAjB,MAAA,CAAYf,IAAI,CAACiC,KAAK,2CAAwCjC,IAAI,CAAC;QAErF,MAAMkC,QAAQ,GAAG,MAAM7C,KAAK,CAC3BY,GAAG,CAACkC,IAAI,EACR;UACC1C,MAAM;UACN2C,IAAI,EAAE/B,OAAO;UACbD,OAAO;UACP2B;SACA,EACA5B,OAAO,CAACkC,cAAc,CAAC,WAAW,CAAC,IAAI,CAAClC,OAAO,CAACmC,SAAS,IACxDnC,OAAO,CAACkC,cAAc,CAAC,oBAAoB,CAAC,IAAIlC,OAAO,CAACoC,kBAAmB,CAC7E;QAED,MAAMC,MAAM,GAAkB;UAC7BvC,GAAG,EAAED,IAAI,CAACC,GAAG;UACbR,MAAM,EAAEO,IAAI,CAACP,MAAM;UACnBgD,UAAU,EAAEP,QAAQ,CAACQ,MAAM;UAC3BtC,OAAO,EAAEc,MAAM,CAACyB,WAAW,CAACT,QAAQ,CAAC9B,OAAyB;SAC9D;QAED,MAAMgC,IAAI,GAAGzB,MAAM,CAACC,IAAI,CAAC,MAAMsB,QAAQ,CAACU,WAAW,EAAE,CAAC;QAEtD,IAAIzC,OAAO,CAAC0C,QAAQ,KAAK,IAAI,EAAE;UAC9B;;;;;;UAMAL,MAAM,CAACnC,OAAO,GAAG+B,IAAW;QAC7B,CAAC,MAAM;UACNI,MAAM,CAACnC,OAAO,GAAG+B,IAAI,CAACvB,QAAQ,CAACV,OAAO,CAAC0C,QAA0B,CAAC;UAClEL,MAAM,CAAClC,IAAI,GAAG,CAAC,MAAU;YACxB,MAAMwC,WAAW,GAAG,CAACZ,QAAQ,CAAC9B,OAAO,CAAC2C,GAAG,CAAC,cAAc,CAAC,IAAI,EAAE,EAAEC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YAC9E,IAAI,CAAC,CAAC,kBAAkB,EAAE,iBAAiB,EAAE,wBAAwB,EAAE,0BAA0B,CAAC,CAACtD,QAAQ,CAACoD,WAAW,CAAC,EAAE;cACzH,OAAO,IAAI;YACZ;YAEA,IAAI;cACH,OAAOG,IAAI,CAACC,KAAK,CAACV,MAAM,CAACnC,OAAO,CAAC;YAClC,CAAC,CAAC,OAAA8C,OAAA,EAAM;cACP,OAAO,IAAI;YACZ;UACD,CAAC,EAAC,CAAE;QACL;QAEA,OAAOX,MAAM;MACd;;IACAY,sBAAA;EAAA,SAAAC,WAAA;IAAA,OAAAD,sBAAA,CAAAC,WAAA;EAAA;EAAAD,sBAAA;AAAA;EAAAE,IAAA;EAAAC,KAAA;AAAA","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"38f2fa8518153cd6e8f1af9719a6e04bf78fe5b4"}
