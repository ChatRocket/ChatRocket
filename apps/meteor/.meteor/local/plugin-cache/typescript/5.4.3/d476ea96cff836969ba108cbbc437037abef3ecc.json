{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/chats/data.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/lib/chats/data.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/chats/data.ts","inputSourceMap":{"version":3,"file":"client/lib/chats/data.ts","sourceRoot":"","sources":["client/lib/chats/data.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IEditedMessage, IMessage, IRoom, ISubscription } from '@rocket.chat/core-typings';\nimport { Random } from '@rocket.chat/random';\nimport moment from 'moment';\n\nimport { hasAtLeastOnePermission, hasPermission } from '../../../app/authorization/client';\nimport { Messages, ChatRoom, ChatSubscription } from '../../../app/models/client';\nimport { settings } from '../../../app/settings/client';\nimport { MessageTypes } from '../../../app/ui-utils/client';\nimport { sdk } from '../../../app/utils/client/lib/SDKClient';\nimport { prependReplies } from '../utils/prependReplies';\nimport type { DataAPI } from './ChatAPI';\n\nexport const createDataAPI = ({ rid, tmid }: { rid: IRoom['_id']; tmid: IMessage['_id'] | undefined }): DataAPI => {\n\tconst composeMessage = async (\n\t\ttext: string,\n\t\t{ sendToChannel, quotedMessages, originalMessage }: { sendToChannel?: boolean; quotedMessages: IMessage[]; originalMessage?: IMessage },\n\t): Promise<IMessage> => {\n\t\tconst msg = await prependReplies(text, quotedMessages);\n\n\t\tconst effectiveRID = originalMessage?.rid ?? rid;\n\t\tconst effectiveTMID = originalMessage ? originalMessage.tmid : tmid;\n\n\t\treturn {\n\t\t\t_id: originalMessage?._id ?? Random.id(),\n\t\t\trid: effectiveRID,\n\t\t\t...(effectiveTMID && {\n\t\t\t\ttmid: effectiveTMID,\n\t\t\t\t...(sendToChannel && { tshow: sendToChannel }),\n\t\t\t}),\n\t\t\tmsg,\n\t\t} as IMessage;\n\t};\n\n\tconst findMessageByID = async (mid: IMessage['_id']): Promise<IMessage | null> =>\n\t\tMessages.findOne({ _id: mid, _hidden: { $ne: true } }, { reactive: false }) ?? sdk.call('getSingleMessage', mid);\n\n\tconst getMessageByID = async (mid: IMessage['_id']): Promise<IMessage> => {\n\t\tconst message = await findMessageByID(mid);\n\n\t\tif (!message) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn message;\n\t};\n\n\tconst findLastMessage = async (): Promise<IMessage | undefined> =>\n\t\tMessages.findOne({ rid, tmid: tmid ?? { $exists: false }, _hidden: { $ne: true } }, { sort: { ts: -1 }, reactive: false });\n\n\tconst getLastMessage = async (): Promise<IMessage> => {\n\t\tconst message = await findLastMessage();\n\n\t\tif (!message) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn message;\n\t};\n\n\tconst findLastOwnMessage = async (): Promise<IMessage | undefined> => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn Messages.findOne(\n\t\t\t{ rid, 'tmid': tmid ?? { $exists: false }, 'u._id': uid, '_hidden': { $ne: true } },\n\t\t\t{ sort: { ts: -1 }, reactive: false },\n\t\t);\n\t};\n\n\tconst getLastOwnMessage = async (): Promise<IMessage> => {\n\t\tconst message = await findLastOwnMessage();\n\n\t\tif (!message) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn message;\n\t};\n\n\tconst canUpdateMessage = async (message: IMessage): Promise<boolean> => {\n\t\tif (MessageTypes.isSystemMessage(message)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst canEditMessage = hasAtLeastOnePermission('edit-message', message.rid);\n\t\tconst editAllowed = (settings.get('Message_AllowEditing') as boolean | undefined) ?? false;\n\t\tconst editOwn = message?.u && message.u._id === Meteor.userId();\n\n\t\tif (!canEditMessage && (!editAllowed || !editOwn)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst blockEditInMinutes = settings.get('Message_AllowEditing_BlockEditInMinutes') as number | undefined;\n\t\tconst bypassBlockTimeLimit = hasPermission('bypass-time-limit-edit-and-delete', message.rid);\n\n\t\tconst elapsedMinutes = moment().diff(message.ts, 'minutes');\n\t\tif (!bypassBlockTimeLimit && elapsedMinutes && blockEditInMinutes && elapsedMinutes > blockEditInMinutes) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst findPreviousOwnMessage = async (message: IMessage): Promise<IMessage | undefined> => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst msg = Messages.findOne(\n\t\t\t{ rid, 'tmid': tmid ?? { $exists: false }, 'u._id': uid, '_hidden': { $ne: true }, 'ts': { $lt: message.ts } },\n\t\t\t{ sort: { ts: -1 }, reactive: false },\n\t\t);\n\n\t\tif (!msg) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (await canUpdateMessage(msg)) {\n\t\t\treturn msg;\n\t\t}\n\n\t\treturn findPreviousOwnMessage(msg);\n\t};\n\n\tconst getPreviousOwnMessage = async (message: IMessage): Promise<IMessage> => {\n\t\tconst previousMessage = await findPreviousOwnMessage(message);\n\n\t\tif (!previousMessage) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn previousMessage;\n\t};\n\n\tconst findNextOwnMessage = async (message: IMessage): Promise<IMessage | undefined> => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst msg = Messages.findOne(\n\t\t\t{ rid, 'tmid': tmid ?? { $exists: false }, 'u._id': uid, '_hidden': { $ne: true }, 'ts': { $gt: message.ts } },\n\t\t\t{ sort: { ts: 1 }, reactive: false },\n\t\t);\n\n\t\tif (!msg) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (await canUpdateMessage(msg)) {\n\t\t\treturn msg;\n\t\t}\n\n\t\treturn findNextOwnMessage(msg);\n\t};\n\n\tconst getNextOwnMessage = async (message: IMessage): Promise<IMessage> => {\n\t\tconst nextMessage = await findNextOwnMessage(message);\n\n\t\tif (!nextMessage) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn nextMessage;\n\t};\n\n\tconst pushEphemeralMessage = async (message: Omit<IMessage, 'rid' | 'tmid'>): Promise<void> => {\n\t\tMessages.upsert({ _id: message._id }, { $set: { ...message, rid, ...(tmid && { tmid }) } });\n\t};\n\n\tconst updateMessage = async (message: IEditedMessage, previewUrls?: string[]): Promise<void> =>\n\t\tsdk.call('updateMessage', message, previewUrls);\n\n\tconst canDeleteMessage = async (message: IMessage): Promise<boolean> => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (MessageTypes.isSystemMessage(message)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst forceDeleteAllowed = hasPermission('force-delete-message', message.rid);\n\t\tif (forceDeleteAllowed) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst deletionEnabled = settings.get('Message_AllowDeleting') as boolean | undefined;\n\t\tif (!deletionEnabled) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst deleteAnyAllowed = hasPermission('delete-message', rid);\n\t\tconst deleteOwnAllowed = hasPermission('delete-own-message');\n\t\tconst deleteAllowed = deleteAnyAllowed || (deleteOwnAllowed && message?.u && message.u._id === Meteor.userId());\n\n\t\tif (!deleteAllowed) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst blockDeleteInMinutes = settings.get('Message_AllowDeleting_BlockDeleteInMinutes') as number | undefined;\n\t\tconst bypassBlockTimeLimit = hasPermission('bypass-time-limit-edit-and-delete', message.rid);\n\t\tconst elapsedMinutes = moment().diff(message.ts, 'minutes');\n\t\tconst onTimeForDelete = bypassBlockTimeLimit || !blockDeleteInMinutes || !elapsedMinutes || elapsedMinutes <= blockDeleteInMinutes;\n\n\t\treturn deleteAllowed && onTimeForDelete;\n\t};\n\n\tconst deleteMessage = async (msgIdOrMsg: IMessage | IMessage['_id']): Promise<void> => {\n\t\tlet msgId: string;\n\t\tlet roomId: string;\n\t\tif (typeof msgIdOrMsg === 'string') {\n\t\t\tmsgId = msgIdOrMsg;\n\t\t\tconst msg = await findMessageByID(msgId);\n\t\t\tif (!msg) {\n\t\t\t\tthrow new Error('Message not found');\n\t\t\t}\n\t\t\troomId = msg.rid;\n\t\t} else {\n\t\t\tmsgId = msgIdOrMsg._id;\n\t\t\troomId = msgIdOrMsg.rid;\n\t\t}\n\n\t\tawait sdk.rest.post('/v1/chat.delete', { msgId, roomId });\n\t};\n\n\tconst drafts = new Map<IMessage['_id'] | undefined, string>();\n\n\tconst getDraft = async (mid: IMessage['_id'] | undefined): Promise<string | undefined> => drafts.get(mid);\n\n\tconst discardDraft = async (mid: IMessage['_id'] | undefined): Promise<void> => {\n\t\tdrafts.delete(mid);\n\t};\n\n\tconst saveDraft = async (mid: IMessage['_id'] | undefined, draft: string): Promise<void> => {\n\t\tdrafts.set(mid, draft);\n\t};\n\n\tconst findRoom = async (): Promise<IRoom | undefined> => ChatRoom.findOne({ _id: rid }, { reactive: false });\n\n\tconst getRoom = async (): Promise<IRoom> => {\n\t\tconst room = await findRoom();\n\n\t\tif (!room) {\n\t\t\tthrow new Error('Room not found');\n\t\t}\n\n\t\treturn room;\n\t};\n\n\tconst isSubscribedToRoom = async (): Promise<boolean> => !!ChatSubscription.findOne({ rid }, { reactive: false });\n\n\tconst joinRoom = async (): Promise<void> => {\n\t\tawait sdk.call('joinRoom', rid);\n\t};\n\n\tconst findDiscussionByID = async (drid: IRoom['_id']): Promise<IRoom | undefined> =>\n\t\tChatRoom.findOne({ _id: drid, prid: { $exists: true } }, { reactive: false });\n\n\tconst getDiscussionByID = async (drid: IRoom['_id']): Promise<IRoom> => {\n\t\tconst discussion = await findDiscussionByID(drid);\n\n\t\tif (!discussion) {\n\t\t\tthrow new Error('Discussion not found');\n\t\t}\n\n\t\treturn discussion;\n\t};\n\n\tconst createStrictGetter = <TFind extends (...args: any[]) => Promise<any>>(\n\t\tfind: TFind,\n\t\terrorMessage: string,\n\t): ((...args: Parameters<TFind>) => Promise<Exclude<Awaited<ReturnType<TFind>>, undefined>>) => {\n\t\treturn async (...args) => {\n\t\t\tconst result = await find(...args);\n\n\t\t\tif (!result) {\n\t\t\t\tthrow new Error(errorMessage);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t};\n\t};\n\n\tconst findSubscription = async (): Promise<ISubscription | undefined> => {\n\t\treturn ChatSubscription.findOne({ rid }, { reactive: false });\n\t};\n\n\tconst getSubscription = createStrictGetter(findSubscription, 'Subscription not found');\n\n\tconst findSubscriptionFromMessage = async (message: IMessage): Promise<ISubscription | undefined> => {\n\t\treturn ChatSubscription.findOne({ rid: message.rid }, { reactive: false });\n\t};\n\n\tconst getSubscriptionFromMessage = createStrictGetter(findSubscriptionFromMessage, 'Subscription not found');\n\n\treturn {\n\t\tcomposeMessage,\n\t\tfindMessageByID,\n\t\tgetMessageByID,\n\t\tfindLastMessage,\n\t\tgetLastMessage,\n\t\tfindLastOwnMessage,\n\t\tgetLastOwnMessage,\n\t\tfindPreviousOwnMessage,\n\t\tgetPreviousOwnMessage,\n\t\tfindNextOwnMessage,\n\t\tgetNextOwnMessage,\n\t\tpushEphemeralMessage,\n\t\tcanUpdateMessage,\n\t\tupdateMessage,\n\t\tcanDeleteMessage,\n\t\tdeleteMessage,\n\t\tgetDraft,\n\t\tsaveDraft,\n\t\tdiscardDraft,\n\t\tfindRoom,\n\t\tgetRoom,\n\t\tisSubscribedToRoom,\n\t\tjoinRoom,\n\t\tfindDiscussionByID,\n\t\tgetDiscussionByID,\n\t\tfindSubscription,\n\t\tgetSubscription,\n\t\tfindSubscriptionFromMessage,\n\t\tgetSubscriptionFromMessage,\n\t};\n};\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/lib/chats/data.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/lib/chats/data.ts","inputSourceMap":{"version":3,"file":"client/lib/chats/data.ts","sourceRoot":"","sources":["client/lib/chats/data.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IEditedMessage, IMessage, IRoom, ISubscription } from '@rocket.chat/core-typings';\nimport { Random } from '@rocket.chat/random';\nimport moment from 'moment';\n\nimport { hasAtLeastOnePermission, hasPermission } from '../../../app/authorization/client';\nimport { Messages, ChatRoom, ChatSubscription } from '../../../app/models/client';\nimport { settings } from '../../../app/settings/client';\nimport { MessageTypes } from '../../../app/ui-utils/client';\nimport { sdk } from '../../../app/utils/client/lib/SDKClient';\nimport { prependReplies } from '../utils/prependReplies';\nimport type { DataAPI } from './ChatAPI';\n\nexport const createDataAPI = ({ rid, tmid }: { rid: IRoom['_id']; tmid: IMessage['_id'] | undefined }): DataAPI => {\n\tconst composeMessage = async (\n\t\ttext: string,\n\t\t{ sendToChannel, quotedMessages, originalMessage }: { sendToChannel?: boolean; quotedMessages: IMessage[]; originalMessage?: IMessage },\n\t): Promise<IMessage> => {\n\t\tconst msg = await prependReplies(text, quotedMessages);\n\n\t\tconst effectiveRID = originalMessage?.rid ?? rid;\n\t\tconst effectiveTMID = originalMessage ? originalMessage.tmid : tmid;\n\n\t\treturn {\n\t\t\t_id: originalMessage?._id ?? Random.id(),\n\t\t\trid: effectiveRID,\n\t\t\t...(effectiveTMID && {\n\t\t\t\ttmid: effectiveTMID,\n\t\t\t\t...(sendToChannel && { tshow: sendToChannel }),\n\t\t\t}),\n\t\t\tmsg,\n\t\t} as IMessage;\n\t};\n\n\tconst findMessageByID = async (mid: IMessage['_id']): Promise<IMessage | null> =>\n\t\tMessages.findOne({ _id: mid, _hidden: { $ne: true } }, { reactive: false }) ?? sdk.call('getSingleMessage', mid);\n\n\tconst getMessageByID = async (mid: IMessage['_id']): Promise<IMessage> => {\n\t\tconst message = await findMessageByID(mid);\n\n\t\tif (!message) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn message;\n\t};\n\n\tconst findLastMessage = async (): Promise<IMessage | undefined> =>\n\t\tMessages.findOne({ rid, tmid: tmid ?? { $exists: false }, _hidden: { $ne: true } }, { sort: { ts: -1 }, reactive: false });\n\n\tconst getLastMessage = async (): Promise<IMessage> => {\n\t\tconst message = await findLastMessage();\n\n\t\tif (!message) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn message;\n\t};\n\n\tconst findLastOwnMessage = async (): Promise<IMessage | undefined> => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn Messages.findOne(\n\t\t\t{ rid, 'tmid': tmid ?? { $exists: false }, 'u._id': uid, '_hidden': { $ne: true } },\n\t\t\t{ sort: { ts: -1 }, reactive: false },\n\t\t);\n\t};\n\n\tconst getLastOwnMessage = async (): Promise<IMessage> => {\n\t\tconst message = await findLastOwnMessage();\n\n\t\tif (!message) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn message;\n\t};\n\n\tconst canUpdateMessage = async (message: IMessage): Promise<boolean> => {\n\t\tif (MessageTypes.isSystemMessage(message)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst canEditMessage = hasAtLeastOnePermission('edit-message', message.rid);\n\t\tconst editAllowed = (settings.get('Message_AllowEditing') as boolean | undefined) ?? false;\n\t\tconst editOwn = message?.u && message.u._id === Meteor.userId();\n\n\t\tif (!canEditMessage && (!editAllowed || !editOwn)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst blockEditInMinutes = settings.get('Message_AllowEditing_BlockEditInMinutes') as number | undefined;\n\t\tconst bypassBlockTimeLimit = hasPermission('bypass-time-limit-edit-and-delete', message.rid);\n\n\t\tconst elapsedMinutes = moment().diff(message.ts, 'minutes');\n\t\tif (!bypassBlockTimeLimit && elapsedMinutes && blockEditInMinutes && elapsedMinutes > blockEditInMinutes) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst findPreviousOwnMessage = async (message: IMessage): Promise<IMessage | undefined> => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst msg = Messages.findOne(\n\t\t\t{ rid, 'tmid': tmid ?? { $exists: false }, 'u._id': uid, '_hidden': { $ne: true }, 'ts': { $lt: message.ts } },\n\t\t\t{ sort: { ts: -1 }, reactive: false },\n\t\t);\n\n\t\tif (!msg) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (await canUpdateMessage(msg)) {\n\t\t\treturn msg;\n\t\t}\n\n\t\treturn findPreviousOwnMessage(msg);\n\t};\n\n\tconst getPreviousOwnMessage = async (message: IMessage): Promise<IMessage> => {\n\t\tconst previousMessage = await findPreviousOwnMessage(message);\n\n\t\tif (!previousMessage) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn previousMessage;\n\t};\n\n\tconst findNextOwnMessage = async (message: IMessage): Promise<IMessage | undefined> => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst msg = Messages.findOne(\n\t\t\t{ rid, 'tmid': tmid ?? { $exists: false }, 'u._id': uid, '_hidden': { $ne: true }, 'ts': { $gt: message.ts } },\n\t\t\t{ sort: { ts: 1 }, reactive: false },\n\t\t);\n\n\t\tif (!msg) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (await canUpdateMessage(msg)) {\n\t\t\treturn msg;\n\t\t}\n\n\t\treturn findNextOwnMessage(msg);\n\t};\n\n\tconst getNextOwnMessage = async (message: IMessage): Promise<IMessage> => {\n\t\tconst nextMessage = await findNextOwnMessage(message);\n\n\t\tif (!nextMessage) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn nextMessage;\n\t};\n\n\tconst pushEphemeralMessage = async (message: Omit<IMessage, 'rid' | 'tmid'>): Promise<void> => {\n\t\tMessages.upsert({ _id: message._id }, { $set: { ...message, rid, ...(tmid && { tmid }) } });\n\t};\n\n\tconst updateMessage = async (message: IEditedMessage, previewUrls?: string[]): Promise<void> =>\n\t\tsdk.call('updateMessage', message, previewUrls);\n\n\tconst canDeleteMessage = async (message: IMessage): Promise<boolean> => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (MessageTypes.isSystemMessage(message)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst forceDeleteAllowed = hasPermission('force-delete-message', message.rid);\n\t\tif (forceDeleteAllowed) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst deletionEnabled = settings.get('Message_AllowDeleting') as boolean | undefined;\n\t\tif (!deletionEnabled) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst deleteAnyAllowed = hasPermission('delete-message', rid);\n\t\tconst deleteOwnAllowed = hasPermission('delete-own-message');\n\t\tconst deleteAllowed = deleteAnyAllowed || (deleteOwnAllowed && message?.u && message.u._id === Meteor.userId());\n\n\t\tif (!deleteAllowed) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst blockDeleteInMinutes = settings.get('Message_AllowDeleting_BlockDeleteInMinutes') as number | undefined;\n\t\tconst bypassBlockTimeLimit = hasPermission('bypass-time-limit-edit-and-delete', message.rid);\n\t\tconst elapsedMinutes = moment().diff(message.ts, 'minutes');\n\t\tconst onTimeForDelete = bypassBlockTimeLimit || !blockDeleteInMinutes || !elapsedMinutes || elapsedMinutes <= blockDeleteInMinutes;\n\n\t\treturn deleteAllowed && onTimeForDelete;\n\t};\n\n\tconst deleteMessage = async (msgIdOrMsg: IMessage | IMessage['_id']): Promise<void> => {\n\t\tlet msgId: string;\n\t\tlet roomId: string;\n\t\tif (typeof msgIdOrMsg === 'string') {\n\t\t\tmsgId = msgIdOrMsg;\n\t\t\tconst msg = await findMessageByID(msgId);\n\t\t\tif (!msg) {\n\t\t\t\tthrow new Error('Message not found');\n\t\t\t}\n\t\t\troomId = msg.rid;\n\t\t} else {\n\t\t\tmsgId = msgIdOrMsg._id;\n\t\t\troomId = msgIdOrMsg.rid;\n\t\t}\n\n\t\tawait sdk.rest.post('/v1/chat.delete', { msgId, roomId });\n\t};\n\n\tconst drafts = new Map<IMessage['_id'] | undefined, string>();\n\n\tconst getDraft = async (mid: IMessage['_id'] | undefined): Promise<string | undefined> => drafts.get(mid);\n\n\tconst discardDraft = async (mid: IMessage['_id'] | undefined): Promise<void> => {\n\t\tdrafts.delete(mid);\n\t};\n\n\tconst saveDraft = async (mid: IMessage['_id'] | undefined, draft: string): Promise<void> => {\n\t\tdrafts.set(mid, draft);\n\t};\n\n\tconst findRoom = async (): Promise<IRoom | undefined> => ChatRoom.findOne({ _id: rid }, { reactive: false });\n\n\tconst getRoom = async (): Promise<IRoom> => {\n\t\tconst room = await findRoom();\n\n\t\tif (!room) {\n\t\t\tthrow new Error('Room not found');\n\t\t}\n\n\t\treturn room;\n\t};\n\n\tconst isSubscribedToRoom = async (): Promise<boolean> => !!ChatSubscription.findOne({ rid }, { reactive: false });\n\n\tconst joinRoom = async (): Promise<void> => {\n\t\tawait sdk.call('joinRoom', rid);\n\t};\n\n\tconst findDiscussionByID = async (drid: IRoom['_id']): Promise<IRoom | undefined> =>\n\t\tChatRoom.findOne({ _id: drid, prid: { $exists: true } }, { reactive: false });\n\n\tconst getDiscussionByID = async (drid: IRoom['_id']): Promise<IRoom> => {\n\t\tconst discussion = await findDiscussionByID(drid);\n\n\t\tif (!discussion) {\n\t\t\tthrow new Error('Discussion not found');\n\t\t}\n\n\t\treturn discussion;\n\t};\n\n\tconst createStrictGetter = <TFind extends (...args: any[]) => Promise<any>>(\n\t\tfind: TFind,\n\t\terrorMessage: string,\n\t): ((...args: Parameters<TFind>) => Promise<Exclude<Awaited<ReturnType<TFind>>, undefined>>) => {\n\t\treturn async (...args) => {\n\t\t\tconst result = await find(...args);\n\n\t\t\tif (!result) {\n\t\t\t\tthrow new Error(errorMessage);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t};\n\t};\n\n\tconst findSubscription = async (): Promise<ISubscription | undefined> => {\n\t\treturn ChatSubscription.findOne({ rid }, { reactive: false });\n\t};\n\n\tconst getSubscription = createStrictGetter(findSubscription, 'Subscription not found');\n\n\tconst findSubscriptionFromMessage = async (message: IMessage): Promise<ISubscription | undefined> => {\n\t\treturn ChatSubscription.findOne({ rid: message.rid }, { reactive: false });\n\t};\n\n\tconst getSubscriptionFromMessage = createStrictGetter(findSubscriptionFromMessage, 'Subscription not found');\n\n\treturn {\n\t\tcomposeMessage,\n\t\tfindMessageByID,\n\t\tgetMessageByID,\n\t\tfindLastMessage,\n\t\tgetLastMessage,\n\t\tfindLastOwnMessage,\n\t\tgetLastOwnMessage,\n\t\tfindPreviousOwnMessage,\n\t\tgetPreviousOwnMessage,\n\t\tfindNextOwnMessage,\n\t\tgetNextOwnMessage,\n\t\tpushEphemeralMessage,\n\t\tcanUpdateMessage,\n\t\tupdateMessage,\n\t\tcanDeleteMessage,\n\t\tdeleteMessage,\n\t\tgetDraft,\n\t\tsaveDraft,\n\t\tdiscardDraft,\n\t\tfindRoom,\n\t\tgetRoom,\n\t\tisSubscribedToRoom,\n\t\tjoinRoom,\n\t\tfindDiscussionByID,\n\t\tgetDiscussionByID,\n\t\tfindSubscription,\n\t\tgetSubscription,\n\t\tfindSubscriptionFromMessage,\n\t\tgetSubscriptionFromMessage,\n\t};\n};\n"]}}},"code":"var _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nvar _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 1);\nmodule.export({\n  createDataAPI: function () {\n    return createDataAPI;\n  }\n});\nvar Random;\nmodule.link(\"@rocket.chat/random\", {\n  Random: function (v) {\n    Random = v;\n  }\n}, 0);\nvar moment;\nmodule.link(\"moment\", {\n  \"default\": function (v) {\n    moment = v;\n  }\n}, 1);\nvar hasAtLeastOnePermission, hasPermission;\nmodule.link(\"../../../app/authorization/client\", {\n  hasAtLeastOnePermission: function (v) {\n    hasAtLeastOnePermission = v;\n  },\n  hasPermission: function (v) {\n    hasPermission = v;\n  }\n}, 2);\nvar Messages, ChatRoom, ChatSubscription;\nmodule.link(\"../../../app/models/client\", {\n  Messages: function (v) {\n    Messages = v;\n  },\n  ChatRoom: function (v) {\n    ChatRoom = v;\n  },\n  ChatSubscription: function (v) {\n    ChatSubscription = v;\n  }\n}, 3);\nvar settings;\nmodule.link(\"../../../app/settings/client\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 4);\nvar MessageTypes;\nmodule.link(\"../../../app/ui-utils/client\", {\n  MessageTypes: function (v) {\n    MessageTypes = v;\n  }\n}, 5);\nvar sdk;\nmodule.link(\"../../../app/utils/client/lib/SDKClient\", {\n  sdk: function (v) {\n    sdk = v;\n  }\n}, 6);\nvar prependReplies;\nmodule.link(\"../utils/prependReplies\", {\n  prependReplies: function (v) {\n    prependReplies = v;\n  }\n}, 7);\nvar createDataAPI = function (_ref) {\n  var rid = _ref.rid,\n    tmid = _ref.tmid;\n  var composeMessage = function () {\n    function _callee(text, _ref2) {\n      var _originalMessage$rid, _originalMessage$_id;\n      var sendToChannel, quotedMessages, originalMessage, msg, effectiveRID, effectiveTMID;\n      return _regeneratorRuntime.async(function () {\n        function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              sendToChannel = _ref2.sendToChannel, quotedMessages = _ref2.quotedMessages, originalMessage = _ref2.originalMessage;\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(prependReplies(text, quotedMessages));\n            case 3:\n              msg = _context.sent;\n              effectiveRID = (_originalMessage$rid = originalMessage === null || originalMessage === void 0 ? void 0 : originalMessage.rid) !== null && _originalMessage$rid !== void 0 ? _originalMessage$rid : rid;\n              effectiveTMID = originalMessage ? originalMessage.tmid : tmid;\n              return _context.abrupt(\"return\", _objectSpread(_objectSpread({\n                _id: (_originalMessage$_id = originalMessage === null || originalMessage === void 0 ? void 0 : originalMessage._id) !== null && _originalMessage$_id !== void 0 ? _originalMessage$_id : Random.id(),\n                rid: effectiveRID\n              }, effectiveTMID && _objectSpread({\n                tmid: effectiveTMID\n              }, sendToChannel && {\n                tshow: sendToChannel\n              })), {}, {\n                msg: msg\n              }));\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n        return _callee$;\n      }(), null, null, null, Promise);\n    }\n    return _callee;\n  }();\n  var findMessageByID = function () {\n    function _callee2(mid) {\n      var _Messages$findOne;\n      return _regeneratorRuntime.async(function () {\n        function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              return _context2.abrupt(\"return\", (_Messages$findOne = Messages.findOne({\n                _id: mid,\n                _hidden: {\n                  $ne: true\n                }\n              }, {\n                reactive: false\n              })) !== null && _Messages$findOne !== void 0 ? _Messages$findOne : sdk.call('getSingleMessage', mid));\n            case 1:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n        return _callee2$;\n      }(), null, null, null, Promise);\n    }\n    return _callee2;\n  }();\n  var getMessageByID = function () {\n    function _callee3(mid) {\n      var message;\n      return _regeneratorRuntime.async(function () {\n        function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return _regeneratorRuntime.awrap(findMessageByID(mid));\n            case 2:\n              message = _context3.sent;\n              if (message) {\n                _context3.next = 5;\n                break;\n              }\n              throw new Error('Message not found');\n            case 5:\n              return _context3.abrupt(\"return\", message);\n            case 6:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n        return _callee3$;\n      }(), null, null, null, Promise);\n    }\n    return _callee3;\n  }();\n  var findLastMessage = function () {\n    function _callee4() {\n      return _regeneratorRuntime.async(function () {\n        function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              return _context4.abrupt(\"return\", Messages.findOne({\n                rid: rid,\n                tmid: tmid !== null && tmid !== void 0 ? tmid : {\n                  $exists: false\n                },\n                _hidden: {\n                  $ne: true\n                }\n              }, {\n                sort: {\n                  ts: -1\n                },\n                reactive: false\n              }));\n            case 1:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n        return _callee4$;\n      }(), null, null, null, Promise);\n    }\n    return _callee4;\n  }();\n  var getLastMessage = function () {\n    function _callee5() {\n      var message;\n      return _regeneratorRuntime.async(function () {\n        function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _regeneratorRuntime.awrap(findLastMessage());\n            case 2:\n              message = _context5.sent;\n              if (message) {\n                _context5.next = 5;\n                break;\n              }\n              throw new Error('Message not found');\n            case 5:\n              return _context5.abrupt(\"return\", message);\n            case 6:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n        return _callee5$;\n      }(), null, null, null, Promise);\n    }\n    return _callee5;\n  }();\n  var findLastOwnMessage = function () {\n    function _callee6() {\n      var uid;\n      return _regeneratorRuntime.async(function () {\n        function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              uid = Meteor.userId();\n              if (uid) {\n                _context6.next = 3;\n                break;\n              }\n              return _context6.abrupt(\"return\", undefined);\n            case 3:\n              return _context6.abrupt(\"return\", Messages.findOne({\n                rid: rid,\n                'tmid': tmid !== null && tmid !== void 0 ? tmid : {\n                  $exists: false\n                },\n                'u._id': uid,\n                '_hidden': {\n                  $ne: true\n                }\n              }, {\n                sort: {\n                  ts: -1\n                },\n                reactive: false\n              }));\n            case 4:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n        return _callee6$;\n      }(), null, null, null, Promise);\n    }\n    return _callee6;\n  }();\n  var getLastOwnMessage = function () {\n    function _callee7() {\n      var message;\n      return _regeneratorRuntime.async(function () {\n        function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.next = 2;\n              return _regeneratorRuntime.awrap(findLastOwnMessage());\n            case 2:\n              message = _context7.sent;\n              if (message) {\n                _context7.next = 5;\n                break;\n              }\n              throw new Error('Message not found');\n            case 5:\n              return _context7.abrupt(\"return\", message);\n            case 6:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n        return _callee7$;\n      }(), null, null, null, Promise);\n    }\n    return _callee7;\n  }();\n  var canUpdateMessage = function () {\n    function _callee8(message) {\n      var _settings$get;\n      var canEditMessage, editAllowed, editOwn, blockEditInMinutes, bypassBlockTimeLimit, elapsedMinutes;\n      return _regeneratorRuntime.async(function () {\n        function _callee8$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              if (!MessageTypes.isSystemMessage(message)) {\n                _context8.next = 2;\n                break;\n              }\n              return _context8.abrupt(\"return\", false);\n            case 2:\n              canEditMessage = hasAtLeastOnePermission('edit-message', message.rid);\n              editAllowed = (_settings$get = settings.get('Message_AllowEditing')) !== null && _settings$get !== void 0 ? _settings$get : false;\n              editOwn = (message === null || message === void 0 ? void 0 : message.u) && message.u._id === Meteor.userId();\n              if (!(!canEditMessage && (!editAllowed || !editOwn))) {\n                _context8.next = 7;\n                break;\n              }\n              return _context8.abrupt(\"return\", false);\n            case 7:\n              blockEditInMinutes = settings.get('Message_AllowEditing_BlockEditInMinutes');\n              bypassBlockTimeLimit = hasPermission('bypass-time-limit-edit-and-delete', message.rid);\n              elapsedMinutes = moment().diff(message.ts, 'minutes');\n              if (!(!bypassBlockTimeLimit && elapsedMinutes && blockEditInMinutes && elapsedMinutes > blockEditInMinutes)) {\n                _context8.next = 12;\n                break;\n              }\n              return _context8.abrupt(\"return\", false);\n            case 12:\n              return _context8.abrupt(\"return\", true);\n            case 13:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n        return _callee8$;\n      }(), null, null, null, Promise);\n    }\n    return _callee8;\n  }();\n  var findPreviousOwnMessage = function () {\n    function _callee9(message) {\n      var uid, msg;\n      return _regeneratorRuntime.async(function () {\n        function _callee9$(_context9) {\n          while (1) switch (_context9.prev = _context9.next) {\n            case 0:\n              uid = Meteor.userId();\n              if (uid) {\n                _context9.next = 3;\n                break;\n              }\n              return _context9.abrupt(\"return\", undefined);\n            case 3:\n              msg = Messages.findOne({\n                rid: rid,\n                'tmid': tmid !== null && tmid !== void 0 ? tmid : {\n                  $exists: false\n                },\n                'u._id': uid,\n                '_hidden': {\n                  $ne: true\n                },\n                'ts': {\n                  $lt: message.ts\n                }\n              }, {\n                sort: {\n                  ts: -1\n                },\n                reactive: false\n              });\n              if (msg) {\n                _context9.next = 6;\n                break;\n              }\n              return _context9.abrupt(\"return\", undefined);\n            case 6:\n              _context9.next = 8;\n              return _regeneratorRuntime.awrap(canUpdateMessage(msg));\n            case 8:\n              if (!_context9.sent) {\n                _context9.next = 10;\n                break;\n              }\n              return _context9.abrupt(\"return\", msg);\n            case 10:\n              return _context9.abrupt(\"return\", findPreviousOwnMessage(msg));\n            case 11:\n            case \"end\":\n              return _context9.stop();\n          }\n        }\n        return _callee9$;\n      }(), null, null, null, Promise);\n    }\n    return _callee9;\n  }();\n  var getPreviousOwnMessage = function () {\n    function _callee10(message) {\n      var previousMessage;\n      return _regeneratorRuntime.async(function () {\n        function _callee10$(_context10) {\n          while (1) switch (_context10.prev = _context10.next) {\n            case 0:\n              _context10.next = 2;\n              return _regeneratorRuntime.awrap(findPreviousOwnMessage(message));\n            case 2:\n              previousMessage = _context10.sent;\n              if (previousMessage) {\n                _context10.next = 5;\n                break;\n              }\n              throw new Error('Message not found');\n            case 5:\n              return _context10.abrupt(\"return\", previousMessage);\n            case 6:\n            case \"end\":\n              return _context10.stop();\n          }\n        }\n        return _callee10$;\n      }(), null, null, null, Promise);\n    }\n    return _callee10;\n  }();\n  var findNextOwnMessage = function () {\n    function _callee11(message) {\n      var uid, msg;\n      return _regeneratorRuntime.async(function () {\n        function _callee11$(_context11) {\n          while (1) switch (_context11.prev = _context11.next) {\n            case 0:\n              uid = Meteor.userId();\n              if (uid) {\n                _context11.next = 3;\n                break;\n              }\n              return _context11.abrupt(\"return\", undefined);\n            case 3:\n              msg = Messages.findOne({\n                rid: rid,\n                'tmid': tmid !== null && tmid !== void 0 ? tmid : {\n                  $exists: false\n                },\n                'u._id': uid,\n                '_hidden': {\n                  $ne: true\n                },\n                'ts': {\n                  $gt: message.ts\n                }\n              }, {\n                sort: {\n                  ts: 1\n                },\n                reactive: false\n              });\n              if (msg) {\n                _context11.next = 6;\n                break;\n              }\n              return _context11.abrupt(\"return\", undefined);\n            case 6:\n              _context11.next = 8;\n              return _regeneratorRuntime.awrap(canUpdateMessage(msg));\n            case 8:\n              if (!_context11.sent) {\n                _context11.next = 10;\n                break;\n              }\n              return _context11.abrupt(\"return\", msg);\n            case 10:\n              return _context11.abrupt(\"return\", findNextOwnMessage(msg));\n            case 11:\n            case \"end\":\n              return _context11.stop();\n          }\n        }\n        return _callee11$;\n      }(), null, null, null, Promise);\n    }\n    return _callee11;\n  }();\n  var getNextOwnMessage = function () {\n    function _callee12(message) {\n      var nextMessage;\n      return _regeneratorRuntime.async(function () {\n        function _callee12$(_context12) {\n          while (1) switch (_context12.prev = _context12.next) {\n            case 0:\n              _context12.next = 2;\n              return _regeneratorRuntime.awrap(findNextOwnMessage(message));\n            case 2:\n              nextMessage = _context12.sent;\n              if (nextMessage) {\n                _context12.next = 5;\n                break;\n              }\n              throw new Error('Message not found');\n            case 5:\n              return _context12.abrupt(\"return\", nextMessage);\n            case 6:\n            case \"end\":\n              return _context12.stop();\n          }\n        }\n        return _callee12$;\n      }(), null, null, null, Promise);\n    }\n    return _callee12;\n  }();\n  var pushEphemeralMessage = function () {\n    function _callee13(message) {\n      return _regeneratorRuntime.async(function () {\n        function _callee13$(_context13) {\n          while (1) switch (_context13.prev = _context13.next) {\n            case 0:\n              Messages.upsert({\n                _id: message._id\n              }, {\n                $set: _objectSpread(_objectSpread({}, message), {}, {\n                  rid: rid\n                }, tmid && {\n                  tmid: tmid\n                })\n              });\n            case 1:\n            case \"end\":\n              return _context13.stop();\n          }\n        }\n        return _callee13$;\n      }(), null, null, null, Promise);\n    }\n    return _callee13;\n  }();\n  var updateMessage = function () {\n    function _callee14(message, previewUrls) {\n      return _regeneratorRuntime.async(function () {\n        function _callee14$(_context14) {\n          while (1) switch (_context14.prev = _context14.next) {\n            case 0:\n              return _context14.abrupt(\"return\", sdk.call('updateMessage', message, previewUrls));\n            case 1:\n            case \"end\":\n              return _context14.stop();\n          }\n        }\n        return _callee14$;\n      }(), null, null, null, Promise);\n    }\n    return _callee14;\n  }();\n  var canDeleteMessage = function () {\n    function _callee15(message) {\n      var uid, forceDeleteAllowed, deletionEnabled, deleteAnyAllowed, deleteOwnAllowed, deleteAllowed, blockDeleteInMinutes, bypassBlockTimeLimit, elapsedMinutes, onTimeForDelete;\n      return _regeneratorRuntime.async(function () {\n        function _callee15$(_context15) {\n          while (1) switch (_context15.prev = _context15.next) {\n            case 0:\n              uid = Meteor.userId();\n              if (uid) {\n                _context15.next = 3;\n                break;\n              }\n              return _context15.abrupt(\"return\", false);\n            case 3:\n              if (!MessageTypes.isSystemMessage(message)) {\n                _context15.next = 5;\n                break;\n              }\n              return _context15.abrupt(\"return\", false);\n            case 5:\n              forceDeleteAllowed = hasPermission('force-delete-message', message.rid);\n              if (!forceDeleteAllowed) {\n                _context15.next = 8;\n                break;\n              }\n              return _context15.abrupt(\"return\", true);\n            case 8:\n              deletionEnabled = settings.get('Message_AllowDeleting');\n              if (deletionEnabled) {\n                _context15.next = 11;\n                break;\n              }\n              return _context15.abrupt(\"return\", false);\n            case 11:\n              deleteAnyAllowed = hasPermission('delete-message', rid);\n              deleteOwnAllowed = hasPermission('delete-own-message');\n              deleteAllowed = deleteAnyAllowed || deleteOwnAllowed && (message === null || message === void 0 ? void 0 : message.u) && message.u._id === Meteor.userId();\n              if (deleteAllowed) {\n                _context15.next = 16;\n                break;\n              }\n              return _context15.abrupt(\"return\", false);\n            case 16:\n              blockDeleteInMinutes = settings.get('Message_AllowDeleting_BlockDeleteInMinutes');\n              bypassBlockTimeLimit = hasPermission('bypass-time-limit-edit-and-delete', message.rid);\n              elapsedMinutes = moment().diff(message.ts, 'minutes');\n              onTimeForDelete = bypassBlockTimeLimit || !blockDeleteInMinutes || !elapsedMinutes || elapsedMinutes <= blockDeleteInMinutes;\n              return _context15.abrupt(\"return\", deleteAllowed && onTimeForDelete);\n            case 21:\n            case \"end\":\n              return _context15.stop();\n          }\n        }\n        return _callee15$;\n      }(), null, null, null, Promise);\n    }\n    return _callee15;\n  }();\n  var deleteMessage = function () {\n    function _callee16(msgIdOrMsg) {\n      var msgId, roomId, msg;\n      return _regeneratorRuntime.async(function () {\n        function _callee16$(_context16) {\n          while (1) switch (_context16.prev = _context16.next) {\n            case 0:\n              if (!(typeof msgIdOrMsg === 'string')) {\n                _context16.next = 10;\n                break;\n              }\n              msgId = msgIdOrMsg;\n              _context16.next = 4;\n              return _regeneratorRuntime.awrap(findMessageByID(msgId));\n            case 4:\n              msg = _context16.sent;\n              if (msg) {\n                _context16.next = 7;\n                break;\n              }\n              throw new Error('Message not found');\n            case 7:\n              roomId = msg.rid;\n              _context16.next = 12;\n              break;\n            case 10:\n              msgId = msgIdOrMsg._id;\n              roomId = msgIdOrMsg.rid;\n            case 12:\n              _context16.next = 14;\n              return _regeneratorRuntime.awrap(sdk.rest.post('/v1/chat.delete', {\n                msgId: msgId,\n                roomId: roomId\n              }));\n            case 14:\n            case \"end\":\n              return _context16.stop();\n          }\n        }\n        return _callee16$;\n      }(), null, null, null, Promise);\n    }\n    return _callee16;\n  }();\n  var drafts = new Map();\n  var getDraft = function () {\n    function _callee17(mid) {\n      return _regeneratorRuntime.async(function () {\n        function _callee17$(_context17) {\n          while (1) switch (_context17.prev = _context17.next) {\n            case 0:\n              return _context17.abrupt(\"return\", drafts.get(mid));\n            case 1:\n            case \"end\":\n              return _context17.stop();\n          }\n        }\n        return _callee17$;\n      }(), null, null, null, Promise);\n    }\n    return _callee17;\n  }();\n  var discardDraft = function () {\n    function _callee18(mid) {\n      return _regeneratorRuntime.async(function () {\n        function _callee18$(_context18) {\n          while (1) switch (_context18.prev = _context18.next) {\n            case 0:\n              drafts.delete(mid);\n            case 1:\n            case \"end\":\n              return _context18.stop();\n          }\n        }\n        return _callee18$;\n      }(), null, null, null, Promise);\n    }\n    return _callee18;\n  }();\n  var saveDraft = function () {\n    function _callee19(mid, draft) {\n      return _regeneratorRuntime.async(function () {\n        function _callee19$(_context19) {\n          while (1) switch (_context19.prev = _context19.next) {\n            case 0:\n              drafts.set(mid, draft);\n            case 1:\n            case \"end\":\n              return _context19.stop();\n          }\n        }\n        return _callee19$;\n      }(), null, null, null, Promise);\n    }\n    return _callee19;\n  }();\n  var findRoom = function () {\n    function _callee20() {\n      return _regeneratorRuntime.async(function () {\n        function _callee20$(_context20) {\n          while (1) switch (_context20.prev = _context20.next) {\n            case 0:\n              return _context20.abrupt(\"return\", ChatRoom.findOne({\n                _id: rid\n              }, {\n                reactive: false\n              }));\n            case 1:\n            case \"end\":\n              return _context20.stop();\n          }\n        }\n        return _callee20$;\n      }(), null, null, null, Promise);\n    }\n    return _callee20;\n  }();\n  var getRoom = function () {\n    function _callee21() {\n      var room;\n      return _regeneratorRuntime.async(function () {\n        function _callee21$(_context21) {\n          while (1) switch (_context21.prev = _context21.next) {\n            case 0:\n              _context21.next = 2;\n              return _regeneratorRuntime.awrap(findRoom());\n            case 2:\n              room = _context21.sent;\n              if (room) {\n                _context21.next = 5;\n                break;\n              }\n              throw new Error('Room not found');\n            case 5:\n              return _context21.abrupt(\"return\", room);\n            case 6:\n            case \"end\":\n              return _context21.stop();\n          }\n        }\n        return _callee21$;\n      }(), null, null, null, Promise);\n    }\n    return _callee21;\n  }();\n  var isSubscribedToRoom = function () {\n    function _callee22() {\n      return _regeneratorRuntime.async(function () {\n        function _callee22$(_context22) {\n          while (1) switch (_context22.prev = _context22.next) {\n            case 0:\n              return _context22.abrupt(\"return\", !!ChatSubscription.findOne({\n                rid: rid\n              }, {\n                reactive: false\n              }));\n            case 1:\n            case \"end\":\n              return _context22.stop();\n          }\n        }\n        return _callee22$;\n      }(), null, null, null, Promise);\n    }\n    return _callee22;\n  }();\n  var joinRoom = function () {\n    function _callee23() {\n      return _regeneratorRuntime.async(function () {\n        function _callee23$(_context23) {\n          while (1) switch (_context23.prev = _context23.next) {\n            case 0:\n              _context23.next = 2;\n              return _regeneratorRuntime.awrap(sdk.call('joinRoom', rid));\n            case 2:\n            case \"end\":\n              return _context23.stop();\n          }\n        }\n        return _callee23$;\n      }(), null, null, null, Promise);\n    }\n    return _callee23;\n  }();\n  var findDiscussionByID = function () {\n    function _callee24(drid) {\n      return _regeneratorRuntime.async(function () {\n        function _callee24$(_context24) {\n          while (1) switch (_context24.prev = _context24.next) {\n            case 0:\n              return _context24.abrupt(\"return\", ChatRoom.findOne({\n                _id: drid,\n                prid: {\n                  $exists: true\n                }\n              }, {\n                reactive: false\n              }));\n            case 1:\n            case \"end\":\n              return _context24.stop();\n          }\n        }\n        return _callee24$;\n      }(), null, null, null, Promise);\n    }\n    return _callee24;\n  }();\n  var getDiscussionByID = function () {\n    function _callee25(drid) {\n      var discussion;\n      return _regeneratorRuntime.async(function () {\n        function _callee25$(_context25) {\n          while (1) switch (_context25.prev = _context25.next) {\n            case 0:\n              _context25.next = 2;\n              return _regeneratorRuntime.awrap(findDiscussionByID(drid));\n            case 2:\n              discussion = _context25.sent;\n              if (discussion) {\n                _context25.next = 5;\n                break;\n              }\n              throw new Error('Discussion not found');\n            case 5:\n              return _context25.abrupt(\"return\", discussion);\n            case 6:\n            case \"end\":\n              return _context25.stop();\n          }\n        }\n        return _callee25$;\n      }(), null, null, null, Promise);\n    }\n    return _callee25;\n  }();\n  var createStrictGetter = function (find, errorMessage) {\n    return function () {\n      function _callee26() {\n        var result,\n          _args26 = arguments;\n        return _regeneratorRuntime.async(function () {\n          function _callee26$(_context26) {\n            while (1) switch (_context26.prev = _context26.next) {\n              case 0:\n                _context26.next = 2;\n                return _regeneratorRuntime.awrap(find.apply(void 0, _args26));\n              case 2:\n                result = _context26.sent;\n                if (result) {\n                  _context26.next = 5;\n                  break;\n                }\n                throw new Error(errorMessage);\n              case 5:\n                return _context26.abrupt(\"return\", result);\n              case 6:\n              case \"end\":\n                return _context26.stop();\n            }\n          }\n          return _callee26$;\n        }(), null, null, null, Promise);\n      }\n      return _callee26;\n    }();\n  };\n  var findSubscription = function () {\n    function _callee27() {\n      return _regeneratorRuntime.async(function () {\n        function _callee27$(_context27) {\n          while (1) switch (_context27.prev = _context27.next) {\n            case 0:\n              return _context27.abrupt(\"return\", ChatSubscription.findOne({\n                rid: rid\n              }, {\n                reactive: false\n              }));\n            case 1:\n            case \"end\":\n              return _context27.stop();\n          }\n        }\n        return _callee27$;\n      }(), null, null, null, Promise);\n    }\n    return _callee27;\n  }();\n  var getSubscription = createStrictGetter(findSubscription, 'Subscription not found');\n  var findSubscriptionFromMessage = function () {\n    function _callee28(message) {\n      return _regeneratorRuntime.async(function () {\n        function _callee28$(_context28) {\n          while (1) switch (_context28.prev = _context28.next) {\n            case 0:\n              return _context28.abrupt(\"return\", ChatSubscription.findOne({\n                rid: message.rid\n              }, {\n                reactive: false\n              }));\n            case 1:\n            case \"end\":\n              return _context28.stop();\n          }\n        }\n        return _callee28$;\n      }(), null, null, null, Promise);\n    }\n    return _callee28;\n  }();\n  var getSubscriptionFromMessage = createStrictGetter(findSubscriptionFromMessage, 'Subscription not found');\n  return {\n    composeMessage: composeMessage,\n    findMessageByID: findMessageByID,\n    getMessageByID: getMessageByID,\n    findLastMessage: findLastMessage,\n    getLastMessage: getLastMessage,\n    findLastOwnMessage: findLastOwnMessage,\n    getLastOwnMessage: getLastOwnMessage,\n    findPreviousOwnMessage: findPreviousOwnMessage,\n    getPreviousOwnMessage: getPreviousOwnMessage,\n    findNextOwnMessage: findNextOwnMessage,\n    getNextOwnMessage: getNextOwnMessage,\n    pushEphemeralMessage: pushEphemeralMessage,\n    canUpdateMessage: canUpdateMessage,\n    updateMessage: updateMessage,\n    canDeleteMessage: canDeleteMessage,\n    deleteMessage: deleteMessage,\n    getDraft: getDraft,\n    saveDraft: saveDraft,\n    discardDraft: discardDraft,\n    findRoom: findRoom,\n    getRoom: getRoom,\n    isSubscribedToRoom: isSubscribedToRoom,\n    joinRoom: joinRoom,\n    findDiscussionByID: findDiscussionByID,\n    getDiscussionByID: getDiscussionByID,\n    findSubscription: findSubscription,\n    getSubscription: getSubscription,\n    findSubscriptionFromMessage: findSubscriptionFromMessage,\n    getSubscriptionFromMessage: getSubscriptionFromMessage\n  };\n};","map":{"version":3,"names":["_regeneratorRuntime","module","link","default","v","_objectSpread","export","createDataAPI","Random","moment","hasAtLeastOnePermission","hasPermission","Messages","ChatRoom","ChatSubscription","settings","MessageTypes","sdk","prependReplies","_ref","rid","tmid","composeMessage","_callee","text","_ref2","_originalMessage$rid","_originalMessage$_id","sendToChannel","quotedMessages","originalMessage","msg","effectiveRID","effectiveTMID","async","_callee$","_context","prev","next","awrap","sent","abrupt","_id","id","tshow","stop","Promise","findMessageByID","_callee2","mid","_Messages$findOne","_callee2$","_context2","findOne","_hidden","$ne","reactive","call","getMessageByID","_callee3","message","_callee3$","_context3","Error","findLastMessage","_callee4","_callee4$","_context4","$exists","sort","ts","getLastMessage","_callee5","_callee5$","_context5","findLastOwnMessage","_callee6","uid","_callee6$","_context6","Meteor","userId","undefined","getLastOwnMessage","_callee7","_callee7$","_context7","canUpdateMessage","_callee8","_settings$get","canEditMessage","editAllowed","editOwn","blockEditInMinutes","bypassBlockTimeLimit","elapsedMinutes","_callee8$","_context8","isSystemMessage","get","u","diff","findPreviousOwnMessage","_callee9","_callee9$","_context9","$lt","getPreviousOwnMessage","_callee10","previousMessage","_callee10$","_context10","findNextOwnMessage","_callee11","_callee11$","_context11","$gt","getNextOwnMessage","_callee12","nextMessage","_callee12$","_context12","pushEphemeralMessage","_callee13","_callee13$","_context13","upsert","$set","updateMessage","_callee14","previewUrls","_callee14$","_context14","canDeleteMessage","_callee15","forceDeleteAllowed","deletionEnabled","deleteAnyAllowed","deleteOwnAllowed","deleteAllowed","blockDeleteInMinutes","onTimeForDelete","_callee15$","_context15","deleteMessage","_callee16","msgIdOrMsg","msgId","roomId","_callee16$","_context16","rest","post","drafts","Map","getDraft","_callee17","_callee17$","_context17","discardDraft","_callee18","_callee18$","_context18","delete","saveDraft","_callee19","draft","_callee19$","_context19","set","findRoom","_callee20","_callee20$","_context20","getRoom","_callee21","room","_callee21$","_context21","isSubscribedToRoom","_callee22","_callee22$","_context22","joinRoom","_callee23","_callee23$","_context23","findDiscussionByID","_callee24","drid","_callee24$","_context24","prid","getDiscussionByID","_callee25","discussion","_callee25$","_context25","createStrictGetter","find","errorMessage","_callee26","result","_args26","arguments","_callee26$","_context26","apply","findSubscription","_callee27","_callee27$","_context27","getSubscription","findSubscriptionFromMessage","_callee28","_callee28$","_context28","getSubscriptionFromMessage"],"sources":["client/lib/chats/data.ts"],"sourcesContent":["import type { IEditedMessage, IMessage, IRoom, ISubscription } from '@rocket.chat/core-typings';\nimport { Random } from '@rocket.chat/random';\nimport moment from 'moment';\n\nimport { hasAtLeastOnePermission, hasPermission } from '../../../app/authorization/client';\nimport { Messages, ChatRoom, ChatSubscription } from '../../../app/models/client';\nimport { settings } from '../../../app/settings/client';\nimport { MessageTypes } from '../../../app/ui-utils/client';\nimport { sdk } from '../../../app/utils/client/lib/SDKClient';\nimport { prependReplies } from '../utils/prependReplies';\nimport type { DataAPI } from './ChatAPI';\n\nexport const createDataAPI = ({ rid, tmid }: { rid: IRoom['_id']; tmid: IMessage['_id'] | undefined }): DataAPI => {\n\tconst composeMessage = async (\n\t\ttext: string,\n\t\t{ sendToChannel, quotedMessages, originalMessage }: { sendToChannel?: boolean; quotedMessages: IMessage[]; originalMessage?: IMessage },\n\t): Promise<IMessage> => {\n\t\tconst msg = await prependReplies(text, quotedMessages);\n\n\t\tconst effectiveRID = originalMessage?.rid ?? rid;\n\t\tconst effectiveTMID = originalMessage ? originalMessage.tmid : tmid;\n\n\t\treturn {\n\t\t\t_id: originalMessage?._id ?? Random.id(),\n\t\t\trid: effectiveRID,\n\t\t\t...(effectiveTMID && {\n\t\t\t\ttmid: effectiveTMID,\n\t\t\t\t...(sendToChannel && { tshow: sendToChannel }),\n\t\t\t}),\n\t\t\tmsg,\n\t\t} as IMessage;\n\t};\n\n\tconst findMessageByID = async (mid: IMessage['_id']): Promise<IMessage | null> =>\n\t\tMessages.findOne({ _id: mid, _hidden: { $ne: true } }, { reactive: false }) ?? sdk.call('getSingleMessage', mid);\n\n\tconst getMessageByID = async (mid: IMessage['_id']): Promise<IMessage> => {\n\t\tconst message = await findMessageByID(mid);\n\n\t\tif (!message) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn message;\n\t};\n\n\tconst findLastMessage = async (): Promise<IMessage | undefined> =>\n\t\tMessages.findOne({ rid, tmid: tmid ?? { $exists: false }, _hidden: { $ne: true } }, { sort: { ts: -1 }, reactive: false });\n\n\tconst getLastMessage = async (): Promise<IMessage> => {\n\t\tconst message = await findLastMessage();\n\n\t\tif (!message) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn message;\n\t};\n\n\tconst findLastOwnMessage = async (): Promise<IMessage | undefined> => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn Messages.findOne(\n\t\t\t{ rid, 'tmid': tmid ?? { $exists: false }, 'u._id': uid, '_hidden': { $ne: true } },\n\t\t\t{ sort: { ts: -1 }, reactive: false },\n\t\t);\n\t};\n\n\tconst getLastOwnMessage = async (): Promise<IMessage> => {\n\t\tconst message = await findLastOwnMessage();\n\n\t\tif (!message) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn message;\n\t};\n\n\tconst canUpdateMessage = async (message: IMessage): Promise<boolean> => {\n\t\tif (MessageTypes.isSystemMessage(message)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst canEditMessage = hasAtLeastOnePermission('edit-message', message.rid);\n\t\tconst editAllowed = (settings.get('Message_AllowEditing') as boolean | undefined) ?? false;\n\t\tconst editOwn = message?.u && message.u._id === Meteor.userId();\n\n\t\tif (!canEditMessage && (!editAllowed || !editOwn)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst blockEditInMinutes = settings.get('Message_AllowEditing_BlockEditInMinutes') as number | undefined;\n\t\tconst bypassBlockTimeLimit = hasPermission('bypass-time-limit-edit-and-delete', message.rid);\n\n\t\tconst elapsedMinutes = moment().diff(message.ts, 'minutes');\n\t\tif (!bypassBlockTimeLimit && elapsedMinutes && blockEditInMinutes && elapsedMinutes > blockEditInMinutes) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst findPreviousOwnMessage = async (message: IMessage): Promise<IMessage | undefined> => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst msg = Messages.findOne(\n\t\t\t{ rid, 'tmid': tmid ?? { $exists: false }, 'u._id': uid, '_hidden': { $ne: true }, 'ts': { $lt: message.ts } },\n\t\t\t{ sort: { ts: -1 }, reactive: false },\n\t\t);\n\n\t\tif (!msg) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (await canUpdateMessage(msg)) {\n\t\t\treturn msg;\n\t\t}\n\n\t\treturn findPreviousOwnMessage(msg);\n\t};\n\n\tconst getPreviousOwnMessage = async (message: IMessage): Promise<IMessage> => {\n\t\tconst previousMessage = await findPreviousOwnMessage(message);\n\n\t\tif (!previousMessage) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn previousMessage;\n\t};\n\n\tconst findNextOwnMessage = async (message: IMessage): Promise<IMessage | undefined> => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst msg = Messages.findOne(\n\t\t\t{ rid, 'tmid': tmid ?? { $exists: false }, 'u._id': uid, '_hidden': { $ne: true }, 'ts': { $gt: message.ts } },\n\t\t\t{ sort: { ts: 1 }, reactive: false },\n\t\t);\n\n\t\tif (!msg) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (await canUpdateMessage(msg)) {\n\t\t\treturn msg;\n\t\t}\n\n\t\treturn findNextOwnMessage(msg);\n\t};\n\n\tconst getNextOwnMessage = async (message: IMessage): Promise<IMessage> => {\n\t\tconst nextMessage = await findNextOwnMessage(message);\n\n\t\tif (!nextMessage) {\n\t\t\tthrow new Error('Message not found');\n\t\t}\n\n\t\treturn nextMessage;\n\t};\n\n\tconst pushEphemeralMessage = async (message: Omit<IMessage, 'rid' | 'tmid'>): Promise<void> => {\n\t\tMessages.upsert({ _id: message._id }, { $set: { ...message, rid, ...(tmid && { tmid }) } });\n\t};\n\n\tconst updateMessage = async (message: IEditedMessage, previewUrls?: string[]): Promise<void> =>\n\t\tsdk.call('updateMessage', message, previewUrls);\n\n\tconst canDeleteMessage = async (message: IMessage): Promise<boolean> => {\n\t\tconst uid = Meteor.userId();\n\n\t\tif (!uid) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (MessageTypes.isSystemMessage(message)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst forceDeleteAllowed = hasPermission('force-delete-message', message.rid);\n\t\tif (forceDeleteAllowed) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst deletionEnabled = settings.get('Message_AllowDeleting') as boolean | undefined;\n\t\tif (!deletionEnabled) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst deleteAnyAllowed = hasPermission('delete-message', rid);\n\t\tconst deleteOwnAllowed = hasPermission('delete-own-message');\n\t\tconst deleteAllowed = deleteAnyAllowed || (deleteOwnAllowed && message?.u && message.u._id === Meteor.userId());\n\n\t\tif (!deleteAllowed) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst blockDeleteInMinutes = settings.get('Message_AllowDeleting_BlockDeleteInMinutes') as number | undefined;\n\t\tconst bypassBlockTimeLimit = hasPermission('bypass-time-limit-edit-and-delete', message.rid);\n\t\tconst elapsedMinutes = moment().diff(message.ts, 'minutes');\n\t\tconst onTimeForDelete = bypassBlockTimeLimit || !blockDeleteInMinutes || !elapsedMinutes || elapsedMinutes <= blockDeleteInMinutes;\n\n\t\treturn deleteAllowed && onTimeForDelete;\n\t};\n\n\tconst deleteMessage = async (msgIdOrMsg: IMessage | IMessage['_id']): Promise<void> => {\n\t\tlet msgId: string;\n\t\tlet roomId: string;\n\t\tif (typeof msgIdOrMsg === 'string') {\n\t\t\tmsgId = msgIdOrMsg;\n\t\t\tconst msg = await findMessageByID(msgId);\n\t\t\tif (!msg) {\n\t\t\t\tthrow new Error('Message not found');\n\t\t\t}\n\t\t\troomId = msg.rid;\n\t\t} else {\n\t\t\tmsgId = msgIdOrMsg._id;\n\t\t\troomId = msgIdOrMsg.rid;\n\t\t}\n\n\t\tawait sdk.rest.post('/v1/chat.delete', { msgId, roomId });\n\t};\n\n\tconst drafts = new Map<IMessage['_id'] | undefined, string>();\n\n\tconst getDraft = async (mid: IMessage['_id'] | undefined): Promise<string | undefined> => drafts.get(mid);\n\n\tconst discardDraft = async (mid: IMessage['_id'] | undefined): Promise<void> => {\n\t\tdrafts.delete(mid);\n\t};\n\n\tconst saveDraft = async (mid: IMessage['_id'] | undefined, draft: string): Promise<void> => {\n\t\tdrafts.set(mid, draft);\n\t};\n\n\tconst findRoom = async (): Promise<IRoom | undefined> => ChatRoom.findOne({ _id: rid }, { reactive: false });\n\n\tconst getRoom = async (): Promise<IRoom> => {\n\t\tconst room = await findRoom();\n\n\t\tif (!room) {\n\t\t\tthrow new Error('Room not found');\n\t\t}\n\n\t\treturn room;\n\t};\n\n\tconst isSubscribedToRoom = async (): Promise<boolean> => !!ChatSubscription.findOne({ rid }, { reactive: false });\n\n\tconst joinRoom = async (): Promise<void> => {\n\t\tawait sdk.call('joinRoom', rid);\n\t};\n\n\tconst findDiscussionByID = async (drid: IRoom['_id']): Promise<IRoom | undefined> =>\n\t\tChatRoom.findOne({ _id: drid, prid: { $exists: true } }, { reactive: false });\n\n\tconst getDiscussionByID = async (drid: IRoom['_id']): Promise<IRoom> => {\n\t\tconst discussion = await findDiscussionByID(drid);\n\n\t\tif (!discussion) {\n\t\t\tthrow new Error('Discussion not found');\n\t\t}\n\n\t\treturn discussion;\n\t};\n\n\tconst createStrictGetter = <TFind extends (...args: any[]) => Promise<any>>(\n\t\tfind: TFind,\n\t\terrorMessage: string,\n\t): ((...args: Parameters<TFind>) => Promise<Exclude<Awaited<ReturnType<TFind>>, undefined>>) => {\n\t\treturn async (...args) => {\n\t\t\tconst result = await find(...args);\n\n\t\t\tif (!result) {\n\t\t\t\tthrow new Error(errorMessage);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t};\n\t};\n\n\tconst findSubscription = async (): Promise<ISubscription | undefined> => {\n\t\treturn ChatSubscription.findOne({ rid }, { reactive: false });\n\t};\n\n\tconst getSubscription = createStrictGetter(findSubscription, 'Subscription not found');\n\n\tconst findSubscriptionFromMessage = async (message: IMessage): Promise<ISubscription | undefined> => {\n\t\treturn ChatSubscription.findOne({ rid: message.rid }, { reactive: false });\n\t};\n\n\tconst getSubscriptionFromMessage = createStrictGetter(findSubscriptionFromMessage, 'Subscription not found');\n\n\treturn {\n\t\tcomposeMessage,\n\t\tfindMessageByID,\n\t\tgetMessageByID,\n\t\tfindLastMessage,\n\t\tgetLastMessage,\n\t\tfindLastOwnMessage,\n\t\tgetLastOwnMessage,\n\t\tfindPreviousOwnMessage,\n\t\tgetPreviousOwnMessage,\n\t\tfindNextOwnMessage,\n\t\tgetNextOwnMessage,\n\t\tpushEphemeralMessage,\n\t\tcanUpdateMessage,\n\t\tupdateMessage,\n\t\tcanDeleteMessage,\n\t\tdeleteMessage,\n\t\tgetDraft,\n\t\tsaveDraft,\n\t\tdiscardDraft,\n\t\tfindRoom,\n\t\tgetRoom,\n\t\tisSubscribedToRoom,\n\t\tjoinRoom,\n\t\tfindDiscussionByID,\n\t\tgetDiscussionByID,\n\t\tfindSubscription,\n\t\tgetSubscription,\n\t\tfindSubscriptionFromMessage,\n\t\tgetSubscriptionFromMessage,\n\t};\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"d476ea96cff836969ba108cbbc437037abef3ecc"}
