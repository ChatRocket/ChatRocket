{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/integrations/server/methods/outgoing/addOutgoingIntegration.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/integrations/server/methods/outgoing/addOutgoingIntegration.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/integrations/server/methods/outgoing/addOutgoingIntegration.ts","inputSourceMap":{"version":3,"file":"app/integrations/server/methods/outgoing/addOutgoingIntegration.ts","sourceRoot":"","sources":["app/integrations/server/methods/outgoing/addOutgoingIntegration.ts"],"names":[],"mappings":"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","sourcesContent":["import type { INewOutgoingIntegration, IOutgoingIntegration } from '@rocket.chat/core-typings';\nimport type { ServerMethods } from '@rocket.chat/ddp-client';\nimport { Integrations } from '@rocket.chat/models';\nimport { Match, check } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\n\nimport { hasPermissionAsync } from '../../../../authorization/server/functions/hasPermission';\nimport { notifyOnIntegrationChanged } from '../../../../lib/server/lib/notifyListener';\nimport { validateOutgoingIntegration } from '../../lib/validateOutgoingIntegration';\nimport { validateScriptEngine } from '../../lib/validateScriptEngine';\n\ndeclare module '@rocket.chat/ddp-client' {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface ServerMethods {\n\t\taddOutgoingIntegration(integration: INewOutgoingIntegration): Promise<IOutgoingIntegration>;\n\t}\n}\n\nexport const addOutgoingIntegration = async (userId: string, integration: INewOutgoingIntegration): Promise<IOutgoingIntegration> => {\n\tcheck(\n\t\tintegration,\n\t\tMatch.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\tname: String,\n\t\t\tenabled: Boolean,\n\t\t\tusername: String,\n\t\t\tchannel: String,\n\t\t\talias: Match.Maybe(String),\n\t\t\temoji: Match.Maybe(String),\n\t\t\tscriptEnabled: Boolean,\n\t\t\tscript: Match.Maybe(String),\n\t\t\tscriptEngine: Match.Maybe(String),\n\t\t\turls: Match.Maybe([String]),\n\t\t\tevent: Match.Maybe(String),\n\t\t\ttriggerWords: Match.Maybe([String]),\n\t\t\tavatar: Match.Maybe(String),\n\t\t\ttoken: Match.Maybe(String),\n\t\t\timpersonateUser: Match.Maybe(Boolean),\n\t\t\tretryCount: Match.Maybe(Number),\n\t\t\tretryDelay: Match.Maybe(String),\n\t\t\tretryFailedCalls: Match.Maybe(Boolean),\n\t\t\trunOnEdits: Match.Maybe(Boolean),\n\t\t\ttargetRoom: Match.Maybe(String),\n\t\t\ttriggerWordAnywhere: Match.Maybe(Boolean),\n\t\t}),\n\t);\n\n\tif (\n\t\t!userId ||\n\t\t(!(await hasPermissionAsync(userId, 'manage-outgoing-integrations')) &&\n\t\t\t!(await hasPermissionAsync(userId, 'manage-own-outgoing-integrations')))\n\t) {\n\t\tthrow new Meteor.Error('not_authorized');\n\t}\n\n\tif (integration.script?.trim()) {\n\t\tvalidateScriptEngine(integration.scriptEngine ?? 'isolated-vm');\n\t}\n\n\tconst integrationData = await validateOutgoingIntegration(integration, userId);\n\n\tconst { insertedId } = await Integrations.insertOne(integrationData);\n\n\tif (insertedId) {\n\t\tvoid notifyOnIntegrationChanged({ ...integrationData, _id: insertedId }, 'inserted');\n\t}\n\n\tintegrationData._id = insertedId;\n\n\treturn integrationData;\n};\n\nMeteor.methods<ServerMethods>({\n\tasync addOutgoingIntegration(integration: INewOutgoingIntegration): Promise<IOutgoingIntegration> {\n\t\tconst { userId } = this;\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('Invalid User');\n\t\t}\n\n\t\treturn addOutgoingIntegration(userId, integration);\n\t},\n});\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/integrations/server/methods/outgoing/addOutgoingIntegration.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/integrations/server/methods/outgoing/addOutgoingIntegration.ts","inputSourceMap":{"version":3,"file":"app/integrations/server/methods/outgoing/addOutgoingIntegration.ts","sourceRoot":"","sources":["app/integrations/server/methods/outgoing/addOutgoingIntegration.ts"],"names":[],"mappings":"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","sourcesContent":["import type { INewOutgoingIntegration, IOutgoingIntegration } from '@rocket.chat/core-typings';\nimport type { ServerMethods } from '@rocket.chat/ddp-client';\nimport { Integrations } from '@rocket.chat/models';\nimport { Match, check } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\n\nimport { hasPermissionAsync } from '../../../../authorization/server/functions/hasPermission';\nimport { notifyOnIntegrationChanged } from '../../../../lib/server/lib/notifyListener';\nimport { validateOutgoingIntegration } from '../../lib/validateOutgoingIntegration';\nimport { validateScriptEngine } from '../../lib/validateScriptEngine';\n\ndeclare module '@rocket.chat/ddp-client' {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface ServerMethods {\n\t\taddOutgoingIntegration(integration: INewOutgoingIntegration): Promise<IOutgoingIntegration>;\n\t}\n}\n\nexport const addOutgoingIntegration = async (userId: string, integration: INewOutgoingIntegration): Promise<IOutgoingIntegration> => {\n\tcheck(\n\t\tintegration,\n\t\tMatch.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\tname: String,\n\t\t\tenabled: Boolean,\n\t\t\tusername: String,\n\t\t\tchannel: String,\n\t\t\talias: Match.Maybe(String),\n\t\t\temoji: Match.Maybe(String),\n\t\t\tscriptEnabled: Boolean,\n\t\t\tscript: Match.Maybe(String),\n\t\t\tscriptEngine: Match.Maybe(String),\n\t\t\turls: Match.Maybe([String]),\n\t\t\tevent: Match.Maybe(String),\n\t\t\ttriggerWords: Match.Maybe([String]),\n\t\t\tavatar: Match.Maybe(String),\n\t\t\ttoken: Match.Maybe(String),\n\t\t\timpersonateUser: Match.Maybe(Boolean),\n\t\t\tretryCount: Match.Maybe(Number),\n\t\t\tretryDelay: Match.Maybe(String),\n\t\t\tretryFailedCalls: Match.Maybe(Boolean),\n\t\t\trunOnEdits: Match.Maybe(Boolean),\n\t\t\ttargetRoom: Match.Maybe(String),\n\t\t\ttriggerWordAnywhere: Match.Maybe(Boolean),\n\t\t}),\n\t);\n\n\tif (\n\t\t!userId ||\n\t\t(!(await hasPermissionAsync(userId, 'manage-outgoing-integrations')) &&\n\t\t\t!(await hasPermissionAsync(userId, 'manage-own-outgoing-integrations')))\n\t) {\n\t\tthrow new Meteor.Error('not_authorized');\n\t}\n\n\tif (integration.script?.trim()) {\n\t\tvalidateScriptEngine(integration.scriptEngine ?? 'isolated-vm');\n\t}\n\n\tconst integrationData = await validateOutgoingIntegration(integration, userId);\n\n\tconst { insertedId } = await Integrations.insertOne(integrationData);\n\n\tif (insertedId) {\n\t\tvoid notifyOnIntegrationChanged({ ...integrationData, _id: insertedId }, 'inserted');\n\t}\n\n\tintegrationData._id = insertedId;\n\n\treturn integrationData;\n};\n\nMeteor.methods<ServerMethods>({\n\tasync addOutgoingIntegration(integration: INewOutgoingIntegration): Promise<IOutgoingIntegration> {\n\t\tconst { userId } = this;\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('Invalid User');\n\t\t}\n\n\t\treturn addOutgoingIntegration(userId, integration);\n\t},\n});\n"]}}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let _objectSpread;\n    module.link(\"@babel/runtime/helpers/objectSpread2\", {\n      default(v) {\n        _objectSpread = v;\n      }\n    }, 0);\n    module.export({\n      addOutgoingIntegration: () => addOutgoingIntegration\n    });\n    let Integrations;\n    module.link(\"@rocket.chat/models\", {\n      Integrations(v) {\n        Integrations = v;\n      }\n    }, 0);\n    let Match, check;\n    module.link(\"meteor/check\", {\n      Match(v) {\n        Match = v;\n      },\n      check(v) {\n        check = v;\n      }\n    }, 1);\n    let Meteor;\n    module.link(\"meteor/meteor\", {\n      Meteor(v) {\n        Meteor = v;\n      }\n    }, 2);\n    let hasPermissionAsync;\n    module.link(\"../../../../authorization/server/functions/hasPermission\", {\n      hasPermissionAsync(v) {\n        hasPermissionAsync = v;\n      }\n    }, 3);\n    let notifyOnIntegrationChanged;\n    module.link(\"../../../../lib/server/lib/notifyListener\", {\n      notifyOnIntegrationChanged(v) {\n        notifyOnIntegrationChanged = v;\n      }\n    }, 4);\n    let validateOutgoingIntegration;\n    module.link(\"../../lib/validateOutgoingIntegration\", {\n      validateOutgoingIntegration(v) {\n        validateOutgoingIntegration = v;\n      }\n    }, 5);\n    let validateScriptEngine;\n    module.link(\"../../lib/validateScriptEngine\", {\n      validateScriptEngine(v) {\n        validateScriptEngine = v;\n      }\n    }, 6);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    const addOutgoingIntegration = async (userId, integration) => {\n      var _integration$script;\n      check(integration, Match.ObjectIncluding({\n        type: String,\n        name: String,\n        enabled: Boolean,\n        username: String,\n        channel: String,\n        alias: Match.Maybe(String),\n        emoji: Match.Maybe(String),\n        scriptEnabled: Boolean,\n        script: Match.Maybe(String),\n        scriptEngine: Match.Maybe(String),\n        urls: Match.Maybe([String]),\n        event: Match.Maybe(String),\n        triggerWords: Match.Maybe([String]),\n        avatar: Match.Maybe(String),\n        token: Match.Maybe(String),\n        impersonateUser: Match.Maybe(Boolean),\n        retryCount: Match.Maybe(Number),\n        retryDelay: Match.Maybe(String),\n        retryFailedCalls: Match.Maybe(Boolean),\n        runOnEdits: Match.Maybe(Boolean),\n        targetRoom: Match.Maybe(String),\n        triggerWordAnywhere: Match.Maybe(Boolean)\n      }));\n      if (!userId || !(await hasPermissionAsync(userId, 'manage-outgoing-integrations')) && !(await hasPermissionAsync(userId, 'manage-own-outgoing-integrations'))) {\n        throw new Meteor.Error('not_authorized');\n      }\n      if ((_integration$script = integration.script) !== null && _integration$script !== void 0 && _integration$script.trim()) {\n        var _integration$scriptEn;\n        validateScriptEngine((_integration$scriptEn = integration.scriptEngine) !== null && _integration$scriptEn !== void 0 ? _integration$scriptEn : 'isolated-vm');\n      }\n      const integrationData = await validateOutgoingIntegration(integration, userId);\n      const {\n        insertedId\n      } = await Integrations.insertOne(integrationData);\n      if (insertedId) {\n        void notifyOnIntegrationChanged(_objectSpread(_objectSpread({}, integrationData), {}, {\n          _id: insertedId\n        }), 'inserted');\n      }\n      integrationData._id = insertedId;\n      return integrationData;\n    };\n    Meteor.methods({\n      async addOutgoingIntegration(integration) {\n        const {\n          userId\n        } = this;\n        if (!userId) {\n          throw new Meteor.Error('Invalid User');\n        }\n        return addOutgoingIntegration(userId, integration);\n      }\n    });\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["_objectSpread","module","link","default","v","export","addOutgoingIntegration","Integrations","Match","check","Meteor","hasPermissionAsync","notifyOnIntegrationChanged","validateOutgoingIntegration","validateScriptEngine","__reifyWaitForDeps__","userId","integration","_integration$script","ObjectIncluding","type","String","name","enabled","Boolean","username","channel","alias","Maybe","emoji","scriptEnabled","script","scriptEngine","urls","event","triggerWords","avatar","token","impersonateUser","retryCount","Number","retryDelay","retryFailedCalls","runOnEdits","targetRoom","triggerWordAnywhere","Error","trim","_integration$scriptEn","integrationData","insertedId","insertOne","_id","methods","__reify_async_result__","_reifyError","self","async"],"sources":["app/integrations/server/methods/outgoing/addOutgoingIntegration.ts"],"sourcesContent":["import type { INewOutgoingIntegration, IOutgoingIntegration } from '@rocket.chat/core-typings';\nimport type { ServerMethods } from '@rocket.chat/ddp-client';\nimport { Integrations } from '@rocket.chat/models';\nimport { Match, check } from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\n\nimport { hasPermissionAsync } from '../../../../authorization/server/functions/hasPermission';\nimport { notifyOnIntegrationChanged } from '../../../../lib/server/lib/notifyListener';\nimport { validateOutgoingIntegration } from '../../lib/validateOutgoingIntegration';\nimport { validateScriptEngine } from '../../lib/validateScriptEngine';\n\ndeclare module '@rocket.chat/ddp-client' {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface ServerMethods {\n\t\taddOutgoingIntegration(integration: INewOutgoingIntegration): Promise<IOutgoingIntegration>;\n\t}\n}\n\nexport const addOutgoingIntegration = async (userId: string, integration: INewOutgoingIntegration): Promise<IOutgoingIntegration> => {\n\tcheck(\n\t\tintegration,\n\t\tMatch.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\tname: String,\n\t\t\tenabled: Boolean,\n\t\t\tusername: String,\n\t\t\tchannel: String,\n\t\t\talias: Match.Maybe(String),\n\t\t\temoji: Match.Maybe(String),\n\t\t\tscriptEnabled: Boolean,\n\t\t\tscript: Match.Maybe(String),\n\t\t\tscriptEngine: Match.Maybe(String),\n\t\t\turls: Match.Maybe([String]),\n\t\t\tevent: Match.Maybe(String),\n\t\t\ttriggerWords: Match.Maybe([String]),\n\t\t\tavatar: Match.Maybe(String),\n\t\t\ttoken: Match.Maybe(String),\n\t\t\timpersonateUser: Match.Maybe(Boolean),\n\t\t\tretryCount: Match.Maybe(Number),\n\t\t\tretryDelay: Match.Maybe(String),\n\t\t\tretryFailedCalls: Match.Maybe(Boolean),\n\t\t\trunOnEdits: Match.Maybe(Boolean),\n\t\t\ttargetRoom: Match.Maybe(String),\n\t\t\ttriggerWordAnywhere: Match.Maybe(Boolean),\n\t\t}),\n\t);\n\n\tif (\n\t\t!userId ||\n\t\t(!(await hasPermissionAsync(userId, 'manage-outgoing-integrations')) &&\n\t\t\t!(await hasPermissionAsync(userId, 'manage-own-outgoing-integrations')))\n\t) {\n\t\tthrow new Meteor.Error('not_authorized');\n\t}\n\n\tif (integration.script?.trim()) {\n\t\tvalidateScriptEngine(integration.scriptEngine ?? 'isolated-vm');\n\t}\n\n\tconst integrationData = await validateOutgoingIntegration(integration, userId);\n\n\tconst { insertedId } = await Integrations.insertOne(integrationData);\n\n\tif (insertedId) {\n\t\tvoid notifyOnIntegrationChanged({ ...integrationData, _id: insertedId }, 'inserted');\n\t}\n\n\tintegrationData._id = insertedId;\n\n\treturn integrationData;\n};\n\nMeteor.methods<ServerMethods>({\n\tasync addOutgoingIntegration(integration: INewOutgoingIntegration): Promise<IOutgoingIntegration> {\n\t\tconst { userId } = this;\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('Invalid User');\n\t\t}\n\n\t\treturn addOutgoingIntegration(userId, integration);\n\t},\n});\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"c530a7558d937d91ebbffb1e262a084ca8badc8f"}
