{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/KonchatNotification.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/ui/client/lib/KonchatNotification.ts","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/KonchatNotification.ts","inputSourceMap":{"version":3,"file":"app/ui/client/lib/KonchatNotification.ts","sourceRoot":"","sources":["app/ui/client/lib/KonchatNotification.ts"],"names":[],"mappings":"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","sourcesContent":["import type { INotificationDesktop, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { Random } from '@rocket.chat/random';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\n\nimport { RoomManager } from '../../../../client/lib/RoomManager';\nimport { onClientMessageReceived } from '../../../../client/lib/onClientMessageReceived';\nimport { getAvatarAsPng } from '../../../../client/lib/utils/getAvatarAsPng';\nimport { router } from '../../../../client/providers/RouterProvider';\nimport { stripTags } from '../../../../lib/utils/stringUtils';\nimport { CustomSounds } from '../../../custom-sounds/client/lib/CustomSounds';\nimport { e2e } from '../../../e2e/client';\nimport { ChatSubscription } from '../../../models/client';\nimport { getUserPreference } from '../../../utils/client';\nimport { getUserAvatarURL } from '../../../utils/client/getUserAvatarURL';\nimport { sdk } from '../../../utils/client/lib/SDKClient';\n\ndeclare global {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface NotificationEventMap {\n\t\treply: { response: string };\n\t}\n}\n\nclass KonchatNotification {\n\tpublic notificationStatus = new ReactiveVar<NotificationPermission | undefined>(undefined);\n\n\tpublic getDesktopPermission() {\n\t\tif (window.Notification && Notification.permission !== 'granted') {\n\t\t\treturn Notification.requestPermission((status) => {\n\t\t\t\tthis.notificationStatus.set(status);\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic async notify(notification: INotificationDesktop) {\n\t\tif (typeof window.Notification === 'undefined' || Notification.permission !== 'granted') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!notification.payload) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { rid } = notification.payload;\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\t\tconst message = await onClientMessageReceived({\n\t\t\trid,\n\t\t\tmsg: notification.text,\n\t\t\tnotification: true,\n\t\t} as any);\n\n\t\tconst requireInteraction = getUserPreference<boolean>(Meteor.userId(), 'desktopNotificationRequireInteraction');\n\t\tconst n = new Notification(notification.title, {\n\t\t\ticon: notification.icon || getUserAvatarURL(notification.payload.sender?.username as string),\n\t\t\tbody: stripTags(message.msg),\n\t\t\ttag: notification.payload._id,\n\t\t\tcanReply: true,\n\t\t\tsilent: true,\n\t\t\trequireInteraction,\n\t\t} as NotificationOptions & {\n\t\t\tcanReply?: boolean; // TODO is this still needed for the desktop app?\n\t\t});\n\n\t\tconst notificationDuration = !requireInteraction ? (notification.duration ?? 0) - 0 || 10 : -1;\n\t\tif (notificationDuration > 0) {\n\t\t\tsetTimeout(() => n.close(), notificationDuration * 1000);\n\t\t}\n\n\t\tif (n.addEventListener) {\n\t\t\tn.addEventListener(\n\t\t\t\t'reply',\n\t\t\t\t({ response }) =>\n\t\t\t\t\tvoid sdk.call('sendMessage', {\n\t\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\t\trid,\n\t\t\t\t\t\tmsg: response,\n\t\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tn.onclick = function () {\n\t\t\tthis.close();\n\t\t\twindow.focus();\n\n\t\t\tif (!notification.payload._id || !notification.payload.rid || !notification.payload.name) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (notification.payload?.type) {\n\t\t\t\tcase 'd':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/direct/:rid/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\trid: notification.payload.rid,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'c':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/channel/:name/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tname: notification.payload.name,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'p':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/group/:name/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tname: notification.payload.name,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'l':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/live/:id/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tid: notification.payload.rid,\n\t\t\t\t\t\t\ttab: 'room-info',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic async showDesktop(notification: INotificationDesktop) {\n\t\tif (!notification.payload.rid) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tnotification.payload?.rid === RoomManager.opened &&\n\t\t\t(typeof window.document.hasFocus === 'function' ? window.document.hasFocus() : undefined)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ((Meteor.user() as IUser | null)?.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (notification.payload?.message?.t === 'e2e') {\n\t\t\tconst e2eRoom = await e2e.getInstanceByRoomId(notification.payload.rid);\n\t\t\tif (e2eRoom) {\n\t\t\t\tnotification.text = (await e2eRoom.decrypt(notification.payload.message.msg)).text;\n\t\t\t}\n\t\t}\n\n\t\treturn getAvatarAsPng(notification.payload?.sender?.username, (avatarAsPng) => {\n\t\t\tnotification.icon = avatarAsPng;\n\t\t\treturn this.notify(notification);\n\t\t});\n\t}\n\n\tpublic async newMessage(rid: IRoom['_id'] | undefined) {\n\t\tif ((Meteor.user() as IUser | null)?.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst userId = Meteor.userId();\n\t\tconst newMessageNotification = getUserPreference<string>(userId, 'newMessageNotification');\n\t\tconst audioVolume = getUserPreference(userId, 'notificationsSoundVolume', 100);\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sub = ChatSubscription.findOne({ rid }, { fields: { audioNotificationValue: 1 } });\n\n\t\tif (!sub || sub.audioNotificationValue === 'none') {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tif (sub.audioNotificationValue && sub.audioNotificationValue !== '0') {\n\t\t\t\tvoid CustomSounds.play(sub.audioNotificationValue, {\n\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (newMessageNotification && newMessageNotification !== 'none') {\n\t\t\t\tvoid CustomSounds.play(newMessageNotification, {\n\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// do nothing\n\t\t}\n\t}\n\n\tpublic newRoom(rid: IRoom['_id']) {\n\t\tTracker.nonreactive(() => {\n\t\t\tlet newRoomSound = Session.get('newRoomSound') as IRoom['_id'][] | undefined;\n\t\t\tif (newRoomSound) {\n\t\t\t\tnewRoomSound = [...newRoomSound, rid];\n\t\t\t} else {\n\t\t\t\tnewRoomSound = [rid];\n\t\t\t}\n\n\t\t\treturn Session.set('newRoomSound', newRoomSound);\n\t\t});\n\t}\n\n\tpublic removeRoomNotification(rid: IRoom['_id']) {\n\t\tlet newRoomSound = (Session.get('newRoomSound') as IRoom['_id'][] | undefined) ?? [];\n\t\tnewRoomSound = newRoomSound.filter((_rid) => _rid !== rid);\n\t\tTracker.nonreactive(() => Session.set('newRoomSound', newRoomSound));\n\n\t\tconst link = document.querySelector(`.link-room-${rid}`);\n\n\t\tlink?.classList.remove('new-room-highlight');\n\t}\n}\n\nconst instance = new KonchatNotification();\n\nexport { instance as KonchatNotification };\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/ui/client/lib/KonchatNotification.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/ui/client/lib/KonchatNotification.ts","inputSourceMap":{"version":3,"file":"app/ui/client/lib/KonchatNotification.ts","sourceRoot":"","sources":["app/ui/client/lib/KonchatNotification.ts"],"names":[],"mappings":"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","sourcesContent":["import type { INotificationDesktop, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { Random } from '@rocket.chat/random';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\n\nimport { RoomManager } from '../../../../client/lib/RoomManager';\nimport { onClientMessageReceived } from '../../../../client/lib/onClientMessageReceived';\nimport { getAvatarAsPng } from '../../../../client/lib/utils/getAvatarAsPng';\nimport { router } from '../../../../client/providers/RouterProvider';\nimport { stripTags } from '../../../../lib/utils/stringUtils';\nimport { CustomSounds } from '../../../custom-sounds/client/lib/CustomSounds';\nimport { e2e } from '../../../e2e/client';\nimport { ChatSubscription } from '../../../models/client';\nimport { getUserPreference } from '../../../utils/client';\nimport { getUserAvatarURL } from '../../../utils/client/getUserAvatarURL';\nimport { sdk } from '../../../utils/client/lib/SDKClient';\n\ndeclare global {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface NotificationEventMap {\n\t\treply: { response: string };\n\t}\n}\n\nclass KonchatNotification {\n\tpublic notificationStatus = new ReactiveVar<NotificationPermission | undefined>(undefined);\n\n\tpublic getDesktopPermission() {\n\t\tif (window.Notification && Notification.permission !== 'granted') {\n\t\t\treturn Notification.requestPermission((status) => {\n\t\t\t\tthis.notificationStatus.set(status);\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic async notify(notification: INotificationDesktop) {\n\t\tif (typeof window.Notification === 'undefined' || Notification.permission !== 'granted') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!notification.payload) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { rid } = notification.payload;\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\t\tconst message = await onClientMessageReceived({\n\t\t\trid,\n\t\t\tmsg: notification.text,\n\t\t\tnotification: true,\n\t\t} as any);\n\n\t\tconst requireInteraction = getUserPreference<boolean>(Meteor.userId(), 'desktopNotificationRequireInteraction');\n\t\tconst n = new Notification(notification.title, {\n\t\t\ticon: notification.icon || getUserAvatarURL(notification.payload.sender?.username as string),\n\t\t\tbody: stripTags(message.msg),\n\t\t\ttag: notification.payload._id,\n\t\t\tcanReply: true,\n\t\t\tsilent: true,\n\t\t\trequireInteraction,\n\t\t} as NotificationOptions & {\n\t\t\tcanReply?: boolean; // TODO is this still needed for the desktop app?\n\t\t});\n\n\t\tconst notificationDuration = !requireInteraction ? (notification.duration ?? 0) - 0 || 10 : -1;\n\t\tif (notificationDuration > 0) {\n\t\t\tsetTimeout(() => n.close(), notificationDuration * 1000);\n\t\t}\n\n\t\tif (n.addEventListener) {\n\t\t\tn.addEventListener(\n\t\t\t\t'reply',\n\t\t\t\t({ response }) =>\n\t\t\t\t\tvoid sdk.call('sendMessage', {\n\t\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\t\trid,\n\t\t\t\t\t\tmsg: response,\n\t\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tn.onclick = function () {\n\t\t\tthis.close();\n\t\t\twindow.focus();\n\n\t\t\tif (!notification.payload._id || !notification.payload.rid || !notification.payload.name) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (notification.payload?.type) {\n\t\t\t\tcase 'd':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/direct/:rid/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\trid: notification.payload.rid,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'c':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/channel/:name/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tname: notification.payload.name,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'p':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/group/:name/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tname: notification.payload.name,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'l':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/live/:id/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tid: notification.payload.rid,\n\t\t\t\t\t\t\ttab: 'room-info',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic async showDesktop(notification: INotificationDesktop) {\n\t\tif (!notification.payload.rid) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tnotification.payload?.rid === RoomManager.opened &&\n\t\t\t(typeof window.document.hasFocus === 'function' ? window.document.hasFocus() : undefined)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ((Meteor.user() as IUser | null)?.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (notification.payload?.message?.t === 'e2e') {\n\t\t\tconst e2eRoom = await e2e.getInstanceByRoomId(notification.payload.rid);\n\t\t\tif (e2eRoom) {\n\t\t\t\tnotification.text = (await e2eRoom.decrypt(notification.payload.message.msg)).text;\n\t\t\t}\n\t\t}\n\n\t\treturn getAvatarAsPng(notification.payload?.sender?.username, (avatarAsPng) => {\n\t\t\tnotification.icon = avatarAsPng;\n\t\t\treturn this.notify(notification);\n\t\t});\n\t}\n\n\tpublic async newMessage(rid: IRoom['_id'] | undefined) {\n\t\tif ((Meteor.user() as IUser | null)?.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst userId = Meteor.userId();\n\t\tconst newMessageNotification = getUserPreference<string>(userId, 'newMessageNotification');\n\t\tconst audioVolume = getUserPreference(userId, 'notificationsSoundVolume', 100);\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sub = ChatSubscription.findOne({ rid }, { fields: { audioNotificationValue: 1 } });\n\n\t\tif (!sub || sub.audioNotificationValue === 'none') {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tif (sub.audioNotificationValue && sub.audioNotificationValue !== '0') {\n\t\t\t\tvoid CustomSounds.play(sub.audioNotificationValue, {\n\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (newMessageNotification && newMessageNotification !== 'none') {\n\t\t\t\tvoid CustomSounds.play(newMessageNotification, {\n\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// do nothing\n\t\t}\n\t}\n\n\tpublic newRoom(rid: IRoom['_id']) {\n\t\tTracker.nonreactive(() => {\n\t\t\tlet newRoomSound = Session.get('newRoomSound') as IRoom['_id'][] | undefined;\n\t\t\tif (newRoomSound) {\n\t\t\t\tnewRoomSound = [...newRoomSound, rid];\n\t\t\t} else {\n\t\t\t\tnewRoomSound = [rid];\n\t\t\t}\n\n\t\t\treturn Session.set('newRoomSound', newRoomSound);\n\t\t});\n\t}\n\n\tpublic removeRoomNotification(rid: IRoom['_id']) {\n\t\tlet newRoomSound = (Session.get('newRoomSound') as IRoom['_id'][] | undefined) ?? [];\n\t\tnewRoomSound = newRoomSound.filter((_rid) => _rid !== rid);\n\t\tTracker.nonreactive(() => Session.set('newRoomSound', newRoomSound));\n\n\t\tconst link = document.querySelector(`.link-room-${rid}`);\n\n\t\tlink?.classList.remove('new-room-highlight');\n\t}\n}\n\nconst instance = new KonchatNotification();\n\nexport { instance as KonchatNotification };\n"]}}},"code":"var _regeneratorRuntime;\nmodule.link(\"@babel/runtime/regenerator\", {\n  default: function (v) {\n    _regeneratorRuntime = v;\n  }\n}, 0);\nvar _toConsumableArray;\nmodule.link(\"@babel/runtime/helpers/toConsumableArray\", {\n  default: function (v) {\n    _toConsumableArray = v;\n  }\n}, 1);\nvar _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default: function (v) {\n    _objectSpread = v;\n  }\n}, 2);\nmodule.export({\n  KonchatNotification: function () {\n    return instance;\n  }\n});\nvar Random;\nmodule.link(\"@rocket.chat/random\", {\n  Random: function (v) {\n    Random = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 2);\nvar RoomManager;\nmodule.link(\"../../../../client/lib/RoomManager\", {\n  RoomManager: function (v) {\n    RoomManager = v;\n  }\n}, 3);\nvar onClientMessageReceived;\nmodule.link(\"../../../../client/lib/onClientMessageReceived\", {\n  onClientMessageReceived: function (v) {\n    onClientMessageReceived = v;\n  }\n}, 4);\nvar getAvatarAsPng;\nmodule.link(\"../../../../client/lib/utils/getAvatarAsPng\", {\n  getAvatarAsPng: function (v) {\n    getAvatarAsPng = v;\n  }\n}, 5);\nvar router;\nmodule.link(\"../../../../client/providers/RouterProvider\", {\n  router: function (v) {\n    router = v;\n  }\n}, 6);\nvar stripTags;\nmodule.link(\"../../../../lib/utils/stringUtils\", {\n  stripTags: function (v) {\n    stripTags = v;\n  }\n}, 7);\nvar CustomSounds;\nmodule.link(\"../../../custom-sounds/client/lib/CustomSounds\", {\n  CustomSounds: function (v) {\n    CustomSounds = v;\n  }\n}, 8);\nvar e2e;\nmodule.link(\"../../../e2e/client\", {\n  e2e: function (v) {\n    e2e = v;\n  }\n}, 9);\nvar ChatSubscription;\nmodule.link(\"../../../models/client\", {\n  ChatSubscription: function (v) {\n    ChatSubscription = v;\n  }\n}, 10);\nvar getUserPreference;\nmodule.link(\"../../../utils/client\", {\n  getUserPreference: function (v) {\n    getUserPreference = v;\n  }\n}, 11);\nvar getUserAvatarURL;\nmodule.link(\"../../../utils/client/getUserAvatarURL\", {\n  getUserAvatarURL: function (v) {\n    getUserAvatarURL = v;\n  }\n}, 12);\nvar sdk;\nmodule.link(\"../../../utils/client/lib/SDKClient\", {\n  sdk: function (v) {\n    sdk = v;\n  }\n}, 13);\nvar KonchatNotification = /*#__PURE__*/function () {\n  function KonchatNotification() {\n    this.notificationStatus = new ReactiveVar(undefined);\n  }\n  var _proto = KonchatNotification.prototype;\n  _proto.getDesktopPermission = function () {\n    function getDesktopPermission() {\n      var _this = this;\n      if (window.Notification && Notification.permission !== 'granted') {\n        return Notification.requestPermission(function (status) {\n          _this.notificationStatus.set(status);\n        });\n      }\n    }\n    return getDesktopPermission;\n  }();\n  _proto.notify = function () {\n    function notify(notification) {\n      var _notification$payload, _notification$duratio;\n      var rid, message, requireInteraction, n, notificationDuration;\n      return _regeneratorRuntime.async(function () {\n        function notify$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (!(typeof window.Notification === 'undefined' || Notification.permission !== 'granted')) {\n                _context.next = 2;\n                break;\n              }\n              return _context.abrupt(\"return\");\n            case 2:\n              if (notification.payload) {\n                _context.next = 4;\n                break;\n              }\n              return _context.abrupt(\"return\");\n            case 4:\n              rid = notification.payload.rid;\n              if (rid) {\n                _context.next = 7;\n                break;\n              }\n              return _context.abrupt(\"return\");\n            case 7:\n              _context.next = 9;\n              return _regeneratorRuntime.awrap(onClientMessageReceived({\n                rid: rid,\n                msg: notification.text,\n                notification: true\n              }));\n            case 9:\n              message = _context.sent;\n              requireInteraction = getUserPreference(Meteor.userId(), 'desktopNotificationRequireInteraction');\n              n = new Notification(notification.title, {\n                icon: notification.icon || getUserAvatarURL((_notification$payload = notification.payload.sender) === null || _notification$payload === void 0 ? void 0 : _notification$payload.username),\n                body: stripTags(message.msg),\n                tag: notification.payload._id,\n                canReply: true,\n                silent: true,\n                requireInteraction: requireInteraction\n              });\n              notificationDuration = !requireInteraction ? ((_notification$duratio = notification.duration) !== null && _notification$duratio !== void 0 ? _notification$duratio : 0) - 0 || 10 : -1;\n              if (notificationDuration > 0) {\n                setTimeout(function () {\n                  return n.close();\n                }, notificationDuration * 1000);\n              }\n              if (n.addEventListener) {\n                n.addEventListener('reply', function (_ref) {\n                  var response = _ref.response;\n                  return void sdk.call('sendMessage', {\n                    _id: Random.id(),\n                    rid: rid,\n                    msg: response\n                  });\n                });\n              }\n              n.onclick = function () {\n                var _notification$payload2;\n                this.close();\n                window.focus();\n                if (!notification.payload._id || !notification.payload.rid || !notification.payload.name) {\n                  return;\n                }\n                switch ((_notification$payload2 = notification.payload) === null || _notification$payload2 === void 0 ? void 0 : _notification$payload2.type) {\n                  case 'd':\n                    return router.navigate({\n                      pattern: '/direct/:rid/:tab?/:context?',\n                      params: _objectSpread({\n                        rid: notification.payload.rid\n                      }, notification.payload.tmid && {\n                        tab: 'thread',\n                        context: notification.payload.tmid\n                      }),\n                      search: _objectSpread(_objectSpread({}, router.getSearchParameters()), {}, {\n                        jump: notification.payload._id\n                      })\n                    });\n                  case 'c':\n                    return router.navigate({\n                      pattern: '/channel/:name/:tab?/:context?',\n                      params: _objectSpread({\n                        name: notification.payload.name\n                      }, notification.payload.tmid && {\n                        tab: 'thread',\n                        context: notification.payload.tmid\n                      }),\n                      search: _objectSpread(_objectSpread({}, router.getSearchParameters()), {}, {\n                        jump: notification.payload._id\n                      })\n                    });\n                  case 'p':\n                    return router.navigate({\n                      pattern: '/group/:name/:tab?/:context?',\n                      params: _objectSpread({\n                        name: notification.payload.name\n                      }, notification.payload.tmid && {\n                        tab: 'thread',\n                        context: notification.payload.tmid\n                      }),\n                      search: _objectSpread(_objectSpread({}, router.getSearchParameters()), {}, {\n                        jump: notification.payload._id\n                      })\n                    });\n                  case 'l':\n                    return router.navigate({\n                      pattern: '/live/:id/:tab?/:context?',\n                      params: {\n                        id: notification.payload.rid,\n                        tab: 'room-info'\n                      },\n                      search: _objectSpread(_objectSpread({}, router.getSearchParameters()), {}, {\n                        jump: notification.payload._id\n                      })\n                    });\n                }\n              };\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n        return notify$;\n      }(), null, null, null, Promise);\n    }\n    return notify;\n  }();\n  _proto.showDesktop = function () {\n    function showDesktop(notification) {\n      var _notification$payload3,\n        _Meteor$user,\n        _notification$payload4,\n        _notification$payload5,\n        _notification$payload6,\n        _notification$payload7,\n        _this2 = this;\n      var e2eRoom;\n      return _regeneratorRuntime.async(function () {\n        function showDesktop$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (notification.payload.rid) {\n                _context2.next = 2;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 2:\n              if (!(((_notification$payload3 = notification.payload) === null || _notification$payload3 === void 0 ? void 0 : _notification$payload3.rid) === RoomManager.opened && (typeof window.document.hasFocus === 'function' ? window.document.hasFocus() : undefined))) {\n                _context2.next = 4;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 4:\n              if (!(((_Meteor$user = Meteor.user()) === null || _Meteor$user === void 0 ? void 0 : _Meteor$user.status) === 'busy')) {\n                _context2.next = 6;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 6:\n              if (!(((_notification$payload4 = notification.payload) === null || _notification$payload4 === void 0 ? void 0 : (_notification$payload5 = _notification$payload4.message) === null || _notification$payload5 === void 0 ? void 0 : _notification$payload5.t) === 'e2e')) {\n                _context2.next = 14;\n                break;\n              }\n              _context2.next = 9;\n              return _regeneratorRuntime.awrap(e2e.getInstanceByRoomId(notification.payload.rid));\n            case 9:\n              e2eRoom = _context2.sent;\n              if (!e2eRoom) {\n                _context2.next = 14;\n                break;\n              }\n              _context2.next = 13;\n              return _regeneratorRuntime.awrap(e2eRoom.decrypt(notification.payload.message.msg));\n            case 13:\n              notification.text = _context2.sent.text;\n            case 14:\n              return _context2.abrupt(\"return\", getAvatarAsPng((_notification$payload6 = notification.payload) === null || _notification$payload6 === void 0 ? void 0 : (_notification$payload7 = _notification$payload6.sender) === null || _notification$payload7 === void 0 ? void 0 : _notification$payload7.username, function (avatarAsPng) {\n                notification.icon = avatarAsPng;\n                return _this2.notify(notification);\n              }));\n            case 15:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n        return showDesktop$;\n      }(), null, null, null, Promise);\n    }\n    return showDesktop;\n  }();\n  _proto.newMessage = function () {\n    function newMessage(rid) {\n      var _Meteor$user2;\n      var userId, newMessageNotification, audioVolume, sub;\n      return _regeneratorRuntime.async(function () {\n        function newMessage$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!(((_Meteor$user2 = Meteor.user()) === null || _Meteor$user2 === void 0 ? void 0 : _Meteor$user2.status) === 'busy')) {\n                _context3.next = 2;\n                break;\n              }\n              return _context3.abrupt(\"return\");\n            case 2:\n              userId = Meteor.userId();\n              newMessageNotification = getUserPreference(userId, 'newMessageNotification');\n              audioVolume = getUserPreference(userId, 'notificationsSoundVolume', 100);\n              if (rid) {\n                _context3.next = 7;\n                break;\n              }\n              return _context3.abrupt(\"return\");\n            case 7:\n              sub = ChatSubscription.findOne({\n                rid: rid\n              }, {\n                fields: {\n                  audioNotificationValue: 1\n                }\n              });\n              if (!(!sub || sub.audioNotificationValue === 'none')) {\n                _context3.next = 10;\n                break;\n              }\n              return _context3.abrupt(\"return\");\n            case 10:\n              _context3.prev = 10;\n              if (!(sub.audioNotificationValue && sub.audioNotificationValue !== '0')) {\n                _context3.next = 14;\n                break;\n              }\n              void CustomSounds.play(sub.audioNotificationValue, {\n                volume: Number((audioVolume / 100).toPrecision(2))\n              });\n              return _context3.abrupt(\"return\");\n            case 14:\n              if (newMessageNotification && newMessageNotification !== 'none') {\n                void CustomSounds.play(newMessageNotification, {\n                  volume: Number((audioVolume / 100).toPrecision(2))\n                });\n              }\n              _context3.next = 19;\n              break;\n            case 17:\n              _context3.prev = 17;\n              _context3.t0 = _context3[\"catch\"](10);\n            case 19:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n        return newMessage$;\n      }(), null, null, [[10, 17]], Promise);\n    }\n    return newMessage;\n  }();\n  _proto.newRoom = function () {\n    function newRoom(rid) {\n      Tracker.nonreactive(function () {\n        var newRoomSound = Session.get('newRoomSound');\n        if (newRoomSound) {\n          newRoomSound = [].concat(_toConsumableArray(newRoomSound), [rid]);\n        } else {\n          newRoomSound = [rid];\n        }\n        return Session.set('newRoomSound', newRoomSound);\n      });\n    }\n    return newRoom;\n  }();\n  _proto.removeRoomNotification = function () {\n    function removeRoomNotification(rid) {\n      var _Session$get;\n      var newRoomSound = (_Session$get = Session.get('newRoomSound')) !== null && _Session$get !== void 0 ? _Session$get : [];\n      newRoomSound = newRoomSound.filter(function (_rid) {\n        return _rid !== rid;\n      });\n      Tracker.nonreactive(function () {\n        return Session.set('newRoomSound', newRoomSound);\n      });\n      var link = document.querySelector(\".link-room-\" + rid);\n      link === null || link === void 0 ? void 0 : link.classList.remove('new-room-highlight');\n    }\n    return removeRoomNotification;\n  }();\n  return KonchatNotification;\n}();\nvar instance = new KonchatNotification();","map":{"version":3,"names":["_regeneratorRuntime","module","link","default","v","_toConsumableArray","_objectSpread","export","KonchatNotification","instance","Random","Meteor","ReactiveVar","RoomManager","onClientMessageReceived","getAvatarAsPng","router","stripTags","CustomSounds","e2e","ChatSubscription","getUserPreference","getUserAvatarURL","sdk","notificationStatus","undefined","_proto","prototype","getDesktopPermission","_this","window","Notification","permission","requestPermission","status","set","notify","notification","_notification$payload","_notification$duratio","rid","message","requireInteraction","n","notificationDuration","async","notify$","_context","prev","next","abrupt","payload","awrap","msg","text","sent","userId","title","icon","sender","username","body","tag","_id","canReply","silent","duration","setTimeout","close","addEventListener","_ref","response","call","id","onclick","_notification$payload2","focus","name","type","navigate","pattern","params","tmid","tab","context","search","getSearchParameters","jump","stop","Promise","showDesktop","_notification$payload3","_Meteor$user","_notification$payload4","_notification$payload5","_notification$payload6","_notification$payload7","_this2","e2eRoom","showDesktop$","_context2","opened","document","hasFocus","user","t","getInstanceByRoomId","decrypt","avatarAsPng","newMessage","_Meteor$user2","newMessageNotification","audioVolume","sub","newMessage$","_context3","findOne","fields","audioNotificationValue","play","volume","Number","toPrecision","t0","newRoom","Tracker","nonreactive","newRoomSound","Session","get","concat","removeRoomNotification","_Session$get","filter","_rid","querySelector","classList","remove"],"sources":["app/ui/client/lib/KonchatNotification.ts"],"sourcesContent":["import type { INotificationDesktop, IRoom, IUser } from '@rocket.chat/core-typings';\nimport { Random } from '@rocket.chat/random';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\n\nimport { RoomManager } from '../../../../client/lib/RoomManager';\nimport { onClientMessageReceived } from '../../../../client/lib/onClientMessageReceived';\nimport { getAvatarAsPng } from '../../../../client/lib/utils/getAvatarAsPng';\nimport { router } from '../../../../client/providers/RouterProvider';\nimport { stripTags } from '../../../../lib/utils/stringUtils';\nimport { CustomSounds } from '../../../custom-sounds/client/lib/CustomSounds';\nimport { e2e } from '../../../e2e/client';\nimport { ChatSubscription } from '../../../models/client';\nimport { getUserPreference } from '../../../utils/client';\nimport { getUserAvatarURL } from '../../../utils/client/getUserAvatarURL';\nimport { sdk } from '../../../utils/client/lib/SDKClient';\n\ndeclare global {\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tinterface NotificationEventMap {\n\t\treply: { response: string };\n\t}\n}\n\nclass KonchatNotification {\n\tpublic notificationStatus = new ReactiveVar<NotificationPermission | undefined>(undefined);\n\n\tpublic getDesktopPermission() {\n\t\tif (window.Notification && Notification.permission !== 'granted') {\n\t\t\treturn Notification.requestPermission((status) => {\n\t\t\t\tthis.notificationStatus.set(status);\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic async notify(notification: INotificationDesktop) {\n\t\tif (typeof window.Notification === 'undefined' || Notification.permission !== 'granted') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!notification.payload) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { rid } = notification.payload;\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\t\tconst message = await onClientMessageReceived({\n\t\t\trid,\n\t\t\tmsg: notification.text,\n\t\t\tnotification: true,\n\t\t} as any);\n\n\t\tconst requireInteraction = getUserPreference<boolean>(Meteor.userId(), 'desktopNotificationRequireInteraction');\n\t\tconst n = new Notification(notification.title, {\n\t\t\ticon: notification.icon || getUserAvatarURL(notification.payload.sender?.username as string),\n\t\t\tbody: stripTags(message.msg),\n\t\t\ttag: notification.payload._id,\n\t\t\tcanReply: true,\n\t\t\tsilent: true,\n\t\t\trequireInteraction,\n\t\t} as NotificationOptions & {\n\t\t\tcanReply?: boolean; // TODO is this still needed for the desktop app?\n\t\t});\n\n\t\tconst notificationDuration = !requireInteraction ? (notification.duration ?? 0) - 0 || 10 : -1;\n\t\tif (notificationDuration > 0) {\n\t\t\tsetTimeout(() => n.close(), notificationDuration * 1000);\n\t\t}\n\n\t\tif (n.addEventListener) {\n\t\t\tn.addEventListener(\n\t\t\t\t'reply',\n\t\t\t\t({ response }) =>\n\t\t\t\t\tvoid sdk.call('sendMessage', {\n\t\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\t\trid,\n\t\t\t\t\t\tmsg: response,\n\t\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tn.onclick = function () {\n\t\t\tthis.close();\n\t\t\twindow.focus();\n\n\t\t\tif (!notification.payload._id || !notification.payload.rid || !notification.payload.name) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (notification.payload?.type) {\n\t\t\t\tcase 'd':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/direct/:rid/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\trid: notification.payload.rid,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'c':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/channel/:name/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tname: notification.payload.name,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'p':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/group/:name/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tname: notification.payload.name,\n\t\t\t\t\t\t\t...(notification.payload.tmid && {\n\t\t\t\t\t\t\t\ttab: 'thread',\n\t\t\t\t\t\t\t\tcontext: notification.payload.tmid,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t\tcase 'l':\n\t\t\t\t\treturn router.navigate({\n\t\t\t\t\t\tpattern: '/live/:id/:tab?/:context?',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tid: notification.payload.rid,\n\t\t\t\t\t\t\ttab: 'room-info',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsearch: { ...router.getSearchParameters(), jump: notification.payload._id },\n\t\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic async showDesktop(notification: INotificationDesktop) {\n\t\tif (!notification.payload.rid) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tnotification.payload?.rid === RoomManager.opened &&\n\t\t\t(typeof window.document.hasFocus === 'function' ? window.document.hasFocus() : undefined)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ((Meteor.user() as IUser | null)?.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (notification.payload?.message?.t === 'e2e') {\n\t\t\tconst e2eRoom = await e2e.getInstanceByRoomId(notification.payload.rid);\n\t\t\tif (e2eRoom) {\n\t\t\t\tnotification.text = (await e2eRoom.decrypt(notification.payload.message.msg)).text;\n\t\t\t}\n\t\t}\n\n\t\treturn getAvatarAsPng(notification.payload?.sender?.username, (avatarAsPng) => {\n\t\t\tnotification.icon = avatarAsPng;\n\t\t\treturn this.notify(notification);\n\t\t});\n\t}\n\n\tpublic async newMessage(rid: IRoom['_id'] | undefined) {\n\t\tif ((Meteor.user() as IUser | null)?.status === 'busy') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst userId = Meteor.userId();\n\t\tconst newMessageNotification = getUserPreference<string>(userId, 'newMessageNotification');\n\t\tconst audioVolume = getUserPreference(userId, 'notificationsSoundVolume', 100);\n\n\t\tif (!rid) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst sub = ChatSubscription.findOne({ rid }, { fields: { audioNotificationValue: 1 } });\n\n\t\tif (!sub || sub.audioNotificationValue === 'none') {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tif (sub.audioNotificationValue && sub.audioNotificationValue !== '0') {\n\t\t\t\tvoid CustomSounds.play(sub.audioNotificationValue, {\n\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (newMessageNotification && newMessageNotification !== 'none') {\n\t\t\t\tvoid CustomSounds.play(newMessageNotification, {\n\t\t\t\t\tvolume: Number((audioVolume / 100).toPrecision(2)),\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// do nothing\n\t\t}\n\t}\n\n\tpublic newRoom(rid: IRoom['_id']) {\n\t\tTracker.nonreactive(() => {\n\t\t\tlet newRoomSound = Session.get('newRoomSound') as IRoom['_id'][] | undefined;\n\t\t\tif (newRoomSound) {\n\t\t\t\tnewRoomSound = [...newRoomSound, rid];\n\t\t\t} else {\n\t\t\t\tnewRoomSound = [rid];\n\t\t\t}\n\n\t\t\treturn Session.set('newRoomSound', newRoomSound);\n\t\t});\n\t}\n\n\tpublic removeRoomNotification(rid: IRoom['_id']) {\n\t\tlet newRoomSound = (Session.get('newRoomSound') as IRoom['_id'][] | undefined) ?? [];\n\t\tnewRoomSound = newRoomSound.filter((_rid) => _rid !== rid);\n\t\tTracker.nonreactive(() => Session.set('newRoomSound', newRoomSound));\n\n\t\tconst link = document.querySelector(`.link-room-${rid}`);\n\n\t\tlink?.classList.remove('new-room-highlight');\n\t}\n}\n\nconst instance = new KonchatNotification();\n\nexport { instance as KonchatNotification };\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"b3b1533892049dbd4f95f2f103bc782323ab07da"}
