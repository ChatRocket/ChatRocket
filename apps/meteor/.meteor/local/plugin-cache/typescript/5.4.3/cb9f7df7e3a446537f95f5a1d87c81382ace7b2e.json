{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/hooks/roomActions/useStartCallRoomAction/useVoipMenuOptions.tsx","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"client/hooks/roomActions/useStartCallRoomAction/useVoipMenuOptions.tsx","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/hooks/roomActions/useStartCallRoomAction/useVoipMenuOptions.tsx","inputSourceMap":{"version":3,"file":"client/hooks/roomActions/useStartCallRoomAction/useVoipMenuOptions.tsx","sourceRoot":"","sources":["client/hooks/roomActions/useStartCallRoomAction/useVoipMenuOptions.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Box } from '@rocket.chat/fuselage';\nimport type { GenericMenuItemProps } from '@rocket.chat/ui-client';\nimport { useUserId } from '@rocket.chat/ui-contexts';\nimport { useVoipAPI, useVoipState } from '@rocket.chat/ui-voip';\nimport React, { useMemo } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { useMediaPermissions } from '../../../views/room/composer/messageBox/hooks/useMediaPermissions';\nimport { useRoom } from '../../../views/room/contexts/RoomContext';\nimport { useUserInfoQuery } from '../../useUserInfoQuery';\n\nconst useVoipMenuOptions = () => {\n\tconst { t } = useTranslation();\n\tconst { uids = [] } = useRoom();\n\tconst ownUserId = useUserId();\n\n\tconst [isMicPermissionDenied] = useMediaPermissions('microphone');\n\n\tconst { isEnabled, isRegistered, isInCall } = useVoipState();\n\tconst { makeCall } = useVoipAPI();\n\n\tconst members = useMemo(() => uids.filter((uid) => uid !== ownUserId), [uids, ownUserId]);\n\tconst remoteUserId = members[0];\n\n\tconst { data: { user: remoteUser } = {}, isLoading } = useUserInfoQuery({ userId: remoteUserId }, { enabled: Boolean(remoteUserId) });\n\n\tconst isRemoteRegistered = !!remoteUser?.freeSwitchExtension;\n\tconst isDM = members.length === 1;\n\n\tconst disabled = isMicPermissionDenied || !isDM || !isRemoteRegistered || !isRegistered || isInCall || isLoading;\n\n\tconst title = useMemo(() => {\n\t\tif (isMicPermissionDenied) {\n\t\t\treturn t('Microphone_access_not_allowed');\n\t\t}\n\n\t\tif (isInCall) {\n\t\t\treturn t('Unable_to_make_calls_while_another_is_ongoing');\n\t\t}\n\n\t\treturn disabled ? t('Voice_calling_disabled') : '';\n\t}, [disabled, isInCall, isMicPermissionDenied, t]);\n\n\treturn useMemo(() => {\n\t\tconst items: GenericMenuItemProps[] = [\n\t\t\t{\n\t\t\t\tid: 'start-voip-call',\n\t\t\t\ticon: 'phone',\n\t\t\t\tdisabled,\n\t\t\t\tonClick: () => makeCall(remoteUser?.freeSwitchExtension as string),\n\t\t\t\tcontent: (\n\t\t\t\t\t<Box is='span' title={title}>\n\t\t\t\t\t\t{t('Voice_call')}\n\t\t\t\t\t</Box>\n\t\t\t\t),\n\t\t\t},\n\t\t];\n\n\t\treturn {\n\t\t\titems: isEnabled ? items : [],\n\t\t\tgroups: ['direct'] as const,\n\t\t\tdisabled,\n\t\t\tallowed: isEnabled,\n\t\t\torder: 4,\n\t\t};\n\t}, [disabled, title, t, isEnabled, makeCall, remoteUser?.freeSwitchExtension]);\n};\n\nexport default useVoipMenuOptions;\n"]},"targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/client/hooks/roomActions/useStartCallRoomAction/useVoipMenuOptions.tsx","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"client/hooks/roomActions/useStartCallRoomAction/useVoipMenuOptions.tsx","inputSourceMap":{"version":3,"file":"client/hooks/roomActions/useStartCallRoomAction/useVoipMenuOptions.tsx","sourceRoot":"","sources":["client/hooks/roomActions/useStartCallRoomAction/useVoipMenuOptions.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Box } from '@rocket.chat/fuselage';\nimport type { GenericMenuItemProps } from '@rocket.chat/ui-client';\nimport { useUserId } from '@rocket.chat/ui-contexts';\nimport { useVoipAPI, useVoipState } from '@rocket.chat/ui-voip';\nimport React, { useMemo } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { useMediaPermissions } from '../../../views/room/composer/messageBox/hooks/useMediaPermissions';\nimport { useRoom } from '../../../views/room/contexts/RoomContext';\nimport { useUserInfoQuery } from '../../useUserInfoQuery';\n\nconst useVoipMenuOptions = () => {\n\tconst { t } = useTranslation();\n\tconst { uids = [] } = useRoom();\n\tconst ownUserId = useUserId();\n\n\tconst [isMicPermissionDenied] = useMediaPermissions('microphone');\n\n\tconst { isEnabled, isRegistered, isInCall } = useVoipState();\n\tconst { makeCall } = useVoipAPI();\n\n\tconst members = useMemo(() => uids.filter((uid) => uid !== ownUserId), [uids, ownUserId]);\n\tconst remoteUserId = members[0];\n\n\tconst { data: { user: remoteUser } = {}, isLoading } = useUserInfoQuery({ userId: remoteUserId }, { enabled: Boolean(remoteUserId) });\n\n\tconst isRemoteRegistered = !!remoteUser?.freeSwitchExtension;\n\tconst isDM = members.length === 1;\n\n\tconst disabled = isMicPermissionDenied || !isDM || !isRemoteRegistered || !isRegistered || isInCall || isLoading;\n\n\tconst title = useMemo(() => {\n\t\tif (isMicPermissionDenied) {\n\t\t\treturn t('Microphone_access_not_allowed');\n\t\t}\n\n\t\tif (isInCall) {\n\t\t\treturn t('Unable_to_make_calls_while_another_is_ongoing');\n\t\t}\n\n\t\treturn disabled ? t('Voice_calling_disabled') : '';\n\t}, [disabled, isInCall, isMicPermissionDenied, t]);\n\n\treturn useMemo(() => {\n\t\tconst items: GenericMenuItemProps[] = [\n\t\t\t{\n\t\t\t\tid: 'start-voip-call',\n\t\t\t\ticon: 'phone',\n\t\t\t\tdisabled,\n\t\t\t\tonClick: () => makeCall(remoteUser?.freeSwitchExtension as string),\n\t\t\t\tcontent: (\n\t\t\t\t\t<Box is='span' title={title}>\n\t\t\t\t\t\t{t('Voice_call')}\n\t\t\t\t\t</Box>\n\t\t\t\t),\n\t\t\t},\n\t\t];\n\n\t\treturn {\n\t\t\titems: isEnabled ? items : [],\n\t\t\tgroups: ['direct'] as const,\n\t\t\tdisabled,\n\t\t\tallowed: isEnabled,\n\t\t\torder: 4,\n\t\t};\n\t}, [disabled, title, t, isEnabled, makeCall, remoteUser?.freeSwitchExtension]);\n};\n\nexport default useVoipMenuOptions;\n"]}}},"code":"var _slicedToArray;\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 0);\nvar Box;\nmodule.link(\"@rocket.chat/fuselage\", {\n  Box: function (v) {\n    Box = v;\n  }\n}, 0);\nvar useUserId;\nmodule.link(\"@rocket.chat/ui-contexts\", {\n  useUserId: function (v) {\n    useUserId = v;\n  }\n}, 1);\nvar useVoipAPI, useVoipState;\nmodule.link(\"@rocket.chat/ui-voip\", {\n  useVoipAPI: function (v) {\n    useVoipAPI = v;\n  },\n  useVoipState: function (v) {\n    useVoipState = v;\n  }\n}, 2);\nvar React, useMemo;\nmodule.link(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  useMemo: function (v) {\n    useMemo = v;\n  }\n}, 3);\nvar useTranslation;\nmodule.link(\"react-i18next\", {\n  useTranslation: function (v) {\n    useTranslation = v;\n  }\n}, 4);\nvar useMediaPermissions;\nmodule.link(\"../../../views/room/composer/messageBox/hooks/useMediaPermissions\", {\n  useMediaPermissions: function (v) {\n    useMediaPermissions = v;\n  }\n}, 5);\nvar useRoom;\nmodule.link(\"../../../views/room/contexts/RoomContext\", {\n  useRoom: function (v) {\n    useRoom = v;\n  }\n}, 6);\nvar useUserInfoQuery;\nmodule.link(\"../../useUserInfoQuery\", {\n  useUserInfoQuery: function (v) {\n    useUserInfoQuery = v;\n  }\n}, 7);\nvar useVoipMenuOptions = function () {\n  var _useTranslation = useTranslation(),\n    t = _useTranslation.t;\n  var _useRoom = useRoom(),\n    _useRoom$uids = _useRoom.uids,\n    uids = _useRoom$uids === void 0 ? [] : _useRoom$uids;\n  var ownUserId = useUserId();\n  var _useMediaPermissions = useMediaPermissions('microphone'),\n    _useMediaPermissions2 = _slicedToArray(_useMediaPermissions, 1),\n    isMicPermissionDenied = _useMediaPermissions2[0];\n  var _useVoipState = useVoipState(),\n    isEnabled = _useVoipState.isEnabled,\n    isRegistered = _useVoipState.isRegistered,\n    isInCall = _useVoipState.isInCall;\n  var _useVoipAPI = useVoipAPI(),\n    makeCall = _useVoipAPI.makeCall;\n  var members = useMemo(function () {\n    return uids.filter(function (uid) {\n      return uid !== ownUserId;\n    });\n  }, [uids, ownUserId]);\n  var remoteUserId = members[0];\n  var _useUserInfoQuery = useUserInfoQuery({\n      userId: remoteUserId\n    }, {\n      enabled: Boolean(remoteUserId)\n    }),\n    _useUserInfoQuery$dat = _useUserInfoQuery.data;\n  _useUserInfoQuery$dat = _useUserInfoQuery$dat === void 0 ? {} : _useUserInfoQuery$dat;\n  var remoteUser = _useUserInfoQuery$dat.user,\n    isLoading = _useUserInfoQuery.isLoading;\n  var isRemoteRegistered = !!(remoteUser !== null && remoteUser !== void 0 && remoteUser.freeSwitchExtension);\n  var isDM = members.length === 1;\n  var disabled = isMicPermissionDenied || !isDM || !isRemoteRegistered || !isRegistered || isInCall || isLoading;\n  var title = useMemo(function () {\n    if (isMicPermissionDenied) {\n      return t('Microphone_access_not_allowed');\n    }\n    if (isInCall) {\n      return t('Unable_to_make_calls_while_another_is_ongoing');\n    }\n    return disabled ? t('Voice_calling_disabled') : '';\n  }, [disabled, isInCall, isMicPermissionDenied, t]);\n  return useMemo(function () {\n    var items = [{\n      id: 'start-voip-call',\n      icon: 'phone',\n      disabled: disabled,\n      onClick: function () {\n        return makeCall(remoteUser === null || remoteUser === void 0 ? void 0 : remoteUser.freeSwitchExtension);\n      },\n      content: /*#__PURE__*/React.createElement(Box, {\n        is: \"span\",\n        title: title\n      }, t('Voice_call'))\n    }];\n    return {\n      items: isEnabled ? items : [],\n      groups: ['direct'],\n      disabled: disabled,\n      allowed: isEnabled,\n      order: 4\n    };\n  }, [disabled, title, t, isEnabled, makeCall, remoteUser === null || remoteUser === void 0 ? void 0 : remoteUser.freeSwitchExtension]);\n};\nmodule.exportDefault(useVoipMenuOptions);","map":{"version":3,"names":["_slicedToArray","module","link","default","v","Box","useUserId","useVoipAPI","useVoipState","React","useMemo","useTranslation","useMediaPermissions","useRoom","useUserInfoQuery","useVoipMenuOptions","_useTranslation","t","_useRoom","_useRoom$uids","uids","ownUserId","_useMediaPermissions","_useMediaPermissions2","isMicPermissionDenied","_useVoipState","isEnabled","isRegistered","isInCall","_useVoipAPI","makeCall","members","filter","uid","remoteUserId","_useUserInfoQuery","userId","enabled","Boolean","_useUserInfoQuery$dat","data","remoteUser","user","isLoading","isRemoteRegistered","freeSwitchExtension","isDM","length","disabled","title","items","id","icon","onClick","content","createElement","is","groups","allowed","order","exportDefault"],"sources":["client/hooks/roomActions/useStartCallRoomAction/useVoipMenuOptions.tsx"],"sourcesContent":["import { Box } from '@rocket.chat/fuselage';\nimport type { GenericMenuItemProps } from '@rocket.chat/ui-client';\nimport { useUserId } from '@rocket.chat/ui-contexts';\nimport { useVoipAPI, useVoipState } from '@rocket.chat/ui-voip';\nimport React, { useMemo } from 'react';\nimport { useTranslation } from 'react-i18next';\n\nimport { useMediaPermissions } from '../../../views/room/composer/messageBox/hooks/useMediaPermissions';\nimport { useRoom } from '../../../views/room/contexts/RoomContext';\nimport { useUserInfoQuery } from '../../useUserInfoQuery';\n\nconst useVoipMenuOptions = () => {\n\tconst { t } = useTranslation();\n\tconst { uids = [] } = useRoom();\n\tconst ownUserId = useUserId();\n\n\tconst [isMicPermissionDenied] = useMediaPermissions('microphone');\n\n\tconst { isEnabled, isRegistered, isInCall } = useVoipState();\n\tconst { makeCall } = useVoipAPI();\n\n\tconst members = useMemo(() => uids.filter((uid) => uid !== ownUserId), [uids, ownUserId]);\n\tconst remoteUserId = members[0];\n\n\tconst { data: { user: remoteUser } = {}, isLoading } = useUserInfoQuery({ userId: remoteUserId }, { enabled: Boolean(remoteUserId) });\n\n\tconst isRemoteRegistered = !!remoteUser?.freeSwitchExtension;\n\tconst isDM = members.length === 1;\n\n\tconst disabled = isMicPermissionDenied || !isDM || !isRemoteRegistered || !isRegistered || isInCall || isLoading;\n\n\tconst title = useMemo(() => {\n\t\tif (isMicPermissionDenied) {\n\t\t\treturn t('Microphone_access_not_allowed');\n\t\t}\n\n\t\tif (isInCall) {\n\t\t\treturn t('Unable_to_make_calls_while_another_is_ongoing');\n\t\t}\n\n\t\treturn disabled ? t('Voice_calling_disabled') : '';\n\t}, [disabled, isInCall, isMicPermissionDenied, t]);\n\n\treturn useMemo(() => {\n\t\tconst items: GenericMenuItemProps[] = [\n\t\t\t{\n\t\t\t\tid: 'start-voip-call',\n\t\t\t\ticon: 'phone',\n\t\t\t\tdisabled,\n\t\t\t\tonClick: () => makeCall(remoteUser?.freeSwitchExtension as string),\n\t\t\t\tcontent: (\n\t\t\t\t\t<Box is='span' title={title}>\n\t\t\t\t\t\t{t('Voice_call')}\n\t\t\t\t\t</Box>\n\t\t\t\t),\n\t\t\t},\n\t\t];\n\n\t\treturn {\n\t\t\titems: isEnabled ? items : [],\n\t\t\tgroups: ['direct'] as const,\n\t\t\tdisabled,\n\t\t\tallowed: isEnabled,\n\t\t\torder: 4,\n\t\t};\n\t}, [disabled, title, t, isEnabled, makeCall, remoteUser?.freeSwitchExtension]);\n};\n\nexport default useVoipMenuOptions;\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"cb9f7df7e3a446537f95f5a1d87c81382ace7b2e"}
