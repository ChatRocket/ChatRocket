{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/rocketchat:restivus/lib/restivus.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"packages/rocketchat:restivus/lib/restivus.js","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/rocketchat:restivus/lib/restivus.js","targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/rocketchat:restivus/lib/restivus.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/rocketchat:restivus/lib/restivus.js"}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let _objectSpread;\n    module.link(\"@babel/runtime/helpers/objectSpread2\", {\n      default(v) {\n        _objectSpread = v;\n      }\n    }, 0);\n    module.export({\n      Restivus: () => Restivus\n    });\n    let Accounts;\n    module.link(\"meteor/accounts-base\", {\n      Accounts(v) {\n        Accounts = v;\n      }\n    }, 0);\n    let Users;\n    module.link(\"@rocket.chat/models\", {\n      Users(v) {\n        Users = v;\n      }\n    }, 1);\n    let Auth;\n    module.link(\"./auth\", {\n      Auth(v) {\n        Auth = v;\n      }\n    }, 2);\n    let Route;\n    module.link(\"./route\", {\n      Route(v) {\n        Route = v;\n      }\n    }, 3);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    class Restivus {\n      constructor(options) {\n        this._routes = [];\n        this._config = _objectSpread({\n          paths: [],\n          useDefaultAuth: false,\n          apiPath: 'api/',\n          version: null,\n          prettyJson: false,\n          auth: {\n            token: 'services.resume.loginTokens.hashedToken',\n            user() {\n              let token;\n              if (this.request.headers['x-auth-token']) {\n                token = Accounts._hashLoginToken(this.request.headers['x-auth-token']);\n              }\n              return {\n                userId: this.request.headers['x-user-id'],\n                token\n              };\n            }\n          },\n          defaultHeaders: {\n            'Content-Type': 'application/json'\n          },\n          enableCors: true\n        }, options);\n        if (this._config.enableCors) {\n          const corsHeaders = {\n            'Access-Control-Allow-Origin': '*',\n            'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept'\n          };\n          if (this._config.useDefaultAuth) {\n            corsHeaders['Access-Control-Allow-Headers'] += ', X-User-Id, X-Auth-Token';\n          }\n          this._config.defaultHeaders = _objectSpread(_objectSpread({}, this._config.defaultHeaders), corsHeaders);\n          if (!this._config.defaultOptionsEndpoint) {\n            this._config.defaultOptionsEndpoint = function () {\n              this.response.writeHead(200, corsHeaders);\n              return this.done();\n            };\n          }\n        }\n        if (this._config.apiPath.startsWith('/')) {\n          this._config.apiPath = this._config.apiPath.slice(1);\n        }\n        if (!this._config.apiPath.endsWith('/')) {\n          this._config.apiPath = \"\".concat(this._config.apiPath, \"/\");\n        }\n        if (this._config.version) {\n          this._config.apiPath += \"\".concat(this._config.version, \"/\");\n        }\n        if (this._config.useDefaultAuth) {\n          this._initAuth();\n        } else if (this._config.useAuth) {\n          this._initAuth();\n          console.warn('Warning: useAuth API config option will be removed in Restivus v1.0 \\n    Use the useDefaultAuth option instead');\n        }\n      }\n\n      /**\n       \tAdd endpoints for the given HTTP methods at the given path\n      \t\t@param path {String} The extended URL path (will be appended to base path of the API)\n      \t@param options {Object} Route configuration options\n      \t@param options.authRequired {Boolean} The default auth requirement for each endpoint on the route\n      \t@param options.roleRequired {String or String[]} The default role required for each endpoint on the route\n      \t@param endpoints {Object} A set of endpoints available on the new route (get, post, put, patch, delete, options)\n      \t@param endpoints.<method> {Function or Object} If a function is provided, all default route\n      \t\tconfiguration options will be applied to the endpoint. Otherwise an object with an `action`\n      \t\tand all other route config options available. An `action` must be provided with the object.\n      */\n\n      addRoute(path, options, endpoints) {\n        const route = new Route(this, path, options, endpoints);\n        this._routes.push(route);\n        route.addToApi();\n        return this;\n      }\n\n      /*\n      \tAdd /login and /logout endpoints to the API\n      */\n\n      _initAuth() {\n        const self = this;\n\n        /*\n        \tAdd a login endpoint to the API\n        \t\tAfter the user is logged in, the onLoggedIn hook is called (see Restfully.configure() for\n        \tadding hook).\n        */\n        this.addRoute('login', {\n          authRequired: false\n        }, {\n          async post() {\n            var _self$_config$onLogge;\n            const user = {};\n            if (this.bodyParams.user) {\n              if (this.bodyParams.user.indexOf('@') === -1) {\n                user.username = this.bodyParams.user;\n              } else {\n                user.email = this.bodyParams.user;\n              }\n            } else if (this.bodyParams.username) {\n              user.username = this.bodyParams.username;\n            } else if (this.bodyParams.email) {\n              user.email = this.bodyParams.email;\n            }\n            let {\n              password\n            } = this.bodyParams;\n            if (this.bodyParams.hashed) {\n              password = {\n                digest: password,\n                algorithm: 'sha-256'\n              };\n            }\n            let auth;\n            try {\n              auth = await Auth.loginWithPassword(user, password);\n            } catch (e) {\n              return {\n                statusCode: e.error\n              };\n            }\n            if (auth.userId && auth.authToken) {\n              var _this$user;\n              const searchQuery = {};\n              searchQuery[self._config.auth.token] = Accounts._hashLoginToken(auth.authToken);\n              this.user = await Users.findOne({\n                _id: auth.userId\n              }, searchQuery);\n              this.userId = (_this$user = this.user) === null || _this$user === void 0 ? void 0 : _this$user._id;\n            }\n            const response = {\n              status: 'success',\n              data: auth\n            };\n            const extraData = (_self$_config$onLogge = self._config.onLoggedIn) === null || _self$_config$onLogge === void 0 ? void 0 : _self$_config$onLogge.call(this);\n            if (extraData != null) {\n              Object.assign(response.data, {\n                extra: extraData\n              });\n            }\n            return response;\n          }\n        });\n        const logout = async function () {\n          var _self$_config$onLogge2;\n          const authToken = this.request.headers['x-auth-token'];\n          const hashedToken = Accounts._hashLoginToken(authToken);\n          const tokenLocation = self._config.auth.token;\n          const index = tokenLocation.lastIndexOf('.');\n          const tokenPath = tokenLocation.substring(0, index);\n          const tokenFieldName = tokenLocation.substring(index + 1);\n          const tokenToRemove = {};\n          tokenToRemove[tokenFieldName] = hashedToken;\n          const tokenRemovalQuery = {};\n          tokenRemovalQuery[tokenPath] = tokenToRemove;\n          await Users.updateOne({\n            _id: this.user._id\n          }, {\n            $pull: tokenRemovalQuery\n          });\n          const response = {\n            status: 'success',\n            data: {\n              message: \"You've been logged out!\"\n            }\n          };\n          const extraData = (_self$_config$onLogge2 = self._config.onLoggedOut) === null || _self$_config$onLogge2 === void 0 ? void 0 : _self$_config$onLogge2.call(this);\n          if (extraData != null) {\n            Object.assign(response.data, {\n              extra: extraData\n            });\n          }\n          return response;\n        };\n\n        /*\n        \tAdd a logout endpoint to the API\n        \t\tAfter the user is logged out, the onLoggedOut hook is called (see Restfully.configure() for\n        \tadding hook).\n        */\n        return this.addRoute('logout', {\n          authRequired: true\n        }, {\n          async get() {\n            console.warn('Warning: Default logout via GET will be removed in Restivus v1.0. Use POST instead.');\n            console.warn('    See https://github.com/kahmali/meteor-restivus/issues/100');\n            return logout.call(this);\n          },\n          post: logout\n        });\n      }\n    }\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["_objectSpread","module","link","default","v","export","Restivus","Accounts","Users","Auth","Route","__reifyWaitForDeps__","constructor","options","_routes","_config","paths","useDefaultAuth","apiPath","version","prettyJson","auth","token","user","request","headers","_hashLoginToken","userId","defaultHeaders","enableCors","corsHeaders","defaultOptionsEndpoint","response","writeHead","done","startsWith","slice","endsWith","concat","_initAuth","useAuth","console","warn","addRoute","path","endpoints","route","push","addToApi","self","authRequired","post","_self$_config$onLogge","bodyParams","indexOf","username","email","password","hashed","digest","algorithm","loginWithPassword","e","statusCode","error","authToken","_this$user","searchQuery","findOne","_id","status","data","extraData","onLoggedIn","call","Object","assign","extra","logout","_self$_config$onLogge2","hashedToken","tokenLocation","index","lastIndexOf","tokenPath","substring","tokenFieldName","tokenToRemove","tokenRemovalQuery","updateOne","$pull","message","onLoggedOut","get","__reify_async_result__","_reifyError","async"],"sources":["packages/rocketchat:restivus/lib/restivus.js"],"sourcesContent":["import { Accounts } from 'meteor/accounts-base';\nimport { Users } from '@rocket.chat/models';\n\nimport { Auth } from './auth';\nimport { Route } from './route';\n\nexport class Restivus {\n\tconstructor(options) {\n\t\tthis._routes = [];\n\t\tthis._config = {\n\t\t\tpaths: [],\n\t\t\tuseDefaultAuth: false,\n\t\t\tapiPath: 'api/',\n\t\t\tversion: null,\n\t\t\tprettyJson: false,\n\t\t\tauth: {\n\t\t\t\ttoken: 'services.resume.loginTokens.hashedToken',\n\t\t\t\tuser() {\n\t\t\t\t\tlet token;\n\t\t\t\t\tif (this.request.headers['x-auth-token']) {\n\t\t\t\t\t\ttoken = Accounts._hashLoginToken(this.request.headers['x-auth-token']);\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\tuserId: this.request.headers['x-user-id'],\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\tdefaultHeaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t\tenableCors: true,\n\t\t\t...options,\n\t\t};\n\n\t\tif (this._config.enableCors) {\n\t\t\tconst corsHeaders = {\n\t\t\t\t'Access-Control-Allow-Origin': '*',\n\t\t\t\t'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept',\n\t\t\t};\n\t\t\tif (this._config.useDefaultAuth) {\n\t\t\t\tcorsHeaders['Access-Control-Allow-Headers'] += ', X-User-Id, X-Auth-Token';\n\t\t\t}\n\t\t\tthis._config.defaultHeaders = {\n\t\t\t\t...this._config.defaultHeaders,\n\t\t\t\t...corsHeaders,\n\t\t\t};\n\t\t\tif (!this._config.defaultOptionsEndpoint) {\n\t\t\t\tthis._config.defaultOptionsEndpoint = function () {\n\t\t\t\t\tthis.response.writeHead(200, corsHeaders);\n\t\t\t\t\treturn this.done();\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tif (this._config.apiPath.startsWith('/')) {\n\t\t\tthis._config.apiPath = this._config.apiPath.slice(1);\n\t\t}\n\t\tif (!this._config.apiPath.endsWith('/')) {\n\t\t\tthis._config.apiPath = `${this._config.apiPath}/`;\n\t\t}\n\t\tif (this._config.version) {\n\t\t\tthis._config.apiPath += `${this._config.version}/`;\n\t\t}\n\t\tif (this._config.useDefaultAuth) {\n\t\t\tthis._initAuth();\n\t\t} else if (this._config.useAuth) {\n\t\t\tthis._initAuth();\n\t\t\tconsole.warn('Warning: useAuth API config option will be removed in Restivus v1.0 \\n    Use the useDefaultAuth option instead');\n\t\t}\n\t}\n\n\t/**\n\t \tAdd endpoints for the given HTTP methods at the given path\n\n\t\t@param path {String} The extended URL path (will be appended to base path of the API)\n\t\t@param options {Object} Route configuration options\n\t\t@param options.authRequired {Boolean} The default auth requirement for each endpoint on the route\n\t\t@param options.roleRequired {String or String[]} The default role required for each endpoint on the route\n\t\t@param endpoints {Object} A set of endpoints available on the new route (get, post, put, patch, delete, options)\n\t\t@param endpoints.<method> {Function or Object} If a function is provided, all default route\n\t\t\tconfiguration options will be applied to the endpoint. Otherwise an object with an `action`\n\t\t\tand all other route config options available. An `action` must be provided with the object.\n\t*/\n\n\taddRoute(path, options, endpoints) {\n\t\tconst route = new Route(this, path, options, endpoints);\n\t\tthis._routes.push(route);\n\t\troute.addToApi();\n\t\treturn this;\n\t}\n\n\t/*\n\t\tAdd /login and /logout endpoints to the API\n\t*/\n\n\t_initAuth() {\n\t\tconst self = this;\n\n\t\t/*\n\t\t\tAdd a login endpoint to the API\n\n\t\t\tAfter the user is logged in, the onLoggedIn hook is called (see Restfully.configure() for\n\t\t\tadding hook).\n\t\t*/\n\t\tthis.addRoute(\n\t\t\t'login',\n\t\t\t{ authRequired: false },\n\t\t\t{\n\t\t\t\tasync post() {\n\t\t\t\t\tconst user = {};\n\t\t\t\t\tif (this.bodyParams.user) {\n\t\t\t\t\t\tif (this.bodyParams.user.indexOf('@') === -1) {\n\t\t\t\t\t\t\tuser.username = this.bodyParams.user;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tuser.email = this.bodyParams.user;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (this.bodyParams.username) {\n\t\t\t\t\t\tuser.username = this.bodyParams.username;\n\t\t\t\t\t} else if (this.bodyParams.email) {\n\t\t\t\t\t\tuser.email = this.bodyParams.email;\n\t\t\t\t\t}\n\t\t\t\t\tlet { password } = this.bodyParams;\n\t\t\t\t\tif (this.bodyParams.hashed) {\n\t\t\t\t\t\tpassword = {\n\t\t\t\t\t\t\tdigest: password,\n\t\t\t\t\t\t\talgorithm: 'sha-256',\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tlet auth;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tauth = await Auth.loginWithPassword(user, password);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tstatusCode: e.error,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tif (auth.userId && auth.authToken) {\n\t\t\t\t\t\tconst searchQuery = {};\n\t\t\t\t\t\tsearchQuery[self._config.auth.token] = Accounts._hashLoginToken(auth.authToken);\n\t\t\t\t\t\tthis.user = await Users.findOne(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t_id: auth.userId,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsearchQuery,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.userId = this.user?._id;\n\t\t\t\t\t}\n\t\t\t\t\tconst response = {\n\t\t\t\t\t\tstatus: 'success',\n\t\t\t\t\t\tdata: auth,\n\t\t\t\t\t};\n\t\t\t\t\tconst extraData = self._config.onLoggedIn?.call(this);\n\t\t\t\t\tif (extraData != null) {\n\t\t\t\t\t\tObject.assign(response.data, {\n\t\t\t\t\t\t\textra: extraData,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn response;\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t\tconst logout = async function () {\n\t\t\tconst authToken = this.request.headers['x-auth-token'];\n\t\t\tconst hashedToken = Accounts._hashLoginToken(authToken);\n\t\t\tconst tokenLocation = self._config.auth.token;\n\t\t\tconst index = tokenLocation.lastIndexOf('.');\n\t\t\tconst tokenPath = tokenLocation.substring(0, index);\n\t\t\tconst tokenFieldName = tokenLocation.substring(index + 1);\n\t\t\tconst tokenToRemove = {};\n\t\t\ttokenToRemove[tokenFieldName] = hashedToken;\n\t\t\tconst tokenRemovalQuery = {};\n\t\t\ttokenRemovalQuery[tokenPath] = tokenToRemove;\n\t\t\tawait Users.updateOne(\n\t\t\t\t{ _id: this.user._id },\n\t\t\t\t{\n\t\t\t\t\t$pull: tokenRemovalQuery,\n\t\t\t\t},\n\t\t\t);\n\t\t\tconst response = {\n\t\t\t\tstatus: 'success',\n\t\t\t\tdata: {\n\t\t\t\t\tmessage: \"You've been logged out!\",\n\t\t\t\t},\n\t\t\t};\n\t\t\tconst extraData = self._config.onLoggedOut?.call(this);\n\t\t\tif (extraData != null) {\n\t\t\t\tObject.assign(response.data, {\n\t\t\t\t\textra: extraData,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn response;\n\t\t};\n\n\t\t/*\n\t\t\tAdd a logout endpoint to the API\n\n\t\t\tAfter the user is logged out, the onLoggedOut hook is called (see Restfully.configure() for\n\t\t\tadding hook).\n\t\t*/\n\t\treturn this.addRoute(\n\t\t\t'logout',\n\t\t\t{ authRequired: true },\n\t\t\t{\n\t\t\t\tasync get() {\n\t\t\t\t\tconsole.warn('Warning: Default logout via GET will be removed in Restivus v1.0. Use POST instead.');\n\t\t\t\t\tconsole.warn('    See https://github.com/kahmali/meteor-restivus/issues/100');\n\t\t\t\t\treturn logout.call(this);\n\t\t\t\t},\n\t\t\t\tpost: logout,\n\t\t\t},\n\t\t);\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"1c45b26081790fe2166eea7659bef4ed82e87b3f"}
