{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/ddp-client/client/queueStubsHelpers.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/ddp-client/client/queueStubsHelpers.js","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/ddp-client/client/queueStubsHelpers.js","targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/ddp-client/client/queueStubsHelpers.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/ddp-client/client/queueStubsHelpers.js"}},"code":"let _objectSpread;\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n}, 0);\nmodule.export({\n  loadAsyncStubHelpers: () => loadAsyncStubHelpers\n});\nlet DDP;\nmodule.link(\"../common/namespace.js\", {\n  DDP(v) {\n    DDP = v;\n  }\n}, 0);\nlet Connection;\nmodule.link(\"../common/livedata_connection\", {\n  Connection(v) {\n    Connection = v;\n  }\n}, 1);\n// https://forums.meteor.com/t/proposal-to-fix-issues-with-async-method-stubs/60826\n\nlet queueSize = 0;\nlet queue = Promise.resolve();\nconst loadAsyncStubHelpers = () => {\n  function queueFunction(fn) {\n    let promiseProps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    queueSize += 1;\n    let resolve;\n    let reject;\n    const promise = new Promise((_resolve, _reject) => {\n      resolve = _resolve;\n      reject = _reject;\n    });\n    queue = queue.finally(() => {\n      var _promise$stubPromise;\n      fn(resolve, reject);\n      return (_promise$stubPromise = promise.stubPromise) === null || _promise$stubPromise === void 0 ? void 0 : _promise$stubPromise.catch(() => {}); // silent uncaught promise\n    });\n    promise.catch(() => {}) // silent uncaught promise\n    .finally(() => {\n      queueSize -= 1;\n      if (queueSize === 0) {\n        Meteor.connection._maybeMigrate();\n      }\n    });\n    promise.stubPromise = promiseProps.stubPromise;\n    promise.serverPromise = promiseProps.serverPromise;\n    return promise;\n  }\n  let oldReadyToMigrate = Connection.prototype._readyToMigrate;\n  Connection.prototype._readyToMigrate = function () {\n    if (queueSize > 0) {\n      return false;\n    }\n    return oldReadyToMigrate.apply(this, arguments);\n  };\n  let currentMethodInvocation = null;\n\n  /**\n   * Meteor sets CurrentMethodInvocation to undefined for the reasons explained at\n   * https://github.com/meteor/meteor/blob/c9e3551b9673a7ed607f18cb1128563ff49ca96f/packages/ddp-client/common/livedata_connection.js#L578-L605\n   * The app code could call `.then` on a promise while the async stub is running,\n   * causing the `then` callback to think it is inside the stub.\n   *\n   * With the queueing we are doing, this is no longer necessary. The point\n   * of the queueing is to prevent app/package code from running while\n   * the stub is running, so we don't need to worry about this.\n   */\n\n  let oldApplyAsync = Connection.prototype.applyAsync;\n  Connection.prototype.applyAsync = function () {\n    let args = arguments;\n    let name = args[0];\n    if (currentMethodInvocation) {\n      DDP._CurrentMethodInvocation._set(currentMethodInvocation);\n      currentMethodInvocation = null;\n    }\n    const enclosing = DDP._CurrentMethodInvocation.get();\n    const alreadyInSimulation = enclosing === null || enclosing === void 0 ? void 0 : enclosing.isSimulation;\n    const isFromCallAsync = enclosing === null || enclosing === void 0 ? void 0 : enclosing._isFromCallAsync;\n    if (Meteor.connection._getIsSimulation({\n      isFromCallAsync,\n      alreadyInSimulation\n    })) {\n      // In stub - call immediately\n      return oldApplyAsync.apply(this, args);\n    }\n    let stubPromiseResolver;\n    let serverPromiseResolver;\n    const stubPromise = new Promise(r => stubPromiseResolver = r);\n    const serverPromise = new Promise(r => serverPromiseResolver = r);\n    return queueFunction((resolve, reject) => {\n      let finished = false;\n      Meteor._setImmediate(() => {\n        const applyAsyncPromise = oldApplyAsync.apply(this, args);\n        stubPromiseResolver(applyAsyncPromise.stubPromise);\n        serverPromiseResolver(applyAsyncPromise.serverPromise);\n        applyAsyncPromise.stubPromise.catch(() => {}) // silent uncaught promise\n        .finally(() => {\n          finished = true;\n        });\n        applyAsyncPromise.then(result => {\n          resolve(result);\n        }).catch(err => {\n          reject(err);\n        });\n        serverPromise.catch(() => {}); // silent uncaught promise\n      });\n      Meteor._setImmediate(() => {\n        if (!finished) {\n          console.warn(\"Method stub (\".concat(name, \") took too long and could cause unexpected problems. Learn more at https://v3-migration-docs.meteor.com/breaking-changes/call-x-callAsync.html#considerations-for-effective-use-of-meteor-callasync\"));\n        }\n      });\n    }, {\n      stubPromise,\n      serverPromise\n    });\n  };\n  let oldApply = Connection.prototype.apply;\n  Connection.prototype.apply = function (name, args, options, callback) {\n    if (this._stream._neverQueued) {\n      return oldApply.apply(this, arguments);\n    }\n\n    // Apply runs the stub before synchronously returning.\n    //\n    // However, we want the server to run the methods in the original call order\n    // so we have to queue sending the message to the server until any previous async\n    // methods run.\n    // This does mean the stubs run in a different order than the methods on the\n    // server.\n\n    if (!callback && typeof options === 'function') {\n      callback = options;\n      options = undefined;\n    }\n    let {\n      methodInvoker,\n      result\n    } = oldApply.call(this, name, args, _objectSpread(_objectSpread({}, options), {}, {\n      _returnMethodInvoker: true\n    }), callback);\n    if (methodInvoker) {\n      queueFunction(resolve => {\n        return this._addOutstandingMethod(methodInvoker, options);\n        resolve();\n      });\n    }\n    return result;\n  };\n\n  /**\n   * Queue subscriptions in case they rely on previous method calls\n   */\n  let queueSend = false;\n  let oldSubscribe = Connection.prototype.subscribe;\n  Connection.prototype.subscribe = function () {\n    if (this._stream._neverQueued) {\n      return oldSubscribe.apply(this, arguments);\n    }\n    queueSend = true;\n    try {\n      return oldSubscribe.apply(this, arguments);\n    } finally {\n      queueSend = false;\n    }\n  };\n  let oldSend = Connection.prototype._send;\n  Connection.prototype._send = function (params, shouldQueue) {\n    if (this._stream._neverQueued) {\n      return oldSend.apply(this, arguments);\n    }\n    if (!queueSend && !shouldQueue) {\n      return oldSend.call(this, params);\n    }\n    queueSend = false;\n    queueFunction(resolve => {\n      try {\n        oldSend.call(this, params);\n      } finally {\n        resolve();\n      }\n    });\n  };\n  let _oldSendOutstandingMethodBlocksMessages = Connection.prototype._sendOutstandingMethodBlocksMessages;\n  Connection.prototype._sendOutstandingMethodBlocksMessages = function () {\n    if (this._stream._neverQueued) {\n      return _oldSendOutstandingMethodBlocksMessages.apply(this, arguments);\n    }\n    queueFunction(resolve => {\n      try {\n        _oldSendOutstandingMethodBlocksMessages.apply(this, arguments);\n      } finally {\n        resolve();\n      }\n    });\n  };\n};","map":{"version":3,"names":["_objectSpread","module","link","default","v","export","loadAsyncStubHelpers","DDP","Connection","queueSize","queue","Promise","resolve","queueFunction","fn","promiseProps","arguments","length","undefined","reject","promise","_resolve","_reject","finally","_promise$stubPromise","stubPromise","catch","Meteor","connection","_maybeMigrate","serverPromise","oldReadyToMigrate","prototype","_readyToMigrate","apply","currentMethodInvocation","oldApplyAsync","applyAsync","args","name","_CurrentMethodInvocation","_set","enclosing","get","alreadyInSimulation","isSimulation","isFromCallAsync","_isFromCallAsync","_getIsSimulation","stubPromiseResolver","serverPromiseResolver","r","finished","_setImmediate","applyAsyncPromise","then","result","err","console","warn","concat","oldApply","options","callback","_stream","_neverQueued","methodInvoker","call","_returnMethodInvoker","_addOutstandingMethod","queueSend","oldSubscribe","subscribe","oldSend","_send","params","shouldQueue","_oldSendOutstandingMethodBlocksMessages","_sendOutstandingMethodBlocksMessages"],"sources":["packages/ddp-client/client/queueStubsHelpers.js"],"sourcesContent":["import { DDP } from '../common/namespace.js';\nimport { Connection } from '../common/livedata_connection';\n\n// https://forums.meteor.com/t/proposal-to-fix-issues-with-async-method-stubs/60826\n\nlet queueSize = 0;\nlet queue = Promise.resolve();\n\nexport const loadAsyncStubHelpers = () => {\n\tfunction queueFunction(fn, promiseProps = {}) {\n\t\tqueueSize += 1;\n\n\t\tlet resolve;\n\t\tlet reject;\n\t\tconst promise = new Promise((_resolve, _reject) => {\n\t\t\tresolve = _resolve;\n\t\t\treject = _reject;\n\t\t});\n\n\t\tqueue = queue.finally(() => {\n\t\t\tfn(resolve, reject);\n\n\t\t\treturn promise.stubPromise?.catch(() => {}); // silent uncaught promise\n\t\t});\n\n\t\tpromise\n\t\t\t.catch(() => {}) // silent uncaught promise\n\t\t\t.finally(() => {\n\t\t\t\tqueueSize -= 1;\n\t\t\t\tif (queueSize === 0) {\n\t\t\t\t\tMeteor.connection._maybeMigrate();\n\t\t\t\t}\n\t\t\t});\n\n\t\tpromise.stubPromise = promiseProps.stubPromise;\n\t\tpromise.serverPromise = promiseProps.serverPromise;\n\n\t\treturn promise;\n\t}\n\n\tlet oldReadyToMigrate = Connection.prototype._readyToMigrate;\n\tConnection.prototype._readyToMigrate = function () {\n\t\tif (queueSize > 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn oldReadyToMigrate.apply(this, arguments);\n\t};\n\n\tlet currentMethodInvocation = null;\n\n\t/**\n\t * Meteor sets CurrentMethodInvocation to undefined for the reasons explained at\n\t * https://github.com/meteor/meteor/blob/c9e3551b9673a7ed607f18cb1128563ff49ca96f/packages/ddp-client/common/livedata_connection.js#L578-L605\n\t * The app code could call `.then` on a promise while the async stub is running,\n\t * causing the `then` callback to think it is inside the stub.\n\t *\n\t * With the queueing we are doing, this is no longer necessary. The point\n\t * of the queueing is to prevent app/package code from running while\n\t * the stub is running, so we don't need to worry about this.\n\t */\n\n\tlet oldApplyAsync = Connection.prototype.applyAsync;\n\tConnection.prototype.applyAsync = function () {\n\t\tlet args = arguments;\n\t\tlet name = args[0];\n\n\t\tif (currentMethodInvocation) {\n\t\t\tDDP._CurrentMethodInvocation._set(currentMethodInvocation);\n\t\t\tcurrentMethodInvocation = null;\n\t\t}\n\n\t\tconst enclosing = DDP._CurrentMethodInvocation.get();\n\t\tconst alreadyInSimulation = enclosing?.isSimulation;\n\t\tconst isFromCallAsync = enclosing?._isFromCallAsync;\n\n\t\tif (\n\t\t\tMeteor.connection._getIsSimulation({\n\t\t\t\tisFromCallAsync,\n\t\t\t\talreadyInSimulation,\n\t\t\t})\n\t\t) {\n\t\t\t// In stub - call immediately\n\t\t\treturn oldApplyAsync.apply(this, args);\n\t\t}\n\n\t\tlet stubPromiseResolver;\n\t\tlet serverPromiseResolver;\n\t\tconst stubPromise = new Promise((r) => (stubPromiseResolver = r));\n\t\tconst serverPromise = new Promise((r) => (serverPromiseResolver = r));\n\n\t\treturn queueFunction(\n\t\t\t(resolve, reject) => {\n\t\t\t\tlet finished = false;\n\n\t\t\t\tMeteor._setImmediate(() => {\n\t\t\t\t\tconst applyAsyncPromise = oldApplyAsync.apply(this, args);\n\t\t\t\t\tstubPromiseResolver(applyAsyncPromise.stubPromise);\n\t\t\t\t\tserverPromiseResolver(applyAsyncPromise.serverPromise);\n\n\t\t\t\t\tapplyAsyncPromise.stubPromise\n\t\t\t\t\t\t.catch(() => {}) // silent uncaught promise\n\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\tfinished = true;\n\t\t\t\t\t\t});\n\n\t\t\t\t\tapplyAsyncPromise\n\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t});\n\n\t\t\t\t\tserverPromise.catch(() => {}); // silent uncaught promise\n\t\t\t\t});\n\n\t\t\t\tMeteor._setImmediate(() => {\n\t\t\t\t\tif (!finished) {\n\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t`Method stub (${name}) took too long and could cause unexpected problems. Learn more at https://v3-migration-docs.meteor.com/breaking-changes/call-x-callAsync.html#considerations-for-effective-use-of-meteor-callasync`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t{\n\t\t\t\tstubPromise,\n\t\t\t\tserverPromise,\n\t\t\t},\n\t\t);\n\t};\n\n\tlet oldApply = Connection.prototype.apply;\n\tConnection.prototype.apply = function (name, args, options, callback) {\n\t\tif (this._stream._neverQueued) {\n\t\t\treturn oldApply.apply(this, arguments);\n\t\t}\n\n\t\t// Apply runs the stub before synchronously returning.\n\t\t//\n\t\t// However, we want the server to run the methods in the original call order\n\t\t// so we have to queue sending the message to the server until any previous async\n\t\t// methods run.\n\t\t// This does mean the stubs run in a different order than the methods on the\n\t\t// server.\n\n\t\tif (!callback && typeof options === 'function') {\n\t\t\tcallback = options;\n\t\t\toptions = undefined;\n\t\t}\n\n\t\tlet { methodInvoker, result } = oldApply.call(\n\t\t\tthis,\n\t\t\tname,\n\t\t\targs,\n\t\t\t{\n\t\t\t\t...options,\n\t\t\t\t_returnMethodInvoker: true,\n\t\t\t},\n\t\t\tcallback,\n\t\t);\n\n\t\tif (methodInvoker) {\n\t\t\tqueueFunction((resolve) => {\n\t\t\t\treturn this._addOutstandingMethod(methodInvoker, options);\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t};\n\n\t/**\n\t * Queue subscriptions in case they rely on previous method calls\n\t */\n\tlet queueSend = false;\n\tlet oldSubscribe = Connection.prototype.subscribe;\n\tConnection.prototype.subscribe = function () {\n\t\tif (this._stream._neverQueued) {\n\t\t\treturn oldSubscribe.apply(this, arguments);\n\t\t}\n\n\t\tqueueSend = true;\n\t\ttry {\n\t\t\treturn oldSubscribe.apply(this, arguments);\n\t\t} finally {\n\t\t\tqueueSend = false;\n\t\t}\n\t};\n\n\tlet oldSend = Connection.prototype._send;\n\tConnection.prototype._send = function (params, shouldQueue) {\n\t\tif (this._stream._neverQueued) {\n\t\t\treturn oldSend.apply(this, arguments);\n\t\t}\n\n\t\tif (!queueSend && !shouldQueue) {\n\t\t\treturn oldSend.call(this, params);\n\t\t}\n\n\t\tqueueSend = false;\n\t\tqueueFunction((resolve) => {\n\t\t\ttry {\n\t\t\t\toldSend.call(this, params);\n\t\t\t} finally {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t};\n\n\tlet _oldSendOutstandingMethodBlocksMessages = Connection.prototype._sendOutstandingMethodBlocksMessages;\n\tConnection.prototype._sendOutstandingMethodBlocksMessages = function () {\n\t\tif (this._stream._neverQueued) {\n\t\t\treturn _oldSendOutstandingMethodBlocksMessages.apply(this, arguments);\n\t\t}\n\t\tqueueFunction((resolve) => {\n\t\t\ttry {\n\t\t\t\t_oldSendOutstandingMethodBlocksMessages.apply(this, arguments);\n\t\t\t} finally {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t};\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"3384034b8aff306960d56bad0bd33e368ba1040d"}
