{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/messages.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"app/apps/server/converters/messages.js","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/messages.js","targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/apps/server/converters/messages.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/apps/server/converters/messages.js"}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let _objectSpread;\n    module.link(\"@babel/runtime/helpers/objectSpread2\", {\n      default(v) {\n        _objectSpread = v;\n      }\n    }, 0);\n    let _objectWithoutProperties;\n    module.link(\"@babel/runtime/helpers/objectWithoutProperties\", {\n      default(v) {\n        _objectWithoutProperties = v;\n      }\n    }, 1);\n    const _excluded = [\"attachments\"];\n    module.export({\n      AppMessagesConverter: () => AppMessagesConverter\n    });\n    let isMessageFromVisitor;\n    module.link(\"@rocket.chat/core-typings\", {\n      isMessageFromVisitor(v) {\n        isMessageFromVisitor = v;\n      }\n    }, 0);\n    let Messages, Rooms, Users;\n    module.link(\"@rocket.chat/models\", {\n      Messages(v) {\n        Messages = v;\n      },\n      Rooms(v) {\n        Rooms = v;\n      },\n      Users(v) {\n        Users = v;\n      }\n    }, 1);\n    let Random;\n    module.link(\"@rocket.chat/random\", {\n      Random(v) {\n        Random = v;\n      }\n    }, 2);\n    let cachedFunction;\n    module.link(\"./cachedFunction\", {\n      cachedFunction(v) {\n        cachedFunction = v;\n      }\n    }, 3);\n    let transformMappedData;\n    module.link(\"./transformMappedData\", {\n      transformMappedData(v) {\n        transformMappedData = v;\n      }\n    }, 4);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    class AppMessagesConverter {\n      constructor(orch) {\n        this.mem = new WeakMap();\n        this.orch = orch;\n      }\n      async convertById(msgId) {\n        const msg = await Messages.findOneById(msgId);\n        return this.convertMessage(msg);\n      }\n      async convertMessageRaw(msgObj) {\n        if (!msgObj) {\n          return undefined;\n        }\n        const {\n            attachments\n          } = msgObj,\n          message = _objectWithoutProperties(msgObj, _excluded);\n        const getAttachments = async () => this._convertAttachmentsToApp(attachments);\n        const map = {\n          id: '_id',\n          threadId: 'tmid',\n          reactions: 'reactions',\n          parseUrls: 'parseUrls',\n          text: 'msg',\n          createdAt: 'ts',\n          updatedAt: '_updatedAt',\n          editedAt: 'editedAt',\n          emoji: 'emoji',\n          avatarUrl: 'avatar',\n          alias: 'alias',\n          file: 'file',\n          customFields: 'customFields',\n          groupable: 'groupable',\n          token: 'token',\n          blocks: 'blocks',\n          roomId: 'rid',\n          editor: 'editedBy',\n          attachments: getAttachments,\n          sender: 'u'\n        };\n        return transformMappedData(message, map);\n      }\n      async convertMessage(msgObj) {\n        var _this$mem$get;\n        let cacheObj = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : msgObj;\n        if (!msgObj) {\n          return undefined;\n        }\n        const cache = (_this$mem$get = this.mem.get(cacheObj)) !== null && _this$mem$get !== void 0 ? _this$mem$get : new Map([['room', cachedFunction(this.orch.getConverters().get('rooms').convertById.bind(this.orch.getConverters().get('rooms')))], ['user.convertById', cachedFunction(this.orch.getConverters().get('users').convertById.bind(this.orch.getConverters().get('users')))], ['user.convertToApp', cachedFunction(this.orch.getConverters().get('users').convertToApp.bind(this.orch.getConverters().get('users')))]]);\n        this.mem.set(cacheObj, cache);\n        const map = {\n          id: '_id',\n          threadId: 'tmid',\n          reactions: 'reactions',\n          parseUrls: 'parseUrls',\n          text: 'msg',\n          createdAt: 'ts',\n          updatedAt: '_updatedAt',\n          editedAt: 'editedAt',\n          emoji: 'emoji',\n          avatarUrl: 'avatar',\n          alias: 'alias',\n          file: 'file',\n          customFields: 'customFields',\n          groupable: 'groupable',\n          token: 'token',\n          blocks: 'blocks',\n          room: async message => {\n            const result = await cache.get('room')(message.rid);\n            delete message.rid;\n            return result;\n          },\n          editor: async message => {\n            const {\n              editedBy\n            } = message;\n            delete message.editedBy;\n            if (!editedBy) {\n              return undefined;\n            }\n            return cache.get('user.convertById')(editedBy._id);\n          },\n          attachments: async message => {\n            const result = await this._convertAttachmentsToApp(message.attachments);\n            delete message.attachments;\n            return result;\n          },\n          sender: async message => {\n            if (!message.u || !message.u._id) {\n              return undefined;\n            }\n\n            // When the message contains token, means the message is from the visitor(omnichannel)\n            const user = await (isMessageFromVisitor(msgObj) ? cache.get('user.convertToApp')(message.u) : cache.get('user.convertById')(message.u._id));\n            delete message.u;\n\n            /**\n             * Old System Messages from visitor doesn't have the `token` field, to not return\n             * `sender` as undefined, so we need to add this fallback here.\n             */\n\n            return user || cache.get('user.convertToApp')(message.u);\n          }\n        };\n        return transformMappedData(msgObj, map);\n      }\n      async convertAppMessage(message) {\n        if (!message || !message.room) {\n          return undefined;\n        }\n        const room = await Rooms.findOneById(message.room.id);\n        if (!room) {\n          throw new Error('Invalid room provided on the message.');\n        }\n        let u;\n        if (message.sender && message.sender.id) {\n          const user = await Users.findOneById(message.sender.id);\n          if (user) {\n            u = {\n              _id: user._id,\n              username: user.username,\n              name: user.name\n            };\n          } else {\n            u = {\n              _id: message.sender.id,\n              username: message.sender.username,\n              name: message.sender.name\n            };\n          }\n        }\n        let editedBy;\n        if (message.editor) {\n          const editor = await Users.findOneById(message.editor.id);\n          editedBy = {\n            _id: editor._id,\n            username: editor.username\n          };\n        }\n        const attachments = this._convertAppAttachments(message.attachments);\n        const newMessage = _objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({\n          _id: message.id || Random.id()\n        }, 'threadId' in message && {\n          tmid: message.threadId\n        }), {}, {\n          rid: room._id,\n          u,\n          msg: message.text,\n          ts: message.createdAt || new Date(),\n          _updatedAt: message.updatedAt || new Date()\n        }, editedBy && {\n          editedBy\n        }), 'editedAt' in message && {\n          editedAt: message.editedAt\n        }), 'emoji' in message && {\n          emoji: message.emoji\n        }), 'avatarUrl' in message && {\n          avatar: message.avatarUrl\n        }), 'alias' in message && {\n          alias: message.alias\n        }), 'customFields' in message && {\n          customFields: message.customFields\n        }), 'groupable' in message && {\n          groupable: message.groupable\n        }), attachments && {\n          attachments\n        }), 'reactions' in message && {\n          reactions: message.reactions\n        }), 'parseUrls' in message && {\n          parseUrls: message.parseUrls\n        }), 'blocks' in message && {\n          blocks: message.blocks\n        }), 'token' in message && {\n          token: message.token\n        });\n        return Object.assign(newMessage, message._unmappedProperties_);\n      }\n      _convertAppAttachments(attachments) {\n        if (typeof attachments === 'undefined' || !Array.isArray(attachments)) {\n          return undefined;\n        }\n        return attachments.map(attachment => Object.assign({\n          collapsed: attachment.collapsed,\n          color: attachment.color,\n          text: attachment.text,\n          ts: attachment.timestamp ? attachment.timestamp.toJSON() : attachment.timestamp,\n          message_link: attachment.timestampLink,\n          thumb_url: attachment.thumbnailUrl,\n          author_name: attachment.author ? attachment.author.name : undefined,\n          author_link: attachment.author ? attachment.author.link : undefined,\n          author_icon: attachment.author ? attachment.author.icon : undefined,\n          title: attachment.title ? attachment.title.value : undefined,\n          title_link: attachment.title ? attachment.title.link : undefined,\n          title_link_download: attachment.title ? attachment.title.displayDownloadLink : undefined,\n          image_dimensions: attachment.imageDimensions,\n          image_preview: attachment.imagePreview,\n          image_url: attachment.imageUrl,\n          image_type: attachment.imageType,\n          image_size: attachment.imageSize,\n          audio_url: attachment.audioUrl,\n          audio_type: attachment.audioType,\n          audio_size: attachment.audioSize,\n          video_url: attachment.videoUrl,\n          video_type: attachment.videoType,\n          video_size: attachment.videoSize,\n          fields: attachment.fields,\n          button_alignment: attachment.actionButtonsAlignment,\n          actions: attachment.actions,\n          type: attachment.type,\n          description: attachment.description\n        }, attachment._unmappedProperties_));\n      }\n      async _convertAttachmentsToApp(attachments) {\n        if (typeof attachments === 'undefined' || !Array.isArray(attachments)) {\n          return undefined;\n        }\n        const map = {\n          collapsed: 'collapsed',\n          color: 'color',\n          text: 'text',\n          timestampLink: 'message_link',\n          thumbnailUrl: 'thumb_url',\n          imageDimensions: 'image_dimensions',\n          imagePreview: 'image_preview',\n          imageUrl: 'image_url',\n          imageType: 'image_type',\n          imageSize: 'image_size',\n          audioUrl: 'audio_url',\n          audioType: 'audio_type',\n          audioSize: 'audio_size',\n          videoUrl: 'video_url',\n          videoType: 'video_type',\n          videoSize: 'video_size',\n          fields: 'fields',\n          actionButtonsAlignment: 'button_alignment',\n          actions: 'actions',\n          type: 'type',\n          description: 'description',\n          author: attachment => {\n            const {\n              author_name: name,\n              author_link: link,\n              author_icon: icon\n            } = attachment;\n            delete attachment.author_name;\n            delete attachment.author_link;\n            delete attachment.author_icon;\n            return {\n              name,\n              link,\n              icon\n            };\n          },\n          title: attachment => {\n            const {\n              title: value,\n              title_link: link,\n              title_link_download: displayDownloadLink\n            } = attachment;\n            delete attachment.title;\n            delete attachment.title_link;\n            delete attachment.title_link_download;\n            return {\n              value,\n              link,\n              displayDownloadLink\n            };\n          },\n          timestamp: attachment => {\n            const result = new Date(attachment.ts);\n            delete attachment.ts;\n            return result;\n          }\n        };\n        return Promise.all(attachments.map(async attachment => transformMappedData(attachment, map)));\n      }\n    }\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["_objectSpread","module","link","default","v","_objectWithoutProperties","_excluded","export","AppMessagesConverter","isMessageFromVisitor","Messages","Rooms","Users","Random","cachedFunction","transformMappedData","__reifyWaitForDeps__","constructor","orch","mem","WeakMap","convertById","msgId","msg","findOneById","convertMessage","convertMessageRaw","msgObj","undefined","attachments","message","getAttachments","_convertAttachmentsToApp","map","id","threadId","reactions","parseUrls","text","createdAt","updatedAt","editedAt","emoji","avatarUrl","alias","file","customFields","groupable","token","blocks","roomId","editor","sender","_this$mem$get","cacheObj","arguments","length","cache","get","Map","getConverters","bind","convertToApp","set","room","result","rid","editedBy","_id","u","user","convertAppMessage","Error","username","name","_convertAppAttachments","newMessage","tmid","ts","Date","_updatedAt","avatar","Object","assign","_unmappedProperties_","Array","isArray","attachment","collapsed","color","timestamp","toJSON","message_link","timestampLink","thumb_url","thumbnailUrl","author_name","author","author_link","author_icon","icon","title","value","title_link","title_link_download","displayDownloadLink","image_dimensions","imageDimensions","image_preview","imagePreview","image_url","imageUrl","image_type","imageType","image_size","imageSize","audio_url","audioUrl","audio_type","audioType","audio_size","audioSize","video_url","videoUrl","video_type","videoType","video_size","videoSize","fields","button_alignment","actionButtonsAlignment","actions","type","description","Promise","all","__reify_async_result__","_reifyError","self","async"],"sources":["app/apps/server/converters/messages.js"],"sourcesContent":["import { isMessageFromVisitor } from '@rocket.chat/core-typings';\nimport { Messages, Rooms, Users } from '@rocket.chat/models';\nimport { Random } from '@rocket.chat/random';\n\nimport { cachedFunction } from './cachedFunction';\nimport { transformMappedData } from './transformMappedData';\n\nexport class AppMessagesConverter {\n\tmem = new WeakMap();\n\n\tconstructor(orch) {\n\t\tthis.orch = orch;\n\t}\n\n\tasync convertById(msgId) {\n\t\tconst msg = await Messages.findOneById(msgId);\n\n\t\treturn this.convertMessage(msg);\n\t}\n\n\tasync convertMessageRaw(msgObj) {\n\t\tif (!msgObj) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst { attachments, ...message } = msgObj;\n\t\tconst getAttachments = async () => this._convertAttachmentsToApp(attachments);\n\n\t\tconst map = {\n\t\t\tid: '_id',\n\t\t\tthreadId: 'tmid',\n\t\t\treactions: 'reactions',\n\t\t\tparseUrls: 'parseUrls',\n\t\t\ttext: 'msg',\n\t\t\tcreatedAt: 'ts',\n\t\t\tupdatedAt: '_updatedAt',\n\t\t\teditedAt: 'editedAt',\n\t\t\temoji: 'emoji',\n\t\t\tavatarUrl: 'avatar',\n\t\t\talias: 'alias',\n\t\t\tfile: 'file',\n\t\t\tcustomFields: 'customFields',\n\t\t\tgroupable: 'groupable',\n\t\t\ttoken: 'token',\n\t\t\tblocks: 'blocks',\n\t\t\troomId: 'rid',\n\t\t\teditor: 'editedBy',\n\t\t\tattachments: getAttachments,\n\t\t\tsender: 'u',\n\t\t};\n\n\t\treturn transformMappedData(message, map);\n\t}\n\n\tasync convertMessage(msgObj, cacheObj = msgObj) {\n\t\tif (!msgObj) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst cache =\n\t\t\tthis.mem.get(cacheObj) ??\n\t\t\tnew Map([\n\t\t\t\t['room', cachedFunction(this.orch.getConverters().get('rooms').convertById.bind(this.orch.getConverters().get('rooms')))],\n\t\t\t\t[\n\t\t\t\t\t'user.convertById',\n\t\t\t\t\tcachedFunction(this.orch.getConverters().get('users').convertById.bind(this.orch.getConverters().get('users'))),\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t'user.convertToApp',\n\t\t\t\t\tcachedFunction(this.orch.getConverters().get('users').convertToApp.bind(this.orch.getConverters().get('users'))),\n\t\t\t\t],\n\t\t\t]);\n\n\t\tthis.mem.set(cacheObj, cache);\n\n\t\tconst map = {\n\t\t\tid: '_id',\n\t\t\tthreadId: 'tmid',\n\t\t\treactions: 'reactions',\n\t\t\tparseUrls: 'parseUrls',\n\t\t\ttext: 'msg',\n\t\t\tcreatedAt: 'ts',\n\t\t\tupdatedAt: '_updatedAt',\n\t\t\teditedAt: 'editedAt',\n\t\t\temoji: 'emoji',\n\t\t\tavatarUrl: 'avatar',\n\t\t\talias: 'alias',\n\t\t\tfile: 'file',\n\t\t\tcustomFields: 'customFields',\n\t\t\tgroupable: 'groupable',\n\t\t\ttoken: 'token',\n\t\t\tblocks: 'blocks',\n\t\t\troom: async (message) => {\n\t\t\t\tconst result = await cache.get('room')(message.rid);\n\t\t\t\tdelete message.rid;\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\teditor: async (message) => {\n\t\t\t\tconst { editedBy } = message;\n\t\t\t\tdelete message.editedBy;\n\n\t\t\t\tif (!editedBy) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\treturn cache.get('user.convertById')(editedBy._id);\n\t\t\t},\n\t\t\tattachments: async (message) => {\n\t\t\t\tconst result = await this._convertAttachmentsToApp(message.attachments);\n\t\t\t\tdelete message.attachments;\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\tsender: async (message) => {\n\t\t\t\tif (!message.u || !message.u._id) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\t// When the message contains token, means the message is from the visitor(omnichannel)\n\t\t\t\tconst user = await (isMessageFromVisitor(msgObj)\n\t\t\t\t\t? cache.get('user.convertToApp')(message.u)\n\t\t\t\t\t: cache.get('user.convertById')(message.u._id));\n\n\t\t\t\tdelete message.u;\n\n\t\t\t\t/**\n\t\t\t\t * Old System Messages from visitor doesn't have the `token` field, to not return\n\t\t\t\t * `sender` as undefined, so we need to add this fallback here.\n\t\t\t\t */\n\n\t\t\t\treturn user || cache.get('user.convertToApp')(message.u);\n\t\t\t},\n\t\t};\n\n\t\treturn transformMappedData(msgObj, map);\n\t}\n\n\tasync convertAppMessage(message) {\n\t\tif (!message || !message.room) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst room = await Rooms.findOneById(message.room.id);\n\n\t\tif (!room) {\n\t\t\tthrow new Error('Invalid room provided on the message.');\n\t\t}\n\n\t\tlet u;\n\t\tif (message.sender && message.sender.id) {\n\t\t\tconst user = await Users.findOneById(message.sender.id);\n\n\t\t\tif (user) {\n\t\t\t\tu = {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tu = {\n\t\t\t\t\t_id: message.sender.id,\n\t\t\t\t\tusername: message.sender.username,\n\t\t\t\t\tname: message.sender.name,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tlet editedBy;\n\t\tif (message.editor) {\n\t\t\tconst editor = await Users.findOneById(message.editor.id);\n\t\t\teditedBy = {\n\t\t\t\t_id: editor._id,\n\t\t\t\tusername: editor.username,\n\t\t\t};\n\t\t}\n\n\t\tconst attachments = this._convertAppAttachments(message.attachments);\n\n\t\tconst newMessage = {\n\t\t\t_id: message.id || Random.id(),\n\t\t\t...('threadId' in message && { tmid: message.threadId }),\n\t\t\trid: room._id,\n\t\t\tu,\n\t\t\tmsg: message.text,\n\t\t\tts: message.createdAt || new Date(),\n\t\t\t_updatedAt: message.updatedAt || new Date(),\n\t\t\t...(editedBy && { editedBy }),\n\t\t\t...('editedAt' in message && { editedAt: message.editedAt }),\n\t\t\t...('emoji' in message && { emoji: message.emoji }),\n\t\t\t...('avatarUrl' in message && { avatar: message.avatarUrl }),\n\t\t\t...('alias' in message && { alias: message.alias }),\n\t\t\t...('customFields' in message && { customFields: message.customFields }),\n\t\t\t...('groupable' in message && { groupable: message.groupable }),\n\t\t\t...(attachments && { attachments }),\n\t\t\t...('reactions' in message && { reactions: message.reactions }),\n\t\t\t...('parseUrls' in message && { parseUrls: message.parseUrls }),\n\t\t\t...('blocks' in message && { blocks: message.blocks }),\n\t\t\t...('token' in message && { token: message.token }),\n\t\t};\n\n\t\treturn Object.assign(newMessage, message._unmappedProperties_);\n\t}\n\n\t_convertAppAttachments(attachments) {\n\t\tif (typeof attachments === 'undefined' || !Array.isArray(attachments)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn attachments.map((attachment) =>\n\t\t\tObject.assign(\n\t\t\t\t{\n\t\t\t\t\tcollapsed: attachment.collapsed,\n\t\t\t\t\tcolor: attachment.color,\n\t\t\t\t\ttext: attachment.text,\n\t\t\t\t\tts: attachment.timestamp ? attachment.timestamp.toJSON() : attachment.timestamp,\n\t\t\t\t\tmessage_link: attachment.timestampLink,\n\t\t\t\t\tthumb_url: attachment.thumbnailUrl,\n\t\t\t\t\tauthor_name: attachment.author ? attachment.author.name : undefined,\n\t\t\t\t\tauthor_link: attachment.author ? attachment.author.link : undefined,\n\t\t\t\t\tauthor_icon: attachment.author ? attachment.author.icon : undefined,\n\t\t\t\t\ttitle: attachment.title ? attachment.title.value : undefined,\n\t\t\t\t\ttitle_link: attachment.title ? attachment.title.link : undefined,\n\t\t\t\t\ttitle_link_download: attachment.title ? attachment.title.displayDownloadLink : undefined,\n\t\t\t\t\timage_dimensions: attachment.imageDimensions,\n\t\t\t\t\timage_preview: attachment.imagePreview,\n\t\t\t\t\timage_url: attachment.imageUrl,\n\t\t\t\t\timage_type: attachment.imageType,\n\t\t\t\t\timage_size: attachment.imageSize,\n\t\t\t\t\taudio_url: attachment.audioUrl,\n\t\t\t\t\taudio_type: attachment.audioType,\n\t\t\t\t\taudio_size: attachment.audioSize,\n\t\t\t\t\tvideo_url: attachment.videoUrl,\n\t\t\t\t\tvideo_type: attachment.videoType,\n\t\t\t\t\tvideo_size: attachment.videoSize,\n\t\t\t\t\tfields: attachment.fields,\n\t\t\t\t\tbutton_alignment: attachment.actionButtonsAlignment,\n\t\t\t\t\tactions: attachment.actions,\n\t\t\t\t\ttype: attachment.type,\n\t\t\t\t\tdescription: attachment.description,\n\t\t\t\t},\n\t\t\t\tattachment._unmappedProperties_,\n\t\t\t),\n\t\t);\n\t}\n\n\tasync _convertAttachmentsToApp(attachments) {\n\t\tif (typeof attachments === 'undefined' || !Array.isArray(attachments)) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst map = {\n\t\t\tcollapsed: 'collapsed',\n\t\t\tcolor: 'color',\n\t\t\ttext: 'text',\n\t\t\ttimestampLink: 'message_link',\n\t\t\tthumbnailUrl: 'thumb_url',\n\t\t\timageDimensions: 'image_dimensions',\n\t\t\timagePreview: 'image_preview',\n\t\t\timageUrl: 'image_url',\n\t\t\timageType: 'image_type',\n\t\t\timageSize: 'image_size',\n\t\t\taudioUrl: 'audio_url',\n\t\t\taudioType: 'audio_type',\n\t\t\taudioSize: 'audio_size',\n\t\t\tvideoUrl: 'video_url',\n\t\t\tvideoType: 'video_type',\n\t\t\tvideoSize: 'video_size',\n\t\t\tfields: 'fields',\n\t\t\tactionButtonsAlignment: 'button_alignment',\n\t\t\tactions: 'actions',\n\t\t\ttype: 'type',\n\t\t\tdescription: 'description',\n\t\t\tauthor: (attachment) => {\n\t\t\t\tconst { author_name: name, author_link: link, author_icon: icon } = attachment;\n\n\t\t\t\tdelete attachment.author_name;\n\t\t\t\tdelete attachment.author_link;\n\t\t\t\tdelete attachment.author_icon;\n\n\t\t\t\treturn { name, link, icon };\n\t\t\t},\n\t\t\ttitle: (attachment) => {\n\t\t\t\tconst { title: value, title_link: link, title_link_download: displayDownloadLink } = attachment;\n\n\t\t\t\tdelete attachment.title;\n\t\t\t\tdelete attachment.title_link;\n\t\t\t\tdelete attachment.title_link_download;\n\n\t\t\t\treturn { value, link, displayDownloadLink };\n\t\t\t},\n\t\t\ttimestamp: (attachment) => {\n\t\t\t\tconst result = new Date(attachment.ts);\n\t\t\t\tdelete attachment.ts;\n\t\t\t\treturn result;\n\t\t\t},\n\t\t};\n\n\t\treturn Promise.all(attachments.map(async (attachment) => transformMappedData(attachment, map)));\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"e30d161f2c11888d31daca45092403ada2c2427c"}
