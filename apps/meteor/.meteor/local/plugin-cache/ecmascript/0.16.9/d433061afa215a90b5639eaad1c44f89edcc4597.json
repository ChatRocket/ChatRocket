{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/webrtc/client/WebRTCClass.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"app/webrtc/client/WebRTCClass.js","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/webrtc/client/WebRTCClass.js","targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null,null]},"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"DoWhileStatement":{"exit":[null]},"ForInStatement":{"exit":[null]},"ForStatement":{"exit":[null]},"WhileStatement":{"exit":[null]},"ForOfStatement":{"exit":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-regenerator","visitor":{"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/app/webrtc/client/WebRTCClass.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"app/webrtc/client/WebRTCClass.js"}},"code":"var _toConsumableArray;\nmodule.link(\"@babel/runtime/helpers/toConsumableArray\", {\n  default: function (v) {\n    _toConsumableArray = v;\n  }\n}, 0);\nvar _slicedToArray;\nmodule.link(\"@babel/runtime/helpers/slicedToArray\", {\n  default: function (v) {\n    _slicedToArray = v;\n  }\n}, 1);\nvar _inheritsLoose;\nmodule.link(\"@babel/runtime/helpers/inheritsLoose\", {\n  default: function (v) {\n    _inheritsLoose = v;\n  }\n}, 2);\nmodule.export({\n  WebRTC: function () {\n    return WebRTC;\n  }\n});\nvar Emitter;\nmodule.link(\"@rocket.chat/emitter\", {\n  Emitter: function (v) {\n    Emitter = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 2);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 3);\nvar GenericModal;\nmodule.link(\"../../../client/components/GenericModal\", {\n  \"default\": function (v) {\n    GenericModal = v;\n  }\n}, 4);\nvar imperativeModal;\nmodule.link(\"../../../client/lib/imperativeModal\", {\n  imperativeModal: function (v) {\n    imperativeModal = v;\n  }\n}, 5);\nvar goToRoomById;\nmodule.link(\"../../../client/lib/utils/goToRoomById\", {\n  goToRoomById: function (v) {\n    goToRoomById = v;\n  }\n}, 6);\nvar ChatSubscription;\nmodule.link(\"../../models/client\", {\n  ChatSubscription: function (v) {\n    ChatSubscription = v;\n  }\n}, 7);\nvar settings;\nmodule.link(\"../../settings/client\", {\n  settings: function (v) {\n    settings = v;\n  }\n}, 8);\nvar sdk;\nmodule.link(\"../../utils/client/lib/SDKClient\", {\n  sdk: function (v) {\n    sdk = v;\n  }\n}, 9);\nvar t;\nmodule.link(\"../../utils/lib/i18n\", {\n  t: function (v) {\n    t = v;\n  }\n}, 10);\nvar WEB_RTC_EVENTS;\nmodule.link(\"../lib/constants\", {\n  WEB_RTC_EVENTS: function (v) {\n    WEB_RTC_EVENTS = v;\n  }\n}, 11);\nvar ChromeScreenShare;\nmodule.link(\"./screenShare\", {\n  ChromeScreenShare: function (v) {\n    ChromeScreenShare = v;\n  }\n}, 12);\nvar WebRTCTransportClass = /*#__PURE__*/function (_Emitter) {\n  function WebRTCTransportClass(webrtcInstance) {\n    var _this;\n    _this = _Emitter.call(this) || this;\n    _this.debug = false;\n    _this.webrtcInstance = webrtcInstance;\n    sdk.stream('notify-room', [_this.webrtcInstance.room + \"/\" + WEB_RTC_EVENTS.WEB_RTC], function (type, data) {\n      _this.log('WebRTCTransportClass - onRoom', type, data);\n      _this.emit(type, data);\n    });\n    return _this;\n  }\n  _inheritsLoose(WebRTCTransportClass, _Emitter);\n  var _proto = WebRTCTransportClass.prototype;\n  _proto.log = function () {\n    function log() {\n      if (this.debug === true) {\n        var _console;\n        (_console = console).log.apply(_console, arguments);\n      }\n    }\n    return log;\n  }();\n  _proto.onUserStream = function () {\n    function onUserStream(type, data) {\n      if (data.room !== this.webrtcInstance.room) {\n        return;\n      }\n      this.log('WebRTCTransportClass - onUser', type, data);\n      this.emit(type, data);\n    }\n    return onUserStream;\n  }();\n  _proto.startCall = function () {\n    function startCall(data) {\n      this.log('WebRTCTransportClass - startCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\n      sdk.publish('notify-room-users', [this.webrtcInstance.room + \"/\" + WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.CALL, {\n        from: this.webrtcInstance.selfId,\n        room: this.webrtcInstance.room,\n        media: data.media,\n        monitor: data.monitor\n      }]);\n    }\n    return startCall;\n  }();\n  _proto.joinCall = function () {\n    function joinCall(data) {\n      this.log('WebRTCTransportClass - joinCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\n      if (data.monitor === true) {\n        sdk.publish('notify-user', [data.to + \"/\" + WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.JOIN, {\n          from: this.webrtcInstance.selfId,\n          room: this.webrtcInstance.room,\n          media: data.media,\n          monitor: data.monitor\n        }]);\n      } else {\n        sdk.publish('notify-room-users', [this.webrtcInstance.room + \"/\" + WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.JOIN, {\n          from: this.webrtcInstance.selfId,\n          room: this.webrtcInstance.room,\n          media: data.media,\n          monitor: data.monitor\n        }]);\n      }\n    }\n    return joinCall;\n  }();\n  _proto.sendCandidate = function () {\n    function sendCandidate(data) {\n      data.from = this.webrtcInstance.selfId;\n      data.room = this.webrtcInstance.room;\n      this.log('WebRTCTransportClass - sendCandidate', data);\n      sdk.publish('notify-user', [data.to + \"/\" + WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.CANDIDATE, data]);\n    }\n    return sendCandidate;\n  }();\n  _proto.sendDescription = function () {\n    function sendDescription(data) {\n      data.from = this.webrtcInstance.selfId;\n      data.room = this.webrtcInstance.room;\n      this.log('WebRTCTransportClass - sendDescription', data);\n      sdk.publish('notify-user', [data.to + \"/\" + WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.DESCRIPTION, data]);\n    }\n    return sendDescription;\n  }();\n  _proto.sendStatus = function () {\n    function sendStatus(data) {\n      this.log('WebRTCTransportClass - sendStatus', data, this.webrtcInstance.room);\n      data.from = this.webrtcInstance.selfId;\n      sdk.publish('notify-room', [this.webrtcInstance.room + \"/\" + WEB_RTC_EVENTS.WEB_RTC, WEB_RTC_EVENTS.STATUS, data]);\n    }\n    return sendStatus;\n  }();\n  _proto.onRemoteCall = function () {\n    function onRemoteCall(fn) {\n      return this.on(WEB_RTC_EVENTS.CALL, fn);\n    }\n    return onRemoteCall;\n  }();\n  _proto.onRemoteJoin = function () {\n    function onRemoteJoin(fn) {\n      return this.on(WEB_RTC_EVENTS.JOIN, fn);\n    }\n    return onRemoteJoin;\n  }();\n  _proto.onRemoteCandidate = function () {\n    function onRemoteCandidate(fn) {\n      return this.on(WEB_RTC_EVENTS.CANDIDATE, fn);\n    }\n    return onRemoteCandidate;\n  }();\n  _proto.onRemoteDescription = function () {\n    function onRemoteDescription(fn) {\n      return this.on(WEB_RTC_EVENTS.DESCRIPTION, fn);\n    }\n    return onRemoteDescription;\n  }();\n  _proto.onRemoteStatus = function () {\n    function onRemoteStatus(fn) {\n      return this.on(WEB_RTC_EVENTS.STATUS, fn);\n    }\n    return onRemoteStatus;\n  }();\n  return WebRTCTransportClass;\n}(Emitter);\nvar WebRTCClass = /*#__PURE__*/function () {\n  /*\n   \t\t@param seldId {String}\n   \t\t@param room {String}\n    */\n\n  function WebRTCClass(selfId, room) {\n    var _this2 = this;\n    var autoAccept = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    this.resetCallInProgress = function () {\n      _this2.callInProgress.set(false);\n    };\n    /*\n     \t\t@param id {String}\n      */\n    this.stopPeerConnection = function (id) {\n      var peerConnection = _this2.peerConnections[id];\n      if (peerConnection == null) {\n        return;\n      }\n      delete _this2.peerConnections[id];\n      peerConnection.close();\n      _this2.updateRemoteItems();\n    };\n    this.config = {\n      iceServers: []\n    };\n    this.debug = false;\n    this.TransportClass = WebRTCTransportClass;\n    this.selfId = selfId;\n    this.room = room;\n    var servers = settings.get('WebRTC_Servers');\n    if (servers && servers.trim() !== '') {\n      servers = servers.replace(/\\s/g, '');\n      servers = servers.split(',');\n      servers.forEach(function (server) {\n        server = server.split('@');\n        var serverConfig = {\n          urls: server.pop()\n        };\n        if (server.length === 1) {\n          server = server[0].split(':');\n          serverConfig.username = decodeURIComponent(server[0]);\n          serverConfig.credential = decodeURIComponent(server[1]);\n        }\n        _this2.config.iceServers.push(serverConfig);\n      });\n    }\n    this.peerConnections = {};\n    this.remoteItems = new ReactiveVar([]);\n    this.remoteItemsById = new ReactiveVar({});\n    this.callInProgress = new ReactiveVar(false);\n    this.audioEnabled = new ReactiveVar(false);\n    this.videoEnabled = new ReactiveVar(false);\n    this.overlayEnabled = new ReactiveVar(false);\n    this.screenShareEnabled = new ReactiveVar(false);\n    this.localUrl = new ReactiveVar();\n    this.active = false;\n    this.remoteMonitoring = false;\n    this.monitor = false;\n    this.autoAccept = autoAccept;\n    this.navigator = undefined;\n    var userAgent = navigator.userAgent.toLocaleLowerCase();\n    if (userAgent.indexOf('electron') !== -1) {\n      this.navigator = 'electron';\n    } else if (userAgent.indexOf('chrome') !== -1) {\n      this.navigator = 'chrome';\n    } else if (userAgent.indexOf('firefox') !== -1) {\n      this.navigator = 'firefox';\n    } else if (userAgent.indexOf('safari') !== -1) {\n      this.navigator = 'safari';\n    }\n    this.screenShareAvailable = ['chrome', 'firefox', 'electron'].includes(this.navigator);\n    this.media = {\n      video: true,\n      audio: true\n    };\n    this.transport = new this.TransportClass(this);\n    this.transport.onRemoteCall(this.onRemoteCall.bind(this));\n    this.transport.onRemoteJoin(this.onRemoteJoin.bind(this));\n    this.transport.onRemoteCandidate(this.onRemoteCandidate.bind(this));\n    this.transport.onRemoteDescription(this.onRemoteDescription.bind(this));\n    this.transport.onRemoteStatus(this.onRemoteStatus.bind(this));\n    setInterval(this.checkPeerConnections.bind(this), 1000);\n  }\n  var _proto2 = WebRTCClass.prototype;\n  _proto2.onUserStream = function () {\n    function onUserStream() {\n      var _this$transport;\n      return (_this$transport = this.transport).onUserStream.apply(_this$transport, arguments);\n    }\n    return onUserStream;\n  }();\n  _proto2.log = function () {\n    function log() {\n      if (this.debug === true) {\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n        console.log.apply(console, args);\n      }\n    }\n    return log;\n  }();\n  _proto2.onError = function () {\n    function onError() {\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n      console.error.apply(console, args);\n    }\n    return onError;\n  }();\n  _proto2.checkPeerConnections = function () {\n    function checkPeerConnections() {\n      var _this3 = this;\n      var peerConnections = this.peerConnections;\n      var date = Date.now();\n      Object.entries(peerConnections).some(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n          id = _ref2[0],\n          peerConnection = _ref2[1];\n        if (!['connected', 'completed'].includes(peerConnection.iceConnectionState) && peerConnection.createdAt + 5000 < date) {\n          _this3.stopPeerConnection(id);\n          return true;\n        }\n        return false;\n      });\n    }\n    return checkPeerConnections;\n  }();\n  _proto2.updateRemoteItems = function () {\n    function updateRemoteItems() {\n      var items = [];\n      var itemsById = {};\n      var peerConnections = this.peerConnections;\n      Object.entries(peerConnections).forEach(function (_ref3) {\n        var _ref4 = _slicedToArray(_ref3, 2),\n          id = _ref4[0],\n          peerConnection = _ref4[1];\n        peerConnection.getRemoteStreams().forEach(function (remoteStream) {\n          var item = {\n            id: id,\n            url: remoteStream,\n            state: peerConnection.iceConnectionState\n          };\n          switch (peerConnection.iceConnectionState) {\n            case 'checking':\n              item.stateText = 'Connecting...';\n              break;\n            case 'connected':\n            case 'completed':\n              item.stateText = 'Connected';\n              item.connected = true;\n              break;\n            case 'disconnected':\n              item.stateText = 'Disconnected';\n              break;\n            case 'failed':\n              item.stateText = 'Failed';\n              break;\n            case 'closed':\n              item.stateText = 'Closed';\n          }\n          items.push(item);\n          itemsById[id] = item;\n        });\n      });\n      this.remoteItems.set(items);\n      this.remoteItemsById.set(itemsById);\n    }\n    return updateRemoteItems;\n  }();\n  _proto2.broadcastStatus = function () {\n    function broadcastStatus() {\n      if (this.active !== true || this.monitor === true || this.remoteMonitoring === true) {\n        return;\n      }\n      var remoteConnections = [];\n      var peerConnections = this.peerConnections;\n      Object.keys(peerConnections).entries(function (_ref5) {\n        var _ref6 = _slicedToArray(_ref5, 2),\n          id = _ref6[0],\n          media = _ref6[1].remoteMedia;\n        remoteConnections.push({\n          id: id,\n          media: media\n        });\n      });\n      this.transport.sendStatus({\n        media: this.media,\n        remoteConnections: remoteConnections\n      });\n    }\n    return broadcastStatus;\n  }()\n  /*\n   \t\t@param data {Object}\n   \t\t\tfrom {String}\n   \t\t\tmedia {Object}\n   \t\t\tremoteConnections {Array[Object]}\n   \t\t\t\tid {String}\n   \t\t\t\tmedia {Object}\n    */\n  ;\n  _proto2.onRemoteStatus = function () {\n    function onRemoteStatus(data) {\n      var _this4 = this;\n      // this.log(onRemoteStatus, arguments);\n      this.callInProgress.set(true);\n      clearTimeout(this.callInProgressTimeout);\n      this.callInProgressTimeout = setTimeout(this.resetCallInProgress, 2000);\n      if (this.active !== true) {\n        return;\n      }\n      var remoteConnections = [{\n        id: data.from,\n        media: data.media\n      }].concat(_toConsumableArray(data.remoteConnections));\n      remoteConnections.forEach(function (remoteConnection) {\n        if (remoteConnection.id !== _this4.selfId && _this4.peerConnections[remoteConnection.id] == null) {\n          _this4.log('reconnecting with', remoteConnection.id);\n          _this4.onRemoteJoin({\n            from: remoteConnection.id,\n            media: remoteConnection.media\n          });\n        }\n      });\n    }\n    return onRemoteStatus;\n  }()\n  /*\n   \t\t@param id {String}\n    */\n  ;\n  _proto2.getPeerConnection = function () {\n    function getPeerConnection(id) {\n      var _this5 = this;\n      if (this.peerConnections[id] != null) {\n        return this.peerConnections[id];\n      }\n      var peerConnection = new RTCPeerConnection(this.config);\n      peerConnection.createdAt = Date.now();\n      peerConnection.remoteMedia = {};\n      this.peerConnections[id] = peerConnection;\n      var eventNames = ['icecandidate', 'addstream', 'removestream', 'iceconnectionstatechange', 'datachannel', 'identityresult', 'idpassertionerror', 'idpvalidationerror', 'negotiationneeded', 'peeridentity', 'signalingstatechange'];\n      eventNames.forEach(function (eventName) {\n        peerConnection.addEventListener(eventName, function (e) {\n          _this5.log(id, e.type, e);\n        });\n      });\n      peerConnection.addEventListener('icecandidate', function (e) {\n        if (e.candidate == null) {\n          return;\n        }\n        _this5.transport.sendCandidate({\n          to: id,\n          candidate: {\n            candidate: e.candidate.candidate,\n            sdpMLineIndex: e.candidate.sdpMLineIndex,\n            sdpMid: e.candidate.sdpMid\n          }\n        });\n      });\n      peerConnection.addEventListener('addstream', function () {\n        _this5.updateRemoteItems();\n      });\n      peerConnection.addEventListener('removestream', function () {\n        _this5.updateRemoteItems();\n      });\n      peerConnection.addEventListener('iceconnectionstatechange', function () {\n        if ((peerConnection.iceConnectionState === 'disconnected' || peerConnection.iceConnectionState === 'closed') && peerConnection === _this5.peerConnections[id]) {\n          _this5.stopPeerConnection(id);\n          setTimeout(function () {\n            if (Object.keys(_this5.peerConnections).length === 0) {\n              _this5.stop();\n            }\n          }, 3000);\n        }\n        _this5.updateRemoteItems();\n      });\n      return peerConnection;\n    }\n    return getPeerConnection;\n  }();\n  _proto2._getUserMedia = function () {\n    function _getUserMedia(media, onSuccess, onError) {\n      var _this6 = this;\n      var onSuccessLocal = function (stream) {\n        if (AudioContext && stream.getAudioTracks().length > 0) {\n          var audioContext = new AudioContext();\n          var source = audioContext.createMediaStreamSource(stream);\n          var volume = audioContext.createGain();\n          source.connect(volume);\n          var peer = audioContext.createMediaStreamDestination();\n          volume.connect(peer);\n          volume.gain.value = 0.6;\n          stream.removeTrack(stream.getAudioTracks()[0]);\n          stream.addTrack(peer.stream.getAudioTracks()[0]);\n          stream.volume = volume;\n          _this6.audioContext = audioContext;\n        }\n        onSuccess(stream);\n      };\n      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n        return navigator.mediaDevices.getUserMedia(media).then(onSuccessLocal).catch(onError);\n      }\n      navigator.getUserMedia(media, onSuccessLocal, onError);\n    }\n    return _getUserMedia;\n  }();\n  _proto2.getUserMedia = function () {\n    function getUserMedia(media, onSuccess) {\n      var _this7 = this;\n      var onError = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.onError;\n      if (media.desktop !== true) {\n        this._getUserMedia(media, onSuccess, onError);\n        return;\n      }\n      if (this.screenShareAvailable !== true) {\n        console.log('Screen share is not avaliable');\n        return;\n      }\n      var getScreen = function (audioStream) {\n        var refresh = function () {\n          imperativeModal.open({\n            component: GenericModal,\n            props: {\n              variant: 'warning',\n              title: t('Refresh_your_page_after_install_to_enable_screen_sharing')\n            }\n          });\n        };\n        var isChromeExtensionInstalled = _this7.navigator === 'chrome' && ChromeScreenShare.installed;\n        var isFirefoxExtensionInstalled = _this7.navigator === 'firefox' && window.rocketchatscreenshare != null;\n        if (!isChromeExtensionInstalled && !isFirefoxExtensionInstalled) {\n          imperativeModal.open({\n            component: GenericModal,\n            props: {\n              title: t('Screen_Share'),\n              variant: 'warning',\n              confirmText: t('Install_Extension'),\n              cancelText: t('Cancel'),\n              children: t('You_need_install_an_extension_to_allow_screen_sharing'),\n              onConfirm: function () {\n                if (_this7.navigator === 'chrome') {\n                  var url = 'https://chrome.google.com/webstore/detail/rocketchat-screen-share/nocfbnnmjnndkbipkabodnheejiegccf';\n                  try {\n                    chrome.webstore.install(url, refresh, function () {\n                      window.open(url);\n                      refresh();\n                    });\n                  } catch (_error) {\n                    console.log(_error);\n                    window.open(url);\n                    refresh();\n                  }\n                } else if (_this7.navigator === 'firefox') {\n                  window.open('https://addons.mozilla.org/en-GB/firefox/addon/rocketchat-screen-share/');\n                  refresh();\n                }\n              }\n            }\n          });\n          return onError(false);\n        }\n        var getScreenSuccess = function (stream) {\n          if (audioStream != null) {\n            stream.addTrack(audioStream.getAudioTracks()[0]);\n          }\n          onSuccess(stream);\n        };\n        if (_this7.navigator === 'firefox') {\n          media = {\n            audio: media.audio,\n            video: {\n              mozMediaSource: 'window',\n              mediaSource: 'window'\n            }\n          };\n          _this7._getUserMedia(media, getScreenSuccess, onError);\n        } else {\n          ChromeScreenShare.getSourceId(_this7.navigator, function (id) {\n            media = {\n              audio: false,\n              video: {\n                mandatory: {\n                  chromeMediaSource: 'desktop',\n                  chromeMediaSourceId: id,\n                  maxWidth: 1280,\n                  maxHeight: 720\n                }\n              }\n            };\n            _this7._getUserMedia(media, getScreenSuccess, onError);\n          });\n        }\n      };\n      if (this.navigator === 'firefox' || media.audio == null || media.audio === false) {\n        getScreen();\n      } else {\n        var getAudioSuccess = function (audioStream) {\n          getScreen(audioStream);\n        };\n        var getAudioError = function () {\n          getScreen();\n        };\n        this._getUserMedia({\n          audio: media.audio\n        }, getAudioSuccess, getAudioError);\n      }\n    }\n    return getUserMedia;\n  }()\n  /*\n   \t\t@param callback {Function}\n    */\n  ;\n  _proto2.getLocalUserMedia = function () {\n    function getLocalUserMedia(callback) {\n      var _this8 = this;\n      for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n        args[_key3 - 1] = arguments[_key3];\n      }\n      this.log('getLocalUserMedia', [callback].concat(args));\n      if (this.localStream != null) {\n        return callback(null, this.localStream);\n      }\n      var onSuccess = function (stream) {\n        _this8.localStream = stream;\n        !_this8.audioEnabled.get() && _this8.disableAudio();\n        !_this8.videoEnabled.get() && _this8.disableVideo();\n        _this8.localUrl.set(stream);\n        var peerConnections = _this8.peerConnections;\n        Object.entries(peerConnections).forEach(function (_ref7) {\n          var _ref8 = _slicedToArray(_ref7, 2),\n            peerConnection = _ref8[1];\n          return peerConnection.addStream(stream);\n        });\n        document.querySelector('video#localVideo').srcObject = stream;\n        callback(null, _this8.localStream);\n      };\n      var onError = function (error) {\n        callback(false);\n        _this8.onError(error);\n      };\n      this.getUserMedia(this.media, onSuccess, onError);\n    }\n    return getLocalUserMedia;\n  }();\n  _proto2.stopAllPeerConnections = function () {\n    function stopAllPeerConnections() {\n      var peerConnections = this.peerConnections;\n      Object.keys(peerConnections).forEach(this.stopPeerConnection);\n      window.audioContext && window.audioContext.close();\n    }\n    return stopAllPeerConnections;\n  }();\n  _proto2.setAudioEnabled = function () {\n    function setAudioEnabled() {\n      var enabled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      if (this.localStream != null) {\n        this.localStream.getAudioTracks().forEach(function (audio) {\n          audio.enabled = enabled;\n        });\n        this.audioEnabled.set(enabled);\n      }\n    }\n    return setAudioEnabled;\n  }();\n  _proto2.disableAudio = function () {\n    function disableAudio() {\n      this.setAudioEnabled(false);\n    }\n    return disableAudio;\n  }();\n  _proto2.enableAudio = function () {\n    function enableAudio() {\n      this.setAudioEnabled(true);\n    }\n    return enableAudio;\n  }();\n  _proto2.toggleAudio = function () {\n    function toggleAudio() {\n      if (this.audioEnabled.get()) {\n        return this.disableAudio();\n      }\n      return this.enableAudio();\n    }\n    return toggleAudio;\n  }();\n  _proto2.setVideoEnabled = function () {\n    function setVideoEnabled() {\n      var enabled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      if (this.localStream != null) {\n        this.localStream.getVideoTracks().forEach(function (video) {\n          video.enabled = enabled;\n        });\n        this.videoEnabled.set(enabled);\n      }\n    }\n    return setVideoEnabled;\n  }();\n  _proto2.disableScreenShare = function () {\n    function disableScreenShare() {\n      this.setScreenShareEnabled(false);\n    }\n    return disableScreenShare;\n  }();\n  _proto2.enableScreenShare = function () {\n    function enableScreenShare() {\n      this.setScreenShareEnabled(true);\n    }\n    return enableScreenShare;\n  }();\n  _proto2.setScreenShareEnabled = function () {\n    function setScreenShareEnabled() {\n      var _this9 = this;\n      var enabled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      if (this.localStream != null) {\n        this.media.desktop = enabled;\n        delete this.localStream;\n        this.getLocalUserMedia(function (err) {\n          if (err != null) {\n            return;\n          }\n          _this9.screenShareEnabled.set(enabled);\n          _this9.stopAllPeerConnections();\n          _this9.joinCall();\n        });\n      }\n    }\n    return setScreenShareEnabled;\n  }();\n  _proto2.disableVideo = function () {\n    function disableVideo() {\n      this.setVideoEnabled(false);\n    }\n    return disableVideo;\n  }();\n  _proto2.enableVideo = function () {\n    function enableVideo() {\n      this.setVideoEnabled(true);\n    }\n    return enableVideo;\n  }();\n  _proto2.toggleVideo = function () {\n    function toggleVideo() {\n      if (this.videoEnabled.get()) {\n        return this.disableVideo();\n      }\n      return this.enableVideo();\n    }\n    return toggleVideo;\n  }();\n  _proto2.stop = function () {\n    function stop() {\n      this.active = false;\n      this.monitor = false;\n      this.remoteMonitoring = false;\n      if (this.localStream != null && typeof this.localStream !== 'undefined') {\n        this.localStream.getTracks().forEach(function (track) {\n          return track.stop();\n        });\n      }\n      this.localUrl.set(undefined);\n      delete this.localStream;\n      this.stopAllPeerConnections();\n    }\n    return stop;\n  }()\n  /*\n   \t\t@param media {Object}\n   \t\t\taudio {Boolean}\n   \t\t\tvideo {Boolean}\n    */\n  ;\n  _proto2.startCall = function () {\n    function startCall() {\n      var _this10 = this;\n      var media = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n        args[_key4 - 1] = arguments[_key4];\n      }\n      this.log('startCall', [media].concat(args));\n      this.media = media;\n      this.getLocalUserMedia(function () {\n        _this10.active = true;\n        _this10.transport.startCall({\n          media: _this10.media\n        });\n      });\n    }\n    return startCall;\n  }();\n  _proto2.startCallAsMonitor = function () {\n    function startCallAsMonitor() {\n      var media = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      for (var _len5 = arguments.length, args = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n        args[_key5 - 1] = arguments[_key5];\n      }\n      this.log('startCallAsMonitor', [media].concat(args));\n      this.media = media;\n      this.active = true;\n      this.monitor = true;\n      this.transport.startCall({\n        media: this.media,\n        monitor: true\n      });\n    }\n    return startCallAsMonitor;\n  }()\n  /*\n   \t\t@param data {Object}\n   \t\t\tfrom {String}\n   \t\t\tmonitor {Boolean}\n   \t\t\tmedia {Object}\n   \t\t\t\taudio {Boolean}\n   \t\t\t\tvideo {Boolean}\n    */\n  ;\n  _proto2.onRemoteCall = function () {\n    function onRemoteCall(data) {\n      var _this11 = this;\n      if (this.autoAccept === true) {\n        setTimeout(function () {\n          _this11.joinCall({\n            to: data.from,\n            monitor: data.monitor,\n            media: data.media\n          });\n        }, 0);\n        return;\n      }\n      var user = Meteor.users.findOne(data.from);\n      var fromUsername = undefined;\n      if (user && user.username) {\n        fromUsername = user.username;\n      }\n      var subscription = ChatSubscription.findOne({\n        rid: data.room\n      });\n      var icon;\n      var title;\n      if (data.monitor === true) {\n        icon = 'eye';\n        title = t('WebRTC_monitor_call_from_%s', fromUsername);\n      } else if (subscription && subscription.t === 'd') {\n        if (data.media && data.media.video) {\n          icon = 'videocam';\n          title = t('WebRTC_direct_video_call_from_%s', fromUsername);\n        } else {\n          icon = 'phone';\n          title = t('WebRTC_direct_audio_call_from_%s', fromUsername);\n        }\n      } else if (data.media && data.media.video) {\n        icon = 'videocam';\n        title = t('WebRTC_group_video_call_from_%s', subscription.name);\n      } else {\n        icon = 'phone';\n        title = t('WebRTC_group_audio_call_from_%s', subscription.name);\n      }\n      imperativeModal.open({\n        component: GenericModal,\n        props: {\n          title: title,\n          icon: icon,\n          confirmText: t('Yes'),\n          cancelText: t('No'),\n          children: t('Do_you_want_to_accept'),\n          onConfirm: function () {\n            goToRoomById(data.room);\n            return _this11.joinCall({\n              to: data.from,\n              monitor: data.monitor,\n              media: data.media\n            });\n          },\n          onCancel: function () {\n            return _this11.stop();\n          },\n          onClose: function () {\n            return _this11.stop();\n          }\n        }\n      });\n    }\n    return onRemoteCall;\n  }()\n  /*\n   \t\t@param data {Object}\n   \t\t\tto {String}\n   \t\t\tmonitor {Boolean}\n   \t\t\tmedia {Object}\n   \t\t\t\taudio {Boolean}\n   \t\t\t\tvideo {Boolean}\n   \t\t\t\tdesktop {Boolean}\n    */\n  ;\n  _proto2.joinCall = function () {\n    function joinCall() {\n      var _this12 = this;\n      var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      data.media = this.media;\n      for (var _len6 = arguments.length, args = new Array(_len6 > 1 ? _len6 - 1 : 0), _key6 = 1; _key6 < _len6; _key6++) {\n        args[_key6 - 1] = arguments[_key6];\n      }\n      this.log('joinCall', [data].concat(args));\n      this.getLocalUserMedia(function () {\n        _this12.remoteMonitoring = data.monitor;\n        _this12.active = true;\n        _this12.transport.joinCall(data);\n      });\n    }\n    return joinCall;\n  }();\n  _proto2.onRemoteJoin = function () {\n    function onRemoteJoin(data) {\n      var _this13 = this;\n      if (this.active !== true) {\n        return;\n      }\n      for (var _len7 = arguments.length, args = new Array(_len7 > 1 ? _len7 - 1 : 0), _key7 = 1; _key7 < _len7; _key7++) {\n        args[_key7 - 1] = arguments[_key7];\n      }\n      this.log('onRemoteJoin', [data].concat(args));\n      var peerConnection = this.getPeerConnection(data.from);\n\n      // needsRefresh = false\n      // if peerConnection.iceConnectionState isnt 'new'\n      // needsAudio = data.media.audio is true and peerConnection.remoteMedia.audio isnt true\n      // needsVideo = data.media.video is true and peerConnection.remoteMedia.video isnt true\n      // needsRefresh = needsAudio or needsVideo or data.media.desktop isnt peerConnection.remoteMedia.desktop\n\n      // # if peerConnection.signalingState is \"have-local-offer\" or needsRefresh\n\n      if (peerConnection.signalingState !== 'checking') {\n        this.stopPeerConnection(data.from);\n        peerConnection = this.getPeerConnection(data.from);\n      }\n      if (peerConnection.iceConnectionState !== 'new') {\n        return;\n      }\n      peerConnection.remoteMedia = data.media;\n      if (this.localStream) {\n        peerConnection.addStream(this.localStream);\n      }\n      var onOffer = function (offer) {\n        var onLocalDescription = function () {\n          _this13.transport.sendDescription({\n            to: data.from,\n            type: 'offer',\n            ts: peerConnection.createdAt,\n            media: _this13.media,\n            description: {\n              sdp: offer.sdp,\n              type: offer.type\n            }\n          });\n        };\n        peerConnection.setLocalDescription(new RTCSessionDescription(offer), onLocalDescription, _this13.onError);\n      };\n      if (data.monitor === true) {\n        peerConnection.createOffer(onOffer, this.onError, {\n          mandatory: {\n            OfferToReceiveAudio: data.media.audio,\n            OfferToReceiveVideo: data.media.video\n          }\n        });\n      } else {\n        peerConnection.createOffer(onOffer, this.onError);\n      }\n    }\n    return onRemoteJoin;\n  }();\n  _proto2.onRemoteOffer = function () {\n    function onRemoteOffer(data) {\n      var _this14 = this;\n      if (this.active !== true) {\n        return;\n      }\n      for (var _len8 = arguments.length, args = new Array(_len8 > 1 ? _len8 - 1 : 0), _key8 = 1; _key8 < _len8; _key8++) {\n        args[_key8 - 1] = arguments[_key8];\n      }\n      this.log('onRemoteOffer', [data].concat(args));\n      var peerConnection = this.getPeerConnection(data.from);\n      if (['have-local-offer', 'stable'].includes(peerConnection.signalingState) && peerConnection.createdAt < data.ts) {\n        this.stopPeerConnection(data.from);\n        peerConnection = this.getPeerConnection(data.from);\n      }\n      if (peerConnection.iceConnectionState !== 'new') {\n        return;\n      }\n      peerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\n      try {\n        if (this.localStream) {\n          peerConnection.addStream(this.localStream);\n        }\n      } catch (error) {\n        console.log(error);\n      }\n      var onAnswer = function (answer) {\n        var onLocalDescription = function () {\n          _this14.transport.sendDescription({\n            to: data.from,\n            type: 'answer',\n            ts: peerConnection.createdAt,\n            description: {\n              sdp: answer.sdp,\n              type: answer.type\n            }\n          });\n        };\n        peerConnection.setLocalDescription(new RTCSessionDescription(answer), onLocalDescription, _this14.onError);\n      };\n      peerConnection.createAnswer(onAnswer, this.onError);\n    }\n    return onRemoteOffer;\n  }()\n  /*\n   \t\t@param data {Object}\n   \t\t\tto {String}\n   \t\t\tfrom {String}\n   \t\t\tcandidate {RTCIceCandidate JSON encoded}\n    */\n  ;\n  _proto2.onRemoteCandidate = function () {\n    function onRemoteCandidate(data) {\n      var _this$remoteItems$get;\n      if (this.active !== true) {\n        return;\n      }\n      if (data.to !== this.selfId) {\n        return;\n      }\n      for (var _len9 = arguments.length, args = new Array(_len9 > 1 ? _len9 - 1 : 0), _key9 = 1; _key9 < _len9; _key9++) {\n        args[_key9 - 1] = arguments[_key9];\n      }\n      this.log('onRemoteCandidate', [data].concat(args));\n      var peerConnection = this.getPeerConnection(data.from);\n      if (peerConnection.iceConnectionState !== 'closed' && peerConnection.iceConnectionState !== 'failed' && peerConnection.iceConnectionState !== 'disconnected' && peerConnection.iceConnectionState !== 'completed') {\n        peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));\n      }\n      document.querySelector('video#remoteVideo').srcObject = (_this$remoteItems$get = this.remoteItems.get()[0]) === null || _this$remoteItems$get === void 0 ? void 0 : _this$remoteItems$get.url;\n    }\n    return onRemoteCandidate;\n  }()\n  /*\n   \t\t@param data {Object}\n   \t\t\tto {String}\n   \t\t\tfrom {String}\n   \t\t\ttype {String} [offer, answer]\n   \t\t\tdescription {RTCSessionDescription JSON encoded}\n   \t\t\tts {Integer}\n   \t\t\tmedia {Object}\n   \t\t\t\taudio {Boolean}\n   \t\t\t\tvideo {Boolean}\n   \t\t\t\tdesktop {Boolean}\n    */\n  ;\n  _proto2.onRemoteDescription = function () {\n    function onRemoteDescription(data) {\n      if (this.active !== true) {\n        return;\n      }\n      if (data.to !== this.selfId) {\n        return;\n      }\n      for (var _len10 = arguments.length, args = new Array(_len10 > 1 ? _len10 - 1 : 0), _key10 = 1; _key10 < _len10; _key10++) {\n        args[_key10 - 1] = arguments[_key10];\n      }\n      this.log('onRemoteDescription', [data].concat(args));\n      var peerConnection = this.getPeerConnection(data.from);\n      if (data.type === 'offer') {\n        peerConnection.remoteMedia = data.media;\n        this.onRemoteOffer({\n          from: data.from,\n          ts: data.ts,\n          description: data.description\n        });\n      } else {\n        peerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\n      }\n    }\n    return onRemoteDescription;\n  }();\n  return WebRTCClass;\n}();\nvar WebRTC = new ( /*#__PURE__*/function () {\n  function _class() {\n    this.instancesByRoomId = {};\n  }\n  var _proto3 = _class.prototype;\n  _proto3.getInstanceByRoomId = function () {\n    function getInstanceByRoomId(rid) {\n      var visitorId = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var enabled = false;\n      if (!visitorId) {\n        var subscription = ChatSubscription.findOne({\n          rid: rid\n        });\n        if (!subscription) {\n          return;\n        }\n        switch (subscription.t) {\n          case 'd':\n            enabled = settings.get('WebRTC_Enable_Direct');\n            break;\n          case 'p':\n            enabled = settings.get('WebRTC_Enable_Private');\n            break;\n          case 'c':\n            enabled = settings.get('WebRTC_Enable_Channel');\n            break;\n          case 'l':\n            enabled = settings.get('Omnichannel_call_provider') === 'WebRTC';\n        }\n      } else {\n        enabled = settings.get('Omnichannel_call_provider') === 'WebRTC';\n      }\n      enabled = enabled && settings.get('WebRTC_Enabled');\n      if (enabled === false) {\n        return;\n      }\n      if (this.instancesByRoomId[rid] == null) {\n        var uid = Meteor.userId();\n        var autoAccept = false;\n        if (visitorId) {\n          uid = visitorId;\n          autoAccept = true;\n        }\n        this.instancesByRoomId[rid] = new WebRTCClass(uid, rid, autoAccept);\n      }\n      return this.instancesByRoomId[rid];\n    }\n    return getInstanceByRoomId;\n  }();\n  return _class;\n}())();\nMeteor.startup(function () {\n  Tracker.autorun(function () {\n    if (Meteor.userId()) {\n      sdk.stream('notify-user', [Meteor.userId() + \"/\" + WEB_RTC_EVENTS.WEB_RTC], function (type, data) {\n        if (data.room == null) {\n          return;\n        }\n        var webrtc = WebRTC.getInstanceByRoomId(data.room);\n        webrtc.onUserStream(type, data);\n      });\n    }\n  });\n});","map":{"version":3,"names":["_toConsumableArray","module","link","default","v","_slicedToArray","_inheritsLoose","export","WebRTC","Emitter","Meteor","ReactiveVar","Tracker","GenericModal","imperativeModal","goToRoomById","ChatSubscription","settings","sdk","t","WEB_RTC_EVENTS","ChromeScreenShare","WebRTCTransportClass","_Emitter","webrtcInstance","_this","call","debug","stream","room","WEB_RTC","type","data","log","emit","_proto","prototype","_console","console","apply","arguments","onUserStream","startCall","selfId","publish","CALL","from","media","monitor","joinCall","to","JOIN","sendCandidate","CANDIDATE","sendDescription","DESCRIPTION","sendStatus","STATUS","onRemoteCall","fn","on","onRemoteJoin","onRemoteCandidate","onRemoteDescription","onRemoteStatus","WebRTCClass","_this2","autoAccept","length","undefined","resetCallInProgress","callInProgress","set","stopPeerConnection","id","peerConnection","peerConnections","close","updateRemoteItems","config","iceServers","TransportClass","servers","get","trim","replace","split","forEach","server","serverConfig","urls","pop","username","decodeURIComponent","credential","push","remoteItems","remoteItemsById","audioEnabled","videoEnabled","overlayEnabled","screenShareEnabled","localUrl","active","remoteMonitoring","navigator","userAgent","toLocaleLowerCase","indexOf","screenShareAvailable","includes","video","audio","transport","bind","setInterval","checkPeerConnections","_proto2","_this$transport","_len","args","Array","_key","onError","_len2","_key2","error","_this3","date","Date","now","Object","entries","some","_ref","_ref2","iceConnectionState","createdAt","items","itemsById","_ref3","_ref4","getRemoteStreams","remoteStream","item","url","state","stateText","connected","broadcastStatus","remoteConnections","keys","_ref5","_ref6","remoteMedia","_this4","clearTimeout","callInProgressTimeout","setTimeout","concat","remoteConnection","getPeerConnection","_this5","RTCPeerConnection","eventNames","eventName","addEventListener","e","candidate","sdpMLineIndex","sdpMid","stop","_getUserMedia","onSuccess","_this6","onSuccessLocal","AudioContext","getAudioTracks","audioContext","source","createMediaStreamSource","volume","createGain","connect","peer","createMediaStreamDestination","gain","value","removeTrack","addTrack","mediaDevices","getUserMedia","then","catch","_this7","desktop","getScreen","audioStream","refresh","open","component","props","variant","title","isChromeExtensionInstalled","installed","isFirefoxExtensionInstalled","window","rocketchatscreenshare","confirmText","cancelText","children","onConfirm","chrome","webstore","install","_error","getScreenSuccess","mozMediaSource","mediaSource","getSourceId","mandatory","chromeMediaSource","chromeMediaSourceId","maxWidth","maxHeight","getAudioSuccess","getAudioError","getLocalUserMedia","callback","_this8","_len3","_key3","localStream","disableAudio","disableVideo","_ref7","_ref8","addStream","document","querySelector","srcObject","stopAllPeerConnections","setAudioEnabled","enabled","enableAudio","toggleAudio","setVideoEnabled","getVideoTracks","disableScreenShare","setScreenShareEnabled","enableScreenShare","_this9","err","enableVideo","toggleVideo","getTracks","track","_this10","_len4","_key4","startCallAsMonitor","_len5","_key5","_this11","user","users","findOne","fromUsername","subscription","rid","icon","name","onCancel","onClose","_this12","_len6","_key6","_this13","_len7","_key7","signalingState","onOffer","offer","onLocalDescription","ts","description","sdp","setLocalDescription","RTCSessionDescription","createOffer","OfferToReceiveAudio","OfferToReceiveVideo","onRemoteOffer","_this14","_len8","_key8","setRemoteDescription","onAnswer","answer","createAnswer","_this$remoteItems$get","_len9","_key9","addIceCandidate","RTCIceCandidate","_len10","_key10","_class","instancesByRoomId","_proto3","getInstanceByRoomId","visitorId","uid","userId","startup","autorun","webrtc"],"sources":["app/webrtc/client/WebRTCClass.js"],"sourcesContent":["import { Emitter } from '@rocket.chat/emitter';\nimport { Meteor } from 'meteor/meteor';\nimport { ReactiveVar } from 'meteor/reactive-var';\nimport { Tracker } from 'meteor/tracker';\n\nimport GenericModal from '../../../client/components/GenericModal';\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\nimport { goToRoomById } from '../../../client/lib/utils/goToRoomById';\nimport { ChatSubscription } from '../../models/client';\nimport { settings } from '../../settings/client';\nimport { sdk } from '../../utils/client/lib/SDKClient';\nimport { t } from '../../utils/lib/i18n';\nimport { WEB_RTC_EVENTS } from '../lib/constants';\nimport { ChromeScreenShare } from './screenShare';\n\nclass WebRTCTransportClass extends Emitter {\n\tconstructor(webrtcInstance) {\n\t\tsuper();\n\t\tthis.debug = false;\n\t\tthis.webrtcInstance = webrtcInstance;\n\t\tsdk.stream('notify-room', [`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`], (type, data) => {\n\t\t\tthis.log('WebRTCTransportClass - onRoom', type, data);\n\t\t\tthis.emit(type, data);\n\t\t});\n\t}\n\n\tlog(...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log(...args);\n\t\t}\n\t}\n\n\tonUserStream(type, data) {\n\t\tif (data.room !== this.webrtcInstance.room) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('WebRTCTransportClass - onUser', type, data);\n\t\tthis.emit(type, data);\n\t}\n\n\tstartCall(data) {\n\t\tthis.log('WebRTCTransportClass - startCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\n\t\tsdk.publish('notify-room-users', [\n\t\t\t`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`,\n\t\t\tWEB_RTC_EVENTS.CALL,\n\t\t\t{\n\t\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\t\troom: this.webrtcInstance.room,\n\t\t\t\tmedia: data.media,\n\t\t\t\tmonitor: data.monitor,\n\t\t\t},\n\t\t]);\n\t}\n\n\tjoinCall(data) {\n\t\tthis.log('WebRTCTransportClass - joinCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\n\t\tif (data.monitor === true) {\n\t\t\tsdk.publish('notify-user', [\n\t\t\t\t`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`,\n\t\t\t\tWEB_RTC_EVENTS.JOIN,\n\t\t\t\t{\n\t\t\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\t\t\troom: this.webrtcInstance.room,\n\t\t\t\t\tmedia: data.media,\n\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t},\n\t\t\t]);\n\t\t} else {\n\t\t\tsdk.publish('notify-room-users', [\n\t\t\t\t`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`,\n\t\t\t\tWEB_RTC_EVENTS.JOIN,\n\t\t\t\t{\n\t\t\t\t\tfrom: this.webrtcInstance.selfId,\n\t\t\t\t\troom: this.webrtcInstance.room,\n\t\t\t\t\tmedia: data.media,\n\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t},\n\t\t\t]);\n\t\t}\n\t}\n\n\tsendCandidate(data) {\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tdata.room = this.webrtcInstance.room;\n\t\tthis.log('WebRTCTransportClass - sendCandidate', data);\n\t\tsdk.publish('notify-user', [`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.CANDIDATE, data]);\n\t}\n\n\tsendDescription(data) {\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tdata.room = this.webrtcInstance.room;\n\t\tthis.log('WebRTCTransportClass - sendDescription', data);\n\t\tsdk.publish('notify-user', [`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.DESCRIPTION, data]);\n\t}\n\n\tsendStatus(data) {\n\t\tthis.log('WebRTCTransportClass - sendStatus', data, this.webrtcInstance.room);\n\t\tdata.from = this.webrtcInstance.selfId;\n\t\tsdk.publish('notify-room', [`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.STATUS, data]);\n\t}\n\n\tonRemoteCall(fn) {\n\t\treturn this.on(WEB_RTC_EVENTS.CALL, fn);\n\t}\n\n\tonRemoteJoin(fn) {\n\t\treturn this.on(WEB_RTC_EVENTS.JOIN, fn);\n\t}\n\n\tonRemoteCandidate(fn) {\n\t\treturn this.on(WEB_RTC_EVENTS.CANDIDATE, fn);\n\t}\n\n\tonRemoteDescription(fn) {\n\t\treturn this.on(WEB_RTC_EVENTS.DESCRIPTION, fn);\n\t}\n\n\tonRemoteStatus(fn) {\n\t\treturn this.on(WEB_RTC_EVENTS.STATUS, fn);\n\t}\n}\n\nclass WebRTCClass {\n\t/*\n  \t\t@param seldId {String}\n  \t\t@param room {String}\n   */\n\n\tconstructor(selfId, room, autoAccept = false) {\n\t\tthis.config = {\n\t\t\ticeServers: [],\n\t\t};\n\t\tthis.debug = false;\n\t\tthis.TransportClass = WebRTCTransportClass;\n\t\tthis.selfId = selfId;\n\t\tthis.room = room;\n\t\tlet servers = settings.get('WebRTC_Servers');\n\t\tif (servers && servers.trim() !== '') {\n\t\t\tservers = servers.replace(/\\s/g, '');\n\t\t\tservers = servers.split(',');\n\n\t\t\tservers.forEach((server) => {\n\t\t\t\tserver = server.split('@');\n\t\t\t\tconst serverConfig = {\n\t\t\t\t\turls: server.pop(),\n\t\t\t\t};\n\t\t\t\tif (server.length === 1) {\n\t\t\t\t\tserver = server[0].split(':');\n\t\t\t\t\tserverConfig.username = decodeURIComponent(server[0]);\n\t\t\t\t\tserverConfig.credential = decodeURIComponent(server[1]);\n\t\t\t\t}\n\t\t\t\tthis.config.iceServers.push(serverConfig);\n\t\t\t});\n\t\t}\n\t\tthis.peerConnections = {};\n\t\tthis.remoteItems = new ReactiveVar([]);\n\t\tthis.remoteItemsById = new ReactiveVar({});\n\t\tthis.callInProgress = new ReactiveVar(false);\n\t\tthis.audioEnabled = new ReactiveVar(false);\n\t\tthis.videoEnabled = new ReactiveVar(false);\n\t\tthis.overlayEnabled = new ReactiveVar(false);\n\t\tthis.screenShareEnabled = new ReactiveVar(false);\n\t\tthis.localUrl = new ReactiveVar();\n\t\tthis.active = false;\n\t\tthis.remoteMonitoring = false;\n\t\tthis.monitor = false;\n\t\tthis.autoAccept = autoAccept;\n\t\tthis.navigator = undefined;\n\t\tconst userAgent = navigator.userAgent.toLocaleLowerCase();\n\n\t\tif (userAgent.indexOf('electron') !== -1) {\n\t\t\tthis.navigator = 'electron';\n\t\t} else if (userAgent.indexOf('chrome') !== -1) {\n\t\t\tthis.navigator = 'chrome';\n\t\t} else if (userAgent.indexOf('firefox') !== -1) {\n\t\t\tthis.navigator = 'firefox';\n\t\t} else if (userAgent.indexOf('safari') !== -1) {\n\t\t\tthis.navigator = 'safari';\n\t\t}\n\n\t\tthis.screenShareAvailable = ['chrome', 'firefox', 'electron'].includes(this.navigator);\n\t\tthis.media = {\n\t\t\tvideo: true,\n\t\t\taudio: true,\n\t\t};\n\t\tthis.transport = new this.TransportClass(this);\n\t\tthis.transport.onRemoteCall(this.onRemoteCall.bind(this));\n\t\tthis.transport.onRemoteJoin(this.onRemoteJoin.bind(this));\n\t\tthis.transport.onRemoteCandidate(this.onRemoteCandidate.bind(this));\n\t\tthis.transport.onRemoteDescription(this.onRemoteDescription.bind(this));\n\t\tthis.transport.onRemoteStatus(this.onRemoteStatus.bind(this));\n\n\t\tsetInterval(this.checkPeerConnections.bind(this), 1000);\n\t}\n\n\tonUserStream(...args) {\n\t\treturn this.transport.onUserStream(...args);\n\t}\n\n\tlog(...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log.apply(console, args);\n\t\t}\n\t}\n\n\tonError(...args) {\n\t\tconsole.error.apply(console, args);\n\t}\n\n\tcheckPeerConnections() {\n\t\tconst { peerConnections } = this;\n\t\tconst date = Date.now();\n\t\tObject.entries(peerConnections).some(([id, peerConnection]) => {\n\t\t\tif (!['connected', 'completed'].includes(peerConnection.iceConnectionState) && peerConnection.createdAt + 5000 < date) {\n\t\t\t\tthis.stopPeerConnection(id);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tupdateRemoteItems() {\n\t\tconst items = [];\n\t\tconst itemsById = {};\n\t\tconst { peerConnections } = this;\n\n\t\tObject.entries(peerConnections).forEach(([id, peerConnection]) => {\n\t\t\tpeerConnection.getRemoteStreams().forEach((remoteStream) => {\n\t\t\t\tconst item = {\n\t\t\t\t\tid,\n\t\t\t\t\turl: remoteStream,\n\t\t\t\t\tstate: peerConnection.iceConnectionState,\n\t\t\t\t};\n\t\t\t\tswitch (peerConnection.iceConnectionState) {\n\t\t\t\t\tcase 'checking':\n\t\t\t\t\t\titem.stateText = 'Connecting...';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'connected':\n\t\t\t\t\tcase 'completed':\n\t\t\t\t\t\titem.stateText = 'Connected';\n\t\t\t\t\t\titem.connected = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'disconnected':\n\t\t\t\t\t\titem.stateText = 'Disconnected';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'failed':\n\t\t\t\t\t\titem.stateText = 'Failed';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'closed':\n\t\t\t\t\t\titem.stateText = 'Closed';\n\t\t\t\t}\n\t\t\t\titems.push(item);\n\t\t\t\titemsById[id] = item;\n\t\t\t});\n\t\t});\n\t\tthis.remoteItems.set(items);\n\t\tthis.remoteItemsById.set(itemsById);\n\t}\n\n\tresetCallInProgress = () => {\n\t\tthis.callInProgress.set(false);\n\t};\n\n\tbroadcastStatus() {\n\t\tif (this.active !== true || this.monitor === true || this.remoteMonitoring === true) {\n\t\t\treturn;\n\t\t}\n\t\tconst remoteConnections = [];\n\t\tconst { peerConnections } = this;\n\t\tObject.keys(peerConnections).entries(([id, { remoteMedia: media }]) => {\n\t\t\tremoteConnections.push({\n\t\t\t\tid,\n\t\t\t\tmedia,\n\t\t\t});\n\t\t});\n\n\t\tthis.transport.sendStatus({\n\t\t\tmedia: this.media,\n\t\t\tremoteConnections,\n\t\t});\n\t}\n\n\t/*\n  \t\t@param data {Object}\n  \t\t\tfrom {String}\n  \t\t\tmedia {Object}\n  \t\t\tremoteConnections {Array[Object]}\n  \t\t\t\tid {String}\n  \t\t\t\tmedia {Object}\n   */\n\n\tonRemoteStatus(data) {\n\t\t// this.log(onRemoteStatus, arguments);\n\t\tthis.callInProgress.set(true);\n\t\tclearTimeout(this.callInProgressTimeout);\n\t\tthis.callInProgressTimeout = setTimeout(this.resetCallInProgress, 2000);\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tconst remoteConnections = [\n\t\t\t{\n\t\t\t\tid: data.from,\n\t\t\t\tmedia: data.media,\n\t\t\t},\n\t\t\t...data.remoteConnections,\n\t\t];\n\n\t\tremoteConnections.forEach((remoteConnection) => {\n\t\t\tif (remoteConnection.id !== this.selfId && this.peerConnections[remoteConnection.id] == null) {\n\t\t\t\tthis.log('reconnecting with', remoteConnection.id);\n\t\t\t\tthis.onRemoteJoin({\n\t\t\t\t\tfrom: remoteConnection.id,\n\t\t\t\t\tmedia: remoteConnection.media,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t/*\n  \t\t@param id {String}\n   */\n\n\tgetPeerConnection(id) {\n\t\tif (this.peerConnections[id] != null) {\n\t\t\treturn this.peerConnections[id];\n\t\t}\n\t\tconst peerConnection = new RTCPeerConnection(this.config);\n\n\t\tpeerConnection.createdAt = Date.now();\n\t\tpeerConnection.remoteMedia = {};\n\t\tthis.peerConnections[id] = peerConnection;\n\t\tconst eventNames = [\n\t\t\t'icecandidate',\n\t\t\t'addstream',\n\t\t\t'removestream',\n\t\t\t'iceconnectionstatechange',\n\t\t\t'datachannel',\n\t\t\t'identityresult',\n\t\t\t'idpassertionerror',\n\t\t\t'idpvalidationerror',\n\t\t\t'negotiationneeded',\n\t\t\t'peeridentity',\n\t\t\t'signalingstatechange',\n\t\t];\n\n\t\teventNames.forEach((eventName) => {\n\t\t\tpeerConnection.addEventListener(eventName, (e) => {\n\t\t\t\tthis.log(id, e.type, e);\n\t\t\t});\n\t\t});\n\n\t\tpeerConnection.addEventListener('icecandidate', (e) => {\n\t\t\tif (e.candidate == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.transport.sendCandidate({\n\t\t\t\tto: id,\n\t\t\t\tcandidate: {\n\t\t\t\t\tcandidate: e.candidate.candidate,\n\t\t\t\t\tsdpMLineIndex: e.candidate.sdpMLineIndex,\n\t\t\t\t\tsdpMid: e.candidate.sdpMid,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t\tpeerConnection.addEventListener('addstream', () => {\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\tpeerConnection.addEventListener('removestream', () => {\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\tpeerConnection.addEventListener('iceconnectionstatechange', () => {\n\t\t\tif (\n\t\t\t\t(peerConnection.iceConnectionState === 'disconnected' || peerConnection.iceConnectionState === 'closed') &&\n\t\t\t\tpeerConnection === this.peerConnections[id]\n\t\t\t) {\n\t\t\t\tthis.stopPeerConnection(id);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (Object.keys(this.peerConnections).length === 0) {\n\t\t\t\t\t\tthis.stop();\n\t\t\t\t\t}\n\t\t\t\t}, 3000);\n\t\t\t}\n\t\t\tthis.updateRemoteItems();\n\t\t});\n\t\treturn peerConnection;\n\t}\n\n\t_getUserMedia(media, onSuccess, onError) {\n\t\tconst onSuccessLocal = (stream) => {\n\t\t\tif (AudioContext && stream.getAudioTracks().length > 0) {\n\t\t\t\tconst audioContext = new AudioContext();\n\t\t\t\tconst source = audioContext.createMediaStreamSource(stream);\n\t\t\t\tconst volume = audioContext.createGain();\n\t\t\t\tsource.connect(volume);\n\t\t\t\tconst peer = audioContext.createMediaStreamDestination();\n\t\t\t\tvolume.connect(peer);\n\t\t\t\tvolume.gain.value = 0.6;\n\t\t\t\tstream.removeTrack(stream.getAudioTracks()[0]);\n\t\t\t\tstream.addTrack(peer.stream.getAudioTracks()[0]);\n\t\t\t\tstream.volume = volume;\n\t\t\t\tthis.audioContext = audioContext;\n\t\t\t}\n\t\t\tonSuccess(stream);\n\t\t};\n\t\tif (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n\t\t\treturn navigator.mediaDevices.getUserMedia(media).then(onSuccessLocal).catch(onError);\n\t\t}\n\n\t\tnavigator.getUserMedia(media, onSuccessLocal, onError);\n\t}\n\n\tgetUserMedia(media, onSuccess, onError = this.onError) {\n\t\tif (media.desktop !== true) {\n\t\t\tthis._getUserMedia(media, onSuccess, onError);\n\t\t\treturn;\n\t\t}\n\t\tif (this.screenShareAvailable !== true) {\n\t\t\tconsole.log('Screen share is not avaliable');\n\t\t\treturn;\n\t\t}\n\t\tconst getScreen = (audioStream) => {\n\t\t\tconst refresh = function () {\n\t\t\t\timperativeModal.open({\n\t\t\t\t\tcomponent: GenericModal,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tvariant: 'warning',\n\t\t\t\t\t\ttitle: t('Refresh_your_page_after_install_to_enable_screen_sharing'),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tconst isChromeExtensionInstalled = this.navigator === 'chrome' && ChromeScreenShare.installed;\n\t\t\tconst isFirefoxExtensionInstalled = this.navigator === 'firefox' && window.rocketchatscreenshare != null;\n\n\t\t\tif (!isChromeExtensionInstalled && !isFirefoxExtensionInstalled) {\n\t\t\t\timperativeModal.open({\n\t\t\t\t\tcomponent: GenericModal,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttitle: t('Screen_Share'),\n\t\t\t\t\t\tvariant: 'warning',\n\t\t\t\t\t\tconfirmText: t('Install_Extension'),\n\t\t\t\t\t\tcancelText: t('Cancel'),\n\t\t\t\t\t\tchildren: t('You_need_install_an_extension_to_allow_screen_sharing'),\n\t\t\t\t\t\tonConfirm: () => {\n\t\t\t\t\t\t\tif (this.navigator === 'chrome') {\n\t\t\t\t\t\t\t\tconst url = 'https://chrome.google.com/webstore/detail/rocketchat-screen-share/nocfbnnmjnndkbipkabodnheejiegccf';\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tchrome.webstore.install(url, refresh, () => {\n\t\t\t\t\t\t\t\t\t\twindow.open(url);\n\t\t\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} catch (_error) {\n\t\t\t\t\t\t\t\t\tconsole.log(_error);\n\t\t\t\t\t\t\t\t\twindow.open(url);\n\t\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (this.navigator === 'firefox') {\n\t\t\t\t\t\t\t\twindow.open('https://addons.mozilla.org/en-GB/firefox/addon/rocketchat-screen-share/');\n\t\t\t\t\t\t\t\trefresh();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\treturn onError(false);\n\t\t\t}\n\n\t\t\tconst getScreenSuccess = (stream) => {\n\t\t\t\tif (audioStream != null) {\n\t\t\t\t\tstream.addTrack(audioStream.getAudioTracks()[0]);\n\t\t\t\t}\n\t\t\t\tonSuccess(stream);\n\t\t\t};\n\t\t\tif (this.navigator === 'firefox') {\n\t\t\t\tmedia = {\n\t\t\t\t\taudio: media.audio,\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tmozMediaSource: 'window',\n\t\t\t\t\t\tmediaSource: 'window',\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tthis._getUserMedia(media, getScreenSuccess, onError);\n\t\t\t} else {\n\t\t\t\tChromeScreenShare.getSourceId(this.navigator, (id) => {\n\t\t\t\t\tmedia = {\n\t\t\t\t\t\taudio: false,\n\t\t\t\t\t\tvideo: {\n\t\t\t\t\t\t\tmandatory: {\n\t\t\t\t\t\t\t\tchromeMediaSource: 'desktop',\n\t\t\t\t\t\t\t\tchromeMediaSourceId: id,\n\t\t\t\t\t\t\t\tmaxWidth: 1280,\n\t\t\t\t\t\t\t\tmaxHeight: 720,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t\tthis._getUserMedia(media, getScreenSuccess, onError);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tif (this.navigator === 'firefox' || media.audio == null || media.audio === false) {\n\t\t\tgetScreen();\n\t\t} else {\n\t\t\tconst getAudioSuccess = (audioStream) => {\n\t\t\t\tgetScreen(audioStream);\n\t\t\t};\n\t\t\tconst getAudioError = () => {\n\t\t\t\tgetScreen();\n\t\t\t};\n\n\t\t\tthis._getUserMedia(\n\t\t\t\t{\n\t\t\t\t\taudio: media.audio,\n\t\t\t\t},\n\t\t\t\tgetAudioSuccess,\n\t\t\t\tgetAudioError,\n\t\t\t);\n\t\t}\n\t}\n\n\t/*\n  \t\t@param callback {Function}\n   */\n\n\tgetLocalUserMedia(callback, ...args) {\n\t\tthis.log('getLocalUserMedia', [callback, ...args]);\n\t\tif (this.localStream != null) {\n\t\t\treturn callback(null, this.localStream);\n\t\t}\n\t\tconst onSuccess = (stream) => {\n\t\t\tthis.localStream = stream;\n\t\t\t!this.audioEnabled.get() && this.disableAudio();\n\t\t\t!this.videoEnabled.get() && this.disableVideo();\n\t\t\tthis.localUrl.set(stream);\n\t\t\tconst { peerConnections } = this;\n\t\t\tObject.entries(peerConnections).forEach(([, peerConnection]) => peerConnection.addStream(stream));\n\t\t\tdocument.querySelector('video#localVideo').srcObject = stream;\n\t\t\tcallback(null, this.localStream);\n\t\t};\n\t\tconst onError = (error) => {\n\t\t\tcallback(false);\n\t\t\tthis.onError(error);\n\t\t};\n\t\tthis.getUserMedia(this.media, onSuccess, onError);\n\t}\n\n\t/*\n  \t\t@param id {String}\n   */\n\n\tstopPeerConnection = (id) => {\n\t\tconst peerConnection = this.peerConnections[id];\n\t\tif (peerConnection == null) {\n\t\t\treturn;\n\t\t}\n\t\tdelete this.peerConnections[id];\n\t\tpeerConnection.close();\n\t\tthis.updateRemoteItems();\n\t};\n\n\tstopAllPeerConnections() {\n\t\tconst { peerConnections } = this;\n\n\t\tObject.keys(peerConnections).forEach(this.stopPeerConnection);\n\n\t\twindow.audioContext && window.audioContext.close();\n\t}\n\n\tsetAudioEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.localStream.getAudioTracks().forEach((audio) => {\n\t\t\t\taudio.enabled = enabled;\n\t\t\t});\n\t\t\tthis.audioEnabled.set(enabled);\n\t\t}\n\t}\n\n\tdisableAudio() {\n\t\tthis.setAudioEnabled(false);\n\t}\n\n\tenableAudio() {\n\t\tthis.setAudioEnabled(true);\n\t}\n\n\ttoggleAudio() {\n\t\tif (this.audioEnabled.get()) {\n\t\t\treturn this.disableAudio();\n\t\t}\n\t\treturn this.enableAudio();\n\t}\n\n\tsetVideoEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.localStream.getVideoTracks().forEach((video) => {\n\t\t\t\tvideo.enabled = enabled;\n\t\t\t});\n\t\t\tthis.videoEnabled.set(enabled);\n\t\t}\n\t}\n\n\tdisableScreenShare() {\n\t\tthis.setScreenShareEnabled(false);\n\t}\n\n\tenableScreenShare() {\n\t\tthis.setScreenShareEnabled(true);\n\t}\n\n\tsetScreenShareEnabled(enabled = true) {\n\t\tif (this.localStream != null) {\n\t\t\tthis.media.desktop = enabled;\n\t\t\tdelete this.localStream;\n\t\t\tthis.getLocalUserMedia((err) => {\n\t\t\t\tif (err != null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.screenShareEnabled.set(enabled);\n\t\t\t\tthis.stopAllPeerConnections();\n\t\t\t\tthis.joinCall();\n\t\t\t});\n\t\t}\n\t}\n\n\tdisableVideo() {\n\t\tthis.setVideoEnabled(false);\n\t}\n\n\tenableVideo() {\n\t\tthis.setVideoEnabled(true);\n\t}\n\n\ttoggleVideo() {\n\t\tif (this.videoEnabled.get()) {\n\t\t\treturn this.disableVideo();\n\t\t}\n\t\treturn this.enableVideo();\n\t}\n\n\tstop() {\n\t\tthis.active = false;\n\t\tthis.monitor = false;\n\t\tthis.remoteMonitoring = false;\n\t\tif (this.localStream != null && typeof this.localStream !== 'undefined') {\n\t\t\tthis.localStream.getTracks().forEach((track) => track.stop());\n\t\t}\n\t\tthis.localUrl.set(undefined);\n\t\tdelete this.localStream;\n\t\tthis.stopAllPeerConnections();\n\t}\n\n\t/*\n  \t\t@param media {Object}\n  \t\t\taudio {Boolean}\n  \t\t\tvideo {Boolean}\n   */\n\n\tstartCall(media = {}, ...args) {\n\t\tthis.log('startCall', [media, ...args]);\n\t\tthis.media = media;\n\t\tthis.getLocalUserMedia(() => {\n\t\t\tthis.active = true;\n\t\t\tthis.transport.startCall({\n\t\t\t\tmedia: this.media,\n\t\t\t});\n\t\t});\n\t}\n\n\tstartCallAsMonitor(media = {}, ...args) {\n\t\tthis.log('startCallAsMonitor', [media, ...args]);\n\t\tthis.media = media;\n\t\tthis.active = true;\n\t\tthis.monitor = true;\n\t\tthis.transport.startCall({\n\t\t\tmedia: this.media,\n\t\t\tmonitor: true,\n\t\t});\n\t}\n\n\t/*\n  \t\t@param data {Object}\n  \t\t\tfrom {String}\n  \t\t\tmonitor {Boolean}\n  \t\t\tmedia {Object}\n  \t\t\t\taudio {Boolean}\n  \t\t\t\tvideo {Boolean}\n   */\n\n\tonRemoteCall(data) {\n\t\tif (this.autoAccept === true) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.joinCall({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t\tmedia: data.media,\n\t\t\t\t});\n\t\t\t}, 0);\n\t\t\treturn;\n\t\t}\n\n\t\tconst user = Meteor.users.findOne(data.from);\n\t\tlet fromUsername = undefined;\n\t\tif (user && user.username) {\n\t\t\tfromUsername = user.username;\n\t\t}\n\t\tconst subscription = ChatSubscription.findOne({\n\t\t\trid: data.room,\n\t\t});\n\n\t\tlet icon;\n\t\tlet title;\n\t\tif (data.monitor === true) {\n\t\t\ticon = 'eye';\n\t\t\ttitle = t('WebRTC_monitor_call_from_%s', fromUsername);\n\t\t} else if (subscription && subscription.t === 'd') {\n\t\t\tif (data.media && data.media.video) {\n\t\t\t\ticon = 'videocam';\n\t\t\t\ttitle = t('WebRTC_direct_video_call_from_%s', fromUsername);\n\t\t\t} else {\n\t\t\t\ticon = 'phone';\n\t\t\t\ttitle = t('WebRTC_direct_audio_call_from_%s', fromUsername);\n\t\t\t}\n\t\t} else if (data.media && data.media.video) {\n\t\t\ticon = 'videocam';\n\t\t\ttitle = t('WebRTC_group_video_call_from_%s', subscription.name);\n\t\t} else {\n\t\t\ticon = 'phone';\n\t\t\ttitle = t('WebRTC_group_audio_call_from_%s', subscription.name);\n\t\t}\n\n\t\timperativeModal.open({\n\t\t\tcomponent: GenericModal,\n\t\t\tprops: {\n\t\t\t\ttitle,\n\t\t\t\ticon,\n\t\t\t\tconfirmText: t('Yes'),\n\t\t\t\tcancelText: t('No'),\n\t\t\t\tchildren: t('Do_you_want_to_accept'),\n\t\t\t\tonConfirm: () => {\n\t\t\t\t\tgoToRoomById(data.room);\n\t\t\t\t\treturn this.joinCall({\n\t\t\t\t\t\tto: data.from,\n\t\t\t\t\t\tmonitor: data.monitor,\n\t\t\t\t\t\tmedia: data.media,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonCancel: () => this.stop(),\n\t\t\t\tonClose: () => this.stop(),\n\t\t\t},\n\t\t});\n\t}\n\n\t/*\n  \t\t@param data {Object}\n  \t\t\tto {String}\n  \t\t\tmonitor {Boolean}\n  \t\t\tmedia {Object}\n  \t\t\t\taudio {Boolean}\n  \t\t\t\tvideo {Boolean}\n  \t\t\t\tdesktop {Boolean}\n   */\n\n\tjoinCall(data = {}, ...args) {\n\t\tdata.media = this.media;\n\t\tthis.log('joinCall', [data, ...args]);\n\t\tthis.getLocalUserMedia(() => {\n\t\t\tthis.remoteMonitoring = data.monitor;\n\t\t\tthis.active = true;\n\t\t\tthis.transport.joinCall(data);\n\t\t});\n\t}\n\n\tonRemoteJoin(data, ...args) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteJoin', [data, ...args]);\n\t\tlet peerConnection = this.getPeerConnection(data.from);\n\n\t\t// needsRefresh = false\n\t\t// if peerConnection.iceConnectionState isnt 'new'\n\t\t// needsAudio = data.media.audio is true and peerConnection.remoteMedia.audio isnt true\n\t\t// needsVideo = data.media.video is true and peerConnection.remoteMedia.video isnt true\n\t\t// needsRefresh = needsAudio or needsVideo or data.media.desktop isnt peerConnection.remoteMedia.desktop\n\n\t\t// # if peerConnection.signalingState is \"have-local-offer\" or needsRefresh\n\n\t\tif (peerConnection.signalingState !== 'checking') {\n\t\t\tthis.stopPeerConnection(data.from);\n\t\t\tpeerConnection = this.getPeerConnection(data.from);\n\t\t}\n\t\tif (peerConnection.iceConnectionState !== 'new') {\n\t\t\treturn;\n\t\t}\n\t\tpeerConnection.remoteMedia = data.media;\n\t\tif (this.localStream) {\n\t\t\tpeerConnection.addStream(this.localStream);\n\t\t}\n\t\tconst onOffer = (offer) => {\n\t\t\tconst onLocalDescription = () => {\n\t\t\t\tthis.transport.sendDescription({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\ttype: 'offer',\n\t\t\t\t\tts: peerConnection.createdAt,\n\t\t\t\t\tmedia: this.media,\n\t\t\t\t\tdescription: {\n\t\t\t\t\t\tsdp: offer.sdp,\n\t\t\t\t\t\ttype: offer.type,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tpeerConnection.setLocalDescription(new RTCSessionDescription(offer), onLocalDescription, this.onError);\n\t\t};\n\n\t\tif (data.monitor === true) {\n\t\t\tpeerConnection.createOffer(onOffer, this.onError, {\n\t\t\t\tmandatory: {\n\t\t\t\t\tOfferToReceiveAudio: data.media.audio,\n\t\t\t\t\tOfferToReceiveVideo: data.media.video,\n\t\t\t\t},\n\t\t\t});\n\t\t} else {\n\t\t\tpeerConnection.createOffer(onOffer, this.onError);\n\t\t}\n\t}\n\n\tonRemoteOffer(data, ...args) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('onRemoteOffer', [data, ...args]);\n\t\tlet peerConnection = this.getPeerConnection(data.from);\n\n\t\tif (['have-local-offer', 'stable'].includes(peerConnection.signalingState) && peerConnection.createdAt < data.ts) {\n\t\t\tthis.stopPeerConnection(data.from);\n\t\t\tpeerConnection = this.getPeerConnection(data.from);\n\t\t}\n\n\t\tif (peerConnection.iceConnectionState !== 'new') {\n\t\t\treturn;\n\t\t}\n\n\t\tpeerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\n\n\t\ttry {\n\t\t\tif (this.localStream) {\n\t\t\t\tpeerConnection.addStream(this.localStream);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t}\n\n\t\tconst onAnswer = (answer) => {\n\t\t\tconst onLocalDescription = () => {\n\t\t\t\tthis.transport.sendDescription({\n\t\t\t\t\tto: data.from,\n\t\t\t\t\ttype: 'answer',\n\t\t\t\t\tts: peerConnection.createdAt,\n\t\t\t\t\tdescription: {\n\t\t\t\t\t\tsdp: answer.sdp,\n\t\t\t\t\t\ttype: answer.type,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tpeerConnection.setLocalDescription(new RTCSessionDescription(answer), onLocalDescription, this.onError);\n\t\t};\n\n\t\tpeerConnection.createAnswer(onAnswer, this.onError);\n\t}\n\n\t/*\n  \t\t@param data {Object}\n  \t\t\tto {String}\n  \t\t\tfrom {String}\n  \t\t\tcandidate {RTCIceCandidate JSON encoded}\n   */\n\n\tonRemoteCandidate(data, ...args) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tif (data.to !== this.selfId) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteCandidate', [data, ...args]);\n\t\tconst peerConnection = this.getPeerConnection(data.from);\n\t\tif (\n\t\t\tpeerConnection.iceConnectionState !== 'closed' &&\n\t\t\tpeerConnection.iceConnectionState !== 'failed' &&\n\t\t\tpeerConnection.iceConnectionState !== 'disconnected' &&\n\t\t\tpeerConnection.iceConnectionState !== 'completed'\n\t\t) {\n\t\t\tpeerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));\n\t\t}\n\t\tdocument.querySelector('video#remoteVideo').srcObject = this.remoteItems.get()[0]?.url;\n\t}\n\n\t/*\n  \t\t@param data {Object}\n  \t\t\tto {String}\n  \t\t\tfrom {String}\n  \t\t\ttype {String} [offer, answer]\n  \t\t\tdescription {RTCSessionDescription JSON encoded}\n  \t\t\tts {Integer}\n  \t\t\tmedia {Object}\n  \t\t\t\taudio {Boolean}\n  \t\t\t\tvideo {Boolean}\n  \t\t\t\tdesktop {Boolean}\n   */\n\n\tonRemoteDescription(data, ...args) {\n\t\tif (this.active !== true) {\n\t\t\treturn;\n\t\t}\n\t\tif (data.to !== this.selfId) {\n\t\t\treturn;\n\t\t}\n\t\tthis.log('onRemoteDescription', [data, ...args]);\n\t\tconst peerConnection = this.getPeerConnection(data.from);\n\t\tif (data.type === 'offer') {\n\t\t\tpeerConnection.remoteMedia = data.media;\n\t\t\tthis.onRemoteOffer({\n\t\t\t\tfrom: data.from,\n\t\t\t\tts: data.ts,\n\t\t\t\tdescription: data.description,\n\t\t\t});\n\t\t} else {\n\t\t\tpeerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\n\t\t}\n\t}\n}\n\nconst WebRTC = new (class {\n\tconstructor() {\n\t\tthis.instancesByRoomId = {};\n\t}\n\n\tgetInstanceByRoomId(rid, visitorId = null) {\n\t\tlet enabled = false;\n\t\tif (!visitorId) {\n\t\t\tconst subscription = ChatSubscription.findOne({ rid });\n\t\t\tif (!subscription) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tswitch (subscription.t) {\n\t\t\t\tcase 'd':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Direct');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'p':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Private');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'c':\n\t\t\t\t\tenabled = settings.get('WebRTC_Enable_Channel');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'l':\n\t\t\t\t\tenabled = settings.get('Omnichannel_call_provider') === 'WebRTC';\n\t\t\t}\n\t\t} else {\n\t\t\tenabled = settings.get('Omnichannel_call_provider') === 'WebRTC';\n\t\t}\n\t\tenabled = enabled && settings.get('WebRTC_Enabled');\n\t\tif (enabled === false) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.instancesByRoomId[rid] == null) {\n\t\t\tlet uid = Meteor.userId();\n\t\t\tlet autoAccept = false;\n\t\t\tif (visitorId) {\n\t\t\t\tuid = visitorId;\n\t\t\t\tautoAccept = true;\n\t\t\t}\n\t\t\tthis.instancesByRoomId[rid] = new WebRTCClass(uid, rid, autoAccept);\n\t\t}\n\t\treturn this.instancesByRoomId[rid];\n\t}\n})();\n\nMeteor.startup(() => {\n\tTracker.autorun(() => {\n\t\tif (Meteor.userId()) {\n\t\t\tsdk.stream('notify-user', [`${Meteor.userId()}/${WEB_RTC_EVENTS.WEB_RTC}`], (type, data) => {\n\t\t\t\tif (data.room == null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst webrtc = WebRTC.getInstanceByRoomId(data.room);\n\t\t\t\twebrtc.onUserStream(type, data);\n\t\t\t});\n\t\t}\n\t});\n});\n\nexport { WebRTC };\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"d433061afa215a90b5639eaad1c44f89edcc4597"}
