{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/rocketchat:streamer/server/server.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"packages/rocketchat:streamer/server/server.js","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/rocketchat:streamer/server/server.js","targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/rocketchat:streamer/server/server.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/rocketchat:streamer/server/server.js"}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let DDPCommon;\n    module.link(\"meteor/ddp-common\", {\n      DDPCommon(v) {\n        DDPCommon = v;\n      }\n    }, 0);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    class StreamerCentral extends EV {\n      constructor() {\n        super();\n        this.instances = {};\n      }\n    }\n    Meteor.StreamerCentral = new StreamerCentral();\n    const changedPayload = function (collection, id, fields) {\n      if (_.isEmpty(fields)) {\n        return;\n      }\n      return DDPCommon.stringifyDDP({\n        msg: 'changed',\n        collection,\n        id,\n        fields\n      });\n    };\n    const send = function (self, msg) {\n      if (!self.socket) {\n        return;\n      }\n      self.socket.send(msg);\n    };\n    Meteor.Streamer = class Streamer extends EV {\n      constructor(name) {\n        let {\n          retransmit = true,\n          retransmitToSelf = false\n        } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n        if (Meteor.StreamerCentral.instances[name]) {\n          console.warn('Streamer instance already exists:', name);\n          return Meteor.StreamerCentral.instances[name];\n        }\n        super();\n        Meteor.StreamerCentral.instances[name] = this;\n        this.name = name;\n        this.retransmit = retransmit;\n        this.retransmitToSelf = retransmitToSelf;\n        this.subscriptions = [];\n        this.subscriptionsByEventName = {};\n        this.transformers = {};\n        this.iniPublication();\n        this.initMethod();\n        this._allowRead = {};\n        this._allowEmit = {};\n        this._allowWrite = {};\n        this.allowRead('none');\n        this.allowEmit('all');\n        this.allowWrite('none');\n      }\n      get name() {\n        return this._name;\n      }\n      set name(name) {\n        check(name, String);\n        this._name = name;\n      }\n      get subscriptionName() {\n        return \"stream-\".concat(this.name);\n      }\n      get retransmit() {\n        return this._retransmit;\n      }\n      set retransmit(retransmit) {\n        check(retransmit, Boolean);\n        this._retransmit = retransmit;\n      }\n      get retransmitToSelf() {\n        return this._retransmitToSelf;\n      }\n      set retransmitToSelf(retransmitToSelf) {\n        check(retransmitToSelf, Boolean);\n        this._retransmitToSelf = retransmitToSelf;\n      }\n      allowRead(eventName, fn) {\n        if (fn === undefined) {\n          fn = eventName;\n          eventName = '__all__';\n        }\n        if (typeof fn === 'function') {\n          return this._allowRead[eventName] = fn;\n        }\n        if (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n          console.error(\"allowRead shortcut '\".concat(fn, \"' is invalid\"));\n        }\n        if (fn === 'all' || fn === true) {\n          return this._allowRead[eventName] = function () {\n            return true;\n          };\n        }\n        if (fn === 'none' || fn === false) {\n          return this._allowRead[eventName] = function () {\n            return false;\n          };\n        }\n        if (fn === 'logged') {\n          return this._allowRead[eventName] = function () {\n            return Boolean(this.userId);\n          };\n        }\n      }\n      allowEmit(eventName, fn) {\n        if (fn === undefined) {\n          fn = eventName;\n          eventName = '__all__';\n        }\n        if (typeof fn === 'function') {\n          return this._allowEmit[eventName] = fn;\n        }\n        if (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n          console.error(\"allowRead shortcut '\".concat(fn, \"' is invalid\"));\n        }\n        if (fn === 'all' || fn === true) {\n          return this._allowEmit[eventName] = function () {\n            return true;\n          };\n        }\n        if (fn === 'none' || fn === false) {\n          return this._allowEmit[eventName] = function () {\n            return false;\n          };\n        }\n        if (fn === 'logged') {\n          return this._allowEmit[eventName] = function () {\n            return Boolean(this.userId);\n          };\n        }\n      }\n      allowWrite(eventName, fn) {\n        if (fn === undefined) {\n          fn = eventName;\n          eventName = '__all__';\n        }\n        if (typeof fn === 'function') {\n          return this._allowWrite[eventName] = fn;\n        }\n        if (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n          console.error(\"allowWrite shortcut '\".concat(fn, \"' is invalid\"));\n        }\n        if (fn === 'all' || fn === true) {\n          return this._allowWrite[eventName] = function () {\n            return true;\n          };\n        }\n        if (fn === 'none' || fn === false) {\n          return this._allowWrite[eventName] = function () {\n            return false;\n          };\n        }\n        if (fn === 'logged') {\n          return this._allowWrite[eventName] = function () {\n            return Boolean(this.userId);\n          };\n        }\n      }\n      isReadAllowed(scope, eventName, args) {\n        if (this._allowRead[eventName]) {\n          return this._allowRead[eventName].call(scope, eventName, ...args);\n        }\n        return this._allowRead['__all__'].call(scope, eventName, ...args);\n      }\n      isEmitAllowed(scope, eventName) {\n        for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n          args[_key - 2] = arguments[_key];\n        }\n        if (this._allowEmit[eventName]) {\n          return this._allowEmit[eventName].call(scope, eventName, ...args);\n        }\n        return this._allowEmit['__all__'].call(scope, eventName, ...args);\n      }\n      isWriteAllowed(scope, eventName, args) {\n        if (this._allowWrite[eventName]) {\n          return this._allowWrite[eventName].call(scope, eventName, ...args);\n        }\n        return this._allowWrite['__all__'].call(scope, eventName, ...args);\n      }\n      addSubscription(subscription, eventName) {\n        this.subscriptions.push(subscription);\n        if (!this.subscriptionsByEventName[eventName]) {\n          this.subscriptionsByEventName[eventName] = [];\n        }\n        this.subscriptionsByEventName[eventName].push(subscription);\n      }\n      removeSubscription(subscription, eventName) {\n        const index = this.subscriptions.indexOf(subscription);\n        if (index > -1) {\n          this.subscriptions.splice(index, 1);\n        }\n        if (this.subscriptionsByEventName[eventName]) {\n          const index = this.subscriptionsByEventName[eventName].indexOf(subscription);\n          if (index > -1) {\n            this.subscriptionsByEventName[eventName].splice(index, 1);\n          }\n        }\n      }\n      transform(eventName, fn) {\n        if (typeof eventName === 'function') {\n          fn = eventName;\n          eventName = '__all__';\n        }\n        if (!this.transformers[eventName]) {\n          this.transformers[eventName] = [];\n        }\n        this.transformers[eventName].push(fn);\n      }\n      applyTransformers(methodScope, eventName, args) {\n        if (this.transformers['__all__']) {\n          this.transformers['__all__'].forEach(transform => {\n            args = transform.call(methodScope, eventName, args);\n            methodScope.tranformed = true;\n            if (!Array.isArray(args)) {\n              args = [args];\n            }\n          });\n        }\n        if (this.transformers[eventName]) {\n          this.transformers[eventName].forEach(transform => {\n            args = transform.call(methodScope, ...args);\n            methodScope.tranformed = true;\n            if (!Array.isArray(args)) {\n              args = [args];\n            }\n          });\n        }\n        return args;\n      }\n      _publish(publication, eventName, options) {\n        check(eventName, String);\n        check(options, Match.OneOf(Boolean, {\n          useCollection: Boolean,\n          args: Array\n        }));\n        let useCollection,\n          args = [];\n        if (typeof options === 'boolean') {\n          useCollection = options;\n        } else {\n          if (options.useCollection) {\n            useCollection = options.useCollection;\n          }\n          if (options.args) {\n            args = options.args;\n          }\n        }\n        if (eventName.length === 0) {\n          publication.stop();\n          throw new Meteor.Error('invalid-event-name');\n        }\n        if (this.isReadAllowed(publication, eventName, args) !== true) {\n          publication.stop();\n          throw new Meteor.Error('not-allowed');\n        }\n        const subscription = {\n          subscription: publication,\n          eventName: eventName\n        };\n        this.addSubscription(subscription, eventName);\n        publication.onStop(() => {\n          this.removeSubscription(subscription, eventName);\n        });\n        if (useCollection === true) {\n          // Collection compatibility\n          publication._session.sendAdded(this.subscriptionName, 'id', {\n            eventName: eventName\n          });\n        }\n        publication.ready();\n      }\n      iniPublication() {\n        const stream = this;\n        Meteor.publish(this.subscriptionName, function () {\n          for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n            args[_key2] = arguments[_key2];\n          }\n          return stream._publish.apply(stream, [this, ...args]);\n        });\n      }\n      initMethod() {\n        const stream = this;\n        const method = {};\n        method[this.subscriptionName] = function (eventName) {\n          for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n            args[_key3 - 1] = arguments[_key3];\n          }\n          check(eventName, String);\n          check(args, Array);\n          this.unblock();\n          if (stream.isWriteAllowed(this, eventName, args) !== true) {\n            return;\n          }\n          const methodScope = {\n            userId: this.userId,\n            connection: this.connection,\n            originalParams: args,\n            tranformed: false\n          };\n          args = stream.applyTransformers(methodScope, eventName, args);\n          stream.emitWithScope(eventName, methodScope, ...args);\n          if (stream.retransmit === true) {\n            stream._emit(eventName, args, this.connection, true);\n          }\n        };\n        try {\n          Meteor.methods(method);\n        } catch (e) {\n          console.error(e);\n        }\n      }\n      _emit(eventName, args, origin, broadcast) {\n        if (broadcast === true) {\n          Meteor.StreamerCentral.emit('broadcast', this.name, eventName, args);\n        }\n        const subscriptions = this.subscriptionsByEventName[eventName];\n        if (!Array.isArray(subscriptions)) {\n          return;\n        }\n        const msg = changedPayload(this.subscriptionName, 'id', {\n          eventName,\n          args\n        });\n        if (!msg) {\n          return;\n        }\n        subscriptions.forEach(subscription => {\n          if (this.retransmitToSelf === false && origin && origin === subscription.subscription.connection) {\n            return;\n          }\n          if (this.isEmitAllowed(subscription.subscription, eventName, ...args)) {\n            send(subscription.subscription._session, msg);\n          }\n        });\n      }\n      emit(eventName) {\n        for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n          args[_key4 - 1] = arguments[_key4];\n        }\n        this._emit(eventName, args, undefined, true);\n      }\n      __emit() {\n        return super.emit(...arguments);\n      }\n      emitWithoutBroadcast(eventName) {\n        for (var _len5 = arguments.length, args = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n          args[_key5 - 1] = arguments[_key5];\n        }\n        this._emit(eventName, args, undefined, false);\n      }\n    };\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["DDPCommon","module","link","v","__reifyWaitForDeps__","StreamerCentral","EV","constructor","instances","Meteor","changedPayload","collection","id","fields","_","isEmpty","stringifyDDP","msg","send","self","socket","Streamer","name","retransmit","retransmitToSelf","arguments","length","undefined","console","warn","subscriptions","subscriptionsByEventName","transformers","iniPublication","initMethod","_allowRead","_allowEmit","_allowWrite","allowRead","allowEmit","allowWrite","_name","check","String","subscriptionName","concat","_retransmit","Boolean","_retransmitToSelf","eventName","fn","indexOf","error","userId","isReadAllowed","scope","args","call","isEmitAllowed","_len","Array","_key","isWriteAllowed","addSubscription","subscription","push","removeSubscription","index","splice","transform","applyTransformers","methodScope","forEach","tranformed","isArray","_publish","publication","options","Match","OneOf","useCollection","stop","Error","onStop","_session","sendAdded","ready","stream","publish","_len2","_key2","apply","method","_len3","_key3","unblock","connection","originalParams","emitWithScope","_emit","methods","e","origin","broadcast","emit","_len4","_key4","__emit","emitWithoutBroadcast","_len5","_key5","__reify_async_result__","_reifyError","async"],"sources":["packages/rocketchat:streamer/server/server.js"],"sourcesContent":["/* globals EV */\n/* eslint new-cap: false */\nimport { DDPCommon } from 'meteor/ddp-common';\n\nclass StreamerCentral extends EV {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.instances = {};\n\t}\n}\n\nMeteor.StreamerCentral = new StreamerCentral;\n\nconst changedPayload = function (collection, id, fields) {\n\tif (_.isEmpty(fields)) {\n\t\treturn;\n\t}\n\treturn DDPCommon.stringifyDDP({\n\t\tmsg: 'changed',\n\t\tcollection,\n\t\tid,\n\t\tfields\n\t});\n};\n\nconst send = function (self, msg) {\n\tif (!self.socket) {\n\t\treturn;\n\t}\n\tself.socket.send(msg);\n};\n\n\nMeteor.Streamer = class Streamer extends EV {\n\tconstructor(name, {retransmit = true, retransmitToSelf = false} = {}) {\n\t\tif (Meteor.StreamerCentral.instances[name]) {\n\t\t\tconsole.warn('Streamer instance already exists:', name);\n\t\t\treturn Meteor.StreamerCentral.instances[name];\n\t\t}\n\n\t\tsuper();\n\n\t\tMeteor.StreamerCentral.instances[name] = this;\n\n\t\tthis.name = name;\n\t\tthis.retransmit = retransmit;\n\t\tthis.retransmitToSelf = retransmitToSelf;\n\n\t\tthis.subscriptions = [];\n\t\tthis.subscriptionsByEventName = {};\n\t\tthis.transformers = {};\n\n\t\tthis.iniPublication();\n\t\tthis.initMethod();\n\n\t\tthis._allowRead = {};\n\t\tthis._allowEmit = {};\n\t\tthis._allowWrite = {};\n\n\t\tthis.allowRead('none');\n\t\tthis.allowEmit('all');\n\t\tthis.allowWrite('none');\n\t}\n\n\tget name() {\n\t\treturn this._name;\n\t}\n\n\tset name(name) {\n\t\tcheck(name, String);\n\t\tthis._name = name;\n\t}\n\n\tget subscriptionName() {\n\t\treturn `stream-${this.name}`;\n\t}\n\n\tget retransmit() {\n\t\treturn this._retransmit;\n\t}\n\n\tset retransmit(retransmit) {\n\t\tcheck(retransmit, Boolean);\n\t\tthis._retransmit = retransmit;\n\t}\n\n\tget retransmitToSelf() {\n\t\treturn this._retransmitToSelf;\n\t}\n\n\tset retransmitToSelf(retransmitToSelf) {\n\t\tcheck(retransmitToSelf, Boolean);\n\t\tthis._retransmitToSelf = retransmitToSelf;\n\t}\n\n\tallowRead(eventName, fn) {\n\t\tif (fn === undefined) {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (typeof fn === 'function') {\n\t\t\treturn this._allowRead[eventName] = fn;\n\t\t}\n\n\t\tif (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n\t\t\tconsole.error(`allowRead shortcut '${fn}' is invalid`);\n\t\t}\n\n\t\tif (fn === 'all' || fn === true) {\n\t\t\treturn this._allowRead[eventName] = function() {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'none' || fn === false) {\n\t\t\treturn this._allowRead[eventName] = function() {\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'logged') {\n\t\t\treturn this._allowRead[eventName] = function() {\n\t\t\t\treturn Boolean(this.userId);\n\t\t\t};\n\t\t}\n\t}\n\n\tallowEmit(eventName, fn) {\n\t\tif (fn === undefined) {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (typeof fn === 'function') {\n\t\t\treturn this._allowEmit[eventName] = fn;\n\t\t}\n\n\t\tif (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n\t\t\tconsole.error(`allowRead shortcut '${fn}' is invalid`);\n\t\t}\n\n\t\tif (fn === 'all' || fn === true) {\n\t\t\treturn this._allowEmit[eventName] = function() {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'none' || fn === false) {\n\t\t\treturn this._allowEmit[eventName] = function() {\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'logged') {\n\t\t\treturn this._allowEmit[eventName] = function() {\n\t\t\t\treturn Boolean(this.userId);\n\t\t\t};\n\t\t}\n\t}\n\n\tallowWrite(eventName, fn) {\n\t\tif (fn === undefined) {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (typeof fn === 'function') {\n\t\t\treturn this._allowWrite[eventName] = fn;\n\t\t}\n\n\t\tif (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n\t\t\tconsole.error(`allowWrite shortcut '${fn}' is invalid`);\n\t\t}\n\n\t\tif (fn === 'all' || fn === true) {\n\t\t\treturn this._allowWrite[eventName] = function() {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'none' || fn === false) {\n\t\t\treturn this._allowWrite[eventName] = function() {\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'logged') {\n\t\t\treturn this._allowWrite[eventName] = function() {\n\t\t\t\treturn Boolean(this.userId);\n\t\t\t};\n\t\t}\n\t}\n\n\tisReadAllowed(scope, eventName, args) {\n\t\tif (this._allowRead[eventName]) {\n\t\t\treturn this._allowRead[eventName].call(scope, eventName, ...args);\n\t\t}\n\n\t\treturn this._allowRead['__all__'].call(scope, eventName, ...args);\n\t}\n\n\tisEmitAllowed(scope, eventName, ...args) {\n\t\tif (this._allowEmit[eventName]) {\n\t\t\treturn this._allowEmit[eventName].call(scope, eventName, ...args);\n\t\t}\n\n\t\treturn this._allowEmit['__all__'].call(scope, eventName, ...args);\n\t}\n\n\tisWriteAllowed(scope, eventName, args) {\n\t\tif (this._allowWrite[eventName]) {\n\t\t\treturn this._allowWrite[eventName].call(scope, eventName, ...args);\n\t\t}\n\n\t\treturn this._allowWrite['__all__'].call(scope, eventName, ...args);\n\t}\n\n\taddSubscription(subscription, eventName) {\n\t\tthis.subscriptions.push(subscription);\n\n\t\tif (!this.subscriptionsByEventName[eventName]) {\n\t\t\tthis.subscriptionsByEventName[eventName] = [];\n\t\t}\n\n\t\tthis.subscriptionsByEventName[eventName].push(subscription);\n\t}\n\n\tremoveSubscription(subscription, eventName) {\n\t\tconst index = this.subscriptions.indexOf(subscription);\n\t\tif (index > -1) {\n\t\t\tthis.subscriptions.splice(index, 1);\n\t\t}\n\n\t\tif (this.subscriptionsByEventName[eventName]) {\n\t\t\tconst index = this.subscriptionsByEventName[eventName].indexOf(subscription);\n\t\t\tif (index > -1) {\n\t\t\t\tthis.subscriptionsByEventName[eventName].splice(index, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\ttransform(eventName, fn) {\n\t\tif (typeof eventName === 'function') {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (!this.transformers[eventName]) {\n\t\t\tthis.transformers[eventName] = [];\n\t\t}\n\n\t\tthis.transformers[eventName].push(fn);\n\t}\n\n\tapplyTransformers(methodScope, eventName, args) {\n\t\tif (this.transformers['__all__']) {\n\t\t\tthis.transformers['__all__'].forEach((transform) => {\n\t\t\t\targs = transform.call(methodScope, eventName, args);\n\t\t\t\tmethodScope.tranformed = true;\n\t\t\t\tif (!Array.isArray(args)) {\n\t\t\t\t\targs = [args];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.transformers[eventName]) {\n\t\t\tthis.transformers[eventName].forEach((transform) => {\n\t\t\t\targs = transform.call(methodScope, ...args);\n\t\t\t\tmethodScope.tranformed = true;\n\t\t\t\tif (!Array.isArray(args)) {\n\t\t\t\t\targs = [args];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn args;\n\t}\n\n\n\t_publish(publication, eventName, options) {\n\t\tcheck(eventName, String);\n\t\tcheck(options, Match.OneOf(Boolean, {\n\t\t\tuseCollection: Boolean,\n\t\t\targs: Array,\n\t\t}));\n\n\t\tlet useCollection, args = [];\n\n\t\tif (typeof options === 'boolean') {\n\t\t\tuseCollection = options;\n\t\t} else {\n\t\t\tif (options.useCollection) {\n\t\t\t\tuseCollection = options.useCollection;\n\t\t\t}\n\n\t\t\tif (options.args) {\n\t\t\t\targs = options.args;\n\t\t\t}\n\t\t}\n\n\t\tif (eventName.length === 0) {\n\t\t\tpublication.stop();\n\t\t\tthrow new Meteor.Error('invalid-event-name');\n\t\t}\n\n\t\tif (this.isReadAllowed(publication, eventName, args) !== true) {\n\t\t\tpublication.stop();\n\t\t\tthrow new Meteor.Error('not-allowed');\n\t\t}\n\n\t\tconst subscription = {\n\t\t\tsubscription: publication,\n\t\t\teventName: eventName\n\t\t};\n\n\t\tthis.addSubscription(subscription, eventName);\n\n\t\tpublication.onStop(() => {\n\t\t\tthis.removeSubscription(subscription, eventName);\n\t\t});\n\n\t\tif (useCollection === true) {\n\t\t\t// Collection compatibility\n\t\t\tpublication._session.sendAdded(this.subscriptionName, 'id', {\n\t\t\t\teventName: eventName\n\t\t\t});\n\t\t}\n\n\t\tpublication.ready();\n\t}\n\n\tiniPublication() {\n\t\tconst stream = this;\n\t\tMeteor.publish(this.subscriptionName, function (...args) { return stream._publish.apply(stream, [this, ...args]); });\n\t}\n\n\tinitMethod() {\n\t\tconst stream = this;\n\t\tconst method = {};\n\n\t\tmethod[this.subscriptionName] = function(eventName, ...args) {\n\t\t\tcheck(eventName, String);\n\t\t\tcheck(args, Array);\n\n\t\t\tthis.unblock();\n\n\t\t\tif (stream.isWriteAllowed(this, eventName, args) !== true) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst methodScope = {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tconnection: this.connection,\n\t\t\t\toriginalParams: args,\n\t\t\t\ttranformed: false\n\t\t\t};\n\n\t\t\targs = stream.applyTransformers(methodScope, eventName, args);\n\n\t\t\tstream.emitWithScope(eventName, methodScope, ...args);\n\n\t\t\tif (stream.retransmit === true) {\n\t\t\t\tstream._emit(eventName, args, this.connection, true);\n\t\t\t}\n\t\t};\n\n\t\ttry {\n\t\t\tMeteor.methods(method);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t}\n\n\t_emit(eventName, args, origin, broadcast) {\n\t\tif (broadcast === true) {\n\t\t\tMeteor.StreamerCentral.emit('broadcast', this.name, eventName, args);\n\t\t}\n\n\t\tconst subscriptions = this.subscriptionsByEventName[eventName];\n\t\tif (!Array.isArray(subscriptions)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst msg = changedPayload(this.subscriptionName, 'id', {\n\t\t\teventName,\n\t\t\targs\n\t\t});\n\n\t\tif(!msg) {\n\t\t\treturn;\n\t\t}\n\n\t\tsubscriptions.forEach((subscription) => {\n\t\t\tif (this.retransmitToSelf === false && origin && origin === subscription.subscription.connection) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isEmitAllowed(subscription.subscription, eventName, ...args)) {\n\t\t\t\tsend(subscription.subscription._session, msg);\n\t\t\t}\n\t\t});\n\t}\n\n\temit(eventName, ...args) {\n\t\tthis._emit(eventName, args, undefined, true);\n\t}\n\n\t__emit(...args) {\n\t\treturn super.emit(...args);\n\t}\n\n\temitWithoutBroadcast(eventName, ...args) {\n\t\tthis._emit(eventName, args, undefined, false);\n\t}\n};\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"edb1fd3e24813c22a611e991072c05e21311ecc3"}
