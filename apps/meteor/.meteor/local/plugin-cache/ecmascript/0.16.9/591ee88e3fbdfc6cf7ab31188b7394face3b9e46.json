{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/rocketchat:restivus/lib/route.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"packages/rocketchat:restivus/lib/route.js","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/rocketchat:restivus/lib/route.js","targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/rocketchat:restivus/lib/route.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/rocketchat:restivus/lib/route.js"}},"code":"!module.wrapAsync(async function (module, __reifyWaitForDeps__, __reify_async_result__) {\n  \"use strict\";\n  try {\n    let _objectSpread;\n    module.link(\"@babel/runtime/helpers/objectSpread2\", {\n      default(v) {\n        _objectSpread = v;\n      }\n    }, 0);\n    module.export({\n      Route: () => Route\n    });\n    let Users;\n    module.link(\"@rocket.chat/models\", {\n      Users(v) {\n        Users = v;\n      }\n    }, 0);\n    let ironRouterSendErrorToResponse;\n    module.link(\"./iron-router-error-to-response\", {\n      ironRouterSendErrorToResponse(v) {\n        ironRouterSendErrorToResponse = v;\n      }\n    }, 1);\n    let JsonRoutes;\n    module.link(\"./json-routes\", {\n      JsonRoutes(v) {\n        JsonRoutes = v;\n      }\n    }, 2);\n    if (__reifyWaitForDeps__()) (await __reifyWaitForDeps__())();\n    const availableMethods = ['get', 'post', 'put', 'patch', 'delete', 'options'];\n    class Route {\n      constructor(api, path, options, endpoints1) {\n        this.api = api;\n        this.path = path;\n        this.options = options;\n        this.endpoints = endpoints1;\n        if (!this.endpoints) {\n          this.endpoints = this.options;\n          this.options = {};\n        }\n      }\n      addToApi() {\n        const self = this;\n        if (this.api._config.paths.includes(this.path)) {\n          throw new Error(\"Cannot add a route at an existing path: \".concat(this.path));\n        }\n        this.endpoints = _objectSpread({\n          options: this.api._config.defaultOptionsEndpoint\n        }, this.endpoints);\n        this._resolveEndpoints();\n        this._configureEndpoints();\n        this.api._config.paths.push(this.path);\n        const allowedMethods = availableMethods.filter(function (method) {\n          return Object.keys(self.endpoints).includes(method);\n        });\n        const rejectedMethods = availableMethods.filter(function (method) {\n          return !Object.keys(self.endpoints).includes(method);\n        });\n        const fullPath = this.api._config.apiPath + this.path;\n        allowedMethods.forEach(function (method) {\n          const endpoint = self.endpoints[method];\n          return JsonRoutes.add(method, fullPath, async function (req, res) {\n            let responseInitiated = false;\n            const doneFunc = function () {\n              responseInitiated = true;\n            };\n            const endpointContext = _objectSpread({\n              urlParams: req.params,\n              queryParams: req.query,\n              bodyParams: req.body,\n              request: req,\n              response: res,\n              done: doneFunc\n            }, endpoint);\n            let responseData = null;\n            try {\n              responseData = await self._callEndpoint(endpointContext, endpoint);\n            } catch (e) {\n              ironRouterSendErrorToResponse(e, req, res);\n              return;\n            }\n            if (responseInitiated) {\n              res.end();\n              return;\n            }\n            if (res.headersSent) {\n              throw new Error(\"Must call this.done() after handling endpoint response manually: \".concat(method, \" \").concat(fullPath));\n            } else if (responseData === null || responseData === void 0) {\n              throw new Error(\"Cannot return null or undefined from an endpoint: \".concat(method, \" \").concat(fullPath));\n            }\n            if (responseData.body && (responseData.statusCode || responseData.headers)) {\n              return self._respond(res, responseData.body, responseData.statusCode, responseData.headers);\n            }\n            return self._respond(res, responseData);\n          });\n        });\n        return rejectedMethods.forEach(function (method) {\n          return JsonRoutes.add(method, fullPath, function (req, res) {\n            const responseData = {\n              status: 'error',\n              message: 'API endpoint does not exist'\n            };\n            const headers = {\n              Allow: allowedMethods.join(', ').toUpperCase()\n            };\n            return self._respond(res, responseData, 405, headers);\n          });\n        });\n      }\n\n      /*\n      \tConvert all endpoints on the given route into our expected endpoint object if it is a bare\n      \tfunction\n      \t\t@param {Route} route The route the endpoints belong to\n      \t*/\n\n      _resolveEndpoints() {\n        Object.entries(this.endpoints).forEach(_ref => {\n          let [method, endpoint] = _ref;\n          if (typeof endpoint === 'function') {\n            this.endpoints[method] = {\n              action: endpoint\n            };\n          }\n        });\n      }\n\n      /*\n      \tConfigure the authentication and role requirement on all endpoints (except OPTIONS, which must\n      \tbe configured directly on the endpoint)\n      \t\tAuthentication can be required on an entire route or individual endpoints. If required on an\n      \tentire route, that serves as the default. If required in any individual endpoints, that will\n      \toverride the default.\n      \t\tAfter the endpoint is configured, all authentication and role requirements of an endpoint can be\n      \taccessed at <code>endpoint.authRequired</code> and <code>endpoint.roleRequired</code>,\n      \trespectively.\n      \t\t@param {Route} route The route the endpoints belong to\n      \t@param {Endpoint} endpoint The endpoint to configure\n      \t*/\n\n      _configureEndpoints() {\n        Object.entries(this.endpoints).forEach(_ref2 => {\n          let [method, endpoint] = _ref2;\n          if (method !== 'options') {\n            var _this$options;\n            if (!((_this$options = this.options) !== null && _this$options !== void 0 && _this$options.roleRequired)) {\n              this.options.roleRequired = [];\n            }\n            if (!endpoint.roleRequired) {\n              endpoint.roleRequired = [];\n            }\n            endpoint.roleRequired = [...endpoint.roleRequired, ...this.options.roleRequired];\n            if (endpoint.roleRequired.length === 0) {\n              endpoint.roleRequired = false;\n            }\n            if (endpoint.authRequired === void 0) {\n              var _this$options2;\n              if ((_this$options2 = this.options) !== null && _this$options2 !== void 0 && _this$options2.authRequired || endpoint.roleRequired) {\n                endpoint.authRequired = true;\n              } else {\n                endpoint.authRequired = false;\n              }\n            }\n          }\n        });\n      }\n\n      /*\n      \tAuthenticate an endpoint if required, and return the result of calling it\n      \t\t@returns The endpoint response or a 401 if authentication fails\n      \t*/\n\n      async _callEndpoint(endpointContext, endpoint) {\n        const auth = await this._authAccepted(endpointContext, endpoint);\n        if (auth.success) {\n          if (this._roleAccepted(endpointContext, endpoint)) {\n            return endpoint.action.call(endpointContext);\n          }\n          return {\n            statusCode: 403,\n            body: {\n              status: 'error',\n              message: 'You do not have permission to do this.'\n            }\n          };\n        }\n        if (auth.data) {\n          return auth.data;\n        }\n        return {\n          statusCode: 401,\n          body: {\n            status: 'error',\n            message: 'You must be logged in to do this.'\n          }\n        };\n      }\n\n      /*\n      \tAuthenticate the given endpoint if required\n      \t\tOnce it's globally configured in the API, authentication can be required on an entire route or\n      \tindividual endpoints. If required on an entire endpoint, that serves as the default. If required\n      \tin any individual endpoints, that will override the default.\n      \t\t@returns An object of the following format:\n      \t\t\t\t{\n      \t\t\t\tsuccess: Boolean\n      \t\t\t\tdata: String or Object\n      \t\t\t}\n      \t\t\twhere `success` is `true` if all required authentication checks pass and the optional `data`\n      \t\twill contain the auth data when successful and an optional error response when auth fails.\n      \t*/\n\n      async _authAccepted(endpointContext, endpoint) {\n        if (endpoint.authRequired) {\n          return this._authenticate(endpointContext);\n        }\n        return {\n          success: true\n        };\n      }\n\n      /*\n      \tVerify the request is being made by an actively logged in user\n      \t\tIf verified, attach the authenticated user to the context.\n      \t\t@returns An object of the following format:\n      \t\t\t\t{\n      \t\t\t\tsuccess: Boolean\n      \t\t\t\tdata: String or Object\n      \t\t\t}\n      \t\t\twhere `success` is `true` if all required authentication checks pass and the optional `data`\n      \t\twill contain the auth data when successful and an optional error response when auth fails.\n      \t*/\n\n      async _authenticate(endpointContext) {\n        const auth = await this.api._config.auth.user.call(endpointContext);\n        if (!auth) {\n          return {\n            success: false\n          };\n        }\n        if (auth.userId && auth.token && !auth.user) {\n          const userSelector = {};\n          userSelector._id = auth.userId;\n          userSelector[this.api._config.auth.token] = auth.token;\n          auth.user = await Users.findOne(userSelector);\n        }\n        if (auth.error) {\n          return {\n            success: false,\n            data: auth.error\n          };\n        }\n        if (auth.user) {\n          endpointContext.user = auth.user;\n          endpointContext.userId = auth.user._id;\n          return {\n            success: true,\n            data: auth\n          };\n        }\n        return {\n          success: false\n        };\n      }\n\n      /*\n      \tAuthenticate the user role if required\n      \t\tMust be called after _authAccepted().\n      \t\t@returns True if the authenticated user belongs to <i>any</i> of the acceptable roles on the\n      \t\t\t\t\t\tendpoint\n      \t*/\n\n      _roleAccepted(endpointContext, endpoint) {\n        if (endpoint.roleRequired) {\n          const intersection = [endpoint.roleRequired, endpointContext.user.roles].reduce((a, b) => a.filter(c => b.includes(c)));\n          if (intersection.length === 0) {\n            return false;\n          }\n        }\n        return true;\n      }\n\n      /*\n      \tRespond to an HTTP request\n      \t*/\n\n      _respond(response, body, statusCode, headers) {\n        let delayInMilliseconds;\n        let minimumDelayInMilliseconds;\n        let randomMultiplierBetweenOneAndTwo;\n        if (statusCode == null) {\n          statusCode = 200;\n        }\n        if (headers == null) {\n          headers = {};\n        }\n        const defaultHeaders = this._lowerCaseKeys(this.api._config.defaultHeaders);\n        headers = this._lowerCaseKeys(headers);\n        headers = _objectSpread(_objectSpread({}, defaultHeaders), headers);\n        if (headers['content-type'].match(/json|javascript/) !== null) {\n          if (this.api._config.prettyJson) {\n            body = JSON.stringify(body, void 0, 2);\n          } else {\n            body = JSON.stringify(body);\n          }\n        }\n        const sendResponse = function () {\n          response.writeHead(statusCode, headers);\n          response.write(body);\n          return response.end();\n        };\n        if (statusCode === 401 || statusCode === 403) {\n          minimumDelayInMilliseconds = 500;\n          randomMultiplierBetweenOneAndTwo = 1 + Math.random();\n          delayInMilliseconds = minimumDelayInMilliseconds * randomMultiplierBetweenOneAndTwo;\n          return setTimeout(sendResponse, delayInMilliseconds);\n        }\n        return sendResponse();\n      }\n\n      /*\n      \tReturn the object with all of the keys converted to lowercase\n      \t*/\n\n      _lowerCaseKeys(object) {\n        return Object.keys(object).reduce((accumulator, key) => {\n          accumulator[key.toLowerCase()] = object[key];\n          return accumulator;\n        }, {});\n      }\n    }\n    __reify_async_result__();\n  } catch (_reifyError) {\n    return __reify_async_result__(_reifyError);\n  }\n  __reify_async_result__()\n}, {\n  self: this,\n  async: false\n});","map":{"version":3,"names":["_objectSpread","module","link","default","v","export","Route","Users","ironRouterSendErrorToResponse","JsonRoutes","__reifyWaitForDeps__","availableMethods","constructor","api","path","options","endpoints1","endpoints","addToApi","self","_config","paths","includes","Error","concat","defaultOptionsEndpoint","_resolveEndpoints","_configureEndpoints","push","allowedMethods","filter","method","Object","keys","rejectedMethods","fullPath","apiPath","forEach","endpoint","add","req","res","responseInitiated","doneFunc","endpointContext","urlParams","params","queryParams","query","bodyParams","body","request","response","done","responseData","_callEndpoint","e","end","headersSent","statusCode","headers","_respond","status","message","Allow","join","toUpperCase","entries","_ref","action","_ref2","_this$options","roleRequired","length","authRequired","_this$options2","auth","_authAccepted","success","_roleAccepted","call","data","_authenticate","user","userId","token","userSelector","_id","findOne","error","intersection","roles","reduce","a","b","c","delayInMilliseconds","minimumDelayInMilliseconds","randomMultiplierBetweenOneAndTwo","defaultHeaders","_lowerCaseKeys","match","prettyJson","JSON","stringify","sendResponse","writeHead","write","Math","random","setTimeout","object","accumulator","key","toLowerCase","__reify_async_result__","_reifyError","async"],"sources":["packages/rocketchat:restivus/lib/route.js"],"sourcesContent":["import { Users } from '@rocket.chat/models';\n\nimport { ironRouterSendErrorToResponse } from './iron-router-error-to-response';\nimport { JsonRoutes } from './json-routes';\n\nconst availableMethods = ['get', 'post', 'put', 'patch', 'delete', 'options'];\n\nexport class Route {\n\tconstructor(api, path, options, endpoints1) {\n\t\tthis.api = api;\n\t\tthis.path = path;\n\t\tthis.options = options;\n\t\tthis.endpoints = endpoints1;\n\t\tif (!this.endpoints) {\n\t\t\tthis.endpoints = this.options;\n\t\t\tthis.options = {};\n\t\t}\n\t}\n\n\taddToApi() {\n\t\tconst self = this;\n\t\tif (this.api._config.paths.includes(this.path)) {\n\t\t\tthrow new Error(`Cannot add a route at an existing path: ${this.path}`);\n\t\t}\n\t\tthis.endpoints = {\n\t\t\toptions: this.api._config.defaultOptionsEndpoint,\n\t\t\t...this.endpoints,\n\t\t};\n\t\tthis._resolveEndpoints();\n\t\tthis._configureEndpoints();\n\t\tthis.api._config.paths.push(this.path);\n\t\tconst allowedMethods = availableMethods.filter(function (method) {\n\t\t\treturn Object.keys(self.endpoints).includes(method);\n\t\t});\n\t\tconst rejectedMethods = availableMethods.filter(function (method) {\n\t\t\treturn !Object.keys(self.endpoints).includes(method);\n\t\t});\n\t\tconst fullPath = this.api._config.apiPath + this.path;\n\t\tallowedMethods.forEach(function (method) {\n\t\t\tconst endpoint = self.endpoints[method];\n\t\t\treturn JsonRoutes.add(method, fullPath, async function (req, res) {\n\t\t\t\tlet responseInitiated = false;\n\t\t\t\tconst doneFunc = function () {\n\t\t\t\t\tresponseInitiated = true;\n\t\t\t\t};\n\t\t\t\tconst endpointContext = {\n\t\t\t\t\turlParams: req.params,\n\t\t\t\t\tqueryParams: req.query,\n\t\t\t\t\tbodyParams: req.body,\n\t\t\t\t\trequest: req,\n\t\t\t\t\tresponse: res,\n\t\t\t\t\tdone: doneFunc,\n\t\t\t\t\t...endpoint,\n\t\t\t\t};\n\t\t\t\tlet responseData = null;\n\t\t\t\ttry {\n\t\t\t\t\tresponseData = await self._callEndpoint(endpointContext, endpoint);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tironRouterSendErrorToResponse(e, req, res);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (responseInitiated) {\n\t\t\t\t\tres.end();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (res.headersSent) {\n\t\t\t\t\tthrow new Error(`Must call this.done() after handling endpoint response manually: ${method} ${fullPath}`);\n\t\t\t\t} else if (responseData === null || responseData === void 0) {\n\t\t\t\t\tthrow new Error(`Cannot return null or undefined from an endpoint: ${method} ${fullPath}`);\n\t\t\t\t}\n\t\t\t\tif (responseData.body && (responseData.statusCode || responseData.headers)) {\n\t\t\t\t\treturn self._respond(res, responseData.body, responseData.statusCode, responseData.headers);\n\t\t\t\t}\n\t\t\t\treturn self._respond(res, responseData);\n\t\t\t});\n\t\t});\n\t\treturn rejectedMethods.forEach(function (method) {\n\t\t\treturn JsonRoutes.add(method, fullPath, function (req, res) {\n\t\t\t\tconst responseData = {\n\t\t\t\t\tstatus: 'error',\n\t\t\t\t\tmessage: 'API endpoint does not exist',\n\t\t\t\t};\n\t\t\t\tconst headers = {\n\t\t\t\t\tAllow: allowedMethods.join(', ').toUpperCase(),\n\t\t\t\t};\n\t\t\t\treturn self._respond(res, responseData, 405, headers);\n\t\t\t});\n\t\t});\n\t}\n\n\t/*\n\t\tConvert all endpoints on the given route into our expected endpoint object if it is a bare\n\t\tfunction\n\n\t\t@param {Route} route The route the endpoints belong to\n\t\t*/\n\n\t_resolveEndpoints() {\n\t\tObject.entries(this.endpoints).forEach(([method, endpoint]) => {\n\t\t\tif (typeof endpoint === 'function') {\n\t\t\t\tthis.endpoints[method] = {\n\t\t\t\t\taction: endpoint,\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t}\n\n\t/*\n\t\tConfigure the authentication and role requirement on all endpoints (except OPTIONS, which must\n\t\tbe configured directly on the endpoint)\n\n\t\tAuthentication can be required on an entire route or individual endpoints. If required on an\n\t\tentire route, that serves as the default. If required in any individual endpoints, that will\n\t\toverride the default.\n\n\t\tAfter the endpoint is configured, all authentication and role requirements of an endpoint can be\n\t\taccessed at <code>endpoint.authRequired</code> and <code>endpoint.roleRequired</code>,\n\t\trespectively.\n\n\t\t@param {Route} route The route the endpoints belong to\n\t\t@param {Endpoint} endpoint The endpoint to configure\n\t\t*/\n\n\t_configureEndpoints() {\n\t\tObject.entries(this.endpoints).forEach(([method, endpoint]) => {\n\t\t\tif (method !== 'options') {\n\t\t\t\tif (!this.options?.roleRequired) {\n\t\t\t\t\tthis.options.roleRequired = [];\n\t\t\t\t}\n\t\t\t\tif (!endpoint.roleRequired) {\n\t\t\t\t\tendpoint.roleRequired = [];\n\t\t\t\t}\n\t\t\t\tendpoint.roleRequired = [...endpoint.roleRequired, ...this.options.roleRequired];\n\t\t\t\tif (endpoint.roleRequired.length === 0) {\n\t\t\t\t\tendpoint.roleRequired = false;\n\t\t\t\t}\n\t\t\t\tif (endpoint.authRequired === void 0) {\n\t\t\t\t\tif (this.options?.authRequired || endpoint.roleRequired) {\n\t\t\t\t\t\tendpoint.authRequired = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tendpoint.authRequired = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/*\n\t\tAuthenticate an endpoint if required, and return the result of calling it\n\n\t\t@returns The endpoint response or a 401 if authentication fails\n\t\t*/\n\n\tasync _callEndpoint(endpointContext, endpoint) {\n\t\tconst auth = await this._authAccepted(endpointContext, endpoint);\n\t\tif (auth.success) {\n\t\t\tif (this._roleAccepted(endpointContext, endpoint)) {\n\t\t\t\treturn endpoint.action.call(endpointContext);\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tstatusCode: 403,\n\t\t\t\tbody: {\n\t\t\t\t\tstatus: 'error',\n\t\t\t\t\tmessage: 'You do not have permission to do this.',\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tif (auth.data) {\n\t\t\treturn auth.data;\n\t\t}\n\t\treturn {\n\t\t\tstatusCode: 401,\n\t\t\tbody: {\n\t\t\t\tstatus: 'error',\n\t\t\t\tmessage: 'You must be logged in to do this.',\n\t\t\t},\n\t\t};\n\t}\n\n\t/*\n\t\tAuthenticate the given endpoint if required\n\n\t\tOnce it's globally configured in the API, authentication can be required on an entire route or\n\t\tindividual endpoints. If required on an entire endpoint, that serves as the default. If required\n\t\tin any individual endpoints, that will override the default.\n\n\t\t@returns An object of the following format:\n\n\t\t\t\t{\n\t\t\t\t\tsuccess: Boolean\n\t\t\t\t\tdata: String or Object\n\t\t\t\t}\n\n\t\t\twhere `success` is `true` if all required authentication checks pass and the optional `data`\n\t\t\twill contain the auth data when successful and an optional error response when auth fails.\n\t\t*/\n\n\tasync _authAccepted(endpointContext, endpoint) {\n\t\tif (endpoint.authRequired) {\n\t\t\treturn this._authenticate(endpointContext);\n\t\t}\n\t\treturn {\n\t\t\tsuccess: true,\n\t\t};\n\t}\n\n\t/*\n\t\tVerify the request is being made by an actively logged in user\n\n\t\tIf verified, attach the authenticated user to the context.\n\n\t\t@returns An object of the following format:\n\n\t\t\t\t{\n\t\t\t\t\tsuccess: Boolean\n\t\t\t\t\tdata: String or Object\n\t\t\t\t}\n\n\t\t\twhere `success` is `true` if all required authentication checks pass and the optional `data`\n\t\t\twill contain the auth data when successful and an optional error response when auth fails.\n\t\t*/\n\n\tasync _authenticate(endpointContext) {\n\t\tconst auth = await this.api._config.auth.user.call(endpointContext);\n\t\tif (!auth) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t};\n\t\t}\n\t\tif (auth.userId && auth.token && !auth.user) {\n\t\t\tconst userSelector = {};\n\t\t\tuserSelector._id = auth.userId;\n\t\t\tuserSelector[this.api._config.auth.token] = auth.token;\n\t\t\tauth.user = await Users.findOne(userSelector);\n\t\t}\n\t\tif (auth.error) {\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tdata: auth.error,\n\t\t\t};\n\t\t}\n\t\tif (auth.user) {\n\t\t\tendpointContext.user = auth.user;\n\t\t\tendpointContext.userId = auth.user._id;\n\t\t\treturn {\n\t\t\t\tsuccess: true,\n\t\t\t\tdata: auth,\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tsuccess: false,\n\t\t};\n\t}\n\n\t/*\n\t\tAuthenticate the user role if required\n\n\t\tMust be called after _authAccepted().\n\n\t\t@returns True if the authenticated user belongs to <i>any</i> of the acceptable roles on the\n\t\t\t\t\t\t\tendpoint\n\t\t*/\n\n\t_roleAccepted(endpointContext, endpoint) {\n\t\tif (endpoint.roleRequired) {\n\t\t\tconst intersection = [endpoint.roleRequired, endpointContext.user.roles].reduce((a, b) => a.filter((c) => b.includes(c)));\n\t\t\tif (intersection.length === 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t/*\n\t\tRespond to an HTTP request\n\t\t*/\n\n\t_respond(response, body, statusCode, headers) {\n\t\tlet delayInMilliseconds;\n\t\tlet minimumDelayInMilliseconds;\n\t\tlet randomMultiplierBetweenOneAndTwo;\n\t\tif (statusCode == null) {\n\t\t\tstatusCode = 200;\n\t\t}\n\t\tif (headers == null) {\n\t\t\theaders = {};\n\t\t}\n\t\tconst defaultHeaders = this._lowerCaseKeys(this.api._config.defaultHeaders);\n\t\theaders = this._lowerCaseKeys(headers);\n\t\theaders = { ...defaultHeaders, ...headers };\n\t\tif (headers['content-type'].match(/json|javascript/) !== null) {\n\t\t\tif (this.api._config.prettyJson) {\n\t\t\t\tbody = JSON.stringify(body, void 0, 2);\n\t\t\t} else {\n\t\t\t\tbody = JSON.stringify(body);\n\t\t\t}\n\t\t}\n\t\tconst sendResponse = function () {\n\t\t\tresponse.writeHead(statusCode, headers);\n\t\t\tresponse.write(body);\n\t\t\treturn response.end();\n\t\t};\n\t\tif (statusCode === 401 || statusCode === 403) {\n\t\t\tminimumDelayInMilliseconds = 500;\n\t\t\trandomMultiplierBetweenOneAndTwo = 1 + Math.random();\n\t\t\tdelayInMilliseconds = minimumDelayInMilliseconds * randomMultiplierBetweenOneAndTwo;\n\t\t\treturn setTimeout(sendResponse, delayInMilliseconds);\n\t\t}\n\t\treturn sendResponse();\n\t}\n\n\t/*\n\t\tReturn the object with all of the keys converted to lowercase\n\t\t*/\n\n\t_lowerCaseKeys(object) {\n\t\treturn Object.keys(object).reduce((accumulator, key) => {\n\t\t\taccumulator[key.toLowerCase()] = object[key];\n\t\t\treturn accumulator;\n\t\t}, {});\n\t}\n}\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"591ee88e3fbdfc6cf7ab31188b7394face3b9e46"}
