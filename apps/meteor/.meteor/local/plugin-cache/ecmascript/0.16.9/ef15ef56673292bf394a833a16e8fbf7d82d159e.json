{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/github-oauth/github_server.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","objectRestSpread","objectRestSpread","asyncGenerators","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"os.osx.arm64"},"sourceFileName":"packages/github-oauth/github_server.js","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/github-oauth/github_server.js","targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true,"topLevelAwait":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/github-oauth/github_server.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/github-oauth/github_server.js"}},"code":"Github = {};\nOAuth.registerService('github', 2, null, async query => {\n  const accessToken = await getAccessToken(query);\n  const identity = await getIdentity(accessToken);\n  const emails = await getEmails(accessToken);\n  const primaryEmail = emails.find(email => email.primary);\n  return {\n    serviceData: {\n      id: identity.id,\n      accessToken: OAuth.sealSecret(accessToken),\n      email: identity.email || primaryEmail && primaryEmail.email || '',\n      username: identity.login,\n      name: identity.name,\n      avatar: identity.avatar_url,\n      company: identity.company,\n      blog: identity.blog,\n      location: identity.location,\n      bio: identity.bio,\n      emails\n    },\n    options: {\n      profile: {\n        name: identity.name\n      }\n    }\n  };\n});\n\n// http://developer.github.com/v3/#user-agent-required\nlet userAgent = 'Meteor';\nif (Meteor.release) userAgent += \"/\".concat(Meteor.release);\nconst getAccessToken = async query => {\n  const config = await ServiceConfiguration.configurations.findOneAsync({\n    service: 'github'\n  });\n  if (!config) throw new ServiceConfiguration.ConfigError();\n  let response;\n  try {\n    const content = new URLSearchParams({\n      client_id: config.clientId,\n      client_secret: config.secret,\n      code: query.code,\n      redirect_uri: OAuth._redirectUri('github', config)\n    });\n    const request = await OAuth._fetch(\"https://github.com/login/oauth/access_token?\".concat(content.toString()), 'POST', {\n      headers: {\n        Accept: 'application/json',\n        'User-Agent': userAgent\n      }\n    });\n    response = await request.json();\n  } catch (err) {\n    throw Object.assign(new Error(\"Failed to complete OAuth handshake with Github. \".concat(err.message)), {\n      response: err.response\n    });\n  }\n  if (response.error) {\n    // if the http response was a json object with an error attribute\n    throw new Error(\"Failed to complete OAuth handshake with GitHub. \".concat(response.error));\n  } else {\n    return response.access_token;\n  }\n};\nconst getIdentity = async accessToken => {\n  try {\n    const request = await OAuth._fetch('https://api.github.com/user', 'GET', {\n      headers: {\n        Accept: 'application/json',\n        'User-Agent': userAgent,\n        Authorization: \"token \".concat(accessToken)\n      } // http://developer.github.com/v3/#user-agent-required\n    });\n    return await request.json();\n  } catch (err) {\n    throw Object.assign(new Error(\"Failed to fetch identity from Github. \".concat(err.message)), {\n      response: err.response\n    });\n  }\n};\nconst getEmails = async accessToken => {\n  try {\n    const request = await OAuth._fetch('https://api.github.com/user/emails', 'GET', {\n      headers: {\n        'User-Agent': userAgent,\n        Accept: 'application/json',\n        Authorization: \"token \".concat(accessToken)\n      } // http://developer.github.com/v3/#user-agent-required\n    });\n    return await request.json();\n  } catch (err) {\n    return [];\n  }\n};\nGithub.retrieveCredential = (credentialToken, credentialSecret) => OAuth.retrieveCredential(credentialToken, credentialSecret);","map":{"version":3,"names":["Github","OAuth","registerService","query","accessToken","getAccessToken","identity","getIdentity","emails","getEmails","primaryEmail","find","email","primary","serviceData","id","sealSecret","username","login","name","avatar","avatar_url","company","blog","location","bio","options","profile","userAgent","Meteor","release","concat","config","ServiceConfiguration","configurations","findOneAsync","service","ConfigError","response","content","URLSearchParams","client_id","clientId","client_secret","secret","code","redirect_uri","_redirectUri","request","_fetch","toString","headers","Accept","json","err","Object","assign","Error","message","error","access_token","Authorization","retrieveCredential","credentialToken","credentialSecret"],"sources":["packages/github-oauth/github_server.js"],"sourcesContent":["Github = {};\n\nOAuth.registerService('github', 2, null, async (query) => {\n  const accessToken = await getAccessToken(query);\n  const identity = await getIdentity(accessToken);\n  const emails = await getEmails(accessToken);\n  const primaryEmail = emails.find((email) => email.primary);\n\n  return {\n    serviceData: {\n      id: identity.id,\n      accessToken: OAuth.sealSecret(accessToken),\n      email: identity.email || (primaryEmail && primaryEmail.email) || '',\n      username: identity.login,\n      name: identity.name,\n      avatar: identity.avatar_url,\n      company: identity.company,\n      blog: identity.blog,\n      location: identity.location,\n      bio: identity.bio,\n      emails\n    },\n    options: { profile: { name: identity.name } }\n  };\n});\n\n// http://developer.github.com/v3/#user-agent-required\nlet userAgent = 'Meteor';\nif (Meteor.release) userAgent += `/${Meteor.release}`;\n\nconst getAccessToken = async (query) => {\n  const config = await ServiceConfiguration.configurations.findOneAsync({\n    service: 'github'\n  });\n  if (!config) throw new ServiceConfiguration.ConfigError();\n\n  let response;\n  try {\n    const content = new URLSearchParams({\n      client_id: config.clientId,\n      client_secret: config.secret,\n      code: query.code,\n      redirect_uri: OAuth._redirectUri(\n        'github',\n        config\n      )\n    });\n    const request = await OAuth._fetch(\n      `https://github.com/login/oauth/access_token?${content.toString()}`,\n      'POST',\n      {\n        headers: {\n          Accept: 'application/json',\n          'User-Agent': userAgent\n        }\n      }\n    );\n    response = await request.json();\n  } catch (err) {\n    throw Object.assign(\n      new Error(\n        `Failed to complete OAuth handshake with Github. ${err.message}`\n      ),\n      { response: err.response }\n    );\n  }\n  if (response.error) {\n    // if the http response was a json object with an error attribute\n    throw new Error(\n      `Failed to complete OAuth handshake with GitHub. ${response.error}`\n    );\n  } else {\n    return response.access_token;\n  }\n};\n\nconst getIdentity = async (accessToken) => {\n  try {\n    const request = await OAuth._fetch('https://api.github.com/user', 'GET', {\n      headers: {\n        Accept: 'application/json',\n        'User-Agent': userAgent,\n        Authorization: `token ${accessToken}`\n      } // http://developer.github.com/v3/#user-agent-required\n    });\n    return await request.json();\n  } catch (err) {\n    throw Object.assign(\n      new Error(`Failed to fetch identity from Github. ${err.message}`),\n      { response: err.response }\n    );\n  }\n};\n\nconst getEmails = async (accessToken) => {\n  try {\n    const request = await OAuth._fetch('https://api.github.com/user/emails', 'GET', {\n      headers: {\n        'User-Agent': userAgent,\n        Accept: 'application/json',\n        Authorization: `token ${accessToken}`\n      } // http://developer.github.com/v3/#user-agent-required\n    });\n    return await request.json();\n  } catch (err) {\n    return [];\n  }\n};\n\nGithub.retrieveCredential = (credentialToken, credentialSecret) =>\n  OAuth.retrieveCredential(credentialToken, credentialSecret);\n"],"mappings":"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","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"ef15ef56673292bf394a833a16e8fbf7d82d159e"}
