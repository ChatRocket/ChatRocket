{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/accounts-oauth/oauth_client.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","topLevelAwait","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/accounts-oauth/oauth_client.js","filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/accounts-oauth/oauth_client.js","targets":{"android":"125.0.0","chrome":"125.0.0","edge":"125.0.0","firefox":"115.0.0","ie":"10.0.0","ios":"17.4.0","opera":"110.0.0","opera_mobile":"80.0.0","safari":"17.4.0","samsung":"24.0.0"},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","root":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXFragment":{"exit":[null]},"JSXElement":{"exit":[null]},"JSXAttribute":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"LogicalExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"CatchClause":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"AssignmentExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/Users/guilhermegazzo/dev/Rocket.Chat/apps/meteor/packages/accounts-oauth/oauth_client.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/accounts-oauth/oauth_client.js"}},"code":"// Documentation for Meteor.loginWithExternalService\n\n/**\n * @name loginWith<ExternalService>\n * @memberOf Meteor\n * @function\n * @summary Log the user in using an external service.\n * @locus Client\n * @param {Object} [options]\n * @param {String[]} options.requestPermissions A list of permissions to request from the user.\n * @param {Boolean} options.requestOfflineToken If true, asks the user for permission to act on their behalf when offline. This stores an additional offline token in the `services` field of the user document. Currently only supported with Google.\n * @param {Object} options.loginUrlParameters Provide additional parameters to the authentication URI. Currently only supported with Google. See [Google Identity Platform documentation](https://developers.google.com/identity/protocols/OpenIDConnect#authenticationuriparameters).\n * @param {String} options.loginHint An email address that the external service will use to pre-fill the login prompt. Currently only supported with Meteor developer accounts and Google accounts. If used with Google, the Google User ID can also be passed.\n * @param {String} options.loginStyle Login style (\"popup\" or \"redirect\", defaults to the login service configuration).  The \"popup\" style opens the login page in a separate popup window, which is generally preferred because the Meteor application doesn't need to be reloaded.  The \"redirect\" style redirects the Meteor application's window to the login page, and the login service provider redirects back to the Meteor application which is then reloaded.  The \"redirect\" style can be used in situations where a popup window can't be opened, such as in a mobile UIWebView.  The \"redirect\" style however relies on session storage which isn't available in Safari private mode, so the \"popup\" style will be forced if session storage can't be used.\n * @param {String} options.redirectUrl If using \"redirect\" login style, the user will be returned to this URL after authorisation has been completed.\n * @param {Boolean} options.forceApprovalPrompt If true, forces the user to approve the app's permissions, even if previously approved. Currently only supported with Google.\n * @param {Function} [callback] Optional callback. Called with no arguments on success, or with a single `Error` argument on failure. The callback cannot be called if you are using the \"redirect\" `loginStyle`, because the app will have reloaded in the meantime; try using [client-side login hooks](#accounts_onlogin) instead.\n * @importFromPackage meteor\n */\n\n// Allow server to specify a specify subclass of errors. We should come\n// up with a more generic way to do this!\nconst convertError = err => {\n  if (err && err instanceof Meteor.Error && err.error === Accounts.LoginCancelledError.numericError) return new Accounts.LoginCancelledError(err.reason);else return err;\n};\n\n// For the redirect login flow, the final step is that we're\n// redirected back to the application.  The credentialToken for this\n// login attempt is stored in the reload migration data, and the\n// credentialSecret for a successful login is stored in session\n// storage.\n\nMeteor.startup(() => {\n  const oauth = OAuth.getDataAfterRedirect();\n  if (!oauth) return;\n\n  // We'll only have the credentialSecret if the login completed\n  // successfully.  However we still call the login method anyway to\n  // retrieve the error if the login was unsuccessful.\n\n  const methodName = 'login';\n  const {\n    credentialToken,\n    credentialSecret\n  } = oauth;\n  const methodArguments = [{\n    oauth: {\n      credentialToken,\n      credentialSecret\n    }\n  }];\n  Accounts.callLoginMethod({\n    methodArguments,\n    userCallback: err => {\n      // The redirect login flow is complete.  Construct an\n      // `attemptInfo` object with the login result, and report back\n      // to the code which initiated the login attempt\n      // (e.g. accounts-ui, when that package is being used).\n      err = convertError(err);\n      Accounts._pageLoadLogin({\n        type: oauth.loginService,\n        allowed: !err,\n        error: err,\n        methodName,\n        methodArguments\n      });\n    }\n  });\n});\n\n// Send an OAuth login method to the server. If the user authorized\n// access in the popup this should log the user in, otherwise\n// nothing should happen.\nAccounts.oauth.tryLoginAfterPopupClosed = function (credentialToken, callback) {\n  let shouldRetry = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  const credentialSecret = OAuth._retrieveCredentialSecret(credentialToken);\n\n  // In some case the function OAuth._retrieveCredentialSecret() can return null, because the local storage might not\n  // be ready. So we retry after a timeout.\n\n  if (!credentialSecret) {\n    if (!shouldRetry) {\n      return;\n    }\n    Meteor.setTimeout(() => Accounts.oauth.tryLoginAfterPopupClosed(credentialToken, callback, false), 500);\n    return;\n  }\n  // continue with the rest of the function\n  Accounts.callLoginMethod({\n    methodArguments: [{\n      oauth: {\n        credentialToken,\n        credentialSecret\n      }\n    }],\n    userCallback: callback && (err => callback(convertError(err)))\n  });\n};\nAccounts.oauth.credentialRequestCompleteHandler = callback => credentialTokenOrError => {\n  if (credentialTokenOrError && credentialTokenOrError instanceof Error) {\n    callback && callback(credentialTokenOrError);\n  } else {\n    Accounts.oauth.tryLoginAfterPopupClosed(credentialTokenOrError, callback);\n  }\n};","map":{"version":3,"names":["convertError","err","Meteor","Error","error","Accounts","LoginCancelledError","numericError","reason","startup","oauth","OAuth","getDataAfterRedirect","methodName","credentialToken","credentialSecret","methodArguments","callLoginMethod","userCallback","_pageLoadLogin","type","loginService","allowed","tryLoginAfterPopupClosed","callback","shouldRetry","arguments","length","undefined","_retrieveCredentialSecret","setTimeout","credentialRequestCompleteHandler","credentialTokenOrError"],"sources":["packages/accounts-oauth/oauth_client.js"],"sourcesContent":["// Documentation for Meteor.loginWithExternalService\n\n/**\n * @name loginWith<ExternalService>\n * @memberOf Meteor\n * @function\n * @summary Log the user in using an external service.\n * @locus Client\n * @param {Object} [options]\n * @param {String[]} options.requestPermissions A list of permissions to request from the user.\n * @param {Boolean} options.requestOfflineToken If true, asks the user for permission to act on their behalf when offline. This stores an additional offline token in the `services` field of the user document. Currently only supported with Google.\n * @param {Object} options.loginUrlParameters Provide additional parameters to the authentication URI. Currently only supported with Google. See [Google Identity Platform documentation](https://developers.google.com/identity/protocols/OpenIDConnect#authenticationuriparameters).\n * @param {String} options.loginHint An email address that the external service will use to pre-fill the login prompt. Currently only supported with Meteor developer accounts and Google accounts. If used with Google, the Google User ID can also be passed.\n * @param {String} options.loginStyle Login style (\"popup\" or \"redirect\", defaults to the login service configuration).  The \"popup\" style opens the login page in a separate popup window, which is generally preferred because the Meteor application doesn't need to be reloaded.  The \"redirect\" style redirects the Meteor application's window to the login page, and the login service provider redirects back to the Meteor application which is then reloaded.  The \"redirect\" style can be used in situations where a popup window can't be opened, such as in a mobile UIWebView.  The \"redirect\" style however relies on session storage which isn't available in Safari private mode, so the \"popup\" style will be forced if session storage can't be used.\n * @param {String} options.redirectUrl If using \"redirect\" login style, the user will be returned to this URL after authorisation has been completed.\n * @param {Boolean} options.forceApprovalPrompt If true, forces the user to approve the app's permissions, even if previously approved. Currently only supported with Google.\n * @param {Function} [callback] Optional callback. Called with no arguments on success, or with a single `Error` argument on failure. The callback cannot be called if you are using the \"redirect\" `loginStyle`, because the app will have reloaded in the meantime; try using [client-side login hooks](#accounts_onlogin) instead.\n * @importFromPackage meteor\n */\n\n// Allow server to specify a specify subclass of errors. We should come\n// up with a more generic way to do this!\nconst convertError = err => {\n  if (err && err instanceof Meteor.Error &&\n      err.error === Accounts.LoginCancelledError.numericError)\n    return new Accounts.LoginCancelledError(err.reason);\n  else\n    return err;\n};\n\n\n// For the redirect login flow, the final step is that we're\n// redirected back to the application.  The credentialToken for this\n// login attempt is stored in the reload migration data, and the\n// credentialSecret for a successful login is stored in session\n// storage.\n\nMeteor.startup(() => {\n  const oauth = OAuth.getDataAfterRedirect();\n  if (! oauth)\n    return;\n\n  // We'll only have the credentialSecret if the login completed\n  // successfully.  However we still call the login method anyway to\n  // retrieve the error if the login was unsuccessful.\n\n  const methodName = 'login';\n  const { credentialToken, credentialSecret } = oauth;\n  const methodArguments = [{ oauth: { credentialToken, credentialSecret } }];\n\n  Accounts.callLoginMethod({\n    methodArguments,\n    userCallback: err => {\n      // The redirect login flow is complete.  Construct an\n      // `attemptInfo` object with the login result, and report back\n      // to the code which initiated the login attempt\n      // (e.g. accounts-ui, when that package is being used).\n      err = convertError(err);\n      Accounts._pageLoadLogin({\n        type: oauth.loginService,\n        allowed: !err,\n        error: err,\n        methodName,\n        methodArguments,\n      });\n    }\n  });\n});\n\n\n// Send an OAuth login method to the server. If the user authorized\n// access in the popup this should log the user in, otherwise\n// nothing should happen.\nAccounts.oauth.tryLoginAfterPopupClosed = (\n  credentialToken,\n  callback,\n  shouldRetry = true\n) => {\n  const credentialSecret =\n    OAuth._retrieveCredentialSecret(credentialToken);\n\n  // In some case the function OAuth._retrieveCredentialSecret() can return null, because the local storage might not\n  // be ready. So we retry after a timeout.\n\n  if (!credentialSecret) {\n    if (!shouldRetry) {\n      return;\n    }\n    Meteor.setTimeout(\n      () =>\n        Accounts.oauth.tryLoginAfterPopupClosed(\n          credentialToken,\n          callback,\n          false\n        ),\n      500\n    );\n    return;\n  }\n  // continue with the rest of the function\n  Accounts.callLoginMethod({\n    methodArguments: [{ oauth: { credentialToken, credentialSecret } }],\n    userCallback: callback && (err => callback(convertError(err))),\n  });\n};\n\nAccounts.oauth.credentialRequestCompleteHandler = callback =>\n  credentialTokenOrError => {\n    if(credentialTokenOrError && credentialTokenOrError instanceof Error) {\n      callback && callback(credentialTokenOrError);\n    } else {\n      Accounts.oauth.tryLoginAfterPopupClosed(credentialTokenOrError, callback);\n    }\n  }\n\n"],"mappings":"AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,MAAMA,YAAY,GAAGC,GAAG,IAAI;EAC1B,IAAIA,GAAG,IAAIA,GAAG,YAAYC,MAAM,CAACC,KAAK,IAClCF,GAAG,CAACG,KAAK,KAAKC,QAAQ,CAACC,mBAAmB,CAACC,YAAY,EACzD,OAAO,IAAIF,QAAQ,CAACC,mBAAmB,CAACL,GAAG,CAACO,MAAM,CAAC,CAAC,KAEpD,OAAOP,GAAG;AACd,CAAC;;AAGD;AACA;AACA;AACA;AACA;;AAEAC,MAAM,CAACO,OAAO,CAAC,MAAM;EACnB,MAAMC,KAAK,GAAGC,KAAK,CAACC,oBAAoB,CAAC,CAAC;EAC1C,IAAI,CAAEF,KAAK,EACT;;EAEF;EACA;EACA;;EAEA,MAAMG,UAAU,GAAG,OAAO;EAC1B,MAAM;IAAEC,eAAe;IAAEC;EAAiB,CAAC,GAAGL,KAAK;EACnD,MAAMM,eAAe,GAAG,CAAC;IAAEN,KAAK,EAAE;MAAEI,eAAe;MAAEC;IAAiB;EAAE,CAAC,CAAC;EAE1EV,QAAQ,CAACY,eAAe,CAAC;IACvBD,eAAe;IACfE,YAAY,EAAEjB,GAAG,IAAI;MACnB;MACA;MACA;MACA;MACAA,GAAG,GAAGD,YAAY,CAACC,GAAG,CAAC;MACvBI,QAAQ,CAACc,cAAc,CAAC;QACtBC,IAAI,EAAEV,KAAK,CAACW,YAAY;QACxBC,OAAO,EAAE,CAACrB,GAAG;QACbG,KAAK,EAAEH,GAAG;QACVY,UAAU;QACVG;MACF,CAAC,CAAC;IACJ;EACF,CAAC,CAAC;AACJ,CAAC,CAAC;;AAGF;AACA;AACA;AACAX,QAAQ,CAACK,KAAK,CAACa,wBAAwB,GAAG,UACxCT,eAAe,EACfU,QAAQ,EAEL;EAAA,IADHC,WAAW,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAI;EAElB,MAAMX,gBAAgB,GACpBJ,KAAK,CAACkB,yBAAyB,CAACf,eAAe,CAAC;;EAElD;EACA;;EAEA,IAAI,CAACC,gBAAgB,EAAE;IACrB,IAAI,CAACU,WAAW,EAAE;MAChB;IACF;IACAvB,MAAM,CAAC4B,UAAU,CACf,MACEzB,QAAQ,CAACK,KAAK,CAACa,wBAAwB,CACrCT,eAAe,EACfU,QAAQ,EACR,KACF,CAAC,EACH,GACF,CAAC;IACD;EACF;EACA;EACAnB,QAAQ,CAACY,eAAe,CAAC;IACvBD,eAAe,EAAE,CAAC;MAAEN,KAAK,EAAE;QAAEI,eAAe;QAAEC;MAAiB;IAAE,CAAC,CAAC;IACnEG,YAAY,EAAEM,QAAQ,KAAKvB,GAAG,IAAIuB,QAAQ,CAACxB,YAAY,CAACC,GAAG,CAAC,CAAC;EAC/D,CAAC,CAAC;AACJ,CAAC;AAEDI,QAAQ,CAACK,KAAK,CAACqB,gCAAgC,GAAGP,QAAQ,IACxDQ,sBAAsB,IAAI;EACxB,IAAGA,sBAAsB,IAAIA,sBAAsB,YAAY7B,KAAK,EAAE;IACpEqB,QAAQ,IAAIA,QAAQ,CAACQ,sBAAsB,CAAC;EAC9C,CAAC,MAAM;IACL3B,QAAQ,CAACK,KAAK,CAACa,wBAAwB,CAACS,sBAAsB,EAAER,QAAQ,CAAC;EAC3E;AACF,CAAC","ignoreList":[]},"sourceType":"module","externalDependencies":{},"hash":"70e4ddc693d066f142f80911379b9a25e788072a"}
