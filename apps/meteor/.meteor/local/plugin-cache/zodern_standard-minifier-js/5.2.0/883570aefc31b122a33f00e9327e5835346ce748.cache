{"code":"function module(e,t,n){n.link(\"@babel/runtime/helpers/taggedTemplateLiteralLoose\",{default:function(e){l=e}},0),n.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){a=e}},1),n.link(\"@babel/runtime/helpers/toConsumableArray\",{default:function(e){u=e}},2),n.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){r=e}},3),n.export({useDateScroll:function(){return v}}),n.link(\"@rocket.chat/css-in-js\",{css:function(e){s=e}},0),n.link(\"@rocket.chat/fuselage-hooks\",{useSafely:function(e){c=e}},1),n.link(\"react\",{useCallback:function(e){b=e},useRef:function(e){f=e},useState:function(e){d=e}},2),n.link(\"../../../../lib/utils/highOrderFunctions\",{withThrottling:function(e){p=e}},3),n.link(\"../providers/DateListProvider\",{useDateListController:function(e){h=e}},4);var i,o,l,a,u,r,s,c,b,f,d,p,h,v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=c(d({date:\"\",show:!1,style:void 0,bubbleDateClassName:void 0,offset:0})),n=r(t,2),v=n[0],g=n[1],m=h().list,k=f(null);return{innerRef:b(function(t){if(t){var n,o,c=(null===(o=k.current)||void 0===o?void 0:o.getBoundingClientRect().bottom)||0,b=function(t){clearTimeout(n);var o=u(t).reduce(function(t,n){if(!n.dataset.id)return t;var i=n.getBoundingClientRect(),o=i.top,l=i.height,a=n.dataset.id;return o>c&&o<c+l?[t[0]||new Date(a).toISOString(),t[1]||n,{position:\"absolute\",top:o-l-c+e+\"px\",left:\" 50%\",translate:\"-50%\",zIndex:11}]:o<c+l?[new Date(a).toISOString(),n,{position:\"absolute\",top:e+\"px\",left:\" 50%\",translate:\"-50%\",zIndex:11}]:t},[]),b=r(o,3),f=b[0],d=b[1],p=b[2];if(g(function(e){return a(a(a({},e),{},{date:\"\"},f&&{date:f}),{},{show:!!f,style:p,bubbleDateClassName:s(i||(i=l([\"\\n\t\t\t\t\t\t\topacity: 0;\\n\t\t\t\t\t\t\ttransition: opacity 0.6s;\\n\t\t\t\t\t\t\t&.bubble-visible {\\n\t\t\t\t\t\t\t\topacity: 1;\\n\t\t\t\t\t\t\t}\\n\t\t\t\t\t\t\"])))})}),d){var h=d.getBoundingClientRect().top;if(h<c&&h>0)return}n=setTimeout(function(){return g(function(e){return a(a({},e),{},{show:!1})})},1e3)},f=p({wait:30})(function(){b(m)});t.addEventListener(\"scroll\",f,{passive:!0})}},[m,e,g]),bubbleRef:k,listStyle:v.show&&v.date?s(o||(o=l([\"\\n\t\t\t\t\tposition: relative;\\n\t\t\t\t\t& [data-time='\",\"'] {\\n\t\t\t\t\t\topacity: 0;\\n\t\t\t\t\t}\\n\t\t\t  \"])),v.date.replaceAll(/[-T:.]/g,\"\").substring(0,8)):void 0,bubbleDate:v.date,bubbleDateStyle:v.style,showBubble:!!v.show,bubbleDateClassName:v.bubbleDateClassName}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/hooks/useDateScroll.ts\",\"<anon>\"],\"sourcesContent\":[\"import { css } from '@rocket.chat/css-in-js';\\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\\nimport type { MutableRefObject } from 'react';\\nimport { useCallback, useRef, useState } from 'react';\\n\\nimport { withThrottling } from '../../../../lib/utils/highOrderFunctions';\\nimport { useDateListController } from '../providers/DateListProvider';\\n\\ntype useDateScrollReturn = {\\n\\tinnerRef: (node: HTMLElement | null) => void;\\n\\tbubbleRef: MutableRefObject<HTMLElement | null>;\\n\\tlistStyle?: ReturnType<typeof css>;\\n} & BubbleDateProps;\\n\\nexport type BubbleDateProps = {\\n\\tbubbleDate: string | undefined;\\n\\tbubbleDateClassName?: ReturnType<typeof css>;\\n\\tshowBubble: boolean;\\n\\tbubbleDateStyle?: React.CSSProperties;\\n};\\n\\nexport const useDateScroll = (margin = 8): useDateScrollReturn => {\\n\\tconst [bubbleDate, setBubbleDate] = useSafely(\\n\\t\\tuseState<{\\n\\t\\t\\tdate: string;\\n\\t\\t\\tshow: boolean;\\n\\t\\t\\tstyle?: React.CSSProperties;\\n\\t\\t\\tbubbleDateClassName?: ReturnType<typeof css>;\\n\\t\\t\\toffset: number;\\n\\t\\t}>({\\n\\t\\t\\tdate: '',\\n\\t\\t\\tshow: false,\\n\\t\\t\\tstyle: undefined,\\n\\t\\t\\tbubbleDateClassName: undefined,\\n\\t\\t\\toffset: 0,\\n\\t\\t}),\\n\\t);\\n\\n\\tconst { list } = useDateListController();\\n\\n\\tconst bubbleRef = useRef<HTMLElement>(null);\\n\\n\\tconst callbackRef = useCallback(\\n\\t\\t(node: HTMLElement | null) => {\\n\\t\\t\\tif (!node) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\tconst bubbleOffset = bubbleRef.current?.getBoundingClientRect().bottom || 0;\\n\\n\\t\\t\\tconst onScroll = (() => {\\n\\t\\t\\t\\tlet timeout: ReturnType<typeof setTimeout>;\\n\\t\\t\\t\\treturn (elements: Set<HTMLElement>) => {\\n\\t\\t\\t\\t\\tclearTimeout(timeout);\\n\\n\\t\\t\\t\\t\\t// Gets the first non visible message date and sets the bubble date to it\\n\\t\\t\\t\\t\\tconst [date, message, style] = [...elements].reduce((ret, message) => {\\n\\t\\t\\t\\t\\t\\t// Sanitize elements\\n\\t\\t\\t\\t\\t\\tif (!message.dataset.id) {\\n\\t\\t\\t\\t\\t\\t\\treturn ret;\\n\\t\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\t\\tconst { top, height } = message.getBoundingClientRect();\\n\\t\\t\\t\\t\\t\\tconst { id } = message.dataset;\\n\\n\\t\\t\\t\\t\\t\\t// if the bubble if between the divider and the top, position it at the top of the divider\\n\\t\\t\\t\\t\\t\\tif (top > bubbleOffset && top < bubbleOffset + height) {\\n\\t\\t\\t\\t\\t\\t\\treturn [\\n\\t\\t\\t\\t\\t\\t\\t\\tret[0] || new Date(id).toISOString(),\\n\\t\\t\\t\\t\\t\\t\\t\\tret[1] || message,\\n\\t\\t\\t\\t\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tposition: 'absolute',\\n\\t\\t\\t\\t\\t\\t\\t\\t\\ttop: `${top - height - bubbleOffset + margin}px`,\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tleft: ' 50%',\\n\\t\\t\\t\\t\\t\\t\\t\\t\\ttranslate: '-50%',\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tzIndex: 11,\\n\\t\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t\\t];\\n\\t\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\t\\tif (top < bubbleOffset + height) {\\n\\t\\t\\t\\t\\t\\t\\treturn [\\n\\t\\t\\t\\t\\t\\t\\t\\tnew Date(id).toISOString(),\\n\\t\\t\\t\\t\\t\\t\\t\\tmessage,\\n\\t\\t\\t\\t\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tposition: 'absolute',\\n\\t\\t\\t\\t\\t\\t\\t\\t\\ttop: `${margin}px`,\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tleft: ' 50%',\\n\\t\\t\\t\\t\\t\\t\\t\\t\\ttranslate: '-50%',\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tzIndex: 11,\\n\\t\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t\\t];\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\treturn ret;\\n\\t\\t\\t\\t\\t}, [] as [string, HTMLElement, { [key: number]: string | number }?] | []);\\n\\n\\t\\t\\t\\t\\t// We always keep the previous date if we don't have a new one, so when the bubble disappears it doesn't flicker\\n\\t\\t\\t\\t\\tsetBubbleDate((current) => ({\\n\\t\\t\\t\\t\\t\\t...current,\\n\\t\\t\\t\\t\\t\\tdate: '',\\n\\t\\t\\t\\t\\t\\t...(date && { date }),\\n\\t\\t\\t\\t\\t\\tshow: Boolean(date),\\n\\t\\t\\t\\t\\t\\tstyle,\\n\\t\\t\\t\\t\\t\\tbubbleDateClassName: css`\\n\\t\\t\\t\\t\\t\\t\\topacity: 0;\\n\\t\\t\\t\\t\\t\\t\\ttransition: opacity 0.6s;\\n\\t\\t\\t\\t\\t\\t\\t&.bubble-visible {\\n\\t\\t\\t\\t\\t\\t\\t\\topacity: 1;\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t`,\\n\\t\\t\\t\\t\\t}));\\n\\n\\t\\t\\t\\t\\tif (message) {\\n\\t\\t\\t\\t\\t\\tconst { top } = message.getBoundingClientRect();\\n\\t\\t\\t\\t\\t\\tif (top < bubbleOffset && top > 0) {\\n\\t\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\ttimeout = setTimeout(\\n\\t\\t\\t\\t\\t\\t() =>\\n\\t\\t\\t\\t\\t\\t\\tsetBubbleDate((current) => ({\\n\\t\\t\\t\\t\\t\\t\\t\\t...current,\\n\\t\\t\\t\\t\\t\\t\\t\\tshow: false,\\n\\t\\t\\t\\t\\t\\t\\t})),\\n\\t\\t\\t\\t\\t\\t1000,\\n\\t\\t\\t\\t\\t);\\n\\t\\t\\t\\t};\\n\\t\\t\\t})();\\n\\n\\t\\t\\tconst fn = withThrottling({ wait: 30 })(() => {\\n\\t\\t\\t\\tonScroll(list);\\n\\t\\t\\t});\\n\\n\\t\\t\\tnode.addEventListener('scroll', fn, { passive: true });\\n\\t\\t},\\n\\t\\t[list, margin, setBubbleDate],\\n\\t);\\n\\n\\tconst listStyle =\\n\\t\\tbubbleDate.show && bubbleDate.date\\n\\t\\t\\t? css`\\n\\t\\t\\t\\t\\tposition: relative;\\n\\t\\t\\t\\t\\t& [data-time='${bubbleDate.date.replaceAll(/[-T:.]/g, '').substring(0, 8)}'] {\\n\\t\\t\\t\\t\\t\\topacity: 0;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t  `\\n\\t\\t\\t: undefined;\\n\\n\\treturn {\\n\\t\\tinnerRef: callbackRef,\\n\\t\\tbubbleRef,\\n\\t\\tlistStyle,\\n\\t\\tbubbleDate: bubbleDate.date,\\n\\t\\tbubbleDateStyle: bubbleDate.style,\\n\\t\\tshowBubble: Boolean(bubbleDate.show),\\n\\t\\tbubbleDateClassName: bubbleDate.bubbleDateClassName,\\n\\t};\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_taggedTemplateLiteralLoose\",\"_objectSpread\",\"_toConsumableArray\",\"_slicedToArray\",\"export\",\"useDateScroll\",\"css\",\"useSafely\",\"useCallback\",\"useRef\",\"useState\",\"withThrottling\",\"useDateListController\",\"margin\",\"arguments\",\"length\",\"undefined\",\"_useSafely\",\"date\",\"show\",\"style\",\"bubbleDateClassName\",\"offset\",\"_useSafely2\",\"bubbleDate\",\"setBubbleDate\",\"list\",\"_useDateListControlle\",\"bubbleRef\",\"innerRef\",\"node\",\"timeout\",\"_bubbleRef$current\",\"bubbleOffset\",\"current\",\"getBoundingClientRect\",\"bottom\",\"onScroll\",\"elements\",\"clearTimeout\",\"_reduce\",\"reduce\",\"ret\",\"message\",\"dataset\",\"id\",\"_message$getBoundingC\",\"top\",\"height\",\"Date\",\"toISOString\",\"position\",\"left\",\"translate\",\"zIndex\",\"_reduce2\",\"Boolean\",\"_templateObject\",\"_message$getBoundingC2\",\"setTimeout\",\"fn\",\"wait\",\"addEventListener\",\"passive\",\"listStyle\",\"_templateObject2\",\"replaceAll\",\"substring\",\"bubbleDateStyle\",\"showBubble\"],\"mappings\":\"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\"}"}