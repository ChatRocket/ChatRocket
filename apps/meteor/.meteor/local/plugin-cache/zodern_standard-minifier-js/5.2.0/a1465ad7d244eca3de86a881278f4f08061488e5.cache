{"code":"function module(e,t,i){let n,s,d;i.link(\"meteor/meteor\",{Meteor(e){n=e}},0),i.link(\"../../app/models/client\",{ChatMessage(e){s=e}},1),i.link(\"../../app/ui-utils/client\",{LegacyRoomManager(e){d=e}},2),n.startup(()=>{s.find().observe({removed(e){if(!d.getOpenedRoomByRid(e.rid))return;let t=s.findOne({ts:{$lt:e.ts}},{sort:{ts:-1}});t&&s.update({_id:t._id},{$set:{tick:new Date}});let i=s.findOne({ts:{$gt:e.ts}},{sort:{ts:1}});if(i)return s.update({_id:i._id},{$set:{tick:new Date}})}})})}","map":"{\"version\":3,\"sources\":[\"client/startup/messageObserve.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\n\\nimport { ChatMessage } from '../../app/models/client';\\nimport { LegacyRoomManager } from '../../app/ui-utils/client';\\n\\nMeteor.startup(() => {\\n\\tChatMessage.find().observe({\\n\\t\\tremoved(record) {\\n\\t\\t\\tif (!LegacyRoomManager.getOpenedRoomByRid(record.rid)) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst recordBefore = ChatMessage.findOne({ ts: { $lt: record.ts } }, { sort: { ts: -1 } });\\n\\t\\t\\tif (recordBefore) {\\n\\t\\t\\t\\tChatMessage.update({ _id: recordBefore._id }, { $set: { tick: new Date() } });\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst recordAfter = ChatMessage.findOne({ ts: { $gt: record.ts } }, { sort: { ts: 1 } });\\n\\t\\t\\tif (recordAfter) {\\n\\t\\t\\t\\treturn ChatMessage.update({ _id: recordAfter._id }, { $set: { tick: new Date() } });\\n\\t\\t\\t}\\n\\t\\t},\\n\\t});\\n});\\n\",null],\"names\":[\"Meteor\",\"ChatMessage\",\"LegacyRoomManager\",\"module\",\"link\",\"v\",\"startup\",\"find\",\"observe\",\"removed\",\"record\",\"getOpenedRoomByRid\",\"rid\",\"recordBefore\",\"findOne\",\"ts\",\"$lt\",\"sort\",\"update\",\"_id\",\"$set\",\"tick\",\"Date\",\"recordAfter\",\"$gt\"],\"mappings\":\"2BAAAA,EAAuCC,EAAAC,EAA9BC,EAAQC,IAAA,CAAM,gBAAgB,CAAAJ,OAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,0BAAA,CAAAH,YAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,4BAAA,CAAAF,kBAAAG,CAAA,EAAAH,EAAAG,CAAA,CAAA,EAAA,GAKvCL,EAAOM,OAAO,CAAC,KACdL,EAAYM,IAAI,GAAGC,OAAO,CAAC,CAC1BC,QAAQC,CAAM,EACb,GAAI,CAACR,EAAkBS,kBAAkB,CAACD,EAAOE,GAAG,EACnD,OAGD,IAAMC,EAAeZ,EAAYa,OAAO,CAAC,CAAEC,GAAI,CAAEC,IAAKN,EAAOK,EAAAA,AAAE,CAAE,EAAI,CAAEE,KAAM,CAAEF,GAAI,EAAE,CAAE,GACnFF,GACHZ,EAAYiB,MAAM,CAAC,CAAEC,IAAKN,EAAaM,GAAAA,AAAG,EAAI,CAAEC,KAAM,CAAEC,KAAM,IAAIC,IAAM,CAAE,GAG3E,IAAMC,EAActB,EAAYa,OAAO,CAAC,CAAEC,GAAI,CAAES,IAAKd,EAAOK,EAAAA,AAAE,CAAE,EAAI,CAAEE,KAAM,CAAEF,GAAI,CAAC,CAAE,GACrF,GAAIQ,EACH,OAAOtB,EAAYiB,MAAM,CAAC,CAAEC,IAAKI,EAAYJ,GAAAA,AAAG,EAAI,CAAEC,KAAM,CAAEC,KAAM,IAAIC,IAAM,CAAE,EAElF,GAEF\"}"}