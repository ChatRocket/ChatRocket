{"code":"function module(e,t,i){let a,s,o,n,r,l,c,u,d,m,k,h,p,y;i.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){a=e}},0),i.export({useNormalizedMessage:()=>g}),i.link(\"@rocket.chat/base64\",{Base64(e){s=e}},0),i.link(\"@rocket.chat/core-typings\",{isFileImageAttachment(e){o=e},isFileAttachment(e){n=e},isFileAudioAttachment(e){r=e},isFileVideoAttachment(e){l=e},isQuoteAttachment(e){c=e}},1),i.link(\"@rocket.chat/ui-contexts\",{useSetting(e){u=e}},2),i.link(\"react\",{useMemo(e){d=e}},3),i.link(\"../../../lib/parseMessageTextToAstMarkdown\",{parseMessageTextToAstMarkdown(e){m=e}},4),i.link(\"../../../views/room/MessageList/hooks/useAutoLinkDomains\",{useAutoLinkDomains(e){k=e}},5),i.link(\"../../../views/room/MessageList/hooks/useAutoTranslate\",{useAutoTranslate(e){h=e}},6),i.link(\"../../../views/room/MessageList/hooks/useKatex\",{useKatex(e){p=e}},7),i.link(\"./useSubscriptionFromMessageQuery\",{useSubscriptionFromMessageQuery(e){y=e}},8);let f=(e,t,i)=>(t&&(t=String.fromCharCode(...new TextEncoder().encode(t))),e.map(e=>{if(c(e)&&e.attachments)return e.attachments=f(e.attachments),e;if(!e.encryption)return e;let u=s.encode(JSON.stringify(a(a({},e.encryption),{},{name:t,type:i})));return n(e)&&(e.title_link&&!e.title_link.startsWith(\"/file-decrypt/\")&&(e.title_link=\"/file-decrypt\".concat(e.title_link,\"?key=\").concat(u)),o(e)&&!e.image_url.startsWith(\"/file-decrypt/\")&&(e.image_url=\"/file-decrypt\".concat(e.image_url,\"?key=\").concat(u)),r(e)&&!e.audio_url.startsWith(\"/file-decrypt/\")&&(e.audio_url=\"/file-decrypt\".concat(e.audio_url,\"?key=\").concat(u)),l(e)&&!e.video_url.startsWith(\"/file-decrypt/\")&&(e.video_url=\"/file-decrypt\".concat(e.video_url,\"?key=\").concat(u))),e})),g=e=>{var t;let{katexEnabled:i,katexDollarSyntaxEnabled:s,katexParenthesisSyntaxEnabled:o}=p(),n=k(),r=null!==(t=y(e).data)&&void 0!==t?t:void 0,l=h(r),c=u(\"HexColorPreview_Enabled\");return d(()=>{let t=a({colors:c,emoticons:!0,customDomains:n},i&&{katex:{dollarSyntax:s,parenthesisSyntax:o}}),r=m(e,t,l);if(r.attachments){var u,d;r.attachments=f(r.attachments,null===(u=r.file)||void 0===u?void 0:u.name,null===(d=r.file)||void 0===d?void 0:d.type)}return r},[c,n,i,s,o,e,l])}}","map":"{\"version\":3,\"sources\":[\"client/components/message/hooks/useNormalizedMessage.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Base64 } from '@rocket.chat/base64';\\nimport type { IMessage, MessageAttachment } from '@rocket.chat/core-typings';\\nimport {\\n\\tisFileImageAttachment,\\n\\tisFileAttachment,\\n\\tisFileAudioAttachment,\\n\\tisFileVideoAttachment,\\n\\tisQuoteAttachment,\\n} from '@rocket.chat/core-typings';\\nimport type { Options } from '@rocket.chat/message-parser';\\nimport { useSetting } from '@rocket.chat/ui-contexts';\\nimport { useMemo } from 'react';\\n\\nimport type { MessageWithMdEnforced } from '../../../lib/parseMessageTextToAstMarkdown';\\nimport { parseMessageTextToAstMarkdown } from '../../../lib/parseMessageTextToAstMarkdown';\\nimport { useAutoLinkDomains } from '../../../views/room/MessageList/hooks/useAutoLinkDomains';\\nimport { useAutoTranslate } from '../../../views/room/MessageList/hooks/useAutoTranslate';\\nimport { useKatex } from '../../../views/room/MessageList/hooks/useKatex';\\nimport { useSubscriptionFromMessageQuery } from './useSubscriptionFromMessageQuery';\\n\\nconst normalizeAttachments = (attachments: MessageAttachment[], name?: string, type?: string): MessageAttachment[] => {\\n\\tif (name) {\\n\\t\\tname = String.fromCharCode(...new TextEncoder().encode(name));\\n\\t}\\n\\n\\treturn attachments.map((attachment) => {\\n\\t\\tif (isQuoteAttachment(attachment) && attachment.attachments) {\\n\\t\\t\\tattachment.attachments = normalizeAttachments(attachment.attachments);\\n\\t\\t\\treturn attachment;\\n\\t\\t}\\n\\n\\t\\tif (!attachment.encryption) {\\n\\t\\t\\treturn attachment;\\n\\t\\t}\\n\\n\\t\\tconst key = Base64.encode(\\n\\t\\t\\tJSON.stringify({\\n\\t\\t\\t\\t...attachment.encryption,\\n\\t\\t\\t\\tname,\\n\\t\\t\\t\\ttype,\\n\\t\\t\\t}),\\n\\t\\t);\\n\\n\\t\\tif (isFileAttachment(attachment)) {\\n\\t\\t\\tif (attachment.title_link && !attachment.title_link.startsWith('/file-decrypt/')) {\\n\\t\\t\\t\\tattachment.title_link = `/file-decrypt${attachment.title_link}?key=${key}`;\\n\\t\\t\\t}\\n\\t\\t\\tif (isFileImageAttachment(attachment) && !attachment.image_url.startsWith('/file-decrypt/')) {\\n\\t\\t\\t\\tattachment.image_url = `/file-decrypt${attachment.image_url}?key=${key}`;\\n\\t\\t\\t}\\n\\t\\t\\tif (isFileAudioAttachment(attachment) && !attachment.audio_url.startsWith('/file-decrypt/')) {\\n\\t\\t\\t\\tattachment.audio_url = `/file-decrypt${attachment.audio_url}?key=${key}`;\\n\\t\\t\\t}\\n\\t\\t\\tif (isFileVideoAttachment(attachment) && !attachment.video_url.startsWith('/file-decrypt/')) {\\n\\t\\t\\t\\tattachment.video_url = `/file-decrypt${attachment.video_url}?key=${key}`;\\n\\t\\t\\t}\\n\\t\\t}\\n\\n\\t\\treturn attachment;\\n\\t});\\n};\\n\\nexport const useNormalizedMessage = <TMessage extends IMessage>(message: TMessage): MessageWithMdEnforced => {\\n\\tconst { katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled } = useKatex();\\n\\tconst customDomains = useAutoLinkDomains();\\n\\tconst subscription = useSubscriptionFromMessageQuery(message).data ?? undefined;\\n\\tconst autoTranslateOptions = useAutoTranslate(subscription);\\n\\tconst showColors = useSetting<boolean>('HexColorPreview_Enabled');\\n\\n\\treturn useMemo(() => {\\n\\t\\tconst parseOptions: Options = {\\n\\t\\t\\tcolors: showColors,\\n\\t\\t\\temoticons: true,\\n\\t\\t\\tcustomDomains,\\n\\t\\t\\t...(katexEnabled && {\\n\\t\\t\\t\\tkatex: {\\n\\t\\t\\t\\t\\tdollarSyntax: katexDollarSyntaxEnabled,\\n\\t\\t\\t\\t\\tparenthesisSyntax: katexParenthesisSyntaxEnabled,\\n\\t\\t\\t\\t},\\n\\t\\t\\t}),\\n\\t\\t};\\n\\n\\t\\tconst normalizedMessage = parseMessageTextToAstMarkdown(message, parseOptions, autoTranslateOptions);\\n\\n\\t\\tif (normalizedMessage.attachments) {\\n\\t\\t\\tnormalizedMessage.attachments = normalizeAttachments(\\n\\t\\t\\t\\tnormalizedMessage.attachments,\\n\\t\\t\\t\\tnormalizedMessage.file?.name,\\n\\t\\t\\t\\tnormalizedMessage.file?.type,\\n\\t\\t\\t);\\n\\t\\t}\\n\\n\\t\\treturn normalizedMessage;\\n\\t}, [showColors, customDomains, katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled, message, autoTranslateOptions]);\\n};\\n\",null],\"names\":[\"_objectSpread\",\"Base64\",\"isFileImageAttachment\",\"isFileAttachment\",\"isFileAudioAttachment\",\"isFileVideoAttachment\",\"isQuoteAttachment\",\"useSetting\",\"useMemo\",\"parseMessageTextToAstMarkdown\",\"useAutoLinkDomains\",\"useAutoTranslate\",\"useKatex\",\"useSubscriptionFromMessageQuery\",\"module\",\"link\",\"default\",\"v\",\"export\",\"useNormalizedMessage\",\"normalizeAttachments\",\"attachments\",\"name\",\"type\",\"String\",\"fromCharCode\",\"TextEncoder\",\"encode\",\"map\",\"attachment\",\"encryption\",\"key\",\"JSON\",\"stringify\",\"title_link\",\"startsWith\",\"concat\",\"image_url\",\"audio_url\",\"video_url\",\"message\",\"_useSubscriptionFromM\",\"katexEnabled\",\"katexDollarSyntaxEnabled\",\"katexParenthesisSyntaxEnabled\",\"customDomains\",\"subscription\",\"data\",\"undefined\",\"autoTranslateOptions\",\"showColors\",\"parseOptions\",\"colors\",\"emoticons\",\"katex\",\"dollarSyntax\",\"parenthesisSyntax\",\"normalizedMessage\",\"_normalizedMessage$fi\",\"_normalizedMessage$fi2\",\"file\"],\"mappings\":\"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\"}"}