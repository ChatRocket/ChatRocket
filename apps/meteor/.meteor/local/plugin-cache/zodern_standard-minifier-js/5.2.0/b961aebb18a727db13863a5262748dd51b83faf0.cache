{"code":"function module(e,n,r){r.export({usersFromRoomMessages:function(){return c}}),r.link(\"meteor/meteor\",{Meteor:function(e){t=e}},0),r.link(\"meteor/mongo\",{Mongo:function(e){o=e}},1),r.link(\"meteor/tracker\",{Tracker:function(e){u=e}},2),r.link(\"../../../../client/lib/RoomManager\",{RoomManager:function(e){i=e}},3),r.link(\"../../../../client/lib/tracker\",{asReactiveSource:function(e){s=e}},4),r.link(\"../../../models/client\",{Messages:function(e){a=e}},5);var t,o,u,i,s,a,c=new o.Collection(null);t.startup(function(){u.autorun(function(){var e=t.userId(),n=s(function(e){return i.on(\"changed\",e)},function(){return i.opened}),r=e?t.users.findOne(e,{fields:{username:1}}):void 0;if(n&&r){c.remove({});var o={};a.find({rid:n,\"u.username\":{$ne:r.username},t:{$exists:!1}},{fields:{\"u.username\":1,\"u.name\":1,\"u._id\":1,ts:1},sort:{ts:-1}}).fetch().filter(function(e){var n=e.u.username,r=!o[n];return o[n]=!0,r}).forEach(function(e){var n=e.u,r=n.username,t=n.name,o=n._id,u=e.ts;return c.upsert(o,{_id:o,username:r,name:t,ts:u})})}})})}","map":"{\"version\":3,\"sources\":[\"app/ui-message/client/popup/messagePopupConfig.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IUser } from '@rocket.chat/core-typings';\\nimport { Meteor } from 'meteor/meteor';\\nimport { Mongo } from 'meteor/mongo';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { RoomManager } from '../../../../client/lib/RoomManager';\\nimport { asReactiveSource } from '../../../../client/lib/tracker';\\nimport { Messages } from '../../../models/client';\\n\\nexport const usersFromRoomMessages = new Mongo.Collection<{\\n\\t_id: string;\\n\\tusername: string;\\n\\tname: string | undefined;\\n\\tts: Date;\\n\\tsuggestion?: boolean;\\n}>(null);\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(() => {\\n\\t\\tconst uid = Meteor.userId();\\n\\t\\tconst rid = asReactiveSource(\\n\\t\\t\\t(cb) => RoomManager.on('changed', cb),\\n\\t\\t\\t() => RoomManager.opened,\\n\\t\\t);\\n\\t\\tconst user = uid ? (Meteor.users.findOne(uid, { fields: { username: 1 } }) as IUser | undefined) : undefined;\\n\\t\\tif (!rid || !user) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tusersFromRoomMessages.remove({});\\n\\n\\t\\tconst uniqueMessageUsersControl: Record<string, boolean> = {};\\n\\n\\t\\tMessages.find(\\n\\t\\t\\t{\\n\\t\\t\\t\\trid,\\n\\t\\t\\t\\t'u.username': { $ne: user.username },\\n\\t\\t\\t\\t't': { $exists: false },\\n\\t\\t\\t},\\n\\t\\t\\t{\\n\\t\\t\\t\\tfields: {\\n\\t\\t\\t\\t\\t'u.username': 1,\\n\\t\\t\\t\\t\\t'u.name': 1,\\n\\t\\t\\t\\t\\t'u._id': 1,\\n\\t\\t\\t\\t\\t'ts': 1,\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\tsort: { ts: -1 },\\n\\t\\t\\t},\\n\\t\\t)\\n\\t\\t\\t.fetch()\\n\\t\\t\\t.filter(({ u: { username } }) => {\\n\\t\\t\\t\\tconst notMapped = !uniqueMessageUsersControl[username];\\n\\t\\t\\t\\tuniqueMessageUsersControl[username] = true;\\n\\t\\t\\t\\treturn notMapped;\\n\\t\\t\\t})\\n\\t\\t\\t.forEach(({ u: { username, name, _id }, ts }) =>\\n\\t\\t\\t\\tusersFromRoomMessages.upsert(_id, {\\n\\t\\t\\t\\t\\t_id,\\n\\t\\t\\t\\t\\tusername,\\n\\t\\t\\t\\t\\tname,\\n\\t\\t\\t\\t\\tts,\\n\\t\\t\\t\\t}),\\n\\t\\t\\t);\\n\\t});\\n});\\n\",null],\"names\":[\"module\",\"export\",\"usersFromRoomMessages\",\"link\",\"Meteor\",\"v\",\"Mongo\",\"Tracker\",\"RoomManager\",\"asReactiveSource\",\"Messages\",\"Collection\",\"startup\",\"autorun\",\"uid\",\"userId\",\"rid\",\"cb\",\"on\",\"opened\",\"user\",\"users\",\"findOne\",\"fields\",\"username\",\"undefined\",\"remove\",\"uniqueMessageUsersControl\",\"find\",\"$ne\",\"$exists\",\"sort\",\"ts\",\"fetch\",\"filter\",\"_ref\",\"u\",\"notMapped\",\"forEach\",\"_ref2\",\"_ref2$u\",\"name\",\"_id\",\"upsert\"],\"mappings\":\"uBACAA,EAAOC,MAAE,CAAA,CAAMC,sBAAQ,WAAgB,OAAAA,CAAA,CAAA,GAAAF,EAAAG,IAAA,CAAA,gBAAA,CAAAC,OAAA,SAAAC,CAAA,EAAAD,EAAAC,CAAA,CAAA,EAAA,GAAAL,EAAAG,IAAA,CAAA,eAAA,CAAAG,MAAA,SAAAD,CAAA,EAAAC,EAAAD,CAAA,CAAA,EAAA,GAAAL,EAAAG,IAAA,CAAA,iBAAA,CAAAI,QAAA,SAAAF,CAAA,EAAAE,EAAAF,CAAA,CAAA,EAAA,GAAAL,EAAAG,IAAA,CAAA,qCAAA,CAAAK,YAAA,SAAAH,CAAA,EAAAG,EAAAH,CAAA,CAAA,EAAA,GAAAL,EAAAG,IAAA,CAAA,iCAAA,CAAAM,iBAAA,SAAAJ,CAAA,EAAAI,EAAAJ,CAAA,CAAA,EAAA,GAAAL,EAAAG,IAAA,CAAA,yBAAA,CAAAO,SAAA,SAAAL,CAAA,EAAAK,EAAAL,CAAA,CAAA,EAAA,GAQhC,IARgCD,EAAAE,EAAAC,EAAAC,EAAAC,EAAAC,EAQ1BR,EAAwB,IAAII,EAAMK,UAAU,CAMtD,MAEHP,EAAOQ,OAAO,CAAC,WACdL,EAAQM,OAAO,CAAC,WACf,IAAMC,EAAMV,EAAOW,MAAM,GACnBC,EAAMP,EACX,SAACQ,CAAE,EAAA,OAAKT,EAAYU,EAAE,CAAC,UAAWD,EAAG,EACrC,WAAA,OAAMT,EAAYW,MAAM,GAEnBC,EAAON,EAAOV,EAAOiB,KAAK,CAACC,OAAO,CAACR,EAAK,CAAES,OAAQ,CAAEC,SAAU,CAAC,CAAE,GAA4BC,KAAAA,EACnG,GAAI,AAACT,GAAQI,GAIblB,EAAsBwB,MAAM,CAAC,CAAA,GAE7B,IAAMC,EAAqD,CAAA,EAE3DjB,EAASkB,IAAI,CACZ,CACCZ,IAAAA,EACA,aAAc,CAAEa,IAAKT,EAAKI,QAAAA,AAAQ,EAClC,EAAK,CAAEM,QAAS,CAAA,CAAK,GAEtB,CACCP,OAAQ,CACP,aAAc,EACd,SAAU,EACV,QAAS,EACT,GAAM,GAEPQ,KAAM,CAAEC,GAAI,EAAE,IAGdC,KAAK,GACLC,MAAM,CAAC,SAAAC,CAAA,EAAwB,IAAhBX,EAAQW,EAAbC,CAAC,CAAIZ,QAAQ,CACjBa,EAAY,CAACV,CAAyB,CAACH,EAAS,CAEtD,OADAG,CAAyB,CAACH,EAAS,CAAG,CAAA,EAC/Ba,CACR,GACCC,OAAO,CAAC,SAAAC,CAAA,EAAA,IAAAC,EAAAD,EAAGH,CAAC,CAAIZ,EAAQgB,EAARhB,QAAQ,CAAEiB,EAAID,EAAJC,IAAI,CAAEC,EAAGF,EAAHE,GAAG,CAAIV,EAAEO,EAAFP,EAAE,CAAA,OACzC9B,EAAsByC,MAAM,CAACD,EAAK,CACjCA,IAAAA,EACAlB,SAAAA,EACAiB,KAAAA,EACAT,GAAAA,GACC,GAEL,EACD\"}"}