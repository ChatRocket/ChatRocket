{"code":"function module(e,t,n){n.link(\"@babel/runtime/regenerator\",{default:function(e){r=e}},0),n.link(\"@babel/runtime/helpers/inheritsLoose\",{default:function(e){s=e}},1),n.export({EEVoipClient:function(){return l}}),n.link(\"@rocket.chat/core-typings\",{Operation:function(e){i=e},UserState:function(e){a=e}},0),n.link(\"sip.js\",{Inviter:function(e){o=e},UserAgent:function(e){c=e}},1),n.link(\"./VoIPUser\",{VoIPUser:function(e){u=e}},2);var r,s,i,a,o,c,u,l=function(e){function t(t,n){return e.call(this,t,n)||this}s(t,e);var n=t.prototype;return n.makeCallURI=function(e,t){var n,s,u,l,h=this;return r.async(function(f){for(;;)switch(f.prev=f.next){case 0:if(t&&(this.mediaStreamRendered=t),!this.session){f.next=3;break}throw Error(\"Session exists\");case 3:if(this.userAgent){f.next=5;break}throw Error(\"No User Agent.\");case 5:if(!(\"REGISTERED\"!==this.callState)){f.next=7;break}throw Error(\"Incorrect UA state\");case 7:if(n=c.makeURI(e)){f.next=10;break}throw Error(\"Failed to create valid URI \"+e);case 10:return s={sessionDescriptionHandlerOptions:{constraints:{audio:!0,video:!1}}},u=new o(this.userAgent,n,s),this.session=u,this.setupSessionEventHandlers(u),this._opInProgress=i.OP_SEND_INVITE,f.next=18,r.awrap(u.invite({requestDelegate:{onReject:function(e){e.message.reasonPhrase&&h.emit(\"callfailed\",e.message.reasonPhrase||\"unknown\")}}}));case 18:this._callState=\"OFFER_SENT\",l={callerId:u.remoteIdentity.uri.user?u.remoteIdentity.uri.user:\"\",callerName:u.remoteIdentity.displayName,host:u.remoteIdentity.uri.host},this._callerInfo=l,this._userState=a.UAC,this.emit(\"stateChanged\");case 23:case\"end\":return f.stop()}},null,this,null,Promise)},n.makeCall=function(e){var t,n;return r.async(function(r){for(;;)switch(r.prev=r.next){case 0:t=e.includes(\"+\"),n=e.replace(\"+\",\"\"),this.makeCallURI(\"sip:\"+(t?\"*\":\"\")+n+\"@\"+this.userConfig.sipRegistrarHostnameOrIP);case 3:case\"end\":return r.stop()}},null,this,null,Promise)},t.create=function(e,n){var s;return r.async(function(i){for(;;)switch(i.prev=i.next){case 0:return s=new t(e,n),i.next=3,r.awrap(s.init());case 3:return i.abrupt(\"return\",s);case 4:case\"end\":return i.stop()}},null,null,null,Promise)},t}(u)}","map":"{\"version\":3,\"sources\":[\"client/lib/voip/EEVoipClient.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { ICallerInfo, IMediaStreamRenderer, VoIPUserConfiguration } from '@rocket.chat/core-typings';\\nimport { Operation, UserState } from '@rocket.chat/core-typings';\\nimport { Inviter, UserAgent } from 'sip.js';\\nimport type { IncomingResponse } from 'sip.js/lib/core';\\n\\nimport { VoIPUser } from './VoIPUser';\\n\\nexport class EEVoipClient extends VoIPUser {\\n\\tconstructor(config: VoIPUserConfiguration, mediaRenderer?: IMediaStreamRenderer) {\\n\\t\\tsuper(config, mediaRenderer);\\n\\t}\\n\\n\\tasync makeCallURI(calleeURI: string, mediaRenderer?: IMediaStreamRenderer): Promise<void> {\\n\\t\\tif (mediaRenderer) {\\n\\t\\t\\tthis.mediaStreamRendered = mediaRenderer;\\n\\t\\t}\\n\\t\\tif (this.session) {\\n\\t\\t\\tthrow new Error('Session exists');\\n\\t\\t}\\n\\t\\tif (!this.userAgent) {\\n\\t\\t\\tthrow new Error('No User Agent.');\\n\\t\\t}\\n\\t\\tif (this.callState !== 'REGISTERED') {\\n\\t\\t\\tthrow new Error('Incorrect UA state');\\n\\t\\t}\\n\\t\\tconst target = UserAgent.makeURI(calleeURI);\\n\\t\\tif (!target) {\\n\\t\\t\\tthrow new Error(`Failed to create valid URI ${calleeURI}`);\\n\\t\\t}\\n\\t\\t// Replace this when device manager code is ready.\\n\\t\\tconst constraints = {\\n\\t\\t\\taudio: true,\\n\\t\\t\\tvideo: false,\\n\\t\\t};\\n\\t\\tconst inviterOptions = {\\n\\t\\t\\tsessionDescriptionHandlerOptions: { constraints },\\n\\t\\t};\\n\\t\\t// Create a new Inviter for the outgoing Session\\n\\t\\tconst inviter = new Inviter(this.userAgent, target, inviterOptions);\\n\\t\\tthis.session = inviter;\\n\\t\\tthis.setupSessionEventHandlers(inviter);\\n\\t\\tthis._opInProgress = Operation.OP_SEND_INVITE;\\n\\n\\t\\tawait inviter.invite({\\n\\t\\t\\trequestDelegate: {\\n\\t\\t\\t\\tonReject: (response: IncomingResponse): void => {\\n\\t\\t\\t\\t\\tif (response.message.reasonPhrase) {\\n\\t\\t\\t\\t\\t\\tthis.emit('callfailed', response.message.reasonPhrase || 'unknown');\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t},\\n\\t\\t\\t},\\n\\t\\t});\\n\\n\\t\\tthis._callState = 'OFFER_SENT';\\n\\t\\tconst callerInfo: ICallerInfo = {\\n\\t\\t\\tcallerId: inviter.remoteIdentity.uri.user ? inviter.remoteIdentity.uri.user : '',\\n\\t\\t\\tcallerName: inviter.remoteIdentity.displayName,\\n\\t\\t\\thost: inviter.remoteIdentity.uri.host,\\n\\t\\t};\\n\\t\\tthis._callerInfo = callerInfo;\\n\\t\\tthis._userState = UserState.UAC;\\n\\t\\tthis.emit('stateChanged');\\n\\t}\\n\\n\\tasync makeCall(calleeNumber: string): Promise<void> {\\n\\t\\tconst hasPlusChar = calleeNumber.includes('+');\\n\\n\\t\\tconst digits = calleeNumber.replace('+', '');\\n\\t\\tthis.makeCallURI(`sip:${hasPlusChar ? '*' : ''}${digits}@${this.userConfig.sipRegistrarHostnameOrIP}`);\\n\\t}\\n\\n\\tstatic async create(config: VoIPUserConfiguration, mediaRenderer?: IMediaStreamRenderer): Promise<VoIPUser> {\\n\\t\\tconst voip = new EEVoipClient(config, mediaRenderer);\\n\\t\\tawait voip.init();\\n\\t\\treturn voip;\\n\\t}\\n}\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"_inheritsLoose\",\"export\",\"EEVoipClient\",\"Operation\",\"UserState\",\"Inviter\",\"UserAgent\",\"VoIPUser\",\"_VoIPUser\",\"config\",\"mediaRenderer\",\"call\",\"_proto\",\"prototype\",\"makeCallURI\",\"calleeURI\",\"target\",\"inviterOptions\",\"inviter\",\"callerInfo\",\"_this\",\"async\",\"_context\",\"prev\",\"next\",\"mediaStreamRendered\",\"session\",\"Error\",\"userAgent\",\"callState\",\"makeURI\",\"sessionDescriptionHandlerOptions\",\"constraints\",\"audio\",\"video\",\"setupSessionEventHandlers\",\"_opInProgress\",\"OP_SEND_INVITE\",\"awrap\",\"invite\",\"requestDelegate\",\"onReject\",\"response\",\"message\",\"reasonPhrase\",\"emit\",\"_callState\",\"callerId\",\"remoteIdentity\",\"uri\",\"user\",\"callerName\",\"displayName\",\"host\",\"_callerInfo\",\"_userState\",\"UAC\",\"stop\",\"Promise\",\"makeCall\",\"calleeNumber\",\"hasPlusChar\",\"digits\",\"_context2\",\"includes\",\"replace\",\"userConfig\",\"sipRegistrarHostnameOrIP\",\"create\",\"voip\",\"_context3\",\"init\",\"abrupt\"],\"mappings\":\"uBACoBA,EAAWC,IAAA,CAAA,6BAAkC,CAAAC,QAAA,SAAAC,CAAA,EAAAC,EAAAD,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAC,QAAA,SAAAC,CAAA,EAAAE,EAAAF,CAAA,CAAA,EAAA,GAAjEH,EAAOM,MAAE,CAAA,CAAAC,aAAW,WAAiB,OAAAA,CAAA,CAAA,GAA4BP,EAAAC,IAAA,CAAA,4BAAA,CAAAO,UAAA,SAAAL,CAAA,EAAAK,EAAAL,CAAA,EAAAM,UAAA,SAAAN,CAAA,EAAAM,EAAAN,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,SAAA,CAAAS,QAAA,SAAAP,CAAA,EAAAO,EAAAP,CAAA,EAAAQ,UAAA,SAAAR,CAAA,EAAAQ,EAAAR,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,aAAA,CAAAW,SAAA,SAAAT,CAAA,EAAAS,EAAAT,CAAA,CAAA,EAAA,GAAA,IAAjEC,EAAiEC,EAAAG,EAAAC,EAAAC,EAAAC,EAAAC,EAMpDL,EAAa,SAAAM,CAAA,EACzB,SAAAN,EAAYO,CAA6B,CAAEC,CAAoC,EAAA,OAC9EF,EAAAG,IAAA,CAAA,IAAA,CAAMF,EAAQC,IAAc,IAAA,AAC7B,CAACV,EAAAE,EAAAM,GAAA,IAAAI,EAAAV,EAAAW,SAAA,CAiEA,OAjEAD,EAEKE,WAAW,CAAjB,SAAkBC,CAAiB,CAAEL,CAAoC,EAAA,IAAAM,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,IAAA,CAAA,OAAArB,EAAAsB,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAGvE,GAFGd,GACH,CAAA,IAAI,CAACe,mBAAmB,CAAGf,CAAAA,EAC3B,CACG,IAAI,CAACgB,OAAO,CAAA,CAAAJ,EAAAE,IAAA,CAAA,EAAA,KAAA,CAAA,MACT,AAAIG,MAAM,iBAAiB,MAAA,EAAA,GAE7B,IAAI,CAACC,SAAS,CAAA,CAAAN,EAAAE,IAAA,CAAA,EAAA,KAAA,CAAA,MACZ,AAAIG,MAAM,iBAAiB,MAAA,EAAA,GAAA,CAE9B,CAAA,AAAmB,eAAnB,IAAI,CAACE,SAAS,AAAK,EAAY,CAAAP,EAAAE,IAAA,CAAA,EAAA,KAAA,CAAA,MAC5B,AAAIG,MAAM,qBAAqB,MAAA,EAEK,GAArCX,EAASV,EAAUwB,OAAO,CAACf,GACtB,CAAAO,EAAAE,IAAA,CAAA,GAAA,KAAA,CAAA,MACJ,AAAIG,MAAK,8BAA+BZ,EAAY,MAAA,GAcb,OAPxCE,EAAiB,CACtBc,iCAAkC,CAAEC,YALjB,CACnBC,MAAO,CAAA,EACPC,MAAO,CAAA,EAGwC,GAG1ChB,EAAU,IAAIb,EAAQ,IAAI,CAACuB,SAAS,CAAEZ,EAAQC,GACpD,IAAI,CAACS,OAAO,CAAGR,EACf,IAAI,CAACiB,yBAAyB,CAACjB,GAC/B,IAAI,CAACkB,aAAa,CAAGjC,EAAUkC,cAAc,CAACf,EAAAE,IAAA,CAAA,GAAAzB,EAAAuC,KAAA,CAExCpB,EAAQqB,MAAM,CAAC,CACpBC,gBAAiB,CAChBC,SAAU,SAACC,CAA0B,EAChCA,EAASC,OAAO,CAACC,YAAY,EAChCxB,EAAKyB,IAAI,CAAC,aAAcH,EAASC,OAAO,CAACC,YAAY,EAAI,UAE3D,KAEA,MAAA,GAEF,IAAI,CAACE,UAAU,CAAG,aACZ3B,EAA0B,CAC/B4B,SAAU7B,EAAQ8B,cAAc,CAACC,GAAG,CAACC,IAAI,CAAGhC,EAAQ8B,cAAc,CAACC,GAAG,CAACC,IAAI,CAAG,GAC9EC,WAAYjC,EAAQ8B,cAAc,CAACI,WAAW,CAC9CC,KAAMnC,EAAQ8B,cAAc,CAACC,GAAG,CAACI,IAAAA,EAElC,IAAI,CAACC,WAAW,CAAGnC,EACnB,IAAI,CAACoC,UAAU,CAAGnD,EAAUoD,GAAG,CAC/B,IAAI,CAACX,IAAI,CAAC,eAAgB,MAAA,GAAA,IAAA,MAAA,OAAAvB,EAAAmC,IAAA,EAAA,CAAA,EAAA,KAAA,IAAA,CAAA,KAAAC,QAAA,EAC1B9C,EAEK+C,QAAQ,CAAd,SAAeC,CAAoB,EAAA,IAAAC,EAAAC,EAAA,OAAA/D,EAAAsB,KAAA,CAAA,SAAA0C,CAAA,EAAA,OAAA,OAAAA,EAAAxC,IAAA,CAAAwC,EAAAvC,IAAA,EAAA,KAAA,EAC5BqC,EAAcD,EAAaI,QAAQ,CAAC,KAEpCF,EAASF,EAAaK,OAAO,CAAC,IAAK,IACzC,IAAI,CAACnD,WAAW,CAAA,OAAQ+C,CAAAA,EAAc,IAAM,EAAA,EAAKC,EAAM,IAAI,IAAI,CAACI,UAAU,CAACC,wBAA0B,CAAE,MAAA,EAAA,IAAA,MAAA,OAAAJ,EAAAN,IAAA,EAAA,CAAA,EAAA,KAAA,IAAA,CAAA,KAAAC,QAAA,EACvGxD,EAEYkE,MAAM,CAAnB,SAAoB3D,CAA6B,CAAEC,CAAoC,EAAA,IAAA2D,EAAA,OAAAtE,EAAAsB,KAAA,CAAA,SAAAiD,CAAA,EAAA,OAAA,OAAAA,EAAA/C,IAAA,CAAA+C,EAAA9C,IAAA,EAAA,KAAA,EAClC,OAA9C6C,EAAO,IAAInE,EAAaO,EAAQC,GAAc4D,EAAA9C,IAAA,CAAA,EAAAzB,EAAAuC,KAAA,CAC9C+B,EAAKE,IAAI,GAAE,MAAA,EAAA,OAAAD,EAAAE,MAAA,CAAA,SACVH,EAAI,MAAA,EAAA,IAAA,MAAA,OAAAC,EAAAb,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,EACXxD,CAAA,EApEgCK\"}"}