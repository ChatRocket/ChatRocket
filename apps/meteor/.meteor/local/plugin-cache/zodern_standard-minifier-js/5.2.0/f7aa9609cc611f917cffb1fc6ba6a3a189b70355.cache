{"code":"function module(e,t,r){let i,o,l,s,n,a,c,u,m,h,d,k,f;r.link(\"@rocket.chat/emitter\",{Emitter(e){i=e}},0),r.link(\"@rocket.chat/ui-contexts\",{AuthorizationContext(e){o=e}},1),r.link(\"meteor/meteor\",{Meteor(e){l=e}},2),r.link(\"react\",{default(e){s=e},useCallback(e){n=e},useEffect(e){a=e}},3),r.link(\"../../app/authorization/client\",{hasPermission(e){c=e},hasAtLeastOnePermission(e){u=e},hasAllPermission(e){m=e},hasRole(e){h=e}},4),r.link(\"../../app/models/client/models/Roles\",{Roles(e){d=e}},5),r.link(\"../hooks/useReactiveValue\",{useReactiveValue(e){k=e}},6),r.link(\"../lib/createReactiveSubscriptionFactory\",{createReactiveSubscriptionFactory(e){f=e}},7);let p={queryPermission:f((e,t,r)=>c(e,t,r)),queryAtLeastOnePermission:f((e,t)=>u(e,t)),queryAllPermissions:f((e,t)=>m(e,t)),queryRole:f(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!!l.userId()&&h(l.userId(),e,t,r)}),roleStore:new class e extends i{constructor(){super(...arguments),this.roles={}}}};r.exportDefault(e=>{let{children:t}=e,r=k(n(()=>d.find().fetch().reduce((e,t)=>(e[t._id]=t,e),{}),[]));return a(()=>{p.roleStore.roles=r,p.roleStore.emit(\"change\",r)},[r]),s.createElement(o.Provider,{children:t,value:p})})}","map":"{\"version\":3,\"sources\":[\"client/providers/AuthorizationProvider.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { IRole } from '@rocket.chat/core-typings';\\nimport { Emitter } from '@rocket.chat/emitter';\\nimport { AuthorizationContext } from '@rocket.chat/ui-contexts';\\nimport { Meteor } from 'meteor/meteor';\\nimport type { ReactNode } from 'react';\\nimport React, { useCallback, useEffect } from 'react';\\n\\nimport { hasPermission, hasAtLeastOnePermission, hasAllPermission, hasRole } from '../../app/authorization/client';\\nimport { Roles } from '../../app/models/client/models/Roles';\\nimport { useReactiveValue } from '../hooks/useReactiveValue';\\nimport { createReactiveSubscriptionFactory } from '../lib/createReactiveSubscriptionFactory';\\n\\nclass RoleStore extends Emitter<{\\n\\tchange: { [_id: string]: IRole };\\n}> {\\n\\troles: { [_id: string]: IRole } = {};\\n}\\n\\nconst contextValue = {\\n\\tqueryPermission: createReactiveSubscriptionFactory((permission, scope, scopeRoles) => hasPermission(permission, scope, scopeRoles)),\\n\\tqueryAtLeastOnePermission: createReactiveSubscriptionFactory((permissions, scope) => hasAtLeastOnePermission(permissions, scope)),\\n\\tqueryAllPermissions: createReactiveSubscriptionFactory((permissions, scope) => hasAllPermission(permissions, scope)),\\n\\tqueryRole: createReactiveSubscriptionFactory(\\n\\t\\t(role, scope?, ignoreSubscriptions = false) =>\\n\\t\\t\\t!!Meteor.userId() && hasRole(Meteor.userId() as string, role, scope, ignoreSubscriptions),\\n\\t),\\n\\troleStore: new RoleStore(),\\n};\\n\\ntype AuthorizationProviderProps = {\\n\\tchildren?: ReactNode;\\n};\\n\\nconst AuthorizationProvider = ({ children }: AuthorizationProviderProps) => {\\n\\tconst roles = useReactiveValue(\\n\\t\\tuseCallback(\\n\\t\\t\\t() =>\\n\\t\\t\\t\\tRoles.find()\\n\\t\\t\\t\\t\\t.fetch()\\n\\t\\t\\t\\t\\t.reduce((ret, obj) => {\\n\\t\\t\\t\\t\\t\\tret[obj._id] = obj;\\n\\t\\t\\t\\t\\t\\treturn ret;\\n\\t\\t\\t\\t\\t}, {} as Record<string, IRole>),\\n\\t\\t\\t[],\\n\\t\\t),\\n\\t);\\n\\n\\tuseEffect(() => {\\n\\t\\tcontextValue.roleStore.roles = roles;\\n\\t\\tcontextValue.roleStore.emit('change', roles);\\n\\t}, [roles]);\\n\\n\\treturn <AuthorizationContext.Provider children={children} value={contextValue} />;\\n};\\n\\nexport default AuthorizationProvider;\\n\",null],\"names\":[\"Emitter\",\"AuthorizationContext\",\"Meteor\",\"React\",\"useCallback\",\"useEffect\",\"hasPermission\",\"hasAtLeastOnePermission\",\"hasAllPermission\",\"hasRole\",\"Roles\",\"useReactiveValue\",\"createReactiveSubscriptionFactory\",\"module\",\"link\",\"v\",\"default\",\"contextValue\",\"queryPermission\",\"permission\",\"scope\",\"scopeRoles\",\"queryAtLeastOnePermission\",\"permissions\",\"queryAllPermissions\",\"queryRole\",\"role\",\"ignoreSubscriptions\",\"arguments\",\"length\",\"undefined\",\"userId\",\"roleStore\",\"RoleStore\",\"constructor\",\"roles\",\"exportDefault\",\"_ref\",\"children\",\"find\",\"fetch\",\"reduce\",\"ret\",\"obj\",\"_id\",\"emit\",\"createElement\",\"Provider\",\"value\"],\"mappings\":\"2BACAA,EAA+CC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAtCC,EAASC,IAAA,CAAM,uBAAuB,CAAAd,QAAAe,CAAA,EAAAf,EAAAe,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,2BAAA,CAAAb,qBAAAc,CAAA,EAAAd,EAAAc,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,gBAAA,CAAAZ,OAAAa,CAAA,EAAAb,EAAAa,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,QAAA,CAAAE,QAAAD,CAAA,EAAAZ,EAAAY,CAAA,EAAAX,YAAAW,CAAA,EAAAX,EAAAW,CAAA,EAAAV,UAAAU,CAAA,EAAAV,EAAAU,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,iCAAA,CAAAR,cAAAS,CAAA,EAAAT,EAAAS,CAAA,EAAAR,wBAAAQ,CAAA,EAAAR,EAAAQ,CAAA,EAAAP,iBAAAO,CAAA,EAAAP,EAAAO,CAAA,EAAAN,QAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,uCAAA,CAAAJ,MAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,4BAAA,CAAAH,iBAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,2CAAA,CAAAF,kCAAAG,CAAA,EAAAH,EAAAG,CAAA,CAAA,EAAA,GAiB/C,IAAME,EAAe,CACpBC,gBAAiBN,EAAkC,CAACO,EAAYC,EAAOC,IAAef,EAAca,EAAYC,EAAOC,IACvHC,0BAA2BV,EAAkC,CAACW,EAAaH,IAAUb,EAAwBgB,EAAaH,IAC1HI,oBAAqBZ,EAAkC,CAACW,EAAaH,IAAUZ,EAAiBe,EAAaH,IAC7GK,UAAWb,EACV,SAACc,CAAI,CAAEN,CAAM,EAAA,IAAEO,EAAmBC,UAAAC,MAAA,CAAA,GAAAD,AAAAE,KAAAA,IAAAF,SAAA,CAAA,EAAA,EAAAA,SAAA,CAAA,EAAA,CAAQ,MACzC,CAAC,CAAC1B,EAAO6B,MAAM,IAAMtB,EAAQP,EAAO6B,MAAM,GAAcL,EAAMN,EAAOO,EAAoB,GAE3FK,UAAW,IAdZ,MAAMC,UAAkBjC,EAEtBkC,aAAA,CAAA,KAAA,IAAAN,WAAA,IAAA,CACDO,KAAK,CAA6B,CAAA,CAAE,IAdrCtB,EAAOuB,aAAW,CAgCYC,IAA6C,GAA5C,CAAEC,SAAAA,CAAAA,CAAsC,CAAAD,EAChEF,EAAQxB,EACbP,EACC,IACCM,EAAM6B,IAAI,GACRC,KAAK,GACLC,MAAM,CAAC,CAACC,EAAKC,KACbD,CAAG,CAACC,EAAIC,GAAG,CAAC,CAAGD,EACRD,GACL,CAAA,GACL,EAAE,GASJ,OALArC,EAAU,KACTY,EAAae,SAAS,CAACG,KAAK,CAAGA,EAC/BlB,EAAae,SAAS,CAACa,IAAI,CAAC,SAAUV,EACvC,EAAG,CAACA,EAAM,EAEHhC,EAAA2C,aAAA,CAAC7C,EAAqB8C,QAAQ,CAAA,CAACT,SAAUA,EAAUU,MAAO/B,CAAa,EAC/E\"}"}