{"code":"function module(e,t,a){let n,s,i,r,l,u,c,o,p;a.export({useTranslationsForApps:()=>d}),a.link(\"@rocket.chat/tools\",{normalizeLanguage(e){n=e}},0),a.link(\"@rocket.chat/ui-contexts\",{useEndpoint(e){s=e},useStream(e){i=e},useUserId(e){r=e}},1),a.link(\"@tanstack/react-query\",{useQuery(e){l=e},useQueryClient(e){u=e}},2),a.link(\"react\",{useEffect(e){c=e}},3),a.link(\"react-i18next\",{useTranslation(e){o=e}},4),a.link(\"../../lib/utils/highOrderFunctions\",{withDebouncing(e){p=e}},5);let d=()=>{let e=s(\"GET\",\"/apps/languages\"),{isSuccess:t,data:a}=l({queryKey:[\"apps\",\"translations\"],queryFn:()=>e(),staleTime:1/0}),{i18n:d}=o();c(()=>{t&&a.apps.forEach(e=>{let{id:t,languages:a}=e;Object.entries(a).forEach(e=>{let[a,s]=e,i=n(a),r=\"app-\".concat(t);d.addResourceBundle(i,r,s)})})},[d,a,t]);let k=u(),h=i(\"apps\"),f=r();c(()=>{if(!f)return;let e=p({wait:100})(()=>{k.invalidateQueries([\"apps\",\"translations\"])}),t=h(\"apps\",t=>{let[a]=t;\"app/added\"===a&&e()});return()=>{t(),e.cancel()}},[f,h,k])}}","map":"{\"version\":3,\"sources\":[\"client/hooks/useTranslationsForApps.ts\",\"<anon>\"],\"sourcesContent\":[\"import { normalizeLanguage } from '@rocket.chat/tools';\\nimport { useEndpoint, useStream, useUserId } from '@rocket.chat/ui-contexts';\\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\\nimport { useEffect } from 'react';\\nimport { useTranslation } from 'react-i18next';\\n\\nimport { withDebouncing } from '../../lib/utils/highOrderFunctions';\\n\\nexport const useTranslationsForApps = () => {\\n\\tconst getAppsLanguages = useEndpoint('GET', '/apps/languages');\\n\\n\\tconst { isSuccess, data } = useQuery({\\n\\t\\tqueryKey: ['apps', 'translations'] as const,\\n\\t\\tqueryFn: () => getAppsLanguages(),\\n\\t\\tstaleTime: Infinity,\\n\\t});\\n\\n\\tconst { i18n } = useTranslation();\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!isSuccess) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tdata.apps.forEach(({ id: appId, languages }) => {\\n\\t\\t\\tObject.entries(languages).forEach(([language, translations]) => {\\n\\t\\t\\t\\tconst normalizedLanguage = normalizeLanguage(language);\\n\\t\\t\\t\\tconst namespace = `app-${appId}`;\\n\\t\\t\\t\\ti18n.addResourceBundle(normalizedLanguage, namespace, translations);\\n\\t\\t\\t});\\n\\t\\t});\\n\\t}, [i18n, data, isSuccess]);\\n\\n\\tconst queryClient = useQueryClient();\\n\\tconst subscribeToApps = useStream('apps');\\n\\tconst uid = useUserId();\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!uid) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst invalidate = withDebouncing({ wait: 100 })(() => {\\n\\t\\t\\tqueryClient.invalidateQueries(['apps', 'translations']);\\n\\t\\t});\\n\\n\\t\\tconst unsubscribe = subscribeToApps('apps', ([key]) => {\\n\\t\\t\\tif (key === 'app/added') {\\n\\t\\t\\t\\tinvalidate();\\n\\t\\t\\t}\\n\\t\\t});\\n\\n\\t\\treturn () => {\\n\\t\\t\\tunsubscribe();\\n\\t\\t\\tinvalidate.cancel();\\n\\t\\t};\\n\\t}, [uid, subscribeToApps, queryClient]);\\n};\\n\",null],\"names\":[\"normalizeLanguage\",\"useEndpoint\",\"useStream\",\"useUserId\",\"useQuery\",\"useQueryClient\",\"useEffect\",\"useTranslation\",\"withDebouncing\",\"module\",\"export\",\"useTranslationsForApps\",\"link\",\"v\",\"getAppsLanguages\",\"isSuccess\",\"data\",\"queryKey\",\"queryFn\",\"staleTime\",\"Infinity\",\"i18n\",\"apps\",\"forEach\",\"_ref\",\"id\",\"appId\",\"languages\",\"Object\",\"entries\",\"_ref2\",\"language\",\"translations\",\"normalizedLanguage\",\"namespace\",\"concat\",\"addResourceBundle\",\"queryClient\",\"subscribeToApps\",\"uid\",\"invalidate\",\"wait\",\"invalidateQueries\",\"unsubscribe\",\"_ref3\",\"key\",\"cancel\"],\"mappings\":\"2BAAuDA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAvDC,EAAOC,MAAE,CAAA,CAAAC,uBAAyBA,IAAAA,CAAqB,GAAAF,EAAAG,IAAA,CAAA,qBAAA,CAAAZ,kBAAAa,CAAA,EAAAb,EAAAa,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,2BAAA,CAAAX,YAAAY,CAAA,EAAAZ,EAAAY,CAAA,EAAAX,UAAAW,CAAA,EAAAX,EAAAW,CAAA,EAAAV,UAAAU,CAAA,EAAAV,EAAAU,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,wBAAA,CAAAR,SAAAS,CAAA,EAAAT,EAAAS,CAAA,EAAAR,eAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,QAAA,CAAAN,UAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,gBAAA,CAAAL,eAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,qCAAA,CAAAJ,eAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAQhD,IAAMF,EAAyBA,KACrC,IAAMG,EAAmBb,EAAY,MAAO,mBAEtC,CAAEc,UAAAA,CAAS,CAAEC,KAAAA,CAAAA,CAAM,CAAGZ,EAAS,CACpCa,SAAU,CAAC,OAAQ,eAAwB,CAC3CC,QAASA,IAAMJ,IACfK,UAAWC,MAGN,CAAEC,KAAAA,CAAAA,CAAM,CAAGd,IAEjBD,EAAU,KACJS,GAILC,EAAKM,IAAI,CAACC,OAAO,CAACC,IAA6B,GAA5B,CAAEC,GAAIC,CAAK,CAAEC,UAAAA,CAAAA,CAAW,CAAAH,EAC1CI,OAAOC,OAAO,CAACF,GAAWJ,OAAO,CAACO,IAA6B,GAA5B,CAACC,EAAUC,EAAa,CAAAF,EACpDG,EAAqBjC,EAAkB+B,GACvCG,EAAS,OAAAC,MAAA,CAAUT,GACzBL,EAAKe,iBAAiB,CAACH,EAAoBC,EAAWF,EACvD,EACD,EACD,EAAG,CAACX,EAAML,EAAMD,EAAU,EAE1B,IAAMsB,EAAchC,IACdiC,EAAkBpC,EAAU,QAC5BqC,EAAMpC,IAEZG,EAAU,KACT,GAAI,CAACiC,EACJ,OAGD,IAAMC,EAAahC,EAAe,CAAEiC,KAAM,GAAG,GAAI,KAChDJ,EAAYK,iBAAiB,CAAC,CAAC,OAAQ,eAAe,CACvD,GAEMC,EAAcL,EAAgB,OAAQM,IAAU,GAAT,CAACC,EAAI,CAAAD,CACrC,CAAA,cAARC,GACHL,GAEF,GAEA,MAAO,KACNG,IACAH,EAAWM,MAAM,EAClB,CACD,EAAG,CAACP,EAAKD,EAAiBD,EAAY,CACvC\"}"}