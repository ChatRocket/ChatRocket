{"code":"function module(e,n,t){var r,s,i,o,u,a,c,l,f=[\"type\"];t.link(\"@babel/runtime/regenerator\",{default:function(e){r=e}},0),t.link(\"@babel/runtime/helpers/objectWithoutProperties\",{default:function(e){s=e}},1),t.link(\"meteor/meteor\",{Meteor:function(e){i=e}},0),t.link(\"meteor/tracker\",{Tracker:function(e){o=e}},1),t.link(\"../../../authorization/client\",{hasPermission:function(e){u=e}},2),t.link(\"../../../settings/client\",{settings:function(e){a=e}},3),t.link(\"../../../utils/client/lib/SDKClient\",{sdk:function(e){c=e}},4),t.link(\"../collections/CannedResponse\",{CannedResponse:function(e){l=e}},5);var d={changed:function(e){e.type;var n=s(e,f);l.upsert({_id:n._id},n)},removed:function(e){return l.remove({_id:e._id})}};i.startup(function(){o.autorun(function(e){return r.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(i.userId()){n.next=2;break}return n.abrupt(\"return\");case 2:if(a.get(\"Canned_Responses_Enable\")){n.next=4;break}return n.abrupt(\"return\");case 4:if(u(\"view-canned-responses\")){n.next=6;break}return n.abrupt(\"return\");case 6:return o.afterFlush(function(){try{c.stream(\"canned-responses\",[\"canned-responses\"],function(e,n){var t=(n||{}).agentsId;(!Array.isArray(t)||t.includes(i.userId()))&&d[e.type](e)})}catch(e){console.log(e)}}),n.next=9,r.awrap(c.rest.get(\"/v1/canned-responses.get\"));case 9:n.sent.responses.forEach(function(e){return l.insert(e)}),e.stop();case 13:case\"end\":return n.stop()}},null,null,null,Promise)})})}","map":"{\"version\":3,\"sources\":[\"app/canned-responses/client/startup/responses.js\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { hasPermission } from '../../../authorization/client';\\nimport { settings } from '../../../settings/client';\\nimport { sdk } from '../../../utils/client/lib/SDKClient';\\nimport { CannedResponse } from '../collections/CannedResponse';\\n\\nconst events = {\\n\\tchanged: ({ type, ...response }) => {\\n\\t\\tCannedResponse.upsert({ _id: response._id }, response);\\n\\t},\\n\\tremoved: (response) => CannedResponse.remove({ _id: response._id }),\\n};\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(async (c) => {\\n\\t\\tif (!Meteor.userId()) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tif (!settings.get('Canned_Responses_Enable')) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tif (!hasPermission('view-canned-responses')) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tTracker.afterFlush(() => {\\n\\t\\t\\ttry {\\n\\t\\t\\t\\t// TODO: check options\\n\\t\\t\\t\\tsdk.stream('canned-responses', ['canned-responses'], (response, options) => {\\n\\t\\t\\t\\t\\tconst { agentsId } = options || {};\\n\\t\\t\\t\\t\\tif (Array.isArray(agentsId) && !agentsId.includes(Meteor.userId())) {\\n\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tevents[response.type](response);\\n\\t\\t\\t\\t});\\n\\t\\t\\t} catch (error) {\\n\\t\\t\\t\\tconsole.log(error);\\n\\t\\t\\t}\\n\\t\\t});\\n\\n\\t\\tconst { responses } = await sdk.rest.get('/v1/canned-responses.get');\\n\\t\\tresponses.forEach((response) => CannedResponse.insert(response));\\n\\t\\tc.stop();\\n\\t});\\n});\\n\",null],\"names\":[\"_regeneratorRuntime\",\"_objectWithoutProperties\",\"Meteor\",\"Tracker\",\"hasPermission\",\"settings\",\"sdk\",\"CannedResponse\",\"module\",\"link\",\"default\",\"v\",\"events\",\"changed\",\"_ref\",\"type\",\"response\",\"_excluded\",\"upsert\",\"_id\",\"removed\",\"remove\",\"startup\",\"autorun\",\"c\",\"async\",\"_context\",\"prev\",\"next\",\"userId\",\"abrupt\",\"get\",\"afterFlush\",\"stream\",\"options\",\"agentsId\",\"_ref2\",\"Array\",\"isArray\",\"includes\",\"error\",\"console\",\"log\",\"awrap\",\"rest\",\"responses\",\"_await$sdk$rest$get\",\"sent\",\"forEach\",\"insert\",\"stop\",\"Promise\"],\"mappings\":\"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\"}"}