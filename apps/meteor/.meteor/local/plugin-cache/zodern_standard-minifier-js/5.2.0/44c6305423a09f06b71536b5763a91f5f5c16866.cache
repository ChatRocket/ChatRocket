{"code":"function module(e,t,l){let n,i,o,r,u,a,c,m,s,k,j,p,E,d,f,C,h;l.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){n=e}},0),l.link(\"@rocket.chat/fuselage-hooks\",{useDebouncedState(e){i=e},useLocalStorage(e){o=e}},0),l.link(\"react\",{default(e){r=e},useState(e){u=e},useCallback(e){a=e},useMemo(e){c=e},useEffect(e){m=e}},1),l.link(\"../../../app/emoji/client\",{emoji(e){s=e},getFrequentEmoji(e){k=e},updateRecent(e){j=e},createEmojiList(e){p=e},createPickerEmojis(e){E=e},CUSTOM_CATEGORY(e){d=e}},2),l.link(\"../../contexts/EmojiPickerContext\",{EmojiPickerContext(e){f=e}},3),l.link(\"../../views/composer/EmojiPicker/EmojiPicker\",{default(e){C=e}},4),l.link(\"./useUpdateCustomEmoji\",{useUpdateCustomEmoji(e){h=e}},5),l.exportDefault(e=>{let{children:t}=e,[l,g]=u(null),[P,b]=i(null,100),[x,v]=o(\"emoji.recent\",[]),[y,S]=o(\"emoji.tone\",0),[M,O]=u(\"recent\"),[U,q]=u(90),[D,L]=o(\"emoji.frequent\",[]),[R,T]=u(()=>k(D.map(e=>{let[t]=e;return t})));h();let w=a(e=>{let t=D.some(t=>{let[l]=t;return l===e})?[]:[[e,0]],l=[...t,...D].map(t=>{let[l,n]=t;return l===e?[l,Math.min(n+5,100)]:[l,Math.max(n-1,0)]}).sort((e,t)=>{let[,l]=e,[,n]=t;return n-l});L(l),T(k(l.map(e=>{let[t]=e;return t})))},[D,L]),[A,B]=u(()=>()=>[]),F=a(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:90;B(l=>()=>l().map(l=>e===l.key?n(n({},l),{},{emojis:{list:p(l.key,null,x,v),limit:l.key===d?t|U:null}}):l))},[U,x,v]);m(()=>{(null==x?void 0:x.length)>0&&j(x),B(()=>()=>E(U,y,x,v))},[y,x,U,M,v,D]);let G=a(e=>{w(e);let t=x||[],l=t.indexOf(e);-1!==l&&t.splice(l,1),t.unshift(e),t.splice(27),v(t),s.packages.base.emojisByCategory.recent=t,F(\"recent\")},[x,v,F,w]),Y=a((e,t)=>g(r.createElement(C,{reference:e,onClose:()=>g(null),onPickEmoji:e=>t(e)})),[]),_=a((e,t)=>b({emoji:e,name:t}),[b]),z=a(()=>b(null),[b]),H=c(()=>({isOpen:null!==l,close:()=>g(null),open:Y,emojiToPreview:P,handlePreview:_,handleRemovePreview:z,addRecentEmoji:G,getEmojiListsByCategory:A,recentEmojis:x,setRecentEmojis:v,actualTone:y,currentCategory:M,setCurrentCategory:O,customItemsLimit:U,setCustomItemsLimit:q,setActualTone:S,quickReactions:R}),[l,Y,P,G,A,x,v,y,M,O,U,S,R,_,z]);return r.createElement(f.Provider,{value:H},t,l)})}","map":"{\"version\":3,\"sources\":[\"client/providers/EmojiPickerProvider/EmojiPickerProvider.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { useDebouncedState, useLocalStorage } from '@rocket.chat/fuselage-hooks';\\nimport type { ReactNode, ReactElement, ContextType } from 'react';\\nimport React, { useState, useCallback, useMemo, useEffect } from 'react';\\n\\nimport type { EmojiByCategory } from '../../../app/emoji/client';\\nimport { emoji, getFrequentEmoji, updateRecent, createEmojiList, createPickerEmojis, CUSTOM_CATEGORY } from '../../../app/emoji/client';\\nimport { EmojiPickerContext } from '../../contexts/EmojiPickerContext';\\nimport EmojiPicker from '../../views/composer/EmojiPicker/EmojiPicker';\\nimport { useUpdateCustomEmoji } from './useUpdateCustomEmoji';\\n\\nconst DEFAULT_ITEMS_LIMIT = 90;\\n\\nconst EmojiPickerProvider = ({ children }: { children: ReactNode }): ReactElement => {\\n\\tconst [emojiPicker, setEmojiPicker] = useState<ReactElement | null>(null);\\n\\tconst [emojiToPreview, setEmojiToPreview] = useDebouncedState<{ emoji: string; name: string } | null>(null, 100);\\n\\tconst [recentEmojis, setRecentEmojis] = useLocalStorage<string[]>('emoji.recent', []);\\n\\tconst [actualTone, setActualTone] = useLocalStorage('emoji.tone', 0);\\n\\tconst [currentCategory, setCurrentCategory] = useState('recent');\\n\\tconst [customItemsLimit, setCustomItemsLimit] = useState(DEFAULT_ITEMS_LIMIT);\\n\\n\\tconst [frequentEmojis, setFrequentEmojis] = useLocalStorage<[string, number][]>('emoji.frequent', []);\\n\\n\\tconst [quickReactions, setQuickReactions] = useState<{ emoji: string; image: string }[]>(() =>\\n\\t\\tgetFrequentEmoji(frequentEmojis.map(([emoji]) => emoji)),\\n\\t);\\n\\n\\tuseUpdateCustomEmoji();\\n\\n\\tconst addFrequentEmojis = useCallback(\\n\\t\\t(emoji: string) => {\\n\\t\\t\\tconst empty: [string, number][] = frequentEmojis.some(([emojiName]) => emojiName === emoji) ? [] : [[emoji, 0]];\\n\\n\\t\\t\\tconst sortedFrequent = [...empty, ...frequentEmojis]\\n\\t\\t\\t\\t.map(([emojiName, count]) => {\\n\\t\\t\\t\\t\\treturn (emojiName === emoji ? [emojiName, Math.min(count + 5, 100)] : [emojiName, Math.max(count - 1, 0)]) as [string, number];\\n\\t\\t\\t\\t})\\n\\t\\t\\t\\t.sort(([, frequentA], [, frequentB]) => frequentB - frequentA);\\n\\n\\t\\t\\tsetFrequentEmojis(sortedFrequent);\\n\\t\\t\\tsetQuickReactions(getFrequentEmoji(sortedFrequent.map(([emoji]) => emoji)));\\n\\t\\t},\\n\\t\\t[frequentEmojis, setFrequentEmojis],\\n\\t);\\n\\n\\tconst [getEmojiListsByCategory, setEmojiListsByCategoryGetter] = useState<() => EmojiByCategory[]>(() => () => []);\\n\\n\\t// TODO: improve this update\\n\\tconst updateEmojiListByCategory = useCallback(\\n\\t\\t(categoryKey: string, limit: number = DEFAULT_ITEMS_LIMIT) => {\\n\\t\\t\\tsetEmojiListsByCategoryGetter(\\n\\t\\t\\t\\t(getEmojiListsByCategory) => () =>\\n\\t\\t\\t\\t\\tgetEmojiListsByCategory().map((category) =>\\n\\t\\t\\t\\t\\t\\tcategoryKey === category.key\\n\\t\\t\\t\\t\\t\\t\\t? {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t...category,\\n\\t\\t\\t\\t\\t\\t\\t\\t\\temojis: {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tlist: createEmojiList(category.key, null, recentEmojis, setRecentEmojis),\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tlimit: category.key === CUSTOM_CATEGORY ? limit | customItemsLimit : null,\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t\\t  }\\n\\t\\t\\t\\t\\t\\t\\t: category,\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t);\\n\\t\\t},\\n\\t\\t[customItemsLimit, recentEmojis, setRecentEmojis],\\n\\t);\\n\\n\\tuseEffect(() => {\\n\\t\\tif (recentEmojis?.length > 0) {\\n\\t\\t\\tupdateRecent(recentEmojis);\\n\\t\\t}\\n\\n\\t\\tsetEmojiListsByCategoryGetter(() => () => createPickerEmojis(customItemsLimit, actualTone, recentEmojis, setRecentEmojis));\\n\\t}, [actualTone, recentEmojis, customItemsLimit, currentCategory, setRecentEmojis, frequentEmojis]);\\n\\n\\tconst addRecentEmoji = useCallback(\\n\\t\\t(_emoji: string) => {\\n\\t\\t\\taddFrequentEmojis(_emoji);\\n\\n\\t\\t\\tconst recent = recentEmojis || [];\\n\\t\\t\\tconst pos = recent.indexOf(_emoji as never);\\n\\n\\t\\t\\tif (pos !== -1) {\\n\\t\\t\\t\\trecent.splice(pos, 1);\\n\\t\\t\\t}\\n\\n\\t\\t\\trecent.unshift(_emoji);\\n\\n\\t\\t\\t// limit recent emojis to 27 (3 rows of 9)\\n\\t\\t\\trecent.splice(27);\\n\\n\\t\\t\\tsetRecentEmojis(recent);\\n\\t\\t\\temoji.packages.base.emojisByCategory.recent = recent;\\n\\t\\t\\tupdateEmojiListByCategory('recent');\\n\\t\\t},\\n\\t\\t[recentEmojis, setRecentEmojis, updateEmojiListByCategory, addFrequentEmojis],\\n\\t);\\n\\n\\tconst open = useCallback((ref: Element, callback: (emoji: string) => void) => {\\n\\t\\treturn setEmojiPicker(<EmojiPicker reference={ref} onClose={() => setEmojiPicker(null)} onPickEmoji={(emoji) => callback(emoji)} />);\\n\\t}, []);\\n\\n\\tconst handlePreview = useCallback((emoji: string, name: string) => setEmojiToPreview({ emoji, name }), [setEmojiToPreview]);\\n\\n\\tconst handleRemovePreview = useCallback(() => setEmojiToPreview(null), [setEmojiToPreview]);\\n\\n\\tconst contextValue = useMemo(\\n\\t\\t(): ContextType<typeof EmojiPickerContext> => ({\\n\\t\\t\\tisOpen: emojiPicker !== null,\\n\\t\\t\\tclose: () => setEmojiPicker(null),\\n\\t\\t\\topen,\\n\\t\\t\\temojiToPreview,\\n\\t\\t\\thandlePreview,\\n\\t\\t\\thandleRemovePreview,\\n\\t\\t\\taddRecentEmoji,\\n\\t\\t\\tgetEmojiListsByCategory,\\n\\t\\t\\trecentEmojis,\\n\\t\\t\\tsetRecentEmojis,\\n\\t\\t\\tactualTone,\\n\\t\\t\\tcurrentCategory,\\n\\t\\t\\tsetCurrentCategory,\\n\\t\\t\\tcustomItemsLimit,\\n\\t\\t\\tsetCustomItemsLimit,\\n\\t\\t\\tsetActualTone,\\n\\t\\t\\tquickReactions,\\n\\t\\t}),\\n\\t\\t[\\n\\t\\t\\temojiPicker,\\n\\t\\t\\topen,\\n\\t\\t\\temojiToPreview,\\n\\t\\t\\taddRecentEmoji,\\n\\t\\t\\tgetEmojiListsByCategory,\\n\\t\\t\\trecentEmojis,\\n\\t\\t\\tsetRecentEmojis,\\n\\t\\t\\tactualTone,\\n\\t\\t\\tcurrentCategory,\\n\\t\\t\\tsetCurrentCategory,\\n\\t\\t\\tcustomItemsLimit,\\n\\t\\t\\tsetActualTone,\\n\\t\\t\\tquickReactions,\\n\\t\\t\\thandlePreview,\\n\\t\\t\\thandleRemovePreview,\\n\\t\\t],\\n\\t);\\n\\n\\treturn (\\n\\t\\t<EmojiPickerContext.Provider value={contextValue}>\\n\\t\\t\\t{children}\\n\\t\\t\\t{emojiPicker}\\n\\t\\t</EmojiPickerContext.Provider>\\n\\t);\\n};\\n\\nexport default EmojiPickerProvider;\\n\",null],\"names\":[\"_objectSpread\",\"useDebouncedState\",\"useLocalStorage\",\"React\",\"useState\",\"useCallback\",\"useMemo\",\"useEffect\",\"emoji\",\"getFrequentEmoji\",\"updateRecent\",\"createEmojiList\",\"createPickerEmojis\",\"CUSTOM_CATEGORY\",\"EmojiPickerContext\",\"EmojiPicker\",\"useUpdateCustomEmoji\",\"module\",\"link\",\"default\",\"v\",\"exportDefault\",\"_ref\",\"children\",\"emojiPicker\",\"setEmojiPicker\",\"emojiToPreview\",\"setEmojiToPreview\",\"recentEmojis\",\"setRecentEmojis\",\"actualTone\",\"setActualTone\",\"currentCategory\",\"setCurrentCategory\",\"customItemsLimit\",\"setCustomItemsLimit\",\"frequentEmojis\",\"setFrequentEmojis\",\"quickReactions\",\"setQuickReactions\",\"map\",\"_ref2\",\"addFrequentEmojis\",\"empty\",\"some\",\"_ref3\",\"emojiName\",\"sortedFrequent\",\"_ref4\",\"count\",\"Math\",\"min\",\"max\",\"sort\",\"_ref5\",\"_ref6\",\"frequentA\",\"frequentB\",\"_ref7\",\"getEmojiListsByCategory\",\"setEmojiListsByCategoryGetter\",\"updateEmojiListByCategory\",\"categoryKey\",\"limit\",\"arguments\",\"length\",\"undefined\",\"category\",\"key\",\"emojis\",\"list\",\"addRecentEmoji\",\"_emoji\",\"recent\",\"pos\",\"indexOf\",\"splice\",\"unshift\",\"packages\",\"base\",\"emojisByCategory\",\"open\",\"ref\",\"callback\",\"createElement\",\"reference\",\"onClose\",\"onPickEmoji\",\"handlePreview\",\"name\",\"handleRemovePreview\",\"contextValue\",\"isOpen\",\"close\",\"Provider\",\"value\"],\"mappings\":\"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\"}"}