{"code":"function module(e,t,r){let i,n,a,l,o,c,s,g,u,d,m,p,f;r.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){i=e}},0),r.link(\"@rocket.chat/string-helpers\",{escapeRegExp(e){n=e}},0),r.link(\"meteor/meteor\",{Meteor(e){a=e}},1),r.link(\"../../app/settings/client\",{settings(e){l=e}},2),r.link(\"../../app/ui-utils/client/lib/AccountBox\",{AccountBox(e){o=e}},3),r.link(\"../../app/utils/client/lib/SDKClient\",{sdk(e){c=e}},4),r.link(\"../../lib/callbacks/afterLogoutCleanUpCallback\",{afterLogoutCleanUpCallback(e){s=e}},5),r.link(\"../../lib/utils/stringUtils\",{capitalize(e){g=e},ltrim(e){u=e},rtrim(e){d=e}},6),r.link(\"../lib/baseURI\",{baseURI(e){m=e}},7),r.link(\"../lib/loginServices\",{loginServices(e){p=e}},8),r.link(\"../providers/RouterProvider\",{router(e){f=e}},9);let k={go(e){if(\"string\"!=typeof e.path||0===e.path.trim().length)return console.error(\"`path` not defined\");let t=new URL(\"\".concat(d(m,\"/\"),\"/\").concat(u(e.path,\"/\"))),r=Array.from(t.searchParams.entries()).reduce((e,t)=>{let[r,i]=t;return e[r]=i,e},{}),a=t.pathname.replace(new RegExp(\"^\".concat(n(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX))),\"\");f.navigate({pathname:a,search:i(i({},f.getSearchParameters()),r)})},\"set-user-status\"(e){o.setStatus(e.status)},\"call-custom-oauth-login\"(e,t){let r=\"\".concat(a.settings.Site_Url,\"/\");if(\"string\"==typeof e.redirectUrl&&e.redirectUrl.startsWith(r)||(e.redirectUrl=null),\"string\"==typeof e.service&&window.ServiceConfiguration){let i=p.getLoginService(e.service);if(i){let n=a[\"loginWith\".concat(g(i.service,!0))],l=e.redirectUrl||r;n.call(a,{redirectUrl:l},e=>{var r;null===(r=t.source)||void 0===r||r.postMessage({event:\"custom-oauth-callback\",response:e},{targetOrigin:t.origin})})}}},\"login-with-token\"(e){\"string\"==typeof e.token&&a.loginWithToken(e.token,()=>{console.log(\"Iframe command [login-with-token]: result\",e)})},async logout(){let e=a.user();a.logout(()=>{if(e)return s.run(e),c.call(\"logoutCleanUp\",e),f.navigate(\"/home\")})}};window.addEventListener(\"message\",e=>{if(!l.get(\"Iframe_Integration_receive_enable\")||\"object\"!=typeof e.data||\"string\"!=typeof e.data.externalCommand)return;let t=l.get(\"Iframe_Integration_receive_origin\");if(\"*\"!==t&&-1===t.split(\",\").indexOf(e.origin)){console.error(\"Origin not allowed\",e.origin);return}if(!(e.data.externalCommand in k)){console.error(\"Command not allowed\",e.data.externalCommand);return}let r=k[e.data.externalCommand];r(e.data,e)})}","map":"{\"version\":3,\"sources\":[\"client/startup/iframeCommands.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { UserStatus, IUser } from '@rocket.chat/core-typings';\\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\\nimport type { LocationPathname } from '@rocket.chat/ui-contexts';\\nimport { Meteor } from 'meteor/meteor';\\n\\nimport { settings } from '../../app/settings/client';\\nimport { AccountBox } from '../../app/ui-utils/client/lib/AccountBox';\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\nimport { afterLogoutCleanUpCallback } from '../../lib/callbacks/afterLogoutCleanUpCallback';\\nimport { capitalize, ltrim, rtrim } from '../../lib/utils/stringUtils';\\nimport { baseURI } from '../lib/baseURI';\\nimport { loginServices } from '../lib/loginServices';\\nimport { router } from '../providers/RouterProvider';\\n\\nconst commands = {\\n\\t'go'(data: { path: string }) {\\n\\t\\tif (typeof data.path !== 'string' || data.path.trim().length === 0) {\\n\\t\\t\\treturn console.error('`path` not defined');\\n\\t\\t}\\n\\t\\tconst newUrl = new URL(`${rtrim(baseURI, '/')}/${ltrim(data.path, '/')}`);\\n\\n\\t\\tconst newParams = Array.from(newUrl.searchParams.entries()).reduce((ret, [key, value]) => {\\n\\t\\t\\tret[key] = value;\\n\\t\\t\\treturn ret;\\n\\t\\t}, {} as Record<string, string>);\\n\\n\\t\\tconst newPath = newUrl.pathname.replace(\\n\\t\\t\\tnew RegExp(`^${escapeRegExp(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX)}`),\\n\\t\\t\\t'',\\n\\t\\t) as LocationPathname;\\n\\t\\trouter.navigate({\\n\\t\\t\\tpathname: newPath,\\n\\t\\t\\tsearch: { ...router.getSearchParameters(), ...newParams },\\n\\t\\t});\\n\\t},\\n\\n\\t'set-user-status'(data: { status: UserStatus }) {\\n\\t\\tAccountBox.setStatus(data.status);\\n\\t},\\n\\n\\t'call-custom-oauth-login'(data: { service: string; redirectUrl?: string | null }, event: MessageEvent) {\\n\\t\\tconst customOAuthCallback = (response: unknown) => {\\n\\t\\t\\tevent.source?.postMessage(\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\tevent: 'custom-oauth-callback',\\n\\t\\t\\t\\t\\tresponse,\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\t{ targetOrigin: event.origin },\\n\\t\\t\\t);\\n\\t\\t};\\n\\n\\t\\tconst siteUrl = `${Meteor.settings.Site_Url}/`;\\n\\t\\tif (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\\n\\t\\t\\tdata.redirectUrl = null;\\n\\t\\t}\\n\\n\\t\\tif (typeof data.service === 'string' && window.ServiceConfiguration) {\\n\\t\\t\\tconst customOauth = loginServices.getLoginService(data.service);\\n\\n\\t\\t\\tif (customOauth) {\\n\\t\\t\\t\\tconst customLoginWith = (Meteor as any)[`loginWith${capitalize(customOauth.service, true)}`];\\n\\t\\t\\t\\tconst customRedirectUri = data.redirectUrl || siteUrl;\\n\\t\\t\\t\\tcustomLoginWith.call(Meteor, { redirectUrl: customRedirectUri }, customOAuthCallback);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t},\\n\\n\\t'login-with-token'(data: { token: string }) {\\n\\t\\tif (typeof data.token === 'string') {\\n\\t\\t\\tMeteor.loginWithToken(data.token, () => {\\n\\t\\t\\t\\tconsole.log('Iframe command [login-with-token]: result', data);\\n\\t\\t\\t});\\n\\t\\t}\\n\\t},\\n\\n\\tasync 'logout'() {\\n\\t\\tconst user = Meteor.user();\\n\\t\\tMeteor.logout(() => {\\n\\t\\t\\tif (!user) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\tvoid afterLogoutCleanUpCallback.run(user);\\n\\t\\t\\tsdk.call('logoutCleanUp', user as unknown as IUser);\\n\\t\\t\\treturn router.navigate('/home');\\n\\t\\t});\\n\\t},\\n} as const;\\n\\ntype CommandMessage<TCommandName extends keyof typeof commands = keyof typeof commands> = {\\n\\texternalCommand: TCommandName;\\n} & Parameters<(typeof commands)[TCommandName]>[0];\\n\\nwindow.addEventListener('message', <TCommandMessage extends CommandMessage>(e: MessageEvent<TCommandMessage>) => {\\n\\tif (!settings.get<boolean>('Iframe_Integration_receive_enable')) {\\n\\t\\treturn;\\n\\t}\\n\\n\\tif (typeof e.data !== 'object' || typeof e.data.externalCommand !== 'string') {\\n\\t\\treturn;\\n\\t}\\n\\n\\tconst origins = settings.get<string>('Iframe_Integration_receive_origin');\\n\\n\\tif (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\\n\\t\\tconsole.error('Origin not allowed', e.origin);\\n\\t\\treturn;\\n\\t}\\n\\n\\tif (!(e.data.externalCommand in commands)) {\\n\\t\\tconsole.error('Command not allowed', e.data.externalCommand);\\n\\t\\treturn;\\n\\t}\\n\\n\\tconst command: (data: any, event: MessageEvent) => void = commands[e.data.externalCommand];\\n\\tcommand(e.data, e);\\n});\\n\",null],\"names\":[\"_objectSpread\",\"escapeRegExp\",\"Meteor\",\"settings\",\"AccountBox\",\"sdk\",\"afterLogoutCleanUpCallback\",\"capitalize\",\"ltrim\",\"rtrim\",\"baseURI\",\"loginServices\",\"router\",\"module\",\"link\",\"default\",\"v\",\"commands\",\"data\",\"path\",\"trim\",\"length\",\"console\",\"error\",\"newUrl\",\"URL\",\"concat\",\"newParams\",\"Array\",\"from\",\"searchParams\",\"entries\",\"reduce\",\"ret\",\"_ref\",\"key\",\"value\",\"newPath\",\"pathname\",\"replace\",\"RegExp\",\"__meteor_runtime_config__\",\"ROOT_URL_PATH_PREFIX\",\"navigate\",\"search\",\"getSearchParameters\",\"setStatus\",\"status\",\"event\",\"siteUrl\",\"Site_Url\",\"redirectUrl\",\"startsWith\",\"service\",\"window\",\"ServiceConfiguration\",\"customOauth\",\"getLoginService\",\"customLoginWith\",\"customRedirectUri\",\"call\",\"response\",\"_event$source\",\"source\",\"postMessage\",\"targetOrigin\",\"origin\",\"token\",\"loginWithToken\",\"log\",\"user\",\"logout\",\"run\",\"addEventListener\",\"e\",\"get\",\"externalCommand\",\"origins\",\"split\",\"indexOf\",\"command\"],\"mappings\":\"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\"}"}