{"code":"function module(e,n,t){var o,r,i,u,a,c,l,s,f,m,d,k,p,_,h,b;t.link(\"@babel/runtime/helpers/extends\",{default:function(e){o=e}},0),t.link(\"@babel/runtime/regenerator\",{default:function(e){r=e}},1),t.link(\"@rocket.chat/fuselage\",{Throbber:function(e){i=e},Box:function(e){u=e}},0),t.link(\"@rocket.chat/ui-contexts\",{useSetModal:function(e){a=e},useEndpoint:function(e){c=e},useToastMessageDispatch:function(e){l=e},useTranslation:function(e){s=e}},1),t.link(\"@tanstack/react-query\",{useMutation:function(e){f=e}},2),t.link(\"react\",{default:function(e){m=e}},3),t.link(\"react-virtuoso\",{Virtuoso:function(e){d=e}},4),t.link(\"../../../components/CustomScrollbars\",{VirtuosoScrollbars:function(e){k=e}},5),t.link(\"../../../lib/rooms/roomCoordinator\",{roomCoordinator:function(e){p=e}},6),t.link(\"./FederatedRoomListEmptyPlaceholder\",{default:function(e){_=e}},7),t.link(\"./FederatedRoomListItem\",{default:function(e){h=e}},8),t.link(\"./useInfiniteFederationSearchPublicRooms\",{useInfiniteFederationSearchPublicRooms:function(e){b=e}},9),t.exportDefault(function(e){var n=e.serverName,t=e.roomName,g=e.count,v=c(\"POST\",\"/v1/federation/joinExternalPublicRoom\"),x=a(),E=s(),P=l(),y=b(n,t,g),R=y.data,S=y.isLoading,N=y.isFetchingNextPage,F=y.fetchNextPage,T=f([\"federation/joinExternalPublicRoom\"],function(e){var n,o;return r.async(function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.id,o=e.pageToken,r.abrupt(\"return\",v({externalRoomId:n,roomName:t,pageToken:o}));case 2:case\"end\":return r.stop()}},null,null,null,Promise)},{onSuccess:function(e,n){P({type:\"success\",message:E(\"Your_request_to_join__roomName__has_been_made_it_could_take_up_to_15_minutes_to_be_processed\",{roomName:n.name})}),x(null)},onError:function(e,n){var t=n.id;if(e instanceof Error&&\"already-joined\"===e.message){x(null),p.openRouteLink(\"c\",{rid:t});return}P({type:\"error\",message:e})}}),C=T.mutate,I=T.isLoading;if(S)return m.createElement(i,null);var L=null==R?void 0:R.pages.flatMap(function(e){return e.rooms});return m.createElement(u,{is:\"ul\",overflow:\"hidden\",height:\"356px\",flexGrow:1,flexShrink:0,mi:-24},m.createElement(d,{data:L||[],computeItemKey:function(e,n){return(null==n?void 0:n.id)||e},overscan:4,components:{Footer:function(){return N?m.createElement(i,null):null},Scroller:k,EmptyPlaceholder:_},endReached:S||N?function(){}:function(){return F()},itemContent:function(e,n){return m.createElement(h,o({onClickJoin:function(){return C(n)}},n,{disabled:I,key:n.id}))}}))})}","map":"{\"version\":3,\"sources\":[\"client/sidebarv2/header/MatrixFederationSearch/FederatedRoomList.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { Throbber, Box } from '@rocket.chat/fuselage';\\nimport type { IFederationPublicRooms } from '@rocket.chat/rest-typings';\\nimport { useSetModal, useEndpoint, useToastMessageDispatch, useTranslation } from '@rocket.chat/ui-contexts';\\nimport { useMutation } from '@tanstack/react-query';\\nimport React from 'react';\\nimport { Virtuoso } from 'react-virtuoso';\\n\\nimport { VirtuosoScrollbars } from '../../../components/CustomScrollbars';\\nimport { roomCoordinator } from '../../../lib/rooms/roomCoordinator';\\nimport FederatedRoomListEmptyPlaceholder from './FederatedRoomListEmptyPlaceholder';\\nimport FederatedRoomListItem from './FederatedRoomListItem';\\nimport { useInfiniteFederationSearchPublicRooms } from './useInfiniteFederationSearchPublicRooms';\\n\\ntype FederatedRoomListProps = {\\n\\tserverName: string;\\n\\troomName?: string;\\n\\tpageToken?: string;\\n\\tcount?: number;\\n};\\n\\nconst FederatedRoomList = ({ serverName, roomName, count }: FederatedRoomListProps) => {\\n\\tconst joinExternalPublicRoom = useEndpoint('POST', '/v1/federation/joinExternalPublicRoom');\\n\\n\\tconst setModal = useSetModal();\\n\\tconst t = useTranslation();\\n\\tconst dispatchToastMessage = useToastMessageDispatch();\\n\\tconst { data, isLoading, isFetchingNextPage, fetchNextPage } = useInfiniteFederationSearchPublicRooms(serverName, roomName, count);\\n\\n\\tconst { mutate: onClickJoin, isLoading: isLoadingMutation } = useMutation(\\n\\t\\t['federation/joinExternalPublicRoom'],\\n\\t\\tasync ({ id, pageToken }: IFederationPublicRooms) => {\\n\\t\\t\\treturn joinExternalPublicRoom({ externalRoomId: id as `!${string}:${string}`, roomName, pageToken });\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tonSuccess: (_, data) => {\\n\\t\\t\\t\\tdispatchToastMessage({\\n\\t\\t\\t\\t\\ttype: 'success',\\n\\t\\t\\t\\t\\tmessage: t('Your_request_to_join__roomName__has_been_made_it_could_take_up_to_15_minutes_to_be_processed', {\\n\\t\\t\\t\\t\\t\\troomName: data.name,\\n\\t\\t\\t\\t\\t}),\\n\\t\\t\\t\\t});\\n\\t\\t\\t\\tsetModal(null);\\n\\t\\t\\t},\\n\\t\\t\\tonError: (error, { id }) => {\\n\\t\\t\\t\\tif (error instanceof Error && error.message === 'already-joined') {\\n\\t\\t\\t\\t\\tsetModal(null);\\n\\t\\t\\t\\t\\troomCoordinator.openRouteLink('c', { rid: id });\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tdispatchToastMessage({ type: 'error', message: error });\\n\\t\\t\\t},\\n\\t\\t},\\n\\t);\\n\\n\\tif (isLoading) {\\n\\t\\treturn <Throbber />;\\n\\t}\\n\\n\\tconst flattenedData = data?.pages.flatMap((page) => page.rooms);\\n\\treturn (\\n\\t\\t<Box is='ul' overflow='hidden' height='356px' flexGrow={1} flexShrink={0} mi={-24}>\\n\\t\\t\\t<Virtuoso\\n\\t\\t\\t\\tdata={flattenedData || []}\\n\\t\\t\\t\\tcomputeItemKey={(index, room) => room?.id || index}\\n\\t\\t\\t\\toverscan={4}\\n\\t\\t\\t\\tcomponents={{\\n\\t\\t\\t\\t\\t// eslint-disable-next-line react/no-multi-comp\\n\\t\\t\\t\\t\\tFooter: () => (isFetchingNextPage ? <Throbber /> : null),\\n\\t\\t\\t\\t\\tScroller: VirtuosoScrollbars,\\n\\t\\t\\t\\t\\tEmptyPlaceholder: FederatedRoomListEmptyPlaceholder,\\n\\t\\t\\t\\t}}\\n\\t\\t\\t\\tendReached={isLoading || isFetchingNextPage ? () => undefined : () => fetchNextPage()}\\n\\t\\t\\t\\titemContent={(_, room) => (\\n\\t\\t\\t\\t\\t<FederatedRoomListItem onClickJoin={() => onClickJoin(room)} {...room} disabled={isLoadingMutation} key={room.id} />\\n\\t\\t\\t\\t)}\\n\\t\\t\\t/>\\n\\t\\t</Box>\\n\\t);\\n};\\n\\nexport default FederatedRoomList;\\n\",null],\"names\":[\"_extends\",\"_regeneratorRuntime\",\"Throbber\",\"Box\",\"useSetModal\",\"useEndpoint\",\"useToastMessageDispatch\",\"useTranslation\",\"useMutation\",\"React\",\"Virtuoso\",\"VirtuosoScrollbars\",\"roomCoordinator\",\"FederatedRoomListEmptyPlaceholder\",\"FederatedRoomListItem\",\"useInfiniteFederationSearchPublicRooms\",\"module\",\"link\",\"default\",\"v\",\"exportDefault\",\"_ref\",\"serverName\",\"roomName\",\"count\",\"joinExternalPublicRoom\",\"setModal\",\"t\",\"dispatchToastMessage\",\"_useInfiniteFederatio\",\"data\",\"isLoading\",\"isFetchingNextPage\",\"fetchNextPage\",\"_useMutation\",\"_ref2\",\"id\",\"pageToken\",\"async\",\"_context\",\"prev\",\"next\",\"abrupt\",\"externalRoomId\",\"stop\",\"Promise\",\"onSuccess\",\"_\",\"type\",\"message\",\"name\",\"onError\",\"error\",\"_ref3\",\"Error\",\"openRouteLink\",\"rid\",\"onClickJoin\",\"mutate\",\"isLoadingMutation\",\"createElement\",\"flattenedData\",\"pages\",\"flatMap\",\"page\",\"rooms\",\"is\",\"overflow\",\"height\",\"flexGrow\",\"flexShrink\",\"mi\",\"computeItemKey\",\"index\",\"room\",\"overscan\",\"components\",\"Footer\",\"Scroller\",\"EmptyPlaceholder\",\"endReached\",\"itemContent\",\"disabled\",\"key\"],\"mappings\":\"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\"}"}