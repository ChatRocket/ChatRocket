{"code":"function module(e,n,t){var r,s,i,a,o,u,c,l,f=[\"type\"];t.link(\"@babel/runtime/regenerator\",{default:function(e){r=e}},0),t.link(\"@babel/runtime/helpers/objectWithoutProperties\",{default:function(e){s=e}},1),t.link(\"meteor/meteor\",{Meteor:function(e){i=e}},0),t.link(\"meteor/tracker\",{Tracker:function(e){a=e}},1),t.link(\"../../../authorization/client\",{hasPermission:function(e){o=e}},2),t.link(\"../../../settings/client\",{settings:function(e){u=e}},3),t.link(\"../../../utils/client/lib/SDKClient\",{sdk:function(e){c=e}},4),t.link(\"../collections/CannedResponse\",{CannedResponse:function(e){l=e}},5),i.startup(function(){a.autorun(function(e){return r.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(i.userId()){n.next=2;break}return n.abrupt(\"return\");case 2:if(u.get(\"Canned_Responses_Enable\")){n.next=4;break}return n.abrupt(\"return\");case 4:if(o(\"view-canned-responses\")){n.next=6;break}return n.abrupt(\"return\");case 6:return a.afterFlush(function(){try{c.stream(\"canned-responses\",[\"canned-responses\"],function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];var r=n[0],a=(n[1]||{}).agentsId;if(!Array.isArray(a)||a.includes(i.userId()))switch(r.type){case\"changed\":r.type;var o=s(r,f);l.upsert({_id:r._id},o);break;case\"removed\":l.remove({_id:r._id})}})}catch(e){console.log(e)}}),n.next=9,r.awrap(c.rest.get(\"/v1/canned-responses.get\"));case 9:n.sent.responses.forEach(function(e){return l.insert(e)}),e.stop();case 13:case\"end\":return n.stop()}},null,null,null,Promise)})})}","map":"{\"version\":3,\"sources\":[\"app/canned-responses/client/startup/responses.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { hasPermission } from '../../../authorization/client';\\nimport { settings } from '../../../settings/client';\\nimport { sdk } from '../../../utils/client/lib/SDKClient';\\nimport { CannedResponse } from '../collections/CannedResponse';\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(async (c) => {\\n\\t\\tif (!Meteor.userId()) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tif (!settings.get('Canned_Responses_Enable')) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tif (!hasPermission('view-canned-responses')) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tTracker.afterFlush(() => {\\n\\t\\t\\ttry {\\n\\t\\t\\t\\t// TODO: check options\\n\\t\\t\\t\\tsdk.stream('canned-responses', ['canned-responses'], (...[response, options]) => {\\n\\t\\t\\t\\t\\tconst { agentsId } = options || {};\\n\\t\\t\\t\\t\\tif (Array.isArray(agentsId) && !agentsId.includes(Meteor.userId())) {\\n\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tswitch (response.type) {\\n\\t\\t\\t\\t\\t\\tcase 'changed': {\\n\\t\\t\\t\\t\\t\\t\\tconst { type, ...fields } = response;\\n\\t\\t\\t\\t\\t\\t\\tCannedResponse.upsert({ _id: response._id }, fields);\\n\\t\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\t\\tcase 'removed': {\\n\\t\\t\\t\\t\\t\\t\\tCannedResponse.remove({ _id: response._id });\\n\\t\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t});\\n\\t\\t\\t} catch (error) {\\n\\t\\t\\t\\tconsole.log(error);\\n\\t\\t\\t}\\n\\t\\t});\\n\\n\\t\\tconst { responses } = await sdk.rest.get('/v1/canned-responses.get');\\n\\t\\tresponses.forEach((response) => CannedResponse.insert(response));\\n\\t\\tc.stop();\\n\\t});\\n});\\n\",null],\"names\":[\"_regeneratorRuntime\",\"_objectWithoutProperties\",\"Meteor\",\"Tracker\",\"hasPermission\",\"settings\",\"sdk\",\"CannedResponse\",\"module\",\"link\",\"default\",\"v\",\"startup\",\"autorun\",\"c\",\"async\",\"_context\",\"prev\",\"next\",\"userId\",\"abrupt\",\"get\",\"afterFlush\",\"stream\",\"_len\",\"arguments\",\"length\",\"_ref\",\"Array\",\"_key\",\"response\",\"agentsId\",\"_ref2\",\"options\",\"isArray\",\"includes\",\"type\",\"fields\",\"_excluded\",\"upsert\",\"_id\",\"remove\",\"error\",\"console\",\"log\",\"awrap\",\"rest\",\"responses\",\"_await$sdk$rest$get\",\"sent\",\"forEach\",\"insert\",\"stop\",\"Promise\"],\"mappings\":\"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\"}"}