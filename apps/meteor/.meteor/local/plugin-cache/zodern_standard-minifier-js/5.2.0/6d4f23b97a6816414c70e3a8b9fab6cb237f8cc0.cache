{"code":"function module(t,e,n){var a,s,i,r,o,u,c,l,d,m,f,g=[\"editedBy\",\"editedAt\",\"emoji\",\"avatar\",\"alias\",\"customFields\",\"groupable\",\"attachments\",\"reactions\"];n.link(\"@babel/runtime/helpers/objectWithoutProperties\",{default:function(t){a=t}},0),n.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(t){s=t}},1),n.export({parseMessageTextToAstMarkdown:function(){return p},parseMessageAttachment:function(){return h},parseMessageAttachments:function(){return v},removePossibleNullMessageValues:function(){return A}}),n.link(\"@rocket.chat/core-typings\",{isFileAttachment:function(t){i=t},isE2EEMessage:function(t){r=t},isOTRMessage:function(t){o=t},isOTRAckMessage:function(t){u=t},isQuoteAttachment:function(t){c=t},isTranslatedAttachment:function(t){l=t},isTranslatedMessage:function(t){d=t}},0),n.link(\"@rocket.chat/message-parser\",{parse:function(t){m=t}},1),n.link(\"../views/room/MessageList/lib/isParsedMessage\",{isParsedMessage:function(t){f=t}},2);var p=function(t,e,n){var a,i=A(t),c=n.showAutoTranslate,l=n.autoTranslateLanguage,m=l&&d(i)&&i.translations,f=c(t),g=f&&m&&m[l]||i.msg;return s(s({},i),{},{md:r(t)||o(t)||u(t)||f?b(g,e):null!==(a=i.md)&&void 0!==a?a:b(g,e)},i.attachments&&{attachments:v(i.attachments,e,{autoTranslateLanguage:l,translated:f})})},h=function(t,e,n){var a,r,o,u=n.translated,d=n.autoTranslateLanguage;if(!t.text&&!t.description)return t;c(t)&&t.attachments&&(t.attachments=v(t.attachments,e,n));var m=l(t)&&d&&(null==t?void 0:null===(a=t.translations)||void 0===a?void 0:a[d])||t.text||t.description||\"\";return i(t)&&t.description&&(t.descriptionMd=u?b(m,e):null!==(o=t.descriptionMd)&&void 0!==o?o:b(m,e)),s(s({},t),{},{md:u?b(m,e):null!==(r=t.md)&&void 0!==r?r:b(m,e)})},v=function(t,e,n){return t.map(function(t){return h(t,e,n)})},M=function(t){return null!=t},A=function(t){var e=t.editedBy,n=t.editedAt,i=t.emoji,r=t.avatar,o=t.alias,u=t.customFields,c=t.groupable,l=t.attachments,d=t.reactions,m=a(t,g);return s(s(s(s(s(s(s(s(s(s({},m),M(e)&&{editedBy:e}),M(n)&&{editedAt:n}),M(i)&&{emoji:i}),M(r)&&{avatar:r}),M(o)&&{alias:o}),M(u)&&{customFields:u}),M(c)&&{groupable:c}),M(l)&&{attachments:l}),M(d)&&{reactions:d})},b=function(t,e){if(!t)return[];if(f(t))return t;var n=m(t,e);return\"LINE_BREAK\"!==n[0].type?n:n.slice(1)}}","map":"{\"version\":3,\"sources\":[\"client/lib/parseMessageTextToAstMarkdown.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IMessage, ITranslatedMessage, MessageAttachment } from '@rocket.chat/core-typings';\\nimport {\\n\\tisFileAttachment,\\n\\tisE2EEMessage,\\n\\tisOTRMessage,\\n\\tisOTRAckMessage,\\n\\tisQuoteAttachment,\\n\\tisTranslatedAttachment,\\n\\tisTranslatedMessage,\\n} from '@rocket.chat/core-typings';\\nimport type { Options, Root } from '@rocket.chat/message-parser';\\nimport { parse } from '@rocket.chat/message-parser';\\n\\nimport type { AutoTranslateOptions } from '../views/room/MessageList/hooks/useAutoTranslate';\\nimport { isParsedMessage } from '../views/room/MessageList/lib/isParsedMessage';\\n\\ntype WithRequiredProperty<Type, Key extends keyof Type> = Omit<Type, Key> & {\\n\\t[Property in Key]-?: Type[Property];\\n};\\n\\nexport type MessageWithMdEnforced<TMessage extends IMessage & Partial<ITranslatedMessage> = IMessage & Partial<ITranslatedMessage>> =\\n\\tWithRequiredProperty<TMessage, 'md'>;\\n/**\\n * Removes null values for known properties values.\\n * Adds a property `md` to the message with the parsed message if is not provided.\\n * if has `attachments` property, but attachment is missing `md` property, it will be added.\\n * if translation is enabled and message contains `translations` property, it will be replaced by the parsed message.\\n * @param message The message to be parsed.\\n * @param parseOptions The options to be used in the parser.\\n * @param autoTranslateOptions The auto translate options to be used in the parser.\\n * @returns message normalized.\\n */\\nexport const parseMessageTextToAstMarkdown = <\\n\\tTMessage extends IMessage & Partial<ITranslatedMessage> = IMessage & Partial<ITranslatedMessage>,\\n>(\\n\\tmessage: TMessage,\\n\\tparseOptions: Options,\\n\\tautoTranslateOptions: AutoTranslateOptions,\\n): MessageWithMdEnforced => {\\n\\tconst msg = removePossibleNullMessageValues(message);\\n\\tconst { showAutoTranslate, autoTranslateLanguage } = autoTranslateOptions;\\n\\tconst translations = autoTranslateLanguage && isTranslatedMessage(msg) && msg.translations;\\n\\tconst translated = showAutoTranslate(message);\\n\\n\\tconst text = (translated && translations && translations[autoTranslateLanguage]) || msg.msg;\\n\\n\\treturn {\\n\\t\\t...msg,\\n\\t\\tmd:\\n\\t\\t\\tisE2EEMessage(message) || isOTRMessage(message) || isOTRAckMessage(message) || translated\\n\\t\\t\\t\\t? textToMessageToken(text, parseOptions)\\n\\t\\t\\t\\t: msg.md ?? textToMessageToken(text, parseOptions),\\n\\t\\t...(msg.attachments && {\\n\\t\\t\\tattachments: parseMessageAttachments(msg.attachments, parseOptions, { autoTranslateLanguage, translated }),\\n\\t\\t}),\\n\\t};\\n};\\n\\nexport const parseMessageAttachment = <T extends MessageAttachment>(\\n\\tattachment: T,\\n\\tparseOptions: Options,\\n\\tautoTranslateOptions: { autoTranslateLanguage?: string; translated: boolean },\\n): T => {\\n\\tconst { translated, autoTranslateLanguage } = autoTranslateOptions;\\n\\tif (!attachment.text && !attachment.description) {\\n\\t\\treturn attachment;\\n\\t}\\n\\n\\tif (isQuoteAttachment(attachment) && attachment.attachments) {\\n\\t\\tattachment.attachments = parseMessageAttachments(attachment.attachments, parseOptions, autoTranslateOptions);\\n\\t}\\n\\n\\tconst text =\\n\\t\\t(isTranslatedAttachment(attachment) && autoTranslateLanguage && attachment?.translations?.[autoTranslateLanguage]) ||\\n\\t\\tattachment.text ||\\n\\t\\tattachment.description ||\\n\\t\\t'';\\n\\n\\tif (isFileAttachment(attachment) && attachment.description) {\\n\\t\\tattachment.descriptionMd = translated\\n\\t\\t\\t? textToMessageToken(text, parseOptions)\\n\\t\\t\\t: attachment.descriptionMd ?? textToMessageToken(text, parseOptions);\\n\\t}\\n\\n\\treturn {\\n\\t\\t...attachment,\\n\\t\\tmd: translated ? textToMessageToken(text, parseOptions) : attachment.md ?? textToMessageToken(text, parseOptions),\\n\\t};\\n};\\n\\nexport const parseMessageAttachments = <T extends MessageAttachment>(\\n\\tattachments: T[],\\n\\tparseOptions: Options,\\n\\tautoTranslateOptions: { autoTranslateLanguage?: string; translated: boolean },\\n): T[] => attachments.map((attachment) => parseMessageAttachment(attachment, parseOptions, autoTranslateOptions));\\n\\nconst isNotNullOrUndefined = (value: unknown): boolean => value !== null && value !== undefined;\\n\\n// In a previous version of the app, some values were being set to null.\\n// This is a workaround to remove those null values.\\n// A migration script should be created to remove this code.\\nexport const removePossibleNullMessageValues = <TMessage extends IMessage = IMessage>({\\n\\teditedBy,\\n\\teditedAt,\\n\\temoji,\\n\\tavatar,\\n\\talias,\\n\\tcustomFields,\\n\\tgroupable,\\n\\tattachments,\\n\\treactions,\\n\\t...message\\n}: any): TMessage => ({\\n\\t...message,\\n\\t...(isNotNullOrUndefined(editedBy) && { editedBy }),\\n\\t...(isNotNullOrUndefined(editedAt) && { editedAt }),\\n\\t...(isNotNullOrUndefined(emoji) && { emoji }),\\n\\t...(isNotNullOrUndefined(avatar) && { avatar }),\\n\\t...(isNotNullOrUndefined(alias) && { alias }),\\n\\t...(isNotNullOrUndefined(customFields) && { customFields }),\\n\\t...(isNotNullOrUndefined(groupable) && { groupable }),\\n\\t...(isNotNullOrUndefined(attachments) && { attachments }),\\n\\t...(isNotNullOrUndefined(reactions) && { reactions }),\\n});\\n\\nconst textToMessageToken = (textOrRoot: string | Root, parseOptions: Options): Root => {\\n\\tif (!textOrRoot) {\\n\\t\\treturn [];\\n\\t}\\n\\n\\tif (isParsedMessage(textOrRoot)) {\\n\\t\\treturn textOrRoot;\\n\\t}\\n\\tconst parsedMessage = parse(textOrRoot, parseOptions);\\n\\n\\tconst parsedMessageCleaned = parsedMessage[0].type !== 'LINE_BREAK' ? parsedMessage : (parsedMessage.slice(1) as Root);\\n\\n\\treturn parsedMessageCleaned;\\n};\\n\",null],\"names\":[\"_objectWithoutProperties\",\"_objectSpread\",\"isFileAttachment\",\"isE2EEMessage\",\"isOTRMessage\",\"isOTRAckMessage\",\"isQuoteAttachment\",\"isTranslatedAttachment\",\"isTranslatedMessage\",\"parse\",\"isParsedMessage\",\"module\",\"link\",\"default\",\"v\",\"export\",\"parseMessageTextToAstMarkdown\",\"parseMessageAttachment\",\"parseMessageAttachments\",\"removePossibleNullMessageValues\",\"message\",\"parseOptions\",\"autoTranslateOptions\",\"_msg$md\",\"msg\",\"showAutoTranslate\",\"autoTranslateLanguage\",\"translations\",\"translated\",\"text\",\"md\",\"textToMessageToken\",\"attachments\",\"attachment\",\"_attachment$translati\",\"_attachment$md\",\"_attachment$descripti\",\"description\",\"descriptionMd\",\"map\",\"isNotNullOrUndefined\",\"value\",\"_ref\",\"editedBy\",\"editedAt\",\"emoji\",\"avatar\",\"alias\",\"customFields\",\"groupable\",\"reactions\",\"_excluded\",\"textOrRoot\",\"parsedMessage\",\"type\",\"slice\"],\"mappings\":\"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\"}"}