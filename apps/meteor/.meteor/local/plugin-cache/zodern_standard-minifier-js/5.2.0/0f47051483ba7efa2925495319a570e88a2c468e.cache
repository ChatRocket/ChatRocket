{"code":"function module(e,t,n){n.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){i=e}},0),n.link(\"@babel/runtime/helpers/toConsumableArray\",{default:function(e){o=e}},1),n.export({useNormalizedMessage:function(){return v}}),n.link(\"@rocket.chat/base64\",{Base64:function(e){a=e}},0),n.link(\"@rocket.chat/core-typings\",{isFileImageAttachment:function(e){r=e},isFileAttachment:function(e){s=e},isFileAudioAttachment:function(e){u=e},isFileVideoAttachment:function(e){l=e},isQuoteAttachment:function(e){c=e}},1),n.link(\"@rocket.chat/ui-contexts\",{useSetting:function(e){d=e}},2),n.link(\"react\",{useMemo:function(e){f=e}},3),n.link(\"../../../lib/parseMessageTextToAstMarkdown\",{parseMessageTextToAstMarkdown:function(e){m=e}},4),n.link(\"../../../views/room/MessageList/hooks/useAutoLinkDomains\",{useAutoLinkDomains:function(e){k=e}},5),n.link(\"../../../views/room/MessageList/hooks/useAutoTranslate\",{useAutoTranslate:function(e){h=e}},6),n.link(\"../../../views/room/MessageList/hooks/useKatex\",{useKatex:function(e){y=e}},7),n.link(\"./useSubscriptionFromMessageQuery\",{useSubscriptionFromMessageQuery:function(e){p=e}},8);var i,o,a,r,s,u,l,c,d,f,m,k,h,y,p,g=function(e,t,n){return t&&(t=String.fromCharCode.apply(String,o(new TextEncoder().encode(t)))),e.map(function(e){if(c(e)&&e.attachments)return e.attachments=g(e.attachments),e;if(!e.encryption)return e;var o=a.encode(JSON.stringify(i(i({},e.encryption),{},{name:t,type:n})));return s(e)&&(e.title_link&&!e.title_link.startsWith(\"/file-decrypt/\")&&(e.title_link=\"/file-decrypt\"+e.title_link+\"?key=\"+o),r(e)&&!e.image_url.startsWith(\"/file-decrypt/\")&&(e.image_url=\"/file-decrypt\"+e.image_url+\"?key=\"+o),u(e)&&!e.audio_url.startsWith(\"/file-decrypt/\")&&(e.audio_url=\"/file-decrypt\"+e.audio_url+\"?key=\"+o),l(e)&&!e.video_url.startsWith(\"/file-decrypt/\")&&(e.video_url=\"/file-decrypt\"+e.video_url+\"?key=\"+o)),e})},v=function(e){var t,n=y(),o=n.katexEnabled,a=n.katexDollarSyntaxEnabled,r=n.katexParenthesisSyntaxEnabled,s=k(),u=null!==(t=p(e).data)&&void 0!==t?t:void 0,l=h(u),c=d(\"HexColorPreview_Enabled\");return f(function(){var t,n,u=i({colors:c,emoticons:!0,customDomains:s},o&&{katex:{dollarSyntax:a,parenthesisSyntax:r}}),d=m(e,u,l);return d.attachments&&(d.attachments=g(d.attachments,null===(t=d.file)||void 0===t?void 0:t.name,null===(n=d.file)||void 0===n?void 0:n.type)),d},[c,s,o,a,r,e,l])}}","map":"{\"version\":3,\"sources\":[\"client/components/message/hooks/useNormalizedMessage.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Base64 } from '@rocket.chat/base64';\\nimport type { IMessage, MessageAttachment } from '@rocket.chat/core-typings';\\nimport {\\n\\tisFileImageAttachment,\\n\\tisFileAttachment,\\n\\tisFileAudioAttachment,\\n\\tisFileVideoAttachment,\\n\\tisQuoteAttachment,\\n} from '@rocket.chat/core-typings';\\nimport type { Options } from '@rocket.chat/message-parser';\\nimport { useSetting } from '@rocket.chat/ui-contexts';\\nimport { useMemo } from 'react';\\n\\nimport type { MessageWithMdEnforced } from '../../../lib/parseMessageTextToAstMarkdown';\\nimport { parseMessageTextToAstMarkdown } from '../../../lib/parseMessageTextToAstMarkdown';\\nimport { useAutoLinkDomains } from '../../../views/room/MessageList/hooks/useAutoLinkDomains';\\nimport { useAutoTranslate } from '../../../views/room/MessageList/hooks/useAutoTranslate';\\nimport { useKatex } from '../../../views/room/MessageList/hooks/useKatex';\\nimport { useSubscriptionFromMessageQuery } from './useSubscriptionFromMessageQuery';\\n\\nconst normalizeAttachments = (attachments: MessageAttachment[], name?: string, type?: string): MessageAttachment[] => {\\n\\tif (name) {\\n\\t\\tname = String.fromCharCode(...new TextEncoder().encode(name));\\n\\t}\\n\\n\\treturn attachments.map((attachment) => {\\n\\t\\tif (isQuoteAttachment(attachment) && attachment.attachments) {\\n\\t\\t\\tattachment.attachments = normalizeAttachments(attachment.attachments);\\n\\t\\t\\treturn attachment;\\n\\t\\t}\\n\\n\\t\\tif (!attachment.encryption) {\\n\\t\\t\\treturn attachment;\\n\\t\\t}\\n\\n\\t\\tconst key = Base64.encode(\\n\\t\\t\\tJSON.stringify({\\n\\t\\t\\t\\t...attachment.encryption,\\n\\t\\t\\t\\tname,\\n\\t\\t\\t\\ttype,\\n\\t\\t\\t}),\\n\\t\\t);\\n\\n\\t\\tif (isFileAttachment(attachment)) {\\n\\t\\t\\tif (attachment.title_link && !attachment.title_link.startsWith('/file-decrypt/')) {\\n\\t\\t\\t\\tattachment.title_link = `/file-decrypt${attachment.title_link}?key=${key}`;\\n\\t\\t\\t}\\n\\t\\t\\tif (isFileImageAttachment(attachment) && !attachment.image_url.startsWith('/file-decrypt/')) {\\n\\t\\t\\t\\tattachment.image_url = `/file-decrypt${attachment.image_url}?key=${key}`;\\n\\t\\t\\t}\\n\\t\\t\\tif (isFileAudioAttachment(attachment) && !attachment.audio_url.startsWith('/file-decrypt/')) {\\n\\t\\t\\t\\tattachment.audio_url = `/file-decrypt${attachment.audio_url}?key=${key}`;\\n\\t\\t\\t}\\n\\t\\t\\tif (isFileVideoAttachment(attachment) && !attachment.video_url.startsWith('/file-decrypt/')) {\\n\\t\\t\\t\\tattachment.video_url = `/file-decrypt${attachment.video_url}?key=${key}`;\\n\\t\\t\\t}\\n\\t\\t}\\n\\n\\t\\treturn attachment;\\n\\t});\\n};\\n\\nexport const useNormalizedMessage = <TMessage extends IMessage>(message: TMessage): MessageWithMdEnforced => {\\n\\tconst { katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled } = useKatex();\\n\\tconst customDomains = useAutoLinkDomains();\\n\\tconst subscription = useSubscriptionFromMessageQuery(message).data ?? undefined;\\n\\tconst autoTranslateOptions = useAutoTranslate(subscription);\\n\\tconst showColors = useSetting<boolean>('HexColorPreview_Enabled');\\n\\n\\treturn useMemo(() => {\\n\\t\\tconst parseOptions: Options = {\\n\\t\\t\\tcolors: showColors,\\n\\t\\t\\temoticons: true,\\n\\t\\t\\tcustomDomains,\\n\\t\\t\\t...(katexEnabled && {\\n\\t\\t\\t\\tkatex: {\\n\\t\\t\\t\\t\\tdollarSyntax: katexDollarSyntaxEnabled,\\n\\t\\t\\t\\t\\tparenthesisSyntax: katexParenthesisSyntaxEnabled,\\n\\t\\t\\t\\t},\\n\\t\\t\\t}),\\n\\t\\t};\\n\\n\\t\\tconst normalizedMessage = parseMessageTextToAstMarkdown(message, parseOptions, autoTranslateOptions);\\n\\n\\t\\tif (normalizedMessage.attachments) {\\n\\t\\t\\tnormalizedMessage.attachments = normalizeAttachments(\\n\\t\\t\\t\\tnormalizedMessage.attachments,\\n\\t\\t\\t\\tnormalizedMessage.file?.name,\\n\\t\\t\\t\\tnormalizedMessage.file?.type,\\n\\t\\t\\t);\\n\\t\\t}\\n\\n\\t\\treturn normalizedMessage;\\n\\t}, [showColors, customDomains, katexEnabled, katexDollarSyntaxEnabled, katexParenthesisSyntaxEnabled, message, autoTranslateOptions]);\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_objectSpread\",\"_toConsumableArray\",\"export\",\"useNormalizedMessage\",\"Base64\",\"isFileImageAttachment\",\"isFileAttachment\",\"isFileAudioAttachment\",\"isFileVideoAttachment\",\"isQuoteAttachment\",\"useSetting\",\"useMemo\",\"parseMessageTextToAstMarkdown\",\"useAutoLinkDomains\",\"useAutoTranslate\",\"useKatex\",\"useSubscriptionFromMessageQuery\",\"normalizeAttachments\",\"attachments\",\"name\",\"type\",\"String\",\"fromCharCode\",\"apply\",\"TextEncoder\",\"encode\",\"map\",\"attachment\",\"encryption\",\"key\",\"JSON\",\"stringify\",\"title_link\",\"startsWith\",\"image_url\",\"audio_url\",\"video_url\",\"message\",\"_useSubscriptionFromM\",\"_useKatex\",\"katexEnabled\",\"katexDollarSyntaxEnabled\",\"katexParenthesisSyntaxEnabled\",\"customDomains\",\"subscription\",\"data\",\"undefined\",\"autoTranslateOptions\",\"showColors\",\"_normalizedMessage$fi\",\"_normalizedMessage$fi2\",\"parseOptions\",\"colors\",\"emoticons\",\"katex\",\"dollarSyntax\",\"parenthesisSyntax\",\"normalizedMessage\",\"file\"],\"mappings\":\"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\"}"}