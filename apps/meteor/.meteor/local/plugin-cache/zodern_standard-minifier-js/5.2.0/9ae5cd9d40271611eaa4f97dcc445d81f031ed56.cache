{"code":"function module(e,n,t){var r,u,o,a,i,l,c,s,f,m,d,p,h,v,k,b,g,x,E,C,y=[\"onChange\",\"value\",\"placeholder\"];t.link(\"@babel/runtime/regenerator\",{default:function(e){r=e}},0),t.link(\"@babel/runtime/helpers/extends\",{default:function(e){u=e}},1),t.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){o=e}},2),t.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){a=e}},3),t.link(\"@babel/runtime/helpers/objectWithoutProperties\",{default:function(e){i=e}},4),t.link(\"@rocket.chat/fuselage\",{MultiSelectFiltered:function(e){l=e},Icon:function(e){c=e},Box:function(e){s=e},Chip:function(e){f=e}},0),t.link(\"@rocket.chat/fuselage-hooks\",{useDebouncedValue:function(e){m=e}},1),t.link(\"@rocket.chat/ui-avatar\",{UserAvatar:function(e){d=e}},2),t.link(\"@rocket.chat/ui-contexts\",{useEndpoint:function(e){p=e}},3),t.link(\"@tanstack/react-query\",{useQuery:function(e){h=e}},4),t.link(\"react\",{default:function(e){v=e},memo:function(e){k=e},useState:function(e){b=e},useCallback:function(e){g=e},useMemo:function(e){x=e}},5),t.link(\"./UserAutoCompleteMultipleOptions\",{default:function(e){E=e},OptionsContext:function(e){C=e}},6);var M=RegExp(\"@(.*:.*)\");t.exportDefault(k(function(e){var n=e.onChange,t=e.value,k=e.placeholder,S=i(e,y),w=b(\"\"),A=a(w,2),D=A[0],O=A[1],P=b({}),j=a(P,2),q=j[0],U=j[1],z=m(D,500),F=p(\"GET\",\"/v1/users.autocomplete\"),T=h([\"users.autocomplete\",z],function(){var e;return r.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.awrap(F({selector:JSON.stringify({term:z})}));case 2:return e=n.sent.items.map(function(e){return[e.username,e]}),M.test(z)&&e.unshift([z,{name:z,username:z,_federated:!0}]),n.abrupt(\"return\",e);case 6:case\"end\":return n.stop()}},null,null,null,Promise)},{keepPreviousData:!0}).data,_=x(function(){return T||[]},[T]),B=g(function(e){var n,t=null===(n=_.find(function(n){return a(n,1)[0]===e}))||void 0===n?void 0:n[1];if(!t)throw Error(\"UserAutoCompleteMultiple - onAddSelected - failed to cache option\");U(function(n){var r;return o(o({},n),{},((r={})[e]=t,r))})},[U,_]),G=g(function(e){return U(function(n){var t=o({},n);return delete t[e],t})},[U]),I=g(function(e){n(e);var r=e.filter(function(e){return!t.includes(e)})[0],u=t.filter(function(n){return!e.includes(n)})[0];O(\"\"),r&&B(r),u&&G(u)},[n,O,B,G,t]);return v.createElement(C.Provider,{value:{options:_}},v.createElement(l,u({},S,{\"data-qa-type\":\"user-auto-complete-input\",placeholder:k,value:t,onChange:I,filter:D,setFilter:O,renderSelected:function(e){var n=e.value,t=e.onMouseDown,r=q[n]||{};return v.createElement(f,{key:n,height:\"x20\",onMouseDown:t,mie:4,mb:2},r._federated?v.createElement(c,{size:\"x20\",name:\"globe\"}):v.createElement(d,{size:\"x20\",username:n}),v.createElement(s,{is:\"span\",margin:\"none\",mis:4},r.name||r.username||n))},renderOptions:E,options:_.concat(Object.entries(q)).map(function(e){var n=a(e,2)[1];return[n.username,n.name||n.username]}),\"data-qa\":\"create-channel-users-autocomplete\"})))}))}","map":"{\"version\":3,\"sources\":[\"client/components/UserAutoCompleteMultiple/UserAutoCompleteMultipleFederated.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { MultiSelectFiltered, Icon, Box, Chip } from '@rocket.chat/fuselage';\\nimport { useDebouncedValue } from '@rocket.chat/fuselage-hooks';\\nimport { UserAvatar } from '@rocket.chat/ui-avatar';\\nimport { useEndpoint } from '@rocket.chat/ui-contexts';\\nimport { useQuery } from '@tanstack/react-query';\\nimport type { ReactElement, AllHTMLAttributes } from 'react';\\nimport React, { memo, useState, useCallback, useMemo } from 'react';\\n\\nimport AutocompleteOptions, { OptionsContext } from './UserAutoCompleteMultipleOptions';\\n\\ntype UserAutoCompleteMultipleFederatedProps = {\\n\\tonChange: (value: Array<string>) => void;\\n\\tvalue: Array<string>;\\n\\tplaceholder?: string;\\n} & Omit<AllHTMLAttributes<HTMLElement>, 'is' | 'onChange'>;\\n\\ntype UserAutoCompleteOptionType = {\\n\\tname: string;\\n\\tusername: string;\\n\\t_federated?: boolean;\\n};\\n\\ntype UserAutoCompleteOptions = {\\n\\t[k: string]: UserAutoCompleteOptionType;\\n};\\n\\nconst matrixRegex = new RegExp('@(.*:.*)');\\n\\nconst UserAutoCompleteMultipleFederated = ({\\n\\tonChange,\\n\\tvalue,\\n\\tplaceholder,\\n\\t...props\\n}: UserAutoCompleteMultipleFederatedProps): ReactElement => {\\n\\tconst [filter, setFilter] = useState('');\\n\\tconst [selectedCache, setSelectedCache] = useState<UserAutoCompleteOptions>({});\\n\\n\\tconst debouncedFilter = useDebouncedValue(filter, 500);\\n\\tconst getUsers = useEndpoint('GET', '/v1/users.autocomplete');\\n\\n\\tconst { data } = useQuery(\\n\\t\\t['users.autocomplete', debouncedFilter],\\n\\t\\tasync () => {\\n\\t\\t\\tconst users = await getUsers({ selector: JSON.stringify({ term: debouncedFilter }) });\\n\\t\\t\\tconst options = users.items.map((item): [string, UserAutoCompleteOptionType] => [item.username, item]);\\n\\n\\t\\t\\t// Add extra option if filter text matches `username:server`\\n\\t\\t\\t// Used to add federated users that do not exist yet\\n\\t\\t\\tif (matrixRegex.test(debouncedFilter)) {\\n\\t\\t\\t\\toptions.unshift([debouncedFilter, { name: debouncedFilter, username: debouncedFilter, _federated: true }]);\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn options;\\n\\t\\t},\\n\\t\\t{ keepPreviousData: true },\\n\\t);\\n\\n\\tconst options = useMemo(() => data || [], [data]);\\n\\n\\tconst onAddUser = useCallback(\\n\\t\\t(username: string): void => {\\n\\t\\t\\tconst user = options.find(([val]) => val === username)?.[1];\\n\\t\\t\\tif (!user) {\\n\\t\\t\\t\\tthrow new Error('UserAutoCompleteMultiple - onAddSelected - failed to cache option');\\n\\t\\t\\t}\\n\\t\\t\\tsetSelectedCache((selectedCache) => ({ ...selectedCache, [username]: user }));\\n\\t\\t},\\n\\t\\t[setSelectedCache, options],\\n\\t);\\n\\n\\tconst onRemoveUser = useCallback(\\n\\t\\t(username: string): void =>\\n\\t\\t\\tsetSelectedCache((selectedCache) => {\\n\\t\\t\\t\\tconst users = { ...selectedCache };\\n\\t\\t\\t\\tdelete users[username];\\n\\t\\t\\t\\treturn users;\\n\\t\\t\\t}),\\n\\t\\t[setSelectedCache],\\n\\t);\\n\\n\\tconst handleOnChange = useCallback(\\n\\t\\t(usernames: string[]) => {\\n\\t\\t\\tonChange(usernames);\\n\\t\\t\\tconst newAddedUsername = usernames.filter((username) => !value.includes(username))[0];\\n\\t\\t\\tconst removedUsername = value.filter((username) => !usernames.includes(username))[0];\\n\\t\\t\\tsetFilter('');\\n\\t\\t\\tnewAddedUsername && onAddUser(newAddedUsername);\\n\\t\\t\\tremovedUsername && onRemoveUser(removedUsername);\\n\\t\\t},\\n\\t\\t[onChange, setFilter, onAddUser, onRemoveUser, value],\\n\\t);\\n\\n\\treturn (\\n\\t\\t<OptionsContext.Provider value={{ options }}>\\n\\t\\t\\t<MultiSelectFiltered\\n\\t\\t\\t\\t{...props}\\n\\t\\t\\t\\tdata-qa-type='user-auto-complete-input'\\n\\t\\t\\t\\tplaceholder={placeholder}\\n\\t\\t\\t\\tvalue={value}\\n\\t\\t\\t\\tonChange={handleOnChange}\\n\\t\\t\\t\\tfilter={filter}\\n\\t\\t\\t\\tsetFilter={setFilter}\\n\\t\\t\\t\\trenderSelected={({ value, onMouseDown }: { value: string; onMouseDown: () => void }) => {\\n\\t\\t\\t\\t\\tconst currentCachedOption = selectedCache[value] || {};\\n\\n\\t\\t\\t\\t\\treturn (\\n\\t\\t\\t\\t\\t\\t<Chip key={value} height='x20' onMouseDown={onMouseDown} mie={4} mb={2}>\\n\\t\\t\\t\\t\\t\\t\\t{currentCachedOption._federated ? <Icon size='x20' name='globe' /> : <UserAvatar size='x20' username={value} />}\\n\\t\\t\\t\\t\\t\\t\\t<Box is='span' margin='none' mis={4}>\\n\\t\\t\\t\\t\\t\\t\\t\\t{currentCachedOption.name || currentCachedOption.username || value}\\n\\t\\t\\t\\t\\t\\t\\t</Box>\\n\\t\\t\\t\\t\\t\\t</Chip>\\n\\t\\t\\t\\t\\t);\\n\\t\\t\\t\\t}}\\n\\t\\t\\t\\trenderOptions={AutocompleteOptions}\\n\\t\\t\\t\\toptions={options.concat(Object.entries(selectedCache)).map(([, item]) => [item.username, item.name || item.username])}\\n\\t\\t\\t\\tdata-qa='create-channel-users-autocomplete'\\n\\t\\t\\t/>\\n\\t\\t</OptionsContext.Provider>\\n\\t);\\n};\\n\\nexport default memo(UserAutoCompleteMultipleFederated);\\n\",null],\"names\":[\"_regeneratorRuntime\",\"_extends\",\"_objectSpread\",\"_slicedToArray\",\"_objectWithoutProperties\",\"MultiSelectFiltered\",\"Icon\",\"Box\",\"Chip\",\"useDebouncedValue\",\"UserAvatar\",\"useEndpoint\",\"useQuery\",\"React\",\"memo\",\"useState\",\"useCallback\",\"useMemo\",\"AutocompleteOptions\",\"OptionsContext\",\"module\",\"link\",\"default\",\"v\",\"matrixRegex\",\"RegExp\",\"exportDefault\",\"_ref\",\"onChange\",\"value\",\"placeholder\",\"props\",\"_excluded\",\"_useState\",\"_useState2\",\"filter\",\"setFilter\",\"_useState3\",\"_useState4\",\"selectedCache\",\"setSelectedCache\",\"debouncedFilter\",\"getUsers\",\"data\",\"_useQuery\",\"options\",\"async\",\"_context\",\"prev\",\"next\",\"awrap\",\"selector\",\"JSON\",\"stringify\",\"term\",\"users\",\"sent\",\"items\",\"map\",\"item\",\"username\",\"test\",\"unshift\",\"name\",\"_federated\",\"abrupt\",\"stop\",\"Promise\",\"keepPreviousData\",\"onAddUser\",\"_options$find\",\"user\",\"find\",\"_ref2\",\"val\",\"_ref3\",\"Error\",\"_objectSpread2\",\"onRemoveUser\",\"handleOnChange\",\"usernames\",\"newAddedUsername\",\"includes\",\"removedUsername\",\"createElement\",\"Provider\",\"renderSelected\",\"_ref4\",\"onMouseDown\",\"currentCachedOption\",\"key\",\"height\",\"mie\",\"mb\",\"size\",\"is\",\"margin\",\"mis\",\"renderOptions\",\"concat\",\"Object\",\"entries\",\"_ref5\",\"_ref6\"],\"mappings\":\"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\"}"}