{"code":"function module(e,t,l){var a,n;let i,o,s,r,u,b,d,c,p;l.link(\"@babel/runtime/helpers/taggedTemplateLiteral\",{default(e){i=e}},0),l.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){o=e}},1),l.export({useDateScroll:()=>f}),l.link(\"@rocket.chat/css-in-js\",{css(e){s=e}},0),l.link(\"@rocket.chat/fuselage-hooks\",{useSafely(e){r=e}},1),l.link(\"react\",{useCallback(e){u=e},useRef(e){b=e},useState(e){d=e}},2),l.link(\"../../../../lib/utils/highOrderFunctions\",{withThrottling(e){c=e}},3),l.link(\"../providers/DateListProvider\",{useDateListController(e){p=e}},4);let f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,[t,l]=r(d({date:\"\",show:!1,style:void 0,bubbleDateClassName:void 0,offset:0})),{list:f}=p(),g=b(null),h=u(t=>{var n;let r;if(!t)return;let u=(null===(n=g.current)||void 0===n?void 0:n.getBoundingClientRect().bottom)||0,b=t=>{clearTimeout(r);let[n,b,d]=[...t].reduce((t,l)=>{if(!l.dataset.id)return t;let{top:a,height:n}=l.getBoundingClientRect(),{id:i}=l.dataset;return a>u&&a<u+n?[t[0]||new Date(i).toISOString(),t[1]||l,{position:\"absolute\",top:\"\".concat(a-n-u+e,\"px\"),left:\" 50%\",translate:\"-50%\",zIndex:11}]:a<u+n?[new Date(i).toISOString(),l,{position:\"absolute\",top:\"\".concat(e,\"px\"),left:\" 50%\",translate:\"-50%\",zIndex:11}]:t},[]);if(l(e=>o(o(o({},e),{},{date:\"\"},n&&{date:n}),{},{show:!!n,style:d,bubbleDateClassName:s(a||(a=i([\"\\n\t\t\t\t\t\t\topacity: 0;\\n\t\t\t\t\t\t\ttransition: opacity 0.6s;\\n\t\t\t\t\t\t\t&.bubble-visible {\\n\t\t\t\t\t\t\t\topacity: 1;\\n\t\t\t\t\t\t\t}\\n\t\t\t\t\t\t\"])))})),b){let{top:e}=b.getBoundingClientRect();if(e<u&&e>0)return}r=setTimeout(()=>l(e=>o(o({},e),{},{show:!1})),1e3)},d=c({wait:30})(()=>{b(f)});t.addEventListener(\"scroll\",d,{passive:!0})},[f,e,l]),v=t.show&&t.date?s(n||(n=i([\"\\n\t\t\t\t\tposition: relative;\\n\t\t\t\t\t& [data-time='\",\"'] {\\n\t\t\t\t\t\topacity: 0;\\n\t\t\t\t\t}\\n\t\t\t  \"])),t.date.replaceAll(/[-T:.]/g,\"\").substring(0,8)):void 0;return{innerRef:h,bubbleRef:g,listStyle:v,bubbleDate:t.date,bubbleDateStyle:t.style,showBubble:!!t.show,bubbleDateClassName:t.bubbleDateClassName}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/hooks/useDateScroll.ts\",\"<anon>\"],\"sourcesContent\":[\"import { css } from '@rocket.chat/css-in-js';\\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\\nimport type { MutableRefObject } from 'react';\\nimport { useCallback, useRef, useState } from 'react';\\n\\nimport { withThrottling } from '../../../../lib/utils/highOrderFunctions';\\nimport { useDateListController } from '../providers/DateListProvider';\\n\\ntype useDateScrollReturn = {\\n\\tinnerRef: (node: HTMLElement | null) => void;\\n\\tbubbleRef: MutableRefObject<HTMLElement | null>;\\n\\tlistStyle?: ReturnType<typeof css>;\\n} & BubbleDateProps;\\n\\nexport type BubbleDateProps = {\\n\\tbubbleDate: string | undefined;\\n\\tbubbleDateClassName?: ReturnType<typeof css>;\\n\\tshowBubble: boolean;\\n\\tbubbleDateStyle?: React.CSSProperties;\\n};\\n\\nexport const useDateScroll = (margin = 8): useDateScrollReturn => {\\n\\tconst [bubbleDate, setBubbleDate] = useSafely(\\n\\t\\tuseState<{\\n\\t\\t\\tdate: string;\\n\\t\\t\\tshow: boolean;\\n\\t\\t\\tstyle?: React.CSSProperties;\\n\\t\\t\\tbubbleDateClassName?: ReturnType<typeof css>;\\n\\t\\t\\toffset: number;\\n\\t\\t}>({\\n\\t\\t\\tdate: '',\\n\\t\\t\\tshow: false,\\n\\t\\t\\tstyle: undefined,\\n\\t\\t\\tbubbleDateClassName: undefined,\\n\\t\\t\\toffset: 0,\\n\\t\\t}),\\n\\t);\\n\\n\\tconst { list } = useDateListController();\\n\\n\\tconst bubbleRef = useRef<HTMLElement>(null);\\n\\n\\tconst callbackRef = useCallback(\\n\\t\\t(node: HTMLElement | null) => {\\n\\t\\t\\tif (!node) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\tconst bubbleOffset = bubbleRef.current?.getBoundingClientRect().bottom || 0;\\n\\n\\t\\t\\tconst onScroll = (() => {\\n\\t\\t\\t\\tlet timeout: ReturnType<typeof setTimeout>;\\n\\t\\t\\t\\treturn (elements: Set<HTMLElement>) => {\\n\\t\\t\\t\\t\\tclearTimeout(timeout);\\n\\n\\t\\t\\t\\t\\t// Gets the first non visible message date and sets the bubble date to it\\n\\t\\t\\t\\t\\tconst [date, message, style] = [...elements].reduce((ret, message) => {\\n\\t\\t\\t\\t\\t\\t// Sanitize elements\\n\\t\\t\\t\\t\\t\\tif (!message.dataset.id) {\\n\\t\\t\\t\\t\\t\\t\\treturn ret;\\n\\t\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\t\\tconst { top, height } = message.getBoundingClientRect();\\n\\t\\t\\t\\t\\t\\tconst { id } = message.dataset;\\n\\n\\t\\t\\t\\t\\t\\t// if the bubble if between the divider and the top, position it at the top of the divider\\n\\t\\t\\t\\t\\t\\tif (top > bubbleOffset && top < bubbleOffset + height) {\\n\\t\\t\\t\\t\\t\\t\\treturn [\\n\\t\\t\\t\\t\\t\\t\\t\\tret[0] || new Date(id).toISOString(),\\n\\t\\t\\t\\t\\t\\t\\t\\tret[1] || message,\\n\\t\\t\\t\\t\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tposition: 'absolute',\\n\\t\\t\\t\\t\\t\\t\\t\\t\\ttop: `${top - height - bubbleOffset + margin}px`,\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tleft: ' 50%',\\n\\t\\t\\t\\t\\t\\t\\t\\t\\ttranslate: '-50%',\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tzIndex: 11,\\n\\t\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t\\t];\\n\\t\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\t\\tif (top < bubbleOffset + height) {\\n\\t\\t\\t\\t\\t\\t\\treturn [\\n\\t\\t\\t\\t\\t\\t\\t\\tnew Date(id).toISOString(),\\n\\t\\t\\t\\t\\t\\t\\t\\tmessage,\\n\\t\\t\\t\\t\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tposition: 'absolute',\\n\\t\\t\\t\\t\\t\\t\\t\\t\\ttop: `${margin}px`,\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tleft: ' 50%',\\n\\t\\t\\t\\t\\t\\t\\t\\t\\ttranslate: '-50%',\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tzIndex: 11,\\n\\t\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t\\t];\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\treturn ret;\\n\\t\\t\\t\\t\\t}, [] as [string, HTMLElement, { [key: number]: string | number }?] | []);\\n\\n\\t\\t\\t\\t\\t// We always keep the previous date if we don't have a new one, so when the bubble disappears it doesn't flicker\\n\\t\\t\\t\\t\\tsetBubbleDate((current) => ({\\n\\t\\t\\t\\t\\t\\t...current,\\n\\t\\t\\t\\t\\t\\tdate: '',\\n\\t\\t\\t\\t\\t\\t...(date && { date }),\\n\\t\\t\\t\\t\\t\\tshow: Boolean(date),\\n\\t\\t\\t\\t\\t\\tstyle,\\n\\t\\t\\t\\t\\t\\tbubbleDateClassName: css`\\n\\t\\t\\t\\t\\t\\t\\topacity: 0;\\n\\t\\t\\t\\t\\t\\t\\ttransition: opacity 0.6s;\\n\\t\\t\\t\\t\\t\\t\\t&.bubble-visible {\\n\\t\\t\\t\\t\\t\\t\\t\\topacity: 1;\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t`,\\n\\t\\t\\t\\t\\t}));\\n\\n\\t\\t\\t\\t\\tif (message) {\\n\\t\\t\\t\\t\\t\\tconst { top } = message.getBoundingClientRect();\\n\\t\\t\\t\\t\\t\\tif (top < bubbleOffset && top > 0) {\\n\\t\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\ttimeout = setTimeout(\\n\\t\\t\\t\\t\\t\\t() =>\\n\\t\\t\\t\\t\\t\\t\\tsetBubbleDate((current) => ({\\n\\t\\t\\t\\t\\t\\t\\t\\t...current,\\n\\t\\t\\t\\t\\t\\t\\t\\tshow: false,\\n\\t\\t\\t\\t\\t\\t\\t})),\\n\\t\\t\\t\\t\\t\\t1000,\\n\\t\\t\\t\\t\\t);\\n\\t\\t\\t\\t};\\n\\t\\t\\t})();\\n\\n\\t\\t\\tconst fn = withThrottling({ wait: 30 })(() => {\\n\\t\\t\\t\\tonScroll(list);\\n\\t\\t\\t});\\n\\n\\t\\t\\tnode.addEventListener('scroll', fn, { passive: true });\\n\\t\\t},\\n\\t\\t[list, margin, setBubbleDate],\\n\\t);\\n\\n\\tconst listStyle =\\n\\t\\tbubbleDate.show && bubbleDate.date\\n\\t\\t\\t? css`\\n\\t\\t\\t\\t\\tposition: relative;\\n\\t\\t\\t\\t\\t& [data-time='${bubbleDate.date.replaceAll(/[-T:.]/g, '').substring(0, 8)}'] {\\n\\t\\t\\t\\t\\t\\topacity: 0;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t  `\\n\\t\\t\\t: undefined;\\n\\n\\treturn {\\n\\t\\tinnerRef: callbackRef,\\n\\t\\tbubbleRef,\\n\\t\\tlistStyle,\\n\\t\\tbubbleDate: bubbleDate.date,\\n\\t\\tbubbleDateStyle: bubbleDate.style,\\n\\t\\tshowBubble: Boolean(bubbleDate.show),\\n\\t\\tbubbleDateClassName: bubbleDate.bubbleDateClassName,\\n\\t};\\n};\\n\",null],\"names\":[\"_taggedTemplateLiteral\",\"_objectSpread\",\"css\",\"useSafely\",\"useCallback\",\"useRef\",\"useState\",\"withThrottling\",\"useDateListController\",\"module\",\"link\",\"default\",\"v\",\"export\",\"useDateScroll\",\"margin\",\"arguments\",\"length\",\"undefined\",\"bubbleDate\",\"setBubbleDate\",\"date\",\"show\",\"style\",\"bubbleDateClassName\",\"offset\",\"list\",\"bubbleRef\",\"callbackRef\",\"node\",\"_bubbleRef$current\",\"timeout\",\"bubbleOffset\",\"current\",\"getBoundingClientRect\",\"bottom\",\"onScroll\",\"elements\",\"clearTimeout\",\"message\",\"reduce\",\"ret\",\"dataset\",\"id\",\"top\",\"height\",\"Date\",\"toISOString\",\"position\",\"concat\",\"left\",\"translate\",\"zIndex\",\"Boolean\",\"_templateObject\",\"setTimeout\",\"fn\",\"wait\",\"addEventListener\",\"passive\",\"listStyle\",\"_templateObject2\",\"replaceAll\",\"substring\",\"innerRef\",\"bubbleDateStyle\",\"showBubble\"],\"mappings\":\"mCAAAA,EAA6CC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAzBC,EAAAC,IAAA,CAAA,+CAAyB,CAAAC,QAAAC,CAAA,EAAAZ,EAAAY,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAC,QAAAC,CAAA,EAAAX,EAAAW,CAAA,CAAA,EAAA,GAA7CH,EAAOI,MAAK,CAAE,CAAAC,cAAMA,IAAAA,CAAyB,GAAAL,EAAAC,IAAA,CAAA,yBAAA,CAAAR,IAAAU,CAAA,EAAAV,EAAAU,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,8BAAA,CAAAP,UAAAS,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,QAAA,CAAAN,YAAAQ,CAAA,EAAAR,EAAAQ,CAAA,EAAAP,OAAAO,CAAA,EAAAP,EAAAO,CAAA,EAAAN,SAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,2CAAA,CAAAH,eAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,gCAAA,CAAAF,sBAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAqBtC,IAAME,EAAgB,WAAoC,IAAnCC,EAAMC,UAAAC,MAAA,CAAA,GAAAD,AAAAE,KAAAA,IAAAF,SAAA,CAAA,EAAA,CAAAA,SAAA,CAAA,EAAA,CAAG,EAChC,CAACG,EAAYC,EAAc,CAAGjB,EACnCG,EAMG,CACFe,KAAM,GACNC,KAAM,CAAA,EACNC,MAAOL,KAAAA,EACPM,oBAAqBN,KAAAA,EACrBO,OAAQ,KAIJ,CAAEC,KAAAA,CAAAA,CAAM,CAAGlB,IAEXmB,EAAYtB,EAAoB,MAEhCuB,EAAcxB,EAClByB,QAA4BC,MAOvBC,EANL,GAAI,CAACF,EACJ,OAED,IAAMG,EAAe,CAAA,AAAiB,OAAjBF,CAAAA,EAAAH,EAAUM,OAAO,AAAPA,GAAOH,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAjBA,EAAmBI,qBAAqB,GAAGC,MAAM,AAANA,GAAU,EAEpEC,EAEGC,IACPC,aAAaP,GAGb,GAAM,CAACV,EAAMkB,EAAShB,EAAM,CAAG,IAAIc,EAAS,CAACG,MAAM,CAAC,CAACC,EAAKF,KAEzD,GAAI,CAACA,EAAQG,OAAO,CAACC,EAAE,CACtB,OAAOF,EAGR,GAAM,CAAEG,IAAAA,CAAG,CAAEC,OAAAA,CAAAA,CAAQ,CAAGN,EAAQL,qBAAqB,GAC/C,CAAES,GAAAA,CAAAA,CAAI,CAAGJ,EAAQG,OAAO,QAG9B,AAAIE,EAAMZ,GAAgBY,EAAMZ,EAAea,EACvC,CACNJ,CAAG,CAAC,EAAE,EAAI,IAAIK,KAAKH,GAAII,WAAW,GAClCN,CAAG,CAAC,EAAE,EAAIF,EACV,CACCS,SAAU,WACVJ,IAAG,GAAAK,MAAA,CAAKL,EAAMC,EAASb,EAAejB,EAAM,MAC5CmC,KAAM,OACNC,UAAW,OACXC,OAAQ,IAET,CAGER,EAAMZ,EAAea,EACjB,CACN,IAAIC,KAAKH,GAAII,WAAW,GACxBR,EACA,CACCS,SAAU,WACVJ,IAAG,GAAAK,MAAA,CAAKlC,EAAM,MACdmC,KAAM,OACNC,UAAW,OACXC,OAAQ,IAET,CAEKX,CACR,EAAG,EAAqE,EAkBxE,GAfArB,EAAea,GAAOhC,EAAAA,EAAAA,EAAA,CAAA,EAClBgC,GAAO,CAAA,EAAA,CACVZ,KAAM,EAAE,EACJA,GAAQ,CAAEA,KAAAA,CAAI,GAAE,CAAA,EAAA,CACpBC,KAAM+B,CAAAA,CAAQhC,EACdE,MAAAA,EACAC,oBAAqBtB,EAAGoD,GAAAA,CAAAA,EAAAtD,EAAA,CAAA,2HAAA,CAAA,EAMvB,IAGEuC,EAAS,CACZ,GAAM,CAAEK,IAAAA,CAAAA,CAAK,CAAGL,EAAQL,qBAAqB,GAC7C,GAAIU,EAAMZ,GAAgBY,EAAM,EAC/B,MAEF,CAEAb,EAAUwB,WACT,IACCnC,EAAea,GAAOhC,EAAAA,EAAA,CAAA,EAClBgC,GAAO,CAAA,EAAA,CACVX,KAAM,CAAA,CAAK,IAEb,IAEF,EAGKkC,EAAKjD,EAAe,CAAEkD,KAAM,EAAE,GAAI,KACvCrB,EAASV,EACV,GAEAG,EAAK6B,gBAAgB,CAAC,SAAUF,EAAI,CAAEG,QAAS,CAAA,CAAI,EACpD,EACA,CAACjC,EAAMX,EAAQK,EAAc,EAGxBwC,EACLzC,EAAWG,IAAI,EAAIH,EAAWE,IAAI,CAC/BnB,EAAG2D,GAAAA,CAAAA,EAAA7D,EAAA,CAAA,kDAAA,yCAAA,CAAA,EAEamB,EAAWE,IAAI,CAACyC,UAAU,CAAC,UAAW,IAAIC,SAAS,CAAC,EAAG,IAIvE7C,KAAAA,EAEJ,MAAO,CACN8C,SAAUpC,EACVD,UAAAA,EACAiC,UAAAA,EACAzC,WAAYA,EAAWE,IAAI,CAC3B4C,gBAAiB9C,EAAWI,KAAK,CACjC2C,WAAYb,CAAAA,CAAQlC,EAAWG,IAAI,CACnCE,oBAAqBL,EAAWK,mBAAAA,CAElC\"}"}