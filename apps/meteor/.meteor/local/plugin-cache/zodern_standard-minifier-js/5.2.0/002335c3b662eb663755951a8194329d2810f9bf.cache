{"code":"function module(t,e,n){let o,a,r,s,i,c,d,l,u,p,_;n.link(\"@babel/runtime/helpers/objectSpread2\",{default(t){o=t}},0),n.export({useDepartmentsSection:()=>h}),n.link(\"@rocket.chat/ui-contexts\",{useEndpoint(t){a=t},useTranslation(t){r=t}},0),n.link(\"@tanstack/react-query\",{useQuery(t){s=t}},1),n.link(\"react\",{useMemo(t){i=t}},2),n.link(\"../../../components/dashboards/periods\",{getPeriodRange(t){c=t}},3),n.link(\"../../../components/dashboards/usePeriodSelectorStorage\",{usePeriodSelectorStorage(t){d=t}},4),n.link(\"../components/constants\",{COLORS(t){l=t},PERIOD_OPTIONS(t){u=t}},5),n.link(\"../utils/formatPeriodDescription\",{formatPeriodDescription(t){p=t}},6),n.link(\"./useDefaultDownload\",{useDefaultDownload(t){_=t}},7);let m=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.map(t=>o(o({},t),{},{color:l.info}))},h=()=>{var t;let e=r(),[n,l]=d(\"reports-department-period\",u),h=a(\"GET\",\"/v1/livechat/analytics/dashboards/conversations-by-department\"),{data:{data:S,total:b=0,unspecified:k=0}={data:[],total:0},isLoading:v,isError:D,isSuccess:y,refetch:f}=s([\"omnichannel-reports\",\"conversations-by-department\",n],async()=>{let{start:t,end:e}=c(n),a=await h({start:t.toISOString(),end:e.toISOString()});return o(o({},a),{},{data:m(a.data)})},{refetchInterval:3e5}),g=e(\"Conversations_by_department\"),O=e(\"__departments__departments_and__count__conversations__period__\",{departments:null!==(t=S.length)&&void 0!==t?t:0,count:b,period:p(n,e)}),P=k>0?\"(\".concat(e(\"__count__without__department__\",{count:k}),\")\"):\"\",I=\"\".concat(O,\" \").concat(P),R=e(\"Omnichannel_Reports_Departments_Empty_Subtitle\"),w=_({columnName:e(\"Departments\"),title:g,data:S,period:n});return i(()=>({id:\"conversations-by-department\",title:g,subtitle:I,emptyStateSubtitle:R,data:S,total:b,isLoading:v,isError:D,isDataFound:y&&S.length>0,periodSelectorProps:l,period:n,downloadProps:w,onRetry:f}),[g,I,R,S,b,v,D,y,l,n,w,f])}}","map":"{\"version\":3,\"sources\":[\"client/omnichannel/reports/hooks/useDepartmentsSection.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { useEndpoint, useTranslation } from '@rocket.chat/ui-contexts';\\nimport { useQuery } from '@tanstack/react-query';\\nimport { useMemo } from 'react';\\n\\nimport { getPeriodRange } from '../../../components/dashboards/periods';\\nimport { usePeriodSelectorStorage } from '../../../components/dashboards/usePeriodSelectorStorage';\\nimport { COLORS, PERIOD_OPTIONS } from '../components/constants';\\nimport { formatPeriodDescription } from '../utils/formatPeriodDescription';\\nimport { useDefaultDownload } from './useDefaultDownload';\\n\\nconst formatChartData = (data: { label: string; value: number }[] | undefined = []) =>\\n\\tdata.map((item) => ({\\n\\t\\t...item,\\n\\t\\tcolor: COLORS.info,\\n\\t}));\\n\\nexport const useDepartmentsSection = () => {\\n\\tconst t = useTranslation();\\n\\tconst [period, periodSelectorProps] = usePeriodSelectorStorage('reports-department-period', PERIOD_OPTIONS);\\n\\tconst getConversationsByDepartment = useEndpoint('GET', '/v1/livechat/analytics/dashboards/conversations-by-department');\\n\\n\\tconst {\\n\\t\\tdata: { data, total = 0, unspecified = 0 } = { data: [], total: 0 },\\n\\t\\tisLoading,\\n\\t\\tisError,\\n\\t\\tisSuccess,\\n\\t\\trefetch,\\n\\t} = useQuery(\\n\\t\\t['omnichannel-reports', 'conversations-by-department', period],\\n\\t\\tasync () => {\\n\\t\\t\\tconst { start, end } = getPeriodRange(period);\\n\\t\\t\\tconst response = await getConversationsByDepartment({ start: start.toISOString(), end: end.toISOString() });\\n\\t\\t\\treturn { ...response, data: formatChartData(response.data) };\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\trefetchInterval: 5 * 60 * 1000,\\n\\t\\t},\\n\\t);\\n\\n\\tconst title = t('Conversations_by_department');\\n\\tconst subtitleTotals = t('__departments__departments_and__count__conversations__period__', {\\n\\t\\tdepartments: data.length ?? 0,\\n\\t\\tcount: total,\\n\\t\\tperiod: formatPeriodDescription(period, t),\\n\\t});\\n\\tconst subtitleUnspecified = unspecified > 0 ? `(${t('__count__without__department__', { count: unspecified })})` : '';\\n\\tconst subtitle = `${subtitleTotals} ${subtitleUnspecified}`;\\n\\tconst emptyStateSubtitle = t('Omnichannel_Reports_Departments_Empty_Subtitle');\\n\\n\\tconst downloadProps = useDefaultDownload({ columnName: t('Departments'), title, data, period });\\n\\n\\treturn useMemo(\\n\\t\\t() => ({\\n\\t\\t\\tid: 'conversations-by-department',\\n\\t\\t\\ttitle,\\n\\t\\t\\tsubtitle,\\n\\t\\t\\temptyStateSubtitle,\\n\\t\\t\\tdata,\\n\\t\\t\\ttotal,\\n\\t\\t\\tisLoading,\\n\\t\\t\\tisError,\\n\\t\\t\\tisDataFound: isSuccess && data.length > 0,\\n\\t\\t\\tperiodSelectorProps,\\n\\t\\t\\tperiod,\\n\\t\\t\\tdownloadProps,\\n\\t\\t\\tonRetry: refetch,\\n\\t\\t}),\\n\\t\\t[title, subtitle, emptyStateSubtitle, data, total, isLoading, isError, isSuccess, periodSelectorProps, period, downloadProps, refetch],\\n\\t);\\n};\\n\",null],\"names\":[\"_objectSpread\",\"useEndpoint\",\"useTranslation\",\"useQuery\",\"useMemo\",\"getPeriodRange\",\"usePeriodSelectorStorage\",\"COLORS\",\"PERIOD_OPTIONS\",\"formatPeriodDescription\",\"useDefaultDownload\",\"module\",\"link\",\"default\",\"v\",\"export\",\"useDepartmentsSection\",\"formatChartData\",\"data\",\"arguments\",\"length\",\"undefined\",\"map\",\"item\",\"color\",\"info\",\"_data$length\",\"t\",\"period\",\"periodSelectorProps\",\"getConversationsByDepartment\",\"total\",\"unspecified\",\"isLoading\",\"isError\",\"isSuccess\",\"refetch\",\"start\",\"end\",\"response\",\"toISOString\",\"refetchInterval\",\"title\",\"subtitleTotals\",\"departments\",\"count\",\"subtitleUnspecified\",\"concat\",\"subtitle\",\"emptyStateSubtitle\",\"downloadProps\",\"columnName\",\"id\",\"isDataFound\",\"onRetry\"],\"mappings\":\"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\"}"}