{"code":"Package[\"core-runtime\"].queue(\"rocketchat:user-presence\",function(){Package.meteor.Meteor,Package.meteor.global,Package.meteor.meteorEnv,Package.tracker.Tracker,Package.tracker.Deps,Package.check.check,Package.check.Match;var e=Package.modules.meteorInstall;return Package.promise.Promise,{require:e({node_modules:{meteor:{\"rocketchat:user-presence\":{client:{\"client.js\":function e(e,t,a){let s,r,n,c,i,o;a.export({UserPresence:()=>l}),a.link(\"meteor/meteor\",{Meteor(e){s=e}},0),a.link(\"meteor/tracker\",{Tracker(e){r=e}},1),a.link(\"meteor/check\",{check(e){n=e}},2),a.link(\"./utils\",{debounce(e){c=e}},3);let l={awayTime:6e4,awayOnWindowBlur:!1,callbacks:[],connected:!0,started:!1,userId:null,onSetUserStatus(e){this.callbacks.push(e)},runCallbacks(e,t){this.callbacks.forEach(function(a){a.call(null,e,t)})},startTimer(){l.stopTimer(),l.awayTime&&(i=setTimeout(l.setAway,l.awayTime))},stopTimer(){clearTimeout(i)},restartTimer(){l.startTimer()},setAway:()=>u(\"away\"),setOnline:()=>u(\"online\"),start(e){this.start=()=>{this.startTimer()},this.userId=e,r.autorun(()=>{let{connected:e}=s.status();if(this.connected=e,e){this.startTimer(),o=\"online\";return}this.stopTimer(),o=\"offline\"}),[\"mousemove\",\"mousedown\",\"touchend\",\"keydown\"].forEach(e=>document.addEventListener(e,this.setOnline)),window.addEventListener(\"focus\",this.setOnline),!0===this.awayOnWindowBlur&&window.addEventListener(\"blur\",this.setAway)}},u=c(async e=>{if(!l.connected||e===o){l.startTimer();return}switch(e){case\"online\":await s.callAsync(\"UserPresence:online\",l.userId);break;case\"away\":await s.callAsync(\"UserPresence:away\",l.userId),l.stopTimer();break;default:return}o=e},1e3);s.methods({async \"UserPresence:setDefaultStatus\"(e){n(e,String),await s.users.updateAsync({_id:s.userId()},{$set:{status:e,statusDefault:e}})},async \"UserPresence:online\"(){let e=await s.userAsync();e&&\"online\"!==e.status&&\"online\"===e.statusDefault&&await s.users.updateAsync({_id:s.userId()},{$set:{status:\"online\"}}),l.runCallbacks(e,\"online\")},async \"UserPresence:away\"(){let e=await s.userAsync();l.runCallbacks(e,\"away\")}})},\"utils.js\":function e(e,t,a){a.export({debounce:()=>s});function s(e,t){let a;return function(){for(var s=arguments.length,r=Array(s),n=0;n<s;n++)r[n]=arguments[n];a&&clearTimeout(a),a=setTimeout(()=>e(...r),t)}}}}}}}},{extensions:[\".js\",\".json\"]}),eagerModulePaths:[\"/node_modules/meteor/rocketchat:user-presence/client/client.js\"],mainModulePath:\"/node_modules/meteor/rocketchat:user-presence/client/client.js\"}});","map":"{\"version\":3,\"sources\":[\"packages/rocketchat:user-presence/client/client.js\",\"packages/rocketchat:user-presence/client/utils.js\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\nimport { check } from 'meteor/check';\\n\\nimport { debounce } from './utils';\\n\\nlet timer;\\nlet status;\\n\\nexport const UserPresence = {\\n\\tawayTime: 60000, // 1 minute\\n\\tawayOnWindowBlur: false,\\n\\tcallbacks: [],\\n\\tconnected: true,\\n\\tstarted: false,\\n\\tuserId: null,\\n\\n\\t/**\\n\\t * The callback will receive the following parameters: user, status\\n\\t */\\n\\tonSetUserStatus(callback) {\\n\\t\\tthis.callbacks.push(callback);\\n\\t},\\n\\n\\trunCallbacks(user, status) {\\n\\t\\tthis.callbacks.forEach(function (callback) {\\n\\t\\t\\tcallback.call(null, user, status);\\n\\t\\t});\\n\\t},\\n\\n\\tstartTimer() {\\n\\t\\tUserPresence.stopTimer();\\n\\t\\tif (!UserPresence.awayTime) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\ttimer = setTimeout(UserPresence.setAway, UserPresence.awayTime);\\n\\t},\\n\\tstopTimer() {\\n\\t\\tclearTimeout(timer);\\n\\t},\\n\\trestartTimer() {\\n\\t\\tUserPresence.startTimer();\\n\\t},\\n\\t// eslint-disable-next-line no-use-before-define\\n\\tsetAway: () => setUserPresence('away'),\\n\\t// eslint-disable-next-line no-use-before-define\\n\\tsetOnline: () => setUserPresence('online'),\\n\\tstart(userId) {\\n\\t\\t// after first call overwrite start function to only call startTimer\\n\\t\\tthis.start = () => {\\n\\t\\t\\tthis.startTimer();\\n\\t\\t};\\n\\t\\tthis.userId = userId;\\n\\n\\t\\t// register a tracker on connection status so we can setup the away timer again (on reconnect)\\n\\t\\tTracker.autorun(() => {\\n\\t\\t\\tconst { connected } = Meteor.status();\\n\\t\\t\\tthis.connected = connected;\\n\\t\\t\\tif (connected) {\\n\\t\\t\\t\\tthis.startTimer();\\n\\t\\t\\t\\tstatus = 'online';\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\tthis.stopTimer();\\n\\t\\t\\tstatus = 'offline';\\n\\t\\t});\\n\\n\\t\\t['mousemove', 'mousedown', 'touchend', 'keydown'].forEach((key) => document.addEventListener(key, this.setOnline));\\n\\n\\t\\twindow.addEventListener('focus', this.setOnline);\\n\\n\\t\\tif (this.awayOnWindowBlur === true) {\\n\\t\\t\\twindow.addEventListener('blur', this.setAway);\\n\\t\\t}\\n\\t},\\n};\\n\\nconst setUserPresence = debounce(async (newStatus) => {\\n\\tif (!UserPresence.connected || newStatus === status) {\\n\\t\\tUserPresence.startTimer();\\n\\t\\treturn;\\n\\t}\\n\\tswitch (newStatus) {\\n\\t\\tcase 'online':\\n\\t\\t\\tawait Meteor.callAsync('UserPresence:online', UserPresence.userId);\\n\\t\\t\\tbreak;\\n\\t\\tcase 'away':\\n\\t\\t\\tawait Meteor.callAsync('UserPresence:away', UserPresence.userId);\\n\\t\\t\\tUserPresence.stopTimer();\\n\\t\\t\\tbreak;\\n\\t\\tdefault:\\n\\t\\t\\treturn;\\n\\t}\\n\\tstatus = newStatus;\\n}, 1000);\\n\\nMeteor.methods({\\n\\tasync 'UserPresence:setDefaultStatus'(status) {\\n\\t\\tcheck(status, String);\\n\\t\\tawait Meteor.users.updateAsync({ _id: Meteor.userId() }, { $set: { status, statusDefault: status } });\\n\\t},\\n\\tasync 'UserPresence:online'() {\\n\\t\\tconst user = await Meteor.userAsync();\\n\\t\\tif (user && user.status !== 'online' && user.statusDefault === 'online') {\\n\\t\\t\\tawait Meteor.users.updateAsync({ _id: Meteor.userId() }, { $set: { status: 'online' } });\\n\\t\\t}\\n\\t\\tUserPresence.runCallbacks(user, 'online');\\n\\t},\\n\\tasync 'UserPresence:away'() {\\n\\t\\tconst user = await Meteor.userAsync();\\n\\t\\tUserPresence.runCallbacks(user, 'away');\\n\\t},\\n});\\n\",\"export function debounce(func, wait) {\\n\\tlet timeout;\\n\\n\\treturn (...args) => {\\n\\t\\tif (timeout) clearTimeout(timeout);\\n\\t\\ttimeout = setTimeout(() => func(...args), wait);\\n\\t};\\n}\\n\",null],\"names\":[\"Meteor\",\"Tracker\",\"check\",\"debounce\",\"timer\",\"status\",\"module\",\"export\",\"UserPresence\",\"link\",\"v\",\"awayTime\",\"awayOnWindowBlur\",\"callbacks\",\"connected\",\"started\",\"userId\",\"onSetUserStatus\",\"callback\",\"push\",\"runCallbacks\",\"user\",\"forEach\",\"call\",\"startTimer\",\"stopTimer\",\"setTimeout\",\"setAway\",\"clearTimeout\",\"restartTimer\",\"setUserPresence\",\"setOnline\",\"start\",\"autorun\",\"key\",\"document\",\"addEventListener\",\"window\",\"newStatus\",\"callAsync\",\"methods\",\"String\",\"users\",\"updateAsync\",\"_id\",\"$set\",\"statusDefault\",\"userAsync\",\"func\",\"wait\",\"timeout\",\"_len\",\"arguments\",\"length\",\"args\",\"Array\",\"_key\"],\"mappings\":\"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\"}"}