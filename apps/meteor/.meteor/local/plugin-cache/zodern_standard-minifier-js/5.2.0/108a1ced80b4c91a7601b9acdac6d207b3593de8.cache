{"code":"function module(e,i,n){let o,t,s,a,l,r,d,u,c,C,f,g,V,k;n.export({useVideoCallAction:()=>m}),n.link(\"@rocket.chat/core-typings\",{isRoomFederated(e){o=e}},0),n.link(\"@rocket.chat/ui-contexts\",{useTranslation(e){t=e},useUserRoom(e){s=e},useUserId(e){a=e},useUserSubscriptionByName(e){l=e},useSetting(e){r=e},usePermission(e){d=e}},1),n.link(\"react\",{useMemo(e){u=e}},2),n.link(\"../../../../../contexts/VideoConfContext\",{useVideoConfDispatchOutgoing(e){c=e},useVideoConfIsCalling(e){C=e},useVideoConfIsRinging(e){f=e}},3),n.link(\"../../../../../lib/VideoConfManager\",{VideoConfManager(e){g=e}},4),n.link(\"../../../contexts/UserCardContext\",{useUserCard(e){V=e}},5),n.link(\"../../../contextualBar/VideoConference/hooks/useVideoConfWarning\",{useVideoConfWarning(e){k=e}},6);let m=e=>{var i;let n=t(),m=l(null!==(i=e.username)&&void 0!==i?i:\"\"),x=s((null==m?void 0:m.rid)||\"\"),{closeUserCard:_}=V(),p=k(),v=c(),h=C(),y=f(),U=a(),b=r(\"VideoConf_Enable_DMs\"),M=d(\"call-management\",null==x?void 0:x._id),I=u(()=>{let i=async()=>{if(!h&&!y&&x)try{await g.loadCapabilities(),_(),v({rid:x._id})}catch(e){p(e.error)}},t=x&&!o(x)&&e._id!==U&&b&&M&&!h&&!y;return t?{type:\"communication\",title:n(\"Video_call\"),icon:\"video\",onClick:i}:void 0},[x,e._id,U,b,M,h,y,n,v,p,_]);return I}}","map":"{\"version\":3,\"sources\":[\"client/views/room/hooks/useUserInfoActions/actions/useVideoCallAction.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { IUser } from '@rocket.chat/core-typings';\\nimport { isRoomFederated } from '@rocket.chat/core-typings';\\nimport { useTranslation, useUserRoom, useUserId, useUserSubscriptionByName, useSetting, usePermission } from '@rocket.chat/ui-contexts';\\nimport { useMemo } from 'react';\\n\\nimport { useVideoConfDispatchOutgoing, useVideoConfIsCalling, useVideoConfIsRinging } from '../../../../../contexts/VideoConfContext';\\nimport { VideoConfManager } from '../../../../../lib/VideoConfManager';\\nimport { useUserCard } from '../../../contexts/UserCardContext';\\nimport { useVideoConfWarning } from '../../../contextualBar/VideoConference/hooks/useVideoConfWarning';\\nimport type { UserInfoAction } from '../useUserInfoActions';\\n\\nexport const useVideoCallAction = (user: Pick<IUser, '_id' | 'username'>): UserInfoAction | undefined => {\\n\\tconst t = useTranslation();\\n\\tconst usernameSubscription = useUserSubscriptionByName(user.username ?? '');\\n\\tconst room = useUserRoom(usernameSubscription?.rid || '');\\n\\tconst { closeUserCard } = useUserCard();\\n\\n\\tconst dispatchWarning = useVideoConfWarning();\\n\\tconst dispatchPopup = useVideoConfDispatchOutgoing();\\n\\tconst isCalling = useVideoConfIsCalling();\\n\\tconst isRinging = useVideoConfIsRinging();\\n\\tconst ownUserId = useUserId();\\n\\n\\tconst enabledForDMs = useSetting('VideoConf_Enable_DMs');\\n\\tconst permittedToCallManagement = usePermission('call-management', room?._id);\\n\\n\\tconst videoCallOption = useMemo<UserInfoAction | undefined>(() => {\\n\\t\\tconst action = async (): Promise<void> => {\\n\\t\\t\\tif (isCalling || isRinging || !room) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\ttry {\\n\\t\\t\\t\\tawait VideoConfManager.loadCapabilities();\\n\\t\\t\\t\\tcloseUserCard();\\n\\t\\t\\t\\tdispatchPopup({ rid: room._id });\\n\\t\\t\\t} catch (error: any) {\\n\\t\\t\\t\\tdispatchWarning(error.error);\\n\\t\\t\\t}\\n\\t\\t};\\n\\n\\t\\tconst shouldShowStartCall =\\n\\t\\t\\troom && !isRoomFederated(room) && user._id !== ownUserId && enabledForDMs && permittedToCallManagement && !isCalling && !isRinging;\\n\\n\\t\\treturn shouldShowStartCall\\n\\t\\t\\t? {\\n\\t\\t\\t\\t\\ttype: 'communication',\\n\\t\\t\\t\\t\\ttitle: t('Video_call'),\\n\\t\\t\\t\\t\\ticon: 'video',\\n\\t\\t\\t\\t\\tonClick: action,\\n\\t\\t\\t  }\\n\\t\\t\\t: undefined;\\n\\t}, [\\n\\t\\troom,\\n\\t\\tuser._id,\\n\\t\\townUserId,\\n\\t\\tenabledForDMs,\\n\\t\\tpermittedToCallManagement,\\n\\t\\tisCalling,\\n\\t\\tisRinging,\\n\\t\\tt,\\n\\t\\tdispatchPopup,\\n\\t\\tdispatchWarning,\\n\\t\\tcloseUserCard,\\n\\t]);\\n\\n\\treturn videoCallOption;\\n};\\n\",null],\"names\":[\"isRoomFederated\",\"useTranslation\",\"useUserRoom\",\"useUserId\",\"useUserSubscriptionByName\",\"useSetting\",\"usePermission\",\"useMemo\",\"useVideoConfDispatchOutgoing\",\"useVideoConfIsCalling\",\"useVideoConfIsRinging\",\"VideoConfManager\",\"useUserCard\",\"useVideoConfWarning\",\"module\",\"export\",\"useVideoCallAction\",\"link\",\"v\",\"user\",\"_user$username\",\"t\",\"usernameSubscription\",\"username\",\"room\",\"rid\",\"closeUserCard\",\"dispatchWarning\",\"dispatchPopup\",\"isCalling\",\"isRinging\",\"ownUserId\",\"enabledForDMs\",\"permittedToCallManagement\",\"_id\",\"videoCallOption\",\"action\",\"loadCapabilities\",\"error\",\"shouldShowStartCall\",\"type\",\"title\",\"icon\",\"onClick\",\"undefined\"],\"mappings\":\"2BAC4DA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA5DC,EAAOC,MAAE,CAAA,CAAAC,mBAAuBA,IAAAA,CAAA,GAA4BF,EAAAG,IAAA,CAAA,4BAAA,CAAAjB,gBAAAkB,CAAA,EAAAlB,EAAAkB,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,2BAAA,CAAAhB,eAAAiB,CAAA,EAAAjB,EAAAiB,CAAA,EAAAhB,YAAAgB,CAAA,EAAAhB,EAAAgB,CAAA,EAAAf,UAAAe,CAAA,EAAAf,EAAAe,CAAA,EAAAd,0BAAAc,CAAA,EAAAd,EAAAc,CAAA,EAAAb,WAAAa,CAAA,EAAAb,EAAAa,CAAA,EAAAZ,cAAAY,CAAA,EAAAZ,EAAAY,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,QAAA,CAAAV,QAAAW,CAAA,EAAAX,EAAAW,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,2CAAA,CAAAT,6BAAAU,CAAA,EAAAV,EAAAU,CAAA,EAAAT,sBAAAS,CAAA,EAAAT,EAAAS,CAAA,EAAAR,sBAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,sCAAA,CAAAN,iBAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,oCAAA,CAAAL,YAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,mEAAA,CAAAJ,oBAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAUrD,IAAMF,EAAsBG,IAAqE,IAAAC,EACvG,IAAMC,EAAIpB,IACJqB,EAAuBlB,EAAyB,AAAc,OAAdgB,CAAAA,EAACD,EAAKI,QAAQ,AAARA,GAAQH,AAAA,KAAA,IAAAA,EAAAA,EAAI,IAClEI,EAAOtB,EAAY,AAAAoB,CAAAA,MAAAA,EAAoB,KAAA,EAApBA,EAAsBG,GAAG,AAAHA,GAAO,IAChD,CAAEC,cAAAA,CAAAA,CAAe,CAAGd,IAEpBe,EAAkBd,IAClBe,EAAgBpB,IAChBqB,EAAYpB,IACZqB,EAAYpB,IACZqB,EAAY5B,IAEZ6B,EAAgB3B,EAAW,wBAC3B4B,EAA4B3B,EAAc,kBAAmBkB,MAAAA,EAAI,KAAA,EAAJA,EAAMU,GAAG,EAEtEC,EAAkB5B,EAAoC,KAC3D,IAAM6B,EAAS,UACd,GAAIP,CAAAA,IAAaC,GAAcN,EAI/B,GAAI,CACH,MAAMb,EAAiB0B,gBAAgB,GACvCX,IACAE,EAAc,CAAEH,IAAKD,EAAKU,GAAAA,AAAG,EAC9B,CAAE,MAAOI,EAAY,CACpBX,EAAgBW,EAAMA,KAAK,CAC5B,CACD,EAEMC,EACLf,GAAQ,CAACxB,EAAgBwB,IAASL,EAAKe,GAAG,GAAKH,GAAaC,GAAiBC,GAA6B,CAACJ,GAAa,CAACC,EAE1H,OAAOS,EACJ,CACAC,KAAM,gBACNC,MAAOpB,EAAE,cACTqB,KAAM,QACNC,QAASP,GAETQ,KAAAA,CACJ,EAAG,CACFpB,EACAL,EAAKe,GAAG,CACRH,EACAC,EACAC,EACAJ,EACAC,EACAT,EACAO,EACAD,EACAD,EACA,EAED,OAAOS,CACR\"}"}