{"code":"function module(e,o,t){let n,a,i,s,r,l,E,m,d,c,p,u,_,S,k,R,T,b,y,f,g;t.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){n=e}},0),t.export({useE2EERoomAction:()=>v}),t.link(\"@rocket.chat/core-typings\",{isRoomFederated(e){a=e}},0),t.link(\"@rocket.chat/fuselage-hooks\",{useEffectEvent(e){i=e}},1),t.link(\"@rocket.chat/ui-contexts\",{useSetting(e){s=e},usePermission(e){r=e},useEndpoint(e){l=e}},2),t.link(\"react\",{useMemo(e){E=e}},3),t.link(\"react-i18next\",{useTranslation(e){m=e}},4),t.link(\"../../../app/e2e/client/E2EEState\",{E2EEState(e){d=e}},5),t.link(\"../../../app/e2e/client/E2ERoomState\",{E2ERoomState(e){c=e}},6),t.link(\"../../../app/otr/lib/OtrRoomState\",{OtrRoomState(e){p=e}},7),t.link(\"../../lib/getRoomTypeTranslation\",{getRoomTypeTranslation(e){u=e}},8),t.link(\"../../lib/imperativeModal\",{imperativeModal(e){_=e}},9),t.link(\"../../lib/toast\",{dispatchToastMessage(e){S=e}},10),t.link(\"../../views/room/contexts/RoomContext\",{useRoom(e){k=e},useRoomSubscription(e){R=e}},11),t.link(\"../../views/room/hooks/useE2EERoomState\",{useE2EERoomState(e){T=e}},12),t.link(\"../../views/room/hooks/useE2EEState\",{useE2EEState(e){b=e}},13),t.link(\"../../views/room/modals/E2EEModals/BaseDisableE2EEModal\",{default(e){y=e}},14),t.link(\"../../views/room/modals/E2EEModals/EnableE2EEModal\",{default(e){f=e}},15),t.link(\"../useOTR\",{useOTR(e){g=e}},16);let v=()=>{let e=s(\"E2E_Enable\",!1),o=k(),t=R(),v=b(),A=T(o._id),O=v===d.READY||v===d.SAVE_PASSWORD,D=O||o.encrypted,h=r(\"toggle-room-e2e-encryption\",o._id),M=r(\"edit-room\",o._id),w=(\"d\"===o.t||M&&h)&&D,N=a(o),{t:C}=m(),{otrState:I}=g(),x=!!o.encrypted,B=E(()=>{var e;return null===(e=u(o))||void 0===e?void 0:e.toLowerCase()},[o]),L=o._id,P=l(\"POST\",\"/v1/rooms.saveRoomSettings\"),W=e&&O&&(\"d\"===o.t||h)&&(A===c.NO_PASSWORD_SET||A===c.NOT_STARTED||A===c.DISABLED||A===c.ERROR||A===c.WAITING_KEYS),G=i(async()=>{if(I===p.ESTABLISHED||I===p.ESTABLISHING||I===p.REQUESTED){S({type:\"error\",message:C(\"E2EE_not_available_OTR\")});return}x?_.open({component:y,props:{onClose:_.close,onConfirm:H,roomType:B,roomId:L,canResetRoomKey:W}}):_.open({component:f,props:{onClose:_.close,onConfirm:H,roomType:B}})}),H=async()=>{let{success:e}=await P({rid:o._id,encrypted:!o.encrypted});e&&(_.close(),S({type:\"success\",message:o.encrypted?C(\"E2E_Encryption_disabled_for_room\",{roomName:o.name}):C(\"E2E_Encryption_enabled_for_room\",{roomName:o.name})}),null!=t&&t.autoTranslate&&S({type:\"success\",message:C(\"AutoTranslate_Disabled_for_room\",{roomName:o.name})}))};return E(()=>{if(e&&w)return n({id:\"e2e\",groups:[\"direct\",\"direct_multiple\",\"group\",\"team\"],title:x?\"E2E_disable\":\"E2E_enable\",icon:\"key\",order:13,action:G,type:\"organization\"},N&&{tooltip:C(\"core.E2E_unavailable_for_federation\"),disabled:!0})},[e,w,N,C,x,G])}}","map":"{\"version\":3,\"sources\":[\"client/hooks/roomActions/useE2EERoomAction.ts\",\"<anon>\"],\"sourcesContent\":[\"import { isRoomFederated } from '@rocket.chat/core-typings';\\nimport { useEffectEvent } from '@rocket.chat/fuselage-hooks';\\nimport { useSetting, usePermission, useEndpoint } from '@rocket.chat/ui-contexts';\\nimport { useMemo } from 'react';\\nimport { useTranslation } from 'react-i18next';\\n\\nimport { E2EEState } from '../../../app/e2e/client/E2EEState';\\nimport { E2ERoomState } from '../../../app/e2e/client/E2ERoomState';\\nimport { OtrRoomState } from '../../../app/otr/lib/OtrRoomState';\\nimport { getRoomTypeTranslation } from '../../lib/getRoomTypeTranslation';\\nimport { imperativeModal } from '../../lib/imperativeModal';\\nimport { dispatchToastMessage } from '../../lib/toast';\\nimport { useRoom, useRoomSubscription } from '../../views/room/contexts/RoomContext';\\nimport type { RoomToolboxActionConfig } from '../../views/room/contexts/RoomToolboxContext';\\nimport { useE2EERoomState } from '../../views/room/hooks/useE2EERoomState';\\nimport { useE2EEState } from '../../views/room/hooks/useE2EEState';\\nimport BaseDisableE2EEModal from '../../views/room/modals/E2EEModals/BaseDisableE2EEModal';\\nimport EnableE2EEModal from '../../views/room/modals/E2EEModals/EnableE2EEModal';\\nimport { useOTR } from '../useOTR';\\n\\nexport const useE2EERoomAction = () => {\\n\\tconst enabled = useSetting('E2E_Enable', false);\\n\\tconst room = useRoom();\\n\\tconst subscription = useRoomSubscription();\\n\\tconst e2eeState = useE2EEState();\\n\\tconst e2eeRoomState = useE2EERoomState(room._id);\\n\\tconst isE2EEReady = e2eeState === E2EEState.READY || e2eeState === E2EEState.SAVE_PASSWORD;\\n\\tconst readyToEncrypt = isE2EEReady || room.encrypted;\\n\\tconst permittedToToggleEncryption = usePermission('toggle-room-e2e-encryption', room._id);\\n\\tconst permittedToEditRoom = usePermission('edit-room', room._id);\\n\\tconst permitted = (room.t === 'd' || (permittedToEditRoom && permittedToToggleEncryption)) && readyToEncrypt;\\n\\tconst federated = isRoomFederated(room);\\n\\tconst { t } = useTranslation();\\n\\tconst { otrState } = useOTR();\\n\\n\\tconst isE2EERoomNotReady = () => {\\n\\t\\tif (\\n\\t\\t\\te2eeRoomState === E2ERoomState.NO_PASSWORD_SET ||\\n\\t\\t\\te2eeRoomState === E2ERoomState.NOT_STARTED ||\\n\\t\\t\\te2eeRoomState === E2ERoomState.DISABLED ||\\n\\t\\t\\te2eeRoomState === E2ERoomState.ERROR ||\\n\\t\\t\\te2eeRoomState === E2ERoomState.WAITING_KEYS\\n\\t\\t) {\\n\\t\\t\\treturn true;\\n\\t\\t}\\n\\n\\t\\treturn false;\\n\\t};\\n\\n\\tconst enabledOnRoom = !!room.encrypted;\\n\\n\\tconst roomType = useMemo(() => getRoomTypeTranslation(room)?.toLowerCase(), [room]);\\n\\n\\tconst roomId = room._id;\\n\\n\\tconst toggleE2E = useEndpoint('POST', '/v1/rooms.saveRoomSettings');\\n\\n\\tconst canResetRoomKey = enabled && isE2EEReady && (room.t === 'd' || permittedToToggleEncryption) && isE2EERoomNotReady();\\n\\n\\tconst action = useEffectEvent(async () => {\\n\\t\\tif (otrState === OtrRoomState.ESTABLISHED || otrState === OtrRoomState.ESTABLISHING || otrState === OtrRoomState.REQUESTED) {\\n\\t\\t\\tdispatchToastMessage({ type: 'error', message: t('E2EE_not_available_OTR') });\\n\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tif (enabledOnRoom) {\\n\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\tcomponent: BaseDisableE2EEModal,\\n\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\tonClose: imperativeModal.close,\\n\\t\\t\\t\\t\\tonConfirm: handleToogleE2E,\\n\\t\\t\\t\\t\\troomType,\\n\\t\\t\\t\\t\\troomId,\\n\\t\\t\\t\\t\\tcanResetRoomKey,\\n\\t\\t\\t\\t},\\n\\t\\t\\t});\\n\\t\\t} else {\\n\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\tcomponent: EnableE2EEModal,\\n\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\tonClose: imperativeModal.close,\\n\\t\\t\\t\\t\\tonConfirm: handleToogleE2E,\\n\\t\\t\\t\\t\\troomType,\\n\\t\\t\\t\\t},\\n\\t\\t\\t});\\n\\t\\t}\\n\\t});\\n\\n\\tconst handleToogleE2E = async () => {\\n\\t\\tconst { success } = await toggleE2E({ rid: room._id, encrypted: !room.encrypted });\\n\\t\\tif (!success) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\timperativeModal.close();\\n\\n\\t\\tdispatchToastMessage({\\n\\t\\t\\ttype: 'success',\\n\\t\\t\\tmessage: room.encrypted\\n\\t\\t\\t\\t? t('E2E_Encryption_disabled_for_room', { roomName: room.name })\\n\\t\\t\\t\\t: t('E2E_Encryption_enabled_for_room', { roomName: room.name }),\\n\\t\\t});\\n\\n\\t\\tif (subscription?.autoTranslate) {\\n\\t\\t\\tdispatchToastMessage({ type: 'success', message: t('AutoTranslate_Disabled_for_room', { roomName: room.name }) });\\n\\t\\t}\\n\\t};\\n\\n\\treturn useMemo((): RoomToolboxActionConfig | undefined => {\\n\\t\\tif (!enabled || !permitted) {\\n\\t\\t\\treturn undefined;\\n\\t\\t}\\n\\n\\t\\treturn {\\n\\t\\t\\tid: 'e2e',\\n\\t\\t\\tgroups: ['direct', 'direct_multiple', 'group', 'team'],\\n\\t\\t\\ttitle: enabledOnRoom ? 'E2E_disable' : 'E2E_enable',\\n\\t\\t\\ticon: 'key',\\n\\t\\t\\torder: 13,\\n\\t\\t\\taction,\\n\\t\\t\\ttype: 'organization',\\n\\t\\t\\t...(federated && {\\n\\t\\t\\t\\ttooltip: t('core.E2E_unavailable_for_federation'),\\n\\t\\t\\t\\tdisabled: true,\\n\\t\\t\\t}),\\n\\t\\t};\\n\\t}, [enabled, permitted, federated, t, enabledOnRoom, action]);\\n};\\n\",null],\"names\":[\"_objectSpread\",\"isRoomFederated\",\"useEffectEvent\",\"useSetting\",\"usePermission\",\"useEndpoint\",\"useMemo\",\"useTranslation\",\"E2EEState\",\"E2ERoomState\",\"OtrRoomState\",\"getRoomTypeTranslation\",\"imperativeModal\",\"dispatchToastMessage\",\"useRoom\",\"useRoomSubscription\",\"useE2EERoomState\",\"useE2EEState\",\"BaseDisableE2EEModal\",\"EnableE2EEModal\",\"useOTR\",\"module\",\"link\",\"default\",\"v\",\"export\",\"useE2EERoomAction\",\"enabled\",\"room\",\"subscription\",\"e2eeState\",\"e2eeRoomState\",\"_id\",\"isE2EEReady\",\"READY\",\"SAVE_PASSWORD\",\"readyToEncrypt\",\"encrypted\",\"permittedToToggleEncryption\",\"permittedToEditRoom\",\"permitted\",\"t\",\"federated\",\"otrState\",\"enabledOnRoom\",\"roomType\",\"_getRoomTypeTranslati\",\"toLowerCase\",\"roomId\",\"toggleE2E\",\"canResetRoomKey\",\"NO_PASSWORD_SET\",\"NOT_STARTED\",\"DISABLED\",\"ERROR\",\"WAITING_KEYS\",\"action\",\"ESTABLISHED\",\"ESTABLISHING\",\"REQUESTED\",\"type\",\"message\",\"open\",\"component\",\"props\",\"onClose\",\"close\",\"onConfirm\",\"handleToogleE2E\",\"success\",\"rid\",\"roomName\",\"name\",\"autoTranslate\",\"id\",\"groups\",\"title\",\"icon\",\"order\",\"tooltip\",\"disabled\"],\"mappings\":\"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\"}"}