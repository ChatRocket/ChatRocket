{"code":"function module(e,i,o){o.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){n=e}},0),o.export({useAudioMessageAction:function(){return p}}),o.link(\"@rocket.chat/fuselage-hooks\",{useMutableCallback:function(e){t=e}},0),o.link(\"@rocket.chat/ui-contexts\",{useSetting:function(e){u=e}},1),o.link(\"react\",{useEffect:function(e){c=e},useMemo:function(e){l=e}},2),o.link(\"../../../../../../../app/ui/client/lib/recorderjs/AudioRecorder\",{AudioRecorder:function(e){a=e}},3),o.link(\"../../../../contexts/ChatContext\",{useChat:function(e){d=e}},4),o.link(\"../../hooks/useMediaActionTitle\",{useMediaActionTitle:function(e){s=e}},5),o.link(\"../../hooks/useMediaPermissions\",{useMediaPermissions:function(e){r=e}},6);var n,t,u,c,l,a,d,s,r,f=new a,p=function(e,i){var o=u(\"FileUpload_Enabled\"),a=u(\"Message_AudioRecorderEnabled\"),p=u(\"FileUpload_MediaTypeBlackList\"),k=u(\"FileUpload_MediaTypeWhiteList\"),m=r(\"microphone\"),h=n(m,1)[0],M=l(function(){return!!(f.isSupported()&&!i&&o&&a&&!(null!=p&&p.match(/audio\\/mp3|audio\\/\\*/i))&&(!k||k.match(/audio\\/mp3|audio\\/\\*/i)))},[p,k,a,o,i]),v=s(\"audio\",h,o,a,M),b=d(),g=t(function(){var e;null==b||b.action.stop(\"recording\"),null==b||null===(e=b.composer)||void 0===e||e.setRecordingMode(!1)}),A=t(function(e){var i;e&&g(),null==b||null===(i=b.composer)||void 0===i||i.setIsMicrophoneDenied(e)});return c(function(){A(h)},[A,h]),{id:\"audio-message\",content:v,icon:\"mic\",disabled:!M||!!e,onClick:function(){var e;return null==b?void 0:null===(e=b.composer)||void 0===e?void 0:e.setRecordingMode(!0)}}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/composer/messageBox/MessageBoxActionsToolbar/hooks/useAudioMessageAction.ts\",\"<anon>\"],\"sourcesContent\":[\"import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\\nimport type { GenericMenuItemProps } from '@rocket.chat/ui-client';\\nimport { useSetting } from '@rocket.chat/ui-contexts';\\nimport { useEffect, useMemo } from 'react';\\n\\nimport { AudioRecorder } from '../../../../../../../app/ui/client/lib/recorderjs/AudioRecorder';\\nimport { useChat } from '../../../../contexts/ChatContext';\\nimport { useMediaActionTitle } from '../../hooks/useMediaActionTitle';\\nimport { useMediaPermissions } from '../../hooks/useMediaPermissions';\\n\\nconst audioRecorder = new AudioRecorder();\\n\\nexport const useAudioMessageAction = (disabled: boolean, isMicrophoneDenied: boolean): GenericMenuItemProps => {\\n\\tconst isFileUploadEnabled = useSetting('FileUpload_Enabled') as boolean;\\n\\tconst isAudioRecorderEnabled = useSetting('Message_AudioRecorderEnabled') as boolean;\\n\\tconst fileUploadMediaTypeBlackList = useSetting('FileUpload_MediaTypeBlackList') as string;\\n\\tconst fileUploadMediaTypeWhiteList = useSetting('FileUpload_MediaTypeWhiteList') as string;\\n\\tconst [isPermissionDenied] = useMediaPermissions('microphone');\\n\\n\\tconst isAllowed = useMemo(\\n\\t\\t() =>\\n\\t\\t\\tBoolean(\\n\\t\\t\\t\\taudioRecorder.isSupported() &&\\n\\t\\t\\t\\t\\t!isMicrophoneDenied &&\\n\\t\\t\\t\\t\\tisFileUploadEnabled &&\\n\\t\\t\\t\\t\\tisAudioRecorderEnabled &&\\n\\t\\t\\t\\t\\t!fileUploadMediaTypeBlackList?.match(/audio\\\\/mp3|audio\\\\/\\\\*/i) &&\\n\\t\\t\\t\\t\\t(!fileUploadMediaTypeWhiteList || fileUploadMediaTypeWhiteList.match(/audio\\\\/mp3|audio\\\\/\\\\*/i)),\\n\\t\\t\\t),\\n\\t\\t[fileUploadMediaTypeBlackList, fileUploadMediaTypeWhiteList, isAudioRecorderEnabled, isFileUploadEnabled, isMicrophoneDenied],\\n\\t);\\n\\n\\tconst getMediaActionTitle = useMediaActionTitle('audio', isPermissionDenied, isFileUploadEnabled, isAudioRecorderEnabled, isAllowed);\\n\\n\\tconst chat = useChat();\\n\\n\\tconst stopRecording = useMutableCallback(() => {\\n\\t\\tchat?.action.stop('recording');\\n\\n\\t\\tchat?.composer?.setRecordingMode(false);\\n\\t});\\n\\n\\tconst setMicrophoneDenied = useMutableCallback((isDenied) => {\\n\\t\\tif (isDenied) {\\n\\t\\t\\tstopRecording();\\n\\t\\t}\\n\\n\\t\\tchat?.composer?.setIsMicrophoneDenied(isDenied);\\n\\t});\\n\\n\\tuseEffect(() => {\\n\\t\\tsetMicrophoneDenied(isPermissionDenied);\\n\\t}, [setMicrophoneDenied, isPermissionDenied]);\\n\\n\\tconst handleRecordButtonClick = () => chat?.composer?.setRecordingMode(true);\\n\\n\\treturn {\\n\\t\\tid: 'audio-message',\\n\\t\\tcontent: getMediaActionTitle,\\n\\t\\ticon: 'mic',\\n\\t\\tdisabled: !isAllowed || Boolean(disabled),\\n\\t\\tonClick: handleRecordButtonClick,\\n\\t};\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_slicedToArray\",\"export\",\"useAudioMessageAction\",\"useMutableCallback\",\"useSetting\",\"useEffect\",\"useMemo\",\"AudioRecorder\",\"useChat\",\"useMediaActionTitle\",\"useMediaPermissions\",\"audioRecorder\",\"disabled\",\"isMicrophoneDenied\",\"isFileUploadEnabled\",\"isAudioRecorderEnabled\",\"fileUploadMediaTypeBlackList\",\"fileUploadMediaTypeWhiteList\",\"_useMediaPermissions\",\"isPermissionDenied\",\"_useMediaPermissions2\",\"isAllowed\",\"Boolean\",\"isSupported\",\"match\",\"getMediaActionTitle\",\"chat\",\"stopRecording\",\"_chat$composer\",\"action\",\"stop\",\"composer\",\"setRecordingMode\",\"setMicrophoneDenied\",\"isDenied\",\"_chat$composer2\",\"setIsMicrophoneDenied\",\"id\",\"content\",\"icon\",\"onClick\",\"_chat$composer3\"],\"mappings\":\"uBAASA,EAAAC,IAAoB,CAAA,uCAAoC,CAAAC,QAAA,SAAAC,CAAA,EAAAC,EAAAD,CAAA,CAAA,EAAA,GAAjEH,EAAOK,MAAE,CAAA,CAAAC,sBAA0B,WAAA,OAAAA,CAA8B,CAAA,GAAAN,EAAAC,IAAA,CAAA,8BAAA,CAAAM,mBAAA,SAAAJ,CAAA,EAAAI,EAAAJ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,2BAAA,CAAAO,WAAA,SAAAL,CAAA,EAAAK,EAAAL,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,QAAA,CAAAQ,UAAA,SAAAN,CAAA,EAAAM,EAAAN,CAAA,EAAAO,QAAA,SAAAP,CAAA,EAAAO,EAAAP,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,kEAAA,CAAAU,cAAA,SAAAR,CAAA,EAAAQ,EAAAR,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,mCAAA,CAAAW,QAAA,SAAAT,CAAA,EAAAS,EAAAT,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,kCAAA,CAAAY,oBAAA,SAAAV,CAAA,EAAAU,EAAAV,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,kCAAA,CAAAa,oBAAA,SAAAX,CAAA,EAAAW,EAAAX,CAAA,CAAA,EAAA,GAUjE,IAVAC,EAAiEG,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAU3DC,EAAgB,IAAIJ,EAEbL,EAAwB,SAACU,CAAiB,CAAEC,CAA2B,EACnF,IAAMC,EAAsBV,EAAW,sBACjCW,EAAyBX,EAAW,gCACpCY,EAA+BZ,EAAW,iCAC1Ca,EAA+Bb,EAAW,iCAChDc,EAA6BR,EAAoB,cAA1CS,EAAkBC,AAAqCpB,EAAAkB,EAAA,EAArC,CAAA,EAAA,CAEnBG,EAAYf,EACjB,WAAA,MACCgB,CAAAA,CACCX,CAAAA,EAAcY,WAAW,IACxB,CAACV,GACDC,GACAC,GACA,CAACC,CAAAA,MAAAA,GAAAA,EAA8BQ,KAAK,CAAC,wBAAuB,GAC3D,CAAA,CAACP,GAAgCA,EAA6BO,KAAK,CAAC,wBAAuB,CAAC,CAC9F,EACF,CAACR,EAA8BC,EAA8BF,EAAwBD,EAAqBD,EAAmB,EAGxHY,EAAsBhB,EAAoB,QAASU,EAAoBL,EAAqBC,EAAwBM,GAEpHK,EAAOlB,IAEPmB,EAAgBxB,EAAmB,WAAK,IAAAyB,CAC7CF,OAAAA,GAAAA,EAAMG,MAAM,CAACC,IAAI,CAAC,aAElBJ,MAAAA,GAAI,AAAU,OAAVE,CAAAA,EAAJF,EAAMK,QAAQ,AAARA,GAAQH,AAAA,KAAA,IAAAA,GAAdA,EAAgBI,gBAAgB,CAAC,CAAA,EAClC,GAEMC,EAAsB9B,EAAmB,SAAC+B,CAAQ,EAAI,IAAAC,EACvDD,GACHP,IAGDD,MAAAA,GAAI,AAAU,OAAVS,CAAAA,EAAJT,EAAMK,QAAQ,AAARA,GAAQI,AAAA,KAAA,IAAAA,GAAdA,EAAgBC,qBAAqB,CAACF,EACvC,UAEA7B,EAAU,WACT4B,EAAoBd,EACrB,EAAG,CAACc,EAAqBd,EAAmB,EAIrC,CACNkB,GAAI,gBACJC,QAASb,EACTc,KAAM,MACN3B,SAAU,CAACS,GAAaC,CAAAA,CAAQV,EAChC4B,QAP+B,WAAA,IAAAC,EAAA,OAAMf,MAAAA,EAAI,KAAA,EAAA,AAAU,OAAVe,CAAAA,EAAJf,EAAMK,QAAQ,AAARA,GAAQU,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAdA,EAAgBT,gBAAgB,CAAC,CAAA,EAAK,EAS7E\"}"}