{"code":"function module(e,t,n){n.link(\"@babel/runtime/helpers/toConsumableArray\",{default:function(e){o=e}},0),n.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){i=e}},1),n.link(\"@babel/runtime/helpers/inheritsLoose\",{default:function(e){r=e}},2),n.export({WebRTC:function(){return I}}),n.link(\"@rocket.chat/emitter\",{Emitter:function(e){a=e}},0),n.link(\"meteor/meteor\",{Meteor:function(e){s=e}},1),n.link(\"meteor/reactive-var\",{ReactiveVar:function(e){c=e}},2),n.link(\"meteor/tracker\",{Tracker:function(e){d=e}},3),n.link(\"../../../client/components/GenericModal\",{default:function(e){l=e}},4),n.link(\"../../../client/lib/imperativeModal\",{imperativeModal:function(e){h=e}},5),n.link(\"../../../client/lib/utils/goToRoomById\",{goToRoomById:function(e){m=e}},6),n.link(\"../../models/client\",{ChatSubscription:function(e){u=e}},7),n.link(\"../../settings/client\",{settings:function(e){f=e}},8),n.link(\"../../utils/client/lib/SDKClient\",{sdk:function(e){v=e}},9),n.link(\"../../utils/lib/i18n\",{t:function(e){p=e}},10),n.link(\"../lib/constants\",{WEB_RTC_EVENTS:function(e){g=e}},11),n.link(\"./screenShare\",{ChromeScreenShare:function(e){C=e}},12);var o,i,r,a,s,c,d,l,h,m,u,f,v,p,g,C,b=function(e){function t(t){var n;return(n=e.call(this)||this).webrtcInstance=void 0,n.debug=!1,n.webrtcInstance=t,v.stream(\"notify-room\",[n.webrtcInstance.room+\"/\"+g.WEB_RTC],function(e,t){n.log(\"WebRTCTransportClass - onRoom\",e,t),n.emit(e,t)}),n}r(t,e);var n=t.prototype;return n.log=function(){if(!0===this.debug){var e;(e=console).log.apply(e,arguments)}},n.onUserStream=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=t[0],i=t[1];if(i.room===this.webrtcInstance.room)switch(this.log(\"WebRTCTransportClass - onUser\",o,i),o){case\"candidate\":this.emit(\"candidate\",i);break;case\"description\":this.emit(\"description\",i);break;case\"join\":this.emit(\"join\",i)}},n.startCall=function(e){this.log(\"WebRTCTransportClass - startCall\",this.webrtcInstance.room,this.webrtcInstance.selfId),v.publish(\"notify-room-users\",[this.webrtcInstance.room+\"/\"+g.WEB_RTC,g.CALL,{from:this.webrtcInstance.selfId,room:this.webrtcInstance.room,media:e.media,monitor:e.monitor}])},n.joinCall=function(e){this.log(\"WebRTCTransportClass - joinCall\",this.webrtcInstance.room,this.webrtcInstance.selfId),!0===e.monitor?v.publish(\"notify-user\",[e.to+\"/\"+g.WEB_RTC,g.JOIN,{from:this.webrtcInstance.selfId,room:this.webrtcInstance.room,media:e.media,monitor:e.monitor}]):v.publish(\"notify-room-users\",[this.webrtcInstance.room+\"/\"+g.WEB_RTC,g.JOIN,{from:this.webrtcInstance.selfId,room:this.webrtcInstance.room,media:e.media,monitor:e.monitor}])},n.sendCandidate=function(e){e.from=this.webrtcInstance.selfId,e.room=this.webrtcInstance.room,this.log(\"WebRTCTransportClass - sendCandidate\",e),v.publish(\"notify-user\",[e.to+\"/\"+g.WEB_RTC,g.CANDIDATE,e])},n.sendDescription=function(e){e.from=this.webrtcInstance.selfId,e.room=this.webrtcInstance.room,this.log(\"WebRTCTransportClass - sendDescription\",e),v.publish(\"notify-user\",[e.to+\"/\"+g.WEB_RTC,g.DESCRIPTION,e])},n.sendStatus=function(e){this.log(\"WebRTCTransportClass - sendStatus\",e,this.webrtcInstance.room),e.from=this.webrtcInstance.selfId,v.publish(\"notify-room\",[this.webrtcInstance.room+\"/\"+g.WEB_RTC,g.STATUS,e])},n.onRemoteCall=function(e){return this.on(g.CALL,e)},n.onRemoteJoin=function(e){return this.on(g.JOIN,e)},n.onRemoteCandidate=function(e){return this.on(g.CANDIDATE,e)},n.onRemoteDescription=function(e){return this.on(g.DESCRIPTION,e)},n.onRemoteStatus=function(e){return this.on(g.STATUS,e)},t}(a),S=function(){function e(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.selfId=void 0,this.room=void 0,this.autoAccept=void 0,this.transport=void 0,this.config=void 0,this.debug=void 0,this.TransportClass=void 0,this.peerConnections={},this.remoteItems=void 0,this.remoteItemsById=void 0,this.callInProgress=void 0,this.audioEnabled=void 0,this.videoEnabled=void 0,this.overlayEnabled=void 0,this.screenShareEnabled=void 0,this.localUrl=void 0,this.active=void 0,this.remoteMonitoring=void 0,this.monitor=void 0,this.navigator=void 0,this.screenShareAvailable=void 0,this.media=void 0,this.resetCallInProgress=function(){n.callInProgress.set(!1)},this.callInProgressTimeout=void 0,this.audioContext=void 0,this.stopPeerConnection=function(e){var t=n.peerConnections[e];null!=t&&(delete n.peerConnections[e],t.close(),n.updateRemoteItems())},this.localStream=void 0,this.selfId=e,this.room=t,this.autoAccept=o,this.config={iceServers:[]},this.debug=!1,this.TransportClass=b;var r=f.get(\"WebRTC_Servers\");r&&\"\"!==r.trim()&&(r=r.replace(/\\s/g,\"\")).split(\",\").forEach(function(e){var t=e.split(\"@\"),o={urls:t.pop()};if(1===t.length){var r=t[0].split(\":\"),a=i(r,2),s=a[0],c=a[1];o.username=decodeURIComponent(s),o.credential=decodeURIComponent(c)}n.config.iceServers.push(o)}),this.peerConnections={},this.remoteItems=new c([]),this.remoteItemsById=new c({}),this.callInProgress=new c(!1),this.audioEnabled=new c(!1),this.videoEnabled=new c(!1),this.overlayEnabled=new c(!1),this.screenShareEnabled=new c(!1),this.localUrl=new c(void 0),this.active=!1,this.remoteMonitoring=!1,this.monitor=!1,this.navigator=void 0;var a=navigator.userAgent.toLocaleLowerCase();-1!==a.indexOf(\"electron\")?this.navigator=\"electron\":-1!==a.indexOf(\"chrome\")?this.navigator=\"chrome\":-1!==a.indexOf(\"firefox\")?this.navigator=\"firefox\":-1!==a.indexOf(\"safari\")&&(this.navigator=\"safari\"),this.screenShareAvailable=[\"chrome\",\"firefox\",\"electron\"].includes(this.navigator),this.media={video:!0,audio:!0},this.transport=new this.TransportClass(this),this.transport.onRemoteCall(this.onRemoteCall.bind(this)),this.transport.onRemoteJoin(this.onRemoteJoin.bind(this)),this.transport.onRemoteCandidate(this.onRemoteCandidate.bind(this)),this.transport.onRemoteDescription(this.onRemoteDescription.bind(this)),this.transport.onRemoteStatus(this.onRemoteStatus.bind(this)),setInterval(this.checkPeerConnections.bind(this),1e3)}var t=e.prototype;return t.onUserStream=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=t[0],i=t[1];switch(o){case\"candidate\":this.transport.onUserStream(\"candidate\",i);break;case\"description\":this.transport.onUserStream(\"description\",i);break;case\"join\":this.transport.onUserStream(\"join\",i)}},t.log=function(){if(!0===this.debug){var e;(e=console).log.apply(e,arguments)}},t.onError=function(){var e;(e=console).error.apply(e,arguments)},t.checkPeerConnections=function(){var e=this,t=this.peerConnections,n=Date.now();Object.entries(t).some(function(t){var o=i(t,2),r=o[0],a=o[1];return![\"connected\",\"completed\"].includes(a.iceConnectionState)&&a.createdAt+5e3<n&&(e.stopPeerConnection(r),!0)})},t.updateRemoteItems=function(){var e=[],t={};Object.entries(this.peerConnections).forEach(function(n){var o=i(n,2),r=o[0],a=o[1];a.getRemoteStreams().forEach(function(n){var o={id:r,url:n,state:a.iceConnectionState};switch(a.iceConnectionState){case\"checking\":o.stateText=\"Connecting...\";break;case\"connected\":case\"completed\":o.stateText=\"Connected\",o.connected=!0;break;case\"disconnected\":o.stateText=\"Disconnected\";break;case\"failed\":o.stateText=\"Failed\";break;case\"closed\":o.stateText=\"Closed\"}e.push(o),t[r]=o})}),this.remoteItems.set(e),this.remoteItemsById.set(t)},t.broadcastStatus=function(){if(!0===this.active&&!0!==this.monitor&&!0!==this.remoteMonitoring){var e=[];Object.entries(this.peerConnections).forEach(function(t){var n=i(t,2),o=n[0],r=n[1].remoteMedia;e.push({id:o,media:r})}),this.transport.sendStatus({media:this.media,remoteConnections:e})}},t.onRemoteStatus=function(e){var t=this;this.callInProgress.set(!0),clearTimeout(this.callInProgressTimeout),this.callInProgressTimeout=setTimeout(this.resetCallInProgress,2e3),!0===this.active&&[{id:e.from,media:e.media}].concat(o(e.remoteConnections)).forEach(function(e){e.id!==t.selfId&&null==t.peerConnections[e.id]&&(t.log(\"reconnecting with\",e.id),t.onRemoteJoin({from:e.id,media:e.media}))})},t.getPeerConnection=function(e){var t=this;if(null!=this.peerConnections[e])return this.peerConnections[e];var n=new RTCPeerConnection(this.config);return n.createdAt=Date.now(),n.remoteMedia={},this.peerConnections[e]=n,[\"icecandidate\",\"addstream\",\"removestream\",\"iceconnectionstatechange\",\"datachannel\",\"identityresult\",\"idpassertionerror\",\"idpvalidationerror\",\"negotiationneeded\",\"peeridentity\",\"signalingstatechange\"].forEach(function(o){n.addEventListener(o,function(n){t.log(e,n.type,n)})}),n.addEventListener(\"icecandidate\",function(n){null!=n.candidate&&t.transport.sendCandidate({to:e,candidate:{candidate:n.candidate.candidate,sdpMLineIndex:n.candidate.sdpMLineIndex,sdpMid:n.candidate.sdpMid}})}),n.addEventListener(\"addstream\",function(){t.updateRemoteItems()}),n.addEventListener(\"removestream\",function(){t.updateRemoteItems()}),n.addEventListener(\"iceconnectionstatechange\",function(){(\"disconnected\"===n.iceConnectionState||\"closed\"===n.iceConnectionState)&&n===t.peerConnections[e]&&(t.stopPeerConnection(e),setTimeout(function(){0===Object.keys(t.peerConnections).length&&t.stop()},3e3)),t.updateRemoteItems()}),n},t._getUserMedia=function(e,t,n){var o,i,r,a=this,s=function(e){if(AudioContext&&e.getAudioTracks().length>0){var n=new AudioContext,o=n.createMediaStreamSource(e),i=n.createGain();o.connect(i);var r=n.createMediaStreamDestination();i.connect(r),i.gain.value=.6,e.removeTrack(e.getAudioTracks()[0]),e.addTrack(r.stream.getAudioTracks()[0]),e.volume=i,a.audioContext=n}t(e)};if(null!==(o=navigator.mediaDevices)&&void 0!==o&&o.getUserMedia)return navigator.mediaDevices.getUserMedia(e).then(s).catch(n);null===(i=(r=navigator).getUserMedia)||void 0===i||i.call(r,e,s,n)},t.getUserMedia=function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.onError;if(!0!==e.desktop){this._getUserMedia(e,t,o);return}if(!0!==this.screenShareAvailable){console.log(\"Screen share is not avaliable\");return}var i=function(i){var r=function(){h.open({component:l,props:{variant:\"warning\",title:p(\"Refresh_your_page_after_install_to_enable_screen_sharing\")}})},a=\"chrome\"===n.navigator&&C.installed,s=\"firefox\"===n.navigator&&null!=window.rocketchatscreenshare;if(!a&&!s)return h.open({component:l,props:{title:p(\"Screen_Share\"),variant:\"warning\",confirmText:p(\"Install_Extension\"),cancelText:p(\"Cancel\"),children:p(\"You_need_install_an_extension_to_allow_screen_sharing\"),onConfirm:function(){if(\"chrome\"===n.navigator){var e=\"https://chrome.google.com/webstore/detail/rocketchat-screen-share/nocfbnnmjnndkbipkabodnheejiegccf\";try{chrome.webstore.install(e,r,function(){window.open(e),r()})}catch(t){console.log(t),window.open(e),r()}}else\"firefox\"===n.navigator&&(window.open(\"https://addons.mozilla.org/en-GB/firefox/addon/rocketchat-screen-share/\"),r())}}}),o(!1);var c=function(e){null!=i&&e.addTrack(i.getAudioTracks()[0]),t(e)};\"firefox\"===n.navigator?(e={audio:e.audio,video:{mozMediaSource:\"window\",mediaSource:\"window\"}},n._getUserMedia(e,c,o)):C.getSourceId(n.navigator,function(t){e={audio:!1,video:{mandatory:{chromeMediaSource:\"desktop\",chromeMediaSourceId:t,maxWidth:1280,maxHeight:720}}},n._getUserMedia(e,c,o)})};\"firefox\"===this.navigator||null==e.audio||!1===e.audio?i():this._getUserMedia({audio:e.audio},function(e){i(e)},function(){i()})},t.getLocalUserMedia=function(e){for(var t=this,n=arguments.length,o=Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];if(this.log(\"getLocalUserMedia\",[e].concat(o)),null!=this.localStream)return e(null,this.localStream);this.getUserMedia(this.media,function(n){t.localStream=n,t.audioEnabled.get()||t.disableAudio(),t.videoEnabled.get()||t.disableVideo(),t.localUrl.set(n),Object.entries(t.peerConnections).forEach(function(e){return i(e,2)[1].addStream(n)}),document.querySelector(\"video#localVideo\").srcObject=n,e(null,t.localStream)},function(n){e(!1),t.onError(n)})},t.stopAllPeerConnections=function(){var e;Object.keys(this.peerConnections).forEach(this.stopPeerConnection),null===(e=window.audioContext)||void 0===e||e.close()},t.setAudioEnabled=function(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];null!=this.localStream&&(this.localStream.getAudioTracks().forEach(function(t){t.enabled=e}),this.audioEnabled.set(e))},t.disableAudio=function(){this.setAudioEnabled(!1)},t.enableAudio=function(){this.setAudioEnabled(!0)},t.toggleAudio=function(){return this.audioEnabled.get()?this.disableAudio():this.enableAudio()},t.setVideoEnabled=function(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];null!=this.localStream&&(this.localStream.getVideoTracks().forEach(function(t){t.enabled=e}),this.videoEnabled.set(e))},t.disableScreenShare=function(){this.setScreenShareEnabled(!1)},t.enableScreenShare=function(){this.setScreenShareEnabled(!0)},t.setScreenShareEnabled=function(){var e=this,t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];null!=this.localStream&&(this.media.desktop=t,delete this.localStream,this.getLocalUserMedia(function(n){null==n&&(e.screenShareEnabled.set(t),e.stopAllPeerConnections(),e.joinCall())}))},t.disableVideo=function(){this.setVideoEnabled(!1)},t.enableVideo=function(){this.setVideoEnabled(!0)},t.toggleVideo=function(){return this.videoEnabled.get()?this.disableVideo():this.enableVideo()},t.stop=function(){this.active=!1,this.monitor=!1,this.remoteMonitoring=!1,null!=this.localStream&&void 0!==this.localStream&&this.localStream.getTracks().forEach(function(e){return e.stop()}),this.localUrl.set(void 0),delete this.localStream,this.stopAllPeerConnections()},t.startCall=function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];this.log(\"startCall\",[t].concat(o)),this.media=t,this.getLocalUserMedia(function(){e.active=!0,e.transport.startCall({media:e.media})})},t.startCallAsMonitor=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.log(\"startCallAsMonitor\",[e].concat(n)),this.media=e,this.active=!0,this.monitor=!0,this.transport.startCall({media:this.media,monitor:!0})},t.onRemoteCall=function(e){var t,n,o,i,r=this;if(!0===this.autoAccept){setTimeout(function(){r.joinCall({to:e.from,monitor:e.monitor,media:e.media})},0);return}var a=s.users.findOne(e.from),c=void 0;null!=a&&a.username&&(c=a.username);var d=u.findOne({rid:e.room});!0===e.monitor?(t=\"eye\",n=p(\"WebRTC_monitor_call_from_%s\",c)):d&&\"d\"===d.t?null!==(o=e.media)&&void 0!==o&&o.video?(t=\"video\",n=p(\"WebRTC_direct_video_call_from_%s\",c)):(t=\"phone\",n=p(\"WebRTC_direct_audio_call_from_%s\",c)):null!==(i=e.media)&&void 0!==i&&i.video?(t=\"video\",n=p(\"WebRTC_group_video_call_from_%s\",d.name)):(t=\"phone\",n=p(\"WebRTC_group_audio_call_from_%s\",d.name)),h.open({component:l,props:{title:n,icon:t,confirmText:p(\"Yes\"),cancelText:p(\"No\"),children:p(\"Do_you_want_to_accept\"),onConfirm:function(){return m(e.room),r.joinCall({to:e.from,monitor:e.monitor,media:e.media})},onCancel:function(){return r.stop()},onClose:function(){return r.stop()}}})},t.joinCall=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.media=this.media;for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];this.log(\"joinCall\",[t].concat(o)),this.getLocalUserMedia(function(){e.remoteMonitoring=t.monitor,e.active=!0,e.transport.joinCall(t)})},t.onRemoteJoin=function(e){var t,n,o=this;if(!0===this.active){for(var i=arguments.length,r=Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];this.log(\"onRemoteJoin\",[e].concat(r));var s=this.getPeerConnection(e.from);if(\"checking\"!==s.signalingState&&(this.stopPeerConnection(e.from),s=this.getPeerConnection(e.from)),\"new\"===s.iceConnectionState){s.remoteMedia=e.media,this.localStream&&s.addStream(this.localStream);var c=function(t){s.setLocalDescription(new RTCSessionDescription(t),function(){o.transport.sendDescription({to:e.from,type:\"offer\",ts:s.createdAt,media:o.media,description:{sdp:t.sdp,type:t.type}})},o.onError)};!0===e.monitor?s.createOffer(c,this.onError,{mandatory:{OfferToReceiveAudio:null===(t=e.media)||void 0===t?void 0:t.audio,OfferToReceiveVideo:null===(n=e.media)||void 0===n?void 0:n.video}}):s.createOffer(c,this.onError)}}},t.onRemoteOffer=function(e){var t=this;if(!0===this.active){for(var n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];this.log(\"onRemoteOffer\",[e].concat(o));var r=this.getPeerConnection(e.from);if([\"have-local-offer\",\"stable\"].includes(r.signalingState)&&r.createdAt<e.ts&&(this.stopPeerConnection(e.from),r=this.getPeerConnection(e.from)),\"new\"===r.iceConnectionState){r.setRemoteDescription(new RTCSessionDescription(e.description));try{this.localStream&&r.addStream(this.localStream)}catch(e){console.log(e)}r.createAnswer(function(n){r.setLocalDescription(new RTCSessionDescription(n),function(){t.transport.sendDescription({to:e.from,type:\"answer\",ts:r.createdAt,description:{sdp:n.sdp,type:n.type}})},t.onError)},this.onError)}}},t.onRemoteCandidate=function(e){if(!0===this.active&&e.to===this.selfId){for(var t,n=arguments.length,o=Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];this.log(\"onRemoteCandidate\",[e].concat(o));var r=this.getPeerConnection(e.from);\"closed\"!==r.iceConnectionState&&\"failed\"!==r.iceConnectionState&&\"disconnected\"!==r.iceConnectionState&&\"completed\"!==r.iceConnectionState&&r.addIceCandidate(new RTCIceCandidate(e.candidate)),document.querySelector(\"video#remoteVideo\").srcObject=null===(t=this.remoteItems.get()[0])||void 0===t?void 0:t.url}},t.onRemoteDescription=function(e){if(!0===this.active&&e.to===this.selfId){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.log(\"onRemoteDescription\",[e].concat(n));var i=this.getPeerConnection(e.from);\"offer\"===e.type?(i.remoteMedia=e.media,this.onRemoteOffer({from:e.from,ts:e.ts,description:e.description})):i.setRemoteDescription(new RTCSessionDescription(e.description))}},e}(),I=new(function(){function e(){this.instancesByRoomId={},this.instancesByRoomId={}}return e.prototype.getInstanceByRoomId=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!1;if(t)n=\"WebRTC\"===f.get(\"Omnichannel_call_provider\");else{var o=u.findOne({rid:e});if(!o)return;switch(o.t){case\"d\":n=f.get(\"WebRTC_Enable_Direct\");break;case\"p\":n=f.get(\"WebRTC_Enable_Private\");break;case\"c\":n=f.get(\"WebRTC_Enable_Channel\");break;case\"l\":n=\"WebRTC\"===f.get(\"Omnichannel_call_provider\")}}if(!1!==(n=n&&f.get(\"WebRTC_Enabled\"))){if(null==this.instancesByRoomId[e]){var i=s.userId(),r=!1;t&&(i=t,r=!0),this.instancesByRoomId[e]=new S(i,e,r)}return this.instancesByRoomId[e]}},e}());s.startup(function(){d.autorun(function(){var e=s.userId();e&&v.stream(\"notify-user\",[e+\"/\"+g.WEB_RTC],function(e,t){if(null!=t.room){var n=I.getInstanceByRoomId(t.room);switch(e){case\"candidate\":null==n||n.onUserStream(\"candidate\",t);break;case\"description\":null==n||n.onUserStream(\"description\",t);break;case\"join\":null==n||n.onUserStream(\"join\",t)}}})})})}","map":"{\"version\":3,\"sources\":[\"app/webrtc/client/WebRTCClass.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom } from '@rocket.chat/core-typings';\\nimport type { StreamKeys, StreamNames, StreamerCallbackArgs } from '@rocket.chat/ddp-client';\\nimport { Emitter } from '@rocket.chat/emitter';\\nimport { Meteor } from 'meteor/meteor';\\nimport { ReactiveVar } from 'meteor/reactive-var';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport GenericModal from '../../../client/components/GenericModal';\\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\\nimport { goToRoomById } from '../../../client/lib/utils/goToRoomById';\\nimport { ChatSubscription } from '../../models/client';\\nimport { settings } from '../../settings/client';\\nimport { sdk } from '../../utils/client/lib/SDKClient';\\nimport { t } from '../../utils/lib/i18n';\\nimport { WEB_RTC_EVENTS } from '../lib/constants';\\nimport { ChromeScreenShare } from './screenShare';\\n\\n// FIXME: there is a mix of obsolete definitions and incorrect field assignments\\n\\ndeclare global {\\n\\t// eslint-disable-next-line @typescript-eslint/naming-convention\\n\\tinterface RTCPeerConnection {\\n\\t\\t/** @deprecated non-standard */\\n\\t\\tcreatedAt: number;\\n\\t\\t/** @deprecated non-standard */\\n\\t\\tremoteMedia: MediaStreamConstraints;\\n\\t}\\n\\n\\t// eslint-disable-next-line @typescript-eslint/naming-convention\\n\\tinterface RTCOfferOptions {\\n\\t\\t/** @deprecated non-standard */\\n\\t\\tmandatory?: unknown;\\n\\t}\\n\\n\\t// eslint-disable-next-line @typescript-eslint/naming-convention\\n\\tinterface MediaStream {\\n\\t\\t/** @deprecated non-standard */\\n\\t\\tvolume?: GainNode;\\n\\t}\\n\\n\\t// eslint-disable-next-line @typescript-eslint/naming-convention\\n\\tinterface MediaStreamConstraints {\\n\\t\\t/** @deprecated non-standard */\\n\\t\\tdesktop?: boolean;\\n\\t}\\n\\n\\t/** @deprecated browser-specific global */\\n\\tconst chrome: {\\n\\t\\twebstore: {\\n\\t\\t\\tinstall(url: string, onSuccess: () => void, onError: (error: any) => void): void;\\n\\t\\t};\\n\\t};\\n\\n\\t// eslint-disable-next-line @typescript-eslint/naming-convention\\n\\tinterface Window {\\n\\t\\trocketchatscreenshare?: unknown;\\n\\t\\taudioContext?: AudioContext;\\n\\t}\\n}\\n\\ntype EventData<TStreamName extends StreamNames, TStreamKey extends StreamKeys<TStreamName>, TType> = Extract<\\n\\tStreamerCallbackArgs<TStreamName, TStreamKey>,\\n\\t[type: TType, data: any]\\n>[1];\\n\\ntype StatusData = EventData<'notify-room', `${string}/webrtc`, 'status'>;\\ntype CallData = EventData<'notify-room-users', `${string}/webrtc`, 'call'>;\\ntype CandidateData = EventData<'notify-user', `${string}/webrtc`, 'candidate'>;\\ntype DescriptionData = EventData<'notify-user', `${string}/webrtc`, 'description'>;\\ntype JoinData = EventData<'notify-user', `${string}/webrtc`, 'join'>;\\n\\ntype RemoteItem = {\\n\\tid: string;\\n\\turl: MediaStream;\\n\\tstate: RTCIceConnectionState;\\n\\tstateText?: string;\\n\\tconnected?: boolean;\\n};\\n\\ntype RemoteConnection = {\\n\\tid: string;\\n\\tmedia: MediaStreamConstraints;\\n};\\n\\nclass WebRTCTransportClass extends Emitter<{\\n\\tstatus: StatusData;\\n\\tcall: CallData;\\n\\tcandidate: CandidateData;\\n\\tdescription: DescriptionData;\\n\\tjoin: JoinData;\\n}> {\\n\\tpublic debug = false;\\n\\n\\tconstructor(public webrtcInstance: WebRTCClass) {\\n\\t\\tsuper();\\n\\t\\tsdk.stream('notify-room', [`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`], (type, data) => {\\n\\t\\t\\tthis.log('WebRTCTransportClass - onRoom', type, data);\\n\\t\\t\\tthis.emit(type, data);\\n\\t\\t});\\n\\t}\\n\\n\\tlog(...args: unknown[]) {\\n\\t\\tif (this.debug === true) {\\n\\t\\t\\tconsole.log(...args);\\n\\t\\t}\\n\\t}\\n\\n\\tonUserStream(type: 'candidate', data: CandidateData): void;\\n\\n\\tonUserStream(type: 'description', data: DescriptionData): void;\\n\\n\\tonUserStream(type: 'join', data: JoinData): void;\\n\\n\\tonUserStream(\\n\\t\\t...[type, data]:\\n\\t\\t\\t| [type: 'candidate', data: CandidateData]\\n\\t\\t\\t| [type: 'description', data: DescriptionData]\\n\\t\\t\\t| [type: 'join', data: JoinData]\\n\\t) {\\n\\t\\tif (data.room !== this.webrtcInstance.room) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tthis.log('WebRTCTransportClass - onUser', type, data);\\n\\n\\t\\tswitch (type) {\\n\\t\\t\\tcase 'candidate':\\n\\t\\t\\t\\tthis.emit('candidate', data);\\n\\t\\t\\t\\tbreak;\\n\\t\\t\\tcase 'description':\\n\\t\\t\\t\\tthis.emit('description', data);\\n\\t\\t\\t\\tbreak;\\n\\t\\t\\tcase 'join':\\n\\t\\t\\t\\tthis.emit('join', data);\\n\\t\\t\\t\\tbreak;\\n\\t\\t}\\n\\t}\\n\\n\\tstartCall(data: CallData) {\\n\\t\\tthis.log('WebRTCTransportClass - startCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\\n\\t\\tsdk.publish('notify-room-users', [\\n\\t\\t\\t`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`,\\n\\t\\t\\tWEB_RTC_EVENTS.CALL,\\n\\t\\t\\t{\\n\\t\\t\\t\\tfrom: this.webrtcInstance.selfId,\\n\\t\\t\\t\\troom: this.webrtcInstance.room,\\n\\t\\t\\t\\tmedia: data.media,\\n\\t\\t\\t\\tmonitor: data.monitor,\\n\\t\\t\\t},\\n\\t\\t]);\\n\\t}\\n\\n\\tjoinCall(data: JoinData) {\\n\\t\\tthis.log('WebRTCTransportClass - joinCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\\n\\t\\tif (data.monitor === true) {\\n\\t\\t\\tsdk.publish('notify-user', [\\n\\t\\t\\t\\t`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`,\\n\\t\\t\\t\\tWEB_RTC_EVENTS.JOIN,\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\tfrom: this.webrtcInstance.selfId,\\n\\t\\t\\t\\t\\troom: this.webrtcInstance.room,\\n\\t\\t\\t\\t\\tmedia: data.media,\\n\\t\\t\\t\\t\\tmonitor: data.monitor,\\n\\t\\t\\t\\t},\\n\\t\\t\\t]);\\n\\t\\t} else {\\n\\t\\t\\tsdk.publish('notify-room-users', [\\n\\t\\t\\t\\t`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`,\\n\\t\\t\\t\\tWEB_RTC_EVENTS.JOIN,\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\tfrom: this.webrtcInstance.selfId,\\n\\t\\t\\t\\t\\troom: this.webrtcInstance.room,\\n\\t\\t\\t\\t\\tmedia: data.media,\\n\\t\\t\\t\\t\\tmonitor: data.monitor,\\n\\t\\t\\t\\t},\\n\\t\\t\\t]);\\n\\t\\t}\\n\\t}\\n\\n\\tsendCandidate(data: CandidateData) {\\n\\t\\tdata.from = this.webrtcInstance.selfId;\\n\\t\\tdata.room = this.webrtcInstance.room;\\n\\t\\tthis.log('WebRTCTransportClass - sendCandidate', data);\\n\\t\\tsdk.publish('notify-user', [`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.CANDIDATE, data]);\\n\\t}\\n\\n\\tsendDescription(data: DescriptionData) {\\n\\t\\tdata.from = this.webrtcInstance.selfId;\\n\\t\\tdata.room = this.webrtcInstance.room;\\n\\t\\tthis.log('WebRTCTransportClass - sendDescription', data);\\n\\t\\tsdk.publish('notify-user', [`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.DESCRIPTION, data]);\\n\\t}\\n\\n\\tsendStatus(data: StatusData) {\\n\\t\\tthis.log('WebRTCTransportClass - sendStatus', data, this.webrtcInstance.room);\\n\\t\\tdata.from = this.webrtcInstance.selfId;\\n\\t\\tsdk.publish('notify-room', [`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.STATUS, data]);\\n\\t}\\n\\n\\tonRemoteCall(fn: (data: CallData) => void) {\\n\\t\\treturn this.on(WEB_RTC_EVENTS.CALL, fn);\\n\\t}\\n\\n\\tonRemoteJoin(fn: (data: JoinData) => void) {\\n\\t\\treturn this.on(WEB_RTC_EVENTS.JOIN, fn);\\n\\t}\\n\\n\\tonRemoteCandidate(fn: (data: CandidateData) => void) {\\n\\t\\treturn this.on(WEB_RTC_EVENTS.CANDIDATE, fn);\\n\\t}\\n\\n\\tonRemoteDescription(fn: (data: DescriptionData) => void) {\\n\\t\\treturn this.on(WEB_RTC_EVENTS.DESCRIPTION, fn);\\n\\t}\\n\\n\\tonRemoteStatus(fn: (data: StatusData) => void) {\\n\\t\\treturn this.on(WEB_RTC_EVENTS.STATUS, fn);\\n\\t}\\n}\\n\\nclass WebRTCClass {\\n\\ttransport: WebRTCTransportClass;\\n\\n\\tconfig: { iceServers: RTCIceServer[] };\\n\\n\\tdebug: boolean;\\n\\n\\tTransportClass: typeof WebRTCTransportClass;\\n\\n\\tpeerConnections: Record<string, RTCPeerConnection> = {};\\n\\n\\tremoteItems: ReactiveVar<RemoteItem[]>;\\n\\n\\tremoteItemsById: ReactiveVar<Record<string, RemoteItem>>;\\n\\n\\tcallInProgress: ReactiveVar<boolean>;\\n\\n\\taudioEnabled: ReactiveVar<boolean>;\\n\\n\\tvideoEnabled: ReactiveVar<boolean>;\\n\\n\\toverlayEnabled: ReactiveVar<boolean>;\\n\\n\\tscreenShareEnabled: ReactiveVar<boolean>;\\n\\n\\tlocalUrl: ReactiveVar<MediaStream | undefined>;\\n\\n\\tactive: boolean;\\n\\n\\tremoteMonitoring: boolean;\\n\\n\\tmonitor: boolean;\\n\\n\\tnavigator: string | undefined;\\n\\n\\tscreenShareAvailable: boolean;\\n\\n\\tmedia: MediaStreamConstraints;\\n\\n\\tconstructor(public selfId: string, public room: string, public autoAccept = false) {\\n\\t\\tthis.config = {\\n\\t\\t\\ticeServers: [],\\n\\t\\t};\\n\\t\\tthis.debug = false;\\n\\t\\tthis.TransportClass = WebRTCTransportClass;\\n\\t\\tlet servers = settings.get<string>('WebRTC_Servers');\\n\\t\\tif (servers && servers.trim() !== '') {\\n\\t\\t\\tservers = servers.replace(/\\\\s/g, '');\\n\\n\\t\\t\\tservers.split(',').forEach((server) => {\\n\\t\\t\\t\\tconst parts = server.split('@');\\n\\t\\t\\t\\tconst serverConfig: RTCIceServer = {\\n\\t\\t\\t\\t\\turls: parts.pop()!,\\n\\t\\t\\t\\t};\\n\\t\\t\\t\\tif (parts.length === 1) {\\n\\t\\t\\t\\t\\tconst [username, credential] = parts[0].split(':');\\n\\t\\t\\t\\t\\tserverConfig.username = decodeURIComponent(username);\\n\\t\\t\\t\\t\\tserverConfig.credential = decodeURIComponent(credential);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tthis.config.iceServers.push(serverConfig);\\n\\t\\t\\t});\\n\\t\\t}\\n\\t\\tthis.peerConnections = {};\\n\\t\\tthis.remoteItems = new ReactiveVar([]);\\n\\t\\tthis.remoteItemsById = new ReactiveVar({});\\n\\t\\tthis.callInProgress = new ReactiveVar(false);\\n\\t\\tthis.audioEnabled = new ReactiveVar(false);\\n\\t\\tthis.videoEnabled = new ReactiveVar(false);\\n\\t\\tthis.overlayEnabled = new ReactiveVar(false);\\n\\t\\tthis.screenShareEnabled = new ReactiveVar(false);\\n\\t\\tthis.localUrl = new ReactiveVar(undefined);\\n\\t\\tthis.active = false;\\n\\t\\tthis.remoteMonitoring = false;\\n\\t\\tthis.monitor = false;\\n\\t\\tthis.navigator = undefined;\\n\\t\\tconst userAgent = navigator.userAgent.toLocaleLowerCase();\\n\\n\\t\\tif (userAgent.indexOf('electron') !== -1) {\\n\\t\\t\\tthis.navigator = 'electron';\\n\\t\\t} else if (userAgent.indexOf('chrome') !== -1) {\\n\\t\\t\\tthis.navigator = 'chrome';\\n\\t\\t} else if (userAgent.indexOf('firefox') !== -1) {\\n\\t\\t\\tthis.navigator = 'firefox';\\n\\t\\t} else if (userAgent.indexOf('safari') !== -1) {\\n\\t\\t\\tthis.navigator = 'safari';\\n\\t\\t}\\n\\n\\t\\tthis.screenShareAvailable = ['chrome', 'firefox', 'electron'].includes(this.navigator!);\\n\\t\\tthis.media = {\\n\\t\\t\\tvideo: true,\\n\\t\\t\\taudio: true,\\n\\t\\t};\\n\\t\\tthis.transport = new this.TransportClass(this);\\n\\t\\tthis.transport.onRemoteCall(this.onRemoteCall.bind(this));\\n\\t\\tthis.transport.onRemoteJoin(this.onRemoteJoin.bind(this));\\n\\t\\tthis.transport.onRemoteCandidate(this.onRemoteCandidate.bind(this));\\n\\t\\tthis.transport.onRemoteDescription(this.onRemoteDescription.bind(this));\\n\\t\\tthis.transport.onRemoteStatus(this.onRemoteStatus.bind(this));\\n\\n\\t\\tsetInterval(this.checkPeerConnections.bind(this), 1000);\\n\\t}\\n\\n\\tonUserStream(type: 'candidate', data: CandidateData): void;\\n\\n\\tonUserStream(type: 'description', data: DescriptionData): void;\\n\\n\\tonUserStream(type: 'join', data: JoinData): void;\\n\\n\\tonUserStream(\\n\\t\\t...[type, data]:\\n\\t\\t\\t| [type: 'candidate', data: CandidateData]\\n\\t\\t\\t| [type: 'description', data: DescriptionData]\\n\\t\\t\\t| [type: 'join', data: JoinData]\\n\\t) {\\n\\t\\tswitch (type) {\\n\\t\\t\\tcase 'candidate':\\n\\t\\t\\t\\tthis.transport.onUserStream('candidate', data);\\n\\t\\t\\t\\tbreak;\\n\\n\\t\\t\\tcase 'description':\\n\\t\\t\\t\\tthis.transport.onUserStream('description', data);\\n\\t\\t\\t\\tbreak;\\n\\n\\t\\t\\tcase 'join':\\n\\t\\t\\t\\tthis.transport.onUserStream('join', data);\\n\\t\\t\\t\\tbreak;\\n\\t\\t}\\n\\t}\\n\\n\\tlog(...args: unknown[]) {\\n\\t\\tif (this.debug === true) {\\n\\t\\t\\tconsole.log(...args);\\n\\t\\t}\\n\\t}\\n\\n\\tonError(...args: unknown[]) {\\n\\t\\tconsole.error(...args);\\n\\t}\\n\\n\\tcheckPeerConnections() {\\n\\t\\tconst { peerConnections } = this;\\n\\t\\tconst date = Date.now();\\n\\t\\tObject.entries(peerConnections).some(([id, peerConnection]) => {\\n\\t\\t\\tif (!['connected', 'completed'].includes(peerConnection.iceConnectionState) && peerConnection.createdAt + 5000 < date) {\\n\\t\\t\\t\\tthis.stopPeerConnection(id);\\n\\t\\t\\t\\treturn true;\\n\\t\\t\\t}\\n\\t\\t\\treturn false;\\n\\t\\t});\\n\\t}\\n\\n\\tupdateRemoteItems() {\\n\\t\\tconst items: RemoteItem[] = [];\\n\\t\\tconst itemsById: Record<string, RemoteItem> = {};\\n\\t\\tconst { peerConnections } = this;\\n\\n\\t\\tObject.entries(peerConnections).forEach(([id, peerConnection]) => {\\n\\t\\t\\tpeerConnection.getRemoteStreams().forEach((remoteStream) => {\\n\\t\\t\\t\\tconst item: RemoteItem = {\\n\\t\\t\\t\\t\\tid,\\n\\t\\t\\t\\t\\turl: remoteStream,\\n\\t\\t\\t\\t\\tstate: peerConnection.iceConnectionState,\\n\\t\\t\\t\\t};\\n\\t\\t\\t\\tswitch (peerConnection.iceConnectionState) {\\n\\t\\t\\t\\t\\tcase 'checking':\\n\\t\\t\\t\\t\\t\\titem.stateText = 'Connecting...';\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t\\tcase 'connected':\\n\\t\\t\\t\\t\\tcase 'completed':\\n\\t\\t\\t\\t\\t\\titem.stateText = 'Connected';\\n\\t\\t\\t\\t\\t\\titem.connected = true;\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t\\tcase 'disconnected':\\n\\t\\t\\t\\t\\t\\titem.stateText = 'Disconnected';\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t\\tcase 'failed':\\n\\t\\t\\t\\t\\t\\titem.stateText = 'Failed';\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t\\tcase 'closed':\\n\\t\\t\\t\\t\\t\\titem.stateText = 'Closed';\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\titems.push(item);\\n\\t\\t\\t\\titemsById[id] = item;\\n\\t\\t\\t});\\n\\t\\t});\\n\\t\\tthis.remoteItems.set(items);\\n\\t\\tthis.remoteItemsById.set(itemsById);\\n\\t}\\n\\n\\tresetCallInProgress = () => {\\n\\t\\tthis.callInProgress.set(false);\\n\\t};\\n\\n\\tbroadcastStatus() {\\n\\t\\tif (this.active !== true || this.monitor === true || this.remoteMonitoring === true) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tconst remoteConnections: RemoteConnection[] = [];\\n\\t\\tconst { peerConnections } = this;\\n\\t\\tObject.entries(peerConnections).forEach(([id, { remoteMedia: media }]) => {\\n\\t\\t\\tremoteConnections.push({\\n\\t\\t\\t\\tid,\\n\\t\\t\\t\\tmedia,\\n\\t\\t\\t});\\n\\t\\t});\\n\\n\\t\\tthis.transport.sendStatus({\\n\\t\\t\\tmedia: this.media,\\n\\t\\t\\tremoteConnections,\\n\\t\\t});\\n\\t}\\n\\n\\tcallInProgressTimeout: ReturnType<typeof setTimeout> | undefined = undefined;\\n\\n\\tonRemoteStatus(data: StatusData) {\\n\\t\\t// this.log(onRemoteStatus, arguments);\\n\\t\\tthis.callInProgress.set(true);\\n\\t\\tclearTimeout(this.callInProgressTimeout);\\n\\t\\tthis.callInProgressTimeout = setTimeout(this.resetCallInProgress, 2000);\\n\\t\\tif (this.active !== true) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tconst remoteConnections = [\\n\\t\\t\\t{\\n\\t\\t\\t\\tid: data.from!,\\n\\t\\t\\t\\tmedia: data.media,\\n\\t\\t\\t},\\n\\t\\t\\t...data.remoteConnections,\\n\\t\\t];\\n\\n\\t\\tremoteConnections.forEach((remoteConnection) => {\\n\\t\\t\\tif (remoteConnection.id !== this.selfId && this.peerConnections[remoteConnection.id] == null) {\\n\\t\\t\\t\\tthis.log('reconnecting with', remoteConnection.id);\\n\\t\\t\\t\\tthis.onRemoteJoin({\\n\\t\\t\\t\\t\\tfrom: remoteConnection.id,\\n\\t\\t\\t\\t\\tmedia: remoteConnection.media,\\n\\t\\t\\t\\t});\\n\\t\\t\\t}\\n\\t\\t});\\n\\t}\\n\\n\\tgetPeerConnection(id: string) {\\n\\t\\tif (this.peerConnections[id] != null) {\\n\\t\\t\\treturn this.peerConnections[id];\\n\\t\\t}\\n\\t\\tconst peerConnection = new RTCPeerConnection(this.config);\\n\\n\\t\\tpeerConnection.createdAt = Date.now();\\n\\t\\tpeerConnection.remoteMedia = {};\\n\\t\\tthis.peerConnections[id] = peerConnection;\\n\\t\\tconst eventNames = [\\n\\t\\t\\t'icecandidate',\\n\\t\\t\\t'addstream',\\n\\t\\t\\t'removestream',\\n\\t\\t\\t'iceconnectionstatechange',\\n\\t\\t\\t'datachannel',\\n\\t\\t\\t'identityresult',\\n\\t\\t\\t'idpassertionerror',\\n\\t\\t\\t'idpvalidationerror',\\n\\t\\t\\t'negotiationneeded',\\n\\t\\t\\t'peeridentity',\\n\\t\\t\\t'signalingstatechange',\\n\\t\\t];\\n\\n\\t\\teventNames.forEach((eventName) => {\\n\\t\\t\\tpeerConnection.addEventListener(eventName, (e) => {\\n\\t\\t\\t\\tthis.log(id, e.type, e);\\n\\t\\t\\t});\\n\\t\\t});\\n\\n\\t\\tpeerConnection.addEventListener('icecandidate', (e) => {\\n\\t\\t\\tif (e.candidate == null) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\tthis.transport.sendCandidate({\\n\\t\\t\\t\\tto: id,\\n\\t\\t\\t\\tcandidate: {\\n\\t\\t\\t\\t\\tcandidate: e.candidate.candidate,\\n\\t\\t\\t\\t\\tsdpMLineIndex: e.candidate.sdpMLineIndex,\\n\\t\\t\\t\\t\\tsdpMid: e.candidate.sdpMid,\\n\\t\\t\\t\\t},\\n\\t\\t\\t});\\n\\t\\t});\\n\\t\\tpeerConnection.addEventListener('addstream', () => {\\n\\t\\t\\tthis.updateRemoteItems();\\n\\t\\t});\\n\\t\\tpeerConnection.addEventListener('removestream', () => {\\n\\t\\t\\tthis.updateRemoteItems();\\n\\t\\t});\\n\\t\\tpeerConnection.addEventListener('iceconnectionstatechange', () => {\\n\\t\\t\\tif (\\n\\t\\t\\t\\t(peerConnection.iceConnectionState === 'disconnected' || peerConnection.iceConnectionState === 'closed') &&\\n\\t\\t\\t\\tpeerConnection === this.peerConnections[id]\\n\\t\\t\\t) {\\n\\t\\t\\t\\tthis.stopPeerConnection(id);\\n\\t\\t\\t\\tsetTimeout(() => {\\n\\t\\t\\t\\t\\tif (Object.keys(this.peerConnections).length === 0) {\\n\\t\\t\\t\\t\\t\\tthis.stop();\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}, 3000);\\n\\t\\t\\t}\\n\\t\\t\\tthis.updateRemoteItems();\\n\\t\\t});\\n\\t\\treturn peerConnection;\\n\\t}\\n\\n\\taudioContext: AudioContext | undefined;\\n\\n\\t_getUserMedia(media: MediaStreamConstraints, onSuccess: (stream: MediaStream) => void, onError: (error?: any) => void) {\\n\\t\\tconst onSuccessLocal = (stream: MediaStream) => {\\n\\t\\t\\tif (AudioContext && stream.getAudioTracks().length > 0) {\\n\\t\\t\\t\\tconst audioContext = new AudioContext();\\n\\t\\t\\t\\tconst source = audioContext.createMediaStreamSource(stream);\\n\\t\\t\\t\\tconst volume = audioContext.createGain();\\n\\t\\t\\t\\tsource.connect(volume);\\n\\t\\t\\t\\tconst peer = audioContext.createMediaStreamDestination();\\n\\t\\t\\t\\tvolume.connect(peer);\\n\\t\\t\\t\\tvolume.gain.value = 0.6;\\n\\t\\t\\t\\tstream.removeTrack(stream.getAudioTracks()[0]);\\n\\t\\t\\t\\tstream.addTrack(peer.stream.getAudioTracks()[0]);\\n\\t\\t\\t\\tstream.volume = volume;\\n\\t\\t\\t\\tthis.audioContext = audioContext;\\n\\t\\t\\t}\\n\\t\\t\\tonSuccess(stream);\\n\\t\\t};\\n\\n\\t\\tif (navigator.mediaDevices?.getUserMedia) {\\n\\t\\t\\treturn navigator.mediaDevices.getUserMedia(media).then(onSuccessLocal).catch(onError);\\n\\t\\t}\\n\\n\\t\\tnavigator.getUserMedia?.(media, onSuccessLocal, onError);\\n\\t}\\n\\n\\tgetUserMedia(media: MediaStreamConstraints, onSuccess: (stream: MediaStream) => void, onError: (error: any) => void = this.onError) {\\n\\t\\tif (media.desktop !== true) {\\n\\t\\t\\tvoid this._getUserMedia(media, onSuccess, onError);\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tif (this.screenShareAvailable !== true) {\\n\\t\\t\\tconsole.log('Screen share is not avaliable');\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tconst getScreen = (audioStream?: MediaStream) => {\\n\\t\\t\\tconst refresh = function () {\\n\\t\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\t\\tcomponent: GenericModal,\\n\\t\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\t\\tvariant: 'warning',\\n\\t\\t\\t\\t\\t\\ttitle: t('Refresh_your_page_after_install_to_enable_screen_sharing'),\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t});\\n\\t\\t\\t};\\n\\n\\t\\t\\tconst isChromeExtensionInstalled = this.navigator === 'chrome' && ChromeScreenShare.installed;\\n\\t\\t\\tconst isFirefoxExtensionInstalled = this.navigator === 'firefox' && window.rocketchatscreenshare != null;\\n\\n\\t\\t\\tif (!isChromeExtensionInstalled && !isFirefoxExtensionInstalled) {\\n\\t\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\t\\tcomponent: GenericModal,\\n\\t\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\t\\ttitle: t('Screen_Share'),\\n\\t\\t\\t\\t\\t\\tvariant: 'warning',\\n\\t\\t\\t\\t\\t\\tconfirmText: t('Install_Extension'),\\n\\t\\t\\t\\t\\t\\tcancelText: t('Cancel'),\\n\\t\\t\\t\\t\\t\\tchildren: t('You_need_install_an_extension_to_allow_screen_sharing'),\\n\\t\\t\\t\\t\\t\\tonConfirm: () => {\\n\\t\\t\\t\\t\\t\\t\\tif (this.navigator === 'chrome') {\\n\\t\\t\\t\\t\\t\\t\\t\\tconst url = 'https://chrome.google.com/webstore/detail/rocketchat-screen-share/nocfbnnmjnndkbipkabodnheejiegccf';\\n\\t\\t\\t\\t\\t\\t\\t\\ttry {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tchrome.webstore.install(url, refresh, () => {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\twindow.open(url);\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\trefresh();\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t\\t\\t\\t} catch (_error) {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tconsole.log(_error);\\n\\t\\t\\t\\t\\t\\t\\t\\t\\twindow.open(url);\\n\\t\\t\\t\\t\\t\\t\\t\\t\\trefresh();\\n\\t\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t\\t} else if (this.navigator === 'firefox') {\\n\\t\\t\\t\\t\\t\\t\\t\\twindow.open('https://addons.mozilla.org/en-GB/firefox/addon/rocketchat-screen-share/');\\n\\t\\t\\t\\t\\t\\t\\t\\trefresh();\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t});\\n\\n\\t\\t\\t\\treturn onError(false);\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst getScreenSuccess = (stream: MediaStream) => {\\n\\t\\t\\t\\tif (audioStream != null) {\\n\\t\\t\\t\\t\\tstream.addTrack(audioStream.getAudioTracks()[0]);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tonSuccess(stream);\\n\\t\\t\\t};\\n\\t\\t\\tif (this.navigator === 'firefox') {\\n\\t\\t\\t\\tmedia = {\\n\\t\\t\\t\\t\\taudio: media.audio,\\n\\t\\t\\t\\t\\tvideo: {\\n\\t\\t\\t\\t\\t\\tmozMediaSource: 'window',\\n\\t\\t\\t\\t\\t\\tmediaSource: 'window',\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t};\\n\\t\\t\\t\\tvoid this._getUserMedia(media, getScreenSuccess, onError);\\n\\t\\t\\t} else {\\n\\t\\t\\t\\tChromeScreenShare.getSourceId(this.navigator!, (id) => {\\n\\t\\t\\t\\t\\tmedia = {\\n\\t\\t\\t\\t\\t\\taudio: false,\\n\\t\\t\\t\\t\\t\\tvideo: {\\n\\t\\t\\t\\t\\t\\t\\tmandatory: {\\n\\t\\t\\t\\t\\t\\t\\t\\tchromeMediaSource: 'desktop',\\n\\t\\t\\t\\t\\t\\t\\t\\tchromeMediaSourceId: id,\\n\\t\\t\\t\\t\\t\\t\\t\\tmaxWidth: 1280,\\n\\t\\t\\t\\t\\t\\t\\t\\tmaxHeight: 720,\\n\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t};\\n\\t\\t\\t\\t\\tvoid this._getUserMedia(media, getScreenSuccess, onError);\\n\\t\\t\\t\\t});\\n\\t\\t\\t}\\n\\t\\t};\\n\\t\\tif (this.navigator === 'firefox' || media.audio == null || media.audio === false) {\\n\\t\\t\\tgetScreen();\\n\\t\\t} else {\\n\\t\\t\\tconst getAudioSuccess = (audioStream: MediaStream) => {\\n\\t\\t\\t\\tgetScreen(audioStream);\\n\\t\\t\\t};\\n\\t\\t\\tconst getAudioError = () => {\\n\\t\\t\\t\\tgetScreen();\\n\\t\\t\\t};\\n\\n\\t\\t\\tvoid this._getUserMedia(\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\taudio: media.audio,\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\tgetAudioSuccess,\\n\\t\\t\\t\\tgetAudioError,\\n\\t\\t\\t);\\n\\t\\t}\\n\\t}\\n\\n\\tgetLocalUserMedia(callback: (...args: any[]) => void, ...args: unknown[]) {\\n\\t\\tthis.log('getLocalUserMedia', [callback, ...args]);\\n\\t\\tif (this.localStream != null) {\\n\\t\\t\\treturn callback(null, this.localStream);\\n\\t\\t}\\n\\t\\tconst onSuccess = (stream: MediaStream) => {\\n\\t\\t\\tthis.localStream = stream;\\n\\t\\t\\t!this.audioEnabled.get() && this.disableAudio();\\n\\t\\t\\t!this.videoEnabled.get() && this.disableVideo();\\n\\t\\t\\tthis.localUrl.set(stream);\\n\\t\\t\\tconst { peerConnections } = this;\\n\\t\\t\\tObject.entries(peerConnections).forEach(([, peerConnection]) => peerConnection.addStream(stream));\\n\\t\\t\\tdocument.querySelector<HTMLVideoElement>('video#localVideo')!.srcObject = stream;\\n\\t\\t\\tcallback(null, this.localStream);\\n\\t\\t};\\n\\t\\tconst onError = (error: any) => {\\n\\t\\t\\tcallback(false);\\n\\t\\t\\tthis.onError(error);\\n\\t\\t};\\n\\t\\tthis.getUserMedia(this.media, onSuccess, onError);\\n\\t}\\n\\n\\tstopPeerConnection = (id: string) => {\\n\\t\\tconst peerConnection = this.peerConnections[id];\\n\\t\\tif (peerConnection == null) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tdelete this.peerConnections[id];\\n\\t\\tpeerConnection.close();\\n\\t\\tthis.updateRemoteItems();\\n\\t};\\n\\n\\tstopAllPeerConnections() {\\n\\t\\tconst { peerConnections } = this;\\n\\n\\t\\tObject.keys(peerConnections).forEach(this.stopPeerConnection);\\n\\n\\t\\tvoid window.audioContext?.close(); // FIXME: probably should be `this.audioContext`\\n\\t}\\n\\n\\tsetAudioEnabled(enabled = true) {\\n\\t\\tif (this.localStream != null) {\\n\\t\\t\\tthis.localStream.getAudioTracks().forEach((audio) => {\\n\\t\\t\\t\\taudio.enabled = enabled;\\n\\t\\t\\t});\\n\\t\\t\\tthis.audioEnabled.set(enabled);\\n\\t\\t}\\n\\t}\\n\\n\\tdisableAudio() {\\n\\t\\tthis.setAudioEnabled(false);\\n\\t}\\n\\n\\tenableAudio() {\\n\\t\\tthis.setAudioEnabled(true);\\n\\t}\\n\\n\\ttoggleAudio() {\\n\\t\\tif (this.audioEnabled.get()) {\\n\\t\\t\\treturn this.disableAudio();\\n\\t\\t}\\n\\t\\treturn this.enableAudio();\\n\\t}\\n\\n\\tlocalStream: MediaStream | undefined;\\n\\n\\tsetVideoEnabled(enabled = true) {\\n\\t\\tif (this.localStream != null) {\\n\\t\\t\\tthis.localStream.getVideoTracks().forEach((video) => {\\n\\t\\t\\t\\tvideo.enabled = enabled;\\n\\t\\t\\t});\\n\\t\\t\\tthis.videoEnabled.set(enabled);\\n\\t\\t}\\n\\t}\\n\\n\\tdisableScreenShare() {\\n\\t\\tthis.setScreenShareEnabled(false);\\n\\t}\\n\\n\\tenableScreenShare() {\\n\\t\\tthis.setScreenShareEnabled(true);\\n\\t}\\n\\n\\tsetScreenShareEnabled(enabled = true) {\\n\\t\\tif (this.localStream != null) {\\n\\t\\t\\tthis.media.desktop = enabled;\\n\\t\\t\\tdelete this.localStream;\\n\\t\\t\\tthis.getLocalUserMedia((err) => {\\n\\t\\t\\t\\tif (err != null) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tthis.screenShareEnabled.set(enabled);\\n\\t\\t\\t\\tthis.stopAllPeerConnections();\\n\\t\\t\\t\\tthis.joinCall();\\n\\t\\t\\t});\\n\\t\\t}\\n\\t}\\n\\n\\tdisableVideo() {\\n\\t\\tthis.setVideoEnabled(false);\\n\\t}\\n\\n\\tenableVideo() {\\n\\t\\tthis.setVideoEnabled(true);\\n\\t}\\n\\n\\ttoggleVideo() {\\n\\t\\tif (this.videoEnabled.get()) {\\n\\t\\t\\treturn this.disableVideo();\\n\\t\\t}\\n\\t\\treturn this.enableVideo();\\n\\t}\\n\\n\\tstop() {\\n\\t\\tthis.active = false;\\n\\t\\tthis.monitor = false;\\n\\t\\tthis.remoteMonitoring = false;\\n\\t\\tif (this.localStream != null && typeof this.localStream !== 'undefined') {\\n\\t\\t\\tthis.localStream.getTracks().forEach((track) => track.stop());\\n\\t\\t}\\n\\t\\tthis.localUrl.set(undefined);\\n\\t\\tdelete this.localStream;\\n\\t\\tthis.stopAllPeerConnections();\\n\\t}\\n\\n\\tstartCall(media: MediaStreamConstraints = {}, ...args: unknown[]) {\\n\\t\\tthis.log('startCall', [media, ...args]);\\n\\t\\tthis.media = media;\\n\\t\\tthis.getLocalUserMedia(() => {\\n\\t\\t\\tthis.active = true;\\n\\t\\t\\tthis.transport.startCall({\\n\\t\\t\\t\\tmedia: this.media,\\n\\t\\t\\t});\\n\\t\\t});\\n\\t}\\n\\n\\tstartCallAsMonitor(media: MediaStreamConstraints = {}, ...args: unknown[]) {\\n\\t\\tthis.log('startCallAsMonitor', [media, ...args]);\\n\\t\\tthis.media = media;\\n\\t\\tthis.active = true;\\n\\t\\tthis.monitor = true;\\n\\t\\tthis.transport.startCall({\\n\\t\\t\\tmedia: this.media,\\n\\t\\t\\tmonitor: true,\\n\\t\\t});\\n\\t}\\n\\n\\tonRemoteCall(data: CallData) {\\n\\t\\tif (this.autoAccept === true) {\\n\\t\\t\\tsetTimeout(() => {\\n\\t\\t\\t\\tthis.joinCall({\\n\\t\\t\\t\\t\\tto: data.from,\\n\\t\\t\\t\\t\\tmonitor: data.monitor,\\n\\t\\t\\t\\t\\tmedia: data.media,\\n\\t\\t\\t\\t});\\n\\t\\t\\t}, 0);\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst user = Meteor.users.findOne(data.from);\\n\\t\\tlet fromUsername = undefined;\\n\\t\\tif (user?.username) {\\n\\t\\t\\tfromUsername = user.username;\\n\\t\\t}\\n\\t\\tconst subscription = ChatSubscription.findOne({\\n\\t\\t\\trid: data.room,\\n\\t\\t})!;\\n\\n\\t\\tlet icon;\\n\\t\\tlet title;\\n\\t\\tif (data.monitor === true) {\\n\\t\\t\\ticon = 'eye' as const;\\n\\t\\t\\ttitle = t('WebRTC_monitor_call_from_%s', fromUsername);\\n\\t\\t} else if (subscription && subscription.t === 'd') {\\n\\t\\t\\tif (data.media?.video) {\\n\\t\\t\\t\\ticon = 'video' as const;\\n\\t\\t\\t\\ttitle = t('WebRTC_direct_video_call_from_%s', fromUsername);\\n\\t\\t\\t} else {\\n\\t\\t\\t\\ticon = 'phone' as const;\\n\\t\\t\\t\\ttitle = t('WebRTC_direct_audio_call_from_%s', fromUsername);\\n\\t\\t\\t}\\n\\t\\t} else if (data.media?.video) {\\n\\t\\t\\ticon = 'video' as const;\\n\\t\\t\\ttitle = t('WebRTC_group_video_call_from_%s', subscription.name);\\n\\t\\t} else {\\n\\t\\t\\ticon = 'phone' as const;\\n\\t\\t\\ttitle = t('WebRTC_group_audio_call_from_%s', subscription.name);\\n\\t\\t}\\n\\n\\t\\timperativeModal.open({\\n\\t\\t\\tcomponent: GenericModal,\\n\\t\\t\\tprops: {\\n\\t\\t\\t\\ttitle,\\n\\t\\t\\t\\ticon,\\n\\t\\t\\t\\tconfirmText: t('Yes'),\\n\\t\\t\\t\\tcancelText: t('No'),\\n\\t\\t\\t\\tchildren: t('Do_you_want_to_accept'),\\n\\t\\t\\t\\tonConfirm: () => {\\n\\t\\t\\t\\t\\tvoid goToRoomById(data.room!);\\n\\t\\t\\t\\t\\treturn this.joinCall({\\n\\t\\t\\t\\t\\t\\tto: data.from,\\n\\t\\t\\t\\t\\t\\tmonitor: data.monitor,\\n\\t\\t\\t\\t\\t\\tmedia: data.media,\\n\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\tonCancel: () => this.stop(),\\n\\t\\t\\t\\tonClose: () => this.stop(),\\n\\t\\t\\t},\\n\\t\\t});\\n\\t}\\n\\n\\tjoinCall(data: JoinData = {}, ...args: unknown[]) {\\n\\t\\tdata.media = this.media;\\n\\t\\tthis.log('joinCall', [data, ...args]);\\n\\t\\tthis.getLocalUserMedia(() => {\\n\\t\\t\\tthis.remoteMonitoring = data.monitor!;\\n\\t\\t\\tthis.active = true;\\n\\t\\t\\tthis.transport.joinCall(data);\\n\\t\\t});\\n\\t}\\n\\n\\tonRemoteJoin(data: JoinData, ...args: unknown[]) {\\n\\t\\tif (this.active !== true) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tthis.log('onRemoteJoin', [data, ...args]);\\n\\t\\tlet peerConnection = this.getPeerConnection(data.from!);\\n\\n\\t\\t// needsRefresh = false\\n\\t\\t// if peerConnection.iceConnectionState isnt 'new'\\n\\t\\t// needsAudio = data.media.audio is true and peerConnection.remoteMedia.audio isnt true\\n\\t\\t// needsVideo = data.media.video is true and peerConnection.remoteMedia.video isnt true\\n\\t\\t// needsRefresh = needsAudio or needsVideo or data.media.desktop isnt peerConnection.remoteMedia.desktop\\n\\n\\t\\t// # if peerConnection.signalingState is \\\"have-local-offer\\\" or needsRefresh\\n\\n\\t\\tif ((peerConnection.signalingState as RTCSignalingState | 'checking') !== 'checking') {\\n\\t\\t\\tthis.stopPeerConnection(data.from!);\\n\\t\\t\\tpeerConnection = this.getPeerConnection(data.from!);\\n\\t\\t}\\n\\t\\tif (peerConnection.iceConnectionState !== 'new') {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tpeerConnection.remoteMedia = data.media!;\\n\\t\\tif (this.localStream) {\\n\\t\\t\\tpeerConnection.addStream(this.localStream);\\n\\t\\t}\\n\\t\\tconst onOffer: RTCSessionDescriptionCallback = (offer) => {\\n\\t\\t\\tconst onLocalDescription = () => {\\n\\t\\t\\t\\tthis.transport.sendDescription({\\n\\t\\t\\t\\t\\tto: data.from,\\n\\t\\t\\t\\t\\ttype: 'offer',\\n\\t\\t\\t\\t\\tts: peerConnection.createdAt,\\n\\t\\t\\t\\t\\tmedia: this.media,\\n\\t\\t\\t\\t\\tdescription: {\\n\\t\\t\\t\\t\\t\\tsdp: offer.sdp,\\n\\t\\t\\t\\t\\t\\ttype: offer.type,\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t});\\n\\t\\t\\t};\\n\\n\\t\\t\\tvoid peerConnection.setLocalDescription(new RTCSessionDescription(offer), onLocalDescription, this.onError);\\n\\t\\t};\\n\\n\\t\\tif (data.monitor === true) {\\n\\t\\t\\tvoid peerConnection.createOffer(onOffer, this.onError, {\\n\\t\\t\\t\\tmandatory: {\\n\\t\\t\\t\\t\\tOfferToReceiveAudio: data.media?.audio,\\n\\t\\t\\t\\t\\tOfferToReceiveVideo: data.media?.video,\\n\\t\\t\\t\\t},\\n\\t\\t\\t});\\n\\t\\t} else {\\n\\t\\t\\tvoid peerConnection.createOffer(onOffer, this.onError);\\n\\t\\t}\\n\\t}\\n\\n\\tonRemoteOffer(data: Omit<DescriptionData, 'type'>, ...args: unknown[]) {\\n\\t\\tif (this.active !== true) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tthis.log('onRemoteOffer', [data, ...args]);\\n\\t\\tlet peerConnection = this.getPeerConnection(data.from!);\\n\\n\\t\\tif (['have-local-offer', 'stable'].includes(peerConnection.signalingState) && peerConnection.createdAt < data.ts) {\\n\\t\\t\\tthis.stopPeerConnection(data.from!);\\n\\t\\t\\tpeerConnection = this.getPeerConnection(data.from!);\\n\\t\\t}\\n\\n\\t\\tif (peerConnection.iceConnectionState !== 'new') {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tvoid peerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\\n\\n\\t\\ttry {\\n\\t\\t\\tif (this.localStream) {\\n\\t\\t\\t\\tpeerConnection.addStream(this.localStream);\\n\\t\\t\\t}\\n\\t\\t} catch (error) {\\n\\t\\t\\tconsole.log(error);\\n\\t\\t}\\n\\n\\t\\tconst onAnswer: RTCSessionDescriptionCallback = (answer) => {\\n\\t\\t\\tconst onLocalDescription = () => {\\n\\t\\t\\t\\tthis.transport.sendDescription({\\n\\t\\t\\t\\t\\tto: data.from,\\n\\t\\t\\t\\t\\ttype: 'answer',\\n\\t\\t\\t\\t\\tts: peerConnection.createdAt,\\n\\t\\t\\t\\t\\tdescription: {\\n\\t\\t\\t\\t\\t\\tsdp: answer.sdp,\\n\\t\\t\\t\\t\\t\\ttype: answer.type,\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t});\\n\\t\\t\\t};\\n\\n\\t\\t\\tvoid peerConnection.setLocalDescription(new RTCSessionDescription(answer), onLocalDescription, this.onError);\\n\\t\\t};\\n\\n\\t\\tvoid peerConnection.createAnswer(onAnswer, this.onError);\\n\\t}\\n\\n\\tonRemoteCandidate(data: CandidateData, ...args: unknown[]) {\\n\\t\\tif (this.active !== true) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tif (data.to !== this.selfId) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tthis.log('onRemoteCandidate', [data, ...args]);\\n\\t\\tconst peerConnection = this.getPeerConnection(data.from!);\\n\\t\\tif (\\n\\t\\t\\tpeerConnection.iceConnectionState !== 'closed' &&\\n\\t\\t\\tpeerConnection.iceConnectionState !== 'failed' &&\\n\\t\\t\\tpeerConnection.iceConnectionState !== 'disconnected' &&\\n\\t\\t\\tpeerConnection.iceConnectionState !== 'completed'\\n\\t\\t) {\\n\\t\\t\\tvoid peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));\\n\\t\\t}\\n\\t\\tdocument.querySelector<HTMLVideoElement>('video#remoteVideo')!.srcObject = this.remoteItems.get()[0]?.url;\\n\\t}\\n\\n\\tonRemoteDescription(data: DescriptionData, ...args: unknown[]) {\\n\\t\\tif (this.active !== true) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tif (data.to !== this.selfId) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tthis.log('onRemoteDescription', [data, ...args]);\\n\\t\\tconst peerConnection = this.getPeerConnection(data.from!);\\n\\t\\tif (data.type === 'offer') {\\n\\t\\t\\tpeerConnection.remoteMedia = data.media;\\n\\t\\t\\tthis.onRemoteOffer({\\n\\t\\t\\t\\tfrom: data.from,\\n\\t\\t\\t\\tts: data.ts,\\n\\t\\t\\t\\tdescription: data.description,\\n\\t\\t\\t});\\n\\t\\t} else {\\n\\t\\t\\tvoid peerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\\n\\t\\t}\\n\\t}\\n}\\n\\nconst WebRTC = new (class {\\n\\tinstancesByRoomId: Record<string, WebRTCClass> = {};\\n\\n\\tconstructor() {\\n\\t\\tthis.instancesByRoomId = {};\\n\\t}\\n\\n\\tgetInstanceByRoomId(rid: IRoom['_id'], visitorId: string | null = null) {\\n\\t\\tlet enabled = false;\\n\\t\\tif (!visitorId) {\\n\\t\\t\\tconst subscription = ChatSubscription.findOne({ rid });\\n\\t\\t\\tif (!subscription) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\tswitch (subscription.t) {\\n\\t\\t\\t\\tcase 'd':\\n\\t\\t\\t\\t\\tenabled = settings.get('WebRTC_Enable_Direct');\\n\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\tcase 'p':\\n\\t\\t\\t\\t\\tenabled = settings.get('WebRTC_Enable_Private');\\n\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\tcase 'c':\\n\\t\\t\\t\\t\\tenabled = settings.get('WebRTC_Enable_Channel');\\n\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\tcase 'l':\\n\\t\\t\\t\\t\\tenabled = settings.get<string>('Omnichannel_call_provider') === 'WebRTC';\\n\\t\\t\\t}\\n\\t\\t} else {\\n\\t\\t\\tenabled = settings.get<string>('Omnichannel_call_provider') === 'WebRTC';\\n\\t\\t}\\n\\t\\tenabled = enabled && settings.get('WebRTC_Enabled');\\n\\t\\tif (enabled === false) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tif (this.instancesByRoomId[rid] == null) {\\n\\t\\t\\tlet uid = Meteor.userId()!;\\n\\t\\t\\tlet autoAccept = false;\\n\\t\\t\\tif (visitorId) {\\n\\t\\t\\t\\tuid = visitorId;\\n\\t\\t\\t\\tautoAccept = true;\\n\\t\\t\\t}\\n\\t\\t\\tthis.instancesByRoomId[rid] = new WebRTCClass(uid, rid, autoAccept);\\n\\t\\t}\\n\\t\\treturn this.instancesByRoomId[rid];\\n\\t}\\n})();\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(() => {\\n\\t\\tconst uid = Meteor.userId();\\n\\n\\t\\tif (uid) {\\n\\t\\t\\tsdk.stream('notify-user', [`${uid}/${WEB_RTC_EVENTS.WEB_RTC}`], (type, data) => {\\n\\t\\t\\t\\tif (data.room == null) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tconst webrtc = WebRTC.getInstanceByRoomId(data.room);\\n\\n\\t\\t\\t\\tswitch (type) {\\n\\t\\t\\t\\t\\tcase 'candidate':\\n\\t\\t\\t\\t\\t\\twebrtc?.onUserStream('candidate', data);\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t\\tcase 'description':\\n\\t\\t\\t\\t\\t\\twebrtc?.onUserStream('description', data);\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t\\tcase 'join':\\n\\t\\t\\t\\t\\t\\twebrtc?.onUserStream('join', data);\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t}\\n\\t\\t\\t});\\n\\t\\t}\\n\\t});\\n});\\n\\nexport { WebRTC };\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_toConsumableArray\",\"_slicedToArray\",\"_inheritsLoose\",\"export\",\"WebRTC\",\"Emitter\",\"Meteor\",\"ReactiveVar\",\"Tracker\",\"GenericModal\",\"imperativeModal\",\"goToRoomById\",\"ChatSubscription\",\"settings\",\"sdk\",\"t\",\"WEB_RTC_EVENTS\",\"ChromeScreenShare\",\"WebRTCTransportClass\",\"_Emitter\",\"webrtcInstance\",\"_this\",\"call\",\"debug\",\"stream\",\"room\",\"WEB_RTC\",\"type\",\"data\",\"log\",\"emit\",\"_proto\",\"prototype\",\"_console\",\"console\",\"apply\",\"arguments\",\"onUserStream\",\"_len\",\"length\",\"_ref\",\"Array\",\"_key\",\"startCall\",\"selfId\",\"publish\",\"CALL\",\"from\",\"media\",\"monitor\",\"joinCall\",\"to\",\"JOIN\",\"sendCandidate\",\"CANDIDATE\",\"sendDescription\",\"DESCRIPTION\",\"sendStatus\",\"STATUS\",\"onRemoteCall\",\"fn\",\"on\",\"onRemoteJoin\",\"onRemoteCandidate\",\"onRemoteDescription\",\"onRemoteStatus\",\"WebRTCClass\",\"_this2\",\"autoAccept\",\"undefined\",\"transport\",\"config\",\"TransportClass\",\"peerConnections\",\"remoteItems\",\"remoteItemsById\",\"callInProgress\",\"audioEnabled\",\"videoEnabled\",\"overlayEnabled\",\"screenShareEnabled\",\"localUrl\",\"active\",\"remoteMonitoring\",\"navigator\",\"screenShareAvailable\",\"resetCallInProgress\",\"set\",\"callInProgressTimeout\",\"audioContext\",\"stopPeerConnection\",\"id\",\"peerConnection\",\"close\",\"updateRemoteItems\",\"localStream\",\"iceServers\",\"servers\",\"get\",\"trim\",\"replace\",\"split\",\"forEach\",\"server\",\"parts\",\"serverConfig\",\"urls\",\"pop\",\"_parts$0$split\",\"_parts$0$split2\",\"username\",\"credential\",\"decodeURIComponent\",\"push\",\"userAgent\",\"toLocaleLowerCase\",\"indexOf\",\"includes\",\"video\",\"audio\",\"bind\",\"setInterval\",\"checkPeerConnections\",\"_proto2\",\"_len2\",\"_ref2\",\"_key2\",\"_console2\",\"onError\",\"_console3\",\"error\",\"_this3\",\"date\",\"Date\",\"now\",\"Object\",\"entries\",\"some\",\"_ref3\",\"_ref4\",\"iceConnectionState\",\"createdAt\",\"items\",\"itemsById\",\"_ref5\",\"_ref6\",\"getRemoteStreams\",\"remoteStream\",\"item\",\"url\",\"state\",\"stateText\",\"connected\",\"broadcastStatus\",\"remoteConnections\",\"_ref7\",\"_ref8\",\"remoteMedia\",\"_this4\",\"clearTimeout\",\"setTimeout\",\"concat\",\"remoteConnection\",\"getPeerConnection\",\"_this5\",\"RTCPeerConnection\",\"eventNames\",\"eventName\",\"addEventListener\",\"e\",\"candidate\",\"sdpMLineIndex\",\"sdpMid\",\"keys\",\"stop\",\"_getUserMedia\",\"onSuccess\",\"_navigator$mediaDevic\",\"_navigator$getUserMed\",\"_navigator\",\"_this6\",\"onSuccessLocal\",\"AudioContext\",\"getAudioTracks\",\"source\",\"createMediaStreamSource\",\"volume\",\"createGain\",\"connect\",\"peer\",\"createMediaStreamDestination\",\"gain\",\"value\",\"removeTrack\",\"addTrack\",\"mediaDevices\",\"getUserMedia\",\"then\",\"catch\",\"_this7\",\"desktop\",\"getScreen\",\"audioStream\",\"refresh\",\"open\",\"component\",\"props\",\"variant\",\"title\",\"isChromeExtensionInstalled\",\"installed\",\"isFirefoxExtensionInstalled\",\"window\",\"rocketchatscreenshare\",\"confirmText\",\"cancelText\",\"children\",\"onConfirm\",\"chrome\",\"webstore\",\"install\",\"_error\",\"getScreenSuccess\",\"mozMediaSource\",\"mediaSource\",\"getSourceId\",\"mandatory\",\"chromeMediaSource\",\"chromeMediaSourceId\",\"maxWidth\",\"maxHeight\",\"getLocalUserMedia\",\"callback\",\"_this8\",\"_len3\",\"args\",\"_key3\",\"disableAudio\",\"disableVideo\",\"_ref9\",\"_ref10\",\"addStream\",\"document\",\"querySelector\",\"srcObject\",\"stopAllPeerConnections\",\"_window$audioContext\",\"setAudioEnabled\",\"enabled\",\"enableAudio\",\"toggleAudio\",\"setVideoEnabled\",\"getVideoTracks\",\"disableScreenShare\",\"setScreenShareEnabled\",\"enableScreenShare\",\"_this9\",\"err\",\"enableVideo\",\"toggleVideo\",\"getTracks\",\"track\",\"_this10\",\"_len4\",\"_key4\",\"startCallAsMonitor\",\"_len5\",\"_key5\",\"icon\",\"_data$media\",\"_data$media2\",\"_this11\",\"user\",\"users\",\"findOne\",\"fromUsername\",\"subscription\",\"rid\",\"name\",\"onCancel\",\"onClose\",\"_this12\",\"_len6\",\"_key6\",\"_data$media3\",\"_data$media4\",\"_this13\",\"_len7\",\"_key7\",\"signalingState\",\"onOffer\",\"offer\",\"setLocalDescription\",\"RTCSessionDescription\",\"ts\",\"description\",\"sdp\",\"createOffer\",\"OfferToReceiveAudio\",\"OfferToReceiveVideo\",\"onRemoteOffer\",\"_this14\",\"_len8\",\"_key8\",\"setRemoteDescription\",\"createAnswer\",\"answer\",\"_this$remoteItems$get\",\"_len9\",\"_key9\",\"addIceCandidate\",\"RTCIceCandidate\",\"_len10\",\"_key10\",\"_class\",\"instancesByRoomId\",\"_proto3\",\"getInstanceByRoomId\",\"visitorId\",\"uid\",\"userId\",\"startup\",\"autorun\",\"webrtc\"],\"mappings\":\"uBAEkBA,EAAMC,IAAA,CAAA,2CAAuB,CAAAC,QAAA,SAAAC,CAAA,EAAAC,EAAAD,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAC,QAAA,SAAAC,CAAA,EAAAE,EAAAF,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAC,QAAA,SAAAC,CAAA,EAAAG,EAAAH,CAAA,CAAA,EAAA,GAA/CH,EAAOO,MAAE,CAAA,CAAAC,OAAS,WAAM,OAAAA,CAAsB,CAAC,GAAAR,EAAAC,IAAA,CAAA,uBAAA,CAAAQ,QAAA,SAAAN,CAAA,EAAAM,EAAAN,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,gBAAA,CAAAS,OAAA,SAAAP,CAAA,EAAAO,EAAAP,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,sBAAA,CAAAU,YAAA,SAAAR,CAAA,EAAAQ,EAAAR,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,iBAAA,CAAAW,QAAA,SAAAT,CAAA,EAAAS,EAAAT,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,0CAAA,CAAA,QAAA,SAAAE,CAAA,EAAAU,EAAAV,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,sCAAA,CAAAa,gBAAA,SAAAX,CAAA,EAAAW,EAAAX,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,yCAAA,CAAAc,aAAA,SAAAZ,CAAA,EAAAY,EAAAZ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,sBAAA,CAAAe,iBAAA,SAAAb,CAAA,EAAAa,EAAAb,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,wBAAA,CAAAgB,SAAA,SAAAd,CAAA,EAAAc,EAAAd,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,mCAAA,CAAAiB,IAAA,SAAAf,CAAA,EAAAe,EAAAf,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uBAAA,CAAAkB,EAAA,SAAAhB,CAAA,EAAAgB,EAAAhB,CAAA,CAAA,EAAA,IAAAH,EAAAC,IAAA,CAAA,mBAAA,CAAAmB,eAAA,SAAAjB,CAAA,EAAAiB,EAAAjB,CAAA,CAAA,EAAA,IAAAH,EAAAC,IAAA,CAAA,gBAAA,CAAAoB,kBAAA,SAAAlB,CAAA,EAAAkB,EAAAlB,CAAA,CAAA,EAAA,IAAA,IAA/CC,EAA+CC,EAAAC,EAAAG,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAkFzCC,EAAqB,SAAAC,CAAA,EAS1B,SAAAD,EAAmBE,CAA2B,EAAA,IAAAC,EAK1C,MAJKA,AAARA,CAAAA,EAAAF,EAAAG,IAAA,CAAA,IAAK,GAAE,IAAA,EADWF,cAAA,CAAA,KAAA,EAAAC,EAFZE,KAAK,CAAG,CAAA,EAEIF,EAAAD,cAAc,CAAdA,EAElBN,EAAIU,MAAM,CAAC,cAAe,CAAIH,EAAKD,cAAc,CAACK,IAAI,CAAA,IAAIT,EAAeU,OAAO,CAAG,CAAE,SAACC,CAAI,CAAEC,CAAI,EAC/FP,EAAKQ,GAAG,CAAC,gCAAiCF,EAAMC,GAChDP,EAAKS,IAAI,CAACH,EAAMC,EACjB,GAAGP,CACJ,CAACnB,EAAAgB,EAAAC,GAAA,IAAAY,EAAAb,EAAAc,SAAA,CAsHA,OAtHAD,EAEDF,GAAG,CAAH,WACC,GAAI,AAAe,CAAA,IAAf,IAAI,CAACN,KAAK,CAAW,CAAA,IAAAU,EACxB,AAAAA,CAAAA,EAAAC,OAAAA,EAAQL,GAAG,CAAAM,KAAA,CAAAF,EAAAG,UACZ,CACD,EAACL,EAQDM,YAAY,CAAZ,WAIkC,IAAA,IAAAC,EAAAF,UAAAG,MAAA,CAAAC,EAAA,AAAAC,MAAAH,GAAAI,EAAA,EAAAA,EAAAJ,EAAAI,IAAAF,CAAA,CAAAE,EAAA,CAAAN,SAAA,CAAAM,EAAA,CAAA,IAH7Bf,EAAIa,CAAA,CAAA,EAAA,CAAEZ,EAAIY,CAAA,CAAA,EAAA,CAKd,GAAIZ,EAAKH,IAAI,GAAK,IAAI,CAACL,cAAc,CAACK,IAAI,CAM1C,OAFA,IAAI,CAACI,GAAG,CAAC,gCAAiCF,EAAMC,GAExCD,GACP,IAAK,YACJ,IAAI,CAACG,IAAI,CAAC,YAAaF,GACvB,KACD,KAAK,cACJ,IAAI,CAACE,IAAI,CAAC,cAAeF,GACzB,KACD,KAAK,OACJ,IAAI,CAACE,IAAI,CAAC,OAAQF,EAEpB,CACD,EAACG,EAEDY,SAAS,CAAT,SAAUf,CAAc,EACvB,IAAI,CAACC,GAAG,CAAC,mCAAoC,IAAI,CAACT,cAAc,CAACK,IAAI,CAAE,IAAI,CAACL,cAAc,CAACwB,MAAM,EACjG9B,EAAI+B,OAAO,CAAC,oBAAqB,CAC7B,IAAI,CAACzB,cAAc,CAACK,IAAI,CAAA,IAAIT,EAAeU,OAAO,CACrDV,EAAe8B,IAAI,CACnB,CACCC,KAAM,IAAI,CAAC3B,cAAc,CAACwB,MAAM,CAChCnB,KAAM,IAAI,CAACL,cAAc,CAACK,IAAI,CAC9BuB,MAAOpB,EAAKoB,KAAK,CACjBC,QAASrB,EAAKqB,OAAAA,EAEf,CACF,EAAClB,EAEDmB,QAAQ,CAAR,SAAStB,CAAc,EACtB,IAAI,CAACC,GAAG,CAAC,kCAAmC,IAAI,CAACT,cAAc,CAACK,IAAI,CAAE,IAAI,CAACL,cAAc,CAACwB,MAAM,EAC5FhB,AAAiB,CAAA,IAAjBA,EAAKqB,OAAO,CACfnC,EAAI+B,OAAO,CAAC,cAAe,CACvBjB,EAAKuB,EAAE,CAAA,IAAInC,EAAeU,OAAO,CACpCV,EAAeoC,IAAI,CACnB,CACCL,KAAM,IAAI,CAAC3B,cAAc,CAACwB,MAAM,CAChCnB,KAAM,IAAI,CAACL,cAAc,CAACK,IAAI,CAC9BuB,MAAOpB,EAAKoB,KAAK,CACjBC,QAASrB,EAAKqB,OAAAA,EAEf,EAEDnC,EAAI+B,OAAO,CAAC,oBAAqB,CAC7B,IAAI,CAACzB,cAAc,CAACK,IAAI,CAAA,IAAIT,EAAeU,OAAO,CACrDV,EAAeoC,IAAI,CACnB,CACCL,KAAM,IAAI,CAAC3B,cAAc,CAACwB,MAAM,CAChCnB,KAAM,IAAI,CAACL,cAAc,CAACK,IAAI,CAC9BuB,MAAOpB,EAAKoB,KAAK,CACjBC,QAASrB,EAAKqB,OAAAA,EAEf,CAEH,EAAClB,EAEDsB,aAAa,CAAb,SAAczB,CAAmB,EAChCA,EAAKmB,IAAI,CAAG,IAAI,CAAC3B,cAAc,CAACwB,MAAM,CACtChB,EAAKH,IAAI,CAAG,IAAI,CAACL,cAAc,CAACK,IAAI,CACpC,IAAI,CAACI,GAAG,CAAC,uCAAwCD,GACjDd,EAAI+B,OAAO,CAAC,cAAe,CAAIjB,EAAKuB,EAAE,CAAA,IAAInC,EAAeU,OAAO,CAAIV,EAAesC,SAAS,CAAE1B,EAAK,CACpG,EAACG,EAEDwB,eAAe,CAAf,SAAgB3B,CAAqB,EACpCA,EAAKmB,IAAI,CAAG,IAAI,CAAC3B,cAAc,CAACwB,MAAM,CACtChB,EAAKH,IAAI,CAAG,IAAI,CAACL,cAAc,CAACK,IAAI,CACpC,IAAI,CAACI,GAAG,CAAC,yCAA0CD,GACnDd,EAAI+B,OAAO,CAAC,cAAe,CAAIjB,EAAKuB,EAAE,CAAA,IAAInC,EAAeU,OAAO,CAAIV,EAAewC,WAAW,CAAE5B,EAAK,CACtG,EAACG,EAED0B,UAAU,CAAV,SAAW7B,CAAgB,EAC1B,IAAI,CAACC,GAAG,CAAC,oCAAqCD,EAAM,IAAI,CAACR,cAAc,CAACK,IAAI,EAC5EG,EAAKmB,IAAI,CAAG,IAAI,CAAC3B,cAAc,CAACwB,MAAM,CACtC9B,EAAI+B,OAAO,CAAC,cAAe,CAAI,IAAI,CAACzB,cAAc,CAACK,IAAI,CAAA,IAAIT,EAAeU,OAAO,CAAIV,EAAe0C,MAAM,CAAE9B,EAAK,CAClH,EAACG,EAED4B,YAAY,CAAZ,SAAaC,CAA4B,EACxC,OAAO,IAAI,CAACC,EAAE,CAAC7C,EAAe8B,IAAI,CAAEc,EACrC,EAAC7B,EAED+B,YAAY,CAAZ,SAAaF,CAA4B,EACxC,OAAO,IAAI,CAACC,EAAE,CAAC7C,EAAeoC,IAAI,CAAEQ,EACrC,EAAC7B,EAEDgC,iBAAiB,CAAjB,SAAkBH,CAAiC,EAClD,OAAO,IAAI,CAACC,EAAE,CAAC7C,EAAesC,SAAS,CAAEM,EAC1C,EAAC7B,EAEDiC,mBAAmB,CAAnB,SAAoBJ,CAAmC,EACtD,OAAO,IAAI,CAACC,EAAE,CAAC7C,EAAewC,WAAW,CAAEI,EAC5C,EAAC7B,EAEDkC,cAAc,CAAd,SAAeL,CAA8B,EAC5C,OAAO,IAAI,CAACC,EAAE,CAAC7C,EAAe0C,MAAM,CAAEE,EACvC,EAAC1C,CAAA,EArIiCb,GAwI7B6D,EAAW,WAuChB,SAAAA,EAAmBtB,CAAc,CAASnB,CAAY,EAA2B,IAAA0C,EAAA,IAAA,CAAlBC,EAAAhC,UAAAG,MAAA,CAAA,GAAAH,AAAAiC,KAAAA,IAAAjC,SAAA,CAAA,EAAA,EAAAA,SAAA,CAAA,EAAA,AAAkB,CAAA,IAAA,CAA9DQ,MAAA,CAAA,KAAA,EAAA,IAAA,CAAuBnB,IAAA,CAAA,KAAA,EAAA,IAAA,CAAqB2C,UAAA,CAAA,KAAA,EAAA,IAAA,CAtC/DE,SAAS,CAAA,KAAA,EAAA,IAAA,CAETC,MAAM,CAAA,KAAA,EAAA,IAAA,CAENhD,KAAK,CAAA,KAAA,EAAA,IAAA,CAELiD,cAAc,CAAA,KAAA,EAAA,IAAA,CAEdC,eAAe,CAAsC,CAAA,EAAE,IAAA,CAEvDC,WAAW,CAAA,KAAA,EAAA,IAAA,CAEXC,eAAe,CAAA,KAAA,EAAA,IAAA,CAEfC,cAAc,CAAA,KAAA,EAAA,IAAA,CAEdC,YAAY,CAAA,KAAA,EAAA,IAAA,CAEZC,YAAY,CAAA,KAAA,EAAA,IAAA,CAEZC,cAAc,CAAA,KAAA,EAAA,IAAA,CAEdC,kBAAkB,CAAA,KAAA,EAAA,IAAA,CAElBC,QAAQ,CAAA,KAAA,EAAA,IAAA,CAERC,MAAM,CAAA,KAAA,EAAA,IAAA,CAENC,gBAAgB,CAAA,KAAA,EAAA,IAAA,CAEhBlC,OAAO,CAAA,KAAA,EAAA,IAAA,CAEPmC,SAAS,CAAA,KAAA,EAAA,IAAA,CAETC,oBAAoB,CAAA,KAAA,EAAA,IAAA,CAEpBrC,KAAK,CAAA,KAAA,EAAA,IAAA,CAwJLsC,mBAAmB,CAAG,WACrBnB,EAAKS,cAAc,CAACW,GAAG,CAAC,CAAA,EACzB,EAAC,IAAA,CAqBDC,qBAAqB,CAA8CnB,KAAAA,EAAS,IAAA,CA8F5EoB,YAAY,CAAA,KAAA,EAAA,IAAA,CA6JZC,kBAAkB,CAAG,SAACC,CAAU,EAC/B,IAAMC,EAAiBzB,EAAKM,eAAe,CAACkB,EAAG,AACzB,OAAlBC,IAGJ,OAAOzB,EAAKM,eAAe,CAACkB,EAAG,CAC/BC,EAAeC,KAAK,GACpB1B,EAAK2B,iBAAiB,GACvB,EAAC,IAAA,CAkCDC,WAAW,CAAA,KAAA,EAldQ,IAAA,CAAAnD,MAAM,CAANA,EAAuB,IAAA,CAAAnB,IAAI,CAAJA,EAAqB,IAAA,CAAA2C,UAAU,CAAVA,EAC9D,IAAI,CAACG,MAAM,CAAG,CACbyB,WAAY,EAAA,EAEb,IAAI,CAACzE,KAAK,CAAG,CAAA,EACb,IAAI,CAACiD,cAAc,CAAGtD,EACtB,IAAI+E,EAAUpF,EAASqF,GAAG,CAAS,kBAC/BD,GAAWA,AAAmB,KAAnBA,EAAQE,IAAI,IAG1BF,AAFAA,CAAAA,EAAUA,EAAQG,OAAO,CAAC,MAAO,GAAE,EAE3BC,KAAK,CAAC,KAAKC,OAAO,CAAC,SAACC,CAAM,EACjC,IAAMC,EAAQD,EAAOF,KAAK,CAAC,KACrBI,EAA6B,CAClCC,KAAMF,EAAMG,GAAG,IAEhB,GAAIH,AAAiB,IAAjBA,EAAMjE,MAAM,CAAQ,CACvB,IAAAqE,EAA+BJ,CAAK,CAAC,EAAE,CAACH,KAAK,CAAC,KAAIQ,EAAA5G,EAAA2G,EAAA,GAA3CE,EAAQD,CAAA,CAAA,EAAA,CAAEE,EAAUF,CAAA,CAAA,EAAA,AAC3BJ,CAAAA,EAAaK,QAAQ,CAAGE,mBAAmBF,GAC3CL,EAAaM,UAAU,CAAGC,mBAAmBD,EAC9C,CACA5C,EAAKI,MAAM,CAACyB,UAAU,CAACiB,IAAI,CAACR,EAC7B,GAED,IAAI,CAAChC,eAAe,CAAG,CAAA,EACvB,IAAI,CAACC,WAAW,CAAG,IAAInE,EAAY,EAAE,EACrC,IAAI,CAACoE,eAAe,CAAG,IAAIpE,EAAY,CAAA,GACvC,IAAI,CAACqE,cAAc,CAAG,IAAIrE,EAAY,CAAA,GACtC,IAAI,CAACsE,YAAY,CAAG,IAAItE,EAAY,CAAA,GACpC,IAAI,CAACuE,YAAY,CAAG,IAAIvE,EAAY,CAAA,GACpC,IAAI,CAACwE,cAAc,CAAG,IAAIxE,EAAY,CAAA,GACtC,IAAI,CAACyE,kBAAkB,CAAG,IAAIzE,EAAY,CAAA,GAC1C,IAAI,CAAC0E,QAAQ,CAAG,IAAI1E,EAAY8D,KAAAA,GAChC,IAAI,CAACa,MAAM,CAAG,CAAA,EACd,IAAI,CAACC,gBAAgB,CAAG,CAAA,EACxB,IAAI,CAAClC,OAAO,CAAG,CAAA,EACf,IAAI,CAACmC,SAAS,CAAGf,KAAAA,EACjB,IAAM6C,EAAY9B,UAAU8B,SAAS,CAACC,iBAAiB,EAEnDD,AAAkC,CAAA,KAAlCA,EAAUE,OAAO,CAAC,YACrB,IAAI,CAAChC,SAAS,CAAG,WACP8B,AAAgC,KAAhCA,EAAUE,OAAO,CAAC,UAC5B,IAAI,CAAChC,SAAS,CAAG,SACP8B,AAAiC,KAAjCA,EAAUE,OAAO,CAAC,WAC5B,IAAI,CAAChC,SAAS,CAAG,UACyB,KAAhC8B,EAAUE,OAAO,CAAC,WAC5B,CAAA,IAAI,CAAChC,SAAS,CAAG,QAAA,EAGlB,IAAI,CAACC,oBAAoB,CAAG,CAAC,SAAU,UAAW,WAAW,CAACgC,QAAQ,CAAC,IAAI,CAACjC,SAAU,EACtF,IAAI,CAACpC,KAAK,CAAG,CACZsE,MAAO,CAAA,EACPC,MAAO,CAAA,GAER,IAAI,CAACjD,SAAS,CAAG,IAAI,IAAI,CAACE,cAAc,CAAC,IAAI,EAC7C,IAAI,CAACF,SAAS,CAACX,YAAY,CAAC,IAAI,CAACA,YAAY,CAAC6D,IAAI,CAAC,IAAI,GACvD,IAAI,CAAClD,SAAS,CAACR,YAAY,CAAC,IAAI,CAACA,YAAY,CAAC0D,IAAI,CAAC,IAAI,GACvD,IAAI,CAAClD,SAAS,CAACP,iBAAiB,CAAC,IAAI,CAACA,iBAAiB,CAACyD,IAAI,CAAC,IAAI,GACjE,IAAI,CAAClD,SAAS,CAACN,mBAAmB,CAAC,IAAI,CAACA,mBAAmB,CAACwD,IAAI,CAAC,IAAI,GACrE,IAAI,CAAClD,SAAS,CAACL,cAAc,CAAC,IAAI,CAACA,cAAc,CAACuD,IAAI,CAAC,IAAI,GAE3DC,YAAY,IAAI,CAACC,oBAAoB,CAACF,IAAI,CAAC,IAAI,EAAG,IACnD,CAAC,IAAAG,EAAAzD,EAAAlC,SAAA,CA8rBA,OA9rBA2F,EAQDtF,YAAY,CAAZ,WAIkC,IAAA,IAAAuF,EAAAxF,UAAAG,MAAA,CAAAsF,EAAA,AAAApF,MAAAmF,GAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAAAD,CAAA,CAAAC,EAAA,CAAA1F,SAAA,CAAA0F,EAAA,CAAA,IAH7BnG,EAAIkG,CAAA,CAAA,EAAA,CAAEjG,EAAIiG,CAAA,CAAA,EAAA,CAKd,OAAQlG,GACP,IAAK,YACJ,IAAI,CAAC2C,SAAS,CAACjC,YAAY,CAAC,YAAaT,GACzC,KAED,KAAK,cACJ,IAAI,CAAC0C,SAAS,CAACjC,YAAY,CAAC,cAAeT,GAC3C,KAED,KAAK,OACJ,IAAI,CAAC0C,SAAS,CAACjC,YAAY,CAAC,OAAQT,EAEtC,CACD,EAAC+F,EAED9F,GAAG,CAAH,WACC,GAAI,AAAe,CAAA,IAAf,IAAI,CAACN,KAAK,CAAW,CAAA,IAAAwG,EACxB,AAAAA,CAAAA,EAAA7F,OAAAA,EAAQL,GAAG,CAAAM,KAAA,CAAA4F,EAAA3F,UACZ,CACD,EAACuF,EAEDK,OAAO,CAAP,WAA0B,IAAAC,EACzB,AAAAA,CAAAA,EAAA/F,OAAAA,EAAQgG,KAAK,CAAA/F,KAAA,CAAA8F,EAAA7F,UACd,EAACuF,EAEDD,oBAAoB,CAApB,WAAoB,IAAAS,EAAA,IAAA,CACX1D,EAAoB,IAAI,CAAxBA,eAAe,CACjB2D,EAAOC,KAAKC,GAAG,GACrBC,OAAOC,OAAO,CAAC/D,GAAiBgE,IAAI,CAAC,SAAAC,CAAA,EAAyB,IAAAC,EAAA1I,EAAAyI,EAAA,GAAvB/C,EAAEgD,CAAA,CAAA,EAAA,CAAE/C,EAAc+C,CAAA,CAAA,EAAA,OACxD,AAAI,CAAC,CAAC,YAAa,YAAY,CAACtB,QAAQ,CAACzB,EAAegD,kBAAkB,GAAKhD,EAAeiD,SAAS,CAAG,IAAOT,IAChHD,EAAKzC,kBAAkB,CAACC,GACjB,CAAA,EAGT,EACD,EAACgC,EAED7B,iBAAiB,CAAjB,WACC,IAAMgD,EAAsB,EAAE,CACxBC,EAAwC,CAAA,EAG9CR,OAAOC,OAAO,CAFc,IAAI,CAAxB/D,eAAe,EAES6B,OAAO,CAAC,SAAA0C,CAAA,EAAyB,IAAAC,EAAAhJ,EAAA+I,EAAA,GAAvBrD,EAAEsD,CAAA,CAAA,EAAA,CAAErD,EAAcqD,CAAA,CAAA,EAAA,CAC3DrD,EAAesD,gBAAgB,GAAG5C,OAAO,CAAC,SAAC6C,CAAY,EACtD,IAAMC,EAAmB,CACxBzD,GAAAA,EACA0D,IAAKF,EACLG,MAAO1D,EAAegD,kBAAAA,EAEvB,OAAQhD,EAAegD,kBAAkB,EACxC,IAAK,WACJQ,EAAKG,SAAS,CAAG,gBACjB,KACD,KAAK,YACL,IAAK,YACJH,EAAKG,SAAS,CAAG,YACjBH,EAAKI,SAAS,CAAG,CAAA,EACjB,KACD,KAAK,eACJJ,EAAKG,SAAS,CAAG,eACjB,KACD,KAAK,SACJH,EAAKG,SAAS,CAAG,SACjB,KACD,KAAK,SACJH,EAAKG,SAAS,CAAG,QACnB,CACAT,EAAM7B,IAAI,CAACmC,GACXL,CAAS,CAACpD,EAAG,CAAGyD,CACjB,EACD,GACA,IAAI,CAAC1E,WAAW,CAACa,GAAG,CAACuD,GACrB,IAAI,CAACnE,eAAe,CAACY,GAAG,CAACwD,EAC1B,EAACpB,EAMD8B,eAAe,CAAf,WACC,GAAI,AAAgB,CAAA,IAAhB,IAAI,CAACvE,MAAM,EAAa,AAAiB,CAAA,IAAjB,IAAI,CAACjC,OAAO,EAAa,AAA0B,CAAA,IAA1B,IAAI,CAACkC,gBAAgB,EAG1E,IAAMuE,EAAwC,EAAE,CAEhDnB,OAAOC,OAAO,CADc,IAAI,CAAxB/D,eAAe,EACS6B,OAAO,CAAC,SAAAqD,CAAA,EAAiC,IAAAC,EAAA3J,EAAA0J,EAAA,GAA/BhE,EAAEiE,CAAA,CAAA,EAAA,CAAiB5G,EAAK4G,CAAA,CAAA,EAAA,CAAlBC,WAAW,CAC1DH,EAAkBzC,IAAI,CAAC,CACtBtB,GAAAA,EACA3C,MAAAA,GAEF,GAEA,IAAI,CAACsB,SAAS,CAACb,UAAU,CAAC,CACzBT,MAAO,IAAI,CAACA,KAAK,CACjB0G,kBAAAA,IAEF,EAAC/B,EAID1D,cAAc,CAAd,SAAerC,CAAgB,EAAA,IAAAkI,EAAA,IAAA,CAE9B,IAAI,CAAClF,cAAc,CAACW,GAAG,CAAC,CAAA,GACxBwE,aAAa,IAAI,CAACvE,qBAAqB,EACvC,IAAI,CAACA,qBAAqB,CAAGwE,WAAW,IAAI,CAAC1E,mBAAmB,CAAE,KAC9C,CAAA,IAAhB,IAAI,CAACJ,MAAM,EAWfwE,AARuB,CACtB,CACC/D,GAAI/D,EAAKmB,IAAK,CACdC,MAAOpB,EAAKoB,KAAAA,EACZ,CAAAiH,MAAA,CAAAjK,EACE4B,EAAK8H,iBAAiB,GAGRpD,OAAO,CAAC,SAAC4D,CAAgB,EACtCA,EAAiBvE,EAAE,GAAKmE,EAAKlH,MAAM,EAAIkH,AAA6C,MAA7CA,EAAKrF,eAAe,CAACyF,EAAiBvE,EAAE,CAAC,GACnFmE,EAAKjI,GAAG,CAAC,oBAAqBqI,EAAiBvE,EAAE,EACjDmE,EAAKhG,YAAY,CAAC,CACjBf,KAAMmH,EAAiBvE,EAAE,CACzB3C,MAAOkH,EAAiBlH,KAAAA,GAG3B,EACD,EAAC2E,EAEDwC,iBAAiB,CAAjB,SAAkBxE,CAAU,EAAA,IAAAyE,EAAA,IAAA,CAC3B,GAAI,AAA4B,MAA5B,IAAI,CAAC3F,eAAe,CAACkB,EAAG,CAC3B,OAAO,IAAI,CAAClB,eAAe,CAACkB,EAAG,CAEhC,IAAMC,EAAiB,IAAIyE,kBAAkB,IAAI,CAAC9F,MAAM,SAExDqB,EAAeiD,SAAS,CAAGR,KAAKC,GAAG,GACnC1C,EAAeiE,WAAW,CAAG,CAAA,EAC7B,IAAI,CAACpF,eAAe,CAACkB,EAAG,CAAGC,EAe3B0E,AAdmB,CAClB,eACA,YACA,eACA,2BACA,cACA,iBACA,oBACA,qBACA,oBACA,eACA,uBACA,CAEUhE,OAAO,CAAC,SAACiE,CAAS,EAC5B3E,EAAe4E,gBAAgB,CAACD,EAAW,SAACE,CAAC,EAC5CL,EAAKvI,GAAG,CAAC8D,EAAI8E,EAAE9I,IAAI,CAAE8I,EACtB,EACD,GAEA7E,EAAe4E,gBAAgB,CAAC,eAAgB,SAACC,CAAC,EAC9B,MAAfA,EAAEC,SAAS,EAGfN,EAAK9F,SAAS,CAACjB,aAAa,CAAC,CAC5BF,GAAIwC,EACJ+E,UAAW,CACVA,UAAWD,EAAEC,SAAS,CAACA,SAAS,CAChCC,cAAeF,EAAEC,SAAS,CAACC,aAAa,CACxCC,OAAQH,EAAEC,SAAS,CAACE,MAAAA,GAGvB,GACAhF,EAAe4E,gBAAgB,CAAC,YAAa,WAC5CJ,EAAKtE,iBAAiB,EACvB,GACAF,EAAe4E,gBAAgB,CAAC,eAAgB,WAC/CJ,EAAKtE,iBAAiB,EACvB,GACAF,EAAe4E,gBAAgB,CAAC,2BAA4B,WAEzD5E,CAAAA,AAAsC,iBAAtCA,EAAegD,kBAAkB,EAAuBhD,AAAsC,WAAtCA,EAAegD,kBAAkB,AAAK,GAC/FhD,IAAmBwE,EAAK3F,eAAe,CAACkB,EAAG,GAE3CyE,EAAK1E,kBAAkB,CAACC,GACxBqE,WAAW,WACuC,IAA7CzB,OAAOsC,IAAI,CAACT,EAAK3F,eAAe,EAAElC,MAAM,EAC3C6H,EAAKU,IAAI,EAEX,EAAG,MAEJV,EAAKtE,iBAAiB,EACvB,GACOF,CACR,EAAC+B,EAIDoD,aAAa,CAAb,SAAc/H,CAA6B,CAAEgI,CAAwC,CAAEhD,CAA8B,EAAA,IAAAiD,EAAAC,EAAAC,EAAAC,EAAA,IAAA,CAC9GC,EAAiB,SAAC7J,CAAmB,EAC1C,GAAI8J,cAAgB9J,EAAO+J,cAAc,GAAGhJ,MAAM,CAAG,EAAG,CACvD,IAAMkD,EAAe,IAAI6F,aACnBE,EAAS/F,EAAagG,uBAAuB,CAACjK,GAC9CkK,EAASjG,EAAakG,UAAU,GACtCH,EAAOI,OAAO,CAACF,GACf,IAAMG,EAAOpG,EAAaqG,4BAA4B,GACtDJ,EAAOE,OAAO,CAACC,GACfH,EAAOK,IAAI,CAACC,KAAK,CAAG,GACpBxK,EAAOyK,WAAW,CAACzK,EAAO+J,cAAc,EAAE,CAAC,EAAE,EAC7C/J,EAAO0K,QAAQ,CAACL,EAAKrK,MAAM,CAAC+J,cAAc,EAAE,CAAC,EAAE,EAC/C/J,EAAOkK,MAAM,CAAGA,EAChBN,EAAK3F,YAAY,CAAGA,CACrB,CACAuF,EAAUxJ,EACX,EAEA,GAAA,AAA0B,OAA1ByJ,CAAAA,EAAI7F,UAAU+G,YAAY,AAAZA,GAAYlB,AAAA,KAAA,IAAAA,GAAtBA,EAAwBmB,YAAY,CACvC,OAAOhH,UAAU+G,YAAY,CAACC,YAAY,CAACpJ,GAAOqJ,IAAI,CAAChB,GAAgBiB,KAAK,CAACtE,EAG9E,AAAsB,QAAtBkD,CAAAA,EAAA,AAAAC,CAAAA,EAAA/F,SAAAA,EAAUgH,YAAY,AAAZA,GAAYlB,AAAA,KAAA,IAAAA,GAAtBA,EAAA5J,IAAA,CAAA6J,EAAyBnI,EAAOqI,EAAgBrD,EACjD,EAACL,EAEDyE,YAAY,CAAZ,SAAapJ,CAA6B,CAAEgI,CAAwC,EAA8C,IAAAuB,EAAA,IAAA,CAA5CvE,EAAA5F,UAAAG,MAAA,CAAA,GAAAH,AAAAiC,KAAAA,IAAAjC,SAAA,CAAA,EAAA,CAAAA,SAAA,CAAA,EAAA,CAAgC,IAAI,CAAC4F,OAAO,CACjI,GAAIhF,AAAkB,CAAA,IAAlBA,EAAMwJ,OAAO,CAAW,CACtB,IAAI,CAACzB,aAAa,CAAC/H,EAAOgI,EAAWhD,GAC1C,MACD,CACA,GAAI,AAA8B,CAAA,IAA9B,IAAI,CAAC3C,oBAAoB,CAAW,CACvCnD,QAAQL,GAAG,CAAC,iCACZ,MACD,CACA,IAAM4K,EAAY,SAACC,CAAyB,EAC3C,IAAMC,EAAU,WACfjM,EAAgBkM,IAAI,CAAC,CACpBC,UAAWpM,EACXqM,MAAO,CACNC,QAAS,UACTC,MAAOjM,EAAE,8DAGZ,EAEMkM,EAA6BV,AAAmB,WAAnBA,EAAKnH,SAAS,EAAiBnE,EAAkBiM,SAAS,CACvFC,EAA8BZ,AAAmB,YAAnBA,EAAKnH,SAAS,EAAkBgI,AAAgC,MAAhCA,OAAOC,qBAAqB,CAEhG,GAAI,CAACJ,GAA8B,CAACE,EA8BnC,OA7BAzM,EAAgBkM,IAAI,CAAC,CACpBC,UAAWpM,EACXqM,MAAO,CACNE,MAAOjM,EAAE,gBACTgM,QAAS,UACTO,YAAavM,EAAE,qBACfwM,WAAYxM,EAAE,UACdyM,SAAUzM,EAAE,yDACZ0M,UAAW,WACV,GAAIlB,AAAmB,WAAnBA,EAAKnH,SAAS,CAAe,CAChC,IAAMiE,EAAM,qGACZ,GAAI,CACHqE,OAAOC,QAAQ,CAACC,OAAO,CAACvE,EAAKsD,EAAS,WACrCS,OAAOR,IAAI,CAACvD,GACZsD,GACD,EACD,CAAE,MAAOkB,EAAQ,CAChB3L,QAAQL,GAAG,CAACgM,GACZT,OAAOR,IAAI,CAACvD,GACZsD,GACD,CACD,KAA8B,YAAnBJ,EAAKnH,SAAS,GACxBgI,OAAOR,IAAI,CAAC,2EACZD,IAEF,KAIK3E,EAAQ,CAAA,GAGhB,IAAM8F,EAAmB,SAACtM,CAAmB,EACzB,MAAfkL,GACHlL,EAAO0K,QAAQ,CAACQ,EAAYnB,cAAc,EAAE,CAAC,EAAE,EAEhDP,EAAUxJ,EACX,CACI+K,AAAmB,CAAA,YAAnBA,EAAKnH,SAAS,EACjBpC,EAAQ,CACPuE,MAAOvE,EAAMuE,KAAK,CAClBD,MAAO,CACNyG,eAAgB,SAChBC,YAAa,WAGVzB,EAAKxB,aAAa,CAAC/H,EAAO8K,EAAkB9F,IAEjD/G,EAAkBgN,WAAW,CAAC1B,EAAKnH,SAAU,CAAE,SAACO,CAAE,EACjD3C,EAAQ,CACPuE,MAAO,CAAA,EACPD,MAAO,CACN4G,UAAW,CACVC,kBAAmB,UACnBC,oBAAqBzI,EACrB0I,SAAU,KACVC,UAAW,OAIT/B,EAAKxB,aAAa,CAAC/H,EAAO8K,EAAkB9F,EAClD,EAEF,CACI,AAAmB,CAAA,YAAnB,IAAI,CAAC5C,SAAS,EAAkBpC,AAAe,MAAfA,EAAMuE,KAAK,EAAYvE,AAAgB,CAAA,IAAhBA,EAAMuE,KAAK,CACrEkF,IASK,IAAI,CAAC1B,aAAa,CACtB,CACCxD,MAAOvE,EAAMuE,KAAAA,EATS,SAACmF,CAAwB,EAChDD,EAAUC,EACX,EACsB,WACrBD,GACD,EAUF,EAAC9E,EAED4G,iBAAiB,CAAjB,SAAkBC,CAAkC,EAAoB,IAAA,IAAAC,EAAA,IAAA,CAAAC,EAAAtM,UAAAG,MAAA,CAAfoM,EAAe,AAAAlM,MAAAiM,EAAA,EAAAA,EAAA,EAAA,GAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAAfD,CAAe,CAAAC,EAAA,EAAA,CAAAxM,SAAA,CAAAwM,EAAA,CAEvE,GADA,IAAI,CAAC/M,GAAG,CAAC,oBAAmB,CAAG2M,EAAQ,CAAAvE,MAAA,CAAK0E,IACxC,AAAoB,MAApB,IAAI,CAAC5I,WAAW,CACnB,OAAOyI,EAAS,KAAM,IAAI,CAACzI,WAAW,EAgBvC,IAAI,CAACqG,YAAY,CAAC,IAAI,CAACpJ,KAAK,CAdV,SAACxB,CAAmB,EACrCiN,EAAK1I,WAAW,CAAGvE,EACnB,AAACiN,EAAK5J,YAAY,CAACqB,GAAG,IAAMuI,EAAKI,YAAY,GAC7C,AAACJ,EAAK3J,YAAY,CAACoB,GAAG,IAAMuI,EAAKK,YAAY,GAC7CL,EAAKxJ,QAAQ,CAACM,GAAG,CAAC/D,GAElB+G,OAAOC,OAAO,CADciG,EAApBhK,eAAe,EACS6B,OAAO,CAAC,SAAAyI,CAAA,EAAkB,OAAMnJ,AAANoJ,AAAlB/O,EAAA8O,EAAA,EAAkB,CAAA,EAAA,CAAqBE,SAAS,CAACzN,EAAO,GAChG0N,SAASC,aAAa,CAAmB,oBAAqBC,SAAS,CAAG5N,EAC1EgN,EAAS,KAAMC,EAAK1I,WAAW,CAChC,EACgB,SAACmC,CAAU,EAC1BsG,EAAS,CAAA,GACTC,EAAKzG,OAAO,CAACE,EACd,EAED,EAACP,EAYD0H,sBAAsB,CAAtB,WACC,IADqBC,EAGrB/G,OAAOsC,IAAI,CAFiB,IAAI,CAAxBpG,eAAe,EAEM6B,OAAO,CAAC,IAAI,CAACZ,kBAAkB,EAE5D,AAAwB,OAAxB4J,CAAAA,EAAKlC,OAAO3H,YAAY,AAAZA,GAAY6J,AAAA,KAAA,IAAAA,GAAnBA,EAAqBzJ,KAAK,EAChC,EAAC8B,EAED4H,eAAe,CAAf,WAA8B,IAAdC,EAAOpN,CAAAA,CAAAA,UAAAG,MAAA,CAAA,CAAA,GAAAH,AAAAiC,KAAAA,IAAAjC,SAAA,CAAA,EAAA,EAAAA,SAAA,CAAA,EAAA,AACE,OAApB,IAAI,CAAC2D,WAAW,GACnB,IAAI,CAACA,WAAW,CAACwF,cAAc,GAAGjF,OAAO,CAAC,SAACiB,CAAK,EAC/CA,EAAMiI,OAAO,CAAGA,CACjB,GACA,IAAI,CAAC3K,YAAY,CAACU,GAAG,CAACiK,GAExB,EAAC7H,EAEDkH,YAAY,CAAZ,WACC,IAAI,CAACU,eAAe,CAAC,CAAA,EACtB,EAAC5H,EAED8H,WAAW,CAAX,WACC,IAAI,CAACF,eAAe,CAAC,CAAA,EACtB,EAAC5H,EAED+H,WAAW,CAAX,kBACC,AAAI,IAAI,CAAC7K,YAAY,CAACqB,GAAG,GACjB,IAAI,CAAC2I,YAAY,GAElB,IAAI,CAACY,WAAW,EACxB,EAAC9H,EAIDgI,eAAe,CAAf,WAA8B,IAAdH,EAAOpN,CAAAA,CAAAA,UAAAG,MAAA,CAAA,CAAA,GAAAH,AAAAiC,KAAAA,IAAAjC,SAAA,CAAA,EAAA,EAAAA,SAAA,CAAA,EAAA,AACE,OAApB,IAAI,CAAC2D,WAAW,GACnB,IAAI,CAACA,WAAW,CAAC6J,cAAc,GAAGtJ,OAAO,CAAC,SAACgB,CAAK,EAC/CA,EAAMkI,OAAO,CAAGA,CACjB,GACA,IAAI,CAAC1K,YAAY,CAACS,GAAG,CAACiK,GAExB,EAAC7H,EAEDkI,kBAAkB,CAAlB,WACC,IAAI,CAACC,qBAAqB,CAAC,CAAA,EAC5B,EAACnI,EAEDoI,iBAAiB,CAAjB,WACC,IAAI,CAACD,qBAAqB,CAAC,CAAA,EAC5B,EAACnI,EAEDmI,qBAAqB,CAArB,WAAoC,IAAAE,EAAA,IAAA,CAAdR,EAAOpN,CAAAA,CAAAA,UAAAG,MAAA,CAAA,CAAA,GAAAH,AAAAiC,KAAAA,IAAAjC,SAAA,CAAA,EAAA,EAAAA,SAAA,CAAA,EAAA,AACJ,OAApB,IAAI,CAAC2D,WAAW,GACnB,IAAI,CAAC/C,KAAK,CAACwJ,OAAO,CAAGgD,EACrB,OAAO,IAAI,CAACzJ,WAAW,CACvB,IAAI,CAACwI,iBAAiB,CAAC,SAAC0B,CAAG,EACf,MAAPA,IAGJD,EAAKhL,kBAAkB,CAACO,GAAG,CAACiK,GAC5BQ,EAAKX,sBAAsB,GAC3BW,EAAK9M,QAAQ,GACd,GAEF,EAACyE,EAEDmH,YAAY,CAAZ,WACC,IAAI,CAACa,eAAe,CAAC,CAAA,EACtB,EAAChI,EAEDuI,WAAW,CAAX,WACC,IAAI,CAACP,eAAe,CAAC,CAAA,EACtB,EAAChI,EAEDwI,WAAW,CAAX,kBACC,AAAI,IAAI,CAACrL,YAAY,CAACoB,GAAG,GACjB,IAAI,CAAC4I,YAAY,GAElB,IAAI,CAACoB,WAAW,EACxB,EAACvI,EAEDmD,IAAI,CAAJ,WACC,IAAI,CAAC5F,MAAM,CAAG,CAAA,EACd,IAAI,CAACjC,OAAO,CAAG,CAAA,EACf,IAAI,CAACkC,gBAAgB,CAAG,CAAA,EACA,MAApB,IAAI,CAACY,WAAW,EAAY,AAA4B,KAAA,IAArB,IAAI,CAACA,WAAW,EACtD,IAAI,CAACA,WAAW,CAACqK,SAAS,GAAG9J,OAAO,CAAC,SAAC+J,CAAK,EAAA,OAAKA,EAAMvF,IAAI,EAAE,GAE7D,IAAI,CAAC7F,QAAQ,CAACM,GAAG,CAAClB,KAAAA,GAClB,OAAO,IAAI,CAAC0B,WAAW,CACvB,IAAI,CAACsJ,sBAAsB,EAC5B,EAAC1H,EAEDhF,SAAS,CAAT,WAA4C,IAAA,IAAoB2N,EAAA,IAAA,CAAtDtN,EAAAZ,UAAAG,MAAA,CAAA,GAAAH,AAAAiC,KAAAA,IAAAjC,SAAA,CAAA,EAAA,CAAAA,SAAA,CAAA,EAAA,CAAgC,CAAA,EAAEmO,EAAAnO,UAAAG,MAAA,CAAKoM,EAAe,AAAAlM,MAAA8N,EAAA,EAAAA,EAAA,EAAA,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAf7B,CAAe,CAAA6B,EAAA,EAAA,CAAApO,SAAA,CAAAoO,EAAA,CAC/D,IAAI,CAAC3O,GAAG,CAAC,YAAW,CAAGmB,EAAK,CAAAiH,MAAA,CAAK0E,IACjC,IAAI,CAAC3L,KAAK,CAAGA,EACb,IAAI,CAACuL,iBAAiB,CAAC,WACtB+B,EAAKpL,MAAM,CAAG,CAAA,EACdoL,EAAKhM,SAAS,CAAC3B,SAAS,CAAC,CACxBK,MAAOsN,EAAKtN,KAAAA,EAEd,EACD,EAAC2E,EAED8I,kBAAkB,CAAlB,WAAqD,IAAA,IAAlCzN,EAAAZ,UAAAG,MAAA,CAAA,GAAAH,AAAAiC,KAAAA,IAAAjC,SAAA,CAAA,EAAA,CAAAA,SAAA,CAAA,EAAA,CAAgC,CAAA,EAAEsO,EAAAtO,UAAAG,MAAA,CAAKoM,EAAe,AAAAlM,MAAAiO,EAAA,EAAAA,EAAA,EAAA,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAfhC,CAAe,CAAAgC,EAAA,EAAA,CAAAvO,SAAA,CAAAuO,EAAA,CACxE,IAAI,CAAC9O,GAAG,CAAC,qBAAoB,CAAGmB,EAAK,CAAAiH,MAAA,CAAK0E,IAC1C,IAAI,CAAC3L,KAAK,CAAGA,EACb,IAAI,CAACkC,MAAM,CAAG,CAAA,EACd,IAAI,CAACjC,OAAO,CAAG,CAAA,EACf,IAAI,CAACqB,SAAS,CAAC3B,SAAS,CAAC,CACxBK,MAAO,IAAI,CAACA,KAAK,CACjBC,QAAS,CAAA,GAEX,EAAC0E,EAEDhE,YAAY,CAAZ,SAAa/B,CAAc,EAAA,IAqBtBgP,EACA5D,EAI+C6D,EA1BzBC,EAAAC,EAAA,IAAA,CAC1B,GAAI,AAAoB,CAAA,IAApB,IAAI,CAAC3M,UAAU,CAAW,CAC7B4F,WAAW,WACV+G,EAAK7N,QAAQ,CAAC,CACbC,GAAIvB,EAAKmB,IAAI,CACbE,QAASrB,EAAKqB,OAAO,CACrBD,MAAOpB,EAAKoB,KAAAA,EAEd,EAAG,GACH,MACD,CAEA,IAAMgO,EAAO1Q,EAAO2Q,KAAK,CAACC,OAAO,CAACtP,EAAKmB,IAAI,EACvCoO,EAAe9M,KAAAA,QACf2M,GAAAA,EAAMlK,QAAQ,EACjBqK,CAAAA,EAAeH,EAAKlK,QAAQ,AAARA,EAErB,IAAMsK,EAAexQ,EAAiBsQ,OAAO,CAAC,CAC7CG,IAAKzP,EAAKH,IAAAA,EAKPG,AAAiB,EAAA,IAAjBA,EAAKqB,OAAO,EACf2N,EAAO,MACP5D,EAAQjM,EAAE,8BAA+BoQ,IAC/BC,GAAgBA,AAAmB,MAAnBA,EAAarQ,CAAC,CACxC,AAAc,OAAd8P,CAAAA,EAAIjP,EAAKoB,KAAK,AAALA,GAAK6N,AAAA,KAAA,IAAAA,GAAVA,EAAYvJ,KAAK,EACpBsJ,EAAO,QACP5D,EAAQjM,EAAE,mCAAoCoQ,KAE9CP,EAAO,QACP5D,EAAQjM,EAAE,mCAAoCoQ,IAEzC,AAAc,OAAdL,CAAAA,EAAIlP,EAAKoB,KAAK,AAALA,GAAK8N,AAAA,KAAA,IAAAA,GAAVA,EAAYxJ,KAAK,EAC3BsJ,EAAO,QACP5D,EAAQjM,EAAE,kCAAmCqQ,EAAaE,IAAI,IAE9DV,EAAO,QACP5D,EAAQjM,EAAE,kCAAmCqQ,EAAaE,IAAI,GAG/D5Q,EAAgBkM,IAAI,CAAC,CACpBC,UAAWpM,EACXqM,MAAO,CACNE,MAAAA,EACA4D,KAAAA,EACAtD,YAAavM,EAAE,OACfwM,WAAYxM,EAAE,MACdyM,SAAUzM,EAAE,yBACZ0M,UAAW,WAEV,OADK9M,EAAaiB,EAAKH,IAAK,EACrBsP,EAAK7N,QAAQ,CAAC,CACpBC,GAAIvB,EAAKmB,IAAI,CACbE,QAASrB,EAAKqB,OAAO,CACrBD,MAAOpB,EAAKoB,KAAAA,EAEd,EACAuO,SAAU,WAAA,OAAMR,EAAKjG,IAAI,EAAE,EAC3B0G,QAAS,WAAA,OAAMT,EAAKjG,IAAI,EAAE,IAG7B,EAACnD,EAEDzE,QAAQ,CAAR,WAAgD,IAAAuO,EAAA,IAAA,CAAvC7P,EAAAQ,UAAAG,MAAA,CAAA,GAAAH,AAAAiC,KAAAA,IAAAjC,SAAA,CAAA,EAAA,CAAAA,SAAA,CAAA,EAAA,CAAiB,CAAA,CACzBR,CAAAA,EAAKoB,KAAK,CAAG,IAAI,CAACA,KAAK,CAAC,IAAA,IAAA0O,EAAAtP,UAAAG,MAAA,CADQoM,EAAe,AAAAlM,MAAAiP,EAAA,EAAAA,EAAA,EAAA,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAfhD,CAAe,CAAAgD,EAAA,EAAA,CAAAvP,SAAA,CAAAuP,EAAA,CAE/C,IAAI,CAAC9P,GAAG,CAAC,WAAU,CAAGD,EAAI,CAAAqI,MAAA,CAAK0E,IAC/B,IAAI,CAACJ,iBAAiB,CAAC,WACtBkD,EAAKtM,gBAAgB,CAAGvD,EAAKqB,OAAQ,CACrCwO,EAAKvM,MAAM,CAAG,CAAA,EACduM,EAAKnN,SAAS,CAACpB,QAAQ,CAACtB,EACzB,EACD,EAAC+F,EAED7D,YAAY,CAAZ,SAAalC,CAAc,EAAoB,IA2CnBgQ,EAAAC,EA3CmBC,EAAA,IAAA,CAC9C,GAAI,AAAgB,CAAA,IAAhB,IAAI,CAAC5M,MAAM,EAEd,IAAA,IAAA6M,EAAA3P,UAAAG,MAAA,CAH8BoM,EAAe,AAAAlM,MAAAsP,EAAA,EAAAA,EAAA,EAAA,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAfrD,CAAe,CAAAqD,EAAA,EAAA,CAAA5P,SAAA,CAAA4P,EAAA,CAI9C,IAAI,CAACnQ,GAAG,CAAC,eAAc,CAAGD,EAAI,CAAAqI,MAAA,CAAK0E,IACnC,IAAI/I,EAAiB,IAAI,CAACuE,iBAAiB,CAACvI,EAAKmB,IAAK,EActD,GAJ0E,aAArE6C,EAAeqM,cAAiD,GACpE,IAAI,CAACvM,kBAAkB,CAAC9D,EAAKmB,IAAK,EAClC6C,EAAiB,IAAI,CAACuE,iBAAiB,CAACvI,EAAKmB,IAAK,GAE/C6C,AAAsC,QAAtCA,EAAegD,kBAAkB,EAGrChD,EAAeiE,WAAW,CAAGjI,EAAKoB,KAAM,CACpC,IAAI,CAAC+C,WAAW,EACnBH,EAAeqJ,SAAS,CAAC,IAAI,CAAClJ,WAAW,EAE1C,IAAMmM,EAAyC,SAACC,CAAK,EAc/CvM,EAAewM,mBAAmB,CAAC,IAAIC,sBAAsBF,GAbvC,WAC1BL,EAAKxN,SAAS,CAACf,eAAe,CAAC,CAC9BJ,GAAIvB,EAAKmB,IAAI,CACbpB,KAAM,QACN2Q,GAAI1M,EAAeiD,SAAS,CAC5B7F,MAAO8O,EAAK9O,KAAK,CACjBuP,YAAa,CACZC,IAAKL,EAAMK,GAAG,CACd7Q,KAAMwQ,EAAMxQ,IAAAA,GAGf,EAE8FmQ,EAAK9J,OAAO,CAC3G,CAEIpG,AAAiB,EAAA,IAAjBA,EAAKqB,OAAO,CACV2C,EAAe6M,WAAW,CAACP,EAAS,IAAI,CAAClK,OAAO,CAAE,CACtDkG,UAAW,CACVwE,oBAAmB,AAAY,OAAZd,CAAAA,EAAEhQ,EAAKoB,KAAK,AAALA,GAAK4O,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAVA,EAAYrK,KAAK,CACtCoL,oBAAmB,AAAY,OAAZd,CAAAA,EAAEjQ,EAAKoB,KAAK,AAALA,GAAK6O,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAVA,EAAYvK,KAAAA,IAI9B1B,EAAe6M,WAAW,CAACP,EAAS,IAAI,CAAClK,OAAO,GAEvD,EAACL,EAEDiL,aAAa,CAAb,SAAchR,CAAmC,EAAoB,IAAAiR,EAAA,IAAA,CACpE,GAAI,AAAgB,CAAA,IAAhB,IAAI,CAAC3N,MAAM,EAEd,IAAA,IAAA4N,EAAA1Q,UAAAG,MAAA,CAHoDoM,EAAe,AAAAlM,MAAAqQ,EAAA,EAAAA,EAAA,EAAA,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAfpE,CAAe,CAAAoE,EAAA,EAAA,CAAA3Q,SAAA,CAAA2Q,EAAA,CAKpE,IAAI,CAAClR,GAAG,CAAC,gBAAe,CAAGD,EAAI,CAAAqI,MAAA,CAAK0E,IACpC,IAAI/I,EAAiB,IAAI,CAACuE,iBAAiB,CAACvI,EAAKmB,IAAK,EAOtD,GALI,CAAC,mBAAoB,SAAS,CAACsE,QAAQ,CAACzB,EAAeqM,cAAc,GAAKrM,EAAeiD,SAAS,CAAGjH,EAAK0Q,EAAE,GAC/G,IAAI,CAAC5M,kBAAkB,CAAC9D,EAAKmB,IAAK,EAClC6C,EAAiB,IAAI,CAACuE,iBAAiB,CAACvI,EAAKmB,IAAK,GAG/C6C,AAAsC,QAAtCA,EAAegD,kBAAkB,EAIhChD,EAAeoN,oBAAoB,CAAC,IAAIX,sBAAsBzQ,EAAK2Q,WAAW,GAEnF,GAAI,CACC,IAAI,CAACxM,WAAW,EACnBH,EAAeqJ,SAAS,CAAC,IAAI,CAAClJ,WAAW,CAE3C,CAAE,MAAOmC,EAAO,CACfhG,QAAQL,GAAG,CAACqG,EACb,CAkBKtC,EAAeqN,YAAY,CAhBgB,SAACC,CAAM,EAajDtN,EAAewM,mBAAmB,CAAC,IAAIC,sBAAsBa,GAZvC,WAC1BL,EAAKvO,SAAS,CAACf,eAAe,CAAC,CAC9BJ,GAAIvB,EAAKmB,IAAI,CACbpB,KAAM,SACN2Q,GAAI1M,EAAeiD,SAAS,CAC5B0J,YAAa,CACZC,IAAKU,EAAOV,GAAG,CACf7Q,KAAMuR,EAAOvR,IAAAA,GAGhB,EAE+FkR,EAAK7K,OAAO,CAC5G,EAE2C,IAAI,CAACA,OAAO,GACxD,EAACL,EAED5D,iBAAiB,CAAjB,SAAkBnC,CAAmB,EACpC,GAAoB,CAAA,IAAhB,IAAI,CAACsD,MAAM,EAGXtD,EAAKuB,EAAE,GAAK,IAAI,CAACP,MAAM,EAE1B,IAAA,IANuDuQ,EAMvDC,EAAAhR,UAAAG,MAAA,CANwCoM,EAAe,AAAAlM,MAAA2Q,EAAA,EAAAA,EAAA,EAAA,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAf1E,CAAe,CAAA0E,EAAA,EAAA,CAAAjR,SAAA,CAAAiR,EAAA,CAOxD,IAAI,CAACxR,GAAG,CAAC,oBAAmB,CAAGD,EAAI,CAAAqI,MAAA,CAAK0E,IACxC,IAAM/I,EAAiB,IAAI,CAACuE,iBAAiB,CAACvI,EAAKmB,IAAK,CAEjB,CAAA,WAAtC6C,EAAegD,kBAAkB,EACjChD,AAAsC,WAAtCA,EAAegD,kBAAkB,EACjChD,AAAsC,iBAAtCA,EAAegD,kBAAkB,EACjChD,AAAsC,cAAtCA,EAAegD,kBAAkB,EAE5BhD,EAAe0N,eAAe,CAAC,IAAIC,gBAAgB3R,EAAK8I,SAAS,GAEvEwE,SAASC,aAAa,CAAmB,qBAAsBC,SAAS,CAAA,AAA4B,OAA5B+D,CAAAA,EAAG,IAAI,CAACzO,WAAW,CAACwB,GAAG,EAAE,CAAC,EAAE,AAAD,GAACiN,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAzBA,EAA2B9J,GAAG,CAC1G,EAAC1B,EAED3D,mBAAmB,CAAnB,SAAoBpC,CAAqB,EACxC,GAAoB,CAAA,IAAhB,IAAI,CAACsD,MAAM,EAGXtD,EAAKuB,EAAE,GAAK,IAAI,CAACP,MAAM,EAE1B,IAAA,IAAA4Q,EAAApR,UAAAG,MAAA,CAN4CoM,EAAe,AAAAlM,MAAA+Q,EAAA,EAAAA,EAAA,EAAA,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAf9E,CAAe,CAAA8E,EAAA,EAAA,CAAArR,SAAA,CAAAqR,EAAA,CAO5D,IAAI,CAAC5R,GAAG,CAAC,sBAAqB,CAAGD,EAAI,CAAAqI,MAAA,CAAK0E,IAC1C,IAAM/I,EAAiB,IAAI,CAACuE,iBAAiB,CAACvI,EAAKmB,IAAK,CACpDnB,AAAc,CAAA,UAAdA,EAAKD,IAAI,EACZiE,EAAeiE,WAAW,CAAGjI,EAAKoB,KAAK,CACvC,IAAI,CAAC4P,aAAa,CAAC,CAClB7P,KAAMnB,EAAKmB,IAAI,CACfuP,GAAI1Q,EAAK0Q,EAAE,CACXC,YAAa3Q,EAAK2Q,WAAAA,IAGd3M,EAAeoN,oBAAoB,CAAC,IAAIX,sBAAsBzQ,EAAK2Q,WAAW,GAErF,EAACrO,CAAA,IAGI9D,EAAS,GAAA,CAAA,WAGd,SAAAsT,IAAA,IAAA,CAFAC,iBAAiB,CAAgC,CAAA,EAGhD,IAAI,CAACA,iBAAiB,CAAG,CAAA,CAC1B,CAuCC,OAvCAC,AAAAF,EAAA1R,SAAA,CAED6R,mBAAmB,CAAnB,SAAoBxC,CAAiB,EAAiC,IAA/ByC,EAAA1R,UAAAG,MAAA,CAAA,GAAAH,AAAAiC,KAAAA,IAAAjC,SAAA,CAAA,EAAA,CAAAA,SAAA,CAAA,EAAA,CAA2B,KAC7DoN,EAAU,CAAA,EACd,GAAKsE,EAmBJtE,EAAU3O,AAAsD,WAAtDA,EAASqF,GAAG,CAAS,iCAnBhB,CACf,IAAMkL,EAAexQ,EAAiBsQ,OAAO,CAAC,CAAEG,IAAAA,CAAG,GACnD,GAAI,CAACD,EACJ,OAED,OAAQA,EAAarQ,CAAC,EACrB,IAAK,IACJyO,EAAU3O,EAASqF,GAAG,CAAC,wBACvB,KACD,KAAK,IACJsJ,EAAU3O,EAASqF,GAAG,CAAC,yBACvB,KACD,KAAK,IACJsJ,EAAU3O,EAASqF,GAAG,CAAC,yBACvB,KACD,KAAK,IACJsJ,EAAU3O,AAAsD,WAAtDA,EAASqF,GAAG,CAAS,4BACjC,CACD,CAIA,GAAIsJ,AAAY,CAAA,IADhBA,CAAAA,EAAUA,GAAW3O,EAASqF,GAAG,CAAC,iBAAgB,GAIlD,GAAI,AAA+B,MAA/B,IAAI,CAACyN,iBAAiB,CAACtC,EAAI,CAAU,CACxC,IAAI0C,EAAMzT,EAAO0T,MAAM,GACnB5P,EAAa,CAAA,EACb0P,IACHC,EAAMD,EACN1P,EAAa,CAAA,GAEd,IAAI,CAACuP,iBAAiB,CAACtC,EAAI,CAAG,IAAInN,EAAY6P,EAAK1C,EAAKjN,EACzD,CACA,OAAO,IAAI,CAACuP,iBAAiB,CAACtC,EAAI,CACnC,EAACqC,CAAA,GAAA,EAGFpT,EAAO2T,OAAO,CAAC,WACdzT,EAAQ0T,OAAO,CAAC,WACf,IAAMH,EAAMzT,EAAO0T,MAAM,GAErBD,GACHjT,EAAIU,MAAM,CAAC,cAAe,CAAIuS,EAAG,IAAI/S,EAAeU,OAAO,CAAG,CAAE,SAACC,CAAI,CAAEC,CAAI,EAC1E,GAAIA,AAAa,MAAbA,EAAKH,IAAI,EAGb,IAAM0S,EAAS/T,EAAOyT,mBAAmB,CAACjS,EAAKH,IAAI,EAEnD,OAAQE,GACP,IAAK,YACJwS,MAAAA,GAAAA,EAAQ9R,YAAY,CAAC,YAAaT,GAClC,KACD,KAAK,cACJuS,MAAAA,GAAAA,EAAQ9R,YAAY,CAAC,cAAeT,GACpC,KACD,KAAK,OACJuS,MAAAA,GAAAA,EAAQ9R,YAAY,CAAC,OAAQT,EAE/B,EACD,EAEF,EACD\"}"}