{"code":"Package[\"core-runtime\"].queue(\"rocketchat:user-presence\",function(){Package.meteor.Meteor,Package.meteor.global,Package.meteor.meteorEnv,Package.tracker.Tracker,Package.tracker.Deps,Package.check.check,Package.check.Match;var e=Package.modules.meteorInstall;Package.modules.meteorBabelHelpers;var n=Package.promise.Promise;return Package[\"ecmascript-runtime-client\"].Symbol,Package[\"ecmascript-runtime-client\"].Map,Package[\"ecmascript-runtime-client\"].Set,{require:e({node_modules:{meteor:{\"rocketchat:user-presence\":{client:{\"client.js\":function e(e,t,r){r.link(\"@babel/runtime/regenerator\",{default:function(e){a=e}},0),r.export({UserPresence:function(){return m}}),r.link(\"meteor/meteor\",{Meteor:function(e){c=e}},0),r.link(\"meteor/tracker\",{Tracker:function(e){s=e}},1),r.link(\"meteor/check\",{check:function(e){u=e}},2),r.link(\"./utils\",{debounce:function(e){o=e}},3);var a,c,s,u,o,i,l,m={awayTime:6e4,awayOnWindowBlur:!1,callbacks:[],connected:!0,started:!1,userId:null,onSetUserStatus:function(e){this.callbacks.push(e)},runCallbacks:function(e,n){this.callbacks.forEach(function(t){t.call(null,e,n)})},startTimer:function(){m.stopTimer(),m.awayTime&&(i=setTimeout(m.setAway,m.awayTime))},stopTimer:function(){clearTimeout(i)},restartTimer:function(){m.startTimer()},setAway:function(){return f(\"away\")},setOnline:function(){return f(\"online\")},start:function(e){var n=this;this.start=function(){n.startTimer()},this.userId=e,s.autorun(function(){var e=c.status().connected;if(n.connected=e,e){n.startTimer(),l=\"online\";return}n.stopTimer(),l=\"offline\"}),[\"mousemove\",\"mousedown\",\"touchend\",\"keydown\"].forEach(function(e){return document.addEventListener(e,n.setOnline)}),window.addEventListener(\"focus\",this.setOnline),!0===this.awayOnWindowBlur&&window.addEventListener(\"blur\",this.setAway)}},f=o(function(e){return a.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(!m.connected||e===l)){n.next=3;break}return m.startTimer(),n.abrupt(\"return\");case 3:n.t0=e,n.next=\"online\"===n.t0?6:\"away\"===n.t0?9:13;break;case 6:return n.next=8,a.awrap(c.callAsync(\"UserPresence:online\",m.userId));case 8:return n.abrupt(\"break\",14);case 9:return n.next=11,a.awrap(c.callAsync(\"UserPresence:away\",m.userId));case 11:return m.stopTimer(),n.abrupt(\"break\",14);case 13:return n.abrupt(\"return\");case 14:l=e;case 15:case\"end\":return n.stop()}},null,null,null,n)},1e3);c.methods({\"UserPresence:setDefaultStatus\":function(e){return a.async(function(n){for(;;)switch(n.prev=n.next){case 0:return u(e,String),n.next=3,a.awrap(c.users.updateAsync({_id:c.userId()},{$set:{status:e,statusDefault:e}}));case 3:case\"end\":return n.stop()}},null,null,null,n)},\"UserPresence:online\":function(){var e;return a.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.awrap(c.userAsync());case 2:if(!((e=n.sent)&&\"online\"!==e.status&&\"online\"===e.statusDefault)){n.next=6;break}return n.next=6,a.awrap(c.users.updateAsync({_id:c.userId()},{$set:{status:\"online\"}}));case 6:m.runCallbacks(e,\"online\");case 7:case\"end\":return n.stop()}},null,null,null,n)},\"UserPresence:away\":function(){var e;return a.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.awrap(c.userAsync());case 2:e=n.sent,m.runCallbacks(e,\"away\");case 4:case\"end\":return n.stop()}},null,null,null,n)}})},\"utils.js\":function e(e,n,t){t.export({debounce:function(){return r}});function r(e,n){var t;return function(){for(var r=arguments.length,a=Array(r),c=0;c<r;c++)a[c]=arguments[c];t&&clearTimeout(t),t=setTimeout(function(){return e.apply(void 0,a)},n)}}}}}}}},{extensions:[\".js\",\".json\"]}),eagerModulePaths:[\"/node_modules/meteor/rocketchat:user-presence/client/client.js\"],mainModulePath:\"/node_modules/meteor/rocketchat:user-presence/client/client.js\"}});","map":"{\"version\":3,\"sources\":[\"packages/rocketchat:user-presence/client/client.js\",\"packages/rocketchat:user-presence/client/utils.js\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\nimport { check } from 'meteor/check';\\n\\nimport { debounce } from './utils';\\n\\nlet timer;\\nlet status;\\n\\nexport const UserPresence = {\\n\\tawayTime: 60000, // 1 minute\\n\\tawayOnWindowBlur: false,\\n\\tcallbacks: [],\\n\\tconnected: true,\\n\\tstarted: false,\\n\\tuserId: null,\\n\\n\\t/**\\n\\t * The callback will receive the following parameters: user, status\\n\\t */\\n\\tonSetUserStatus(callback) {\\n\\t\\tthis.callbacks.push(callback);\\n\\t},\\n\\n\\trunCallbacks(user, status) {\\n\\t\\tthis.callbacks.forEach(function (callback) {\\n\\t\\t\\tcallback.call(null, user, status);\\n\\t\\t});\\n\\t},\\n\\n\\tstartTimer() {\\n\\t\\tUserPresence.stopTimer();\\n\\t\\tif (!UserPresence.awayTime) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\ttimer = setTimeout(UserPresence.setAway, UserPresence.awayTime);\\n\\t},\\n\\tstopTimer() {\\n\\t\\tclearTimeout(timer);\\n\\t},\\n\\trestartTimer() {\\n\\t\\tUserPresence.startTimer();\\n\\t},\\n\\t// eslint-disable-next-line no-use-before-define\\n\\tsetAway: () => setUserPresence('away'),\\n\\t// eslint-disable-next-line no-use-before-define\\n\\tsetOnline: () => setUserPresence('online'),\\n\\tstart(userId) {\\n\\t\\t// after first call overwrite start function to only call startTimer\\n\\t\\tthis.start = () => {\\n\\t\\t\\tthis.startTimer();\\n\\t\\t};\\n\\t\\tthis.userId = userId;\\n\\n\\t\\t// register a tracker on connection status so we can setup the away timer again (on reconnect)\\n\\t\\tTracker.autorun(() => {\\n\\t\\t\\tconst { connected } = Meteor.status();\\n\\t\\t\\tthis.connected = connected;\\n\\t\\t\\tif (connected) {\\n\\t\\t\\t\\tthis.startTimer();\\n\\t\\t\\t\\tstatus = 'online';\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\tthis.stopTimer();\\n\\t\\t\\tstatus = 'offline';\\n\\t\\t});\\n\\n\\t\\t['mousemove', 'mousedown', 'touchend', 'keydown'].forEach((key) => document.addEventListener(key, this.setOnline));\\n\\n\\t\\twindow.addEventListener('focus', this.setOnline);\\n\\n\\t\\tif (this.awayOnWindowBlur === true) {\\n\\t\\t\\twindow.addEventListener('blur', this.setAway);\\n\\t\\t}\\n\\t},\\n};\\n\\nconst setUserPresence = debounce(async (newStatus) => {\\n\\tif (!UserPresence.connected || newStatus === status) {\\n\\t\\tUserPresence.startTimer();\\n\\t\\treturn;\\n\\t}\\n\\tswitch (newStatus) {\\n\\t\\tcase 'online':\\n\\t\\t\\tawait Meteor.callAsync('UserPresence:online', UserPresence.userId);\\n\\t\\t\\tbreak;\\n\\t\\tcase 'away':\\n\\t\\t\\tawait Meteor.callAsync('UserPresence:away', UserPresence.userId);\\n\\t\\t\\tUserPresence.stopTimer();\\n\\t\\t\\tbreak;\\n\\t\\tdefault:\\n\\t\\t\\treturn;\\n\\t}\\n\\tstatus = newStatus;\\n}, 1000);\\n\\nMeteor.methods({\\n\\tasync 'UserPresence:setDefaultStatus'(status) {\\n\\t\\tcheck(status, String);\\n\\t\\tawait Meteor.users.updateAsync({ _id: Meteor.userId() }, { $set: { status, statusDefault: status } });\\n\\t},\\n\\tasync 'UserPresence:online'() {\\n\\t\\tconst user = await Meteor.userAsync();\\n\\t\\tif (user && user.status !== 'online' && user.statusDefault === 'online') {\\n\\t\\t\\tawait Meteor.users.updateAsync({ _id: Meteor.userId() }, { $set: { status: 'online' } });\\n\\t\\t}\\n\\t\\tUserPresence.runCallbacks(user, 'online');\\n\\t},\\n\\tasync 'UserPresence:away'() {\\n\\t\\tconst user = await Meteor.userAsync();\\n\\t\\tUserPresence.runCallbacks(user, 'away');\\n\\t},\\n});\\n\",\"export function debounce(func, wait) {\\n\\tlet timeout;\\n\\n\\treturn (...args) => {\\n\\t\\tif (timeout) clearTimeout(timeout);\\n\\t\\ttimeout = setTimeout(() => func(...args), wait);\\n\\t};\\n}\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"export\",\"UserPresence\",\"Meteor\",\"Tracker\",\"check\",\"debounce\",\"timer\",\"status\",\"awayTime\",\"awayOnWindowBlur\",\"callbacks\",\"connected\",\"started\",\"userId\",\"onSetUserStatus\",\"callback\",\"push\",\"runCallbacks\",\"user\",\"forEach\",\"call\",\"startTimer\",\"stopTimer\",\"setTimeout\",\"setAway\",\"clearTimeout\",\"restartTimer\",\"setUserPresence\",\"setOnline\",\"start\",\"_this\",\"autorun\",\"_Meteor$status\",\"key\",\"document\",\"addEventListener\",\"window\",\"newStatus\",\"async\",\"_context\",\"prev\",\"next\",\"abrupt\",\"t0\",\"awrap\",\"callAsync\",\"stop\",\"Promise\",\"methods\",\"_context2\",\"String\",\"users\",\"updateAsync\",\"_id\",\"$set\",\"statusDefault\",\"_context3\",\"userAsync\",\"sent\",\"_context4\",\"func\",\"wait\",\"timeout\",\"_len\",\"arguments\",\"length\",\"args\",\"Array\",\"_key\",\"apply\"],\"mappings\":\"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\"}"}