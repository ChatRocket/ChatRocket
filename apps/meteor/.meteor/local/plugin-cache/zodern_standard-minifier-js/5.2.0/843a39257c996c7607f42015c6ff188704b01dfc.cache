{"code":"function module(n,e,o){o.link(\"@babel/runtime/regenerator\",{default:function(n){r=n}},0),o.export({useChangeOwnerAction:function(){return b}}),o.link(\"@rocket.chat/core-typings\",{isRoomFederated:function(n){i=n}},0),o.link(\"@rocket.chat/fuselage-hooks\",{useMutableCallback:function(n){t=n}},1),o.link(\"@rocket.chat/string-helpers\",{escapeHTML:function(n){u=n}},2),o.link(\"@rocket.chat/ui-contexts\",{useTranslation:function(n){s=n},usePermission:function(n){c=n},useUserRoom:function(n){a=n},useUserSubscription:function(n){l=n},useSetModal:function(n){m=n},useUser:function(n){_=n}},3),o.link(\"react\",{default:function(n){f=n},useCallback:function(n){d=n},useMemo:function(n){v=n}},4),o.link(\"../../../../../components/GenericModal\",{default:function(n){g=n}},5),o.link(\"../../../../../hooks/useEndpointAction\",{useEndpointAction:function(n){k=n}},6),o.link(\"../../../../../lib/rooms/roomCoordinator\",{roomCoordinator:function(n){p=n}},7),o.link(\"../../../lib/getRoomDirectives\",{getRoomDirectives:function(n){w=n}},8),o.link(\"../../useUserHasRoomRole\",{useUserHasRoomRole:function(n){h=n}},9);var r,i,t,u,s,c,a,l,m,_,f,d,v,g,k,p,w,h,R=function(n,e,o,r,i){return f.createElement(g,{variant:\"warning\",onClose:n,onConfirm:e,onCancel:n,title:o,confirmText:r},i)},b=function(n,e){var o=s(),f=a(e),g=n._id,b=c(\"set-owner\",e),C=h(g,e,\"owner\"),I=l(e),M=m(),U=(_()||{})._id,x=void 0===U?\"\":U,S=h(x,e,\"owner\"),O=d(function(){return M(null)},[M]);if(!f)throw Error(\"Room not provided\");var E=w({room:f,showingUserId:g,userSubscription:I}).roomCanSetOwner,F=(null==f?void 0:f.t)&&u(p.getRoomName(f.t,f)),T=\"p\"===f.t?\"/v1/groups\":\"/v1/channels\",y=k(\"POST\",T+\".\"+(C?\"removeOwner\":\"addOwner\"),{successMessage:o(C?\"User__username__removed_from__room_name__owners\":\"User__username__is_now_an_owner_of__room_name_\",{username:n.username,room_name:F})}),A=d(function(){y({roomId:e,userId:g}),O()},[y,e,g,O]),H=d(function(n){var r=n.userId;if(!i(f))return y({roomId:e,userId:g});var t=r===x;return t&&S?M(function(){return R(O,A,o(\"Federation_Matrix_losing_privileges\"),o(\"Yes_continue\"),o(\"Federation_Matrix_losing_privileges_warning\"))}):!t&&S?M(function(){return R(O,A,o(\"Warning\"),o(\"Yes_continue\"),o(\"Federation_Matrix_giving_same_permission_warning\"))}):void y({roomId:e,userId:g})},[M,x,S,o,e,g,y,O,A,f]),P=t(function(){return r.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt(\"return\",H({roomId:e,userId:g}));case 1:case\"end\":return n.stop()}},null,null,null,Promise)});return v(function(){return i(f)&&E||!i(f)&&E&&b?{content:o(C?\"Remove_as_owner\":\"Set_as_owner\"),icon:\"shield-check\",onClick:P,type:\"privileges\"}:void 0},[P,E,b,C,o,f])}}","map":"{\"version\":3,\"sources\":[\"client/views/room/hooks/useUserInfoActions/actions/useChangeOwnerAction.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom, IUser } from '@rocket.chat/core-typings';\\nimport { isRoomFederated } from '@rocket.chat/core-typings';\\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\\nimport { escapeHTML } from '@rocket.chat/string-helpers';\\nimport { useTranslation, usePermission, useUserRoom, useUserSubscription, useSetModal, useUser } from '@rocket.chat/ui-contexts';\\nimport type { ReactElement } from 'react';\\nimport React, { useCallback, useMemo } from 'react';\\n\\nimport GenericModal from '../../../../../components/GenericModal';\\nimport { useEndpointAction } from '../../../../../hooks/useEndpointAction';\\nimport { roomCoordinator } from '../../../../../lib/rooms/roomCoordinator';\\nimport { getRoomDirectives } from '../../../lib/getRoomDirectives';\\nimport { useUserHasRoomRole } from '../../useUserHasRoomRole';\\nimport type { UserInfoAction, UserInfoActionType } from '../useUserInfoActions';\\n\\nconst getWarningModalForFederatedRooms = (\\n\\tcloseModalFn: () => void,\\n\\thandleConfirmFn: () => void,\\n\\ttitle: string,\\n\\tconfirmText: string,\\n\\tbodyText: string,\\n): ReactElement => (\\n\\t<GenericModal\\n\\t\\tvariant='warning'\\n\\t\\tonClose={closeModalFn}\\n\\t\\tonConfirm={handleConfirmFn}\\n\\t\\tonCancel={closeModalFn}\\n\\t\\ttitle={title}\\n\\t\\tconfirmText={confirmText}\\n\\t>\\n\\t\\t{bodyText}\\n\\t</GenericModal>\\n);\\n\\nexport const useChangeOwnerAction = (user: Pick<IUser, '_id' | 'username'>, rid: IRoom['_id']): UserInfoAction | undefined => {\\n\\tconst t = useTranslation();\\n\\tconst room = useUserRoom(rid);\\n\\tconst { _id: uid } = user;\\n\\tconst userCanSetOwner = usePermission('set-owner', rid);\\n\\tconst isOwner = useUserHasRoomRole(uid, rid, 'owner');\\n\\tconst userSubscription = useUserSubscription(rid);\\n\\tconst setModal = useSetModal();\\n\\tconst { _id: loggedUserId = '' } = useUser() || {};\\n\\tconst loggedUserIsOwner = useUserHasRoomRole(loggedUserId, rid, 'owner');\\n\\tconst closeModal = useCallback(() => setModal(null), [setModal]);\\n\\n\\tif (!room) {\\n\\t\\tthrow Error('Room not provided');\\n\\t}\\n\\n\\tconst { roomCanSetOwner } = getRoomDirectives({ room, showingUserId: uid, userSubscription });\\n\\tconst roomName = room?.t && escapeHTML(roomCoordinator.getRoomName(room.t, room));\\n\\n\\tconst endpointPrefix = room.t === 'p' ? '/v1/groups' : '/v1/channels';\\n\\tconst changeOwnerEndpoint = isOwner ? 'removeOwner' : 'addOwner';\\n\\tconst changeOwnerMessage = isOwner ? 'User__username__removed_from__room_name__owners' : 'User__username__is_now_an_owner_of__room_name_';\\n\\tconst changeOwner = useEndpointAction('POST', `${endpointPrefix}.${changeOwnerEndpoint}`, {\\n\\t\\tsuccessMessage: t(changeOwnerMessage, { username: user.username, room_name: roomName }),\\n\\t});\\n\\n\\tconst handleConfirm = useCallback(() => {\\n\\t\\tchangeOwner({ roomId: rid, userId: uid });\\n\\t\\tcloseModal();\\n\\t}, [changeOwner, rid, uid, closeModal]);\\n\\n\\tconst handleChangeOwner = useCallback(\\n\\t\\t({ userId }) => {\\n\\t\\t\\tif (!isRoomFederated(room)) {\\n\\t\\t\\t\\treturn changeOwner({ roomId: rid, userId: uid });\\n\\t\\t\\t}\\n\\t\\t\\tconst changingOwnRole = userId === loggedUserId;\\n\\n\\t\\t\\tif (changingOwnRole && loggedUserIsOwner) {\\n\\t\\t\\t\\treturn setModal(() =>\\n\\t\\t\\t\\t\\tgetWarningModalForFederatedRooms(\\n\\t\\t\\t\\t\\t\\tcloseModal,\\n\\t\\t\\t\\t\\t\\thandleConfirm,\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_losing_privileges'),\\n\\t\\t\\t\\t\\t\\tt('Yes_continue'),\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_losing_privileges_warning'),\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t\\t);\\n\\t\\t\\t}\\n\\n\\t\\t\\tif (!changingOwnRole && loggedUserIsOwner) {\\n\\t\\t\\t\\treturn setModal(() =>\\n\\t\\t\\t\\t\\tgetWarningModalForFederatedRooms(\\n\\t\\t\\t\\t\\t\\tcloseModal,\\n\\t\\t\\t\\t\\t\\thandleConfirm,\\n\\t\\t\\t\\t\\t\\tt('Warning'),\\n\\t\\t\\t\\t\\t\\tt('Yes_continue'),\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_giving_same_permission_warning'),\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t\\t);\\n\\t\\t\\t}\\n\\n\\t\\t\\tchangeOwner({ roomId: rid, userId: uid });\\n\\t\\t},\\n\\t\\t[setModal, loggedUserId, loggedUserIsOwner, t, rid, uid, changeOwner, closeModal, handleConfirm, room],\\n\\t);\\n\\n\\tconst changeOwnerAction = useMutableCallback(async () => handleChangeOwner({ roomId: rid, userId: uid }));\\n\\tconst changeOwnerOption = useMemo(\\n\\t\\t() =>\\n\\t\\t\\t(isRoomFederated(room) && roomCanSetOwner) || (!isRoomFederated(room) && roomCanSetOwner && userCanSetOwner)\\n\\t\\t\\t\\t? {\\n\\t\\t\\t\\t\\t\\tcontent: t(isOwner ? 'Remove_as_owner' : 'Set_as_owner'),\\n\\t\\t\\t\\t\\t\\ticon: 'shield-check' as const,\\n\\t\\t\\t\\t\\t\\tonClick: changeOwnerAction,\\n\\t\\t\\t\\t\\t\\ttype: 'privileges' as UserInfoActionType,\\n\\t\\t\\t\\t  }\\n\\t\\t\\t\\t: undefined,\\n\\t\\t[changeOwnerAction, roomCanSetOwner, userCanSetOwner, isOwner, t, room],\\n\\t);\\n\\n\\treturn changeOwnerOption;\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"export\",\"useChangeOwnerAction\",\"isRoomFederated\",\"useMutableCallback\",\"escapeHTML\",\"useTranslation\",\"usePermission\",\"useUserRoom\",\"useUserSubscription\",\"useSetModal\",\"useUser\",\"React\",\"useCallback\",\"useMemo\",\"GenericModal\",\"useEndpointAction\",\"roomCoordinator\",\"getRoomDirectives\",\"useUserHasRoomRole\",\"getWarningModalForFederatedRooms\",\"closeModalFn\",\"handleConfirmFn\",\"title\",\"confirmText\",\"bodyText\",\"createElement\",\"variant\",\"onClose\",\"onConfirm\",\"onCancel\",\"user\",\"rid\",\"t\",\"room\",\"uid\",\"_id\",\"userCanSetOwner\",\"isOwner\",\"userSubscription\",\"setModal\",\"_ref$_id\",\"_ref\",\"loggedUserId\",\"loggedUserIsOwner\",\"closeModal\",\"Error\",\"roomCanSetOwner\",\"_getRoomDirectives\",\"showingUserId\",\"roomName\",\"getRoomName\",\"endpointPrefix\",\"changeOwner\",\"successMessage\",\"username\",\"room_name\",\"handleConfirm\",\"roomId\",\"userId\",\"handleChangeOwner\",\"_ref2\",\"changingOwnRole\",\"changeOwnerAction\",\"async\",\"_context\",\"prev\",\"next\",\"abrupt\",\"stop\",\"Promise\",\"content\",\"icon\",\"onClick\",\"type\",\"undefined\"],\"mappings\":\"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\"}"}