{"code":"function module(n,e,t){t.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(n){r=n}},0),t.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(n){u=n}},1),t.link(\"@babel/runtime/regenerator\",{default:function(n){i=n}},2),t.export({useAppInfo:function(){return f}}),t.link(\"@rocket.chat/ui-contexts\",{useEndpoint:function(n){s=n}},0),t.link(\"react\",{useState:function(n){a=n},useEffect:function(n){l=n},useContext:function(n){p=n}},1),t.link(\"../../../apps/orchestrator\",{AppClientOrchestratorInstance:function(n){c=n}},2),t.link(\"../../../contexts/AppsContext\",{AppsContext:function(n){o=n}},3);var r,u,i,s,a,l,p,c,o,d=function(n){var e,t;return i.async(function(r){for(;;)switch(r.prev=r.next){case 0:return t=void 0===(e=n.bundledIn)?[]:e,r.abrupt(\"return\",Promise.all(t.map(function n(n){var e;return i.async(function t(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.awrap(c.getAppsOnBundle(n.bundleId));case 2:return e=t.sent,n.apps=e.slice(0,4),t.abrupt(\"return\",n);case 5:case\"end\":return t.stop()}},null,null,null,Promise)})));case 2:case\"end\":return r.stop()}},null,null,null,Promise)},f=function(n,e){var t,c=p(o),f=c.installedApps,v=c.marketplaceApps,h=c.privateApps,k=a(),b=u(k,2),m=b[0],x=b[1],g=s(\"GET\",\"/apps/:id/settings\",{id:n}),A=s(\"GET\",\"/apps/:id/screenshots\",{id:n}),y=s(\"GET\",\"/apps/:id/apis\",{id:n}),E=s(\"GET\",\"/apps/:id\",{id:n});return l(function(){var t,s,a,l,p,c,o,k,b,m,w,I,P,T;i.async(function(C){for(;;)switch(C.prev=C.next){case 0:if(!(!(null!==(t=v.value)&&void 0!==t&&null!==(s=t.apps)&&void 0!==s&&s.length)&&!(null!==(a=f.value)&&void 0!==a&&a.apps.length)&&!(null!==(l=h.value)&&void 0!==l&&l.apps.length)||!n)){C.next=2;break}return C.abrupt(\"return\");case 2:if([\"explore\",\"premium\",\"requested\"].includes(e)&&(k=null===(p=v.value)||void 0===p?void 0:p.apps.find(function(e){return e.id===n})),\"private\"===e&&(k=null===(c=h.value)||void 0===c?void 0:c.apps.find(function(e){return e.id===n})),\"installed\"===e&&(k=null===(o=f.value)||void 0===o?void 0:o.apps.find(function(e){return e.id===n})),k){C.next=8;break}return C.abrupt(\"return\");case 8:return C.next=10,i.awrap(Promise.all([g().catch(function(){return{settings:{}}}),y().catch(function(){return{apis:[]}}),A().catch(function(){return{screenshots:[]}}),!1===k.marketplace?[]:E({marketplace:\"true\",update:\"true\",appVersion:n}).then(function(n){var e=n.app;return k.tosLink=e.tosLink,k.privacyLink=e.privacyLink,d(e)}).catch(function(){return{settings:{}}})]));case 10:b=C.sent,w=(m=u(b,4))[0],I=m[1],P=m[2],T=m[3],x(r(r({},k),{},{bundledIn:T,settings:w.settings,apis:I?I.apis:[],screenshots:P?P.screenshots:[]}));case 17:case\"end\":return C.stop()}},null,null,null,Promise)},[n,e,y,E,A,g,f,v,null===(t=h.value)||void 0===t?void 0:t.apps]),m}}","map":"{\"version\":3,\"sources\":[\"client/views/marketplace/hooks/useAppInfo.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { App } from '@rocket.chat/core-typings';\\nimport { useEndpoint } from '@rocket.chat/ui-contexts';\\nimport { useState, useEffect, useContext } from 'react';\\n\\nimport type { ISettings } from '../../../apps/@types/IOrchestrator';\\nimport { AppClientOrchestratorInstance } from '../../../apps/orchestrator';\\nimport { AppsContext } from '../../../contexts/AppsContext';\\nimport type { AppInfo } from '../definitions/AppInfo';\\n\\nconst getBundledInApp = async (app: App): Promise<App['bundledIn']> => {\\n\\tconst { bundledIn = [] } = app;\\n\\n\\treturn Promise.all(\\n\\t\\tbundledIn.map(async (bundle) => {\\n\\t\\t\\tconst apps = await AppClientOrchestratorInstance.getAppsOnBundle(bundle.bundleId);\\n\\t\\t\\tbundle.apps = apps.slice(0, 4);\\n\\t\\t\\treturn bundle;\\n\\t\\t}),\\n\\t);\\n};\\n\\nexport const useAppInfo = (appId: string, context: string): AppInfo | undefined => {\\n\\tconst { installedApps, marketplaceApps, privateApps } = useContext(AppsContext);\\n\\n\\tconst [appData, setAppData] = useState<AppInfo>();\\n\\n\\tconst getSettings = useEndpoint('GET', '/apps/:id/settings', { id: appId });\\n\\tconst getScreenshots = useEndpoint('GET', '/apps/:id/screenshots', { id: appId });\\n\\tconst getApis = useEndpoint('GET', '/apps/:id/apis', { id: appId });\\n\\tconst getBundledIn = useEndpoint('GET', '/apps/:id', { id: appId });\\n\\n\\tuseEffect(() => {\\n\\t\\tconst fetchAppInfo = async (): Promise<void> => {\\n\\t\\t\\tif ((!marketplaceApps.value?.apps?.length && !installedApps.value?.apps.length && !privateApps.value?.apps.length) || !appId) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tlet appResult: App | undefined;\\n\\t\\t\\tconst marketplaceAppsContexts = ['explore', 'premium', 'requested'];\\n\\n\\t\\t\\tif (marketplaceAppsContexts.includes(context)) appResult = marketplaceApps.value?.apps.find((app) => app.id === appId);\\n\\n\\t\\t\\tif (context === 'private') appResult = privateApps.value?.apps.find((app) => app.id === appId);\\n\\n\\t\\t\\tif (context === 'installed') appResult = installedApps.value?.apps.find((app) => app.id === appId);\\n\\n\\t\\t\\tif (!appResult) return;\\n\\n\\t\\t\\tconst [settings, apis, screenshots, bundledIn] = await Promise.all([\\n\\t\\t\\t\\tgetSettings().catch(() => ({\\n\\t\\t\\t\\t\\tsettings: {},\\n\\t\\t\\t\\t})),\\n\\t\\t\\t\\tgetApis().catch(() => ({\\n\\t\\t\\t\\t\\tapis: [],\\n\\t\\t\\t\\t})),\\n\\t\\t\\t\\tgetScreenshots().catch(() => ({\\n\\t\\t\\t\\t\\tscreenshots: [],\\n\\t\\t\\t\\t})),\\n\\t\\t\\t\\tappResult.marketplace === false\\n\\t\\t\\t\\t\\t? []\\n\\t\\t\\t\\t\\t: getBundledIn({\\n\\t\\t\\t\\t\\t\\t\\tmarketplace: 'true',\\n\\t\\t\\t\\t\\t\\t\\tupdate: 'true',\\n\\t\\t\\t\\t\\t\\t\\tappVersion: appId,\\n\\t\\t\\t\\t\\t  })\\n\\t\\t\\t\\t\\t\\t\\t.then(({ app }: any) => {\\n\\t\\t\\t\\t\\t\\t\\t\\t(appResult as App).tosLink = app.tosLink;\\n\\t\\t\\t\\t\\t\\t\\t\\t(appResult as App).privacyLink = app.privacyLink;\\n\\t\\t\\t\\t\\t\\t\\t\\treturn getBundledInApp(app);\\n\\t\\t\\t\\t\\t\\t\\t})\\n\\t\\t\\t\\t\\t\\t\\t.catch(() => ({\\n\\t\\t\\t\\t\\t\\t\\t\\tsettings: {},\\n\\t\\t\\t\\t\\t\\t\\t})),\\n\\t\\t\\t]);\\n\\n\\t\\t\\tsetAppData({\\n\\t\\t\\t\\t...appResult,\\n\\t\\t\\t\\tbundledIn: bundledIn as App['bundledIn'],\\n\\t\\t\\t\\tsettings: settings.settings as ISettings,\\n\\t\\t\\t\\tapis: apis ? apis.apis : [],\\n\\t\\t\\t\\tscreenshots: screenshots ? screenshots.screenshots : [],\\n\\t\\t\\t});\\n\\t\\t};\\n\\n\\t\\tfetchAppInfo();\\n\\t}, [appId, context, getApis, getBundledIn, getScreenshots, getSettings, installedApps, marketplaceApps, privateApps.value?.apps]);\\n\\n\\treturn appData;\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_objectSpread\",\"_slicedToArray\",\"_regeneratorRuntime\",\"export\",\"useAppInfo\",\"useEndpoint\",\"useState\",\"useEffect\",\"useContext\",\"AppClientOrchestratorInstance\",\"AppsContext\",\"getBundledInApp\",\"app\",\"_app$bundledIn\",\"bundledIn\",\"async\",\"_context2\",\"prev\",\"next\",\"abrupt\",\"Promise\",\"all\",\"map\",\"_callee\",\"bundle\",\"apps\",\"_callee$\",\"_context\",\"awrap\",\"getAppsOnBundle\",\"bundleId\",\"sent\",\"slice\",\"stop\",\"appId\",\"context\",\"_privateApps$value3\",\"_useContext\",\"installedApps\",\"marketplaceApps\",\"privateApps\",\"_useState\",\"_useState2\",\"appData\",\"setAppData\",\"getSettings\",\"id\",\"getScreenshots\",\"getApis\",\"getBundledIn\",\"_marketplaceApps$valu\",\"_marketplaceApps$valu2\",\"_installedApps$value\",\"_privateApps$value\",\"_marketplaceApps$valu3\",\"_privateApps$value2\",\"_installedApps$value2\",\"appResult\",\"_await$Promise$all\",\"_await$Promise$all2\",\"settings\",\"apis\",\"screenshots\",\"_context3\",\"value\",\"length\",\"marketplaceAppsContexts\",\"includes\",\"find\",\"catch\",\"marketplace\",\"update\",\"appVersion\",\"then\",\"_ref\",\"tosLink\",\"privacyLink\"],\"mappings\":\"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\"}"}