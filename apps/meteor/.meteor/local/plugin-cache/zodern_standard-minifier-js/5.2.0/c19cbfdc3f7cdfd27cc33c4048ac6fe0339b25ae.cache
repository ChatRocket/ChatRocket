{"code":"function module(e,n,t){let i,l,r;t.export({findParentMessage:()=>s}),t.link(\"../../../client/lib/utils/callWithErrorHandling\",{callWithErrorHandling(e){i=e}},0),t.link(\"../../../lib/utils/highOrderFunctions\",{withDebouncing(e){l=e}},1),t.link(\"../../models/client\",{ChatMessage(e){r=e}},2);let s=(()=>{let e;let n=[],t=new Promise(n=>{e=n}),s=l({wait:500})(async()=>{let l=[...n];n.length=0,e(i(\"getMessages\",l)),t=new Promise(n=>{e=n})}),a=async e=>{s();let n=await t;return n.find(n=>{let{_id:t}=n;return t===e})};return async e=>{let t=r.findOne({_id:e});return t||(-1===n.indexOf(e)&&n.push(e),a(e))}})()}","map":"{\"version\":3,\"sources\":[\"app/ui-message/client/findParentMessage.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IMessage } from '@rocket.chat/core-typings';\\n\\nimport { callWithErrorHandling } from '../../../client/lib/utils/callWithErrorHandling';\\nimport { withDebouncing } from '../../../lib/utils/highOrderFunctions';\\nimport { ChatMessage } from '../../models/client';\\n\\nexport const findParentMessage = (() => {\\n\\tconst waiting: string[] = [];\\n\\tlet resolve: (resolved: IMessage[] | PromiseLike<IMessage[]>) => void;\\n\\tlet pending = new Promise<IMessage[]>((r) => {\\n\\t\\tresolve = r;\\n\\t});\\n\\n\\tconst getMessages = withDebouncing({ wait: 500 })(async () => {\\n\\t\\tconst _tmp = [...waiting];\\n\\t\\twaiting.length = 0;\\n\\t\\tresolve(callWithErrorHandling('getMessages', _tmp));\\n\\t\\tpending = new Promise<IMessage[]>((r) => {\\n\\t\\t\\tresolve = r;\\n\\t\\t});\\n\\t});\\n\\n\\tconst get = async (tmid: IMessage['_id']) => {\\n\\t\\tvoid getMessages();\\n\\t\\tconst messages = await pending;\\n\\t\\treturn messages.find(({ _id }) => _id === tmid);\\n\\t};\\n\\n\\treturn async (tmid: IMessage['_id']) => {\\n\\t\\tconst message = ChatMessage.findOne({ _id: tmid });\\n\\n\\t\\tif (message) {\\n\\t\\t\\treturn message;\\n\\t\\t}\\n\\n\\t\\tif (waiting.indexOf(tmid) === -1) {\\n\\t\\t\\twaiting.push(tmid);\\n\\t\\t}\\n\\t\\treturn get(tmid);\\n\\t};\\n})();\\n\",null],\"names\":[\"callWithErrorHandling\",\"withDebouncing\",\"ChatMessage\",\"module\",\"export\",\"findParentMessage\",\"link\",\"v\",\"resolve\",\"waiting\",\"pending\",\"Promise\",\"r\",\"getMessages\",\"wait\",\"_tmp\",\"length\",\"get\",\"tmid\",\"messages\",\"find\",\"_ref\",\"_id\",\"message\",\"findOne\",\"indexOf\",\"push\"],\"mappings\":\"2BAEsCA,EAAkDC,EAAAC,EAAxFC,EAAOC,MAAE,CAAA,CAAAC,kBAAuBA,IAAAA,CAAM,GAAAF,EAAkDG,IAAA,CAAA,kDAAA,CAAAN,sBAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,wCAAA,CAAAL,eAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,sBAAA,CAAAJ,YAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAIjF,IAAMF,EAAoB,AAAC,CAAA,SAE7BG,EADJ,IAAMC,EAAoB,EAAE,CAExBC,EAAU,IAAIC,QAAqBC,IACtCJ,EAAUI,CACX,GAEMC,EAAcZ,EAAe,CAAEa,KAAM,GAAG,GAAI,UACjD,IAAMC,EAAO,IAAIN,EAAQ,AACzBA,CAAAA,EAAQO,MAAM,CAAG,EACjBR,EAAQR,EAAsB,cAAee,IAC7CL,EAAU,IAAIC,QAAqBC,IAClCJ,EAAUI,CACX,EACD,GAEMK,EAAM,MAAOC,IACbL,IACL,IAAMM,EAAW,MAAMT,EACvB,OAAOS,EAASC,IAAI,CAACC,IAAA,GAAC,CAAEC,IAAAA,CAAAA,CAAK,CAAAD,EAAA,OAAKC,IAAQJ,CAAI,EAC/C,EAEA,OAAO,MAAOA,IACb,IAAMK,EAAUrB,EAAYsB,OAAO,CAAC,CAAEF,IAAKJ,CAAI,UAE/C,AAAIK,IAI0B,KAA1Bd,EAAQgB,OAAO,CAACP,IACnBT,EAAQiB,IAAI,CAACR,GAEPD,EAAIC,GACZ,CACD,CAAA\"}"}