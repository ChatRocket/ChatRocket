{"code":"function module(e,t,i){let r,s,o,n,l;let c=[\"appId\"];i.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){r=e}},0),i.link(\"@babel/runtime/helpers/objectWithoutProperties\",{default(e){s=e}},1),i.export({loginServices:()=>a}),i.link(\"@rocket.chat/emitter\",{Emitter(e){o=e}},0),i.link(\"@rocket.chat/string-helpers\",{capitalize(e){n=e}},1),i.link(\"../../app/utils/client/lib/SDKClient\",{sdk(e){l=e}},2);let a=new class e extends o{constructor(){super(...arguments),this.retries=0,this.services=[],this.serviceButtons=[],this.state=\"none\",this.config={apple:{title:\"Apple\",icon:\"apple\"},facebook:{title:\"Facebook\",icon:\"facebook\"},twitter:{title:\"Twitter\",icon:\"twitter\"},google:{title:\"Google\",icon:\"google\"},github:{title:\"Github\",icon:\"github\"},github_enterprise:{title:\"Github Enterprise\",icon:\"github\"},gitlab:{title:\"Gitlab\",icon:\"gitlab\"},dolphin:{title:\"Dolphin\",icon:\"dophin\"},drupal:{title:\"Drupal\",icon:\"drupal\"},nextcloud:{title:\"Nextcloud\",icon:\"nextcloud\"},tokenpass:{title:\"Tokenpass\",icon:\"tokenpass\"},\"meteor-developer\":{title:\"Meteor\",icon:\"meteor\"},wordpress:{title:\"WordPress\",icon:\"wordpress\"},linkedin:{title:\"Linkedin\",icon:\"linkedin\"}}}setServices(e,t){this.services=t,this.state=e,this.generateServiceButtons(),\"loaded\"===e&&(this.retries=0,this.emit(\"loaded\",t))}generateServiceButtons(){let e=this.services.filter(e=>!(\"showButton\"in e)||!1!==e.showButton)||[],t=e.sort((e,t)=>{let{service:i}=e,{service:r}=t;return i.localeCompare(r)});this.serviceButtons=t.map(e=>{let t=r(r({},e),{},{appId:void 0}),{appId:i}=t,o=s(t,c),l=this.config[e.service]||{title:n(e.service)};return r(r({},o),l)}),this.emit(\"changed\")}getLoginService(e){if(this.ready)return this.services.find(t=>{let{service:i}=t;return i===e})}async loadLoginService(e){return this.ready?this.getLoginService(e):new Promise((t,i)=>{this.onLoad(()=>t(this.getLoginService(e))),setTimeout(()=>i(Error(\"LoadLoginService timeout\")),1e4)})}get ready(){return\"loaded\"===this.state}getLoginServiceButtons(){return this.ready||\"none\"!==this.state||void this.loadServices(),this.serviceButtons}onLoad(e){if(this.ready)return e(this.services);this.loadServices(),this.once(\"loaded\",e)}async loadServices(){if(\"error\"===this.state){if(this.retries>=3)return;this.retries++}else if(\"none\"!==this.state)return;try{this.state=\"loading\";let{configurations:e}=await l.rest.get(\"/v1/service.configurations\");this.setServices(\"loaded\",e)}catch(e){throw this.setServices(\"error\",[]),e}}}}","map":"{\"version\":3,\"sources\":[\"client/lib/loginServices.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { LoginServiceConfiguration } from '@rocket.chat/core-typings';\\nimport { Emitter } from '@rocket.chat/emitter';\\nimport { capitalize } from '@rocket.chat/string-helpers';\\nimport type { LoginService } from '@rocket.chat/ui-contexts';\\n\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\n\\ntype LoginServicesEvents = {\\n\\tchanged: undefined;\\n\\tloaded: LoginServiceConfiguration[];\\n};\\n\\ntype LoadState = 'loaded' | 'loading' | 'error' | 'none';\\n\\nconst maxRetries = 3;\\nconst timeout = 10000;\\n\\nclass LoginServices extends Emitter<LoginServicesEvents> {\\n\\tprivate retries = 0;\\n\\n\\tprivate services: LoginServiceConfiguration[] = [];\\n\\n\\tprivate serviceButtons: LoginService[] = [];\\n\\n\\tprivate state: LoadState = 'none';\\n\\n\\tprivate config: Record<string, Partial<LoginService>> = {\\n\\t\\t'apple': { title: 'Apple', icon: 'apple' },\\n\\t\\t'facebook': { title: 'Facebook', icon: 'facebook' },\\n\\t\\t'twitter': { title: 'Twitter', icon: 'twitter' },\\n\\t\\t'google': { title: 'Google', icon: 'google' },\\n\\t\\t'github': { title: 'Github', icon: 'github' },\\n\\t\\t'github_enterprise': { title: 'Github Enterprise', icon: 'github' },\\n\\t\\t'gitlab': { title: 'Gitlab', icon: 'gitlab' },\\n\\t\\t'dolphin': { title: 'Dolphin', icon: 'dophin' },\\n\\t\\t'drupal': { title: 'Drupal', icon: 'drupal' },\\n\\t\\t'nextcloud': { title: 'Nextcloud', icon: 'nextcloud' },\\n\\t\\t'tokenpass': { title: 'Tokenpass', icon: 'tokenpass' },\\n\\t\\t'meteor-developer': { title: 'Meteor', icon: 'meteor' },\\n\\t\\t'wordpress': { title: 'WordPress', icon: 'wordpress' },\\n\\t\\t'linkedin': { title: 'Linkedin', icon: 'linkedin' },\\n\\t};\\n\\n\\tprivate setServices(state: LoadState, services: LoginServiceConfiguration[]) {\\n\\t\\tthis.services = services;\\n\\t\\tthis.state = state;\\n\\n\\t\\tthis.generateServiceButtons();\\n\\n\\t\\tif (state === 'loaded') {\\n\\t\\t\\tthis.retries = 0;\\n\\t\\t\\tthis.emit('loaded', services);\\n\\t\\t}\\n\\t}\\n\\n\\tprivate generateServiceButtons(): void {\\n\\t\\tconst filtered = this.services.filter((config) => !('showButton' in config) || config.showButton !== false) || [];\\n\\t\\tconst sorted = filtered.sort(({ service: service1 }, { service: service2 }) => service1.localeCompare(service2));\\n\\t\\tthis.serviceButtons = sorted.map((service) => {\\n\\t\\t\\t// Remove the appId attribute if present\\n\\t\\t\\tconst { appId: _, ...serviceData } = {\\n\\t\\t\\t\\t...service,\\n\\t\\t\\t\\tappId: undefined,\\n\\t\\t\\t};\\n\\n\\t\\t\\t// Get the hardcoded title and icon, or fallback to capitalizing the service name\\n\\t\\t\\tconst serviceConfig = this.config[service.service] || {\\n\\t\\t\\t\\ttitle: capitalize(service.service),\\n\\t\\t\\t};\\n\\n\\t\\t\\treturn {\\n\\t\\t\\t\\t...serviceData,\\n\\t\\t\\t\\t...serviceConfig,\\n\\t\\t\\t};\\n\\t\\t});\\n\\n\\t\\tthis.emit('changed');\\n\\t}\\n\\n\\tpublic getLoginService<T extends Partial<LoginServiceConfiguration> = LoginServiceConfiguration>(serviceName: string): T | undefined {\\n\\t\\tif (!this.ready) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\treturn this.services.find(({ service }) => service === serviceName) as T | undefined;\\n\\t}\\n\\n\\tpublic async loadLoginService<T extends Partial<LoginServiceConfiguration> = LoginServiceConfiguration>(\\n\\t\\tserviceName: string,\\n\\t): Promise<T | undefined> {\\n\\t\\tif (this.ready) {\\n\\t\\t\\treturn this.getLoginService<T>(serviceName);\\n\\t\\t}\\n\\n\\t\\treturn new Promise((resolve, reject) => {\\n\\t\\t\\tthis.onLoad(() => resolve(this.getLoginService<T>(serviceName)));\\n\\n\\t\\t\\tsetTimeout(() => reject(new Error('LoadLoginService timeout')), timeout);\\n\\t\\t});\\n\\t}\\n\\n\\tpublic get ready() {\\n\\t\\treturn this.state === 'loaded';\\n\\t}\\n\\n\\tpublic getLoginServiceButtons(): LoginService[] {\\n\\t\\tif (!this.ready) {\\n\\t\\t\\tif (this.state === 'none') {\\n\\t\\t\\t\\tvoid this.loadServices();\\n\\t\\t\\t}\\n\\t\\t}\\n\\n\\t\\treturn this.serviceButtons;\\n\\t}\\n\\n\\tpublic onLoad(callback: (services: LoginServiceConfiguration[]) => void) {\\n\\t\\tif (this.ready) {\\n\\t\\t\\treturn callback(this.services);\\n\\t\\t}\\n\\n\\t\\tvoid this.loadServices();\\n\\t\\tthis.once('loaded', callback);\\n\\t}\\n\\n\\tpublic async loadServices(): Promise<void> {\\n\\t\\tif (this.state === 'error') {\\n\\t\\t\\tif (this.retries >= maxRetries) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\tthis.retries++;\\n\\t\\t} else if (this.state !== 'none') {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\ttry {\\n\\t\\t\\tthis.state = 'loading';\\n\\t\\t\\tconst { configurations } = await sdk.rest.get('/v1/service.configurations');\\n\\n\\t\\t\\tthis.setServices('loaded', configurations);\\n\\t\\t} catch (e) {\\n\\t\\t\\tthis.setServices('error', []);\\n\\t\\t\\tthrow e;\\n\\t\\t}\\n\\t}\\n}\\n\\nexport const loginServices = new LoginServices();\\n\",null],\"names\":[\"_objectSpread\",\"_objectWithoutProperties\",\"Emitter\",\"capitalize\",\"sdk\",\"module\",\"link\",\"default\",\"v\",\"export\",\"loginServices\",\"LoginServices\",\"constructor\",\"arguments\",\"retries\",\"services\",\"serviceButtons\",\"state\",\"config\",\"title\",\"icon\",\"setServices\",\"generateServiceButtons\",\"emit\",\"filtered\",\"filter\",\"showButton\",\"sorted\",\"sort\",\"_ref\",\"_ref2\",\"service\",\"service1\",\"service2\",\"localeCompare\",\"map\",\"_service$appId\",\"appId\",\"undefined\",\"_\",\"serviceData\",\"_excluded\",\"serviceConfig\",\"getLoginService\",\"serviceName\",\"ready\",\"find\",\"_ref3\",\"loadLoginService\",\"Promise\",\"resolve\",\"reject\",\"onLoad\",\"setTimeout\",\"Error\",\"getLoginServiceButtons\",\"loadServices\",\"callback\",\"once\",\"configurations\",\"rest\",\"get\",\"e\"],\"mappings\":\"2BACAA,EAA+CC,EAAAC,EAAAC,EAAAC,kBAA7BC,EAAMC,IAAA,CAAA,uCAAuB,CAAAC,QAAAC,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,iDAAA,CAAAC,QAAAC,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAA/CH,EAAOI,MAAE,CAAA,CAAAC,cAAeA,IAAAA,CAAsB,GAACL,EAAAC,IAAA,CAAA,uBAAA,CAAAJ,QAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,8BAAA,CAAAH,WAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAF,IAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAiJxC,IAAME,EAAgB,IAjI7B,MAAMC,UAAsBT,EAA4BU,aAAA,CAAA,KAAA,IAAAC,WAAA,IAAA,CAC/CC,OAAO,CAAG,EAAC,IAAA,CAEXC,QAAQ,CAAgC,EAAE,CAAA,IAAA,CAE1CC,cAAc,CAAmB,EAAE,CAAA,IAAA,CAEnCC,KAAK,CAAc,OAAM,IAAA,CAEzBC,MAAM,CAA0C,CACvD,MAAS,CAAEC,MAAO,QAASC,KAAM,OAAO,EACxC,SAAY,CAAED,MAAO,WAAYC,KAAM,UAAU,EACjD,QAAW,CAAED,MAAO,UAAWC,KAAM,SAAS,EAC9C,OAAU,CAAED,MAAO,SAAUC,KAAM,QAAQ,EAC3C,OAAU,CAAED,MAAO,SAAUC,KAAM,QAAQ,EAC3C,kBAAqB,CAAED,MAAO,oBAAqBC,KAAM,QAAQ,EACjE,OAAU,CAAED,MAAO,SAAUC,KAAM,QAAQ,EAC3C,QAAW,CAAED,MAAO,UAAWC,KAAM,QAAQ,EAC7C,OAAU,CAAED,MAAO,SAAUC,KAAM,QAAQ,EAC3C,UAAa,CAAED,MAAO,YAAaC,KAAM,WAAW,EACpD,UAAa,CAAED,MAAO,YAAaC,KAAM,WAAW,EACpD,mBAAoB,CAAED,MAAO,SAAUC,KAAM,QAAQ,EACrD,UAAa,CAAED,MAAO,YAAaC,KAAM,WAAW,EACpD,SAAY,CAAED,MAAO,WAAYC,KAAM,UAAU,EACjD,CAEOC,YAAYJ,CAAgB,CAAEF,CAAqC,CAAA,CAC1E,IAAI,CAACA,QAAQ,CAAGA,EAChB,IAAI,CAACE,KAAK,CAAGA,EAEb,IAAI,CAACK,sBAAsB,GAEb,WAAVL,IACH,IAAI,CAACH,OAAO,CAAG,EACf,IAAI,CAACS,IAAI,CAAC,SAAUR,GAEtB,CAEQO,wBAAsB,CAC7B,IAAME,EAAW,IAAI,CAACT,QAAQ,CAACU,MAAM,CAAEP,GAAW,CAAE,CAAA,eAAgBA,CAAAA,GAAWA,AAAsB,CAAA,IAAtBA,EAAOQ,UAAU,GAAe,EAAE,CAC3GC,EAASH,EAASI,IAAI,CAAC,CAAAC,EAAAC,KAAA,GAAC,CAAEC,QAASC,CAAAA,CAAU,CAAAH,EAAE,CAAEE,QAASE,CAAAA,CAAU,CAAAH,EAAA,OAAKE,EAASE,aAAa,CAACD,EAAS,EAC/G,CAAA,IAAI,CAACjB,cAAc,CAAGW,EAAOQ,GAAG,CAAEJ,IAEjC,IAAAK,EAAApC,EAAAA,EAAA,CAAA,EACI+B,GAAO,CAAA,EAAA,CACVM,MAAOC,KAAAA,CAAS,GAFX,CAAED,MAAOE,CAAAA,CAAmB,CAAAH,EAAbI,EAAWvC,EAAAmC,EAAAK,GAM1BC,EAAgB,IAAI,CAACxB,MAAM,CAACa,EAAQA,OAAO,CAAC,EAAI,CACrDZ,MAAOhB,EAAW4B,EAAQA,OAAO,GAGlC,OAAA/B,EAAAA,EAAA,CAAA,EACIwC,GACAE,EAEL,GAEA,IAAI,CAACnB,IAAI,CAAC,UACX,CAEOoB,gBAA0FC,CAAmB,CAAA,CACnH,GAAK,IAAI,CAACC,KAAK,CAIf,OAAO,IAAI,CAAC9B,QAAQ,CAAC+B,IAAI,CAACC,IAAA,GAAC,CAAEhB,QAAAA,CAAAA,CAAS,CAAAgB,EAAA,OAAKhB,IAAYa,CAAW,EACnE,CAEO,MAAMI,iBACZJ,CAAmB,CAAA,QAEnB,AAAI,IAAI,CAACC,KAAK,CACN,IAAI,CAACF,eAAe,CAAIC,GAGzB,IAAIK,QAAQ,CAACC,EAASC,KAC5B,IAAI,CAACC,MAAM,CAAC,IAAMF,EAAQ,IAAI,CAACP,eAAe,CAAIC,KAElDS,WAAW,IAAMF,EAAO,AAAIG,MAAM,6BAlFrB,IAmFd,EACD,CAEA,IAAWT,OAAK,CACf,MAAO,AAAe,WAAf,IAAI,CAAC5B,KAAK,AAClB,CAEOsC,wBAAsB,CAO5B,OANK,IAAI,CAACV,KAAK,EACV,AAAe,SAAf,IAAI,CAAC5B,KAAK,EACb,KAAK,IAAI,CAACuC,YAAY,GAIjB,IAAI,CAACxC,cAAc,AAC3B,CAEOoC,OAAOK,CAAyD,CAAA,CACtE,GAAI,IAAI,CAACZ,KAAK,CACb,OAAOY,EAAS,IAAI,CAAC1C,QAAQ,EAGzB,IAAI,CAACyC,YAAY,GACtB,IAAI,CAACE,IAAI,CAAC,SAAUD,EACrB,CAEO,MAAMD,cAAY,CACxB,GAAI,AAAe,UAAf,IAAI,CAACvC,KAAK,CAAc,CAC3B,GAAI,IAAI,CAACH,OAAO,EAhHA,EAiHf,MAED,CAAA,IAAI,CAACA,OAAO,EACb,MAAO,GAAI,AAAe,SAAf,IAAI,CAACG,KAAK,CACpB,OAGD,GAAI,CACH,IAAI,CAACA,KAAK,CAAG,UACb,GAAM,CAAE0C,eAAAA,CAAAA,CAAgB,CAAG,MAAMvD,EAAIwD,IAAI,CAACC,GAAG,CAAC,8BAE9C,IAAI,CAACxC,WAAW,CAAC,SAAUsC,EAC5B,CAAE,MAAOG,EAAG,CAEX,MADA,IAAI,CAACzC,WAAW,CAAC,QAAS,EAAE,EACtByC,CACP,CACD\"}"}