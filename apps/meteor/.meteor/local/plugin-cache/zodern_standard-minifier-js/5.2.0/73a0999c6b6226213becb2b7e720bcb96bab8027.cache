{"code":"function module(e,t,n){let r;n.export({MentionsParser:()=>l}),n.link(\"@rocket.chat/string-helpers\",{escapeHTML(e){r=e}},0);let a=e=>{let{prefix:t,className:n,mention:r,title:a=\"\",label:i,type:l=\"username\"}=e;return\"\".concat(t,'<a class=\"').concat(n,'\" data-').concat(l,'=\"').concat(r,'\"').concat(a?' title=\"'.concat(a,'\"'):\"\",\">\").concat(i,\"</a>\")},i=e=>{let{prefix:t,reference:n,mention:r}=e;return\"\".concat(t,'<a class=\"mention-link mention-link--room\" data-channel=\"').concat(n,'\">',\"#\".concat(r),\"</a>\")};class l{constructor(e){let{pattern:t,useRealName:n,me:l,roomTemplate:s=i,userTemplate:o=a}=e;this.me=void 0,this.pattern=void 0,this.userTemplate=void 0,this.roomTemplate=void 0,this.useRealName=void 0,this.replaceUsers=(e,t,n)=>{let{mentions:a,temp:i}=t;return e.replace(this.userMentionRegex,(e,t,l)=>{let s=[\"mention-link\"];\"all\"===l?(s.push(\"mention-link--all\"),s.push(\"mention-link--group\")):\"here\"===l?(s.push(\"mention-link--here\"),s.push(\"mention-link--group\")):(l===n&&s.push(\"mention-link--me\"),s.push(\"mention-link--user\"));let o=s.join(\" \");if(\"all\"===l||\"here\"===l)return this.userTemplate({prefix:t,className:o,mention:l,label:l,type:\"group\"});let c=e=>{let{username:t,type:n}=e;return(!n||\"user\"===n)&&t===l},h=e=>{let{name:t,type:n}=e;return\"team\"===n&&t===l},[m]=(a||[]).filter(e=>e&&(c(e)||h(e))),u=i?l&&r(l):m&&r((\"team\"===m.type||this.useRealName()?m.name:m.username)||\"\");return u?this.userTemplate({prefix:t,className:o,mention:l,label:u,type:(null==m?void 0:m.type)===\"team\"?\"team\":\"username\",title:this.useRealName()?l:u}):e})},this.replaceChannels=(e,t)=>{let{temp:n,channels:r}=t;return e.replace(/&#39;/g,\"'\").replace(this.channelMentionRegex,(e,t,a)=>{if(!n&&!(null!=r&&r.find(e=>e.name===a)))return e;let i=null==r?void 0:r.find(e=>{let{name:t}=e;return t===a}),l=i?i._id:a;return this.roomTemplate({prefix:t,reference:l,channel:i,mention:a})})},this.pattern=t,this.useRealName=n||(()=>!1),this.me=l||(()=>\"\"),this.userTemplate=o,this.roomTemplate=s}get userMentionRegex(){return RegExp(\"(^|\\\\s|>)@(\".concat(this.pattern(),\"(@(\").concat(this.pattern(),\"))?(:([0-9a-zA-Z-_.]+))?)\"),\"gm\")}get channelMentionRegex(){return RegExp(\"(^|\\\\s|>)#(\".concat(this.pattern(),\"(@(\").concat(this.pattern(),\"))?)\"),\"gm\")}getUserMentions(e){return(e.match(this.userMentionRegex)||[]).map(e=>e.trim())}getChannelMentions(e){return(e.match(this.channelMentionRegex)||[]).map(e=>e.trim())}parse(e){let t=(null==e?void 0:e.html)||\"\";return t.trim()&&(t=this.replaceUsers(t,e,this.me()),t=this.replaceChannels(t,e),e.html=t),e}}}","map":"{\"version\":3,\"sources\":[\"app/mentions/lib/MentionsParser.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IMessage } from '@rocket.chat/core-typings';\\nimport { escapeHTML } from '@rocket.chat/string-helpers';\\n\\nexport type MentionsParserArgs = {\\n\\tpattern: () => string;\\n\\tuseRealName?: () => boolean;\\n\\tme?: () => string;\\n\\troomTemplate?: (args: { prefix: string; reference: string; mention: string; channel?: any }) => string;\\n\\tuserTemplate?: (args: { prefix: string; className: string; mention: string; title?: string; label: string; type?: string }) => string;\\n};\\n\\nconst userTemplateDefault = ({\\n\\tprefix,\\n\\tclassName,\\n\\tmention,\\n\\ttitle = '',\\n\\tlabel,\\n\\ttype = 'username',\\n}: {\\n\\tprefix: string;\\n\\tclassName: string;\\n\\tmention: string;\\n\\ttitle?: string;\\n\\tlabel?: string;\\n\\ttype?: string;\\n}) => `${prefix}<a class=\\\"${className}\\\" data-${type}=\\\"${mention}\\\"${title ? ` title=\\\"${title}\\\"` : ''}>${label}</a>`;\\n\\nconst roomTemplateDefault = ({ prefix, reference, mention }: { prefix: string; reference: string; mention: string }) =>\\n\\t`${prefix}<a class=\\\"mention-link mention-link--room\\\" data-channel=\\\"${reference}\\\">${`#${mention}`}</a>`;\\n\\nexport class MentionsParser {\\n\\tme: () => string;\\n\\n\\tpattern: MentionsParserArgs['pattern'];\\n\\n\\tuserTemplate: (args: { prefix: string; className: string; mention: string; title?: string; label: string; type?: string }) => string;\\n\\n\\troomTemplate: (args: { prefix: string; reference: string; mention: string; channel?: any }) => string;\\n\\n\\tuseRealName: () => boolean;\\n\\n\\tconstructor({ pattern, useRealName, me, roomTemplate = roomTemplateDefault, userTemplate = userTemplateDefault }: MentionsParserArgs) {\\n\\t\\tthis.pattern = pattern;\\n\\t\\tthis.useRealName = useRealName || (() => false);\\n\\t\\tthis.me = me || (() => '');\\n\\t\\tthis.userTemplate = userTemplate;\\n\\t\\tthis.roomTemplate = roomTemplate;\\n\\t}\\n\\n\\tget userMentionRegex() {\\n\\t\\treturn new RegExp(`(^|\\\\\\\\s|>)@(${this.pattern()}(@(${this.pattern()}))?(:([0-9a-zA-Z-_.]+))?)`, 'gm');\\n\\t}\\n\\n\\tget channelMentionRegex() {\\n\\t\\treturn new RegExp(`(^|\\\\\\\\s|>)#(${this.pattern()}(@(${this.pattern()}))?)`, 'gm');\\n\\t}\\n\\n\\treplaceUsers = (msg: string, { mentions, temp }: IMessage, me: string) =>\\n\\t\\tmsg.replace(this.userMentionRegex, (match, prefix, mention) => {\\n\\t\\t\\tconst classNames = ['mention-link'];\\n\\n\\t\\t\\tif (mention === 'all') {\\n\\t\\t\\t\\tclassNames.push('mention-link--all');\\n\\t\\t\\t\\tclassNames.push('mention-link--group');\\n\\t\\t\\t} else if (mention === 'here') {\\n\\t\\t\\t\\tclassNames.push('mention-link--here');\\n\\t\\t\\t\\tclassNames.push('mention-link--group');\\n\\t\\t\\t} else if (mention === me) {\\n\\t\\t\\t\\tclassNames.push('mention-link--me');\\n\\t\\t\\t\\tclassNames.push('mention-link--user');\\n\\t\\t\\t} else {\\n\\t\\t\\t\\tclassNames.push('mention-link--user');\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst className = classNames.join(' ');\\n\\n\\t\\t\\tif (mention === 'all' || mention === 'here') {\\n\\t\\t\\t\\treturn this.userTemplate({ prefix, className, mention, label: mention, type: 'group' });\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst filterUser = ({ username, type }: { username?: string; type?: string }) => (!type || type === 'user') && username === mention;\\n\\t\\t\\tconst filterTeam = ({ name, type }: { name?: string; type?: string }) => type === 'team' && name === mention;\\n\\n\\t\\t\\tconst [mentionObj] = (mentions || []).filter((m) => m && (filterUser(m) || filterTeam(m)));\\n\\n\\t\\t\\tconst label = temp\\n\\t\\t\\t\\t? mention && escapeHTML(mention)\\n\\t\\t\\t\\t: mentionObj && escapeHTML((mentionObj.type === 'team' || this.useRealName() ? mentionObj.name : mentionObj.username) || '');\\n\\n\\t\\t\\tif (!label) {\\n\\t\\t\\t\\treturn match;\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn this.userTemplate({\\n\\t\\t\\t\\tprefix,\\n\\t\\t\\t\\tclassName,\\n\\t\\t\\t\\tmention,\\n\\t\\t\\t\\tlabel,\\n\\t\\t\\t\\ttype: mentionObj?.type === 'team' ? 'team' : 'username',\\n\\t\\t\\t\\ttitle: this.useRealName() ? mention : label,\\n\\t\\t\\t});\\n\\t\\t});\\n\\n\\treplaceChannels = (msg: string, { temp, channels }: IMessage) =>\\n\\t\\tmsg.replace(/&#39;/g, \\\"'\\\").replace(this.channelMentionRegex, (match, prefix, mention) => {\\n\\t\\t\\tif (\\n\\t\\t\\t\\t!temp &&\\n\\t\\t\\t\\t!channels?.find((c) => {\\n\\t\\t\\t\\t\\treturn c.name === mention;\\n\\t\\t\\t\\t})\\n\\t\\t\\t) {\\n\\t\\t\\t\\treturn match;\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst channel = channels?.find(({ name }) => {\\n\\t\\t\\t\\treturn name === mention;\\n\\t\\t\\t});\\n\\t\\t\\tconst reference = channel ? channel._id : mention;\\n\\t\\t\\treturn this.roomTemplate({ prefix, reference, channel, mention });\\n\\t\\t});\\n\\n\\tgetUserMentions(str: string) {\\n\\t\\treturn (str.match(this.userMentionRegex) || []).map((match) => match.trim());\\n\\t}\\n\\n\\tgetChannelMentions(str: string) {\\n\\t\\treturn (str.match(this.channelMentionRegex) || []).map((match) => match.trim());\\n\\t}\\n\\n\\tparse(message: IMessage) {\\n\\t\\tlet msg = message?.html || '';\\n\\t\\tif (!msg.trim()) {\\n\\t\\t\\treturn message;\\n\\t\\t}\\n\\t\\tmsg = this.replaceUsers(msg, message, this.me());\\n\\t\\tmsg = this.replaceChannels(msg, message);\\n\\t\\tmessage.html = msg;\\n\\t\\treturn message;\\n\\t}\\n}\\n\",null],\"names\":[\"escapeHTML\",\"module\",\"export\",\"MentionsParser\",\"link\",\"v\",\"userTemplateDefault\",\"_ref\",\"prefix\",\"className\",\"mention\",\"title\",\"label\",\"type\",\"concat\",\"roomTemplateDefault\",\"_ref2\",\"reference\",\"constructor\",\"_ref3\",\"pattern\",\"useRealName\",\"me\",\"roomTemplate\",\"userTemplate\",\"replaceUsers\",\"msg\",\"_ref4\",\"mentions\",\"temp\",\"replace\",\"userMentionRegex\",\"match\",\"classNames\",\"push\",\"join\",\"filterUser\",\"_ref5\",\"username\",\"filterTeam\",\"_ref6\",\"name\",\"mentionObj\",\"filter\",\"m\",\"replaceChannels\",\"_ref7\",\"channels\",\"channelMentionRegex\",\"find\",\"c\",\"channel\",\"_ref8\",\"_id\",\"RegExp\",\"getUserMentions\",\"str\",\"map\",\"trim\",\"getChannelMentions\",\"parse\",\"message\",\"html\"],\"mappings\":\"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\"}"}