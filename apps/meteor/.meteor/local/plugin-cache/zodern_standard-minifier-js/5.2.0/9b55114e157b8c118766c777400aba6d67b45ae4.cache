{"code":"function module(e,o,n){n.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){t=e}},0),n.link(\"@babel/runtime/regenerator\",{default:function(e){i=e}},1),n.export({useE2EERoomAction:function(){return A}}),n.link(\"@rocket.chat/core-typings\",{isRoomFederated:function(e){r=e}},0),n.link(\"@rocket.chat/fuselage-hooks\",{useEffectEvent:function(e){a=e}},1),n.link(\"@rocket.chat/ui-contexts\",{useSetting:function(e){s=e},usePermission:function(e){u=e},useEndpoint:function(e){c=e}},2),n.link(\"react\",{useMemo:function(e){l=e}},3),n.link(\"react-i18next\",{useTranslation:function(e){E=e}},4),n.link(\"../../../app/e2e/client/E2EEState\",{E2EEState:function(e){m=e}},5),n.link(\"../../../app/e2e/client/E2ERoomState\",{E2ERoomState:function(e){f=e}},6),n.link(\"../../../app/otr/lib/OtrRoomState\",{OtrRoomState:function(e){p=e}},7),n.link(\"../../lib/getRoomTypeTranslation\",{getRoomTypeTranslation:function(e){d=e}},8),n.link(\"../../lib/imperativeModal\",{imperativeModal:function(e){_=e}},9),n.link(\"../../lib/toast\",{dispatchToastMessage:function(e){S=e}},10),n.link(\"../../views/room/contexts/RoomContext\",{useRoom:function(e){k=e},useRoomSubscription:function(e){R=e}},11),n.link(\"../../views/room/hooks/useE2EERoomState\",{useE2EERoomState:function(e){b=e}},12),n.link(\"../../views/room/hooks/useE2EEState\",{useE2EEState:function(e){T=e}},13),n.link(\"../../views/room/modals/E2EEModals/BaseDisableE2EEModal\",{default:function(e){y=e}},14),n.link(\"../../views/room/modals/E2EEModals/EnableE2EEModal\",{default:function(e){v=e}},15),n.link(\"../useOTR\",{useOTR:function(e){g=e}},16);var t,i,r,a,s,u,c,l,E,m,f,p,d,_,S,k,R,b,T,y,v,g,A=function(){var e=s(\"E2E_Enable\",!1),o=k(),n=R(),A=T(),O=b(o._id),h=A===m.READY||A===m.SAVE_PASSWORD,x=h||o.encrypted,D=u(\"toggle-room-e2e-encryption\",o._id),w=u(\"edit-room\",o._id),M=(\"d\"===o.t||w&&D)&&x,I=r(o),N=E().t,C=g().otrState,P=!!o.encrypted,B=l(function(){var e;return null===(e=d(o))||void 0===e?void 0:e.toLowerCase()},[o]),L=o._id,W=c(\"POST\",\"/v1/rooms.saveRoomSettings\"),G=e&&h&&(\"d\"===o.t||D)&&(O===f.NO_PASSWORD_SET||O===f.NOT_STARTED||O===f.DISABLED||O===f.ERROR||O===f.WAITING_KEYS),H=a(function(){return i.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(C===p.ESTABLISHED||C===p.ESTABLISHING||C===p.REQUESTED)){e.next=3;break}return S({type:\"error\",message:N(\"E2EE_not_available_OTR\")}),e.abrupt(\"return\");case 3:P?_.open({component:y,props:{onClose:_.close,onConfirm:K,roomType:B,roomId:L,canResetRoomKey:G}}):_.open({component:v,props:{onClose:_.close,onConfirm:K,roomType:B}});case 4:case\"end\":return e.stop()}},null,null,null,Promise)}),K=function(){return i.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.awrap(W({rid:o._id,encrypted:!o.encrypted}));case 2:if(e.sent.success){e.next=6;break}return e.abrupt(\"return\");case 6:_.close(),S({type:\"success\",message:o.encrypted?N(\"E2E_Encryption_disabled_for_room\",{roomName:o.name}):N(\"E2E_Encryption_enabled_for_room\",{roomName:o.name})}),null!=n&&n.autoTranslate&&S({type:\"success\",message:N(\"AutoTranslate_Disabled_for_room\",{roomName:o.name})});case 9:case\"end\":return e.stop()}},null,null,null,Promise)};return l(function(){if(e&&M)return t({id:\"e2e\",groups:[\"direct\",\"direct_multiple\",\"group\",\"team\"],title:P?\"E2E_disable\":\"E2E_enable\",icon:\"key\",order:13,action:H,type:\"organization\"},I&&{tooltip:N(\"core.E2E_unavailable_for_federation\"),disabled:!0})},[e,M,I,N,P,H])}}","map":"{\"version\":3,\"sources\":[\"client/hooks/roomActions/useE2EERoomAction.ts\",\"<anon>\"],\"sourcesContent\":[\"import { isRoomFederated } from '@rocket.chat/core-typings';\\nimport { useEffectEvent } from '@rocket.chat/fuselage-hooks';\\nimport { useSetting, usePermission, useEndpoint } from '@rocket.chat/ui-contexts';\\nimport { useMemo } from 'react';\\nimport { useTranslation } from 'react-i18next';\\n\\nimport { E2EEState } from '../../../app/e2e/client/E2EEState';\\nimport { E2ERoomState } from '../../../app/e2e/client/E2ERoomState';\\nimport { OtrRoomState } from '../../../app/otr/lib/OtrRoomState';\\nimport { getRoomTypeTranslation } from '../../lib/getRoomTypeTranslation';\\nimport { imperativeModal } from '../../lib/imperativeModal';\\nimport { dispatchToastMessage } from '../../lib/toast';\\nimport { useRoom, useRoomSubscription } from '../../views/room/contexts/RoomContext';\\nimport type { RoomToolboxActionConfig } from '../../views/room/contexts/RoomToolboxContext';\\nimport { useE2EERoomState } from '../../views/room/hooks/useE2EERoomState';\\nimport { useE2EEState } from '../../views/room/hooks/useE2EEState';\\nimport BaseDisableE2EEModal from '../../views/room/modals/E2EEModals/BaseDisableE2EEModal';\\nimport EnableE2EEModal from '../../views/room/modals/E2EEModals/EnableE2EEModal';\\nimport { useOTR } from '../useOTR';\\n\\nexport const useE2EERoomAction = () => {\\n\\tconst enabled = useSetting('E2E_Enable', false);\\n\\tconst room = useRoom();\\n\\tconst subscription = useRoomSubscription();\\n\\tconst e2eeState = useE2EEState();\\n\\tconst e2eeRoomState = useE2EERoomState(room._id);\\n\\tconst isE2EEReady = e2eeState === E2EEState.READY || e2eeState === E2EEState.SAVE_PASSWORD;\\n\\tconst readyToEncrypt = isE2EEReady || room.encrypted;\\n\\tconst permittedToToggleEncryption = usePermission('toggle-room-e2e-encryption', room._id);\\n\\tconst permittedToEditRoom = usePermission('edit-room', room._id);\\n\\tconst permitted = (room.t === 'd' || (permittedToEditRoom && permittedToToggleEncryption)) && readyToEncrypt;\\n\\tconst federated = isRoomFederated(room);\\n\\tconst { t } = useTranslation();\\n\\tconst { otrState } = useOTR();\\n\\n\\tconst isE2EERoomNotReady = () => {\\n\\t\\tif (\\n\\t\\t\\te2eeRoomState === E2ERoomState.NO_PASSWORD_SET ||\\n\\t\\t\\te2eeRoomState === E2ERoomState.NOT_STARTED ||\\n\\t\\t\\te2eeRoomState === E2ERoomState.DISABLED ||\\n\\t\\t\\te2eeRoomState === E2ERoomState.ERROR ||\\n\\t\\t\\te2eeRoomState === E2ERoomState.WAITING_KEYS\\n\\t\\t) {\\n\\t\\t\\treturn true;\\n\\t\\t}\\n\\n\\t\\treturn false;\\n\\t};\\n\\n\\tconst enabledOnRoom = !!room.encrypted;\\n\\n\\tconst roomType = useMemo(() => getRoomTypeTranslation(room)?.toLowerCase(), [room]);\\n\\n\\tconst roomId = room._id;\\n\\n\\tconst toggleE2E = useEndpoint('POST', '/v1/rooms.saveRoomSettings');\\n\\n\\tconst canResetRoomKey = enabled && isE2EEReady && (room.t === 'd' || permittedToToggleEncryption) && isE2EERoomNotReady();\\n\\n\\tconst action = useEffectEvent(async () => {\\n\\t\\tif (otrState === OtrRoomState.ESTABLISHED || otrState === OtrRoomState.ESTABLISHING || otrState === OtrRoomState.REQUESTED) {\\n\\t\\t\\tdispatchToastMessage({ type: 'error', message: t('E2EE_not_available_OTR') });\\n\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tif (enabledOnRoom) {\\n\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\tcomponent: BaseDisableE2EEModal,\\n\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\tonClose: imperativeModal.close,\\n\\t\\t\\t\\t\\tonConfirm: handleToogleE2E,\\n\\t\\t\\t\\t\\troomType,\\n\\t\\t\\t\\t\\troomId,\\n\\t\\t\\t\\t\\tcanResetRoomKey,\\n\\t\\t\\t\\t},\\n\\t\\t\\t});\\n\\t\\t} else {\\n\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\tcomponent: EnableE2EEModal,\\n\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\tonClose: imperativeModal.close,\\n\\t\\t\\t\\t\\tonConfirm: handleToogleE2E,\\n\\t\\t\\t\\t\\troomType,\\n\\t\\t\\t\\t},\\n\\t\\t\\t});\\n\\t\\t}\\n\\t});\\n\\n\\tconst handleToogleE2E = async () => {\\n\\t\\tconst { success } = await toggleE2E({ rid: room._id, encrypted: !room.encrypted });\\n\\t\\tif (!success) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\timperativeModal.close();\\n\\n\\t\\tdispatchToastMessage({\\n\\t\\t\\ttype: 'success',\\n\\t\\t\\tmessage: room.encrypted\\n\\t\\t\\t\\t? t('E2E_Encryption_disabled_for_room', { roomName: room.name })\\n\\t\\t\\t\\t: t('E2E_Encryption_enabled_for_room', { roomName: room.name }),\\n\\t\\t});\\n\\n\\t\\tif (subscription?.autoTranslate) {\\n\\t\\t\\tdispatchToastMessage({ type: 'success', message: t('AutoTranslate_Disabled_for_room', { roomName: room.name }) });\\n\\t\\t}\\n\\t};\\n\\n\\treturn useMemo((): RoomToolboxActionConfig | undefined => {\\n\\t\\tif (!enabled || !permitted) {\\n\\t\\t\\treturn undefined;\\n\\t\\t}\\n\\n\\t\\treturn {\\n\\t\\t\\tid: 'e2e',\\n\\t\\t\\tgroups: ['direct', 'direct_multiple', 'group', 'team'],\\n\\t\\t\\ttitle: enabledOnRoom ? 'E2E_disable' : 'E2E_enable',\\n\\t\\t\\ticon: 'key',\\n\\t\\t\\torder: 13,\\n\\t\\t\\taction,\\n\\t\\t\\ttype: 'organization',\\n\\t\\t\\t...(federated && {\\n\\t\\t\\t\\ttooltip: t('core.E2E_unavailable_for_federation'),\\n\\t\\t\\t\\tdisabled: true,\\n\\t\\t\\t}),\\n\\t\\t};\\n\\t}, [enabled, permitted, federated, t, enabledOnRoom, action]);\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_objectSpread\",\"_regeneratorRuntime\",\"export\",\"useE2EERoomAction\",\"isRoomFederated\",\"useEffectEvent\",\"useSetting\",\"usePermission\",\"useEndpoint\",\"useMemo\",\"useTranslation\",\"E2EEState\",\"E2ERoomState\",\"OtrRoomState\",\"getRoomTypeTranslation\",\"imperativeModal\",\"dispatchToastMessage\",\"useRoom\",\"useRoomSubscription\",\"useE2EERoomState\",\"useE2EEState\",\"BaseDisableE2EEModal\",\"EnableE2EEModal\",\"useOTR\",\"enabled\",\"room\",\"subscription\",\"e2eeState\",\"e2eeRoomState\",\"_id\",\"isE2EEReady\",\"READY\",\"SAVE_PASSWORD\",\"readyToEncrypt\",\"encrypted\",\"permittedToToggleEncryption\",\"permittedToEditRoom\",\"permitted\",\"t\",\"federated\",\"_useTranslation\",\"otrState\",\"_useOTR\",\"enabledOnRoom\",\"roomType\",\"_getRoomTypeTranslati\",\"toLowerCase\",\"roomId\",\"toggleE2E\",\"canResetRoomKey\",\"NO_PASSWORD_SET\",\"NOT_STARTED\",\"DISABLED\",\"ERROR\",\"WAITING_KEYS\",\"action\",\"async\",\"_context\",\"prev\",\"next\",\"ESTABLISHED\",\"ESTABLISHING\",\"REQUESTED\",\"type\",\"message\",\"abrupt\",\"open\",\"component\",\"props\",\"onClose\",\"close\",\"onConfirm\",\"handleToogleE2E\",\"stop\",\"Promise\",\"_context2\",\"awrap\",\"rid\",\"_await$toggleE2E\",\"sent\",\"success\",\"roomName\",\"name\",\"autoTranslate\",\"id\",\"groups\",\"title\",\"icon\",\"order\",\"tooltip\",\"disabled\"],\"mappings\":\"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\"}"}