{"code":"function module(e,t,n){let a,r,i,o,s,l,u,c,d,g,m,y,k,f,h,p,b,P,C,E,H,S,D,T;n.link(\"@babel/runtime/helpers/extends\",{default(e){a=e}},0),n.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){r=e}},1),n.link(\"@rocket.chat/fuselage\",{Button(e){i=e},ButtonGroup(e){o=e},Pagination(e){s=e}},0),n.link(\"@rocket.chat/ui-contexts\",{useToastMessageDispatch(e){l=e},useRouteParameter(e){u=e},useMethod(e){c=e},useTranslation(e){d=e},useEndpoint(e){g=e},useRouter(e){m=e}},1),n.link(\"@tanstack/react-query\",{useQuery(e){y=e},useQueryClient(e){k=e}},2),n.link(\"react\",{default(e){f=e},useMemo(e){h=e},useState(e){p=e},useEffect(e){b=e}},3),n.link(\"../../../../../../app/utils/client/lib/SDKClient\",{sdk(e){P=e}},4),n.link(\"../../../../../components/CustomScrollbars\",{CustomScrollbars(e){C=e}},5),n.link(\"../../../../../components/GenericTable/hooks/usePagination\",{usePagination(e){E=e}},6),n.link(\"../../../../../components/Page\",{Page(e){H=e},PageHeader(e){S=e},PageContent(e){D=e}},7),n.link(\"./HistoryContent\",{default(e){T=e}},8),n.exportDefault(e=>{let t=l(),n=d(),_=m(),{itemsPerPage:v,setItemsPerPage:x,current:I,setCurrent:Q,itemsPerPageLabel:B,showingResultsLabel:G}=E(),[L,M]=p(!1),[R,j]=p(0),w=c(\"clearIntegrationHistory\"),O=u(\"id\"),q=h(()=>({id:O,count:v,offset:I}),[O,v,I]),K=g(\"GET\",\"/v1/integrations.history\"),W=h(()=>[\"integrations/history\",O,v,I],[O,v,I]),z=k(),{data:A,isLoading:F,refetch:J}=y(W,async()=>{let e=K(q);return M(!0),e},{cacheTime:99999,staleTime:99999}),N=async()=>{try{await w(O),t({type:\"success\",message:n(\"Integration_History_Cleared\")}),J(),M(!1)}catch(e){t({type:\"error\",message:e})}};return b(()=>{if(L)return P.stream(\"integrationHistory\",[O],e=>{if(\"inserted\"===e.type&&(j(e=>e+1),z.setQueryData(W,t=>{if(t&&e.data)return r(r({},t),{},{history:[e.data].concat(t.history),total:t.total+1})})),\"updated\"===e.type){z.setQueryData(W,t=>{if(!t)return;let n=t.history.findIndex(e=>{let{_id:t}=e;return t===O});if(-1!==n)return Object.assign(t.history[n],e.diff),r({},t)});return}\"removed\"===e.type&&J()}).stop},[O,L,z,W,J]),f.createElement(H,a({flexDirection:\"column\"},e),f.createElement(S,{title:n(\"Integration_Outgoing_WebHook_History\"),onClickBack:()=>_.navigate(\"/admin/integrations/edit/outgoing/\".concat(O))},f.createElement(o,null,f.createElement(i,{icon:\"trash\",danger:!0,onClick:N,disabled:0===R},n(\"clear_history\")))),f.createElement(D,null,f.createElement(C,null,f.createElement(T,{key:\"historyContent\",data:(null==A?void 0:A.history)||[],isLoading:F})),f.createElement(s,{current:I,itemsPerPage:v,itemsPerPageLabel:B,showingResultsLabel:G,count:(null==A?void 0:A.total)||0,onSetItemsPerPage:x,onSetCurrent:Q})))})}","map":"{\"version\":3,\"sources\":[\"client/views/admin/integrations/outgoing/history/OutgoingWebhookHistoryPage.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { Button, ButtonGroup, Pagination } from '@rocket.chat/fuselage';\\nimport { useToastMessageDispatch, useRouteParameter, useMethod, useTranslation, useEndpoint, useRouter } from '@rocket.chat/ui-contexts';\\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\\nimport type { ComponentProps } from 'react';\\nimport React, { useMemo, useState, useEffect } from 'react';\\n\\nimport { sdk } from '../../../../../../app/utils/client/lib/SDKClient';\\nimport { CustomScrollbars } from '../../../../../components/CustomScrollbars';\\nimport { usePagination } from '../../../../../components/GenericTable/hooks/usePagination';\\nimport { Page, PageHeader, PageContent } from '../../../../../components/Page';\\nimport HistoryContent from './HistoryContent';\\n\\nconst OutgoingWebhookHistoryPage = (props: ComponentProps<typeof Page>) => {\\n\\tconst dispatchToastMessage = useToastMessageDispatch();\\n\\tconst t = useTranslation();\\n\\tconst router = useRouter();\\n\\n\\tconst { itemsPerPage, setItemsPerPage, current, setCurrent, itemsPerPageLabel, showingResultsLabel } = usePagination();\\n\\n\\tconst [mounted, setMounted] = useState(false);\\n\\tconst [total, setTotal] = useState(0);\\n\\n\\tconst clearIntegrationHistory = useMethod('clearIntegrationHistory');\\n\\n\\tconst id = useRouteParameter('id') as string;\\n\\n\\tconst query = useMemo(\\n\\t\\t() => ({\\n\\t\\t\\tid,\\n\\t\\t\\tcount: itemsPerPage,\\n\\t\\t\\toffset: current,\\n\\t\\t}),\\n\\t\\t[id, itemsPerPage, current],\\n\\t);\\n\\n\\tconst fetchHistory = useEndpoint('GET', '/v1/integrations.history');\\n\\n\\tconst queryKey = useMemo(() => ['integrations/history', id, itemsPerPage, current], [id, itemsPerPage, current]);\\n\\n\\tconst queryClient = useQueryClient();\\n\\n\\ttype HistoryData = Awaited<ReturnType<typeof fetchHistory>>;\\n\\n\\tconst { data, isLoading, refetch } = useQuery(\\n\\t\\tqueryKey,\\n\\t\\tasync () => {\\n\\t\\t\\tconst result = fetchHistory(query);\\n\\t\\t\\tsetMounted(true);\\n\\t\\t\\treturn result;\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tcacheTime: 99999,\\n\\t\\t\\tstaleTime: 99999,\\n\\t\\t},\\n\\t);\\n\\n\\tconst handleClearHistory = async (): Promise<void> => {\\n\\t\\ttry {\\n\\t\\t\\tawait clearIntegrationHistory(id);\\n\\t\\t\\tdispatchToastMessage({ type: 'success', message: t('Integration_History_Cleared') });\\n\\t\\t\\trefetch();\\n\\t\\t\\tsetMounted(false);\\n\\t\\t} catch (e) {\\n\\t\\t\\tdispatchToastMessage({ type: 'error', message: e });\\n\\t\\t}\\n\\t};\\n\\n\\tuseEffect(() => {\\n\\t\\tif (mounted) {\\n\\t\\t\\treturn sdk.stream('integrationHistory', [id], (integration) => {\\n\\t\\t\\t\\tif (integration.type === 'inserted') {\\n\\t\\t\\t\\t\\tsetTotal((total) => total + 1);\\n\\t\\t\\t\\t\\tqueryClient.setQueryData<HistoryData>(queryKey, (oldData): HistoryData | undefined => {\\n\\t\\t\\t\\t\\t\\tif (!oldData || !integration.data) {\\n\\t\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\treturn {\\n\\t\\t\\t\\t\\t\\t\\t...oldData,\\n\\t\\t\\t\\t\\t\\t\\thistory: [integration.data as unknown as HistoryData['history'][number]].concat(oldData.history),\\n\\t\\t\\t\\t\\t\\t\\ttotal: oldData.total + 1,\\n\\t\\t\\t\\t\\t\\t};\\n\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (integration.type === 'updated') {\\n\\t\\t\\t\\t\\tqueryClient.setQueryData<HistoryData>(queryKey, (oldData): HistoryData | undefined => {\\n\\t\\t\\t\\t\\t\\tif (!oldData) {\\n\\t\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\tconst index = oldData.history.findIndex(({ _id }) => _id === id);\\n\\t\\t\\t\\t\\t\\tif (index === -1) {\\n\\t\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\tObject.assign(oldData.history[index], integration.diff);\\n\\t\\t\\t\\t\\t\\treturn { ...oldData };\\n\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (integration.type === 'removed') {\\n\\t\\t\\t\\t\\trefetch();\\n\\t\\t\\t\\t}\\n\\t\\t\\t}).stop;\\n\\t\\t}\\n\\t}, [id, mounted, queryClient, queryKey, refetch]);\\n\\n\\treturn (\\n\\t\\t<Page flexDirection='column' {...props}>\\n\\t\\t\\t<PageHeader\\n\\t\\t\\t\\ttitle={t('Integration_Outgoing_WebHook_History')}\\n\\t\\t\\t\\tonClickBack={() => router.navigate(`/admin/integrations/edit/outgoing/${id}`)}\\n\\t\\t\\t>\\n\\t\\t\\t\\t<ButtonGroup>\\n\\t\\t\\t\\t\\t<Button icon='trash' danger onClick={handleClearHistory} disabled={total === 0}>\\n\\t\\t\\t\\t\\t\\t{t('clear_history')}\\n\\t\\t\\t\\t\\t</Button>\\n\\t\\t\\t\\t</ButtonGroup>\\n\\t\\t\\t</PageHeader>\\n\\t\\t\\t<PageContent>\\n\\t\\t\\t\\t<CustomScrollbars>\\n\\t\\t\\t\\t\\t<HistoryContent key='historyContent' data={data?.history || []} isLoading={isLoading} />\\n\\t\\t\\t\\t</CustomScrollbars>\\n\\t\\t\\t\\t<Pagination\\n\\t\\t\\t\\t\\tcurrent={current}\\n\\t\\t\\t\\t\\titemsPerPage={itemsPerPage}\\n\\t\\t\\t\\t\\titemsPerPageLabel={itemsPerPageLabel}\\n\\t\\t\\t\\t\\tshowingResultsLabel={showingResultsLabel}\\n\\t\\t\\t\\t\\tcount={data?.total || 0}\\n\\t\\t\\t\\t\\tonSetItemsPerPage={setItemsPerPage}\\n\\t\\t\\t\\t\\tonSetCurrent={setCurrent}\\n\\t\\t\\t\\t/>\\n\\t\\t\\t</PageContent>\\n\\t\\t</Page>\\n\\t);\\n};\\n\\nexport default OutgoingWebhookHistoryPage;\\n\",null],\"names\":[\"_extends\",\"_objectSpread\",\"Button\",\"ButtonGroup\",\"Pagination\",\"useToastMessageDispatch\",\"useRouteParameter\",\"useMethod\",\"useTranslation\",\"useEndpoint\",\"useRouter\",\"useQuery\",\"useQueryClient\",\"React\",\"useMemo\",\"useState\",\"useEffect\",\"sdk\",\"CustomScrollbars\",\"usePagination\",\"Page\",\"PageHeader\",\"PageContent\",\"HistoryContent\",\"module\",\"link\",\"default\",\"v\",\"exportDefault\",\"props\",\"dispatchToastMessage\",\"t\",\"router\",\"itemsPerPage\",\"setItemsPerPage\",\"current\",\"setCurrent\",\"itemsPerPageLabel\",\"showingResultsLabel\",\"mounted\",\"setMounted\",\"total\",\"setTotal\",\"clearIntegrationHistory\",\"id\",\"query\",\"count\",\"offset\",\"fetchHistory\",\"queryKey\",\"queryClient\",\"data\",\"isLoading\",\"refetch\",\"result\",\"cacheTime\",\"staleTime\",\"handleClearHistory\",\"type\",\"message\",\"e\",\"stream\",\"integration\",\"setQueryData\",\"oldData\",\"history\",\"concat\",\"index\",\"findIndex\",\"_ref\",\"_id\",\"Object\",\"assign\",\"diff\",\"stop\",\"createElement\",\"flexDirection\",\"title\",\"onClickBack\",\"navigate\",\"icon\",\"danger\",\"onClick\",\"disabled\",\"key\",\"onSetItemsPerPage\",\"onSetCurrent\"],\"mappings\":\"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\"}"}