{"code":"function module(e,t,n){n.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){o=e}},0),n.export({useHasNewMessages:function(){return d}}),n.link(\"@rocket.chat/core-typings\",{isEditedMessage:function(e){i=e}},0),n.link(\"react\",{useCallback:function(e){s=e},useEffect:function(e){r=e},useState:function(e){c=e}},1),n.link(\"../../../../../app/ui-utils/client\",{RoomHistoryManager:function(e){u=e}},2),n.link(\"../../../../../lib/callbacks\",{callbacks:function(e){a=e}},3),n.link(\"../../../../../lib/utils/highOrderFunctions\",{withThrottling:function(e){l=e}},4),n.link(\"../../contexts/ChatContext\",{useChat:function(e){f=e}},5);var o,i,s,r,c,u,a,l,f,d=function(e,t,n,d){var m=d.sendToBottom,h=d.sendToBottomIfNecessary,k=d.isAtBottom,p=f();if(!p)throw Error(\"No ChatContext provided\");var g=c(!1),M=o(g,2),v=M[0],w=M[1],C=s(function(){var e;n.current=!0,h(),w(!1),null===(e=p.composer)||void 0===e||e.focus()},[n,p.composer,h]),b=s(function(){n.current=!0,u.clear(e),u.getMoreIfIsEmpty(e)},[n,e]),N=s(function(){h(),w(!1)},[h]);return r(function(){return a.add(\"streamNewMessage\",function(n){if(!(e!==n.rid||i(n))&&!n.tmid){if(n.u._id===t){m(),w(!1);return}k()||w(!0)}},a.priority.MEDIUM,e),function(){a.remove(\"streamNewMessage\",e)}},[k,e,m,t]),{newMessagesScrollRef:s(function(e){e&&e.addEventListener(\"scroll\",l({wait:100})(function(){n.current&&w(!1)}),{passive:!0})},[n]),handleNewMessageButtonClick:C,handleJumpToRecentButtonClick:b,handleComposerResize:N,hasNewMessages:v}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/body/hooks/useHasNewMessages.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IMessage } from '@rocket.chat/core-typings';\\nimport { isEditedMessage } from '@rocket.chat/core-typings';\\nimport type { MutableRefObject } from 'react';\\nimport { useCallback, useEffect, useState } from 'react';\\n\\nimport { RoomHistoryManager } from '../../../../../app/ui-utils/client';\\nimport { callbacks } from '../../../../../lib/callbacks';\\nimport { withThrottling } from '../../../../../lib/utils/highOrderFunctions';\\nimport { useChat } from '../../contexts/ChatContext';\\n\\nexport const useHasNewMessages = (\\n\\trid: string,\\n\\tuid: string | undefined,\\n\\tatBottomRef: MutableRefObject<boolean>,\\n\\t{\\n\\t\\tsendToBottom,\\n\\t\\tsendToBottomIfNecessary,\\n\\t\\tisAtBottom,\\n\\t}: {\\n\\t\\tsendToBottom: () => void;\\n\\t\\tsendToBottomIfNecessary: () => void;\\n\\t\\tisAtBottom: (threshold?: number) => boolean;\\n\\t},\\n) => {\\n\\tconst chat = useChat();\\n\\n\\tif (!chat) {\\n\\t\\tthrow new Error('No ChatContext provided');\\n\\t}\\n\\n\\tconst [hasNewMessages, setHasNewMessages] = useState(false);\\n\\n\\tconst handleNewMessageButtonClick = useCallback(() => {\\n\\t\\tatBottomRef.current = true;\\n\\t\\tsendToBottomIfNecessary();\\n\\t\\tsetHasNewMessages(false);\\n\\t\\tchat.composer?.focus();\\n\\t}, [atBottomRef, chat.composer, sendToBottomIfNecessary]);\\n\\n\\tconst handleJumpToRecentButtonClick = useCallback(() => {\\n\\t\\tatBottomRef.current = true;\\n\\t\\tRoomHistoryManager.clear(rid);\\n\\t\\tRoomHistoryManager.getMoreIfIsEmpty(rid);\\n\\t}, [atBottomRef, rid]);\\n\\n\\tconst handleComposerResize = useCallback((): void => {\\n\\t\\tsendToBottomIfNecessary();\\n\\t\\tsetHasNewMessages(false);\\n\\t}, [sendToBottomIfNecessary]);\\n\\n\\tuseEffect(() => {\\n\\t\\tcallbacks.add(\\n\\t\\t\\t'streamNewMessage',\\n\\t\\t\\t(msg: IMessage) => {\\n\\t\\t\\t\\tif (rid !== msg.rid || isEditedMessage(msg) || msg.tmid) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (msg.u._id === uid) {\\n\\t\\t\\t\\t\\tsendToBottom();\\n\\t\\t\\t\\t\\tsetHasNewMessages(false);\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (!isAtBottom()) {\\n\\t\\t\\t\\t\\tsetHasNewMessages(true);\\n\\t\\t\\t\\t}\\n\\t\\t\\t},\\n\\t\\t\\tcallbacks.priority.MEDIUM,\\n\\t\\t\\trid,\\n\\t\\t);\\n\\n\\t\\treturn () => {\\n\\t\\t\\tcallbacks.remove('streamNewMessage', rid);\\n\\t\\t};\\n\\t}, [isAtBottom, rid, sendToBottom, uid]);\\n\\n\\tconst ref = useCallback(\\n\\t\\t(node: HTMLElement | null) => {\\n\\t\\t\\tif (!node) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tnode.addEventListener(\\n\\t\\t\\t\\t'scroll',\\n\\t\\t\\t\\twithThrottling({ wait: 100 })(() => {\\n\\t\\t\\t\\t\\tatBottomRef.current && setHasNewMessages(false);\\n\\t\\t\\t\\t}),\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\tpassive: true,\\n\\t\\t\\t\\t},\\n\\t\\t\\t);\\n\\t\\t},\\n\\t\\t[atBottomRef],\\n\\t);\\n\\n\\treturn {\\n\\t\\tnewMessagesScrollRef: ref,\\n\\t\\thandleNewMessageButtonClick,\\n\\t\\thandleJumpToRecentButtonClick,\\n\\t\\thandleComposerResize,\\n\\t\\thasNewMessages,\\n\\t};\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_slicedToArray\",\"export\",\"useHasNewMessages\",\"isEditedMessage\",\"useCallback\",\"useEffect\",\"useState\",\"RoomHistoryManager\",\"callbacks\",\"withThrottling\",\"useChat\",\"rid\",\"uid\",\"atBottomRef\",\"_ref\",\"sendToBottom\",\"sendToBottomIfNecessary\",\"isAtBottom\",\"chat\",\"Error\",\"_useState\",\"_useState2\",\"hasNewMessages\",\"setHasNewMessages\",\"handleNewMessageButtonClick\",\"_chat$composer\",\"current\",\"composer\",\"focus\",\"handleJumpToRecentButtonClick\",\"clear\",\"getMoreIfIsEmpty\",\"handleComposerResize\",\"add\",\"msg\",\"tmid\",\"u\",\"_id\",\"priority\",\"MEDIUM\",\"remove\",\"newMessagesScrollRef\",\"node\",\"addEventListener\",\"wait\",\"passive\"],\"mappings\":\"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\"}"}