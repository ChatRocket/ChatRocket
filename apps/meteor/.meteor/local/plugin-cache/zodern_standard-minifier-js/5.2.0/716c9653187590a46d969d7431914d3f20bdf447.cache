{"code":"function module(e,n,t){t.link(\"@babel/runtime/regenerator\",{default:function(e){r=e}},0),t.link(\"@babel/runtime/helpers/inheritsLoose\",{default:function(e){a=e}},1),t.export({RealAppsEngineUIHost:function(){return f}}),t.link(\"@rocket.chat/apps-engine/client/AppsEngineUIHost\",{AppsEngineUIHost:function(e){i=e}},0),t.link(\"meteor/meteor\",{Meteor:function(e){s=e}},1),t.link(\"../../app/models/client\",{ChatRoom:function(e){o=e}},2),t.link(\"../../app/utils/client/getUserAvatarURL\",{getUserAvatarURL:function(e){u=e}},3),t.link(\"../../app/utils/client/lib/SDKClient\",{sdk:function(e){l=e}},4),t.link(\"../lib/RoomManager\",{RoomManager:function(e){c=e}},5),t.link(\"../lib/baseURI\",{baseURI:function(e){p=e}},6);var r,a,i,s,o,u,l,c,p,f=function(e){function n(){var n;return(n=e.call(this)||this)._baseURL=void 0,n._baseURL=p.replace(/\\/$/,\"\"),n}a(n,e);var t=n.prototype;return t.getUserAvatarUrl=function(e){var n=u(e);return n.startsWith(\"http\")||n.startsWith(\"data\")?n:\"\"+this._baseURL+n},t.getClientRoomInfo=function(){var e,n,t,a,i=this;return r.async(function(s){for(;;)switch(s.prev=s.next){case 0:return n=(e=o.findOne(c.opened)).name,t=e._id,a=[],s.prev=2,s.next=5,r.awrap(l.rest.get(\"/v1/groups.members\",{roomId:t}));case 5:a=s.sent.members.map(function(e){var n=e._id,t=e.username;return{id:n,username:t,avatarUrl:i.getUserAvatarUrl(t)}}),s.next=13;break;case 10:s.prev=10,s.t0=s.catch(2),console.warn(s.t0);case 13:return s.abrupt(\"return\",{id:t,slugifiedName:n,members:a});case 14:case\"end\":return s.stop()}},null,null,[[2,10]],Promise)},t.getClientUserInfo=function(){var e,n,t;return r.async(function(r){for(;;)switch(r.prev=r.next){case 0:return n=(e=s.user()).username,t=e._id,r.abrupt(\"return\",{id:t,username:n,avatarUrl:this.getUserAvatarUrl(n)||\"\"});case 2:case\"end\":return r.stop()}},null,this,null,Promise)},n}(i)}","map":"{\"version\":3,\"sources\":[\"client/apps/RealAppsEngineUIHost.ts\",\"<anon>\"],\"sourcesContent\":[\"import { AppsEngineUIHost } from '@rocket.chat/apps-engine/client/AppsEngineUIHost';\\nimport type { IExternalComponentRoomInfo, IExternalComponentUserInfo } from '@rocket.chat/apps-engine/client/definition';\\nimport { Meteor } from 'meteor/meteor';\\n\\nimport { ChatRoom } from '../../app/models/client';\\nimport { getUserAvatarURL } from '../../app/utils/client/getUserAvatarURL';\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\nimport { RoomManager } from '../lib/RoomManager';\\nimport { baseURI } from '../lib/baseURI';\\n\\n// FIXME: replace non-null assertions with proper error handling\\n\\nexport class RealAppsEngineUIHost extends AppsEngineUIHost {\\n\\tprivate _baseURL: string;\\n\\n\\tconstructor() {\\n\\t\\tsuper();\\n\\n\\t\\tthis._baseURL = baseURI.replace(/\\\\/$/, '');\\n\\t}\\n\\n\\tprivate getUserAvatarUrl(username: string) {\\n\\t\\tconst avatarUrl = getUserAvatarURL(username)!;\\n\\n\\t\\tif (!avatarUrl.startsWith('http') && !avatarUrl.startsWith('data')) {\\n\\t\\t\\treturn `${this._baseURL}${avatarUrl}`;\\n\\t\\t}\\n\\n\\t\\treturn avatarUrl;\\n\\t}\\n\\n\\tasync getClientRoomInfo(): Promise<IExternalComponentRoomInfo> {\\n\\t\\tconst { name: slugifiedName, _id: id } = ChatRoom.findOne(RoomManager.opened)!;\\n\\n\\t\\tlet cachedMembers: IExternalComponentUserInfo[] = [];\\n\\t\\ttry {\\n\\t\\t\\tconst { members } = await sdk.rest.get('/v1/groups.members', { roomId: id });\\n\\n\\t\\t\\tcachedMembers = members.map(\\n\\t\\t\\t\\t({ _id, username }): IExternalComponentUserInfo => ({\\n\\t\\t\\t\\t\\tid: _id,\\n\\t\\t\\t\\t\\tusername: username!,\\n\\t\\t\\t\\t\\tavatarUrl: this.getUserAvatarUrl(username!),\\n\\t\\t\\t\\t}),\\n\\t\\t\\t);\\n\\t\\t} catch (error) {\\n\\t\\t\\tconsole.warn(error);\\n\\t\\t}\\n\\n\\t\\treturn {\\n\\t\\t\\tid,\\n\\t\\t\\tslugifiedName: slugifiedName!,\\n\\t\\t\\tmembers: cachedMembers,\\n\\t\\t};\\n\\t}\\n\\n\\tasync getClientUserInfo(): Promise<IExternalComponentUserInfo> {\\n\\t\\tconst { username, _id } = Meteor.user()!;\\n\\n\\t\\treturn {\\n\\t\\t\\tid: _id,\\n\\t\\t\\tusername: username!,\\n\\t\\t\\tavatarUrl: this.getUserAvatarUrl(username!) || '',\\n\\t\\t};\\n\\t}\\n}\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"_inheritsLoose\",\"export\",\"RealAppsEngineUIHost\",\"AppsEngineUIHost\",\"Meteor\",\"ChatRoom\",\"getUserAvatarURL\",\"sdk\",\"RoomManager\",\"baseURI\",\"_AppsEngineUIHost\",\"_this\",\"call\",\"_baseURL\",\"replace\",\"_proto\",\"prototype\",\"getUserAvatarUrl\",\"username\",\"avatarUrl\",\"startsWith\",\"getClientRoomInfo\",\"_ChatRoom$findOne\",\"slugifiedName\",\"id\",\"cachedMembers\",\"_this2\",\"async\",\"_context\",\"prev\",\"next\",\"findOne\",\"opened\",\"name\",\"_id\",\"awrap\",\"rest\",\"get\",\"roomId\",\"members\",\"_await$sdk$rest$get\",\"sent\",\"map\",\"_ref\",\"t0\",\"console\",\"warn\",\"abrupt\",\"stop\",\"Promise\",\"getClientUserInfo\",\"_Meteor$user\",\"_context2\",\"user\"],\"mappings\":\"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\"}"}