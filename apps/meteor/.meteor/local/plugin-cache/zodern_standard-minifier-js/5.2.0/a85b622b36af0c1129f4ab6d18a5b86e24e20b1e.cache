{"code":"function module(e,t,l){let s,n,i,o,r;l.export({useMessageDeletionIsAllowed:()=>u}),l.link(\"@rocket.chat/ui-contexts\",{useSetting(e){s=e},usePermission(e){n=e}},0),l.link(\"react\",{useMemo(e){i=e}},1),l.link(\"../lib/getDifference\",{getDifference(e){o=e},MINUTES(e){r=e}},2);let u=(e,t,l)=>{let u=n(\"force-delete-message\",e),a=s(\"Message_AllowDeleting\"),d=n(\"delete-message\",e),g=n(\"delete-own-message\"),c=n(\"bypass-time-limit-edit-and-delete\",e),f=s(\"Message_AllowDeleting_BlockDeleteInMinutes\"),m=i(()=>!!u||!!a&&(!!d||!!g)&&(!!d||t.userId===l)&&(e=>{if(!c&&0!==f){if(!e.uploadedAt||!f)return!1;let t=o(new Date,new Date(e.uploadedAt),r);return t<f}return!0})(t),[u,a,d,g,f,c,t,l]);return m}}","map":"{\"version\":3,\"sources\":[\"client/views/room/contextualBar/RoomFiles/hooks/useMessageDeletionIsAllowed.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom, IUser, IUpload } from '@rocket.chat/core-typings';\\nimport { useSetting, usePermission } from '@rocket.chat/ui-contexts';\\nimport { useMemo } from 'react';\\n\\nimport { getDifference, MINUTES } from '../lib/getDifference';\\n\\nexport const useMessageDeletionIsAllowed = (rid: IRoom['_id'], file: IUpload, uid: IUser['_id'] | null) => {\\n\\tconst canForceDelete = usePermission('force-delete-message', rid);\\n\\tconst deletionIsEnabled = useSetting('Message_AllowDeleting');\\n\\tconst userHasPermissionToDeleteAny = usePermission('delete-message', rid);\\n\\tconst userHasPermissionToDeleteOwn = usePermission('delete-own-message');\\n\\tconst bypassBlockTimeLimit = usePermission('bypass-time-limit-edit-and-delete', rid);\\n\\tconst blockDeleteInMinutes = useSetting<number>('Message_AllowDeleting_BlockDeleteInMinutes');\\n\\n\\tconst isDeletionAllowed = useMemo(() => {\\n\\t\\tif (canForceDelete) {\\n\\t\\t\\treturn true;\\n\\t\\t}\\n\\n\\t\\tif (!deletionIsEnabled) {\\n\\t\\t\\treturn false;\\n\\t\\t}\\n\\n\\t\\tif (!userHasPermissionToDeleteAny && !userHasPermissionToDeleteOwn) {\\n\\t\\t\\treturn false;\\n\\t\\t}\\n\\n\\t\\tconst checkTimeframe = (file: IUpload) => {\\n\\t\\t\\tif (!bypassBlockTimeLimit && blockDeleteInMinutes !== 0) {\\n\\t\\t\\t\\tif (!file.uploadedAt || !blockDeleteInMinutes) {\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tconst currentTsDiff = getDifference(new Date(), new Date(file.uploadedAt), MINUTES);\\n\\t\\t\\t\\treturn currentTsDiff < blockDeleteInMinutes;\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn true;\\n\\t\\t};\\n\\n\\t\\tconst isUserOwnFile = (file: IUpload) => file.userId === uid;\\n\\n\\t\\tif (userHasPermissionToDeleteAny || isUserOwnFile(file)) {\\n\\t\\t\\treturn checkTimeframe(file);\\n\\t\\t}\\n\\n\\t\\treturn false;\\n\\t}, [\\n\\t\\tcanForceDelete,\\n\\t\\tdeletionIsEnabled,\\n\\t\\tuserHasPermissionToDeleteAny,\\n\\t\\tuserHasPermissionToDeleteOwn,\\n\\t\\tblockDeleteInMinutes,\\n\\t\\tbypassBlockTimeLimit,\\n\\t\\tfile,\\n\\t\\tuid,\\n\\t]);\\n\\n\\treturn isDeletionAllowed;\\n};\\n\",null],\"names\":[\"useSetting\",\"usePermission\",\"useMemo\",\"getDifference\",\"MINUTES\",\"module\",\"export\",\"useMessageDeletionIsAllowed\",\"link\",\"v\",\"rid\",\"file\",\"uid\",\"canForceDelete\",\"deletionIsEnabled\",\"userHasPermissionToDeleteAny\",\"userHasPermissionToDeleteOwn\",\"bypassBlockTimeLimit\",\"blockDeleteInMinutes\",\"isDeletionAllowed\",\"userId\",\"checkTimeframe\",\"uploadedAt\",\"currentTsDiff\",\"Date\"],\"mappings\":\"2BACqEA,EAAAC,EAAAC,EAAAC,EAAAC,EAArEC,EAAOC,MAAE,CAAA,CAAAC,4BAAiCA,IAAAA,CAA2B,GAAAF,EAAAG,IAAA,CAAA,2BAAA,CAAAR,WAAAS,CAAA,EAAAT,EAAAS,CAAA,EAAAR,cAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,QAAA,CAAAN,QAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,uBAAA,CAAAL,cAAAM,CAAA,EAAAN,EAAAM,CAAA,EAAAL,QAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAK9D,IAAMF,EAA8BA,CAACG,EAAmBC,EAAeC,KAC7E,IAAMC,EAAiBZ,EAAc,uBAAwBS,GACvDI,EAAoBd,EAAW,yBAC/Be,EAA+Bd,EAAc,iBAAkBS,GAC/DM,EAA+Bf,EAAc,sBAC7CgB,EAAuBhB,EAAc,oCAAqCS,GAC1EQ,EAAuBlB,EAAmB,8CAE1CmB,EAAoBjB,EAAQ,IACjC,EAAIW,KAICC,GAID,CAAA,EAACC,KAAiCC,CAAAA,GAmBlCD,CAAAA,EAAAA,GAFqCJ,AAESA,EAFJS,MAAM,GAAKR,CAEH,GAC9CS,AAhBgBV,CAAAA,IACvB,GAAI,CAACM,GAAwBC,AAAyB,IAAzBA,EAA4B,CACxD,GAAI,CAACP,EAAKW,UAAU,EAAI,CAACJ,EACxB,MAAO,CAAA,EAGR,IAAMK,EAAgBpB,EAAc,IAAIqB,KAAQ,IAAIA,KAAKb,EAAKW,UAAU,EAAGlB,GAC3E,OAAOmB,EAAgBL,CACxB,CAEA,MAAO,CAAA,CACR,CAAA,EAKuBP,GAIrB,CACFE,EACAC,EACAC,EACAC,EACAE,EACAD,EACAN,EACAC,EACA,EAED,OAAOO,CACR\"}"}