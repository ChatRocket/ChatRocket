{"code":"function module(e,n,t){var r,i,u,c,l,a,o,s,f,d,m,k,b,p,v,x,h,E,g,_,F,S,T,q=[\"control\",\"trigger\",\"index\",\"disabled\"];t.link(\"@babel/runtime/regenerator\",{default:function(e){r=e}},0),t.link(\"@babel/runtime/helpers/extends\",{default:function(e){i=e}},1),t.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){u=e}},2),t.link(\"@babel/runtime/helpers/objectWithoutProperties\",{default:function(e){c=e}},3),t.export({ActionExternalServiceUrl:function(){return y}}),t.link(\"@rocket.chat/fuselage\",{Box:function(e){l=e},Button:function(e){a=e},Field:function(e){o=e},FieldError:function(e){s=e},FieldHint:function(e){f=e},FieldLabel:function(e){d=e},FieldRow:function(e){m=e},Icon:function(e){k=e},TextInput:function(e){b=e}},0),t.link(\"@rocket.chat/fuselage-hooks\",{useSafely:function(e){p=e},useUniqueId:function(e){v=e}},1),t.link(\"@rocket.chat/ui-contexts\",{useEndpoint:function(e){x=e}},2),t.link(\"@tanstack/react-query\",{useMutation:function(e){h=e}},3),t.link(\"react\",{default:function(e){E=e},useState:function(e){g=e}},4),t.link(\"react-hook-form\",{Controller:function(e){_=e},useWatch:function(e){F=e}},5),t.link(\"react-i18next\",{useTranslation:function(e){S=e}},6),t.link(\"../hooks\",{useFieldError:function(e){T=e}},7);var y=function(e){var n=e.control,t=e.trigger,y=e.index,w=e.disabled,A=c(e,q),U=S().t,I=v(),L=\"actions.\"+y+\".params.serviceUrl\",P=\"actions.\"+y+\".params.serviceTimeout\",B=F({control:n,name:P}),C=T({control:n,name:L}),M=u(C,1)[0],R=p(g(!1)),W=u(R,2),j=W[0],z=W[1],D=x(\"POST\",\"/v1/livechat/triggers/external-service/test\"),H=h({mutationFn:D,onSuccess:function(){z(!0),setTimeout(function(){return z(!1)},3e3)}});return E.createElement(o,A,E.createElement(d,{required:!0,htmlFor:I},U(\"External_service_url\")),E.createElement(m,null,E.createElement(_,{name:L,control:n,defaultValue:\"\",rules:{required:U(\"Required_field\",{field:U(\"External_service_url\")}),validate:function(e){return r.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt(\"return\",!0);case 2:return n.prev=2,n.next=5,r.awrap(H.mutateAsync({webhookUrl:e,timeout:B||1e4,fallbackMessage:\"\",extraData:[]}));case 5:return n.abrupt(\"return\",!0);case 8:return n.prev=8,n.t0=n.catch(2),n.abrupt(\"return\",U(n.t0.error));case 11:case\"end\":return n.stop()}},null,null,[[2,8]],Promise)},deps:P},render:function(e){var n=e.field;return E.createElement(b,i({},n,{disabled:H.isLoading||w,error:null==M?void 0:M.message}))}})),M&&E.createElement(s,null,M.message),E.createElement(f,null,U(\"External_service_test_hint\")),E.createElement(a,{loading:H.isLoading,disabled:w||j,onClick:function(){return t(L)}},j?E.createElement(l,{is:\"span\",color:\"status-font-on-success\"},E.createElement(k,{name:\"success-circle\",size:\"x20\",verticalAlign:\"middle\"}),\" \",U(\"Success\"),\"!\"):U(\"Send_Test\")))}}","map":"{\"version\":3,\"sources\":[\"client/views/omnichannel/triggers/actions/ActionExternalServiceUrl.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { Box, Button, Field, FieldError, FieldHint, FieldLabel, FieldRow, Icon, TextInput } from '@rocket.chat/fuselage';\\nimport { useSafely, useUniqueId } from '@rocket.chat/fuselage-hooks';\\nimport type { TranslationKey } from '@rocket.chat/ui-contexts';\\nimport { useEndpoint } from '@rocket.chat/ui-contexts';\\nimport { useMutation } from '@tanstack/react-query';\\nimport type { ComponentProps } from 'react';\\nimport React, { useState } from 'react';\\nimport type { Control, UseFormTrigger } from 'react-hook-form';\\nimport { Controller, useWatch } from 'react-hook-form';\\nimport { useTranslation } from 'react-i18next';\\n\\nimport type { TriggersPayload } from '../EditTrigger';\\nimport { useFieldError } from '../hooks';\\n\\ntype ActionExternaServicelUrlType = ComponentProps<typeof Field> & {\\n\\tindex: number;\\n\\tcontrol: Control<TriggersPayload>;\\n\\ttrigger: UseFormTrigger<TriggersPayload>;\\n\\tdisabled?: boolean;\\n};\\n\\nexport const ActionExternalServiceUrl = ({ control, trigger, index, disabled, ...props }: ActionExternaServicelUrlType) => {\\n\\tconst { t } = useTranslation();\\n\\n\\tconst serviceUrlFieldId = useUniqueId();\\n\\tconst serviceUrlFieldName = `actions.${index}.params.serviceUrl` as const;\\n\\tconst serviceTimeoutFieldName = `actions.${index}.params.serviceTimeout` as const;\\n\\n\\tconst serviceTimeoutValue = useWatch({ control, name: serviceTimeoutFieldName });\\n\\tconst [serviceUrlError] = useFieldError({ control, name: serviceUrlFieldName });\\n\\tconst [isSuccessMessageVisible, setSuccessMessageVisible] = useSafely(useState(false));\\n\\tconst webhookTestEndpoint = useEndpoint('POST', '/v1/livechat/triggers/external-service/test');\\n\\n\\tconst showSuccessMesssage = () => {\\n\\t\\tsetSuccessMessageVisible(true);\\n\\t\\tsetTimeout(() => setSuccessMessageVisible(false), 3000);\\n\\t};\\n\\n\\tconst webhookTest = useMutation({\\n\\t\\tmutationFn: webhookTestEndpoint,\\n\\t\\tonSuccess: showSuccessMesssage,\\n\\t});\\n\\n\\tconst testExternalService = async (serviceUrl: string) => {\\n\\t\\tif (!serviceUrl) {\\n\\t\\t\\treturn true;\\n\\t\\t}\\n\\n\\t\\ttry {\\n\\t\\t\\tawait webhookTest.mutateAsync({\\n\\t\\t\\t\\twebhookUrl: serviceUrl,\\n\\t\\t\\t\\ttimeout: serviceTimeoutValue || 10000,\\n\\t\\t\\t\\tfallbackMessage: '',\\n\\t\\t\\t\\textraData: [],\\n\\t\\t\\t});\\n\\t\\t\\treturn true;\\n\\t\\t} catch (e) {\\n\\t\\t\\treturn t((e as { error: TranslationKey }).error);\\n\\t\\t}\\n\\t};\\n\\n\\treturn (\\n\\t\\t<Field {...props}>\\n\\t\\t\\t<FieldLabel required htmlFor={serviceUrlFieldId}>\\n\\t\\t\\t\\t{t('External_service_url')}\\n\\t\\t\\t</FieldLabel>\\n\\t\\t\\t<FieldRow>\\n\\t\\t\\t\\t<Controller\\n\\t\\t\\t\\t\\tname={serviceUrlFieldName}\\n\\t\\t\\t\\t\\tcontrol={control}\\n\\t\\t\\t\\t\\tdefaultValue=''\\n\\t\\t\\t\\t\\trules={{\\n\\t\\t\\t\\t\\t\\trequired: t('Required_field', { field: t('External_service_url') }),\\n\\t\\t\\t\\t\\t\\tvalidate: testExternalService,\\n\\t\\t\\t\\t\\t\\tdeps: serviceTimeoutFieldName,\\n\\t\\t\\t\\t\\t}}\\n\\t\\t\\t\\t\\trender={({ field }) => {\\n\\t\\t\\t\\t\\t\\treturn <TextInput {...field} disabled={webhookTest.isLoading || disabled} error={serviceUrlError?.message} />;\\n\\t\\t\\t\\t\\t}}\\n\\t\\t\\t\\t/>\\n\\t\\t\\t</FieldRow>\\n\\n\\t\\t\\t{serviceUrlError && <FieldError>{serviceUrlError.message}</FieldError>}\\n\\n\\t\\t\\t<FieldHint>{t('External_service_test_hint')}</FieldHint>\\n\\n\\t\\t\\t<Button loading={webhookTest.isLoading} disabled={disabled || isSuccessMessageVisible} onClick={() => trigger(serviceUrlFieldName)}>\\n\\t\\t\\t\\t{isSuccessMessageVisible ? (\\n\\t\\t\\t\\t\\t<Box is='span' color='status-font-on-success'>\\n\\t\\t\\t\\t\\t\\t<Icon name='success-circle' size='x20' verticalAlign='middle' /> {t('Success')}!\\n\\t\\t\\t\\t\\t</Box>\\n\\t\\t\\t\\t) : (\\n\\t\\t\\t\\t\\tt('Send_Test')\\n\\t\\t\\t\\t)}\\n\\t\\t\\t</Button>\\n\\t\\t</Field>\\n\\t);\\n};\\n\",null],\"names\":[\"_regeneratorRuntime\",\"_extends\",\"_slicedToArray\",\"_objectWithoutProperties\",\"Box\",\"Button\",\"Field\",\"FieldError\",\"FieldHint\",\"FieldLabel\",\"FieldRow\",\"Icon\",\"TextInput\",\"useSafely\",\"useUniqueId\",\"useEndpoint\",\"useMutation\",\"React\",\"useState\",\"Controller\",\"useWatch\",\"useTranslation\",\"useFieldError\",\"module\",\"link\",\"default\",\"v\",\"export\",\"ActionExternalServiceUrl\",\"_ref\",\"control\",\"trigger\",\"index\",\"disabled\",\"props\",\"_excluded\",\"t\",\"_useTranslation\",\"serviceUrlFieldId\",\"serviceUrlFieldName\",\"serviceTimeoutFieldName\",\"serviceTimeoutValue\",\"name\",\"_useFieldError\",\"serviceUrlError\",\"_useFieldError2\",\"_useSafely\",\"_useSafely2\",\"isSuccessMessageVisible\",\"setSuccessMessageVisible\",\"webhookTestEndpoint\",\"webhookTest\",\"mutationFn\",\"onSuccess\",\"setTimeout\",\"createElement\",\"required\",\"htmlFor\",\"defaultValue\",\"rules\",\"field\",\"validate\",\"serviceUrl\",\"async\",\"_context\",\"prev\",\"next\",\"abrupt\",\"awrap\",\"mutateAsync\",\"webhookUrl\",\"timeout\",\"fallbackMessage\",\"extraData\",\"t0\",\"error\",\"stop\",\"Promise\",\"deps\",\"render\",\"_ref2\",\"isLoading\",\"message\",\"loading\",\"onClick\",\"is\",\"color\",\"size\",\"verticalAlign\"],\"mappings\":\"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\"}"}