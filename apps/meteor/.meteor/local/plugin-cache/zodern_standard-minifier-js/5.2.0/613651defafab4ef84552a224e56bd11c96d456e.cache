{"code":"function module(e,r,n){let t,o,l,s,u,i;n.export({usersFromRoomMessages:()=>a}),n.link(\"meteor/meteor\",{Meteor(e){t=e}},0),n.link(\"meteor/mongo\",{Mongo(e){o=e}},1),n.link(\"meteor/tracker\",{Tracker(e){l=e}},2),n.link(\"../../../../client/lib/RoomManager\",{RoomManager(e){s=e}},3),n.link(\"../../../../client/lib/tracker\",{asReactiveSource(e){u=e}},4),n.link(\"../../../models/client\",{Messages(e){i=e}},5);let a=new o.Collection(null);t.startup(()=>{l.autorun(()=>{let e=t.userId(),r=u(e=>s.on(\"changed\",e),()=>s.opened),n=e?t.users.findOne(e,{fields:{username:1}}):void 0;if(!r||!n)return;a.remove({});let o={};i.find({rid:r,\"u.username\":{$ne:n.username},t:{$exists:!1}},{fields:{\"u.username\":1,\"u.name\":1,\"u._id\":1,ts:1},sort:{ts:-1}}).fetch().filter(e=>{let{u:{username:r}}=e,n=!o[r];return o[r]=!0,n}).forEach(e=>{let{u:{username:r,name:n,_id:t},ts:o}=e;return a.upsert(t,{_id:t,username:r,name:n,ts:o})})})})}","map":"{\"version\":3,\"sources\":[\"app/ui-message/client/popup/messagePopupConfig.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IUser } from '@rocket.chat/core-typings';\\nimport { Meteor } from 'meteor/meteor';\\nimport { Mongo } from 'meteor/mongo';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { RoomManager } from '../../../../client/lib/RoomManager';\\nimport { asReactiveSource } from '../../../../client/lib/tracker';\\nimport { Messages } from '../../../models/client';\\n\\nexport const usersFromRoomMessages = new Mongo.Collection<{\\n\\t_id: string;\\n\\tusername: string;\\n\\tname: string | undefined;\\n\\tts: Date;\\n\\tsuggestion?: boolean;\\n}>(null);\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(() => {\\n\\t\\tconst uid = Meteor.userId();\\n\\t\\tconst rid = asReactiveSource(\\n\\t\\t\\t(cb) => RoomManager.on('changed', cb),\\n\\t\\t\\t() => RoomManager.opened,\\n\\t\\t);\\n\\t\\tconst user = uid ? (Meteor.users.findOne(uid, { fields: { username: 1 } }) as IUser | undefined) : undefined;\\n\\t\\tif (!rid || !user) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tusersFromRoomMessages.remove({});\\n\\n\\t\\tconst uniqueMessageUsersControl: Record<string, boolean> = {};\\n\\n\\t\\tMessages.find(\\n\\t\\t\\t{\\n\\t\\t\\t\\trid,\\n\\t\\t\\t\\t'u.username': { $ne: user.username },\\n\\t\\t\\t\\t't': { $exists: false },\\n\\t\\t\\t},\\n\\t\\t\\t{\\n\\t\\t\\t\\tfields: {\\n\\t\\t\\t\\t\\t'u.username': 1,\\n\\t\\t\\t\\t\\t'u.name': 1,\\n\\t\\t\\t\\t\\t'u._id': 1,\\n\\t\\t\\t\\t\\t'ts': 1,\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\tsort: { ts: -1 },\\n\\t\\t\\t},\\n\\t\\t)\\n\\t\\t\\t.fetch()\\n\\t\\t\\t.filter(({ u: { username } }) => {\\n\\t\\t\\t\\tconst notMapped = !uniqueMessageUsersControl[username];\\n\\t\\t\\t\\tuniqueMessageUsersControl[username] = true;\\n\\t\\t\\t\\treturn notMapped;\\n\\t\\t\\t})\\n\\t\\t\\t.forEach(({ u: { username, name, _id }, ts }) =>\\n\\t\\t\\t\\tusersFromRoomMessages.upsert(_id, {\\n\\t\\t\\t\\t\\t_id,\\n\\t\\t\\t\\t\\tusername,\\n\\t\\t\\t\\t\\tname,\\n\\t\\t\\t\\t\\tts,\\n\\t\\t\\t\\t}),\\n\\t\\t\\t);\\n\\t});\\n});\\n\",null],\"names\":[\"Meteor\",\"Mongo\",\"Tracker\",\"RoomManager\",\"asReactiveSource\",\"Messages\",\"module\",\"export\",\"usersFromRoomMessages\",\"link\",\"v\",\"Collection\",\"startup\",\"autorun\",\"uid\",\"userId\",\"rid\",\"cb\",\"on\",\"opened\",\"user\",\"users\",\"findOne\",\"fields\",\"username\",\"undefined\",\"remove\",\"uniqueMessageUsersControl\",\"find\",\"$ne\",\"$exists\",\"sort\",\"ts\",\"fetch\",\"filter\",\"_ref\",\"u\",\"notMapped\",\"forEach\",\"_ref2\",\"name\",\"_id\",\"upsert\"],\"mappings\":\"2BACuCA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAvCC,EAAOC,MAAE,CAAA,CAAMC,sBAAQA,IAAgBA,CAAA,GAAAF,EAAAG,IAAA,CAAA,gBAAA,CAAAT,OAAAU,CAAA,EAAAV,EAAAU,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,eAAA,CAAAR,MAAAS,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,iBAAA,CAAAP,QAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,qCAAA,CAAAN,YAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,iCAAA,CAAAL,iBAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,yBAAA,CAAAJ,SAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAQhC,IAAMF,EAAwB,IAAIP,EAAMU,UAAU,CAMtD,MAEHX,EAAOY,OAAO,CAAC,KACdV,EAAQW,OAAO,CAAC,KACf,IAAMC,EAAMd,EAAOe,MAAM,GACnBC,EAAMZ,EACVa,GAAOd,EAAYe,EAAE,CAAC,UAAWD,GAClC,IAAMd,EAAYgB,MAAM,EAEnBC,EAAON,EAAOd,EAAOqB,KAAK,CAACC,OAAO,CAACR,EAAK,CAAES,OAAQ,CAAEC,SAAU,CAAC,CAAE,GAA4BC,KAAAA,EACnG,GAAI,CAACT,GAAO,CAACI,EACZ,OAGDZ,EAAsBkB,MAAM,CAAC,CAAA,GAE7B,IAAMC,EAAqD,CAAA,EAE3DtB,EAASuB,IAAI,CACZ,CACCZ,IAAAA,EACA,aAAc,CAAEa,IAAKT,EAAKI,QAAAA,AAAQ,EAClC,EAAK,CAAEM,QAAS,CAAA,CAAK,GAEtB,CACCP,OAAQ,CACP,aAAc,EACd,SAAU,EACV,QAAS,EACT,GAAM,GAEPQ,KAAM,CAAEC,GAAI,EAAE,IAGdC,KAAK,GACLC,MAAM,CAACC,IAAwB,GAAvB,CAAEC,EAAG,CAAEZ,SAAAA,CAAAA,CAAQ,CAAI,CAAAW,EACrBE,EAAY,CAACV,CAAyB,CAACH,EAAS,CAEtD,OADAG,CAAyB,CAACH,EAAS,CAAG,CAAA,EAC/Ba,CACR,GACCC,OAAO,CAACC,IAAA,GAAC,CAAEH,EAAG,CAAEZ,SAAAA,CAAQ,CAAEgB,KAAAA,CAAI,CAAEC,IAAAA,CAAAA,CAAK,CAAET,GAAAA,CAAAA,CAAI,CAAAO,EAAA,OAC3C/B,EAAsBkC,MAAM,CAACD,EAAK,CACjCA,IAAAA,EACAjB,SAAAA,EACAgB,KAAAA,EACAR,GAAAA,GACC,EAEL,EACD\"}"}