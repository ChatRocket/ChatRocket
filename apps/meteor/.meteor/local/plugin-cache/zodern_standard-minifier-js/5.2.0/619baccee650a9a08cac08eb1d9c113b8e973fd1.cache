{"code":"function module(e,t,s){let n,i,a,l,p,r,d;s.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){n=e}},0),s.export({useAppInfo:()=>o}),s.link(\"@rocket.chat/ui-contexts\",{useEndpoint(e){i=e}},0),s.link(\"react\",{useState(e){a=e},useEffect(e){l=e},useContext(e){p=e}},1),s.link(\"../../../apps/orchestrator\",{AppClientOrchestratorInstance(e){r=e}},2),s.link(\"../../../contexts/AppsContext\",{AppsContext(e){d=e}},3);let u=async e=>{let{bundledIn:t=[]}=e;return Promise.all(t.map(async e=>{let t=await r.getAppsOnBundle(e.bundleId);return e.apps=t.slice(0,4),e}))},o=(e,t)=>{var s;let{installedApps:r,marketplaceApps:o,privateApps:c}=p(d),[v,h]=a(),k=i(\"GET\",\"/apps/:id/settings\",{id:e}),f=i(\"GET\",\"/apps/:id/screenshots\",{id:e}),g=i(\"GET\",\"/apps/:id/apis\",{id:e}),m=i(\"GET\",\"/apps/:id\",{id:e});return l(()=>{let s=async()=>{var s,i,a,l,p,d,v;let x;if(!(null!==(s=o.value)&&void 0!==s&&null!==(i=s.apps)&&void 0!==i&&i.length)&&!(null!==(a=r.value)&&void 0!==a&&a.apps.length)&&!(null!==(l=c.value)&&void 0!==l&&l.apps.length)||!e||([\"explore\",\"premium\",\"requested\"].includes(t)&&(x=null===(p=o.value)||void 0===p?void 0:p.apps.find(t=>t.id===e)),\"private\"===t&&(x=null===(d=c.value)||void 0===d?void 0:d.apps.find(t=>t.id===e)),\"installed\"===t&&(x=null===(v=r.value)||void 0===v?void 0:v.apps.find(t=>t.id===e)),!x))return;let[E,b,y,A]=await Promise.all([k().catch(()=>({settings:{}})),g().catch(()=>({apis:[]})),f().catch(()=>({screenshots:[]})),!1===x.marketplace?[]:m({marketplace:\"true\",update:\"true\",appVersion:e}).then(e=>{let{app:t}=e;return x.tosLink=t.tosLink,x.privacyLink=t.privacyLink,u(t)}).catch(()=>({settings:{}}))]);h(n(n({},x),{},{bundledIn:A,settings:E.settings,apis:b?b.apis:[],screenshots:y?y.screenshots:[]}))};s()},[e,t,g,m,f,k,r,o,null===(s=c.value)||void 0===s?void 0:s.apps]),v}}","map":"{\"version\":3,\"sources\":[\"client/views/marketplace/hooks/useAppInfo.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { App } from '@rocket.chat/core-typings';\\nimport { useEndpoint } from '@rocket.chat/ui-contexts';\\nimport { useState, useEffect, useContext } from 'react';\\n\\nimport type { ISettings } from '../../../apps/@types/IOrchestrator';\\nimport { AppClientOrchestratorInstance } from '../../../apps/orchestrator';\\nimport { AppsContext } from '../../../contexts/AppsContext';\\nimport type { AppInfo } from '../definitions/AppInfo';\\n\\nconst getBundledInApp = async (app: App): Promise<App['bundledIn']> => {\\n\\tconst { bundledIn = [] } = app;\\n\\n\\treturn Promise.all(\\n\\t\\tbundledIn.map(async (bundle) => {\\n\\t\\t\\tconst apps = await AppClientOrchestratorInstance.getAppsOnBundle(bundle.bundleId);\\n\\t\\t\\tbundle.apps = apps.slice(0, 4);\\n\\t\\t\\treturn bundle;\\n\\t\\t}),\\n\\t);\\n};\\n\\nexport const useAppInfo = (appId: string, context: string): AppInfo | undefined => {\\n\\tconst { installedApps, marketplaceApps, privateApps } = useContext(AppsContext);\\n\\n\\tconst [appData, setAppData] = useState<AppInfo>();\\n\\n\\tconst getSettings = useEndpoint('GET', '/apps/:id/settings', { id: appId });\\n\\tconst getScreenshots = useEndpoint('GET', '/apps/:id/screenshots', { id: appId });\\n\\tconst getApis = useEndpoint('GET', '/apps/:id/apis', { id: appId });\\n\\tconst getBundledIn = useEndpoint('GET', '/apps/:id', { id: appId });\\n\\n\\tuseEffect(() => {\\n\\t\\tconst fetchAppInfo = async (): Promise<void> => {\\n\\t\\t\\tif ((!marketplaceApps.value?.apps?.length && !installedApps.value?.apps.length && !privateApps.value?.apps.length) || !appId) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tlet appResult: App | undefined;\\n\\t\\t\\tconst marketplaceAppsContexts = ['explore', 'premium', 'requested'];\\n\\n\\t\\t\\tif (marketplaceAppsContexts.includes(context)) appResult = marketplaceApps.value?.apps.find((app) => app.id === appId);\\n\\n\\t\\t\\tif (context === 'private') appResult = privateApps.value?.apps.find((app) => app.id === appId);\\n\\n\\t\\t\\tif (context === 'installed') appResult = installedApps.value?.apps.find((app) => app.id === appId);\\n\\n\\t\\t\\tif (!appResult) return;\\n\\n\\t\\t\\tconst [settings, apis, screenshots, bundledIn] = await Promise.all([\\n\\t\\t\\t\\tgetSettings().catch(() => ({\\n\\t\\t\\t\\t\\tsettings: {},\\n\\t\\t\\t\\t})),\\n\\t\\t\\t\\tgetApis().catch(() => ({\\n\\t\\t\\t\\t\\tapis: [],\\n\\t\\t\\t\\t})),\\n\\t\\t\\t\\tgetScreenshots().catch(() => ({\\n\\t\\t\\t\\t\\tscreenshots: [],\\n\\t\\t\\t\\t})),\\n\\t\\t\\t\\tappResult.marketplace === false\\n\\t\\t\\t\\t\\t? []\\n\\t\\t\\t\\t\\t: getBundledIn({\\n\\t\\t\\t\\t\\t\\t\\tmarketplace: 'true',\\n\\t\\t\\t\\t\\t\\t\\tupdate: 'true',\\n\\t\\t\\t\\t\\t\\t\\tappVersion: appId,\\n\\t\\t\\t\\t\\t  })\\n\\t\\t\\t\\t\\t\\t\\t.then(({ app }: any) => {\\n\\t\\t\\t\\t\\t\\t\\t\\t(appResult as App).tosLink = app.tosLink;\\n\\t\\t\\t\\t\\t\\t\\t\\t(appResult as App).privacyLink = app.privacyLink;\\n\\t\\t\\t\\t\\t\\t\\t\\treturn getBundledInApp(app);\\n\\t\\t\\t\\t\\t\\t\\t})\\n\\t\\t\\t\\t\\t\\t\\t.catch(() => ({\\n\\t\\t\\t\\t\\t\\t\\t\\tsettings: {},\\n\\t\\t\\t\\t\\t\\t\\t})),\\n\\t\\t\\t]);\\n\\n\\t\\t\\tsetAppData({\\n\\t\\t\\t\\t...appResult,\\n\\t\\t\\t\\tbundledIn: bundledIn as App['bundledIn'],\\n\\t\\t\\t\\tsettings: settings.settings as ISettings,\\n\\t\\t\\t\\tapis: apis ? apis.apis : [],\\n\\t\\t\\t\\tscreenshots: screenshots ? screenshots.screenshots : [],\\n\\t\\t\\t});\\n\\t\\t};\\n\\n\\t\\tfetchAppInfo();\\n\\t}, [appId, context, getApis, getBundledIn, getScreenshots, getSettings, installedApps, marketplaceApps, privateApps.value?.apps]);\\n\\n\\treturn appData;\\n};\\n\",null],\"names\":[\"_objectSpread\",\"useEndpoint\",\"useState\",\"useEffect\",\"useContext\",\"AppClientOrchestratorInstance\",\"AppsContext\",\"module\",\"link\",\"default\",\"v\",\"export\",\"useAppInfo\",\"getBundledInApp\",\"app\",\"bundledIn\",\"Promise\",\"all\",\"map\",\"bundle\",\"apps\",\"getAppsOnBundle\",\"bundleId\",\"slice\",\"appId\",\"context\",\"_privateApps$value3\",\"installedApps\",\"marketplaceApps\",\"privateApps\",\"appData\",\"setAppData\",\"getSettings\",\"id\",\"getScreenshots\",\"getApis\",\"getBundledIn\",\"fetchAppInfo\",\"_marketplaceApps$valu\",\"_marketplaceApps$valu2\",\"_installedApps$value\",\"_privateApps$value\",\"_marketplaceApps$valu3\",\"_privateApps$value2\",\"_installedApps$value2\",\"appResult\",\"value\",\"length\",\"marketplaceAppsContexts\",\"includes\",\"find\",\"settings\",\"apis\",\"screenshots\",\"catch\",\"marketplace\",\"update\",\"appVersion\",\"then\",\"_ref\",\"tosLink\",\"privacyLink\"],\"mappings\":\"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\"}"}