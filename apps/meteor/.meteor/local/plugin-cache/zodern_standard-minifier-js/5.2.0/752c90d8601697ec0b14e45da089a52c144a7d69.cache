{"code":"function module(e,t,n){let o,a,l,s,i;n.export({processTooLongMessage:()=>r}),n.link(\"../../../../app/settings/client\",{settings(e){o=e}},0),n.link(\"../../../../app/utils/lib/i18n\",{t(e){a=e}},1),n.link(\"../../../components/GenericModal\",{default(e){l=e}},2),n.link(\"../../imperativeModal\",{imperativeModal(e){s=e}},3),n.link(\"../../toast\",{dispatchToastMessage(e){i=e}},4);let r=async(e,t)=>{let{msg:n}=t,r=o.get(\"Message_MaxAllowedSize\");if(n.length<=r)return!1;let c=o.get(\"FileUpload_Enabled\"),p=o.get(\"Message_AllowConvertLongMessagesToAttachment\");if(e.currentEditing||!c||!p){var d;return i({type:\"error\",message:Error(a(\"Message_too_long\"))}),null===(d=e.composer)||void 0===d||d.setText(n),!0}return await new Promise(t=>{let o=async()=>{var o,a;let l=\"text/plain\",i=new Blob([n],{type:l}),r=\"\".concat(null!==(o=null===(a=Meteor.user())||void 0===a?void 0:a.username)&&void 0!==o?o:\"anonymous\",\" - \").concat(new Date,\".txt\"),c=new File([i],r,{type:l,lastModified:Date.now()});s.close(),await e.flows.uploadFiles([c]),t()},i=()=>{var o;null===(o=e.composer)||void 0===o||o.setText(n),s.close(),t()};s.open({component:l,props:{title:a(\"Message_too_long\"),children:a(\"Send_it_as_attachment_instead_question\"),onConfirm:o,onClose:i,onCancel:i,variant:\"warning\"}})}),!0}}","map":"{\"version\":3,\"sources\":[\"client/lib/chats/flows/processTooLongMessage.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IMessage } from '@rocket.chat/core-typings';\\n\\nimport { settings } from '../../../../app/settings/client';\\nimport { t } from '../../../../app/utils/lib/i18n';\\nimport GenericModal from '../../../components/GenericModal';\\nimport { imperativeModal } from '../../imperativeModal';\\nimport { dispatchToastMessage } from '../../toast';\\nimport type { ChatAPI } from '../ChatAPI';\\n\\nexport const processTooLongMessage = async (chat: ChatAPI, { msg }: Pick<IMessage, 'msg'>): Promise<boolean> => {\\n\\tconst maxAllowedSize = settings.get('Message_MaxAllowedSize');\\n\\n\\tif (msg.length <= maxAllowedSize) {\\n\\t\\treturn false;\\n\\t}\\n\\tconst fileUploadsEnabled = settings.get('FileUpload_Enabled');\\n\\tconst convertLongMessagesToAttachment = settings.get('Message_AllowConvertLongMessagesToAttachment');\\n\\n\\tif (chat.currentEditing || !fileUploadsEnabled || !convertLongMessagesToAttachment) {\\n\\t\\tdispatchToastMessage({ type: 'error', message: new Error(t('Message_too_long')) });\\n\\t\\tchat.composer?.setText(msg);\\n\\t\\treturn true;\\n\\t}\\n\\n\\tawait new Promise<void>((resolve) => {\\n\\t\\tconst onConfirm = async (): Promise<void> => {\\n\\t\\t\\tconst contentType = 'text/plain';\\n\\t\\t\\tconst messageBlob = new Blob([msg], { type: contentType });\\n\\t\\t\\tconst fileName = `${Meteor.user()?.username ?? 'anonymous'} - ${new Date()}.txt`; // TODO: proper naming and formatting\\n\\t\\t\\tconst file = new File([messageBlob], fileName, {\\n\\t\\t\\t\\ttype: contentType,\\n\\t\\t\\t\\tlastModified: Date.now(),\\n\\t\\t\\t});\\n\\n\\t\\t\\timperativeModal.close();\\n\\t\\t\\tawait chat.flows.uploadFiles([file]);\\n\\n\\t\\t\\tresolve();\\n\\t\\t};\\n\\n\\t\\tconst onClose = (): void => {\\n\\t\\t\\tchat.composer?.setText(msg);\\n\\n\\t\\t\\timperativeModal.close();\\n\\t\\t\\tresolve();\\n\\t\\t};\\n\\n\\t\\timperativeModal.open({\\n\\t\\t\\tcomponent: GenericModal,\\n\\t\\t\\tprops: {\\n\\t\\t\\t\\ttitle: t('Message_too_long'),\\n\\t\\t\\t\\tchildren: t('Send_it_as_attachment_instead_question'),\\n\\t\\t\\t\\tonConfirm,\\n\\t\\t\\t\\tonClose,\\n\\t\\t\\t\\tonCancel: onClose,\\n\\t\\t\\t\\tvariant: 'warning',\\n\\t\\t\\t},\\n\\t\\t});\\n\\t});\\n\\n\\treturn true;\\n};\\n\",null],\"names\":[\"settings\",\"t\",\"GenericModal\",\"imperativeModal\",\"dispatchToastMessage\",\"module\",\"export\",\"processTooLongMessage\",\"link\",\"v\",\"default\",\"chat\",\"_ref\",\"msg\",\"maxAllowedSize\",\"get\",\"length\",\"fileUploadsEnabled\",\"convertLongMessagesToAttachment\",\"currentEditing\",\"_chat$composer\",\"type\",\"message\",\"Error\",\"composer\",\"setText\",\"Promise\",\"resolve\",\"onConfirm\",\"_Meteor$user$username\",\"_Meteor$user\",\"contentType\",\"messageBlob\",\"Blob\",\"fileName\",\"concat\",\"Meteor\",\"user\",\"username\",\"Date\",\"file\",\"File\",\"lastModified\",\"now\",\"close\",\"flows\",\"uploadFiles\",\"onClose\",\"_chat$composer2\",\"open\",\"component\",\"props\",\"title\",\"children\",\"onCancel\",\"variant\"],\"mappings\":\"2BAE2DA,EAAAC,EAAAC,EAAAC,EAAAC,EAA3DC,EAAOC,MAAE,CAAA,CAAAC,sBAAgBA,IAAAA,CAAkC,GAAAF,EAAAG,IAAA,CAAA,kCAAA,CAAAR,SAAAS,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,iCAAA,CAAAP,EAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,mCAAA,CAAAE,QAAAD,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,wBAAA,CAAAL,gBAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,cAAA,CAAAJ,qBAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAOpD,IAAMF,EAAwB,MAAOI,EAAaC,KAAsD,GAApD,CAAEC,IAAAA,CAAAA,CAA4B,CAAAD,EAClFE,EAAiBd,EAASe,GAAG,CAAC,0BAEpC,GAAIF,EAAIG,MAAM,EAAIF,EACjB,MAAO,CAAA,EAER,IAAMG,EAAqBjB,EAASe,GAAG,CAAC,sBAClCG,EAAkClB,EAASe,GAAG,CAAC,gDAErD,GAAIJ,EAAKQ,cAAc,EAAI,CAACF,GAAsB,CAACC,EAAiC,CAAA,IAAAE,EAGnF,OAFAhB,EAAqB,CAAEiB,KAAM,QAASC,QAAS,AAAIC,MAAMtB,EAAE,oBAAoB,GAC/E,AAAa,OAAbmB,CAAAA,EAAAT,EAAKa,QAAQ,AAARA,GAAQJ,AAAA,KAAA,IAAAA,GAAbA,EAAeK,OAAO,CAACZ,GAChB,CAAA,CACR,CAsCA,OApCA,MAAM,IAAIa,QAAeC,IACxB,IAAMC,EAAY,UAA0B,IAAAC,EAAAC,EAC3C,IAAMC,EAAc,aACdC,EAAc,IAAIC,KAAK,CAACpB,EAAI,CAAE,CAAEQ,KAAMU,CAAW,GACjDG,EAAQ,GAAAC,MAAA,CAAA,AAA6B,OAA7BN,CAAAA,EAAA,AAAmB,OAAnBC,CAAAA,EAAMM,OAAOC,IAAI,EAAA,GAAEP,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAbA,EAAeQ,QAAQ,AAARA,GAAQT,AAAA,KAAA,IAAAA,EAAAA,EAAI,YAAW,OAAAM,MAAA,CAAM,IAAII,KAAM,QACpEC,EAAO,IAAIC,KAAK,CAACT,EAAY,CAAEE,EAAU,CAC9Cb,KAAMU,EACNW,aAAcH,KAAKI,GAAG,KAGvBxC,EAAgByC,KAAK,GACrB,MAAMjC,EAAKkC,KAAK,CAACC,WAAW,CAAC,CAACN,EAAK,EAEnCb,GACD,EAEMoB,EAAUA,KAAW,IAAAC,CAC1B,AAAa,QAAbA,CAAAA,EAAArC,EAAKa,QAAQ,AAARA,GAAQwB,AAAA,KAAA,IAAAA,GAAbA,EAAevB,OAAO,CAACZ,GAEvBV,EAAgByC,KAAK,GACrBjB,GACD,EAEAxB,EAAgB8C,IAAI,CAAC,CACpBC,UAAWhD,EACXiD,MAAO,CACNC,MAAOnD,EAAE,oBACToD,SAAUpD,EAAE,0CACZ2B,UAAAA,EACAmB,QAAAA,EACAO,SAAUP,EACVQ,QAAS,YAGZ,GAEO,CAAA,CACR\"}"}