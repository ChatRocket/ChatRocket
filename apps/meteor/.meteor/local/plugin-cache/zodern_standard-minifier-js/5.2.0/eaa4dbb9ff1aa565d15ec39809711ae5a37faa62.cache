{"code":"function module(e,t,a){let n,i,s,l,o,r,u,g,d,c,m,h;a.link(\"meteor/meteor\",{Meteor(e){n=e}},0),a.link(\"meteor/tracker\",{Tracker(e){i=e}},1),a.link(\"../../../../client/lib/rooms/roomCoordinator\",{roomCoordinator(e){s=e}},2),a.link(\"../../../../client/lib/utils/messageArgs\",{messageArgs(e){l=e}},3),a.link(\"../../../../client/views/room/MessageList/lib/autoTranslate\",{hasTranslationLanguageInAttachments(e){o=e},hasTranslationLanguageInMessage(e){r=e}},4),a.link(\"../../../authorization/client\",{hasAtLeastOnePermission(e){u=e}},5),a.link(\"../../../models/client\",{Messages(e){g=e}},6),a.link(\"../../../settings/client\",{settings(e){d=e}},7),a.link(\"../../../ui-utils/client/lib/MessageAction\",{MessageAction(e){c=e}},8),a.link(\"../../../utils/client/lib/SDKClient\",{sdk(e){m=e}},9),a.link(\"./autotranslate\",{AutoTranslate(e){h=e}},10),n.startup(()=>{h.init(),i.autorun(()=>{d.get(\"AutoTranslate_Enabled\")&&u([\"auto-translate\"])?(c.addButton({id:\"translate\",icon:\"language\",label:\"Translate\",context:[\"message\",\"message-mobile\",\"threads\"],type:\"interaction\",action(e,t){let{message:a=l(this).msg}=t,n=h.getLanguage(a.rid);r(a,n)||o(a.attachments,n)||(h.messageIdsToWait[a._id]=!0,g.update({_id:a._id},{$set:{autoTranslateFetching:!0}}),m.call(\"autoTranslate.translateMessage\",a,n));let i=\"autoTranslateShowInverse\"in a?\"$unset\":\"$set\";g.update({_id:a._id},{[i]:{autoTranslateShowInverse:!0}})},condition(e){let{message:t,subscription:a,user:n,room:i}=e;if(!n)return!1;let l=(null==a?void 0:a.autoTranslateLanguage)||h.getLanguage(t.rid)||\"\",u=s.isLivechatRoom(null==i?void 0:i.t),g=(null==t?void 0:t.u)&&t.u._id!==n._id,d=(null==a?void 0:a.autoTranslate)||u,c=r(t,l)||o(t.attachments,l);return!!(t.autoTranslateShowInverse||g&&d&&!c)},order:90}),c.addButton({id:\"view-original\",icon:\"language\",label:\"View_original\",context:[\"message\",\"message-mobile\",\"threads\"],type:\"interaction\",action(e,t){let{message:a=l(this).msg}=t,n=h.getLanguage(a.rid);r(a,n)||o(a.attachments,n)||(h.messageIdsToWait[a._id]=!0,g.update({_id:a._id},{$set:{autoTranslateFetching:!0}}),m.call(\"autoTranslate.translateMessage\",a,n));let i=\"autoTranslateShowInverse\"in a?\"$unset\":\"$set\";g.update({_id:a._id},{[i]:{autoTranslateShowInverse:!0}})},condition(e){let{message:t,subscription:a,user:n,room:i}=e,l=(null==a?void 0:a.autoTranslateLanguage)||h.getLanguage(t.rid)||\"\",u=s.isLivechatRoom(null==i?void 0:i.t);if(!n)return!1;let g=(null==t?void 0:t.u)&&t.u._id!==n._id,d=(null==a?void 0:a.autoTranslate)||u,c=r(t,l)||o(t.attachments,l);return!!(!t.autoTranslateShowInverse&&g&&d&&c)},order:90})):c.removeButton(\"toggle-language\")})})}","map":"{\"version\":3,\"sources\":[\"app/autotranslate/client/lib/actionButton.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { roomCoordinator } from '../../../../client/lib/rooms/roomCoordinator';\\nimport { messageArgs } from '../../../../client/lib/utils/messageArgs';\\nimport {\\n\\thasTranslationLanguageInAttachments,\\n\\thasTranslationLanguageInMessage,\\n} from '../../../../client/views/room/MessageList/lib/autoTranslate';\\nimport { hasAtLeastOnePermission } from '../../../authorization/client';\\nimport { Messages } from '../../../models/client';\\nimport { settings } from '../../../settings/client';\\nimport { MessageAction } from '../../../ui-utils/client/lib/MessageAction';\\nimport { sdk } from '../../../utils/client/lib/SDKClient';\\nimport { AutoTranslate } from './autotranslate';\\n\\nMeteor.startup(() => {\\n\\tAutoTranslate.init();\\n\\n\\tTracker.autorun(() => {\\n\\t\\tif (settings.get('AutoTranslate_Enabled') && hasAtLeastOnePermission(['auto-translate'])) {\\n\\t\\t\\tMessageAction.addButton({\\n\\t\\t\\t\\tid: 'translate',\\n\\t\\t\\t\\ticon: 'language',\\n\\t\\t\\t\\tlabel: 'Translate',\\n\\t\\t\\t\\tcontext: ['message', 'message-mobile', 'threads'],\\n\\t\\t\\t\\ttype: 'interaction',\\n\\t\\t\\t\\taction(_, props) {\\n\\t\\t\\t\\t\\tconst { message = messageArgs(this).msg } = props;\\n\\t\\t\\t\\t\\tconst language = AutoTranslate.getLanguage(message.rid);\\n\\t\\t\\t\\t\\tif (!hasTranslationLanguageInMessage(message, language) && !hasTranslationLanguageInAttachments(message.attachments, language)) {\\n\\t\\t\\t\\t\\t\\t(AutoTranslate.messageIdsToWait as any)[message._id] = true;\\n\\t\\t\\t\\t\\t\\tMessages.update({ _id: message._id }, { $set: { autoTranslateFetching: true } });\\n\\t\\t\\t\\t\\t\\tvoid sdk.call('autoTranslate.translateMessage', message, language);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tconst action = 'autoTranslateShowInverse' in message ? '$unset' : '$set';\\n\\t\\t\\t\\t\\tMessages.update({ _id: message._id }, { [action]: { autoTranslateShowInverse: true } });\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\tcondition({ message, subscription, user, room }) {\\n\\t\\t\\t\\t\\tif (!user) {\\n\\t\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tconst language = subscription?.autoTranslateLanguage || AutoTranslate.getLanguage(message.rid) || '';\\n\\t\\t\\t\\t\\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room?.t);\\n\\t\\t\\t\\t\\tconst isDifferentUser = message?.u && message.u._id !== user._id;\\n\\t\\t\\t\\t\\tconst autoTranslateEnabled = subscription?.autoTranslate || isLivechatRoom;\\n\\t\\t\\t\\t\\tconst hasLanguage =\\n\\t\\t\\t\\t\\t\\thasTranslationLanguageInMessage(message, language) || hasTranslationLanguageInAttachments(message.attachments, language);\\n\\n\\t\\t\\t\\t\\treturn Boolean(\\n\\t\\t\\t\\t\\t\\t(message as { autoTranslateShowInverse?: boolean }).autoTranslateShowInverse ||\\n\\t\\t\\t\\t\\t\\t\\t(isDifferentUser && autoTranslateEnabled && !hasLanguage),\\n\\t\\t\\t\\t\\t);\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\torder: 90,\\n\\t\\t\\t});\\n\\t\\t\\tMessageAction.addButton({\\n\\t\\t\\t\\tid: 'view-original',\\n\\t\\t\\t\\ticon: 'language',\\n\\t\\t\\t\\tlabel: 'View_original',\\n\\t\\t\\t\\tcontext: ['message', 'message-mobile', 'threads'],\\n\\t\\t\\t\\ttype: 'interaction',\\n\\t\\t\\t\\taction(_, props) {\\n\\t\\t\\t\\t\\tconst { message = messageArgs(this).msg } = props;\\n\\t\\t\\t\\t\\tconst language = AutoTranslate.getLanguage(message.rid);\\n\\t\\t\\t\\t\\tif (!hasTranslationLanguageInMessage(message, language) && !hasTranslationLanguageInAttachments(message.attachments, language)) {\\n\\t\\t\\t\\t\\t\\t(AutoTranslate.messageIdsToWait as any)[message._id] = true;\\n\\t\\t\\t\\t\\t\\tMessages.update({ _id: message._id }, { $set: { autoTranslateFetching: true } });\\n\\t\\t\\t\\t\\t\\tvoid sdk.call('autoTranslate.translateMessage', message, language);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tconst action = 'autoTranslateShowInverse' in message ? '$unset' : '$set';\\n\\t\\t\\t\\t\\tMessages.update({ _id: message._id }, { [action]: { autoTranslateShowInverse: true } });\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\tcondition({ message, subscription, user, room }) {\\n\\t\\t\\t\\t\\tconst language = subscription?.autoTranslateLanguage || AutoTranslate.getLanguage(message.rid) || '';\\n\\t\\t\\t\\t\\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room?.t);\\n\\t\\t\\t\\t\\tif (!user) {\\n\\t\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tconst isDifferentUser = message?.u && message.u._id !== user._id;\\n\\t\\t\\t\\t\\tconst autoTranslateEnabled = subscription?.autoTranslate || isLivechatRoom;\\n\\t\\t\\t\\t\\tconst hasLanguage =\\n\\t\\t\\t\\t\\t\\thasTranslationLanguageInMessage(message, language) || hasTranslationLanguageInAttachments(message.attachments, language);\\n\\n\\t\\t\\t\\t\\treturn Boolean(\\n\\t\\t\\t\\t\\t\\t!(message as { autoTranslateShowInverse?: boolean }).autoTranslateShowInverse &&\\n\\t\\t\\t\\t\\t\\t\\tisDifferentUser &&\\n\\t\\t\\t\\t\\t\\t\\tautoTranslateEnabled &&\\n\\t\\t\\t\\t\\t\\t\\thasLanguage,\\n\\t\\t\\t\\t\\t);\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\torder: 90,\\n\\t\\t\\t});\\n\\t\\t} else {\\n\\t\\t\\tMessageAction.removeButton('toggle-language');\\n\\t\\t}\\n\\t});\\n});\\n\",null],\"names\":[\"Meteor\",\"Tracker\",\"roomCoordinator\",\"messageArgs\",\"hasTranslationLanguageInAttachments\",\"hasTranslationLanguageInMessage\",\"hasAtLeastOnePermission\",\"Messages\",\"settings\",\"MessageAction\",\"sdk\",\"AutoTranslate\",\"module\",\"link\",\"v\",\"startup\",\"init\",\"autorun\",\"get\",\"addButton\",\"id\",\"icon\",\"label\",\"context\",\"type\",\"action\",\"_\",\"props\",\"message\",\"msg\",\"language\",\"getLanguage\",\"rid\",\"attachments\",\"messageIdsToWait\",\"_id\",\"update\",\"$set\",\"autoTranslateFetching\",\"call\",\"autoTranslateShowInverse\",\"condition\",\"_ref\",\"subscription\",\"user\",\"room\",\"autoTranslateLanguage\",\"isLivechatRoom\",\"t\",\"isDifferentUser\",\"u\",\"autoTranslateEnabled\",\"autoTranslate\",\"hasLanguage\",\"Boolean\",\"order\",\"_ref2\",\"removeButton\"],\"mappings\":\"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\"}"}