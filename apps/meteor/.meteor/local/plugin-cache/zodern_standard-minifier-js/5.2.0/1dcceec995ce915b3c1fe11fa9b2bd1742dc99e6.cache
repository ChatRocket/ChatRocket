{"code":"function module(t,e,n){var i,o,s;n.link(\"meteor/meteor\",{Meteor:function(t){i=t}},0),n.link(\"../../app/models/client\",{ChatMessage:function(t){o=t}},1),n.link(\"../../app/ui-utils/client\",{LegacyRoomManager:function(t){s=t}},2),i.startup(function(){o.find().observe({removed:function(t){if(s.getOpenedRoomByRid(t.rid)){var e=o.findOne({ts:{$lt:t.ts}},{sort:{ts:-1}});e&&o.update({_id:e._id},{$set:{tick:new Date}});var n=o.findOne({ts:{$gt:t.ts}},{sort:{ts:1}});if(n)return o.update({_id:n._id},{$set:{tick:new Date}})}}})})}","map":"{\"version\":3,\"sources\":[\"client/startup/messageObserve.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\n\\nimport { ChatMessage } from '../../app/models/client';\\nimport { LegacyRoomManager } from '../../app/ui-utils/client';\\n\\nMeteor.startup(() => {\\n\\tChatMessage.find().observe({\\n\\t\\tremoved(record) {\\n\\t\\t\\tif (!LegacyRoomManager.getOpenedRoomByRid(record.rid)) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst recordBefore = ChatMessage.findOne({ ts: { $lt: record.ts } }, { sort: { ts: -1 } });\\n\\t\\t\\tif (recordBefore) {\\n\\t\\t\\t\\tChatMessage.update({ _id: recordBefore._id }, { $set: { tick: new Date() } });\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst recordAfter = ChatMessage.findOne({ ts: { $gt: record.ts } }, { sort: { ts: 1 } });\\n\\t\\t\\tif (recordAfter) {\\n\\t\\t\\t\\treturn ChatMessage.update({ _id: recordAfter._id }, { $set: { tick: new Date() } });\\n\\t\\t\\t}\\n\\t\\t},\\n\\t});\\n});\\n\",null],\"names\":[\"Meteor\",\"ChatMessage\",\"LegacyRoomManager\",\"module\",\"link\",\"v\",\"startup\",\"find\",\"observe\",\"removed\",\"record\",\"getOpenedRoomByRid\",\"rid\",\"recordBefore\",\"findOne\",\"ts\",\"$lt\",\"sort\",\"update\",\"_id\",\"$set\",\"tick\",\"Date\",\"recordAfter\",\"$gt\"],\"mappings\":\"2BAAAA,EAAuCC,EAAAC,EAA9BC,EAAQC,IAAA,CAAM,gBAAgB,CAAAJ,OAAA,SAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,0BAAA,CAAAH,YAAA,SAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,4BAAA,CAAAF,kBAAA,SAAAG,CAAA,EAAAH,EAAAG,CAAA,CAAA,EAAA,GAKvCL,EAAOM,OAAO,CAAC,WACdL,EAAYM,IAAI,GAAGC,OAAO,CAAC,CAC1BC,QAAO,SAACC,CAAM,EACb,GAAKR,EAAkBS,kBAAkB,CAACD,EAAOE,GAAG,GAIpD,IAAMC,EAAeZ,EAAYa,OAAO,CAAC,CAAEC,GAAI,CAAEC,IAAKN,EAAOK,EAAAA,AAAE,CAAE,EAAI,CAAEE,KAAM,CAAEF,GAAI,EAAE,CAAE,GACnFF,GACHZ,EAAYiB,MAAM,CAAC,CAAEC,IAAKN,EAAaM,GAAAA,AAAG,EAAI,CAAEC,KAAM,CAAEC,KAAM,IAAIC,IAAM,CAAE,GAG3E,IAAMC,EAActB,EAAYa,OAAO,CAAC,CAAEC,GAAI,CAAES,IAAKd,EAAOK,EAAAA,AAAE,CAAE,EAAI,CAAEE,KAAM,CAAEF,GAAI,CAAC,CAAE,GACrF,GAAIQ,EACH,OAAOtB,EAAYiB,MAAM,CAAC,CAAEC,IAAKI,EAAYJ,GAAAA,AAAG,EAAI,CAAEC,KAAM,CAAEC,KAAM,IAAIC,IAAM,CAAE,GAElF,GAEF\"}"}