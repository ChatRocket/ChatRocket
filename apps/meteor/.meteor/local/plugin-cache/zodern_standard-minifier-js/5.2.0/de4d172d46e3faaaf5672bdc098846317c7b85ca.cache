{"code":"function module(n,t,o){o.export({useApplyButtonFilters:function(){return p},useApplyButtonAuthFilter:function(){return C}}),o.link(\"@rocket.chat/apps-engine/definition/ui\",{RoomTypeFilter:function(n){i=n}},0),o.link(\"@rocket.chat/core-typings\",{isDirectMessageRoom:function(n){u=n},isMultipleDirectMessageRoom:function(n){r=n},isOmnichannelRoom:function(n){s=n},isPrivateDiscussion:function(n){c=n},isPrivateTeamRoom:function(n){l=n},isPublicDiscussion:function(n){a=n},isPublicTeamRoom:function(n){f=n}},1),o.link(\"@rocket.chat/ui-contexts\",{AuthorizationContext:function(n){m=n},useUserId:function(n){v=n}},2),o.link(\"react\",{useCallback:function(n){A=n},useContext:function(n){R=n}},3),o.link(\"../views/room/contexts/RoomContext\",{useRoom:function(n){d=n}},4);var e,i,u,r,s,c,l,a,f,m,v,A,R,d,I=((e={})[i.PUBLIC_CHANNEL]=function(n){return\"c\"===n.t},e[i.PRIVATE_CHANNEL]=function(n){return\"p\"===n.t},e[i.PUBLIC_TEAM]=f,e[i.PRIVATE_TEAM]=l,e[i.PUBLIC_DISCUSSION]=a,e[i.PRIVATE_DISCUSSION]=c,e[i.DIRECT]=u,e[i.DIRECT_MULTIPLE]=r,e[i.LIVE_CHAT]=s,e),P=function(n,t){var o=(n.when||{}).roomTypes;return!o||o.some(function(n){var o;return null===(o=I[n])||void 0===o?void 0:o.call(I,t)})},h=function(n,t){var o=n.category;return\"default\"===t?!o||\"default\"===o:o===t},p=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"default\",t=d();if(!t)throw Error(\"useApplyButtonFilters must be used inside a room context\");var o=C();return A(function(e){return o(e)&&(!t||P(e,t))&&h(e,n)},[o,n,t])},C=function(){var n=v(),t=R(m),o=t.queryAllPermissions,e=t.queryAtLeastOnePermission,i=t.queryRole;return A(function(t,u){var r=t.when||{},s=r.hasAllPermissions,c=r.hasOnePermission,l=r.hasAllRoles,a=r.hasOneRole,f=!s||o(s)[1](),m=!c||e(c)[1](),v=!l||!!n&&l.every(function(n){return i(n,null==u?void 0:u._id)}),A=!a||!!n&&a.some(function(n){return i(n,null==u?void 0:u._id)[1]()});return f&&m&&v&&A},[o,e,i,n])}}","map":"{\"version\":3,\"sources\":[\"client/hooks/useApplyButtonFilters.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IUIActionButton } from '@rocket.chat/apps-engine/definition/ui';\\nimport { RoomTypeFilter } from '@rocket.chat/apps-engine/definition/ui';\\nimport type { IRoom } from '@rocket.chat/core-typings';\\nimport {\\n\\tisDirectMessageRoom,\\n\\tisMultipleDirectMessageRoom,\\n\\tisOmnichannelRoom,\\n\\tisPrivateDiscussion,\\n\\tisPrivateTeamRoom,\\n\\tisPublicDiscussion,\\n\\tisPublicTeamRoom,\\n} from '@rocket.chat/core-typings';\\nimport { AuthorizationContext, useUserId } from '@rocket.chat/ui-contexts';\\nimport { useCallback, useContext } from 'react';\\n\\nimport { useRoom } from '../views/room/contexts/RoomContext';\\n\\nconst enumToFilter: { [k in RoomTypeFilter]: (room: IRoom) => boolean } = {\\n\\t[RoomTypeFilter.PUBLIC_CHANNEL]: (room) => room.t === 'c',\\n\\t[RoomTypeFilter.PRIVATE_CHANNEL]: (room) => room.t === 'p',\\n\\t[RoomTypeFilter.PUBLIC_TEAM]: isPublicTeamRoom,\\n\\t[RoomTypeFilter.PRIVATE_TEAM]: isPrivateTeamRoom,\\n\\t[RoomTypeFilter.PUBLIC_DISCUSSION]: isPublicDiscussion,\\n\\t[RoomTypeFilter.PRIVATE_DISCUSSION]: isPrivateDiscussion,\\n\\t[RoomTypeFilter.DIRECT]: isDirectMessageRoom,\\n\\t[RoomTypeFilter.DIRECT_MULTIPLE]: isMultipleDirectMessageRoom,\\n\\t[RoomTypeFilter.LIVE_CHAT]: isOmnichannelRoom,\\n};\\n\\nconst applyRoomFilter = (button: IUIActionButton, room: IRoom): boolean => {\\n\\tconst { roomTypes } = button.when || {};\\n\\treturn !roomTypes || roomTypes.some((filter): boolean => enumToFilter[filter]?.(room));\\n};\\n\\nconst applyCategoryFilter = (button: IUIActionButton, category: string): boolean => {\\n\\tconst { category: buttonCategory } = button;\\n\\n\\tif (category === 'default') {\\n\\t\\treturn !buttonCategory || buttonCategory === 'default';\\n\\t}\\n\\n\\treturn buttonCategory === category;\\n};\\n\\nexport const useApplyButtonFilters = (category = 'default'): ((button: IUIActionButton) => boolean) => {\\n\\tconst room = useRoom();\\n\\tif (!room) {\\n\\t\\tthrow new Error('useApplyButtonFilters must be used inside a room context');\\n\\t}\\n\\tconst applyAuthFilter = useApplyButtonAuthFilter();\\n\\treturn useCallback(\\n\\t\\t(button: IUIActionButton) =>\\n\\t\\t\\tapplyAuthFilter(button) && (!room || applyRoomFilter(button, room)) && applyCategoryFilter(button, category),\\n\\t\\t[applyAuthFilter, category, room],\\n\\t);\\n};\\n\\nexport const useApplyButtonAuthFilter = (): ((button: IUIActionButton) => boolean) => {\\n\\tconst uid = useUserId();\\n\\n\\tconst { queryAllPermissions, queryAtLeastOnePermission, queryRole } = useContext(AuthorizationContext);\\n\\n\\treturn useCallback(\\n\\t\\t(button: IUIActionButton, room?: IRoom) => {\\n\\t\\t\\tconst { hasAllPermissions, hasOnePermission, hasAllRoles, hasOneRole } = button.when || {};\\n\\n\\t\\t\\tconst hasAllPermissionsResult = hasAllPermissions ? queryAllPermissions(hasAllPermissions)[1]() : true;\\n\\t\\t\\tconst hasOnePermissionResult = hasOnePermission ? queryAtLeastOnePermission(hasOnePermission)[1]() : true;\\n\\t\\t\\tconst hasAllRolesResult = hasAllRoles ? !!uid && hasAllRoles.every((role) => queryRole(role, room?._id)) : true;\\n\\t\\t\\tconst hasOneRoleResult = hasOneRole ? !!uid && hasOneRole.some((role) => queryRole(role, room?._id)[1]()) : true;\\n\\n\\t\\t\\treturn hasAllPermissionsResult && hasOnePermissionResult && hasAllRolesResult && hasOneRoleResult;\\n\\t\\t},\\n\\t\\t[queryAllPermissions, queryAtLeastOnePermission, queryRole, uid],\\n\\t);\\n};\\n\",null],\"names\":[\"module\",\"export\",\"useApplyButtonFilters\",\"useApplyButtonAuthFilter\",\"link\",\"RoomTypeFilter\",\"v\",\"isDirectMessageRoom\",\"isMultipleDirectMessageRoom\",\"isOmnichannelRoom\",\"isPrivateDiscussion\",\"isPrivateTeamRoom\",\"isPublicDiscussion\",\"isPublicTeamRoom\",\"AuthorizationContext\",\"useUserId\",\"useCallback\",\"useContext\",\"useRoom\",\"enumToFilter\",\"_enumToFilter\",\"PUBLIC_CHANNEL\",\"room\",\"t\",\"PRIVATE_CHANNEL\",\"PUBLIC_TEAM\",\"PRIVATE_TEAM\",\"PUBLIC_DISCUSSION\",\"PRIVATE_DISCUSSION\",\"DIRECT\",\"DIRECT_MULTIPLE\",\"LIVE_CHAT\",\"applyRoomFilter\",\"button\",\"roomTypes\",\"_ref\",\"when\",\"some\",\"filter\",\"_enumToFilter$filter\",\"call\",\"applyCategoryFilter\",\"category\",\"buttonCategory\",\"arguments\",\"length\",\"undefined\",\"Error\",\"applyAuthFilter\",\"uid\",\"_useContext\",\"queryAllPermissions\",\"queryAtLeastOnePermission\",\"queryRole\",\"_ref2\",\"hasAllPermissions\",\"hasOnePermission\",\"hasAllRoles\",\"hasOneRole\",\"hasAllPermissionsResult\",\"hasOnePermissionResult\",\"hasAllRolesResult\",\"every\",\"role\",\"_id\",\"hasOneRoleResult\"],\"mappings\":\"uBACAA,EAAOC,MAAE,CAAA,CAAAC,sBAAsB,WAAA,OAAAA,CAAyC,EAAAC,yBAAA,WAAA,OAAAA,CAAA,CAAA,GAAAH,EAAAI,IAAA,CAAA,yCAAA,CAAAC,eAAA,SAAAC,CAAA,EAAAD,EAAAC,CAAA,CAAA,EAAA,GAAAN,EAAAI,IAAA,CAAA,4BAAA,CAAAG,oBAAA,SAAAD,CAAA,EAAAC,EAAAD,CAAA,EAAAE,4BAAA,SAAAF,CAAA,EAAAE,EAAAF,CAAA,EAAAG,kBAAA,SAAAH,CAAA,EAAAG,EAAAH,CAAA,EAAAI,oBAAA,SAAAJ,CAAA,EAAAI,EAAAJ,CAAA,EAAAK,kBAAA,SAAAL,CAAA,EAAAK,EAAAL,CAAA,EAAAM,mBAAA,SAAAN,CAAA,EAAAM,EAAAN,CAAA,EAAAO,iBAAA,SAAAP,CAAA,EAAAO,EAAAP,CAAA,CAAA,EAAA,GAAAN,EAAAI,IAAA,CAAA,2BAAA,CAAAU,qBAAA,SAAAR,CAAA,EAAAQ,EAAAR,CAAA,EAAAS,UAAA,SAAAT,CAAA,EAAAS,EAAAT,CAAA,CAAA,EAAA,GAAAN,EAAAI,IAAA,CAAA,QAAA,CAAAY,YAAA,SAAAV,CAAA,EAAAU,EAAAV,CAAA,EAAAW,WAAA,SAAAX,CAAA,EAAAW,EAAAX,CAAA,CAAA,EAAA,GAAAN,EAAAI,IAAA,CAAA,qCAAA,CAAAc,QAAA,SAAAZ,CAAA,EAAAY,EAAAZ,CAAA,CAAA,EAAA,GAgBxE,MAhBwED,EAAAE,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAgBlEC,EAAYC,CAAAA,CAAAA,EAAA,CAAA,CAAA,CAAA,CAChBf,EAAegB,cAAc,CAAA,CAAG,SAACC,CAAI,EAAA,MAAKA,AAAW,MAAXA,EAAKC,CAAC,AAAQ,EAAAH,CAAA,CACxDf,EAAemB,eAAe,CAAA,CAAG,SAACF,CAAI,EAAA,MAAKA,AAAW,MAAXA,EAAKC,CAAC,AAAQ,EAAAH,CAAA,CACzDf,EAAeoB,WAAW,CAAA,CAAGZ,EAAgBO,CAAA,CAC7Cf,EAAeqB,YAAY,CAAA,CAAGf,EAAiBS,CAAA,CAC/Cf,EAAesB,iBAAiB,CAAA,CAAGf,EAAkBQ,CAAA,CACrDf,EAAeuB,kBAAkB,CAAA,CAAGlB,EAAmBU,CAAA,CACvDf,EAAewB,MAAM,CAAA,CAAGtB,EAAmBa,CAAA,CAC3Cf,EAAeyB,eAAe,CAAA,CAAGtB,EAA2BY,CAAA,CAC5Df,EAAe0B,SAAS,CAAA,CAAGtB,EAAiBW,CAAAA,EAGxCY,EAAkB,SAACC,CAAuB,CAAEX,CAAW,EAC5D,IAAQY,EAASC,AAAKF,CAAAA,EAAOG,IAAI,EAAI,CAAA,CAAA,EAA7BF,SAAS,CACjB,MAAO,CAACA,GAAaA,EAAUG,IAAI,CAAC,SAACC,CAAM,EAAA,IAAAC,EAAA,OAAA,AAAkC,OAAlCA,CAAAA,EAAcpB,CAAY,CAACmB,EAAO,AAAD,GAACC,AAAA,KAAA,IAAAA,EAAA,KAAA,EAApBA,EAAAC,IAAA,CAAArB,EAAuBG,EAAK,EACtF,EAEMmB,EAAsB,SAACR,CAAuB,CAAES,CAAgB,EACrE,IAAkBC,EAAmBV,EAA7BS,QAAQ,OAEhB,AAAIA,AAAa,YAAbA,EACI,CAACC,GAAkBA,AAAmB,YAAnBA,EAGpBA,IAAmBD,CAC3B,EAEaxC,EAAwB,WAAiE,IAAhEwC,EAAQE,UAAAC,MAAA,CAAA,GAAAD,AAAAE,KAAAA,IAAAF,SAAA,CAAA,EAAA,CAAAA,SAAA,CAAA,EAAA,CAAG,UAC1CtB,EAAOJ,IACb,GAAI,CAACI,EACJ,MAAM,AAAIyB,MAAM,4DAEjB,IAAMC,EAAkB7C,IACxB,OAAOa,EACN,SAACiB,CAAuB,EAAA,OACvBe,EAAgBf,IAAY,CAAA,CAACX,GAAQU,EAAgBC,EAAQX,EAAI,GAAMmB,EAAoBR,EAAQS,EAAS,EAC7G,CAACM,EAAiBN,EAAUpB,EAAK,CAEnC,EAEanB,EAA2B,WACvC,IAAM8C,EAAMlC,IAEZmC,EAAsEjC,EAAWH,GAAzEqC,EAAmBD,EAAnBC,mBAAmB,CAAEC,EAAyBF,EAAzBE,yBAAyB,CAAEC,EAASH,EAATG,SAAS,CAEjE,OAAOrC,EACN,SAACiB,CAAuB,CAAEX,CAAY,EACrC,IAAAgC,EAAyErB,EAAOG,IAAI,EAAI,CAAA,EAAhFmB,EAAiBD,EAAjBC,iBAAiB,CAAEC,EAAgBF,EAAhBE,gBAAgB,CAAEC,EAAWH,EAAXG,WAAW,CAAEC,EAAUJ,EAAVI,UAAU,CAE9DC,EAA0BJ,CAAAA,GAAoBJ,EAAoBI,EAAkB,CAAC,EAAE,GACvFK,EAAyBJ,CAAAA,GAAmBJ,EAA0BI,EAAiB,CAAC,EAAE,GAC1FK,EAAoBJ,CAAAA,GAAc,CAAC,CAACR,GAAOQ,EAAYK,KAAK,CAAC,SAACC,CAAI,EAAA,OAAKV,EAAUU,EAAMzC,MAAAA,EAAI,KAAA,EAAJA,EAAM0C,GAAG,CAAC,GACjGC,EAAmBP,CAAAA,GAAa,CAAC,CAACT,GAAOS,EAAWrB,IAAI,CAAC,SAAC0B,CAAI,EAAA,OAAKV,EAAUU,EAAMzC,MAAAA,EAAI,KAAA,EAAJA,EAAM0C,GAAG,CAAC,CAAC,EAAE,EAAE,GAExG,OAAOL,GAA2BC,GAA0BC,GAAqBI,CAClF,EACA,CAACd,EAAqBC,EAA2BC,EAAWJ,EAAI,CAElE\"}"}