{"code":"function module(e,n,t){t.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){i=e}},0),t.link(\"@babel/runtime/regenerator\",{default:function(e){u=e}},1),t.link(\"@rocket.chat/fuselage-hooks\",{useLocalStorage:function(e){o=e}},0),t.link(\"@rocket.chat/ui-contexts\",{UserContext:function(e){r=e},useEndpoint:function(e){l=e}},1),t.link(\"meteor/meteor\",{Meteor:function(e){c=e}},2),t.link(\"react\",{default:function(e){a=e},useEffect:function(e){s=e},useMemo:function(e){f=e},useRef:function(e){d=e}},3),t.link(\"../../../app/models/client\",{Subscriptions:function(e){k=e},ChatRoom:function(e){g=e}},4),t.link(\"../../../app/utils/client\",{getUserPreference:function(e){v=e}},5),t.link(\"../../../app/utils/client/lib/SDKClient\",{sdk:function(e){p=e}},6),t.link(\"../../../lib/callbacks/afterLogoutCleanUpCallback\",{afterLogoutCleanUpCallback:function(e){m=e}},7),t.link(\"../../hooks/useReactiveValue\",{useReactiveValue:function(e){b=e}},8),t.link(\"../../lib/createReactiveSubscriptionFactory\",{createReactiveSubscriptionFactory:function(e){h=e}},9),t.link(\"../../lib/queryClient\",{queryClient:function(e){y=e}},10),t.link(\"../../views/account/accessibility/hooks/useCreateFontStyleElement\",{useCreateFontStyleElement:function(e){C=e}},11),t.link(\"./hooks/useClearRemovedRoomsHistory\",{useClearRemovedRoomsHistory:function(e){R=e}},12),t.link(\"./hooks/useDeleteUser\",{useDeleteUser:function(e){S=e}},13),t.link(\"./hooks/useEmailVerificationWarning\",{useEmailVerificationWarning:function(e){U=e}},14),t.link(\"./hooks/useUpdateAvatar\",{useUpdateAvatar:function(e){E=e}},15);var i,u,o,r,l,c,a,s,f,d,k,g,v,p,m,b,h,y,C,R,S,U,E,P=function(){return c.user()},q=function(){return c.userId()},x=function(){return new Promise(function(e,n){var t=P();if(!t)return e();c.logout(function(){return u.async(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,u.awrap(m.run(t));case 2:p.call(\"logoutCleanUp\",t).then(e,n);case 3:case\"end\":return i.stop()}},null,null,null,Promise)})})};t.exportDefault(function(e){var n,t,u=e.children,c=b(P),p=b(q),m=d(p),L=o(\"userLanguage\",\"\"),w=i(L,2),D=w[0],F=w[1],V=o(\"preferedLanguage\",\"\"),A=i(V,2),O=A[0],H=A[1],I=l(\"POST\",\"/v1/users.setPreferences\");C()(null==c?void 0:null===(n=c.settings)||void 0===n?void 0:null===(t=n.preferences)||void 0===t?void 0:t.fontSize),U(null!=c?c:void 0),R(p),S(),E();var M=f(function(){return{userId:p,user:c,queryPreference:h(function(e,n){return v(p,e,n)}),querySubscription:h(function(e,n,t){return k.findOne(e,{fields:n,sort:t})}),queryRoom:h(function(e,n){return g.findOne(e,{fields:n})}),querySubscriptions:h(function(e,n){return p?k.find(e,n).fetch():g.find(e,n).fetch()}),logout:x}},[p,c]);return s(function(){p&&O!==D&&(I({data:{language:O}}),F(O)),(null==c?void 0:c.language)!==void 0&&c.language!==D&&(F(c.language),H(c.language))},[O,H,F,null==c?void 0:c.language,D,p,I]),s(function(){m.current&&m.current!==p&&y.clear(),m.current=p},[p]),a.createElement(r.Provider,{children:u,value:M})})}","map":"{\"version\":3,\"sources\":[\"client/providers/UserProvider/UserProvider.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom, ISubscription, IUser } from '@rocket.chat/core-typings';\\nimport { useLocalStorage } from '@rocket.chat/fuselage-hooks';\\nimport type { SubscriptionWithRoom } from '@rocket.chat/ui-contexts';\\nimport { UserContext, useEndpoint } from '@rocket.chat/ui-contexts';\\nimport { Meteor } from 'meteor/meteor';\\nimport type { ContextType, ReactElement, ReactNode } from 'react';\\nimport React, { useEffect, useMemo, useRef } from 'react';\\n\\nimport { Subscriptions, ChatRoom } from '../../../app/models/client';\\nimport { getUserPreference } from '../../../app/utils/client';\\nimport { sdk } from '../../../app/utils/client/lib/SDKClient';\\nimport { afterLogoutCleanUpCallback } from '../../../lib/callbacks/afterLogoutCleanUpCallback';\\nimport { useReactiveValue } from '../../hooks/useReactiveValue';\\nimport { createReactiveSubscriptionFactory } from '../../lib/createReactiveSubscriptionFactory';\\nimport { queryClient } from '../../lib/queryClient';\\nimport { useCreateFontStyleElement } from '../../views/account/accessibility/hooks/useCreateFontStyleElement';\\nimport { useClearRemovedRoomsHistory } from './hooks/useClearRemovedRoomsHistory';\\nimport { useDeleteUser } from './hooks/useDeleteUser';\\nimport { useEmailVerificationWarning } from './hooks/useEmailVerificationWarning';\\nimport { useUpdateAvatar } from './hooks/useUpdateAvatar';\\n\\nconst getUser = (): IUser | null => Meteor.user() as IUser | null;\\n\\nconst getUserId = (): string | null => Meteor.userId();\\n\\nconst logout = (): Promise<void> =>\\n\\tnew Promise((resolve, reject) => {\\n\\t\\tconst user = getUser();\\n\\n\\t\\tif (!user) {\\n\\t\\t\\treturn resolve();\\n\\t\\t}\\n\\n\\t\\tMeteor.logout(async () => {\\n\\t\\t\\tawait afterLogoutCleanUpCallback.run(user);\\n\\t\\t\\tsdk.call('logoutCleanUp', user).then(resolve, reject);\\n\\t\\t});\\n\\t});\\n\\ntype UserProviderProps = {\\n\\tchildren: ReactNode;\\n};\\n\\nconst UserProvider = ({ children }: UserProviderProps): ReactElement => {\\n\\tconst user = useReactiveValue(getUser);\\n\\tconst userId = useReactiveValue(getUserId);\\n\\tconst previousUserId = useRef(userId);\\n\\tconst [userLanguage, setUserLanguage] = useLocalStorage('userLanguage', '');\\n\\tconst [preferedLanguage, setPreferedLanguage] = useLocalStorage('preferedLanguage', '');\\n\\n\\tconst setUserPreferences = useEndpoint('POST', '/v1/users.setPreferences');\\n\\n\\tconst createFontStyleElement = useCreateFontStyleElement();\\n\\tcreateFontStyleElement(user?.settings?.preferences?.fontSize);\\n\\n\\tuseEmailVerificationWarning(user ?? undefined);\\n\\tuseClearRemovedRoomsHistory(userId);\\n\\n\\tuseDeleteUser();\\n\\tuseUpdateAvatar();\\n\\n\\tconst contextValue = useMemo(\\n\\t\\t(): ContextType<typeof UserContext> => ({\\n\\t\\t\\tuserId,\\n\\t\\t\\tuser,\\n\\t\\t\\tqueryPreference: createReactiveSubscriptionFactory(\\n\\t\\t\\t\\t<T,>(key: string, defaultValue?: T) => getUserPreference(userId, key, defaultValue) as T,\\n\\t\\t\\t),\\n\\t\\t\\tquerySubscription: createReactiveSubscriptionFactory<ISubscription | undefined>((query, fields, sort) =>\\n\\t\\t\\t\\tSubscriptions.findOne(query, { fields, sort }),\\n\\t\\t\\t),\\n\\t\\t\\tqueryRoom: createReactiveSubscriptionFactory<IRoom | undefined>((query, fields) => ChatRoom.findOne(query, { fields })),\\n\\t\\t\\tquerySubscriptions: createReactiveSubscriptionFactory<SubscriptionWithRoom[]>((query, options) => {\\n\\t\\t\\t\\tif (userId) {\\n\\t\\t\\t\\t\\treturn Subscriptions.find(query, options).fetch();\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\treturn ChatRoom.find(query, options).fetch();\\n\\t\\t\\t}),\\n\\t\\t\\tlogout,\\n\\t\\t}),\\n\\t\\t[userId, user],\\n\\t);\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!!userId && preferedLanguage !== userLanguage) {\\n\\t\\t\\tsetUserPreferences({ data: { language: preferedLanguage } });\\n\\t\\t\\tsetUserLanguage(preferedLanguage);\\n\\t\\t}\\n\\n\\t\\tif (user?.language !== undefined && user.language !== userLanguage) {\\n\\t\\t\\tsetUserLanguage(user.language);\\n\\t\\t\\tsetPreferedLanguage(user.language);\\n\\t\\t}\\n\\t}, [preferedLanguage, setPreferedLanguage, setUserLanguage, user?.language, userLanguage, userId, setUserPreferences]);\\n\\n\\tuseEffect(() => {\\n\\t\\tif (previousUserId.current && previousUserId.current !== userId) {\\n\\t\\t\\tqueryClient.clear();\\n\\t\\t}\\n\\n\\t\\tpreviousUserId.current = userId;\\n\\t}, [userId]);\\n\\n\\treturn <UserContext.Provider children={children} value={contextValue} />;\\n};\\n\\nexport default UserProvider;\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_slicedToArray\",\"_regeneratorRuntime\",\"useLocalStorage\",\"UserContext\",\"useEndpoint\",\"Meteor\",\"React\",\"useEffect\",\"useMemo\",\"useRef\",\"Subscriptions\",\"ChatRoom\",\"getUserPreference\",\"sdk\",\"afterLogoutCleanUpCallback\",\"useReactiveValue\",\"createReactiveSubscriptionFactory\",\"queryClient\",\"useCreateFontStyleElement\",\"useClearRemovedRoomsHistory\",\"useDeleteUser\",\"useEmailVerificationWarning\",\"useUpdateAvatar\",\"getUser\",\"user\",\"getUserId\",\"userId\",\"logout\",\"Promise\",\"resolve\",\"reject\",\"async\",\"_context\",\"prev\",\"next\",\"awrap\",\"run\",\"call\",\"then\",\"stop\",\"exportDefault\",\"_ref\",\"_user$settings\",\"_user$settings$prefer\",\"children\",\"previousUserId\",\"_useLocalStorage\",\"_useLocalStorage2\",\"userLanguage\",\"setUserLanguage\",\"_useLocalStorage3\",\"_useLocalStorage4\",\"preferedLanguage\",\"setPreferedLanguage\",\"setUserPreferences\",\"createFontStyleElement\",\"settings\",\"preferences\",\"fontSize\",\"undefined\",\"contextValue\",\"queryPreference\",\"key\",\"defaultValue\",\"querySubscription\",\"query\",\"fields\",\"sort\",\"findOne\",\"queryRoom\",\"querySubscriptions\",\"options\",\"find\",\"fetch\",\"data\",\"language\",\"current\",\"clear\",\"createElement\",\"Provider\",\"value\"],\"mappings\":\"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\"}"}