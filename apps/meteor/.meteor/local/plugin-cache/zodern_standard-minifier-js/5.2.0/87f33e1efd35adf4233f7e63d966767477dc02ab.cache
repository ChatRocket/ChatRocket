{"code":"function module(e,t,n){let o,a,i,l,r,s,d,c,u,m,p;n.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){o=e}},0),n.link(\"@babel/runtime/helpers/asyncIterator\",{default(e){a=e}},1),n.export({useImagesList:()=>f}),n.link(\"@rocket.chat/base64\",{Base64(e){i=e}},0),n.link(\"@rocket.chat/ui-contexts\",{useEndpoint(e){l=e}},1),n.link(\"react\",{useCallback(e){r=e},useEffect(e){s=e},useState(e){d=e}},2),n.link(\"../../../../../app/e2e/client/rocketchat.e2e\",{e2e(e){c=e}},3),n.link(\"../../../../hooks/lists/useScrollableRecordList\",{useScrollableRecordList(e){u=e}},4),n.link(\"../../../../hooks/useComponentDidUpdate\",{useComponentDidUpdate(e){m=e}},5),n.link(\"../../../../lib/lists/ImagesList\",{ImagesList(e){p=e}},6);let f=e=>{let[t,n]=d(()=>new p(e)),f=r(()=>n(new p(e)),[e]);m(()=>{e&&f()},[e,f]),s(()=>{t.options!==e&&t.updateFilters(e)},[t,e]);let k=l(\"GET\",\"/v1/rooms.images\"),y=r(async(t,n)=>{let{files:l,total:r}=await k({roomId:e.roomId,startingFromId:e.startingFromId,offset:t,count:n}),s=l.map(e=>o(o({},e),{},{uploadedAt:e.uploadedAt?new Date(e.uploadedAt):void 0,modifiedAt:e.modifiedAt?new Date(e.modifiedAt):void 0}));var d=!1,u=!1;try{for(var m,p,f=a(s);d=!(p=await f.next()).done;d=!1){let e=p.value;if(e.rid&&e.content){let t=await c.getInstanceByRoomId(e.rid);if(null!=t&&t.shouldConvertReceivedMessages()){let t=await c.decryptFileContent(e),n=i.encode(JSON.stringify(o(o({},t.encryption),{},{name:String.fromCharCode(...new TextEncoder().encode(t.name)),type:t.type})));t.path=\"/file-decrypt\".concat(t.path,\"?key=\").concat(n),Object.assign(e,t)}}}}catch(e){u=!0,m=e}finally{try{d&&null!=f.return&&await f.return()}finally{if(u)throw m}}return{items:s,itemCount:r}},[k,e.roomId,e.startingFromId]),{loadMoreItems:h,initialItemCount:g}=u(t,y,5);return{reload:f,filesList:t,loadMoreItems:h,initialItemCount:g}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/ImageGallery/hooks/useImagesList.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Base64 } from '@rocket.chat/base64';\\nimport type { RoomsImagesProps } from '@rocket.chat/rest-typings';\\nimport { useEndpoint } from '@rocket.chat/ui-contexts';\\nimport { useCallback, useEffect, useState } from 'react';\\n\\nimport { e2e } from '../../../../../app/e2e/client/rocketchat.e2e';\\nimport { useScrollableRecordList } from '../../../../hooks/lists/useScrollableRecordList';\\nimport { useComponentDidUpdate } from '../../../../hooks/useComponentDidUpdate';\\nimport { ImagesList } from '../../../../lib/lists/ImagesList';\\n\\nexport const useImagesList = (\\n\\toptions: RoomsImagesProps,\\n): {\\n\\tfilesList: ImagesList;\\n\\tinitialItemCount: number;\\n\\treload: () => void;\\n\\tloadMoreItems: (start: number) => void;\\n} => {\\n\\tconst [filesList, setFilesList] = useState(() => new ImagesList(options));\\n\\tconst reload = useCallback(() => setFilesList(new ImagesList(options)), [options]);\\n\\n\\tuseComponentDidUpdate(() => {\\n\\t\\toptions && reload();\\n\\t}, [options, reload]);\\n\\n\\tuseEffect(() => {\\n\\t\\tif (filesList.options !== options) {\\n\\t\\t\\tfilesList.updateFilters(options);\\n\\t\\t}\\n\\t}, [filesList, options]);\\n\\n\\tconst apiEndPoint = '/v1/rooms.images';\\n\\n\\tconst getFiles = useEndpoint('GET', apiEndPoint);\\n\\n\\tconst fetchMessages = useCallback(\\n\\t\\tasync (start, end) => {\\n\\t\\t\\tconst { files, total } = await getFiles({\\n\\t\\t\\t\\troomId: options.roomId,\\n\\t\\t\\t\\tstartingFromId: options.startingFromId,\\n\\t\\t\\t\\toffset: start,\\n\\t\\t\\t\\tcount: end,\\n\\t\\t\\t});\\n\\n\\t\\t\\tconst items = files.map((file) => ({\\n\\t\\t\\t\\t...file,\\n\\t\\t\\t\\tuploadedAt: file.uploadedAt ? new Date(file.uploadedAt) : undefined,\\n\\t\\t\\t\\tmodifiedAt: file.modifiedAt ? new Date(file.modifiedAt) : undefined,\\n\\t\\t\\t}));\\n\\n\\t\\t\\tfor await (const file of items) {\\n\\t\\t\\t\\tif (file.rid && file.content) {\\n\\t\\t\\t\\t\\tconst e2eRoom = await e2e.getInstanceByRoomId(file.rid);\\n\\t\\t\\t\\t\\tif (e2eRoom?.shouldConvertReceivedMessages()) {\\n\\t\\t\\t\\t\\t\\tconst decrypted = await e2e.decryptFileContent(file);\\n\\t\\t\\t\\t\\t\\tconst key = Base64.encode(\\n\\t\\t\\t\\t\\t\\t\\tJSON.stringify({\\n\\t\\t\\t\\t\\t\\t\\t\\t...decrypted.encryption,\\n\\t\\t\\t\\t\\t\\t\\t\\tname: String.fromCharCode(...new TextEncoder().encode(decrypted.name)),\\n\\t\\t\\t\\t\\t\\t\\t\\ttype: decrypted.type,\\n\\t\\t\\t\\t\\t\\t\\t}),\\n\\t\\t\\t\\t\\t\\t);\\n\\t\\t\\t\\t\\t\\tdecrypted.path = `/file-decrypt${decrypted.path}?key=${key}`;\\n\\t\\t\\t\\t\\t\\tObject.assign(file, decrypted);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn {\\n\\t\\t\\t\\titems,\\n\\t\\t\\t\\titemCount: total,\\n\\t\\t\\t};\\n\\t\\t},\\n\\t\\t[getFiles, options.roomId, options.startingFromId],\\n\\t);\\n\\n\\tconst { loadMoreItems, initialItemCount } = useScrollableRecordList(filesList, fetchMessages, 5);\\n\\n\\treturn {\\n\\t\\treload,\\n\\t\\tfilesList,\\n\\t\\tloadMoreItems,\\n\\t\\tinitialItemCount,\\n\\t};\\n};\\n\",null],\"names\":[\"_objectSpread\",\"_asyncIterator\",\"Base64\",\"useEndpoint\",\"useCallback\",\"useEffect\",\"useState\",\"e2e\",\"useScrollableRecordList\",\"useComponentDidUpdate\",\"ImagesList\",\"module\",\"link\",\"default\",\"v\",\"export\",\"useImagesList\",\"options\",\"filesList\",\"setFilesList\",\"reload\",\"updateFilters\",\"getFiles\",\"fetchMessages\",\"start\",\"end\",\"files\",\"total\",\"roomId\",\"startingFromId\",\"offset\",\"count\",\"items\",\"map\",\"file\",\"uploadedAt\",\"Date\",\"undefined\",\"modifiedAt\",\"_iteratorAbruptCompletion\",\"_didIteratorError\",\"_iteratorError\",\"_step\",\"_iterator\",\"next\",\"done\",\"value\",\"rid\",\"content\",\"e2eRoom\",\"getInstanceByRoomId\",\"shouldConvertReceivedMessages\",\"decrypted\",\"decryptFileContent\",\"key\",\"encode\",\"JSON\",\"stringify\",\"encryption\",\"name\",\"String\",\"fromCharCode\",\"TextEncoder\",\"type\",\"path\",\"concat\",\"Object\",\"assign\",\"err\",\"return\",\"itemCount\",\"loadMoreItems\",\"initialItemCount\"],\"mappings\":\"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\"}"}