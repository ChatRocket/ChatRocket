{"code":"function module(r,n,e){var t,o,u;function a(r){var n;return t.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.awrap(function(r){return t.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!(r instanceof File)){n.next=5;break}return n.next=4,t.awrap(function(r){return t.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt(\"return\",new Promise(function(n,e){var t=new FileReader;t.onload=function(r){return n(new Uint8Array(r.target.result))},t.onerror=function(r){return e(r)},t.readAsArrayBuffer(r)}));case 1:case\"end\":return n.stop()}},null,null,null,Promise)}(r));case 4:r=n.sent;case 5:return n.abrupt(\"return\",o(r));case 8:throw n.prev=8,n.t0=n.catch(0),console.error(n.t0),n.t0;case 12:case\"end\":return n.stop()}},null,null,[[0,8]],Promise)}(r));case 2:return n=e.sent,e.abrupt(\"return\",function(r){if(!r[\"app.json\"])throw Error(\"No app.json file found in the zip\");try{return JSON.parse(u(r[\"app.json\"]))}catch(r){throw Error(\"Failed to parse app.json: \"+(r instanceof Error?r.message:String(r)))}}(n));case 4:case\"end\":return e.stop()}},null,null,null,Promise)}e.link(\"@babel/runtime/regenerator\",{default:function(r){t=r}},0),e.export({getManifestFromZippedApp:function(){return a}}),e.link(\"fflate\",{unzipSync:function(r){o=r},strFromU8:function(r){u=r}},0)}","map":"{\"version\":3,\"sources\":[\"client/views/marketplace/lib/getManifestFromZippedApp.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { AppPermission } from '@rocket.chat/core-typings';\\nimport { unzipSync, strFromU8 } from 'fflate';\\n\\ntype Uint8ArrayObject = { [fileName: string]: Uint8Array };\\ntype AppManifestSchema = { id: string; name: string; permissions: AppPermission[] };\\n\\nasync function fileToUint8Array(file: File): Promise<Uint8Array> {\\n\\treturn new Promise((resolve, reject) => {\\n\\t\\tconst fileReader = new FileReader();\\n\\t\\tfileReader.onload = (e): void => resolve(new Uint8Array((e.target as any).result as Uint8Array));\\n\\t\\tfileReader.onerror = (e): void => reject(e);\\n\\t\\tfileReader.readAsArrayBuffer(file);\\n\\t});\\n}\\n\\nfunction unzipAppBuffer(zippedAppBuffer: Uint8Array): Uint8ArrayObject {\\n\\treturn unzipSync(zippedAppBuffer);\\n}\\n\\nfunction getAppManifest(unzippedAppBuffer: Uint8ArrayObject): AppManifestSchema {\\n\\tif (!unzippedAppBuffer['app.json']) {\\n\\t\\tthrow new Error('No app.json file found in the zip');\\n\\t}\\n\\n\\ttry {\\n\\t\\treturn JSON.parse(strFromU8(unzippedAppBuffer['app.json']));\\n\\t} catch (e) {\\n\\t\\tthrow new Error(`Failed to parse app.json: ${e instanceof Error ? e.message : String(e)}`);\\n\\t}\\n}\\n\\nasync function unzipZippedApp(zippedApp: File | Uint8Array): Promise<Uint8ArrayObject> {\\n\\ttry {\\n\\t\\tif (zippedApp instanceof File) {\\n\\t\\t\\tzippedApp = await fileToUint8Array(zippedApp);\\n\\t\\t}\\n\\n\\t\\treturn unzipAppBuffer(zippedApp);\\n\\t} catch (e) {\\n\\t\\tconsole.error(e);\\n\\t\\tthrow e;\\n\\t}\\n}\\n\\nexport async function getManifestFromZippedApp(zippedApp: File): Promise<AppManifestSchema> {\\n\\tconst unzippedBuffer = await unzipZippedApp(zippedApp);\\n\\treturn getAppManifest(unzippedBuffer);\\n}\\n\",null],\"names\":[\"_regeneratorRuntime\",\"unzipSync\",\"strFromU8\",\"getManifestFromZippedApp\",\"zippedApp\",\"unzippedBuffer\",\"async\",\"_context3\",\"prev\",\"next\",\"awrap\",\"unzipZippedApp\",\"_context2\",\"File\",\"fileToUint8Array\",\"file\",\"_context\",\"abrupt\",\"Promise\",\"resolve\",\"reject\",\"fileReader\",\"FileReader\",\"onload\",\"e\",\"Uint8Array\",\"target\",\"result\",\"onerror\",\"readAsArrayBuffer\",\"stop\",\"sent\",\"t0\",\"console\",\"error\",\"getAppManifest\",\"unzippedAppBuffer\",\"Error\",\"JSON\",\"parse\",\"message\",\"String\",\"module\",\"link\",\"default\",\"v\",\"export\"],\"mappings\":\"2BACAA,EAA8CC,EAAAC,EA2CvC,SAAeC,EAAyBC,CAAe,EAAA,IAAAC,EAAA,OAAAL,EAAAM,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAAA,OAAAF,EAAAE,IAAA,CAAA,EAAAT,EAAAU,KAAA,CAChCC,AAd9B,SAA8BP,CAA4B,EAAA,OAAAJ,EAAAM,KAAA,CAAA,SAAAM,CAAA,EAAA,OAAA,OAAAA,EAAAJ,IAAA,CAAAI,EAAAH,IAAA,EAAA,KAAA,EAAA,GAAAG,EAAAJ,IAAA,CAAA,EAAA,CAEpDJ,CAAAA,aAAqBS,IAAAA,EAAI,CAAAD,EAAAH,IAAA,CAAA,EAAA,KAAA,CAAA,OAAAG,EAAAH,IAAA,CAAA,EAAAT,EAAAU,KAAA,CACVI,AA5BrB,SAAgCC,CAAU,EAAA,OAAAf,EAAAM,KAAA,CAAA,SAAAU,CAAA,EAAA,OAAA,OAAAA,EAAAR,IAAA,CAAAQ,EAAAP,IAAA,EAAA,KAAA,EAAA,OAAAO,EAAAC,MAAA,CAAA,SAClC,IAAIC,QAAQ,SAACC,CAAO,CAAEC,CAAM,EAClC,IAAMC,EAAa,IAAIC,UACvBD,CAAAA,EAAWE,MAAM,CAAG,SAACC,CAAC,EAAA,OAAWL,EAAQ,IAAIM,WAAYD,EAAEE,MAAc,CAACC,MAAoB,EAAE,EAChGN,EAAWO,OAAO,CAAG,SAACJ,CAAC,EAAA,OAAWJ,EAAOI,EAAE,EAC3CH,EAAWQ,iBAAiB,CAACd,EAC9B,GAAE,MAAA,EAAA,IAAA,MAAA,OAAAC,EAAAc,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAZ,QAAA,EAsBmCd,GAAU,MAAA,EAA7CA,EAASQ,EAAAmB,IAAA,MAAA,EAAA,OAAAnB,EAAAK,MAAA,CAAA,SAlBJhB,EAqBgBG,GAAU,MAAA,EAEf,MAFeQ,EAAAJ,IAAA,CAAA,EAAAI,EAAAoB,EAAA,CAAApB,EAAA,KAAA,CAAA,GAEhCqB,QAAQC,KAAK,CAAAtB,EAAAoB,EAAE,EAAEpB,EAAAoB,EAAA,MAAA,GAAA,IAAA,MAAA,OAAApB,EAAAkB,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,CAAA,CAAA,EAAA,EAAA,CAAA,CAAAZ,QAAA,EAM0Bd,GAAU,MAAA,EAAlC,OAAdC,EAAcE,EAAAwB,IAAA,CAAAxB,EAAAU,MAAA,CAAA,SACbkB,AA3BR,SAAwBC,CAAmC,EAC1D,GAAI,CAACA,CAAiB,CAAC,WAAW,CACjC,MAAM,AAAIC,MAAM,qCAGjB,GAAI,CACH,OAAOC,KAAKC,KAAK,CAACrC,EAAUkC,CAAiB,CAAC,WAAW,EAC1D,CAAE,MAAOZ,EAAG,CACX,MAAM,AAAIa,MAAK,6BAA8Bb,CAAAA,aAAaa,MAAQb,EAAEgB,OAAO,CAAGC,OAAOjB,EAAC,EACvF,CACD,EAiBuBnB,GAAe,MAAA,EAAA,IAAA,MAAA,OAAAE,EAAAuB,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAZ,QAAA,CA7ClBwB,EAAWC,IAAA,CAAA,6BAAe,CAAAC,QAAA,SAAAC,CAAA,EAAA7C,EAAA6C,CAAA,CAAA,EAAA,GAA9CH,EAAOI,MAAE,CAAA,CAAA3C,yBAA4B,WAAS,OAAAA,CAAA,CAAA,GAAAuC,EAAAC,IAAA,CAAA,SAAA,CAAA1C,UAAA,SAAA4C,CAAA,EAAA5C,EAAA4C,CAAA,EAAA3C,UAAA,SAAA2C,CAAA,EAAA3C,EAAA2C,CAAA,CAAA,EAAA\"}"}