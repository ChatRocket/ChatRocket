{"code":"function module(e,n,t){var o,i,c,r,l,u;t.link(\"@babel/runtime/regenerator\",{default:function(e){o=e}},0),t.link(\"meteor/meteor\",{Meteor:function(e){i=e}},0),t.link(\"meteor/tracker\",{Tracker:function(e){c=e}},1),t.link(\"../../app/models/client\",{Roles:function(e){r=e}},2),t.link(\"../../app/ui-cached-collection/client\",{CachedCollectionManager:function(e){l=e}},3),t.link(\"../../app/utils/client/lib/SDKClient\",{sdk:function(e){u=e}},4),i.startup(function(){l.onLogin(function(){var e;return o.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o.awrap(u.rest.get(\"/v1/roles.list\"));case 2:e=n.sent.roles,r._collection._docs._map=new Map(e.map(function(e){return[r._collection._docs._idStringify(e._id),e]})),Object.values(r._collection.queries).forEach(function(e){return r._collection._recomputeResults(e)}),r.ready.set(!0);case 7:case\"end\":return n.stop()}},null,null,null,Promise)});var e={changed:function(e){delete e.type,r.upsert({_id:e._id},e)},removed:function(e){r.remove({_id:e._id})}};c.autorun(function(n){i.userId()&&(c.afterFlush(function(){u.stream(\"roles\",[\"roles\"],function(n){var t;null===(t=e[n.type])||void 0===t||t.call(e,n)})}),n.stop())})})}","map":"{\"version\":3,\"sources\":[\"client/startup/roles.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IRole } from '@rocket.chat/core-typings';\\nimport { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { Roles } from '../../app/models/client';\\nimport { CachedCollectionManager } from '../../app/ui-cached-collection/client';\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\n\\nMeteor.startup(() => {\\n\\tCachedCollectionManager.onLogin(async () => {\\n\\t\\tconst { roles } = await sdk.rest.get('/v1/roles.list');\\n\\t\\t// if a role is checked before this collection is populated, it will return undefined\\n\\t\\tRoles._collection._docs._map = new Map(roles.map((record) => [Roles._collection._docs._idStringify(record._id), record]));\\n\\t\\tObject.values(Roles._collection.queries).forEach((query) => Roles._collection._recomputeResults(query));\\n\\n\\t\\tRoles.ready.set(true);\\n\\t});\\n\\n\\ttype ClientAction = 'inserted' | 'updated' | 'removed' | 'changed';\\n\\n\\tconst events: Record<string, ((role: IRole & { type?: ClientAction }) => void) | undefined> = {\\n\\t\\tchanged: (role) => {\\n\\t\\t\\tdelete role.type;\\n\\t\\t\\tRoles.upsert({ _id: role._id }, role);\\n\\t\\t},\\n\\t\\tremoved: (role) => {\\n\\t\\t\\tRoles.remove({ _id: role._id });\\n\\t\\t},\\n\\t};\\n\\n\\tTracker.autorun((c) => {\\n\\t\\tif (!Meteor.userId()) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tTracker.afterFlush(() => {\\n\\t\\t\\tsdk.stream('roles', ['roles'], (role) => {\\n\\t\\t\\t\\tevents[role.type]?.(role);\\n\\t\\t\\t});\\n\\t\\t});\\n\\n\\t\\tc.stop();\\n\\t});\\n});\\n\",null],\"names\":[\"_regeneratorRuntime\",\"Meteor\",\"Tracker\",\"Roles\",\"CachedCollectionManager\",\"sdk\",\"module\",\"link\",\"default\",\"v\",\"startup\",\"onLogin\",\"roles\",\"async\",\"_context\",\"prev\",\"next\",\"awrap\",\"rest\",\"get\",\"_await$sdk$rest$get\",\"sent\",\"_collection\",\"_docs\",\"_map\",\"Map\",\"map\",\"record\",\"_idStringify\",\"_id\",\"Object\",\"values\",\"queries\",\"forEach\",\"query\",\"_recomputeResults\",\"ready\",\"set\",\"stop\",\"Promise\",\"events\",\"changed\",\"role\",\"type\",\"upsert\",\"removed\",\"remove\",\"autorun\",\"c\",\"userId\",\"afterFlush\",\"stream\",\"_events$role$type\",\"call\"],\"mappings\":\"2BACAA,EAAAC,EAAuCC,EAAAC,EAAAC,EAAAC,EAAhBC,EAAAC,IAAA,CAAA,6BAAgB,CAAAC,QAAA,SAAAC,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAA9BH,EAAQC,IAAA,CAAM,gBAAgB,CAAAN,OAAA,SAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,iBAAA,CAAAL,QAAA,SAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,0BAAA,CAAAJ,MAAA,SAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,wCAAA,CAAAH,wBAAA,SAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAF,IAAA,SAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAOvCR,EAAOS,OAAO,CAAC,WACdN,EAAwBO,OAAO,CAAC,WAAA,IAAAC,EAAA,OAAAZ,EAAAa,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAAA,OAAAF,EAAAE,IAAA,CAAA,EAAAhB,EAAAiB,KAAA,CACPZ,EAAIa,IAAI,CAACC,GAAG,CAAC,kBAAiB,MAAA,EAA9CP,EAAKQ,AAAyCN,EAAAO,IAAA,CAA9CT,KAAK,CAEbT,EAAMmB,WAAW,CAACC,KAAK,CAACC,IAAI,CAAG,IAAIC,IAAIb,EAAMc,GAAG,CAAC,SAACC,CAAM,EAAA,MAAK,CAACxB,EAAMmB,WAAW,CAACC,KAAK,CAACK,YAAY,CAACD,EAAOE,GAAG,EAAGF,EAAO,IACvHG,OAAOC,MAAM,CAAC5B,EAAMmB,WAAW,CAACU,OAAO,EAAEC,OAAO,CAAC,SAACC,CAAK,EAAA,OAAK/B,EAAMmB,WAAW,CAACa,iBAAiB,CAACD,EAAM,GAEtG/B,EAAMiC,KAAK,CAACC,GAAG,CAAC,CAAA,EAAM,MAAA,EAAA,IAAA,MAAA,OAAAvB,EAAAwB,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,GAKvB,IAAMC,EAAwF,CAC7FC,QAAS,SAACC,CAAI,EACb,OAAOA,EAAKC,IAAI,CAChBxC,EAAMyC,MAAM,CAAC,CAAEf,IAAKa,EAAKb,GAAAA,AAAG,EAAIa,EACjC,EACAG,QAAS,SAACH,CAAI,EACbvC,EAAM2C,MAAM,CAAC,CAAEjB,IAAKa,EAAKb,GAAAA,AAAG,EAC7B,GAGD3B,EAAQ6C,OAAO,CAAC,SAACC,CAAC,EACZ/C,EAAOgD,MAAM,KAIlB/C,EAAQgD,UAAU,CAAC,WAClB7C,EAAI8C,MAAM,CAAC,QAAS,CAAC,QAAQ,CAAE,SAACT,CAAI,EAAI,IAAAU,CACvC,AAAiB,QAAjBA,CAAAA,EAAAZ,CAAM,CAACE,EAAKC,IAAI,CAAC,AAAD,GAACS,AAAA,KAAA,IAAAA,GAAjBA,EAAAC,IAAA,CAAAb,EAAoBE,EACrB,EACD,GAEAM,EAAEV,IAAI,GACP,EACD\"}"}