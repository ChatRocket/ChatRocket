{"code":"function module(n,e,t){t.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(n){i=n}},0),t.export({LivechatRoomType:function(){return p}}),t.link(\"../../../../app/authorization/client\",{hasPermission:function(n){o=n}},0),t.link(\"../../../../app/models/client\",{ChatRoom:function(n){r=n},ChatSubscription:function(n){a=n}},1),t.link(\"../../../../app/settings/client\",{settings:function(n){u=n}},2),t.link(\"../../../../app/utils/client/getAvatarURL\",{getAvatarURL:function(n){c=n}},3),t.link(\"../../../../definition/IRoomTypeConfig\",{RoomSettingsEnum:function(n){l=n},RoomMemberActions:function(n){f=n},UiTextContext:function(n){m=n}},4),t.link(\"../../../../lib/rooms/roomTypes/livechat\",{getLivechatRoomType:function(n){d=n}},5),t.link(\"../roomCoordinator\",{roomCoordinator:function(n){s=n}},6);var i,o,r,a,u,c,l,f,m,d,s,p=d(s);s.add(i(i({},p),{},{label:\"Omnichannel\"}),{allowRoomSettingChange:function(n,e){return e!==l.JOIN_CODE},allowMemberAction:function(n,e){return[f.INVITE,f.JOIN].includes(e)},roomName:function(n){return n.name||n.fname||n.label},getUiText:function(n){switch(n){case m.HIDE_WARNING:case m.LEAVE_WARNING:return\"Hide_Livechat_Warning\";default:return\"\"}},condition:function(){return u.get(\"Livechat_enabled\")&&o(\"view-l-room\")},getAvatarPath:function(n){return c({username:\"@\"+this.roomName(n)})||\"\"},findRoom:function(n){return r.findOne({_id:n})},isLivechatRoom:function(){return!0},canSendMessage:function(n){var e=r.findOne({_id:n},{fields:{open:1}});return!!(null==e?void 0:e.open)},readOnly:function(n,e){var t=r.findOne({_id:n},{fields:{open:1,servedBy:1}});return null==t||!t.open||!a.findOne({rid:n})},getIcon:function(){return\"livechat\"},extractOpenRoomParams:function(n){return{type:\"l\",reference:n.id}}})}","map":"{\"version\":3,\"sources\":[\"client/lib/rooms/roomTypes/livechat.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { AtLeast, ValueOf } from '@rocket.chat/core-typings';\\n\\nimport { hasPermission } from '../../../../app/authorization/client';\\nimport { ChatRoom, ChatSubscription } from '../../../../app/models/client';\\nimport { settings } from '../../../../app/settings/client';\\nimport { getAvatarURL } from '../../../../app/utils/client/getAvatarURL';\\nimport type { IRoomTypeClientDirectives } from '../../../../definition/IRoomTypeConfig';\\nimport { RoomSettingsEnum, RoomMemberActions, UiTextContext } from '../../../../definition/IRoomTypeConfig';\\nimport { getLivechatRoomType } from '../../../../lib/rooms/roomTypes/livechat';\\nimport { roomCoordinator } from '../roomCoordinator';\\n\\nexport const LivechatRoomType = getLivechatRoomType(roomCoordinator);\\n\\nroomCoordinator.add(\\n\\t{\\n\\t\\t...LivechatRoomType,\\n\\t\\tlabel: 'Omnichannel',\\n\\t},\\n\\t{\\n\\t\\tallowRoomSettingChange(_room, setting) {\\n\\t\\t\\tswitch (setting) {\\n\\t\\t\\t\\tcase RoomSettingsEnum.JOIN_CODE:\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\tdefault:\\n\\t\\t\\t\\t\\treturn true;\\n\\t\\t\\t}\\n\\t\\t},\\n\\n\\t\\tallowMemberAction(_room, action) {\\n\\t\\t\\treturn ([RoomMemberActions.INVITE, RoomMemberActions.JOIN] as Array<ValueOf<typeof RoomMemberActions>>).includes(action);\\n\\t\\t},\\n\\n\\t\\troomName(room) {\\n\\t\\t\\treturn room.name || room.fname || (room as any).label;\\n\\t\\t},\\n\\n\\t\\tgetUiText(context) {\\n\\t\\t\\tswitch (context) {\\n\\t\\t\\t\\tcase UiTextContext.HIDE_WARNING:\\n\\t\\t\\t\\t\\treturn 'Hide_Livechat_Warning';\\n\\t\\t\\t\\tcase UiTextContext.LEAVE_WARNING:\\n\\t\\t\\t\\t\\treturn 'Hide_Livechat_Warning';\\n\\t\\t\\t\\tdefault:\\n\\t\\t\\t\\t\\treturn '';\\n\\t\\t\\t}\\n\\t\\t},\\n\\n\\t\\tcondition() {\\n\\t\\t\\treturn settings.get('Livechat_enabled') && hasPermission('view-l-room');\\n\\t\\t},\\n\\n\\t\\tgetAvatarPath(room) {\\n\\t\\t\\treturn getAvatarURL({ username: `@${this.roomName(room)}` }) || '';\\n\\t\\t},\\n\\n\\t\\tfindRoom(identifier) {\\n\\t\\t\\treturn ChatRoom.findOne({ _id: identifier });\\n\\t\\t},\\n\\n\\t\\tisLivechatRoom() {\\n\\t\\t\\treturn true;\\n\\t\\t},\\n\\n\\t\\tcanSendMessage(rid) {\\n\\t\\t\\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { open: 1 } });\\n\\t\\t\\treturn Boolean(room?.open);\\n\\t\\t},\\n\\n\\t\\treadOnly(rid, _user) {\\n\\t\\t\\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { open: 1, servedBy: 1 } });\\n\\t\\t\\tif (!room?.open) {\\n\\t\\t\\t\\treturn true;\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst subscription = ChatSubscription.findOne({ rid });\\n\\t\\t\\treturn !subscription;\\n\\t\\t},\\n\\n\\t\\tgetIcon() {\\n\\t\\t\\treturn 'livechat';\\n\\t\\t},\\n\\n\\t\\textractOpenRoomParams({ id }) {\\n\\t\\t\\treturn { type: 'l', reference: id };\\n\\t\\t},\\n\\t} as AtLeast<IRoomTypeClientDirectives, 'roomName'>,\\n);\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_objectSpread\",\"export\",\"LivechatRoomType\",\"hasPermission\",\"ChatRoom\",\"ChatSubscription\",\"settings\",\"getAvatarURL\",\"RoomSettingsEnum\",\"RoomMemberActions\",\"UiTextContext\",\"getLivechatRoomType\",\"roomCoordinator\",\"add\",\"label\",\"allowRoomSettingChange\",\"_room\",\"setting\",\"JOIN_CODE\",\"allowMemberAction\",\"action\",\"INVITE\",\"JOIN\",\"includes\",\"roomName\",\"room\",\"name\",\"fname\",\"getUiText\",\"context\",\"HIDE_WARNING\",\"LEAVE_WARNING\",\"condition\",\"get\",\"getAvatarPath\",\"username\",\"findRoom\",\"identifier\",\"findOne\",\"_id\",\"isLivechatRoom\",\"canSendMessage\",\"rid\",\"fields\",\"open\",\"Boolean\",\"readOnly\",\"_user\",\"servedBy\",\"getIcon\",\"extractOpenRoomParams\",\"_ref\",\"type\",\"reference\",\"id\"],\"mappings\":\"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\"}"}