{"code":"function module(e,n,t){var i,o,r,l,s,a,u,c,d,f;t.link(\"@babel/runtime/regenerator\",{default:function(e){i=e}},0),t.link(\"meteor/meteor\",{Meteor:function(e){o=e}},0),t.link(\"meteor/tracker\",{Tracker:function(e){r=e}},1),t.link(\"../../../../client/lib/rooms/roomCoordinator\",{roomCoordinator:function(e){l=e}},2),t.link(\"../../../../client/lib/toast\",{dispatchToastMessage:function(e){s=e}},3),t.link(\"../../../../client/lib/utils/callWithErrorHandling\",{callWithErrorHandling:function(e){a=e}},4),t.link(\"../../../models/client\",{Messages:function(e){u=e}},5),t.link(\"../../../settings/client\",{settings:function(e){c=e}},6),t.link(\"../../../ui-utils/client\",{MessageAction:function(e){d=e}},7),t.link(\"../../../utils/lib/i18n\",{t:function(e){f=e}},8),o.startup(function(){r.autorun(function(){if(!c.get(\"Threads_enabled\"))return d.removeButton(\"follow-message\");d.addButton({id:\"follow-message\",icon:\"bell\",label:\"Follow_message\",type:\"interaction\",context:[\"message\",\"message-mobile\",\"threads\",\"federated\",\"videoconf\",\"videoconf-threads\"],action:function(e,n){var t;return i.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.message){e.next=3;break}return e.abrupt(\"return\");case 3:return e.next=5,i.awrap(a(\"followMessage\",{mid:t._id}).then(function(){return s({type:\"success\",message:f(\"You_followed_this_message\")})}));case 5:case\"end\":return e.stop()}},null,null,null,Promise)},condition:function(e){var n=e.message,t=n._id,i=n.tmid,o=n.replies,r=void 0===o?[]:o,s=e.room,a=e.user,c=e.context;if(i||c){var d=u.findOne({_id:i||t},{fields:{replies:1}});d&&(r=d.replies||[])}return!l.isLivechatRoom(s.t)&&null!=a&&!!a._id&&!r.includes(a._id)},order:1,group:\"menu\"})})})}","map":"{\"version\":3,\"sources\":[\"app/threads/client/messageAction/follow.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { roomCoordinator } from '../../../../client/lib/rooms/roomCoordinator';\\nimport { dispatchToastMessage } from '../../../../client/lib/toast';\\nimport { callWithErrorHandling } from '../../../../client/lib/utils/callWithErrorHandling';\\nimport { Messages } from '../../../models/client';\\nimport { settings } from '../../../settings/client';\\nimport { MessageAction } from '../../../ui-utils/client';\\nimport { t } from '../../../utils/lib/i18n';\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(() => {\\n\\t\\tif (!settings.get('Threads_enabled')) {\\n\\t\\t\\treturn MessageAction.removeButton('follow-message');\\n\\t\\t}\\n\\t\\tMessageAction.addButton({\\n\\t\\t\\tid: 'follow-message',\\n\\t\\t\\ticon: 'bell',\\n\\t\\t\\tlabel: 'Follow_message',\\n\\t\\t\\ttype: 'interaction',\\n\\t\\t\\tcontext: ['message', 'message-mobile', 'threads', 'federated', 'videoconf', 'videoconf-threads'],\\n\\t\\t\\tasync action(_, { message }) {\\n\\t\\t\\t\\tif (!message) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tawait callWithErrorHandling('followMessage', { mid: message._id }).then(() =>\\n\\t\\t\\t\\t\\tdispatchToastMessage({\\n\\t\\t\\t\\t\\t\\ttype: 'success',\\n\\t\\t\\t\\t\\t\\tmessage: t('You_followed_this_message'),\\n\\t\\t\\t\\t\\t}),\\n\\t\\t\\t\\t);\\n\\t\\t\\t},\\n\\t\\t\\tcondition({ message: { _id, tmid, replies = [] }, room, user, context }) {\\n\\t\\t\\t\\tif (tmid || context) {\\n\\t\\t\\t\\t\\tconst parentMessage = Messages.findOne({ _id: tmid || _id }, { fields: { replies: 1 } });\\n\\t\\t\\t\\t\\tif (parentMessage) {\\n\\t\\t\\t\\t\\t\\treplies = parentMessage.replies || [];\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room.t);\\n\\t\\t\\t\\tif (isLivechatRoom) {\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\treturn user?._id ? !replies.includes(user._id) : false;\\n\\t\\t\\t},\\n\\t\\t\\torder: 1,\\n\\t\\t\\tgroup: 'menu',\\n\\t\\t});\\n\\t});\\n});\\n\",null],\"names\":[\"_regeneratorRuntime\",\"Meteor\",\"Tracker\",\"roomCoordinator\",\"dispatchToastMessage\",\"callWithErrorHandling\",\"Messages\",\"settings\",\"MessageAction\",\"t\",\"module\",\"link\",\"default\",\"v\",\"startup\",\"autorun\",\"get\",\"removeButton\",\"addButton\",\"id\",\"icon\",\"label\",\"type\",\"context\",\"action\",\"_\",\"_ref\",\"message\",\"async\",\"_context\",\"prev\",\"next\",\"abrupt\",\"awrap\",\"mid\",\"_id\",\"then\",\"stop\",\"Promise\",\"condition\",\"_ref2\",\"_ref2$message\",\"tmid\",\"_ref2$message$replies\",\"replies\",\"room\",\"user\",\"parentMessage\",\"findOne\",\"fields\",\"isLivechatRoom\",\"includes\",\"order\",\"group\"],\"mappings\":\"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\"}"}