{"code":"function module(e,n,o){o.link(\"@babel/runtime/helpers/toConsumableArray\",{default:function(e){t=e}},0),o.link(\"@babel/runtime/helpers/inheritsLoose\",{default:function(e){r=e}},1),o.export({AudioEncoder:function(){return s}}),o.link(\"@rocket.chat/emitter\",{Emitter:function(e){i=e}},0),o.link(\"meteor/meteor\",{Meteor:function(e){a=e}},1);var t,r,i,a,s=function(e){function n(n){var o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.bufferLen,s=void 0===i?4096:i,c=r.numChannels,d=void 0===c?1:c,u=r.bitRate;(o=e.call(this)||this).worker=void 0,o.scriptNode=void 0,o.handleWorkerMessage=function(e){if(\"end\"===e.data.command){var n=[new Int8Array([73,68,51,3,0,0,0,0,0,0])].concat(t(e.data.buffer)),r=new Blob(n,{type:\"audio/mpeg\"});o.emit(\"encoded\",r),o.worker.terminate()}},o.handleAudioProcess=function(e){for(var n=0;n<e.inputBuffer.numberOfChannels;n++){var t=e.inputBuffer.getChannelData(n);o.worker.postMessage({command:\"encode\",buffer:t})}};var l=a.absoluteUrl(\"workers/mp3-encoder/index.js\");return o.worker=new Worker(l),o.worker.onmessage=o.handleWorkerMessage,o.worker.postMessage({command:\"init\",config:{sampleRate:n.context.sampleRate,numChannels:d,bitRate:void 0===u?32:u}}),o.scriptNode=n.context.createScriptProcessor(s,d,d),o.scriptNode.onaudioprocess=o.handleAudioProcess,n.connect(o.scriptNode),o.scriptNode.connect(n.context.destination),o}return r(n,e),n.prototype.close=function(){this.worker.postMessage({command:\"finish\"})},n}(i)}","map":"{\"version\":3,\"sources\":[\"app/ui/client/lib/recorderjs/AudioEncoder.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Emitter } from '@rocket.chat/emitter';\\nimport { Meteor } from 'meteor/meteor';\\n\\nexport class AudioEncoder extends Emitter {\\n\\tprivate worker: Worker;\\n\\n\\tprivate scriptNode: ScriptProcessorNode;\\n\\n\\tconstructor(source: MediaStreamAudioSourceNode, { bufferLen = 4096, numChannels = 1, bitRate = 32 } = {}) {\\n\\t\\tsuper();\\n\\n\\t\\tconst workerPath = Meteor.absoluteUrl('workers/mp3-encoder/index.js');\\n\\n\\t\\tthis.worker = new Worker(workerPath);\\n\\t\\tthis.worker.onmessage = this.handleWorkerMessage;\\n\\n\\t\\tthis.worker.postMessage({\\n\\t\\t\\tcommand: 'init',\\n\\t\\t\\tconfig: {\\n\\t\\t\\t\\tsampleRate: source.context.sampleRate,\\n\\t\\t\\t\\tnumChannels,\\n\\t\\t\\t\\tbitRate,\\n\\t\\t\\t},\\n\\t\\t});\\n\\n\\t\\tthis.scriptNode = source.context.createScriptProcessor(bufferLen, numChannels, numChannels);\\n\\t\\tthis.scriptNode.onaudioprocess = this.handleAudioProcess;\\n\\n\\t\\tsource.connect(this.scriptNode);\\n\\t\\tthis.scriptNode.connect(source.context.destination);\\n\\t}\\n\\n\\tclose() {\\n\\t\\tthis.worker.postMessage({ command: 'finish' });\\n\\t}\\n\\n\\thandleWorkerMessage = (event: MessageEvent) => {\\n\\t\\tswitch (event.data.command) {\\n\\t\\t\\tcase 'end': {\\n\\t\\t\\t\\t// prepend mp3 magic number to the buffer\\n\\t\\t\\t\\tconst magicNoPrefix = new Int8Array([73, 68, 51, 3, 0, 0, 0, 0, 0, 0]);\\n\\t\\t\\t\\tconst bufferWithMagicNo = [magicNoPrefix, ...event.data.buffer];\\n\\t\\t\\t\\tconst blob = new Blob(bufferWithMagicNo, { type: 'audio/mpeg' });\\n\\t\\t\\t\\tthis.emit('encoded', blob);\\n\\t\\t\\t\\tthis.worker.terminate();\\n\\t\\t\\t\\tbreak;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t};\\n\\n\\thandleAudioProcess = (event: AudioProcessingEvent) => {\\n\\t\\tfor (let channel = 0; channel < event.inputBuffer.numberOfChannels; channel++) {\\n\\t\\t\\tconst buffer = event.inputBuffer.getChannelData(channel);\\n\\t\\t\\tthis.worker.postMessage({\\n\\t\\t\\t\\tcommand: 'encode',\\n\\t\\t\\t\\tbuffer,\\n\\t\\t\\t});\\n\\t\\t}\\n\\t};\\n}\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_toConsumableArray\",\"_inheritsLoose\",\"export\",\"AudioEncoder\",\"Emitter\",\"Meteor\",\"_Emitter\",\"source\",\"_this\",\"_ref\",\"arguments\",\"length\",\"undefined\",\"_ref$bufferLen\",\"bufferLen\",\"_ref$numChannels\",\"numChannels\",\"_ref$bitRate\",\"bitRate\",\"call\",\"worker\",\"scriptNode\",\"handleWorkerMessage\",\"event\",\"data\",\"command\",\"bufferWithMagicNo\",\"Int8Array\",\"concat\",\"buffer\",\"blob\",\"Blob\",\"type\",\"emit\",\"terminate\",\"handleAudioProcess\",\"channel\",\"inputBuffer\",\"numberOfChannels\",\"getChannelData\",\"postMessage\",\"workerPath\",\"absoluteUrl\",\"Worker\",\"onmessage\",\"config\",\"sampleRate\",\"context\",\"createScriptProcessor\",\"onaudioprocess\",\"connect\",\"destination\",\"_proto\",\"prototype\",\"close\"],\"mappings\":\"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\"}"}