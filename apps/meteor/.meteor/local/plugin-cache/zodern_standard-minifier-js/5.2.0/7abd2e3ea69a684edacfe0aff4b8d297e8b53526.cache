{"code":"function module(e,n,t){let i,o,r,l,a,u,c,s,m,g,d;t.export({usePruneWarningMessage:()=>y}),t.link(\"@rocket.chat/fuselage-hooks\",{useSafely(e){i=e}},0),t.link(\"@rocket.chat/ui-contexts\",{useSetting(e){o=e},useTranslation(e){r=e},useLanguage(e){l=e}},1),t.link(\"cron\",{sendAt(e){a=e}},2),t.link(\"date-fns/intlFormat\",{default(e){u=e}},3),t.link(\"react\",{useEffect(e){c=e},useState(e){s=e}},4),t.link(\"../../lib/getCronAdvancedTimerFromPrecisionSetting\",{getCronAdvancedTimerFromPrecisionSetting(e){m=e}},5),t.link(\"../views/room/hooks/useRetentionPolicy\",{useRetentionPolicy(e){g=e}},6),t.link(\"./useFormattedRelativeTime\",{useFormattedRelativeTime(e){d=e}},7);let R=e=>{let{filesOnly:n,excludePinned:t}=e;return n?t?\"RetentionPolicy_RoomWarning_UnpinnedFilesOnly_NextRunDate\":\"RetentionPolicy_RoomWarning_FilesOnly_NextRunDate\":t?\"RetentionPolicy_RoomWarning_Unpinned_NextRunDate\":\"RetentionPolicy_RoomWarning_NextRunDate\"},_=e=>{let{enableAdvancedCronTimer:n,cronPrecision:t,advancedCronTimer:i}=e;return n?a(i):a(m(t))},P=e=>{let{enableAdvancedCronTimer:n,advancedCronTimer:t,cronPrecision:o}=e,[r,a]=i(s(_({enableAdvancedCronTimer:n,advancedCronTimer:t,cronPrecision:o}))),m=l();return c(()=>{let e=r.valueOf()-Date.now(),i=setTimeout(()=>a(_({enableAdvancedCronTimer:n,advancedCronTimer:t,cronPrecision:o})),e);return()=>clearTimeout(i)},[t,o,n,r,a]),u(new Date(r.valueOf()),{localeMatcher:\"best fit\",year:\"numeric\",month:\"long\",day:\"numeric\",hour:\"numeric\",minute:\"numeric\"},{locale:m})},y=e=>{let n=g(e);if(!n)throw Error(\"usePruneWarningMessage - No room provided\");let{maxAge:t,filesOnly:i,excludePinned:l}=n,a=String(o(\"RetentionPolicy_Precision\")),u=r(),c=!!o(\"RetentionPolicy_Advanced_Precision\"),s=String(o(\"RetentionPolicy_Advanced_Precision_Cron\")),m=R({filesOnly:i,excludePinned:l}),_=P({enableAdvancedCronTimer:c,advancedCronTimer:s,cronPrecision:a}),y=d(t);return u(m,{maxAge:y,nextRunDate:_})}}","map":"{\"version\":3,\"sources\":[\"client/hooks/usePruneWarningMessage.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom } from '@rocket.chat/core-typings';\\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\\nimport type { TranslationKey } from '@rocket.chat/ui-contexts';\\nimport { useSetting, useTranslation, useLanguage } from '@rocket.chat/ui-contexts';\\nimport { sendAt } from 'cron';\\nimport intlFormat from 'date-fns/intlFormat';\\nimport { useEffect, useState } from 'react';\\n\\nimport { getCronAdvancedTimerFromPrecisionSetting } from '../../lib/getCronAdvancedTimerFromPrecisionSetting';\\nimport { useRetentionPolicy } from '../views/room/hooks/useRetentionPolicy';\\nimport { useFormattedRelativeTime } from './useFormattedRelativeTime';\\n\\nconst getMessage = ({ filesOnly, excludePinned }: { filesOnly: boolean; excludePinned: boolean }): TranslationKey => {\\n\\tif (filesOnly) {\\n\\t\\treturn excludePinned\\n\\t\\t\\t? 'RetentionPolicy_RoomWarning_UnpinnedFilesOnly_NextRunDate'\\n\\t\\t\\t: 'RetentionPolicy_RoomWarning_FilesOnly_NextRunDate';\\n\\t}\\n\\n\\treturn excludePinned ? 'RetentionPolicy_RoomWarning_Unpinned_NextRunDate' : 'RetentionPolicy_RoomWarning_NextRunDate';\\n};\\n\\ntype CronPrecisionSetting = '0' | '1' | '2' | '3';\\nconst getNextRunDate = ({\\n\\tenableAdvancedCronTimer,\\n\\tcronPrecision,\\n\\tadvancedCronTimer,\\n}: {\\n\\tenableAdvancedCronTimer: boolean;\\n\\tcronPrecision: CronPrecisionSetting;\\n\\tadvancedCronTimer: string;\\n}) => {\\n\\tif (enableAdvancedCronTimer) {\\n\\t\\treturn sendAt(advancedCronTimer);\\n\\t}\\n\\n\\treturn sendAt(getCronAdvancedTimerFromPrecisionSetting(cronPrecision));\\n};\\n\\nconst useNextRunDate = ({\\n\\tenableAdvancedCronTimer,\\n\\tadvancedCronTimer,\\n\\tcronPrecision,\\n}: {\\n\\tenableAdvancedCronTimer: boolean;\\n\\tcronPrecision: CronPrecisionSetting;\\n\\tadvancedCronTimer: string;\\n}) => {\\n\\tconst [nextRunDate, setNextRunDate] = useSafely(useState(getNextRunDate({ enableAdvancedCronTimer, advancedCronTimer, cronPrecision })));\\n\\tconst lang = useLanguage();\\n\\n\\tuseEffect(() => {\\n\\t\\tconst timeoutBetweenRunAndNow = nextRunDate.valueOf() - Date.now();\\n\\n\\t\\tconst timeout = setTimeout(\\n\\t\\t\\t() => setNextRunDate(getNextRunDate({ enableAdvancedCronTimer, advancedCronTimer, cronPrecision })),\\n\\t\\t\\ttimeoutBetweenRunAndNow,\\n\\t\\t);\\n\\n\\t\\treturn () => clearTimeout(timeout);\\n\\t}, [advancedCronTimer, cronPrecision, enableAdvancedCronTimer, nextRunDate, setNextRunDate]);\\n\\n\\treturn intlFormat(\\n\\t\\tnew Date(nextRunDate.valueOf()),\\n\\t\\t{\\n\\t\\t\\tlocaleMatcher: 'best fit',\\n\\t\\t\\tyear: 'numeric',\\n\\t\\t\\tmonth: 'long',\\n\\t\\t\\tday: 'numeric',\\n\\t\\t\\thour: 'numeric',\\n\\t\\t\\tminute: 'numeric',\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tlocale: lang,\\n\\t\\t},\\n\\t);\\n};\\n\\nexport const usePruneWarningMessage = (room: IRoom) => {\\n\\tconst retention = useRetentionPolicy(room);\\n\\tif (!retention) {\\n\\t\\tthrow new Error('usePruneWarningMessage - No room provided');\\n\\t}\\n\\n\\tconst { maxAge, filesOnly, excludePinned } = retention;\\n\\n\\tconst cronPrecision = String(useSetting('RetentionPolicy_Precision')) as CronPrecisionSetting;\\n\\n\\tconst t = useTranslation();\\n\\n\\tconst enableAdvancedCronTimer = Boolean(useSetting('RetentionPolicy_Advanced_Precision'));\\n\\tconst advancedCronTimer = String(useSetting('RetentionPolicy_Advanced_Precision_Cron'));\\n\\n\\tconst message = getMessage({ filesOnly, excludePinned });\\n\\n\\tconst nextRunDate = useNextRunDate({\\n\\t\\tenableAdvancedCronTimer,\\n\\t\\tadvancedCronTimer,\\n\\t\\tcronPrecision,\\n\\t});\\n\\n\\tconst maxAgeFormatted = useFormattedRelativeTime(maxAge);\\n\\n\\treturn t(message, { maxAge: maxAgeFormatted, nextRunDate });\\n};\\n\",null],\"names\":[\"useSafely\",\"useSetting\",\"useTranslation\",\"useLanguage\",\"sendAt\",\"intlFormat\",\"useEffect\",\"useState\",\"getCronAdvancedTimerFromPrecisionSetting\",\"useRetentionPolicy\",\"useFormattedRelativeTime\",\"module\",\"export\",\"usePruneWarningMessage\",\"link\",\"v\",\"default\",\"getMessage\",\"_ref\",\"filesOnly\",\"excludePinned\",\"getNextRunDate\",\"_ref2\",\"enableAdvancedCronTimer\",\"cronPrecision\",\"advancedCronTimer\",\"useNextRunDate\",\"_ref3\",\"nextRunDate\",\"setNextRunDate\",\"lang\",\"timeoutBetweenRunAndNow\",\"valueOf\",\"Date\",\"now\",\"timeout\",\"setTimeout\",\"clearTimeout\",\"localeMatcher\",\"year\",\"month\",\"day\",\"hour\",\"minute\",\"locale\",\"room\",\"retention\",\"Error\",\"maxAge\",\"String\",\"t\",\"Boolean\",\"message\",\"maxAgeFormatted\"],\"mappings\":\"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\"}"}