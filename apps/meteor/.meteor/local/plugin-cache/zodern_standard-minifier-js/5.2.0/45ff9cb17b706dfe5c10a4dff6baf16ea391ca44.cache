{"code":"function module(e,n,t){t.link(\"@babel/runtime/regenerator\",{default:function(e){o=e}},0),t.link(\"@rocket.chat/random\",{Random:function(e){r=e}},0),t.link(\"meteor/accounts-base\",{Accounts:function(e){i=e}},1),t.link(\"meteor/meteor\",{Meteor:function(e){a=e}},2),t.link(\"../../../app/settings/client\",{settings:function(e){l=e}},3),t.link(\"../../lib/2fa/overrideLoginMethod\",{callLoginMethod:function(e){u=e},handleLogin:function(e){c=e}},4),i.saml||(i.saml={});var o,r,i,a,l,u,c,s=a.logout;a.logout=function(){var e,n,r,u,c,d=arguments;return o.async(function(m){for(;;)switch(m.prev=m.next){case 0:for(n=Array(e=d.length),r=0;r<e;r++)n[r]=d[r];if(u=function(){return s.apply(a,n)},l.get(\"SAML_Custom_Default\")){m.next=4;break}return m.abrupt(\"return\",u());case 4:if(\"Local\"!==l.get(\"SAML_Custom_Default_logout_behaviour\")){m.next=7;break}return console.info(\"SAML session not terminated, only the Rocket.Chat session is going to be killed\"),m.abrupt(\"return\",u());case 7:if(!((c=l.get(\"SAML_Custom_Default_provider\"))&&l.get(\"SAML_Custom_Default_idp_slo_redirect_url\"))){m.next=16;break}return console.info(\"SAML session terminated via SLO\"),m.next=12,o.awrap(t.dynamicImport(\"../../../app/utils/client/lib/SDKClient\"));case 12:return m.sent.sdk.call(\"samlLogout\",c).then(function(e){if(!e){s.apply(a);return}i.storageLocation.removeItem(i.USER_ID_KEY),window.location.replace(a.absoluteUrl(\"_saml/sloRedirect/\"+c+\"/?redirect=\"+encodeURIComponent(e)))}).catch(function(){return s.apply(a)}),m.abrupt(\"return\");case 16:return m.abrupt(\"return\",u());case 17:case\"end\":return m.stop()}},null,null,null,Promise)},a.loginWithSaml=function(e){e=e||{};var n=\"id-\"+r.id();e.credentialToken=n,window.location.href=\"_saml/authorize/\"+e.provider+\"/\"+e.credentialToken},a.loginWithSamlToken=c(function(e){return u({methodArguments:[{saml:!0,credentialToken:e}]})},function(e,n){return u({methodArguments:[{totp:{login:{saml:!0,credentialToken:e},code:n}}]})})}","map":"{\"version\":3,\"sources\":[\"client/meteorOverrides/login/saml.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Random } from '@rocket.chat/random';\\nimport { Accounts } from 'meteor/accounts-base';\\nimport { Meteor } from 'meteor/meteor';\\n\\nimport { settings } from '../../../app/settings/client';\\nimport { type LoginCallback, callLoginMethod, handleLogin } from '../../lib/2fa/overrideLoginMethod';\\n\\ndeclare module 'meteor/meteor' {\\n\\t// eslint-disable-next-line @typescript-eslint/no-namespace\\n\\tnamespace Meteor {\\n\\t\\tfunction loginWithSamlToken(credentialToken: string, callback?: LoginCallback): void;\\n\\n\\t\\tfunction loginWithSaml(options: { provider: string; credentialToken?: string }): void;\\n\\t}\\n}\\n\\ndeclare module 'meteor/accounts-base' {\\n\\t// eslint-disable-next-line @typescript-eslint/no-namespace\\n\\tnamespace Accounts {\\n\\t\\texport let saml: {\\n\\t\\t\\tcredentialToken?: string;\\n\\t\\t\\tcredentialSecret?: string;\\n\\t\\t};\\n\\n\\t\\t/**\\n\\t\\t * There is one case where the onlogout event is triggered with no user:\\n\\t\\t * during the deletion, the user is logged out, and the framework try to get the user from the database.\\n\\t\\t */\\n\\t\\tfunction onLogout(func: (options: { user?: Meteor.User; connection: Meteor.Connection }) => void): void;\\n\\t}\\n}\\n\\ndeclare module 'meteor/service-configuration' {\\n\\t// eslint-disable-next-line @typescript-eslint/naming-convention\\n\\tinterface Configuration {\\n\\t\\tlogoutBehaviour?: 'SAML' | 'Local';\\n\\t\\tidpSLORedirectURL?: string;\\n\\t}\\n}\\n\\nif (!Accounts.saml) {\\n\\tAccounts.saml = {};\\n}\\n\\nconst { logout } = Meteor;\\n\\nMeteor.logout = async function (...args) {\\n\\tconst standardLogout = () => logout.apply(Meteor, args);\\n\\n\\tif (!settings.get('SAML_Custom_Default')) {\\n\\t\\treturn standardLogout();\\n\\t}\\n\\n\\tif (settings.get('SAML_Custom_Default_logout_behaviour') === 'Local') {\\n\\t\\tconsole.info('SAML session not terminated, only the Rocket.Chat session is going to be killed');\\n\\t\\treturn standardLogout();\\n\\t}\\n\\n\\tconst provider = settings.get('SAML_Custom_Default_provider');\\n\\n\\tif (provider && settings.get('SAML_Custom_Default_idp_slo_redirect_url')) {\\n\\t\\tconsole.info('SAML session terminated via SLO');\\n\\n\\t\\tconst { sdk } = await import('../../../app/utils/client/lib/SDKClient');\\n\\t\\tsdk\\n\\t\\t\\t.call('samlLogout', provider)\\n\\t\\t\\t.then((result) => {\\n\\t\\t\\t\\tif (!result) {\\n\\t\\t\\t\\t\\tlogout.apply(Meteor);\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t// Remove the userId from the client to prevent calls to the server while the logout is processed.\\n\\t\\t\\t\\t// If the logout fails, the userId will be reloaded on the resume call\\n\\t\\t\\t\\tAccounts.storageLocation.removeItem(Accounts.USER_ID_KEY);\\n\\n\\t\\t\\t\\t// A nasty bounce: 'result' has the SAML LogoutRequest but we need a proper 302 to redirected from the server.\\n\\t\\t\\t\\twindow.location.replace(Meteor.absoluteUrl(`_saml/sloRedirect/${provider}/?redirect=${encodeURIComponent(result)}`));\\n\\t\\t\\t})\\n\\t\\t\\t.catch(() => logout.apply(Meteor));\\n\\t\\treturn;\\n\\t}\\n\\n\\treturn standardLogout();\\n};\\n\\nMeteor.loginWithSaml = (options) => {\\n\\toptions = options || {};\\n\\tconst credentialToken = `id-${Random.id()}`;\\n\\toptions.credentialToken = credentialToken;\\n\\n\\twindow.location.href = `_saml/authorize/${options.provider}/${options.credentialToken}`;\\n};\\n\\nconst loginWithSamlToken = (credentialToken: string) =>\\n\\tcallLoginMethod({\\n\\t\\tmethodArguments: [\\n\\t\\t\\t{\\n\\t\\t\\t\\tsaml: true,\\n\\t\\t\\t\\tcredentialToken,\\n\\t\\t\\t},\\n\\t\\t],\\n\\t});\\n\\nconst loginWithSamlTokenAndTOTP = (credentialToken: string, code: string) =>\\n\\tcallLoginMethod({\\n\\t\\tmethodArguments: [\\n\\t\\t\\t{\\n\\t\\t\\t\\ttotp: {\\n\\t\\t\\t\\t\\tlogin: {\\n\\t\\t\\t\\t\\t\\tsaml: true,\\n\\t\\t\\t\\t\\t\\tcredentialToken,\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\tcode,\\n\\t\\t\\t\\t},\\n\\t\\t\\t},\\n\\t\\t],\\n\\t});\\n\\nMeteor.loginWithSamlToken = handleLogin(loginWithSamlToken, loginWithSamlTokenAndTOTP);\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"Random\",\"Accounts\",\"Meteor\",\"settings\",\"callLoginMethod\",\"handleLogin\",\"saml\",\"logout\",\"_Meteor\",\"_len\",\"args\",\"_key\",\"standardLogout\",\"provider\",\"_args\",\"arguments\",\"async\",\"_context\",\"prev\",\"next\",\"Array\",\"length\",\"apply\",\"get\",\"abrupt\",\"console\",\"info\",\"awrap\",\"dynamicImport\",\"sdk\",\"_await$module$dynamic\",\"sent\",\"call\",\"then\",\"result\",\"storageLocation\",\"removeItem\",\"USER_ID_KEY\",\"window\",\"location\",\"replace\",\"absoluteUrl\",\"encodeURIComponent\",\"catch\",\"stop\",\"Promise\",\"loginWithSaml\",\"options\",\"credentialToken\",\"id\",\"href\",\"loginWithSamlToken\",\"methodArguments\",\"code\",\"totp\",\"login\"],\"mappings\":\"uBAAuBA,EAAAC,IAAA,CAAA,6BAAsB,CAAAC,QAAA,SAAAC,CAAA,EAAAC,EAAAD,CAAA,CAAA,EAAA,GAApCH,EAAQC,IAAA,CAAM,sBAAsB,CAAAI,OAAA,SAAAF,CAAA,EAAAE,EAAAF,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uBAAA,CAAAK,SAAA,SAAAH,CAAA,EAAAG,EAAAH,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,gBAAA,CAAAM,OAAA,SAAAJ,CAAA,EAAAI,EAAAJ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,+BAAA,CAAAO,SAAA,SAAAL,CAAA,EAAAK,EAAAL,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,oCAAA,CAAAQ,gBAAA,SAAAN,CAAA,EAAAM,EAAAN,CAAA,EAAAO,YAAA,SAAAP,CAAA,EAAAO,EAAAP,CAAA,CAAA,EAAA,GAwCxCG,EAASK,IAAI,EACjBL,CAAAA,EAASK,IAAI,CAAG,CAAA,CAAA,EAGjB,IA5CAP,EAAAC,EAA6CC,EAAAC,EAAAC,EAAAC,EAAAC,EA4CrCE,EAAMC,AAAKN,EAAXK,MAAM,AAEdL,CAAAA,EAAOK,MAAM,CAAG,WAAA,IAAAE,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,UAAA,OAAAhB,EAAAiB,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAAA,IAAAV,AAAmBC,EAAI,AAAAU,MAAvBX,EAAAK,EAAAO,MAAA,EAAuBV,EAAA,EAAAA,EAAAF,EAAAE,IAAJD,CAAI,CAAAC,EAAA,CAAAG,CAAA,CAAAH,EAAA,CACiB,GAAjDC,EAAiB,WAAA,OAAML,EAAOe,KAAK,CAACpB,EAAQQ,EAAK,EAElDP,EAASoB,GAAG,CAAC,uBAAsB,CAAAN,EAAAE,IAAA,CAAA,EAAA,KAAA,CAAA,OAAAF,EAAAO,MAAA,CAAA,SAChCZ,IAAgB,MAAA,EAAA,GAAA,AAGqC,UAAzDT,EAASoB,GAAG,CAAC,wCAAmD,CAAAN,EAAAE,IAAA,CAAA,EAAA,KAAA,CAC6B,OAAhGM,QAAQC,IAAI,CAAC,mFAAmFT,EAAAO,MAAA,CAAA,SACzFZ,IAAgB,MAAA,EAGqC,GAAA,CAEzDC,CAAAA,AAFEA,CAAAA,EAAWV,EAASoB,GAAG,CAAC,+BAA8B,GAE5CpB,EAASoB,GAAG,CAAC,2CAA0C,EAAC,CAAAN,EAAAE,IAAA,CAAA,GAAA,KAAA,CACvB,OAAhDM,QAAQC,IAAI,CAAC,mCAAmCT,EAAAE,IAAA,CAAA,GAAApB,EAAA4B,KAAA,CAE1BhC,EAAAiC,aAAA,CAAO,2CAA0C,MAAA,GAgBnC,OAfpCC,AADWC,AAA4Db,EAAAc,IAAA,CAA/DF,GAAG,CAETG,IAAI,CAAC,aAAcnB,GACnBoB,IAAI,CAAC,SAACC,CAAM,EACZ,GAAI,CAACA,EAAQ,CACZ3B,EAAOe,KAAK,CAACpB,GACb,MACD,CAIAD,EAASkC,eAAe,CAACC,UAAU,CAACnC,EAASoC,WAAW,EAGxDC,OAAOC,QAAQ,CAACC,OAAO,CAACtC,EAAOuC,WAAW,CAAA,qBAAsB5B,EAAQ,cAAc6B,mBAAmBR,IAC1G,GACCS,KAAK,CAAC,WAAA,OAAMpC,EAAOe,KAAK,CAACpB,EAAO,GAAEe,EAAAO,MAAA,CAAA,SAAA,MAAA,GAAA,OAAAP,EAAAO,MAAA,CAAA,SAI9BZ,IAAgB,MAAA,GAAA,IAAA,MAAA,OAAAK,EAAA2B,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,EAGxB3C,EAAO4C,aAAa,CAAG,SAACC,CAAO,EAC9BA,EAAUA,GAAW,CAAA,EACrB,IAAMC,EAAe,MAAShD,EAAOiD,EAAE,EACvCF,CAAAA,EAAQC,eAAe,CAAGA,EAE1BV,OAAOC,QAAQ,CAACW,IAAI,CAAA,mBAAsBH,EAAQlC,QAAQ,CAAA,IAAIkC,EAAQC,eAAiB,AACxF,EA2BA9C,EAAOiD,kBAAkB,CAAG9C,EAzBD,SAAC2C,CAAuB,EAAA,OAClD5C,EAAgB,CACfgD,gBAAiB,CAChB,CACC9C,KAAM,CAAA,EACN0C,gBAAAA,GACA,EAED,EAE+B,SAACA,CAAuB,CAAEK,CAAY,EAAA,OACvEjD,EAAgB,CACfgD,gBAAiB,CAChB,CACCE,KAAM,CACLC,MAAO,CACNjD,KAAM,CAAA,EACN0C,gBAAAA,GAEDK,KAAAA,IAED,EAED\"}"}