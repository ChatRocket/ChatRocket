{"code":"function module(n,e,t){var u,r,c,a,i,l,o,s,f,d,m;t.link(\"@babel/runtime/helpers/extends\",{default:function(n){u=n}},0),t.link(\"@babel/runtime/regenerator\",{default:function(n){r=n}},1),t.link(\"@rocket.chat/core-typings\",{BannerPlatform:function(n){c=n}},0),t.link(\"@rocket.chat/ui-contexts\",{useEndpoint:function(n){a=n},useStream:function(n){i=n},useUserId:function(n){l=n}},1),t.link(\"@tanstack/react-query\",{useQuery:function(n){o=n},useQueryClient:function(n){s=n}},2),t.link(\"react\",{default:function(n){f=n},useEffect:function(n){d=n}},3),t.link(\"./CloudAnnouncementHandler\",{default:function(n){m=n}},4),t.exportDefault(function(){var n=l(),e=a(\"GET\",\"/v1/banners\"),t=o({queryKey:[\"cloud\",\"announcements\"],queryFn:function(){return e({platform:c.Web})},select:function(n){return n.banners},enabled:!!n,staleTime:0,refetchInterval:864e5}),y=t.isSuccess,k=t.data,b=i(\"notify-logged\"),p=i(\"notify-user\"),v=s();return(d(function(){if(n){var e=b(\"banner-changed\",function(){return r.async(function(n){for(;;)switch(n.prev=n.next){case 0:v.invalidateQueries([\"cloud\",\"announcements\"]);case 1:case\"end\":return n.stop()}},null,null,null,Promise)}),t=p(n+\"/banners\",function(){return r.async(function(n){for(;;)switch(n.prev=n.next){case 0:v.invalidateQueries([\"cloud\",\"announcements\"]);case 1:case\"end\":return n.stop()}},null,null,null,Promise)});return function(){e(),t()}}},[b,n,p,v]),y)?f.createElement(f.Fragment,null,k.map(function(n){return f.createElement(m,u({key:n._id},n))})):null})}","map":"{\"version\":3,\"sources\":[\"client/views/cloud/CloudAnnouncementsRegion.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { BannerPlatform } from '@rocket.chat/core-typings';\\nimport { useEndpoint, useStream, useUserId } from '@rocket.chat/ui-contexts';\\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\\nimport React, { useEffect } from 'react';\\n\\nimport CloudAnnouncementHandler from './CloudAnnouncementHandler';\\n\\nconst CloudAnnouncementsRegion = () => {\\n\\tconst uid = useUserId();\\n\\n\\tconst getAnnouncements = useEndpoint('GET', '/v1/banners');\\n\\n\\tconst { isSuccess, data: announcements } = useQuery({\\n\\t\\tqueryKey: ['cloud', 'announcements'],\\n\\t\\tqueryFn: () => getAnnouncements({ platform: BannerPlatform.Web }),\\n\\t\\tselect: (data) => data.banners,\\n\\t\\tenabled: !!uid,\\n\\t\\tstaleTime: 0,\\n\\t\\trefetchInterval: 1000 * 60 * 60 * 24,\\n\\t});\\n\\n\\tconst subscribeToNotifyLoggedIn = useStream('notify-logged');\\n\\tconst subscribeToNotifyUser = useStream('notify-user');\\n\\tconst queryClient = useQueryClient();\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!uid) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst unsubscribeFromBannerChanged = subscribeToNotifyLoggedIn('banner-changed', async () => {\\n\\t\\t\\tqueryClient.invalidateQueries(['cloud', 'announcements']);\\n\\t\\t});\\n\\n\\t\\tconst unsubscribeBanners = subscribeToNotifyUser(`${uid}/banners`, async () => {\\n\\t\\t\\tqueryClient.invalidateQueries(['cloud', 'announcements']);\\n\\t\\t});\\n\\n\\t\\treturn () => {\\n\\t\\t\\tunsubscribeFromBannerChanged();\\n\\t\\t\\tunsubscribeBanners();\\n\\t\\t};\\n\\t}, [subscribeToNotifyLoggedIn, uid, subscribeToNotifyUser, queryClient]);\\n\\n\\tif (!isSuccess) {\\n\\t\\treturn null;\\n\\t}\\n\\n\\treturn (\\n\\t\\t<>\\n\\t\\t\\t{announcements.map((announcement) => (\\n\\t\\t\\t\\t<CloudAnnouncementHandler key={announcement._id} {...announcement} />\\n\\t\\t\\t))}\\n\\t\\t</>\\n\\t);\\n};\\n\\nexport default CloudAnnouncementsRegion;\\n\",null],\"names\":[\"_extends\",\"_regeneratorRuntime\",\"BannerPlatform\",\"useEndpoint\",\"useStream\",\"useUserId\",\"useQuery\",\"useQueryClient\",\"React\",\"useEffect\",\"CloudAnnouncementHandler\",\"module\",\"link\",\"default\",\"v\",\"exportDefault\",\"uid\",\"getAnnouncements\",\"_useQuery\",\"queryKey\",\"queryFn\",\"platform\",\"Web\",\"select\",\"data\",\"banners\",\"enabled\",\"staleTime\",\"refetchInterval\",\"isSuccess\",\"announcements\",\"subscribeToNotifyLoggedIn\",\"subscribeToNotifyUser\",\"queryClient\",\"unsubscribeFromBannerChanged\",\"async\",\"_context\",\"prev\",\"next\",\"invalidateQueries\",\"stop\",\"Promise\",\"unsubscribeBanners\",\"_context2\",\"createElement\",\"Fragment\",\"map\",\"announcement\",\"key\",\"_id\"],\"mappings\":\"uBAOA,IAPAA,EAA2DC,EAA3DC,EAA2DC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAlDC,EAAAC,IAAc,CAAE,iCAAiC,CAACC,QAAA,SAAAC,CAAA,EAAAd,EAAAc,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,6BAAA,CAAAC,QAAA,SAAAC,CAAA,EAAAb,EAAAa,CAAA,CAAA,EAAA,GAAlDH,EAAgBC,IAAA,CAAM,4BAA4B,CAAAV,eAAA,SAAAY,CAAA,EAAAZ,EAAAY,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,2BAAA,CAAAT,YAAA,SAAAW,CAAA,EAAAX,EAAAW,CAAA,EAAAV,UAAA,SAAAU,CAAA,EAAAV,EAAAU,CAAA,EAAAT,UAAA,SAAAS,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,wBAAA,CAAAN,SAAA,SAAAQ,CAAA,EAAAR,EAAAQ,CAAA,EAAAP,eAAA,SAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,QAAA,CAAA,QAAA,SAAAE,CAAA,EAAAN,EAAAM,CAAA,EAAAL,UAAA,SAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,6BAAA,CAAA,QAAA,SAAAE,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAA3DH,EAAOI,aAAE,CAOwB,WAChC,IAAMC,EAAMX,IAENY,EAAmBd,EAAY,MAAO,eAE5Ce,EAA2CZ,EAAS,CACnDa,SAAU,CAAC,QAAS,gBAAgB,CACpCC,QAAS,WAAA,OAAMH,EAAiB,CAAEI,SAAUnB,EAAeoB,GAAAA,AAAG,EAAG,EACjEC,OAAQ,SAACC,CAAI,EAAA,OAAKA,EAAKC,OAAO,EAC9BC,QAAS,CAAC,CAACV,EACXW,UAAW,EACXC,gBAAiB,QANVC,EAASX,EAATW,SAAS,CAAQC,EAAaZ,EAAnBM,IAAI,CASjBO,EAA4B3B,EAAU,iBACtC4B,EAAwB5B,EAAU,eAClC6B,EAAc1B,UAqBpB,CAnBAE,EAAU,WACT,GAAKO,GAIL,IAAMkB,EAA+BH,EAA0B,iBAAkB,WAAA,OAAA9B,EAAAkC,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAChFL,EAAYM,iBAAiB,CAAC,CAAC,QAAS,gBAAgB,CAAE,MAAA,EAAA,IAAA,MAAA,OAAAH,EAAAI,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,GAGrDC,EAAqBV,EAAyBhB,EAAG,WAAY,WAAA,OAAAf,EAAAkC,KAAA,CAAA,SAAAQ,CAAA,EAAA,OAAA,OAAAA,EAAAN,IAAA,CAAAM,EAAAL,IAAA,EAAA,KAAA,EAClEL,EAAYM,iBAAiB,CAAC,CAAC,QAAS,gBAAgB,CAAE,MAAA,EAAA,IAAA,MAAA,OAAAI,EAAAH,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,GAG3D,OAAO,WACNP,IACAQ,GACD,EACD,EAAG,CAACX,EAA2Bf,EAAKgB,EAAuBC,EAAY,EAElEJ,GAKJrB,EAAAoC,aAAA,CAAApC,EAAAqC,QAAA,CAAA,KACEf,EAAcgB,GAAG,CAAC,SAACC,CAAY,EAAA,OAC/BvC,EAAAoC,aAAA,CAAClC,EAAwBV,EAAA,CAACgD,IAAKD,EAAaE,GAAAA,AAAI,EAAKF,GAAgB,IANhE,IAUT\"}"}