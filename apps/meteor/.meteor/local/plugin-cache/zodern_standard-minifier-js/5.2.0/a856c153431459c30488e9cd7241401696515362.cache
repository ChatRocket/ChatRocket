{"code":"function module(e,n,t){t.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){o=e}},0),t.link(\"@babel/runtime/helpers/toConsumableArray\",{default:function(e){s=e}},1),t.export({useMessages:function(){return h}}),t.link(\"@rocket.chat/fuselage-hooks\",{useStableArray:function(e){i=e}},0),t.link(\"@rocket.chat/ui-contexts\",{useSetting:function(e){u=e},useUserPreference:function(e){r=e}},1),t.link(\"react\",{useCallback:function(e){a=e},useMemo:function(e){c=e}},2),t.link(\"../../../../../app/models/client\",{ChatMessage:function(e){l=e}},3),t.link(\"../../../../hooks/useReactiveValue\",{useReactiveValue:function(e){f=e}},4),t.link(\"../../contexts/RoomContext\",{useRoom:function(e){d=e}},5);var o,s,i,u,r,a,c,l,f,d,h=function(e){var n,t=e.rid,h=r(\"showThreadsInMainChannel\",!1),k=null!==(n=u(\"Hide_System_Messages\"))&&void 0!==n?n:[],m=d(),b=Array.isArray(m.sysMes)?m.sysMes:[],y=i(Array.from(new Set([].concat(s(k),s(b))))),M=c(function(){return o({rid:t,_hidden:{$ne:!0},t:{$nin:y}},!h&&{$or:[{tmid:{$exists:!1}},{tshow:{$eq:!0}}]})},[t,y,h]);return f(a(function(){return l.find(M,{sort:{ts:1}}).fetch()},[M]))}}","map":"{\"version\":3,\"sources\":[\"client/views/room/MessageList/hooks/useMessages.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom, IMessage, MessageTypesValues } from '@rocket.chat/core-typings';\\nimport { useStableArray } from '@rocket.chat/fuselage-hooks';\\nimport { useSetting, useUserPreference } from '@rocket.chat/ui-contexts';\\nimport type { Mongo } from 'meteor/mongo';\\nimport { useCallback, useMemo } from 'react';\\n\\nimport { ChatMessage } from '../../../../../app/models/client';\\nimport { useReactiveValue } from '../../../../hooks/useReactiveValue';\\nimport { useRoom } from '../../contexts/RoomContext';\\n\\nconst mergeHideSysMessages = (\\n\\tsysMesArray1: Array<MessageTypesValues>,\\n\\tsysMesArray2: Array<MessageTypesValues>,\\n): Array<MessageTypesValues> => {\\n\\treturn Array.from(new Set([...sysMesArray1, ...sysMesArray2]));\\n};\\n\\nexport const useMessages = ({ rid }: { rid: IRoom['_id'] }): IMessage[] => {\\n\\tconst showThreadsInMainChannel = useUserPreference<boolean>('showThreadsInMainChannel', false);\\n\\tconst hideSysMesSetting = useSetting<MessageTypesValues[]>('Hide_System_Messages') ?? [];\\n\\tconst room = useRoom();\\n\\tconst hideRoomSysMes: Array<MessageTypesValues> = Array.isArray(room.sysMes) ? room.sysMes : [];\\n\\n\\tconst hideSysMessages = useStableArray(mergeHideSysMessages(hideSysMesSetting, hideRoomSysMes));\\n\\n\\tconst query: Mongo.Selector<IMessage> = useMemo(\\n\\t\\t() => ({\\n\\t\\t\\trid,\\n\\t\\t\\t_hidden: { $ne: true },\\n\\t\\t\\tt: { $nin: hideSysMessages },\\n\\t\\t\\t...(!showThreadsInMainChannel && {\\n\\t\\t\\t\\t$or: [{ tmid: { $exists: false } }, { tshow: { $eq: true } }],\\n\\t\\t\\t}),\\n\\t\\t}),\\n\\t\\t[rid, hideSysMessages, showThreadsInMainChannel],\\n\\t);\\n\\n\\treturn useReactiveValue(\\n\\t\\tuseCallback(\\n\\t\\t\\t() =>\\n\\t\\t\\t\\tChatMessage.find(query, {\\n\\t\\t\\t\\t\\tsort: {\\n\\t\\t\\t\\t\\t\\tts: 1,\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t}).fetch(),\\n\\t\\t\\t[query],\\n\\t\\t),\\n\\t);\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_objectSpread\",\"_toConsumableArray\",\"export\",\"useMessages\",\"useStableArray\",\"useSetting\",\"useUserPreference\",\"useCallback\",\"useMemo\",\"ChatMessage\",\"useReactiveValue\",\"useRoom\",\"_ref\",\"_useSetting\",\"rid\",\"showThreadsInMainChannel\",\"hideSysMesSetting\",\"room\",\"hideRoomSysMes\",\"Array\",\"isArray\",\"sysMes\",\"hideSysMessages\",\"from\",\"Set\",\"concat\",\"query\",\"_hidden\",\"$ne\",\"t\",\"$nin\",\"$or\",\"tmid\",\"$exists\",\"tshow\",\"$eq\",\"find\",\"sort\",\"ts\",\"fetch\"],\"mappings\":\"uBACSA,EAAgBC,IAAA,CAAA,uCAAoC,CAAAC,QAAA,SAAAC,CAAA,EAAAC,EAAAD,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,2CAAA,CAAAC,QAAA,SAAAC,CAAA,EAAAE,EAAAF,CAAA,CAAA,EAAA,GAA7DH,EAAOM,MAAE,CAAA,CAAAC,YAAgB,WAAM,OAAAA,CAAA,CAAA,GAA8BP,EAAAC,IAAA,CAAA,8BAAA,CAAAO,eAAA,SAAAL,CAAA,EAAAK,EAAAL,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,2BAAA,CAAAQ,WAAA,SAAAN,CAAA,EAAAM,EAAAN,CAAA,EAAAO,kBAAA,SAAAP,CAAA,EAAAO,EAAAP,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,QAAA,CAAAU,YAAA,SAAAR,CAAA,EAAAQ,EAAAR,CAAA,EAAAS,QAAA,SAAAT,CAAA,EAAAS,EAAAT,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,mCAAA,CAAAY,YAAA,SAAAV,CAAA,EAAAU,EAAAV,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,qCAAA,CAAAa,iBAAA,SAAAX,CAAA,EAAAW,EAAAX,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,6BAAA,CAAAc,QAAA,SAAAZ,CAAA,EAAAY,EAAAZ,CAAA,CAAA,EAAA,GAgBtD,IAhBPC,EAA6DC,EAAAG,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAgBhDR,EAAc,SAAAS,CAAA,EAA+C,IAAAC,EAA5CC,EAAGF,EAAHE,GAAG,CAC1BC,EAA2BT,EAA2B,2BAA4B,CAAA,GAClFU,EAAiB,AAA2D,OAA3DH,CAAAA,EAAGR,EAAiC,uBAAsB,GAACQ,AAAA,KAAA,IAAAA,EAAAA,EAAI,EAAE,CAClFI,EAAON,IACPO,EAA4CC,MAAMC,OAAO,CAACH,EAAKI,MAAM,EAAIJ,EAAKI,MAAM,CAAG,EAAE,CAEzFC,EAAkBlB,EATjBe,MAAMI,IAAI,CAAC,IAAIC,IAAG,EAAA,CAAAC,MAAA,CAAAxB,EASmCe,GATlBf,EASqCiB,OAEzEQ,EAAkClB,EACvC,WAAA,OAAAR,EAAA,CACCc,IAAAA,EACAa,QAAS,CAAEC,IAAK,CAAA,CAAI,EACpBC,EAAG,CAAEC,KAAMR,CAAe,CAAE,EACxB,CAACP,GAA4B,CAChCgB,IAAK,CAAC,CAAEC,KAAM,CAAEC,QAAS,CAAA,CAAK,CAAE,EAAI,CAAEC,MAAO,CAAEC,IAAK,CAAA,CAAI,CAAE,EAAE,EAC5D,EAEF,CAACrB,EAAKQ,EAAiBP,EAAyB,EAGjD,OAAOL,EACNH,EACC,WAAA,OACCE,EAAY2B,IAAI,CAACV,EAAO,CACvBW,KAAM,CACLC,GAAI,KAEHC,KAAK,EAAE,EACX,CAACb,EAAM,EAGV\"}"}