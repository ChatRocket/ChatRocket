{"code":"function module(e,t,i){let n,r,l,c,s,a,o,d,u,g,v,b,k,y;i.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){n=e}},0),i.link(\"@rocket.chat/ui-contexts\",{SettingsContext(e){r=e},useAtLeastOnePermission(e){l=e},useMethod(e){c=e}},0),i.link(\"meteor/tracker\",{Tracker(e){s=e}},1),i.link(\"react\",{default(e){a=e},useCallback(e){o=e},useEffect(e){d=e},useMemo(e){u=e},useState(e){g=e}},2),i.link(\"../lib/createReactiveSubscriptionFactory\",{createReactiveSubscriptionFactory(e){v=e}},3),i.link(\"../lib/queryClient\",{queryClient(e){b=e}},4),i.link(\"../lib/settings/PrivateSettingsCachedCollection\",{PrivateSettingsCachedCollection(e){k=e}},5),i.link(\"../lib/settings/PublicSettingsCachedCollection\",{PublicSettingsCachedCollection(e){y=e}},6),i.exportDefault(e=>{let{children:t,privileged:i=!1}=e,C=l(u(()=>[\"view-privileged-setting\",\"edit-privileged-setting\",\"manage-selected-settings\"],[])),f=i&&C,h=u(()=>f?k:y,[f]),[p,S]=g(()=>s.nonreactive(()=>!h.ready.get()));d(()=>{let e=!0,t=async()=>{s.nonreactive(()=>h.ready.get())||await h.init(),e&&S(!1)};return t(),()=>{e=!1}},[h]);let _=u(()=>v(e=>{let t=h.collection.findOne(e);return t?n({},t):void 0}),[h]),m=u(()=>v(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return h.collection.find(n(n(n(n({},\"_id\"in e&&Array.isArray(e._id)&&{_id:{$in:e._id}}),\"_id\"in e&&!Array.isArray(e._id)&&{_id:e._id}),\"group\"in e&&{group:e.group}),\"section\"in e&&(e.section?{section:e.section}:{$or:[{section:{$exists:!1}},{section:void 0}]})),{sort:{section:1,sorter:1,i18nLabel:1}}).fetch()}),[h]),P=e=>{e.forEach(e=>{\"Enterprise_License\"===e._id&&b.invalidateQueries([\"licenses\"])})},A=c(\"saveSettings\"),x=o(async e=>{P(e),await A(e)},[A]),E=u(()=>({hasPrivateAccess:f,isLoading:p,querySetting:_,querySettings:m,dispatch:x}),[f,p,_,m,x]);return a.createElement(r.Provider,{children:t,value:E})})}","map":"{\"version\":3,\"sources\":[\"client/providers/SettingsProvider.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { ISetting } from '@rocket.chat/core-typings';\\nimport type { SettingsContextValue } from '@rocket.chat/ui-contexts';\\nimport { SettingsContext, useAtLeastOnePermission, useMethod } from '@rocket.chat/ui-contexts';\\nimport { Tracker } from 'meteor/tracker';\\nimport type { ReactNode } from 'react';\\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\\n\\nimport { createReactiveSubscriptionFactory } from '../lib/createReactiveSubscriptionFactory';\\nimport { queryClient } from '../lib/queryClient';\\nimport { PrivateSettingsCachedCollection } from '../lib/settings/PrivateSettingsCachedCollection';\\nimport { PublicSettingsCachedCollection } from '../lib/settings/PublicSettingsCachedCollection';\\n\\ntype SettingsProviderProps = {\\n\\tchildren?: ReactNode;\\n\\tprivileged?: boolean;\\n};\\n\\nconst SettingsProvider = ({ children, privileged = false }: SettingsProviderProps) => {\\n\\tconst hasPrivilegedPermission = useAtLeastOnePermission(\\n\\t\\tuseMemo(() => ['view-privileged-setting', 'edit-privileged-setting', 'manage-selected-settings'], []),\\n\\t);\\n\\n\\tconst hasPrivateAccess = privileged && hasPrivilegedPermission;\\n\\n\\tconst cachedCollection = useMemo(\\n\\t\\t() => (hasPrivateAccess ? PrivateSettingsCachedCollection : PublicSettingsCachedCollection),\\n\\t\\t[hasPrivateAccess],\\n\\t);\\n\\n\\tconst [isLoading, setLoading] = useState(() => Tracker.nonreactive(() => !cachedCollection.ready.get()));\\n\\n\\tuseEffect(() => {\\n\\t\\tlet mounted = true;\\n\\n\\t\\tconst initialize = async (): Promise<void> => {\\n\\t\\t\\tif (!Tracker.nonreactive(() => cachedCollection.ready.get())) {\\n\\t\\t\\t\\tawait cachedCollection.init();\\n\\t\\t\\t}\\n\\n\\t\\t\\tif (!mounted) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tsetLoading(false);\\n\\t\\t};\\n\\n\\t\\tinitialize();\\n\\n\\t\\treturn (): void => {\\n\\t\\t\\tmounted = false;\\n\\t\\t};\\n\\t}, [cachedCollection]);\\n\\n\\tconst querySetting = useMemo(\\n\\t\\t() =>\\n\\t\\t\\tcreateReactiveSubscriptionFactory((_id): ISetting | undefined => {\\n\\t\\t\\t\\tconst subscription = cachedCollection.collection.findOne(_id);\\n\\t\\t\\t\\treturn subscription ? { ...subscription } : undefined;\\n\\t\\t\\t}),\\n\\t\\t[cachedCollection],\\n\\t);\\n\\n\\tconst querySettings = useMemo(\\n\\t\\t() =>\\n\\t\\t\\tcreateReactiveSubscriptionFactory((query = {}) =>\\n\\t\\t\\t\\tcachedCollection.collection\\n\\t\\t\\t\\t\\t.find(\\n\\t\\t\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\t\\t...('_id' in query && Array.isArray(query._id) && { _id: { $in: query._id } }),\\n\\t\\t\\t\\t\\t\\t\\t...('_id' in query && !Array.isArray(query._id) && { _id: query._id }),\\n\\t\\t\\t\\t\\t\\t\\t...('group' in query && { group: query.group }),\\n\\t\\t\\t\\t\\t\\t\\t...('section' in query &&\\n\\t\\t\\t\\t\\t\\t\\t\\t(query.section\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t? { section: query.section }\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t: {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t$or: [{ section: { $exists: false } }, { section: undefined }],\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t  })),\\n\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\t\\tsort: {\\n\\t\\t\\t\\t\\t\\t\\t\\tsection: 1,\\n\\t\\t\\t\\t\\t\\t\\t\\tsorter: 1,\\n\\t\\t\\t\\t\\t\\t\\t\\ti18nLabel: 1,\\n\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t)\\n\\t\\t\\t\\t\\t.fetch(),\\n\\t\\t\\t),\\n\\t\\t[cachedCollection],\\n\\t);\\n\\n\\tconst settingsChangeCallback = (changes: { _id: string }[]): void => {\\n\\t\\tchanges.forEach((val) => {\\n\\t\\t\\tswitch (val._id) {\\n\\t\\t\\t\\tcase 'Enterprise_License':\\n\\t\\t\\t\\t\\tqueryClient.invalidateQueries(['licenses']);\\n\\t\\t\\t\\t\\tbreak;\\n\\n\\t\\t\\t\\tdefault:\\n\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t}\\n\\t\\t});\\n\\t};\\n\\n\\tconst saveSettings = useMethod('saveSettings');\\n\\tconst dispatch = useCallback(\\n\\t\\tasync (changes) => {\\n\\t\\t\\tsettingsChangeCallback(changes);\\n\\t\\t\\tawait saveSettings(changes);\\n\\t\\t},\\n\\t\\t[saveSettings],\\n\\t);\\n\\n\\tconst contextValue = useMemo<SettingsContextValue>(\\n\\t\\t() => ({\\n\\t\\t\\thasPrivateAccess,\\n\\t\\t\\tisLoading,\\n\\t\\t\\tquerySetting,\\n\\t\\t\\tquerySettings,\\n\\t\\t\\tdispatch,\\n\\t\\t}),\\n\\t\\t[hasPrivateAccess, isLoading, querySetting, querySettings, dispatch],\\n\\t);\\n\\n\\treturn <SettingsContext.Provider children={children} value={contextValue} />;\\n};\\n\\nexport default SettingsProvider;\\n\\n// '[subscribe: (onStoreChange: () => void) => () => void, getSnapshot: () => {}]'\\n// '[subscribe: (onStoreChange: () => void) => () => void, getSnapshot: () => ISetting | undefined]'\\n\",null],\"names\":[\"_objectSpread\",\"SettingsContext\",\"useAtLeastOnePermission\",\"useMethod\",\"Tracker\",\"React\",\"useCallback\",\"useEffect\",\"useMemo\",\"useState\",\"createReactiveSubscriptionFactory\",\"queryClient\",\"PrivateSettingsCachedCollection\",\"PublicSettingsCachedCollection\",\"module\",\"link\",\"default\",\"v\",\"exportDefault\",\"_ref\",\"children\",\"privileged\",\"hasPrivilegedPermission\",\"hasPrivateAccess\",\"cachedCollection\",\"isLoading\",\"setLoading\",\"nonreactive\",\"ready\",\"get\",\"mounted\",\"initialize\",\"init\",\"querySetting\",\"_id\",\"subscription\",\"collection\",\"findOne\",\"undefined\",\"querySettings\",\"query\",\"arguments\",\"length\",\"find\",\"Array\",\"isArray\",\"$in\",\"group\",\"section\",\"$or\",\"$exists\",\"sort\",\"sorter\",\"i18nLabel\",\"fetch\",\"settingsChangeCallback\",\"changes\",\"forEach\",\"val\",\"invalidateQueries\",\"saveSettings\",\"dispatch\",\"contextValue\",\"createElement\",\"Provider\",\"value\"],\"mappings\":\"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\"}"}