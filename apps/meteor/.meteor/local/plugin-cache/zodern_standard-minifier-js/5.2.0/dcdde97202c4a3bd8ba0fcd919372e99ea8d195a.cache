{"code":"function module(o,n,e){e.export({useChangeModeratorAction:function(){return R}}),e.link(\"@rocket.chat/core-typings\",{isRoomFederated:function(o){r=o}},0),e.link(\"@rocket.chat/fuselage-hooks\",{useMutableCallback:function(o){t=o}},1),e.link(\"@rocket.chat/string-helpers\",{escapeHTML:function(o){i=o}},2),e.link(\"@rocket.chat/ui-contexts\",{useTranslation:function(o){s=o},usePermission:function(o){u=o},useUserRoom:function(o){a=o},useUserSubscription:function(o){c=o},useUser:function(o){m=o},useSetModal:function(o){d=o}},3),e.link(\"react\",{default:function(o){l=o},useCallback:function(o){_=o},useMemo:function(o){f=o}},4),e.link(\"../../../../../components/GenericModal\",{default:function(o){v=o}},5),e.link(\"../../../../../hooks/useEndpointAction\",{useEndpointAction:function(o){g=o}},6),e.link(\"../../../../../lib/rooms/roomCoordinator\",{roomCoordinator:function(o){k=o}},7),e.link(\"../../../lib/getRoomDirectives\",{getRoomDirectives:function(o){p=o}},8),e.link(\"../../useUserHasRoomRole\",{useUserHasRoomRole:function(o){M=o}},9);var r,t,i,s,u,a,c,m,d,l,_,f,v,g,k,p,M,h=function(o,n,e,r,t){return l.createElement(v,{variant:\"warning\",onClose:o,onConfirm:n,onCancel:o,title:e,confirmText:r},t)},R=function(o,n){var e=s(),l=a(n),v=o._id,R=u(\"set-moderator\",n),C=M(v,n,\"moderator\"),I=c(n),b=(m()||{})._id,U=void 0===b?\"\":b,w=M(U,n,\"moderator\"),x=M(U,n,\"owner\"),S=d(),E=_(function(){return S(null)},[S]);if(!l)throw Error(\"Room not provided\");var F=p({room:l,showingUserId:v,userSubscription:I}).roomCanSetModerator,T=(null==l?void 0:l.t)&&i(k.getRoomName(l.t,l)),A=\"p\"===l.t?\"/v1/groups\":\"/v1/channels\",H=g(\"POST\",A+\".\"+(C?\"removeModerator\":\"addModerator\"),{successMessage:e(C?\"User__username__removed_from__room_name__moderators\":\"User__username__is_now_a_moderator_of__room_name_\",{username:o.username,room_name:T})}),y=_(function(){H({roomId:n,userId:v}),E()},[H,n,v,E]),D=_(function(o){var t=o.userId;if(!r(l))return H({roomId:n,userId:v});var i=t===U;return i&&w||i&&x?S(function(){return h(E,y,e(\"Federation_Matrix_losing_privileges\"),e(\"Yes_continue\"),e(\"Federation_Matrix_losing_privileges_warning\"))}):!i&&w?S(function(){return h(E,y,e(\"Warning\"),e(\"Yes_continue\"),e(\"Federation_Matrix_giving_same_permission_warning\"))}):void H({roomId:n,userId:v})},[S,U,w,x,e,n,v,H,E,y,l]),P=t(function(){return D({roomId:n,userId:v})});return f(function(){return r(l)&&F||!r(l)&&F&&R?{content:e(C?\"Remove_as_moderator\":\"Set_as_moderator\"),icon:\"shield-blank\",onClick:P,type:\"privileges\"}:void 0},[P,C,F,e,R,l])}}","map":"{\"version\":3,\"sources\":[\"client/views/room/hooks/useUserInfoActions/actions/useChangeModeratorAction.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom, IUser } from '@rocket.chat/core-typings';\\nimport { isRoomFederated } from '@rocket.chat/core-typings';\\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\\nimport { escapeHTML } from '@rocket.chat/string-helpers';\\nimport { useTranslation, usePermission, useUserRoom, useUserSubscription, useUser, useSetModal } from '@rocket.chat/ui-contexts';\\nimport type { ReactElement } from 'react';\\nimport React, { useCallback, useMemo } from 'react';\\n\\nimport GenericModal from '../../../../../components/GenericModal';\\nimport { useEndpointAction } from '../../../../../hooks/useEndpointAction';\\nimport { roomCoordinator } from '../../../../../lib/rooms/roomCoordinator';\\nimport { getRoomDirectives } from '../../../lib/getRoomDirectives';\\nimport { useUserHasRoomRole } from '../../useUserHasRoomRole';\\nimport type { UserInfoAction, UserInfoActionType } from '../useUserInfoActions';\\n\\nconst getWarningModalForFederatedRooms = (\\n\\tcloseModalFn: () => void,\\n\\thandleConfirmFn: () => void,\\n\\ttitle: string,\\n\\tconfirmText: string,\\n\\tbodyText: string,\\n): ReactElement => (\\n\\t<GenericModal\\n\\t\\tvariant='warning'\\n\\t\\tonClose={closeModalFn}\\n\\t\\tonConfirm={handleConfirmFn}\\n\\t\\tonCancel={closeModalFn}\\n\\t\\ttitle={title}\\n\\t\\tconfirmText={confirmText}\\n\\t>\\n\\t\\t{bodyText}\\n\\t</GenericModal>\\n);\\n\\nexport const useChangeModeratorAction = (user: Pick<IUser, '_id' | 'username'>, rid: IRoom['_id']): UserInfoAction | undefined => {\\n\\tconst t = useTranslation();\\n\\tconst room = useUserRoom(rid);\\n\\tconst { _id: uid } = user;\\n\\n\\tconst userCanSetModerator = usePermission('set-moderator', rid);\\n\\tconst isModerator = useUserHasRoomRole(uid, rid, 'moderator');\\n\\tconst userSubscription = useUserSubscription(rid);\\n\\tconst { _id: loggedUserId = '' } = useUser() || {};\\n\\tconst loggedUserIsModerator = useUserHasRoomRole(loggedUserId, rid, 'moderator');\\n\\tconst loggedUserIsOwner = useUserHasRoomRole(loggedUserId, rid, 'owner');\\n\\tconst setModal = useSetModal();\\n\\tconst closeModal = useCallback(() => setModal(null), [setModal]);\\n\\n\\tif (!room) {\\n\\t\\tthrow Error('Room not provided');\\n\\t}\\n\\n\\tconst { roomCanSetModerator } = getRoomDirectives({ room, showingUserId: uid, userSubscription });\\n\\tconst roomName = room?.t && escapeHTML(roomCoordinator.getRoomName(room.t, room));\\n\\n\\tconst endpointPrefix = room.t === 'p' ? '/v1/groups' : '/v1/channels';\\n\\tconst changeModeratorEndpoint = isModerator ? 'removeModerator' : 'addModerator';\\n\\tconst changeModeratorMessage = isModerator\\n\\t\\t? 'User__username__removed_from__room_name__moderators'\\n\\t\\t: 'User__username__is_now_a_moderator_of__room_name_';\\n\\n\\tconst changeModerator = useEndpointAction('POST', `${endpointPrefix}.${changeModeratorEndpoint}`, {\\n\\t\\tsuccessMessage: t(changeModeratorMessage, { username: user.username, room_name: roomName }),\\n\\t});\\n\\n\\tconst handleConfirm = useCallback(() => {\\n\\t\\tchangeModerator({ roomId: rid, userId: uid });\\n\\t\\tcloseModal();\\n\\t}, [changeModerator, rid, uid, closeModal]);\\n\\n\\tconst handleChangeModerator = useCallback(\\n\\t\\t({ userId }) => {\\n\\t\\t\\tif (!isRoomFederated(room)) {\\n\\t\\t\\t\\treturn changeModerator({ roomId: rid, userId: uid });\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst changingOwnRole = userId === loggedUserId;\\n\\t\\t\\tif (changingOwnRole && loggedUserIsModerator) {\\n\\t\\t\\t\\treturn setModal(() =>\\n\\t\\t\\t\\t\\tgetWarningModalForFederatedRooms(\\n\\t\\t\\t\\t\\t\\tcloseModal,\\n\\t\\t\\t\\t\\t\\thandleConfirm,\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_losing_privileges'),\\n\\t\\t\\t\\t\\t\\tt('Yes_continue'),\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_losing_privileges_warning'),\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t\\t);\\n\\t\\t\\t}\\n\\n\\t\\t\\tif (changingOwnRole && loggedUserIsOwner) {\\n\\t\\t\\t\\treturn setModal(() =>\\n\\t\\t\\t\\t\\tgetWarningModalForFederatedRooms(\\n\\t\\t\\t\\t\\t\\tcloseModal,\\n\\t\\t\\t\\t\\t\\thandleConfirm,\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_losing_privileges'),\\n\\t\\t\\t\\t\\t\\tt('Yes_continue'),\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_losing_privileges_warning'),\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t\\t);\\n\\t\\t\\t}\\n\\n\\t\\t\\tif (!changingOwnRole && loggedUserIsModerator) {\\n\\t\\t\\t\\treturn setModal(() =>\\n\\t\\t\\t\\t\\tgetWarningModalForFederatedRooms(\\n\\t\\t\\t\\t\\t\\tcloseModal,\\n\\t\\t\\t\\t\\t\\thandleConfirm,\\n\\t\\t\\t\\t\\t\\tt('Warning'),\\n\\t\\t\\t\\t\\t\\tt('Yes_continue'),\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_giving_same_permission_warning'),\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t\\t);\\n\\t\\t\\t}\\n\\n\\t\\t\\tchangeModerator({ roomId: rid, userId: uid });\\n\\t\\t},\\n\\t\\t[setModal, loggedUserId, loggedUserIsModerator, loggedUserIsOwner, t, rid, uid, changeModerator, closeModal, handleConfirm, room],\\n\\t);\\n\\n\\tconst changeModeratorAction = useMutableCallback(() => handleChangeModerator({ roomId: rid, userId: uid }));\\n\\tconst changeModeratorOption = useMemo(\\n\\t\\t() =>\\n\\t\\t\\t(isRoomFederated(room) && roomCanSetModerator) || (!isRoomFederated(room) && roomCanSetModerator && userCanSetModerator)\\n\\t\\t\\t\\t? {\\n\\t\\t\\t\\t\\t\\tcontent: t(isModerator ? 'Remove_as_moderator' : 'Set_as_moderator'),\\n\\t\\t\\t\\t\\t\\ticon: 'shield-blank' as const,\\n\\t\\t\\t\\t\\t\\tonClick: changeModeratorAction,\\n\\t\\t\\t\\t\\t\\ttype: 'privileges' as UserInfoActionType,\\n\\t\\t\\t\\t  }\\n\\t\\t\\t\\t: undefined,\\n\\t\\t[changeModeratorAction, isModerator, roomCanSetModerator, t, userCanSetModerator, room],\\n\\t);\\n\\n\\treturn changeModeratorOption;\\n};\\n\",null],\"names\":[\"module\",\"export\",\"useChangeModeratorAction\",\"link\",\"isRoomFederated\",\"v\",\"useMutableCallback\",\"escapeHTML\",\"useTranslation\",\"usePermission\",\"useUserRoom\",\"useUserSubscription\",\"useUser\",\"useSetModal\",\"React\",\"useCallback\",\"useMemo\",\"GenericModal\",\"useEndpointAction\",\"roomCoordinator\",\"getRoomDirectives\",\"useUserHasRoomRole\",\"getWarningModalForFederatedRooms\",\"closeModalFn\",\"handleConfirmFn\",\"title\",\"confirmText\",\"bodyText\",\"createElement\",\"variant\",\"onClose\",\"onConfirm\",\"onCancel\",\"user\",\"rid\",\"t\",\"room\",\"uid\",\"_id\",\"userCanSetModerator\",\"isModerator\",\"userSubscription\",\"_ref$_id\",\"_ref\",\"loggedUserId\",\"loggedUserIsModerator\",\"loggedUserIsOwner\",\"setModal\",\"closeModal\",\"Error\",\"roomCanSetModerator\",\"_getRoomDirectives\",\"showingUserId\",\"roomName\",\"getRoomName\",\"endpointPrefix\",\"changeModerator\",\"successMessage\",\"username\",\"room_name\",\"handleConfirm\",\"roomId\",\"userId\",\"handleChangeModerator\",\"_ref2\",\"changingOwnRole\",\"changeModeratorAction\",\"content\",\"icon\",\"onClick\",\"type\",\"undefined\"],\"mappings\":\"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\"}"}