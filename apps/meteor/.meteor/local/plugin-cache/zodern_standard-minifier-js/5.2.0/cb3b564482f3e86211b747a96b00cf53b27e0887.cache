{"code":"function module(e,t,i){let o,n,s,r,a,c,l,d,h,m,u,g,p;i.export({WebRTC:()=>C}),i.link(\"@rocket.chat/emitter\",{Emitter(e){o=e}},0),i.link(\"meteor/meteor\",{Meteor(e){n=e}},1),i.link(\"meteor/reactive-var\",{ReactiveVar(e){s=e}},2),i.link(\"meteor/tracker\",{Tracker(e){r=e}},3),i.link(\"../../../client/components/GenericModal\",{default(e){a=e}},4),i.link(\"../../../client/lib/imperativeModal\",{imperativeModal(e){c=e}},5),i.link(\"../../../client/lib/utils/goToRoomById\",{goToRoomById(e){l=e}},6),i.link(\"../../models/client\",{ChatSubscription(e){d=e}},7),i.link(\"../../settings/client\",{settings(e){h=e}},8),i.link(\"../../utils/client/lib/SDKClient\",{sdk(e){m=e}},9),i.link(\"../../utils/lib/i18n\",{t(e){u=e}},10),i.link(\"../lib/constants\",{WEB_RTC_EVENTS(e){g=e}},11),i.link(\"./screenShare\",{ChromeScreenShare(e){p=e}},12);class f extends o{constructor(e){super(),this.webrtcInstance=void 0,this.debug=!1,this.webrtcInstance=e,m.stream(\"notify-room\",[\"\".concat(this.webrtcInstance.room,\"/\").concat(g.WEB_RTC)],(e,t)=>{this.log(\"WebRTCTransportClass - onRoom\",e,t),this.emit(e,t)})}log(){!0===this.debug&&console.log(...arguments)}onUserStream(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let[o,n]=t;if(n.room===this.webrtcInstance.room)switch(this.log(\"WebRTCTransportClass - onUser\",o,n),o){case\"candidate\":this.emit(\"candidate\",n);break;case\"description\":this.emit(\"description\",n);break;case\"join\":this.emit(\"join\",n)}}startCall(e){this.log(\"WebRTCTransportClass - startCall\",this.webrtcInstance.room,this.webrtcInstance.selfId),m.publish(\"notify-room-users\",[\"\".concat(this.webrtcInstance.room,\"/\").concat(g.WEB_RTC),g.CALL,{from:this.webrtcInstance.selfId,room:this.webrtcInstance.room,media:e.media,monitor:e.monitor}])}joinCall(e){this.log(\"WebRTCTransportClass - joinCall\",this.webrtcInstance.room,this.webrtcInstance.selfId),!0===e.monitor?m.publish(\"notify-user\",[\"\".concat(e.to,\"/\").concat(g.WEB_RTC),g.JOIN,{from:this.webrtcInstance.selfId,room:this.webrtcInstance.room,media:e.media,monitor:e.monitor}]):m.publish(\"notify-room-users\",[\"\".concat(this.webrtcInstance.room,\"/\").concat(g.WEB_RTC),g.JOIN,{from:this.webrtcInstance.selfId,room:this.webrtcInstance.room,media:e.media,monitor:e.monitor}])}sendCandidate(e){e.from=this.webrtcInstance.selfId,e.room=this.webrtcInstance.room,this.log(\"WebRTCTransportClass - sendCandidate\",e),m.publish(\"notify-user\",[\"\".concat(e.to,\"/\").concat(g.WEB_RTC),g.CANDIDATE,e])}sendDescription(e){e.from=this.webrtcInstance.selfId,e.room=this.webrtcInstance.room,this.log(\"WebRTCTransportClass - sendDescription\",e),m.publish(\"notify-user\",[\"\".concat(e.to,\"/\").concat(g.WEB_RTC),g.DESCRIPTION,e])}sendStatus(e){this.log(\"WebRTCTransportClass - sendStatus\",e,this.webrtcInstance.room),e.from=this.webrtcInstance.selfId,m.publish(\"notify-room\",[\"\".concat(this.webrtcInstance.room,\"/\").concat(g.WEB_RTC),g.STATUS,e])}onRemoteCall(e){return this.on(g.CALL,e)}onRemoteJoin(e){return this.on(g.JOIN,e)}onRemoteCandidate(e){return this.on(g.CANDIDATE,e)}onRemoteDescription(e){return this.on(g.DESCRIPTION,e)}onRemoteStatus(e){return this.on(g.STATUS,e)}}class v{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.selfId=void 0,this.room=void 0,this.autoAccept=void 0,this.transport=void 0,this.config=void 0,this.debug=void 0,this.TransportClass=void 0,this.peerConnections={},this.remoteItems=void 0,this.remoteItemsById=void 0,this.callInProgress=void 0,this.audioEnabled=void 0,this.videoEnabled=void 0,this.overlayEnabled=void 0,this.screenShareEnabled=void 0,this.localUrl=void 0,this.active=void 0,this.remoteMonitoring=void 0,this.monitor=void 0,this.navigator=void 0,this.screenShareAvailable=void 0,this.media=void 0,this.resetCallInProgress=()=>{this.callInProgress.set(!1)},this.callInProgressTimeout=void 0,this.audioContext=void 0,this.stopPeerConnection=e=>{let t=this.peerConnections[e];null!=t&&(delete this.peerConnections[e],t.close(),this.updateRemoteItems())},this.localStream=void 0,this.selfId=e,this.room=t,this.autoAccept=i,this.config={iceServers:[]},this.debug=!1,this.TransportClass=f;let o=h.get(\"WebRTC_Servers\");o&&\"\"!==o.trim()&&(o=o.replace(/\\s/g,\"\")).split(\",\").forEach(e=>{let t=e.split(\"@\"),i={urls:t.pop()};if(1===t.length){let[e,o]=t[0].split(\":\");i.username=decodeURIComponent(e),i.credential=decodeURIComponent(o)}this.config.iceServers.push(i)}),this.peerConnections={},this.remoteItems=new s([]),this.remoteItemsById=new s({}),this.callInProgress=new s(!1),this.audioEnabled=new s(!1),this.videoEnabled=new s(!1),this.overlayEnabled=new s(!1),this.screenShareEnabled=new s(!1),this.localUrl=new s(void 0),this.active=!1,this.remoteMonitoring=!1,this.monitor=!1,this.navigator=void 0;let n=navigator.userAgent.toLocaleLowerCase();-1!==n.indexOf(\"electron\")?this.navigator=\"electron\":-1!==n.indexOf(\"chrome\")?this.navigator=\"chrome\":-1!==n.indexOf(\"firefox\")?this.navigator=\"firefox\":-1!==n.indexOf(\"safari\")&&(this.navigator=\"safari\"),this.screenShareAvailable=[\"chrome\",\"firefox\",\"electron\"].includes(this.navigator),this.media={video:!0,audio:!0},this.transport=new this.TransportClass(this),this.transport.onRemoteCall(this.onRemoteCall.bind(this)),this.transport.onRemoteJoin(this.onRemoteJoin.bind(this)),this.transport.onRemoteCandidate(this.onRemoteCandidate.bind(this)),this.transport.onRemoteDescription(this.onRemoteDescription.bind(this)),this.transport.onRemoteStatus(this.onRemoteStatus.bind(this)),setInterval(this.checkPeerConnections.bind(this),1e3)}onUserStream(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let[o,n]=t;switch(o){case\"candidate\":this.transport.onUserStream(\"candidate\",n);break;case\"description\":this.transport.onUserStream(\"description\",n);break;case\"join\":this.transport.onUserStream(\"join\",n)}}log(){!0===this.debug&&console.log(...arguments)}onError(){console.error(...arguments)}checkPeerConnections(){let{peerConnections:e}=this,t=Date.now();Object.entries(e).some(e=>{let[i,o]=e;return![\"connected\",\"completed\"].includes(o.iceConnectionState)&&o.createdAt+5e3<t&&(this.stopPeerConnection(i),!0)})}updateRemoteItems(){let e=[],t={},{peerConnections:i}=this;Object.entries(i).forEach(i=>{let[o,n]=i;n.getRemoteStreams().forEach(i=>{let s={id:o,url:i,state:n.iceConnectionState};switch(n.iceConnectionState){case\"checking\":s.stateText=\"Connecting...\";break;case\"connected\":case\"completed\":s.stateText=\"Connected\",s.connected=!0;break;case\"disconnected\":s.stateText=\"Disconnected\";break;case\"failed\":s.stateText=\"Failed\";break;case\"closed\":s.stateText=\"Closed\"}e.push(s),t[o]=s})}),this.remoteItems.set(e),this.remoteItemsById.set(t)}broadcastStatus(){if(!0!==this.active||!0===this.monitor||!0===this.remoteMonitoring)return;let e=[],{peerConnections:t}=this;Object.entries(t).forEach(t=>{let[i,{remoteMedia:o}]=t;e.push({id:i,media:o})}),this.transport.sendStatus({media:this.media,remoteConnections:e})}onRemoteStatus(e){if(this.callInProgress.set(!0),clearTimeout(this.callInProgressTimeout),this.callInProgressTimeout=setTimeout(this.resetCallInProgress,2e3),!0!==this.active)return;let t=[{id:e.from,media:e.media},...e.remoteConnections];t.forEach(e=>{e.id!==this.selfId&&null==this.peerConnections[e.id]&&(this.log(\"reconnecting with\",e.id),this.onRemoteJoin({from:e.id,media:e.media}))})}getPeerConnection(e){if(null!=this.peerConnections[e])return this.peerConnections[e];let t=new RTCPeerConnection(this.config);return t.createdAt=Date.now(),t.remoteMedia={},this.peerConnections[e]=t,[\"icecandidate\",\"addstream\",\"removestream\",\"iceconnectionstatechange\",\"datachannel\",\"identityresult\",\"idpassertionerror\",\"idpvalidationerror\",\"negotiationneeded\",\"peeridentity\",\"signalingstatechange\"].forEach(i=>{t.addEventListener(i,t=>{this.log(e,t.type,t)})}),t.addEventListener(\"icecandidate\",t=>{null!=t.candidate&&this.transport.sendCandidate({to:e,candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}})}),t.addEventListener(\"addstream\",()=>{this.updateRemoteItems()}),t.addEventListener(\"removestream\",()=>{this.updateRemoteItems()}),t.addEventListener(\"iceconnectionstatechange\",()=>{(\"disconnected\"===t.iceConnectionState||\"closed\"===t.iceConnectionState)&&t===this.peerConnections[e]&&(this.stopPeerConnection(e),setTimeout(()=>{0===Object.keys(this.peerConnections).length&&this.stop()},3e3)),this.updateRemoteItems()}),t}_getUserMedia(e,t,i){var o,n,s;let r=e=>{if(AudioContext&&e.getAudioTracks().length>0){let t=new AudioContext,i=t.createMediaStreamSource(e),o=t.createGain();i.connect(o);let n=t.createMediaStreamDestination();o.connect(n),o.gain.value=.6,e.removeTrack(e.getAudioTracks()[0]),e.addTrack(n.stream.getAudioTracks()[0]),e.volume=o,this.audioContext=t}t(e)};if(null!==(o=navigator.mediaDevices)&&void 0!==o&&o.getUserMedia)return navigator.mediaDevices.getUserMedia(e).then(r).catch(i);null===(n=(s=navigator).getUserMedia)||void 0===n||n.call(s,e,r,i)}getUserMedia(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.onError;if(!0!==e.desktop){this._getUserMedia(e,t,i);return}if(!0!==this.screenShareAvailable){console.log(\"Screen share is not avaliable\");return}let o=o=>{let n=function(){c.open({component:a,props:{variant:\"warning\",title:u(\"Refresh_your_page_after_install_to_enable_screen_sharing\")}})},s=\"chrome\"===this.navigator&&p.installed,r=\"firefox\"===this.navigator&&null!=window.rocketchatscreenshare;if(!s&&!r)return c.open({component:a,props:{title:u(\"Screen_Share\"),variant:\"warning\",confirmText:u(\"Install_Extension\"),cancelText:u(\"Cancel\"),children:u(\"You_need_install_an_extension_to_allow_screen_sharing\"),onConfirm:()=>{if(\"chrome\"===this.navigator){let e=\"https://chrome.google.com/webstore/detail/rocketchat-screen-share/nocfbnnmjnndkbipkabodnheejiegccf\";try{chrome.webstore.install(e,n,()=>{window.open(e),n()})}catch(t){console.log(t),window.open(e),n()}}else\"firefox\"===this.navigator&&(window.open(\"https://addons.mozilla.org/en-GB/firefox/addon/rocketchat-screen-share/\"),n())}}}),i(!1);let l=e=>{null!=o&&e.addTrack(o.getAudioTracks()[0]),t(e)};\"firefox\"===this.navigator?(e={audio:e.audio,video:{mozMediaSource:\"window\",mediaSource:\"window\"}},this._getUserMedia(e,l,i)):p.getSourceId(this.navigator,t=>{e={audio:!1,video:{mandatory:{chromeMediaSource:\"desktop\",chromeMediaSourceId:t,maxWidth:1280,maxHeight:720}}},this._getUserMedia(e,l,i)})};\"firefox\"===this.navigator||null==e.audio||!1===e.audio?o():this._getUserMedia({audio:e.audio},e=>{o(e)},()=>{o()})}getLocalUserMedia(e){for(var t=arguments.length,i=Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];if(this.log(\"getLocalUserMedia\",[e,...i]),null!=this.localStream)return e(null,this.localStream);this.getUserMedia(this.media,t=>{this.localStream=t,this.audioEnabled.get()||this.disableAudio(),this.videoEnabled.get()||this.disableVideo(),this.localUrl.set(t);let{peerConnections:i}=this;Object.entries(i).forEach(e=>{let[,i]=e;return i.addStream(t)}),document.querySelector(\"video#localVideo\").srcObject=t,e(null,this.localStream)},t=>{e(!1),this.onError(t)})}stopAllPeerConnections(){var e;let{peerConnections:t}=this;Object.keys(t).forEach(this.stopPeerConnection),null===(e=window.audioContext)||void 0===e||e.close()}setAudioEnabled(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];null!=this.localStream&&(this.localStream.getAudioTracks().forEach(t=>{t.enabled=e}),this.audioEnabled.set(e))}disableAudio(){this.setAudioEnabled(!1)}enableAudio(){this.setAudioEnabled(!0)}toggleAudio(){return this.audioEnabled.get()?this.disableAudio():this.enableAudio()}setVideoEnabled(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];null!=this.localStream&&(this.localStream.getVideoTracks().forEach(t=>{t.enabled=e}),this.videoEnabled.set(e))}disableScreenShare(){this.setScreenShareEnabled(!1)}enableScreenShare(){this.setScreenShareEnabled(!0)}setScreenShareEnabled(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];null!=this.localStream&&(this.media.desktop=e,delete this.localStream,this.getLocalUserMedia(t=>{null==t&&(this.screenShareEnabled.set(e),this.stopAllPeerConnections(),this.joinCall())}))}disableVideo(){this.setVideoEnabled(!1)}enableVideo(){this.setVideoEnabled(!0)}toggleVideo(){return this.videoEnabled.get()?this.disableVideo():this.enableVideo()}stop(){this.active=!1,this.monitor=!1,this.remoteMonitoring=!1,null!=this.localStream&&void 0!==this.localStream&&this.localStream.getTracks().forEach(e=>e.stop()),this.localUrl.set(void 0),delete this.localStream,this.stopAllPeerConnections()}startCall(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t=arguments.length,i=Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];this.log(\"startCall\",[e,...i]),this.media=e,this.getLocalUserMedia(()=>{this.active=!0,this.transport.startCall({media:this.media})})}startCallAsMonitor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t=arguments.length,i=Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];this.log(\"startCallAsMonitor\",[e,...i]),this.media=e,this.active=!0,this.monitor=!0,this.transport.startCall({media:this.media,monitor:!0})}onRemoteCall(e){var t,i;let o,s,r;if(!0===this.autoAccept){setTimeout(()=>{this.joinCall({to:e.from,monitor:e.monitor,media:e.media})},0);return}let h=n.users.findOne(e.from);null!=h&&h.username&&(r=h.username);let m=d.findOne({rid:e.room});!0===e.monitor?(o=\"eye\",s=u(\"WebRTC_monitor_call_from_%s\",r)):m&&\"d\"===m.t?null!==(i=e.media)&&void 0!==i&&i.video?(o=\"video\",s=u(\"WebRTC_direct_video_call_from_%s\",r)):(o=\"phone\",s=u(\"WebRTC_direct_audio_call_from_%s\",r)):null!==(t=e.media)&&void 0!==t&&t.video?(o=\"video\",s=u(\"WebRTC_group_video_call_from_%s\",m.name)):(o=\"phone\",s=u(\"WebRTC_group_audio_call_from_%s\",m.name)),c.open({component:a,props:{title:s,icon:o,confirmText:u(\"Yes\"),cancelText:u(\"No\"),children:u(\"Do_you_want_to_accept\"),onConfirm:()=>(l(e.room),this.joinCall({to:e.from,monitor:e.monitor,media:e.media})),onCancel:()=>this.stop(),onClose:()=>this.stop()}})}joinCall(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.media=this.media;for(var t=arguments.length,i=Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];this.log(\"joinCall\",[e,...i]),this.getLocalUserMedia(()=>{this.remoteMonitoring=e.monitor,this.active=!0,this.transport.joinCall(e)})}onRemoteJoin(e){if(!0!==this.active)return;for(var t,i,o=arguments.length,n=Array(o>1?o-1:0),s=1;s<o;s++)n[s-1]=arguments[s];this.log(\"onRemoteJoin\",[e,...n]);let r=this.getPeerConnection(e.from);if(\"checking\"!==r.signalingState&&(this.stopPeerConnection(e.from),r=this.getPeerConnection(e.from)),\"new\"!==r.iceConnectionState)return;r.remoteMedia=e.media,this.localStream&&r.addStream(this.localStream);let a=t=>{r.setLocalDescription(new RTCSessionDescription(t),()=>{this.transport.sendDescription({to:e.from,type:\"offer\",ts:r.createdAt,media:this.media,description:{sdp:t.sdp,type:t.type}})},this.onError)};!0===e.monitor?r.createOffer(a,this.onError,{mandatory:{OfferToReceiveAudio:null===(t=e.media)||void 0===t?void 0:t.audio,OfferToReceiveVideo:null===(i=e.media)||void 0===i?void 0:i.video}}):r.createOffer(a,this.onError)}onRemoteOffer(e){if(!0!==this.active)return;for(var t=arguments.length,i=Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];this.log(\"onRemoteOffer\",[e,...i]);let n=this.getPeerConnection(e.from);if([\"have-local-offer\",\"stable\"].includes(n.signalingState)&&n.createdAt<e.ts&&(this.stopPeerConnection(e.from),n=this.getPeerConnection(e.from)),\"new\"===n.iceConnectionState){n.setRemoteDescription(new RTCSessionDescription(e.description));try{this.localStream&&n.addStream(this.localStream)}catch(e){console.log(e)}n.createAnswer(t=>{n.setLocalDescription(new RTCSessionDescription(t),()=>{this.transport.sendDescription({to:e.from,type:\"answer\",ts:n.createdAt,description:{sdp:t.sdp,type:t.type}})},this.onError)},this.onError)}}onRemoteCandidate(e){var t;if(!0!==this.active||e.to!==this.selfId)return;for(var i=arguments.length,o=Array(i>1?i-1:0),n=1;n<i;n++)o[n-1]=arguments[n];this.log(\"onRemoteCandidate\",[e,...o]);let s=this.getPeerConnection(e.from);\"closed\"!==s.iceConnectionState&&\"failed\"!==s.iceConnectionState&&\"disconnected\"!==s.iceConnectionState&&\"completed\"!==s.iceConnectionState&&s.addIceCandidate(new RTCIceCandidate(e.candidate)),document.querySelector(\"video#remoteVideo\").srcObject=null===(t=this.remoteItems.get()[0])||void 0===t?void 0:t.url}onRemoteDescription(e){if(!0!==this.active||e.to!==this.selfId)return;for(var t=arguments.length,i=Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];this.log(\"onRemoteDescription\",[e,...i]);let n=this.getPeerConnection(e.from);\"offer\"===e.type?(n.remoteMedia=e.media,this.onRemoteOffer({from:e.from,ts:e.ts,description:e.description})):n.setRemoteDescription(new RTCSessionDescription(e.description))}}let C=new class{constructor(){this.instancesByRoomId={},this.instancesByRoomId={}}getInstanceByRoomId(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!1;if(t)i=\"WebRTC\"===h.get(\"Omnichannel_call_provider\");else{let t=d.findOne({rid:e});if(!t)return;switch(t.t){case\"d\":i=h.get(\"WebRTC_Enable_Direct\");break;case\"p\":i=h.get(\"WebRTC_Enable_Private\");break;case\"c\":i=h.get(\"WebRTC_Enable_Channel\");break;case\"l\":i=\"WebRTC\"===h.get(\"Omnichannel_call_provider\")}}if(!1!==(i=i&&h.get(\"WebRTC_Enabled\"))){if(null==this.instancesByRoomId[e]){let i=n.userId(),o=!1;t&&(i=t,o=!0),this.instancesByRoomId[e]=new v(i,e,o)}return this.instancesByRoomId[e]}}};n.startup(()=>{r.autorun(()=>{let e=n.userId();e&&m.stream(\"notify-user\",[\"\".concat(e,\"/\").concat(g.WEB_RTC)],(e,t)=>{if(null==t.room)return;let i=C.getInstanceByRoomId(t.room);switch(e){case\"candidate\":null==i||i.onUserStream(\"candidate\",t);break;case\"description\":null==i||i.onUserStream(\"description\",t);break;case\"join\":null==i||i.onUserStream(\"join\",t)}})})})}","map":"{\"version\":3,\"sources\":[\"app/webrtc/client/WebRTCClass.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom } from '@rocket.chat/core-typings';\\nimport type { StreamKeys, StreamNames, StreamerCallbackArgs } from '@rocket.chat/ddp-client';\\nimport { Emitter } from '@rocket.chat/emitter';\\nimport { Meteor } from 'meteor/meteor';\\nimport { ReactiveVar } from 'meteor/reactive-var';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport GenericModal from '../../../client/components/GenericModal';\\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\\nimport { goToRoomById } from '../../../client/lib/utils/goToRoomById';\\nimport { ChatSubscription } from '../../models/client';\\nimport { settings } from '../../settings/client';\\nimport { sdk } from '../../utils/client/lib/SDKClient';\\nimport { t } from '../../utils/lib/i18n';\\nimport { WEB_RTC_EVENTS } from '../lib/constants';\\nimport { ChromeScreenShare } from './screenShare';\\n\\n// FIXME: there is a mix of obsolete definitions and incorrect field assignments\\n\\ndeclare global {\\n\\t// eslint-disable-next-line @typescript-eslint/naming-convention\\n\\tinterface RTCPeerConnection {\\n\\t\\t/** @deprecated non-standard */\\n\\t\\tcreatedAt: number;\\n\\t\\t/** @deprecated non-standard */\\n\\t\\tremoteMedia: MediaStreamConstraints;\\n\\t}\\n\\n\\t// eslint-disable-next-line @typescript-eslint/naming-convention\\n\\tinterface RTCOfferOptions {\\n\\t\\t/** @deprecated non-standard */\\n\\t\\tmandatory?: unknown;\\n\\t}\\n\\n\\t// eslint-disable-next-line @typescript-eslint/naming-convention\\n\\tinterface MediaStream {\\n\\t\\t/** @deprecated non-standard */\\n\\t\\tvolume?: GainNode;\\n\\t}\\n\\n\\t// eslint-disable-next-line @typescript-eslint/naming-convention\\n\\tinterface MediaStreamConstraints {\\n\\t\\t/** @deprecated non-standard */\\n\\t\\tdesktop?: boolean;\\n\\t}\\n\\n\\t/** @deprecated browser-specific global */\\n\\tconst chrome: {\\n\\t\\twebstore: {\\n\\t\\t\\tinstall(url: string, onSuccess: () => void, onError: (error: any) => void): void;\\n\\t\\t};\\n\\t};\\n\\n\\t// eslint-disable-next-line @typescript-eslint/naming-convention\\n\\tinterface Window {\\n\\t\\trocketchatscreenshare?: unknown;\\n\\t\\taudioContext?: AudioContext;\\n\\t}\\n}\\n\\ntype EventData<TStreamName extends StreamNames, TStreamKey extends StreamKeys<TStreamName>, TType> = Extract<\\n\\tStreamerCallbackArgs<TStreamName, TStreamKey>,\\n\\t[type: TType, data: any]\\n>[1];\\n\\ntype StatusData = EventData<'notify-room', `${string}/webrtc`, 'status'>;\\ntype CallData = EventData<'notify-room-users', `${string}/webrtc`, 'call'>;\\ntype CandidateData = EventData<'notify-user', `${string}/webrtc`, 'candidate'>;\\ntype DescriptionData = EventData<'notify-user', `${string}/webrtc`, 'description'>;\\ntype JoinData = EventData<'notify-user', `${string}/webrtc`, 'join'>;\\n\\ntype RemoteItem = {\\n\\tid: string;\\n\\turl: MediaStream;\\n\\tstate: RTCIceConnectionState;\\n\\tstateText?: string;\\n\\tconnected?: boolean;\\n};\\n\\ntype RemoteConnection = {\\n\\tid: string;\\n\\tmedia: MediaStreamConstraints;\\n};\\n\\nclass WebRTCTransportClass extends Emitter<{\\n\\tstatus: StatusData;\\n\\tcall: CallData;\\n\\tcandidate: CandidateData;\\n\\tdescription: DescriptionData;\\n\\tjoin: JoinData;\\n}> {\\n\\tpublic debug = false;\\n\\n\\tconstructor(public webrtcInstance: WebRTCClass) {\\n\\t\\tsuper();\\n\\t\\tsdk.stream('notify-room', [`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`], (type, data) => {\\n\\t\\t\\tthis.log('WebRTCTransportClass - onRoom', type, data);\\n\\t\\t\\tthis.emit(type, data);\\n\\t\\t});\\n\\t}\\n\\n\\tlog(...args: unknown[]) {\\n\\t\\tif (this.debug === true) {\\n\\t\\t\\tconsole.log(...args);\\n\\t\\t}\\n\\t}\\n\\n\\tonUserStream(type: 'candidate', data: CandidateData): void;\\n\\n\\tonUserStream(type: 'description', data: DescriptionData): void;\\n\\n\\tonUserStream(type: 'join', data: JoinData): void;\\n\\n\\tonUserStream(\\n\\t\\t...[type, data]:\\n\\t\\t\\t| [type: 'candidate', data: CandidateData]\\n\\t\\t\\t| [type: 'description', data: DescriptionData]\\n\\t\\t\\t| [type: 'join', data: JoinData]\\n\\t) {\\n\\t\\tif (data.room !== this.webrtcInstance.room) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tthis.log('WebRTCTransportClass - onUser', type, data);\\n\\n\\t\\tswitch (type) {\\n\\t\\t\\tcase 'candidate':\\n\\t\\t\\t\\tthis.emit('candidate', data);\\n\\t\\t\\t\\tbreak;\\n\\t\\t\\tcase 'description':\\n\\t\\t\\t\\tthis.emit('description', data);\\n\\t\\t\\t\\tbreak;\\n\\t\\t\\tcase 'join':\\n\\t\\t\\t\\tthis.emit('join', data);\\n\\t\\t\\t\\tbreak;\\n\\t\\t}\\n\\t}\\n\\n\\tstartCall(data: CallData) {\\n\\t\\tthis.log('WebRTCTransportClass - startCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\\n\\t\\tsdk.publish('notify-room-users', [\\n\\t\\t\\t`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`,\\n\\t\\t\\tWEB_RTC_EVENTS.CALL,\\n\\t\\t\\t{\\n\\t\\t\\t\\tfrom: this.webrtcInstance.selfId,\\n\\t\\t\\t\\troom: this.webrtcInstance.room,\\n\\t\\t\\t\\tmedia: data.media,\\n\\t\\t\\t\\tmonitor: data.monitor,\\n\\t\\t\\t},\\n\\t\\t]);\\n\\t}\\n\\n\\tjoinCall(data: JoinData) {\\n\\t\\tthis.log('WebRTCTransportClass - joinCall', this.webrtcInstance.room, this.webrtcInstance.selfId);\\n\\t\\tif (data.monitor === true) {\\n\\t\\t\\tsdk.publish('notify-user', [\\n\\t\\t\\t\\t`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`,\\n\\t\\t\\t\\tWEB_RTC_EVENTS.JOIN,\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\tfrom: this.webrtcInstance.selfId,\\n\\t\\t\\t\\t\\troom: this.webrtcInstance.room,\\n\\t\\t\\t\\t\\tmedia: data.media,\\n\\t\\t\\t\\t\\tmonitor: data.monitor,\\n\\t\\t\\t\\t},\\n\\t\\t\\t]);\\n\\t\\t} else {\\n\\t\\t\\tsdk.publish('notify-room-users', [\\n\\t\\t\\t\\t`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`,\\n\\t\\t\\t\\tWEB_RTC_EVENTS.JOIN,\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\tfrom: this.webrtcInstance.selfId,\\n\\t\\t\\t\\t\\troom: this.webrtcInstance.room,\\n\\t\\t\\t\\t\\tmedia: data.media,\\n\\t\\t\\t\\t\\tmonitor: data.monitor,\\n\\t\\t\\t\\t},\\n\\t\\t\\t]);\\n\\t\\t}\\n\\t}\\n\\n\\tsendCandidate(data: CandidateData) {\\n\\t\\tdata.from = this.webrtcInstance.selfId;\\n\\t\\tdata.room = this.webrtcInstance.room;\\n\\t\\tthis.log('WebRTCTransportClass - sendCandidate', data);\\n\\t\\tsdk.publish('notify-user', [`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.CANDIDATE, data]);\\n\\t}\\n\\n\\tsendDescription(data: DescriptionData) {\\n\\t\\tdata.from = this.webrtcInstance.selfId;\\n\\t\\tdata.room = this.webrtcInstance.room;\\n\\t\\tthis.log('WebRTCTransportClass - sendDescription', data);\\n\\t\\tsdk.publish('notify-user', [`${data.to}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.DESCRIPTION, data]);\\n\\t}\\n\\n\\tsendStatus(data: StatusData) {\\n\\t\\tthis.log('WebRTCTransportClass - sendStatus', data, this.webrtcInstance.room);\\n\\t\\tdata.from = this.webrtcInstance.selfId;\\n\\t\\tsdk.publish('notify-room', [`${this.webrtcInstance.room}/${WEB_RTC_EVENTS.WEB_RTC}`, WEB_RTC_EVENTS.STATUS, data]);\\n\\t}\\n\\n\\tonRemoteCall(fn: (data: CallData) => void) {\\n\\t\\treturn this.on(WEB_RTC_EVENTS.CALL, fn);\\n\\t}\\n\\n\\tonRemoteJoin(fn: (data: JoinData) => void) {\\n\\t\\treturn this.on(WEB_RTC_EVENTS.JOIN, fn);\\n\\t}\\n\\n\\tonRemoteCandidate(fn: (data: CandidateData) => void) {\\n\\t\\treturn this.on(WEB_RTC_EVENTS.CANDIDATE, fn);\\n\\t}\\n\\n\\tonRemoteDescription(fn: (data: DescriptionData) => void) {\\n\\t\\treturn this.on(WEB_RTC_EVENTS.DESCRIPTION, fn);\\n\\t}\\n\\n\\tonRemoteStatus(fn: (data: StatusData) => void) {\\n\\t\\treturn this.on(WEB_RTC_EVENTS.STATUS, fn);\\n\\t}\\n}\\n\\nclass WebRTCClass {\\n\\ttransport: WebRTCTransportClass;\\n\\n\\tconfig: { iceServers: RTCIceServer[] };\\n\\n\\tdebug: boolean;\\n\\n\\tTransportClass: typeof WebRTCTransportClass;\\n\\n\\tpeerConnections: Record<string, RTCPeerConnection> = {};\\n\\n\\tremoteItems: ReactiveVar<RemoteItem[]>;\\n\\n\\tremoteItemsById: ReactiveVar<Record<string, RemoteItem>>;\\n\\n\\tcallInProgress: ReactiveVar<boolean>;\\n\\n\\taudioEnabled: ReactiveVar<boolean>;\\n\\n\\tvideoEnabled: ReactiveVar<boolean>;\\n\\n\\toverlayEnabled: ReactiveVar<boolean>;\\n\\n\\tscreenShareEnabled: ReactiveVar<boolean>;\\n\\n\\tlocalUrl: ReactiveVar<MediaStream | undefined>;\\n\\n\\tactive: boolean;\\n\\n\\tremoteMonitoring: boolean;\\n\\n\\tmonitor: boolean;\\n\\n\\tnavigator: string | undefined;\\n\\n\\tscreenShareAvailable: boolean;\\n\\n\\tmedia: MediaStreamConstraints;\\n\\n\\tconstructor(public selfId: string, public room: string, public autoAccept = false) {\\n\\t\\tthis.config = {\\n\\t\\t\\ticeServers: [],\\n\\t\\t};\\n\\t\\tthis.debug = false;\\n\\t\\tthis.TransportClass = WebRTCTransportClass;\\n\\t\\tlet servers = settings.get<string>('WebRTC_Servers');\\n\\t\\tif (servers && servers.trim() !== '') {\\n\\t\\t\\tservers = servers.replace(/\\\\s/g, '');\\n\\n\\t\\t\\tservers.split(',').forEach((server) => {\\n\\t\\t\\t\\tconst parts = server.split('@');\\n\\t\\t\\t\\tconst serverConfig: RTCIceServer = {\\n\\t\\t\\t\\t\\turls: parts.pop()!,\\n\\t\\t\\t\\t};\\n\\t\\t\\t\\tif (parts.length === 1) {\\n\\t\\t\\t\\t\\tconst [username, credential] = parts[0].split(':');\\n\\t\\t\\t\\t\\tserverConfig.username = decodeURIComponent(username);\\n\\t\\t\\t\\t\\tserverConfig.credential = decodeURIComponent(credential);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tthis.config.iceServers.push(serverConfig);\\n\\t\\t\\t});\\n\\t\\t}\\n\\t\\tthis.peerConnections = {};\\n\\t\\tthis.remoteItems = new ReactiveVar([]);\\n\\t\\tthis.remoteItemsById = new ReactiveVar({});\\n\\t\\tthis.callInProgress = new ReactiveVar(false);\\n\\t\\tthis.audioEnabled = new ReactiveVar(false);\\n\\t\\tthis.videoEnabled = new ReactiveVar(false);\\n\\t\\tthis.overlayEnabled = new ReactiveVar(false);\\n\\t\\tthis.screenShareEnabled = new ReactiveVar(false);\\n\\t\\tthis.localUrl = new ReactiveVar(undefined);\\n\\t\\tthis.active = false;\\n\\t\\tthis.remoteMonitoring = false;\\n\\t\\tthis.monitor = false;\\n\\t\\tthis.navigator = undefined;\\n\\t\\tconst userAgent = navigator.userAgent.toLocaleLowerCase();\\n\\n\\t\\tif (userAgent.indexOf('electron') !== -1) {\\n\\t\\t\\tthis.navigator = 'electron';\\n\\t\\t} else if (userAgent.indexOf('chrome') !== -1) {\\n\\t\\t\\tthis.navigator = 'chrome';\\n\\t\\t} else if (userAgent.indexOf('firefox') !== -1) {\\n\\t\\t\\tthis.navigator = 'firefox';\\n\\t\\t} else if (userAgent.indexOf('safari') !== -1) {\\n\\t\\t\\tthis.navigator = 'safari';\\n\\t\\t}\\n\\n\\t\\tthis.screenShareAvailable = ['chrome', 'firefox', 'electron'].includes(this.navigator!);\\n\\t\\tthis.media = {\\n\\t\\t\\tvideo: true,\\n\\t\\t\\taudio: true,\\n\\t\\t};\\n\\t\\tthis.transport = new this.TransportClass(this);\\n\\t\\tthis.transport.onRemoteCall(this.onRemoteCall.bind(this));\\n\\t\\tthis.transport.onRemoteJoin(this.onRemoteJoin.bind(this));\\n\\t\\tthis.transport.onRemoteCandidate(this.onRemoteCandidate.bind(this));\\n\\t\\tthis.transport.onRemoteDescription(this.onRemoteDescription.bind(this));\\n\\t\\tthis.transport.onRemoteStatus(this.onRemoteStatus.bind(this));\\n\\n\\t\\tsetInterval(this.checkPeerConnections.bind(this), 1000);\\n\\t}\\n\\n\\tonUserStream(type: 'candidate', data: CandidateData): void;\\n\\n\\tonUserStream(type: 'description', data: DescriptionData): void;\\n\\n\\tonUserStream(type: 'join', data: JoinData): void;\\n\\n\\tonUserStream(\\n\\t\\t...[type, data]:\\n\\t\\t\\t| [type: 'candidate', data: CandidateData]\\n\\t\\t\\t| [type: 'description', data: DescriptionData]\\n\\t\\t\\t| [type: 'join', data: JoinData]\\n\\t) {\\n\\t\\tswitch (type) {\\n\\t\\t\\tcase 'candidate':\\n\\t\\t\\t\\tthis.transport.onUserStream('candidate', data);\\n\\t\\t\\t\\tbreak;\\n\\n\\t\\t\\tcase 'description':\\n\\t\\t\\t\\tthis.transport.onUserStream('description', data);\\n\\t\\t\\t\\tbreak;\\n\\n\\t\\t\\tcase 'join':\\n\\t\\t\\t\\tthis.transport.onUserStream('join', data);\\n\\t\\t\\t\\tbreak;\\n\\t\\t}\\n\\t}\\n\\n\\tlog(...args: unknown[]) {\\n\\t\\tif (this.debug === true) {\\n\\t\\t\\tconsole.log(...args);\\n\\t\\t}\\n\\t}\\n\\n\\tonError(...args: unknown[]) {\\n\\t\\tconsole.error(...args);\\n\\t}\\n\\n\\tcheckPeerConnections() {\\n\\t\\tconst { peerConnections } = this;\\n\\t\\tconst date = Date.now();\\n\\t\\tObject.entries(peerConnections).some(([id, peerConnection]) => {\\n\\t\\t\\tif (!['connected', 'completed'].includes(peerConnection.iceConnectionState) && peerConnection.createdAt + 5000 < date) {\\n\\t\\t\\t\\tthis.stopPeerConnection(id);\\n\\t\\t\\t\\treturn true;\\n\\t\\t\\t}\\n\\t\\t\\treturn false;\\n\\t\\t});\\n\\t}\\n\\n\\tupdateRemoteItems() {\\n\\t\\tconst items: RemoteItem[] = [];\\n\\t\\tconst itemsById: Record<string, RemoteItem> = {};\\n\\t\\tconst { peerConnections } = this;\\n\\n\\t\\tObject.entries(peerConnections).forEach(([id, peerConnection]) => {\\n\\t\\t\\tpeerConnection.getRemoteStreams().forEach((remoteStream) => {\\n\\t\\t\\t\\tconst item: RemoteItem = {\\n\\t\\t\\t\\t\\tid,\\n\\t\\t\\t\\t\\turl: remoteStream,\\n\\t\\t\\t\\t\\tstate: peerConnection.iceConnectionState,\\n\\t\\t\\t\\t};\\n\\t\\t\\t\\tswitch (peerConnection.iceConnectionState) {\\n\\t\\t\\t\\t\\tcase 'checking':\\n\\t\\t\\t\\t\\t\\titem.stateText = 'Connecting...';\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t\\tcase 'connected':\\n\\t\\t\\t\\t\\tcase 'completed':\\n\\t\\t\\t\\t\\t\\titem.stateText = 'Connected';\\n\\t\\t\\t\\t\\t\\titem.connected = true;\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t\\tcase 'disconnected':\\n\\t\\t\\t\\t\\t\\titem.stateText = 'Disconnected';\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t\\tcase 'failed':\\n\\t\\t\\t\\t\\t\\titem.stateText = 'Failed';\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t\\tcase 'closed':\\n\\t\\t\\t\\t\\t\\titem.stateText = 'Closed';\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\titems.push(item);\\n\\t\\t\\t\\titemsById[id] = item;\\n\\t\\t\\t});\\n\\t\\t});\\n\\t\\tthis.remoteItems.set(items);\\n\\t\\tthis.remoteItemsById.set(itemsById);\\n\\t}\\n\\n\\tresetCallInProgress = () => {\\n\\t\\tthis.callInProgress.set(false);\\n\\t};\\n\\n\\tbroadcastStatus() {\\n\\t\\tif (this.active !== true || this.monitor === true || this.remoteMonitoring === true) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tconst remoteConnections: RemoteConnection[] = [];\\n\\t\\tconst { peerConnections } = this;\\n\\t\\tObject.entries(peerConnections).forEach(([id, { remoteMedia: media }]) => {\\n\\t\\t\\tremoteConnections.push({\\n\\t\\t\\t\\tid,\\n\\t\\t\\t\\tmedia,\\n\\t\\t\\t});\\n\\t\\t});\\n\\n\\t\\tthis.transport.sendStatus({\\n\\t\\t\\tmedia: this.media,\\n\\t\\t\\tremoteConnections,\\n\\t\\t});\\n\\t}\\n\\n\\tcallInProgressTimeout: ReturnType<typeof setTimeout> | undefined = undefined;\\n\\n\\tonRemoteStatus(data: StatusData) {\\n\\t\\t// this.log(onRemoteStatus, arguments);\\n\\t\\tthis.callInProgress.set(true);\\n\\t\\tclearTimeout(this.callInProgressTimeout);\\n\\t\\tthis.callInProgressTimeout = setTimeout(this.resetCallInProgress, 2000);\\n\\t\\tif (this.active !== true) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tconst remoteConnections = [\\n\\t\\t\\t{\\n\\t\\t\\t\\tid: data.from!,\\n\\t\\t\\t\\tmedia: data.media,\\n\\t\\t\\t},\\n\\t\\t\\t...data.remoteConnections,\\n\\t\\t];\\n\\n\\t\\tremoteConnections.forEach((remoteConnection) => {\\n\\t\\t\\tif (remoteConnection.id !== this.selfId && this.peerConnections[remoteConnection.id] == null) {\\n\\t\\t\\t\\tthis.log('reconnecting with', remoteConnection.id);\\n\\t\\t\\t\\tthis.onRemoteJoin({\\n\\t\\t\\t\\t\\tfrom: remoteConnection.id,\\n\\t\\t\\t\\t\\tmedia: remoteConnection.media,\\n\\t\\t\\t\\t});\\n\\t\\t\\t}\\n\\t\\t});\\n\\t}\\n\\n\\tgetPeerConnection(id: string) {\\n\\t\\tif (this.peerConnections[id] != null) {\\n\\t\\t\\treturn this.peerConnections[id];\\n\\t\\t}\\n\\t\\tconst peerConnection = new RTCPeerConnection(this.config);\\n\\n\\t\\tpeerConnection.createdAt = Date.now();\\n\\t\\tpeerConnection.remoteMedia = {};\\n\\t\\tthis.peerConnections[id] = peerConnection;\\n\\t\\tconst eventNames = [\\n\\t\\t\\t'icecandidate',\\n\\t\\t\\t'addstream',\\n\\t\\t\\t'removestream',\\n\\t\\t\\t'iceconnectionstatechange',\\n\\t\\t\\t'datachannel',\\n\\t\\t\\t'identityresult',\\n\\t\\t\\t'idpassertionerror',\\n\\t\\t\\t'idpvalidationerror',\\n\\t\\t\\t'negotiationneeded',\\n\\t\\t\\t'peeridentity',\\n\\t\\t\\t'signalingstatechange',\\n\\t\\t];\\n\\n\\t\\teventNames.forEach((eventName) => {\\n\\t\\t\\tpeerConnection.addEventListener(eventName, (e) => {\\n\\t\\t\\t\\tthis.log(id, e.type, e);\\n\\t\\t\\t});\\n\\t\\t});\\n\\n\\t\\tpeerConnection.addEventListener('icecandidate', (e) => {\\n\\t\\t\\tif (e.candidate == null) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\tthis.transport.sendCandidate({\\n\\t\\t\\t\\tto: id,\\n\\t\\t\\t\\tcandidate: {\\n\\t\\t\\t\\t\\tcandidate: e.candidate.candidate,\\n\\t\\t\\t\\t\\tsdpMLineIndex: e.candidate.sdpMLineIndex,\\n\\t\\t\\t\\t\\tsdpMid: e.candidate.sdpMid,\\n\\t\\t\\t\\t},\\n\\t\\t\\t});\\n\\t\\t});\\n\\t\\tpeerConnection.addEventListener('addstream', () => {\\n\\t\\t\\tthis.updateRemoteItems();\\n\\t\\t});\\n\\t\\tpeerConnection.addEventListener('removestream', () => {\\n\\t\\t\\tthis.updateRemoteItems();\\n\\t\\t});\\n\\t\\tpeerConnection.addEventListener('iceconnectionstatechange', () => {\\n\\t\\t\\tif (\\n\\t\\t\\t\\t(peerConnection.iceConnectionState === 'disconnected' || peerConnection.iceConnectionState === 'closed') &&\\n\\t\\t\\t\\tpeerConnection === this.peerConnections[id]\\n\\t\\t\\t) {\\n\\t\\t\\t\\tthis.stopPeerConnection(id);\\n\\t\\t\\t\\tsetTimeout(() => {\\n\\t\\t\\t\\t\\tif (Object.keys(this.peerConnections).length === 0) {\\n\\t\\t\\t\\t\\t\\tthis.stop();\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}, 3000);\\n\\t\\t\\t}\\n\\t\\t\\tthis.updateRemoteItems();\\n\\t\\t});\\n\\t\\treturn peerConnection;\\n\\t}\\n\\n\\taudioContext: AudioContext | undefined;\\n\\n\\t_getUserMedia(media: MediaStreamConstraints, onSuccess: (stream: MediaStream) => void, onError: (error?: any) => void) {\\n\\t\\tconst onSuccessLocal = (stream: MediaStream) => {\\n\\t\\t\\tif (AudioContext && stream.getAudioTracks().length > 0) {\\n\\t\\t\\t\\tconst audioContext = new AudioContext();\\n\\t\\t\\t\\tconst source = audioContext.createMediaStreamSource(stream);\\n\\t\\t\\t\\tconst volume = audioContext.createGain();\\n\\t\\t\\t\\tsource.connect(volume);\\n\\t\\t\\t\\tconst peer = audioContext.createMediaStreamDestination();\\n\\t\\t\\t\\tvolume.connect(peer);\\n\\t\\t\\t\\tvolume.gain.value = 0.6;\\n\\t\\t\\t\\tstream.removeTrack(stream.getAudioTracks()[0]);\\n\\t\\t\\t\\tstream.addTrack(peer.stream.getAudioTracks()[0]);\\n\\t\\t\\t\\tstream.volume = volume;\\n\\t\\t\\t\\tthis.audioContext = audioContext;\\n\\t\\t\\t}\\n\\t\\t\\tonSuccess(stream);\\n\\t\\t};\\n\\n\\t\\tif (navigator.mediaDevices?.getUserMedia) {\\n\\t\\t\\treturn navigator.mediaDevices.getUserMedia(media).then(onSuccessLocal).catch(onError);\\n\\t\\t}\\n\\n\\t\\tnavigator.getUserMedia?.(media, onSuccessLocal, onError);\\n\\t}\\n\\n\\tgetUserMedia(media: MediaStreamConstraints, onSuccess: (stream: MediaStream) => void, onError: (error: any) => void = this.onError) {\\n\\t\\tif (media.desktop !== true) {\\n\\t\\t\\tvoid this._getUserMedia(media, onSuccess, onError);\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tif (this.screenShareAvailable !== true) {\\n\\t\\t\\tconsole.log('Screen share is not avaliable');\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tconst getScreen = (audioStream?: MediaStream) => {\\n\\t\\t\\tconst refresh = function () {\\n\\t\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\t\\tcomponent: GenericModal,\\n\\t\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\t\\tvariant: 'warning',\\n\\t\\t\\t\\t\\t\\ttitle: t('Refresh_your_page_after_install_to_enable_screen_sharing'),\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t});\\n\\t\\t\\t};\\n\\n\\t\\t\\tconst isChromeExtensionInstalled = this.navigator === 'chrome' && ChromeScreenShare.installed;\\n\\t\\t\\tconst isFirefoxExtensionInstalled = this.navigator === 'firefox' && window.rocketchatscreenshare != null;\\n\\n\\t\\t\\tif (!isChromeExtensionInstalled && !isFirefoxExtensionInstalled) {\\n\\t\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\t\\tcomponent: GenericModal,\\n\\t\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\t\\ttitle: t('Screen_Share'),\\n\\t\\t\\t\\t\\t\\tvariant: 'warning',\\n\\t\\t\\t\\t\\t\\tconfirmText: t('Install_Extension'),\\n\\t\\t\\t\\t\\t\\tcancelText: t('Cancel'),\\n\\t\\t\\t\\t\\t\\tchildren: t('You_need_install_an_extension_to_allow_screen_sharing'),\\n\\t\\t\\t\\t\\t\\tonConfirm: () => {\\n\\t\\t\\t\\t\\t\\t\\tif (this.navigator === 'chrome') {\\n\\t\\t\\t\\t\\t\\t\\t\\tconst url = 'https://chrome.google.com/webstore/detail/rocketchat-screen-share/nocfbnnmjnndkbipkabodnheejiegccf';\\n\\t\\t\\t\\t\\t\\t\\t\\ttry {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tchrome.webstore.install(url, refresh, () => {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\twindow.open(url);\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\trefresh();\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t\\t\\t\\t} catch (_error) {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tconsole.log(_error);\\n\\t\\t\\t\\t\\t\\t\\t\\t\\twindow.open(url);\\n\\t\\t\\t\\t\\t\\t\\t\\t\\trefresh();\\n\\t\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t\\t} else if (this.navigator === 'firefox') {\\n\\t\\t\\t\\t\\t\\t\\t\\twindow.open('https://addons.mozilla.org/en-GB/firefox/addon/rocketchat-screen-share/');\\n\\t\\t\\t\\t\\t\\t\\t\\trefresh();\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t});\\n\\n\\t\\t\\t\\treturn onError(false);\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst getScreenSuccess = (stream: MediaStream) => {\\n\\t\\t\\t\\tif (audioStream != null) {\\n\\t\\t\\t\\t\\tstream.addTrack(audioStream.getAudioTracks()[0]);\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tonSuccess(stream);\\n\\t\\t\\t};\\n\\t\\t\\tif (this.navigator === 'firefox') {\\n\\t\\t\\t\\tmedia = {\\n\\t\\t\\t\\t\\taudio: media.audio,\\n\\t\\t\\t\\t\\tvideo: {\\n\\t\\t\\t\\t\\t\\tmozMediaSource: 'window',\\n\\t\\t\\t\\t\\t\\tmediaSource: 'window',\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t};\\n\\t\\t\\t\\tvoid this._getUserMedia(media, getScreenSuccess, onError);\\n\\t\\t\\t} else {\\n\\t\\t\\t\\tChromeScreenShare.getSourceId(this.navigator!, (id) => {\\n\\t\\t\\t\\t\\tmedia = {\\n\\t\\t\\t\\t\\t\\taudio: false,\\n\\t\\t\\t\\t\\t\\tvideo: {\\n\\t\\t\\t\\t\\t\\t\\tmandatory: {\\n\\t\\t\\t\\t\\t\\t\\t\\tchromeMediaSource: 'desktop',\\n\\t\\t\\t\\t\\t\\t\\t\\tchromeMediaSourceId: id,\\n\\t\\t\\t\\t\\t\\t\\t\\tmaxWidth: 1280,\\n\\t\\t\\t\\t\\t\\t\\t\\tmaxHeight: 720,\\n\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t};\\n\\t\\t\\t\\t\\tvoid this._getUserMedia(media, getScreenSuccess, onError);\\n\\t\\t\\t\\t});\\n\\t\\t\\t}\\n\\t\\t};\\n\\t\\tif (this.navigator === 'firefox' || media.audio == null || media.audio === false) {\\n\\t\\t\\tgetScreen();\\n\\t\\t} else {\\n\\t\\t\\tconst getAudioSuccess = (audioStream: MediaStream) => {\\n\\t\\t\\t\\tgetScreen(audioStream);\\n\\t\\t\\t};\\n\\t\\t\\tconst getAudioError = () => {\\n\\t\\t\\t\\tgetScreen();\\n\\t\\t\\t};\\n\\n\\t\\t\\tvoid this._getUserMedia(\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\taudio: media.audio,\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\tgetAudioSuccess,\\n\\t\\t\\t\\tgetAudioError,\\n\\t\\t\\t);\\n\\t\\t}\\n\\t}\\n\\n\\tgetLocalUserMedia(callback: (...args: any[]) => void, ...args: unknown[]) {\\n\\t\\tthis.log('getLocalUserMedia', [callback, ...args]);\\n\\t\\tif (this.localStream != null) {\\n\\t\\t\\treturn callback(null, this.localStream);\\n\\t\\t}\\n\\t\\tconst onSuccess = (stream: MediaStream) => {\\n\\t\\t\\tthis.localStream = stream;\\n\\t\\t\\t!this.audioEnabled.get() && this.disableAudio();\\n\\t\\t\\t!this.videoEnabled.get() && this.disableVideo();\\n\\t\\t\\tthis.localUrl.set(stream);\\n\\t\\t\\tconst { peerConnections } = this;\\n\\t\\t\\tObject.entries(peerConnections).forEach(([, peerConnection]) => peerConnection.addStream(stream));\\n\\t\\t\\tdocument.querySelector<HTMLVideoElement>('video#localVideo')!.srcObject = stream;\\n\\t\\t\\tcallback(null, this.localStream);\\n\\t\\t};\\n\\t\\tconst onError = (error: any) => {\\n\\t\\t\\tcallback(false);\\n\\t\\t\\tthis.onError(error);\\n\\t\\t};\\n\\t\\tthis.getUserMedia(this.media, onSuccess, onError);\\n\\t}\\n\\n\\tstopPeerConnection = (id: string) => {\\n\\t\\tconst peerConnection = this.peerConnections[id];\\n\\t\\tif (peerConnection == null) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tdelete this.peerConnections[id];\\n\\t\\tpeerConnection.close();\\n\\t\\tthis.updateRemoteItems();\\n\\t};\\n\\n\\tstopAllPeerConnections() {\\n\\t\\tconst { peerConnections } = this;\\n\\n\\t\\tObject.keys(peerConnections).forEach(this.stopPeerConnection);\\n\\n\\t\\tvoid window.audioContext?.close(); // FIXME: probably should be `this.audioContext`\\n\\t}\\n\\n\\tsetAudioEnabled(enabled = true) {\\n\\t\\tif (this.localStream != null) {\\n\\t\\t\\tthis.localStream.getAudioTracks().forEach((audio) => {\\n\\t\\t\\t\\taudio.enabled = enabled;\\n\\t\\t\\t});\\n\\t\\t\\tthis.audioEnabled.set(enabled);\\n\\t\\t}\\n\\t}\\n\\n\\tdisableAudio() {\\n\\t\\tthis.setAudioEnabled(false);\\n\\t}\\n\\n\\tenableAudio() {\\n\\t\\tthis.setAudioEnabled(true);\\n\\t}\\n\\n\\ttoggleAudio() {\\n\\t\\tif (this.audioEnabled.get()) {\\n\\t\\t\\treturn this.disableAudio();\\n\\t\\t}\\n\\t\\treturn this.enableAudio();\\n\\t}\\n\\n\\tlocalStream: MediaStream | undefined;\\n\\n\\tsetVideoEnabled(enabled = true) {\\n\\t\\tif (this.localStream != null) {\\n\\t\\t\\tthis.localStream.getVideoTracks().forEach((video) => {\\n\\t\\t\\t\\tvideo.enabled = enabled;\\n\\t\\t\\t});\\n\\t\\t\\tthis.videoEnabled.set(enabled);\\n\\t\\t}\\n\\t}\\n\\n\\tdisableScreenShare() {\\n\\t\\tthis.setScreenShareEnabled(false);\\n\\t}\\n\\n\\tenableScreenShare() {\\n\\t\\tthis.setScreenShareEnabled(true);\\n\\t}\\n\\n\\tsetScreenShareEnabled(enabled = true) {\\n\\t\\tif (this.localStream != null) {\\n\\t\\t\\tthis.media.desktop = enabled;\\n\\t\\t\\tdelete this.localStream;\\n\\t\\t\\tthis.getLocalUserMedia((err) => {\\n\\t\\t\\t\\tif (err != null) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tthis.screenShareEnabled.set(enabled);\\n\\t\\t\\t\\tthis.stopAllPeerConnections();\\n\\t\\t\\t\\tthis.joinCall();\\n\\t\\t\\t});\\n\\t\\t}\\n\\t}\\n\\n\\tdisableVideo() {\\n\\t\\tthis.setVideoEnabled(false);\\n\\t}\\n\\n\\tenableVideo() {\\n\\t\\tthis.setVideoEnabled(true);\\n\\t}\\n\\n\\ttoggleVideo() {\\n\\t\\tif (this.videoEnabled.get()) {\\n\\t\\t\\treturn this.disableVideo();\\n\\t\\t}\\n\\t\\treturn this.enableVideo();\\n\\t}\\n\\n\\tstop() {\\n\\t\\tthis.active = false;\\n\\t\\tthis.monitor = false;\\n\\t\\tthis.remoteMonitoring = false;\\n\\t\\tif (this.localStream != null && typeof this.localStream !== 'undefined') {\\n\\t\\t\\tthis.localStream.getTracks().forEach((track) => track.stop());\\n\\t\\t}\\n\\t\\tthis.localUrl.set(undefined);\\n\\t\\tdelete this.localStream;\\n\\t\\tthis.stopAllPeerConnections();\\n\\t}\\n\\n\\tstartCall(media: MediaStreamConstraints = {}, ...args: unknown[]) {\\n\\t\\tthis.log('startCall', [media, ...args]);\\n\\t\\tthis.media = media;\\n\\t\\tthis.getLocalUserMedia(() => {\\n\\t\\t\\tthis.active = true;\\n\\t\\t\\tthis.transport.startCall({\\n\\t\\t\\t\\tmedia: this.media,\\n\\t\\t\\t});\\n\\t\\t});\\n\\t}\\n\\n\\tstartCallAsMonitor(media: MediaStreamConstraints = {}, ...args: unknown[]) {\\n\\t\\tthis.log('startCallAsMonitor', [media, ...args]);\\n\\t\\tthis.media = media;\\n\\t\\tthis.active = true;\\n\\t\\tthis.monitor = true;\\n\\t\\tthis.transport.startCall({\\n\\t\\t\\tmedia: this.media,\\n\\t\\t\\tmonitor: true,\\n\\t\\t});\\n\\t}\\n\\n\\tonRemoteCall(data: CallData) {\\n\\t\\tif (this.autoAccept === true) {\\n\\t\\t\\tsetTimeout(() => {\\n\\t\\t\\t\\tthis.joinCall({\\n\\t\\t\\t\\t\\tto: data.from,\\n\\t\\t\\t\\t\\tmonitor: data.monitor,\\n\\t\\t\\t\\t\\tmedia: data.media,\\n\\t\\t\\t\\t});\\n\\t\\t\\t}, 0);\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst user = Meteor.users.findOne(data.from);\\n\\t\\tlet fromUsername = undefined;\\n\\t\\tif (user?.username) {\\n\\t\\t\\tfromUsername = user.username;\\n\\t\\t}\\n\\t\\tconst subscription = ChatSubscription.findOne({\\n\\t\\t\\trid: data.room,\\n\\t\\t})!;\\n\\n\\t\\tlet icon;\\n\\t\\tlet title;\\n\\t\\tif (data.monitor === true) {\\n\\t\\t\\ticon = 'eye' as const;\\n\\t\\t\\ttitle = t('WebRTC_monitor_call_from_%s', fromUsername);\\n\\t\\t} else if (subscription && subscription.t === 'd') {\\n\\t\\t\\tif (data.media?.video) {\\n\\t\\t\\t\\ticon = 'video' as const;\\n\\t\\t\\t\\ttitle = t('WebRTC_direct_video_call_from_%s', fromUsername);\\n\\t\\t\\t} else {\\n\\t\\t\\t\\ticon = 'phone' as const;\\n\\t\\t\\t\\ttitle = t('WebRTC_direct_audio_call_from_%s', fromUsername);\\n\\t\\t\\t}\\n\\t\\t} else if (data.media?.video) {\\n\\t\\t\\ticon = 'video' as const;\\n\\t\\t\\ttitle = t('WebRTC_group_video_call_from_%s', subscription.name);\\n\\t\\t} else {\\n\\t\\t\\ticon = 'phone' as const;\\n\\t\\t\\ttitle = t('WebRTC_group_audio_call_from_%s', subscription.name);\\n\\t\\t}\\n\\n\\t\\timperativeModal.open({\\n\\t\\t\\tcomponent: GenericModal,\\n\\t\\t\\tprops: {\\n\\t\\t\\t\\ttitle,\\n\\t\\t\\t\\ticon,\\n\\t\\t\\t\\tconfirmText: t('Yes'),\\n\\t\\t\\t\\tcancelText: t('No'),\\n\\t\\t\\t\\tchildren: t('Do_you_want_to_accept'),\\n\\t\\t\\t\\tonConfirm: () => {\\n\\t\\t\\t\\t\\tvoid goToRoomById(data.room!);\\n\\t\\t\\t\\t\\treturn this.joinCall({\\n\\t\\t\\t\\t\\t\\tto: data.from,\\n\\t\\t\\t\\t\\t\\tmonitor: data.monitor,\\n\\t\\t\\t\\t\\t\\tmedia: data.media,\\n\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\tonCancel: () => this.stop(),\\n\\t\\t\\t\\tonClose: () => this.stop(),\\n\\t\\t\\t},\\n\\t\\t});\\n\\t}\\n\\n\\tjoinCall(data: JoinData = {}, ...args: unknown[]) {\\n\\t\\tdata.media = this.media;\\n\\t\\tthis.log('joinCall', [data, ...args]);\\n\\t\\tthis.getLocalUserMedia(() => {\\n\\t\\t\\tthis.remoteMonitoring = data.monitor!;\\n\\t\\t\\tthis.active = true;\\n\\t\\t\\tthis.transport.joinCall(data);\\n\\t\\t});\\n\\t}\\n\\n\\tonRemoteJoin(data: JoinData, ...args: unknown[]) {\\n\\t\\tif (this.active !== true) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tthis.log('onRemoteJoin', [data, ...args]);\\n\\t\\tlet peerConnection = this.getPeerConnection(data.from!);\\n\\n\\t\\t// needsRefresh = false\\n\\t\\t// if peerConnection.iceConnectionState isnt 'new'\\n\\t\\t// needsAudio = data.media.audio is true and peerConnection.remoteMedia.audio isnt true\\n\\t\\t// needsVideo = data.media.video is true and peerConnection.remoteMedia.video isnt true\\n\\t\\t// needsRefresh = needsAudio or needsVideo or data.media.desktop isnt peerConnection.remoteMedia.desktop\\n\\n\\t\\t// # if peerConnection.signalingState is \\\"have-local-offer\\\" or needsRefresh\\n\\n\\t\\tif ((peerConnection.signalingState as RTCSignalingState | 'checking') !== 'checking') {\\n\\t\\t\\tthis.stopPeerConnection(data.from!);\\n\\t\\t\\tpeerConnection = this.getPeerConnection(data.from!);\\n\\t\\t}\\n\\t\\tif (peerConnection.iceConnectionState !== 'new') {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tpeerConnection.remoteMedia = data.media!;\\n\\t\\tif (this.localStream) {\\n\\t\\t\\tpeerConnection.addStream(this.localStream);\\n\\t\\t}\\n\\t\\tconst onOffer: RTCSessionDescriptionCallback = (offer) => {\\n\\t\\t\\tconst onLocalDescription = () => {\\n\\t\\t\\t\\tthis.transport.sendDescription({\\n\\t\\t\\t\\t\\tto: data.from,\\n\\t\\t\\t\\t\\ttype: 'offer',\\n\\t\\t\\t\\t\\tts: peerConnection.createdAt,\\n\\t\\t\\t\\t\\tmedia: this.media,\\n\\t\\t\\t\\t\\tdescription: {\\n\\t\\t\\t\\t\\t\\tsdp: offer.sdp,\\n\\t\\t\\t\\t\\t\\ttype: offer.type,\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t});\\n\\t\\t\\t};\\n\\n\\t\\t\\tvoid peerConnection.setLocalDescription(new RTCSessionDescription(offer), onLocalDescription, this.onError);\\n\\t\\t};\\n\\n\\t\\tif (data.monitor === true) {\\n\\t\\t\\tvoid peerConnection.createOffer(onOffer, this.onError, {\\n\\t\\t\\t\\tmandatory: {\\n\\t\\t\\t\\t\\tOfferToReceiveAudio: data.media?.audio,\\n\\t\\t\\t\\t\\tOfferToReceiveVideo: data.media?.video,\\n\\t\\t\\t\\t},\\n\\t\\t\\t});\\n\\t\\t} else {\\n\\t\\t\\tvoid peerConnection.createOffer(onOffer, this.onError);\\n\\t\\t}\\n\\t}\\n\\n\\tonRemoteOffer(data: Omit<DescriptionData, 'type'>, ...args: unknown[]) {\\n\\t\\tif (this.active !== true) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tthis.log('onRemoteOffer', [data, ...args]);\\n\\t\\tlet peerConnection = this.getPeerConnection(data.from!);\\n\\n\\t\\tif (['have-local-offer', 'stable'].includes(peerConnection.signalingState) && peerConnection.createdAt < data.ts) {\\n\\t\\t\\tthis.stopPeerConnection(data.from!);\\n\\t\\t\\tpeerConnection = this.getPeerConnection(data.from!);\\n\\t\\t}\\n\\n\\t\\tif (peerConnection.iceConnectionState !== 'new') {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tvoid peerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\\n\\n\\t\\ttry {\\n\\t\\t\\tif (this.localStream) {\\n\\t\\t\\t\\tpeerConnection.addStream(this.localStream);\\n\\t\\t\\t}\\n\\t\\t} catch (error) {\\n\\t\\t\\tconsole.log(error);\\n\\t\\t}\\n\\n\\t\\tconst onAnswer: RTCSessionDescriptionCallback = (answer) => {\\n\\t\\t\\tconst onLocalDescription = () => {\\n\\t\\t\\t\\tthis.transport.sendDescription({\\n\\t\\t\\t\\t\\tto: data.from,\\n\\t\\t\\t\\t\\ttype: 'answer',\\n\\t\\t\\t\\t\\tts: peerConnection.createdAt,\\n\\t\\t\\t\\t\\tdescription: {\\n\\t\\t\\t\\t\\t\\tsdp: answer.sdp,\\n\\t\\t\\t\\t\\t\\ttype: answer.type,\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t});\\n\\t\\t\\t};\\n\\n\\t\\t\\tvoid peerConnection.setLocalDescription(new RTCSessionDescription(answer), onLocalDescription, this.onError);\\n\\t\\t};\\n\\n\\t\\tvoid peerConnection.createAnswer(onAnswer, this.onError);\\n\\t}\\n\\n\\tonRemoteCandidate(data: CandidateData, ...args: unknown[]) {\\n\\t\\tif (this.active !== true) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tif (data.to !== this.selfId) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tthis.log('onRemoteCandidate', [data, ...args]);\\n\\t\\tconst peerConnection = this.getPeerConnection(data.from!);\\n\\t\\tif (\\n\\t\\t\\tpeerConnection.iceConnectionState !== 'closed' &&\\n\\t\\t\\tpeerConnection.iceConnectionState !== 'failed' &&\\n\\t\\t\\tpeerConnection.iceConnectionState !== 'disconnected' &&\\n\\t\\t\\tpeerConnection.iceConnectionState !== 'completed'\\n\\t\\t) {\\n\\t\\t\\tvoid peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));\\n\\t\\t}\\n\\t\\tdocument.querySelector<HTMLVideoElement>('video#remoteVideo')!.srcObject = this.remoteItems.get()[0]?.url;\\n\\t}\\n\\n\\tonRemoteDescription(data: DescriptionData, ...args: unknown[]) {\\n\\t\\tif (this.active !== true) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tif (data.to !== this.selfId) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tthis.log('onRemoteDescription', [data, ...args]);\\n\\t\\tconst peerConnection = this.getPeerConnection(data.from!);\\n\\t\\tif (data.type === 'offer') {\\n\\t\\t\\tpeerConnection.remoteMedia = data.media;\\n\\t\\t\\tthis.onRemoteOffer({\\n\\t\\t\\t\\tfrom: data.from,\\n\\t\\t\\t\\tts: data.ts,\\n\\t\\t\\t\\tdescription: data.description,\\n\\t\\t\\t});\\n\\t\\t} else {\\n\\t\\t\\tvoid peerConnection.setRemoteDescription(new RTCSessionDescription(data.description));\\n\\t\\t}\\n\\t}\\n}\\n\\nconst WebRTC = new (class {\\n\\tinstancesByRoomId: Record<string, WebRTCClass> = {};\\n\\n\\tconstructor() {\\n\\t\\tthis.instancesByRoomId = {};\\n\\t}\\n\\n\\tgetInstanceByRoomId(rid: IRoom['_id'], visitorId: string | null = null) {\\n\\t\\tlet enabled = false;\\n\\t\\tif (!visitorId) {\\n\\t\\t\\tconst subscription = ChatSubscription.findOne({ rid });\\n\\t\\t\\tif (!subscription) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\tswitch (subscription.t) {\\n\\t\\t\\t\\tcase 'd':\\n\\t\\t\\t\\t\\tenabled = settings.get('WebRTC_Enable_Direct');\\n\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\tcase 'p':\\n\\t\\t\\t\\t\\tenabled = settings.get('WebRTC_Enable_Private');\\n\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\tcase 'c':\\n\\t\\t\\t\\t\\tenabled = settings.get('WebRTC_Enable_Channel');\\n\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\tcase 'l':\\n\\t\\t\\t\\t\\tenabled = settings.get<string>('Omnichannel_call_provider') === 'WebRTC';\\n\\t\\t\\t}\\n\\t\\t} else {\\n\\t\\t\\tenabled = settings.get<string>('Omnichannel_call_provider') === 'WebRTC';\\n\\t\\t}\\n\\t\\tenabled = enabled && settings.get('WebRTC_Enabled');\\n\\t\\tif (enabled === false) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tif (this.instancesByRoomId[rid] == null) {\\n\\t\\t\\tlet uid = Meteor.userId()!;\\n\\t\\t\\tlet autoAccept = false;\\n\\t\\t\\tif (visitorId) {\\n\\t\\t\\t\\tuid = visitorId;\\n\\t\\t\\t\\tautoAccept = true;\\n\\t\\t\\t}\\n\\t\\t\\tthis.instancesByRoomId[rid] = new WebRTCClass(uid, rid, autoAccept);\\n\\t\\t}\\n\\t\\treturn this.instancesByRoomId[rid];\\n\\t}\\n})();\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(() => {\\n\\t\\tconst uid = Meteor.userId();\\n\\n\\t\\tif (uid) {\\n\\t\\t\\tsdk.stream('notify-user', [`${uid}/${WEB_RTC_EVENTS.WEB_RTC}`], (type, data) => {\\n\\t\\t\\t\\tif (data.room == null) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tconst webrtc = WebRTC.getInstanceByRoomId(data.room);\\n\\n\\t\\t\\t\\tswitch (type) {\\n\\t\\t\\t\\t\\tcase 'candidate':\\n\\t\\t\\t\\t\\t\\twebrtc?.onUserStream('candidate', data);\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t\\tcase 'description':\\n\\t\\t\\t\\t\\t\\twebrtc?.onUserStream('description', data);\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t\\tcase 'join':\\n\\t\\t\\t\\t\\t\\twebrtc?.onUserStream('join', data);\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t}\\n\\t\\t\\t});\\n\\t\\t}\\n\\t});\\n});\\n\\nexport { WebRTC };\\n\",null],\"names\":[\"Emitter\",\"Meteor\",\"ReactiveVar\",\"Tracker\",\"GenericModal\",\"imperativeModal\",\"goToRoomById\",\"ChatSubscription\",\"settings\",\"sdk\",\"t\",\"WEB_RTC_EVENTS\",\"ChromeScreenShare\",\"module\",\"export\",\"WebRTC\",\"link\",\"v\",\"default\",\"WebRTCTransportClass\",\"constructor\",\"webrtcInstance\",\"debug\",\"stream\",\"concat\",\"room\",\"WEB_RTC\",\"type\",\"data\",\"log\",\"emit\",\"console\",\"arguments\",\"onUserStream\",\"_len\",\"length\",\"_ref\",\"Array\",\"_key\",\"startCall\",\"selfId\",\"publish\",\"CALL\",\"from\",\"media\",\"monitor\",\"joinCall\",\"to\",\"JOIN\",\"sendCandidate\",\"CANDIDATE\",\"sendDescription\",\"DESCRIPTION\",\"sendStatus\",\"STATUS\",\"onRemoteCall\",\"fn\",\"on\",\"onRemoteJoin\",\"onRemoteCandidate\",\"onRemoteDescription\",\"onRemoteStatus\",\"WebRTCClass\",\"autoAccept\",\"undefined\",\"transport\",\"config\",\"TransportClass\",\"peerConnections\",\"remoteItems\",\"remoteItemsById\",\"callInProgress\",\"audioEnabled\",\"videoEnabled\",\"overlayEnabled\",\"screenShareEnabled\",\"localUrl\",\"active\",\"remoteMonitoring\",\"navigator\",\"screenShareAvailable\",\"resetCallInProgress\",\"set\",\"callInProgressTimeout\",\"audioContext\",\"stopPeerConnection\",\"id\",\"peerConnection\",\"close\",\"updateRemoteItems\",\"localStream\",\"iceServers\",\"servers\",\"get\",\"trim\",\"replace\",\"split\",\"forEach\",\"server\",\"parts\",\"serverConfig\",\"urls\",\"pop\",\"username\",\"credential\",\"decodeURIComponent\",\"push\",\"userAgent\",\"toLocaleLowerCase\",\"indexOf\",\"includes\",\"video\",\"audio\",\"bind\",\"setInterval\",\"checkPeerConnections\",\"_len2\",\"_ref2\",\"_key2\",\"onError\",\"error\",\"date\",\"Date\",\"now\",\"Object\",\"entries\",\"some\",\"_ref3\",\"iceConnectionState\",\"createdAt\",\"items\",\"itemsById\",\"_ref4\",\"getRemoteStreams\",\"remoteStream\",\"item\",\"url\",\"state\",\"stateText\",\"connected\",\"broadcastStatus\",\"remoteConnections\",\"_ref5\",\"remoteMedia\",\"clearTimeout\",\"setTimeout\",\"remoteConnection\",\"getPeerConnection\",\"RTCPeerConnection\",\"eventNames\",\"eventName\",\"addEventListener\",\"e\",\"candidate\",\"sdpMLineIndex\",\"sdpMid\",\"keys\",\"stop\",\"_getUserMedia\",\"onSuccess\",\"_navigator$mediaDevic\",\"_navigator$getUserMed\",\"_navigator\",\"onSuccessLocal\",\"AudioContext\",\"getAudioTracks\",\"source\",\"createMediaStreamSource\",\"volume\",\"createGain\",\"connect\",\"peer\",\"createMediaStreamDestination\",\"gain\",\"value\",\"removeTrack\",\"addTrack\",\"mediaDevices\",\"getUserMedia\",\"then\",\"catch\",\"call\",\"desktop\",\"getScreen\",\"audioStream\",\"refresh\",\"open\",\"component\",\"props\",\"variant\",\"title\",\"isChromeExtensionInstalled\",\"installed\",\"isFirefoxExtensionInstalled\",\"window\",\"rocketchatscreenshare\",\"confirmText\",\"cancelText\",\"children\",\"onConfirm\",\"chrome\",\"webstore\",\"install\",\"_error\",\"getScreenSuccess\",\"mozMediaSource\",\"mediaSource\",\"getSourceId\",\"mandatory\",\"chromeMediaSource\",\"chromeMediaSourceId\",\"maxWidth\",\"maxHeight\",\"getAudioError\",\"getLocalUserMedia\",\"callback\",\"_len3\",\"args\",\"_key3\",\"disableAudio\",\"disableVideo\",\"_ref6\",\"addStream\",\"document\",\"querySelector\",\"srcObject\",\"stopAllPeerConnections\",\"_window$audioContext\",\"setAudioEnabled\",\"enabled\",\"enableAudio\",\"toggleAudio\",\"setVideoEnabled\",\"getVideoTracks\",\"disableScreenShare\",\"setScreenShareEnabled\",\"enableScreenShare\",\"err\",\"enableVideo\",\"toggleVideo\",\"getTracks\",\"track\",\"_len4\",\"_key4\",\"startCallAsMonitor\",\"_len5\",\"_key5\",\"_data$media2\",\"_data$media\",\"icon\",\"fromUsername\",\"user\",\"users\",\"findOne\",\"subscription\",\"rid\",\"name\",\"onCancel\",\"onClose\",\"_len6\",\"_key6\",\"_data$media3\",\"_data$media4\",\"_len7\",\"_key7\",\"signalingState\",\"onOffer\",\"offer\",\"setLocalDescription\",\"RTCSessionDescription\",\"onLocalDescription\",\"ts\",\"description\",\"sdp\",\"createOffer\",\"OfferToReceiveAudio\",\"OfferToReceiveVideo\",\"onRemoteOffer\",\"_len8\",\"_key8\",\"setRemoteDescription\",\"createAnswer\",\"answer\",\"_this$remoteItems$get\",\"_len9\",\"_key9\",\"addIceCandidate\",\"RTCIceCandidate\",\"_len10\",\"_key10\",\"instancesByRoomId\",\"getInstanceByRoomId\",\"visitorId\",\"uid\",\"userId\",\"startup\",\"autorun\",\"webrtc\"],\"mappings\":\"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\"}"}