{"code":"function module(e,t,i){var n,r,o,s,c,a,u,l,h=[\"appId\"];i.link(\"@babel/runtime/regenerator\",{default:function(e){n=e}},0),i.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){r=e}},1),i.link(\"@babel/runtime/helpers/objectWithoutProperties\",{default:function(e){o=e}},2),i.link(\"@babel/runtime/helpers/createClass\",{default:function(e){s=e}},3),i.link(\"@babel/runtime/helpers/inheritsLoose\",{default:function(e){c=e}},4),i.export({loginServices:function(){return d}}),i.link(\"@rocket.chat/emitter\",{Emitter:function(e){a=e}},0),i.link(\"@rocket.chat/string-helpers\",{capitalize:function(e){u=e}},1),i.link(\"../../app/utils/client/lib/SDKClient\",{sdk:function(e){l=e}},2);var d=new(function(e){function t(){for(var t,i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).retries=0,t.services=[],t.serviceButtons=[],t.state=\"none\",t.config={apple:{title:\"Apple\",icon:\"apple\"},facebook:{title:\"Facebook\",icon:\"facebook\"},twitter:{title:\"Twitter\",icon:\"twitter\"},google:{title:\"Google\",icon:\"google\"},github:{title:\"Github\",icon:\"github\"},github_enterprise:{title:\"Github Enterprise\",icon:\"github\"},gitlab:{title:\"Gitlab\",icon:\"gitlab\"},dolphin:{title:\"Dolphin\",icon:\"dophin\"},drupal:{title:\"Drupal\",icon:\"drupal\"},nextcloud:{title:\"Nextcloud\",icon:\"nextcloud\"},tokenpass:{title:\"Tokenpass\",icon:\"tokenpass\"},\"meteor-developer\":{title:\"Meteor\",icon:\"meteor\"},wordpress:{title:\"WordPress\",icon:\"wordpress\"},linkedin:{title:\"Linkedin\",icon:\"linkedin\"}},t}c(t,e);var i=t.prototype;return i.setServices=function(e,t){this.services=t,this.state=e,this.generateServiceButtons(),\"loaded\"===e&&(this.retries=0,this.emit(\"loaded\",t))},i.generateServiceButtons=function(){var e=this,t=(this.services.filter(function(e){return!(\"showButton\"in e)||!1!==e.showButton})||[]).sort(function(e,t){var i=e.service,n=t.service;return i.localeCompare(n)});this.serviceButtons=t.map(function(t){var i=r(r({},t),{},{appId:void 0}),n=(i.appId,o(i,h)),s=e.config[t.service]||{title:u(t.service)};return r(r({},n),s)}),this.emit(\"changed\")},i.getLoginService=function(e){if(this.ready)return this.services.find(function(t){return t.service===e})},i.loadLoginService=function(e){var t=this;return n.async(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this.ready){i.next=2;break}return i.abrupt(\"return\",this.getLoginService(e));case 2:return i.abrupt(\"return\",new Promise(function(i,n){t.onLoad(function(){return i(t.getLoginService(e))}),setTimeout(function(){return n(Error(\"LoadLoginService timeout\"))},1e4)}));case 3:case\"end\":return i.stop()}},null,this,null,Promise)},i.getLoginServiceButtons=function(){return this.ready||\"none\"!==this.state||void this.loadServices(),this.serviceButtons},i.onLoad=function(e){if(this.ready)return e(this.services);this.loadServices(),this.once(\"loaded\",e)},i.loadServices=function(){var e;return n.async(function(t){for(;;)switch(t.prev=t.next){case 0:if(\"error\"!==this.state){t.next=6;break}if(!(this.retries>=3)){t.next=3;break}return t.abrupt(\"return\");case 3:this.retries++,t.next=8;break;case 6:if(!(\"none\"!==this.state)){t.next=8;break}return t.abrupt(\"return\");case 8:return t.prev=8,this.state=\"loading\",t.next=12,n.awrap(l.rest.get(\"/v1/service.configurations\"));case 12:e=t.sent.configurations,this.setServices(\"loaded\",e),t.next=21;break;case 17:throw t.prev=17,t.t0=t.catch(8),this.setServices(\"error\",[]),t.t0;case 21:case\"end\":return t.stop()}},null,this,[[8,17]],Promise)},s(t,[{key:\"ready\",get:function(){return\"loaded\"===this.state}}])}(a))}","map":"{\"version\":3,\"sources\":[\"client/lib/loginServices.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { LoginServiceConfiguration } from '@rocket.chat/core-typings';\\nimport { Emitter } from '@rocket.chat/emitter';\\nimport { capitalize } from '@rocket.chat/string-helpers';\\nimport type { LoginService } from '@rocket.chat/ui-contexts';\\n\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\n\\ntype LoginServicesEvents = {\\n\\tchanged: undefined;\\n\\tloaded: LoginServiceConfiguration[];\\n};\\n\\ntype LoadState = 'loaded' | 'loading' | 'error' | 'none';\\n\\nconst maxRetries = 3;\\nconst timeout = 10000;\\n\\nclass LoginServices extends Emitter<LoginServicesEvents> {\\n\\tprivate retries = 0;\\n\\n\\tprivate services: LoginServiceConfiguration[] = [];\\n\\n\\tprivate serviceButtons: LoginService[] = [];\\n\\n\\tprivate state: LoadState = 'none';\\n\\n\\tprivate config: Record<string, Partial<LoginService>> = {\\n\\t\\t'apple': { title: 'Apple', icon: 'apple' },\\n\\t\\t'facebook': { title: 'Facebook', icon: 'facebook' },\\n\\t\\t'twitter': { title: 'Twitter', icon: 'twitter' },\\n\\t\\t'google': { title: 'Google', icon: 'google' },\\n\\t\\t'github': { title: 'Github', icon: 'github' },\\n\\t\\t'github_enterprise': { title: 'Github Enterprise', icon: 'github' },\\n\\t\\t'gitlab': { title: 'Gitlab', icon: 'gitlab' },\\n\\t\\t'dolphin': { title: 'Dolphin', icon: 'dophin' },\\n\\t\\t'drupal': { title: 'Drupal', icon: 'drupal' },\\n\\t\\t'nextcloud': { title: 'Nextcloud', icon: 'nextcloud' },\\n\\t\\t'tokenpass': { title: 'Tokenpass', icon: 'tokenpass' },\\n\\t\\t'meteor-developer': { title: 'Meteor', icon: 'meteor' },\\n\\t\\t'wordpress': { title: 'WordPress', icon: 'wordpress' },\\n\\t\\t'linkedin': { title: 'Linkedin', icon: 'linkedin' },\\n\\t};\\n\\n\\tprivate setServices(state: LoadState, services: LoginServiceConfiguration[]) {\\n\\t\\tthis.services = services;\\n\\t\\tthis.state = state;\\n\\n\\t\\tthis.generateServiceButtons();\\n\\n\\t\\tif (state === 'loaded') {\\n\\t\\t\\tthis.retries = 0;\\n\\t\\t\\tthis.emit('loaded', services);\\n\\t\\t}\\n\\t}\\n\\n\\tprivate generateServiceButtons(): void {\\n\\t\\tconst filtered = this.services.filter((config) => !('showButton' in config) || config.showButton !== false) || [];\\n\\t\\tconst sorted = filtered.sort(({ service: service1 }, { service: service2 }) => service1.localeCompare(service2));\\n\\t\\tthis.serviceButtons = sorted.map((service) => {\\n\\t\\t\\t// Remove the appId attribute if present\\n\\t\\t\\tconst { appId: _, ...serviceData } = {\\n\\t\\t\\t\\t...service,\\n\\t\\t\\t\\tappId: undefined,\\n\\t\\t\\t};\\n\\n\\t\\t\\t// Get the hardcoded title and icon, or fallback to capitalizing the service name\\n\\t\\t\\tconst serviceConfig = this.config[service.service] || {\\n\\t\\t\\t\\ttitle: capitalize(service.service),\\n\\t\\t\\t};\\n\\n\\t\\t\\treturn {\\n\\t\\t\\t\\t...serviceData,\\n\\t\\t\\t\\t...serviceConfig,\\n\\t\\t\\t};\\n\\t\\t});\\n\\n\\t\\tthis.emit('changed');\\n\\t}\\n\\n\\tpublic getLoginService<T extends Partial<LoginServiceConfiguration> = LoginServiceConfiguration>(serviceName: string): T | undefined {\\n\\t\\tif (!this.ready) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\treturn this.services.find(({ service }) => service === serviceName) as T | undefined;\\n\\t}\\n\\n\\tpublic async loadLoginService<T extends Partial<LoginServiceConfiguration> = LoginServiceConfiguration>(\\n\\t\\tserviceName: string,\\n\\t): Promise<T | undefined> {\\n\\t\\tif (this.ready) {\\n\\t\\t\\treturn this.getLoginService<T>(serviceName);\\n\\t\\t}\\n\\n\\t\\treturn new Promise((resolve, reject) => {\\n\\t\\t\\tthis.onLoad(() => resolve(this.getLoginService<T>(serviceName)));\\n\\n\\t\\t\\tsetTimeout(() => reject(new Error('LoadLoginService timeout')), timeout);\\n\\t\\t});\\n\\t}\\n\\n\\tpublic get ready() {\\n\\t\\treturn this.state === 'loaded';\\n\\t}\\n\\n\\tpublic getLoginServiceButtons(): LoginService[] {\\n\\t\\tif (!this.ready) {\\n\\t\\t\\tif (this.state === 'none') {\\n\\t\\t\\t\\tvoid this.loadServices();\\n\\t\\t\\t}\\n\\t\\t}\\n\\n\\t\\treturn this.serviceButtons;\\n\\t}\\n\\n\\tpublic onLoad(callback: (services: LoginServiceConfiguration[]) => void) {\\n\\t\\tif (this.ready) {\\n\\t\\t\\treturn callback(this.services);\\n\\t\\t}\\n\\n\\t\\tvoid this.loadServices();\\n\\t\\tthis.once('loaded', callback);\\n\\t}\\n\\n\\tpublic async loadServices(): Promise<void> {\\n\\t\\tif (this.state === 'error') {\\n\\t\\t\\tif (this.retries >= maxRetries) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\tthis.retries++;\\n\\t\\t} else if (this.state !== 'none') {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\ttry {\\n\\t\\t\\tthis.state = 'loading';\\n\\t\\t\\tconst { configurations } = await sdk.rest.get('/v1/service.configurations');\\n\\n\\t\\t\\tthis.setServices('loaded', configurations);\\n\\t\\t} catch (e) {\\n\\t\\t\\tthis.setServices('error', []);\\n\\t\\t\\tthrow e;\\n\\t\\t}\\n\\t}\\n}\\n\\nexport const loginServices = new LoginServices();\\n\",null],\"names\":[\"_regeneratorRuntime\",\"_objectSpread\",\"_objectWithoutProperties\",\"_createClass\",\"_inheritsLoose\",\"Emitter\",\"capitalize\",\"sdk\",\"module\",\"link\",\"default\",\"v\",\"export\",\"loginServices\",\"_Emitter\",\"LoginServices\",\"_this\",\"_len\",\"arguments\",\"length\",\"args\",\"Array\",\"_key\",\"call\",\"apply\",\"concat\",\"retries\",\"services\",\"serviceButtons\",\"state\",\"config\",\"title\",\"icon\",\"_proto\",\"prototype\",\"setServices\",\"generateServiceButtons\",\"emit\",\"_this2\",\"sorted\",\"filtered\",\"filter\",\"showButton\",\"sort\",\"_ref\",\"_ref2\",\"service1\",\"service\",\"service2\",\"localeCompare\",\"map\",\"_service$appId\",\"appId\",\"undefined\",\"serviceData\",\"_excluded\",\"serviceConfig\",\"getLoginService\",\"serviceName\",\"ready\",\"find\",\"_ref3\",\"loadLoginService\",\"_this3\",\"async\",\"_context\",\"prev\",\"next\",\"abrupt\",\"Promise\",\"resolve\",\"reject\",\"onLoad\",\"setTimeout\",\"Error\",\"stop\",\"getLoginServiceButtons\",\"loadServices\",\"callback\",\"once\",\"configurations\",\"_context2\",\"maxRetries\",\"awrap\",\"rest\",\"get\",\"_await$sdk$rest$get\",\"sent\",\"t0\",\"key\"],\"mappings\":\"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\"}"}