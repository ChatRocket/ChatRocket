{"code":"function module(e,t,s){let o,i,l,r,a,n,d,c;s.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){o=e}},0),s.export({useHistoryList:()=>u}),s.link(\"@rocket.chat/ui-contexts\",{useEndpoint(e){i=e}},0),s.link(\"react\",{useCallback(e){l=e},useState(e){r=e}},1),s.link(\"../../../hooks/lists/useScrollableRecordList\",{useScrollableRecordList(e){a=e}},2),s.link(\"../../../hooks/useComponentDidUpdate\",{useComponentDidUpdate(e){n=e}},3),s.link(\"../../../lib/lists/RecordList\",{RecordList(e){d=e}},4),s.link(\"../../../lib/utils/mapMessageFromApi\",{mapMessageFromApi(e){c=e}},5);let u=e=>{let[t,s]=r(()=>new d),u=l(()=>s(new d),[]),m=i(\"GET\",\"/v1/livechat/visitors.searchChats/room/:roomId/visitor/:visitorId\",{roomId:e.roomId,visitorId:e.visitorId});n(()=>{e&&u()},[e,u]);let v=l(async(t,s)=>{let{history:i,total:l}=await m(o(o({},e.filter&&{searchText:e.filter}),{},{closedChatsOnly:\"true\",servedChatsOnly:\"false\",offset:t,count:s+t}));return{items:i.map(e=>o(o({},e),{},{ts:new Date(e.ts),_updatedAt:new Date(e.ts),closedAt:e.closedAt?new Date(e.closedAt):void 0,servedBy:e.servedBy?o(o({},e.servedBy),{},{ts:new Date(e.servedBy.ts)}):void 0,closingMessage:e.closingMessage?c(e.closingMessage):void 0})),itemCount:l}},[m,e]),{loadMoreItems:p,initialItemCount:k}=a(t,v,25);return{itemsList:t,loadMoreItems:p,initialItemCount:k}}}","map":"{\"version\":3,\"sources\":[\"client/views/omnichannel/contactHistory/useHistoryList.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { VisitorSearchChatsResult } from '@rocket.chat/rest-typings';\\nimport { useEndpoint } from '@rocket.chat/ui-contexts';\\nimport { useCallback, useState } from 'react';\\n\\nimport { useScrollableRecordList } from '../../../hooks/lists/useScrollableRecordList';\\nimport { useComponentDidUpdate } from '../../../hooks/useComponentDidUpdate';\\nimport { RecordList } from '../../../lib/lists/RecordList';\\nimport { mapMessageFromApi } from '../../../lib/utils/mapMessageFromApi';\\n\\ntype HistoryListOptions = {\\n\\tfilter: string;\\n\\troomId: string;\\n\\tvisitorId: string;\\n};\\n\\nexport const useHistoryList = (\\n\\toptions: HistoryListOptions,\\n): {\\n\\titemsList: RecordList<VisitorSearchChatsResult & { _updatedAt: Date }>;\\n\\tinitialItemCount: number;\\n\\tloadMoreItems: (start: number, end: number) => void;\\n} => {\\n\\tconst [itemsList, setItemsList] = useState(() => new RecordList<VisitorSearchChatsResult & { _updatedAt: Date }>());\\n\\tconst reload = useCallback(() => setItemsList(new RecordList<VisitorSearchChatsResult & { _updatedAt: Date }>()), []);\\n\\n\\tconst getHistory = useEndpoint('GET', '/v1/livechat/visitors.searchChats/room/:roomId/visitor/:visitorId', {\\n\\t\\troomId: options.roomId,\\n\\t\\tvisitorId: options.visitorId,\\n\\t});\\n\\n\\tuseComponentDidUpdate(() => {\\n\\t\\toptions && reload();\\n\\t}, [options, reload]);\\n\\n\\tconst fetchData = useCallback(\\n\\t\\tasync (start, end) => {\\n\\t\\t\\tconst { history, total } = await getHistory({\\n\\t\\t\\t\\t...(options.filter && { searchText: options.filter }),\\n\\t\\t\\t\\tclosedChatsOnly: 'true',\\n\\t\\t\\t\\tservedChatsOnly: 'false',\\n\\t\\t\\t\\toffset: start,\\n\\t\\t\\t\\tcount: end + start,\\n\\t\\t\\t});\\n\\t\\t\\treturn {\\n\\t\\t\\t\\titems: history.map((history) => ({\\n\\t\\t\\t\\t\\t...history,\\n\\t\\t\\t\\t\\tts: new Date(history.ts),\\n\\t\\t\\t\\t\\t_updatedAt: new Date(history.ts),\\n\\t\\t\\t\\t\\tclosedAt: history.closedAt ? new Date(history.closedAt) : undefined,\\n\\t\\t\\t\\t\\tservedBy: history.servedBy ? { ...history.servedBy, ts: new Date(history.servedBy.ts) } : undefined,\\n\\t\\t\\t\\t\\tclosingMessage: history.closingMessage ? mapMessageFromApi(history.closingMessage) : undefined,\\n\\t\\t\\t\\t})),\\n\\t\\t\\t\\titemCount: total,\\n\\t\\t\\t};\\n\\t\\t},\\n\\t\\t[getHistory, options],\\n\\t);\\n\\n\\tconst { loadMoreItems, initialItemCount } = useScrollableRecordList(itemsList, fetchData, 25);\\n\\n\\treturn {\\n\\t\\titemsList,\\n\\t\\tloadMoreItems,\\n\\t\\tinitialItemCount,\\n\\t};\\n};\\n\",null],\"names\":[\"_objectSpread\",\"useEndpoint\",\"useCallback\",\"useState\",\"useScrollableRecordList\",\"useComponentDidUpdate\",\"RecordList\",\"mapMessageFromApi\",\"module\",\"link\",\"default\",\"v\",\"export\",\"useHistoryList\",\"options\",\"itemsList\",\"setItemsList\",\"reload\",\"getHistory\",\"roomId\",\"visitorId\",\"fetchData\",\"start\",\"end\",\"history\",\"total\",\"filter\",\"searchText\",\"closedChatsOnly\",\"servedChatsOnly\",\"offset\",\"count\",\"items\",\"map\",\"ts\",\"Date\",\"_updatedAt\",\"closedAt\",\"undefined\",\"servedBy\",\"closingMessage\",\"itemCount\",\"loadMoreItems\",\"initialItemCount\"],\"mappings\":\"2BACAA,EAAuDC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA9CC,EAAaC,IAAM,CAAA,uCAA2B,CAAAC,QAAAC,CAAA,EAAAX,EAAAW,CAAA,CAAA,EAAA,GAAvDH,EAAOI,MAAE,CAAA,CAAAC,eAAmBA,IAAAA,CAAA,GAA2BL,EAAAC,IAAA,CAAA,2BAAA,CAAAR,YAAAU,CAAA,EAAAV,EAAAU,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,QAAA,CAAAP,YAAAS,CAAA,EAAAT,EAAAS,CAAA,EAAAR,SAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,+CAAA,CAAAL,wBAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAJ,sBAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,gCAAA,CAAAH,WAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAF,kBAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAchD,IAAME,EACZC,IAMA,GAAM,CAACC,EAAWC,EAAa,CAAGb,EAAS,IAAM,IAAIG,GAC/CW,EAASf,EAAY,IAAMc,EAAa,IAAIV,GAAgE,EAAE,EAE9GY,EAAajB,EAAY,MAAO,oEAAqE,CAC1GkB,OAAQL,EAAQK,MAAM,CACtBC,UAAWN,EAAQM,SAAAA,GAGpBf,EAAsB,KACrBS,GAAWG,GACZ,EAAG,CAACH,EAASG,EAAO,EAEpB,IAAMI,EAAYnB,EACjB,MAAOoB,EAAOC,KACb,GAAM,CAAEC,QAAAA,CAAO,CAAEC,MAAAA,CAAAA,CAAO,CAAG,MAAMP,EAAUlB,EAAAA,EAAA,CAAA,EACtCc,EAAQY,MAAM,EAAI,CAAEC,WAAYb,EAAQY,MAAAA,AAAM,GAAE,CAAA,EAAA,CACpDE,gBAAiB,OACjBC,gBAAiB,QACjBC,OAAQR,EACRS,MAAOR,EAAMD,CAAK,IAEnB,MAAO,CACNU,MAAOR,EAAQS,GAAG,CAAET,GAAOxB,EAAAA,EAAA,CAAA,EACvBwB,GAAO,CAAA,EAAA,CACVU,GAAI,IAAIC,KAAKX,EAAQU,EAAE,EACvBE,WAAY,IAAID,KAAKX,EAAQU,EAAE,EAC/BG,SAAUb,EAAQa,QAAQ,CAAG,IAAIF,KAAKX,EAAQa,QAAQ,EAAIC,KAAAA,EAC1DC,SAAUf,EAAQe,QAAQ,CAAAvC,EAAAA,EAAA,CAAA,EAAQwB,EAAQe,QAAQ,EAAA,CAAA,EAAA,CAAEL,GAAI,IAAIC,KAAKX,EAAQe,QAAQ,CAACL,EAAE,CAAC,GAAKI,KAAAA,EAC1FE,eAAgBhB,EAAQgB,cAAc,CAAGjC,EAAkBiB,EAAQgB,cAAc,EAAIF,KAAAA,CAAS,IAE/FG,UAAWhB,EAEb,EACA,CAACP,EAAYJ,EAAQ,EAGhB,CAAE4B,cAAAA,CAAa,CAAEC,iBAAAA,CAAAA,CAAkB,CAAGvC,EAAwBW,EAAWM,EAAW,IAE1F,MAAO,CACNN,UAAAA,EACA2B,cAAAA,EACAC,iBAAAA,EAEF\"}"}