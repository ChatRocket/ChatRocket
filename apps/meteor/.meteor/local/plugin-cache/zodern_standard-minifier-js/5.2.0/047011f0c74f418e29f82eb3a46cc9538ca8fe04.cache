{"code":"function module(e,n,t){t.link(\"@babel/runtime/regenerator\",{default:function(e){i=e}},0),t.link(\"@babel/runtime/helpers/typeof\",{default:function(e){r=e}},1),t.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){o=e}},2),t.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){a=e}},3),t.link(\"@rocket.chat/string-helpers\",{escapeRegExp:function(e){l=e}},0),t.link(\"meteor/meteor\",{Meteor:function(e){c=e}},1),t.link(\"../../app/settings/client\",{settings:function(e){u=e}},2),t.link(\"../../app/ui-utils/client/lib/AccountBox\",{AccountBox:function(e){s=e}},3),t.link(\"../../app/utils/client/lib/SDKClient\",{sdk:function(e){f=e}},4),t.link(\"../../lib/callbacks/afterLogoutCleanUpCallback\",{afterLogoutCleanUpCallback:function(e){g=e}},5),t.link(\"../../lib/utils/stringUtils\",{capitalize:function(e){d=e},ltrim:function(e){m=e},rtrim:function(e){p=e}},6),t.link(\"../lib/baseURI\",{baseURI:function(e){v=e}},7),t.link(\"../lib/loginServices\",{loginServices:function(e){k=e}},8),t.link(\"../providers/RouterProvider\",{router:function(e){h=e}},9);var i,r,o,a,l,c,u,s,f,g,d,m,p,v,k,h,b={go:function(e){if(\"string\"!=typeof e.path||0===e.path.trim().length)return console.error(\"`path` not defined\");var n=new URL(p(v,\"/\")+\"/\"+m(e.path,\"/\")),t=Array.from(n.searchParams.entries()).reduce(function(e,n){var t=a(n,2),i=t[0],r=t[1];return e[i]=r,e},{}),i=n.pathname.replace(RegExp(\"^\"+l(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX)),\"\");h.navigate({pathname:i,search:o(o({},h.getSearchParameters()),t)})},\"set-user-status\":function(e){s.setStatus(e.status)},\"call-custom-oauth-login\":function(e,n){var t=c.settings.Site_Url+\"/\";if(\"string\"==typeof e.redirectUrl&&e.redirectUrl.startsWith(t)||(e.redirectUrl=null),\"string\"==typeof e.service&&window.ServiceConfiguration){var i=k.getLoginService(e.service);if(i){var r=c[\"loginWith\"+d(i.service,!0)],o=e.redirectUrl||t;r.call(c,{redirectUrl:o},function(e){var t;null===(t=n.source)||void 0===t||t.postMessage({event:\"custom-oauth-callback\",response:e},{targetOrigin:n.origin})})}}},\"login-with-token\":function(e){\"string\"==typeof e.token&&c.loginWithToken(e.token,function(){console.log(\"Iframe command [login-with-token]: result\",e)})},logout:function(){var e;return i.async(function(n){for(;;)switch(n.prev=n.next){case 0:e=c.user(),c.logout(function(){if(e)return g.run(e),f.call(\"logoutCleanUp\",e),h.navigate(\"/home\")});case 2:case\"end\":return n.stop()}},null,null,null,Promise)}};window.addEventListener(\"message\",function(e){if(u.get(\"Iframe_Integration_receive_enable\")&&\"object\"===r(e.data)&&\"string\"==typeof e.data.externalCommand){var n=u.get(\"Iframe_Integration_receive_origin\");if(\"*\"!==n&&-1===n.split(\",\").indexOf(e.origin)){console.error(\"Origin not allowed\",e.origin);return}if(!(e.data.externalCommand in b)){console.error(\"Command not allowed\",e.data.externalCommand);return}(0,b[e.data.externalCommand])(e.data,e)}})}","map":"{\"version\":3,\"sources\":[\"client/startup/iframeCommands.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { UserStatus, IUser } from '@rocket.chat/core-typings';\\nimport { escapeRegExp } from '@rocket.chat/string-helpers';\\nimport type { LocationPathname } from '@rocket.chat/ui-contexts';\\nimport { Meteor } from 'meteor/meteor';\\n\\nimport { settings } from '../../app/settings/client';\\nimport { AccountBox } from '../../app/ui-utils/client/lib/AccountBox';\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\nimport { afterLogoutCleanUpCallback } from '../../lib/callbacks/afterLogoutCleanUpCallback';\\nimport { capitalize, ltrim, rtrim } from '../../lib/utils/stringUtils';\\nimport { baseURI } from '../lib/baseURI';\\nimport { loginServices } from '../lib/loginServices';\\nimport { router } from '../providers/RouterProvider';\\n\\nconst commands = {\\n\\t'go'(data: { path: string }) {\\n\\t\\tif (typeof data.path !== 'string' || data.path.trim().length === 0) {\\n\\t\\t\\treturn console.error('`path` not defined');\\n\\t\\t}\\n\\t\\tconst newUrl = new URL(`${rtrim(baseURI, '/')}/${ltrim(data.path, '/')}`);\\n\\n\\t\\tconst newParams = Array.from(newUrl.searchParams.entries()).reduce((ret, [key, value]) => {\\n\\t\\t\\tret[key] = value;\\n\\t\\t\\treturn ret;\\n\\t\\t}, {} as Record<string, string>);\\n\\n\\t\\tconst newPath = newUrl.pathname.replace(\\n\\t\\t\\tnew RegExp(`^${escapeRegExp(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX)}`),\\n\\t\\t\\t'',\\n\\t\\t) as LocationPathname;\\n\\t\\trouter.navigate({\\n\\t\\t\\tpathname: newPath,\\n\\t\\t\\tsearch: { ...router.getSearchParameters(), ...newParams },\\n\\t\\t});\\n\\t},\\n\\n\\t'set-user-status'(data: { status: UserStatus }) {\\n\\t\\tAccountBox.setStatus(data.status);\\n\\t},\\n\\n\\t'call-custom-oauth-login'(data: { service: string; redirectUrl?: string | null }, event: MessageEvent) {\\n\\t\\tconst customOAuthCallback = (response: unknown) => {\\n\\t\\t\\tevent.source?.postMessage(\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\tevent: 'custom-oauth-callback',\\n\\t\\t\\t\\t\\tresponse,\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\t{ targetOrigin: event.origin },\\n\\t\\t\\t);\\n\\t\\t};\\n\\n\\t\\tconst siteUrl = `${Meteor.settings.Site_Url}/`;\\n\\t\\tif (typeof data.redirectUrl !== 'string' || !data.redirectUrl.startsWith(siteUrl)) {\\n\\t\\t\\tdata.redirectUrl = null;\\n\\t\\t}\\n\\n\\t\\tif (typeof data.service === 'string' && window.ServiceConfiguration) {\\n\\t\\t\\tconst customOauth = loginServices.getLoginService(data.service);\\n\\n\\t\\t\\tif (customOauth) {\\n\\t\\t\\t\\tconst customLoginWith = (Meteor as any)[`loginWith${capitalize(customOauth.service, true)}`];\\n\\t\\t\\t\\tconst customRedirectUri = data.redirectUrl || siteUrl;\\n\\t\\t\\t\\tcustomLoginWith.call(Meteor, { redirectUrl: customRedirectUri }, customOAuthCallback);\\n\\t\\t\\t}\\n\\t\\t}\\n\\t},\\n\\n\\t'login-with-token'(data: { token: string }) {\\n\\t\\tif (typeof data.token === 'string') {\\n\\t\\t\\tMeteor.loginWithToken(data.token, () => {\\n\\t\\t\\t\\tconsole.log('Iframe command [login-with-token]: result', data);\\n\\t\\t\\t});\\n\\t\\t}\\n\\t},\\n\\n\\tasync 'logout'() {\\n\\t\\tconst user = Meteor.user();\\n\\t\\tMeteor.logout(() => {\\n\\t\\t\\tif (!user) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\tvoid afterLogoutCleanUpCallback.run(user);\\n\\t\\t\\tsdk.call('logoutCleanUp', user as unknown as IUser);\\n\\t\\t\\treturn router.navigate('/home');\\n\\t\\t});\\n\\t},\\n} as const;\\n\\ntype CommandMessage<TCommandName extends keyof typeof commands = keyof typeof commands> = {\\n\\texternalCommand: TCommandName;\\n} & Parameters<(typeof commands)[TCommandName]>[0];\\n\\nwindow.addEventListener('message', <TCommandMessage extends CommandMessage>(e: MessageEvent<TCommandMessage>) => {\\n\\tif (!settings.get<boolean>('Iframe_Integration_receive_enable')) {\\n\\t\\treturn;\\n\\t}\\n\\n\\tif (typeof e.data !== 'object' || typeof e.data.externalCommand !== 'string') {\\n\\t\\treturn;\\n\\t}\\n\\n\\tconst origins = settings.get<string>('Iframe_Integration_receive_origin');\\n\\n\\tif (origins !== '*' && origins.split(',').indexOf(e.origin) === -1) {\\n\\t\\tconsole.error('Origin not allowed', e.origin);\\n\\t\\treturn;\\n\\t}\\n\\n\\tif (!(e.data.externalCommand in commands)) {\\n\\t\\tconsole.error('Command not allowed', e.data.externalCommand);\\n\\t\\treturn;\\n\\t}\\n\\n\\tconst command: (data: any, event: MessageEvent) => void = commands[e.data.externalCommand];\\n\\tcommand(e.data, e);\\n});\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"_typeof\",\"_objectSpread\",\"_slicedToArray\",\"escapeRegExp\",\"Meteor\",\"settings\",\"AccountBox\",\"sdk\",\"afterLogoutCleanUpCallback\",\"capitalize\",\"ltrim\",\"rtrim\",\"baseURI\",\"loginServices\",\"router\",\"commands\",\"data\",\"path\",\"trim\",\"length\",\"console\",\"error\",\"newUrl\",\"URL\",\"newParams\",\"Array\",\"from\",\"searchParams\",\"entries\",\"reduce\",\"ret\",\"_ref\",\"_ref2\",\"key\",\"value\",\"newPath\",\"pathname\",\"replace\",\"RegExp\",\"__meteor_runtime_config__\",\"ROOT_URL_PATH_PREFIX\",\"navigate\",\"search\",\"getSearchParameters\",\"setStatus\",\"status\",\"event\",\"siteUrl\",\"Site_Url\",\"redirectUrl\",\"startsWith\",\"service\",\"window\",\"ServiceConfiguration\",\"customOauth\",\"getLoginService\",\"customLoginWith\",\"customRedirectUri\",\"call\",\"response\",\"_event$source\",\"source\",\"postMessage\",\"targetOrigin\",\"origin\",\"token\",\"loginWithToken\",\"log\",\"user\",\"async\",\"_context\",\"prev\",\"next\",\"logout\",\"run\",\"stop\",\"Promise\",\"addEventListener\",\"e\",\"get\",\"externalCommand\",\"origins\",\"split\",\"indexOf\",\"command\"],\"mappings\":\"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\"}"}