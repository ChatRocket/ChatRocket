{"code":"function module(e,t,r){let l,n,a,i,s,c,o,u,d,m,k,E,h,f,x,g,v,b,p,_,F;let S=[\"control\",\"trigger\",\"index\",\"disabled\"];r.link(\"@babel/runtime/helpers/extends\",{default(e){l=e}},0),r.link(\"@babel/runtime/helpers/objectWithoutProperties\",{default(e){n=e}},1),r.export({ActionExternalServiceUrl:()=>T}),r.link(\"@rocket.chat/fuselage\",{Box(e){a=e},Button(e){i=e},Field(e){s=e},FieldError(e){c=e},FieldHint(e){o=e},FieldLabel(e){u=e},FieldRow(e){d=e},Icon(e){m=e},TextInput(e){k=e}},0),r.link(\"@rocket.chat/fuselage-hooks\",{useSafely(e){E=e},useUniqueId(e){h=e}},1),r.link(\"@rocket.chat/ui-contexts\",{useEndpoint(e){f=e}},2),r.link(\"@tanstack/react-query\",{useMutation(e){x=e}},3),r.link(\"react\",{default(e){g=e},useState(e){v=e}},4),r.link(\"react-hook-form\",{Controller(e){b=e},useWatch(e){p=e}},5),r.link(\"react-i18next\",{useTranslation(e){_=e}},6),r.link(\"../hooks\",{useFieldError(e){F=e}},7);let T=e=>{let{control:t,trigger:r,index:T,disabled:q}=e,y=n(e,S),{t:U}=_(),w=h(),A=\"actions.\".concat(T,\".params.serviceUrl\"),I=\"actions.\".concat(T,\".params.serviceTimeout\"),L=p({control:t,name:I}),[B]=F({control:t,name:A}),[C,M]=E(v(!1)),P=f(\"POST\",\"/v1/livechat/triggers/external-service/test\"),R=x({mutationFn:P,onSuccess:()=>{M(!0),setTimeout(()=>M(!1),3e3)}}),W=async e=>{if(!e)return!0;try{return await R.mutateAsync({webhookUrl:e,timeout:L||1e4,fallbackMessage:\"\",extraData:[]}),!0}catch(e){return U(e.error)}};return g.createElement(s,y,g.createElement(u,{required:!0,htmlFor:w},U(\"External_service_url\")),g.createElement(d,null,g.createElement(b,{name:A,control:t,defaultValue:\"\",rules:{required:U(\"Required_field\",{field:U(\"External_service_url\")}),validate:W,deps:I},render:e=>{let{field:t}=e;return g.createElement(k,l({},t,{disabled:R.isLoading||q,error:null==B?void 0:B.message}))}})),B&&g.createElement(c,null,B.message),g.createElement(o,null,U(\"External_service_test_hint\")),g.createElement(i,{loading:R.isLoading,disabled:q||C,onClick:()=>r(A)},C?g.createElement(a,{is:\"span\",color:\"status-font-on-success\"},g.createElement(m,{name:\"success-circle\",size:\"x20\",verticalAlign:\"middle\"}),\" \",U(\"Success\"),\"!\"):U(\"Send_Test\")))}}","map":"{\"version\":3,\"sources\":[\"client/views/omnichannel/triggers/actions/ActionExternalServiceUrl.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { Box, Button, Field, FieldError, FieldHint, FieldLabel, FieldRow, Icon, TextInput } from '@rocket.chat/fuselage';\\nimport { useSafely, useUniqueId } from '@rocket.chat/fuselage-hooks';\\nimport type { TranslationKey } from '@rocket.chat/ui-contexts';\\nimport { useEndpoint } from '@rocket.chat/ui-contexts';\\nimport { useMutation } from '@tanstack/react-query';\\nimport type { ComponentProps } from 'react';\\nimport React, { useState } from 'react';\\nimport type { Control, UseFormTrigger } from 'react-hook-form';\\nimport { Controller, useWatch } from 'react-hook-form';\\nimport { useTranslation } from 'react-i18next';\\n\\nimport type { TriggersPayload } from '../EditTrigger';\\nimport { useFieldError } from '../hooks';\\n\\ntype ActionExternaServicelUrlType = ComponentProps<typeof Field> & {\\n\\tindex: number;\\n\\tcontrol: Control<TriggersPayload>;\\n\\ttrigger: UseFormTrigger<TriggersPayload>;\\n\\tdisabled?: boolean;\\n};\\n\\nexport const ActionExternalServiceUrl = ({ control, trigger, index, disabled, ...props }: ActionExternaServicelUrlType) => {\\n\\tconst { t } = useTranslation();\\n\\n\\tconst serviceUrlFieldId = useUniqueId();\\n\\tconst serviceUrlFieldName = `actions.${index}.params.serviceUrl` as const;\\n\\tconst serviceTimeoutFieldName = `actions.${index}.params.serviceTimeout` as const;\\n\\n\\tconst serviceTimeoutValue = useWatch({ control, name: serviceTimeoutFieldName });\\n\\tconst [serviceUrlError] = useFieldError({ control, name: serviceUrlFieldName });\\n\\tconst [isSuccessMessageVisible, setSuccessMessageVisible] = useSafely(useState(false));\\n\\tconst webhookTestEndpoint = useEndpoint('POST', '/v1/livechat/triggers/external-service/test');\\n\\n\\tconst showSuccessMesssage = () => {\\n\\t\\tsetSuccessMessageVisible(true);\\n\\t\\tsetTimeout(() => setSuccessMessageVisible(false), 3000);\\n\\t};\\n\\n\\tconst webhookTest = useMutation({\\n\\t\\tmutationFn: webhookTestEndpoint,\\n\\t\\tonSuccess: showSuccessMesssage,\\n\\t});\\n\\n\\tconst testExternalService = async (serviceUrl: string) => {\\n\\t\\tif (!serviceUrl) {\\n\\t\\t\\treturn true;\\n\\t\\t}\\n\\n\\t\\ttry {\\n\\t\\t\\tawait webhookTest.mutateAsync({\\n\\t\\t\\t\\twebhookUrl: serviceUrl,\\n\\t\\t\\t\\ttimeout: serviceTimeoutValue || 10000,\\n\\t\\t\\t\\tfallbackMessage: '',\\n\\t\\t\\t\\textraData: [],\\n\\t\\t\\t});\\n\\t\\t\\treturn true;\\n\\t\\t} catch (e) {\\n\\t\\t\\treturn t((e as { error: TranslationKey }).error);\\n\\t\\t}\\n\\t};\\n\\n\\treturn (\\n\\t\\t<Field {...props}>\\n\\t\\t\\t<FieldLabel required htmlFor={serviceUrlFieldId}>\\n\\t\\t\\t\\t{t('External_service_url')}\\n\\t\\t\\t</FieldLabel>\\n\\t\\t\\t<FieldRow>\\n\\t\\t\\t\\t<Controller\\n\\t\\t\\t\\t\\tname={serviceUrlFieldName}\\n\\t\\t\\t\\t\\tcontrol={control}\\n\\t\\t\\t\\t\\tdefaultValue=''\\n\\t\\t\\t\\t\\trules={{\\n\\t\\t\\t\\t\\t\\trequired: t('Required_field', { field: t('External_service_url') }),\\n\\t\\t\\t\\t\\t\\tvalidate: testExternalService,\\n\\t\\t\\t\\t\\t\\tdeps: serviceTimeoutFieldName,\\n\\t\\t\\t\\t\\t}}\\n\\t\\t\\t\\t\\trender={({ field }) => {\\n\\t\\t\\t\\t\\t\\treturn <TextInput {...field} disabled={webhookTest.isLoading || disabled} error={serviceUrlError?.message} />;\\n\\t\\t\\t\\t\\t}}\\n\\t\\t\\t\\t/>\\n\\t\\t\\t</FieldRow>\\n\\n\\t\\t\\t{serviceUrlError && <FieldError>{serviceUrlError.message}</FieldError>}\\n\\n\\t\\t\\t<FieldHint>{t('External_service_test_hint')}</FieldHint>\\n\\n\\t\\t\\t<Button loading={webhookTest.isLoading} disabled={disabled || isSuccessMessageVisible} onClick={() => trigger(serviceUrlFieldName)}>\\n\\t\\t\\t\\t{isSuccessMessageVisible ? (\\n\\t\\t\\t\\t\\t<Box is='span' color='status-font-on-success'>\\n\\t\\t\\t\\t\\t\\t<Icon name='success-circle' size='x20' verticalAlign='middle' /> {t('Success')}!\\n\\t\\t\\t\\t\\t</Box>\\n\\t\\t\\t\\t) : (\\n\\t\\t\\t\\t\\tt('Send_Test')\\n\\t\\t\\t\\t)}\\n\\t\\t\\t</Button>\\n\\t\\t</Field>\\n\\t);\\n};\\n\",null],\"names\":[\"_extends\",\"_objectWithoutProperties\",\"Box\",\"Button\",\"Field\",\"FieldError\",\"FieldHint\",\"FieldLabel\",\"FieldRow\",\"Icon\",\"TextInput\",\"useSafely\",\"useUniqueId\",\"useEndpoint\",\"useMutation\",\"React\",\"useState\",\"Controller\",\"useWatch\",\"useTranslation\",\"useFieldError\",\"module\",\"link\",\"default\",\"v\",\"export\",\"ActionExternalServiceUrl\",\"_ref\",\"control\",\"trigger\",\"index\",\"disabled\",\"props\",\"_excluded\",\"t\",\"serviceUrlFieldId\",\"serviceUrlFieldName\",\"concat\",\"serviceTimeoutFieldName\",\"serviceTimeoutValue\",\"name\",\"serviceUrlError\",\"isSuccessMessageVisible\",\"setSuccessMessageVisible\",\"webhookTestEndpoint\",\"webhookTest\",\"mutationFn\",\"onSuccess\",\"showSuccessMesssage\",\"setTimeout\",\"testExternalService\",\"serviceUrl\",\"mutateAsync\",\"webhookUrl\",\"timeout\",\"fallbackMessage\",\"extraData\",\"e\",\"error\",\"createElement\",\"required\",\"htmlFor\",\"defaultValue\",\"rules\",\"field\",\"validate\",\"deps\",\"render\",\"_ref2\",\"isLoading\",\"message\",\"loading\",\"onClick\",\"is\",\"color\",\"size\",\"verticalAlign\"],\"mappings\":\"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\"}"}