{"code":"function module(e,n,t){t.export({useLegacyThreadMessageListScrolling:function(){return a}}),t.link(\"@rocket.chat/core-typings\",{isEditedMessage:function(e){r=e}},0),t.link(\"@rocket.chat/ui-contexts\",{useUser:function(e){i=e}},1),t.link(\"react\",{useCallback:function(e){c=e},useEffect:function(e){o=e},useRef:function(e){u=e}},2),t.link(\"../../../../../../lib/callbacks\",{callbacks:function(e){l=e}},3),t.link(\"../../../contexts/RoomContext\",{useRoom:function(e){s=e}},4);var r,i,c,o,u,l,s,a=function(e){var n=u(null),t=u(null),a=u(!0),f=c(function(e){var n=e.scrollHeight,t=e.scrollTop,r=e.clientHeight;a.current=t>=n-r},[]),d=c(function(){if(!0===a.current){var e=n.current;null==e||e.scrollTo(30,e.scrollHeight)}},[]),v=s(),g=i();return o(function(){return l.add(\"streamNewMessage\",function(n){v._id!==n.rid||r(n)||n.tmid!==e._id||n.u._id!==(null==g?void 0:g._id)||(a.current=!0,d())},l.priority.MEDIUM,\"thread-scroll-\"+v._id),function(){l.remove(\"streamNewMessage\",\"thread-scroll-\"+v._id)}},[v._id,d,null==g?void 0:g._id,e._id]),o(function(){var e=new ResizeObserver(function(){d()});return n.current&&e.observe(n.current),t.current&&e.observe(t.current),function(){e.disconnect()}},[d]),{listWrapperRef:n,listRef:t,requestScrollToBottom:d,onScroll:f}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/contextualBar/Threads/hooks/useLegacyThreadMessageListScrolling.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IMessage } from '@rocket.chat/core-typings';\\nimport { isEditedMessage } from '@rocket.chat/core-typings';\\nimport { useUser } from '@rocket.chat/ui-contexts';\\nimport type { ScrollValues } from 'rc-scrollbars';\\nimport { useCallback, useEffect, useRef } from 'react';\\n\\nimport { callbacks } from '../../../../../../lib/callbacks';\\nimport { useRoom } from '../../../contexts/RoomContext';\\n\\nexport const useLegacyThreadMessageListScrolling = (mainMessage: IMessage) => {\\n\\tconst listWrapperRef = useRef<HTMLDivElement>(null);\\n\\tconst listRef = useRef<HTMLElement>(null);\\n\\n\\tconst atBottomRef = useRef(true);\\n\\n\\tconst onScroll = useCallback(({ scrollHeight, scrollTop, clientHeight }: ScrollValues) => {\\n\\t\\tatBottomRef.current = scrollTop >= scrollHeight - clientHeight;\\n\\t}, []);\\n\\n\\tconst sendToBottomIfNecessary = useCallback(() => {\\n\\t\\tif (atBottomRef.current === true) {\\n\\t\\t\\tconst listWrapper = listWrapperRef.current;\\n\\n\\t\\t\\tlistWrapper?.scrollTo(30, listWrapper.scrollHeight);\\n\\t\\t}\\n\\t}, []);\\n\\n\\tconst room = useRoom();\\n\\tconst user = useUser();\\n\\n\\tuseEffect(() => {\\n\\t\\tcallbacks.add(\\n\\t\\t\\t'streamNewMessage',\\n\\t\\t\\t(msg: IMessage) => {\\n\\t\\t\\t\\tif (room._id !== msg.rid || isEditedMessage(msg) || msg.tmid !== mainMessage._id) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (msg.u._id === user?._id) {\\n\\t\\t\\t\\t\\tatBottomRef.current = true;\\n\\t\\t\\t\\t\\tsendToBottomIfNecessary();\\n\\t\\t\\t\\t}\\n\\t\\t\\t},\\n\\t\\t\\tcallbacks.priority.MEDIUM,\\n\\t\\t\\t`thread-scroll-${room._id}`,\\n\\t\\t);\\n\\n\\t\\treturn () => {\\n\\t\\t\\tcallbacks.remove('streamNewMessage', `thread-scroll-${room._id}`);\\n\\t\\t};\\n\\t}, [room._id, sendToBottomIfNecessary, user?._id, mainMessage._id]);\\n\\n\\tuseEffect(() => {\\n\\t\\tconst observer = new ResizeObserver(() => {\\n\\t\\t\\tsendToBottomIfNecessary();\\n\\t\\t});\\n\\n\\t\\tif (listWrapperRef.current) observer.observe(listWrapperRef.current);\\n\\t\\tif (listRef.current) observer.observe(listRef.current);\\n\\n\\t\\treturn () => {\\n\\t\\t\\tobserver.disconnect();\\n\\t\\t};\\n\\t}, [sendToBottomIfNecessary]);\\n\\n\\treturn { listWrapperRef, listRef, requestScrollToBottom: sendToBottomIfNecessary, onScroll };\\n};\\n\",null],\"names\":[\"module\",\"export\",\"useLegacyThreadMessageListScrolling\",\"link\",\"isEditedMessage\",\"v\",\"useUser\",\"useCallback\",\"useEffect\",\"useRef\",\"callbacks\",\"useRoom\",\"mainMessage\",\"listWrapperRef\",\"listRef\",\"atBottomRef\",\"onScroll\",\"_ref\",\"scrollHeight\",\"scrollTop\",\"clientHeight\",\"current\",\"sendToBottomIfNecessary\",\"listWrapper\",\"scrollTo\",\"room\",\"user\",\"add\",\"msg\",\"_id\",\"rid\",\"tmid\",\"u\",\"priority\",\"MEDIUM\",\"remove\",\"observer\",\"ResizeObserver\",\"observe\",\"disconnect\",\"requestScrollToBottom\"],\"mappings\":\"uBACAA,EAAOC,MAAE,CAAA,CAAAC,oCAAuB,WAA4B,OAAAA,CAAA,CAAA,GAAAF,EAAAG,IAAA,CAAA,4BAAA,CAAAC,gBAAA,SAAAC,CAAA,EAAAD,EAAAC,CAAA,CAAA,EAAA,GAAAL,EAAAG,IAAA,CAAA,2BAAA,CAAAG,QAAA,SAAAD,CAAA,EAAAC,EAAAD,CAAA,CAAA,EAAA,GAAAL,EAAAG,IAAA,CAAA,QAAA,CAAAI,YAAA,SAAAF,CAAA,EAAAE,EAAAF,CAAA,EAAAG,UAAA,SAAAH,CAAA,EAAAG,EAAAH,CAAA,EAAAI,OAAA,SAAAJ,CAAA,EAAAI,EAAAJ,CAAA,CAAA,EAAA,GAAAL,EAAAG,IAAA,CAAA,kCAAA,CAAAO,UAAA,SAAAL,CAAA,EAAAK,EAAAL,CAAA,CAAA,EAAA,GAAAL,EAAAG,IAAA,CAAA,gCAAA,CAAAQ,QAAA,SAAAN,CAAA,EAAAM,EAAAN,CAAA,CAAA,EAAA,GAQrD,IARqDD,EAAAE,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAQ/CT,EAAsC,SAACU,CAAqB,EACxE,IAAMC,EAAiBJ,EAAuB,MACxCK,EAAUL,EAAoB,MAE9BM,EAAcN,EAAO,CAAA,GAErBO,EAAWT,EAAY,SAAAU,CAAA,EAA4D,IAAzDC,EAAYD,EAAZC,YAAY,CAAEC,EAASF,EAATE,SAAS,CAAEC,EAAYH,EAAZG,YAAY,AACpEL,CAAAA,EAAYM,OAAO,CAAGF,GAAaD,EAAeE,CACnD,EAAG,EAAE,EAECE,EAA0Bf,EAAY,WAC3C,GAAIQ,AAAwB,CAAA,IAAxBA,EAAYM,OAAO,CAAW,CACjC,IAAME,EAAcV,EAAeQ,OAAO,AAE1CE,OAAAA,GAAAA,EAAaC,QAAQ,CAAC,GAAID,EAAYL,YAAY,CACnD,CACD,EAAG,EAAE,EAECO,EAAOd,IACPe,EAAOpB,IAqCb,OAnCAE,EAAU,WAiBT,OAhBAE,EAAUiB,GAAG,CACZ,mBACA,SAACC,CAAa,EACTH,EAAKI,GAAG,GAAKD,EAAIE,GAAG,EAAI1B,EAAgBwB,IAAQA,EAAIG,IAAI,GAAKnB,EAAYiB,GAAG,EAI5ED,EAAII,CAAC,CAACH,GAAG,GAAKH,CAAAA,MAAAA,EAAI,KAAA,EAAJA,EAAMG,GAAG,AAAHA,IACvBd,EAAYM,OAAO,CAAG,CAAA,EACtBC,IAEF,EACAZ,EAAUuB,QAAQ,CAACC,MAAM,CAAA,iBACRT,EAAKI,GAAK,EAGrB,WACNnB,EAAUyB,MAAM,CAAC,mBAAkB,iBAAmBV,EAAKI,GAAK,CACjE,CACD,EAAG,CAACJ,EAAKI,GAAG,CAAEP,EAAyBI,MAAAA,EAAI,KAAA,EAAJA,EAAMG,GAAG,CAAEjB,EAAYiB,GAAG,CAAC,EAElErB,EAAU,WACT,IAAM4B,EAAW,IAAIC,eAAe,WACnCf,GACD,GAKA,OAHIT,EAAeQ,OAAO,EAAEe,EAASE,OAAO,CAACzB,EAAeQ,OAAO,EAC/DP,EAAQO,OAAO,EAAEe,EAASE,OAAO,CAACxB,EAAQO,OAAO,EAE9C,WACNe,EAASG,UAAU,EACpB,CACD,EAAG,CAACjB,EAAwB,EAErB,CAAET,eAAAA,EAAgBC,QAAAA,EAAS0B,sBAAuBlB,EAAyBN,SAAAA,CAAQ,CAC3F\"}"}