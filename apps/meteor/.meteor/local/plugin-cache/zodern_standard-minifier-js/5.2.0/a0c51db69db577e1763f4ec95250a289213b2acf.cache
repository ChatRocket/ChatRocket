{"code":"function module(e,i,t){let l,o,s,n,a,r,d,c,m;t.link(\"meteor/meteor\",{Meteor(e){l=e}},0),t.link(\"meteor/tracker\",{Tracker(e){o=e}},1),t.link(\"../../../../client/lib/rooms/roomCoordinator\",{roomCoordinator(e){s=e}},2),t.link(\"../../../../client/lib/toast\",{dispatchToastMessage(e){n=e}},3),t.link(\"../../../../client/lib/utils/callWithErrorHandling\",{callWithErrorHandling(e){a=e}},4),t.link(\"../../../models/client\",{Messages(e){r=e}},5),t.link(\"../../../settings/client\",{settings(e){d=e}},6),t.link(\"../../../ui-utils/client\",{MessageAction(e){c=e}},7),t.link(\"../../../utils/lib/i18n\",{t(e){m=e}},8),l.startup(()=>{o.autorun(()=>{if(!d.get(\"Threads_enabled\"))return c.removeButton(\"follow-message\");c.addButton({id:\"follow-message\",icon:\"bell\",label:\"Follow_message\",type:\"interaction\",context:[\"message\",\"message-mobile\",\"threads\",\"federated\",\"videoconf\",\"videoconf-threads\"],async action(e,i){let{message:t}=i;t&&await a(\"followMessage\",{mid:t._id}).then(()=>n({type:\"success\",message:m(\"You_followed_this_message\")}))},condition(e){let{message:{_id:i,tmid:t,replies:l=[]},room:o,user:n,context:a}=e;if(t||a){let e=r.findOne({_id:t||i},{fields:{replies:1}});e&&(l=e.replies||[])}let d=s.isLivechatRoom(o.t);return!d&&null!=n&&!!n._id&&!l.includes(n._id)},order:1,group:\"menu\"})})})}","map":"{\"version\":3,\"sources\":[\"app/threads/client/messageAction/follow.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { roomCoordinator } from '../../../../client/lib/rooms/roomCoordinator';\\nimport { dispatchToastMessage } from '../../../../client/lib/toast';\\nimport { callWithErrorHandling } from '../../../../client/lib/utils/callWithErrorHandling';\\nimport { Messages } from '../../../models/client';\\nimport { settings } from '../../../settings/client';\\nimport { MessageAction } from '../../../ui-utils/client';\\nimport { t } from '../../../utils/lib/i18n';\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(() => {\\n\\t\\tif (!settings.get('Threads_enabled')) {\\n\\t\\t\\treturn MessageAction.removeButton('follow-message');\\n\\t\\t}\\n\\t\\tMessageAction.addButton({\\n\\t\\t\\tid: 'follow-message',\\n\\t\\t\\ticon: 'bell',\\n\\t\\t\\tlabel: 'Follow_message',\\n\\t\\t\\ttype: 'interaction',\\n\\t\\t\\tcontext: ['message', 'message-mobile', 'threads', 'federated', 'videoconf', 'videoconf-threads'],\\n\\t\\t\\tasync action(_, { message }) {\\n\\t\\t\\t\\tif (!message) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tawait callWithErrorHandling('followMessage', { mid: message._id }).then(() =>\\n\\t\\t\\t\\t\\tdispatchToastMessage({\\n\\t\\t\\t\\t\\t\\ttype: 'success',\\n\\t\\t\\t\\t\\t\\tmessage: t('You_followed_this_message'),\\n\\t\\t\\t\\t\\t}),\\n\\t\\t\\t\\t);\\n\\t\\t\\t},\\n\\t\\t\\tcondition({ message: { _id, tmid, replies = [] }, room, user, context }) {\\n\\t\\t\\t\\tif (tmid || context) {\\n\\t\\t\\t\\t\\tconst parentMessage = Messages.findOne({ _id: tmid || _id }, { fields: { replies: 1 } });\\n\\t\\t\\t\\t\\tif (parentMessage) {\\n\\t\\t\\t\\t\\t\\treplies = parentMessage.replies || [];\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room.t);\\n\\t\\t\\t\\tif (isLivechatRoom) {\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\treturn user?._id ? !replies.includes(user._id) : false;\\n\\t\\t\\t},\\n\\t\\t\\torder: 1,\\n\\t\\t\\tgroup: 'menu',\\n\\t\\t});\\n\\t});\\n});\\n\",null],\"names\":[\"Meteor\",\"Tracker\",\"roomCoordinator\",\"dispatchToastMessage\",\"callWithErrorHandling\",\"Messages\",\"settings\",\"MessageAction\",\"t\",\"module\",\"link\",\"v\",\"startup\",\"autorun\",\"get\",\"removeButton\",\"addButton\",\"id\",\"icon\",\"label\",\"type\",\"context\",\"action\",\"_\",\"_ref\",\"message\",\"mid\",\"_id\",\"then\",\"condition\",\"_ref2\",\"tmid\",\"replies\",\"room\",\"user\",\"parentMessage\",\"findOne\",\"fields\",\"isLivechatRoom\",\"includes\",\"order\",\"group\"],\"mappings\":\"2BAAAA,EAAuCC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA9BC,EAAQC,IAAA,CAAM,gBAAgB,CAAAV,OAAAW,CAAA,EAAAX,EAAAW,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,iBAAA,CAAAT,QAAAU,CAAA,EAAAV,EAAAU,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,+CAAA,CAAAR,gBAAAS,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,+BAAA,CAAAP,qBAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,qDAAA,CAAAN,sBAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,yBAAA,CAAAL,SAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,2BAAA,CAAAJ,SAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,2BAAA,CAAAH,cAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,0BAAA,CAAAF,EAAAG,CAAA,EAAAH,EAAAG,CAAA,CAAA,EAAA,GAWvCX,EAAOY,OAAO,CAAC,KACdX,EAAQY,OAAO,CAAC,KACf,GAAI,CAACP,EAASQ,GAAG,CAAC,mBACjB,OAAOP,EAAcQ,YAAY,CAAC,kBAEnCR,EAAcS,SAAS,CAAC,CACvBC,GAAI,iBACJC,KAAM,OACNC,MAAO,iBACPC,KAAM,cACNC,QAAS,CAAC,UAAW,iBAAkB,UAAW,YAAa,YAAa,oBAAoB,CAChG,MAAMC,OAAOC,CAAC,CAAAC,CAAA,EAAa,GAAX,CAAEC,QAAAA,CAAAA,CAAS,CAAAD,EACrBC,GAIL,MAAMrB,EAAsB,gBAAiB,CAAEsB,IAAKD,EAAQE,GAAAA,AAAG,GAAIC,IAAI,CAAC,IACvEzB,EAAqB,CACpBiB,KAAM,UACNK,QAASjB,EAAE,+BAGd,EACAqB,UAASC,CAAA,EAA8D,GAA7D,CAAEL,QAAS,CAAEE,IAAAA,CAAG,CAAEI,KAAAA,CAAI,CAAEC,QAAAA,EAAU,EAAA,CAAI,CAAEC,KAAAA,CAAI,CAAEC,KAAAA,CAAI,CAAEb,QAAAA,CAAAA,CAAS,CAAAS,EACtE,GAAIC,GAAQV,EAAS,CACpB,IAAMc,EAAgB9B,EAAS+B,OAAO,CAAC,CAAET,IAAKI,GAAQJ,CAAG,EAAI,CAAEU,OAAQ,CAAEL,QAAS,CAAC,CAAE,GACjFG,GACHH,CAAAA,EAAUG,EAAcH,OAAO,EAAI,EAAE,AAAF,CAErC,CACA,IAAMM,EAAiBpC,EAAgBoC,cAAc,CAACL,EAAKzB,CAAC,QAC5D,CAAI8B,GAGGJ,MAAAA,KAAAA,EAAMP,GAAG,EAAG,CAACK,EAAQO,QAAQ,CAACL,EAAKP,GAAG,CAC9C,EACAa,MAAO,EACPC,MAAO,QAET,EACD\"}"}