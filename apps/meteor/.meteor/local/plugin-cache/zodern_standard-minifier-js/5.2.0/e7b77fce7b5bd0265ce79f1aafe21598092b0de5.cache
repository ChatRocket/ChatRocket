{"code":"function module(e,t,l){let n,a,o,i,r,d,s,c,u,m,k,v,w,f,p,g;l.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){n=e}},0),l.link(\"@rocket.chat/emitter\",{Emitter(e){a=e}},0),l.link(\"@rocket.chat/fuselage\",{Box(e){o=e},Menu(e){i=e},Icon(e){r=e}},1),l.link(\"@rocket.chat/fuselage-hooks\",{useUniqueId(e){d=e}},2),l.link(\"@rocket.chat/ui-contexts\",{useTranslation(e){s=e},useUserId(e){c=e}},3),l.link(\"react\",{default(e){u=e},memo(e){m=e},useEffect(e){k=e}},4),l.link(\"../../../../../../app/utils/client\",{getURL(e){v=e}},5),l.link(\"../../../../../lib/download\",{download(e){w=e},downloadAs(e){f=e}},6),l.link(\"../../../contexts/RoomContext\",{useRoom(e){p=e}},7),l.link(\"../hooks/useMessageDeletionIsAllowed\",{useMessageDeletionIsAllowed(e){g=e}},8);let h=new a;\"serviceWorker\"in navigator&&navigator.serviceWorker.addEventListener(\"message\",e=>{if(\"attachment-download-result\"===e.data.type){let{result:t}=e.data;h.emit(e.data.id,{result:t,id:e.data.id})}}),l.exportDefault(m(e=>{var t;let{fileData:l,onClickDelete:a}=e,m=s(),b=p(),x=c(),E=g(b._id,l,x),I=!l.encryption||\"serviceWorker\"in navigator,{controller:y}=(null===(t=navigator)||void 0===t?void 0:t.serviceWorker)||{},D=d();k(()=>h.once(D,e=>{var t;let{result:n}=e;f({data:[new Blob([n])]},null!==(t=l.name)&&void 0!==t?t:m(\"Download\"))}),[l,m,D]);let L=n({downLoad:{label:u.createElement(o,{display:\"flex\",alignItems:\"center\"},u.createElement(r,{mie:4,name:\"download\",size:\"x16\"}),m(\"Download\")),action:()=>{var e,t;if(null!==(e=l.path)&&void 0!==e&&e.includes(\"/file-decrypt/\")){if(!y)return;null==y||y.postMessage({type:\"attachment-download\",url:l.path,id:D});return}if(l.url&&l.name){let e=null!==(t=window.webkitURL)&&void 0!==t?t:window.URL,n=v(l.url);w(n,l.name),e.revokeObjectURL(l.url)}},disabled:!I}},E&&a&&{delete:{label:u.createElement(o,{display:\"flex\",alignItems:\"center\",color:\"status-font-on-danger\"},u.createElement(r,{mie:4,name:\"trash\",size:\"x16\"}),m(\"Delete\")),action:()=>a(l._id)}});return u.createElement(i,{options:L})}))}","map":"{\"version\":3,\"sources\":[\"client/views/room/contextualBar/RoomFiles/components/FileItemMenu.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { IUpload } from '@rocket.chat/core-typings';\\nimport { Emitter } from '@rocket.chat/emitter';\\nimport { Box, Menu, Icon } from '@rocket.chat/fuselage';\\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\\nimport { useTranslation, useUserId } from '@rocket.chat/ui-contexts';\\nimport React, { memo, useEffect } from 'react';\\n\\nimport { getURL } from '../../../../../../app/utils/client';\\nimport { download, downloadAs } from '../../../../../lib/download';\\nimport { useRoom } from '../../../contexts/RoomContext';\\nimport { useMessageDeletionIsAllowed } from '../hooks/useMessageDeletionIsAllowed';\\n\\ntype FileItemMenuProps = {\\n\\tfileData: IUpload;\\n\\tonClickDelete: (id: IUpload['_id']) => void;\\n};\\n\\nconst ee = new Emitter<Record<string, { result: ArrayBuffer; id: string }>>();\\n\\nif ('serviceWorker' in navigator) {\\n\\tnavigator.serviceWorker.addEventListener('message', (event) => {\\n\\t\\tif (event.data.type === 'attachment-download-result') {\\n\\t\\t\\tconst { result } = event.data as { result: ArrayBuffer; id: string };\\n\\n\\t\\t\\tee.emit(event.data.id, { result, id: event.data.id });\\n\\t\\t}\\n\\t});\\n}\\n\\nconst FileItemMenu = ({ fileData, onClickDelete }: FileItemMenuProps) => {\\n\\tconst t = useTranslation();\\n\\tconst room = useRoom();\\n\\tconst userId = useUserId();\\n\\tconst isDeletionAllowed = useMessageDeletionIsAllowed(room._id, fileData, userId);\\n\\tconst canDownloadFile = !fileData.encryption || 'serviceWorker' in navigator;\\n\\n\\tconst { controller } = navigator?.serviceWorker || {};\\n\\n\\tconst uid = useUniqueId();\\n\\n\\tuseEffect(\\n\\t\\t() =>\\n\\t\\t\\tee.once(uid, ({ result }) => {\\n\\t\\t\\t\\tdownloadAs({ data: [new Blob([result])] }, fileData.name ?? t('Download'));\\n\\t\\t\\t}),\\n\\t\\t[fileData, t, uid],\\n\\t);\\n\\n\\tconst menuOptions = {\\n\\t\\tdownLoad: {\\n\\t\\t\\tlabel: (\\n\\t\\t\\t\\t<Box display='flex' alignItems='center'>\\n\\t\\t\\t\\t\\t<Icon mie={4} name='download' size='x16' />\\n\\t\\t\\t\\t\\t{t('Download')}\\n\\t\\t\\t\\t</Box>\\n\\t\\t\\t),\\n\\t\\t\\taction: () => {\\n\\t\\t\\t\\tif (fileData.path?.includes('/file-decrypt/')) {\\n\\t\\t\\t\\t\\tif (!controller) {\\n\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tcontroller?.postMessage({\\n\\t\\t\\t\\t\\t\\ttype: 'attachment-download',\\n\\t\\t\\t\\t\\t\\turl: fileData.path,\\n\\t\\t\\t\\t\\t\\tid: uid,\\n\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (fileData.url && fileData.name) {\\n\\t\\t\\t\\t\\tconst URL = window.webkitURL ?? window.URL;\\n\\t\\t\\t\\t\\tconst href = getURL(fileData.url);\\n\\t\\t\\t\\t\\tdownload(href, fileData.name);\\n\\t\\t\\t\\t\\tURL.revokeObjectURL(fileData.url);\\n\\t\\t\\t\\t}\\n\\t\\t\\t},\\n\\t\\t\\tdisabled: !canDownloadFile,\\n\\t\\t},\\n\\t\\t...(isDeletionAllowed &&\\n\\t\\t\\tonClickDelete && {\\n\\t\\t\\t\\tdelete: {\\n\\t\\t\\t\\t\\tlabel: (\\n\\t\\t\\t\\t\\t\\t<Box display='flex' alignItems='center' color='status-font-on-danger'>\\n\\t\\t\\t\\t\\t\\t\\t<Icon mie={4} name='trash' size='x16' />\\n\\t\\t\\t\\t\\t\\t\\t{t('Delete')}\\n\\t\\t\\t\\t\\t\\t</Box>\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t\\t\\taction: () => onClickDelete(fileData._id),\\n\\t\\t\\t\\t},\\n\\t\\t\\t}),\\n\\t};\\n\\n\\treturn <Menu options={menuOptions} />;\\n};\\n\\nexport default memo(FileItemMenu);\\n\",null],\"names\":[\"_objectSpread\",\"Emitter\",\"Box\",\"Menu\",\"Icon\",\"useUniqueId\",\"useTranslation\",\"useUserId\",\"React\",\"memo\",\"useEffect\",\"getURL\",\"download\",\"downloadAs\",\"useRoom\",\"useMessageDeletionIsAllowed\",\"module\",\"link\",\"default\",\"v\",\"ee\",\"navigator\",\"serviceWorker\",\"addEventListener\",\"event\",\"data\",\"type\",\"result\",\"emit\",\"id\",\"exportDefault\",\"_ref\",\"_navigator\",\"fileData\",\"onClickDelete\",\"t\",\"room\",\"userId\",\"isDeletionAllowed\",\"_id\",\"canDownloadFile\",\"encryption\",\"controller\",\"uid\",\"once\",\"_ref2\",\"_fileData$name\",\"Blob\",\"name\",\"menuOptions\",\"downLoad\",\"label\",\"createElement\",\"display\",\"alignItems\",\"mie\",\"size\",\"action\",\"_fileData$path\",\"_window$webkitURL\",\"path\",\"includes\",\"postMessage\",\"url\",\"URL\",\"window\",\"webkitURL\",\"href\",\"revokeObjectURL\",\"disabled\",\"delete\",\"color\",\"options\"],\"mappings\":\"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\"}"}