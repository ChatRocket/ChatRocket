{"code":"function module(n,t,e){e.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(n){i=n}},0),e.export({useTranslationsForApps:function(){return d}}),e.link(\"@rocket.chat/tools\",{normalizeLanguage:function(n){a=n}},0),e.link(\"@rocket.chat/ui-contexts\",{useEndpoint:function(n){u=n},useStream:function(n){c=n},useUserId:function(n){r=n}},1),e.link(\"@tanstack/react-query\",{useQuery:function(n){o=n},useQueryClient:function(n){s=n}},2),e.link(\"react\",{useEffect:function(n){f=n}},3),e.link(\"react-i18next\",{useTranslation:function(n){l=n}},4),e.link(\"../../lib/utils/highOrderFunctions\",{withDebouncing:function(n){p=n}},5);var i,a,u,c,r,o,s,f,l,p,d=function(){var n=u(\"GET\",\"/apps/languages\"),t=o({queryKey:[\"apps\",\"translations\"],queryFn:function(){return n()},staleTime:1/0}),e=t.isSuccess,d=t.data,k=l().i18n;f(function(){e&&d.apps.forEach(function(n){var t=n.id;Object.entries(n.languages).forEach(function(n){var e=i(n,2),u=e[0],c=e[1],r=a(u);k.addResourceBundle(r,\"app-\"+t,c)})})},[k,d,e]);var g=s(),h=c(\"apps\"),v=r();f(function(){if(v){var n=p({wait:100})(function(){g.invalidateQueries([\"apps\",\"translations\"])}),t=h(\"apps\",function(t){\"app/added\"===i(t,1)[0]&&n()});return function(){t(),n.cancel()}}},[v,h,g])}}","map":"{\"version\":3,\"sources\":[\"client/hooks/useTranslationsForApps.ts\",\"<anon>\"],\"sourcesContent\":[\"import { normalizeLanguage } from '@rocket.chat/tools';\\nimport { useEndpoint, useStream, useUserId } from '@rocket.chat/ui-contexts';\\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\\nimport { useEffect } from 'react';\\nimport { useTranslation } from 'react-i18next';\\n\\nimport { withDebouncing } from '../../lib/utils/highOrderFunctions';\\n\\nexport const useTranslationsForApps = () => {\\n\\tconst getAppsLanguages = useEndpoint('GET', '/apps/languages');\\n\\n\\tconst { isSuccess, data } = useQuery({\\n\\t\\tqueryKey: ['apps', 'translations'] as const,\\n\\t\\tqueryFn: () => getAppsLanguages(),\\n\\t\\tstaleTime: Infinity,\\n\\t});\\n\\n\\tconst { i18n } = useTranslation();\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!isSuccess) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tdata.apps.forEach(({ id: appId, languages }) => {\\n\\t\\t\\tObject.entries(languages).forEach(([language, translations]) => {\\n\\t\\t\\t\\tconst normalizedLanguage = normalizeLanguage(language);\\n\\t\\t\\t\\tconst namespace = `app-${appId}`;\\n\\t\\t\\t\\ti18n.addResourceBundle(normalizedLanguage, namespace, translations);\\n\\t\\t\\t});\\n\\t\\t});\\n\\t}, [i18n, data, isSuccess]);\\n\\n\\tconst queryClient = useQueryClient();\\n\\tconst subscribeToApps = useStream('apps');\\n\\tconst uid = useUserId();\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!uid) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst invalidate = withDebouncing({ wait: 100 })(() => {\\n\\t\\t\\tqueryClient.invalidateQueries(['apps', 'translations']);\\n\\t\\t});\\n\\n\\t\\tconst unsubscribe = subscribeToApps('apps', ([key]) => {\\n\\t\\t\\tif (key === 'app/added') {\\n\\t\\t\\t\\tinvalidate();\\n\\t\\t\\t}\\n\\t\\t});\\n\\n\\t\\treturn () => {\\n\\t\\t\\tunsubscribe();\\n\\t\\t\\tinvalidate.cancel();\\n\\t\\t};\\n\\t}, [uid, subscribeToApps, queryClient]);\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_slicedToArray\",\"export\",\"useTranslationsForApps\",\"normalizeLanguage\",\"useEndpoint\",\"useStream\",\"useUserId\",\"useQuery\",\"useQueryClient\",\"useEffect\",\"useTranslation\",\"withDebouncing\",\"getAppsLanguages\",\"_useQuery\",\"queryKey\",\"queryFn\",\"staleTime\",\"Infinity\",\"isSuccess\",\"data\",\"i18n\",\"_useTranslation\",\"apps\",\"forEach\",\"_ref\",\"appId\",\"id\",\"Object\",\"entries\",\"languages\",\"_ref2\",\"_ref3\",\"language\",\"translations\",\"normalizedLanguage\",\"addResourceBundle\",\"queryClient\",\"subscribeToApps\",\"uid\",\"invalidate\",\"wait\",\"invalidateQueries\",\"unsubscribe\",\"_ref4\",\"_ref5\",\"cancel\"],\"mappings\":\"uBAASA,EAAiBC,IAAE,CAAA,uCAA2B,CAAAC,QAAA,SAAAC,CAAA,EAAAC,EAAAD,CAAA,CAAA,EAAA,GAAvDH,EAAOK,MAAE,CAAA,CAAAC,uBAAyB,WAAA,OAAqBA,CAAA,CAAA,GAAAN,EAAAC,IAAA,CAAA,qBAAA,CAAAM,kBAAA,SAAAJ,CAAA,EAAAI,EAAAJ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,2BAAA,CAAAO,YAAA,SAAAL,CAAA,EAAAK,EAAAL,CAAA,EAAAM,UAAA,SAAAN,CAAA,EAAAM,EAAAN,CAAA,EAAAO,UAAA,SAAAP,CAAA,EAAAO,EAAAP,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,wBAAA,CAAAU,SAAA,SAAAR,CAAA,EAAAQ,EAAAR,CAAA,EAAAS,eAAA,SAAAT,CAAA,EAAAS,EAAAT,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,QAAA,CAAAY,UAAA,SAAAV,CAAA,EAAAU,EAAAV,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,gBAAA,CAAAa,eAAA,SAAAX,CAAA,EAAAW,EAAAX,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,qCAAA,CAAAc,eAAA,SAAAZ,CAAA,EAAAY,EAAAZ,CAAA,CAAA,EAAA,GAQhD,IARPC,EAAuDG,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAQ1CT,EAAyB,WACrC,IAAMU,EAAmBR,EAAY,MAAO,mBAE5CS,EAA4BN,EAAS,CACpCO,SAAU,CAAC,OAAQ,eAAwB,CAC3CC,QAAS,WAAA,OAAMH,GAAkB,EACjCI,UAAWC,MAHJC,EAASL,EAATK,SAAS,CAAEC,EAAIN,EAAJM,IAAI,CAMfC,EAAIC,AAAKX,IAATU,IAAI,CAEZX,EAAU,WACJS,GAILC,EAAKG,IAAI,CAACC,OAAO,CAAC,SAAAC,CAAA,EAA6B,IAAtBC,EAAKD,EAATE,EAAE,CACtBC,OAAOC,OAAO,CAD0BJ,EAATK,SAAS,EACdN,OAAO,CAAC,SAAAO,CAAA,EAA6B,IAAAC,EAAA/B,EAAA8B,EAAA,GAA3BE,EAAQD,CAAA,CAAA,EAAA,CAAEE,EAAYF,CAAA,CAAA,EAAA,CACnDG,EAAqB/B,EAAkB6B,GAE7CZ,EAAKe,iBAAiB,CAACD,EADR,OAAUT,EAC6BQ,EACvD,EACD,EACD,EAAG,CAACb,EAAMD,EAAMD,EAAU,EAE1B,IAAMkB,EAAc5B,IACd6B,EAAkBhC,EAAU,QAC5BiC,EAAMhC,IAEZG,EAAU,WACT,GAAK6B,GAIL,IAAMC,EAAa5B,EAAe,CAAE6B,KAAM,GAAG,GAAI,WAChDJ,EAAYK,iBAAiB,CAAC,CAAC,OAAQ,eAAe,CACvD,GAEMC,EAAcL,EAAgB,OAAQ,SAAAM,CAAA,EAC/B,cADoCC,AAAK5C,EAAA2C,EAAA,EAAL,CAAA,EAAA,EAE/CJ,GAEF,GAEA,OAAO,WACNG,IACAH,EAAWM,MAAM,EAClB,EACD,EAAG,CAACP,EAAKD,EAAiBD,EAAY,CACvC\"}"}