{"code":"function module(e,n,t){var i,r,c,o,u,a,s,l,f,d,v,g,p,b,h,k;t.link(\"@babel/runtime/regenerator\",{default:function(e){i=e}},0),t.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){r=e}},1),t.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){c=e}},2),t.link(\"@rocket.chat/ui-contexts\",{SettingsContext:function(e){o=e},useAtLeastOnePermission:function(e){u=e},useMethod:function(e){a=e}},0),t.link(\"meteor/tracker\",{Tracker:function(e){s=e}},1),t.link(\"react\",{default:function(e){l=e},useCallback:function(e){f=e},useEffect:function(e){d=e},useMemo:function(e){v=e},useState:function(e){g=e}},2),t.link(\"../lib/createReactiveSubscriptionFactory\",{createReactiveSubscriptionFactory:function(e){p=e}},3),t.link(\"../lib/queryClient\",{queryClient:function(e){b=e}},4),t.link(\"../lib/settings/PrivateSettingsCachedCollection\",{PrivateSettingsCachedCollection:function(e){h=e}},5),t.link(\"../lib/settings/PublicSettingsCachedCollection\",{PublicSettingsCachedCollection:function(e){k=e}},6),t.exportDefault(function(e){var n=e.children,t=e.privileged,y=u(v(function(){return[\"view-privileged-setting\",\"edit-privileged-setting\",\"manage-selected-settings\"]},[])),C=void 0!==t&&t&&y,S=v(function(){return C?h:k},[C]),m=g(function(){return s.nonreactive(function(){return!S.ready.get()})}),x=c(m,2),_=x[0],P=x[1];d(function(){var e=!0;return i.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(s.nonreactive(function(){return S.ready.get()})){n.next=3;break}return n.next=3,i.awrap(S.init());case 3:if(e){n.next=5;break}return n.abrupt(\"return\");case 5:P(!1);case 6:case\"end\":return n.stop()}},null,null,null,Promise),function(){e=!1}},[S]);var A=v(function(){return p(function(e){var n=S.collection.findOne(e);return n?r({},n):void 0})},[S]),w=v(function(){return p(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return S.collection.find(r(r(r(r({},\"_id\"in e&&Array.isArray(e._id)&&{_id:{$in:e._id}}),\"_id\"in e&&!Array.isArray(e._id)&&{_id:e._id}),\"group\"in e&&{group:e.group}),\"section\"in e&&(e.section?{section:e.section}:{$or:[{section:{$exists:!1}},{section:void 0}]})),{sort:{section:1,sorter:1,i18nLabel:1}}).fetch()})},[S]),q=function(e){e.forEach(function(e){\"Enterprise_License\"===e._id&&b.invalidateQueries([\"licenses\"])})},E=a(\"saveSettings\"),L=f(function(e){return i.async(function(n){for(;;)switch(n.prev=n.next){case 0:return q(e),n.next=3,i.awrap(E(e));case 3:case\"end\":return n.stop()}},null,null,null,Promise)},[E]),$=v(function(){return{hasPrivateAccess:C,isLoading:_,querySetting:A,querySettings:w,dispatch:L}},[C,_,A,w,L]);return l.createElement(o.Provider,{children:n,value:$})})}","map":"{\"version\":3,\"sources\":[\"client/providers/SettingsProvider.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { ISetting } from '@rocket.chat/core-typings';\\nimport type { SettingsContextValue } from '@rocket.chat/ui-contexts';\\nimport { SettingsContext, useAtLeastOnePermission, useMethod } from '@rocket.chat/ui-contexts';\\nimport { Tracker } from 'meteor/tracker';\\nimport type { ReactNode } from 'react';\\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\\n\\nimport { createReactiveSubscriptionFactory } from '../lib/createReactiveSubscriptionFactory';\\nimport { queryClient } from '../lib/queryClient';\\nimport { PrivateSettingsCachedCollection } from '../lib/settings/PrivateSettingsCachedCollection';\\nimport { PublicSettingsCachedCollection } from '../lib/settings/PublicSettingsCachedCollection';\\n\\ntype SettingsProviderProps = {\\n\\tchildren?: ReactNode;\\n\\tprivileged?: boolean;\\n};\\n\\nconst SettingsProvider = ({ children, privileged = false }: SettingsProviderProps) => {\\n\\tconst hasPrivilegedPermission = useAtLeastOnePermission(\\n\\t\\tuseMemo(() => ['view-privileged-setting', 'edit-privileged-setting', 'manage-selected-settings'], []),\\n\\t);\\n\\n\\tconst hasPrivateAccess = privileged && hasPrivilegedPermission;\\n\\n\\tconst cachedCollection = useMemo(\\n\\t\\t() => (hasPrivateAccess ? PrivateSettingsCachedCollection : PublicSettingsCachedCollection),\\n\\t\\t[hasPrivateAccess],\\n\\t);\\n\\n\\tconst [isLoading, setLoading] = useState(() => Tracker.nonreactive(() => !cachedCollection.ready.get()));\\n\\n\\tuseEffect(() => {\\n\\t\\tlet mounted = true;\\n\\n\\t\\tconst initialize = async (): Promise<void> => {\\n\\t\\t\\tif (!Tracker.nonreactive(() => cachedCollection.ready.get())) {\\n\\t\\t\\t\\tawait cachedCollection.init();\\n\\t\\t\\t}\\n\\n\\t\\t\\tif (!mounted) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tsetLoading(false);\\n\\t\\t};\\n\\n\\t\\tinitialize();\\n\\n\\t\\treturn (): void => {\\n\\t\\t\\tmounted = false;\\n\\t\\t};\\n\\t}, [cachedCollection]);\\n\\n\\tconst querySetting = useMemo(\\n\\t\\t() =>\\n\\t\\t\\tcreateReactiveSubscriptionFactory((_id): ISetting | undefined => {\\n\\t\\t\\t\\tconst subscription = cachedCollection.collection.findOne(_id);\\n\\t\\t\\t\\treturn subscription ? { ...subscription } : undefined;\\n\\t\\t\\t}),\\n\\t\\t[cachedCollection],\\n\\t);\\n\\n\\tconst querySettings = useMemo(\\n\\t\\t() =>\\n\\t\\t\\tcreateReactiveSubscriptionFactory((query = {}) =>\\n\\t\\t\\t\\tcachedCollection.collection\\n\\t\\t\\t\\t\\t.find(\\n\\t\\t\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\t\\t...('_id' in query && Array.isArray(query._id) && { _id: { $in: query._id } }),\\n\\t\\t\\t\\t\\t\\t\\t...('_id' in query && !Array.isArray(query._id) && { _id: query._id }),\\n\\t\\t\\t\\t\\t\\t\\t...('group' in query && { group: query.group }),\\n\\t\\t\\t\\t\\t\\t\\t...('section' in query &&\\n\\t\\t\\t\\t\\t\\t\\t\\t(query.section\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t? { section: query.section }\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t: {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t$or: [{ section: { $exists: false } }, { section: undefined }],\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t  })),\\n\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\t\\tsort: {\\n\\t\\t\\t\\t\\t\\t\\t\\tsection: 1,\\n\\t\\t\\t\\t\\t\\t\\t\\tsorter: 1,\\n\\t\\t\\t\\t\\t\\t\\t\\ti18nLabel: 1,\\n\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t)\\n\\t\\t\\t\\t\\t.fetch(),\\n\\t\\t\\t),\\n\\t\\t[cachedCollection],\\n\\t);\\n\\n\\tconst settingsChangeCallback = (changes: { _id: string }[]): void => {\\n\\t\\tchanges.forEach((val) => {\\n\\t\\t\\tswitch (val._id) {\\n\\t\\t\\t\\tcase 'Enterprise_License':\\n\\t\\t\\t\\t\\tqueryClient.invalidateQueries(['licenses']);\\n\\t\\t\\t\\t\\tbreak;\\n\\n\\t\\t\\t\\tdefault:\\n\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t}\\n\\t\\t});\\n\\t};\\n\\n\\tconst saveSettings = useMethod('saveSettings');\\n\\tconst dispatch = useCallback(\\n\\t\\tasync (changes) => {\\n\\t\\t\\tsettingsChangeCallback(changes);\\n\\t\\t\\tawait saveSettings(changes);\\n\\t\\t},\\n\\t\\t[saveSettings],\\n\\t);\\n\\n\\tconst contextValue = useMemo<SettingsContextValue>(\\n\\t\\t() => ({\\n\\t\\t\\thasPrivateAccess,\\n\\t\\t\\tisLoading,\\n\\t\\t\\tquerySetting,\\n\\t\\t\\tquerySettings,\\n\\t\\t\\tdispatch,\\n\\t\\t}),\\n\\t\\t[hasPrivateAccess, isLoading, querySetting, querySettings, dispatch],\\n\\t);\\n\\n\\treturn <SettingsContext.Provider children={children} value={contextValue} />;\\n};\\n\\nexport default SettingsProvider;\\n\\n// '[subscribe: (onStoreChange: () => void) => () => void, getSnapshot: () => {}]'\\n// '[subscribe: (onStoreChange: () => void) => () => void, getSnapshot: () => ISetting | undefined]'\\n\",null],\"names\":[\"_regeneratorRuntime\",\"_objectSpread\",\"_slicedToArray\",\"SettingsContext\",\"useAtLeastOnePermission\",\"useMethod\",\"Tracker\",\"React\",\"useCallback\",\"useEffect\",\"useMemo\",\"useState\",\"createReactiveSubscriptionFactory\",\"queryClient\",\"PrivateSettingsCachedCollection\",\"PublicSettingsCachedCollection\",\"module\",\"link\",\"default\",\"v\",\"exportDefault\",\"_ref\",\"children\",\"_ref$privileged\",\"privileged\",\"hasPrivilegedPermission\",\"hasPrivateAccess\",\"cachedCollection\",\"_useState\",\"nonreactive\",\"ready\",\"get\",\"_useState2\",\"isLoading\",\"setLoading\",\"mounted\",\"async\",\"_context\",\"prev\",\"next\",\"awrap\",\"init\",\"abrupt\",\"stop\",\"Promise\",\"querySetting\",\"_id\",\"subscription\",\"collection\",\"findOne\",\"undefined\",\"querySettings\",\"query\",\"arguments\",\"length\",\"find\",\"Array\",\"isArray\",\"$in\",\"group\",\"section\",\"$or\",\"$exists\",\"sort\",\"sorter\",\"i18nLabel\",\"fetch\",\"settingsChangeCallback\",\"changes\",\"forEach\",\"val\",\"invalidateQueries\",\"saveSettings\",\"dispatch\",\"_context2\",\"contextValue\",\"createElement\",\"Provider\",\"value\"],\"mappings\":\"uBAiBA,IAfAA,EAA+FC,EAAAC,EAA/FC,EAASC,EAAiBC,EAAqEC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAvEC,EAAEC,IAAA,CAAA,6BAAoC,CAAAC,QAAM,SAAAC,CAAA,EAAAnB,EAA2BmB,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAC,QAAA,SAAAC,CAAA,EAAAlB,EAAAkB,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAC,QAAA,SAAAC,CAAA,EAAAjB,EAAAiB,CAAA,CAAA,EAAA,GAA5CH,EAASC,IAAE,CAAA,2BAAM,CAA0Bd,gBAAC,SAAAgB,CAAA,EAAAhB,EAAAgB,CAAA,EAAAf,wBAAA,SAAAe,CAAA,EAAAf,EAAAe,CAAA,EAAAd,UAAA,SAAAc,CAAA,EAAAd,EAAAc,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,iBAAA,CAAAX,QAAA,SAAAa,CAAA,EAAAb,EAAAa,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,QAAA,CAAA,QAAA,SAAAE,CAAA,EAAAZ,EAAAY,CAAA,EAAAX,YAAA,SAAAW,CAAA,EAAAX,EAAAW,CAAA,EAAAV,UAAA,SAAAU,CAAA,EAAAV,EAAAU,CAAA,EAAAT,QAAA,SAAAS,CAAA,EAAAT,EAAAS,CAAA,EAAAR,SAAA,SAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,2CAAA,CAAAL,kCAAA,SAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,qBAAA,CAAAJ,YAAA,SAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,kDAAA,CAAAH,gCAAA,SAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,iDAAA,CAAAF,+BAAA,SAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAA/FH,EAAOI,aAAE,CAegB,SAAAC,CAAA,EAA4D,IAAzDC,EAAQD,EAARC,QAAQ,CAAAC,EAAAF,EAAEG,UAAU,CACzCC,EAA0BrB,EAC/BM,EAAQ,WAAA,MAAM,CAAC,0BAA2B,0BAA2B,2BAA2B,EAAE,EAAE,GAG/FgB,EAAmBF,AALsB,KAAA,IAAAD,GAAQA,GAKhBE,EAEjCE,EAAmBjB,EACxB,WAAA,OAAOgB,EAAmBZ,EAAkCC,CAA8B,EAC1F,CAACW,EAAiB,EAGnBE,EAAgCjB,EAAS,WAAA,OAAML,EAAQuB,WAAW,CAAC,WAAA,MAAM,CAACF,EAAiBG,KAAK,CAACC,GAAG,EAAE,EAAC,GAACC,EAAA9B,EAAA0B,EAAA,GAAjGK,EAASD,CAAA,CAAA,EAAA,CAAEE,EAAUF,CAAA,CAAA,EAAA,CAE5BvB,EAAU,WACT,IAAI0B,EAAU,CAAA,EAgBd,OAdmBnC,EAAAoC,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAAA,GACbjC,EAAQuB,WAAW,CAAC,WAAA,OAAMF,EAAiBG,KAAK,CAACC,GAAG,EAAE,GAAC,CAAAM,EAAAE,IAAA,CAAA,EAAA,KAAA,CAAA,OAAAF,EAAAE,IAAA,CAAA,EAAAvC,EAAAwC,KAAA,CACrDb,EAAiBc,IAAI,GAAE,MAAA,EAAA,GAGzBN,EAAO,CAAAE,EAAAE,IAAA,CAAA,EAAA,KAAA,CAAA,OAAAF,EAAAK,MAAA,CAAA,SAAA,MAAA,EAIZR,EAAW,CAAA,EAAO,MAAA,EAAA,IAAA,MAAA,OAAAG,EAAAM,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,SAKZ,WACNT,EAAU,CAAA,CACX,CACD,EAAG,CAACR,EAAiB,EAErB,IAAMkB,EAAenC,EACpB,WAAA,OACCE,EAAkC,SAACkC,CAAG,EACrC,IAAMC,EAAepB,EAAiBqB,UAAU,CAACC,OAAO,CAACH,GACzD,OAAOC,EAAY9C,EAAA,CAAA,EAAQ8C,GAAiBG,KAAAA,CAC7C,EAAE,EACH,CAACvB,EAAiB,EAGbwB,EAAgBzC,EACrB,WAAA,OACCE,EAAkC,WAAA,IAACwC,EAAKC,UAAAC,MAAA,CAAA,GAAAD,AAAAH,KAAAA,IAAAG,SAAA,CAAA,EAAA,CAAAA,SAAA,CAAA,EAAA,CAAG,CAAA,EAAE,OAC5C1B,EAAiBqB,UAAU,CACzBO,IAAI,CAAAtD,EAAAA,EAAAA,EAAAA,EAAA,CAAA,EAEC,QAASmD,GAASI,MAAMC,OAAO,CAACL,EAAMN,GAAG,GAAK,CAAEA,IAAK,CAAEY,IAAKN,EAAMN,GAAAA,AAAG,CAAE,GACvE,QAASM,GAAS,CAACI,MAAMC,OAAO,CAACL,EAAMN,GAAG,GAAK,CAAEA,IAAKM,EAAMN,GAAAA,AAAG,GAC/D,UAAWM,GAAS,CAAEO,MAAOP,EAAMO,KAAAA,AAAK,GACxC,YAAaP,GACfA,CAAAA,EAAMQ,OAAO,CACX,CAAEA,QAASR,EAAMQ,OAAAA,AAAO,EACxB,CACAC,IAAK,CAAC,CAAED,QAAS,CAAEE,QAAS,CAAA,CAAK,CAAE,EAAI,CAAEF,QAASV,KAAAA,CAAS,EAAE,IAGlE,CACCa,KAAM,CACLH,QAAS,EACTI,OAAQ,EACRC,UAAW,KAIbC,KAAK,EAAE,EACT,EACF,CAACvC,EAAiB,EAGbwC,EAAyB,SAACC,CAA0B,EACzDA,EAAQC,OAAO,CAAC,SAACC,CAAG,EAEb,uBADEA,EAAIxB,GAAG,EAEbjC,EAAY0D,iBAAiB,CAAC,CAAC,WAAW,CAM7C,EACD,EAEMC,EAAenE,EAAU,gBACzBoE,EAAWjE,EAChB,SAAO4D,CAAO,EAAA,OAAApE,EAAAoC,KAAA,CAAA,SAAAsC,CAAA,EAAA,OAAA,OAAAA,EAAApC,IAAA,CAAAoC,EAAAnC,IAAA,EAAA,KAAA,EACmB,OAAhC4B,EAAuBC,GAASM,EAAAnC,IAAA,CAAA,EAAAvC,EAAAwC,KAAA,CAC1BgC,EAAaJ,GAAQ,MAAA,EAAA,IAAA,MAAA,OAAAM,EAAA/B,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,EAE5B,CAAC4B,EAAa,EAGTG,EAAejE,EACpB,WAAA,MAAO,CACNgB,iBAAAA,EACAO,UAAAA,EACAY,aAAAA,EACAM,cAAAA,EACAsB,SAAAA,EACA,EACD,CAAC/C,EAAkBO,EAAWY,EAAcM,EAAesB,EAAS,EAGrE,OAAOlE,EAAAqE,aAAA,CAACzE,EAAgB0E,QAAQ,CAAA,CAACvD,SAAUA,EAAUwD,MAAOH,CAAa,EAC1E\"}"}