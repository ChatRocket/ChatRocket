{"code":"function module(l,t,e){let o,r,i,n,s;function c(l){let t=r(t=>{if(!t)return;let e=s.getStore(l);null!=e&&e.scroll&&!e.atBottom?t.scrollTo({left:30,top:e.scroll}):t.scrollTo({top:t.scrollHeight})},[l]),e=r(t=>{if(!t)return;let e=s.getStore(l),o=n({wait:100})(()=>{null==e||e.update({scroll:t.scrollTop,atBottom:i(t,50)})});t.addEventListener(\"scroll\",o,{passive:!0})},[l]);return{innerRef:o(e,t)}}e.export({useRestoreScrollPosition:()=>c}),e.link(\"@rocket.chat/fuselage-hooks\",{useMergedRefs(l){o=l}},0),e.link(\"react\",{useCallback(l){r=l}},1),e.link(\"../../../../../app/ui/client/views/app/lib/scrolling\",{isAtBottom(l){i=l}},2),e.link(\"../../../../../lib/utils/highOrderFunctions\",{withThrottling(l){n=l}},3),e.link(\"../../../../lib/RoomManager\",{RoomManager(l){s=l}},4)}","map":"{\"version\":3,\"sources\":[\"client/views/room/body/hooks/useRestoreScrollPosition.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom } from '@rocket.chat/core-typings';\\nimport { useMergedRefs } from '@rocket.chat/fuselage-hooks';\\nimport type { RefObject } from 'react';\\nimport { useCallback } from 'react';\\n\\nimport { isAtBottom } from '../../../../../app/ui/client/views/app/lib/scrolling';\\nimport { withThrottling } from '../../../../../lib/utils/highOrderFunctions';\\nimport { RoomManager } from '../../../../lib/RoomManager';\\n\\nexport function useRestoreScrollPosition(roomId: IRoom['_id']) {\\n\\tconst ref = useCallback(\\n\\t\\t(node: HTMLElement | null) => {\\n\\t\\t\\tif (!node) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\tconst store = RoomManager.getStore(roomId);\\n\\n\\t\\t\\tif (store?.scroll && !store.atBottom) {\\n\\t\\t\\t\\tnode.scrollTo({\\n\\t\\t\\t\\t\\tleft: 30,\\n\\t\\t\\t\\t\\ttop: store.scroll,\\n\\t\\t\\t\\t});\\n\\t\\t\\t} else {\\n\\t\\t\\t\\tnode.scrollTo({\\n\\t\\t\\t\\t\\ttop: node.scrollHeight,\\n\\t\\t\\t\\t});\\n\\t\\t\\t}\\n\\t\\t},\\n\\t\\t[roomId],\\n\\t);\\n\\n\\tconst refCallback = useCallback(\\n\\t\\t(node: HTMLElement | null) => {\\n\\t\\t\\tif (!node) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst store = RoomManager.getStore(roomId);\\n\\n\\t\\t\\tconst handleWrapperScroll = withThrottling({ wait: 100 })(() => {\\n\\t\\t\\t\\tstore?.update({ scroll: node.scrollTop, atBottom: isAtBottom(node, 50) });\\n\\t\\t\\t});\\n\\n\\t\\t\\tnode.addEventListener('scroll', handleWrapperScroll, {\\n\\t\\t\\t\\tpassive: true,\\n\\t\\t\\t});\\n\\t\\t},\\n\\t\\t[roomId],\\n\\t);\\n\\n\\treturn {\\n\\t\\tinnerRef: useMergedRefs(refCallback, ref) as unknown as RefObject<HTMLElement>,\\n\\t};\\n}\\n\",null],\"names\":[\"useMergedRefs\",\"useCallback\",\"isAtBottom\",\"withThrottling\",\"RoomManager\",\"useRestoreScrollPosition\",\"roomId\",\"ref\",\"node\",\"store\",\"getStore\",\"scroll\",\"atBottom\",\"scrollTo\",\"left\",\"top\",\"scrollHeight\",\"refCallback\",\"handleWrapperScroll\",\"wait\",\"update\",\"scrollTop\",\"addEventListener\",\"passive\",\"innerRef\",\"module\",\"export\",\"link\",\"v\"],\"mappings\":\"2BAC4DA,EAAAC,EAAAC,EAAAC,EAAAC,EAQtD,SAAUC,EAAyBC,CAAoB,EAC5D,IAAMC,EAAMN,EACVO,IACA,GAAI,CAACA,EACJ,OAED,IAAMC,EAAQL,EAAYM,QAAQ,CAACJ,EAE/BG,OAAAA,GAAAA,EAAOE,MAAM,EAAI,CAACF,EAAMG,QAAQ,CACnCJ,EAAKK,QAAQ,CAAC,CACbC,KAAM,GACNC,IAAKN,EAAME,MAAAA,GAGZH,EAAKK,QAAQ,CAAC,CACbE,IAAKP,EAAKQ,YAAAA,EAGb,EACA,CAACV,EAAO,EAGHW,EAAchB,EAClBO,IACA,GAAI,CAACA,EACJ,OAGD,IAAMC,EAAQL,EAAYM,QAAQ,CAACJ,GAE7BY,EAAsBf,EAAe,CAAEgB,KAAM,GAAG,GAAI,KACzDV,MAAAA,GAAAA,EAAOW,MAAM,CAAC,CAAET,OAAQH,EAAKa,SAAS,CAAET,SAAUV,EAAWM,EAAM,GAAG,EACvE,GAEAA,EAAKc,gBAAgB,CAAC,SAAUJ,EAAqB,CACpDK,QAAS,CAAA,GAEX,EACA,CAACjB,EAAO,EAGT,MAAO,CACNkB,SAAUxB,EAAciB,EAAaV,GAEvC,CApDAkB,EAAOC,MAAE,CAAA,CAAArB,yBAAqBA,IAAAA,CAA8B,GAAAoB,EAAAE,IAAA,CAAA,8BAAA,CAAA3B,cAAA4B,CAAA,EAAA5B,EAAA4B,CAAA,CAAA,EAAA,GAAAH,EAAAE,IAAA,CAAA,QAAA,CAAA1B,YAAA2B,CAAA,EAAA3B,EAAA2B,CAAA,CAAA,EAAA,GAAAH,EAAAE,IAAA,CAAA,uDAAA,CAAAzB,WAAA0B,CAAA,EAAA1B,EAAA0B,CAAA,CAAA,EAAA,GAAAH,EAAAE,IAAA,CAAA,8CAAA,CAAAxB,eAAAyB,CAAA,EAAAzB,EAAAyB,CAAA,CAAA,EAAA,GAAAH,EAAAE,IAAA,CAAA,8BAAA,CAAAvB,YAAAwB,CAAA,EAAAxB,EAAAwB,CAAA,CAAA,EAAA\"}"}