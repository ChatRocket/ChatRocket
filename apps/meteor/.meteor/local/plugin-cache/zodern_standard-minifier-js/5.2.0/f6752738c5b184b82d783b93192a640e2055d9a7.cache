{"code":"function module(e,i,o){let n,r,l,d,t,u;o.export({actionAllowed:()=>R,isEditableByTheUser:()=>c,canCreateInviteLinks:()=>_,isRoomSettingAllowed:()=>S}),o.link(\"@rocket.chat/core-typings\",{isRoomFederated(e){n=e},isDirectMessageRoom(e){r=e},isPublicRoom(e){l=e}},0),o.link(\"../../../app/models/client\",{RoomRoles(e){d=e}},1),o.link(\"../../../definition/IRoomTypeConfig\",{RoomMemberActions(e){t=e},RoomSettingsEnum(e){u=e}},2);let s=[t.REMOVE_USER,t.SET_AS_OWNER,t.SET_AS_MODERATOR],E=[u.NAME,u.TOPIC],R=(e,i,o,l)=>{var u,E;if(!n(e)||r(e))return!1;let R=!(null!=l&&l.roles);if(!l||R)return!1;let c=(null===(u=l.u)||void 0===u?void 0:u._id)===o,_=i===t.REMOVE_USER&&c;if(_)return!1;let S=(null===(E=d.findOne({rid:e._id,\"u._id\":o}))||void 0===E?void 0:E.roles)||[],m=l.roles||[];if(m.includes(\"owner\")){if(i===t.SET_AS_OWNER||i===t.SET_AS_MODERATOR)return!S.includes(\"owner\")||c;if(i===t.REMOVE_USER)return!S.includes(\"owner\");let e=s.includes(i);return e}if(m.includes(\"moderator\")){if(S.includes(\"owner\"))return!1;if(S.includes(\"moderator\"))return i===t.SET_AS_MODERATOR&&c;let e=i===t.SET_AS_MODERATOR||i===t.REMOVE_USER;return e}return!1},c=(e,i,o)=>{var r,l;return!!e&&!!i&&!!o&&n(i)&&!!((null===(r=o.roles)||void 0===r?void 0:r.includes(\"owner\"))||(null===(l=o.roles)||void 0===l?void 0:l.includes(\"moderator\")))},_=(e,i,o)=>{var r,d;return!!e&&!!i&&!!o&&n(i)&&l(i)&&!!((null===(r=o.roles)||void 0===r?void 0:r.includes(\"owner\"))||(null===(d=o.roles)||void 0===d?void 0:d.includes(\"moderator\")))},S=(e,i)=>!(!n(e)||r(e))&&E.includes(i)}","map":"{\"version\":3,\"sources\":[\"client/lib/federation/Federation.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom, ISubscription, IUser, ValueOf } from '@rocket.chat/core-typings';\\nimport { isRoomFederated, isDirectMessageRoom, isPublicRoom } from '@rocket.chat/core-typings';\\n\\nimport { RoomRoles } from '../../../app/models/client';\\nimport { RoomMemberActions, RoomSettingsEnum } from '../../../definition/IRoomTypeConfig';\\n\\nconst allowedUserActionsInFederatedRooms: ValueOf<typeof RoomMemberActions>[] = [\\n\\tRoomMemberActions.REMOVE_USER,\\n\\tRoomMemberActions.SET_AS_OWNER,\\n\\tRoomMemberActions.SET_AS_MODERATOR,\\n];\\n\\nconst allowedRoomSettingsChangesInFederatedRooms: ValueOf<typeof RoomSettingsEnum>[] = [RoomSettingsEnum.NAME, RoomSettingsEnum.TOPIC];\\n\\nexport const actionAllowed = (\\n\\troom: Partial<IRoom>,\\n\\taction: ValueOf<typeof RoomMemberActions>,\\n\\tdisplayingUserId: IUser['_id'],\\n\\tuserSubscription?: ISubscription,\\n): boolean => {\\n\\tif (!isRoomFederated(room)) {\\n\\t\\treturn false;\\n\\t}\\n\\n\\tif (isDirectMessageRoom(room)) {\\n\\t\\treturn false;\\n\\t}\\n\\n\\tconst subscribed = Boolean(userSubscription);\\n\\tconst defaultUser = !userSubscription?.roles;\\n\\tif (!subscribed || defaultUser) {\\n\\t\\treturn false;\\n\\t}\\n\\n\\tconst myself = userSubscription.u?._id === displayingUserId;\\n\\tconst removingMyself = action === RoomMemberActions.REMOVE_USER && myself;\\n\\n\\tif (removingMyself) {\\n\\t\\treturn false;\\n\\t}\\n\\n\\tconst displayingUserRoomRoles = RoomRoles.findOne({ 'rid': room._id, 'u._id': displayingUserId })?.roles || [];\\n\\tconst loggedInUserRoomRoles = userSubscription.roles || [];\\n\\n\\tif (loggedInUserRoomRoles.includes('owner')) {\\n\\t\\tif (action === RoomMemberActions.SET_AS_OWNER || action === RoomMemberActions.SET_AS_MODERATOR) {\\n\\t\\t\\treturn displayingUserRoomRoles.includes('owner') ? myself : true;\\n\\t\\t}\\n\\n\\t\\tif (action === RoomMemberActions.REMOVE_USER) {\\n\\t\\t\\treturn !displayingUserRoomRoles.includes('owner');\\n\\t\\t}\\n\\t\\tconst allowedForOwnersOverDefaultUsers = allowedUserActionsInFederatedRooms.includes(action);\\n\\n\\t\\treturn allowedForOwnersOverDefaultUsers;\\n\\t}\\n\\n\\tif (loggedInUserRoomRoles.includes('moderator')) {\\n\\t\\tif (displayingUserRoomRoles.includes('owner')) {\\n\\t\\t\\treturn false;\\n\\t\\t}\\n\\n\\t\\tif (displayingUserRoomRoles.includes('moderator')) {\\n\\t\\t\\tif (action === RoomMemberActions.SET_AS_MODERATOR) {\\n\\t\\t\\t\\treturn myself;\\n\\t\\t\\t}\\n\\t\\t\\treturn false;\\n\\t\\t}\\n\\n\\t\\tconst allowedForModeratorsOverDefaultUsers = action === RoomMemberActions.SET_AS_MODERATOR || action === RoomMemberActions.REMOVE_USER;\\n\\n\\t\\treturn allowedForModeratorsOverDefaultUsers;\\n\\t}\\n\\n\\treturn false;\\n};\\n\\nexport const isEditableByTheUser = (user?: IUser, room?: IRoom, subscription?: ISubscription): boolean => {\\n\\tif (!user || !room || !subscription) {\\n\\t\\treturn false;\\n\\t}\\n\\treturn isRoomFederated(room) && Boolean(subscription.roles?.includes('owner') || subscription.roles?.includes('moderator'));\\n};\\n\\nexport const canCreateInviteLinks = (user?: IUser, room?: IRoom, subscription?: ISubscription): boolean => {\\n\\tif (!user || !room || !subscription) {\\n\\t\\treturn false;\\n\\t}\\n\\treturn (\\n\\t\\tisRoomFederated(room) &&\\n\\t\\tisPublicRoom(room) &&\\n\\t\\tBoolean(subscription.roles?.includes('owner') || subscription.roles?.includes('moderator'))\\n\\t);\\n};\\n\\nexport const isRoomSettingAllowed = (room: Partial<IRoom>, setting: ValueOf<typeof RoomSettingsEnum>): boolean => {\\n\\tif (!isRoomFederated(room)) {\\n\\t\\treturn false;\\n\\t}\\n\\n\\tif (isDirectMessageRoom(room)) {\\n\\t\\treturn false;\\n\\t}\\n\\treturn allowedRoomSettingsChangesInFederatedRooms.includes(setting);\\n};\\n\",null],\"names\":[\"isRoomFederated\",\"isDirectMessageRoom\",\"isPublicRoom\",\"RoomRoles\",\"RoomMemberActions\",\"RoomSettingsEnum\",\"module\",\"export\",\"actionAllowed\",\"isEditableByTheUser\",\"canCreateInviteLinks\",\"isRoomSettingAllowed\",\"link\",\"v\",\"allowedUserActionsInFederatedRooms\",\"REMOVE_USER\",\"SET_AS_OWNER\",\"SET_AS_MODERATOR\",\"allowedRoomSettingsChangesInFederatedRooms\",\"NAME\",\"TOPIC\",\"room\",\"action\",\"displayingUserId\",\"userSubscription\",\"_userSubscription$u\",\"_RoomRoles$findOne\",\"defaultUser\",\"roles\",\"Boolean\",\"myself\",\"u\",\"_id\",\"removingMyself\",\"displayingUserRoomRoles\",\"findOne\",\"loggedInUserRoomRoles\",\"includes\",\"allowedForOwnersOverDefaultUsers\",\"allowedForModeratorsOverDefaultUsers\",\"user\",\"subscription\",\"_subscription$roles\",\"_subscription$roles2\",\"_subscription$roles3\",\"_subscription$roles4\",\"setting\"],\"mappings\":\"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\"}"}