{"code":"function module(e,n,t){t.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){r=e}},0),t.link(\"meteor/ddp-common\",{DDPCommon:function(e){i=e}},0),t.link(\"meteor/meteor\",{Meteor:function(e){s=e}},1),t.link(\"meteor/tracker\",{Tracker:function(e){a=e}},2),t.link(\"../../app/utils/client/lib/SDKClient\",{sdk:function(e){l=e}},3);var o,r,i,s,a,l,c=[\"setUserStatus\",\"logout\"],u=function(e){var n,t=e.msg,o=e.method,r=e.params;return!!(\"method\"!==t||\"login\"===o&&null!==(n=r[0])&&void 0!==n&&n.resume||o.startsWith(\"UserPresence:\")||c.includes(o)||o.startsWith(\"stream-\"))};window.USE_REST_FOR_DDP_CALLS&&(s.connection._send=(o=s.connection._send,function(e){var n=this;if(u(e)){for(var t=arguments.length,c=Array(t>1?t-1:0),d=1;d<t;d++)c[d-1]=arguments[d];return o.call.apply(o,[this,e].concat(c))}var m=a.nonreactive(function(){return s.userId()?\"method.call\":\"method.callAnon\"}),f={message:i.stringifyDDP(r({},e))},h=function(t){n._methodInvokers[e.id]&&(n._livedata_data({msg:\"updated\",methods:[e.id]}),n.onMessage(t))},p=encodeURIComponent(e.method.replace(/\\//g,\":\"));l.rest.post(\"/v1/\"+m+\"/\"+p,f).then(function(n){var t=n.message;if(h(t),\"login\"===e.method){var o,r=i.parseDDP(t);null!==(o=r.result)&&void 0!==o&&o.token&&s.loginWithToken(r.result.token)}}).catch(function(e){console.error(e)})}))}","map":"{\"version\":3,\"sources\":[\"client/meteorOverrides/ddpOverREST.ts\",\"<anon>\"],\"sourcesContent\":[\"import { DDPCommon } from 'meteor/ddp-common';\\nimport { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\n\\nconst bypassMethods: string[] = ['setUserStatus', 'logout'];\\n\\nconst shouldBypass = ({ msg, method, params }: Meteor.IDDPMessage): boolean => {\\n\\tif (msg !== 'method') {\\n\\t\\treturn true;\\n\\t}\\n\\n\\tif (method === 'login' && params[0]?.resume) {\\n\\t\\treturn true;\\n\\t}\\n\\n\\tif (method.startsWith('UserPresence:') || bypassMethods.includes(method)) {\\n\\t\\treturn true;\\n\\t}\\n\\n\\tif (method.startsWith('stream-')) {\\n\\t\\treturn true;\\n\\t}\\n\\n\\treturn false;\\n};\\n\\nconst withDDPOverREST = (_send: (this: Meteor.IMeteorConnection, message: Meteor.IDDPMessage, ...args: unknown[]) => void) => {\\n\\treturn function _sendOverREST(this: Meteor.IMeteorConnection, message: Meteor.IDDPMessage, ...args: unknown[]): void {\\n\\t\\tif (shouldBypass(message)) {\\n\\t\\t\\treturn _send.call(this, message, ...args);\\n\\t\\t}\\n\\n\\t\\tconst endpoint = Tracker.nonreactive(() => (!Meteor.userId() ? 'method.callAnon' : 'method.call'));\\n\\n\\t\\tconst restParams = {\\n\\t\\t\\tmessage: DDPCommon.stringifyDDP({ ...message }),\\n\\t\\t};\\n\\n\\t\\tconst processResult = (_message: string): void => {\\n\\t\\t\\t// Prevent error on reconnections and method retry.\\n\\t\\t\\t// On those cases the API will be called 2 times but\\n\\t\\t\\t// the handler will be deleted after the first execution.\\n\\t\\t\\tif (!this._methodInvokers[message.id]) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\tthis._livedata_data({\\n\\t\\t\\t\\tmsg: 'updated',\\n\\t\\t\\t\\tmethods: [message.id],\\n\\t\\t\\t});\\n\\t\\t\\tthis.onMessage(_message);\\n\\t\\t};\\n\\n\\t\\tconst method = encodeURIComponent(message.method.replace(/\\\\//g, ':'));\\n\\n\\t\\tsdk.rest\\n\\t\\t\\t.post(`/v1/${endpoint}/${method}`, restParams)\\n\\t\\t\\t.then(({ message: _message }) => {\\n\\t\\t\\t\\tprocessResult(_message);\\n\\t\\t\\t\\tif (message.method === 'login') {\\n\\t\\t\\t\\t\\tconst parsedMessage = DDPCommon.parseDDP(_message) as { result?: { token?: string } };\\n\\t\\t\\t\\t\\tif (parsedMessage.result?.token) {\\n\\t\\t\\t\\t\\t\\tMeteor.loginWithToken(parsedMessage.result.token);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t})\\n\\t\\t\\t.catch((error) => {\\n\\t\\t\\t\\tconsole.error(error);\\n\\t\\t\\t});\\n\\t};\\n};\\n\\nif (window.USE_REST_FOR_DDP_CALLS) {\\n\\tMeteor.connection._send = withDDPOverREST(Meteor.connection._send);\\n}\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_objectSpread\",\"DDPCommon\",\"Meteor\",\"Tracker\",\"sdk\",\"_send\",\"bypassMethods\",\"shouldBypass\",\"_ref\",\"_params$\",\"msg\",\"method\",\"params\",\"resume\",\"startsWith\",\"includes\",\"window\",\"USE_REST_FOR_DDP_CALLS\",\"connection\",\"message\",\"_this\",\"_len\",\"arguments\",\"length\",\"args\",\"Array\",\"_key\",\"call\",\"apply\",\"concat\",\"endpoint\",\"nonreactive\",\"userId\",\"restParams\",\"stringifyDDP\",\"processResult\",\"_message\",\"_methodInvokers\",\"id\",\"_livedata_data\",\"methods\",\"onMessage\",\"encodeURIComponent\",\"replace\",\"rest\",\"post\",\"then\",\"_ref2\",\"_parsedMessage$result\",\"parsedMessage\",\"parseDDP\",\"result\",\"token\",\"loginWithToken\",\"catch\",\"error\",\"console\"],\"mappings\":\"uBAAkBA,EAAEC,IAAM,CAAA,uCAAoB,CAAAC,QAAA,SAAAC,CAAA,EAAAC,EAAAD,CAAA,CAAA,EAAA,GAArCH,EAAWC,IAAA,CAAM,oBAAoB,CAAAI,UAAA,SAAAF,CAAA,EAAAE,EAAAF,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,gBAAA,CAAAK,OAAA,SAAAH,CAAA,EAAAG,EAAAH,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,iBAAA,CAAAM,QAAA,SAAAJ,CAAA,EAAAI,EAAAJ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAO,IAAA,SAAAL,CAAA,EAAAK,EAAAL,CAAA,CAAA,EAAA,GAM9C,IAsByBM,EA5BzBL,EAAAC,EAA8CC,EAAAC,EAAAC,EAMxCE,EAA0B,CAAC,gBAAiB,SAAS,CAErDC,EAAe,SAAAC,CAAA,EAAyD,IAAAC,EAAtDC,EAAGF,EAAHE,GAAG,CAAEC,EAAMH,EAANG,MAAM,CAAEC,EAAMJ,EAANI,MAAM,UAC9B,WAARF,GAIAC,AAAW,UAAXA,GAAkB,AAAa,OAAbF,CAAAA,EAAIG,CAAM,CAAC,EAAE,AAAD,GAACH,AAAA,KAAA,IAAAA,GAATA,EAAWI,MAAM,EAIvCF,EAAOG,UAAU,CAAC,kBAAoBR,EAAcS,QAAQ,CAACJ,IAI7DA,EAAOG,UAAU,CAAC,WAKvB,CA+CIE,CAAAA,OAAOC,sBAAsB,EAChCf,CAAAA,EAAOgB,UAAU,CAACb,KAAK,EA9CCA,EA8CkBH,EAAOgB,UAAU,CAACb,KAAK,CA7C1D,SAAuDc,CAA2B,EAAoB,IAAAC,EAAA,IAAA,CAC5G,GAAIb,EAAaY,GAAU,CAAA,IAAA,IAAAE,EAAAC,UAAAC,MAAA,CADkEC,EAAe,AAAAC,MAAAJ,EAAA,EAAAA,EAAA,EAAA,GAAAK,EAAA,EAAAA,EAAAL,EAAAK,IAAfF,CAAe,CAAAE,EAAA,EAAA,CAAAJ,SAAA,CAAAI,EAAA,CAE3G,OAAOrB,EAAMsB,IAAI,CAAAC,KAAA,CAAVvB,EAAK,CAAM,IAAI,CAAEc,EAAO,CAAAU,MAAA,CAAKL,GACrC,CAEA,IAAMM,EAAW3B,EAAQ4B,WAAW,CAAC,WAAA,OAAO,AAAC7B,EAAO8B,MAAM,GAAyB,cAApB,iBAAiC,GAE1FC,EAAa,CAClBd,QAASlB,EAAUiC,YAAY,CAAAlC,EAAA,CAAA,EAAMmB,KAGhCgB,EAAgB,SAACC,CAAgB,EAIjChB,EAAKiB,eAAe,CAAClB,EAAQmB,EAAE,CAAC,GAGrClB,EAAKmB,cAAc,CAAC,CACnB7B,IAAK,UACL8B,QAAS,CAACrB,EAAQmB,EAAE,CAAA,GAErBlB,EAAKqB,SAAS,CAACL,GAChB,EAEMzB,EAAS+B,mBAAmBvB,EAAQR,MAAM,CAACgC,OAAO,CAAC,MAAO,MAEhEvC,EAAIwC,IAAI,CACNC,IAAI,CAAA,OAAQf,EAAQ,IAAInB,EAAUsB,GAClCa,IAAI,CAAC,SAAAC,CAAA,EAA0B,IAAdX,EAAQW,EAAjB5B,OAAO,CAEf,GADAgB,EAAcC,GACVjB,AAAmB,UAAnBA,EAAQR,MAAM,CAAc,CAC/B,IAD+BqC,EACzBC,EAAgBhD,EAAUiD,QAAQ,CAACd,EACjB,QAAxBY,CAAAA,EAAIC,EAAcE,MAAM,AAANA,GAAMH,AAAA,KAAA,IAAAA,GAApBA,EAAsBI,KAAK,EAC9BlD,EAAOmD,cAAc,CAACJ,EAAcE,MAAM,CAACC,KAAK,CAElD,CACD,GACCE,KAAK,CAAC,SAACC,CAAK,EACZC,QAAQD,KAAK,CAACA,EACf,EACF,EAIiE\"}"}