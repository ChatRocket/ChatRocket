{"code":"function module(t,e,n){n.export({useGetMore:function(){return l}}),n.link(\"react\",{useCallback:function(t){i=t}},0),n.link(\"../../../../../app/ui-utils/client\",{RoomHistoryManager:function(t){r=t}},1),n.link(\"../../../../../lib/utils/highOrderFunctions\",{withThrottling:function(t){o=t}},2);var i,r,o,l=function(t,e){return{innerRef:i(function(n){if(n){var i=0;n.addEventListener(\"scroll\",o({wait:100})(function(n){i=n.target.scrollTop;var o=n.target.clientHeight,l=r.isLoading(t),a=r.hasMore(t),c=r.hasMoreNext(t);(!1===l&&!0===a||!0===c)&&(!0===a&&i<=o/3?r.getMore(t):!0===c&&Math.ceil(i)>=n.target.scrollHeight-o&&(r.getMoreNext(t,e),e.current=!1))}))}},[e,t])}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/body/hooks/useGetMore.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { MutableRefObject } from 'react';\\nimport { useCallback } from 'react';\\n\\nimport { RoomHistoryManager } from '../../../../../app/ui-utils/client';\\nimport { withThrottling } from '../../../../../lib/utils/highOrderFunctions';\\n\\nexport const useGetMore = (rid: string, atBottomRef: MutableRefObject<boolean>) => {\\n\\treturn {\\n\\t\\tinnerRef: useCallback(\\n\\t\\t\\t(wrapper: HTMLElement | null) => {\\n\\t\\t\\t\\tif (!wrapper) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tlet lastScrollTopRef = 0;\\n\\n\\t\\t\\t\\twrapper.addEventListener(\\n\\t\\t\\t\\t\\t'scroll',\\n\\t\\t\\t\\t\\twithThrottling({ wait: 100 })((event) => {\\n\\t\\t\\t\\t\\t\\tlastScrollTopRef = event.target.scrollTop;\\n\\t\\t\\t\\t\\t\\tconst height = event.target.clientHeight;\\n\\t\\t\\t\\t\\t\\tconst isLoading = RoomHistoryManager.isLoading(rid);\\n\\t\\t\\t\\t\\t\\tconst hasMore = RoomHistoryManager.hasMore(rid);\\n\\t\\t\\t\\t\\t\\tconst hasMoreNext = RoomHistoryManager.hasMoreNext(rid);\\n\\n\\t\\t\\t\\t\\t\\tif ((isLoading === false && hasMore === true) || hasMoreNext === true) {\\n\\t\\t\\t\\t\\t\\t\\tif (hasMore === true && lastScrollTopRef <= height / 3) {\\n\\t\\t\\t\\t\\t\\t\\t\\tRoomHistoryManager.getMore(rid);\\n\\t\\t\\t\\t\\t\\t\\t} else if (hasMoreNext === true && Math.ceil(lastScrollTopRef) >= event.target.scrollHeight - height) {\\n\\t\\t\\t\\t\\t\\t\\t\\tRoomHistoryManager.getMoreNext(rid, atBottomRef);\\n\\t\\t\\t\\t\\t\\t\\t\\tatBottomRef.current = false;\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t}),\\n\\t\\t\\t\\t);\\n\\t\\t\\t},\\n\\t\\t\\t[atBottomRef, rid],\\n\\t\\t),\\n\\t};\\n};\\n\",null],\"names\":[\"module\",\"export\",\"useGetMore\",\"link\",\"useCallback\",\"v\",\"RoomHistoryManager\",\"withThrottling\",\"rid\",\"atBottomRef\",\"innerRef\",\"wrapper\",\"lastScrollTopRef\",\"addEventListener\",\"wait\",\"event\",\"target\",\"scrollTop\",\"height\",\"clientHeight\",\"isLoading\",\"hasMore\",\"hasMoreNext\",\"getMore\",\"Math\",\"ceil\",\"scrollHeight\",\"getMoreNext\",\"current\"],\"mappings\":\"uBACAA,EAAOC,MAAE,CAAA,CAAAC,WAAa,WAAc,OAAAA,CAAA,CAAA,GAAAF,EAAAG,IAAA,CAAA,QAAA,CAAAC,YAAA,SAAAC,CAAA,EAAAD,EAAAC,CAAA,CAAA,EAAA,GAAAL,EAAAG,IAAA,CAAA,qCAAA,CAAAG,mBAAA,SAAAD,CAAA,EAAAC,EAAAD,CAAA,CAAA,EAAA,GAAAL,EAAAG,IAAA,CAAA,8CAAA,CAAAI,eAAA,SAAAF,CAAA,EAAAE,EAAAF,CAAA,CAAA,EAAA,GAK7B,IAL6BD,EAAAE,EAAAC,EAKvBL,EAAa,SAACM,CAAW,CAAEC,CAAsC,EAC7E,MAAO,CACNC,SAAUN,EACT,SAACO,CAA2B,EAC3B,GAAKA,GAIL,IAAIC,EAAmB,EAEvBD,EAAQE,gBAAgB,CACvB,SACAN,EAAe,CAAEO,KAAM,GAAG,GAAI,SAACC,CAAK,EACnCH,EAAmBG,EAAMC,MAAM,CAACC,SAAS,CACzC,IAAMC,EAASH,EAAMC,MAAM,CAACG,YAAY,CAClCC,EAAYd,EAAmBc,SAAS,CAACZ,GACzCa,EAAUf,EAAmBe,OAAO,CAACb,GACrCc,EAAchB,EAAmBgB,WAAW,CAACd,GAE9CY,CAAAA,AAAc,CAAA,IAAdA,GAAuBC,AAAY,CAAA,IAAZA,GAAqBC,AAAgB,CAAA,IAAhBA,CAAgB,IAC5DD,AAAY,CAAA,IAAZA,GAAoBT,GAAoBM,EAAS,EACpDZ,EAAmBiB,OAAO,CAACf,GACD,CAAA,IAAhBc,GAAwBE,KAAKC,IAAI,CAACb,IAAqBG,EAAMC,MAAM,CAACU,YAAY,CAAGR,IAC7FZ,EAAmBqB,WAAW,CAACnB,EAAKC,GACpCA,EAAYmB,OAAO,CAAG,CAAA,GAGzB,IAEF,EACA,CAACnB,EAAaD,EAAI,EAGrB\"}"}