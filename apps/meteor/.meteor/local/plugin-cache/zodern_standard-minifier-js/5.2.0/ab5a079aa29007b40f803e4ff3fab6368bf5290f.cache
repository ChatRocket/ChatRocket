{"code":"function module(e,n,t){t.link(\"@babel/runtime/regenerator\",{default:function(e){o=e}},0),t.export({processTooLongMessage:function(){return u}}),t.link(\"../../../../app/settings/client\",{settings:function(e){r=e}},0),t.link(\"../../../../app/utils/lib/i18n\",{t:function(e){a=e}},1),t.link(\"../../../components/GenericModal\",{default:function(e){s=e}},2),t.link(\"../../imperativeModal\",{imperativeModal:function(e){i=e}},3),t.link(\"../../toast\",{dispatchToastMessage:function(e){l=e}},4);var o,r,a,s,i,l,u=function(e,n){var t,u,c,p,d;return o.async(function(f){for(;;)switch(f.prev=f.next){case 0:if(t=n.msg,u=r.get(\"Message_MaxAllowedSize\"),!(t.length<=u)){f.next=4;break}return f.abrupt(\"return\",!1);case 4:if(c=r.get(\"FileUpload_Enabled\"),p=r.get(\"Message_AllowConvertLongMessagesToAttachment\"),!(e.currentEditing||!c||!p)){f.next=10;break}return l({type:\"error\",message:Error(a(\"Message_too_long\"))}),null===(d=e.composer)||void 0===d||d.setText(t),f.abrupt(\"return\",!0);case 10:return f.next=12,o.awrap(new Promise(function(n){var r=function r(){var r,a,s,l,u,c;return o.async(function p(p){for(;;)switch(p.prev=p.next){case 0:return s=\"text/plain\",l=new Blob([t],{type:s}),u=(null!==(r=null===(a=Meteor.user())||void 0===a?void 0:a.username)&&void 0!==r?r:\"anonymous\")+\" - \"+new Date+\".txt\",c=new File([l],u,{type:s,lastModified:Date.now()}),i.close(),p.next=7,o.awrap(e.flows.uploadFiles([c]));case 7:n();case 8:case\"end\":return p.stop()}},null,null,null,Promise)},l=function(){var o;null===(o=e.composer)||void 0===o||o.setText(t),i.close(),n()};i.open({component:s,props:{title:a(\"Message_too_long\"),children:a(\"Send_it_as_attachment_instead_question\"),onConfirm:r,onClose:l,onCancel:l,variant:\"warning\"}})}));case 12:return f.abrupt(\"return\",!0);case 13:case\"end\":return f.stop()}},null,null,null,Promise)}}","map":"{\"version\":3,\"sources\":[\"client/lib/chats/flows/processTooLongMessage.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IMessage } from '@rocket.chat/core-typings';\\n\\nimport { settings } from '../../../../app/settings/client';\\nimport { t } from '../../../../app/utils/lib/i18n';\\nimport GenericModal from '../../../components/GenericModal';\\nimport { imperativeModal } from '../../imperativeModal';\\nimport { dispatchToastMessage } from '../../toast';\\nimport type { ChatAPI } from '../ChatAPI';\\n\\nexport const processTooLongMessage = async (chat: ChatAPI, { msg }: Pick<IMessage, 'msg'>): Promise<boolean> => {\\n\\tconst maxAllowedSize = settings.get('Message_MaxAllowedSize');\\n\\n\\tif (msg.length <= maxAllowedSize) {\\n\\t\\treturn false;\\n\\t}\\n\\tconst fileUploadsEnabled = settings.get('FileUpload_Enabled');\\n\\tconst convertLongMessagesToAttachment = settings.get('Message_AllowConvertLongMessagesToAttachment');\\n\\n\\tif (chat.currentEditing || !fileUploadsEnabled || !convertLongMessagesToAttachment) {\\n\\t\\tdispatchToastMessage({ type: 'error', message: new Error(t('Message_too_long')) });\\n\\t\\tchat.composer?.setText(msg);\\n\\t\\treturn true;\\n\\t}\\n\\n\\tawait new Promise<void>((resolve) => {\\n\\t\\tconst onConfirm = async (): Promise<void> => {\\n\\t\\t\\tconst contentType = 'text/plain';\\n\\t\\t\\tconst messageBlob = new Blob([msg], { type: contentType });\\n\\t\\t\\tconst fileName = `${Meteor.user()?.username ?? 'anonymous'} - ${new Date()}.txt`; // TODO: proper naming and formatting\\n\\t\\t\\tconst file = new File([messageBlob], fileName, {\\n\\t\\t\\t\\ttype: contentType,\\n\\t\\t\\t\\tlastModified: Date.now(),\\n\\t\\t\\t});\\n\\n\\t\\t\\timperativeModal.close();\\n\\t\\t\\tawait chat.flows.uploadFiles([file]);\\n\\n\\t\\t\\tresolve();\\n\\t\\t};\\n\\n\\t\\tconst onClose = (): void => {\\n\\t\\t\\tchat.composer?.setText(msg);\\n\\n\\t\\t\\timperativeModal.close();\\n\\t\\t\\tresolve();\\n\\t\\t};\\n\\n\\t\\timperativeModal.open({\\n\\t\\t\\tcomponent: GenericModal,\\n\\t\\t\\tprops: {\\n\\t\\t\\t\\ttitle: t('Message_too_long'),\\n\\t\\t\\t\\tchildren: t('Send_it_as_attachment_instead_question'),\\n\\t\\t\\t\\tonConfirm,\\n\\t\\t\\t\\tonClose,\\n\\t\\t\\t\\tonCancel: onClose,\\n\\t\\t\\t\\tvariant: 'warning',\\n\\t\\t\\t},\\n\\t\\t});\\n\\t});\\n\\n\\treturn true;\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"export\",\"processTooLongMessage\",\"settings\",\"t\",\"GenericModal\",\"imperativeModal\",\"dispatchToastMessage\",\"chat\",\"_ref\",\"msg\",\"maxAllowedSize\",\"fileUploadsEnabled\",\"convertLongMessagesToAttachment\",\"_chat$composer\",\"async\",\"_context2\",\"prev\",\"next\",\"get\",\"length\",\"abrupt\",\"currentEditing\",\"type\",\"message\",\"Error\",\"composer\",\"setText\",\"awrap\",\"Promise\",\"resolve\",\"onConfirm\",\"_callee\",\"_Meteor$user$username\",\"_Meteor$user\",\"contentType\",\"messageBlob\",\"fileName\",\"file\",\"_callee$\",\"_context\",\"Blob\",\"Meteor\",\"user\",\"username\",\"Date\",\"File\",\"lastModified\",\"now\",\"close\",\"flows\",\"uploadFiles\",\"stop\",\"onClose\",\"_chat$composer2\",\"open\",\"component\",\"props\",\"title\",\"children\",\"onCancel\",\"variant\"],\"mappings\":\"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\"}"}