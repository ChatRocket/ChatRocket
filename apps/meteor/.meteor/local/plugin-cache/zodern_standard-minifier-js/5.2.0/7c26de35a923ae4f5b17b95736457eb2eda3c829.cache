{"code":"function module(e,t,r){let s,i,l,a,o,n,c,u;r.export({useHasNewMessages:()=>d}),r.link(\"@rocket.chat/core-typings\",{isEditedMessage(e){s=e}},0),r.link(\"react\",{useCallback(e){i=e},useEffect(e){l=e},useState(e){a=e}},1),r.link(\"../../../../../app/ui-utils/client\",{RoomHistoryManager(e){o=e}},2),r.link(\"../../../../../lib/callbacks\",{callbacks(e){n=e}},3),r.link(\"../../../../../lib/utils/highOrderFunctions\",{withThrottling(e){c=e}},4),r.link(\"../../contexts/ChatContext\",{useChat(e){u=e}},5);let d=(e,t,r,d)=>{let{sendToBottom:g,sendToBottomIfNecessary:k,isAtBottom:p}=d,f=u();if(!f)throw Error(\"No ChatContext provided\");let[h,m]=a(!1),M=i(()=>{var e;r.current=!0,k(),m(!1),null===(e=f.composer)||void 0===e||e.focus()},[r,f.composer,k]),w=i(()=>{r.current=!0,o.clear(e),o.getMoreIfIsEmpty(e)},[r,e]),v=i(()=>{k(),m(!1)},[k]);l(()=>(n.add(\"streamNewMessage\",r=>{if(!(e!==r.rid||s(r))&&!r.tmid){if(r.u._id===t){g(),m(!1);return}p()||m(!0)}},n.priority.MEDIUM,e),()=>{n.remove(\"streamNewMessage\",e)}),[p,e,g,t]);let C=i(e=>{e&&e.addEventListener(\"scroll\",c({wait:100})(()=>{r.current&&m(!1)}),{passive:!0})},[r]);return{newMessagesScrollRef:C,handleNewMessageButtonClick:M,handleJumpToRecentButtonClick:w,handleComposerResize:v,hasNewMessages:h}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/body/hooks/useHasNewMessages.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IMessage } from '@rocket.chat/core-typings';\\nimport { isEditedMessage } from '@rocket.chat/core-typings';\\nimport type { MutableRefObject } from 'react';\\nimport { useCallback, useEffect, useState } from 'react';\\n\\nimport { RoomHistoryManager } from '../../../../../app/ui-utils/client';\\nimport { callbacks } from '../../../../../lib/callbacks';\\nimport { withThrottling } from '../../../../../lib/utils/highOrderFunctions';\\nimport { useChat } from '../../contexts/ChatContext';\\n\\nexport const useHasNewMessages = (\\n\\trid: string,\\n\\tuid: string | undefined,\\n\\tatBottomRef: MutableRefObject<boolean>,\\n\\t{\\n\\t\\tsendToBottom,\\n\\t\\tsendToBottomIfNecessary,\\n\\t\\tisAtBottom,\\n\\t}: {\\n\\t\\tsendToBottom: () => void;\\n\\t\\tsendToBottomIfNecessary: () => void;\\n\\t\\tisAtBottom: (threshold?: number) => boolean;\\n\\t},\\n) => {\\n\\tconst chat = useChat();\\n\\n\\tif (!chat) {\\n\\t\\tthrow new Error('No ChatContext provided');\\n\\t}\\n\\n\\tconst [hasNewMessages, setHasNewMessages] = useState(false);\\n\\n\\tconst handleNewMessageButtonClick = useCallback(() => {\\n\\t\\tatBottomRef.current = true;\\n\\t\\tsendToBottomIfNecessary();\\n\\t\\tsetHasNewMessages(false);\\n\\t\\tchat.composer?.focus();\\n\\t}, [atBottomRef, chat.composer, sendToBottomIfNecessary]);\\n\\n\\tconst handleJumpToRecentButtonClick = useCallback(() => {\\n\\t\\tatBottomRef.current = true;\\n\\t\\tRoomHistoryManager.clear(rid);\\n\\t\\tRoomHistoryManager.getMoreIfIsEmpty(rid);\\n\\t}, [atBottomRef, rid]);\\n\\n\\tconst handleComposerResize = useCallback((): void => {\\n\\t\\tsendToBottomIfNecessary();\\n\\t\\tsetHasNewMessages(false);\\n\\t}, [sendToBottomIfNecessary]);\\n\\n\\tuseEffect(() => {\\n\\t\\tcallbacks.add(\\n\\t\\t\\t'streamNewMessage',\\n\\t\\t\\t(msg: IMessage) => {\\n\\t\\t\\t\\tif (rid !== msg.rid || isEditedMessage(msg) || msg.tmid) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (msg.u._id === uid) {\\n\\t\\t\\t\\t\\tsendToBottom();\\n\\t\\t\\t\\t\\tsetHasNewMessages(false);\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (!isAtBottom()) {\\n\\t\\t\\t\\t\\tsetHasNewMessages(true);\\n\\t\\t\\t\\t}\\n\\t\\t\\t},\\n\\t\\t\\tcallbacks.priority.MEDIUM,\\n\\t\\t\\trid,\\n\\t\\t);\\n\\n\\t\\treturn () => {\\n\\t\\t\\tcallbacks.remove('streamNewMessage', rid);\\n\\t\\t};\\n\\t}, [isAtBottom, rid, sendToBottom, uid]);\\n\\n\\tconst ref = useCallback(\\n\\t\\t(node: HTMLElement | null) => {\\n\\t\\t\\tif (!node) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tnode.addEventListener(\\n\\t\\t\\t\\t'scroll',\\n\\t\\t\\t\\twithThrottling({ wait: 100 })(() => {\\n\\t\\t\\t\\t\\tatBottomRef.current && setHasNewMessages(false);\\n\\t\\t\\t\\t}),\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\tpassive: true,\\n\\t\\t\\t\\t},\\n\\t\\t\\t);\\n\\t\\t},\\n\\t\\t[atBottomRef],\\n\\t);\\n\\n\\treturn {\\n\\t\\tnewMessagesScrollRef: ref,\\n\\t\\thandleNewMessageButtonClick,\\n\\t\\thandleJumpToRecentButtonClick,\\n\\t\\thandleComposerResize,\\n\\t\\thasNewMessages,\\n\\t};\\n};\\n\",null],\"names\":[\"isEditedMessage\",\"useCallback\",\"useEffect\",\"useState\",\"RoomHistoryManager\",\"callbacks\",\"withThrottling\",\"useChat\",\"module\",\"export\",\"useHasNewMessages\",\"link\",\"v\",\"rid\",\"uid\",\"atBottomRef\",\"_ref\",\"sendToBottom\",\"sendToBottomIfNecessary\",\"isAtBottom\",\"chat\",\"Error\",\"hasNewMessages\",\"setHasNewMessages\",\"handleNewMessageButtonClick\",\"_chat$composer\",\"current\",\"composer\",\"focus\",\"handleJumpToRecentButtonClick\",\"clear\",\"getMoreIfIsEmpty\",\"handleComposerResize\",\"add\",\"msg\",\"tmid\",\"u\",\"_id\",\"priority\",\"MEDIUM\",\"remove\",\"ref\",\"node\",\"addEventListener\",\"wait\",\"passive\",\"newMessagesScrollRef\"],\"mappings\":\"2BAC4DA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA5DC,EAAOC,MAAE,CAAA,CAAAC,kBAAuBA,IAAAA,CAAA,GAA4BF,EAAAG,IAAA,CAAA,4BAAA,CAAAX,gBAAAY,CAAA,EAAAZ,EAAAY,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,QAAA,CAAAV,YAAAW,CAAA,EAAAX,EAAAW,CAAA,EAAAV,UAAAU,CAAA,EAAAV,EAAAU,CAAA,EAAAT,SAAAS,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,qCAAA,CAAAP,mBAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,+BAAA,CAAAN,UAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,8CAAA,CAAAL,eAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,6BAAA,CAAAJ,QAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GASrD,IAAMF,EAAoBA,CAChCG,EACAC,EACAC,EAAsCC,KAUnC,GATH,CACCC,aAAAA,CAAY,CACZC,wBAAAA,CAAuB,CACvBC,WAAAA,CAAAA,CAKA,CAAAH,EAEKI,EAAOb,IAEb,GAAI,CAACa,EACJ,MAAM,AAAIC,MAAM,2BAGjB,GAAM,CAACC,EAAgBC,EAAkB,CAAGpB,EAAS,CAAA,GAE/CqB,EAA8BvB,EAAY,KAAK,IAAAwB,CACpDV,CAAAA,EAAYW,OAAO,CAAG,CAAA,EACtBR,IACAK,EAAkB,CAAA,GAClB,AAAa,OAAbE,CAAAA,EAAAL,EAAKO,QAAQ,AAARA,GAAQF,AAAA,KAAA,IAAAA,GAAbA,EAAeG,KAAK,EACrB,EAAG,CAACb,EAAaK,EAAKO,QAAQ,CAAET,EAAwB,EAElDW,EAAgC5B,EAAY,KACjDc,EAAYW,OAAO,CAAG,CAAA,EACtBtB,EAAmB0B,KAAK,CAACjB,GACzBT,EAAmB2B,gBAAgB,CAAClB,EACrC,EAAG,CAACE,EAAaF,EAAI,EAEfmB,EAAuB/B,EAAY,KACxCiB,IACAK,EAAkB,CAAA,EACnB,EAAG,CAACL,EAAwB,EAE5BhB,EAAU,KACTG,EAAU4B,GAAG,CACZ,mBACCC,IACA,GAAIrB,CAAAA,CAAAA,IAAQqB,EAAIrB,GAAG,EAAIb,EAAgBkC,EAAG,IAAKA,EAAIC,IAAI,EAIvD,GAAID,EAAIE,CAAC,CAACC,GAAG,GAAKvB,EAAK,CACtBG,IACAM,EAAkB,CAAA,GAClB,MACD,CAEKJ,KACJI,EAAkB,CAAA,GAEpB,EACAlB,EAAUiC,QAAQ,CAACC,MAAM,CACzB1B,GAGM,KACNR,EAAUmC,MAAM,CAAC,mBAAoB3B,EACtC,GACE,CAACM,EAAYN,EAAKI,EAAcH,EAAI,EAEvC,IAAM2B,EAAMxC,EACVyC,IACKA,GAILA,EAAKC,gBAAgB,CACpB,SACArC,EAAe,CAAEsC,KAAM,GAAG,GAAI,KAC7B7B,EAAYW,OAAO,EAAIH,EAAkB,CAAA,EAC1C,GACA,CACCsB,QAAS,CAAA,GAGZ,EACA,CAAC9B,EAAY,EAGd,MAAO,CACN+B,qBAAsBL,EACtBjB,4BAAAA,EACAK,8BAAAA,EACAG,qBAAAA,EACAV,eAAAA,EAEF\"}"}