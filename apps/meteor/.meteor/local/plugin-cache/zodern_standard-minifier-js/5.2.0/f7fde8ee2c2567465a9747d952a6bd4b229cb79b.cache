{"code":"function module(e,n,t){t.link(\"@babel/runtime/regenerator\",{default:function(e){r=e}},0),t.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){o=e}},1),t.export({useAddUserAction:function(){return x}}),t.link(\"@rocket.chat/core-typings\",{isRoomFederated:function(e){s=e}},0),t.link(\"@rocket.chat/fuselage-hooks\",{useEffectEvent:function(e){i=e}},1),t.link(\"@rocket.chat/ui-contexts\",{useTranslation:function(e){u=e},useUser:function(e){a=e},useUserRoom:function(e){c=e},useUserSubscription:function(e){d=e},useToastMessageDispatch:function(e){l=e},useAtLeastOnePermission:function(e){f=e},useEndpoint:function(e){m=e}},2),t.link(\"react\",{useMemo:function(e){p=e}},3),t.link(\"../../../../../lib/federation/Federation\",{\"*\":function(e){v=e}},4),t.link(\"../../../contextualBar/RoomMembers/AddUsers/AddMatrixUsers/useAddMatrixUsers\",{useAddMatrixUsers:function(e){k=e}},5),t.link(\"../../../lib/getRoomDirectives\",{getRoomDirectives:function(e){h=e}},6);var r,o,s,i,u,a,c,d,l,f,m,p,v,k,h,b={c:\"/v1/channels.invite\",p:\"/v1/groups.invite\"},x=function(e,n,t){var x=u(),g=c(n),U=a(),y=d(n),A=l(),w=e.username,M=e._id;if(!g)throw Error(\"Room not provided\");var R=f(p(function(){return[(null==g?void 0:g.t)===\"p\"?\"add-user-to-any-p-room\":\"add-user-to-any-c-room\",\"add-user-to-joined-room\"]},[null==g?void 0:g.t]),n),E=g&&e&&s(g)?v.isEditableByTheUser(U||void 0,g,y):R,T=h({room:g,showingUserId:M,userSubscription:y}).roomCanInvite,P=m(\"POST\",b[\"p\"===g.t?\"p\":\"c\"]),S=i(function(e){var s,i;return r.async(function(u){for(;;)switch(u.prev=u.next){case 0:return s=e.users,i=o(s,1)[0],u.next=4,r.awrap(P({roomId:n,username:i}));case 4:null==t||t();case 5:case\"end\":return u.stop()}},null,null,null,Promise)}),D=k(),I=i(function(){var e;return r.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,e=[w],!s(g)){n.next=6;break}D.mutate({users:e,handleSave:S}),n.next=8;break;case 6:return n.next=8,r.awrap(S({users:e}));case 8:A({type:\"success\",message:x(\"User_added\")}),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(0),A({type:\"error\",message:n.t0});case 14:case\"end\":return n.stop()}},null,null,[[0,11]],Promise)});return p(function(){return T&&E&&!0!==g.archived?{content:x(\"add-to-room\"),icon:\"user-plus\",onClick:I,type:\"management\"}:void 0},[T,E,g.archived,x,I])}}","map":"{\"version\":3,\"sources\":[\"client/views/room/hooks/useUserInfoActions/actions/useAddUserAction.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom, IUser } from '@rocket.chat/core-typings';\\nimport { isRoomFederated } from '@rocket.chat/core-typings';\\nimport { useEffectEvent } from '@rocket.chat/fuselage-hooks';\\nimport {\\n\\tuseTranslation,\\n\\tuseUser,\\n\\tuseUserRoom,\\n\\tuseUserSubscription,\\n\\tuseToastMessageDispatch,\\n\\tuseAtLeastOnePermission,\\n\\tuseEndpoint,\\n} from '@rocket.chat/ui-contexts';\\nimport { useMemo } from 'react';\\n\\nimport * as Federation from '../../../../../lib/federation/Federation';\\nimport { useAddMatrixUsers } from '../../../contextualBar/RoomMembers/AddUsers/AddMatrixUsers/useAddMatrixUsers';\\nimport { getRoomDirectives } from '../../../lib/getRoomDirectives';\\nimport type { UserInfoAction } from '../useUserInfoActions';\\n\\nconst inviteUserEndpoints = {\\n\\tc: '/v1/channels.invite',\\n\\tp: '/v1/groups.invite',\\n} as const;\\n\\nexport const useAddUserAction = (\\n\\tuser: Pick<IUser, '_id' | 'username'>,\\n\\trid: IRoom['_id'],\\n\\treload?: () => void,\\n): UserInfoAction | undefined => {\\n\\tconst t = useTranslation();\\n\\tconst room = useUserRoom(rid);\\n\\tconst currentUser = useUser();\\n\\tconst subscription = useUserSubscription(rid);\\n\\tconst dispatchToastMessage = useToastMessageDispatch();\\n\\n\\tconst { username, _id: uid } = user;\\n\\n\\tif (!room) {\\n\\t\\tthrow Error('Room not provided');\\n\\t}\\n\\n\\tconst hasPermissionToAddUsers = useAtLeastOnePermission(\\n\\t\\tuseMemo(() => [room?.t === 'p' ? 'add-user-to-any-p-room' : 'add-user-to-any-c-room', 'add-user-to-joined-room'], [room?.t]),\\n\\t\\trid,\\n\\t);\\n\\n\\tconst userCanAdd =\\n\\t\\troom && user && isRoomFederated(room)\\n\\t\\t\\t? Federation.isEditableByTheUser(currentUser || undefined, room, subscription)\\n\\t\\t\\t: hasPermissionToAddUsers;\\n\\n\\tconst { roomCanInvite } = getRoomDirectives({ room, showingUserId: uid, userSubscription: subscription });\\n\\n\\tconst inviteUser = useEndpoint('POST', inviteUserEndpoints[room.t === 'p' ? 'p' : 'c']);\\n\\n\\tconst handleAddUser = useEffectEvent(async ({ users }) => {\\n\\t\\tconst [username] = users;\\n\\t\\tawait inviteUser({ roomId: rid, username });\\n\\t\\treload?.();\\n\\t});\\n\\n\\tconst addClickHandler = useAddMatrixUsers();\\n\\n\\tconst addUserOptionAction = useEffectEvent(async () => {\\n\\t\\ttry {\\n\\t\\t\\tconst users = [username as string];\\n\\t\\t\\tif (isRoomFederated(room)) {\\n\\t\\t\\t\\taddClickHandler.mutate({\\n\\t\\t\\t\\t\\tusers,\\n\\t\\t\\t\\t\\thandleSave: handleAddUser,\\n\\t\\t\\t\\t});\\n\\t\\t\\t} else {\\n\\t\\t\\t\\tawait handleAddUser({ users });\\n\\t\\t\\t}\\n\\t\\t\\tdispatchToastMessage({ type: 'success', message: t('User_added') });\\n\\t\\t} catch (error) {\\n\\t\\t\\tdispatchToastMessage({ type: 'error', message: error as Error });\\n\\t\\t}\\n\\t});\\n\\n\\tconst addUserOption = useMemo(\\n\\t\\t() =>\\n\\t\\t\\troomCanInvite && userCanAdd && room.archived !== true\\n\\t\\t\\t\\t? {\\n\\t\\t\\t\\t\\t\\tcontent: t('add-to-room'),\\n\\t\\t\\t\\t\\t\\ticon: 'user-plus' as const,\\n\\t\\t\\t\\t\\t\\tonClick: addUserOptionAction,\\n\\t\\t\\t\\t\\t\\ttype: 'management' as const,\\n\\t\\t\\t\\t  }\\n\\t\\t\\t\\t: undefined,\\n\\t\\t[roomCanInvite, userCanAdd, room.archived, t, addUserOptionAction],\\n\\t);\\n\\n\\treturn addUserOption;\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"_slicedToArray\",\"export\",\"useAddUserAction\",\"isRoomFederated\",\"useEffectEvent\",\"useTranslation\",\"useUser\",\"useUserRoom\",\"useUserSubscription\",\"useToastMessageDispatch\",\"useAtLeastOnePermission\",\"useEndpoint\",\"useMemo\",\"Federation\",\"useAddMatrixUsers\",\"getRoomDirectives\",\"inviteUserEndpoints\",\"c\",\"p\",\"user\",\"rid\",\"reload\",\"t\",\"room\",\"currentUser\",\"subscription\",\"dispatchToastMessage\",\"username\",\"uid\",\"_id\",\"Error\",\"hasPermissionToAddUsers\",\"userCanAdd\",\"isEditableByTheUser\",\"undefined\",\"roomCanInvite\",\"_getRoomDirectives\",\"showingUserId\",\"userSubscription\",\"inviteUser\",\"handleAddUser\",\"_ref\",\"users\",\"async\",\"_context\",\"prev\",\"next\",\"_users\",\"awrap\",\"roomId\",\"stop\",\"Promise\",\"addClickHandler\",\"addUserOptionAction\",\"_context2\",\"mutate\",\"handleSave\",\"type\",\"message\",\"t0\",\"archived\",\"content\",\"icon\",\"onClick\"],\"mappings\":\"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\"}"}