{"code":"function module(e,o,n){let r,i,s,t,a,l,_,c,m,u,d,g,k,p,v,w,h;n.export({useChangeOwnerAction:()=>f}),n.link(\"@rocket.chat/core-typings\",{isRoomFederated(e){r=e}},0),n.link(\"@rocket.chat/fuselage-hooks\",{useMutableCallback(e){i=e}},1),n.link(\"@rocket.chat/string-helpers\",{escapeHTML(e){s=e}},2),n.link(\"@rocket.chat/ui-contexts\",{useTranslation(e){t=e},usePermission(e){a=e},useUserRoom(e){l=e},useUserSubscription(e){_=e},useSetModal(e){c=e},useUser(e){m=e}},3),n.link(\"react\",{default(e){u=e},useCallback(e){d=e},useMemo(e){g=e}},4),n.link(\"../../../../../components/GenericModal\",{default(e){k=e}},5),n.link(\"../../../../../hooks/useEndpointAction\",{useEndpointAction(e){p=e}},6),n.link(\"../../../../../lib/rooms/roomCoordinator\",{roomCoordinator(e){v=e}},7),n.link(\"../../../lib/getRoomDirectives\",{getRoomDirectives(e){w=e}},8),n.link(\"../../useUserHasRoomRole\",{useUserHasRoomRole(e){h=e}},9);let R=(e,o,n,r,i)=>u.createElement(k,{variant:\"warning\",onClose:e,onConfirm:o,onCancel:e,title:n,confirmText:r},i),f=(e,o)=>{let n=t(),u=l(o),{_id:k}=e,f=a(\"set-owner\",o),C=h(k,o,\"owner\"),I=_(o),M=c(),{_id:U=\"\"}=m()||{},b=h(U,o,\"owner\"),x=d(()=>M(null),[M]);if(!u)throw Error(\"Room not provided\");let{roomCanSetOwner:E}=w({room:u,showingUserId:k,userSubscription:I}),F=(null==u?void 0:u.t)&&s(v.getRoomName(u.t,u)),O=\"p\"===u.t?\"/v1/groups\":\"/v1/channels\",S=C?\"removeOwner\":\"addOwner\",T=C?\"User__username__removed_from__room_name__owners\":\"User__username__is_now_an_owner_of__room_name_\",y=p(\"POST\",\"\".concat(O,\".\").concat(S),{successMessage:n(T,{username:e.username,room_name:F})}),A=d(()=>{y({roomId:o,userId:k}),x()},[y,o,k,x]),H=d(e=>{let{userId:i}=e;if(!r(u))return y({roomId:o,userId:k});let s=i===U;return s&&b?M(()=>R(x,A,n(\"Federation_Matrix_losing_privileges\"),n(\"Yes_continue\"),n(\"Federation_Matrix_losing_privileges_warning\"))):!s&&b?M(()=>R(x,A,n(\"Warning\"),n(\"Yes_continue\"),n(\"Federation_Matrix_giving_same_permission_warning\"))):void y({roomId:o,userId:k})},[M,U,b,n,o,k,y,x,A,u]),D=i(async()=>H({roomId:o,userId:k})),P=g(()=>r(u)&&E||!r(u)&&E&&f?{content:n(C?\"Remove_as_owner\":\"Set_as_owner\"),icon:\"shield-check\",onClick:D,type:\"privileges\"}:void 0,[D,E,f,C,n,u]);return P}}","map":"{\"version\":3,\"sources\":[\"client/views/room/hooks/useUserInfoActions/actions/useChangeOwnerAction.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom, IUser } from '@rocket.chat/core-typings';\\nimport { isRoomFederated } from '@rocket.chat/core-typings';\\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\\nimport { escapeHTML } from '@rocket.chat/string-helpers';\\nimport { useTranslation, usePermission, useUserRoom, useUserSubscription, useSetModal, useUser } from '@rocket.chat/ui-contexts';\\nimport type { ReactElement } from 'react';\\nimport React, { useCallback, useMemo } from 'react';\\n\\nimport GenericModal from '../../../../../components/GenericModal';\\nimport { useEndpointAction } from '../../../../../hooks/useEndpointAction';\\nimport { roomCoordinator } from '../../../../../lib/rooms/roomCoordinator';\\nimport { getRoomDirectives } from '../../../lib/getRoomDirectives';\\nimport { useUserHasRoomRole } from '../../useUserHasRoomRole';\\nimport type { UserInfoAction, UserInfoActionType } from '../useUserInfoActions';\\n\\nconst getWarningModalForFederatedRooms = (\\n\\tcloseModalFn: () => void,\\n\\thandleConfirmFn: () => void,\\n\\ttitle: string,\\n\\tconfirmText: string,\\n\\tbodyText: string,\\n): ReactElement => (\\n\\t<GenericModal\\n\\t\\tvariant='warning'\\n\\t\\tonClose={closeModalFn}\\n\\t\\tonConfirm={handleConfirmFn}\\n\\t\\tonCancel={closeModalFn}\\n\\t\\ttitle={title}\\n\\t\\tconfirmText={confirmText}\\n\\t>\\n\\t\\t{bodyText}\\n\\t</GenericModal>\\n);\\n\\nexport const useChangeOwnerAction = (user: Pick<IUser, '_id' | 'username'>, rid: IRoom['_id']): UserInfoAction | undefined => {\\n\\tconst t = useTranslation();\\n\\tconst room = useUserRoom(rid);\\n\\tconst { _id: uid } = user;\\n\\tconst userCanSetOwner = usePermission('set-owner', rid);\\n\\tconst isOwner = useUserHasRoomRole(uid, rid, 'owner');\\n\\tconst userSubscription = useUserSubscription(rid);\\n\\tconst setModal = useSetModal();\\n\\tconst { _id: loggedUserId = '' } = useUser() || {};\\n\\tconst loggedUserIsOwner = useUserHasRoomRole(loggedUserId, rid, 'owner');\\n\\tconst closeModal = useCallback(() => setModal(null), [setModal]);\\n\\n\\tif (!room) {\\n\\t\\tthrow Error('Room not provided');\\n\\t}\\n\\n\\tconst { roomCanSetOwner } = getRoomDirectives({ room, showingUserId: uid, userSubscription });\\n\\tconst roomName = room?.t && escapeHTML(roomCoordinator.getRoomName(room.t, room));\\n\\n\\tconst endpointPrefix = room.t === 'p' ? '/v1/groups' : '/v1/channels';\\n\\tconst changeOwnerEndpoint = isOwner ? 'removeOwner' : 'addOwner';\\n\\tconst changeOwnerMessage = isOwner ? 'User__username__removed_from__room_name__owners' : 'User__username__is_now_an_owner_of__room_name_';\\n\\tconst changeOwner = useEndpointAction('POST', `${endpointPrefix}.${changeOwnerEndpoint}`, {\\n\\t\\tsuccessMessage: t(changeOwnerMessage, { username: user.username, room_name: roomName }),\\n\\t});\\n\\n\\tconst handleConfirm = useCallback(() => {\\n\\t\\tchangeOwner({ roomId: rid, userId: uid });\\n\\t\\tcloseModal();\\n\\t}, [changeOwner, rid, uid, closeModal]);\\n\\n\\tconst handleChangeOwner = useCallback(\\n\\t\\t({ userId }) => {\\n\\t\\t\\tif (!isRoomFederated(room)) {\\n\\t\\t\\t\\treturn changeOwner({ roomId: rid, userId: uid });\\n\\t\\t\\t}\\n\\t\\t\\tconst changingOwnRole = userId === loggedUserId;\\n\\n\\t\\t\\tif (changingOwnRole && loggedUserIsOwner) {\\n\\t\\t\\t\\treturn setModal(() =>\\n\\t\\t\\t\\t\\tgetWarningModalForFederatedRooms(\\n\\t\\t\\t\\t\\t\\tcloseModal,\\n\\t\\t\\t\\t\\t\\thandleConfirm,\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_losing_privileges'),\\n\\t\\t\\t\\t\\t\\tt('Yes_continue'),\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_losing_privileges_warning'),\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t\\t);\\n\\t\\t\\t}\\n\\n\\t\\t\\tif (!changingOwnRole && loggedUserIsOwner) {\\n\\t\\t\\t\\treturn setModal(() =>\\n\\t\\t\\t\\t\\tgetWarningModalForFederatedRooms(\\n\\t\\t\\t\\t\\t\\tcloseModal,\\n\\t\\t\\t\\t\\t\\thandleConfirm,\\n\\t\\t\\t\\t\\t\\tt('Warning'),\\n\\t\\t\\t\\t\\t\\tt('Yes_continue'),\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_giving_same_permission_warning'),\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t\\t);\\n\\t\\t\\t}\\n\\n\\t\\t\\tchangeOwner({ roomId: rid, userId: uid });\\n\\t\\t},\\n\\t\\t[setModal, loggedUserId, loggedUserIsOwner, t, rid, uid, changeOwner, closeModal, handleConfirm, room],\\n\\t);\\n\\n\\tconst changeOwnerAction = useMutableCallback(async () => handleChangeOwner({ roomId: rid, userId: uid }));\\n\\tconst changeOwnerOption = useMemo(\\n\\t\\t() =>\\n\\t\\t\\t(isRoomFederated(room) && roomCanSetOwner) || (!isRoomFederated(room) && roomCanSetOwner && userCanSetOwner)\\n\\t\\t\\t\\t? {\\n\\t\\t\\t\\t\\t\\tcontent: t(isOwner ? 'Remove_as_owner' : 'Set_as_owner'),\\n\\t\\t\\t\\t\\t\\ticon: 'shield-check' as const,\\n\\t\\t\\t\\t\\t\\tonClick: changeOwnerAction,\\n\\t\\t\\t\\t\\t\\ttype: 'privileges' as UserInfoActionType,\\n\\t\\t\\t\\t  }\\n\\t\\t\\t\\t: undefined,\\n\\t\\t[changeOwnerAction, roomCanSetOwner, userCanSetOwner, isOwner, t, room],\\n\\t);\\n\\n\\treturn changeOwnerOption;\\n};\\n\",null],\"names\":[\"isRoomFederated\",\"useMutableCallback\",\"escapeHTML\",\"useTranslation\",\"usePermission\",\"useUserRoom\",\"useUserSubscription\",\"useSetModal\",\"useUser\",\"React\",\"useCallback\",\"useMemo\",\"GenericModal\",\"useEndpointAction\",\"roomCoordinator\",\"getRoomDirectives\",\"useUserHasRoomRole\",\"module\",\"export\",\"useChangeOwnerAction\",\"link\",\"v\",\"default\",\"getWarningModalForFederatedRooms\",\"closeModalFn\",\"handleConfirmFn\",\"title\",\"confirmText\",\"bodyText\",\"createElement\",\"variant\",\"onClose\",\"onConfirm\",\"onCancel\",\"user\",\"rid\",\"t\",\"room\",\"_id\",\"uid\",\"userCanSetOwner\",\"isOwner\",\"userSubscription\",\"setModal\",\"loggedUserId\",\"loggedUserIsOwner\",\"closeModal\",\"Error\",\"roomCanSetOwner\",\"showingUserId\",\"roomName\",\"getRoomName\",\"endpointPrefix\",\"changeOwnerEndpoint\",\"changeOwnerMessage\",\"changeOwner\",\"concat\",\"successMessage\",\"username\",\"room_name\",\"handleConfirm\",\"roomId\",\"userId\",\"handleChangeOwner\",\"_ref\",\"changingOwnRole\",\"changeOwnerAction\",\"changeOwnerOption\",\"content\",\"icon\",\"onClick\",\"type\",\"undefined\"],\"mappings\":\"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\"}"}