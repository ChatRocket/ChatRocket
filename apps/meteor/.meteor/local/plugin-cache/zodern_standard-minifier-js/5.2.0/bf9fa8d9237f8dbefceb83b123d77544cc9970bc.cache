{"code":"function module(n,t,e){e.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(n){i=n}},0),e.export({useHandleUnread:function(){return C}}),e.link(\"@rocket.chat/ui-contexts\",{useRouter:function(n){o=n}},0),e.link(\"react\",{useCallback:function(n){u=n},useEffect:function(n){r=n},useMemo:function(n){a=n},useRef:function(n){l=n},useState:function(n){c=n}},1),e.link(\"../../../../../app/models/client\",{ChatMessage:function(n){d=n}},2),e.link(\"../../../../../app/ui-utils/client\",{LegacyRoomManager:function(n){s=n},RoomHistoryManager:function(n){f=n}},3),e.link(\"../../../../../lib/utils/highOrderFunctions\",{withDebouncing:function(n){g=n},withThrottling:function(n){v=n}},4),e.link(\"../../../../hooks/useReactiveValue\",{useReactiveValue:function(n){m=n}},5),e.link(\"../../../../lib/rooms/roomCoordinator\",{roomCoordinator:function(n){R=n}},6),e.link(\"../../../../lib/utils/setMessageJumpQueryStringParameter\",{setMessageJumpQueryStringParameter:function(n){h=n}},7),e.link(\"../../contexts/ChatContext\",{useChat:function(n){k=n}},8);var i,o,u,r,a,l,c,d,s,f,g,v,m,R,h,k,p=function(n){var t=m(u(function(){return f.getRoom(n._id).unreadNotLoaded.get()},[n._id])),e=c(0),o=i(e,2),r=o[0],l=o[1],d=a(function(){return t+r},[t,r]),g=m(u(function(){var t;return null===(t=s.getOpenedRoomByRid(n._id))||void 0===t?void 0:t.unreadSince.get()},[n._id]));return a(function(){return d&&g?[{count:d,since:g},l]:[void 0,l]},[d,g])},C=function(n,t){var e,s=l(null),m=!!t,C=p(n),w=i(C,2),M=w[0],_=w[1],b=c(),S=i(b,2),x=S[0],y=S[1],B=k();if(!B)throw Error(\"No ChatContext provided\");var O=u(function(){var t,e=n._id,i=f.getRoom(e).firstUnread,o=null==i?void 0:i.get();o||(o=d.findOne({rid:e,ts:{$gt:null==M?void 0:M.since}},{sort:{ts:1},limit:1})),o&&(h(null===(t=o)||void 0===t?void 0:t._id),_(0))},[n._id,null==M?void 0:M.since,_]),F=u(function(){B.readStateManager.markAsRead(),_(0)},[B.readStateManager,_]);r(function(){if(!m){_(0);return}_(d.find({rid:n._id,ts:{$lte:x,$gt:null==t?void 0:t.ls}}).count())},[x,n._id,_,m,null==t?void 0:t.ls]);var L=o(),T=a(function(){return g({wait:500})(function(){m&&B.readStateManager.attemptMarkAsRead()})},[B.readStateManager,m]);return r(function(){return L.subscribeToRouteChange(function(){var n=L.getRouteName();n&&R.isRouteNameKnown(n)&&T()})},[T,n._id,L,m,null==t?void 0:t.alert,null==t?void 0:t.unread]),r(function(){if(!(null!=M&&M.count))return T()},[T,n._id,null==M?void 0:M.count]),{innerRef:u(function(n){if(n){var t=function(){var n,t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=s.current;if(i){var o=i.getBoundingClientRect().left+window.pageXOffset,u=i.getBoundingClientRect().top+window.pageYOffset,r=parseFloat(getComputedStyle(i).width);if(null!==(n=t=\"rtl\"===document.dir?document.elementFromPoint(o+r-2,u+e+2):document.elementFromPoint(o+2,u+e+2))&&void 0!==n&&n.classList.contains(\"rcx-message\")||null!=t&&t.classList.contains(\"rcx-message--sequential\"))return t}};n.addEventListener(\"scroll\",v({wait:300})(function(){Tracker.afterFlush(function(){var n=t(0)||t(20)||t(40);if(!n){_(0);return}var e=d.findOne(n.id);if(!e){_(0);return}y(e.ts)})}))}},[_]),wrapperRef:s,handleUnreadBarJumpToButtonClick:O,handleMarkAsReadButtonClick:F,counter:[null!==(e=null==M?void 0:M.count)&&void 0!==e?e:0,null==M?void 0:M.since]}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/body/hooks/useUnreadMessages.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom, ISubscription } from '@rocket.chat/core-typings';\\nimport { useRouter } from '@rocket.chat/ui-contexts';\\nimport type { Dispatch, SetStateAction } from 'react';\\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\\n\\nimport { ChatMessage } from '../../../../../app/models/client';\\nimport { LegacyRoomManager, RoomHistoryManager } from '../../../../../app/ui-utils/client';\\nimport { withDebouncing, withThrottling } from '../../../../../lib/utils/highOrderFunctions';\\nimport { useReactiveValue } from '../../../../hooks/useReactiveValue';\\nimport { roomCoordinator } from '../../../../lib/rooms/roomCoordinator';\\nimport { setMessageJumpQueryStringParameter } from '../../../../lib/utils/setMessageJumpQueryStringParameter';\\nimport { useChat } from '../../contexts/ChatContext';\\n\\ninterface IUnreadMessages {\\n\\tcount: number;\\n\\tsince: Date;\\n}\\n\\nconst useUnreadMessages = (room: IRoom): readonly [data: IUnreadMessages | undefined, setUnreadCount: Dispatch<SetStateAction<number>>] => {\\n\\tconst notLoadedCount = useReactiveValue(useCallback(() => RoomHistoryManager.getRoom(room._id).unreadNotLoaded.get(), [room._id]));\\n\\tconst [loadedCount, setLoadedCount] = useState(0);\\n\\n\\tconst count = useMemo(() => notLoadedCount + loadedCount, [notLoadedCount, loadedCount]);\\n\\n\\tconst since = useReactiveValue(useCallback(() => LegacyRoomManager.getOpenedRoomByRid(room._id)?.unreadSince.get(), [room._id]));\\n\\n\\treturn useMemo(() => {\\n\\t\\tif (count && since) {\\n\\t\\t\\treturn [{ count, since }, setLoadedCount];\\n\\t\\t}\\n\\n\\t\\treturn [undefined, setLoadedCount];\\n\\t}, [count, since]);\\n};\\n\\nexport const useHandleUnread = (\\n\\troom: IRoom,\\n\\tsubscription?: ISubscription,\\n): {\\n\\tinnerRef: (wrapper: HTMLDivElement | null) => void;\\n\\twrapperRef: React.MutableRefObject<HTMLDivElement | null>;\\n\\thandleUnreadBarJumpToButtonClick: () => void;\\n\\thandleMarkAsReadButtonClick: () => void;\\n\\tcounter: readonly [number, Date | undefined];\\n} => {\\n\\tconst messagesBoxRef = useRef<HTMLDivElement>(null);\\n\\n\\tconst subscribed = Boolean(subscription);\\n\\tconst [unread, setUnreadCount] = useUnreadMessages(room);\\n\\n\\tconst [lastMessageDate, setLastMessageDate] = useState<Date | undefined>();\\n\\n\\tconst chat = useChat();\\n\\n\\tif (!chat) {\\n\\t\\tthrow new Error('No ChatContext provided');\\n\\t}\\n\\tconst handleUnreadBarJumpToButtonClick = useCallback(() => {\\n\\t\\tconst rid = room._id;\\n\\t\\tconst { firstUnread } = RoomHistoryManager.getRoom(rid);\\n\\t\\tlet message = firstUnread?.get();\\n\\t\\tif (!message) {\\n\\t\\t\\tmessage = ChatMessage.findOne({ rid, ts: { $gt: unread?.since } }, { sort: { ts: 1 }, limit: 1 });\\n\\t\\t}\\n\\t\\tif (!message) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tsetMessageJumpQueryStringParameter(message?._id);\\n\\t\\tsetUnreadCount(0);\\n\\t}, [room._id, unread?.since, setUnreadCount]);\\n\\n\\tconst handleMarkAsReadButtonClick = useCallback(() => {\\n\\t\\tchat.readStateManager.markAsRead();\\n\\t\\tsetUnreadCount(0);\\n\\t}, [chat.readStateManager, setUnreadCount]);\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!subscribed) {\\n\\t\\t\\tsetUnreadCount(0);\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst count = ChatMessage.find({\\n\\t\\t\\trid: room._id,\\n\\t\\t\\tts: { $lte: lastMessageDate, $gt: subscription?.ls },\\n\\t\\t}).count();\\n\\n\\t\\tsetUnreadCount(count);\\n\\t}, [lastMessageDate, room._id, setUnreadCount, subscribed, subscription?.ls]);\\n\\n\\tconst router = useRouter();\\n\\n\\tconst debouncedReadMessageRead = useMemo(\\n\\t\\t() =>\\n\\t\\t\\twithDebouncing({ wait: 500 })(() => {\\n\\t\\t\\t\\tif (subscribed) {\\n\\t\\t\\t\\t\\tchat.readStateManager.attemptMarkAsRead();\\n\\t\\t\\t\\t}\\n\\t\\t\\t}),\\n\\t\\t[chat.readStateManager, subscribed],\\n\\t);\\n\\n\\tuseEffect(\\n\\t\\t() =>\\n\\t\\t\\trouter.subscribeToRouteChange(() => {\\n\\t\\t\\t\\tconst routeName = router.getRouteName();\\n\\t\\t\\t\\tif (!routeName || !roomCoordinator.isRouteNameKnown(routeName)) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tdebouncedReadMessageRead();\\n\\t\\t\\t}),\\n\\t\\t[debouncedReadMessageRead, room._id, router, subscribed, subscription?.alert, subscription?.unread],\\n\\t);\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!unread?.count) {\\n\\t\\t\\treturn debouncedReadMessageRead();\\n\\t\\t}\\n\\t}, [debouncedReadMessageRead, room._id, unread?.count]);\\n\\n\\tconst ref = useCallback(\\n\\t\\t(wrapper: HTMLDivElement | null) => {\\n\\t\\t\\tif (!wrapper) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst getElementFromPoint = (topOffset = 0): Element | undefined => {\\n\\t\\t\\t\\tconst messagesBox = messagesBoxRef.current;\\n\\n\\t\\t\\t\\tif (!messagesBox) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tconst messagesBoxLeft = messagesBox.getBoundingClientRect().left + window.pageXOffset;\\n\\t\\t\\t\\tconst messagesBoxTop = messagesBox.getBoundingClientRect().top + window.pageYOffset;\\n\\t\\t\\t\\tconst messagesBoxWidth = parseFloat(getComputedStyle(messagesBox).width);\\n\\n\\t\\t\\t\\tlet element;\\n\\t\\t\\t\\tif (document.dir === 'rtl') {\\n\\t\\t\\t\\t\\telement = document.elementFromPoint(messagesBoxLeft + messagesBoxWidth - 2, messagesBoxTop + topOffset + 2);\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\telement = document.elementFromPoint(messagesBoxLeft + 2, messagesBoxTop + topOffset + 2);\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (element?.classList.contains('rcx-message') || element?.classList.contains('rcx-message--sequential')) {\\n\\t\\t\\t\\t\\treturn element;\\n\\t\\t\\t\\t}\\n\\t\\t\\t};\\n\\t\\t\\twrapper.addEventListener(\\n\\t\\t\\t\\t'scroll',\\n\\t\\t\\t\\twithThrottling({ wait: 300 })(() => {\\n\\t\\t\\t\\t\\tTracker.afterFlush(() => {\\n\\t\\t\\t\\t\\t\\tconst lastInvisibleMessageOnScreen = getElementFromPoint(0) || getElementFromPoint(20) || getElementFromPoint(40);\\n\\n\\t\\t\\t\\t\\t\\tif (!lastInvisibleMessageOnScreen) {\\n\\t\\t\\t\\t\\t\\t\\tsetUnreadCount(0);\\n\\t\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\t\\tconst lastMessage = ChatMessage.findOne(lastInvisibleMessageOnScreen.id);\\n\\t\\t\\t\\t\\t\\tif (!lastMessage) {\\n\\t\\t\\t\\t\\t\\t\\tsetUnreadCount(0);\\n\\t\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\t\\tsetLastMessageDate(lastMessage.ts);\\n\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t}),\\n\\t\\t\\t);\\n\\t\\t},\\n\\t\\t[setUnreadCount],\\n\\t);\\n\\n\\treturn {\\n\\t\\tinnerRef: ref,\\n\\t\\twrapperRef: messagesBoxRef,\\n\\t\\thandleUnreadBarJumpToButtonClick,\\n\\t\\thandleMarkAsReadButtonClick,\\n\\t\\tcounter: [unread?.count ?? 0, unread?.since] as const,\\n\\t};\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_slicedToArray\",\"export\",\"useHandleUnread\",\"useRouter\",\"useCallback\",\"useEffect\",\"useMemo\",\"useRef\",\"useState\",\"ChatMessage\",\"LegacyRoomManager\",\"RoomHistoryManager\",\"withDebouncing\",\"withThrottling\",\"useReactiveValue\",\"roomCoordinator\",\"setMessageJumpQueryStringParameter\",\"useChat\",\"useUnreadMessages\",\"room\",\"notLoadedCount\",\"getRoom\",\"_id\",\"unreadNotLoaded\",\"get\",\"_useState\",\"_useState2\",\"loadedCount\",\"setLoadedCount\",\"count\",\"since\",\"_LegacyRoomManager$ge\",\"getOpenedRoomByRid\",\"unreadSince\",\"undefined\",\"subscription\",\"_unread$count\",\"messagesBoxRef\",\"subscribed\",\"Boolean\",\"_useUnreadMessages\",\"_useUnreadMessages2\",\"unread\",\"setUnreadCount\",\"_useState3\",\"_useState4\",\"lastMessageDate\",\"setLastMessageDate\",\"chat\",\"Error\",\"handleUnreadBarJumpToButtonClick\",\"_message\",\"rid\",\"firstUnread\",\"_RoomHistoryManager$g\",\"message\",\"findOne\",\"ts\",\"$gt\",\"sort\",\"limit\",\"handleMarkAsReadButtonClick\",\"readStateManager\",\"markAsRead\",\"find\",\"$lte\",\"ls\",\"router\",\"debouncedReadMessageRead\",\"wait\",\"attemptMarkAsRead\",\"subscribeToRouteChange\",\"routeName\",\"getRouteName\",\"isRouteNameKnown\",\"alert\",\"innerRef\",\"wrapper\",\"getElementFromPoint\",\"_element\",\"element\",\"topOffset\",\"arguments\",\"length\",\"messagesBox\",\"current\",\"messagesBoxLeft\",\"getBoundingClientRect\",\"left\",\"window\",\"pageXOffset\",\"messagesBoxTop\",\"top\",\"pageYOffset\",\"messagesBoxWidth\",\"parseFloat\",\"getComputedStyle\",\"width\",\"document\",\"dir\",\"elementFromPoint\",\"classList\",\"contains\",\"_element2\",\"addEventListener\",\"Tracker\",\"afterFlush\",\"lastInvisibleMessageOnScreen\",\"lastMessage\",\"id\",\"wrapperRef\",\"counter\"],\"mappings\":\"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\"}"}