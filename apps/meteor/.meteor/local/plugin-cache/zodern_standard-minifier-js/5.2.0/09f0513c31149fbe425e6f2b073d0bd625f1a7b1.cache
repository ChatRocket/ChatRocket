{"code":"function module(e,a,t){let s,r,p,l,i,n,o,d,u,c,k,v,m,h,A;t.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){s=e}},0),t.link(\"@rocket.chat/fuselage-hooks\",{useDebouncedCallback(e){r=e}},0),t.link(\"@rocket.chat/ui-contexts\",{usePermission(e){p=e},useStream(e){l=e}},1),t.link(\"@tanstack/react-query\",{useQuery(e){i=e},useQueryClient(e){n=e}},2),t.link(\"react\",{default(e){o=e},useEffect(e){d=e}},3),t.link(\"../../apps/orchestrator\",{AppClientOrchestratorInstance(e){u=e}},4),t.link(\"../../contexts/AppsContext\",{AppsContext(e){c=e}},5),t.link(\"../../hooks/useLicense\",{useInvalidateLicense(e){k=e},useLicense(e){v=e}},6),t.link(\"../../lib/asyncState\",{AsyncStatePhase(e){m=e}},7),t.link(\"../../views/marketplace/hooks/useAppsCountQuery\",{useInvalidateAppsCountQueryCallback(e){h=e}},8),t.link(\"./storeQueryFunction\",{storeQueryFunction(e){A=e}},9);let y=(e,a,t)=>t?{phase:m.REJECTED,value:void 0,error:t}:{phase:e?m.LOADING:m.RESOLVED,value:{apps:a||[]},error:t};t.exportDefault(e=>{var a,t;let{children:m}=e,Q=p(\"manage-apps\"),f=n(),{isLoading:E,data:{license:b,limits:C}={}}=v({loadValues:!0}),g=E?void 0:!!b,D=h(),L=k(),S=l(\"apps\"),x=r(()=>{f.invalidateQueries([\"marketplace\",\"apps-instance\"]),D()},100,[]);d(()=>S(\"apps\",e=>{let[a]=e;[\"app/added\",\"app/removed\",\"app/updated\",\"app/statusUpdate\",\"app/settingUpdated\"].includes(a)&&x(),[\"app/added\",\"app/removed\"].includes(a)&&!g&&L()}),[x,L,g,S]);let P=i([\"marketplace\",\"apps-marketplace\",Q],async()=>{let e=await u.getAppsFromMarketplace(Q);if(f.invalidateQueries([\"marketplace\",\"apps-stored\"]),e.error&&\"string\"==typeof e.error)throw Error(e.error);return e.apps},{staleTime:1/0,keepPreviousData:!0,onSettled:()=>f.invalidateQueries([\"marketplace\",\"apps-stored\"])}),w=i([\"marketplace\",\"apps-instance\",Q],async()=>{let e=await u.getInstalledApps().then(e=>e.map(e=>s(s({},e),{},{installed:!0})));return e},{staleTime:1/0,onSettled:()=>f.invalidateQueries([\"marketplace\",\"apps-stored\"])}),{isLoading:F,data:I}=i([\"marketplace\",\"apps-stored\",w.data,P.data],()=>A(P,w),{enabled:P.isFetched&&w.isFetched,keepPreviousData:!0}),[O,T,R]=I||[];return o.createElement(c.Provider,{children:m,value:{installedApps:y(F,T),marketplaceApps:y(F,O,P.error instanceof Error?P.error:void 0),privateApps:y(F,R),reload:async()=>{await Promise.all([f.invalidateQueries([\"marketplace\"])])},orchestrator:u,privateAppsEnabled:(null!==(a=null==C?void 0:null===(t=C.privateApps)||void 0===t?void 0:t.max)&&void 0!==a?a:0)!==0}})})}","map":"{\"version\":3,\"sources\":[\"client/providers/AppsProvider/AppsProvider.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { useDebouncedCallback } from '@rocket.chat/fuselage-hooks';\\nimport { usePermission, useStream } from '@rocket.chat/ui-contexts';\\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\\nimport type { ReactNode } from 'react';\\nimport React, { useEffect } from 'react';\\n\\nimport { AppClientOrchestratorInstance } from '../../apps/orchestrator';\\nimport { AppsContext } from '../../contexts/AppsContext';\\nimport { useInvalidateLicense, useLicense } from '../../hooks/useLicense';\\nimport type { AsyncState } from '../../lib/asyncState';\\nimport { AsyncStatePhase } from '../../lib/asyncState';\\nimport { useInvalidateAppsCountQueryCallback } from '../../views/marketplace/hooks/useAppsCountQuery';\\nimport type { App } from '../../views/marketplace/types';\\nimport { storeQueryFunction } from './storeQueryFunction';\\n\\nconst getAppState = (\\n\\tloading: boolean,\\n\\tapps: App[] | undefined,\\n\\terror?: Error,\\n): AsyncState<{\\n\\tapps: App[];\\n}> => {\\n\\tif (error) {\\n\\t\\treturn {\\n\\t\\t\\tphase: AsyncStatePhase.REJECTED,\\n\\t\\t\\tvalue: undefined,\\n\\t\\t\\terror,\\n\\t\\t};\\n\\t}\\n\\n\\treturn {\\n\\t\\tphase: loading ? AsyncStatePhase.LOADING : AsyncStatePhase.RESOLVED,\\n\\t\\tvalue: { apps: apps || [] },\\n\\t\\terror,\\n\\t};\\n};\\n\\ntype AppsProviderProps = {\\n\\tchildren: ReactNode;\\n};\\n\\nconst AppsProvider = ({ children }: AppsProviderProps) => {\\n\\tconst isAdminUser = usePermission('manage-apps');\\n\\n\\tconst queryClient = useQueryClient();\\n\\n\\tconst { isLoading: isLicenseInformationLoading, data: { license, limits } = {} } = useLicense({ loadValues: true });\\n\\tconst isEnterprise = isLicenseInformationLoading ? undefined : !!license;\\n\\n\\tconst invalidateAppsCountQuery = useInvalidateAppsCountQueryCallback();\\n\\tconst invalidateLicenseQuery = useInvalidateLicense();\\n\\n\\tconst stream = useStream('apps');\\n\\n\\tconst invalidate = useDebouncedCallback(\\n\\t\\t() => {\\n\\t\\t\\tqueryClient.invalidateQueries(['marketplace', 'apps-instance']);\\n\\t\\t\\tinvalidateAppsCountQuery();\\n\\t\\t},\\n\\t\\t100,\\n\\t\\t[],\\n\\t);\\n\\n\\tuseEffect(() => {\\n\\t\\treturn stream('apps', ([key]) => {\\n\\t\\t\\tif (['app/added', 'app/removed', 'app/updated', 'app/statusUpdate', 'app/settingUpdated'].includes(key)) {\\n\\t\\t\\t\\tinvalidate();\\n\\t\\t\\t}\\n\\t\\t\\tif (['app/added', 'app/removed'].includes(key) && !isEnterprise) {\\n\\t\\t\\t\\tinvalidateLicenseQuery();\\n\\t\\t\\t}\\n\\t\\t});\\n\\t}, [invalidate, invalidateLicenseQuery, isEnterprise, stream]);\\n\\n\\tconst marketplace = useQuery(\\n\\t\\t['marketplace', 'apps-marketplace', isAdminUser],\\n\\t\\tasync () => {\\n\\t\\t\\tconst result = await AppClientOrchestratorInstance.getAppsFromMarketplace(isAdminUser);\\n\\t\\t\\tqueryClient.invalidateQueries(['marketplace', 'apps-stored']);\\n\\t\\t\\tif (result.error && typeof result.error === 'string') {\\n\\t\\t\\t\\tthrow new Error(result.error);\\n\\t\\t\\t}\\n\\t\\t\\treturn result.apps;\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tstaleTime: Infinity,\\n\\t\\t\\tkeepPreviousData: true,\\n\\t\\t\\tonSettled: () => queryClient.invalidateQueries(['marketplace', 'apps-stored']),\\n\\t\\t},\\n\\t);\\n\\n\\tconst instance = useQuery(\\n\\t\\t['marketplace', 'apps-instance', isAdminUser],\\n\\t\\tasync () => {\\n\\t\\t\\tconst result = await AppClientOrchestratorInstance.getInstalledApps().then((result: App[]) =>\\n\\t\\t\\t\\tresult.map((current: App) => ({\\n\\t\\t\\t\\t\\t...current,\\n\\t\\t\\t\\t\\tinstalled: true,\\n\\t\\t\\t\\t})),\\n\\t\\t\\t);\\n\\t\\t\\treturn result;\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tstaleTime: Infinity,\\n\\t\\t\\tonSettled: () => queryClient.invalidateQueries(['marketplace', 'apps-stored']),\\n\\t\\t},\\n\\t);\\n\\n\\tconst { isLoading: isMarketplaceDataLoading, data: marketplaceData } = useQuery(\\n\\t\\t['marketplace', 'apps-stored', instance.data, marketplace.data],\\n\\t\\t() => storeQueryFunction(marketplace, instance),\\n\\t\\t{\\n\\t\\t\\tenabled: marketplace.isFetched && instance.isFetched,\\n\\t\\t\\tkeepPreviousData: true,\\n\\t\\t},\\n\\t);\\n\\n\\tconst [marketplaceAppsData, installedAppsData, privateAppsData] = marketplaceData || [];\\n\\n\\treturn (\\n\\t\\t<AppsContext.Provider\\n\\t\\t\\tchildren={children}\\n\\t\\t\\tvalue={{\\n\\t\\t\\t\\tinstalledApps: getAppState(isMarketplaceDataLoading, installedAppsData),\\n\\t\\t\\t\\tmarketplaceApps: getAppState(\\n\\t\\t\\t\\t\\tisMarketplaceDataLoading,\\n\\t\\t\\t\\t\\tmarketplaceAppsData,\\n\\t\\t\\t\\t\\tmarketplace.error instanceof Error ? marketplace.error : undefined,\\n\\t\\t\\t\\t),\\n\\t\\t\\t\\tprivateApps: getAppState(isMarketplaceDataLoading, privateAppsData),\\n\\n\\t\\t\\t\\treload: async () => {\\n\\t\\t\\t\\t\\tawait Promise.all([queryClient.invalidateQueries(['marketplace'])]);\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\torchestrator: AppClientOrchestratorInstance,\\n\\t\\t\\t\\tprivateAppsEnabled: (limits?.privateApps?.max ?? 0) !== 0,\\n\\t\\t\\t}}\\n\\t\\t/>\\n\\t);\\n};\\n\\nexport default AppsProvider;\\n\",null],\"names\":[\"_objectSpread\",\"useDebouncedCallback\",\"usePermission\",\"useStream\",\"useQuery\",\"useQueryClient\",\"React\",\"useEffect\",\"AppClientOrchestratorInstance\",\"AppsContext\",\"useInvalidateLicense\",\"useLicense\",\"AsyncStatePhase\",\"useInvalidateAppsCountQueryCallback\",\"storeQueryFunction\",\"module\",\"link\",\"default\",\"v\",\"getAppState\",\"loading\",\"apps\",\"error\",\"phase\",\"REJECTED\",\"value\",\"undefined\",\"LOADING\",\"RESOLVED\",\"exportDefault\",\"_ref\",\"_limits$privateApps$m\",\"_limits$privateApps\",\"children\",\"isAdminUser\",\"queryClient\",\"isLoading\",\"isLicenseInformationLoading\",\"data\",\"license\",\"limits\",\"loadValues\",\"isEnterprise\",\"invalidateAppsCountQuery\",\"invalidateLicenseQuery\",\"stream\",\"invalidate\",\"invalidateQueries\",\"_ref2\",\"key\",\"includes\",\"marketplace\",\"result\",\"getAppsFromMarketplace\",\"Error\",\"staleTime\",\"Infinity\",\"keepPreviousData\",\"onSettled\",\"instance\",\"getInstalledApps\",\"then\",\"map\",\"current\",\"installed\",\"isMarketplaceDataLoading\",\"marketplaceData\",\"enabled\",\"isFetched\",\"marketplaceAppsData\",\"installedAppsData\",\"privateAppsData\",\"createElement\",\"Provider\",\"installedApps\",\"marketplaceApps\",\"privateApps\",\"reload\",\"Promise\",\"all\",\"orchestrator\",\"privateAppsEnabled\",\"max\"],\"mappings\":\"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\"}"}