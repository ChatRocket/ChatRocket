{"code":"function module(e,t,i){let a,n,o,s;i.export({useAnalytics:()=>l}),i.link(\"meteor/meteor\",{Meteor(e){a=e}},0),i.link(\"react\",{useEffect(e){n=e}},1),i.link(\"../../../client/hooks/useReactiveValue\",{useReactiveValue(e){o=e}},2),i.link(\"../../settings/client\",{settings(e){s=e}},3);let l=()=>{let e=o(()=>a.userId()),t=o(()=>s.get(\"GoogleAnalytics_enabled\")&&s.get(\"GoogleAnalytics_ID\")),i=o(()=>s.get(\"PiwikAnalytics_enabled\")&&s.get(\"PiwikAnalytics_url\"));n(()=>{e&&(window._paq=window._paq||[],window._paq.push([\"setUserId\",e]))}),n(()=>{var e,i,a,n,o,s,l,c,r,w;if(t){if(t.startsWith(\"G-\")){let i=document.getElementsByTagName(\"script\")[0],a=document.createElement(\"script\");a.async=!0,a.src=\"//www.googletagmanager.com/gtag/js?id=\".concat(t),null===(e=i.parentNode)||void 0===e||e.insertBefore(a,i);let n=window,o=n.dataLayer||[],s=(e,t)=>{o.push(e,t)};s(\"js\",new Date),s(\"config\",t)}else s=window,l=document,c=\"script\",s.GoogleAnalyticsObject=\"ga\",s.ga=s.ga||function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];(s.ga.q=s.ga.q||[]).push(t)},s.ga.l=new Date().getTime(),r=l.createElement(c),w=l.getElementsByTagName(c)[0],r.async=1,r.src=\"https://www.google-analytics.com/analytics.js\",w.parentNode.insertBefore(r,w),null===(i=(a=window).ga)||void 0===i||i.call(a,\"create\",t,\"auto\"),null===(n=(o=window).ga)||void 0===n||n.call(o,\"send\",\"pageview\")}},[t,e]),n(()=>{if(!i){var e;null===(e=document.getElementById(\"piwik-analytics\"))||void 0===e||e.remove(),window._paq=[];return}let t=i&&s.get(\"PiwikAnalytics_siteId\"),a=i&&s.get(\"PiwikAnalytics_prependDomain\"),n=i&&s.get(\"PiwikAnalytics_cookieDomain\"),o=i&&s.get(\"PiwikAnalytics_domains\"),l=i&&s.get(\"PiwikAdditionalTrackers\");window._paq=window._paq||[],window._paq.push([\"trackPageView\"]),window._paq.push([\"enableLinkTracking\"]),a&&window._paq.push([\"setDocumentTitle\",\"\".concat(window.location.hostname,\"/\").concat(document.title)]);let c=\"*.\".concat(window.location.hostname.split(\".\").slice(1).join(\".\"));if(n&&window._paq.push([\"setCookieDomain\",c]),o){let e=o.split(/\\n/),t=[];for(let i=0;i<e.length;i++)/\\S/.test(e[i])&&t.push(\"*.\".concat(e[i].trim()));window._paq.push([\"setDomains\",t])}(e=>{try{if(/\\S/.test(l)){let e=JSON.parse(l);for(let t=0;t<e.length;t++){let i=e[t];window._paq.push([\"addTracker\",\"\".concat(i.trackerURL,\"js/\"),i.siteId])}}}catch(e){console.log('Error while parsing JSON value of \"piwikAdditionalTracker\": ',e)}window._paq.push([\"setTrackerUrl\",\"\".concat(i,\"js/\")]),window._paq.push([\"setSiteId\",Number.parseInt(t)]);let a=document,n=a.createElement(\"script\");n.setAttribute(\"id\",\"piwik-analytics\");let o=a.getElementsByTagName(\"script\")[0];n.type=\"text/javascript\",n.async=!0,n.defer=!0,n.src=\"\".concat(i,\"js/\"),null===(e=o.parentNode)||void 0===e||e.insertBefore(n,o)})()},[i])}}","map":"{\"version\":3,\"sources\":[\"app/analytics/client/loadScript.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { useEffect } from 'react';\\n\\nimport { useReactiveValue } from '../../../client/hooks/useReactiveValue';\\nimport { settings } from '../../settings/client';\\n\\ndeclare global {\\n\\t// eslint-disable-next-line @typescript-eslint/naming-convention\\n\\tinterface Window {\\n\\t\\t_paq?: [string, ...unknown[]][];\\n\\t\\tGoogleAnalyticsObject: unknown;\\n\\t\\tga?: qa;\\n\\t}\\n\\n\\ttype qa = {\\n\\t\\t(...args: unknown[]): void;\\n\\t\\tl?: number;\\n\\t\\tq?: unknown[];\\n\\t};\\n}\\n\\nexport const useAnalytics = (): void => {\\n\\tconst uid = useReactiveValue(() => Meteor.userId());\\n\\n\\tconst googleId = useReactiveValue(() => settings.get('GoogleAnalytics_enabled') && settings.get('GoogleAnalytics_ID'));\\n\\tconst piwikUrl = useReactiveValue(() => settings.get('PiwikAnalytics_enabled') && settings.get('PiwikAnalytics_url'));\\n\\n\\tuseEffect(() => {\\n\\t\\tif (uid) {\\n\\t\\t\\twindow._paq = window._paq || [];\\n\\t\\t\\twindow._paq.push(['setUserId', uid]);\\n\\t\\t}\\n\\t});\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!googleId) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tif (googleId.startsWith('G-')) {\\n\\t\\t\\t// Google Analytics 4\\n\\t\\t\\tconst f = document.getElementsByTagName('script')[0];\\n\\t\\t\\tconst j = document.createElement('script');\\n\\t\\t\\tj.async = true;\\n\\t\\t\\tj.src = `//www.googletagmanager.com/gtag/js?id=${googleId}`;\\n\\t\\t\\tf.parentNode?.insertBefore(j, f);\\n\\n\\t\\t\\t// injecting the dataLayer into the windows global object\\n\\t\\t\\tconst w: Window & { dataLayer?: any } = window;\\n\\t\\t\\tconst dataLayer = w.dataLayer || [];\\n\\t\\t\\tconst gtag = (key: string, value: any) => {\\n\\t\\t\\t\\tdataLayer.push(key, value);\\n\\t\\t\\t};\\n\\t\\t\\tgtag('js', new Date());\\n\\t\\t\\tgtag('config', googleId);\\n\\t\\t} else {\\n\\t\\t\\t// Google Analytics 3\\n\\t\\t\\t(function (i, s, o, g, r: 'ga', a?: any, m?: any) {\\n\\t\\t\\t\\ti.GoogleAnalyticsObject = r;\\n\\t\\t\\t\\t(i[r] =\\n\\t\\t\\t\\t\\ti[r] ||\\n\\t\\t\\t\\t\\tfunction (...args) {\\n\\t\\t\\t\\t\\t\\t((i[r] as any).q = (i[r] as any).q || []).push(args);\\n\\t\\t\\t\\t\\t\\t// eslint-disable-next-line no-sequences\\n\\t\\t\\t\\t\\t}),\\n\\t\\t\\t\\t\\t((i[r] as any).l = new Date().getTime());\\n\\t\\t\\t\\t// eslint-disable-next-line no-sequences\\n\\t\\t\\t\\t(a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);\\n\\t\\t\\t\\ta.async = 1;\\n\\t\\t\\t\\ta.src = g;\\n\\t\\t\\t\\tm.parentNode.insertBefore(a, m);\\n\\t\\t\\t})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');\\n\\n\\t\\t\\twindow.ga?.('create', googleId, 'auto');\\n\\t\\t\\twindow.ga?.('send', 'pageview');\\n\\t\\t}\\n\\t}, [googleId, uid]);\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!piwikUrl) {\\n\\t\\t\\tdocument.getElementById('piwik-analytics')?.remove();\\n\\t\\t\\twindow._paq = [];\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst piwikSiteId = piwikUrl && settings.get('PiwikAnalytics_siteId');\\n\\t\\tconst piwikPrependDomain = piwikUrl && settings.get('PiwikAnalytics_prependDomain');\\n\\t\\tconst piwikCookieDomain = piwikUrl && settings.get('PiwikAnalytics_cookieDomain');\\n\\t\\tconst piwikDomains = piwikUrl && settings.get('PiwikAnalytics_domains');\\n\\t\\tconst piwikAdditionalTracker = piwikUrl && settings.get('PiwikAdditionalTrackers');\\n\\t\\twindow._paq = window._paq || [];\\n\\n\\t\\twindow._paq.push(['trackPageView']);\\n\\t\\twindow._paq.push(['enableLinkTracking']);\\n\\t\\tif (piwikPrependDomain) {\\n\\t\\t\\twindow._paq.push(['setDocumentTitle', `${window.location.hostname}/${document.title}`]);\\n\\t\\t}\\n\\t\\tconst upperLevelDomain = `*.${window.location.hostname.split('.').slice(1).join('.')}`;\\n\\t\\tif (piwikCookieDomain) {\\n\\t\\t\\twindow._paq.push(['setCookieDomain', upperLevelDomain]);\\n\\t\\t}\\n\\t\\tif (piwikDomains) {\\n\\t\\t\\t// array\\n\\t\\t\\tconst domainsArray = piwikDomains.split(/\\\\n/);\\n\\t\\t\\tconst domains = [];\\n\\t\\t\\tfor (let i = 0; i < domainsArray.length; i++) {\\n\\t\\t\\t\\t// only push domain if it contains a non whitespace character.\\n\\t\\t\\t\\tif (/\\\\S/.test(domainsArray[i])) {\\n\\t\\t\\t\\t\\tdomains.push(`*.${domainsArray[i].trim()}`);\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t\\twindow._paq.push(['setDomains', domains]);\\n\\t\\t}\\n\\t\\t(() => {\\n\\t\\t\\ttry {\\n\\t\\t\\t\\tif (/\\\\S/.test(piwikAdditionalTracker)) {\\n\\t\\t\\t\\t\\t// piwikAdditionalTracker is not empty or whitespace only\\n\\t\\t\\t\\t\\tconst addTrackers = JSON.parse(piwikAdditionalTracker);\\n\\t\\t\\t\\t\\tfor (let i = 0; i < addTrackers.length; i++) {\\n\\t\\t\\t\\t\\t\\tconst tracker = addTrackers[i];\\n\\t\\t\\t\\t\\t\\twindow._paq.push(['addTracker', `${tracker.trackerURL}js/`, tracker.siteId]);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t} catch (e) {\\n\\t\\t\\t\\t// parsing JSON faild\\n\\t\\t\\t\\tconsole.log('Error while parsing JSON value of \\\"piwikAdditionalTracker\\\": ', e);\\n\\t\\t\\t}\\n\\t\\t\\twindow._paq.push(['setTrackerUrl', `${piwikUrl}js/`]);\\n\\t\\t\\twindow._paq.push(['setSiteId', Number.parseInt(piwikSiteId)]);\\n\\t\\t\\tconst d = document;\\n\\t\\t\\tconst g = d.createElement('script');\\n\\t\\t\\tg.setAttribute('id', 'piwik-analytics');\\n\\t\\t\\tconst s = d.getElementsByTagName('script')[0];\\n\\t\\t\\tg.type = 'text/javascript';\\n\\t\\t\\tg.async = true;\\n\\t\\t\\tg.defer = true;\\n\\t\\t\\tg.src = `${piwikUrl}js/`;\\n\\t\\t\\ts.parentNode?.insertBefore(g, s);\\n\\t\\t})();\\n\\t}, [piwikUrl]);\\n};\\n\",null],\"names\":[\"Meteor\",\"useEffect\",\"useReactiveValue\",\"settings\",\"module\",\"export\",\"useAnalytics\",\"link\",\"v\",\"uid\",\"userId\",\"googleId\",\"get\",\"piwikUrl\",\"window\",\"_paq\",\"push\",\"_f$parentNode\",\"_window$ga\",\"_window\",\"_window$ga2\",\"_window2\",\"i\",\"s\",\"o\",\"a\",\"m\",\"startsWith\",\"f\",\"document\",\"getElementsByTagName\",\"j\",\"createElement\",\"async\",\"src\",\"concat\",\"parentNode\",\"insertBefore\",\"w\",\"dataLayer\",\"gtag\",\"key\",\"value\",\"Date\",\"GoogleAnalyticsObject\",\"_len\",\"arguments\",\"length\",\"args\",\"Array\",\"_key\",\"q\",\"l\",\"getTime\",\"ga\",\"call\",\"_document$getElementB\",\"getElementById\",\"remove\",\"piwikSiteId\",\"piwikPrependDomain\",\"piwikCookieDomain\",\"piwikDomains\",\"piwikAdditionalTracker\",\"location\",\"hostname\",\"title\",\"upperLevelDomain\",\"split\",\"slice\",\"join\",\"domainsArray\",\"domains\",\"test\",\"trim\",\"_s$parentNode\",\"addTrackers\",\"JSON\",\"parse\",\"tracker\",\"trackerURL\",\"siteId\",\"e\",\"console\",\"log\",\"Number\",\"parseInt\",\"d\",\"g\",\"setAttribute\",\"type\",\"defer\"],\"mappings\":\"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\"}"}