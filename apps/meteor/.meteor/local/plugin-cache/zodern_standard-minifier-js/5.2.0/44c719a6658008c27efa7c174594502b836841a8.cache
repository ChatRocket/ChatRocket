{"code":"function module(n,e,i){i.link(\"@babel/runtime/regenerator\",{default:function(n){o=n}},0),i.export({useVideoCallAction:function(){return V}}),i.link(\"@rocket.chat/core-typings\",{isRoomFederated:function(n){t=n}},0),i.link(\"@rocket.chat/ui-contexts\",{useTranslation:function(n){r=n},useUserRoom:function(n){u=n},useUserId:function(n){c=n},useUserSubscriptionByName:function(n){a=n},useSetting:function(n){s=n},usePermission:function(n){l=n}},1),i.link(\"react\",{useMemo:function(n){f=n}},2),i.link(\"../../../../../contexts/VideoConfContext\",{useVideoConfDispatchOutgoing:function(n){d=n},useVideoConfIsCalling:function(n){C=n},useVideoConfIsRinging:function(n){k=n}},3),i.link(\"../../../../../lib/VideoConfManager\",{VideoConfManager:function(n){g=n}},4),i.link(\"../../../contexts/UserCardContext\",{useUserCard:function(n){m=n}},5),i.link(\"../../../contextualBar/VideoConference/hooks/useVideoConfWarning\",{useVideoConfWarning:function(n){p=n}},6);var o,t,r,u,c,a,s,l,f,d,C,k,g,m,p,V=function(n){var e,i=r(),V=a(null!==(e=n.username)&&void 0!==e?e:\"\"),x=u((null==V?void 0:V.rid)||\"\"),v=m().closeUserCard,b=p(),_=d(),h=C(),U=k(),y=c(),M=s(\"VideoConf_Enable_DMs\"),I=l(\"call-management\",null==x?void 0:x._id);return f(function(){return x&&!t(x)&&n._id!==y&&M&&I&&!h&&!U?{type:\"communication\",title:i(\"Video_call\"),icon:\"video\",onClick:function(){return o.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(h||U||!x)){n.next=2;break}return n.abrupt(\"return\");case 2:return n.prev=2,n.next=5,o.awrap(g.loadCapabilities());case 5:v(),_({rid:x._id}),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(2),b(n.t0.error);case 12:case\"end\":return n.stop()}},null,null,[[2,9]],Promise)}}:void 0},[x,n._id,y,M,I,h,U,i,_,b,v])}}","map":"{\"version\":3,\"sources\":[\"client/views/room/hooks/useUserInfoActions/actions/useVideoCallAction.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { IUser } from '@rocket.chat/core-typings';\\nimport { isRoomFederated } from '@rocket.chat/core-typings';\\nimport { useTranslation, useUserRoom, useUserId, useUserSubscriptionByName, useSetting, usePermission } from '@rocket.chat/ui-contexts';\\nimport { useMemo } from 'react';\\n\\nimport { useVideoConfDispatchOutgoing, useVideoConfIsCalling, useVideoConfIsRinging } from '../../../../../contexts/VideoConfContext';\\nimport { VideoConfManager } from '../../../../../lib/VideoConfManager';\\nimport { useUserCard } from '../../../contexts/UserCardContext';\\nimport { useVideoConfWarning } from '../../../contextualBar/VideoConference/hooks/useVideoConfWarning';\\nimport type { UserInfoAction } from '../useUserInfoActions';\\n\\nexport const useVideoCallAction = (user: Pick<IUser, '_id' | 'username'>): UserInfoAction | undefined => {\\n\\tconst t = useTranslation();\\n\\tconst usernameSubscription = useUserSubscriptionByName(user.username ?? '');\\n\\tconst room = useUserRoom(usernameSubscription?.rid || '');\\n\\tconst { closeUserCard } = useUserCard();\\n\\n\\tconst dispatchWarning = useVideoConfWarning();\\n\\tconst dispatchPopup = useVideoConfDispatchOutgoing();\\n\\tconst isCalling = useVideoConfIsCalling();\\n\\tconst isRinging = useVideoConfIsRinging();\\n\\tconst ownUserId = useUserId();\\n\\n\\tconst enabledForDMs = useSetting('VideoConf_Enable_DMs');\\n\\tconst permittedToCallManagement = usePermission('call-management', room?._id);\\n\\n\\tconst videoCallOption = useMemo<UserInfoAction | undefined>(() => {\\n\\t\\tconst action = async (): Promise<void> => {\\n\\t\\t\\tif (isCalling || isRinging || !room) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\ttry {\\n\\t\\t\\t\\tawait VideoConfManager.loadCapabilities();\\n\\t\\t\\t\\tcloseUserCard();\\n\\t\\t\\t\\tdispatchPopup({ rid: room._id });\\n\\t\\t\\t} catch (error: any) {\\n\\t\\t\\t\\tdispatchWarning(error.error);\\n\\t\\t\\t}\\n\\t\\t};\\n\\n\\t\\tconst shouldShowStartCall =\\n\\t\\t\\troom && !isRoomFederated(room) && user._id !== ownUserId && enabledForDMs && permittedToCallManagement && !isCalling && !isRinging;\\n\\n\\t\\treturn shouldShowStartCall\\n\\t\\t\\t? {\\n\\t\\t\\t\\t\\ttype: 'communication',\\n\\t\\t\\t\\t\\ttitle: t('Video_call'),\\n\\t\\t\\t\\t\\ticon: 'video',\\n\\t\\t\\t\\t\\tonClick: action,\\n\\t\\t\\t  }\\n\\t\\t\\t: undefined;\\n\\t}, [\\n\\t\\troom,\\n\\t\\tuser._id,\\n\\t\\townUserId,\\n\\t\\tenabledForDMs,\\n\\t\\tpermittedToCallManagement,\\n\\t\\tisCalling,\\n\\t\\tisRinging,\\n\\t\\tt,\\n\\t\\tdispatchPopup,\\n\\t\\tdispatchWarning,\\n\\t\\tcloseUserCard,\\n\\t]);\\n\\n\\treturn videoCallOption;\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"export\",\"useVideoCallAction\",\"isRoomFederated\",\"useTranslation\",\"useUserRoom\",\"useUserId\",\"useUserSubscriptionByName\",\"useSetting\",\"usePermission\",\"useMemo\",\"useVideoConfDispatchOutgoing\",\"useVideoConfIsCalling\",\"useVideoConfIsRinging\",\"VideoConfManager\",\"useUserCard\",\"useVideoConfWarning\",\"user\",\"_user$username\",\"t\",\"usernameSubscription\",\"username\",\"room\",\"rid\",\"closeUserCard\",\"_useUserCard\",\"dispatchWarning\",\"dispatchPopup\",\"isCalling\",\"isRinging\",\"ownUserId\",\"enabledForDMs\",\"permittedToCallManagement\",\"_id\",\"shouldShowStartCall\",\"type\",\"title\",\"icon\",\"onClick\",\"async\",\"_context\",\"prev\",\"next\",\"abrupt\",\"awrap\",\"loadCapabilities\",\"t0\",\"error\",\"stop\",\"Promise\",\"undefined\"],\"mappings\":\"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\"}"}