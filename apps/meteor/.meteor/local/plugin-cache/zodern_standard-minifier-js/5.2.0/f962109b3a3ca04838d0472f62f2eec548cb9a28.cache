{"code":"Package[\"core-runtime\"].queue(\"accounts-base\",function(){var n,e=Package.meteor.Meteor;Package.meteor.global,Package.meteor.meteorEnv;var t=Package.tracker.Tracker;Package.tracker.Deps;var o=Package.random.Random,i=Package[\"callback-hook\"].Hook,r=Package[\"reactive-var\"].ReactiveVar;Package.url.URL,Package.url.URLSearchParams;var s=Package[\"ddp-client\"].DDP,a=Package.mongo.Mongo,c=Package.modules.meteorInstall;Package.modules.meteorBabelHelpers;var l=Package.promise.Promise;return Package[\"ecmascript-runtime-client\"].Symbol,Package[\"ecmascript-runtime-client\"].Map,Package[\"ecmascript-runtime-client\"].Set,{export:function(){return{Accounts:n}},require:c({node_modules:{meteor:{\"accounts-base\":{\"client_main.js\":function t(t,o,i){var r,s,a,c,l;i.export({Accounts:function(){return n},AccountsClient:function(){return c},AccountsTest:function(){return l},default:function(){return o}}),i.link(\"./accounts_client.js\",{AccountsClient:function(n){c=n},AccountsTest:function(n){l=n}},0),i.runSetters(n=new c((null===(r=e.settings)||void 0===r?void 0:null===(s=r.public)||void 0===s?void 0:null===(a=s.packages)||void 0===a?void 0:a.accounts)||{}),[\"Accounts\"]),e.users=n.users},\"accounts_client.js\":function i(i,a,c){c.link(\"@babel/runtime/regenerator\",{default:function(n){u=n}},0),c.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(n){g=n}},1),c.link(\"@babel/runtime/helpers/inheritsLoose\",{default:function(n){h=n}},2),c.export({AccountsClient:function(){return d},AccountsTest:function(){return m}}),c.link(\"./accounts_common.js\",{AccountsCommon:function(n){_=n}},0);var u,g,h,_,d=function(n){function i(e){var t;return(t=n.call(this,e)||this)._loggingIn=new r(!1),t._loggingOut=new r(!1),t._loginServicesHandle=t.connection.subscribe(\"meteor.loginServiceConfiguration\"),t._pageLoadLoginCallbacks=[],t._pageLoadLoginAttemptInfo=null,t.savedHash=window.location.hash,t._initUrlMatching(),t.initStorageLocation(),t._initLocalStorage(),t._loginFuncs={},t._loginCallbacksCalled=!1,t}h(i,n);var a=i.prototype;return a.initStorageLocation=function(n){var t,o,i,r;this.storageLocation=(null==n?void 0:n.clientStorage)===\"session\"||(null===(t=e.settings)||void 0===t?void 0:null===(o=t.public)||void 0===o?void 0:null===(i=o.packages)||void 0===i?void 0:null===(r=i.accounts)||void 0===r?void 0:r.clientStorage)===\"session\"?window.sessionStorage:e._localStorage},a.config=function(e){n.prototype.config.call(this,e),this.initStorageLocation(e)},a.userId=function(){return this.connection.userId()},a._setLoggingIn=function(n){this._loggingIn.set(n)},a.loggingIn=function(){return this._loggingIn.get()},a.loggingOut=function(){return this._loggingOut.get()},a.registerClientLoginFunction=function(n,e){if(this._loginFuncs[n])throw Error(n+\" has been defined already\");this._loginFuncs[n]=e},a.callLoginFunction=function(n){if(!this._loginFuncs[n])throw Error(n+\" was not defined\");for(var e=arguments.length,t=Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];return this._loginFuncs[n].apply(this,t)},a.applyLoginFunction=function(n,e){if(!this._loginFuncs[n])throw Error(n+\" was not defined\");return this._loginFuncs[n].apply(this,e)},a.logout=function(n){var e=this;this._loggingOut.set(!0),this.connection.applyAsync(\"logout\",[],{wait:!0}).then(function(t){e._loggingOut.set(!1),e._loginCallbacksCalled=!1,e.makeClientLoggedOut(),n&&n()}).catch(function(t){e._loggingOut.set(!1),n&&n(t)})},a.logoutOtherClients=function(n){var e=this;this.connection.apply(\"getNewToken\",[],{wait:!0},function(n,t){n||e._storeLoginToken(e.userId(),t.token,t.tokenExpires)}),this.connection.apply(\"removeOtherTokens\",[],{wait:!0},function(e){return n&&n(e)})},a.callLoginMethod=function(n){var o,i=this;n=g({methodName:\"login\",methodArguments:[{}],_suppressLoggingIn:!1},n),[\"validateResult\",\"userCallback\"].forEach(function(e){n[e]||(n[e]=function(){return null})});var r=function(e){var t=e.error,r=e.loginDetails;o||(o=!0,t?(i._loginCallbacksCalled=!1,i._onLoginFailureHook.forEach(function(n){return n({error:t}),!0})):(i._onLoginHook.forEach(function(n){return n(r),!0}),i._loginCallbacksCalled=!0),n.userCallback(t,r))},a=!1;n._suppressLoggingIn||this._setLoggingIn(!0),this.connection.applyAsync(n.methodName,n.methodArguments,{wait:!0,onResultReceived:function(n,e){!n&&e&&e.token&&(i._reconnectStopper&&i._reconnectStopper.stop(),i._reconnectStopper=s.onReconnect(function(n){if(n==i.connection){a=!0;var t=i._storedLoginToken();t&&(e={token:t,tokenExpires:i._storedLoginTokenExpires()}),e.tokenExpires||(e.tokenExpires=i._tokenExpiration(new Date)),i._tokenExpiresSoon(e.tokenExpires)?i.makeClientLoggedOut():i.callLoginMethod({methodArguments:[{resume:e.token}],_suppressLoggingIn:!0,userCallback:function(n,t){var o=i._storedLoginToken();n&&o&&o===e.token&&i.makeClientLoggedOut(),r({error:n,loginDetails:t})}})}}))}},function(o,s){if(!a){if(o||!s){r({error:o=o||Error(\"No result from call to \"+n.methodName)}),i._setLoggingIn(!1);return}try{n.validateResult(s)}catch(n){r({error:n}),i._setLoggingIn(!1);return}i.makeClientLoggedIn(s.id,s.token,s.tokenExpires),t.autorun(function(n){return u.async(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,u.awrap(t.withComputation(n,function(){return e.userAsync()}));case 2:o.sent&&(r({loginDetails:s}),i._setLoggingIn(!1),n.stop());case 4:case\"end\":return o.stop()}},null,null,null,l)})}})},a.makeClientLoggedOut=function(){this.connection._userId&&this._onLogoutHook.each(function(n){return n(),!0}),this._unstoreLoginToken(),this.connection.setUserId(null),this._reconnectStopper&&this._reconnectStopper.stop()},a.makeClientLoggedIn=function(n,e,t){this._storeLoginToken(n,e,t),this.connection.setUserId(n)},a.loginServicesConfigured=function(){return this._loginServicesHandle.ready()},a.onPageLoadLogin=function(n){this._pageLoadLoginAttemptInfo?n(this._pageLoadLoginAttemptInfo):this._pageLoadLoginCallbacks.push(n)},a._pageLoadLogin=function(n){if(this._pageLoadLoginAttemptInfo){e._debug(\"Ignoring unexpected duplicate page load login attempt info\");return}this._pageLoadLoginCallbacks.forEach(function(e){return e(n)}),this._pageLoadLoginCallbacks=[],this._pageLoadLoginAttemptInfo=n},a._startupCallback=function(n){this._loginCallbacksCalled&&e.setTimeout(function(){return n({type:\"resume\"})},0)},a.loginWithToken=function(n,e){this.callLoginMethod({methodArguments:[{resume:n}],userCallback:e})},a._enableAutoLogin=function(){this._autoLoginEnabled=!0,this._pollStoredLoginToken()},a._isolateLoginTokenForTest=function(){this.LOGIN_TOKEN_KEY=this.LOGIN_TOKEN_KEY+o.id(),this.USER_ID_KEY=this.USER_ID_KEY+o.id()},a._storeLoginToken=function(n,e,t){this.storageLocation.setItem(this.USER_ID_KEY,n),this.storageLocation.setItem(this.LOGIN_TOKEN_KEY,e),t||(t=this._tokenExpiration(new Date)),this.storageLocation.setItem(this.LOGIN_TOKEN_EXPIRES_KEY,t),this._lastLoginTokenWhenPolled=e},a._unstoreLoginToken=function(){this.storageLocation.removeItem(this.USER_ID_KEY),this.storageLocation.removeItem(this.LOGIN_TOKEN_KEY),this.storageLocation.removeItem(this.LOGIN_TOKEN_EXPIRES_KEY),this._lastLoginTokenWhenPolled=null},a._storedLoginToken=function(){return this.storageLocation.getItem(this.LOGIN_TOKEN_KEY)},a._storedLoginTokenExpires=function(){return this.storageLocation.getItem(this.LOGIN_TOKEN_EXPIRES_KEY)},a._storedUserId=function(){return this.storageLocation.getItem(this.USER_ID_KEY)},a._unstoreLoginTokenIfExpiresSoon=function(){var n=this._storedLoginTokenExpires();n&&this._tokenExpiresSoon(new Date(n))&&this._unstoreLoginToken()},a._initLocalStorage=function(){var n,t=this;this.LOGIN_TOKEN_KEY=\"Meteor.loginToken\",this.LOGIN_TOKEN_EXPIRES_KEY=\"Meteor.loginTokenExpires\",this.USER_ID_KEY=\"Meteor.userId\";var o=__meteor_runtime_config__.ROOT_URL_PATH_PREFIX;if(o||this.connection!==e.connection){var i=\":\"+this.connection._stream.rawUrl;o&&(i+=\":\"+o),this.LOGIN_TOKEN_KEY+=i,this.LOGIN_TOKEN_EXPIRES_KEY+=i,this.USER_ID_KEY+=i}if(this._autoLoginEnabled&&(this._unstoreLoginTokenIfExpiresSoon(),n=this._storedLoginToken())){var r=this._storedUserId();r&&this.connection.setUserId(r),this.loginWithToken(n,function(o){o&&(e._debug(\"Error logging in with token: \"+o),t.makeClientLoggedOut()),t._pageLoadLogin({type:\"resume\",allowed:!o,error:o,methodName:\"login\",methodArguments:[{resume:n}]})})}this._lastLoginTokenWhenPolled=n,this._pollIntervalTimer&&clearInterval(this._pollIntervalTimer),this._pollIntervalTimer=setInterval(function(){t._pollStoredLoginToken()},3e3)},a._pollStoredLoginToken=function(){var n=this;if(this._autoLoginEnabled){var e=this._storedLoginToken();this._lastLoginTokenWhenPolled!=e&&(e?this.loginWithToken(e,function(e){e&&n.makeClientLoggedOut()}):this.logout()),this._lastLoginTokenWhenPolled=e}},a._initUrlMatching=function(){this._autoLoginEnabled=!0,this._accountsCallbacks={},this._attemptToMatchHash()},a._attemptToMatchHash=function(){k(this,this.savedHash,p)},a.onResetPasswordLink=function(n){this._accountsCallbacks[\"reset-password\"]&&e._debug(\"Accounts.onResetPasswordLink was called more than once. Only one callback added will be executed.\"),this._accountsCallbacks[\"reset-password\"]=n},a.onEmailVerificationLink=function(n){this._accountsCallbacks[\"verify-email\"]&&e._debug(\"Accounts.onEmailVerificationLink was called more than once. Only one callback added will be executed.\"),this._accountsCallbacks[\"verify-email\"]=n},a.onEnrollmentLink=function(n){this._accountsCallbacks[\"enroll-account\"]&&e._debug(\"Accounts.onEnrollmentLink was called more than once. Only one callback added will be executed.\"),this._accountsCallbacks[\"enroll-account\"]=n},i}(_);if(e.loggingIn=function(){return n.loggingIn()},e.loggingOut=function(){return n.loggingOut()},e.logout=function(e){return n.logout(e)},e.logoutOtherClients=function(e){return n.logoutOtherClients(e)},e.loginWithToken=function(e,t){return n.loginWithToken(e,t)},Package.blaze){var f=Package.blaze.Blaze.Template;f.registerHelper(\"currentUser\",function(){return e.user()}),f.registerHelper(\"loggingIn\",function(){return e.loggingIn()}),f.registerHelper(\"loggingOut\",function(){return e.loggingOut()}),f.registerHelper(\"loggingInOrOut\",function(){return e.loggingIn()||e.loggingOut()})}var p=function(n,t){var o=this;this._autoLoginEnabled=!1,e.startup(function(){o._accountsCallbacks[t]&&o._accountsCallbacks[t](n,function(){return o._enableAutoLogin()})})},k=function(n,e,t){[\"reset-password\",\"verify-email\",\"enroll-account\"].forEach(function(o){var i,r=RegExp(\"^\\\\#\\\\/\"+o+\"\\\\/(.*)$\"),s=e.match(r);s&&(i=s[1],\"reset-password\"===o?n._resetPasswordToken=i:\"verify-email\"===o?n._verifyEmailToken=i:\"enroll-account\"===o&&(n._enrollAccountToken=i),window.location.hash=\"\",t.call(n,i,o))})},m={attemptToMatchHash:function(e,t){return k(n,e,t)}}},\"accounts_common.js\":function e(e,t,o){o.link(\"@babel/runtime/regenerator\",{default:function(n){r=n}},0),o.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(n){c=n}},1),o.export({AccountsCommon:function(){return h},EXPIRE_TOKENS_INTERVAL_MS:function(){return k}}),o.link(\"meteor/meteor\",{Meteor:function(n){u=n}},0);var r,c,u,g=[\"sendVerificationEmail\",\"forbidClientAccountCreation\",\"restrictCreationByEmailDomain\",\"loginExpiration\",\"loginExpirationInDays\",\"oauthSecretKey\",\"passwordResetTokenExpirationInDays\",\"passwordResetTokenExpiration\",\"passwordEnrollTokenExpirationInDays\",\"passwordEnrollTokenExpiration\",\"ambiguousErrorMessages\",\"bcryptRounds\",\"defaultFieldSelector\",\"collection\",\"loginTokenExpirationHours\",\"tokenSequenceLength\",\"clientStorage\",\"ddpUrl\",\"connection\"],h=function(){function n(n){for(var e=0,t=Object.keys(n);e<t.length;e++){var o=t[e];g.includes(o)||console.error(\"Accounts.config: Invalid key: \"+o)}this._options=n||{},this.connection=void 0,this._initConnection(n||{}),this.users=this._initializeCollection(n||{}),this._onLoginHook=new i({bindEnvironment:!1,debugPrintExceptions:\"onLogin callback\"}),this._onLoginFailureHook=new i({bindEnvironment:!1,debugPrintExceptions:\"onLoginFailure callback\"}),this._onLogoutHook=new i({bindEnvironment:!1,debugPrintExceptions:\"onLogout callback\"}),this.DEFAULT_LOGIN_EXPIRATION_DAYS=_,this.LOGIN_UNEXPIRING_TOKEN_DAYS=m;var r=\"Accounts.LoginCancelledError\";this.LoginCancelledError=u.makeErrorType(r,function(n){this.message=n}),this.LoginCancelledError.prototype.name=r,this.LoginCancelledError.numericError=145546287}var e=n.prototype;return e._initializeCollection=function(n){if(n.collection&&\"string\"!=typeof n.collection&&!(n.collection instanceof a.Collection))throw new u.Error('Collection parameter can be only of type string or \"Mongo.Collection\"');var e,t=\"users\";return\"string\"==typeof n.collection&&(t=n.collection),e=n.collection instanceof a.Collection?n.collection:new a.Collection(t,{_preventAutopublish:!0,connection:this.connection})},e.userId=function(){throw Error(\"userId method not implemented\")},e._addDefaultFieldSelector=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._options.defaultFieldSelector)return n;if(!n.fields)return c(c({},n),{},{fields:this._options.defaultFieldSelector});var e=Object.keys(n.fields);if(!e.length||n.fields[e[0]])return n;var t=Object.keys(this._options.defaultFieldSelector);return this._options.defaultFieldSelector[t[0]]?n:c(c({},n),{},{fields:c(c({},n.fields),this._options.defaultFieldSelector)})},e.user=function(n){u.isServer&&console.warn(\"`Meteor.user()` is deprecated on the server side.\\n    To fetch the current user record on the server,\\n    use `Meteor.userAsync()` instead.\");var e=this,t=e.userId();return t?function(){var n,t;return u.isClient?(n=e.users).findOne.apply(n,arguments):(t=e.users).findOneAsync.apply(t,arguments)}(t,this._addDefaultFieldSelector(n)):null},e.userAsync=function(n){var e;return r.async(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.userId(),t.abrupt(\"return\",e?this.users.findOneAsync(e,this._addDefaultFieldSelector(n)):null);case 2:case\"end\":return t.stop()}},null,this,null,l)},e.config=function(n){if(u.isServer?__meteor_runtime_config__.accountsConfigCalled=!0:__meteor_runtime_config__.accountsConfigCalled||u._debug(\"Accounts.config was called on the client but not on the server; some configuration options may not take effect.\"),Object.prototype.hasOwnProperty.call(n,\"oauthSecretKey\")){if(u.isClient)throw Error(\"The oauthSecretKey option may only be specified on the server\");if(!Package[\"oauth-encryption\"])throw Error(\"The oauth-encryption package must be loaded to set oauthSecretKey\");Package[\"oauth-encryption\"].OAuthEncryption.loadKey(n.oauthSecretKey),n=c({},n),delete n.oauthSecretKey}for(var e=0,t=Object.keys(n);e<t.length;e++){var o=t[e];g.includes(o)||console.error(\"Accounts.config: Invalid key: \"+o)}for(var i=0;i<g.length;i++){var r=g[i];if(r in n){if(r in this._options&&\"collection\"!==r&&u.isTest&&\"clientStorage\"!==r)throw new u.Error(\"Can't set `\"+r+\"` more than once\");this._options[r]=n[r]}}n.collection&&n.collection!==this.users._name&&n.collection!==this.users&&(this.users=this._initializeCollection(n))},e.onLogin=function(n){var e=this._onLoginHook.register(n);return this._startupCallback(e.callback),e},e.onLoginFailure=function(n){return this._onLoginFailureHook.register(n)},e.onLogout=function(n){return this._onLogoutHook.register(n)},e._initConnection=function(n){u.isClient&&(n.connection?this.connection=n.connection:n.ddpUrl?this.connection=s.connect(n.ddpUrl):\"undefined\"!=typeof __meteor_runtime_config__&&__meteor_runtime_config__.ACCOUNTS_CONNECTION_URL?this.connection=s.connect(__meteor_runtime_config__.ACCOUNTS_CONNECTION_URL):this.connection=u.connection)},e._getTokenLifetimeMs=function(){var n=null===this._options.loginExpirationInDays?m:this._options.loginExpirationInDays;return this._options.loginExpiration||864e5*(n||_)},e._getPasswordResetTokenLifetimeMs=function(){return this._options.passwordResetTokenExpiration||864e5*(this._options.passwordResetTokenExpirationInDays||d)},e._getPasswordEnrollTokenLifetimeMs=function(){return this._options.passwordEnrollTokenExpiration||864e5*(this._options.passwordEnrollTokenExpirationInDays||f)},e._tokenExpiration=function(n){return new Date(new Date(n).getTime()+this._getTokenLifetimeMs())},e._tokenExpiresSoon=function(n){var e=.1*this._getTokenLifetimeMs(),t=1e3*p;return e>t&&(e=t),new Date>new Date(n)-e},e._startupCallback=function(n){},n}();u.userId=function(){return n.userId()},u.user=function(e){return n.user(e)},u.userAsync=function(e){return n.userAsync(e)};var _=90,d=3,f=30,p=3600,k=6e5,m=36500}}}}},{extensions:[\".js\",\".json\"]}),eagerModulePaths:[\"/node_modules/meteor/accounts-base/client_main.js\"],mainModulePath:\"/node_modules/meteor/accounts-base/client_main.js\"}});","map":"{\"version\":3,\"sources\":[\"packages/accounts-base/client_main.js\",\"packages/accounts-base/accounts_client.js\",\"packages/accounts-base/accounts_common.js\",\"<anon>\"],\"sourcesContent\":[\"import {\\n  AccountsClient,\\n  AccountsTest,\\n} from \\\"./accounts_client.js\\\";\\n\\n/**\\n * @namespace Accounts\\n * @summary The namespace for all client-side accounts-related methods.\\n */\\nAccounts = new AccountsClient(Meteor.settings?.public?.packages?.accounts || {});\\n\\n/**\\n * @summary A [Mongo.Collection](#collections) containing user documents.\\n * @locus Anywhere\\n * @type {Mongo.Collection}\\n * @importFromPackage meteor\\n */\\nMeteor.users = Accounts.users;\\n\\nexport {\\n  Accounts,\\n  AccountsClient,\\n  AccountsTest,\\n  // For backwards compatibility. Note that exporting an object as the\\n  // default export is *not* the same as exporting its properties as named\\n  // exports, as was previously assumed.\\n  exports as default,\\n};\\n\",\"import { AccountsCommon } from './accounts_common.js';\\n\\n/**\\n * @summary Constructor for the `Accounts` object on the client.\\n * @locus Client\\n * @class AccountsClient\\n * @extends AccountsCommon\\n * @instancename accountsClient\\n * @param {Object} options an object with fields:\\n * @param {Object} options.connection Optional DDP connection to reuse.\\n * @param {String} options.ddpUrl Optional URL for creating a new DDP connection.\\n * @param {'session' | 'local'} options.clientStorage Optional Define what kind of storage you want for credentials on the client. Default is 'local' to use `localStorage`. Set to 'session' to use session storage.\\n */\\nexport class AccountsClient extends AccountsCommon {\\n\\tconstructor(options) {\\n\\t\\tsuper(options);\\n\\n\\t\\tthis._loggingIn = new ReactiveVar(false);\\n\\t\\tthis._loggingOut = new ReactiveVar(false);\\n\\n\\t\\tthis._loginServicesHandle = this.connection.subscribe('meteor.loginServiceConfiguration');\\n\\n\\t\\tthis._pageLoadLoginCallbacks = [];\\n\\t\\tthis._pageLoadLoginAttemptInfo = null;\\n\\n\\t\\tthis.savedHash = window.location.hash;\\n\\t\\tthis._initUrlMatching();\\n\\n\\t\\tthis.initStorageLocation();\\n\\n\\t\\t// Defined in localstorage_token.js.\\n\\t\\tthis._initLocalStorage();\\n\\n\\t\\t// This is for .registerClientLoginFunction & .callLoginFunction.\\n\\t\\tthis._loginFuncs = {};\\n\\n\\t\\t// This tracks whether callbacks registered with\\n\\t\\t// Accounts.onLogin have been called\\n\\t\\tthis._loginCallbacksCalled = false;\\n\\t}\\n\\n\\tinitStorageLocation(options) {\\n\\t\\t// Determine whether to use local or session storage to storage credentials and anything else.\\n\\t\\tthis.storageLocation =\\n\\t\\t\\toptions?.clientStorage === 'session' || Meteor.settings?.public?.packages?.accounts?.clientStorage === 'session'\\n\\t\\t\\t\\t? window.sessionStorage\\n\\t\\t\\t\\t: Meteor._localStorage;\\n\\t}\\n\\n\\tconfig(options) {\\n\\t\\tsuper.config(options);\\n\\n\\t\\tthis.initStorageLocation(options);\\n\\t}\\n\\n\\t///\\n\\t/// CURRENT USER\\n\\t///\\n\\n\\t// @override\\n\\tuserId() {\\n\\t\\treturn this.connection.userId();\\n\\t}\\n\\n\\t// This is mostly just called within this file, but Meteor.loginWithPassword\\n\\t// also uses it to make loggingIn() be true during the beginPasswordExchange\\n\\t// method call too.\\n\\t_setLoggingIn(x) {\\n\\t\\tthis._loggingIn.set(x);\\n\\t}\\n\\n\\t/**\\n\\t * @summary True if a login method (such as `Meteor.loginWithPassword`, `Meteor.loginWithFacebook`, or `Accounts.createUser`) is currently in progress. A reactive data source.\\n\\t * @locus Client\\n\\t */\\n\\tloggingIn() {\\n\\t\\treturn this._loggingIn.get();\\n\\t}\\n\\n\\t/**\\n\\t * @summary True if a logout method (such as `Meteor.logout`) is currently in progress. A reactive data source.\\n\\t * @locus Client\\n\\t */\\n\\tloggingOut() {\\n\\t\\treturn this._loggingOut.get();\\n\\t}\\n\\n\\t/**\\n   * @summary Register a new login function on the client. Intended for OAuth package authors. You can call the login function by using\\n   `Accounts.callLoginFunction` or `Accounts.callLoginFunction`.\\n   * @locus Client\\n   * @param {String} funcName The name of your login function. Used by `Accounts.callLoginFunction` and `Accounts.applyLoginFunction`.\\n   Should be the OAuth provider name accordingly.\\n   * @param {Function} func The actual function you want to call. Just write it in the manner of `loginWithFoo`.\\n   */\\n\\tregisterClientLoginFunction(funcName, func) {\\n\\t\\tif (this._loginFuncs[funcName]) {\\n\\t\\t\\tthrow new Error(`${funcName} has been defined already`);\\n\\t\\t}\\n\\t\\tthis._loginFuncs[funcName] = func;\\n\\t}\\n\\n\\t/**\\n   * @summary Call a login function defined using `Accounts.registerClientLoginFunction`. Excluding the first argument, all remaining\\n   arguments are passed to the login function accordingly. Use `applyLoginFunction` if you want to pass in an arguments array that contains\\n   all arguments for the login function.\\n   * @locus Client\\n   * @param {String} funcName The name of the login function you wanted to call.\\n   */\\n\\tcallLoginFunction(funcName, ...funcArgs) {\\n\\t\\tif (!this._loginFuncs[funcName]) {\\n\\t\\t\\tthrow new Error(`${funcName} was not defined`);\\n\\t\\t}\\n\\t\\treturn this._loginFuncs[funcName].apply(this, funcArgs);\\n\\t}\\n\\n\\t/**\\n   * @summary Same as ``callLoginFunction` but accept an `arguments` which contains all arguments for the login\\n   function.\\n   * @locus Client\\n   * @param {String} funcName The name of the login function you wanted to call.\\n   * @param {Array} funcArgs The `arguments` for the login function.\\n   */\\n\\tapplyLoginFunction(funcName, funcArgs) {\\n\\t\\tif (!this._loginFuncs[funcName]) {\\n\\t\\t\\tthrow new Error(`${funcName} was not defined`);\\n\\t\\t}\\n\\t\\treturn this._loginFuncs[funcName].apply(this, funcArgs);\\n\\t}\\n\\n\\t/**\\n\\t * @summary Log the user out.\\n\\t * @locus Client\\n\\t * @param {Function} [callback] Optional callback. Called with no arguments on success, or with a single `Error` argument on failure.\\n\\t */\\n\\tlogout(callback) {\\n\\t\\tthis._loggingOut.set(true);\\n\\n\\t\\tthis.connection\\n\\t\\t\\t.applyAsync('logout', [], {\\n\\t\\t\\t\\t// TODO[FIBERS]: Look this { wait: true } later.\\n\\t\\t\\t\\twait: true,\\n\\t\\t\\t})\\n\\t\\t\\t.then((result) => {\\n\\t\\t\\t\\tthis._loggingOut.set(false);\\n\\t\\t\\t\\tthis._loginCallbacksCalled = false;\\n\\t\\t\\t\\tthis.makeClientLoggedOut();\\n\\t\\t\\t\\tcallback && callback();\\n\\t\\t\\t})\\n\\t\\t\\t.catch((e) => {\\n\\t\\t\\t\\tthis._loggingOut.set(false);\\n\\t\\t\\t\\tcallback && callback(e);\\n\\t\\t\\t});\\n\\t}\\n\\n\\t/**\\n\\t * @summary Log out other clients logged in as the current user, but does not log out the client that calls this function.\\n\\t * @locus Client\\n\\t * @param {Function} [callback] Optional callback. Called with no arguments on success, or with a single `Error` argument on failure.\\n\\t */\\n\\tlogoutOtherClients(callback) {\\n\\t\\t// We need to make two method calls: one to replace our current token,\\n\\t\\t// and another to remove all tokens except the current one. We want to\\n\\t\\t// call these two methods one after the other, without any other\\n\\t\\t// methods running between them. For example, we don't want `logout`\\n\\t\\t// to be called in between our two method calls (otherwise the second\\n\\t\\t// method call would return an error). Another example: we don't want\\n\\t\\t// logout to be called before the callback for `getNewToken`;\\n\\t\\t// otherwise we would momentarily log the user out and then write a\\n\\t\\t// new token to localStorage.\\n\\t\\t//\\n\\t\\t// To accomplish this, we make both calls as wait methods, and queue\\n\\t\\t// them one after the other, without spinning off the event loop in\\n\\t\\t// between. Even though we queue `removeOtherTokens` before\\n\\t\\t// `getNewToken`, we won't actually send the `removeOtherTokens` call\\n\\t\\t// until the `getNewToken` callback has finished running, because they\\n\\t\\t// are both wait methods.\\n\\t\\tthis.connection.apply('getNewToken', [], { wait: true }, (err, result) => {\\n\\t\\t\\tif (!err) {\\n\\t\\t\\t\\tthis._storeLoginToken(this.userId(), result.token, result.tokenExpires);\\n\\t\\t\\t}\\n\\t\\t});\\n\\n\\t\\tthis.connection.apply('removeOtherTokens', [], { wait: true }, (err) => callback && callback(err));\\n\\t}\\n\\n\\t///\\n\\t/// LOGIN METHODS\\n\\t///\\n\\n\\t// Call a login method on the server.\\n\\t//\\n\\t// A login method is a method which on success calls `this.setUserId(id)` and\\n\\t// `Accounts._setLoginToken` on the server and returns an object with fields\\n\\t// 'id' (containing the user id), 'token' (containing a resume token), and\\n\\t// optionally `tokenExpires`.\\n\\t//\\n\\t// This function takes care of:\\n\\t//   - Updating the Meteor.loggingIn() reactive data source\\n\\t//   - Calling the method in 'wait' mode\\n\\t//   - On success, saving the resume token to localStorage\\n\\t//   - On success, calling Accounts.connection.setUserId()\\n\\t//   - Setting up an onReconnect handler which logs in with\\n\\t//     the resume token\\n\\t//\\n\\t// Options:\\n\\t// - methodName: The method to call (default 'login')\\n\\t// - methodArguments: The arguments for the method\\n\\t// - validateResult: If provided, will be called with the result of the\\n\\t//                 method. If it throws, the client will not be logged in (and\\n\\t//                 its error will be passed to the callback).\\n\\t// - userCallback: Will be called with no arguments once the user is fully\\n\\t//                 logged in, or with the error on error.\\n\\t//\\n\\tcallLoginMethod(options) {\\n\\t\\toptions = {\\n\\t\\t\\tmethodName: 'login',\\n\\t\\t\\tmethodArguments: [{}],\\n\\t\\t\\t_suppressLoggingIn: false,\\n\\t\\t\\t...options,\\n\\t\\t};\\n\\n\\t\\t// Set defaults for callback arguments to no-op functions; make sure we\\n\\t\\t// override falsey values too.\\n\\t\\t['validateResult', 'userCallback'].forEach((f) => {\\n\\t\\t\\tif (!options[f]) options[f] = () => null;\\n\\t\\t});\\n\\n\\t\\tlet called;\\n\\t\\t// Prepare callbacks: user provided and onLogin/onLoginFailure hooks.\\n\\t\\tconst loginCallbacks = ({ error, loginDetails }) => {\\n\\t\\t\\tif (!called) {\\n\\t\\t\\t\\tcalled = true;\\n\\t\\t\\t\\tif (!error) {\\n\\t\\t\\t\\t\\tthis._onLoginHook.forEach((callback) => {\\n\\t\\t\\t\\t\\t\\tcallback(loginDetails);\\n\\t\\t\\t\\t\\t\\treturn true;\\n\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\tthis._loginCallbacksCalled = true;\\n\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\tthis._loginCallbacksCalled = false;\\n\\t\\t\\t\\t\\tthis._onLoginFailureHook.forEach((callback) => {\\n\\t\\t\\t\\t\\t\\tcallback({ error });\\n\\t\\t\\t\\t\\t\\treturn true;\\n\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\toptions.userCallback(error, loginDetails);\\n\\t\\t\\t}\\n\\t\\t};\\n\\n\\t\\tlet reconnected = false;\\n\\n\\t\\t// We want to set up onReconnect as soon as we get a result token back from\\n\\t\\t// the server, without having to wait for subscriptions to rerun. This is\\n\\t\\t// because if we disconnect and reconnect between getting the result and\\n\\t\\t// getting the results of subscription rerun, we WILL NOT re-send this\\n\\t\\t// method (because we never re-send methods whose results we've received)\\n\\t\\t// but we WILL call loggedInAndDataReadyCallback at \\\"reconnect quiesce\\\"\\n\\t\\t// time. This will lead to makeClientLoggedIn(result.id) even though we\\n\\t\\t// haven't actually sent a login method!\\n\\t\\t//\\n\\t\\t// But by making sure that we send this \\\"resume\\\" login in that case (and\\n\\t\\t// calling makeClientLoggedOut if it fails), we'll end up with an accurate\\n\\t\\t// client-side userId. (It's important that livedata_connection guarantees\\n\\t\\t// that the \\\"reconnect quiesce\\\"-time call to loggedInAndDataReadyCallback\\n\\t\\t// will occur before the callback from the resume login call.)\\n\\t\\tconst onResultReceived = (err, result) => {\\n\\t\\t\\tif (err || !result || !result.token) {\\n\\t\\t\\t\\t// Leave onReconnect alone if there was an error, so that if the user was\\n\\t\\t\\t\\t// already logged in they will still get logged in on reconnect.\\n\\t\\t\\t\\t// See issue #4970.\\n\\t\\t\\t} else {\\n\\t\\t\\t\\t// First clear out any previously set Acccounts login onReconnect\\n\\t\\t\\t\\t// callback (to make sure we don't keep piling up duplicate callbacks,\\n\\t\\t\\t\\t// which would then all be triggered when reconnecting).\\n\\t\\t\\t\\tif (this._reconnectStopper) {\\n\\t\\t\\t\\t\\tthis._reconnectStopper.stop();\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tthis._reconnectStopper = DDP.onReconnect((conn) => {\\n\\t\\t\\t\\t\\tif (conn != this.connection) {\\n\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\treconnected = true;\\n\\t\\t\\t\\t\\t// If our token was updated in storage, use the latest one.\\n\\t\\t\\t\\t\\tconst storedToken = this._storedLoginToken();\\n\\t\\t\\t\\t\\tif (storedToken) {\\n\\t\\t\\t\\t\\t\\tresult = {\\n\\t\\t\\t\\t\\t\\t\\ttoken: storedToken,\\n\\t\\t\\t\\t\\t\\t\\ttokenExpires: this._storedLoginTokenExpires(),\\n\\t\\t\\t\\t\\t\\t};\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tif (!result.tokenExpires) result.tokenExpires = this._tokenExpiration(new Date());\\n\\t\\t\\t\\t\\tif (this._tokenExpiresSoon(result.tokenExpires)) {\\n\\t\\t\\t\\t\\t\\tthis.makeClientLoggedOut();\\n\\t\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\\tthis.callLoginMethod({\\n\\t\\t\\t\\t\\t\\t\\tmethodArguments: [{ resume: result.token }],\\n\\t\\t\\t\\t\\t\\t\\t// Reconnect quiescence ensures that the user doesn't see an\\n\\t\\t\\t\\t\\t\\t\\t// intermediate state before the login method finishes. So we don't\\n\\t\\t\\t\\t\\t\\t\\t// need to show a logging-in animation.\\n\\t\\t\\t\\t\\t\\t\\t_suppressLoggingIn: true,\\n\\t\\t\\t\\t\\t\\t\\tuserCallback: (error, loginDetails) => {\\n\\t\\t\\t\\t\\t\\t\\t\\tconst storedTokenNow = this._storedLoginToken();\\n\\t\\t\\t\\t\\t\\t\\t\\tif (error) {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// If we had a login error AND the current stored token is the\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// one that we tried to log in with, then declare ourselves\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// logged out. If there's a token in storage but it's not the\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// token that we tried to log in with, we don't know anything\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// about whether that token is valid or not, so do nothing. The\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// periodic localStorage poll will decide if we are logged in or\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// out with this token, if it hasn't already. Of course, even\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// with this check, another tab could insert a new valid token\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// immediately before we clear localStorage here, which would\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// lead to both tabs being logged out, but by checking the token\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// in storage right now we hope to make that unlikely to happen.\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t//\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// If there is no token in storage right now, we don't have to\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// do anything; whatever code removed the token from storage was\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// responsible for calling `makeClientLoggedOut()`, or the\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// periodic localStorage poll will call `makeClientLoggedOut`\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t// eventually if another tab wiped the token from storage.\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tif (storedTokenNow && storedTokenNow === result.token) {\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tthis.makeClientLoggedOut();\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t\\t\\t// Possibly a weird callback to call, but better than nothing if\\n\\t\\t\\t\\t\\t\\t\\t\\t// there is a reconnect between \\\"login result received\\\" and \\\"data\\n\\t\\t\\t\\t\\t\\t\\t\\t// ready\\\".\\n\\t\\t\\t\\t\\t\\t\\t\\tloginCallbacks({ error, loginDetails });\\n\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t});\\n\\t\\t\\t}\\n\\t\\t};\\n\\n\\t\\t// This callback is called once the local cache of the current-user\\n\\t\\t// subscription (and all subscriptions, in fact) are guaranteed to be up to\\n\\t\\t// date.\\n\\t\\tconst loggedInAndDataReadyCallback = (error, result) => {\\n\\t\\t\\t// If the login method returns its result but the connection is lost\\n\\t\\t\\t// before the data is in the local cache, it'll set an onReconnect (see\\n\\t\\t\\t// above). The onReconnect will try to log in using the token, and *it*\\n\\t\\t\\t// will call userCallback via its own version of this\\n\\t\\t\\t// loggedInAndDataReadyCallback. So we don't have to do anything here.\\n\\t\\t\\tif (reconnected) return;\\n\\n\\t\\t\\t// Note that we need to call this even if _suppressLoggingIn is true,\\n\\t\\t\\t// because it could be matching a _setLoggingIn(true) from a\\n\\t\\t\\t// half-completed pre-reconnect login method.\\n\\t\\t\\tif (error || !result) {\\n\\t\\t\\t\\terror = error || new Error(`No result from call to ${options.methodName}`);\\n\\t\\t\\t\\tloginCallbacks({ error });\\n\\t\\t\\t\\tthis._setLoggingIn(false);\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\t\\t\\ttry {\\n\\t\\t\\t\\toptions.validateResult(result);\\n\\t\\t\\t} catch (e) {\\n\\t\\t\\t\\tloginCallbacks({ error: e });\\n\\t\\t\\t\\tthis._setLoggingIn(false);\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\t// Make the client logged in. (The user data should already be loaded!)\\n\\t\\t\\tthis.makeClientLoggedIn(result.id, result.token, result.tokenExpires);\\n\\n\\t\\t\\t// use Tracker to make we sure have a user before calling the callbacks\\n\\t\\t\\tTracker.autorun(async (computation) => {\\n\\t\\t\\t\\tconst user = await Tracker.withComputation(computation, () => Meteor.userAsync());\\n\\n\\t\\t\\t\\tif (user) {\\n\\t\\t\\t\\t\\tloginCallbacks({ loginDetails: result });\\n\\t\\t\\t\\t\\tthis._setLoggingIn(false);\\n\\t\\t\\t\\t\\tcomputation.stop();\\n\\t\\t\\t\\t}\\n\\t\\t\\t});\\n\\t\\t};\\n\\n\\t\\tif (!options._suppressLoggingIn) {\\n\\t\\t\\tthis._setLoggingIn(true);\\n\\t\\t}\\n\\t\\tthis.connection.applyAsync(options.methodName, options.methodArguments, { wait: true, onResultReceived }, loggedInAndDataReadyCallback);\\n\\t}\\n\\n\\tmakeClientLoggedOut() {\\n\\t\\t// Ensure client was successfully logged in before running logout hooks.\\n\\t\\tif (this.connection._userId) {\\n\\t\\t\\tthis._onLogoutHook.each((callback) => {\\n\\t\\t\\t\\tcallback();\\n\\t\\t\\t\\treturn true;\\n\\t\\t\\t});\\n\\t\\t}\\n\\t\\tthis._unstoreLoginToken();\\n\\t\\tthis.connection.setUserId(null);\\n\\t\\tthis._reconnectStopper && this._reconnectStopper.stop();\\n\\t}\\n\\n\\tmakeClientLoggedIn(userId, token, tokenExpires) {\\n\\t\\tthis._storeLoginToken(userId, token, tokenExpires);\\n\\t\\tthis.connection.setUserId(userId);\\n\\t}\\n\\n\\t///\\n\\t/// LOGIN SERVICES\\n\\t///\\n\\n\\t// A reactive function returning whether the loginServiceConfiguration\\n\\t// subscription is ready. Used by accounts-ui to hide the login button\\n\\t// until we have all the configuration loaded\\n\\t//\\n\\tloginServicesConfigured() {\\n\\t\\treturn this._loginServicesHandle.ready();\\n\\t}\\n\\n\\t// Some login services such as the redirect login flow or the resume\\n\\t// login handler can log the user in at page load time.  The\\n\\t// Meteor.loginWithX functions have a callback argument, but the\\n\\t// callback function instance won't be in memory any longer if the\\n\\t// page was reloaded.  The `onPageLoadLogin` function allows a\\n\\t// callback to be registered for the case where the login was\\n\\t// initiated in a previous VM, and we now have the result of the login\\n\\t// attempt in a new VM.\\n\\n\\t// Register a callback to be called if we have information about a\\n\\t// login attempt at page load time.  Call the callback immediately if\\n\\t// we already have the page load login attempt info, otherwise stash\\n\\t// the callback to be called if and when we do get the attempt info.\\n\\t//\\n\\tonPageLoadLogin(f) {\\n\\t\\tif (this._pageLoadLoginAttemptInfo) {\\n\\t\\t\\tf(this._pageLoadLoginAttemptInfo);\\n\\t\\t} else {\\n\\t\\t\\tthis._pageLoadLoginCallbacks.push(f);\\n\\t\\t}\\n\\t}\\n\\n\\t// Receive the information about the login attempt at page load time.\\n\\t// Call registered callbacks, and also record the info in case\\n\\t// someone's callback hasn't been registered yet.\\n\\t//\\n\\t_pageLoadLogin(attemptInfo) {\\n\\t\\tif (this._pageLoadLoginAttemptInfo) {\\n\\t\\t\\tMeteor._debug('Ignoring unexpected duplicate page load login attempt info');\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tthis._pageLoadLoginCallbacks.forEach((callback) => callback(attemptInfo));\\n\\t\\tthis._pageLoadLoginCallbacks = [];\\n\\t\\tthis._pageLoadLoginAttemptInfo = attemptInfo;\\n\\t}\\n\\n\\t// _startupCallback executes on onLogin callbacks\\n\\t// at registration time if already logged in\\n\\t// this can happen when new AccountsClient is created\\n\\t// before callbacks are registered see #10157\\n\\t_startupCallback(callback) {\\n\\t\\t// Are we already logged in?\\n\\t\\tif (this._loginCallbacksCalled) {\\n\\t\\t\\t// If already logged in before handler is registered, it's safe to\\n\\t\\t\\t// assume type is a 'resume', so we execute the callback at the end\\n\\t\\t\\t// of the queue so that Meteor.startup can complete before any\\n\\t\\t\\t// embedded onLogin callbacks would execute.\\n\\t\\t\\tMeteor.setTimeout(() => callback({ type: 'resume' }), 0);\\n\\t\\t}\\n\\t}\\n\\n\\t///\\n\\t/// LOGIN TOKENS\\n\\t///\\n\\n\\t// These methods deal with storing a login token and user id in the\\n\\t// browser's localStorage facility. It polls local storage every few\\n\\t// seconds to synchronize login state between multiple tabs in the same\\n\\t// browser.\\n\\n\\tloginWithToken(token, callback) {\\n\\t\\tthis.callLoginMethod({\\n\\t\\t\\tmethodArguments: [\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\tresume: token,\\n\\t\\t\\t\\t},\\n\\t\\t\\t],\\n\\t\\t\\tuserCallback: callback,\\n\\t\\t});\\n\\t}\\n\\n\\t// Semi-internal API. Call this function to re-enable auto login after\\n\\t// if it was disabled at startup.\\n\\t_enableAutoLogin() {\\n\\t\\tthis._autoLoginEnabled = true;\\n\\t\\tthis._pollStoredLoginToken();\\n\\t}\\n\\n\\t///\\n\\t/// STORING\\n\\t///\\n\\n\\t// Call this from the top level of the test file for any test that does\\n\\t// logging in and out, to protect multiple tabs running the same tests\\n\\t// simultaneously from interfering with each others' localStorage.\\n\\t_isolateLoginTokenForTest() {\\n\\t\\tthis.LOGIN_TOKEN_KEY = this.LOGIN_TOKEN_KEY + Random.id();\\n\\t\\tthis.USER_ID_KEY = this.USER_ID_KEY + Random.id();\\n\\t}\\n\\n\\t_storeLoginToken(userId, token, tokenExpires) {\\n\\t\\tthis.storageLocation.setItem(this.USER_ID_KEY, userId);\\n\\t\\tthis.storageLocation.setItem(this.LOGIN_TOKEN_KEY, token);\\n\\t\\tif (!tokenExpires) tokenExpires = this._tokenExpiration(new Date());\\n\\t\\tthis.storageLocation.setItem(this.LOGIN_TOKEN_EXPIRES_KEY, tokenExpires);\\n\\n\\t\\t// to ensure that the localstorage poller doesn't end up trying to\\n\\t\\t// connect a second time\\n\\t\\tthis._lastLoginTokenWhenPolled = token;\\n\\t}\\n\\n\\t_unstoreLoginToken() {\\n\\t\\tthis.storageLocation.removeItem(this.USER_ID_KEY);\\n\\t\\tthis.storageLocation.removeItem(this.LOGIN_TOKEN_KEY);\\n\\t\\tthis.storageLocation.removeItem(this.LOGIN_TOKEN_EXPIRES_KEY);\\n\\n\\t\\t// to ensure that the localstorage poller doesn't end up trying to\\n\\t\\t// connect a second time\\n\\t\\tthis._lastLoginTokenWhenPolled = null;\\n\\t}\\n\\n\\t// This is private, but it is exported for now because it is used by a\\n\\t// test in accounts-password.\\n\\t_storedLoginToken() {\\n\\t\\treturn this.storageLocation.getItem(this.LOGIN_TOKEN_KEY);\\n\\t}\\n\\n\\t_storedLoginTokenExpires() {\\n\\t\\treturn this.storageLocation.getItem(this.LOGIN_TOKEN_EXPIRES_KEY);\\n\\t}\\n\\n\\t_storedUserId() {\\n\\t\\treturn this.storageLocation.getItem(this.USER_ID_KEY);\\n\\t}\\n\\n\\t_unstoreLoginTokenIfExpiresSoon() {\\n\\t\\tconst tokenExpires = this._storedLoginTokenExpires();\\n\\t\\tif (tokenExpires && this._tokenExpiresSoon(new Date(tokenExpires))) {\\n\\t\\t\\tthis._unstoreLoginToken();\\n\\t\\t}\\n\\t}\\n\\n\\t///\\n\\t/// AUTO-LOGIN\\n\\t///\\n\\n\\t_initLocalStorage() {\\n\\t\\t// Key names to use in localStorage\\n\\t\\tthis.LOGIN_TOKEN_KEY = 'Meteor.loginToken';\\n\\t\\tthis.LOGIN_TOKEN_EXPIRES_KEY = 'Meteor.loginTokenExpires';\\n\\t\\tthis.USER_ID_KEY = 'Meteor.userId';\\n\\n\\t\\tconst rootUrlPathPrefix = __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\\n\\t\\tif (rootUrlPathPrefix || this.connection !== Meteor.connection) {\\n\\t\\t\\t// We want to keep using the same keys for existing apps that do not\\n\\t\\t\\t// set a custom ROOT_URL_PATH_PREFIX, so that most users will not have\\n\\t\\t\\t// to log in again after an app updates to a version of Meteor that\\n\\t\\t\\t// contains this code, but it's generally preferable to namespace the\\n\\t\\t\\t// keys so that connections from distinct apps to distinct DDP URLs\\n\\t\\t\\t// will be distinct in Meteor._localStorage.\\n\\t\\t\\tlet namespace = `:${this.connection._stream.rawUrl}`;\\n\\t\\t\\tif (rootUrlPathPrefix) {\\n\\t\\t\\t\\tnamespace += `:${rootUrlPathPrefix}`;\\n\\t\\t\\t}\\n\\t\\t\\tthis.LOGIN_TOKEN_KEY += namespace;\\n\\t\\t\\tthis.LOGIN_TOKEN_EXPIRES_KEY += namespace;\\n\\t\\t\\tthis.USER_ID_KEY += namespace;\\n\\t\\t}\\n\\n\\t\\tlet token;\\n\\t\\tif (this._autoLoginEnabled) {\\n\\t\\t\\t// Immediately try to log in via local storage, so that any DDP\\n\\t\\t\\t// messages are sent after we have established our user account\\n\\t\\t\\tthis._unstoreLoginTokenIfExpiresSoon();\\n\\t\\t\\ttoken = this._storedLoginToken();\\n\\t\\t\\tif (token) {\\n\\t\\t\\t\\t// On startup, optimistically present us as logged in while the\\n\\t\\t\\t\\t// request is in flight. This reduces page flicker on startup.\\n\\t\\t\\t\\tconst userId = this._storedUserId();\\n\\t\\t\\t\\tuserId && this.connection.setUserId(userId);\\n\\t\\t\\t\\tthis.loginWithToken(token, (err) => {\\n\\t\\t\\t\\t\\tif (err) {\\n\\t\\t\\t\\t\\t\\tMeteor._debug(`Error logging in with token: ${err}`);\\n\\t\\t\\t\\t\\t\\tthis.makeClientLoggedOut();\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tthis._pageLoadLogin({\\n\\t\\t\\t\\t\\t\\ttype: 'resume',\\n\\t\\t\\t\\t\\t\\tallowed: !err,\\n\\t\\t\\t\\t\\t\\terror: err,\\n\\t\\t\\t\\t\\t\\tmethodName: 'login',\\n\\t\\t\\t\\t\\t\\t// XXX This is duplicate code with loginWithToken, but\\n\\t\\t\\t\\t\\t\\t// loginWithToken can also be called at other times besides\\n\\t\\t\\t\\t\\t\\t// page load.\\n\\t\\t\\t\\t\\t\\tmethodArguments: [{ resume: token }],\\n\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t});\\n\\t\\t\\t}\\n\\t\\t}\\n\\n\\t\\t// Poll local storage every 3 seconds to login if someone logged in in\\n\\t\\t// another tab\\n\\t\\tthis._lastLoginTokenWhenPolled = token;\\n\\n\\t\\tif (this._pollIntervalTimer) {\\n\\t\\t\\t// Unlikely that _initLocalStorage will be called more than once for\\n\\t\\t\\t// the same AccountsClient instance, but just in case...\\n\\t\\t\\tclearInterval(this._pollIntervalTimer);\\n\\t\\t}\\n\\n\\t\\tthis._pollIntervalTimer = setInterval(() => {\\n\\t\\t\\tthis._pollStoredLoginToken();\\n\\t\\t}, 3000);\\n\\t}\\n\\n\\t_pollStoredLoginToken() {\\n\\t\\tif (!this._autoLoginEnabled) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst currentLoginToken = this._storedLoginToken();\\n\\n\\t\\t// != instead of !== just to make sure undefined and null are treated the same\\n\\t\\tif (this._lastLoginTokenWhenPolled != currentLoginToken) {\\n\\t\\t\\tif (currentLoginToken) {\\n\\t\\t\\t\\tthis.loginWithToken(currentLoginToken, (err) => {\\n\\t\\t\\t\\t\\tif (err) {\\n\\t\\t\\t\\t\\t\\tthis.makeClientLoggedOut();\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t});\\n\\t\\t\\t} else {\\n\\t\\t\\t\\tthis.logout();\\n\\t\\t\\t}\\n\\t\\t}\\n\\n\\t\\tthis._lastLoginTokenWhenPolled = currentLoginToken;\\n\\t}\\n\\n\\t///\\n\\t/// URLS\\n\\t///\\n\\n\\t_initUrlMatching() {\\n\\t\\t// By default, allow the autologin process to happen.\\n\\t\\tthis._autoLoginEnabled = true;\\n\\n\\t\\t// We only support one callback per URL.\\n\\t\\tthis._accountsCallbacks = {};\\n\\n\\t\\t// Try to match the saved value of window.location.hash.\\n\\t\\tthis._attemptToMatchHash();\\n\\t}\\n\\n\\t// Separate out this functionality for testing\\n\\t_attemptToMatchHash() {\\n\\t\\tattemptToMatchHash(this, this.savedHash, defaultSuccessHandler);\\n\\t}\\n\\n\\t/**\\n\\t * @summary Register a function to call when a reset password link is clicked\\n\\t * in an email sent by\\n\\t * [`Accounts.sendResetPasswordEmail`](#accounts_sendresetpasswordemail).\\n\\t * This function should be called in top-level code, not inside\\n\\t * `Meteor.startup()`.\\n\\t * @memberof! Accounts\\n\\t * @name onResetPasswordLink\\n\\t * @param  {Function} callback The function to call. It is given two arguments:\\n\\t *\\n\\t * 1. `token`: A password reset token that can be passed to\\n\\t * [`Accounts.resetPassword`](#accounts_resetpassword).\\n\\t * 2. `done`: A function to call when the password reset UI flow is complete. The normal\\n\\t * login process is suspended until this function is called, so that the\\n\\t * password for user A can be reset even if user B was logged in.\\n\\t * @locus Client\\n\\t */\\n\\tonResetPasswordLink(callback) {\\n\\t\\tif (this._accountsCallbacks['reset-password']) {\\n\\t\\t\\tMeteor._debug('Accounts.onResetPasswordLink was called more than once. ' + 'Only one callback added will be executed.');\\n\\t\\t}\\n\\n\\t\\tthis._accountsCallbacks['reset-password'] = callback;\\n\\t}\\n\\n\\t/**\\n\\t * @summary Register a function to call when an email verification link is\\n\\t * clicked in an email sent by\\n\\t * [`Accounts.sendVerificationEmail`](#accounts_sendverificationemail).\\n\\t * This function should be called in top-level code, not inside\\n\\t * `Meteor.startup()`.\\n\\t * @memberof! Accounts\\n\\t * @name onEmailVerificationLink\\n\\t * @param  {Function} callback The function to call. It is given two arguments:\\n\\t *\\n\\t * 1. `token`: An email verification token that can be passed to\\n\\t * [`Accounts.verifyEmail`](#accounts_verifyemail).\\n\\t * 2. `done`: A function to call when the email verification UI flow is complete.\\n\\t * The normal login process is suspended until this function is called, so\\n\\t * that the user can be notified that they are verifying their email before\\n\\t * being logged in.\\n\\t * @locus Client\\n\\t */\\n\\tonEmailVerificationLink(callback) {\\n\\t\\tif (this._accountsCallbacks['verify-email']) {\\n\\t\\t\\tMeteor._debug('Accounts.onEmailVerificationLink was called more than once. ' + 'Only one callback added will be executed.');\\n\\t\\t}\\n\\n\\t\\tthis._accountsCallbacks['verify-email'] = callback;\\n\\t}\\n\\n\\t/**\\n\\t * @summary Register a function to call when an account enrollment link is\\n\\t * clicked in an email sent by\\n\\t * [`Accounts.sendEnrollmentEmail`](#accounts_sendenrollmentemail).\\n\\t * This function should be called in top-level code, not inside\\n\\t * `Meteor.startup()`.\\n\\t * @memberof! Accounts\\n\\t * @name onEnrollmentLink\\n\\t * @param  {Function} callback The function to call. It is given two arguments:\\n\\t *\\n\\t * 1. `token`: A password reset token that can be passed to\\n\\t * [`Accounts.resetPassword`](#accounts_resetpassword) to give the newly\\n\\t * enrolled account a password.\\n\\t * 2. `done`: A function to call when the enrollment UI flow is complete.\\n\\t * The normal login process is suspended until this function is called, so that\\n\\t * user A can be enrolled even if user B was logged in.\\n\\t * @locus Client\\n\\t */\\n\\tonEnrollmentLink(callback) {\\n\\t\\tif (this._accountsCallbacks['enroll-account']) {\\n\\t\\t\\tMeteor._debug('Accounts.onEnrollmentLink was called more than once. ' + 'Only one callback added will be executed.');\\n\\t\\t}\\n\\n\\t\\tthis._accountsCallbacks['enroll-account'] = callback;\\n\\t}\\n}\\n\\n/**\\n * @summary True if a login method (such as `Meteor.loginWithPassword`,\\n * `Meteor.loginWithFacebook`, or `Accounts.createUser`) is currently in\\n * progress. A reactive data source.\\n * @locus Client\\n * @importFromPackage meteor\\n */\\nMeteor.loggingIn = () => Accounts.loggingIn();\\n\\n/**\\n * @summary True if a logout method (such as `Meteor.logout`) is currently in\\n * progress. A reactive data source.\\n * @locus Client\\n * @importFromPackage meteor\\n */\\nMeteor.loggingOut = () => Accounts.loggingOut();\\n\\n/**\\n * @summary Log the user out.\\n * @locus Client\\n * @param {Function} [callback] Optional callback. Called with no arguments on success, or with a single `Error` argument on failure.\\n * @importFromPackage meteor\\n */\\nMeteor.logout = (callback) => Accounts.logout(callback);\\n\\n/**\\n * @summary Log out other clients logged in as the current user, but does not log out the client that calls this function.\\n * @locus Client\\n * @param {Function} [callback] Optional callback. Called with no arguments on success, or with a single `Error` argument on failure.\\n * @importFromPackage meteor\\n */\\nMeteor.logoutOtherClients = (callback) => Accounts.logoutOtherClients(callback);\\n\\n/**\\n * @summary Login with a Meteor access token.\\n * @locus Client\\n * @param {Object} [token] Local storage token for use with login across\\n * multiple tabs in the same browser.\\n * @param {Function} [callback] Optional callback. Called with no arguments on\\n * success.\\n * @importFromPackage meteor\\n */\\nMeteor.loginWithToken = (token, callback) => Accounts.loginWithToken(token, callback);\\n\\n///\\n/// HANDLEBARS HELPERS\\n///\\n\\n// If our app has a Blaze, register the {{currentUser}} and {{loggingIn}}\\n// global helpers.\\nif (Package.blaze) {\\n\\tconst { Template } = Package.blaze.Blaze;\\n\\n\\t/**\\n\\t * @global\\n\\t * @name  currentUser\\n\\t * @isHelper true\\n\\t * @summary Calls [Meteor.user()](#meteor_user). Use `{{#if currentUser}}` to check whether the user is logged in.\\n\\t */\\n\\tTemplate.registerHelper('currentUser', () => Meteor.user());\\n\\n\\t// TODO: the code above needs to be changed to Meteor.userAsync() when we have\\n\\t// a way to make it reactive using async.\\n\\t// Template.registerHelper('currentUserAsync',\\n\\t//  async () => await Meteor.userAsync());\\n\\n\\t/**\\n\\t * @global\\n\\t * @name  loggingIn\\n\\t * @isHelper true\\n\\t * @summary Calls [Meteor.loggingIn()](#meteor_loggingin).\\n\\t */\\n\\tTemplate.registerHelper('loggingIn', () => Meteor.loggingIn());\\n\\n\\t/**\\n\\t * @global\\n\\t * @name  loggingOut\\n\\t * @isHelper true\\n\\t * @summary Calls [Meteor.loggingOut()](#meteor_loggingout).\\n\\t */\\n\\tTemplate.registerHelper('loggingOut', () => Meteor.loggingOut());\\n\\n\\t/**\\n\\t * @global\\n\\t * @name  loggingInOrOut\\n\\t * @isHelper true\\n\\t * @summary Calls [Meteor.loggingIn()](#meteor_loggingin) or [Meteor.loggingOut()](#meteor_loggingout).\\n\\t */\\n\\tTemplate.registerHelper('loggingInOrOut', () => Meteor.loggingIn() || Meteor.loggingOut());\\n}\\n\\nconst defaultSuccessHandler = function (token, urlPart) {\\n\\t// put login in a suspended state to wait for the interaction to finish\\n\\tthis._autoLoginEnabled = false;\\n\\n\\t// wait for other packages to register callbacks\\n\\tMeteor.startup(() => {\\n\\t\\t// if a callback has been registered for this kind of token, call it\\n\\t\\tif (this._accountsCallbacks[urlPart]) {\\n\\t\\t\\tthis._accountsCallbacks[urlPart](token, () => this._enableAutoLogin());\\n\\t\\t}\\n\\t});\\n};\\n\\n// Note that both arguments are optional and are currently only passed by\\n// accounts_url_tests.js.\\nconst attemptToMatchHash = (accounts, hash, success) => {\\n\\t// All of the special hash URLs we support for accounts interactions\\n\\t['reset-password', 'verify-email', 'enroll-account'].forEach((urlPart) => {\\n\\t\\tlet token;\\n\\n\\t\\tconst tokenRegex = new RegExp(`^\\\\\\\\#\\\\\\\\/${urlPart}\\\\\\\\/(.*)$`);\\n\\t\\tconst match = hash.match(tokenRegex);\\n\\n\\t\\tif (match) {\\n\\t\\t\\ttoken = match[1];\\n\\n\\t\\t\\t// XXX COMPAT WITH 0.9.3\\n\\t\\t\\tif (urlPart === 'reset-password') {\\n\\t\\t\\t\\taccounts._resetPasswordToken = token;\\n\\t\\t\\t} else if (urlPart === 'verify-email') {\\n\\t\\t\\t\\taccounts._verifyEmailToken = token;\\n\\t\\t\\t} else if (urlPart === 'enroll-account') {\\n\\t\\t\\t\\taccounts._enrollAccountToken = token;\\n\\t\\t\\t}\\n\\t\\t} else {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\t// If no handlers match the hash, then maybe it's meant to be consumed\\n\\t\\t// by some entirely different code, so we only clear it the first time\\n\\t\\t// a handler successfully matches. Note that later handlers reuse the\\n\\t\\t// savedHash, so clearing window.location.hash here will not interfere\\n\\t\\t// with their needs.\\n\\t\\twindow.location.hash = '';\\n\\n\\t\\t// Do some stuff with the token we matched\\n\\t\\tsuccess.call(accounts, token, urlPart);\\n\\t});\\n};\\n\\n// Export for testing\\nexport const AccountsTest = {\\n\\tattemptToMatchHash: (hash, success) => attemptToMatchHash(Accounts, hash, success),\\n};\\n\",\"import { Meteor } from 'meteor/meteor';\\n\\n// config option keys\\nconst VALID_CONFIG_KEYS = [\\n  'sendVerificationEmail',\\n  'forbidClientAccountCreation',\\n  'restrictCreationByEmailDomain',\\n  'loginExpiration',\\n  'loginExpirationInDays',\\n  'oauthSecretKey',\\n  'passwordResetTokenExpirationInDays',\\n  'passwordResetTokenExpiration',\\n  'passwordEnrollTokenExpirationInDays',\\n  'passwordEnrollTokenExpiration',\\n  'ambiguousErrorMessages',\\n  'bcryptRounds',\\n  'defaultFieldSelector',\\n  'collection',\\n  'loginTokenExpirationHours',\\n  'tokenSequenceLength',\\n  'clientStorage',\\n  'ddpUrl',\\n  'connection',\\n];\\n\\n/**\\n * @summary Super-constructor for AccountsClient and AccountsServer.\\n * @locus Anywhere\\n * @class AccountsCommon\\n * @instancename accountsClientOrServer\\n * @param options {Object} an object with fields:\\n * - connection {Object} Optional DDP connection to reuse.\\n * - ddpUrl {String} Optional URL for creating a new DDP connection.\\n * - collection {String|Mongo.Collection} The name of the Mongo.Collection\\n *     or the Mongo.Collection object to hold the users.\\n */\\nexport class AccountsCommon {\\n  constructor(options) {\\n    // Validate config options keys\\n    for (const key of Object.keys(options)) {\\n      if (!VALID_CONFIG_KEYS.includes(key)) {\\n        console.error(`Accounts.config: Invalid key: ${key}`);\\n      }\\n    }\\n\\n    // Currently this is read directly by packages like accounts-password\\n    // and accounts-ui-unstyled.\\n    this._options = options || {};\\n\\n    // Note that setting this.connection = null causes this.users to be a\\n    // LocalCollection, which is not what we want.\\n    this.connection = undefined;\\n    this._initConnection(options || {});\\n\\n    // There is an allow call in accounts_server.js that restricts writes to\\n    // this collection.\\n    this.users = this._initializeCollection(options || {});\\n\\n    // Callback exceptions are printed with Meteor._debug and ignored.\\n    this._onLoginHook = new Hook({\\n      bindEnvironment: false,\\n      debugPrintExceptions: 'onLogin callback',\\n    });\\n\\n    this._onLoginFailureHook = new Hook({\\n      bindEnvironment: false,\\n      debugPrintExceptions: 'onLoginFailure callback',\\n    });\\n\\n    this._onLogoutHook = new Hook({\\n      bindEnvironment: false,\\n      debugPrintExceptions: 'onLogout callback',\\n    });\\n\\n    // Expose for testing.\\n    this.DEFAULT_LOGIN_EXPIRATION_DAYS = DEFAULT_LOGIN_EXPIRATION_DAYS;\\n    this.LOGIN_UNEXPIRING_TOKEN_DAYS = LOGIN_UNEXPIRING_TOKEN_DAYS;\\n\\n    // Thrown when the user cancels the login process (eg, closes an oauth\\n    // popup, declines retina scan, etc)\\n    const lceName = 'Accounts.LoginCancelledError';\\n    this.LoginCancelledError = Meteor.makeErrorType(lceName, function(\\n      description\\n    ) {\\n      this.message = description;\\n    });\\n    this.LoginCancelledError.prototype.name = lceName;\\n\\n    // This is used to transmit specific subclass errors over the wire. We\\n    // should come up with a more generic way to do this (eg, with some sort of\\n    // symbolic error code rather than a number).\\n    this.LoginCancelledError.numericError = 0x8acdc2f;\\n  }\\n\\n  _initializeCollection(options) {\\n    if (options.collection && typeof options.collection !== 'string' && !(options.collection instanceof Mongo.Collection)) {\\n      throw new Meteor.Error('Collection parameter can be only of type string or \\\"Mongo.Collection\\\"');\\n    }\\n\\n    let collectionName = 'users';\\n    if (typeof options.collection === 'string') {\\n      collectionName = options.collection;\\n    }\\n\\n    let collection;\\n    if (options.collection instanceof Mongo.Collection) {\\n      collection = options.collection;\\n    } else {\\n      collection = new Mongo.Collection(collectionName, {\\n        _preventAutopublish: true,\\n        connection: this.connection,\\n      });\\n    }\\n\\n    return collection;\\n  }\\n\\n  /**\\n   * @summary Get the current user id, or `null` if no user is logged in. A reactive data source.\\n   * @locus Anywhere\\n   */\\n  userId() {\\n    throw new Error('userId method not implemented');\\n  }\\n\\n  // merge the defaultFieldSelector with an existing options object\\n  _addDefaultFieldSelector(options = {}) {\\n    // this will be the most common case for most people, so make it quick\\n    if (!this._options.defaultFieldSelector) return options;\\n\\n    // if no field selector then just use defaultFieldSelector\\n    if (!options.fields)\\n      return {\\n        ...options,\\n        fields: this._options.defaultFieldSelector,\\n      };\\n\\n    // if empty field selector then the full user object is explicitly requested, so obey\\n    const keys = Object.keys(options.fields);\\n    if (!keys.length) return options;\\n\\n    // if the requested fields are +ve then ignore defaultFieldSelector\\n    // assume they are all either +ve or -ve because Mongo doesn't like mixed\\n    if (!!options.fields[keys[0]]) return options;\\n\\n    // The requested fields are -ve.\\n    // If the defaultFieldSelector is +ve then use requested fields, otherwise merge them\\n    const keys2 = Object.keys(this._options.defaultFieldSelector);\\n    return this._options.defaultFieldSelector[keys2[0]]\\n      ? options\\n      : {\\n          ...options,\\n          fields: {\\n            ...options.fields,\\n            ...this._options.defaultFieldSelector,\\n          },\\n        };\\n  }\\n\\n  /**\\n   * @summary Get the current user record, or `null` if no user is logged in. A reactive data source. In the server this fuction returns a promise.\\n   * @locus Anywhere\\n   * @param {Object} [options]\\n   * @param {MongoFieldSpecifier} options.fields Dictionary of fields to return or exclude.\\n   */\\n  user(options) {\\n    if (Meteor.isServer) {\\n      console.warn([\\n        \\\"`Meteor.user()` is deprecated on the server side.\\\",\\n        \\\"    To fetch the current user record on the server,\\\",\\n        \\\"    use `Meteor.userAsync()` instead.\\\",\\n      ].join(\\\"\\\\n\\\"));\\n    }\\n\\n    const self = this;\\n    const userId = self.userId();\\n    const findOne = (...args) => Meteor.isClient\\n      ? self.users.findOne(...args)\\n      : self.users.findOneAsync(...args);\\n    return userId\\n      ? findOne(userId, this._addDefaultFieldSelector(options))\\n      : null;\\n  }\\n\\n  /**\\n   * @summary Get the current user record, or `null` if no user is logged in.\\n   * @locus Anywhere\\n   * @param {Object} [options]\\n   * @param {MongoFieldSpecifier} options.fields Dictionary of fields to return or exclude.\\n   */\\n  async userAsync(options) {\\n    const userId = this.userId();\\n    return userId\\n      ? this.users.findOneAsync(userId, this._addDefaultFieldSelector(options))\\n      : null;\\n  }\\n  // Set up config for the accounts system. Call this on both the client\\n  // and the server.\\n  //\\n  // Note that this method gets overridden on AccountsServer.prototype, but\\n  // the overriding method calls the overridden method.\\n  //\\n  // XXX we should add some enforcement that this is called on both the\\n  // client and the server. Otherwise, a user can\\n  // 'forbidClientAccountCreation' only on the client and while it looks\\n  // like their app is secure, the server will still accept createUser\\n  // calls. https://github.com/meteor/meteor/issues/828\\n  //\\n  // @param options {Object} an object with fields:\\n  // - sendVerificationEmail {Boolean}\\n  //     Send email address verification emails to new users created from\\n  //     client signups.\\n  // - forbidClientAccountCreation {Boolean}\\n  //     Do not allow clients to create accounts directly.\\n  // - restrictCreationByEmailDomain {Function or String}\\n  //     Require created users to have an email matching the function or\\n  //     having the string as domain.\\n  // - loginExpirationInDays {Number}\\n  //     Number of days since login until a user is logged out (login token\\n  //     expires).\\n  // - collection {String|Mongo.Collection}\\n  //     A collection name or a Mongo.Collection object to hold the users.\\n  // - passwordResetTokenExpirationInDays {Number}\\n  //     Number of days since password reset token creation until the\\n  //     token can't be used any longer (password reset token expires).\\n  // - ambiguousErrorMessages {Boolean}\\n  //     Return ambiguous error messages from login failures to prevent\\n  //     user enumeration.\\n  // - bcryptRounds {Number}\\n  //     Allows override of number of bcrypt rounds (aka work factor) used\\n  //     to store passwords.\\n\\n  /**\\n   * @summary Set global accounts options. You can also set these in `Meteor.settings.packages.accounts` without the need to call this function.\\n   * @locus Anywhere\\n   * @param {Object} options\\n   * @param {Boolean} options.sendVerificationEmail New users with an email address will receive an address verification email.\\n   * @param {Boolean} options.forbidClientAccountCreation Calls to [`createUser`](#accounts_createuser) from the client will be rejected. In addition, if you are using [accounts-ui](#accountsui), the \\\"Create account\\\" link will not be available.\\n   * @param {String | Function} options.restrictCreationByEmailDomain If set to a string, only allows new users if the domain part of their email address matches the string. If set to a function, only allows new users if the function returns true.  The function is passed the full email address of the proposed new user.  Works with password-based sign-in and external services that expose email addresses (Google, Facebook, GitHub). All existing users still can log in after enabling this option. Example: `Accounts.config({ restrictCreationByEmailDomain: 'school.edu' })`.\\n   * @param {Number} options.loginExpiration The number of milliseconds from when a user logs in until their token expires and they are logged out, for a more granular control. If `loginExpirationInDays` is set, it takes precedent.\\n   * @param {Number} options.loginExpirationInDays The number of days from when a user logs in until their token expires and they are logged out. Defaults to 90. Set to `null` to disable login expiration.\\n   * @param {String} options.oauthSecretKey When using the `oauth-encryption` package, the 16 byte key using to encrypt sensitive account credentials in the database, encoded in base64.  This option may only be specified on the server.  See packages/oauth-encryption/README.md for details.\\n   * @param {Number} options.passwordResetTokenExpirationInDays The number of days from when a link to reset password is sent until token expires and user can't reset password with the link anymore. Defaults to 3.\\n   * @param {Number} options.passwordResetTokenExpiration The number of milliseconds from when a link to reset password is sent until token expires and user can't reset password with the link anymore. If `passwordResetTokenExpirationInDays` is set, it takes precedent.\\n   * @param {Number} options.passwordEnrollTokenExpirationInDays The number of days from when a link to set initial password is sent until token expires and user can't set password with the link anymore. Defaults to 30.\\n   * @param {Number} options.passwordEnrollTokenExpiration The number of milliseconds from when a link to set initial password is sent until token expires and user can't set password with the link anymore. If `passwordEnrollTokenExpirationInDays` is set, it takes precedent.\\n   * @param {Boolean} options.ambiguousErrorMessages Return ambiguous error messages from login failures to prevent user enumeration. Defaults to `false`, but in production environments it is recommended it defaults to `true`.\\n   * @param {Number} options.bcryptRounds Allows override of number of bcrypt rounds (aka work factor) used to store passwords. The default is 10.\\n   * @param {MongoFieldSpecifier} options.defaultFieldSelector To exclude by default large custom fields from `Meteor.user()` and `Meteor.findUserBy...()` functions when called without a field selector, and all `onLogin`, `onLoginFailure` and `onLogout` callbacks.  Example: `Accounts.config({ defaultFieldSelector: { myBigArray: 0 }})`. Beware when using this. If, for instance, you do not include `email` when excluding the fields, you can have problems with functions like `forgotPassword` that will break because they won't have the required data available. It's recommend that you always keep the fields `_id`, `username`, and `email`.\\n   * @param {String|Mongo.Collection} options.collection A collection name or a Mongo.Collection object to hold the users.\\n   * @param {Number} options.loginTokenExpirationHours When using the package `accounts-2fa`, use this to set the amount of time a token sent is valid. As it's just a number, you can use, for example, 0.5 to make the token valid for just half hour. The default is 1 hour.\\n   * @param {Number} options.tokenSequenceLength When using the package `accounts-2fa`, use this to the size of the token sequence generated. The default is 6.\\n   * @param {'session' | 'local'} options.clientStorage By default login credentials are stored in local storage, setting this to true will switch to using session storage.\\n   */\\n  config(options) {\\n    // We don't want users to accidentally only call Accounts.config on the\\n    // client, where some of the options will have partial effects (eg removing\\n    // the \\\"create account\\\" button from accounts-ui if forbidClientAccountCreation\\n    // is set, or redirecting Google login to a specific-domain page) without\\n    // having their full effects.\\n    if (Meteor.isServer) {\\n      __meteor_runtime_config__.accountsConfigCalled = true;\\n    } else if (!__meteor_runtime_config__.accountsConfigCalled) {\\n      // XXX would be nice to \\\"crash\\\" the client and replace the UI with an error\\n      // message, but there's no trivial way to do this.\\n      Meteor._debug(\\n        'Accounts.config was called on the client but not on the ' +\\n          'server; some configuration options may not take effect.'\\n      );\\n    }\\n\\n    // We need to validate the oauthSecretKey option at the time\\n    // Accounts.config is called. We also deliberately don't store the\\n    // oauthSecretKey in Accounts._options.\\n    if (Object.prototype.hasOwnProperty.call(options, 'oauthSecretKey')) {\\n      if (Meteor.isClient) {\\n        throw new Error(\\n          'The oauthSecretKey option may only be specified on the server'\\n        );\\n      }\\n      if (!Package['oauth-encryption']) {\\n        throw new Error(\\n          'The oauth-encryption package must be loaded to set oauthSecretKey'\\n        );\\n      }\\n      Package['oauth-encryption'].OAuthEncryption.loadKey(\\n        options.oauthSecretKey\\n      );\\n      options = { ...options };\\n      delete options.oauthSecretKey;\\n    }\\n\\n    // Validate config options keys\\n    for (const key of Object.keys(options)) {\\n      if (!VALID_CONFIG_KEYS.includes(key)) {\\n        console.error(`Accounts.config: Invalid key: ${key}`);\\n      }\\n    }\\n\\n    // set values in Accounts._options\\n    for (const key of VALID_CONFIG_KEYS) {\\n      if (key in options) {\\n        if (key in this._options) {\\n          if (key !== 'collection' && (Meteor.isTest && key !== 'clientStorage')) {\\n            throw new Meteor.Error(`Can't set \\\\`${key}\\\\` more than once`);\\n          }\\n        }\\n        this._options[key] = options[key];\\n      }\\n    }\\n\\n    if (options.collection && options.collection !== this.users._name && options.collection !== this.users) {\\n      this.users = this._initializeCollection(options);\\n    }\\n  }\\n\\n  /**\\n   * @summary Register a callback to be called after a login attempt succeeds.\\n   * @locus Anywhere\\n   * @param {Function} func The callback to be called when login is successful.\\n   *                        The callback receives a single object that\\n   *                        holds login details. This object contains the login\\n   *                        result type (password, resume, etc.) on both the\\n   *                        client and server. `onLogin` callbacks registered\\n   *                        on the server also receive extra data, such\\n   *                        as user details, connection information, etc.\\n   */\\n  onLogin(func) {\\n    let ret = this._onLoginHook.register(func);\\n    // call the just registered callback if already logged in\\n    this._startupCallback(ret.callback);\\n    return ret;\\n  }\\n\\n  /**\\n   * @summary Register a callback to be called after a login attempt fails.\\n   * @locus Anywhere\\n   * @param {Function} func The callback to be called after the login has failed.\\n   */\\n  onLoginFailure(func) {\\n    return this._onLoginFailureHook.register(func);\\n  }\\n\\n  /**\\n   * @summary Register a callback to be called after a logout attempt succeeds.\\n   * @locus Anywhere\\n   * @param {Function} func The callback to be called when logout is successful.\\n   */\\n  onLogout(func) {\\n    return this._onLogoutHook.register(func);\\n  }\\n\\n  _initConnection(options) {\\n    if (!Meteor.isClient) {\\n      return;\\n    }\\n\\n    // The connection used by the Accounts system. This is the connection\\n    // that will get logged in by Meteor.login(), and this is the\\n    // connection whose login state will be reflected by Meteor.userId().\\n    //\\n    // It would be much preferable for this to be in accounts_client.js,\\n    // but it has to be here because it's needed to create the\\n    // Meteor.users collection.\\n    if (options.connection) {\\n      this.connection = options.connection;\\n    } else if (options.ddpUrl) {\\n      this.connection = DDP.connect(options.ddpUrl);\\n    } else if (\\n      typeof __meteor_runtime_config__ !== 'undefined' &&\\n      __meteor_runtime_config__.ACCOUNTS_CONNECTION_URL\\n    ) {\\n      // Temporary, internal hook to allow the server to point the client\\n      // to a different authentication server. This is for a very\\n      // particular use case that comes up when implementing a oauth\\n      // server. Unsupported and may go away at any point in time.\\n      //\\n      // We will eventually provide a general way to use account-base\\n      // against any DDP connection, not just one special one.\\n      this.connection = DDP.connect(\\n        __meteor_runtime_config__.ACCOUNTS_CONNECTION_URL\\n      );\\n    } else {\\n      this.connection = Meteor.connection;\\n    }\\n  }\\n\\n  _getTokenLifetimeMs() {\\n    // When loginExpirationInDays is set to null, we'll use a really high\\n    // number of days (LOGIN_UNEXPIRABLE_TOKEN_DAYS) to simulate an\\n    // unexpiring token.\\n    const loginExpirationInDays =\\n      this._options.loginExpirationInDays === null\\n        ? LOGIN_UNEXPIRING_TOKEN_DAYS\\n        : this._options.loginExpirationInDays;\\n    return (\\n      this._options.loginExpiration ||\\n      (loginExpirationInDays || DEFAULT_LOGIN_EXPIRATION_DAYS) * 86400000\\n    );\\n  }\\n\\n  _getPasswordResetTokenLifetimeMs() {\\n    return (\\n      this._options.passwordResetTokenExpiration ||\\n      (this._options.passwordResetTokenExpirationInDays ||\\n        DEFAULT_PASSWORD_RESET_TOKEN_EXPIRATION_DAYS) * 86400000\\n    );\\n  }\\n\\n  _getPasswordEnrollTokenLifetimeMs() {\\n    return (\\n      this._options.passwordEnrollTokenExpiration ||\\n      (this._options.passwordEnrollTokenExpirationInDays ||\\n        DEFAULT_PASSWORD_ENROLL_TOKEN_EXPIRATION_DAYS) * 86400000\\n    );\\n  }\\n\\n  _tokenExpiration(when) {\\n    // We pass when through the Date constructor for backwards compatibility;\\n    // `when` used to be a number.\\n    return new Date(new Date(when).getTime() + this._getTokenLifetimeMs());\\n  }\\n\\n  _tokenExpiresSoon(when) {\\n    let minLifetimeMs = 0.1 * this._getTokenLifetimeMs();\\n    const minLifetimeCapMs = MIN_TOKEN_LIFETIME_CAP_SECS * 1000;\\n    if (minLifetimeMs > minLifetimeCapMs) {\\n      minLifetimeMs = minLifetimeCapMs;\\n    }\\n    return new Date() > new Date(when) - minLifetimeMs;\\n  }\\n\\n  // No-op on the server, overridden on the client.\\n  _startupCallback(callback) {}\\n}\\n\\n// Note that Accounts is defined separately in accounts_client.js and\\n// accounts_server.js.\\n\\n/**\\n * @summary Get the current user id, or `null` if no user is logged in. A reactive data source.\\n * @locus Anywhere\\n * @importFromPackage meteor\\n */\\nMeteor.userId = () => Accounts.userId();\\n\\n/**\\n * @summary Get the current user record, or `null` if no user is logged in. A reactive data source.\\n * @locus Anywhere\\n * @importFromPackage meteor\\n * @param {Object} [options]\\n * @param {MongoFieldSpecifier} options.fields Dictionary of fields to return or exclude.\\n */\\nMeteor.user = options => Accounts.user(options);\\n\\n/**\\n * @summary Get the current user record, or `null` if no user is logged in. A reactive data source.\\n * @locus Anywhere\\n * @importFromPackage meteor\\n * @param {Object} [options]\\n * @param {MongoFieldSpecifier} options.fields Dictionary of fields to return or exclude.\\n */\\nMeteor.userAsync = options => Accounts.userAsync(options);\\n\\n// how long (in days) until a login token expires\\nconst DEFAULT_LOGIN_EXPIRATION_DAYS = 90;\\n// how long (in days) until reset password token expires\\nconst DEFAULT_PASSWORD_RESET_TOKEN_EXPIRATION_DAYS = 3;\\n// how long (in days) until enrol password token expires\\nconst DEFAULT_PASSWORD_ENROLL_TOKEN_EXPIRATION_DAYS = 30;\\n// Clients don't try to auto-login with a token that is going to expire within\\n// .1 * DEFAULT_LOGIN_EXPIRATION_DAYS, capped at MIN_TOKEN_LIFETIME_CAP_SECS.\\n// Tries to avoid abrupt disconnects from expiring tokens.\\nconst MIN_TOKEN_LIFETIME_CAP_SECS = 3600; // one hour\\n// how often (in milliseconds) we check for expired tokens\\nexport const EXPIRE_TOKENS_INTERVAL_MS = 600 * 1000; // 10 minutes\\n// A large number of expiration days (approximately 100 years worth) that is\\n// used when creating unexpiring tokens.\\nconst LOGIN_UNEXPIRING_TOKEN_DAYS = 365 * 100;\\n\",null],\"names\":[\"AccountsClient\",\"AccountsTest\",\"module\",\"export\",\"Accounts\",\"exports\",\"link\",\"v\",\"runSetters\",\"_Meteor$settings\",\"Meteor\",\"settings\",\"_Meteor$settings$publ\",\"public\",\"_Meteor$settings$publ2\",\"packages\",\"accounts\",\"users\",\"default\",\"_regeneratorRuntime\",\"_objectSpread\",\"_inheritsLoose\",\"AccountsCommon\",\"_AccountsCommon\",\"options\",\"_this\",\"call\",\"_loggingIn\",\"ReactiveVar\",\"_loggingOut\",\"_loginServicesHandle\",\"connection\",\"subscribe\",\"_pageLoadLoginCallbacks\",\"_pageLoadLoginAttemptInfo\",\"savedHash\",\"window\",\"location\",\"hash\",\"_initUrlMatching\",\"initStorageLocation\",\"_initLocalStorage\",\"_loginFuncs\",\"_loginCallbacksCalled\",\"_proto\",\"prototype\",\"_Meteor$settings$publ3\",\"storageLocation\",\"clientStorage\",\"sessionStorage\",\"_localStorage\",\"config\",\"userId\",\"_setLoggingIn\",\"x\",\"set\",\"loggingIn\",\"get\",\"loggingOut\",\"registerClientLoginFunction\",\"funcName\",\"func\",\"Error\",\"callLoginFunction\",\"_len\",\"arguments\",\"length\",\"funcArgs\",\"Array\",\"_key\",\"apply\",\"applyLoginFunction\",\"logout\",\"callback\",\"_this2\",\"applyAsync\",\"wait\",\"then\",\"result\",\"makeClientLoggedOut\",\"catch\",\"e\",\"logoutOtherClients\",\"_this3\",\"err\",\"_storeLoginToken\",\"token\",\"tokenExpires\",\"callLoginMethod\",\"called\",\"_this4\",\"methodName\",\"methodArguments\",\"_suppressLoggingIn\",\"forEach\",\"f\",\"loginCallbacks\",\"_ref\",\"error\",\"loginDetails\",\"_onLoginFailureHook\",\"_onLoginHook\",\"userCallback\",\"reconnected\",\"onResultReceived\",\"_reconnectStopper\",\"stop\",\"DDP\",\"onReconnect\",\"conn\",\"storedToken\",\"_storedLoginToken\",\"_storedLoginTokenExpires\",\"_tokenExpiration\",\"Date\",\"_tokenExpiresSoon\",\"resume\",\"storedTokenNow\",\"validateResult\",\"makeClientLoggedIn\",\"id\",\"Tracker\",\"autorun\",\"computation\",\"async\",\"_context\",\"prev\",\"next\",\"awrap\",\"withComputation\",\"userAsync\",\"sent\",\"Promise\",\"_userId\",\"_onLogoutHook\",\"each\",\"_unstoreLoginToken\",\"setUserId\",\"loginServicesConfigured\",\"ready\",\"onPageLoadLogin\",\"push\",\"_pageLoadLogin\",\"attemptInfo\",\"_debug\",\"_startupCallback\",\"setTimeout\",\"type\",\"loginWithToken\",\"_enableAutoLogin\",\"_autoLoginEnabled\",\"_pollStoredLoginToken\",\"_isolateLoginTokenForTest\",\"LOGIN_TOKEN_KEY\",\"Random\",\"USER_ID_KEY\",\"setItem\",\"LOGIN_TOKEN_EXPIRES_KEY\",\"_lastLoginTokenWhenPolled\",\"removeItem\",\"getItem\",\"_storedUserId\",\"_unstoreLoginTokenIfExpiresSoon\",\"_this5\",\"rootUrlPathPrefix\",\"__meteor_runtime_config__\",\"ROOT_URL_PATH_PREFIX\",\"namespace\",\"_stream\",\"rawUrl\",\"allowed\",\"_pollIntervalTimer\",\"clearInterval\",\"setInterval\",\"_this6\",\"currentLoginToken\",\"_accountsCallbacks\",\"_attemptToMatchHash\",\"attemptToMatchHash\",\"defaultSuccessHandler\",\"onResetPasswordLink\",\"onEmailVerificationLink\",\"onEnrollmentLink\",\"Package\",\"blaze\",\"Template\",\"Blaze\",\"registerHelper\",\"user\",\"urlPart\",\"_this7\",\"startup\",\"success\",\"tokenRegex\",\"RegExp\",\"match\",\"_resetPasswordToken\",\"_verifyEmailToken\",\"_enrollAccountToken\",\"EXPIRE_TOKENS_INTERVAL_MS\",\"VALID_CONFIG_KEYS\",\"_i\",\"_Object$keys\",\"Object\",\"keys\",\"key\",\"includes\",\"console\",\"_options\",\"undefined\",\"_initConnection\",\"_initializeCollection\",\"Hook\",\"bindEnvironment\",\"debugPrintExceptions\",\"DEFAULT_LOGIN_EXPIRATION_DAYS\",\"LOGIN_UNEXPIRING_TOKEN_DAYS\",\"lceName\",\"LoginCancelledError\",\"makeErrorType\",\"description\",\"message\",\"name\",\"numericError\",\"collection\",\"Mongo\",\"Collection\",\"collectionName\",\"_preventAutopublish\",\"_addDefaultFieldSelector\",\"defaultFieldSelector\",\"fields\",\"keys2\",\"isServer\",\"warn\",\"self\",\"findOne\",\"_self$users\",\"_self$users2\",\"isClient\",\"findOneAsync\",\"abrupt\",\"accountsConfigCalled\",\"hasOwnProperty\",\"OAuthEncryption\",\"loadKey\",\"oauthSecretKey\",\"_i2\",\"_Object$keys2\",\"_i3\",\"_VALID_CONFIG_KEYS\",\"isTest\",\"_name\",\"onLogin\",\"ret\",\"register\",\"onLoginFailure\",\"onLogout\",\"ddpUrl\",\"connect\",\"ACCOUNTS_CONNECTION_URL\",\"_getTokenLifetimeMs\",\"loginExpirationInDays\",\"loginExpiration\",\"_getPasswordResetTokenLifetimeMs\",\"passwordResetTokenExpiration\",\"passwordResetTokenExpirationInDays\",\"DEFAULT_PASSWORD_RESET_TOKEN_EXPIRATION_DAYS\",\"_getPasswordEnrollTokenLifetimeMs\",\"passwordEnrollTokenExpiration\",\"passwordEnrollTokenExpirationInDays\",\"DEFAULT_PASSWORD_ENROLL_TOKEN_EXPIRATION_DAYS\",\"when\",\"getTime\",\"minLifetimeMs\",\"minLifetimeCapMs\",\"MIN_TOKEN_LIFETIME_CAP_SECS\"],\"mappings\":\"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\"}"}