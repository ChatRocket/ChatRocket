{"code":"function module(i,e,s){let t,o,n,r,l,a,u,c,d;s.link(\"meteor/meteor\",{Meteor(i){t=i}},0),s.link(\"meteor/tracker\",{Tracker(i){o=i}},1),s.link(\"../../../client/components/CreateDiscussion/CreateDiscussion\",{default(i){n=i}},2),s.link(\"../../../client/lib/imperativeModal\",{imperativeModal(i){r=i}},3),s.link(\"../../../client/lib/rooms/roomCoordinator\",{roomCoordinator(i){l=i}},4),s.link(\"../../../client/lib/utils/messageArgs\",{messageArgs(i){a=i}},5),s.link(\"../../authorization/client\",{hasPermission(i){u=i}},6),s.link(\"../../settings/client\",{settings(i){c=i}},7),s.link(\"../../ui-utils/client\",{MessageAction(i){d=i}},8),t.startup(()=>{o.autorun(()=>{if(!c.get(\"Discussion_enabled\"))return d.removeButton(\"start-discussion\");d.addButton({id:\"start-discussion\",icon:\"discussion\",label:\"Discussion_start\",type:\"communication\",context:[\"message\",\"message-mobile\",\"videoconf\"],async action(i,e){var s;let{message:t=a(this).msg,room:o}=e;r.open({component:n,props:{defaultParentRoom:(null==o?void 0:o.prid)||(null==o?void 0:o._id),onClose:r.close,parentMessageId:t._id,nameSuggestion:null==t?void 0:null===(s=t.msg)||void 0===s?void 0:s.substr(0,140)}})},condition(i){let{message:{u:{_id:e},drid:s,dcount:t},room:o,subscription:n,user:r}=i;if(s||!Number.isNaN(Number(t))||!n)return!1;let a=l.isLivechatRoom(o.t);return!a&&!!r&&(e!==r._id?u(\"start-discussion-other-user\",o._id):u(\"start-discussion\",o._id))},order:1,group:\"menu\"})})})}","map":"{\"version\":3,\"sources\":[\"app/discussion/client/createDiscussionMessageAction.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport CreateDiscussion from '../../../client/components/CreateDiscussion/CreateDiscussion';\\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\\nimport { roomCoordinator } from '../../../client/lib/rooms/roomCoordinator';\\nimport { messageArgs } from '../../../client/lib/utils/messageArgs';\\nimport { hasPermission } from '../../authorization/client';\\nimport { settings } from '../../settings/client';\\nimport { MessageAction } from '../../ui-utils/client';\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(() => {\\n\\t\\tif (!settings.get('Discussion_enabled')) {\\n\\t\\t\\treturn MessageAction.removeButton('start-discussion');\\n\\t\\t}\\n\\n\\t\\tMessageAction.addButton({\\n\\t\\t\\tid: 'start-discussion',\\n\\t\\t\\ticon: 'discussion',\\n\\t\\t\\tlabel: 'Discussion_start',\\n\\t\\t\\ttype: 'communication',\\n\\t\\t\\tcontext: ['message', 'message-mobile', 'videoconf'],\\n\\t\\t\\tasync action(_, props) {\\n\\t\\t\\t\\tconst { message = messageArgs(this).msg, room } = props;\\n\\n\\t\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\t\\tcomponent: CreateDiscussion,\\n\\t\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\t\\tdefaultParentRoom: room?.prid || room?._id,\\n\\t\\t\\t\\t\\t\\tonClose: imperativeModal.close,\\n\\t\\t\\t\\t\\t\\tparentMessageId: message._id,\\n\\t\\t\\t\\t\\t\\tnameSuggestion: message?.msg?.substr(0, 140),\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t});\\n\\t\\t\\t},\\n\\t\\t\\tcondition({\\n\\t\\t\\t\\tmessage: {\\n\\t\\t\\t\\t\\tu: { _id: uid },\\n\\t\\t\\t\\t\\tdrid,\\n\\t\\t\\t\\t\\tdcount,\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\troom,\\n\\t\\t\\t\\tsubscription,\\n\\t\\t\\t\\tuser,\\n\\t\\t\\t}) {\\n\\t\\t\\t\\tif (drid || !Number.isNaN(Number(dcount))) {\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tif (!subscription) {\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room.t);\\n\\t\\t\\t\\tif (isLivechatRoom) {\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (!user) {\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\treturn uid !== user._id ? hasPermission('start-discussion-other-user', room._id) : hasPermission('start-discussion', room._id);\\n\\t\\t\\t},\\n\\t\\t\\torder: 1,\\n\\t\\t\\tgroup: 'menu',\\n\\t\\t});\\n\\t});\\n});\\n\",null],\"names\":[\"Meteor\",\"Tracker\",\"CreateDiscussion\",\"imperativeModal\",\"roomCoordinator\",\"messageArgs\",\"hasPermission\",\"settings\",\"MessageAction\",\"module\",\"link\",\"v\",\"default\",\"startup\",\"autorun\",\"get\",\"removeButton\",\"addButton\",\"id\",\"icon\",\"label\",\"type\",\"context\",\"action\",\"_\",\"props\",\"_message$msg\",\"message\",\"msg\",\"room\",\"open\",\"component\",\"defaultParentRoom\",\"prid\",\"_id\",\"onClose\",\"close\",\"parentMessageId\",\"nameSuggestion\",\"substr\",\"condition\",\"_ref\",\"u\",\"uid\",\"drid\",\"dcount\",\"subscription\",\"user\",\"Number\",\"isNaN\",\"isLivechatRoom\",\"t\",\"order\",\"group\"],\"mappings\":\"2BAAAA,EAAuCC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA9BC,EAAQC,IAAA,CAAM,gBAAgB,CAAAV,OAAAW,CAAA,EAAAX,EAAAW,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,iBAAA,CAAAT,QAAAU,CAAA,EAAAV,EAAAU,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,+DAAA,CAAAE,QAAAD,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,sCAAA,CAAAP,gBAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,4CAAA,CAAAN,gBAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,wCAAA,CAAAL,YAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,6BAAA,CAAAJ,cAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,wBAAA,CAAAH,SAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,wBAAA,CAAAF,cAAAG,CAAA,EAAAH,EAAAG,CAAA,CAAA,EAAA,GAWvCX,EAAOa,OAAO,CAAC,KACdZ,EAAQa,OAAO,CAAC,KACf,GAAI,CAACP,EAASQ,GAAG,CAAC,sBACjB,OAAOP,EAAcQ,YAAY,CAAC,oBAGnCR,EAAcS,SAAS,CAAC,CACvBC,GAAI,mBACJC,KAAM,aACNC,MAAO,mBACPC,KAAM,gBACNC,QAAS,CAAC,UAAW,iBAAkB,YAAY,CACnD,MAAMC,OAAOC,CAAC,CAAEC,CAAK,EAAA,IAAAC,EACpB,GAAM,CAAEC,QAAAA,EAAUtB,EAAY,IAAI,EAAEuB,GAAG,CAAEC,KAAAA,CAAAA,CAAM,CAAGJ,EAElDtB,EAAgB2B,IAAI,CAAC,CACpBC,UAAW7B,EACXuB,MAAO,CACNO,kBAAmB,AAAAH,CAAAA,MAAAA,EAAI,KAAA,EAAJA,EAAMI,IAAI,AAAJA,GAAQJ,CAAAA,MAAAA,EAAI,KAAA,EAAJA,EAAMK,GAAG,AAAHA,EACvCC,QAAShC,EAAgBiC,KAAK,CAC9BC,gBAAiBV,EAAQO,GAAG,CAC5BI,eAAgBX,MAAAA,EAAO,KAAA,EAAA,AAAK,OAALD,CAAAA,EAAPC,EAASC,GAAG,AAAHA,GAAGF,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAZA,EAAca,MAAM,CAAC,EAAG,OAG3C,EACAC,UAASC,CAAA,EASR,GATS,CACTd,QAAS,CACRe,EAAG,CAAER,IAAKS,CAAAA,CAAK,CACfC,KAAAA,CAAI,CACJC,OAAAA,CAAAA,CACA,CACDhB,KAAAA,CAAI,CACJiB,aAAAA,CAAY,CACZC,KAAAA,CAAAA,CACA,CAAAN,EACA,GAAIG,GAAQ,CAACI,OAAOC,KAAK,CAACD,OAAOH,KAG7B,CAACC,EAFJ,MAAO,CAAA,EAKR,IAAMI,EAAiB9C,EAAgB8C,cAAc,CAACrB,EAAKsB,CAAC,QAC5D,CAAID,IAIA,CAACH,GAIEJ,CAAAA,IAAQI,EAAKb,GAAG,CAAG5B,EAAc,8BAA+BuB,EAAKK,GAAG,EAAI5B,EAAc,mBAAoBuB,EAAKK,GAAG,CAAA,CAC9H,EACAkB,MAAO,EACPC,MAAO,QAET,EACD\"}"}