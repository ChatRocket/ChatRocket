{"code":"function module(t,e,n){n.link(\"@babel/runtime/regenerator\",{default:function(t){r=t}},0),n.link(\"@babel/runtime/helpers/createForOfIteratorHelperLoose\",{default:function(t){s=t}},1),n.export({UserStatuses:function(){return i},userStatuses:function(){return o}}),n.link(\"@rocket.chat/core-typings\",{UserStatus:function(t){u=t}},0),n.link(\"../../app/utils/client/lib/SDKClient\",{sdk:function(t){a=t}},1);var r,s,u,a,i=function(){function t(){this.invisibleAllowed=!0,this.store=new Map([u.ONLINE,u.AWAY,u.BUSY,u.OFFLINE].map(function(t){return[t,{id:t,name:t,statusType:t,localizeName:!0}]}))}var e=t.prototype;return e.delete=function(t){this.store.delete(t)},e.put=function(t){this.store.set(t.id,t)},e.createFromCustom=function(t){if(!this.isValidType(t.statusType))throw Error(\"Invalid user status type\");return{name:t.name,id:t._id,statusType:t.statusType,localizeName:!1}},e.isValidType=function(t){return Object.values(u).includes(t)},e[Symbol.iterator]=r.mark(function t(){var e,n,a;return r.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=s(this.store.values());case 1:if((n=e()).done){t.next=8;break}if(a=n.value,!(this.invisibleAllowed||a.statusType!==u.OFFLINE)){t.next=6;break}return t.next=6,a;case 6:t.next=1;break;case 8:case\"end\":return t.stop()}},t,this)}),e.sync=function(){var t,e,n,u;return r.async(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,r.awrap(a.call(\"listCustomUserStatus\"));case 2:if(t=i.sent){i.next=5;break}return i.abrupt(\"return\");case 5:for(e=s(t);!(n=e()).done;)u=n.value,this.put(this.createFromCustom(u));case 6:case\"end\":return i.stop()}},null,this,null,Promise)},e.watch=function(t){var e=this,n=a.stream(\"notify-logged\",[\"updateCustomUserStatus\"],function(n){e.put(e.createFromCustom(n.userStatusData)),null==t||t()}),r=a.stream(\"notify-logged\",[\"deleteCustomUserStatus\"],function(n){e.delete(n.userStatusData._id),null==t||t()});return function(){n.stop(),r.stop()}},t}(),o=new i}","map":"{\"version\":3,\"sources\":[\"client/lib/userStatuses.ts\",\"<anon>\"],\"sourcesContent\":[\"import { UserStatus } from '@rocket.chat/core-typings';\\nimport type { ICustomUserStatus } from '@rocket.chat/core-typings';\\n\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\n\\nexport type UserStatusDescriptor = {\\n\\tid: string;\\n\\tname: string;\\n\\tstatusType: UserStatus;\\n\\tlocalizeName: boolean;\\n};\\n\\nexport class UserStatuses implements Iterable<UserStatusDescriptor> {\\n\\tpublic invisibleAllowed = true;\\n\\n\\tprivate store: Map<UserStatusDescriptor['id'], UserStatusDescriptor> = new Map(\\n\\t\\t[UserStatus.ONLINE, UserStatus.AWAY, UserStatus.BUSY, UserStatus.OFFLINE].map((status) => [\\n\\t\\t\\tstatus,\\n\\t\\t\\t{\\n\\t\\t\\t\\tid: status,\\n\\t\\t\\t\\tname: status,\\n\\t\\t\\t\\tstatusType: status,\\n\\t\\t\\t\\tlocalizeName: true,\\n\\t\\t\\t},\\n\\t\\t]),\\n\\t);\\n\\n\\tpublic delete(id: string): void {\\n\\t\\tthis.store.delete(id);\\n\\t}\\n\\n\\tpublic put(customUserStatus: UserStatusDescriptor): void {\\n\\t\\tthis.store.set(customUserStatus.id, customUserStatus);\\n\\t}\\n\\n\\tpublic createFromCustom(customUserStatus: ICustomUserStatus): UserStatusDescriptor {\\n\\t\\tif (!this.isValidType(customUserStatus.statusType)) {\\n\\t\\t\\tthrow new Error('Invalid user status type');\\n\\t\\t}\\n\\n\\t\\treturn {\\n\\t\\t\\tname: customUserStatus.name,\\n\\t\\t\\tid: customUserStatus._id,\\n\\t\\t\\tstatusType: customUserStatus.statusType as UserStatus,\\n\\t\\t\\tlocalizeName: false,\\n\\t\\t};\\n\\t}\\n\\n\\tpublic isValidType(type: string): type is UserStatus {\\n\\t\\treturn (Object.values(UserStatus) as string[]).includes(type);\\n\\t}\\n\\n\\tpublic *[Symbol.iterator]() {\\n\\t\\tfor (const value of this.store.values()) {\\n\\t\\t\\tif (this.invisibleAllowed || value.statusType !== UserStatus.OFFLINE) {\\n\\t\\t\\t\\tyield value;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n\\n\\tpublic async sync() {\\n\\t\\tconst result = await sdk.call('listCustomUserStatus');\\n\\t\\tif (!result) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tfor (const customStatus of result) {\\n\\t\\t\\tthis.put(this.createFromCustom(customStatus));\\n\\t\\t}\\n\\t}\\n\\n\\tpublic watch(cb?: () => void) {\\n\\t\\tconst updateSubscription = sdk.stream('notify-logged', ['updateCustomUserStatus'], (data) => {\\n\\t\\t\\tthis.put(this.createFromCustom(data.userStatusData));\\n\\t\\t\\tcb?.();\\n\\t\\t});\\n\\n\\t\\tconst deleteSubscription = sdk.stream('notify-logged', ['deleteCustomUserStatus'], (data) => {\\n\\t\\t\\tthis.delete(data.userStatusData._id);\\n\\t\\t\\tcb?.();\\n\\t\\t});\\n\\n\\t\\treturn () => {\\n\\t\\t\\tupdateSubscription.stop();\\n\\t\\t\\tdeleteSubscription.stop();\\n\\t\\t};\\n\\t}\\n}\\n\\nexport const userStatuses = new UserStatuses();\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"_createForOfIteratorHelperLoose\",\"export\",\"UserStatuses\",\"userStatuses\",\"UserStatus\",\"sdk\",\"invisibleAllowed\",\"store\",\"Map\",\"ONLINE\",\"AWAY\",\"BUSY\",\"OFFLINE\",\"map\",\"status\",\"id\",\"name\",\"statusType\",\"localizeName\",\"_proto\",\"prototype\",\"delete\",\"put\",\"customUserStatus\",\"set\",\"createFromCustom\",\"isValidType\",\"Error\",\"_id\",\"type\",\"Object\",\"values\",\"includes\",\"Symbol\",\"iterator\",\"mark\",\"_callee\",\"_iterator\",\"_step\",\"value\",\"wrap\",\"_context\",\"prev\",\"next\",\"done\",\"stop\",\"sync\",\"result\",\"_iterator2\",\"_step2\",\"customStatus\",\"async\",\"_context2\",\"awrap\",\"call\",\"sent\",\"abrupt\",\"Promise\",\"watch\",\"cb\",\"_this\",\"updateSubscription\",\"stream\",\"data\",\"userStatusData\",\"deleteSubscription\"],\"mappings\":\"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\"}"}