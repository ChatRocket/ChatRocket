{"code":"function module(e,t,i){let a,n,l,r,o,u,d;i.export({DeviceProvider:()=>c}),i.link(\"@rocket.chat/fuselage-hooks\",{useMutableCallback(e){a=e}},0),i.link(\"@rocket.chat/ui-contexts\",{DeviceContext(e){n=e}},1),i.link(\"react\",{default(e){l=e},useEffect(e){r=e},useState(e){o=e},useMemo(e){u=e}},2),i.link(\"./lib/isSetSinkIdAvailable\",{isSetSinkIdAvailable(e){d=e}},3);let c=e=>{let{children:t}=e,[i]=o(typeof isSecureContext&&isSecureContext),[c,s]=o([]),[v,h]=o([]),[k,b]=o({id:\"default\",label:\"\",type:\"audio\"}),[f,S]=o({id:\"default\",label:\"\",type:\"audio\"}),p=e=>{if(!isSecureContext)throw Error(\"Device Changes are not available on insecure contexts\");S(e)},g=a(e=>{let{outputDevice:t,HTMLAudioElement:a}=e;if(!d())throw Error(\"setSinkId is not available in this browser\");if(!i)throw Error(\"Device Changes are not available on insecure contexts\");b(t),a.setSinkId(t.id)});r(()=>{var e;if(!i)return;let t=()=>{var e;null===(e=navigator.mediaDevices)||void 0===e||e.enumerateDevices().then(e=>{let t=[],i=[];e.forEach(e=>{let a={id:e.deviceId,label:e.label,type:e.kind};\"audioinput\"===e.kind?t.push(a):\"audiooutput\"===e.kind&&i.push(a)}),s(i),h(t)})};return null===(e=navigator.mediaDevices)||void 0===e||e.addEventListener(\"devicechange\",t),t(),()=>{var e;null===(e=navigator.mediaDevices)||void 0===e||e.removeEventListener(\"devicechange\",t)}},[i]);let m=u(()=>i?{enabled:i,availableAudioOutputDevices:c,availableAudioInputDevices:v,selectedAudioOutputDevice:k,selectedAudioInputDevice:f,setAudioOutputDevice:g,setAudioInputDevice:p}:{enabled:i},[v,c,i,f,k,g]);return l.createElement(n.Provider,{value:m},t)}}","map":"{\"version\":3,\"sources\":[\"client/providers/DeviceProvider/DeviceProvider.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\\nimport type { Device, DeviceContextValue } from '@rocket.chat/ui-contexts';\\nimport { DeviceContext } from '@rocket.chat/ui-contexts';\\nimport type { ReactElement, ReactNode } from 'react';\\nimport React, { useEffect, useState, useMemo } from 'react';\\n\\nimport { isSetSinkIdAvailable } from './lib/isSetSinkIdAvailable';\\n\\ntype DeviceProviderProps = {\\n\\tchildren?: ReactNode | undefined;\\n};\\n\\nexport const DeviceProvider = ({ children }: DeviceProviderProps): ReactElement => {\\n\\tconst [enabled] = useState(typeof isSecureContext && isSecureContext);\\n\\tconst [availableAudioOutputDevices, setAvailableAudioOutputDevices] = useState<Device[]>([]);\\n\\tconst [availableAudioInputDevices, setAvailableAudioInputDevices] = useState<Device[]>([]);\\n\\tconst [selectedAudioOutputDevice, setSelectedAudioOutputDevice] = useState<Device>({\\n\\t\\tid: 'default',\\n\\t\\tlabel: '',\\n\\t\\ttype: 'audio',\\n\\t});\\n\\tconst [selectedAudioInputDevice, setSelectedAudioInputDevice] = useState<Device>({\\n\\t\\tid: 'default',\\n\\t\\tlabel: '',\\n\\t\\ttype: 'audio',\\n\\t});\\n\\n\\tconst setAudioInputDevice = (device: Device): void => {\\n\\t\\tif (!isSecureContext) {\\n\\t\\t\\tthrow new Error('Device Changes are not available on insecure contexts');\\n\\t\\t}\\n\\t\\tsetSelectedAudioInputDevice(device);\\n\\t};\\n\\n\\tconst setAudioOutputDevice = useMutableCallback(\\n\\t\\t({ outputDevice, HTMLAudioElement }: { outputDevice: Device; HTMLAudioElement: HTMLAudioElement }): void => {\\n\\t\\t\\tif (!isSetSinkIdAvailable()) {\\n\\t\\t\\t\\tthrow new Error('setSinkId is not available in this browser');\\n\\t\\t\\t}\\n\\t\\t\\tif (!enabled) {\\n\\t\\t\\t\\tthrow new Error('Device Changes are not available on insecure contexts');\\n\\t\\t\\t}\\n\\t\\t\\tsetSelectedAudioOutputDevice(outputDevice);\\n\\t\\t\\tHTMLAudioElement.setSinkId(outputDevice.id);\\n\\t\\t},\\n\\t);\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!enabled) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tconst setMediaDevices = (): void => {\\n\\t\\t\\tnavigator.mediaDevices?.enumerateDevices().then((devices) => {\\n\\t\\t\\t\\tconst audioInput: Device[] = [];\\n\\t\\t\\t\\tconst audioOutput: Device[] = [];\\n\\t\\t\\t\\tdevices.forEach((device) => {\\n\\t\\t\\t\\t\\tconst mediaDevice: Device = {\\n\\t\\t\\t\\t\\t\\tid: device.deviceId,\\n\\t\\t\\t\\t\\t\\tlabel: device.label,\\n\\t\\t\\t\\t\\t\\ttype: device.kind,\\n\\t\\t\\t\\t\\t};\\n\\t\\t\\t\\t\\tif (device.kind === 'audioinput') {\\n\\t\\t\\t\\t\\t\\taudioInput.push(mediaDevice);\\n\\t\\t\\t\\t\\t} else if (device.kind === 'audiooutput') {\\n\\t\\t\\t\\t\\t\\taudioOutput.push(mediaDevice);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t});\\n\\t\\t\\t\\tsetAvailableAudioOutputDevices(audioOutput);\\n\\t\\t\\t\\tsetAvailableAudioInputDevices(audioInput);\\n\\t\\t\\t});\\n\\t\\t};\\n\\n\\t\\tnavigator.mediaDevices?.addEventListener('devicechange', setMediaDevices);\\n\\t\\tsetMediaDevices();\\n\\n\\t\\treturn (): void => {\\n\\t\\t\\tnavigator.mediaDevices?.removeEventListener('devicechange', setMediaDevices);\\n\\t\\t};\\n\\t}, [enabled]);\\n\\n\\tconst contextValue = useMemo((): DeviceContextValue => {\\n\\t\\tif (!enabled) {\\n\\t\\t\\treturn {\\n\\t\\t\\t\\tenabled,\\n\\t\\t\\t};\\n\\t\\t}\\n\\n\\t\\treturn {\\n\\t\\t\\tenabled,\\n\\t\\t\\tavailableAudioOutputDevices,\\n\\t\\t\\tavailableAudioInputDevices,\\n\\t\\t\\tselectedAudioOutputDevice,\\n\\t\\t\\tselectedAudioInputDevice,\\n\\t\\t\\tsetAudioOutputDevice,\\n\\t\\t\\tsetAudioInputDevice,\\n\\t\\t};\\n\\t}, [\\n\\t\\tavailableAudioInputDevices,\\n\\t\\tavailableAudioOutputDevices,\\n\\t\\tenabled,\\n\\t\\tselectedAudioInputDevice,\\n\\t\\tselectedAudioOutputDevice,\\n\\t\\tsetAudioOutputDevice,\\n\\t]);\\n\\treturn <DeviceContext.Provider value={contextValue}>{children}</DeviceContext.Provider>;\\n};\\n\",null],\"names\":[\"useMutableCallback\",\"DeviceContext\",\"React\",\"useEffect\",\"useState\",\"useMemo\",\"isSetSinkIdAvailable\",\"module\",\"export\",\"DeviceProvider\",\"link\",\"v\",\"default\",\"_ref\",\"children\",\"enabled\",\"isSecureContext\",\"availableAudioOutputDevices\",\"setAvailableAudioOutputDevices\",\"availableAudioInputDevices\",\"setAvailableAudioInputDevices\",\"selectedAudioOutputDevice\",\"setSelectedAudioOutputDevice\",\"id\",\"label\",\"type\",\"selectedAudioInputDevice\",\"setSelectedAudioInputDevice\",\"setAudioInputDevice\",\"device\",\"Error\",\"setAudioOutputDevice\",\"_ref2\",\"outputDevice\",\"HTMLAudioElement\",\"setSinkId\",\"_navigator$mediaDevic2\",\"setMediaDevices\",\"_navigator$mediaDevic\",\"navigator\",\"mediaDevices\",\"enumerateDevices\",\"then\",\"devices\",\"audioInput\",\"audioOutput\",\"forEach\",\"mediaDevice\",\"deviceId\",\"kind\",\"push\",\"addEventListener\",\"_navigator$mediaDevic3\",\"removeEventListener\",\"contextValue\",\"createElement\",\"Provider\",\"value\"],\"mappings\":\"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\"}"}