{"code":"function module(e,n,o){let t,i,r,l,a,u,c,s,d,f,p,v,g,m,k,h,w,E,b;o.link(\"react/jsx-runtime\",{jsx(e){t=e},jsxs(e){i=e}},0),o.link(\"@rocket.chat/fuselage-hooks\",{useEffectEvent(e){r=e},useLocalStorage(e){l=e}},1),o.link(\"@rocket.chat/ui-contexts\",{usePermission(e){a=e},useSetInputMediaDevice(e){u=e},useSetOutputMediaDevice(e){c=e},useSetting(e){s=e},useToastMessageDispatch(e){d=e}},2),o.link(\"react\",{useEffect(e){f=e},useMemo(e){p=e},useRef(e){v=e}},3),o.link(\"react-dom\",{createPortal(e){g=e}},4),o.link(\"react-i18next\",{useTranslation(e){m=e}},5),o.link(\"../components/VoipPopup\",{default(e){k=e}},6),o.link(\"../components/VoipPopupPortal\",{default(e){h=e}},7),o.link(\"../contexts/VoipContext\",{VoipContext(e){w=e}},8),o.link(\"../hooks/useVoipClient\",{useVoipClient(e){E=e}},9),o.link(\"../hooks/useVoipSounds\",{useVoipSounds(e){b=e}},10);var x=this&&this.__awaiter||function(e,n,o,t){return new(o||(o=Promise))(function(i,r){function l(e){try{u(t.next(e))}catch(e){r(e)}}function a(e){try{u(t.throw(e))}catch(e){r(e)}}function u(e){var n;e.done?i(e.value):((n=e.value)instanceof o?n:new o(function(e){e(n)})).then(l,a)}u((t=t.apply(e,n||[])).next())})};o.exportDefault(({children:e})=>{let n=s(\"VoIP_TeamCollab_Enabled\")||!1,o=a(\"view-user-voip-extension\"),V=n&&o,[y,C]=l(\"voip-registered\",!0),{t:P}=m(),D=b(),{voipClient:M,error:_}=E({enabled:V,autoRegister:y}),S=c(),L=u(),A=d(),I=v(null);f(()=>{if(!M)return;let e=e=>{e.preventDefault(),e.returnValue=!0},n=()=>x(void 0,void 0,void 0,function*(){D.stopAll(),window.addEventListener(\"beforeunload\",e),M.isCallee()&&I.current&&M.switchMediaRenderer({remoteMediaElement:I.current})}),o=()=>{M.isOngoing()&&M.endCall()},t=()=>{D.play(\"outbound-call-ringing\")},i=()=>{D.play(\"telephone\")},r=()=>{D.play(\"call-ended\",!1),D.stopAll(),window.removeEventListener(\"beforeunload\",e)},l=()=>{C(!1),A({type:\"error\",message:P(\"Voice_calling_registration_failed\")})},a=()=>{C(!0)},u=()=>{C(!1)};return M.on(\"incomingcall\",i),M.on(\"outgoingcall\",t),M.on(\"callestablished\",n),M.on(\"callterminated\",r),M.on(\"registrationerror\",l),M.on(\"registered\",a),M.on(\"unregistered\",u),M.networkEmitter.on(\"disconnected\",o),M.networkEmitter.on(\"connectionerror\",o),M.networkEmitter.on(\"localnetworkoffline\",o),()=>{M.off(\"incomingcall\",i),M.off(\"outgoingcall\",t),M.off(\"callestablished\",n),M.off(\"callterminated\",r),M.off(\"registrationerror\",l),M.off(\"registered\",a),M.off(\"unregistered\",u),M.networkEmitter.off(\"disconnected\",o),M.networkEmitter.off(\"connectionerror\",o),M.networkEmitter.off(\"localnetworkoffline\",o),window.removeEventListener(\"beforeunload\",e)}},[A,C,P,M,D]);let T=r(e=>x(void 0,void 0,void 0,function*(){I.current&&S({outputDevice:e,HTMLAudioElement:I.current})})),j=r(e=>x(void 0,void 0,void 0,function*(){M&&(yield M.changeAudioInputDevice({audio:{deviceId:{exact:e.id}}}),L(e))})),R=p(()=>V?!M||_?{isEnabled:!0,voipClient:null,error:_,changeAudioInputDevice:j,changeAudioOutputDevice:T}:{isEnabled:!0,voipClient:M,changeAudioInputDevice:j,changeAudioOutputDevice:T}:{isEnabled:!1,voipClient:null,error:null,changeAudioInputDevice:j,changeAudioOutputDevice:T},[M,V,_,j,T]);return i(w.Provider,{value:R,children:[e,R.isEnabled&&g(t(\"audio\",{ref:I,children:t(\"track\",{kind:\"captions\"})}),document.body),t(h,{children:t(k,{position:{bottom:132,right:24}})})]})})}","map":"{\"version\":3,\"sources\":[\"<anon>\"],\"names\":[],\"mappings\":\"\"}"}