{"code":"function module(e,t,i){var n,r,u,o,d,l,a;i.link(\"@babel/runtime/helpers/createForOfIteratorHelperLoose\",{default:function(e){n=e}},0),i.link(\"meteor/meteor\",{Meteor:function(e){r=e}},0),i.link(\"meteor/tracker\",{Tracker:function(e){u=e}},1),i.link(\"../../app/models/client\",{UserRoles:function(e){o=e},ChatMessage:function(e){d=e}},2),i.link(\"../../app/utils/client/lib/SDKClient\",{sdk:function(e){l=e}},3),i.link(\"../lib/toast\",{dispatchToastMessage:function(e){a=e}},4),r.startup(function(){u.autorun(function(){r.userId()&&(l.call(\"getUserRoles\").then(function(e){for(var t,i=n(e);!(t=i()).done;){var r=t.value;o.upsert({_id:r._id},r)}}).catch(function(e){a({type:\"error\",message:e})}),l.stream(\"notify-logged\",[\"roles-change\"],function(e){if(\"added\"===e.type){if(!e.scope){if(!e.u)return;o.upsert({_id:e.u._id},{$addToSet:{roles:e._id},$set:{username:e.u.username}}),d.update({\"u._id\":e.u._id},{$addToSet:{roles:e._id}},{multi:!0})}return}if(\"removed\"===e.type){if(!e.scope){if(!e.u)return;o.update({_id:e.u._id},{$pull:{roles:e._id}}),d.update({\"u._id\":e.u._id},{$pull:{roles:e._id}},{multi:!0})}return}\"changed\"===e.type&&d.update({roles:e._id},{$inc:{rerender:1}},{multi:!0})}))})})}","map":"{\"version\":3,\"sources\":[\"client/startup/userRoles.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { UserRoles, ChatMessage } from '../../app/models/client';\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\nimport { dispatchToastMessage } from '../lib/toast';\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(() => {\\n\\t\\tif (Meteor.userId()) {\\n\\t\\t\\tsdk\\n\\t\\t\\t\\t.call('getUserRoles')\\n\\t\\t\\t\\t.then((results) => {\\n\\t\\t\\t\\t\\tfor (const record of results) {\\n\\t\\t\\t\\t\\t\\tUserRoles.upsert({ _id: record._id }, record);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t})\\n\\t\\t\\t\\t.catch((error) => {\\n\\t\\t\\t\\t\\tdispatchToastMessage({ type: 'error', message: error });\\n\\t\\t\\t\\t});\\n\\n\\t\\t\\tsdk.stream('notify-logged', ['roles-change'], (role) => {\\n\\t\\t\\t\\tif (role.type === 'added') {\\n\\t\\t\\t\\t\\tif (!role.scope) {\\n\\t\\t\\t\\t\\t\\tif (!role.u) {\\n\\t\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\tUserRoles.upsert({ _id: role.u._id }, { $addToSet: { roles: role._id }, $set: { username: role.u.username } });\\n\\t\\t\\t\\t\\t\\tChatMessage.update({ 'u._id': role.u._id }, { $addToSet: { roles: role._id } }, { multi: true });\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (role.type === 'removed') {\\n\\t\\t\\t\\t\\tif (!role.scope) {\\n\\t\\t\\t\\t\\t\\tif (!role.u) {\\n\\t\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\tUserRoles.update({ _id: role.u._id }, { $pull: { roles: role._id } });\\n\\t\\t\\t\\t\\t\\tChatMessage.update({ 'u._id': role.u._id }, { $pull: { roles: role._id } }, { multi: true });\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (role.type === 'changed') {\\n\\t\\t\\t\\t\\tChatMessage.update({ roles: role._id }, { $inc: { rerender: 1 } }, { multi: true });\\n\\t\\t\\t\\t}\\n\\t\\t\\t});\\n\\t\\t}\\n\\t});\\n});\\n\",null],\"names\":[\"_createForOfIteratorHelperLoose\",\"Meteor\",\"Tracker\",\"UserRoles\",\"ChatMessage\",\"sdk\",\"dispatchToastMessage\",\"module\",\"link\",\"default\",\"v\",\"startup\",\"autorun\",\"userId\",\"call\",\"then\",\"results\",\"_step\",\"_iterator\",\"done\",\"record\",\"value\",\"upsert\",\"_id\",\"catch\",\"error\",\"type\",\"message\",\"stream\",\"role\",\"scope\",\"u\",\"$addToSet\",\"roles\",\"$set\",\"username\",\"update\",\"multi\",\"$pull\",\"$inc\",\"rerender\"],\"mappings\":\"2BAAAA,EAAAC,EAAuCC,EAAAC,EAAAC,EAAAC,EAAAC,EAAhBC,EAAgBC,IAAA,CAAA,wDAAA,CAAAC,QAAA,SAAAC,CAAA,EAAAV,EAAAU,CAAA,CAAA,EAAA,GAA9BH,EAAQC,IAAA,CAAM,gBAAgB,CAAAP,OAAA,SAAAS,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,iBAAA,CAAAN,QAAA,SAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,0BAAA,CAAAL,UAAA,SAAAO,CAAA,EAAAP,EAAAO,CAAA,EAAAN,YAAA,SAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAH,IAAA,SAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,eAAA,CAAAF,qBAAA,SAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAOvCT,EAAOU,OAAO,CAAC,WACdT,EAAQU,OAAO,CAAC,WACXX,EAAOY,MAAM,KAChBR,EACES,IAAI,CAAC,gBACLC,IAAI,CAAC,SAACC,CAAO,EACb,IAAA,IAA4BC,EAA5BC,EAAAlB,EAAqBgB,GAAO,CAAA,AAAAC,CAAAA,EAAAC,GAAA,EAAAC,IAAA,EAAE,CAAA,IAAnBC,EAAMH,EAAAI,KAAA,CAChBlB,EAAUmB,MAAM,CAAC,CAAEC,IAAKH,EAAOG,GAAAA,AAAG,EAAIH,EACvC,CACD,GACCI,KAAK,CAAC,SAACC,CAAK,EACZnB,EAAqB,CAAEoB,KAAM,QAASC,QAASF,CAAK,EACrD,GAEDpB,EAAIuB,MAAM,CAAC,gBAAiB,CAAC,eAAe,CAAE,SAACC,CAAI,EAClD,GAAIA,AAAc,UAAdA,EAAKH,IAAI,CAAc,CAC1B,GAAI,CAACG,EAAKC,KAAK,CAAE,CAChB,GAAI,CAACD,EAAKE,CAAC,CACV,OAED5B,EAAUmB,MAAM,CAAC,CAAEC,IAAKM,EAAKE,CAAC,CAACR,GAAAA,AAAG,EAAI,CAAES,UAAW,CAAEC,MAAOJ,EAAKN,GAAAA,AAAG,EAAIW,KAAM,CAAEC,SAAUN,EAAKE,CAAC,CAACI,QAAAA,AAAQ,CAAE,GAC3G/B,EAAYgC,MAAM,CAAC,CAAE,QAASP,EAAKE,CAAC,CAACR,GAAAA,AAAG,EAAI,CAAES,UAAW,CAAEC,MAAOJ,EAAKN,GAAAA,AAAG,CAAE,EAAI,CAAEc,MAAO,CAAA,CAAI,EAC9F,CAEA,MACD,CAEA,GAAIR,AAAc,YAAdA,EAAKH,IAAI,CAAgB,CAC5B,GAAI,CAACG,EAAKC,KAAK,CAAE,CAChB,GAAI,CAACD,EAAKE,CAAC,CACV,OAED5B,EAAUiC,MAAM,CAAC,CAAEb,IAAKM,EAAKE,CAAC,CAACR,GAAAA,AAAG,EAAI,CAAEe,MAAO,CAAEL,MAAOJ,EAAKN,GAAAA,AAAG,CAAE,GAClEnB,EAAYgC,MAAM,CAAC,CAAE,QAASP,EAAKE,CAAC,CAACR,GAAAA,AAAG,EAAI,CAAEe,MAAO,CAAEL,MAAOJ,EAAKN,GAAAA,AAAG,CAAE,EAAI,CAAEc,MAAO,CAAA,CAAI,EAC1F,CAEA,MACD,CAEkB,YAAdR,EAAKH,IAAI,EACZtB,EAAYgC,MAAM,CAAC,CAAEH,MAAOJ,EAAKN,GAAAA,AAAG,EAAI,CAAEgB,KAAM,CAAEC,SAAU,CAAC,CAAE,EAAI,CAAEH,MAAO,CAAA,CAAI,EAElF,GAEF,EACD\"}"}