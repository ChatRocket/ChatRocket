{"code":"function module(i,n,o){var t,e,s,r,u,c,a,l,d,m;o.link(\"@babel/runtime/regenerator\",{default:function(i){t=i}},0),o.link(\"meteor/meteor\",{Meteor:function(i){e=i}},0),o.link(\"meteor/tracker\",{Tracker:function(i){s=i}},1),o.link(\"../../../client/components/CreateDiscussion/CreateDiscussion\",{default:function(i){r=i}},2),o.link(\"../../../client/lib/imperativeModal\",{imperativeModal:function(i){u=i}},3),o.link(\"../../../client/lib/rooms/roomCoordinator\",{roomCoordinator:function(i){c=i}},4),o.link(\"../../../client/lib/utils/messageArgs\",{messageArgs:function(i){a=i}},5),o.link(\"../../authorization/client\",{hasPermission:function(i){l=i}},6),o.link(\"../../settings/client\",{settings:function(i){d=i}},7),o.link(\"../../ui-utils/client\",{MessageAction:function(i){m=i}},8),e.startup(function(){s.autorun(function(){if(!d.get(\"Discussion_enabled\"))return m.removeButton(\"start-discussion\");m.addButton({id:\"start-discussion\",icon:\"discussion\",label:\"Discussion_start\",type:\"communication\",context:[\"message\",\"message-mobile\",\"videoconf\"],action:function(i,n){var o,e,s,c;return t.async(function(i){for(;;)switch(i.prev=i.next){case 0:s=void 0===(e=n.message)?a(this).msg:e,c=n.room,u.open({component:r,props:{defaultParentRoom:(null==c?void 0:c.prid)||(null==c?void 0:c._id),onClose:u.close,parentMessageId:s._id,nameSuggestion:null==s?void 0:null===(o=s.msg)||void 0===o?void 0:o.substr(0,140)}});case 2:case\"end\":return i.stop()}},null,this,null,Promise)},condition:function(i){var n=i.message,o=n.u._id,t=n.drid,e=n.dcount,s=i.room,r=i.subscription,u=i.user;return!!(!t&&Number.isNaN(Number(e)))&&!!r&&!c.isLivechatRoom(s.t)&&!!u&&(o!==u._id?l(\"start-discussion-other-user\",s._id):l(\"start-discussion\",s._id))},order:1,group:\"menu\"})})})}","map":"{\"version\":3,\"sources\":[\"app/discussion/client/createDiscussionMessageAction.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport CreateDiscussion from '../../../client/components/CreateDiscussion/CreateDiscussion';\\nimport { imperativeModal } from '../../../client/lib/imperativeModal';\\nimport { roomCoordinator } from '../../../client/lib/rooms/roomCoordinator';\\nimport { messageArgs } from '../../../client/lib/utils/messageArgs';\\nimport { hasPermission } from '../../authorization/client';\\nimport { settings } from '../../settings/client';\\nimport { MessageAction } from '../../ui-utils/client';\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(() => {\\n\\t\\tif (!settings.get('Discussion_enabled')) {\\n\\t\\t\\treturn MessageAction.removeButton('start-discussion');\\n\\t\\t}\\n\\n\\t\\tMessageAction.addButton({\\n\\t\\t\\tid: 'start-discussion',\\n\\t\\t\\ticon: 'discussion',\\n\\t\\t\\tlabel: 'Discussion_start',\\n\\t\\t\\ttype: 'communication',\\n\\t\\t\\tcontext: ['message', 'message-mobile', 'videoconf'],\\n\\t\\t\\tasync action(_, props) {\\n\\t\\t\\t\\tconst { message = messageArgs(this).msg, room } = props;\\n\\n\\t\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\t\\tcomponent: CreateDiscussion,\\n\\t\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\t\\tdefaultParentRoom: room?.prid || room?._id,\\n\\t\\t\\t\\t\\t\\tonClose: imperativeModal.close,\\n\\t\\t\\t\\t\\t\\tparentMessageId: message._id,\\n\\t\\t\\t\\t\\t\\tnameSuggestion: message?.msg?.substr(0, 140),\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t});\\n\\t\\t\\t},\\n\\t\\t\\tcondition({\\n\\t\\t\\t\\tmessage: {\\n\\t\\t\\t\\t\\tu: { _id: uid },\\n\\t\\t\\t\\t\\tdrid,\\n\\t\\t\\t\\t\\tdcount,\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\troom,\\n\\t\\t\\t\\tsubscription,\\n\\t\\t\\t\\tuser,\\n\\t\\t\\t}) {\\n\\t\\t\\t\\tif (drid || !Number.isNaN(Number(dcount))) {\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tif (!subscription) {\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room.t);\\n\\t\\t\\t\\tif (isLivechatRoom) {\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (!user) {\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\treturn uid !== user._id ? hasPermission('start-discussion-other-user', room._id) : hasPermission('start-discussion', room._id);\\n\\t\\t\\t},\\n\\t\\t\\torder: 1,\\n\\t\\t\\tgroup: 'menu',\\n\\t\\t});\\n\\t});\\n});\\n\",null],\"names\":[\"_regeneratorRuntime\",\"Meteor\",\"Tracker\",\"CreateDiscussion\",\"imperativeModal\",\"roomCoordinator\",\"messageArgs\",\"hasPermission\",\"settings\",\"MessageAction\",\"module\",\"link\",\"default\",\"v\",\"startup\",\"autorun\",\"get\",\"removeButton\",\"addButton\",\"id\",\"icon\",\"label\",\"type\",\"context\",\"action\",\"_\",\"props\",\"_message$msg\",\"_props$message\",\"message\",\"room\",\"async\",\"_context\",\"prev\",\"next\",\"msg\",\"open\",\"component\",\"defaultParentRoom\",\"prid\",\"_id\",\"onClose\",\"close\",\"parentMessageId\",\"nameSuggestion\",\"substr\",\"stop\",\"Promise\",\"condition\",\"_ref\",\"_ref$message\",\"uid\",\"u\",\"drid\",\"dcount\",\"subscription\",\"user\",\"Number\",\"isNaN\",\"isLivechatRoom\",\"t\",\"order\",\"group\"],\"mappings\":\"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\"}"}