{"code":"function module(n,e,o){o.link(\"@babel/runtime/regenerator\",{default:function(n){i=n}},0),o.export({useMessageBlockContextValue:function(){return k}}),o.link(\"@rocket.chat/fuselage-hooks\",{useMutableCallback:function(n){t=n}},0),o.link(\"../../contexts/VideoConfContext\",{useVideoConfDispatchOutgoing:function(n){a=n},useVideoConfIsCalling:function(n){r=n},useVideoConfIsRinging:function(n){u=n},useVideoConfJoinCall:function(n){c=n},useVideoConfManager:function(n){l=n},useVideoConfSetPreferences:function(n){s=n}},1),o.link(\"../../views/room/contextualBar/VideoConference/hooks/useVideoConfWarning\",{useVideoConfWarning:function(n){f=n}},2),o.link(\"./useUiKitActionManager\",{useUiKitActionManager:function(n){d=n}},3);var i,t,a,r,u,c,l,s,f,d,k=function(n,e){var o=c(),k=s(),C=r(),p=u(),g=f(),v=a(),b=l(),V=t(function(n){return i.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(C||p)){e.next=2;break}return e.abrupt(\"return\");case 2:return e.prev=2,e.next=5,i.awrap(null==b?void 0:b.loadCapabilities());case 5:v({rid:n}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),g(e.t0.error);case 11:case\"end\":return e.stop()}},null,null,[[2,8]],Promise)}),m=d();return{action:function(i,t){var a=i.appId,r=i.actionId,u=i.blockId,c=i.value;if(\"videoconf-core\"===a){if(t.preventDefault(),k({mic:!0,cam:!1}),\"join\"===r)return o(u);if(\"callBack\"===r)return V(u)}m.emitInteraction(a,{type:\"blockAction\",actionId:r,payload:{blockId:u,value:c},container:{type:\"message\",id:e},rid:n,mid:e})},rid:n,values:{}}}}","map":"{\"version\":3,\"sources\":[\"client/uikit/hooks/useMessageBlockContextValue.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom, IMessage } from '@rocket.chat/core-typings';\\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\\nimport type { UiKitContext } from '@rocket.chat/fuselage-ui-kit';\\nimport type { ContextType } from 'react';\\n\\nimport {\\n\\tuseVideoConfDispatchOutgoing,\\n\\tuseVideoConfIsCalling,\\n\\tuseVideoConfIsRinging,\\n\\tuseVideoConfJoinCall,\\n\\tuseVideoConfManager,\\n\\tuseVideoConfSetPreferences,\\n} from '../../contexts/VideoConfContext';\\nimport { useVideoConfWarning } from '../../views/room/contextualBar/VideoConference/hooks/useVideoConfWarning';\\nimport { useUiKitActionManager } from './useUiKitActionManager';\\n\\nexport const useMessageBlockContextValue = (rid: IRoom['_id'], mid: IMessage['_id']): ContextType<typeof UiKitContext> => {\\n\\tconst joinCall = useVideoConfJoinCall();\\n\\tconst setPreferences = useVideoConfSetPreferences();\\n\\tconst isCalling = useVideoConfIsCalling();\\n\\tconst isRinging = useVideoConfIsRinging();\\n\\tconst dispatchWarning = useVideoConfWarning();\\n\\tconst dispatchPopup = useVideoConfDispatchOutgoing();\\n\\n\\tconst videoConfManager = useVideoConfManager();\\n\\n\\tconst handleOpenVideoConf = useMutableCallback(async (rid: IRoom['_id']) => {\\n\\t\\tif (isCalling || isRinging) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\ttry {\\n\\t\\t\\tawait videoConfManager?.loadCapabilities();\\n\\t\\t\\tdispatchPopup({ rid });\\n\\t\\t} catch (error: any) {\\n\\t\\t\\tdispatchWarning(error.error);\\n\\t\\t}\\n\\t});\\n\\n\\tconst actionManager = useUiKitActionManager();\\n\\n\\treturn {\\n\\t\\taction: ({ appId, actionId, blockId, value }, event) => {\\n\\t\\t\\tif (appId === 'videoconf-core') {\\n\\t\\t\\t\\tevent.preventDefault();\\n\\t\\t\\t\\tsetPreferences({ mic: true, cam: false });\\n\\t\\t\\t\\tif (actionId === 'join') {\\n\\t\\t\\t\\t\\treturn joinCall(blockId);\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (actionId === 'callBack') {\\n\\t\\t\\t\\t\\treturn handleOpenVideoConf(blockId);\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\n\\t\\t\\tactionManager.emitInteraction(appId, {\\n\\t\\t\\t\\ttype: 'blockAction',\\n\\t\\t\\t\\tactionId,\\n\\t\\t\\t\\tpayload: {\\n\\t\\t\\t\\t\\tblockId,\\n\\t\\t\\t\\t\\tvalue,\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\tcontainer: {\\n\\t\\t\\t\\t\\ttype: 'message',\\n\\t\\t\\t\\t\\tid: mid,\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\trid,\\n\\t\\t\\t\\tmid,\\n\\t\\t\\t});\\n\\t\\t},\\n\\t\\trid,\\n\\t\\tvalues: {}, // TODO: this is a hack to make the context work, but it should be removed\\n\\t};\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"export\",\"useMessageBlockContextValue\",\"useMutableCallback\",\"useVideoConfDispatchOutgoing\",\"useVideoConfIsCalling\",\"useVideoConfIsRinging\",\"useVideoConfJoinCall\",\"useVideoConfManager\",\"useVideoConfSetPreferences\",\"useVideoConfWarning\",\"useUiKitActionManager\",\"rid\",\"mid\",\"joinCall\",\"setPreferences\",\"isCalling\",\"isRinging\",\"dispatchWarning\",\"dispatchPopup\",\"videoConfManager\",\"handleOpenVideoConf\",\"async\",\"_context\",\"prev\",\"next\",\"abrupt\",\"awrap\",\"loadCapabilities\",\"t0\",\"error\",\"stop\",\"Promise\",\"actionManager\",\"action\",\"_ref\",\"event\",\"appId\",\"actionId\",\"blockId\",\"value\",\"preventDefault\",\"mic\",\"cam\",\"emitInteraction\",\"type\",\"payload\",\"container\",\"id\",\"values\"],\"mappings\":\"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\"}"}