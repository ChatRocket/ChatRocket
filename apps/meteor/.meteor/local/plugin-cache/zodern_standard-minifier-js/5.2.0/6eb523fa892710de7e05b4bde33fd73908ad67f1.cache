{"code":"function module(n,e,r){r.link(\"@babel/runtime/regenerator\",{default:function(n){a=n}},0),r.export({findParentMessage:function(){return d}}),r.link(\"../../../client/lib/utils/callWithErrorHandling\",{callWithErrorHandling:function(n){s=n}},0),r.link(\"../../../lib/utils/highOrderFunctions\",{withDebouncing:function(n){o=n}},1),r.link(\"../../models/client\",{ChatMessage:function(n){f=n}},2);var t,i,u,c,l,a,s,o,f,d=(i=[],u=new Promise(function(n){t=n}),c=o({wait:500})(function(){var n;return a.async(function(e){for(;;)switch(e.prev=e.next){case 0:n=[].concat(i),i.length=0,t(s(\"getMessages\",n)),u=new Promise(function(n){t=n});case 4:case\"end\":return e.stop()}},null,null,null,Promise)}),l=function(n){var e;return a.async(function(r){for(;;)switch(r.prev=r.next){case 0:return c(),r.next=3,a.awrap(u);case 3:return e=r.sent,r.abrupt(\"return\",e.find(function(e){return e._id===n}));case 5:case\"end\":return r.stop()}},null,null,null,Promise)},function(n){var e;return a.async(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(e=f.findOne({_id:n}))){r.next=3;break}return r.abrupt(\"return\",e);case 3:return -1===i.indexOf(n)&&i.push(n),r.abrupt(\"return\",l(n));case 5:case\"end\":return r.stop()}},null,null,null,Promise)})}","map":"{\"version\":3,\"sources\":[\"app/ui-message/client/findParentMessage.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IMessage } from '@rocket.chat/core-typings';\\n\\nimport { callWithErrorHandling } from '../../../client/lib/utils/callWithErrorHandling';\\nimport { withDebouncing } from '../../../lib/utils/highOrderFunctions';\\nimport { ChatMessage } from '../../models/client';\\n\\nexport const findParentMessage = (() => {\\n\\tconst waiting: string[] = [];\\n\\tlet resolve: (resolved: IMessage[] | PromiseLike<IMessage[]>) => void;\\n\\tlet pending = new Promise<IMessage[]>((r) => {\\n\\t\\tresolve = r;\\n\\t});\\n\\n\\tconst getMessages = withDebouncing({ wait: 500 })(async () => {\\n\\t\\tconst _tmp = [...waiting];\\n\\t\\twaiting.length = 0;\\n\\t\\tresolve(callWithErrorHandling('getMessages', _tmp));\\n\\t\\tpending = new Promise<IMessage[]>((r) => {\\n\\t\\t\\tresolve = r;\\n\\t\\t});\\n\\t});\\n\\n\\tconst get = async (tmid: IMessage['_id']) => {\\n\\t\\tvoid getMessages();\\n\\t\\tconst messages = await pending;\\n\\t\\treturn messages.find(({ _id }) => _id === tmid);\\n\\t};\\n\\n\\treturn async (tmid: IMessage['_id']) => {\\n\\t\\tconst message = ChatMessage.findOne({ _id: tmid });\\n\\n\\t\\tif (message) {\\n\\t\\t\\treturn message;\\n\\t\\t}\\n\\n\\t\\tif (waiting.indexOf(tmid) === -1) {\\n\\t\\t\\twaiting.push(tmid);\\n\\t\\t}\\n\\t\\treturn get(tmid);\\n\\t};\\n})();\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"export\",\"findParentMessage\",\"callWithErrorHandling\",\"withDebouncing\",\"ChatMessage\",\"resolve\",\"waiting\",\"pending\",\"getMessages\",\"get\",\"Promise\",\"r\",\"wait\",\"_tmp\",\"async\",\"_context\",\"prev\",\"next\",\"concat\",\"length\",\"stop\",\"tmid\",\"messages\",\"_context2\",\"awrap\",\"sent\",\"abrupt\",\"find\",\"_ref\",\"_id\",\"message\",\"_context3\",\"findOne\",\"indexOf\",\"push\"],\"mappings\":\"uBAESA,EAAqBC,IAAE,CAAA,6BAAM,CAAAC,QAAA,SAAAC,CAAA,EAAAC,EAAkDD,CAAA,CAAA,EAAA,GAAxFH,EAAOK,MAAE,CAAA,CAAAC,kBAAuB,WAAM,OAAAA,CAAA,CAAA,GAAkDN,EAAAC,IAAA,CAAA,kDAAA,CAAAM,sBAAA,SAAAJ,CAAA,EAAAI,EAAAJ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,wCAAA,CAAAO,eAAA,SAAAL,CAAA,EAAAK,EAAAL,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,sBAAA,CAAAQ,YAAA,SAAAN,CAAA,EAAAM,EAAAN,CAAA,CAAA,EAAA,GAIjF,IAEFO,EADEC,EAEFC,EAIEC,EASAC,EApBPV,EAAsCG,EAAkDC,EAAAC,EAI3EH,GACNK,EAAoB,EAAE,CAExBC,EAAU,IAAIG,QAAoB,SAACC,CAAC,EACvCN,EAAUM,CACX,GAEMH,EAAcL,EAAe,CAAES,KAAM,GAAG,GAAI,WAAA,IAAAC,EAAA,OAAAd,EAAAe,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAC3CJ,EAAI,EAAA,CAAAK,MAAA,CAAOZ,GACjBA,EAAQa,MAAM,CAAG,EACjBd,EAAQH,EAAsB,cAAeW,IAC7CN,EAAU,IAAIG,QAAoB,SAACC,CAAC,EACnCN,EAAUM,CACX,EAAG,MAAA,EAAA,IAAA,MAAA,OAAAI,EAAAK,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAV,QAAA,GAGED,EAAM,SAAOY,CAAqB,EAAA,IAAAC,EAAA,OAAAvB,EAAAe,KAAA,CAAA,SAAAS,CAAA,EAAA,OAAA,OAAAA,EAAAP,IAAA,CAAAO,EAAAN,IAAA,EAAA,KAAA,EACpB,OAAdT,IAAce,EAAAN,IAAA,CAAA,EAAAlB,EAAAyB,KAAA,CACIjB,EAAO,MAAA,EAAhB,OAARe,EAAQC,EAAAE,IAAA,CAAAF,EAAAG,MAAA,CAAA,SACPJ,EAASK,IAAI,CAAC,SAAAC,CAAA,EAAM,OAAOC,AAAPD,EAAHC,GAAG,GAAeR,CAAI,GAAC,MAAA,EAAA,IAAA,MAAA,OAAAE,EAAAH,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAV,QAAA,EAGzC,SAAOW,CAAqB,EAAA,IAAAS,EAAA,OAAA/B,EAAAe,KAAA,CAAA,SAAAiB,CAAA,EAAA,OAAA,OAAAA,EAAAf,IAAA,CAAAe,EAAAd,IAAA,EAAA,KAAA,EACgB,GAAA,CAA5Ca,CAAAA,EAAU1B,EAAY4B,OAAO,CAAC,CAAEH,IAAKR,CAAI,EAAE,EAEtC,CAAAU,EAAAd,IAAA,CAAA,EAAA,KAAA,CAAA,OAAAc,EAAAL,MAAA,CAAA,SACHI,EAAO,MAAA,EAKd,OAF6B,KAA1BxB,EAAQ2B,OAAO,CAACZ,IACnBf,EAAQ4B,IAAI,CAACb,GACbU,EAAAL,MAAA,CAAA,SACMjB,EAAIY,GAAK,MAAA,EAAA,IAAA,MAAA,OAAAU,EAAAX,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAV,QAAA\"}"}