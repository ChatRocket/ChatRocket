{"code":"function module(e,t,n){n.link(\"@babel/runtime/regenerator\",{default:function(e){r=e}},0),n.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){u=e}},1),n.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){i=e}},2),n.link(\"@rocket.chat/onboarding-ui\",{RegisterServerPage:function(e){o=e},RegisterOfflinePage:function(e){c=e}},0),n.link(\"@rocket.chat/ui-contexts\",{useEndpoint:function(e){a=e},useMethod:function(e){s=e},useTranslation:function(e){l=e}},1),n.link(\"@tanstack/react-query\",{useMutation:function(e){f=e},useQuery:function(e){p=e}},2),n.link(\"react\",{default:function(e){d=e},useState:function(e){m=e}},3),n.link(\"../../../hooks/useLicense\",{useInvalidateLicense:function(e){g=e}},4),n.link(\"../../../lib/toast\",{dispatchToastMessage:function(e){S=e}},5),n.link(\"../contexts/SetupWizardContext\",{useSetupWizardContext:function(e){k=e}},6);var r,u,i,o,c,a,s,l,f,p,d,m,g,S,k,E={REGISTERED:\"REGISTERED\",OFFLINE:\"OFFLINE\"};n.exportDefault(function(){var e=l(),t=k(),n=t.currentStep,h=t.goToNextStep,v=t.setSetupWizardData,y=t.registerServer,b=t.maxSteps,x=t.completeSetupWizard,R=t.saveAgreementData,T=m(E.REGISTERED),I=i(T,2),P=I[0],C=I[1],D=g(),O=a(\"POST\",\"/v1/cloud.manualRegister\"),F=a(\"POST\",\"/v1/cloud.registerPreIntent\"),W=s(\"cloud:getWorkspaceRegisterData\"),w=p([\"setupWizard/clientKey\"],function(){return r.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",W());case 1:case\"end\":return e.stop()}},null,null,null,Promise)},{staleTime:1/0}).data,z=p([\"setupWizard/registerIntent\"],function(){return r.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",F());case 1:case\"end\":return e.stop()}},null,null,null,Promise)},{staleTime:1/0,select:function(e){return e.offline}}),L=z.data,N=z.isLoading,G=z.isError,B=f([\"setupWizard/confirmOfflineRegistration\"],function(e){return r.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt(\"return\",O({cloudBlob:e}));case 1:case\"end\":return t.stop()}},null,null,null,Promise)},{onSuccess:function(){D(100),x()},onError:function(){S({type:\"error\",message:e(\"Cloud_register_error\")})}}).mutate;return P===E.OFFLINE?d.createElement(c,{termsHref:\"https://rocket.chat/terms\",policyHref:\"https://rocket.chat/privacy\",clientKey:w||\"\",onCopySecurityCode:function(){return S({type:\"success\",message:e(\"Copied\")})},onBackButtonClick:function(){return C(E.REGISTERED)},onSubmit:function(e){var t,n;return r.async(function(u){for(;;)switch(u.prev=u.next){case 0:return t=e.token,n=e.agreement,u.next=3,r.awrap(R(n));case 3:B(t);case 4:case\"end\":return u.stop()}},null,null,null,Promise)}}):d.createElement(o,{onClickRegisterOffline:function(){return C(E.OFFLINE)},stepCount:b,onSubmit:function(e){return r.async(function(t){for(;;)switch(t.prev=t.next){case 0:return h(),v(function(t){return u(u({},t),{},{serverData:e})}),t.next=4,r.awrap(y(e));case 4:case\"end\":return t.stop()}},null,null,null,Promise)},currentStep:n,offline:G||!N&&L})})}","map":"{\"version\":3,\"sources\":[\"client/views/setupWizard/steps/RegisterServerStep.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { RegisterServerPage, RegisterOfflinePage } from '@rocket.chat/onboarding-ui';\\nimport { useEndpoint, useMethod, useTranslation } from '@rocket.chat/ui-contexts';\\nimport { useMutation, useQuery } from '@tanstack/react-query';\\nimport type { ReactElement, ComponentProps } from 'react';\\nimport React, { useState } from 'react';\\n\\nimport { useInvalidateLicense } from '../../../hooks/useLicense';\\nimport { dispatchToastMessage } from '../../../lib/toast';\\nimport { useSetupWizardContext } from '../contexts/SetupWizardContext';\\n\\nconst SERVER_OPTIONS = {\\n\\tREGISTERED: 'REGISTERED',\\n\\tOFFLINE: 'OFFLINE',\\n};\\n\\nconst RegisterServerStep = (): ReactElement => {\\n\\tconst t = useTranslation();\\n\\tconst { currentStep, goToNextStep, setSetupWizardData, registerServer, maxSteps, completeSetupWizard, saveAgreementData } =\\n\\t\\tuseSetupWizardContext();\\n\\tconst [serverOption, setServerOption] = useState(SERVER_OPTIONS.REGISTERED);\\n\\tconst invalidateLicenseQuery = useInvalidateLicense();\\n\\n\\tconst handleRegister: ComponentProps<typeof RegisterServerPage>['onSubmit'] = async (data: {\\n\\t\\temail: string;\\n\\t\\tagreement: boolean;\\n\\t\\tupdates: boolean;\\n\\t\\tresend?: boolean;\\n\\t}) => {\\n\\t\\tgoToNextStep();\\n\\t\\tsetSetupWizardData((prevState) => ({ ...prevState, serverData: data }));\\n\\t\\tawait registerServer(data);\\n\\t};\\n\\n\\tconst registerManually = useEndpoint('POST', '/v1/cloud.manualRegister');\\n\\tconst registerPreIntent = useEndpoint('POST', '/v1/cloud.registerPreIntent');\\n\\tconst getWorkspaceRegisterData = useMethod('cloud:getWorkspaceRegisterData');\\n\\n\\tconst { data: clientKey } = useQuery(['setupWizard/clientKey'], async () => getWorkspaceRegisterData(), {\\n\\t\\tstaleTime: Infinity,\\n\\t});\\n\\n\\tconst {\\n\\t\\tdata: offline,\\n\\t\\tisLoading,\\n\\t\\tisError,\\n\\t} = useQuery(['setupWizard/registerIntent'], async () => registerPreIntent(), {\\n\\t\\tstaleTime: Infinity,\\n\\t\\tselect: (data) => data.offline,\\n\\t});\\n\\n\\tconst { mutate } = useMutation<null, unknown, string>(\\n\\t\\t['setupWizard/confirmOfflineRegistration'],\\n\\t\\tasync (token) => registerManually({ cloudBlob: token }),\\n\\t\\t{\\n\\t\\t\\tonSuccess: () => {\\n\\t\\t\\t\\tinvalidateLicenseQuery(100);\\n\\t\\t\\t\\tcompleteSetupWizard();\\n\\t\\t\\t},\\n\\t\\t\\tonError: () => {\\n\\t\\t\\t\\tdispatchToastMessage({ type: 'error', message: t('Cloud_register_error') });\\n\\t\\t\\t},\\n\\t\\t},\\n\\t);\\n\\n\\tconst handleConfirmOffline: ComponentProps<typeof RegisterOfflinePage>['onSubmit'] = async ({ token, agreement }) => {\\n\\t\\tawait saveAgreementData(agreement);\\n\\t\\tmutate(token);\\n\\t};\\n\\n\\tif (serverOption === SERVER_OPTIONS.OFFLINE) {\\n\\t\\treturn (\\n\\t\\t\\t<RegisterOfflinePage\\n\\t\\t\\t\\ttermsHref='https://rocket.chat/terms'\\n\\t\\t\\t\\tpolicyHref='https://rocket.chat/privacy'\\n\\t\\t\\t\\tclientKey={clientKey || ''}\\n\\t\\t\\t\\tonCopySecurityCode={(): void => dispatchToastMessage({ type: 'success', message: t('Copied') })}\\n\\t\\t\\t\\tonBackButtonClick={(): void => setServerOption(SERVER_OPTIONS.REGISTERED)}\\n\\t\\t\\t\\tonSubmit={handleConfirmOffline}\\n\\t\\t\\t/>\\n\\t\\t);\\n\\t}\\n\\n\\treturn (\\n\\t\\t<RegisterServerPage\\n\\t\\t\\tonClickRegisterOffline={(): void => setServerOption(SERVER_OPTIONS.OFFLINE)}\\n\\t\\t\\tstepCount={maxSteps}\\n\\t\\t\\tonSubmit={handleRegister}\\n\\t\\t\\tcurrentStep={currentStep}\\n\\t\\t\\toffline={isError || (!isLoading && offline)}\\n\\t\\t/>\\n\\t);\\n};\\n\\nexport default RegisterServerStep;\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"_objectSpread\",\"_slicedToArray\",\"RegisterServerPage\",\"RegisterOfflinePage\",\"useEndpoint\",\"useMethod\",\"useTranslation\",\"useMutation\",\"useQuery\",\"React\",\"useState\",\"useInvalidateLicense\",\"dispatchToastMessage\",\"useSetupWizardContext\",\"SERVER_OPTIONS\",\"REGISTERED\",\"OFFLINE\",\"exportDefault\",\"t\",\"_useSetupWizardContex\",\"currentStep\",\"goToNextStep\",\"setSetupWizardData\",\"registerServer\",\"maxSteps\",\"completeSetupWizard\",\"saveAgreementData\",\"_useState\",\"_useState2\",\"serverOption\",\"setServerOption\",\"invalidateLicenseQuery\",\"registerManually\",\"registerPreIntent\",\"getWorkspaceRegisterData\",\"clientKey\",\"_useQuery\",\"async\",\"_context2\",\"prev\",\"next\",\"abrupt\",\"stop\",\"Promise\",\"staleTime\",\"Infinity\",\"data\",\"_useQuery2\",\"_context3\",\"select\",\"offline\",\"isLoading\",\"isError\",\"mutate\",\"_useMutation\",\"token\",\"_context4\",\"cloudBlob\",\"onSuccess\",\"onError\",\"type\",\"message\",\"createElement\",\"termsHref\",\"policyHref\",\"onCopySecurityCode\",\"onBackButtonClick\",\"onSubmit\",\"_ref\",\"agreement\",\"_context5\",\"awrap\",\"onClickRegisterOffline\",\"stepCount\",\"_context\",\"prevState\",\"serverData\"],\"mappings\":\"uBAASA,EAAoBC,IAAA,CAAA,6BAA2B,CAAAC,QAAA,SAAAC,CAA4B,EAACC,EAAAD,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAC,QAAA,SAAAC,CAAA,EAAAE,EAAAF,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAC,QAAA,SAAAC,CAAA,EAAAG,EAAAH,CAAA,CAAA,EAAA,GAAxDH,EAAqBC,IAAA,CAAA,6BAAkC,CAACM,mBAAA,SAAAJ,CAAA,EAAAI,EAAAJ,CAAA,EAAAK,oBAAA,SAAAL,CAAA,EAAAK,EAAAL,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,2BAAA,CAAAQ,YAAA,SAAAN,CAAA,EAAAM,EAAAN,CAAA,EAAAO,UAAA,SAAAP,CAAA,EAAAO,EAAAP,CAAA,EAAAQ,eAAA,SAAAR,CAAA,EAAAQ,EAAAR,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,wBAAA,CAAAW,YAAA,SAAAT,CAAA,EAAAS,EAAAT,CAAA,EAAAU,SAAA,SAAAV,CAAA,EAAAU,EAAAV,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,QAAA,CAAA,QAAA,SAAAE,CAAA,EAAAW,EAAAX,CAAA,EAAAY,SAAA,SAAAZ,CAAA,EAAAY,EAAAZ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,4BAAA,CAAAe,qBAAA,SAAAb,CAAA,EAAAa,EAAAb,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,qBAAA,CAAAgB,qBAAA,SAAAd,CAAA,EAAAc,EAAAd,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,iCAAA,CAAAiB,sBAAA,SAAAf,CAAA,EAAAe,EAAAf,CAAA,CAAA,EAAA,GAUrF,IAVAC,EAAqFC,EAAAC,EAArFC,EAASC,EAA4EC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAU/EC,EAAiB,CACtBC,WAAY,aACZC,QAAS,WAZVrB,EAAOsB,aAAE,CAekB,WAC1B,IAAMC,EAAIZ,IACVa,EACCN,IADOO,EAAWD,EAAXC,WAAW,CAAEC,EAAYF,EAAZE,YAAY,CAAEC,EAAkBH,EAAlBG,kBAAkB,CAAEC,EAAcJ,EAAdI,cAAc,CAAEC,EAAQL,EAARK,QAAQ,CAAEC,EAAmBN,EAAnBM,mBAAmB,CAAEC,EAAiBP,EAAjBO,iBAAiB,CAEvHC,EAAwCjB,EAASI,EAAeC,UAAU,EAACa,EAAA3B,EAAA0B,EAAA,GAApEE,EAAYD,CAAA,CAAA,EAAA,CAAEE,EAAeF,CAAA,CAAA,EAAA,CAC9BG,EAAyBpB,IAazBqB,EAAmB5B,EAAY,OAAQ,4BACvC6B,EAAoB7B,EAAY,OAAQ,+BACxC8B,EAA2B7B,EAAU,kCAE7B8B,EAASC,AAAK5B,EAAS,CAAC,wBAAwB,CAAE,WAAA,OAAAT,EAAAsC,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAAA,OAAAF,EAAAG,MAAA,CAAA,SAAYP,IAA0B,MAAA,EAAA,IAAA,MAAA,OAAAI,EAAAI,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,EAAE,CACvGC,UAAWC,MADJC,IAAI,CAIZC,EAIIvC,EAAS,CAAC,6BAA6B,CAAE,WAAA,OAAAT,EAAAsC,KAAA,CAAA,SAAAW,CAAA,EAAA,OAAA,OAAAA,EAAAT,IAAA,CAAAS,EAAAR,IAAA,EAAA,KAAA,EAAA,OAAAQ,EAAAP,MAAA,CAAA,SAAYR,IAAmB,MAAA,EAAA,IAAA,MAAA,OAAAe,EAAAN,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,EAAE,CAC7EC,UAAWC,IACXI,OAAQ,SAACH,CAAI,EAAA,OAAKA,EAAKI,OAAO,IALxBA,EAAOH,EAAbD,IAAI,CACJK,EAASJ,EAATI,SAAS,CACTC,EAAOL,EAAPK,OAAO,CAMAC,EAAMC,AAAK/C,EAClB,CAAC,yCAAyC,CAC1C,SAAOgD,CAAK,EAAA,OAAAxD,EAAAsC,KAAA,CAAA,SAAAmB,CAAA,EAAA,OAAA,OAAAA,EAAAjB,IAAA,CAAAiB,EAAAhB,IAAA,EAAA,KAAA,EAAA,OAAAgB,EAAAf,MAAA,CAAA,SAAKT,EAAiB,CAAEyB,UAAWF,CAAK,GAAG,MAAA,EAAA,IAAA,MAAA,OAAAC,EAAAd,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,EACvD,CACCe,UAAW,WACV3B,EAAuB,KACvBN,GACD,EACAkC,QAAS,WACR/C,EAAqB,CAAEgD,KAAM,QAASC,QAAS3C,EAAE,uBAAuB,EACzE,IAVMmC,MAAM,QAmBd,AAAIxB,IAAiBf,EAAeE,OAAO,CAEzCP,EAAAqD,aAAA,CAAC3D,EAAmB,CACnB4D,UAAU,4BACVC,WAAW,8BACX7B,UAAWA,GAAa,GACxB8B,mBAAoB,WAAA,OAAYrD,EAAqB,CAAEgD,KAAM,UAAWC,QAAS3C,EAAE,SAAS,EAAG,EAC/FgD,kBAAmB,WAAA,OAAYpC,EAAgBhB,EAAeC,UAAU,CAAC,EACzEoD,SAbkF,SAAAC,CAAA,EAAA,IAAAb,EAAAc,EAAA,OAAAtE,EAAAsC,KAAA,CAAA,SAAAiC,CAAA,EAAA,OAAA,OAAAA,EAAA/B,IAAA,CAAA+B,EAAA9B,IAAA,EAAA,KAAA,EAAyB,OAAhBe,EAAKa,EAALb,KAAK,CAAEc,EAASD,EAATC,SAAS,CAAAC,EAAA9B,IAAA,CAAA,EAAAzC,EAAAwE,KAAA,CACvG7C,EAAkB2C,GAAU,MAAA,EAClChB,EAAOE,EAAO,MAAA,EAAA,IAAA,MAAA,OAAAe,EAAA5B,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,CAWmB,GAMjClC,EAAAqD,aAAA,CAAC5D,EAAkB,CAClBsE,uBAAwB,WAAA,OAAY1C,EAAgBhB,EAAeE,OAAO,CAAC,EAC3EyD,UAAWjD,EACX2C,SAhE4E,SAAOrB,CAKpF,EAAA,OAAA/C,EAAAsC,KAAA,CAAA,SAAAqC,CAAA,EAAA,OAAA,OAAAA,EAAAnC,IAAA,CAAAmC,EAAAlC,IAAA,EAAA,KAAA,EAEwE,OADxEnB,IACAC,EAAmB,SAACqD,CAAS,EAAA,OAAA3E,EAAAA,EAAA,CAAA,EAAW2E,GAAS,CAAA,EAAA,CAAEC,WAAY9B,CAAI,EAAA,GAAK4B,EAAAlC,IAAA,CAAA,EAAAzC,EAAAwE,KAAA,CAClEhD,EAAeuB,GAAK,MAAA,EAAA,IAAA,MAAA,OAAA4B,EAAAhC,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,EAyDzBvB,YAAaA,EACb8B,QAASE,GAAY,CAACD,GAAaD,CAAS,EAG/C\"}"}