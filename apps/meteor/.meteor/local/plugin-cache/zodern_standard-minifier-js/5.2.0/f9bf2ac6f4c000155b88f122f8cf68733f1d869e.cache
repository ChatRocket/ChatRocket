{"code":"function module(e,t,r){let o,u;r.export({createReactiveSubscriptionFactory:()=>a}),r.link(\"meteor/tracker\",{Tracker(e){o=e}},0),r.link(\"./utils/queueMicrotask\",{queueMicrotask(e){u=e}},1);let a=e=>function(){let t;for(var r=arguments.length,a=Array(r),i=0;i<r;i++)a[i]=arguments[i];let n=new Set,l=e(...a),c=()=>{l=e(...a),u(()=>{n.forEach(e=>{e()})})};return u(()=>{t=o.autorun(c)}),[e=>(n.add(e),()=>{n.delete(e),0===n.size&&u(()=>{var e;return null===(e=t)||void 0===e?void 0:e.stop()})}),()=>l]}}","map":"{\"version\":3,\"sources\":[\"client/lib/createReactiveSubscriptionFactory.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Tracker } from 'meteor/tracker';\\n\\nimport { queueMicrotask } from './utils/queueMicrotask';\\n\\ninterface ISubscriptionFactory<T> {\\n\\t(...args: any[]): [subscribe: (onStoreChange: () => void) => () => void, getSnapshot: () => T];\\n}\\n\\nexport const createReactiveSubscriptionFactory =\\n\\t<T>(computeCurrentValueWith: (...args: any[]) => T): ISubscriptionFactory<T> =>\\n\\t(...args: any[]): [subscribe: (onStoreChange: () => void) => () => void, getSnapshot: () => T] => {\\n\\t\\tconst callbacks = new Set<() => void>();\\n\\n\\t\\tlet currentValue = computeCurrentValueWith(...args);\\n\\n\\t\\tconst reactiveFn = (): void => {\\n\\t\\t\\tcurrentValue = computeCurrentValueWith(...args);\\n\\t\\t\\tqueueMicrotask(() => {\\n\\t\\t\\t\\tcallbacks.forEach((callback) => {\\n\\t\\t\\t\\t\\tcallback();\\n\\t\\t\\t\\t});\\n\\t\\t\\t});\\n\\t\\t};\\n\\n\\t\\tlet computation: Tracker.Computation | undefined;\\n\\n\\t\\tqueueMicrotask(() => {\\n\\t\\t\\tcomputation = Tracker.autorun(reactiveFn);\\n\\t\\t});\\n\\n\\t\\treturn [\\n\\t\\t\\t(callback): (() => void) => {\\n\\t\\t\\t\\tcallbacks.add(callback);\\n\\n\\t\\t\\t\\treturn (): void => {\\n\\t\\t\\t\\t\\tcallbacks.delete(callback);\\n\\n\\t\\t\\t\\t\\tif (callbacks.size === 0) {\\n\\t\\t\\t\\t\\t\\tqueueMicrotask(() => computation?.stop());\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t};\\n\\t\\t\\t},\\n\\t\\t\\t(): T => currentValue,\\n\\t\\t];\\n\\t};\\n\",null],\"names\":[\"Tracker\",\"queueMicrotask\",\"module\",\"export\",\"createReactiveSubscriptionFactory\",\"link\",\"v\",\"computeCurrentValueWith\",\"computation\",\"_len\",\"arguments\",\"length\",\"args\",\"Array\",\"_key\",\"callbacks\",\"Set\",\"currentValue\",\"reactiveFn\",\"forEach\",\"callback\",\"autorun\",\"add\",\"delete\",\"size\",\"_computation\",\"stop\"],\"mappings\":\"2BAAyCA,EAAAC,EAAzCC,EAAOC,MAAE,CAAA,CAAAC,kCAAgCA,IAAAA,CAAA,GAAAF,EAAAG,IAAA,CAAA,iBAAA,CAAAL,QAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,yBAAA,CAAAJ,eAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAQlC,IAAMF,EACRG,GACJ,eAcKC,EAd4F,IAAA,IAAAC,EAAAC,UAAAC,MAAA,CAA7FC,EAAW,AAAAC,MAAAJ,GAAAK,EAAA,EAAAA,EAAAL,EAAAK,IAAXF,CAAW,CAAAE,EAAA,CAAAJ,SAAA,CAAAI,EAAA,CACd,IAAMC,EAAY,IAAIC,IAElBC,EAAeV,KAA2BK,GAExCM,EAAaA,KAClBD,EAAeV,KAA2BK,GAC1CX,EAAe,KACdc,EAAUI,OAAO,CAAEC,IAClBA,GACD,EACD,EACD,EAQA,OAJAnB,EAAe,KACdO,EAAcR,EAAQqB,OAAO,CAACH,EAC/B,GAEO,CACLE,IACAL,EAAUO,GAAG,CAACF,GAEP,KACNL,EAAUQ,MAAM,CAACH,GAEM,IAAnBL,EAAUS,IAAI,EACjBvB,EAAe,KAAA,IAAAwB,EAAA,OAAA,AAAiB,OAAjBA,CAAAA,EAAMjB,CAAAA,GAAWiB,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAXA,EAAaC,IAAI,EAAE,EAE1C,GAED,IAAST,EACT,AACF\"}"}