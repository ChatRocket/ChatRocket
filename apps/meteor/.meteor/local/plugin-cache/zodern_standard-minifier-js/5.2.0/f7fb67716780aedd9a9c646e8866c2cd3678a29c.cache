{"code":"function module(e,t,r){let a,n,s;r.export({useMessageListNavigation:()=>u}),r.link(\"@react-aria/focus\",{createFocusManager(e){a=e}},0),r.link(\"react\",{useCallback(e){n=e}},1),r.link(\"react-aria\",{useFocusManager(e){s=e}},2);let o=e=>\"listitem\"===e.getAttribute(\"role\")||\"link\"===e.getAttribute(\"role\"),c=e=>{var t;return(null===(t=e.parentElement)||void 0===t?void 0:t.getAttribute(\"role\"))===\"toolbar\"},i=e=>e.classList.contains(\"rcx-message-system\"),l=e=>e.classList.contains(\"rcx-message-thread\"),u=()=>{let e=s(),t=n(t=>{let r=null,n=!0;if(!t)return;let s=a({current:t});t.addEventListener(\"keydown\",t=>{t.target&&o(t.target)&&(\"Tab\"===t.key&&(t.shiftKey?(t.preventDefault(),t.stopPropagation(),e.focusFirst({from:document.getElementsByClassName(\"rcx-room-header\")[0]})):(l(t.target)||i(t.target)||c(t.target))&&(t.preventDefault(),t.stopPropagation(),e.focusNext({accept:e=>\"TEXTAREA\"===e.tagName}))),(\"ArrowUp\"===t.key||\"ArrowDown\"===t.key)&&(\"ArrowUp\"===t.key&&s.focusPrevious({accept:e=>o(e)}),\"ArrowDown\"===t.key&&s.focusNext({accept:e=>o(e)}),r=document.activeElement))}),t.addEventListener(\"blur\",e=>{var t;null!==(t=e.relatedTarget)&&void 0!==t&&t.classList.contains(\"focus-visible\")&&e.currentTarget instanceof HTMLElement&&e.relatedTarget instanceof HTMLElement&&(e.currentTarget.contains(e.relatedTarget)||r||(r=e.target))},{capture:!0}),t.addEventListener(\"focus\",e=>{var a,c;let i=null===(a=e.target)||void 0===a?void 0:a.classList.contains(\"focus-visible\");if(i&&e.currentTarget instanceof HTMLElement&&e.relatedTarget instanceof HTMLElement){if(n){s.focusLast({accept:e=>o(e)}),r=document.activeElement,n=!1;return}r&&!e.currentTarget.contains(e.relatedTarget)&&t.contains(e.target)&&(null===(c=r)||void 0===c||c.focus())}},{capture:!0})},[e]);return{messageListRef:t}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/hooks/useMessageListNavigation.ts\",\"<anon>\"],\"sourcesContent\":[\"import { createFocusManager } from '@react-aria/focus';\\nimport type { RefCallback } from 'react';\\nimport { useCallback } from 'react';\\nimport { useFocusManager } from 'react-aria';\\n\\nconst isListItem = (node: EventTarget) =>\\n\\t(node as HTMLElement).getAttribute('role') === 'listitem' || (node as HTMLElement).getAttribute('role') === 'link';\\nconst isMessageToolbarAction = (node: EventTarget) => (node as HTMLElement).parentElement?.getAttribute('role') === 'toolbar';\\nconst isSystemMessage = (node: EventTarget) => (node as HTMLElement).classList.contains('rcx-message-system');\\nconst isThreadMessage = (node: EventTarget) => (node as HTMLElement).classList.contains('rcx-message-thread');\\n\\n/**\\n * Custom hook to provide the room navigation by keyboard.\\n * @param ref - A ref to the message list DOM element.\\n */\\nexport const useMessageListNavigation = (): { messageListRef: RefCallback<HTMLElement> } => {\\n\\tconst roomFocusManager = useFocusManager();\\n\\n\\tconst messageListRef = useCallback(\\n\\t\\t(node: HTMLElement | null) => {\\n\\t\\t\\tlet lastMessageFocused: HTMLElement | null = null;\\n\\t\\t\\tlet initialFocus = true;\\n\\n\\t\\t\\tif (!node) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst massageListFocusManager = createFocusManager({\\n\\t\\t\\t\\tcurrent: node,\\n\\t\\t\\t});\\n\\n\\t\\t\\tnode.addEventListener('keydown', (e) => {\\n\\t\\t\\t\\tif (!e.target) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (!isListItem(e.target)) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (e.key === 'Tab') {\\n\\t\\t\\t\\t\\tif (e.shiftKey) {\\n\\t\\t\\t\\t\\t\\te.preventDefault();\\n\\t\\t\\t\\t\\t\\te.stopPropagation();\\n\\n\\t\\t\\t\\t\\t\\troomFocusManager.focusFirst({\\n\\t\\t\\t\\t\\t\\t\\tfrom: document.getElementsByClassName('rcx-room-header')[0],\\n\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t} else if (isThreadMessage(e.target) || isSystemMessage(e.target) || isMessageToolbarAction(e.target)) {\\n\\t\\t\\t\\t\\t\\te.preventDefault();\\n\\t\\t\\t\\t\\t\\te.stopPropagation();\\n\\n\\t\\t\\t\\t\\t\\troomFocusManager.focusNext({\\n\\t\\t\\t\\t\\t\\t\\taccept: (node) => node.tagName === 'TEXTAREA',\\n\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (e.key === 'ArrowUp' || e.key === 'ArrowDown') {\\n\\t\\t\\t\\t\\tif (e.key === 'ArrowUp') {\\n\\t\\t\\t\\t\\t\\tmassageListFocusManager.focusPrevious({ accept: (node) => isListItem(node) });\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tif (e.key === 'ArrowDown') {\\n\\t\\t\\t\\t\\t\\tmassageListFocusManager.focusNext({ accept: (node) => isListItem(node) });\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tlastMessageFocused = document.activeElement as HTMLElement;\\n\\t\\t\\t\\t}\\n\\t\\t\\t});\\n\\n\\t\\t\\tnode.addEventListener(\\n\\t\\t\\t\\t'blur',\\n\\t\\t\\t\\t(e) => {\\n\\t\\t\\t\\t\\tif (\\n\\t\\t\\t\\t\\t\\t!(e.relatedTarget as HTMLElement)?.classList.contains('focus-visible') ||\\n\\t\\t\\t\\t\\t\\t!(e.currentTarget instanceof HTMLElement && e.relatedTarget instanceof HTMLElement)\\n\\t\\t\\t\\t\\t) {\\n\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tif (!e.currentTarget.contains(e.relatedTarget) && !lastMessageFocused) {\\n\\t\\t\\t\\t\\t\\tlastMessageFocused = e.target as HTMLElement;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\t{ capture: true },\\n\\t\\t\\t);\\n\\n\\t\\t\\tnode.addEventListener(\\n\\t\\t\\t\\t'focus',\\n\\t\\t\\t\\t(e) => {\\n\\t\\t\\t\\t\\tconst triggeredByKeyboard = (e.target as HTMLElement)?.classList.contains('focus-visible');\\n\\t\\t\\t\\t\\tif (!triggeredByKeyboard || !(e.currentTarget instanceof HTMLElement && e.relatedTarget instanceof HTMLElement)) {\\n\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tif (initialFocus) {\\n\\t\\t\\t\\t\\t\\tmassageListFocusManager.focusLast({ accept: (node) => isListItem(node) });\\n\\t\\t\\t\\t\\t\\tlastMessageFocused = document.activeElement as HTMLElement;\\n\\t\\t\\t\\t\\t\\tinitialFocus = false;\\n\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tif (lastMessageFocused && !e.currentTarget.contains(e.relatedTarget) && node.contains(e.target as HTMLElement)) {\\n\\t\\t\\t\\t\\t\\tlastMessageFocused?.focus();\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\t{ capture: true },\\n\\t\\t\\t);\\n\\t\\t},\\n\\t\\t[roomFocusManager],\\n\\t);\\n\\n\\treturn {\\n\\t\\tmessageListRef,\\n\\t};\\n};\\n\",null],\"names\":[\"createFocusManager\",\"useCallback\",\"useFocusManager\",\"module\",\"export\",\"useMessageListNavigation\",\"link\",\"v\",\"isListItem\",\"node\",\"getAttribute\",\"isMessageToolbarAction\",\"_node$parentElement\",\"parentElement\",\"isSystemMessage\",\"classList\",\"contains\",\"isThreadMessage\",\"roomFocusManager\",\"messageListRef\",\"lastMessageFocused\",\"initialFocus\",\"massageListFocusManager\",\"current\",\"addEventListener\",\"e\",\"target\",\"key\",\"shiftKey\",\"preventDefault\",\"stopPropagation\",\"focusFirst\",\"from\",\"document\",\"getElementsByClassName\",\"focusNext\",\"accept\",\"tagName\",\"focusPrevious\",\"activeElement\",\"_e$relatedTarget\",\"relatedTarget\",\"currentTarget\",\"HTMLElement\",\"capture\",\"_e$target\",\"_lastMessageFocused\",\"triggeredByKeyboard\",\"focusLast\",\"focus\"],\"mappings\":\"2BAAuDA,EAAAC,EAAAC,EAAvDC,EAAOC,MAAE,CAAA,CAAAC,yBAA0BA,IAAAA,CAAoB,GAAAF,EAAAG,IAAA,CAAA,oBAAA,CAAAN,mBAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,QAAA,CAAAL,YAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,aAAA,CAAAJ,gBAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAKvD,IAAMC,EAAcC,GAClBA,AAA8C,aAA9CA,EAAqBC,YAAY,CAAC,SAA2BD,AAA8C,SAA9CA,EAAqBC,YAAY,CAAC,QAC3FC,EAA0BF,IAAiB,IAAAG,EAAA,MAAM,CAAA,AAAkC,OAAlCA,CAAAA,EAAAH,EAAqBI,aAAa,AAAbA,GAAaD,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAlCA,EAAoCF,YAAY,CAAC,OAAM,IAAM,SAAS,EACvHI,EAAmBL,GAAuBA,EAAqBM,SAAS,CAACC,QAAQ,CAAC,sBAClFC,EAAmBR,GAAuBA,EAAqBM,SAAS,CAACC,QAAQ,CAAC,sBAM3EX,EAA2BA,KACvC,IAAMa,EAAmBhB,IAEnBiB,EAAiBlB,EACrBQ,IACA,IAAIW,EAAyC,KACzCC,EAAe,CAAA,EAEnB,GAAI,CAACZ,EACJ,OAGD,IAAMa,EAA0BtB,EAAmB,CAClDuB,QAASd,IAGVA,EAAKe,gBAAgB,CAAC,UAAYC,IAC5BA,EAAEC,MAAM,EAIRlB,EAAWiB,EAAEC,MAAM,IAIV,QAAVD,EAAEE,GAAG,GACJF,EAAEG,QAAQ,EACbH,EAAEI,cAAc,GAChBJ,EAAEK,eAAe,GAEjBZ,EAAiBa,UAAU,CAAC,CAC3BC,KAAMC,SAASC,sBAAsB,CAAC,kBAAkB,CAAC,EAAC,IAEjDjB,CAAAA,EAAgBQ,EAAEC,MAAM,GAAKZ,EAAgBW,EAAEC,MAAM,GAAKf,EAAuBc,EAAEC,MAAM,CAAA,IACnGD,EAAEI,cAAc,GAChBJ,EAAEK,eAAe,GAEjBZ,EAAiBiB,SAAS,CAAC,CAC1BC,OAAS3B,GAASA,AAAiB,aAAjBA,EAAK4B,OAAO,KAK7BZ,CAAAA,AAAU,YAAVA,EAAEE,GAAG,EAAkBF,AAAU,cAAVA,EAAEE,GAAG,AAAK,IACtB,YAAVF,EAAEE,GAAG,EACRL,EAAwBgB,aAAa,CAAC,CAAEF,OAAS3B,GAASD,EAAWC,EAAK,GAG7D,cAAVgB,EAAEE,GAAG,EACRL,EAAwBa,SAAS,CAAC,CAAEC,OAAS3B,GAASD,EAAWC,EAAK,GAGvEW,EAAqBa,SAASM,aAA4B,EAE5D,GAEA9B,EAAKe,gBAAgB,CACpB,OACCC,IAAK,IAAAe,CAE6B,QAAjCA,CAAAA,EAAEf,EAAEgB,aAA6B,AAA7BA,GAA6BD,AAAA,KAAA,IAAAA,GAA/BA,EAAiCzB,SAAS,CAACC,QAAQ,CAAC,kBACpDS,EAAEiB,aAAa,YAAYC,aAAelB,EAAEgB,aAAa,YAAYE,cAKnElB,EAAEiB,aAAa,CAAC1B,QAAQ,CAACS,EAAEgB,aAAa,GAAMrB,GAClDA,CAAAA,EAAqBK,EAAEC,MAAqB,AAArBA,EAEzB,EACA,CAAEkB,QAAS,CAAA,CAAI,GAGhBnC,EAAKe,gBAAgB,CACpB,QACCC,QAAKoB,EAa2GC,EAZhH,IAAMC,EAAmB,AAA4B,OAA5BF,CAAAA,EAAIpB,EAAEC,MAAsB,AAAtBA,GAAsBmB,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAxBA,EAA0B9B,SAAS,CAACC,QAAQ,CAAC,iBAC1E,GAAI,AAAC+B,GAAyBtB,EAAEiB,aAAa,YAAYC,aAAelB,EAAEgB,aAAa,YAAYE,aAInG,GAAItB,EAAc,CACjBC,EAAwB0B,SAAS,CAAC,CAAEZ,OAAS3B,GAASD,EAAWC,EAAK,GACtEW,EAAqBa,SAASM,aAA4B,CAC1DlB,EAAe,CAAA,EACf,MACD,CAEID,GAAsB,CAACK,EAAEiB,aAAa,CAAC1B,QAAQ,CAACS,EAAEgB,aAAa,GAAKhC,EAAKO,QAAQ,CAACS,EAAEC,MAAqB,GAC5G,CAAA,AAAkB,OAAlBoB,CAAAA,EAAA1B,CAAAA,GAAkB0B,AAAA,KAAA,IAAAA,GAAlBA,EAAoBG,KAAK,EAAA,EAE3B,EACA,CAAEL,QAAS,CAAA,CAAI,EAEjB,EACA,CAAC1B,EAAiB,EAGnB,MAAO,CACNC,eAAAA,EAEF\"}"}