{"code":"function module(e,o,i){let t,n,s,l,r,a,c,u,d,k;i.link(\"@rocket.chat/fuselage\",{Box(e){t=e}},0),i.link(\"@rocket.chat/ui-contexts\",{useUserId(e){n=e}},1),i.link(\"@rocket.chat/ui-voip\",{useVoipAPI(e){s=e},useVoipState(e){l=e}},2),i.link(\"react\",{default(e){r=e},useMemo(e){a=e}},3),i.link(\"react-i18next\",{useTranslation(e){c=e}},4),i.link(\"../../../views/room/composer/messageBox/hooks/useMediaPermissions\",{useMediaPermissions(e){u=e}},5),i.link(\"../../../views/room/contexts/RoomContext\",{useRoom(e){d=e}},6),i.link(\"../../useUserInfoQuery\",{useUserInfoQuery(e){k=e}},7),i.exportDefault(()=>{let{t:e}=c(),{uids:o=[]}=d(),i=n(),[m]=u(\"microphone\"),{isEnabled:h,isRegistered:_,isInCall:p}=l(),{makeCall:f}=s(),x=a(()=>o.filter(e=>e!==i),[o,i]),w=x[0],{data:{user:g}={},isLoading:v}=k({userId:w},{enabled:!!w}),I=!!(null!=g&&g.freeSwitchExtension),E=1===x.length,M=m||!E||!I||!_||p||v,S=a(()=>m?e(\"Microphone_access_not_allowed\"):p?e(\"Unable_to_make_calls_while_another_is_ongoing\"):M?e(\"Voice_calling_disabled\"):\"\",[M,p,m,e]);return a(()=>{let o=[{id:\"start-voip-call\",icon:\"phone\",disabled:M,onClick:()=>f(null==g?void 0:g.freeSwitchExtension),content:r.createElement(t,{is:\"span\",title:S},e(\"Voice_call\"))}];return{items:h?o:[],groups:[\"direct\"],disabled:M,allowed:h,order:4}},[M,S,e,h,f,null==g?void 0:g.freeSwitchExtension])})}","map":"{\"version\":3,\"sources\":[\"client/hooks/roomActions/useStartCallRoomAction/useVoipMenuOptions.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { Box } from '@rocket.chat/fuselage';\\nimport type { GenericMenuItemProps } from '@rocket.chat/ui-client';\\nimport { useUserId } from '@rocket.chat/ui-contexts';\\nimport { useVoipAPI, useVoipState } from '@rocket.chat/ui-voip';\\nimport React, { useMemo } from 'react';\\nimport { useTranslation } from 'react-i18next';\\n\\nimport { useMediaPermissions } from '../../../views/room/composer/messageBox/hooks/useMediaPermissions';\\nimport { useRoom } from '../../../views/room/contexts/RoomContext';\\nimport { useUserInfoQuery } from '../../useUserInfoQuery';\\n\\nconst useVoipMenuOptions = () => {\\n\\tconst { t } = useTranslation();\\n\\tconst { uids = [] } = useRoom();\\n\\tconst ownUserId = useUserId();\\n\\n\\tconst [isMicPermissionDenied] = useMediaPermissions('microphone');\\n\\n\\tconst { isEnabled, isRegistered, isInCall } = useVoipState();\\n\\tconst { makeCall } = useVoipAPI();\\n\\n\\tconst members = useMemo(() => uids.filter((uid) => uid !== ownUserId), [uids, ownUserId]);\\n\\tconst remoteUserId = members[0];\\n\\n\\tconst { data: { user: remoteUser } = {}, isLoading } = useUserInfoQuery({ userId: remoteUserId }, { enabled: Boolean(remoteUserId) });\\n\\n\\tconst isRemoteRegistered = !!remoteUser?.freeSwitchExtension;\\n\\tconst isDM = members.length === 1;\\n\\n\\tconst disabled = isMicPermissionDenied || !isDM || !isRemoteRegistered || !isRegistered || isInCall || isLoading;\\n\\n\\tconst title = useMemo(() => {\\n\\t\\tif (isMicPermissionDenied) {\\n\\t\\t\\treturn t('Microphone_access_not_allowed');\\n\\t\\t}\\n\\n\\t\\tif (isInCall) {\\n\\t\\t\\treturn t('Unable_to_make_calls_while_another_is_ongoing');\\n\\t\\t}\\n\\n\\t\\treturn disabled ? t('Voice_calling_disabled') : '';\\n\\t}, [disabled, isInCall, isMicPermissionDenied, t]);\\n\\n\\treturn useMemo(() => {\\n\\t\\tconst items: GenericMenuItemProps[] = [\\n\\t\\t\\t{\\n\\t\\t\\t\\tid: 'start-voip-call',\\n\\t\\t\\t\\ticon: 'phone',\\n\\t\\t\\t\\tdisabled,\\n\\t\\t\\t\\tonClick: () => makeCall(remoteUser?.freeSwitchExtension as string),\\n\\t\\t\\t\\tcontent: (\\n\\t\\t\\t\\t\\t<Box is='span' title={title}>\\n\\t\\t\\t\\t\\t\\t{t('Voice_call')}\\n\\t\\t\\t\\t\\t</Box>\\n\\t\\t\\t\\t),\\n\\t\\t\\t},\\n\\t\\t];\\n\\n\\t\\treturn {\\n\\t\\t\\titems: isEnabled ? items : [],\\n\\t\\t\\tgroups: ['direct'] as const,\\n\\t\\t\\tdisabled,\\n\\t\\t\\tallowed: isEnabled,\\n\\t\\t\\torder: 4,\\n\\t\\t};\\n\\t}, [disabled, title, t, isEnabled, makeCall, remoteUser?.freeSwitchExtension]);\\n};\\n\\nexport default useVoipMenuOptions;\\n\",null],\"names\":[\"Box\",\"useUserId\",\"useVoipAPI\",\"useVoipState\",\"React\",\"useMemo\",\"useTranslation\",\"useMediaPermissions\",\"useRoom\",\"useUserInfoQuery\",\"module\",\"link\",\"v\",\"default\",\"exportDefault\",\"useVoipMenuOptions\",\"t\",\"uids\",\"ownUserId\",\"isMicPermissionDenied\",\"isEnabled\",\"isRegistered\",\"isInCall\",\"makeCall\",\"members\",\"filter\",\"uid\",\"remoteUserId\",\"data\",\"user\",\"remoteUser\",\"isLoading\",\"userId\",\"enabled\",\"Boolean\",\"isRemoteRegistered\",\"freeSwitchExtension\",\"isDM\",\"length\",\"disabled\",\"title\",\"items\",\"id\",\"icon\",\"onClick\",\"content\",\"createElement\",\"is\",\"groups\",\"allowed\",\"order\"],\"mappings\":\"2BAAAA,EAA4CC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAArCC,EAAOC,IAAA,CAAM,wBAAwB,CAAAX,IAAAY,CAAA,EAAAZ,EAAAY,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,2BAAA,CAAAV,UAAAW,CAAA,EAAAX,EAAAW,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,uBAAA,CAAAT,WAAAU,CAAA,EAAAV,EAAAU,CAAA,EAAAT,aAAAS,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,QAAA,CAAAE,QAAAD,CAAA,EAAAR,EAAAQ,CAAA,EAAAP,QAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,gBAAA,CAAAL,eAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,oEAAA,CAAAJ,oBAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,2CAAA,CAAAH,QAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,yBAAA,CAAAF,iBAAAG,CAAA,EAAAH,EAAAG,CAAA,CAAA,EAAA,GAA5CF,EAAOI,aAAa,CAWOC,KAC1B,GAAM,CAAEC,EAAAA,CAAAA,CAAG,CAAGV,IACR,CAAEW,KAAAA,EAAO,EAAA,CAAI,CAAGT,IAChBU,EAAYjB,IAEZ,CAACkB,EAAsB,CAAGZ,EAAoB,cAE9C,CAAEa,UAAAA,CAAS,CAAEC,aAAAA,CAAY,CAAEC,SAAAA,CAAAA,CAAU,CAAGnB,IACxC,CAAEoB,SAAAA,CAAAA,CAAU,CAAGrB,IAEfsB,EAAUnB,EAAQ,IAAMY,EAAKQ,MAAM,CAAEC,GAAQA,IAAQR,GAAY,CAACD,EAAMC,EAAU,EAClFS,EAAeH,CAAO,CAAC,EAAE,CAEzB,CAAEI,KAAM,CAAEC,KAAMC,CAAAA,CAAY,CAAG,CAAA,CAAE,CAAEC,UAAAA,CAAAA,CAAW,CAAGtB,EAAiB,CAAEuB,OAAQL,CAAY,EAAI,CAAEM,QAASC,CAAAA,CAAQP,CAAa,GAE5HQ,EAAqB,CAAC,CAACL,CAAAA,MAAAA,GAAAA,EAAYM,mBAAmB,AAAnBA,EACnCC,EAAOb,AAAmB,IAAnBA,EAAQc,MAAM,CAErBC,EAAWpB,GAAyB,CAACkB,GAAQ,CAACF,GAAsB,CAACd,GAAgBC,GAAYS,EAEjGS,EAAQnC,EAAQ,IACrB,AAAIc,EACIH,EAAE,iCAGNM,EACIN,EAAE,iDAGHuB,EAAWvB,EAAE,0BAA4B,GAC9C,CAACuB,EAAUjB,EAAUH,EAAuBH,EAAE,EAEjD,OAAOX,EAAQ,KACd,IAAMoC,EAAgC,CACrC,CACCC,GAAI,kBACJC,KAAM,QACNJ,SAAAA,EACAK,QAASA,IAAMrB,EAASO,MAAAA,EAAU,KAAA,EAAVA,EAAYM,mBAA6B,EACjES,QACCzC,EAAA0C,aAAA,CAAC9C,EAAG,CAAC+C,GAAG,OAAOP,MAAOA,CAAM,EAC1BxB,EAAE,gBAIN,CAED,MAAO,CACNyB,MAAOrB,EAAYqB,EAAQ,EAAE,CAC7BO,OAAQ,CAAC,SAAkB,CAC3BT,SAAAA,EACAU,QAAS7B,EACT8B,MAAO,EAET,EAAG,CAACX,EAAUC,EAAOxB,EAAGI,EAAWG,EAAUO,MAAAA,EAAU,KAAA,EAAVA,EAAYM,mBAAmB,CAAC,CAC9E\"}"}