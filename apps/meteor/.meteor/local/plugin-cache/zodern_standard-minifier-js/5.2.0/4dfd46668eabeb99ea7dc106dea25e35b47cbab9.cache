{"code":"function module(e,o,r){let n,t,i,s,a,l,m,d,_,u,c,g,k,p,v,h,M;r.export({useChangeModeratorAction:()=>f}),r.link(\"@rocket.chat/core-typings\",{isRoomFederated(e){n=e}},0),r.link(\"@rocket.chat/fuselage-hooks\",{useMutableCallback(e){t=e}},1),r.link(\"@rocket.chat/string-helpers\",{escapeHTML(e){i=e}},2),r.link(\"@rocket.chat/ui-contexts\",{useTranslation(e){s=e},usePermission(e){a=e},useUserRoom(e){l=e},useUserSubscription(e){m=e},useUser(e){d=e},useSetModal(e){_=e}},3),r.link(\"react\",{default(e){u=e},useCallback(e){c=e},useMemo(e){g=e}},4),r.link(\"../../../../../components/GenericModal\",{default(e){k=e}},5),r.link(\"../../../../../hooks/useEndpointAction\",{useEndpointAction(e){p=e}},6),r.link(\"../../../../../lib/rooms/roomCoordinator\",{roomCoordinator(e){v=e}},7),r.link(\"../../../lib/getRoomDirectives\",{getRoomDirectives(e){h=e}},8),r.link(\"../../useUserHasRoomRole\",{useUserHasRoomRole(e){M=e}},9);let R=(e,o,r,n,t)=>u.createElement(k,{variant:\"warning\",onClose:e,onConfirm:o,onCancel:e,title:r,confirmText:n},t),f=(e,o)=>{let r=s(),u=l(o),{_id:k}=e,f=a(\"set-moderator\",o),C=M(k,o,\"moderator\"),I=m(o),{_id:U=\"\"}=d()||{},b=M(U,o,\"moderator\"),w=M(U,o,\"owner\"),x=_(),E=c(()=>x(null),[x]);if(!u)throw Error(\"Room not provided\");let{roomCanSetModerator:F}=h({room:u,showingUserId:k,userSubscription:I}),S=(null==u?void 0:u.t)&&i(v.getRoomName(u.t,u)),T=\"p\"===u.t?\"/v1/groups\":\"/v1/channels\",A=C?\"removeModerator\":\"addModerator\",H=C?\"User__username__removed_from__room_name__moderators\":\"User__username__is_now_a_moderator_of__room_name_\",y=p(\"POST\",\"\".concat(T,\".\").concat(A),{successMessage:r(H,{username:e.username,room_name:S})}),D=c(()=>{y({roomId:o,userId:k}),E()},[y,o,k,E]),P=c(e=>{let{userId:t}=e;if(!n(u))return y({roomId:o,userId:k});let i=t===U;return i&&b||i&&w?x(()=>R(E,D,r(\"Federation_Matrix_losing_privileges\"),r(\"Yes_continue\"),r(\"Federation_Matrix_losing_privileges_warning\"))):!i&&b?x(()=>R(E,D,r(\"Warning\"),r(\"Yes_continue\"),r(\"Federation_Matrix_giving_same_permission_warning\"))):void y({roomId:o,userId:k})},[x,U,b,w,r,o,k,y,E,D,u]),Y=t(()=>P({roomId:o,userId:k})),G=g(()=>n(u)&&F||!n(u)&&F&&f?{content:r(C?\"Remove_as_moderator\":\"Set_as_moderator\"),icon:\"shield-blank\",onClick:Y,type:\"privileges\"}:void 0,[Y,C,F,r,f,u]);return G}}","map":"{\"version\":3,\"sources\":[\"client/views/room/hooks/useUserInfoActions/actions/useChangeModeratorAction.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom, IUser } from '@rocket.chat/core-typings';\\nimport { isRoomFederated } from '@rocket.chat/core-typings';\\nimport { useMutableCallback } from '@rocket.chat/fuselage-hooks';\\nimport { escapeHTML } from '@rocket.chat/string-helpers';\\nimport { useTranslation, usePermission, useUserRoom, useUserSubscription, useUser, useSetModal } from '@rocket.chat/ui-contexts';\\nimport type { ReactElement } from 'react';\\nimport React, { useCallback, useMemo } from 'react';\\n\\nimport GenericModal from '../../../../../components/GenericModal';\\nimport { useEndpointAction } from '../../../../../hooks/useEndpointAction';\\nimport { roomCoordinator } from '../../../../../lib/rooms/roomCoordinator';\\nimport { getRoomDirectives } from '../../../lib/getRoomDirectives';\\nimport { useUserHasRoomRole } from '../../useUserHasRoomRole';\\nimport type { UserInfoAction, UserInfoActionType } from '../useUserInfoActions';\\n\\nconst getWarningModalForFederatedRooms = (\\n\\tcloseModalFn: () => void,\\n\\thandleConfirmFn: () => void,\\n\\ttitle: string,\\n\\tconfirmText: string,\\n\\tbodyText: string,\\n): ReactElement => (\\n\\t<GenericModal\\n\\t\\tvariant='warning'\\n\\t\\tonClose={closeModalFn}\\n\\t\\tonConfirm={handleConfirmFn}\\n\\t\\tonCancel={closeModalFn}\\n\\t\\ttitle={title}\\n\\t\\tconfirmText={confirmText}\\n\\t>\\n\\t\\t{bodyText}\\n\\t</GenericModal>\\n);\\n\\nexport const useChangeModeratorAction = (user: Pick<IUser, '_id' | 'username'>, rid: IRoom['_id']): UserInfoAction | undefined => {\\n\\tconst t = useTranslation();\\n\\tconst room = useUserRoom(rid);\\n\\tconst { _id: uid } = user;\\n\\n\\tconst userCanSetModerator = usePermission('set-moderator', rid);\\n\\tconst isModerator = useUserHasRoomRole(uid, rid, 'moderator');\\n\\tconst userSubscription = useUserSubscription(rid);\\n\\tconst { _id: loggedUserId = '' } = useUser() || {};\\n\\tconst loggedUserIsModerator = useUserHasRoomRole(loggedUserId, rid, 'moderator');\\n\\tconst loggedUserIsOwner = useUserHasRoomRole(loggedUserId, rid, 'owner');\\n\\tconst setModal = useSetModal();\\n\\tconst closeModal = useCallback(() => setModal(null), [setModal]);\\n\\n\\tif (!room) {\\n\\t\\tthrow Error('Room not provided');\\n\\t}\\n\\n\\tconst { roomCanSetModerator } = getRoomDirectives({ room, showingUserId: uid, userSubscription });\\n\\tconst roomName = room?.t && escapeHTML(roomCoordinator.getRoomName(room.t, room));\\n\\n\\tconst endpointPrefix = room.t === 'p' ? '/v1/groups' : '/v1/channels';\\n\\tconst changeModeratorEndpoint = isModerator ? 'removeModerator' : 'addModerator';\\n\\tconst changeModeratorMessage = isModerator\\n\\t\\t? 'User__username__removed_from__room_name__moderators'\\n\\t\\t: 'User__username__is_now_a_moderator_of__room_name_';\\n\\n\\tconst changeModerator = useEndpointAction('POST', `${endpointPrefix}.${changeModeratorEndpoint}`, {\\n\\t\\tsuccessMessage: t(changeModeratorMessage, { username: user.username, room_name: roomName }),\\n\\t});\\n\\n\\tconst handleConfirm = useCallback(() => {\\n\\t\\tchangeModerator({ roomId: rid, userId: uid });\\n\\t\\tcloseModal();\\n\\t}, [changeModerator, rid, uid, closeModal]);\\n\\n\\tconst handleChangeModerator = useCallback(\\n\\t\\t({ userId }) => {\\n\\t\\t\\tif (!isRoomFederated(room)) {\\n\\t\\t\\t\\treturn changeModerator({ roomId: rid, userId: uid });\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst changingOwnRole = userId === loggedUserId;\\n\\t\\t\\tif (changingOwnRole && loggedUserIsModerator) {\\n\\t\\t\\t\\treturn setModal(() =>\\n\\t\\t\\t\\t\\tgetWarningModalForFederatedRooms(\\n\\t\\t\\t\\t\\t\\tcloseModal,\\n\\t\\t\\t\\t\\t\\thandleConfirm,\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_losing_privileges'),\\n\\t\\t\\t\\t\\t\\tt('Yes_continue'),\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_losing_privileges_warning'),\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t\\t);\\n\\t\\t\\t}\\n\\n\\t\\t\\tif (changingOwnRole && loggedUserIsOwner) {\\n\\t\\t\\t\\treturn setModal(() =>\\n\\t\\t\\t\\t\\tgetWarningModalForFederatedRooms(\\n\\t\\t\\t\\t\\t\\tcloseModal,\\n\\t\\t\\t\\t\\t\\thandleConfirm,\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_losing_privileges'),\\n\\t\\t\\t\\t\\t\\tt('Yes_continue'),\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_losing_privileges_warning'),\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t\\t);\\n\\t\\t\\t}\\n\\n\\t\\t\\tif (!changingOwnRole && loggedUserIsModerator) {\\n\\t\\t\\t\\treturn setModal(() =>\\n\\t\\t\\t\\t\\tgetWarningModalForFederatedRooms(\\n\\t\\t\\t\\t\\t\\tcloseModal,\\n\\t\\t\\t\\t\\t\\thandleConfirm,\\n\\t\\t\\t\\t\\t\\tt('Warning'),\\n\\t\\t\\t\\t\\t\\tt('Yes_continue'),\\n\\t\\t\\t\\t\\t\\tt('Federation_Matrix_giving_same_permission_warning'),\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t\\t);\\n\\t\\t\\t}\\n\\n\\t\\t\\tchangeModerator({ roomId: rid, userId: uid });\\n\\t\\t},\\n\\t\\t[setModal, loggedUserId, loggedUserIsModerator, loggedUserIsOwner, t, rid, uid, changeModerator, closeModal, handleConfirm, room],\\n\\t);\\n\\n\\tconst changeModeratorAction = useMutableCallback(() => handleChangeModerator({ roomId: rid, userId: uid }));\\n\\tconst changeModeratorOption = useMemo(\\n\\t\\t() =>\\n\\t\\t\\t(isRoomFederated(room) && roomCanSetModerator) || (!isRoomFederated(room) && roomCanSetModerator && userCanSetModerator)\\n\\t\\t\\t\\t? {\\n\\t\\t\\t\\t\\t\\tcontent: t(isModerator ? 'Remove_as_moderator' : 'Set_as_moderator'),\\n\\t\\t\\t\\t\\t\\ticon: 'shield-blank' as const,\\n\\t\\t\\t\\t\\t\\tonClick: changeModeratorAction,\\n\\t\\t\\t\\t\\t\\ttype: 'privileges' as UserInfoActionType,\\n\\t\\t\\t\\t  }\\n\\t\\t\\t\\t: undefined,\\n\\t\\t[changeModeratorAction, isModerator, roomCanSetModerator, t, userCanSetModerator, room],\\n\\t);\\n\\n\\treturn changeModeratorOption;\\n};\\n\",null],\"names\":[\"isRoomFederated\",\"useMutableCallback\",\"escapeHTML\",\"useTranslation\",\"usePermission\",\"useUserRoom\",\"useUserSubscription\",\"useUser\",\"useSetModal\",\"React\",\"useCallback\",\"useMemo\",\"GenericModal\",\"useEndpointAction\",\"roomCoordinator\",\"getRoomDirectives\",\"useUserHasRoomRole\",\"module\",\"export\",\"useChangeModeratorAction\",\"link\",\"v\",\"default\",\"getWarningModalForFederatedRooms\",\"closeModalFn\",\"handleConfirmFn\",\"title\",\"confirmText\",\"bodyText\",\"createElement\",\"variant\",\"onClose\",\"onConfirm\",\"onCancel\",\"user\",\"rid\",\"t\",\"room\",\"_id\",\"uid\",\"userCanSetModerator\",\"isModerator\",\"userSubscription\",\"loggedUserId\",\"loggedUserIsModerator\",\"loggedUserIsOwner\",\"setModal\",\"closeModal\",\"Error\",\"roomCanSetModerator\",\"showingUserId\",\"roomName\",\"getRoomName\",\"endpointPrefix\",\"changeModeratorEndpoint\",\"changeModeratorMessage\",\"changeModerator\",\"concat\",\"successMessage\",\"username\",\"room_name\",\"handleConfirm\",\"roomId\",\"userId\",\"handleChangeModerator\",\"_ref\",\"changingOwnRole\",\"changeModeratorAction\",\"changeModeratorOption\",\"content\",\"icon\",\"onClick\",\"type\",\"undefined\"],\"mappings\":\"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\"}"}