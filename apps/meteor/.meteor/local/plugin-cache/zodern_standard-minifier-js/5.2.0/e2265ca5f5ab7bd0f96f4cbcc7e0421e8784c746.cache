{"code":"function module(t,e,n){n.export({useMessageListNavigation:function(){return s}}),n.link(\"@react-aria/focus\",{createFocusManager:function(t){r=t}},0),n.link(\"react\",{useCallback:function(t){a=t}},1),n.link(\"react-aria\",{useFocusManager:function(t){o=t}},2);var r,a,o,c=function(t){return\"listitem\"===t.getAttribute(\"role\")||\"link\"===t.getAttribute(\"role\")},i=function(t){var e;return(null===(e=t.parentElement)||void 0===e?void 0:e.getAttribute(\"role\"))===\"toolbar\"},s=function(){var t=o();return{messageListRef:a(function(e){var n=null,a=!0;if(e){var o=r({current:e});e.addEventListener(\"keydown\",function(e){e.target&&c(e.target)&&(\"Tab\"===e.key&&(e.shiftKey?(e.preventDefault(),e.stopPropagation(),t.focusFirst({from:document.getElementsByClassName(\"rcx-room-header\")[0]})):(e.target.classList.contains(\"rcx-message-thread\")||e.target.classList.contains(\"rcx-message-system\")||i(e.target))&&(e.preventDefault(),e.stopPropagation(),t.focusNext({accept:function(t){return\"TEXTAREA\"===t.tagName}}))),(\"ArrowUp\"===e.key||\"ArrowDown\"===e.key)&&(\"ArrowUp\"===e.key&&o.focusPrevious({accept:function(t){return c(t)}}),\"ArrowDown\"===e.key&&o.focusNext({accept:function(t){return c(t)}}),n=document.activeElement))}),e.addEventListener(\"blur\",function(t){var e;null!==(e=t.relatedTarget)&&void 0!==e&&e.classList.contains(\"focus-visible\")&&t.currentTarget instanceof HTMLElement&&t.relatedTarget instanceof HTMLElement&&(t.currentTarget.contains(t.relatedTarget)||n||(n=t.target))},{capture:!0}),e.addEventListener(\"focus\",function(t){var r,i;if((null===(r=t.target)||void 0===r?void 0:r.classList.contains(\"focus-visible\"))&&t.currentTarget instanceof HTMLElement&&t.relatedTarget instanceof HTMLElement){if(a){o.focusLast({accept:function(t){return c(t)}}),n=document.activeElement,a=!1;return}n&&!t.currentTarget.contains(t.relatedTarget)&&e.contains(t.target)&&(null===(i=n)||void 0===i||i.focus())}},{capture:!0})}},[t])}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/hooks/useMessageListNavigation.ts\",\"<anon>\"],\"sourcesContent\":[\"import { createFocusManager } from '@react-aria/focus';\\nimport type { RefCallback } from 'react';\\nimport { useCallback } from 'react';\\nimport { useFocusManager } from 'react-aria';\\n\\nconst isListItem = (node: EventTarget) =>\\n\\t(node as HTMLElement).getAttribute('role') === 'listitem' || (node as HTMLElement).getAttribute('role') === 'link';\\nconst isMessageToolbarAction = (node: EventTarget) => (node as HTMLElement).parentElement?.getAttribute('role') === 'toolbar';\\nconst isSystemMessage = (node: EventTarget) => (node as HTMLElement).classList.contains('rcx-message-system');\\nconst isThreadMessage = (node: EventTarget) => (node as HTMLElement).classList.contains('rcx-message-thread');\\n\\n/**\\n * Custom hook to provide the room navigation by keyboard.\\n * @param ref - A ref to the message list DOM element.\\n */\\nexport const useMessageListNavigation = (): { messageListRef: RefCallback<HTMLElement> } => {\\n\\tconst roomFocusManager = useFocusManager();\\n\\n\\tconst messageListRef = useCallback(\\n\\t\\t(node: HTMLElement | null) => {\\n\\t\\t\\tlet lastMessageFocused: HTMLElement | null = null;\\n\\t\\t\\tlet initialFocus = true;\\n\\n\\t\\t\\tif (!node) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst massageListFocusManager = createFocusManager({\\n\\t\\t\\t\\tcurrent: node,\\n\\t\\t\\t});\\n\\n\\t\\t\\tnode.addEventListener('keydown', (e) => {\\n\\t\\t\\t\\tif (!e.target) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (!isListItem(e.target)) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (e.key === 'Tab') {\\n\\t\\t\\t\\t\\tif (e.shiftKey) {\\n\\t\\t\\t\\t\\t\\te.preventDefault();\\n\\t\\t\\t\\t\\t\\te.stopPropagation();\\n\\n\\t\\t\\t\\t\\t\\troomFocusManager.focusFirst({\\n\\t\\t\\t\\t\\t\\t\\tfrom: document.getElementsByClassName('rcx-room-header')[0],\\n\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t} else if (isThreadMessage(e.target) || isSystemMessage(e.target) || isMessageToolbarAction(e.target)) {\\n\\t\\t\\t\\t\\t\\te.preventDefault();\\n\\t\\t\\t\\t\\t\\te.stopPropagation();\\n\\n\\t\\t\\t\\t\\t\\troomFocusManager.focusNext({\\n\\t\\t\\t\\t\\t\\t\\taccept: (node) => node.tagName === 'TEXTAREA',\\n\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (e.key === 'ArrowUp' || e.key === 'ArrowDown') {\\n\\t\\t\\t\\t\\tif (e.key === 'ArrowUp') {\\n\\t\\t\\t\\t\\t\\tmassageListFocusManager.focusPrevious({ accept: (node) => isListItem(node) });\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tif (e.key === 'ArrowDown') {\\n\\t\\t\\t\\t\\t\\tmassageListFocusManager.focusNext({ accept: (node) => isListItem(node) });\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tlastMessageFocused = document.activeElement as HTMLElement;\\n\\t\\t\\t\\t}\\n\\t\\t\\t});\\n\\n\\t\\t\\tnode.addEventListener(\\n\\t\\t\\t\\t'blur',\\n\\t\\t\\t\\t(e) => {\\n\\t\\t\\t\\t\\tif (\\n\\t\\t\\t\\t\\t\\t!(e.relatedTarget as HTMLElement)?.classList.contains('focus-visible') ||\\n\\t\\t\\t\\t\\t\\t!(e.currentTarget instanceof HTMLElement && e.relatedTarget instanceof HTMLElement)\\n\\t\\t\\t\\t\\t) {\\n\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tif (!e.currentTarget.contains(e.relatedTarget) && !lastMessageFocused) {\\n\\t\\t\\t\\t\\t\\tlastMessageFocused = e.target as HTMLElement;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\t{ capture: true },\\n\\t\\t\\t);\\n\\n\\t\\t\\tnode.addEventListener(\\n\\t\\t\\t\\t'focus',\\n\\t\\t\\t\\t(e) => {\\n\\t\\t\\t\\t\\tconst triggeredByKeyboard = (e.target as HTMLElement)?.classList.contains('focus-visible');\\n\\t\\t\\t\\t\\tif (!triggeredByKeyboard || !(e.currentTarget instanceof HTMLElement && e.relatedTarget instanceof HTMLElement)) {\\n\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tif (initialFocus) {\\n\\t\\t\\t\\t\\t\\tmassageListFocusManager.focusLast({ accept: (node) => isListItem(node) });\\n\\t\\t\\t\\t\\t\\tlastMessageFocused = document.activeElement as HTMLElement;\\n\\t\\t\\t\\t\\t\\tinitialFocus = false;\\n\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tif (lastMessageFocused && !e.currentTarget.contains(e.relatedTarget) && node.contains(e.target as HTMLElement)) {\\n\\t\\t\\t\\t\\t\\tlastMessageFocused?.focus();\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\t{ capture: true },\\n\\t\\t\\t);\\n\\t\\t},\\n\\t\\t[roomFocusManager],\\n\\t);\\n\\n\\treturn {\\n\\t\\tmessageListRef,\\n\\t};\\n};\\n\",null],\"names\":[\"module\",\"export\",\"useMessageListNavigation\",\"link\",\"createFocusManager\",\"v\",\"useCallback\",\"useFocusManager\",\"isListItem\",\"node\",\"getAttribute\",\"isMessageToolbarAction\",\"_node$parentElement\",\"parentElement\",\"roomFocusManager\",\"messageListRef\",\"lastMessageFocused\",\"initialFocus\",\"massageListFocusManager\",\"current\",\"addEventListener\",\"e\",\"target\",\"key\",\"shiftKey\",\"preventDefault\",\"stopPropagation\",\"focusFirst\",\"from\",\"document\",\"getElementsByClassName\",\"isThreadMessage\",\"classList\",\"contains\",\"focusNext\",\"accept\",\"tagName\",\"focusPrevious\",\"activeElement\",\"_e$relatedTarget\",\"relatedTarget\",\"currentTarget\",\"HTMLElement\",\"capture\",\"_e$target\",\"_lastMessageFocused\",\"focusLast\",\"focus\"],\"mappings\":\"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\"}"}