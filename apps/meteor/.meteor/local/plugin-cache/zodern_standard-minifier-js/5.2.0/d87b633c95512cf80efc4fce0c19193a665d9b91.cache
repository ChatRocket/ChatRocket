{"code":"function module(e,l,t){let o,i,c,r,n;t.link(\"meteor/meteor\",{Meteor(e){o=e}},0),t.link(\"meteor/tracker\",{Tracker(e){i=e}},1),t.link(\"../../app/models/client\",{Roles(e){c=e}},2),t.link(\"../../app/ui-cached-collection/client\",{CachedCollectionManager(e){r=e}},3),t.link(\"../../app/utils/client/lib/SDKClient\",{sdk(e){n=e}},4),o.startup(()=>{r.onLogin(async()=>{let{roles:e}=await n.rest.get(\"/v1/roles.list\");c._collection._docs._map=new Map(e.map(e=>[c._collection._docs._idStringify(e._id),e])),Object.values(c._collection.queries).forEach(e=>c._collection._recomputeResults(e)),c.ready.set(!0)});let e={changed:e=>{delete e.type,c.upsert({_id:e._id},e)},removed:e=>{c.remove({_id:e._id})}};i.autorun(l=>{o.userId()&&(i.afterFlush(()=>{n.stream(\"roles\",[\"roles\"],l=>{var t;null===(t=e[l.type])||void 0===t||t.call(e,l)})}),l.stop())})})}","map":"{\"version\":3,\"sources\":[\"client/startup/roles.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IRole } from '@rocket.chat/core-typings';\\nimport { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { Roles } from '../../app/models/client';\\nimport { CachedCollectionManager } from '../../app/ui-cached-collection/client';\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\n\\nMeteor.startup(() => {\\n\\tCachedCollectionManager.onLogin(async () => {\\n\\t\\tconst { roles } = await sdk.rest.get('/v1/roles.list');\\n\\t\\t// if a role is checked before this collection is populated, it will return undefined\\n\\t\\tRoles._collection._docs._map = new Map(roles.map((record) => [Roles._collection._docs._idStringify(record._id), record]));\\n\\t\\tObject.values(Roles._collection.queries).forEach((query) => Roles._collection._recomputeResults(query));\\n\\n\\t\\tRoles.ready.set(true);\\n\\t});\\n\\n\\ttype ClientAction = 'inserted' | 'updated' | 'removed' | 'changed';\\n\\n\\tconst events: Record<string, ((role: IRole & { type?: ClientAction }) => void) | undefined> = {\\n\\t\\tchanged: (role) => {\\n\\t\\t\\tdelete role.type;\\n\\t\\t\\tRoles.upsert({ _id: role._id }, role);\\n\\t\\t},\\n\\t\\tremoved: (role) => {\\n\\t\\t\\tRoles.remove({ _id: role._id });\\n\\t\\t},\\n\\t};\\n\\n\\tTracker.autorun((c) => {\\n\\t\\tif (!Meteor.userId()) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tTracker.afterFlush(() => {\\n\\t\\t\\tsdk.stream('roles', ['roles'], (role) => {\\n\\t\\t\\t\\tevents[role.type]?.(role);\\n\\t\\t\\t});\\n\\t\\t});\\n\\n\\t\\tc.stop();\\n\\t});\\n});\\n\",null],\"names\":[\"Meteor\",\"Tracker\",\"Roles\",\"CachedCollectionManager\",\"sdk\",\"module\",\"link\",\"v\",\"startup\",\"onLogin\",\"roles\",\"rest\",\"get\",\"_collection\",\"_docs\",\"_map\",\"Map\",\"map\",\"record\",\"_idStringify\",\"_id\",\"Object\",\"values\",\"queries\",\"forEach\",\"query\",\"_recomputeResults\",\"ready\",\"set\",\"events\",\"changed\",\"role\",\"type\",\"upsert\",\"removed\",\"remove\",\"autorun\",\"c\",\"userId\",\"afterFlush\",\"stream\",\"_events$role$type\",\"call\",\"stop\"],\"mappings\":\"2BACAA,EAAuCC,EAAAC,EAAAC,EAAAC,EAA9BC,EAAQC,IAAA,CAAM,gBAAgB,CAAAN,OAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,iBAAA,CAAAL,QAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,0BAAA,CAAAJ,MAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,wCAAA,CAAAH,wBAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,uCAAA,CAAAF,IAAAG,CAAA,EAAAH,EAAAG,CAAA,CAAA,EAAA,GAOvCP,EAAOQ,OAAO,CAAC,KACdL,EAAwBM,OAAO,CAAC,UAC/B,GAAM,CAAEC,MAAAA,CAAAA,CAAO,CAAG,MAAMN,EAAIO,IAAI,CAACC,GAAG,CAAC,iBAErCV,CAAAA,EAAMW,WAAW,CAACC,KAAK,CAACC,IAAI,CAAG,IAAIC,IAAIN,EAAMO,GAAG,CAAEC,GAAW,CAAChB,EAAMW,WAAW,CAACC,KAAK,CAACK,YAAY,CAACD,EAAOE,GAAG,EAAGF,EAAO,GACvHG,OAAOC,MAAM,CAACpB,EAAMW,WAAW,CAACU,OAAO,EAAEC,OAAO,CAAEC,GAAUvB,EAAMW,WAAW,CAACa,iBAAiB,CAACD,IAEhGvB,EAAMyB,KAAK,CAACC,GAAG,CAAC,CAAA,EACjB,GAIA,IAAMC,EAAwF,CAC7FC,QAAUC,IACT,OAAOA,EAAKC,IAAI,CAChB9B,EAAM+B,MAAM,CAAC,CAAEb,IAAKW,EAAKX,GAAAA,AAAG,EAAIW,EACjC,EACAG,QAAUH,IACT7B,EAAMiC,MAAM,CAAC,CAAEf,IAAKW,EAAKX,GAAAA,AAAG,EAC7B,GAGDnB,EAAQmC,OAAO,CAAEC,IACXrC,EAAOsC,MAAM,KAIlBrC,EAAQsC,UAAU,CAAC,KAClBnC,EAAIoC,MAAM,CAAC,QAAS,CAAC,QAAQ,CAAGT,IAAQ,IAAAU,CACvC,AAAiB,QAAjBA,CAAAA,EAAAZ,CAAM,CAACE,EAAKC,IAAI,CAAC,AAAD,GAACS,AAAA,KAAA,IAAAA,GAAjBA,EAAAC,IAAA,CAAAb,EAAoBE,EACrB,EACD,GAEAM,EAAEM,IAAI,GACP,EACD\"}"}