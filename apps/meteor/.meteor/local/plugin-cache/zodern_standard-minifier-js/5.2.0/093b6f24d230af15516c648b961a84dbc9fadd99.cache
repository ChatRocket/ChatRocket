{"code":"function module(t,e,n){n.link(\"@babel/runtime/regenerator\",{default:function(t){r=t}},0),n.export({AudioRecorder:function(){return s}}),n.link(\"../../../../settings/client\",{settings:function(t){o=t}},0),n.link(\"./AudioEncoder\",{AudioEncoder:function(t){i=t}},1);var r,o,i,s=function(){function t(){this.audioContext=void 0,this.stream=void 0,this.encoder=void 0}var e=t.prototype;return e.isSupported=function(){var t;return!!(null===(t=navigator.mediaDevices)||void 0===t?void 0:t.getUserMedia)&&!!AudioContext},e.createAudioContext=function(){this.audioContext||(this.audioContext=new AudioContext)},e.destroyAudioContext=function(){this.audioContext&&(this.audioContext.close(),delete this.audioContext)},e.createStream=function(){return r.async(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.stream){t.next=2;break}return t.abrupt(\"return\");case 2:return t.next=4,r.awrap(navigator.mediaDevices.getUserMedia({audio:!0}));case 4:this.stream=t.sent;case 5:case\"end\":return t.stop()}},null,this,null,Promise)},e.destroyStream=function(){this.stream&&(this.stream.getAudioTracks().forEach(function(t){return t.stop()}),delete this.stream)},e.createEncoder=function(){var t,e;return r.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(this.encoder||!this.audioContext||!this.stream)){n.next=2;break}return n.abrupt(\"return\");case 2:e=null===(t=this.audioContext)||void 0===t?void 0:t.createMediaStreamSource(this.stream),this.encoder=new i(e,{bitRate:o.get(\"Message_Audio_bitRate\")||32});case 4:case\"end\":return n.stop()}},null,this,null,Promise)},e.destroyEncoder=function(){this.encoder&&(this.encoder.close(),delete this.encoder)},e.start=function(t){return r.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.createAudioContext(),e.next=4,r.awrap(this.createStream());case 4:return e.next=6,r.awrap(this.createEncoder());case 6:null==t||t.call(this,!0),e.next=17;break;case 9:throw e.prev=9,e.t0=e.catch(0),console.error(e.t0),this.destroyEncoder(),this.destroyStream(),this.destroyAudioContext(),null==t||t.call(this,!1),e.t0;case 17:case\"end\":return e.stop()}},null,this,[[0,9]],Promise)},e.stop=function(t){var e,n;null===(e=this.encoder)||void 0===e||e.on(\"encoded\",t),null===(n=this.encoder)||void 0===n||n.close(),this.destroyEncoder(),this.destroyStream(),this.destroyAudioContext()},t}()}","map":"{\"version\":3,\"sources\":[\"app/ui/client/lib/recorderjs/AudioRecorder.ts\",\"<anon>\"],\"sourcesContent\":[\"import { settings } from '../../../../settings/client';\\nimport { AudioEncoder } from './AudioEncoder';\\n\\nexport class AudioRecorder {\\n\\tprivate audioContext: AudioContext | undefined;\\n\\n\\tprivate stream: MediaStream | undefined;\\n\\n\\tprivate encoder: AudioEncoder | undefined;\\n\\n\\tisSupported() {\\n\\t\\treturn Boolean(navigator.mediaDevices?.getUserMedia) && Boolean(AudioContext);\\n\\t}\\n\\n\\tcreateAudioContext() {\\n\\t\\tif (this.audioContext) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tthis.audioContext = new AudioContext();\\n\\t}\\n\\n\\tdestroyAudioContext() {\\n\\t\\tif (!this.audioContext) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tvoid this.audioContext.close();\\n\\t\\tdelete this.audioContext;\\n\\t}\\n\\n\\tasync createStream() {\\n\\t\\tif (this.stream) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tthis.stream = await navigator.mediaDevices.getUserMedia({ audio: true });\\n\\t}\\n\\n\\tdestroyStream() {\\n\\t\\tif (!this.stream) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tthis.stream.getAudioTracks().forEach((track) => track.stop());\\n\\t\\tdelete this.stream;\\n\\t}\\n\\n\\tasync createEncoder() {\\n\\t\\tif (this.encoder || !this.audioContext || !this.stream) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst input = this.audioContext?.createMediaStreamSource(this.stream);\\n\\t\\tthis.encoder = new AudioEncoder(input, { bitRate: settings.get('Message_Audio_bitRate') || 32 });\\n\\t}\\n\\n\\tdestroyEncoder() {\\n\\t\\tif (!this.encoder) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tthis.encoder.close();\\n\\t\\tdelete this.encoder;\\n\\t}\\n\\n\\tasync start(cb?: (this: this, done: boolean) => void) {\\n\\t\\ttry {\\n\\t\\t\\tthis.createAudioContext();\\n\\t\\t\\tawait this.createStream();\\n\\t\\t\\tawait this.createEncoder();\\n\\t\\t\\tcb?.call(this, true);\\n\\t\\t} catch (error) {\\n\\t\\t\\tconsole.error(error);\\n\\t\\t\\tthis.destroyEncoder();\\n\\t\\t\\tthis.destroyStream();\\n\\t\\t\\tthis.destroyAudioContext();\\n\\t\\t\\tcb?.call(this, false);\\n\\t\\t\\tthrow error;\\n\\t\\t}\\n\\t}\\n\\n\\tstop(cb: (data: Blob) => void) {\\n\\t\\tthis.encoder?.on('encoded', cb);\\n\\t\\tthis.encoder?.close();\\n\\n\\t\\tthis.destroyEncoder();\\n\\t\\tthis.destroyStream();\\n\\t\\tthis.destroyAudioContext();\\n\\t}\\n}\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"export\",\"AudioRecorder\",\"settings\",\"AudioEncoder\",\"audioContext\",\"stream\",\"encoder\",\"_proto\",\"prototype\",\"isSupported\",\"_navigator$mediaDevic\",\"Boolean\",\"navigator\",\"mediaDevices\",\"getUserMedia\",\"AudioContext\",\"createAudioContext\",\"destroyAudioContext\",\"close\",\"createStream\",\"async\",\"_context\",\"prev\",\"next\",\"abrupt\",\"awrap\",\"audio\",\"sent\",\"stop\",\"Promise\",\"destroyStream\",\"getAudioTracks\",\"forEach\",\"track\",\"createEncoder\",\"_this$audioContext\",\"input\",\"_context2\",\"createMediaStreamSource\",\"bitRate\",\"get\",\"destroyEncoder\",\"start\",\"cb\",\"_context3\",\"call\",\"t0\",\"console\",\"error\",\"_this$encoder\",\"_this$encoder2\",\"on\"],\"mappings\":\"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\"}"}