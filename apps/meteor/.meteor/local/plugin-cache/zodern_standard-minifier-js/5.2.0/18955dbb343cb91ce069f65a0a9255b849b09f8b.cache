{"code":"function module(e,t,a){let r,n,s,i,o,c,l,u,d,p,E,k,f;a.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){r=e}},0),a.link(\"@rocket.chat/onboarding-ui\",{RegisterServerPage(e){n=e},RegisterOfflinePage(e){s=e}},0),a.link(\"@rocket.chat/ui-contexts\",{useEndpoint(e){i=e},useMethod(e){o=e},useTranslation(e){c=e}},1),a.link(\"@tanstack/react-query\",{useMutation(e){l=e},useQuery(e){u=e}},2),a.link(\"react\",{default(e){d=e},useState(e){p=e}},3),a.link(\"../../../hooks/useLicense\",{useInvalidateLicense(e){E=e}},4),a.link(\"../../../lib/toast\",{dispatchToastMessage(e){k=e}},5),a.link(\"../contexts/SetupWizardContext\",{useSetupWizardContext(e){f=e}},6);let g={REGISTERED:\"REGISTERED\",OFFLINE:\"OFFLINE\"};a.exportDefault(()=>{let e=c(),{currentStep:t,goToNextStep:a,setSetupWizardData:S,registerServer:y,maxSteps:m,completeSetupWizard:R,saveAgreementData:I}=f(),[h,T]=p(g.REGISTERED),C=E(),O=async e=>{a(),S(t=>r(r({},t),{},{serverData:e})),await y(e)},b=i(\"POST\",\"/v1/cloud.manualRegister\"),F=i(\"POST\",\"/v1/cloud.registerPreIntent\"),D=o(\"cloud:getWorkspaceRegisterData\"),{data:v}=u([\"setupWizard/clientKey\"],async()=>D(),{staleTime:1/0}),{data:L,isLoading:W,isError:x}=u([\"setupWizard/registerIntent\"],async()=>F(),{staleTime:1/0,select:e=>e.offline}),{mutate:z}=l([\"setupWizard/confirmOfflineRegistration\"],async e=>b({cloudBlob:e}),{onSuccess:()=>{C(100),R()},onError:()=>{k({type:\"error\",message:e(\"Cloud_register_error\")})}}),P=async e=>{let{token:t,agreement:a}=e;await I(a),z(t)};return h===g.OFFLINE?d.createElement(s,{termsHref:\"https://rocket.chat/terms\",policyHref:\"https://rocket.chat/privacy\",clientKey:v||\"\",onCopySecurityCode:()=>k({type:\"success\",message:e(\"Copied\")}),onBackButtonClick:()=>T(g.REGISTERED),onSubmit:P}):d.createElement(n,{onClickRegisterOffline:()=>T(g.OFFLINE),stepCount:m,onSubmit:O,currentStep:t,offline:x||!W&&L})})}","map":"{\"version\":3,\"sources\":[\"client/views/setupWizard/steps/RegisterServerStep.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { RegisterServerPage, RegisterOfflinePage } from '@rocket.chat/onboarding-ui';\\nimport { useEndpoint, useMethod, useTranslation } from '@rocket.chat/ui-contexts';\\nimport { useMutation, useQuery } from '@tanstack/react-query';\\nimport type { ReactElement, ComponentProps } from 'react';\\nimport React, { useState } from 'react';\\n\\nimport { useInvalidateLicense } from '../../../hooks/useLicense';\\nimport { dispatchToastMessage } from '../../../lib/toast';\\nimport { useSetupWizardContext } from '../contexts/SetupWizardContext';\\n\\nconst SERVER_OPTIONS = {\\n\\tREGISTERED: 'REGISTERED',\\n\\tOFFLINE: 'OFFLINE',\\n};\\n\\nconst RegisterServerStep = (): ReactElement => {\\n\\tconst t = useTranslation();\\n\\tconst { currentStep, goToNextStep, setSetupWizardData, registerServer, maxSteps, completeSetupWizard, saveAgreementData } =\\n\\t\\tuseSetupWizardContext();\\n\\tconst [serverOption, setServerOption] = useState(SERVER_OPTIONS.REGISTERED);\\n\\tconst invalidateLicenseQuery = useInvalidateLicense();\\n\\n\\tconst handleRegister: ComponentProps<typeof RegisterServerPage>['onSubmit'] = async (data: {\\n\\t\\temail: string;\\n\\t\\tagreement: boolean;\\n\\t\\tupdates: boolean;\\n\\t\\tresend?: boolean;\\n\\t}) => {\\n\\t\\tgoToNextStep();\\n\\t\\tsetSetupWizardData((prevState) => ({ ...prevState, serverData: data }));\\n\\t\\tawait registerServer(data);\\n\\t};\\n\\n\\tconst registerManually = useEndpoint('POST', '/v1/cloud.manualRegister');\\n\\tconst registerPreIntent = useEndpoint('POST', '/v1/cloud.registerPreIntent');\\n\\tconst getWorkspaceRegisterData = useMethod('cloud:getWorkspaceRegisterData');\\n\\n\\tconst { data: clientKey } = useQuery(['setupWizard/clientKey'], async () => getWorkspaceRegisterData(), {\\n\\t\\tstaleTime: Infinity,\\n\\t});\\n\\n\\tconst {\\n\\t\\tdata: offline,\\n\\t\\tisLoading,\\n\\t\\tisError,\\n\\t} = useQuery(['setupWizard/registerIntent'], async () => registerPreIntent(), {\\n\\t\\tstaleTime: Infinity,\\n\\t\\tselect: (data) => data.offline,\\n\\t});\\n\\n\\tconst { mutate } = useMutation<null, unknown, string>(\\n\\t\\t['setupWizard/confirmOfflineRegistration'],\\n\\t\\tasync (token) => registerManually({ cloudBlob: token }),\\n\\t\\t{\\n\\t\\t\\tonSuccess: () => {\\n\\t\\t\\t\\tinvalidateLicenseQuery(100);\\n\\t\\t\\t\\tcompleteSetupWizard();\\n\\t\\t\\t},\\n\\t\\t\\tonError: () => {\\n\\t\\t\\t\\tdispatchToastMessage({ type: 'error', message: t('Cloud_register_error') });\\n\\t\\t\\t},\\n\\t\\t},\\n\\t);\\n\\n\\tconst handleConfirmOffline: ComponentProps<typeof RegisterOfflinePage>['onSubmit'] = async ({ token, agreement }) => {\\n\\t\\tawait saveAgreementData(agreement);\\n\\t\\tmutate(token);\\n\\t};\\n\\n\\tif (serverOption === SERVER_OPTIONS.OFFLINE) {\\n\\t\\treturn (\\n\\t\\t\\t<RegisterOfflinePage\\n\\t\\t\\t\\ttermsHref='https://rocket.chat/terms'\\n\\t\\t\\t\\tpolicyHref='https://rocket.chat/privacy'\\n\\t\\t\\t\\tclientKey={clientKey || ''}\\n\\t\\t\\t\\tonCopySecurityCode={(): void => dispatchToastMessage({ type: 'success', message: t('Copied') })}\\n\\t\\t\\t\\tonBackButtonClick={(): void => setServerOption(SERVER_OPTIONS.REGISTERED)}\\n\\t\\t\\t\\tonSubmit={handleConfirmOffline}\\n\\t\\t\\t/>\\n\\t\\t);\\n\\t}\\n\\n\\treturn (\\n\\t\\t<RegisterServerPage\\n\\t\\t\\tonClickRegisterOffline={(): void => setServerOption(SERVER_OPTIONS.OFFLINE)}\\n\\t\\t\\tstepCount={maxSteps}\\n\\t\\t\\tonSubmit={handleRegister}\\n\\t\\t\\tcurrentStep={currentStep}\\n\\t\\t\\toffline={isError || (!isLoading && offline)}\\n\\t\\t/>\\n\\t);\\n};\\n\\nexport default RegisterServerStep;\\n\",null],\"names\":[\"_objectSpread\",\"RegisterServerPage\",\"RegisterOfflinePage\",\"useEndpoint\",\"useMethod\",\"useTranslation\",\"useMutation\",\"useQuery\",\"React\",\"useState\",\"useInvalidateLicense\",\"dispatchToastMessage\",\"useSetupWizardContext\",\"module\",\"link\",\"default\",\"v\",\"SERVER_OPTIONS\",\"REGISTERED\",\"OFFLINE\",\"exportDefault\",\"RegisterServerStep\",\"t\",\"currentStep\",\"goToNextStep\",\"setSetupWizardData\",\"registerServer\",\"maxSteps\",\"completeSetupWizard\",\"saveAgreementData\",\"serverOption\",\"setServerOption\",\"invalidateLicenseQuery\",\"handleRegister\",\"data\",\"prevState\",\"serverData\",\"registerManually\",\"registerPreIntent\",\"getWorkspaceRegisterData\",\"clientKey\",\"staleTime\",\"Infinity\",\"offline\",\"isLoading\",\"isError\",\"select\",\"mutate\",\"token\",\"cloudBlob\",\"onSuccess\",\"onError\",\"type\",\"message\",\"handleConfirmOffline\",\"_ref\",\"agreement\",\"createElement\",\"termsHref\",\"policyHref\",\"onCopySecurityCode\",\"onBackButtonClick\",\"onSubmit\",\"onClickRegisterOffline\",\"stepCount\"],\"mappings\":\"2BAAAA,EAAAC,EAASC,EAA4EC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA5EC,EAAAC,IAAoB,CAAA,uCAA2B,CAAAC,QAAAC,CAAA,EAAAhB,EAA6BgB,CAAA,CAAA,EAAA,GAAxDH,EAAqBC,IAAA,CAAA,6BAAkC,CAACb,mBAAAe,CAAA,EAAAf,EAAAe,CAAA,EAAAd,oBAAAc,CAAA,EAAAd,EAAAc,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,2BAAA,CAAAX,YAAAa,CAAA,EAAAb,EAAAa,CAAA,EAAAZ,UAAAY,CAAA,EAAAZ,EAAAY,CAAA,EAAAX,eAAAW,CAAA,EAAAX,EAAAW,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,wBAAA,CAAAR,YAAAU,CAAA,EAAAV,EAAAU,CAAA,EAAAT,SAAAS,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,QAAA,CAAAC,QAAAC,CAAA,EAAAR,EAAAQ,CAAA,EAAAP,SAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,4BAAA,CAAAJ,qBAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,qBAAA,CAAAH,qBAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,iCAAA,CAAAF,sBAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAUrF,IAAMC,EAAiB,CACtBC,WAAY,aACZC,QAAS,WAZVN,EAAOO,aAAE,CAekBC,KAC1B,IAAMC,EAAIjB,IACJ,CAAEkB,YAAAA,CAAW,CAAEC,aAAAA,CAAY,CAAEC,mBAAAA,CAAkB,CAAEC,eAAAA,CAAc,CAAEC,SAAAA,CAAQ,CAAEC,oBAAAA,CAAmB,CAAEC,kBAAAA,CAAAA,CAAmB,CACxHjB,IACK,CAACkB,EAAcC,EAAgB,CAAGtB,EAASQ,EAAeC,UAAU,EACpEc,EAAyBtB,IAEzBuB,EAAwE,MAAOC,IAMpFV,IACAC,EAAoBU,GAASnC,EAAAA,EAAA,CAAA,EAAWmC,GAAS,CAAA,EAAA,CAAEC,WAAYF,CAAI,IACnE,MAAMR,EAAeQ,EACtB,EAEMG,EAAmBlC,EAAY,OAAQ,4BACvCmC,EAAoBnC,EAAY,OAAQ,+BACxCoC,EAA2BnC,EAAU,kCAErC,CAAE8B,KAAMM,CAAAA,CAAW,CAAGjC,EAAS,CAAC,wBAAwB,CAAE,SAAYgC,IAA4B,CACvGE,UAAWC,MAGN,CACLR,KAAMS,CAAO,CACbC,UAAAA,CAAS,CACTC,QAAAA,CAAAA,CACA,CAAGtC,EAAS,CAAC,6BAA6B,CAAE,SAAY+B,IAAqB,CAC7EG,UAAWC,IACXI,OAASZ,GAASA,EAAKS,OAAAA,GAGlB,CAAEI,OAAAA,CAAAA,CAAQ,CAAGzC,EAClB,CAAC,yCAAyC,CAC1C,MAAO0C,GAAUX,EAAiB,CAAEY,UAAWD,CAAK,GACpD,CACCE,UAAWA,KACVlB,EAAuB,KACvBJ,GACD,EACAuB,QAASA,KACRxC,EAAqB,CAAEyC,KAAM,QAASC,QAAS/B,EAAE,uBAAuB,EACzE,IAIIgC,EAA+E,MAAAC,IAA+B,GAAxB,CAAEP,MAAAA,CAAK,CAAEQ,UAAAA,CAAAA,CAAW,CAAAD,CAC/G,OAAM1B,EAAkB2B,GACxBT,EAAOC,EACR,SAEA,AAAIlB,IAAiBb,EAAeE,OAAO,CAEzCX,EAAAiD,aAAA,CAACvD,EAAmB,CACnBwD,UAAU,4BACVC,WAAW,8BACXnB,UAAWA,GAAa,GACxBoB,mBAAoBA,IAAYjD,EAAqB,CAAEyC,KAAM,UAAWC,QAAS/B,EAAE,SAAS,GAC5FuC,kBAAmBA,IAAY9B,EAAgBd,EAAeC,UAAU,EACxE4C,SAAUR,CAAqB,GAMjC9C,EAAAiD,aAAA,CAACxD,EAAkB,CAClB8D,uBAAwBA,IAAYhC,EAAgBd,EAAeE,OAAO,EAC1E6C,UAAWrC,EACXmC,SAAU7B,EACVV,YAAaA,EACboB,QAASE,GAAY,CAACD,GAAaD,CAAS,EAG/C\"}"}