{"code":"function module(e,n,t){let i,o,a,l,r,m,c,d,s,p,u;t.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){i=e}},0),t.export({LivechatRoomType:()=>h}),t.link(\"../../../../app/authorization/client\",{hasPermission(e){o=e}},0),t.link(\"../../../../app/models/client\",{ChatRoom(e){a=e},ChatSubscription(e){l=e}},1),t.link(\"../../../../app/settings/client\",{settings(e){r=e}},2),t.link(\"../../../../app/utils/client/getAvatarURL\",{getAvatarURL(e){m=e}},3),t.link(\"../../../../definition/IRoomTypeConfig\",{RoomSettingsEnum(e){c=e},RoomMemberActions(e){d=e},UiTextContext(e){s=e}},4),t.link(\"../../../../lib/rooms/roomTypes/livechat\",{getLivechatRoomType(e){p=e}},5),t.link(\"../roomCoordinator\",{roomCoordinator(e){u=e}},6);let h=p(u);u.add(i(i({},h),{},{label:\"Omnichannel\"}),{allowRoomSettingChange:(e,n)=>n!==c.JOIN_CODE,allowMemberAction:(e,n)=>[d.INVITE,d.JOIN].includes(n),roomName:e=>e.name||e.fname||e.label,getUiText(e){switch(e){case s.HIDE_WARNING:case s.LEAVE_WARNING:return\"Hide_Livechat_Warning\";default:return\"\"}},condition:()=>r.get(\"Livechat_enabled\")&&o(\"view-l-room\"),getAvatarPath(e){return m({username:\"@\".concat(this.roomName(e))})||\"\"},findRoom:e=>a.findOne({_id:e}),isLivechatRoom:()=>!0,canSendMessage(e){let n=a.findOne({_id:e},{fields:{open:1}});return!!(null==n?void 0:n.open)},readOnly(e,n){let t=a.findOne({_id:e},{fields:{open:1,servedBy:1}});if(!(null!=t&&t.open))return!0;let i=l.findOne({rid:e});return!i},getIcon:()=>\"livechat\",extractOpenRoomParams(e){let{id:n}=e;return{type:\"l\",reference:n}}})}","map":"{\"version\":3,\"sources\":[\"client/lib/rooms/roomTypes/livechat.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { AtLeast, ValueOf } from '@rocket.chat/core-typings';\\n\\nimport { hasPermission } from '../../../../app/authorization/client';\\nimport { ChatRoom, ChatSubscription } from '../../../../app/models/client';\\nimport { settings } from '../../../../app/settings/client';\\nimport { getAvatarURL } from '../../../../app/utils/client/getAvatarURL';\\nimport type { IRoomTypeClientDirectives } from '../../../../definition/IRoomTypeConfig';\\nimport { RoomSettingsEnum, RoomMemberActions, UiTextContext } from '../../../../definition/IRoomTypeConfig';\\nimport { getLivechatRoomType } from '../../../../lib/rooms/roomTypes/livechat';\\nimport { roomCoordinator } from '../roomCoordinator';\\n\\nexport const LivechatRoomType = getLivechatRoomType(roomCoordinator);\\n\\nroomCoordinator.add(\\n\\t{\\n\\t\\t...LivechatRoomType,\\n\\t\\tlabel: 'Omnichannel',\\n\\t},\\n\\t{\\n\\t\\tallowRoomSettingChange(_room, setting) {\\n\\t\\t\\tswitch (setting) {\\n\\t\\t\\t\\tcase RoomSettingsEnum.JOIN_CODE:\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\tdefault:\\n\\t\\t\\t\\t\\treturn true;\\n\\t\\t\\t}\\n\\t\\t},\\n\\n\\t\\tallowMemberAction(_room, action) {\\n\\t\\t\\treturn ([RoomMemberActions.INVITE, RoomMemberActions.JOIN] as Array<ValueOf<typeof RoomMemberActions>>).includes(action);\\n\\t\\t},\\n\\n\\t\\troomName(room) {\\n\\t\\t\\treturn room.name || room.fname || (room as any).label;\\n\\t\\t},\\n\\n\\t\\tgetUiText(context) {\\n\\t\\t\\tswitch (context) {\\n\\t\\t\\t\\tcase UiTextContext.HIDE_WARNING:\\n\\t\\t\\t\\t\\treturn 'Hide_Livechat_Warning';\\n\\t\\t\\t\\tcase UiTextContext.LEAVE_WARNING:\\n\\t\\t\\t\\t\\treturn 'Hide_Livechat_Warning';\\n\\t\\t\\t\\tdefault:\\n\\t\\t\\t\\t\\treturn '';\\n\\t\\t\\t}\\n\\t\\t},\\n\\n\\t\\tcondition() {\\n\\t\\t\\treturn settings.get('Livechat_enabled') && hasPermission('view-l-room');\\n\\t\\t},\\n\\n\\t\\tgetAvatarPath(room) {\\n\\t\\t\\treturn getAvatarURL({ username: `@${this.roomName(room)}` }) || '';\\n\\t\\t},\\n\\n\\t\\tfindRoom(identifier) {\\n\\t\\t\\treturn ChatRoom.findOne({ _id: identifier });\\n\\t\\t},\\n\\n\\t\\tisLivechatRoom() {\\n\\t\\t\\treturn true;\\n\\t\\t},\\n\\n\\t\\tcanSendMessage(rid) {\\n\\t\\t\\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { open: 1 } });\\n\\t\\t\\treturn Boolean(room?.open);\\n\\t\\t},\\n\\n\\t\\treadOnly(rid, _user) {\\n\\t\\t\\tconst room = ChatRoom.findOne({ _id: rid }, { fields: { open: 1, servedBy: 1 } });\\n\\t\\t\\tif (!room?.open) {\\n\\t\\t\\t\\treturn true;\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst subscription = ChatSubscription.findOne({ rid });\\n\\t\\t\\treturn !subscription;\\n\\t\\t},\\n\\n\\t\\tgetIcon() {\\n\\t\\t\\treturn 'livechat';\\n\\t\\t},\\n\\n\\t\\textractOpenRoomParams({ id }) {\\n\\t\\t\\treturn { type: 'l', reference: id };\\n\\t\\t},\\n\\t} as AtLeast<IRoomTypeClientDirectives, 'roomName'>,\\n);\\n\",null],\"names\":[\"_objectSpread\",\"hasPermission\",\"ChatRoom\",\"ChatSubscription\",\"settings\",\"getAvatarURL\",\"RoomSettingsEnum\",\"RoomMemberActions\",\"UiTextContext\",\"getLivechatRoomType\",\"roomCoordinator\",\"module\",\"link\",\"default\",\"v\",\"export\",\"LivechatRoomType\",\"add\",\"label\",\"allowRoomSettingChange\",\"_room\",\"setting\",\"JOIN_CODE\",\"allowMemberAction\",\"action\",\"INVITE\",\"JOIN\",\"includes\",\"roomName\",\"room\",\"name\",\"fname\",\"getUiText\",\"context\",\"HIDE_WARNING\",\"LEAVE_WARNING\",\"condition\",\"get\",\"getAvatarPath\",\"username\",\"concat\",\"findRoom\",\"identifier\",\"findOne\",\"_id\",\"isLivechatRoom\",\"canSendMessage\",\"rid\",\"fields\",\"open\",\"Boolean\",\"readOnly\",\"_user\",\"servedBy\",\"subscription\",\"getIcon\",\"extractOpenRoomParams\",\"_ref\",\"id\",\"type\",\"reference\"],\"mappings\":\"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\"}"}