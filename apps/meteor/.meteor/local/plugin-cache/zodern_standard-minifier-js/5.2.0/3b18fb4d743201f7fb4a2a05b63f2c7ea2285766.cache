{"code":"function module(e,n,t){var i,o,s,l,r,a,u,c,d;t.link(\"@babel/runtime/regenerator\",{default:function(e){i=e}},0),t.link(\"meteor/meteor\",{Meteor:function(e){o=e}},0),t.link(\"meteor/tracker\",{Tracker:function(e){s=e}},1),t.link(\"../../../../client/lib/toast\",{dispatchToastMessage:function(e){l=e}},2),t.link(\"../../../../client/lib/utils/callWithErrorHandling\",{callWithErrorHandling:function(e){r=e}},3),t.link(\"../../../models/client\",{Messages:function(e){a=e}},4),t.link(\"../../../settings/client\",{settings:function(e){u=e}},5),t.link(\"../../../ui-utils/client\",{MessageAction:function(e){c=e}},6),t.link(\"../../../utils/lib/i18n\",{t:function(e){d=e}},7),o.startup(function(){s.autorun(function(){if(!u.get(\"Threads_enabled\"))return c.removeButton(\"unfollow-message\");c.addButton({id:\"unfollow-message\",icon:\"bell-off\",label:\"Unfollow_message\",type:\"interaction\",context:[\"message\",\"message-mobile\",\"threads\",\"federated\",\"videoconf\",\"videoconf-threads\"],action:function(e,n){var t;return i.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.message){e.next=3;break}return e.abrupt(\"return\");case 3:return e.next=5,i.awrap(r(\"unfollowMessage\",{mid:t._id}));case 5:l({type:\"success\",message:d(\"You_unfollowed_this_message\")});case 6:case\"end\":return e.stop()}},null,null,null,Promise)},condition:function(e){var n=e.message,t=n._id,i=n.tmid,o=n.replies,s=void 0===o?[]:o,l=e.user,r=e.context;if(i||r){var u=a.findOne({_id:i||t},{fields:{replies:1}});u&&(s=u.replies||[])}return null!=l&&!!l._id&&s.includes(l._id)},order:2,group:\"menu\"})})})}","map":"{\"version\":3,\"sources\":[\"app/threads/client/messageAction/unfollow.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { dispatchToastMessage } from '../../../../client/lib/toast';\\nimport { callWithErrorHandling } from '../../../../client/lib/utils/callWithErrorHandling';\\nimport { Messages } from '../../../models/client';\\nimport { settings } from '../../../settings/client';\\nimport { MessageAction } from '../../../ui-utils/client';\\nimport { t } from '../../../utils/lib/i18n';\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(() => {\\n\\t\\tif (!settings.get('Threads_enabled')) {\\n\\t\\t\\treturn MessageAction.removeButton('unfollow-message');\\n\\t\\t}\\n\\t\\tMessageAction.addButton({\\n\\t\\t\\tid: 'unfollow-message',\\n\\t\\t\\ticon: 'bell-off',\\n\\t\\t\\tlabel: 'Unfollow_message',\\n\\t\\t\\ttype: 'interaction',\\n\\t\\t\\tcontext: ['message', 'message-mobile', 'threads', 'federated', 'videoconf', 'videoconf-threads'],\\n\\t\\t\\tasync action(_, { message }) {\\n\\t\\t\\t\\tif (!message) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tawait callWithErrorHandling('unfollowMessage', { mid: message._id });\\n\\t\\t\\t\\tdispatchToastMessage({\\n\\t\\t\\t\\t\\ttype: 'success',\\n\\t\\t\\t\\t\\tmessage: t('You_unfollowed_this_message'),\\n\\t\\t\\t\\t});\\n\\t\\t\\t},\\n\\t\\t\\tcondition({ message: { _id, tmid, replies = [] }, user, context }) {\\n\\t\\t\\t\\tif (tmid || context) {\\n\\t\\t\\t\\t\\tconst parentMessage = Messages.findOne({ _id: tmid || _id }, { fields: { replies: 1 } });\\n\\t\\t\\t\\t\\tif (parentMessage) {\\n\\t\\t\\t\\t\\t\\treplies = parentMessage.replies || [];\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\treturn user?._id ? replies.includes(user._id) : false;\\n\\t\\t\\t},\\n\\t\\t\\torder: 2,\\n\\t\\t\\tgroup: 'menu',\\n\\t\\t});\\n\\t});\\n});\\n\",null],\"names\":[\"_regeneratorRuntime\",\"Meteor\",\"Tracker\",\"dispatchToastMessage\",\"callWithErrorHandling\",\"Messages\",\"settings\",\"MessageAction\",\"t\",\"module\",\"link\",\"default\",\"v\",\"startup\",\"autorun\",\"get\",\"removeButton\",\"addButton\",\"id\",\"icon\",\"label\",\"type\",\"context\",\"action\",\"_\",\"_ref\",\"message\",\"async\",\"_context\",\"prev\",\"next\",\"abrupt\",\"awrap\",\"mid\",\"_id\",\"stop\",\"Promise\",\"condition\",\"_ref2\",\"_ref2$message\",\"tmid\",\"_ref2$message$replies\",\"replies\",\"user\",\"parentMessage\",\"findOne\",\"fields\",\"includes\",\"order\",\"group\"],\"mappings\":\"2BAAAA,EAAAC,EAAuCC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAhBC,EAAAC,IAAA,CAAA,6BAAgB,CAAAC,QAAA,SAAAC,CAAA,EAAAZ,EAAAY,CAAA,CAAA,EAAA,GAA9BH,EAAQC,IAAA,CAAM,gBAAgB,CAAAT,OAAA,SAAAW,CAAA,EAAAX,EAAAW,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,iBAAA,CAAAR,QAAA,SAAAU,CAAA,EAAAV,EAAAU,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,+BAAA,CAAAP,qBAAA,SAAAS,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,qDAAA,CAAAN,sBAAA,SAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,yBAAA,CAAAL,SAAA,SAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,2BAAA,CAAAJ,SAAA,SAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,2BAAA,CAAAH,cAAA,SAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,0BAAA,CAAAF,EAAA,SAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAUvCX,EAAOY,OAAO,CAAC,WACdX,EAAQY,OAAO,CAAC,WACf,GAAI,CAACR,EAASS,GAAG,CAAC,mBACjB,OAAOR,EAAcS,YAAY,CAAC,oBAEnCT,EAAcU,SAAS,CAAC,CACvBC,GAAI,mBACJC,KAAM,WACNC,MAAO,mBACPC,KAAM,cACNC,QAAS,CAAC,UAAW,iBAAkB,UAAW,YAAa,YAAa,oBAAoB,CAC1FC,OAAM,SAACC,CAAC,CAAAC,CAAA,EAAA,IAAAC,EAAA,OAAA1B,EAAA2B,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAAW,GAAPJ,EAAOD,EAAPC,OAAO,CACZ,CAAAE,EAAAE,IAAA,CAAA,EAAA,KAAA,CAAA,OAAAF,EAAAG,MAAA,CAAA,SAAA,MAAA,EAAA,OAAAH,EAAAE,IAAA,CAAA,EAAA9B,EAAAgC,KAAA,CAIN5B,EAAsB,kBAAmB,CAAE6B,IAAKP,EAAQQ,GAAAA,AAAG,GAAG,MAAA,EACpE/B,EAAqB,CACpBkB,KAAM,UACNK,QAASlB,EAAE,gCACT,MAAA,EAAA,IAAA,MAAA,OAAAoB,EAAAO,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAC,QAAA,EAEJC,UAAS,SAAAC,CAAA,EAAwD,IAAAC,EAAAD,EAArDZ,OAAO,CAAIQ,EAAGK,EAAHL,GAAG,CAAEM,EAAID,EAAJC,IAAI,CAAAC,EAAAF,EAAEG,OAAO,CAAPA,EAAOD,AAAA,KAAA,IAAAA,EAAG,EAAE,CAAAA,EAAIE,EAAIL,EAAJK,IAAI,CAAErB,EAAOgB,EAAPhB,OAAO,CAC9D,GAAIkB,GAAQlB,EAAS,CACpB,IAAMsB,EAAgBvC,EAASwC,OAAO,CAAC,CAAEX,IAAKM,GAAQN,CAAG,EAAI,CAAEY,OAAQ,CAAEJ,QAAS,CAAC,CAAE,GACjFE,GACHF,CAAAA,EAAUE,EAAcF,OAAO,EAAI,EAAE,AAAF,CAErC,CACA,OAAOC,MAAAA,KAAAA,EAAMT,GAAG,EAAGQ,EAAQK,QAAQ,CAACJ,EAAKT,GAAG,CAC7C,EACAc,MAAO,EACPC,MAAO,QAET,EACD\"}"}