{"code":"function module(e,o,n){n.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){t=e}},0),n.link(\"@rocket.chat/random\",{Random:function(e){i=e}},0),n.link(\"meteor/facebook-oauth\",{Facebook:function(e){a=e}},1),n.link(\"meteor/meteor\",{Meteor:function(e){l=e}},2),n.link(\"meteor/oauth\",{OAuth:function(e){r=e}},3),n.link(\"../../lib/2fa/overrideLoginMethod\",{overrideLoginMethod:function(e){c=e}},4),n.link(\"../../lib/wrapRequestCredentialFn\",{wrapRequestCredentialFn:function(e){u=e}},5),n.link(\"./oauth\",{createOAuthTotpLoginMethod:function(e){d=e}},6);var t,i,a,l,r,c,u,d,s=l.loginWithFacebook,p=d(a);l.loginWithFacebook=function(e,o){c(s,[e],o,p)},a.requestCredential=u(\"facebook\",function(e){var o,n,a,c,u=e.config,d=e.loginStyle,s=e.options,p=e.credentialRequestCompleteCallback,k=i.secret(),h=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone/i.test(navigator.userAgent),f=null!=s&&s.requestPermissions?s.requestPermissions.join(\",\"):\"email\",b=(null===(o=l.settings)||void 0===o?void 0:null===(n=o.public)||void 0===n?void 0:null===(a=n.packages)||void 0===a?void 0:null===(c=a[\"facebook-oauth\"])||void 0===c?void 0:c.apiVersion)||\"17.0\",m=t({client_id:u.appId,redirect_uri:r._redirectUri(\"facebook\",u,s.params,s.absoluteUrlOptions),display:h?\"touch\":\"popup\",scope:f,state:r._stateParam(d,k,null==s?void 0:s.redirectUrl)},s.auth_type&&{auth_type:s.auth_type}),g=\"https://www.facebook.com/v\"+b+\"/dialog/oauth?\"+Object.keys(m).map(function(e){return encodeURIComponent(e)+\"=\"+encodeURIComponent(m[e])}).join(\"&\");r.launchLogin({loginService:\"facebook\",loginStyle:d,loginUrl:g,credentialRequestCompleteCallback:p,credentialToken:k})})}","map":"{\"version\":3,\"sources\":[\"client/meteorOverrides/login/facebook.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { FacebookOAuthConfiguration } from '@rocket.chat/core-typings';\\nimport { Random } from '@rocket.chat/random';\\nimport { Facebook } from 'meteor/facebook-oauth';\\nimport { Meteor } from 'meteor/meteor';\\nimport { OAuth } from 'meteor/oauth';\\n\\nimport { overrideLoginMethod } from '../../lib/2fa/overrideLoginMethod';\\nimport { wrapRequestCredentialFn } from '../../lib/wrapRequestCredentialFn';\\nimport { createOAuthTotpLoginMethod } from './oauth';\\n\\nconst { loginWithFacebook } = Meteor;\\nconst loginWithFacebookAndTOTP = createOAuthTotpLoginMethod(Facebook);\\nMeteor.loginWithFacebook = (options, callback) => {\\n\\toverrideLoginMethod(loginWithFacebook, [options], callback, loginWithFacebookAndTOTP);\\n};\\n\\nFacebook.requestCredential = wrapRequestCredentialFn<FacebookOAuthConfiguration>(\\n\\t'facebook',\\n\\t({ config, loginStyle, options: requestOptions, credentialRequestCompleteCallback }) => {\\n\\t\\tconst options = requestOptions as Meteor.LoginWithExternalServiceOptions & {\\n\\t\\t\\tabsoluteUrlOptions?: Record<string, any>;\\n\\t\\t\\tparams?: Record<string, any>;\\n\\t\\t\\tauth_type?: string;\\n\\t\\t};\\n\\n\\t\\tconst credentialToken = Random.secret();\\n\\t\\tconst mobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone/i.test(navigator.userAgent);\\n\\t\\tconst display = mobile ? 'touch' : 'popup';\\n\\n\\t\\tconst scope = options?.requestPermissions ? options.requestPermissions.join(',') : 'email';\\n\\n\\t\\tconst API_VERSION = Meteor.settings?.public?.packages?.['facebook-oauth']?.apiVersion || '17.0';\\n\\n\\t\\tconst loginUrlParameters: Record<string, any> = {\\n\\t\\t\\tclient_id: config.appId,\\n\\t\\t\\tredirect_uri: OAuth._redirectUri('facebook', config, options.params, options.absoluteUrlOptions),\\n\\t\\t\\tdisplay,\\n\\t\\t\\tscope,\\n\\t\\t\\tstate: OAuth._stateParam(loginStyle, credentialToken, options?.redirectUrl),\\n\\t\\t\\t// Handle authentication type (e.g. for force login you need auth_type: \\\"reauthenticate\\\")\\n\\t\\t\\t...(options.auth_type && { auth_type: options.auth_type }),\\n\\t\\t};\\n\\n\\t\\tconst loginUrl = `https://www.facebook.com/v${API_VERSION}/dialog/oauth?${Object.keys(loginUrlParameters)\\n\\t\\t\\t.map((param) => `${encodeURIComponent(param)}=${encodeURIComponent(loginUrlParameters[param])}`)\\n\\t\\t\\t.join('&')}`;\\n\\n\\t\\tOAuth.launchLogin({\\n\\t\\t\\tloginService: 'facebook',\\n\\t\\t\\tloginStyle,\\n\\t\\t\\tloginUrl,\\n\\t\\t\\tcredentialRequestCompleteCallback,\\n\\t\\t\\tcredentialToken,\\n\\t\\t});\\n\\t},\\n);\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_objectSpread\",\"Random\",\"Facebook\",\"Meteor\",\"OAuth\",\"overrideLoginMethod\",\"wrapRequestCredentialFn\",\"createOAuthTotpLoginMethod\",\"loginWithFacebook\",\"_Meteor\",\"loginWithFacebookAndTOTP\",\"options\",\"callback\",\"requestCredential\",\"_ref\",\"_Meteor$settings\",\"_Meteor$settings$publ\",\"_Meteor$settings$publ2\",\"_Meteor$settings$publ3\",\"config\",\"loginStyle\",\"requestOptions\",\"credentialRequestCompleteCallback\",\"credentialToken\",\"secret\",\"mobile\",\"test\",\"navigator\",\"userAgent\",\"scope\",\"requestPermissions\",\"join\",\"API_VERSION\",\"settings\",\"public\",\"packages\",\"apiVersion\",\"loginUrlParameters\",\"client_id\",\"appId\",\"redirect_uri\",\"_redirectUri\",\"params\",\"absoluteUrlOptions\",\"display\",\"state\",\"_stateParam\",\"redirectUrl\",\"auth_type\",\"loginUrl\",\"Object\",\"keys\",\"map\",\"param\",\"encodeURIComponent\",\"launchLogin\",\"loginService\"],\"mappings\":\"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\"}"}