{"code":"function module(n,t,e){e.link(\"@babel/runtime/regenerator\",{default:function(n){o=n}},0),e.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(n){a=n}},1),e.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(n){r=n}},2),e.export({useChannelsSection:function(){return _}}),e.link(\"@rocket.chat/string-helpers\",{capitalize:function(n){i=n}},0),e.link(\"@rocket.chat/ui-contexts\",{useEndpoint:function(n){l=n}},1),e.link(\"@tanstack/react-query\",{useQuery:function(n){u=n}},2),e.link(\"react\",{useMemo:function(n){s=n}},3),e.link(\"react-i18next\",{useTranslation:function(n){c=n}},4),e.link(\"../../../components/dashboards/periods\",{getPeriodRange:function(n){d=n}},5),e.link(\"../../../components/dashboards/usePeriodSelectorStorage\",{usePeriodSelectorStorage:function(n){f=n}},6),e.link(\"../components/constants\",{PERIOD_OPTIONS:function(n){p=n}},7),e.link(\"../utils/formatPeriodDescription\",{formatPeriodDescription:function(n){h=n}},8),e.link(\"../utils/getTop\",{getTop:function(n){b=n}},9),e.link(\"../utils/round\",{round:function(n){v=n}},10),e.link(\"./useDefaultDownload\",{useDefaultDownload:function(n){m=n}},11);var o,a,r,i,l,u,s,c,d,f,p,h,b,v,m,g={widget:\"Livechat\",\"email-inbox\":\"Email\",twilio:\"SMS\",api:\"Custom_Integration\"},k=function(n,t,e){var o=t>0?v(n.value/t*100):0,a=\"\"+(e(g[n.label])||i(n.label));return r(r({},n),{},{label:a+\" \"+n.value+\" (\"+o+\"%)\",rawLabel:a,id:n.label})},S=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;return n.map(function(n){return k(n,t,e)})},_=function(){var n=c().t,t=f(\"reports-channels-period\",p),e=a(t,2),i=e[0],v=e[1],g=l(\"GET\",\"/v1/livechat/analytics/dashboards/conversations-by-source\"),_=u([\"omnichannel-reports\",\"conversations-by-source\",i],function(){var t,e,a,l,u,s;return o.async(function(c){for(;;)switch(c.prev=c.next){case 0:return e=(t=d(i)).start,a=t.end,c.next=3,o.awrap(g({start:e.toISOString(),end:a.toISOString()}));case 3:return u=S((l=c.sent).data,l.total,n),s=b(5,u,function(t){return k({label:n(\"Others\"),value:t},l.total,n)}),c.abrupt(\"return\",r(r({},l),{},{data:s,rawData:u}));case 7:case\"end\":return c.stop()}},null,null,null,Promise)},{refetchInterval:3e5}),y=_.data,w=(y=void 0===y?{data:[],rawData:[],total:0}:y).data,D=y.rawData,P=y.total,E=_.refetch,O=_.isLoading,x=_.isError,I=_.isSuccess,T=n(\"Conversations_by_channel\"),C=n(\"__count__conversations__period__\",{count:null!=P?P:0,period:h(i,n)}),L=n(\"Omnichannel_Reports_Channels_Empty_Subtitle\"),R=m({columnName:n(\"Channel\"),title:T,data:D,period:i});return s(function(){return{id:\"conversations-by-channel\",title:T,subtitle:C,emptyStateSubtitle:L,data:w,total:P,isLoading:O,isError:x,isDataFound:I&&w.length>0,periodSelectorProps:v,period:i,downloadProps:R,onRetry:E}},[T,C,L,w,P,O,x,I,v,i,R,E])}}","map":"{\"version\":3,\"sources\":[\"client/omnichannel/reports/hooks/useChannelsSection.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { capitalize } from '@rocket.chat/string-helpers';\\nimport type { TranslationKey } from '@rocket.chat/ui-contexts';\\nimport { useEndpoint } from '@rocket.chat/ui-contexts';\\nimport { useQuery } from '@tanstack/react-query';\\nimport type { TFunction } from 'i18next';\\nimport { useMemo } from 'react';\\nimport { useTranslation } from 'react-i18next';\\n\\nimport { getPeriodRange } from '../../../components/dashboards/periods';\\nimport { usePeriodSelectorStorage } from '../../../components/dashboards/usePeriodSelectorStorage';\\nimport { PERIOD_OPTIONS } from '../components/constants';\\nimport { formatPeriodDescription } from '../utils/formatPeriodDescription';\\nimport { getTop } from '../utils/getTop';\\nimport { round } from '../utils/round';\\nimport { useDefaultDownload } from './useDefaultDownload';\\n\\ntype DataItem = { label: string; value: number; id: string; rawLabel: string };\\n\\nconst TYPE_LABEL: Record<string, TranslationKey> = {\\n\\t'widget': 'Livechat',\\n\\t'email-inbox': 'Email',\\n\\t'twilio': 'SMS',\\n\\t'api': 'Custom_Integration',\\n};\\n\\nconst formatItem = (item: { label: string; value: number }, total: number, t: TFunction): DataItem => {\\n\\tconst percentage = total > 0 ? round((item.value / total) * 100) : 0;\\n\\tconst label = `${t(TYPE_LABEL[item.label]) || capitalize(item.label)}`;\\n\\treturn {\\n\\t\\t...item,\\n\\t\\tlabel: `${label} ${item.value} (${percentage}%)`,\\n\\t\\trawLabel: label,\\n\\t\\tid: item.label,\\n\\t};\\n};\\n\\nconst formatChartData = (data: { label: string; value: number }[] | undefined = [], total = 0, t: TFunction) => {\\n\\treturn data.map((item) => formatItem(item, total, t));\\n};\\n\\nexport const useChannelsSection = () => {\\n\\tconst { t } = useTranslation();\\n\\tconst [period, periodSelectorProps] = usePeriodSelectorStorage('reports-channels-period', PERIOD_OPTIONS);\\n\\tconst getConversationsBySource = useEndpoint('GET', '/v1/livechat/analytics/dashboards/conversations-by-source');\\n\\n\\tconst {\\n\\t\\tdata: { data, rawData, total } = { data: [], rawData: [], total: 0 },\\n\\t\\trefetch,\\n\\t\\tisLoading,\\n\\t\\tisError,\\n\\t\\tisSuccess,\\n\\t} = useQuery(\\n\\t\\t['omnichannel-reports', 'conversations-by-source', period],\\n\\t\\tasync () => {\\n\\t\\t\\tconst { start, end } = getPeriodRange(period);\\n\\t\\t\\tconst response = await getConversationsBySource({ start: start.toISOString(), end: end.toISOString() });\\n\\t\\t\\tconst data = formatChartData(response.data, response.total, t);\\n\\t\\t\\tconst displayData: DataItem[] = getTop<DataItem>(5, data, (value) => formatItem({ label: t('Others'), value }, response.total, t));\\n\\t\\t\\treturn { ...response, data: displayData, rawData: data };\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\trefetchInterval: 5 * 60 * 1000,\\n\\t\\t},\\n\\t);\\n\\n\\tconst title = t('Conversations_by_channel');\\n\\tconst subtitle = t('__count__conversations__period__', {\\n\\t\\tcount: total ?? 0,\\n\\t\\tperiod: formatPeriodDescription(period, t),\\n\\t});\\n\\tconst emptyStateSubtitle = t('Omnichannel_Reports_Channels_Empty_Subtitle');\\n\\n\\tconst downloadProps = useDefaultDownload({ columnName: t('Channel'), title, data: rawData, period });\\n\\n\\treturn useMemo(\\n\\t\\t() => ({\\n\\t\\t\\tid: 'conversations-by-channel',\\n\\t\\t\\ttitle,\\n\\t\\t\\tsubtitle,\\n\\t\\t\\temptyStateSubtitle,\\n\\t\\t\\tdata,\\n\\t\\t\\ttotal,\\n\\t\\t\\tisLoading,\\n\\t\\t\\tisError,\\n\\t\\t\\tisDataFound: isSuccess && data.length > 0,\\n\\t\\t\\tperiodSelectorProps,\\n\\t\\t\\tperiod,\\n\\t\\t\\tdownloadProps,\\n\\t\\t\\tonRetry: refetch,\\n\\t\\t}),\\n\\t\\t[title, subtitle, emptyStateSubtitle, data, total, isLoading, isError, isSuccess, periodSelectorProps, period, downloadProps, refetch],\\n\\t);\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"_slicedToArray\",\"_objectSpread\",\"export\",\"useChannelsSection\",\"capitalize\",\"useEndpoint\",\"useQuery\",\"useMemo\",\"useTranslation\",\"getPeriodRange\",\"usePeriodSelectorStorage\",\"PERIOD_OPTIONS\",\"formatPeriodDescription\",\"getTop\",\"round\",\"useDefaultDownload\",\"TYPE_LABEL\",\"formatItem\",\"item\",\"total\",\"t\",\"percentage\",\"value\",\"label\",\"rawLabel\",\"id\",\"formatChartData\",\"data\",\"arguments\",\"length\",\"undefined\",\"map\",\"_useTranslation\",\"_usePeriodSelectorSto\",\"_usePeriodSelectorSto2\",\"period\",\"periodSelectorProps\",\"getConversationsBySource\",\"_useQuery\",\"_getPeriodRange\",\"start\",\"end\",\"response\",\"displayData\",\"async\",\"_context\",\"prev\",\"next\",\"awrap\",\"toISOString\",\"sent\",\"abrupt\",\"rawData\",\"stop\",\"Promise\",\"refetchInterval\",\"_useQuery$data\",\"refetch\",\"isLoading\",\"isError\",\"isSuccess\",\"title\",\"subtitle\",\"count\",\"emptyStateSubtitle\",\"downloadProps\",\"columnName\",\"isDataFound\",\"onRetry\"],\"mappings\":\"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\"}"}