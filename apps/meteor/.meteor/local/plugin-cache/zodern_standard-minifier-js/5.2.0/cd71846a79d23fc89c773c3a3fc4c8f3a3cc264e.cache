{"code":"function module(e,i,n){var u,t,d,o,r,a,c=[\"_id\"],l=[\"type\"];n.link(\"@babel/runtime/helpers/objectWithoutProperties\",{default:function(e){u=e}},0),n.export({useRoomRolesManagement:function(){return s}}),n.link(\"@rocket.chat/ui-contexts\",{useMethod:function(e){t=e},useStream:function(e){d=e}},0),n.link(\"react\",{useEffect:function(e){o=e}},1),n.link(\"../../../../../app/models/client\",{RoomRoles:function(e){r=e},ChatMessage:function(e){a=e}},2);var s=function(e){var i=t(\"getRoomRoles\");o(function(){i(e).then(function(e){Array.from(e).forEach(function(e){e._id;var i=u(e,c),n=i.rid,t=i.u._id;r.upsert({rid:n,\"u._id\":t},{$set:i})})})},[i,e]),o(function(){var i=r.find({rid:e}).observe({added:function(i){var n;null!==(n=i.u)&&void 0!==n&&n._id&&a.update({rid:e,\"u._id\":i.u._id},{$addToSet:{roles:i._id}},{multi:!0})},changed:function(i){var n;null!==(n=i.u)&&void 0!==n&&n._id&&a.update({rid:e,\"u._id\":i.u._id},{$inc:{rerender:1}},{multi:!0})},removed:function(i){var n;null!==(n=i.u)&&void 0!==n&&n._id&&a.update({rid:e,\"u._id\":i.u._id},{$pull:{roles:i._id}},{multi:!0})}});return function(){i.stop()}},[i,e]);var n=d(\"notify-logged\");o(function(){return n(\"roles-change\",function(e){var i,n=e.type,t=u(e,l);if(t.scope&&null!==(i=t.u)&&void 0!==i&&i._id)switch(n){case\"added\":r.upsert({rid:t.scope,\"u._id\":t.u._id},{$setOnInsert:{u:t.u},$addToSet:{roles:t._id}});break;case\"removed\":r.update({rid:t.scope,\"u._id\":t.u._id},{$pull:{roles:t._id}})}})},[n]),o(function(){return n(\"Users:NameChanged\",function(e){var i=e._id,n=e.name;r.update({\"u._id\":i},{$set:{\"u.name\":n}},{multi:!0})})},[n])}}","map":"{\"version\":3,\"sources\":[\"client/views/room/body/hooks/useRoomRolesManagement.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom, IUser } from '@rocket.chat/core-typings';\\nimport { useMethod, useStream } from '@rocket.chat/ui-contexts';\\nimport { useEffect } from 'react';\\n\\nimport { RoomRoles, ChatMessage } from '../../../../../app/models/client';\\n\\n// const roomRoles = RoomRoles as Mongo.Collection<Pick<ISubscription, 'rid' | 'u' | 'roles'>>;\\n\\nexport const useRoomRolesManagement = (rid: IRoom['_id']): void => {\\n\\tconst getRoomRoles = useMethod('getRoomRoles');\\n\\n\\tuseEffect(() => {\\n\\t\\tgetRoomRoles(rid).then((results) => {\\n\\t\\t\\tArray.from(results).forEach(({ _id, ...data }) => {\\n\\t\\t\\t\\tconst {\\n\\t\\t\\t\\t\\trid,\\n\\t\\t\\t\\t\\tu: { _id: uid },\\n\\t\\t\\t\\t} = data;\\n\\t\\t\\t\\tRoomRoles.upsert({ rid, 'u._id': uid }, { $set: data });\\n\\t\\t\\t});\\n\\t\\t});\\n\\t}, [getRoomRoles, rid]);\\n\\n\\tuseEffect(() => {\\n\\t\\tconst rolesObserve = RoomRoles.find({ rid }).observe({\\n\\t\\t\\tadded: (role) => {\\n\\t\\t\\t\\tif (!role.u?._id) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tChatMessage.update({ rid, 'u._id': role.u._id }, { $addToSet: { roles: role._id } }, { multi: true });\\n\\t\\t\\t},\\n\\t\\t\\tchanged: (role) => {\\n\\t\\t\\t\\tif (!role.u?._id) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tChatMessage.update({ rid, 'u._id': role.u._id }, { $inc: { rerender: 1 } }, { multi: true });\\n\\t\\t\\t},\\n\\t\\t\\tremoved: (role) => {\\n\\t\\t\\t\\tif (!role.u?._id) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tChatMessage.update({ rid, 'u._id': role.u._id }, { $pull: { roles: role._id } }, { multi: true });\\n\\t\\t\\t},\\n\\t\\t});\\n\\n\\t\\treturn (): void => {\\n\\t\\t\\trolesObserve.stop();\\n\\t\\t};\\n\\t}, [getRoomRoles, rid]);\\n\\n\\tconst subscribeToNotifyLoggedIn = useStream('notify-logged');\\n\\n\\tuseEffect(\\n\\t\\t() =>\\n\\t\\t\\tsubscribeToNotifyLoggedIn('roles-change', ({ type, ...role }) => {\\n\\t\\t\\t\\tif (!role.scope) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (!role.u?._id) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tswitch (type) {\\n\\t\\t\\t\\t\\tcase 'added':\\n\\t\\t\\t\\t\\t\\tRoomRoles.upsert({ 'rid': role.scope, 'u._id': role.u._id }, { $setOnInsert: { u: role.u }, $addToSet: { roles: role._id } });\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\n\\t\\t\\t\\t\\tcase 'removed':\\n\\t\\t\\t\\t\\t\\tRoomRoles.update({ 'rid': role.scope, 'u._id': role.u._id }, { $pull: { roles: role._id } });\\n\\t\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t\\t}\\n\\t\\t\\t}),\\n\\t\\t[subscribeToNotifyLoggedIn],\\n\\t);\\n\\n\\tuseEffect(\\n\\t\\t() =>\\n\\t\\t\\tsubscribeToNotifyLoggedIn('Users:NameChanged', ({ _id: uid, name }: Partial<IUser>) => {\\n\\t\\t\\t\\tRoomRoles.update(\\n\\t\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\t'u._id': uid,\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\t$set: {\\n\\t\\t\\t\\t\\t\\t\\t'u.name': name,\\n\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\tmulti: true,\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t);\\n\\t\\t\\t}),\\n\\t\\t[subscribeToNotifyLoggedIn],\\n\\t);\\n};\\n\",null],\"names\":[\"_objectWithoutProperties\",\"useMethod\",\"useStream\",\"useEffect\",\"RoomRoles\",\"ChatMessage\",\"module\",\"link\",\"default\",\"v\",\"export\",\"useRoomRolesManagement\",\"rid\",\"getRoomRoles\",\"then\",\"results\",\"Array\",\"from\",\"forEach\",\"_ref\",\"_id\",\"data\",\"_excluded\",\"uid\",\"u\",\"upsert\",\"$set\",\"rolesObserve\",\"find\",\"observe\",\"added\",\"role\",\"_role$u\",\"update\",\"$addToSet\",\"roles\",\"multi\",\"changed\",\"_role$u2\",\"$inc\",\"rerender\",\"removed\",\"_role$u3\",\"$pull\",\"stop\",\"subscribeToNotifyLoggedIn\",\"_ref2\",\"_role$u4\",\"type\",\"_excluded2\",\"scope\",\"$setOnInsert\",\"_ref3\",\"name\"],\"mappings\":\"2BACAA,EAAgEC,EAAAC,EAAAC,EAAAC,EAAAC,uBAAnCC,EAAEC,IAAM,CAAA,iDAA2B,CAAAC,QAAA,SAAAC,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAhEH,EAAOI,MAAE,CAAA,CAAAC,uBAA4B,WAAA,OAAAA,CAA2B,CAAA,GAAAL,EAAAC,IAAA,CAAA,2BAAA,CAAAN,UAAA,SAAAQ,CAAA,EAAAR,EAAAQ,CAAA,EAAAP,UAAA,SAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,QAAA,CAAAJ,UAAA,SAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,mCAAA,CAAAH,UAAA,SAAAK,CAAA,EAAAL,EAAAK,CAAA,EAAAJ,YAAA,SAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAOzD,IAAME,EAAyB,SAACC,CAAiB,EACvD,IAAMC,EAAeZ,EAAU,gBAE/BE,EAAU,WACTU,EAAaD,GAAKE,IAAI,CAAC,SAACC,CAAO,EAC9BC,MAAMC,IAAI,CAACF,GAASG,OAAO,CAAC,SAAAC,CAAA,EAAMA,EAAHC,GAAG,CAAe,IAAVC,EAAIrB,EAAAmB,EAAAG,GAEzCV,EAEGS,EAFHT,GAAG,CACOW,EACPF,EADHG,CAAC,CAAIJ,GAAG,CAEThB,EAAUqB,MAAM,CAAC,CAAEb,IAAAA,EAAK,QAASW,CAAG,EAAI,CAAEG,KAAML,CAAI,EACrD,EACD,EACD,EAAG,CAACR,EAAcD,EAAI,EAEtBT,EAAU,WACT,IAAMwB,EAAevB,EAAUwB,IAAI,CAAC,CAAEhB,IAAAA,CAAG,GAAIiB,OAAO,CAAC,CACpDC,MAAO,SAACC,CAAI,EAAI,IAAAC,CACJ,QAAPA,CAAAA,EAACD,EAAKP,CAAC,AAADA,GAACQ,AAAA,KAAA,IAAAA,GAANA,EAAQZ,GAAG,EAGhBf,EAAY4B,MAAM,CAAC,CAAErB,IAAAA,EAAK,QAASmB,EAAKP,CAAC,CAACJ,GAAAA,AAAG,EAAI,CAAEc,UAAW,CAAEC,MAAOJ,EAAKX,GAAAA,AAAG,CAAE,EAAI,CAAEgB,MAAO,CAAA,CAAI,EACnG,EACAC,QAAS,SAACN,CAAI,EAAI,IAAAO,CACN,QAAPA,CAAAA,EAACP,EAAKP,CAAC,AAADA,GAACc,AAAA,KAAA,IAAAA,GAANA,EAAQlB,GAAG,EAGhBf,EAAY4B,MAAM,CAAC,CAAErB,IAAAA,EAAK,QAASmB,EAAKP,CAAC,CAACJ,GAAAA,AAAG,EAAI,CAAEmB,KAAM,CAAEC,SAAU,CAAC,CAAE,EAAI,CAAEJ,MAAO,CAAA,CAAI,EAC1F,EACAK,QAAS,SAACV,CAAI,EAAI,IAAAW,CACN,QAAPA,CAAAA,EAACX,EAAKP,CAAC,AAADA,GAACkB,AAAA,KAAA,IAAAA,GAANA,EAAQtB,GAAG,EAGhBf,EAAY4B,MAAM,CAAC,CAAErB,IAAAA,EAAK,QAASmB,EAAKP,CAAC,CAACJ,GAAAA,AAAG,EAAI,CAAEuB,MAAO,CAAER,MAAOJ,EAAKX,GAAAA,AAAG,CAAE,EAAI,CAAEgB,MAAO,CAAA,CAAI,EAC/F,IAGD,OAAO,WACNT,EAAaiB,IAAI,EAClB,CACD,EAAG,CAAC/B,EAAcD,EAAI,EAEtB,IAAMiC,EAA4B3C,EAAU,iBAE5CC,EACC,WAAA,OACC0C,EAA0B,eAAgB,SAAAC,CAAA,EAAsB,IAAAC,EAAnBC,EAAIF,EAAJE,IAAI,CAAKjB,EAAI/B,EAAA8C,EAAAG,GACzD,GAAKlB,EAAKmB,KAAK,EAIX,AAAO,OAAPH,CAAAA,EAAChB,EAAKP,CAAC,AAADA,GAACuB,AAAA,KAAA,IAAAA,GAANA,EAAQ3B,GAAG,CAIhB,OAAQ4B,GACP,IAAK,QACJ5C,EAAUqB,MAAM,CAAC,CAAE,IAAOM,EAAKmB,KAAK,CAAE,QAASnB,EAAKP,CAAC,CAACJ,GAAAA,AAAG,EAAI,CAAE+B,aAAc,CAAE3B,EAAGO,EAAKP,CAAAA,AAAC,EAAIU,UAAW,CAAEC,MAAOJ,EAAKX,GAAAA,AAAG,CAAE,GAC1H,KAED,KAAK,UACJhB,EAAU6B,MAAM,CAAC,CAAE,IAAOF,EAAKmB,KAAK,CAAE,QAASnB,EAAKP,CAAC,CAACJ,GAAAA,AAAG,EAAI,CAAEuB,MAAO,CAAER,MAAOJ,EAAKX,GAAAA,AAAG,CAAE,EAE3F,CACD,EAAE,EACH,CAACyB,EAA0B,EAG5B1C,EACC,WAAA,OACC0C,EAA0B,oBAAqB,SAAAO,CAAA,EAAuC,IAA/B7B,EAAG6B,EAARhC,GAAG,CAAOiC,EAAID,EAAJC,IAAI,CAC/DjD,EAAU6B,MAAM,CACf,CACC,QAASV,GAEV,CACCG,KAAM,CACL,SAAU2B,IAGZ,CACCjB,MAAO,CAAA,GAGV,EAAE,EACH,CAACS,EAA0B,CAE7B\"}"}