{"code":"function module(e,r,t){let l,c,s,i,n,o,u;t.export({useLegacyThreadMessageListScrolling:()=>a}),t.link(\"@rocket.chat/core-typings\",{isEditedMessage(e){l=e}},0),t.link(\"@rocket.chat/ui-contexts\",{useUser(e){c=e}},1),t.link(\"react\",{useCallback(e){s=e},useEffect(e){i=e},useRef(e){n=e}},2),t.link(\"../../../../../../lib/callbacks\",{callbacks(e){o=e}},3),t.link(\"../../../contexts/RoomContext\",{useRoom(e){u=e}},4);let a=e=>{let r=n(null),t=n(null),a=n(!0),d=s(e=>{let{scrollHeight:r,scrollTop:t,clientHeight:l}=e;a.current=t>=r-l},[]),k=s(()=>{if(!0===a.current){let e=r.current;null==e||e.scrollTo(30,e.scrollHeight)}},[]),_=u(),g=c();return i(()=>(o.add(\"streamNewMessage\",r=>{_._id!==r.rid||l(r)||r.tmid!==e._id||r.u._id!==(null==g?void 0:g._id)||(a.current=!0,k())},o.priority.MEDIUM,\"thread-scroll-\".concat(_._id)),()=>{o.remove(\"streamNewMessage\",\"thread-scroll-\".concat(_._id))}),[_._id,k,null==g?void 0:g._id,e._id]),i(()=>{let e=new ResizeObserver(()=>{k()});return r.current&&e.observe(r.current),t.current&&e.observe(t.current),()=>{e.disconnect()}},[k]),{listWrapperRef:r,listRef:t,requestScrollToBottom:k,onScroll:d}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/contextualBar/Threads/hooks/useLegacyThreadMessageListScrolling.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IMessage } from '@rocket.chat/core-typings';\\nimport { isEditedMessage } from '@rocket.chat/core-typings';\\nimport { useUser } from '@rocket.chat/ui-contexts';\\nimport type { ScrollValues } from 'rc-scrollbars';\\nimport { useCallback, useEffect, useRef } from 'react';\\n\\nimport { callbacks } from '../../../../../../lib/callbacks';\\nimport { useRoom } from '../../../contexts/RoomContext';\\n\\nexport const useLegacyThreadMessageListScrolling = (mainMessage: IMessage) => {\\n\\tconst listWrapperRef = useRef<HTMLDivElement>(null);\\n\\tconst listRef = useRef<HTMLElement>(null);\\n\\n\\tconst atBottomRef = useRef(true);\\n\\n\\tconst onScroll = useCallback(({ scrollHeight, scrollTop, clientHeight }: ScrollValues) => {\\n\\t\\tatBottomRef.current = scrollTop >= scrollHeight - clientHeight;\\n\\t}, []);\\n\\n\\tconst sendToBottomIfNecessary = useCallback(() => {\\n\\t\\tif (atBottomRef.current === true) {\\n\\t\\t\\tconst listWrapper = listWrapperRef.current;\\n\\n\\t\\t\\tlistWrapper?.scrollTo(30, listWrapper.scrollHeight);\\n\\t\\t}\\n\\t}, []);\\n\\n\\tconst room = useRoom();\\n\\tconst user = useUser();\\n\\n\\tuseEffect(() => {\\n\\t\\tcallbacks.add(\\n\\t\\t\\t'streamNewMessage',\\n\\t\\t\\t(msg: IMessage) => {\\n\\t\\t\\t\\tif (room._id !== msg.rid || isEditedMessage(msg) || msg.tmid !== mainMessage._id) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (msg.u._id === user?._id) {\\n\\t\\t\\t\\t\\tatBottomRef.current = true;\\n\\t\\t\\t\\t\\tsendToBottomIfNecessary();\\n\\t\\t\\t\\t}\\n\\t\\t\\t},\\n\\t\\t\\tcallbacks.priority.MEDIUM,\\n\\t\\t\\t`thread-scroll-${room._id}`,\\n\\t\\t);\\n\\n\\t\\treturn () => {\\n\\t\\t\\tcallbacks.remove('streamNewMessage', `thread-scroll-${room._id}`);\\n\\t\\t};\\n\\t}, [room._id, sendToBottomIfNecessary, user?._id, mainMessage._id]);\\n\\n\\tuseEffect(() => {\\n\\t\\tconst observer = new ResizeObserver(() => {\\n\\t\\t\\tsendToBottomIfNecessary();\\n\\t\\t});\\n\\n\\t\\tif (listWrapperRef.current) observer.observe(listWrapperRef.current);\\n\\t\\tif (listRef.current) observer.observe(listRef.current);\\n\\n\\t\\treturn () => {\\n\\t\\t\\tobserver.disconnect();\\n\\t\\t};\\n\\t}, [sendToBottomIfNecessary]);\\n\\n\\treturn { listWrapperRef, listRef, requestScrollToBottom: sendToBottomIfNecessary, onScroll };\\n};\\n\",null],\"names\":[\"isEditedMessage\",\"useUser\",\"useCallback\",\"useEffect\",\"useRef\",\"callbacks\",\"useRoom\",\"module\",\"export\",\"useLegacyThreadMessageListScrolling\",\"link\",\"v\",\"mainMessage\",\"listWrapperRef\",\"listRef\",\"atBottomRef\",\"onScroll\",\"_ref\",\"scrollHeight\",\"scrollTop\",\"clientHeight\",\"current\",\"sendToBottomIfNecessary\",\"listWrapper\",\"scrollTo\",\"room\",\"user\",\"add\",\"msg\",\"_id\",\"rid\",\"tmid\",\"u\",\"priority\",\"MEDIUM\",\"concat\",\"remove\",\"observer\",\"ResizeObserver\",\"observe\",\"disconnect\",\"requestScrollToBottom\"],\"mappings\":\"2BAC4DA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAA5DC,EAAOC,MAAE,CAAA,CAAAC,oCAAuBA,IAAAA,CAA4B,GAAAF,EAAAG,IAAA,CAAA,4BAAA,CAAAV,gBAAAW,CAAA,EAAAX,EAAAW,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,2BAAA,CAAAT,QAAAU,CAAA,EAAAV,EAAAU,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,QAAA,CAAAR,YAAAS,CAAA,EAAAT,EAAAS,CAAA,EAAAR,UAAAQ,CAAA,EAAAR,EAAAQ,CAAA,EAAAP,OAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,kCAAA,CAAAL,UAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,gCAAA,CAAAJ,QAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAQrD,IAAMF,EAAuCG,IACnD,IAAMC,EAAiBT,EAAuB,MACxCU,EAAUV,EAAoB,MAE9BW,EAAcX,EAAO,CAAA,GAErBY,EAAWd,EAAYe,IAA4D,GAA3D,CAAEC,aAAAA,CAAY,CAAEC,UAAAA,CAAS,CAAEC,aAAAA,CAAAA,CAA4B,CAAAH,CACpFF,CAAAA,EAAYM,OAAO,CAAGF,GAAaD,EAAeE,CACnD,EAAG,EAAE,EAECE,EAA0BpB,EAAY,KAC3C,GAAIa,AAAwB,CAAA,IAAxBA,EAAYM,OAAO,CAAW,CACjC,IAAME,EAAcV,EAAeQ,OAAO,AAE1CE,OAAAA,GAAAA,EAAaC,QAAQ,CAAC,GAAID,EAAYL,YAAY,CACnD,CACD,EAAG,EAAE,EAECO,EAAOnB,IACPoB,EAAOzB,IAqCb,OAnCAE,EAAU,KACTE,EAAUsB,GAAG,CACZ,mBACCC,IACIH,EAAKI,GAAG,GAAKD,EAAIE,GAAG,EAAI9B,EAAgB4B,IAAQA,EAAIG,IAAI,GAAKnB,EAAYiB,GAAG,EAI5ED,EAAII,CAAC,CAACH,GAAG,GAAKH,CAAAA,MAAAA,EAAI,KAAA,EAAJA,EAAMG,GAAG,AAAHA,IACvBd,EAAYM,OAAO,CAAG,CAAA,EACtBC,IAEF,EACAjB,EAAU4B,QAAQ,CAACC,MAAM,CAAA,iBAAAC,MAAA,CACRV,EAAKI,GAAG,GAGnB,KACNxB,EAAU+B,MAAM,CAAC,mBAAkB,iBAAAD,MAAA,CAAmBV,EAAKI,GAAG,EAC/D,GACE,CAACJ,EAAKI,GAAG,CAAEP,EAAyBI,MAAAA,EAAI,KAAA,EAAJA,EAAMG,GAAG,CAAEjB,EAAYiB,GAAG,CAAC,EAElE1B,EAAU,KACT,IAAMkC,EAAW,IAAIC,eAAe,KACnChB,GACD,GAKA,OAHIT,EAAeQ,OAAO,EAAEgB,EAASE,OAAO,CAAC1B,EAAeQ,OAAO,EAC/DP,EAAQO,OAAO,EAAEgB,EAASE,OAAO,CAACzB,EAAQO,OAAO,EAE9C,KACNgB,EAASG,UAAU,EACpB,CACD,EAAG,CAAClB,EAAwB,EAErB,CAAET,eAAAA,EAAgBC,QAAAA,EAAS2B,sBAAuBnB,EAAyBN,SAAAA,CAAQ,CAC3F\"}"}