{"code":"function module(n,e,i){var t,r,o,u,d;i.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(n){t=n}},0),i.link(\"meteor/meteor\",{Meteor:function(n){r=n}},0),i.link(\"../../app/models/client\",{ChatMessage:function(n){o=n}},1),i.link(\"../../app/ui-cached-collection/client\",{CachedCollectionManager:function(n){u=n}},2),i.link(\"../../app/utils/client/lib/SDKClient\",{sdk:function(n){d=n}},3),r.startup(function(){Tracker.autorun(function(){r.userId()&&d.stream(\"notify-user\",[r.userId()+\"/message\"],function(n){return n.u=n.u||{username:\"rocket.cat\"},n.private=!0,o.upsert({_id:n._id},n)})}),u.onLogin(function(){d.stream(\"notify-user\",[r.userId()+\"/subscriptions-changed\"],function(n,e){o.update(t({rid:e.rid},\"ignored\"in e&&e.ignored?{\"u._id\":{$nin:e.ignored}}:{ignored:{$exists:!0}}),{$unset:{ignored:!0}},{multi:!0}),\"ignored\"in e&&e.ignored&&o.update({rid:e.rid,t:{$ne:\"command\"},\"u._id\":{$in:e.ignored}},{$set:{ignored:!0}},{multi:!0})})})})}","map":"{\"version\":3,\"sources\":[\"client/startup/incomingMessages.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IMessage } from '@rocket.chat/core-typings';\\nimport { Meteor } from 'meteor/meteor';\\n\\nimport { ChatMessage } from '../../app/models/client';\\nimport { CachedCollectionManager } from '../../app/ui-cached-collection/client';\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(() => {\\n\\t\\tif (!Meteor.userId()) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\t// Only event I found triggers this is from ephemeral messages\\n\\t\\t// Other types of messages come from another stream\\n\\t\\tsdk.stream('notify-user', [`${Meteor.userId()}/message`], (msg: IMessage) => {\\n\\t\\t\\tmsg.u = msg.u || { username: 'rocket.cat' };\\n\\t\\t\\tmsg.private = true;\\n\\n\\t\\t\\treturn ChatMessage.upsert({ _id: msg._id }, msg);\\n\\t\\t});\\n\\t});\\n\\n\\tCachedCollectionManager.onLogin(() => {\\n\\t\\tsdk.stream('notify-user', [`${Meteor.userId()}/subscriptions-changed`], (_action, sub) => {\\n\\t\\t\\tChatMessage.update(\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\trid: sub.rid,\\n\\t\\t\\t\\t\\t...('ignored' in sub && sub.ignored ? { 'u._id': { $nin: sub.ignored } } : { ignored: { $exists: true } }),\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\t{ $unset: { ignored: true } },\\n\\t\\t\\t\\t{ multi: true },\\n\\t\\t\\t);\\n\\t\\t\\tif ('ignored' in sub && sub.ignored) {\\n\\t\\t\\t\\tChatMessage.update(\\n\\t\\t\\t\\t\\t{ 'rid': sub.rid, 't': { $ne: 'command' }, 'u._id': { $in: sub.ignored } },\\n\\t\\t\\t\\t\\t{ $set: { ignored: true } },\\n\\t\\t\\t\\t\\t{ multi: true },\\n\\t\\t\\t\\t);\\n\\t\\t\\t}\\n\\t\\t});\\n\\t});\\n});\\n\",null],\"names\":[\"_objectSpread\",\"Meteor\",\"ChatMessage\",\"CachedCollectionManager\",\"sdk\",\"module\",\"link\",\"default\",\"v\",\"startup\",\"Tracker\",\"autorun\",\"userId\",\"stream\",\"msg\",\"u\",\"username\",\"private\",\"upsert\",\"_id\",\"onLogin\",\"_action\",\"sub\",\"update\",\"rid\",\"ignored\",\"$nin\",\"$exists\",\"$unset\",\"multi\",\"$ne\",\"$in\",\"$set\"],\"mappings\":\"2BACAA,EAAAC,EAAuCC,EAAAC,EAAAC,EAAtBC,EAAMC,IAAA,CAAA,uCAAgB,CAAAC,QAAA,SAAAC,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAA9BH,EAAQC,IAAA,CAAM,gBAAgB,CAAAL,OAAA,SAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,0BAAA,CAAAJ,YAAA,SAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,wCAAA,CAAAH,wBAAA,SAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAF,IAAA,SAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAMvCP,EAAOQ,OAAO,CAAC,WACdC,QAAQC,OAAO,CAAC,WACVV,EAAOW,MAAM,IAMlBR,EAAIS,MAAM,CAAC,cAAe,CAAIZ,EAAOW,MAAM,GAAE,WAAW,CAAE,SAACE,CAAa,EAIvE,OAHAA,EAAIC,CAAC,CAAGD,EAAIC,CAAC,EAAI,CAAEC,SAAU,YAAY,EACzCF,EAAIG,OAAO,CAAG,CAAA,EAEPf,EAAYgB,MAAM,CAAC,CAAEC,IAAKL,EAAIK,GAAAA,AAAG,EAAIL,EAC7C,EACD,GAEAX,EAAwBiB,OAAO,CAAC,WAC/BhB,EAAIS,MAAM,CAAC,cAAe,CAAIZ,EAAOW,MAAM,GAAE,yBAAyB,CAAE,SAACS,CAAO,CAAEC,CAAG,EACpFpB,EAAYqB,MAAM,CAAAvB,EAAA,CAEhBwB,IAAKF,EAAIE,GAAAA,AAAG,EACR,YAAaF,GAAOA,EAAIG,OAAO,CAAG,CAAE,QAAS,CAAEC,KAAMJ,EAAIG,OAAAA,AAAO,CAAE,EAAK,CAAEA,QAAS,CAAEE,QAAS,CAAA,CAAI,CAAE,GAExG,CAAEC,OAAQ,CAAEH,QAAS,CAAA,CAAI,CAAE,EAC3B,CAAEI,MAAO,CAAA,CAAI,GAEV,YAAaP,GAAOA,EAAIG,OAAO,EAClCvB,EAAYqB,MAAM,CACjB,CAAE,IAAOD,EAAIE,GAAG,CAAE,EAAK,CAAEM,IAAK,SAAS,EAAI,QAAS,CAAEC,IAAKT,EAAIG,OAAAA,AAAO,CAAE,EACxE,CAAEO,KAAM,CAAEP,QAAS,CAAA,CAAI,CAAE,EACzB,CAAEI,MAAO,CAAA,CAAI,EAGhB,EACD,EACD\"}"}