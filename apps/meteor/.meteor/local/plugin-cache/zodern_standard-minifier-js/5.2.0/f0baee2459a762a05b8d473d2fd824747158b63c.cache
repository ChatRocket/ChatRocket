{"code":"function module(e,t,o){let i,r,l,n,s,u,d;o.export({useComposerBoxPopup:()=>c}),o.link(\"@rocket.chat/fuselage-hooks\",{useMutableCallback(e){i=e}},0),o.link(\"react\",{useEffect(e){r=e},useCallback(e){l=e},useState(e){n=e},useRef(e){s=e}},1),o.link(\"../../contexts/ChatContext\",{useChat(e){u=e}},2),o.link(\"./useComposerBoxPopupQueries\",{useComposerBoxPopupQueries(e){d=e}},3);let a={TAB:9,ENTER:13,ESC:27,ARROW_UP:38,ARROW_DOWN:40},c=e=>{let{configurations:t}=e,[o,c]=n(void 0),[v,p]=n(void 0),[f,g]=n(\"\"),h=s(),{queries:m,suspended:x}=d(f,o),R=u(),E=v?\"popup-item-\".concat(v._id):void 0;r(()=>{if(o){if(null!=o&&o.preview&&x){p(void 0);return}p(e=>{var t;let o=m.filter(e=>e.isSuccess).flatMap(e=>e.data).sort((e,t)=>(\"sort\"in e&&e.sort||0)-(\"sort\"in t&&t.sort||0));return null!==(t=o.find(t=>t._id===(null==e?void 0:e._id)))&&void 0!==t?t:o[0]})}},[m,o,x]);let w=i(e=>{var t,i,r,l,n,s,u,d,a;if(!o)throw Error(\"No popup is open\");if(null!==(t=h.current)&&void 0!==t&&t.select)h.current.select(e);else{let t=null==R?void 0:null===(i=R.composer)||void 0===i?void 0:i.substring(0,null==R?void 0:null===(r=R.composer)||void 0===r?void 0:r.selection.start),c=null!==(l=o.matchSelectorRegex)&&void 0!==l?l:new RegExp(o.triggerAnywhere?\"(?:^| |\\n)(\".concat(o.trigger,\")([^\\\\s]*$)\"):\"(?:^)(\".concat(o.trigger,\")([^\\\\s]*$)\")),v=null==t?void 0:t.match(c);if(!v||!t)return;null==R||null===(n=R.composer)||void 0===n||n.replaceText((null!==(s=null!==(u=o.prefix)&&void 0!==u?u:o.trigger)&&void 0!==s?s:\"\")+o.getValue(e)+(null!==(d=o.suffix)&&void 0!==d?d:\"\"),{start:t.lastIndexOf(v[1]+v[2]),end:null==R?void 0:null===(a=R.composer)||void 0===a?void 0:a.selection.start})}c(void 0),p(void 0)}),y=i(()=>{var e,o,i,r,l,n;let s=null==R?void 0:null===(e=R.composer)||void 0===e?void 0:e.substring(0,null==R?void 0:null===(o=R.composer)||void 0===o?void 0:o.selection.start);if(!s){c(void 0),p(void 0);return}let u=t.find(e=>{let{trigger:t,matchSelectorRegex:o,triggerAnywhere:i,triggerLength:r}=e,l=null!=o?o:new RegExp(i?\"(?:^| |\\n)(\".concat(t,\")[^\\\\s]*$\"):\"(?:^)(\".concat(t,\")[^\\\\s]*$\")),n=l.test(s);if(!r||!n)return n;let u=s.match(l);return u&&r<u[0].length});if(c(u),u||(p(void 0),g(\"\")),u){let e=null!==(i=u.matchSelectorRegex)&&void 0!==i?i:new RegExp(u.triggerAnywhere?\"(?:^| |\\n)(\".concat(u.trigger,\")([^\\\\s]*$)\"):\"(?:^)(\".concat(u.trigger,\")([^\\\\s]*$)\")),t=s.match(e);g(null!==(r=null===(l=h.current)||void 0===l?void 0:null===(n=l.getFilter)||void 0===n?void 0:n.call(l))&&void 0!==r?r:t?t[2]:\"\")}return u}),k=i(()=>{o||y()}),C=i(e=>{y()&&o&&!0===o.closeOnEsc&&e.which===a.ESC&&(c(void 0),p(void 0),e.preventDefault(),e.stopImmediatePropagation())}),A=i(e=>{if(o){if(e.which===a.ENTER||e.which===a.TAB){if(!v)return;return w(v),e.preventDefault(),e.stopImmediatePropagation(),!0}return e.which!==a.ARROW_UP||e.shiftKey||e.ctrlKey||e.altKey||e.metaKey?e.which!==a.ARROW_DOWN||e.shiftKey||e.ctrlKey||e.altKey||e.metaKey?void 0:(p(e=>{let t=m.filter(e=>e.isSuccess).flatMap(e=>e.data).sort((e,t)=>(\"sort\"in e&&e.sort||0)-(\"sort\"in t&&t.sort||0));if(!t)return;let o=t.findIndex(t=>t===e);return o<t.length-1?t[o+1]:t[0]}),e.preventDefault(),e.stopImmediatePropagation(),!0):(p(e=>{let t=m.filter(e=>e.isSuccess).flatMap(e=>e.data).sort((e,t)=>(\"sort\"in e&&e.sort||0)-(\"sort\"in t&&t.sort||0));if(!t)return;let o=t.findIndex(t=>t===e);return o>0?t[o-1]:t[t.length-1]}),e.preventDefault(),e.stopImmediatePropagation(),!0)}}),P=i(()=>{o&&(c(void 0),p(void 0),g(\"\"))}),K=l(e=>{e&&(e.addEventListener(\"keyup\",C),e.addEventListener(\"keydown\",A),e.addEventListener(\"focus\",k))},[C,A,k]);return o?{focused:v,items:m,ariaActiveDescendant:E,popup:o,select:w,filter:f,suspended:x,commandsRef:h,callbackRef:K,clearPopup:P}:{callbackRef:K,focused:void 0,items:void 0,ariaActiveDescendant:void 0,popup:void 0,select:void 0,suspended:!0,commandsRef:h,filter:void 0,clearPopup:P}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/composer/hooks/useComposerBoxPopup.ts\",\"<anon>\"],\"sourcesContent\":[\"import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\\nimport type { UseQueryResult } from '@tanstack/react-query';\\nimport type { MutableRefObject } from 'react';\\nimport { useEffect, useCallback, useState, useRef } from 'react';\\n\\nimport { useChat } from '../../contexts/ChatContext';\\nimport type { ComposerPopupOption } from '../../contexts/ComposerPopupContext';\\nimport { useComposerBoxPopupQueries } from './useComposerBoxPopupQueries';\\n\\ntype ComposerBoxPopupImperativeCommands<T> = MutableRefObject<\\n\\t| {\\n\\t\\t\\tgetFilter?: () => unknown;\\n\\t\\t\\tselect?: (s: T) => void;\\n\\t  }\\n\\t| undefined\\n>;\\n\\ntype ComposerBoxPopupOptions<T extends { _id: string; sort?: number | undefined }> = ComposerPopupOption<T>;\\n\\ntype ComposerBoxPopupResult<T extends { _id: string; sort?: number }> =\\n\\t| {\\n\\t\\t\\tpopup: ComposerPopupOption<T>;\\n\\t\\t\\titems: UseQueryResult<T[]>[];\\n\\t\\t\\tfocused: T | undefined;\\n\\t\\t\\tariaActiveDescendant: string | undefined;\\n\\t\\t\\tselect: (item: T) => void;\\n\\t\\t\\tcallbackRef: (node: HTMLElement) => void;\\n\\t\\t\\tcommandsRef: ComposerBoxPopupImperativeCommands<T>;\\n\\t\\t\\tsuspended: boolean;\\n\\t\\t\\tfilter: unknown;\\n\\t\\t\\tclearPopup: () => void;\\n\\t  }\\n\\t| {\\n\\t\\t\\tpopup: undefined;\\n\\t\\t\\titems: undefined;\\n\\t\\t\\tfocused: undefined;\\n\\t\\t\\tariaActiveDescendant: undefined;\\n\\t\\t\\tcallbackRef: (node: HTMLElement) => void;\\n\\t\\t\\tselect: undefined;\\n\\t\\t\\tcommandsRef: ComposerBoxPopupImperativeCommands<T>;\\n\\t\\t\\tsuspended: boolean;\\n\\t\\t\\tfilter: unknown;\\n\\t\\t\\tclearPopup: () => void;\\n\\t  };\\n\\nconst keys = {\\n\\tTAB: 9,\\n\\tENTER: 13,\\n\\tESC: 27,\\n\\tARROW_LEFT: 37,\\n\\tARROW_UP: 38,\\n\\tARROW_RIGHT: 39,\\n\\tARROW_DOWN: 40,\\n};\\n\\nexport const useComposerBoxPopup = <T extends { _id: string; sort?: number }>({\\n\\tconfigurations,\\n}: {\\n\\tconfigurations: ComposerBoxPopupOptions<T>[];\\n}): ComposerBoxPopupResult<T> => {\\n\\tconst [popup, setPopup] = useState<ComposerBoxPopupOptions<T> | undefined>(undefined);\\n\\tconst [focused, setFocused] = useState<T | undefined>(undefined);\\n\\tconst [filter, setFilter] = useState<unknown>('');\\n\\n\\tconst commandsRef: ComposerBoxPopupImperativeCommands<T> = useRef();\\n\\n\\tconst { queries: items, suspended } = useComposerBoxPopupQueries(filter, popup) as {\\n\\t\\tqueries: UseQueryResult<T[]>[];\\n\\t\\tsuspended: boolean;\\n\\t};\\n\\n\\tconst chat = useChat();\\n\\n\\tconst ariaActiveDescendant = focused ? `popup-item-${focused._id}` : undefined;\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!popup) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tif (popup?.preview && suspended) {\\n\\t\\t\\tsetFocused(undefined);\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tsetFocused((focused) => {\\n\\t\\t\\tconst sortedItems = items\\n\\t\\t\\t\\t.filter((item) => item.isSuccess)\\n\\t\\t\\t\\t.flatMap((item) => item.data as T[])\\n\\t\\t\\t\\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\\n\\t\\t\\treturn sortedItems.find((item) => item._id === focused?._id) ?? sortedItems[0];\\n\\t\\t});\\n\\t}, [items, popup, suspended]);\\n\\n\\tconst select = useMutableCallback((item: T) => {\\n\\t\\tif (!popup) {\\n\\t\\t\\tthrow new Error('No popup is open');\\n\\t\\t}\\n\\n\\t\\tif (commandsRef.current?.select) {\\n\\t\\t\\tcommandsRef.current.select(item);\\n\\t\\t} else {\\n\\t\\t\\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\\n\\t\\t\\tconst selector =\\n\\t\\t\\t\\tpopup.matchSelectorRegex ??\\n\\t\\t\\t\\t(popup.triggerAnywhere ? new RegExp(`(?:^| |\\\\n)(${popup.trigger})([^\\\\\\\\s]*$)`) : new RegExp(`(?:^)(${popup.trigger})([^\\\\\\\\s]*$)`));\\n\\n\\t\\t\\tconst result = value?.match(selector);\\n\\t\\t\\tif (!result || !value) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tchat?.composer?.replaceText((popup.prefix ?? popup.trigger ?? '') + popup.getValue(item) + (popup.suffix ?? ''), {\\n\\t\\t\\t\\tstart: value.lastIndexOf(result[1] + result[2]),\\n\\t\\t\\t\\tend: chat?.composer?.selection.start,\\n\\t\\t\\t});\\n\\t\\t}\\n\\t\\tsetPopup(undefined);\\n\\t\\tsetFocused(undefined);\\n\\t});\\n\\n\\tconst setConfigByInput = useMutableCallback((): ComposerBoxPopupOptions<T> | undefined => {\\n\\t\\tconst value = chat?.composer?.substring(0, chat?.composer?.selection.start);\\n\\n\\t\\tif (!value) {\\n\\t\\t\\tsetPopup(undefined);\\n\\t\\t\\tsetFocused(undefined);\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst configuration = configurations.find(({ trigger, matchSelectorRegex, triggerAnywhere, triggerLength }) => {\\n\\t\\t\\tconst selector =\\n\\t\\t\\t\\tmatchSelectorRegex ?? (triggerAnywhere ? new RegExp(`(?:^| |\\\\n)(${trigger})[^\\\\\\\\s]*$`) : new RegExp(`(?:^)(${trigger})[^\\\\\\\\s]*$`));\\n\\t\\t\\tconst result = selector.test(value);\\n\\t\\t\\tif (!triggerLength || !result) {\\n\\t\\t\\t\\treturn result;\\n\\t\\t\\t}\\n\\t\\t\\tconst filter = value.match(selector);\\n\\t\\t\\treturn filter && triggerLength < filter[0].length;\\n\\t\\t});\\n\\t\\tsetPopup(configuration);\\n\\t\\tif (!configuration) {\\n\\t\\t\\tsetFocused(undefined);\\n\\t\\t\\tsetFilter('');\\n\\t\\t}\\n\\n\\t\\tif (configuration) {\\n\\t\\t\\tconst selector =\\n\\t\\t\\t\\tconfiguration.matchSelectorRegex ??\\n\\t\\t\\t\\t(configuration.triggerAnywhere\\n\\t\\t\\t\\t\\t? new RegExp(`(?:^| |\\\\n)(${configuration.trigger})([^\\\\\\\\s]*$)`)\\n\\t\\t\\t\\t\\t: new RegExp(`(?:^)(${configuration.trigger})([^\\\\\\\\s]*$)`));\\n\\t\\t\\tconst result = value.match(selector);\\n\\t\\t\\tsetFilter(commandsRef.current?.getFilter?.() ?? (result ? result[2] : ''));\\n\\t\\t}\\n\\t\\treturn configuration;\\n\\t});\\n\\n\\tconst onFocus = useMutableCallback(() => {\\n\\t\\tif (popup) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tsetConfigByInput();\\n\\t});\\n\\n\\tconst keyup = useMutableCallback((event: KeyboardEvent) => {\\n\\t\\tif (!setConfigByInput()) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tif (!popup) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tif (popup.closeOnEsc === true && event.which === keys.ESC) {\\n\\t\\t\\tsetPopup(undefined);\\n\\t\\t\\tsetFocused(undefined);\\n\\t\\t\\tevent.preventDefault();\\n\\t\\t\\tevent.stopImmediatePropagation();\\n\\t\\t}\\n\\t});\\n\\n\\tconst keydown = useMutableCallback((event: KeyboardEvent) => {\\n\\t\\tif (!popup) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tif (event.which === keys.ENTER || event.which === keys.TAB) {\\n\\t\\t\\tif (!focused) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tselect(focused);\\n\\n\\t\\t\\tevent.preventDefault();\\n\\t\\t\\tevent.stopImmediatePropagation();\\n\\t\\t\\treturn true;\\n\\t\\t}\\n\\t\\tif (event.which === keys.ARROW_UP && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\\n\\t\\t\\tsetFocused((focused) => {\\n\\t\\t\\t\\tconst list = items\\n\\t\\t\\t\\t\\t.filter((item) => item.isSuccess)\\n\\t\\t\\t\\t\\t.flatMap((item) => item.data as T[])\\n\\t\\t\\t\\t\\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\\n\\n\\t\\t\\t\\tif (!list) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tconst focusedIndex = list.findIndex((item) => item === focused);\\n\\n\\t\\t\\t\\treturn (focusedIndex > 0 ? list[focusedIndex - 1] : list[list.length - 1]) as T;\\n\\t\\t\\t});\\n\\t\\t\\tevent.preventDefault();\\n\\t\\t\\tevent.stopImmediatePropagation();\\n\\t\\t\\treturn true;\\n\\t\\t}\\n\\t\\tif (event.which === keys.ARROW_DOWN && !(event.shiftKey || event.ctrlKey || event.altKey || event.metaKey)) {\\n\\t\\t\\tsetFocused((focused) => {\\n\\t\\t\\t\\tconst list = items\\n\\t\\t\\t\\t\\t.filter((item) => item.isSuccess)\\n\\t\\t\\t\\t\\t.flatMap((item) => item.data as T[])\\n\\t\\t\\t\\t\\t.sort((a, b) => (('sort' in a && a.sort) || 0) - (('sort' in b && b.sort) || 0));\\n\\n\\t\\t\\t\\tif (!list) {\\n\\t\\t\\t\\t\\treturn undefined;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tconst focusedIndex = list.findIndex((item) => item === focused);\\n\\n\\t\\t\\t\\treturn (focusedIndex < list.length - 1 ? list[focusedIndex + 1] : list[0]) as T;\\n\\t\\t\\t});\\n\\t\\t\\tevent.preventDefault();\\n\\t\\t\\tevent.stopImmediatePropagation();\\n\\t\\t\\treturn true;\\n\\t\\t}\\n\\t});\\n\\n\\tconst clearPopup = useMutableCallback(() => {\\n\\t\\tif (!popup) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tsetPopup(undefined);\\n\\t\\tsetFocused(undefined);\\n\\t\\tsetFilter('');\\n\\t});\\n\\n\\tconst callbackRef = useCallback(\\n\\t\\t(node: HTMLElement | null) => {\\n\\t\\t\\tif (!node) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tnode.addEventListener('keyup', keyup);\\n\\t\\t\\tnode.addEventListener('keydown', keydown);\\n\\t\\t\\tnode.addEventListener('focus', onFocus);\\n\\t\\t},\\n\\t\\t[keyup, keydown, onFocus],\\n\\t);\\n\\n\\tif (!popup) {\\n\\t\\treturn {\\n\\t\\t\\tcallbackRef,\\n\\t\\t\\tfocused: undefined,\\n\\t\\t\\titems: undefined,\\n\\t\\t\\tariaActiveDescendant: undefined,\\n\\t\\t\\tpopup: undefined,\\n\\t\\t\\tselect: undefined,\\n\\t\\t\\tsuspended: true,\\n\\t\\t\\tcommandsRef,\\n\\t\\t\\tfilter: undefined,\\n\\t\\t\\tclearPopup,\\n\\t\\t};\\n\\t}\\n\\n\\treturn {\\n\\t\\tfocused,\\n\\t\\titems,\\n\\t\\tariaActiveDescendant,\\n\\t\\tpopup,\\n\\t\\tselect,\\n\\t\\tfilter,\\n\\t\\tsuspended,\\n\\t\\tcommandsRef,\\n\\t\\tcallbackRef,\\n\\t\\tclearPopup,\\n\\t};\\n};\\n\",null],\"names\":[\"useMutableCallback\",\"useEffect\",\"useCallback\",\"useState\",\"useRef\",\"useChat\",\"useComposerBoxPopupQueries\",\"module\",\"export\",\"useComposerBoxPopup\",\"link\",\"v\",\"keys\",\"TAB\",\"ENTER\",\"ESC\",\"ARROW_UP\",\"ARROW_DOWN\",\"_ref\",\"configurations\",\"popup\",\"setPopup\",\"undefined\",\"focused\",\"setFocused\",\"filter\",\"setFilter\",\"commandsRef\",\"queries\",\"items\",\"suspended\",\"chat\",\"ariaActiveDescendant\",\"concat\",\"_id\",\"preview\",\"_sortedItems$find\",\"sortedItems\",\"item\",\"isSuccess\",\"flatMap\",\"data\",\"sort\",\"a\",\"b\",\"find\",\"select\",\"_commandsRef$current\",\"_chat$composer\",\"_chat$composer2\",\"_popup$matchSelectorR\",\"_chat$composer3\",\"_ref2\",\"_popup$prefix\",\"_popup$suffix\",\"_chat$composer4\",\"Error\",\"current\",\"value\",\"composer\",\"substring\",\"selection\",\"start\",\"selector\",\"matchSelectorRegex\",\"RegExp\",\"triggerAnywhere\",\"trigger\",\"result\",\"match\",\"replaceText\",\"prefix\",\"getValue\",\"suffix\",\"lastIndexOf\",\"end\",\"setConfigByInput\",\"_chat$composer5\",\"_chat$composer6\",\"_configuration$matchS\",\"_commandsRef$current$\",\"_commandsRef$current2\",\"_commandsRef$current3\",\"configuration\",\"_ref3\",\"triggerLength\",\"test\",\"length\",\"getFilter\",\"call\",\"onFocus\",\"keyup\",\"event\",\"closeOnEsc\",\"which\",\"preventDefault\",\"stopImmediatePropagation\",\"keydown\",\"shiftKey\",\"ctrlKey\",\"altKey\",\"metaKey\",\"list\",\"focusedIndex\",\"findIndex\",\"clearPopup\",\"callbackRef\",\"node\",\"addEventListener\"],\"mappings\":\"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\"}"}