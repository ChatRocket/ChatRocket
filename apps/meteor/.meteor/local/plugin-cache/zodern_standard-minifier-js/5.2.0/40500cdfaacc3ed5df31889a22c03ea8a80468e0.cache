{"code":"function module(e,n,t){t.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){o=e}},0),t.link(\"@rocket.chat/emitter\",{Emitter:function(e){i=e}},0),t.link(\"@rocket.chat/fuselage\",{Box:function(e){a=e},Menu:function(e){l=e},Icon:function(e){r=e}},1),t.link(\"@rocket.chat/fuselage-hooks\",{useUniqueId:function(e){c=e}},2),t.link(\"@rocket.chat/ui-contexts\",{useTranslation:function(e){u=e},useUserId:function(e){d=e}},3),t.link(\"react\",{default:function(e){s=e},memo:function(e){f=e},useEffect:function(e){m=e}},4),t.link(\"../../../../../../app/utils/client\",{getURL:function(e){k=e}},5),t.link(\"../../../../../lib/download\",{download:function(e){v=e},downloadAs:function(e){w=e}},6),t.link(\"../../../contexts/RoomContext\",{useRoom:function(e){p=e}},7),t.link(\"../hooks/useMessageDeletionIsAllowed\",{useMessageDeletionIsAllowed:function(e){g=e}},8);var o,i,a,l,r,c,u,d,s,f,m,k,v,w,p,g,h=new i;\"serviceWorker\"in navigator&&navigator.serviceWorker.addEventListener(\"message\",function(e){if(\"attachment-download-result\"===e.data.type){var n=e.data.result;h.emit(e.data.id,{result:n,id:e.data.id})}}),t.exportDefault(f(function(e){var n,t=e.fileData,i=e.onClickDelete,f=u(),b=p(),x=d(),D=g(b._id,t,x),E=!t.encryption||\"serviceWorker\"in navigator,I=((null===(n=navigator)||void 0===n?void 0:n.serviceWorker)||{}).controller,y=c();m(function(){return h.once(y,function(e){var n,o=e.result;w({data:[new Blob([o])]},null!==(n=t.name)&&void 0!==n?n:f(\"Download\"))})},[t,f,y]);var L=o({downLoad:{label:s.createElement(a,{display:\"flex\",alignItems:\"center\"},s.createElement(r,{mie:4,name:\"download\",size:\"x16\"}),f(\"Download\")),action:function(){var e;if(null!==(e=t.path)&&void 0!==e&&e.includes(\"/file-decrypt/\")){if(!I)return;null==I||I.postMessage({type:\"attachment-download\",url:t.path,id:y});return}if(t.url&&t.name){var n,o=null!==(n=window.webkitURL)&&void 0!==n?n:window.URL,i=k(t.url);v(i,t.name),o.revokeObjectURL(t.url)}},disabled:!E}},D&&i&&{delete:{label:s.createElement(a,{display:\"flex\",alignItems:\"center\",color:\"status-font-on-danger\"},s.createElement(r,{mie:4,name:\"trash\",size:\"x16\"}),f(\"Delete\")),action:function(){return i(t._id)}}});return s.createElement(l,{options:L})}))}","map":"{\"version\":3,\"sources\":[\"client/views/room/contextualBar/RoomFiles/components/FileItemMenu.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { IUpload } from '@rocket.chat/core-typings';\\nimport { Emitter } from '@rocket.chat/emitter';\\nimport { Box, Menu, Icon } from '@rocket.chat/fuselage';\\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\\nimport { useTranslation, useUserId } from '@rocket.chat/ui-contexts';\\nimport React, { memo, useEffect } from 'react';\\n\\nimport { getURL } from '../../../../../../app/utils/client';\\nimport { download, downloadAs } from '../../../../../lib/download';\\nimport { useRoom } from '../../../contexts/RoomContext';\\nimport { useMessageDeletionIsAllowed } from '../hooks/useMessageDeletionIsAllowed';\\n\\ntype FileItemMenuProps = {\\n\\tfileData: IUpload;\\n\\tonClickDelete: (id: IUpload['_id']) => void;\\n};\\n\\nconst ee = new Emitter<Record<string, { result: ArrayBuffer; id: string }>>();\\n\\nif ('serviceWorker' in navigator) {\\n\\tnavigator.serviceWorker.addEventListener('message', (event) => {\\n\\t\\tif (event.data.type === 'attachment-download-result') {\\n\\t\\t\\tconst { result } = event.data as { result: ArrayBuffer; id: string };\\n\\n\\t\\t\\tee.emit(event.data.id, { result, id: event.data.id });\\n\\t\\t}\\n\\t});\\n}\\n\\nconst FileItemMenu = ({ fileData, onClickDelete }: FileItemMenuProps) => {\\n\\tconst t = useTranslation();\\n\\tconst room = useRoom();\\n\\tconst userId = useUserId();\\n\\tconst isDeletionAllowed = useMessageDeletionIsAllowed(room._id, fileData, userId);\\n\\tconst canDownloadFile = !fileData.encryption || 'serviceWorker' in navigator;\\n\\n\\tconst { controller } = navigator?.serviceWorker || {};\\n\\n\\tconst uid = useUniqueId();\\n\\n\\tuseEffect(\\n\\t\\t() =>\\n\\t\\t\\tee.once(uid, ({ result }) => {\\n\\t\\t\\t\\tdownloadAs({ data: [new Blob([result])] }, fileData.name ?? t('Download'));\\n\\t\\t\\t}),\\n\\t\\t[fileData, t, uid],\\n\\t);\\n\\n\\tconst menuOptions = {\\n\\t\\tdownLoad: {\\n\\t\\t\\tlabel: (\\n\\t\\t\\t\\t<Box display='flex' alignItems='center'>\\n\\t\\t\\t\\t\\t<Icon mie={4} name='download' size='x16' />\\n\\t\\t\\t\\t\\t{t('Download')}\\n\\t\\t\\t\\t</Box>\\n\\t\\t\\t),\\n\\t\\t\\taction: () => {\\n\\t\\t\\t\\tif (fileData.path?.includes('/file-decrypt/')) {\\n\\t\\t\\t\\t\\tif (!controller) {\\n\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tcontroller?.postMessage({\\n\\t\\t\\t\\t\\t\\ttype: 'attachment-download',\\n\\t\\t\\t\\t\\t\\turl: fileData.path,\\n\\t\\t\\t\\t\\t\\tid: uid,\\n\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (fileData.url && fileData.name) {\\n\\t\\t\\t\\t\\tconst URL = window.webkitURL ?? window.URL;\\n\\t\\t\\t\\t\\tconst href = getURL(fileData.url);\\n\\t\\t\\t\\t\\tdownload(href, fileData.name);\\n\\t\\t\\t\\t\\tURL.revokeObjectURL(fileData.url);\\n\\t\\t\\t\\t}\\n\\t\\t\\t},\\n\\t\\t\\tdisabled: !canDownloadFile,\\n\\t\\t},\\n\\t\\t...(isDeletionAllowed &&\\n\\t\\t\\tonClickDelete && {\\n\\t\\t\\t\\tdelete: {\\n\\t\\t\\t\\t\\tlabel: (\\n\\t\\t\\t\\t\\t\\t<Box display='flex' alignItems='center' color='status-font-on-danger'>\\n\\t\\t\\t\\t\\t\\t\\t<Icon mie={4} name='trash' size='x16' />\\n\\t\\t\\t\\t\\t\\t\\t{t('Delete')}\\n\\t\\t\\t\\t\\t\\t</Box>\\n\\t\\t\\t\\t\\t),\\n\\t\\t\\t\\t\\taction: () => onClickDelete(fileData._id),\\n\\t\\t\\t\\t},\\n\\t\\t\\t}),\\n\\t};\\n\\n\\treturn <Menu options={menuOptions} />;\\n};\\n\\nexport default memo(FileItemMenu);\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_objectSpread\",\"Emitter\",\"Box\",\"Menu\",\"Icon\",\"useUniqueId\",\"useTranslation\",\"useUserId\",\"React\",\"memo\",\"useEffect\",\"getURL\",\"download\",\"downloadAs\",\"useRoom\",\"useMessageDeletionIsAllowed\",\"ee\",\"navigator\",\"serviceWorker\",\"addEventListener\",\"event\",\"data\",\"type\",\"result\",\"emit\",\"id\",\"exportDefault\",\"_ref\",\"_navigator\",\"fileData\",\"onClickDelete\",\"t\",\"room\",\"userId\",\"isDeletionAllowed\",\"_id\",\"canDownloadFile\",\"encryption\",\"controller\",\"_ref2\",\"uid\",\"once\",\"_ref3\",\"_fileData$name\",\"Blob\",\"name\",\"menuOptions\",\"downLoad\",\"label\",\"createElement\",\"display\",\"alignItems\",\"mie\",\"size\",\"action\",\"_fileData$path\",\"path\",\"includes\",\"postMessage\",\"url\",\"_window$webkitURL\",\"URL\",\"window\",\"webkitURL\",\"href\",\"revokeObjectURL\",\"disabled\",\"color\",\"options\"],\"mappings\":\"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\"}"}