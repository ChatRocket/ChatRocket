{"code":"function module(n,e,o){var t,i,r,c,a,s,l,u,p,f,m,d,g;o.link(\"meteor/meteor\",{Meteor:function(n){t=n}},0),o.link(\"meteor/tracker\",{Tracker:function(n){i=n}},1),o.link(\"../../app/authorization/client\",{hasRole:function(n){r=n}},2),o.link(\"../../app/models/client\",{Roles:function(n){c=n}},3),o.link(\"../../app/settings/client\",{settings:function(n){a=n}},4),o.link(\"../../app/utils/client/lib/SDKClient\",{sdk:function(n){s=n}},5),o.link(\"../../app/utils/lib/i18n\",{t:function(n){l=n}},6),o.link(\"../components/FingerprintChangeModal\",{default:function(n){u=n}},7),o.link(\"../components/FingerprintChangeModalConfirmation\",{default:function(n){p=n}},8),o.link(\"../components/UrlChangeModal\",{default:function(n){f=n}},9),o.link(\"../lib/imperativeModal\",{imperativeModal:function(n){m=n}},10),o.link(\"../lib/toast\",{dispatchToastMessage:function(n){d=n}},11),o.link(\"../lib/userData\",{isSyncReady:function(n){g=n}},12),t.startup(function(){i.autorun(function(n){var e=t.userId();if(e&&c.ready.get()&&g.get()){if(!1===r(e,\"admin\"))return n.stop();var o=a.get(\"Site_Url\");if(o){var i=location.origin+window.__meteor_runtime_config__.ROOT_URL_PATH_PREFIX;window.__meteor_runtime_config__.ROOT_URL.replace(/\\/$/,\"\")!==i&&m.open({component:f,props:{onConfirm:function(){m.close(),s.call(\"saveSetting\",\"Site_Url\",i).then(function(){d({type:\"success\",message:l(\"Saved\")})})},siteUrl:o,currentUrl:i,onClose:m.close}});var u=a.get(\"Document_Domain\");return u&&(window.document.domain=u),n.stop()}}})}),t.startup(function(){i.autorun(function(n){var e=t.userId();if(e&&c.ready.get()&&g.get()){if(!1===r(e,\"admin\"))return n.stop();var o=a.get(\"Deployment_FingerPrint_Verified\");if(null!=o&&!0!==o){var i=function(){m.close(),s.rest.post(\"/v1/fingerprint\",{setDeploymentAs:\"updated-configuration\"}).then(function(){d({type:\"success\",message:l(\"Configuration_update_confirmed\")})})},f=function(){m.close(),s.rest.post(\"/v1/fingerprint\",{setDeploymentAs:\"new-workspace\"}).then(function(){d({type:\"success\",message:l(\"New_workspace_confirmed\")})})},_=function(){m.open({component:u,props:{onConfirm:function(){m.open({component:p,props:{onConfirm:f,onCancel:_,newWorkspace:!0}})},onCancel:function(){m.open({component:p,props:{onConfirm:i,onCancel:_,newWorkspace:!1}})},onClose:m.close}})};return _(),n.stop()}}})})}","map":"{\"version\":3,\"sources\":[\"client/startup/rootUrlChange.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { hasRole } from '../../app/authorization/client';\\nimport { Roles } from '../../app/models/client';\\nimport { settings } from '../../app/settings/client';\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\nimport { t } from '../../app/utils/lib/i18n';\\nimport FingerprintChangeModal from '../components/FingerprintChangeModal';\\nimport FingerprintChangeModalConfirmation from '../components/FingerprintChangeModalConfirmation';\\nimport UrlChangeModal from '../components/UrlChangeModal';\\nimport { imperativeModal } from '../lib/imperativeModal';\\nimport { dispatchToastMessage } from '../lib/toast';\\nimport { isSyncReady } from '../lib/userData';\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun((c) => {\\n\\t\\tconst userId = Meteor.userId();\\n\\t\\tif (!userId) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tif (!Roles.ready.get() || !isSyncReady.get()) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tif (hasRole(userId, 'admin') === false) {\\n\\t\\t\\treturn c.stop();\\n\\t\\t}\\n\\n\\t\\tconst siteUrl = settings.get('Site_Url');\\n\\t\\tif (!siteUrl) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst currentUrl = location.origin + window.__meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\\n\\t\\tif (window.__meteor_runtime_config__.ROOT_URL.replace(/\\\\/$/, '') !== currentUrl) {\\n\\t\\t\\tconst confirm = (): void => {\\n\\t\\t\\t\\timperativeModal.close();\\n\\t\\t\\t\\tvoid sdk.call('saveSetting', 'Site_Url', currentUrl).then(() => {\\n\\t\\t\\t\\t\\tdispatchToastMessage({ type: 'success', message: t('Saved') });\\n\\t\\t\\t\\t});\\n\\t\\t\\t};\\n\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\tcomponent: UrlChangeModal,\\n\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\tonConfirm: confirm,\\n\\t\\t\\t\\t\\tsiteUrl,\\n\\t\\t\\t\\t\\tcurrentUrl,\\n\\t\\t\\t\\t\\tonClose: imperativeModal.close,\\n\\t\\t\\t\\t},\\n\\t\\t\\t});\\n\\t\\t}\\n\\n\\t\\tconst documentDomain = settings.get('Document_Domain');\\n\\t\\tif (documentDomain) {\\n\\t\\t\\twindow.document.domain = documentDomain;\\n\\t\\t}\\n\\n\\t\\treturn c.stop();\\n\\t});\\n});\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun((c) => {\\n\\t\\tconst userId = Meteor.userId();\\n\\t\\tif (!userId) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tif (!Roles.ready.get() || !isSyncReady.get()) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tif (hasRole(userId, 'admin') === false) {\\n\\t\\t\\treturn c.stop();\\n\\t\\t}\\n\\n\\t\\tconst deploymentFingerPrintVerified = settings.get('Deployment_FingerPrint_Verified');\\n\\t\\tif (deploymentFingerPrintVerified == null || deploymentFingerPrintVerified === true) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst updateWorkspace = (): void => {\\n\\t\\t\\timperativeModal.close();\\n\\t\\t\\tvoid sdk.rest.post('/v1/fingerprint', { setDeploymentAs: 'updated-configuration' }).then(() => {\\n\\t\\t\\t\\tdispatchToastMessage({ type: 'success', message: t('Configuration_update_confirmed') });\\n\\t\\t\\t});\\n\\t\\t};\\n\\n\\t\\tconst setNewWorkspace = (): void => {\\n\\t\\t\\timperativeModal.close();\\n\\t\\t\\tvoid sdk.rest.post('/v1/fingerprint', { setDeploymentAs: 'new-workspace' }).then(() => {\\n\\t\\t\\t\\tdispatchToastMessage({ type: 'success', message: t('New_workspace_confirmed') });\\n\\t\\t\\t});\\n\\t\\t};\\n\\n\\t\\tconst openModal = (): void => {\\n\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\tcomponent: FingerprintChangeModal,\\n\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\tonConfirm: () => {\\n\\t\\t\\t\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\t\\t\\t\\tcomponent: FingerprintChangeModalConfirmation,\\n\\t\\t\\t\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\t\\t\\t\\tonConfirm: setNewWorkspace,\\n\\t\\t\\t\\t\\t\\t\\t\\tonCancel: openModal,\\n\\t\\t\\t\\t\\t\\t\\t\\tnewWorkspace: true,\\n\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\tonCancel: () => {\\n\\t\\t\\t\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\t\\t\\t\\tcomponent: FingerprintChangeModalConfirmation,\\n\\t\\t\\t\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\t\\t\\t\\tonConfirm: updateWorkspace,\\n\\t\\t\\t\\t\\t\\t\\t\\tonCancel: openModal,\\n\\t\\t\\t\\t\\t\\t\\t\\tnewWorkspace: false,\\n\\t\\t\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\tonClose: imperativeModal.close,\\n\\t\\t\\t\\t},\\n\\t\\t\\t});\\n\\t\\t};\\n\\n\\t\\topenModal();\\n\\n\\t\\treturn c.stop();\\n\\t});\\n});\\n\",null],\"names\":[\"Meteor\",\"Tracker\",\"hasRole\",\"Roles\",\"settings\",\"sdk\",\"t\",\"FingerprintChangeModal\",\"FingerprintChangeModalConfirmation\",\"UrlChangeModal\",\"imperativeModal\",\"dispatchToastMessage\",\"isSyncReady\",\"module\",\"link\",\"v\",\"startup\",\"autorun\",\"c\",\"userId\",\"ready\",\"get\",\"stop\",\"siteUrl\",\"currentUrl\",\"location\",\"origin\",\"window\",\"__meteor_runtime_config__\",\"ROOT_URL_PATH_PREFIX\",\"ROOT_URL\",\"replace\",\"open\",\"component\",\"props\",\"onConfirm\",\"close\",\"call\",\"then\",\"type\",\"message\",\"onClose\",\"documentDomain\",\"document\",\"domain\",\"deploymentFingerPrintVerified\",\"updateWorkspace\",\"rest\",\"post\",\"setDeploymentAs\",\"setNewWorkspace\",\"openModal\",\"onCancel\",\"newWorkspace\"],\"mappings\":\"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\"}"}