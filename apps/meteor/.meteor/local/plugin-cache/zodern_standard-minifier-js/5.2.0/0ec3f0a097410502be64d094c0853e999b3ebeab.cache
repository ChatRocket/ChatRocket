{"code":"function module(n,e,t){t.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(n){i=n}},0),t.export({useLicenseBase:function(){return m},useLicense:function(){return v},useHasLicense:function(){return d},useLicenseName:function(){return p},useInvalidateLicense:function(){return k}}),t.link(\"@rocket.chat/ui-contexts\",{useEndpoint:function(n){r=n},useStream:function(n){c=n},useUserId:function(n){s=n}},0),t.link(\"@tanstack/react-query\",{useQuery:function(n){o=n},useQueryClient:function(n){a=n}},1),t.link(\"react\",{useEffect:function(n){f=n}},2);var u,i,r,c,s,o,a,f,l=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;clearTimeout(u),u=setTimeout(function(){u=void 0,n.invalidateQueries([\"licenses\"])},e)},m=function(n){var e=n.params,t=n.select,u=s(),a=r(\"GET\",\"/v1/licenses.info\"),l=k(),m=c(\"notify-all\");return f(function(){return m(\"license\",function(){return l()})},[m,l]),o([\"licenses\",\"getLicenses\",e],function(){return a(i({},e))},{staleTime:1/0,keepPreviousData:!0,select:t,enabled:!!u})},v=function(n){return m({params:n,select:function(n){return n.license}})},d=function(){return m({select:function(n){return!!n.license}})},p=function(n){return m({params:n,select:function(n){var e;return(null==n?void 0:null===(e=n.license.tags)||void 0===e?void 0:e.map(function(n){return n.name}).join(\" \"))||\"Community\"}})},k=function(){var n=a();return function(e){return l(n,e)}}}","map":"{\"version\":3,\"sources\":[\"client/hooks/useLicense.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { Serialized } from '@rocket.chat/core-typings';\\nimport type { OperationResult } from '@rocket.chat/rest-typings';\\nimport { useEndpoint, useStream, useUserId } from '@rocket.chat/ui-contexts';\\nimport type { QueryClient, UseQueryResult } from '@tanstack/react-query';\\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\\nimport { useEffect } from 'react';\\n\\ntype LicenseDataType = Serialized<Awaited<OperationResult<'GET', '/v1/licenses.info'>>>;\\n\\ntype LicenseParams = {\\n\\tloadValues?: boolean;\\n};\\n\\nconst invalidateQueryClientLicenses = (() => {\\n\\tlet timeout: ReturnType<typeof setTimeout> | undefined;\\n\\n\\treturn (queryClient: QueryClient, milliseconds = 5000) => {\\n\\t\\tclearTimeout(timeout);\\n\\t\\ttimeout = setTimeout(() => {\\n\\t\\t\\ttimeout = undefined;\\n\\t\\t\\tqueryClient.invalidateQueries(['licenses']);\\n\\t\\t}, milliseconds);\\n\\t};\\n})();\\n\\nexport const useLicenseBase = <TData = LicenseDataType>({\\n\\tparams,\\n\\tselect,\\n}: {\\n\\tparams?: LicenseParams;\\n\\tselect: (data: LicenseDataType) => TData;\\n}) => {\\n\\tconst uid = useUserId();\\n\\n\\tconst getLicenses = useEndpoint('GET', '/v1/licenses.info');\\n\\n\\tconst invalidateQueries = useInvalidateLicense();\\n\\n\\tconst notify = useStream('notify-all');\\n\\n\\tuseEffect(() => notify('license', () => invalidateQueries()), [notify, invalidateQueries]);\\n\\n\\treturn useQuery(['licenses', 'getLicenses', params], () => getLicenses({ ...params }), {\\n\\t\\tstaleTime: Infinity,\\n\\t\\tkeepPreviousData: true,\\n\\t\\tselect,\\n\\t\\tenabled: !!uid,\\n\\t});\\n};\\n\\nexport const useLicense = (params?: LicenseParams) => {\\n\\treturn useLicenseBase({ params, select: (data) => data.license });\\n};\\n\\nexport const useHasLicense = (): UseQueryResult<boolean> => {\\n\\treturn useLicenseBase({ select: (data) => Boolean(data.license) });\\n};\\n\\nexport const useLicenseName = (params?: LicenseParams) => {\\n\\treturn useLicenseBase({ params, select: (data) => data?.license.tags?.map((tag) => tag.name).join(' ') || 'Community' });\\n};\\n\\nexport const useInvalidateLicense = () => {\\n\\tconst queryClient = useQueryClient();\\n\\treturn (milliseconds?: number) => invalidateQueryClientLicenses(queryClient, milliseconds);\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_objectSpread\",\"export\",\"useLicenseBase\",\"useLicense\",\"useHasLicense\",\"useLicenseName\",\"useInvalidateLicense\",\"useEndpoint\",\"useStream\",\"useUserId\",\"useQuery\",\"useQueryClient\",\"useEffect\",\"timeout\",\"invalidateQueryClientLicenses\",\"queryClient\",\"milliseconds\",\"arguments\",\"length\",\"undefined\",\"clearTimeout\",\"setTimeout\",\"invalidateQueries\",\"_ref\",\"params\",\"select\",\"uid\",\"getLicenses\",\"notify\",\"staleTime\",\"Infinity\",\"keepPreviousData\",\"enabled\",\"data\",\"license\",\"Boolean\",\"_data$license$tags\",\"tags\",\"map\",\"tag\",\"name\",\"join\"],\"mappings\":\"uBAESA,EAAaC,IAAA,CAAA,uCAA4B,CAAAC,QAA2B,SAAAC,CAAA,EAAAC,EAAAD,CAAA,CAAA,EAAA,GAA7EH,EAAOK,MAAE,CAAA,CAAAC,eAAa,WAAW,OAAWA,CAAM,EAAAC,WAAA,WAA2B,OAAAA,CAAA,EAAAC,cAAA,WAAA,OAAAA,CAAA,EAAAC,eAAA,WAAA,OAAAA,CAAA,EAAAC,qBAAA,WAAA,OAAAA,CAAA,CAAA,GAAAV,EAAAC,IAAA,CAAA,2BAAA,CAAAU,YAAA,SAAAR,CAAA,EAAAQ,EAAAR,CAAA,EAAAS,UAAA,SAAAT,CAAA,EAAAS,EAAAT,CAAA,EAAAU,UAAA,SAAAV,CAAA,EAAAU,EAAAV,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,wBAAA,CAAAa,SAAA,SAAAX,CAAA,EAAAW,EAAAX,CAAA,EAAAY,eAAA,SAAAZ,CAAA,EAAAY,EAAAZ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,QAAA,CAAAe,UAAA,SAAAb,CAAA,EAAAa,EAAAb,CAAA,CAAA,EAAA,GAW7E,IACKc,EAZLb,EAA6EO,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAWvEE,EAGE,SAACC,CAAwB,EAAyB,IAAvBC,EAAYC,UAAAC,MAAA,CAAA,GAAAD,AAAAE,KAAAA,IAAAF,SAAA,CAAA,EAAA,CAAAA,SAAA,CAAA,EAAA,CAAG,IAChDG,aAAaP,GACbA,EAAUQ,WAAW,WACpBR,EAAUM,KAAAA,EACVJ,EAAYO,iBAAiB,CAAC,CAAC,WAAW,CAC3C,EAAGN,EACJ,EAGYd,EAAiB,SAAAqB,CAAA,EAMzB,IALJC,EAAMD,EAANC,MAAM,CACNC,EAAMF,EAANE,MAAM,CAKAC,EAAMjB,IAENkB,EAAcpB,EAAY,MAAO,qBAEjCe,EAAoBhB,IAEpBsB,EAASpB,EAAU,cAIzB,OAFAI,EAAU,WAAA,OAAMgB,EAAO,UAAW,WAAA,OAAMN,GAAmB,EAAC,EAAE,CAACM,EAAQN,EAAkB,EAElFZ,EAAS,CAAC,WAAY,cAAec,EAAO,CAAE,WAAA,OAAMG,EAAW3B,EAAA,CAAA,EAAMwB,GAAS,EAAE,CACtFK,UAAWC,IACXC,iBAAkB,CAAA,EAClBN,OAAAA,EACAO,QAAS,CAAC,CAACN,GAEb,EAEavB,EAAa,SAACqB,CAAsB,EAChD,OAAOtB,EAAe,CAAEsB,OAAAA,EAAQC,OAAQ,SAACQ,CAAI,EAAA,OAAKA,EAAKC,OAAO,CAAA,EAC/D,EAEa9B,EAAgB,WAC5B,OAAOF,EAAe,CAAEuB,OAAQ,SAACQ,CAAI,EAAA,MAAKE,CAAAA,CAAQF,EAAKC,OAAO,AAAC,CAAA,EAChE,EAEa7B,EAAiB,SAACmB,CAAsB,EACpD,OAAOtB,EAAe,CAAEsB,OAAAA,EAAQC,OAAQ,SAACQ,CAAI,EAAA,IAAAG,EAAA,MAAK,AAAAH,CAAAA,MAAAA,EAAI,KAAA,EAAA,AAAc,OAAdG,CAAAA,EAAJH,EAAMC,OAAO,CAACG,IAAI,AAAJA,GAAID,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAlBA,EAAoBE,GAAG,CAAC,SAACC,CAAG,EAAA,OAAKA,EAAIC,IAAI,GAAEC,IAAI,CAAC,IAAG,GAAK,WAAW,CAAA,EACtH,EAEanC,EAAuB,WACnC,IAAMS,EAAcJ,IACpB,OAAO,SAACK,CAAqB,EAAA,OAAKF,EAA8BC,EAAaC,EAAa,CAC3F\"}"}