{"code":"function module(e,n,o){o.link(\"@babel/runtime/regenerator\",{default:function(e){t=e}},0),o.export({openCASLoginPopup:function(){return s}}),o.link(\"meteor/meteor\",{Meteor:function(e){r=e}},0),o.link(\"../../app/settings/client\",{settings:function(e){i=e}},1);var t,r,i,u=function(e,n,o){var t,r,i,u,l=null!==(t=window.screenX)&&void 0!==t?t:window.screenLeft,c=null!==(r=window.screenY)&&void 0!==r?r:window.screenTop,s=null!==(i=window.outerWidth)&&void 0!==i?i:document.body.clientWidth,a=null!==(u=window.outerHeight)&&void 0!==u?u:document.body.clientHeight-22,d=window.open(e,\"Login\",\"width=\"+n+\",height=\"+o+\",left=\"+(l+(s-n)/2)+\",top=\"+(c+(a-o)/2)+\",scrollbars=yes\");if(!d)throw Error(\"Could not open popup\");return d.focus(),d},l=function(e){var n=i.get(\"CAS_login_url\");if(!n)throw Error(\"CAS_login_url not set\");var o=r.absoluteUrl().replace(/\\/$/,\"\")+__meteor_runtime_config__.ROOT_URL_PATH_PREFIX,t=new URL(n);return t.searchParams.set(\"service\",o+\"/_cas/\"+e),t.href},c=function(e){return new Promise(function(n){var o=setInterval(function(){(e.closed||void 0===e.closed)&&(clearInterval(o),n())},100)})},s=function(e){var n,o,r;return t.async(function(s){for(;;)switch(s.prev=s.next){case 0:return n=i.get(\"CAS_popup_width\")||800,o=i.get(\"CAS_popup_height\")||600,r=u(l(e),n,o),s.next=6,t.awrap(c(r));case 6:case\"end\":return s.stop()}},null,null,null,Promise)}}","map":"{\"version\":3,\"sources\":[\"client/lib/openCASLoginPopup.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\n\\nimport { settings } from '../../app/settings/client';\\n\\nconst openCenteredPopup = (url: string, width: number, height: number) => {\\n\\tconst screenX = window.screenX ?? window.screenLeft;\\n\\tconst screenY = window.screenY ?? window.screenTop;\\n\\tconst outerWidth = window.outerWidth ?? document.body.clientWidth;\\n\\tconst outerHeight = window.outerHeight ?? document.body.clientHeight - 22;\\n\\t// XXX what is the 22? Probably the height of the title bar.\\n\\t// Use `outerWidth - width` and `outerHeight - height` for help in\\n\\t// positioning the popup centered relative to the current window\\n\\tconst left = screenX + (outerWidth - width) / 2;\\n\\tconst top = screenY + (outerHeight - height) / 2;\\n\\tconst features = `width=${width},height=${height},left=${left},top=${top},scrollbars=yes`;\\n\\n\\tconst newwindow = window.open(url, 'Login', features);\\n\\n\\tif (!newwindow) {\\n\\t\\tthrow new Error('Could not open popup');\\n\\t}\\n\\n\\tnewwindow.focus();\\n\\n\\treturn newwindow;\\n};\\n\\nconst getPopupUrl = (credentialToken: string): string => {\\n\\tconst loginUrl = settings.get<string | undefined>('CAS_login_url');\\n\\n\\tif (!loginUrl) {\\n\\t\\tthrow new Error('CAS_login_url not set');\\n\\t}\\n\\n\\tconst appUrl = Meteor.absoluteUrl().replace(/\\\\/$/, '') + __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\\n\\tconst serviceUrl = `${appUrl}/_cas/${credentialToken}`;\\n\\tconst url = new URL(loginUrl);\\n\\turl.searchParams.set('service', serviceUrl);\\n\\n\\treturn url.href;\\n};\\n\\nconst waitForPopupClose = (popup: Window) => {\\n\\treturn new Promise<void>((resolve) => {\\n\\t\\tconst checkPopupOpen = setInterval(() => {\\n\\t\\t\\tif (popup.closed || popup.closed === undefined) {\\n\\t\\t\\t\\tclearInterval(checkPopupOpen);\\n\\t\\t\\t\\tresolve();\\n\\t\\t\\t}\\n\\t\\t}, 100);\\n\\t});\\n};\\n\\nexport const openCASLoginPopup = async (credentialToken: string) => {\\n\\tconst popupWidth = settings.get<number>('CAS_popup_width') || 800;\\n\\tconst popupHeight = settings.get<number>('CAS_popup_height') || 600;\\n\\n\\tconst popupUrl = getPopupUrl(credentialToken);\\n\\tconst popup = openCenteredPopup(popupUrl, popupWidth, popupHeight);\\n\\n\\tawait waitForPopupClose(popup);\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"export\",\"openCASLoginPopup\",\"Meteor\",\"settings\",\"openCenteredPopup\",\"url\",\"width\",\"height\",\"_window$screenX\",\"_window$screenY\",\"_window$outerWidth\",\"_window$outerHeight\",\"screenX\",\"window\",\"screenLeft\",\"screenY\",\"screenTop\",\"outerWidth\",\"document\",\"body\",\"clientWidth\",\"outerHeight\",\"clientHeight\",\"newwindow\",\"open\",\"Error\",\"focus\",\"getPopupUrl\",\"credentialToken\",\"loginUrl\",\"get\",\"appUrl\",\"absoluteUrl\",\"replace\",\"__meteor_runtime_config__\",\"ROOT_URL_PATH_PREFIX\",\"URL\",\"searchParams\",\"set\",\"href\",\"waitForPopupClose\",\"popup\",\"Promise\",\"resolve\",\"checkPopupOpen\",\"setInterval\",\"closed\",\"undefined\",\"clearInterval\",\"popupWidth\",\"popupHeight\",\"async\",\"_context\",\"prev\",\"next\",\"awrap\",\"stop\"],\"mappings\":\"uBAAuBA,EAAAC,IAAA,CAAA,6BAAgB,CAAAC,QAAA,SAAAC,CAAA,EAAAC,EAAAD,CAAA,CAAA,EAAA,GAAvCH,EAAOK,MAAE,CAAA,CAAMC,kBAAQ,WAAgB,OAAAA,CAAA,CAAA,GAAAN,EAAAC,IAAA,CAAA,gBAAA,CAAAM,OAAA,SAAAJ,CAAA,EAAAI,EAAAJ,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,4BAAA,CAAAO,SAAA,SAAAL,CAAA,EAAAK,EAAAL,CAAA,CAAA,EAAA,GAIvC,IAJAC,EAAuCG,EAAAC,EAIjCC,EAAoB,SAACC,CAAW,CAAEC,CAAa,CAAEC,CAAc,EACpE,IADwEC,EAAAC,EAAAC,EAAAC,EAClEC,EAAO,AAAiB,OAAjBJ,CAAAA,EAAGK,OAAOD,OAAO,AAAPA,GAAOJ,AAAA,KAAA,IAAAA,EAAAA,EAAIK,OAAOC,UAAU,CAC7CC,EAAO,AAAiB,OAAjBN,CAAAA,EAAGI,OAAOE,OAAO,AAAPA,GAAON,AAAA,KAAA,IAAAA,EAAAA,EAAII,OAAOG,SAAS,CAC5CC,EAAU,AAAoB,OAApBP,CAAAA,EAAGG,OAAOI,UAAU,AAAVA,GAAUP,AAAA,KAAA,IAAAA,EAAAA,EAAIQ,SAASC,IAAI,CAACC,WAAW,CAC3DC,EAAW,AAAqB,OAArBV,CAAAA,EAAGE,OAAOQ,WAAW,AAAXA,GAAWV,AAAA,KAAA,IAAAA,EAAAA,EAAIO,SAASC,IAAI,CAACG,YAAY,CAAG,GAQjEC,EAAYV,OAAOW,IAAI,CAACnB,EAAK,QAFrB,SAAYC,EAAK,WAAWC,EAAM,SAFnCK,CAAAA,EAAU,AAACK,CAAAA,EAAaX,CAAAA,EAAS,CAAA,EAEe,QADjDS,CAAAA,EAAU,AAACM,CAAAA,EAAcd,CAAAA,EAAU,CAAA,EACyB,mBAIxE,GAAI,CAACgB,EACJ,MAAM,AAAIE,MAAM,wBAKjB,OAFAF,EAAUG,KAAK,GAERH,CACR,EAEMI,EAAc,SAACC,CAAuB,EAC3C,IAAMC,EAAW1B,EAAS2B,GAAG,CAAqB,iBAElD,GAAI,CAACD,EACJ,MAAM,AAAIJ,MAAM,yBAGjB,IAAMM,EAAS7B,EAAO8B,WAAW,GAAGC,OAAO,CAAC,MAAO,IAAMC,0BAA0BC,oBAAoB,CAEjG9B,EAAM,IAAI+B,IAAIP,GAGpB,OAFAxB,EAAIgC,YAAY,CAACC,GAAG,CAAC,UAFCP,EAAM,SAASH,GAI9BvB,EAAIkC,IAAI,AAChB,EAEMC,EAAoB,SAACC,CAAa,EACvC,OAAO,IAAIC,QAAc,SAACC,CAAO,EAChC,IAAMC,EAAiBC,YAAY,WAC9BJ,CAAAA,EAAMK,MAAM,EAAIL,AAAiBM,KAAAA,IAAjBN,EAAMK,MAAM,AAAKC,IACpCC,cAAcJ,GACdD,IAEF,EAAG,IACJ,EACD,EAEa1C,EAAoB,SAAO2B,CAAuB,EAAA,IAAAqB,EAAAC,EAAAT,EAAA,OAAA1C,EAAAoD,KAAA,CAAA,SAAAC,CAAA,EAAA,OAAA,OAAAA,EAAAC,IAAA,CAAAD,EAAAE,IAAA,EAAA,KAAA,EAKI,OAJ5DL,EAAa9C,EAAS2B,GAAG,CAAS,oBAAsB,IACxDoB,EAAc/C,EAAS2B,GAAG,CAAS,qBAAuB,IAG1DW,EAAQrC,EADGuB,EAAYC,GACaqB,EAAYC,GAAYE,EAAAE,IAAA,CAAA,EAAAvD,EAAAwD,KAAA,CAE5Df,EAAkBC,GAAM,MAAA,EAAA,IAAA,MAAA,OAAAW,EAAAI,IAAA,EAAA,CAAA,EAAA,KAAA,KAAA,KAAAd,QAAA\"}"}