{"code":"function module(e,t,i){let n,s,l,a,o,r,d,c,u,p,f,m,k,y,h,v;i.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){n=e}},0),i.link(\"@babel/runtime/helpers/asyncIterator\",{default(e){s=e}},1),i.export({useFilesList:()=>g}),i.link(\"@rocket.chat/base64\",{Base64(e){l=e}},0),i.link(\"@rocket.chat/ui-contexts\",{useUserRoom(e){a=e},useUserId(e){o=e},useEndpoint(e){r=e}},1),i.link(\"react\",{useCallback(e){d=e},useEffect(e){c=e},useMemo(e){u=e},useState(e){p=e}},2),i.link(\"../../../../../../app/e2e/client/rocketchat.e2e\",{e2e(e){f=e}},3),i.link(\"../../../../../hooks/lists/useScrollableRecordList\",{useScrollableRecordList(e){m=e}},4),i.link(\"../../../../../hooks/lists/useStreamUpdatesForMessageList\",{useStreamUpdatesForMessageList(e){k=e}},5),i.link(\"../../../../../hooks/useComponentDidUpdate\",{useComponentDidUpdate(e){y=e}},6),i.link(\"../../../../../lib/lists/FilesList\",{FilesList(e){h=e}},7),i.link(\"../../../../../lib/utils/getConfig\",{getConfig(e){v=e}},8);let g=e=>{let[t,i]=p(()=>new h(e)),g=d(()=>i(new h(e)),[e]),b=a(e.rid),w=o();y(()=>{e&&g()},[e,g]),c(()=>{t.options!==e&&t.updateFilters(e)},[t,e]);let C=b?({c:\"/v1/channels.files\",l:\"/v1/channels.files\",v:\"/v1/channels.files\",d:\"/v1/im.files\",p:\"/v1/groups.files\"})[b.t]:\"/v1/channels.files\",S=r(\"GET\",C),L=d(async(t,i)=>{let{files:a,total:o}=await S(n(n({roomId:e.rid,offset:t,count:i,sort:JSON.stringify({uploadedAt:-1})},e.text?{name:e.text}:{}),\"all\"!==e.type&&{typeGroup:e.type})),r=a.map(e=>n(n({},e),{},{uploadedAt:e.uploadedAt?new Date(e.uploadedAt):void 0,modifiedAt:e.modifiedAt?new Date(e.modifiedAt):void 0}));var d=!1,c=!1;try{for(var u,p,m=s(r);d=!(p=await m.next()).done;d=!1){let e=p.value;if(e.rid&&e.content){let t=await f.getInstanceByRoomId(e.rid);if(null!=t&&t.shouldConvertReceivedMessages()){let t=await f.decryptFileContent(e),i=l.encode(JSON.stringify(n(n({},t.encryption),{},{name:String.fromCharCode(...new TextEncoder().encode(t.name)),type:t.type})));t.path=\"/file-decrypt\".concat(t.path,\"?key=\").concat(i),Object.assign(e,t)}}}}catch(e){c=!0,u=e}finally{try{d&&null!=m.return&&await m.return()}finally{if(c)throw u}}return{items:r,itemCount:o}},[S,e.rid,e.type,e.text]),{loadMoreItems:x,initialItemCount:A}=m(t,L,u(()=>parseInt(\"\".concat(v(\"discussionListSize\",10))),[]));return k(t,w,e.rid||null),{reload:g,filesList:t,loadMoreItems:x,initialItemCount:A}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/contextualBar/RoomFiles/hooks/useFilesList.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Base64 } from '@rocket.chat/base64';\\nimport { useUserRoom, useUserId, useEndpoint } from '@rocket.chat/ui-contexts';\\nimport { useCallback, useEffect, useMemo, useState } from 'react';\\n\\nimport { e2e } from '../../../../../../app/e2e/client/rocketchat.e2e';\\nimport { useScrollableRecordList } from '../../../../../hooks/lists/useScrollableRecordList';\\nimport { useStreamUpdatesForMessageList } from '../../../../../hooks/lists/useStreamUpdatesForMessageList';\\nimport { useComponentDidUpdate } from '../../../../../hooks/useComponentDidUpdate';\\nimport type { FilesListOptions } from '../../../../../lib/lists/FilesList';\\nimport { FilesList } from '../../../../../lib/lists/FilesList';\\nimport type { MessageList } from '../../../../../lib/lists/MessageList';\\nimport { getConfig } from '../../../../../lib/utils/getConfig';\\n\\nexport const useFilesList = (\\n\\toptions: FilesListOptions,\\n): {\\n\\tfilesList: FilesList;\\n\\tinitialItemCount: number;\\n\\treload: () => void;\\n\\tloadMoreItems: (start: number, end: number) => void;\\n} => {\\n\\tconst [filesList, setFilesList] = useState(() => new FilesList(options));\\n\\tconst reload = useCallback(() => setFilesList(new FilesList(options)), [options]);\\n\\tconst room = useUserRoom(options.rid);\\n\\tconst uid = useUserId();\\n\\n\\tuseComponentDidUpdate(() => {\\n\\t\\toptions && reload();\\n\\t}, [options, reload]);\\n\\n\\tuseEffect(() => {\\n\\t\\tif (filesList.options !== options) {\\n\\t\\t\\tfilesList.updateFilters(options);\\n\\t\\t}\\n\\t}, [filesList, options]);\\n\\n\\tconst roomTypes = {\\n\\t\\tc: '/v1/channels.files',\\n\\t\\tl: '/v1/channels.files',\\n\\t\\tv: '/v1/channels.files',\\n\\t\\td: '/v1/im.files',\\n\\t\\tp: '/v1/groups.files',\\n\\t} as const;\\n\\n\\tconst apiEndPoint = room ? roomTypes[room.t] : '/v1/channels.files';\\n\\n\\tconst getFiles = useEndpoint('GET', apiEndPoint);\\n\\n\\tconst fetchMessages = useCallback(\\n\\t\\tasync (start, end) => {\\n\\t\\t\\tconst { files, total } = await getFiles({\\n\\t\\t\\t\\troomId: options.rid,\\n\\t\\t\\t\\toffset: start,\\n\\t\\t\\t\\tcount: end,\\n\\t\\t\\t\\tsort: JSON.stringify({ uploadedAt: -1 }),\\n\\t\\t\\t\\t...(options.text ? { name: options.text } : {}),\\n\\t\\t\\t\\t...(options.type !== 'all' && {\\n\\t\\t\\t\\t\\ttypeGroup: options.type,\\n\\t\\t\\t\\t}),\\n\\t\\t\\t});\\n\\n\\t\\t\\tconst items = files.map((file) => ({\\n\\t\\t\\t\\t...file,\\n\\t\\t\\t\\tuploadedAt: file.uploadedAt ? new Date(file.uploadedAt) : undefined,\\n\\t\\t\\t\\tmodifiedAt: file.modifiedAt ? new Date(file.modifiedAt) : undefined,\\n\\t\\t\\t}));\\n\\n\\t\\t\\tfor await (const file of items) {\\n\\t\\t\\t\\tif (file.rid && file.content) {\\n\\t\\t\\t\\t\\tconst e2eRoom = await e2e.getInstanceByRoomId(file.rid);\\n\\t\\t\\t\\t\\tif (e2eRoom?.shouldConvertReceivedMessages()) {\\n\\t\\t\\t\\t\\t\\tconst decrypted = await e2e.decryptFileContent(file);\\n\\t\\t\\t\\t\\t\\tconst key = Base64.encode(\\n\\t\\t\\t\\t\\t\\t\\tJSON.stringify({\\n\\t\\t\\t\\t\\t\\t\\t\\t...decrypted.encryption,\\n\\t\\t\\t\\t\\t\\t\\t\\tname: String.fromCharCode(...new TextEncoder().encode(decrypted.name)),\\n\\t\\t\\t\\t\\t\\t\\t\\ttype: decrypted.type,\\n\\t\\t\\t\\t\\t\\t\\t}),\\n\\t\\t\\t\\t\\t\\t);\\n\\t\\t\\t\\t\\t\\tdecrypted.path = `/file-decrypt${decrypted.path}?key=${key}`;\\n\\t\\t\\t\\t\\t\\tObject.assign(file, decrypted);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn {\\n\\t\\t\\t\\titems,\\n\\t\\t\\t\\titemCount: total,\\n\\t\\t\\t};\\n\\t\\t},\\n\\t\\t[getFiles, options.rid, options.type, options.text],\\n\\t);\\n\\n\\tconst { loadMoreItems, initialItemCount } = useScrollableRecordList(\\n\\t\\tfilesList,\\n\\t\\tfetchMessages,\\n\\t\\tuseMemo(() => parseInt(`${getConfig('discussionListSize', 10)}`), []),\\n\\t);\\n\\n\\t// TODO: chapter day : frontend create useStreamUpdatesForUploadList\\n\\tuseStreamUpdatesForMessageList(filesList as unknown as MessageList, uid, options.rid || null);\\n\\n\\treturn {\\n\\t\\treload,\\n\\t\\tfilesList,\\n\\t\\tloadMoreItems,\\n\\t\\tinitialItemCount,\\n\\t};\\n};\\n\",null],\"names\":[\"_objectSpread\",\"_asyncIterator\",\"Base64\",\"useUserRoom\",\"useUserId\",\"useEndpoint\",\"useCallback\",\"useEffect\",\"useMemo\",\"useState\",\"e2e\",\"useScrollableRecordList\",\"useStreamUpdatesForMessageList\",\"useComponentDidUpdate\",\"FilesList\",\"getConfig\",\"module\",\"link\",\"default\",\"v\",\"export\",\"useFilesList\",\"options\",\"filesList\",\"setFilesList\",\"reload\",\"room\",\"rid\",\"uid\",\"updateFilters\",\"apiEndPoint\",\"roomTypes\",\"c\",\"l\",\"d\",\"p\",\"t\",\"getFiles\",\"fetchMessages\",\"start\",\"end\",\"files\",\"total\",\"roomId\",\"offset\",\"count\",\"sort\",\"JSON\",\"stringify\",\"uploadedAt\",\"text\",\"name\",\"type\",\"typeGroup\",\"items\",\"map\",\"file\",\"Date\",\"undefined\",\"modifiedAt\",\"_iteratorAbruptCompletion\",\"_didIteratorError\",\"_iteratorError\",\"_step\",\"_iterator\",\"next\",\"done\",\"value\",\"content\",\"e2eRoom\",\"getInstanceByRoomId\",\"shouldConvertReceivedMessages\",\"decrypted\",\"decryptFileContent\",\"key\",\"encode\",\"encryption\",\"String\",\"fromCharCode\",\"TextEncoder\",\"path\",\"concat\",\"Object\",\"assign\",\"err\",\"return\",\"itemCount\",\"loadMoreItems\",\"initialItemCount\",\"parseInt\"],\"mappings\":\"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\"}"}