{"code":"function module(e,t,n){let s,i,o;n.export({CustomSounds:()=>a}),n.link(\"meteor/reactive-var\",{ReactiveVar(e){s=e}},0),n.link(\"../../../utils/client\",{getURL(e){i=e}},1),n.link(\"../../../utils/client/lib/SDKClient\",{sdk(e){o=e}},2);let l=e=>\"custom-sound-\".concat(e),d=(e,t)=>i(e,t,void 0,!0),c=[{_id:\"chime\",name:\"Chime\",extension:\"mp3\",src:d(\"sounds/chime.mp3\")},{_id:\"door\",name:\"Door\",extension:\"mp3\",src:d(\"sounds/door.mp3\")},{_id:\"beep\",name:\"Beep\",extension:\"mp3\",src:d(\"sounds/beep.mp3\")},{_id:\"chelle\",name:\"Chelle\",extension:\"mp3\",src:d(\"sounds/chelle.mp3\")},{_id:\"ding\",name:\"Ding\",extension:\"mp3\",src:d(\"sounds/ding.mp3\")},{_id:\"droplet\",name:\"Droplet\",extension:\"mp3\",src:d(\"sounds/droplet.mp3\")},{_id:\"highbell\",name:\"Highbell\",extension:\"mp3\",src:d(\"sounds/highbell.mp3\")},{_id:\"seasons\",name:\"Seasons\",extension:\"mp3\",src:d(\"sounds/seasons.mp3\")},{_id:\"telephone\",name:\"Telephone\",extension:\"mp3\",src:d(\"sounds/telephone.mp3\")},{_id:\"outbound-call-ringing\",name:\"Outbound Call Ringing\",extension:\"mp3\",src:d(\"sounds/outbound-call-ringing.mp3\")},{_id:\"call-ended\",name:\"Call Ended\",extension:\"mp3\",src:d(\"sounds/call-ended.mp3\")},{_id:\"dialtone\",name:\"Dialtone\",extension:\"mp3\",src:d(\"sounds/dialtone.mp3\")},{_id:\"ringtone\",name:\"Ringtone\",extension:\"mp3\",src:d(\"sounds/ringtone.mp3\")}],a=new class e{constructor(){this.list=void 0,this.initialFetchDone=void 0,this.play=async function(e){let{volume:t=1,loop:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=document.querySelector(\"#\".concat(l(e)));if(null!=s&&s.play)return s.volume=t,s.loop=n,await s.play(),s},this.pause=e=>{let t=document.querySelector(\"#\".concat(l(e)));null!=t&&t.pause&&t.pause()},this.stop=e=>{let t=document.querySelector(\"#\".concat(l(e)));null!=t&&t.load&&(null==t||t.load())},this.isPlaying=e=>{let t=document.querySelector(\"#\".concat(l(e)));return t&&t.duration>0&&!t.paused},this.fetchCustomSoundList=async()=>{if(this.initialFetchDone)return;let e=await o.call(\"listCustomSounds\");for(let t of e)this.add(t);this.initialFetchDone=!0},this.list=new s({}),this.initialFetchDone=!1,c.forEach(e=>this.add(e))}add(e){e.src||(e.src=this.getURL(e));let t=document.createElement(\"source\");t.src=e.src;let n=document.createElement(\"audio\");n.id=l(e._id),n.preload=\"none\",n.appendChild(t),document.body.appendChild(n);let s=this.list.get();s[e._id]=e,this.list.set(s)}remove(e){let t=this.list.get();delete t[e._id],this.list.set(t);let n=document.querySelector(\"#\".concat(l(e._id)));null==n||n.remove()}getSound(e){let t=this.list.get();return t[e]}update(e){let t=document.querySelector(\"#\".concat(l(e._id)));if(t){let n=this.list.get();e.src||(e.src=this.getURL(e)),n[e._id]=e,this.list.set(n);let s=t.querySelector(\"source\");s&&(s.src=e.src),t.load()}else this.add(e)}getURL(e){return d(\"/custom-sounds/\".concat(e._id,\".\").concat(e.extension),{_dc:e.random||0})}getList(){let e=Object.values(this.list.get());return e.sort((e,t)=>{var n,s;return(null!==(n=e.name)&&void 0!==n?n:\"\").localeCompare(null!==(s=t.name)&&void 0!==s?s:\"\")})}}}","map":"{\"version\":3,\"sources\":[\"app/custom-sounds/client/lib/CustomSounds.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { ICustomSound } from '@rocket.chat/core-typings';\\nimport { ReactiveVar } from 'meteor/reactive-var';\\n\\nimport { getURL } from '../../../utils/client';\\nimport { sdk } from '../../../utils/client/lib/SDKClient';\\n\\nconst getCustomSoundId = (soundId: ICustomSound['_id']) => `custom-sound-${soundId}`;\\nconst getAssetUrl = (asset: string, params?: Record<string, any>) => getURL(asset, params, undefined, true);\\n\\nconst defaultSounds = [\\n\\t{ _id: 'chime', name: 'Chime', extension: 'mp3', src: getAssetUrl('sounds/chime.mp3') },\\n\\t{ _id: 'door', name: 'Door', extension: 'mp3', src: getAssetUrl('sounds/door.mp3') },\\n\\t{ _id: 'beep', name: 'Beep', extension: 'mp3', src: getAssetUrl('sounds/beep.mp3') },\\n\\t{ _id: 'chelle', name: 'Chelle', extension: 'mp3', src: getAssetUrl('sounds/chelle.mp3') },\\n\\t{ _id: 'ding', name: 'Ding', extension: 'mp3', src: getAssetUrl('sounds/ding.mp3') },\\n\\t{ _id: 'droplet', name: 'Droplet', extension: 'mp3', src: getAssetUrl('sounds/droplet.mp3') },\\n\\t{ _id: 'highbell', name: 'Highbell', extension: 'mp3', src: getAssetUrl('sounds/highbell.mp3') },\\n\\t{ _id: 'seasons', name: 'Seasons', extension: 'mp3', src: getAssetUrl('sounds/seasons.mp3') },\\n\\t{ _id: 'telephone', name: 'Telephone', extension: 'mp3', src: getAssetUrl('sounds/telephone.mp3') },\\n\\t{ _id: 'outbound-call-ringing', name: 'Outbound Call Ringing', extension: 'mp3', src: getAssetUrl('sounds/outbound-call-ringing.mp3') },\\n\\t{ _id: 'call-ended', name: 'Call Ended', extension: 'mp3', src: getAssetUrl('sounds/call-ended.mp3') },\\n\\t{ _id: 'dialtone', name: 'Dialtone', extension: 'mp3', src: getAssetUrl('sounds/dialtone.mp3') },\\n\\t{ _id: 'ringtone', name: 'Ringtone', extension: 'mp3', src: getAssetUrl('sounds/ringtone.mp3') },\\n];\\n\\nclass CustomSoundsClass {\\n\\tlist: ReactiveVar<Record<string, ICustomSound>>;\\n\\n\\tinitialFetchDone: boolean;\\n\\n\\tconstructor() {\\n\\t\\tthis.list = new ReactiveVar({});\\n\\t\\tthis.initialFetchDone = false;\\n\\t\\tdefaultSounds.forEach((sound) => this.add(sound));\\n\\t}\\n\\n\\tadd(sound: ICustomSound) {\\n\\t\\tif (!sound.src) {\\n\\t\\t\\tsound.src = this.getURL(sound);\\n\\t\\t}\\n\\n\\t\\tconst source = document.createElement('source');\\n\\t\\tsource.src = sound.src;\\n\\n\\t\\tconst audio = document.createElement('audio');\\n\\t\\taudio.id = getCustomSoundId(sound._id);\\n\\t\\taudio.preload = 'none';\\n\\t\\taudio.appendChild(source);\\n\\n\\t\\tdocument.body.appendChild(audio);\\n\\n\\t\\tconst list = this.list.get();\\n\\t\\tlist[sound._id] = sound;\\n\\t\\tthis.list.set(list);\\n\\t}\\n\\n\\tremove(sound: ICustomSound) {\\n\\t\\tconst list = this.list.get();\\n\\t\\tdelete list[sound._id];\\n\\t\\tthis.list.set(list);\\n\\t\\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(sound._id)}`);\\n\\t\\taudio?.remove();\\n\\t}\\n\\n\\tgetSound(soundId: ICustomSound['_id']) {\\n\\t\\tconst list = this.list.get();\\n\\t\\treturn list[soundId];\\n\\t}\\n\\n\\tupdate(sound: ICustomSound) {\\n\\t\\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(sound._id)}`);\\n\\t\\tif (audio) {\\n\\t\\t\\tconst list = this.list.get();\\n\\t\\t\\tif (!sound.src) {\\n\\t\\t\\t\\tsound.src = this.getURL(sound);\\n\\t\\t\\t}\\n\\t\\t\\tlist[sound._id] = sound;\\n\\t\\t\\tthis.list.set(list);\\n\\t\\t\\tconst sourceEl = audio.querySelector('source');\\n\\t\\t\\tif (sourceEl) {\\n\\t\\t\\t\\tsourceEl.src = sound.src;\\n\\t\\t\\t}\\n\\t\\t\\taudio.load();\\n\\t\\t} else {\\n\\t\\t\\tthis.add(sound);\\n\\t\\t}\\n\\t}\\n\\n\\tgetURL(sound: ICustomSound) {\\n\\t\\treturn getAssetUrl(`/custom-sounds/${sound._id}.${sound.extension}`, { _dc: sound.random || 0 });\\n\\t}\\n\\n\\tgetList() {\\n\\t\\tconst list = Object.values(this.list.get());\\n\\t\\treturn list.sort((a, b) => (a.name ?? '').localeCompare(b.name ?? ''));\\n\\t}\\n\\n\\tplay = async (soundId: ICustomSound['_id'], { volume = 1, loop = false } = {}) => {\\n\\t\\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(soundId)}`);\\n\\t\\tif (!audio?.play) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\taudio.volume = volume;\\n\\t\\taudio.loop = loop;\\n\\t\\tawait audio.play();\\n\\n\\t\\treturn audio;\\n\\t};\\n\\n\\tpause = (soundId: ICustomSound['_id']) => {\\n\\t\\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(soundId)}`);\\n\\t\\tif (!audio?.pause) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\taudio.pause();\\n\\t};\\n\\n\\tstop = (soundId: ICustomSound['_id']) => {\\n\\t\\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(soundId)}`);\\n\\t\\tif (!audio?.load) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\taudio?.load();\\n\\t};\\n\\n\\tisPlaying = (soundId: ICustomSound['_id']) => {\\n\\t\\tconst audio = document.querySelector<HTMLAudioElement>(`#${getCustomSoundId(soundId)}`);\\n\\n\\t\\treturn audio && audio.duration > 0 && !audio.paused;\\n\\t};\\n\\n\\tfetchCustomSoundList = async () => {\\n\\t\\tif (this.initialFetchDone) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tconst result = await sdk.call('listCustomSounds');\\n\\t\\tfor (const sound of result) {\\n\\t\\t\\tthis.add(sound);\\n\\t\\t}\\n\\t\\tthis.initialFetchDone = true;\\n\\t};\\n}\\n\\nexport const CustomSounds = new CustomSoundsClass();\\n\",null],\"names\":[\"ReactiveVar\",\"getURL\",\"sdk\",\"module\",\"export\",\"CustomSounds\",\"link\",\"v\",\"getCustomSoundId\",\"soundId\",\"concat\",\"getAssetUrl\",\"asset\",\"params\",\"undefined\",\"defaultSounds\",\"_id\",\"name\",\"extension\",\"src\",\"CustomSoundsClass\",\"constructor\",\"list\",\"initialFetchDone\",\"play\",\"volume\",\"loop\",\"arguments\",\"length\",\"audio\",\"document\",\"querySelector\",\"pause\",\"stop\",\"load\",\"isPlaying\",\"duration\",\"paused\",\"fetchCustomSoundList\",\"result\",\"call\",\"sound\",\"add\",\"forEach\",\"source\",\"createElement\",\"id\",\"preload\",\"appendChild\",\"body\",\"get\",\"set\",\"remove\",\"getSound\",\"update\",\"sourceEl\",\"_dc\",\"random\",\"getList\",\"Object\",\"values\",\"sort\",\"a\",\"b\",\"_a$name\",\"_b$name\",\"localeCompare\"],\"mappings\":\"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\"}"}