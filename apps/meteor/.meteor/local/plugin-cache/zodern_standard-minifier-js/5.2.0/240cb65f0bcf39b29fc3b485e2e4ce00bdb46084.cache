{"code":"function module(e,t,i){let r,l,n;i.export({useGetMore:()=>o}),i.link(\"react\",{useCallback(e){r=e}},0),i.link(\"../../../../../app/ui-utils/client\",{RoomHistoryManager(e){l=e}},1),i.link(\"../../../../../lib/utils/highOrderFunctions\",{withThrottling(e){n=e}},2);let o=(e,t)=>({innerRef:r(i=>{if(!i)return;let r=0;i.addEventListener(\"scroll\",n({wait:100})(i=>{r=i.target.scrollTop;let n=i.target.clientHeight,o=l.isLoading(e),a=l.hasMore(e),s=l.hasMoreNext(e);(!1===o&&!0===a||!0===s)&&(!0===a&&r<=n/3?l.getMore(e):!0===s&&Math.ceil(r)>=i.target.scrollHeight-n&&(l.getMoreNext(e,t),t.current=!1))}))},[t,e])})}","map":"{\"version\":3,\"sources\":[\"client/views/room/body/hooks/useGetMore.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { MutableRefObject } from 'react';\\nimport { useCallback } from 'react';\\n\\nimport { RoomHistoryManager } from '../../../../../app/ui-utils/client';\\nimport { withThrottling } from '../../../../../lib/utils/highOrderFunctions';\\n\\nexport const useGetMore = (rid: string, atBottomRef: MutableRefObject<boolean>) => {\\n\\treturn {\\n\\t\\tinnerRef: useCallback(\\n\\t\\t\\t(wrapper: HTMLElement | null) => {\\n\\t\\t\\t\\tif (!wrapper) {\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tlet lastScrollTopRef = 0;\\n\\n\\t\\t\\t\\twrapper.addEventListener(\\n\\t\\t\\t\\t\\t'scroll',\\n\\t\\t\\t\\t\\twithThrottling({ wait: 100 })((event) => {\\n\\t\\t\\t\\t\\t\\tlastScrollTopRef = event.target.scrollTop;\\n\\t\\t\\t\\t\\t\\tconst height = event.target.clientHeight;\\n\\t\\t\\t\\t\\t\\tconst isLoading = RoomHistoryManager.isLoading(rid);\\n\\t\\t\\t\\t\\t\\tconst hasMore = RoomHistoryManager.hasMore(rid);\\n\\t\\t\\t\\t\\t\\tconst hasMoreNext = RoomHistoryManager.hasMoreNext(rid);\\n\\n\\t\\t\\t\\t\\t\\tif ((isLoading === false && hasMore === true) || hasMoreNext === true) {\\n\\t\\t\\t\\t\\t\\t\\tif (hasMore === true && lastScrollTopRef <= height / 3) {\\n\\t\\t\\t\\t\\t\\t\\t\\tRoomHistoryManager.getMore(rid);\\n\\t\\t\\t\\t\\t\\t\\t} else if (hasMoreNext === true && Math.ceil(lastScrollTopRef) >= event.target.scrollHeight - height) {\\n\\t\\t\\t\\t\\t\\t\\t\\tRoomHistoryManager.getMoreNext(rid, atBottomRef);\\n\\t\\t\\t\\t\\t\\t\\t\\tatBottomRef.current = false;\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t}),\\n\\t\\t\\t\\t);\\n\\t\\t\\t},\\n\\t\\t\\t[atBottomRef, rid],\\n\\t\\t),\\n\\t};\\n};\\n\",null],\"names\":[\"useCallback\",\"RoomHistoryManager\",\"withThrottling\",\"module\",\"export\",\"useGetMore\",\"link\",\"v\",\"rid\",\"atBottomRef\",\"innerRef\",\"wrapper\",\"lastScrollTopRef\",\"addEventListener\",\"wait\",\"event\",\"target\",\"scrollTop\",\"height\",\"clientHeight\",\"isLoading\",\"hasMore\",\"hasMoreNext\",\"getMore\",\"Math\",\"ceil\",\"scrollHeight\",\"getMoreNext\",\"current\"],\"mappings\":\"2BACoCA,EAAAC,EAAAC,EAApCC,EAAOC,MAAE,CAAA,CAAAC,WAAaA,IAAMA,CAAQ,GAAAF,EAAAG,IAAA,CAAA,QAAA,CAAAN,YAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,qCAAA,CAAAL,mBAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,8CAAA,CAAAJ,eAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAK7B,IAAMF,EAAaA,CAACG,EAAaC,IAChC,CAAA,CACNC,SAAUV,EACRW,IACA,GAAI,CAACA,EACJ,OAGD,IAAIC,EAAmB,EAEvBD,EAAQE,gBAAgB,CACvB,SACAX,EAAe,CAAEY,KAAM,GAAG,GAAKC,IAC9BH,EAAmBG,EAAMC,MAAM,CAACC,SAAS,CACzC,IAAMC,EAASH,EAAMC,MAAM,CAACG,YAAY,CAClCC,EAAYnB,EAAmBmB,SAAS,CAACZ,GACzCa,EAAUpB,EAAmBoB,OAAO,CAACb,GACrCc,EAAcrB,EAAmBqB,WAAW,CAACd,GAE9CY,CAAAA,AAAc,CAAA,IAAdA,GAAuBC,AAAY,CAAA,IAAZA,GAAqBC,AAAgB,CAAA,IAAhBA,CAAgB,IAC5DD,AAAY,CAAA,IAAZA,GAAoBT,GAAoBM,EAAS,EACpDjB,EAAmBsB,OAAO,CAACf,GACD,CAAA,IAAhBc,GAAwBE,KAAKC,IAAI,CAACb,IAAqBG,EAAMC,MAAM,CAACU,YAAY,CAAGR,IAC7FjB,EAAmB0B,WAAW,CAACnB,EAAKC,GACpCA,EAAYmB,OAAO,CAAG,CAAA,GAGzB,GAEF,EACA,CAACnB,EAAaD,EAAI\"}"}