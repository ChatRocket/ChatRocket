{"code":"function module(n,e,i){i.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(n){o=n}},0),i.export({usePruneWarningMessage:function(){return y}}),i.link(\"@rocket.chat/fuselage-hooks\",{useSafely:function(n){r=n}},0),i.link(\"@rocket.chat/ui-contexts\",{useSetting:function(n){t=n},useTranslation:function(n){c=n},useLanguage:function(n){a=n}},1),i.link(\"cron\",{sendAt:function(n){u=n}},2),i.link(\"date-fns/intlFormat\",{default:function(n){l=n}},3),i.link(\"react\",{useEffect:function(n){d=n},useState:function(n){s=n}},4),i.link(\"../../lib/getCronAdvancedTimerFromPrecisionSetting\",{getCronAdvancedTimerFromPrecisionSetting:function(n){m=n}},5),i.link(\"../views/room/hooks/useRetentionPolicy\",{useRetentionPolicy:function(n){f=n}},6),i.link(\"./useFormattedRelativeTime\",{useFormattedRelativeTime:function(n){v=n}},7);var o,r,t,c,a,u,l,d,s,m,f,v,P=function(n){var e=n.filesOnly,i=n.excludePinned;return e?i?\"RetentionPolicy_RoomWarning_UnpinnedFilesOnly_NextRunDate\":\"RetentionPolicy_RoomWarning_FilesOnly_NextRunDate\":i?\"RetentionPolicy_RoomWarning_Unpinned_NextRunDate\":\"RetentionPolicy_RoomWarning_NextRunDate\"},g=function(n){var e=n.enableAdvancedCronTimer,i=n.cronPrecision,o=n.advancedCronTimer;return e?u(o):u(m(i))},R=function(n){var e=n.enableAdvancedCronTimer,i=n.advancedCronTimer,t=n.cronPrecision,c=r(s(g({enableAdvancedCronTimer:e,advancedCronTimer:i,cronPrecision:t}))),u=o(c,2),m=u[0],f=u[1],v=a();return d(function(){var n=setTimeout(function(){return f(g({enableAdvancedCronTimer:e,advancedCronTimer:i,cronPrecision:t}))},m.valueOf()-Date.now());return function(){return clearTimeout(n)}},[i,t,e,m,f]),l(new Date(m.valueOf()),{localeMatcher:\"best fit\",year:\"numeric\",month:\"long\",day:\"numeric\",hour:\"numeric\",minute:\"numeric\"},{locale:v})},y=function(n){var e=f(n);if(!e)throw Error(\"usePruneWarningMessage - No room provided\");var i=e.maxAge,o=e.filesOnly,r=e.excludePinned,a=String(t(\"RetentionPolicy_Precision\")),u=c(),l=!!t(\"RetentionPolicy_Advanced_Precision\"),d=String(t(\"RetentionPolicy_Advanced_Precision_Cron\")),s=P({filesOnly:o,excludePinned:r}),m=R({enableAdvancedCronTimer:l,advancedCronTimer:d,cronPrecision:a});return u(s,{maxAge:v(i),nextRunDate:m})}}","map":"{\"version\":3,\"sources\":[\"client/hooks/usePruneWarningMessage.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom } from '@rocket.chat/core-typings';\\nimport { useSafely } from '@rocket.chat/fuselage-hooks';\\nimport type { TranslationKey } from '@rocket.chat/ui-contexts';\\nimport { useSetting, useTranslation, useLanguage } from '@rocket.chat/ui-contexts';\\nimport { sendAt } from 'cron';\\nimport intlFormat from 'date-fns/intlFormat';\\nimport { useEffect, useState } from 'react';\\n\\nimport { getCronAdvancedTimerFromPrecisionSetting } from '../../lib/getCronAdvancedTimerFromPrecisionSetting';\\nimport { useRetentionPolicy } from '../views/room/hooks/useRetentionPolicy';\\nimport { useFormattedRelativeTime } from './useFormattedRelativeTime';\\n\\nconst getMessage = ({ filesOnly, excludePinned }: { filesOnly: boolean; excludePinned: boolean }): TranslationKey => {\\n\\tif (filesOnly) {\\n\\t\\treturn excludePinned\\n\\t\\t\\t? 'RetentionPolicy_RoomWarning_UnpinnedFilesOnly_NextRunDate'\\n\\t\\t\\t: 'RetentionPolicy_RoomWarning_FilesOnly_NextRunDate';\\n\\t}\\n\\n\\treturn excludePinned ? 'RetentionPolicy_RoomWarning_Unpinned_NextRunDate' : 'RetentionPolicy_RoomWarning_NextRunDate';\\n};\\n\\ntype CronPrecisionSetting = '0' | '1' | '2' | '3';\\nconst getNextRunDate = ({\\n\\tenableAdvancedCronTimer,\\n\\tcronPrecision,\\n\\tadvancedCronTimer,\\n}: {\\n\\tenableAdvancedCronTimer: boolean;\\n\\tcronPrecision: CronPrecisionSetting;\\n\\tadvancedCronTimer: string;\\n}) => {\\n\\tif (enableAdvancedCronTimer) {\\n\\t\\treturn sendAt(advancedCronTimer);\\n\\t}\\n\\n\\treturn sendAt(getCronAdvancedTimerFromPrecisionSetting(cronPrecision));\\n};\\n\\nconst useNextRunDate = ({\\n\\tenableAdvancedCronTimer,\\n\\tadvancedCronTimer,\\n\\tcronPrecision,\\n}: {\\n\\tenableAdvancedCronTimer: boolean;\\n\\tcronPrecision: CronPrecisionSetting;\\n\\tadvancedCronTimer: string;\\n}) => {\\n\\tconst [nextRunDate, setNextRunDate] = useSafely(useState(getNextRunDate({ enableAdvancedCronTimer, advancedCronTimer, cronPrecision })));\\n\\tconst lang = useLanguage();\\n\\n\\tuseEffect(() => {\\n\\t\\tconst timeoutBetweenRunAndNow = nextRunDate.valueOf() - Date.now();\\n\\n\\t\\tconst timeout = setTimeout(\\n\\t\\t\\t() => setNextRunDate(getNextRunDate({ enableAdvancedCronTimer, advancedCronTimer, cronPrecision })),\\n\\t\\t\\ttimeoutBetweenRunAndNow,\\n\\t\\t);\\n\\n\\t\\treturn () => clearTimeout(timeout);\\n\\t}, [advancedCronTimer, cronPrecision, enableAdvancedCronTimer, nextRunDate, setNextRunDate]);\\n\\n\\treturn intlFormat(\\n\\t\\tnew Date(nextRunDate.valueOf()),\\n\\t\\t{\\n\\t\\t\\tlocaleMatcher: 'best fit',\\n\\t\\t\\tyear: 'numeric',\\n\\t\\t\\tmonth: 'long',\\n\\t\\t\\tday: 'numeric',\\n\\t\\t\\thour: 'numeric',\\n\\t\\t\\tminute: 'numeric',\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\tlocale: lang,\\n\\t\\t},\\n\\t);\\n};\\n\\nexport const usePruneWarningMessage = (room: IRoom) => {\\n\\tconst retention = useRetentionPolicy(room);\\n\\tif (!retention) {\\n\\t\\tthrow new Error('usePruneWarningMessage - No room provided');\\n\\t}\\n\\n\\tconst { maxAge, filesOnly, excludePinned } = retention;\\n\\n\\tconst cronPrecision = String(useSetting('RetentionPolicy_Precision')) as CronPrecisionSetting;\\n\\n\\tconst t = useTranslation();\\n\\n\\tconst enableAdvancedCronTimer = Boolean(useSetting('RetentionPolicy_Advanced_Precision'));\\n\\tconst advancedCronTimer = String(useSetting('RetentionPolicy_Advanced_Precision_Cron'));\\n\\n\\tconst message = getMessage({ filesOnly, excludePinned });\\n\\n\\tconst nextRunDate = useNextRunDate({\\n\\t\\tenableAdvancedCronTimer,\\n\\t\\tadvancedCronTimer,\\n\\t\\tcronPrecision,\\n\\t});\\n\\n\\tconst maxAgeFormatted = useFormattedRelativeTime(maxAge);\\n\\n\\treturn t(message, { maxAge: maxAgeFormatted, nextRunDate });\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_slicedToArray\",\"export\",\"usePruneWarningMessage\",\"useSafely\",\"useSetting\",\"useTranslation\",\"useLanguage\",\"sendAt\",\"intlFormat\",\"useEffect\",\"useState\",\"getCronAdvancedTimerFromPrecisionSetting\",\"useRetentionPolicy\",\"useFormattedRelativeTime\",\"getMessage\",\"_ref\",\"filesOnly\",\"excludePinned\",\"getNextRunDate\",\"_ref2\",\"enableAdvancedCronTimer\",\"cronPrecision\",\"advancedCronTimer\",\"useNextRunDate\",\"_ref3\",\"_useSafely\",\"_useSafely2\",\"nextRunDate\",\"setNextRunDate\",\"lang\",\"timeout\",\"setTimeout\",\"valueOf\",\"Date\",\"now\",\"clearTimeout\",\"localeMatcher\",\"year\",\"month\",\"day\",\"hour\",\"minute\",\"locale\",\"room\",\"retention\",\"Error\",\"maxAge\",\"String\",\"t\",\"Boolean\",\"message\"],\"mappings\":\"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\"}"}