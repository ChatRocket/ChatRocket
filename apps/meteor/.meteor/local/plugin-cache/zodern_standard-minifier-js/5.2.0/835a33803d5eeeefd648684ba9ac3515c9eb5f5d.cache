{"code":"function module(e,n,t){let a,l,r,u,c,s,i,o,d,m;t.link(\"@babel/runtime/helpers/extends\",{default(e){a=e}},0),t.link(\"@rocket.chat/core-typings\",{BannerPlatform(e){l=e}},0),t.link(\"@rocket.chat/ui-contexts\",{useEndpoint(e){r=e},useStream(e){u=e},useUserId(e){c=e}},1),t.link(\"@tanstack/react-query\",{useQuery(e){s=e},useQueryClient(e){i=e}},2),t.link(\"react\",{default(e){o=e},useEffect(e){d=e}},3),t.link(\"./CloudAnnouncementHandler\",{default(e){m=e}},4),t.exportDefault(()=>{let e=c(),n=r(\"GET\",\"/v1/banners\"),{isSuccess:t,data:f}=s({queryKey:[\"cloud\",\"announcements\"],queryFn:()=>n({platform:l.Web}),select:e=>e.banners,enabled:!!e,staleTime:0,refetchInterval:864e5}),y=u(\"notify-logged\"),k=u(\"notify-user\"),b=i();return(d(()=>{if(!e)return;let n=y(\"banner-changed\",async()=>{b.invalidateQueries([\"cloud\",\"announcements\"])}),t=k(\"\".concat(e,\"/banners\"),async()=>{b.invalidateQueries([\"cloud\",\"announcements\"])});return()=>{n(),t()}},[y,e,k,b]),t)?o.createElement(o.Fragment,null,f.map(e=>o.createElement(m,a({key:e._id},e)))):null})}","map":"{\"version\":3,\"sources\":[\"client/views/cloud/CloudAnnouncementsRegion.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { BannerPlatform } from '@rocket.chat/core-typings';\\nimport { useEndpoint, useStream, useUserId } from '@rocket.chat/ui-contexts';\\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\\nimport React, { useEffect } from 'react';\\n\\nimport CloudAnnouncementHandler from './CloudAnnouncementHandler';\\n\\nconst CloudAnnouncementsRegion = () => {\\n\\tconst uid = useUserId();\\n\\n\\tconst getAnnouncements = useEndpoint('GET', '/v1/banners');\\n\\n\\tconst { isSuccess, data: announcements } = useQuery({\\n\\t\\tqueryKey: ['cloud', 'announcements'],\\n\\t\\tqueryFn: () => getAnnouncements({ platform: BannerPlatform.Web }),\\n\\t\\tselect: (data) => data.banners,\\n\\t\\tenabled: !!uid,\\n\\t\\tstaleTime: 0,\\n\\t\\trefetchInterval: 1000 * 60 * 60 * 24,\\n\\t});\\n\\n\\tconst subscribeToNotifyLoggedIn = useStream('notify-logged');\\n\\tconst subscribeToNotifyUser = useStream('notify-user');\\n\\tconst queryClient = useQueryClient();\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!uid) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst unsubscribeFromBannerChanged = subscribeToNotifyLoggedIn('banner-changed', async () => {\\n\\t\\t\\tqueryClient.invalidateQueries(['cloud', 'announcements']);\\n\\t\\t});\\n\\n\\t\\tconst unsubscribeBanners = subscribeToNotifyUser(`${uid}/banners`, async () => {\\n\\t\\t\\tqueryClient.invalidateQueries(['cloud', 'announcements']);\\n\\t\\t});\\n\\n\\t\\treturn () => {\\n\\t\\t\\tunsubscribeFromBannerChanged();\\n\\t\\t\\tunsubscribeBanners();\\n\\t\\t};\\n\\t}, [subscribeToNotifyLoggedIn, uid, subscribeToNotifyUser, queryClient]);\\n\\n\\tif (!isSuccess) {\\n\\t\\treturn null;\\n\\t}\\n\\n\\treturn (\\n\\t\\t<>\\n\\t\\t\\t{announcements.map((announcement) => (\\n\\t\\t\\t\\t<CloudAnnouncementHandler key={announcement._id} {...announcement} />\\n\\t\\t\\t))}\\n\\t\\t</>\\n\\t);\\n};\\n\\nexport default CloudAnnouncementsRegion;\\n\",null],\"names\":[\"_extends\",\"BannerPlatform\",\"useEndpoint\",\"useStream\",\"useUserId\",\"useQuery\",\"useQueryClient\",\"React\",\"useEffect\",\"CloudAnnouncementHandler\",\"module\",\"link\",\"default\",\"v\",\"exportDefault\",\"CloudAnnouncementsRegion\",\"uid\",\"getAnnouncements\",\"isSuccess\",\"data\",\"announcements\",\"queryKey\",\"queryFn\",\"platform\",\"Web\",\"select\",\"banners\",\"enabled\",\"staleTime\",\"refetchInterval\",\"subscribeToNotifyLoggedIn\",\"subscribeToNotifyUser\",\"queryClient\",\"unsubscribeFromBannerChanged\",\"invalidateQueries\",\"unsubscribeBanners\",\"concat\",\"createElement\",\"Fragment\",\"map\",\"announcement\",\"key\",\"_id\"],\"mappings\":\"2BAAAA,EAAAC,EAA2DC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAlDC,EAAAC,IAAc,CAAE,iCAAiC,CAACC,QAAAC,CAAA,EAAAb,EAAAa,CAAA,CAAA,EAAA,GAAlDH,EAAgBC,IAAA,CAAM,4BAA4B,CAAAV,eAAAY,CAAA,EAAAZ,EAAAY,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,2BAAA,CAAAT,YAAAW,CAAA,EAAAX,EAAAW,CAAA,EAAAV,UAAAU,CAAA,EAAAV,EAAAU,CAAA,EAAAT,UAAAS,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,wBAAA,CAAAN,SAAAQ,CAAA,EAAAR,EAAAQ,CAAA,EAAAP,eAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,QAAA,CAAAC,QAAAC,CAAA,EAAAN,EAAAM,CAAA,EAAAL,UAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,6BAAA,CAAAC,QAAAC,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAA3DH,EAAOI,aAAE,CAOwBC,KAChC,IAAMC,EAAMZ,IAENa,EAAmBf,EAAY,MAAO,eAEtC,CAAEgB,UAAAA,CAAS,CAAEC,KAAMC,CAAAA,CAAe,CAAGf,EAAS,CACnDgB,SAAU,CAAC,QAAS,gBAAgB,CACpCC,QAASA,IAAML,EAAiB,CAAEM,SAAUtB,EAAeuB,GAAAA,AAAG,GAC9DC,OAASN,GAASA,EAAKO,OAAO,CAC9BC,QAAS,CAAC,CAACX,EACXY,UAAW,EACXC,gBAAiB,QAGZC,EAA4B3B,EAAU,iBACtC4B,EAAwB5B,EAAU,eAClC6B,EAAc1B,UAqBpB,CAnBAE,EAAU,KACT,GAAI,CAACQ,EACJ,OAGD,IAAMiB,EAA+BH,EAA0B,iBAAkB,UAChFE,EAAYE,iBAAiB,CAAC,CAAC,QAAS,gBAAgB,CACzD,GAEMC,EAAqBJ,EAAqB,GAAAK,MAAA,CAAIpB,EAAG,YAAY,UAClEgB,EAAYE,iBAAiB,CAAC,CAAC,QAAS,gBAAgB,CACzD,GAEA,MAAO,KACND,IACAE,GACD,CACD,EAAG,CAACL,EAA2Bd,EAAKe,EAAuBC,EAAY,EAElEd,GAKJX,EAAA8B,aAAA,CAAA9B,EAAA+B,QAAA,CAAA,KACElB,EAAcmB,GAAG,CAAEC,GACnBjC,EAAA8B,aAAA,CAAC5B,EAAwBT,EAAA,CAACyC,IAAKD,EAAaE,GAAAA,AAAI,EAAKF,MANhD,IAUT\"}"}