{"code":"function module(n,e,i){var t,o,s,a,r,c,l,u,p,m,d,f;i.link(\"@babel/runtime/regenerator\",{default:function(n){t=n}},0),i.link(\"meteor/meteor\",{Meteor:function(n){o=n}},0),i.link(\"../../../app/authorization/client\",{hasAtLeastOnePermission:function(n){s=n}},1),i.link(\"../../../app/settings/client\",{settings:function(n){a=n}},2),i.link(\"../../../app/ui-utils/client\",{MessageAction:function(n){r=n}},3),i.link(\"../../../app/utils/client/lib/SDKClient\",{sdk:function(n){c=n}},4),i.link(\"../../lib/imperativeModal\",{imperativeModal:function(n){l=n}},5),i.link(\"../../lib/queryClient\",{queryClient:function(n){u=n}},6),i.link(\"../../lib/rooms/roomCoordinator\",{roomCoordinator:function(n){p=n}},7),i.link(\"../../lib/toast\",{dispatchToastMessage:function(n){m=n}},8),i.link(\"../../lib/utils/messageArgs\",{messageArgs:function(n){d=n}},9),i.link(\"../../views/room/modals/PinMessageModal\",{default:function(n){f=n}},10),o.startup(function(){r.addButton({id:\"pin-message\",icon:\"pin\",label:\"Pin\",type:\"interaction\",context:[\"pinned\",\"message\",\"message-mobile\",\"threads\",\"direct\",\"videoconf\",\"videoconf-threads\"],action:function(n,e){var i,o,s;return t.async(function(n){for(;;)switch(n.prev=n.next){case 0:o=void 0===(i=e.message)?d(this).msg:i,s=function n(){return t.async(function n(n){for(;;)switch(n.prev=n.next){case 0:return o.pinned=!0,n.prev=1,n.next=4,t.awrap(c.call(\"pinMessage\",o));case 4:u.invalidateQueries([\"rooms\",o.rid,\"pinned-messages\"]),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(1),m({type:\"error\",message:n.t0});case 10:l.close();case 11:case\"end\":return n.stop()}},null,null,[[1,7]],Promise)},l.open({component:f,props:{message:o,onConfirm:s,onCancel:function(){return l.close()}}});case 3:case\"end\":return n.stop()}},null,this,null,Promise)},condition:function(n){var e=n.message,i=n.subscription,t=n.room;return!!a.get(\"Message_AllowPinning\")&&!e.pinned&&!!i&&!p.isLivechatRoom(t.t)&&s(\"pin-message\",e.rid)},order:2,group:\"menu\"})})}","map":"{\"version\":3,\"sources\":[\"client/startup/actionButtons/pinMessage.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\n\\nimport { hasAtLeastOnePermission } from '../../../app/authorization/client';\\nimport { settings } from '../../../app/settings/client';\\nimport { MessageAction } from '../../../app/ui-utils/client';\\nimport { sdk } from '../../../app/utils/client/lib/SDKClient';\\nimport { imperativeModal } from '../../lib/imperativeModal';\\nimport { queryClient } from '../../lib/queryClient';\\nimport { roomCoordinator } from '../../lib/rooms/roomCoordinator';\\nimport { dispatchToastMessage } from '../../lib/toast';\\nimport { messageArgs } from '../../lib/utils/messageArgs';\\nimport PinMessageModal from '../../views/room/modals/PinMessageModal';\\n\\nMeteor.startup(() => {\\n\\tMessageAction.addButton({\\n\\t\\tid: 'pin-message',\\n\\t\\ticon: 'pin',\\n\\t\\tlabel: 'Pin',\\n\\t\\ttype: 'interaction',\\n\\t\\tcontext: ['pinned', 'message', 'message-mobile', 'threads', 'direct', 'videoconf', 'videoconf-threads'],\\n\\t\\tasync action(_, props) {\\n\\t\\t\\tconst { message = messageArgs(this).msg } = props;\\n\\t\\t\\tconst onConfirm = async () => {\\n\\t\\t\\t\\tmessage.pinned = true;\\n\\t\\t\\t\\ttry {\\n\\t\\t\\t\\t\\tawait sdk.call('pinMessage', message);\\n\\t\\t\\t\\t\\tqueryClient.invalidateQueries(['rooms', message.rid, 'pinned-messages']);\\n\\t\\t\\t\\t} catch (error) {\\n\\t\\t\\t\\t\\tdispatchToastMessage({ type: 'error', message: error });\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\timperativeModal.close();\\n\\t\\t\\t};\\n\\n\\t\\t\\timperativeModal.open({\\n\\t\\t\\t\\tcomponent: PinMessageModal,\\n\\t\\t\\t\\tprops: {\\n\\t\\t\\t\\t\\tmessage,\\n\\t\\t\\t\\t\\tonConfirm,\\n\\t\\t\\t\\t\\tonCancel: () => imperativeModal.close(),\\n\\t\\t\\t\\t},\\n\\t\\t\\t});\\n\\t\\t},\\n\\t\\tcondition({ message, subscription, room }) {\\n\\t\\t\\tif (!settings.get('Message_AllowPinning') || message.pinned || !subscription) {\\n\\t\\t\\t\\treturn false;\\n\\t\\t\\t}\\n\\t\\t\\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room.t);\\n\\t\\t\\tif (isLivechatRoom) {\\n\\t\\t\\t\\treturn false;\\n\\t\\t\\t}\\n\\t\\t\\treturn hasAtLeastOnePermission('pin-message', message.rid);\\n\\t\\t},\\n\\t\\torder: 2,\\n\\t\\tgroup: 'menu',\\n\\t});\\n});\\n\",null],\"names\":[\"_regeneratorRuntime\",\"Meteor\",\"hasAtLeastOnePermission\",\"settings\",\"MessageAction\",\"sdk\",\"imperativeModal\",\"queryClient\",\"roomCoordinator\",\"dispatchToastMessage\",\"messageArgs\",\"PinMessageModal\",\"module\",\"link\",\"default\",\"v\",\"startup\",\"addButton\",\"id\",\"icon\",\"label\",\"type\",\"context\",\"action\",\"_\",\"props\",\"_props$message\",\"message\",\"onConfirm\",\"async\",\"_context2\",\"prev\",\"next\",\"msg\",\"_callee\",\"_callee$\",\"_context\",\"pinned\",\"awrap\",\"call\",\"invalidateQueries\",\"rid\",\"t0\",\"close\",\"stop\",\"Promise\",\"open\",\"component\",\"onCancel\",\"condition\",\"_ref\",\"subscription\",\"room\",\"get\",\"isLivechatRoom\",\"t\",\"order\",\"group\"],\"mappings\":\"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\"}"}