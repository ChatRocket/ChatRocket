{"code":"function module(e,n,o){o.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){t=e}},0),o.link(\"@babel/runtime/regenerator\",{default:function(e){r=e}},1),o.export({useFileUploadDropTarget:function(){return h}}),o.link(\"@rocket.chat/fuselage-hooks\",{useMutableCallback:function(e){u=e}},0),o.link(\"@rocket.chat/ui-contexts\",{useSetting:function(e){i=e},useTranslation:function(e){a=e},useUser:function(e){l=e}},1),o.link(\"react\",{useCallback:function(e){s=e},useMemo:function(e){c=e}},2),o.link(\"../../../../hooks/omnichannel/useIsRoomOverMacLimit\",{useIsRoomOverMacLimit:function(e){f=e}},3),o.link(\"../../../../hooks/useReactiveValue\",{useReactiveValue:function(e){m=e}},4),o.link(\"../../../../lib/rooms/roomCoordinator\",{roomCoordinator:function(e){p=e}},5),o.link(\"../../contexts/ChatContext\",{useChat:function(e){d=e}},6),o.link(\"../../contexts/RoomContext\",{useRoom:function(e){k=e},useRoomSubscription:function(e){b=e}},7),o.link(\"./useDropTarget\",{useDropTarget:function(e){v=e}},8);var t,r,u,i,a,l,s,c,f,m,p,d,k,b,v,h=function(){var e=k(),n=v(),h=n.triggerProps,y=n.overlayProps,g=f(e),x=a(),C=i(\"FileUpload_Enabled\"),R=l(),T=m(s(function(){return!p.readOnly(e._id,{username:null==R?void 0:R.username})},[e._id,null==R?void 0:R.username])),w=d(),D=b(),F=u(function(e){var n,t;return r.async(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,r.awrap(o.dynamicImport(\"../../../../../app/utils/lib/mimeTypes\"));case 2:n=u.sent.getMimeType,t=Array.from(function(){var n=[],o=new Set;return e.forEach(function(e){var t=e.size;o.has(t)||(n.push(e),o.add(t))}),n}()).map(function(e){return Object.defineProperty(e,\"type\",{value:n(e.type,e.name)}),e}),null==w||w.flows.uploadFiles(t);case 8:case\"end\":return u.stop()}},null,null,null,Promise)});return[h,c(function(){return!C||g?t({enabled:!1,reason:x(\"FileUpload_Disabled\")},y):T&&D?t({enabled:!0,onFileDrop:F},y):t({enabled:!1,reason:x(\"error-not-allowed\")},y)},[T,C,g,F,y,D,x])]}}","map":"{\"version\":3,\"sources\":[\"client/views/room/body/hooks/useFileUploadDropTarget.ts\",\"<anon>\"],\"sourcesContent\":[\"import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\\nimport { useSetting, useTranslation, useUser } from '@rocket.chat/ui-contexts';\\nimport type { ReactNode } from 'react';\\nimport type React from 'react';\\nimport { useCallback, useMemo } from 'react';\\n\\nimport { useIsRoomOverMacLimit } from '../../../../hooks/omnichannel/useIsRoomOverMacLimit';\\nimport { useReactiveValue } from '../../../../hooks/useReactiveValue';\\nimport { roomCoordinator } from '../../../../lib/rooms/roomCoordinator';\\nimport { useChat } from '../../contexts/ChatContext';\\nimport { useRoom, useRoomSubscription } from '../../contexts/RoomContext';\\nimport { useDropTarget } from './useDropTarget';\\n\\nexport const useFileUploadDropTarget = (): readonly [\\n\\tfileUploadTriggerProps: {\\n\\t\\tonDragEnter: (event: React.DragEvent<Element>) => void;\\n\\t},\\n\\tfileUploadOverlayProps: {\\n\\t\\tvisible: boolean;\\n\\t\\tonDismiss: () => void;\\n\\t\\tenabled: boolean;\\n\\t\\treason?: ReactNode;\\n\\t},\\n] => {\\n\\tconst room = useRoom();\\n\\tconst { triggerProps, overlayProps } = useDropTarget();\\n\\n\\tconst isRoomOverMacLimit = useIsRoomOverMacLimit(room);\\n\\n\\tconst t = useTranslation();\\n\\n\\tconst fileUploadEnabled = useSetting<boolean>('FileUpload_Enabled');\\n\\tconst user = useUser();\\n\\tconst fileUploadAllowedForUser = useReactiveValue(\\n\\t\\tuseCallback(() => !roomCoordinator.readOnly(room._id, { username: user?.username }), [room._id, user?.username]),\\n\\t);\\n\\n\\tconst chat = useChat();\\n\\tconst subscription = useRoomSubscription();\\n\\n\\tconst onFileDrop = useMutableCallback(async (files: File[]) => {\\n\\t\\tconst { getMimeType } = await import('../../../../../app/utils/lib/mimeTypes');\\n\\t\\tconst getUniqueFiles = () => {\\n\\t\\t\\tconst uniqueFiles: File[] = [];\\n\\t\\t\\tconst st: Set<number> = new Set();\\n\\t\\t\\tfiles.forEach((file) => {\\n\\t\\t\\t\\tconst key = file.size;\\n\\t\\t\\t\\tif (!st.has(key)) {\\n\\t\\t\\t\\t\\tuniqueFiles.push(file);\\n\\t\\t\\t\\t\\tst.add(key);\\n\\t\\t\\t\\t}\\n\\t\\t\\t});\\n\\t\\t\\treturn uniqueFiles;\\n\\t\\t};\\n\\t\\tconst uniqueFiles = getUniqueFiles();\\n\\n\\t\\tconst uploads = Array.from(uniqueFiles).map((file) => {\\n\\t\\t\\tObject.defineProperty(file, 'type', { value: getMimeType(file.type, file.name) });\\n\\t\\t\\treturn file;\\n\\t\\t});\\n\\n\\t\\tchat?.flows.uploadFiles(uploads);\\n\\t});\\n\\n\\tconst allOverlayProps = useMemo(() => {\\n\\t\\tif (!fileUploadEnabled || isRoomOverMacLimit) {\\n\\t\\t\\treturn {\\n\\t\\t\\t\\tenabled: false,\\n\\t\\t\\t\\treason: t('FileUpload_Disabled'),\\n\\t\\t\\t\\t...overlayProps,\\n\\t\\t\\t} as const;\\n\\t\\t}\\n\\n\\t\\tif (!fileUploadAllowedForUser || !subscription) {\\n\\t\\t\\treturn {\\n\\t\\t\\t\\tenabled: false,\\n\\t\\t\\t\\treason: t('error-not-allowed'),\\n\\t\\t\\t\\t...overlayProps,\\n\\t\\t\\t} as const;\\n\\t\\t}\\n\\n\\t\\treturn {\\n\\t\\t\\tenabled: true,\\n\\t\\t\\tonFileDrop,\\n\\t\\t\\t...overlayProps,\\n\\t\\t} as const;\\n\\t}, [fileUploadAllowedForUser, fileUploadEnabled, isRoomOverMacLimit, onFileDrop, overlayProps, subscription, t]);\\n\\n\\treturn [triggerProps, allOverlayProps] as const;\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_objectSpread\",\"_regeneratorRuntime\",\"export\",\"useFileUploadDropTarget\",\"useMutableCallback\",\"useSetting\",\"useTranslation\",\"useUser\",\"useCallback\",\"useMemo\",\"useIsRoomOverMacLimit\",\"useReactiveValue\",\"roomCoordinator\",\"useChat\",\"useRoom\",\"useRoomSubscription\",\"useDropTarget\",\"room\",\"_useDropTarget\",\"triggerProps\",\"overlayProps\",\"isRoomOverMacLimit\",\"t\",\"fileUploadEnabled\",\"user\",\"fileUploadAllowedForUser\",\"readOnly\",\"_id\",\"username\",\"chat\",\"subscription\",\"onFileDrop\",\"files\",\"getMimeType\",\"uploads\",\"async\",\"_context\",\"prev\",\"next\",\"awrap\",\"dynamicImport\",\"_await$module$dynamic\",\"sent\",\"Array\",\"from\",\"getUniqueFiles\",\"uniqueFiles\",\"st\",\"Set\",\"forEach\",\"file\",\"key\",\"size\",\"has\",\"push\",\"add\",\"map\",\"Object\",\"defineProperty\",\"value\",\"type\",\"name\",\"flows\",\"uploadFiles\",\"stop\",\"Promise\",\"enabled\",\"reason\"],\"mappings\":\"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\"}"}