{"code":"function module(e,o,t){let n,r,l,a,i,s,u,c,d,m,k,_,f,p,h;t.link(\"@babel/runtime/helpers/extends\",{default(e){n=e}},0),t.link(\"@rocket.chat/fuselage\",{Throbber(e){r=e},Box(e){l=e}},0),t.link(\"@rocket.chat/ui-contexts\",{useSetModal(e){a=e},useEndpoint(e){i=e},useToastMessageDispatch(e){s=e}},1),t.link(\"@tanstack/react-query\",{useMutation(e){u=e}},2),t.link(\"react\",{default(e){c=e}},3),t.link(\"react-i18next\",{useTranslation(e){d=e}},4),t.link(\"react-virtuoso\",{Virtuoso(e){m=e}},5),t.link(\"../../../components/CustomScrollbars\",{VirtuosoScrollbars(e){k=e}},6),t.link(\"../../../lib/rooms/roomCoordinator\",{roomCoordinator(e){_=e}},7),t.link(\"./FederatedRoomListEmptyPlaceholder\",{default(e){f=e}},8),t.link(\"./FederatedRoomListItem\",{default(e){p=e}},9),t.link(\"./useInfiniteFederationSearchPublicRooms\",{useInfiniteFederationSearchPublicRooms(e){h=e}},10),t.exportDefault(e=>{let{serverName:o,roomName:t,count:b}=e,E=i(\"POST\",\"/v1/federation/joinExternalPublicRoom\"),x=a(),{t:y}=d(),R=s(),{data:S,isLoading:g,isFetchingNextPage:v,fetchNextPage:P}=h(o,t,b),{mutate:C,isLoading:F}=u([\"federation/joinExternalPublicRoom\"],async e=>{let{id:o,pageToken:n}=e;return E({externalRoomId:o,roomName:t,pageToken:n})},{onSuccess:(e,o)=>{R({type:\"success\",message:y(\"Your_request_to_join__roomName__has_been_made_it_could_take_up_to_15_minutes_to_be_processed\",{roomName:o.name})}),x(null)},onError:(e,o)=>{let{id:t}=o;if(e instanceof Error&&\"already-joined\"===e.message){x(null),_.openRouteLink(\"c\",{rid:t});return}R({type:\"error\",message:e})}});if(g)return c.createElement(r,null);let I=null==S?void 0:S.pages.flatMap(e=>e.rooms);return c.createElement(l,{is:\"ul\",overflow:\"hidden\",height:\"356px\",flexGrow:1,flexShrink:0,mi:-24},c.createElement(m,{data:I||[],computeItemKey:(e,o)=>(null==o?void 0:o.id)||e,overscan:4,components:{Footer:()=>v?c.createElement(r,null):null,Scroller:k,EmptyPlaceholder:f},endReached:g||v?()=>void 0:()=>P(),itemContent:(e,o)=>c.createElement(p,n({onClickJoin:()=>C(o)},o,{disabled:F,key:o.id}))}))})}","map":"{\"version\":3,\"sources\":[\"client/sidebar/header/MatrixFederationSearch/FederatedRoomList.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { Throbber, Box } from '@rocket.chat/fuselage';\\nimport type { IFederationPublicRooms } from '@rocket.chat/rest-typings';\\nimport { useSetModal, useEndpoint, useToastMessageDispatch } from '@rocket.chat/ui-contexts';\\nimport { useMutation } from '@tanstack/react-query';\\nimport React from 'react';\\nimport { useTranslation } from 'react-i18next';\\nimport { Virtuoso } from 'react-virtuoso';\\n\\nimport { VirtuosoScrollbars } from '../../../components/CustomScrollbars';\\nimport { roomCoordinator } from '../../../lib/rooms/roomCoordinator';\\nimport FederatedRoomListEmptyPlaceholder from './FederatedRoomListEmptyPlaceholder';\\nimport FederatedRoomListItem from './FederatedRoomListItem';\\nimport { useInfiniteFederationSearchPublicRooms } from './useInfiniteFederationSearchPublicRooms';\\n\\ntype FederatedRoomListProps = {\\n\\tserverName: string;\\n\\troomName?: string;\\n\\tpageToken?: string;\\n\\tcount?: number;\\n};\\n\\nconst FederatedRoomList = ({ serverName, roomName, count }: FederatedRoomListProps) => {\\n\\tconst joinExternalPublicRoom = useEndpoint('POST', '/v1/federation/joinExternalPublicRoom');\\n\\n\\tconst setModal = useSetModal();\\n\\tconst { t } = useTranslation();\\n\\tconst dispatchToastMessage = useToastMessageDispatch();\\n\\tconst { data, isLoading, isFetchingNextPage, fetchNextPage } = useInfiniteFederationSearchPublicRooms(serverName, roomName, count);\\n\\n\\tconst { mutate: onClickJoin, isLoading: isLoadingMutation } = useMutation(\\n\\t\\t['federation/joinExternalPublicRoom'],\\n\\t\\tasync ({ id, pageToken }: IFederationPublicRooms) =>\\n\\t\\t\\tjoinExternalPublicRoom({ externalRoomId: id as `!${string}:${string}`, roomName, pageToken }),\\n\\t\\t{\\n\\t\\t\\tonSuccess: (_, data) => {\\n\\t\\t\\t\\tdispatchToastMessage({\\n\\t\\t\\t\\t\\ttype: 'success',\\n\\t\\t\\t\\t\\tmessage: t('Your_request_to_join__roomName__has_been_made_it_could_take_up_to_15_minutes_to_be_processed', {\\n\\t\\t\\t\\t\\t\\troomName: data.name,\\n\\t\\t\\t\\t\\t}),\\n\\t\\t\\t\\t});\\n\\t\\t\\t\\tsetModal(null);\\n\\t\\t\\t},\\n\\t\\t\\tonError: (error, { id }) => {\\n\\t\\t\\t\\tif (error instanceof Error && error.message === 'already-joined') {\\n\\t\\t\\t\\t\\tsetModal(null);\\n\\t\\t\\t\\t\\troomCoordinator.openRouteLink('c', { rid: id });\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tdispatchToastMessage({ type: 'error', message: error });\\n\\t\\t\\t},\\n\\t\\t},\\n\\t);\\n\\n\\tif (isLoading) {\\n\\t\\treturn <Throbber />;\\n\\t}\\n\\n\\tconst flattenedData = data?.pages.flatMap((page) => page.rooms);\\n\\treturn (\\n\\t\\t<Box is='ul' overflow='hidden' height='356px' flexGrow={1} flexShrink={0} mi={-24}>\\n\\t\\t\\t<Virtuoso\\n\\t\\t\\t\\tdata={flattenedData || []}\\n\\t\\t\\t\\tcomputeItemKey={(index, room) => room?.id || index}\\n\\t\\t\\t\\toverscan={4}\\n\\t\\t\\t\\tcomponents={{\\n\\t\\t\\t\\t\\t// eslint-disable-next-line react/no-multi-comp\\n\\t\\t\\t\\t\\tFooter: () => (isFetchingNextPage ? <Throbber /> : null),\\n\\t\\t\\t\\t\\tScroller: VirtuosoScrollbars,\\n\\t\\t\\t\\t\\tEmptyPlaceholder: FederatedRoomListEmptyPlaceholder,\\n\\t\\t\\t\\t}}\\n\\t\\t\\t\\tendReached={isLoading || isFetchingNextPage ? () => undefined : () => fetchNextPage()}\\n\\t\\t\\t\\titemContent={(_, room) => (\\n\\t\\t\\t\\t\\t<FederatedRoomListItem onClickJoin={() => onClickJoin(room)} {...room} disabled={isLoadingMutation} key={room.id} />\\n\\t\\t\\t\\t)}\\n\\t\\t\\t/>\\n\\t\\t</Box>\\n\\t);\\n};\\n\\nexport default FederatedRoomList;\\n\",null],\"names\":[\"_extends\",\"Throbber\",\"Box\",\"useSetModal\",\"useEndpoint\",\"useToastMessageDispatch\",\"useMutation\",\"React\",\"useTranslation\",\"Virtuoso\",\"VirtuosoScrollbars\",\"roomCoordinator\",\"FederatedRoomListEmptyPlaceholder\",\"FederatedRoomListItem\",\"useInfiniteFederationSearchPublicRooms\",\"module\",\"link\",\"default\",\"v\",\"exportDefault\",\"_ref\",\"serverName\",\"roomName\",\"count\",\"joinExternalPublicRoom\",\"setModal\",\"t\",\"dispatchToastMessage\",\"data\",\"isLoading\",\"isFetchingNextPage\",\"fetchNextPage\",\"mutate\",\"onClickJoin\",\"isLoadingMutation\",\"_ref2\",\"id\",\"pageToken\",\"externalRoomId\",\"onSuccess\",\"_\",\"type\",\"message\",\"name\",\"onError\",\"error\",\"_ref3\",\"Error\",\"openRouteLink\",\"rid\",\"createElement\",\"flattenedData\",\"pages\",\"flatMap\",\"page\",\"rooms\",\"is\",\"overflow\",\"height\",\"flexGrow\",\"flexShrink\",\"mi\",\"computeItemKey\",\"index\",\"room\",\"overscan\",\"components\",\"Footer\",\"Scroller\",\"EmptyPlaceholder\",\"endReached\",\"undefined\",\"itemContent\",\"disabled\",\"key\"],\"mappings\":\"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\"}"}