{"code":"function module(e,t,r){let i,d,l,u,s,o;r.link(\"meteor/meteor\",{Meteor(e){i=e}},0),r.link(\"meteor/tracker\",{Tracker(e){d=e}},1),r.link(\"../../app/models/client\",{UserRoles(e){l=e},ChatMessage(e){u=e}},2),r.link(\"../../app/utils/client/lib/SDKClient\",{sdk(e){s=e}},3),r.link(\"../lib/toast\",{dispatchToastMessage(e){o=e}},4),i.startup(()=>{d.autorun(()=>{i.userId()&&(s.call(\"getUserRoles\").then(e=>{for(let t of e)l.upsert({_id:t._id},t)}).catch(e=>{o({type:\"error\",message:e})}),s.stream(\"notify-logged\",[\"roles-change\"],e=>{if(\"added\"===e.type){if(!e.scope){if(!e.u)return;l.upsert({_id:e.u._id},{$addToSet:{roles:e._id},$set:{username:e.u.username}}),u.update({\"u._id\":e.u._id},{$addToSet:{roles:e._id}},{multi:!0})}return}if(\"removed\"===e.type){if(!e.scope){if(!e.u)return;l.update({_id:e.u._id},{$pull:{roles:e._id}}),u.update({\"u._id\":e.u._id},{$pull:{roles:e._id}},{multi:!0})}return}\"changed\"===e.type&&u.update({roles:e._id},{$inc:{rerender:1}},{multi:!0})}))})})}","map":"{\"version\":3,\"sources\":[\"client/startup/userRoles.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { UserRoles, ChatMessage } from '../../app/models/client';\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\nimport { dispatchToastMessage } from '../lib/toast';\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(() => {\\n\\t\\tif (Meteor.userId()) {\\n\\t\\t\\tsdk\\n\\t\\t\\t\\t.call('getUserRoles')\\n\\t\\t\\t\\t.then((results) => {\\n\\t\\t\\t\\t\\tfor (const record of results) {\\n\\t\\t\\t\\t\\t\\tUserRoles.upsert({ _id: record._id }, record);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t})\\n\\t\\t\\t\\t.catch((error) => {\\n\\t\\t\\t\\t\\tdispatchToastMessage({ type: 'error', message: error });\\n\\t\\t\\t\\t});\\n\\n\\t\\t\\tsdk.stream('notify-logged', ['roles-change'], (role) => {\\n\\t\\t\\t\\tif (role.type === 'added') {\\n\\t\\t\\t\\t\\tif (!role.scope) {\\n\\t\\t\\t\\t\\t\\tif (!role.u) {\\n\\t\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\tUserRoles.upsert({ _id: role.u._id }, { $addToSet: { roles: role._id }, $set: { username: role.u.username } });\\n\\t\\t\\t\\t\\t\\tChatMessage.update({ 'u._id': role.u._id }, { $addToSet: { roles: role._id } }, { multi: true });\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (role.type === 'removed') {\\n\\t\\t\\t\\t\\tif (!role.scope) {\\n\\t\\t\\t\\t\\t\\tif (!role.u) {\\n\\t\\t\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\tUserRoles.update({ _id: role.u._id }, { $pull: { roles: role._id } });\\n\\t\\t\\t\\t\\t\\tChatMessage.update({ 'u._id': role.u._id }, { $pull: { roles: role._id } }, { multi: true });\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\treturn;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (role.type === 'changed') {\\n\\t\\t\\t\\t\\tChatMessage.update({ roles: role._id }, { $inc: { rerender: 1 } }, { multi: true });\\n\\t\\t\\t\\t}\\n\\t\\t\\t});\\n\\t\\t}\\n\\t});\\n});\\n\",null],\"names\":[\"Meteor\",\"Tracker\",\"UserRoles\",\"ChatMessage\",\"sdk\",\"dispatchToastMessage\",\"module\",\"link\",\"v\",\"startup\",\"autorun\",\"userId\",\"call\",\"then\",\"results\",\"record\",\"upsert\",\"_id\",\"catch\",\"error\",\"type\",\"message\",\"stream\",\"role\",\"scope\",\"u\",\"$addToSet\",\"roles\",\"$set\",\"username\",\"update\",\"multi\",\"$pull\",\"$inc\",\"rerender\"],\"mappings\":\"2BAAAA,EAAuCC,EAAAC,EAAAC,EAAAC,EAAAC,EAA9BC,EAAQC,IAAA,CAAM,gBAAgB,CAAAP,OAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,iBAAA,CAAAN,QAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,0BAAA,CAAAL,UAAAM,CAAA,EAAAN,EAAAM,CAAA,EAAAL,YAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,uCAAA,CAAAH,IAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAAAF,EAAAC,IAAA,CAAA,eAAA,CAAAF,qBAAAG,CAAA,EAAAH,EAAAG,CAAA,CAAA,EAAA,GAOvCR,EAAOS,OAAO,CAAC,KACdR,EAAQS,OAAO,CAAC,KACXV,EAAOW,MAAM,KAChBP,EACEQ,IAAI,CAAC,gBACLC,IAAI,CAAEC,IACN,IAAK,IAAMC,KAAUD,EACpBZ,EAAUc,MAAM,CAAC,CAAEC,IAAKF,EAAOE,GAAAA,AAAG,EAAIF,EAExC,GACCG,KAAK,CAAEC,IACPd,EAAqB,CAAEe,KAAM,QAASC,QAASF,CAAK,EACrD,GAEDf,EAAIkB,MAAM,CAAC,gBAAiB,CAAC,eAAe,CAAGC,IAC9C,GAAIA,AAAc,UAAdA,EAAKH,IAAI,CAAc,CAC1B,GAAI,CAACG,EAAKC,KAAK,CAAE,CAChB,GAAI,CAACD,EAAKE,CAAC,CACV,OAEDvB,EAAUc,MAAM,CAAC,CAAEC,IAAKM,EAAKE,CAAC,CAACR,GAAAA,AAAG,EAAI,CAAES,UAAW,CAAEC,MAAOJ,EAAKN,GAAAA,AAAG,EAAIW,KAAM,CAAEC,SAAUN,EAAKE,CAAC,CAACI,QAAAA,AAAQ,CAAE,GAC3G1B,EAAY2B,MAAM,CAAC,CAAE,QAASP,EAAKE,CAAC,CAACR,GAAAA,AAAG,EAAI,CAAES,UAAW,CAAEC,MAAOJ,EAAKN,GAAAA,AAAG,CAAE,EAAI,CAAEc,MAAO,CAAA,CAAI,EAC9F,CAEA,MACD,CAEA,GAAIR,AAAc,YAAdA,EAAKH,IAAI,CAAgB,CAC5B,GAAI,CAACG,EAAKC,KAAK,CAAE,CAChB,GAAI,CAACD,EAAKE,CAAC,CACV,OAEDvB,EAAU4B,MAAM,CAAC,CAAEb,IAAKM,EAAKE,CAAC,CAACR,GAAAA,AAAG,EAAI,CAAEe,MAAO,CAAEL,MAAOJ,EAAKN,GAAAA,AAAG,CAAE,GAClEd,EAAY2B,MAAM,CAAC,CAAE,QAASP,EAAKE,CAAC,CAACR,GAAAA,AAAG,EAAI,CAAEe,MAAO,CAAEL,MAAOJ,EAAKN,GAAAA,AAAG,CAAE,EAAI,CAAEc,MAAO,CAAA,CAAI,EAC1F,CAEA,MACD,CAEkB,YAAdR,EAAKH,IAAI,EACZjB,EAAY2B,MAAM,CAAC,CAAEH,MAAOJ,EAAKN,GAAAA,AAAG,EAAI,CAAEgB,KAAM,CAAEC,SAAU,CAAC,CAAE,EAAI,CAAEH,MAAO,CAAA,CAAI,EAElF,GAEF,EACD\"}"}