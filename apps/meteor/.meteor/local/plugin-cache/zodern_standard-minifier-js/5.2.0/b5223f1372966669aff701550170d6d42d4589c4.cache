{"code":"function module(e,n,t){var r,a,i,u,c,l,o,s,f,m;t.link(\"@babel/runtime/regenerator\",{default:function(e){r=e}},0),t.link(\"@rocket.chat/ui-contexts\",{useSetting:function(e){a=e},useUserId:function(e){i=e}},0),t.link(\"@tanstack/react-query\",{useQuery:function(e){u=e}},1),t.link(\"react\",{default:function(e){c=e},useMemo:function(e){l=e}},2),t.link(\"../../../app/livechat/client/externalFrame/crypto\",{encrypt:function(e){o=e},getKeyFromString:function(e){s=e}},3),t.link(\"../../../app/utils/client/lib/SDKClient\",{sdk:function(e){f=e}},4),t.link(\"../room/contexts/RoomContext\",{useRoom:function(e){m=e}},5),t.exportDefault(function(){var e=i(),n=m(),t=(f.rest.getCredentials()||{})[\"X-Auth-Token\"],p=a(\"Omnichannel_External_Frame_Encryption_JWK\"),d=a(\"Omnichannel_External_Frame_URL\"),x=u([\"externalFrame\",p,t],function(){return r.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!p||!t)){e.next=2;break}return e.abrupt(\"return\",\"\");case 2:return e.t0=o,e.t1=t,e.next=6,r.awrap(s(p));case 6:return e.t2=e.sent,e.abrupt(\"return\",(0,e.t0)(e.t1,e.t2));case 8:case\"end\":return e.stop()}},null,null,null,Promise)}),k=l(function(){if(!d||!e||!n._id||!t||!x.data)return\"\";var r=new URL(d);return r.searchParams.append(\"uid\",e),r.searchParams.append(\"rid\",n._id),r.searchParams.append(\"t\",t),r.toString()},[d,e,n._id,t,x.data]);return k?c.createElement(\"div\",{className:\"flex-nav\"},c.createElement(\"iframe\",{title:\"external-frame\",className:\"external-frame\",src:k})):null})}","map":"{\"version\":3,\"sources\":[\"client/views/omnichannel/ExternalFrameContainer.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { useSetting, useUserId } from '@rocket.chat/ui-contexts';\\nimport { useQuery } from '@tanstack/react-query';\\nimport React, { useMemo } from 'react';\\n\\nimport { encrypt, getKeyFromString } from '../../../app/livechat/client/externalFrame/crypto';\\nimport { sdk } from '../../../app/utils/client/lib/SDKClient';\\nimport { useRoom } from '../room/contexts/RoomContext';\\n\\nfunction ExternalFrameContainer() {\\n\\tconst uid = useUserId();\\n\\tconst room = useRoom();\\n\\tconst { 'X-Auth-Token': authToken } = sdk.rest.getCredentials() || {};\\n\\tconst keyStr = useSetting<string>('Omnichannel_External_Frame_Encryption_JWK');\\n\\tconst frameURLSetting = useSetting<string>('Omnichannel_External_Frame_URL');\\n\\n\\tconst token = useQuery(['externalFrame', keyStr, authToken], async () => {\\n\\t\\tif (!keyStr || !authToken) {\\n\\t\\t\\treturn '';\\n\\t\\t}\\n\\t\\treturn encrypt(authToken, await getKeyFromString(keyStr));\\n\\t});\\n\\n\\tconst externalFrameUrl = useMemo(() => {\\n\\t\\tif (!frameURLSetting || !uid || !room._id || !authToken || !token.data) {\\n\\t\\t\\treturn '';\\n\\t\\t}\\n\\t\\tconst frameURL = new URL(frameURLSetting);\\n\\n\\t\\tframeURL.searchParams.append('uid', uid);\\n\\t\\tframeURL.searchParams.append('rid', room._id);\\n\\t\\tframeURL.searchParams.append('t', authToken);\\n\\n\\t\\treturn frameURL.toString();\\n\\t}, [frameURLSetting, uid, room._id, authToken, token.data]);\\n\\n\\tif (!externalFrameUrl) {\\n\\t\\treturn null;\\n\\t}\\n\\n\\treturn (\\n\\t\\t<div className='flex-nav'>\\n\\t\\t\\t<iframe title='external-frame' className='external-frame' src={externalFrameUrl} />\\n\\t\\t</div>\\n\\t);\\n}\\n\\nexport default ExternalFrameContainer;\\n\",null],\"names\":[\"_regeneratorRuntime\",\"useSetting\",\"useUserId\",\"useQuery\",\"React\",\"useMemo\",\"encrypt\",\"getKeyFromString\",\"sdk\",\"useRoom\",\"module\",\"link\",\"default\",\"v\",\"exportDefault\",\"uid\",\"room\",\"authToken\",\"_ref\",\"rest\",\"getCredentials\",\"keyStr\",\"frameURLSetting\",\"token\",\"async\",\"_context\",\"prev\",\"next\",\"abrupt\",\"t0\",\"t1\",\"awrap\",\"t2\",\"sent\",\"stop\",\"Promise\",\"externalFrameUrl\",\"_id\",\"data\",\"frameURL\",\"URL\",\"searchParams\",\"append\",\"toString\",\"createElement\",\"className\",\"title\",\"src\"],\"mappings\":\"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\"}"}