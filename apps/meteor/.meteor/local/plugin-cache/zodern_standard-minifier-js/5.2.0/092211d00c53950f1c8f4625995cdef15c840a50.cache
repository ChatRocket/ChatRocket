{"code":"function module(e,n,t){t.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){i=e}},0),t.export({DirectMessageRoomType:function(){return h}}),t.link(\"@rocket.chat/core-typings\",{isRoomFederated:function(e){a=e}},0),t.link(\"meteor/meteor\",{Meteor:function(e){r=e}},1),t.link(\"../../../../app/authorization/client\",{hasAtLeastOnePermission:function(e){o=e}},2),t.link(\"../../../../app/models/client\",{Subscriptions:function(e){u=e},Users:function(e){s=e},ChatRoom:function(e){c=e}},3),t.link(\"../../../../app/settings/client\",{settings:function(e){l=e}},4),t.link(\"../../../../app/utils/client\",{getUserPreference:function(e){f=e}},5),t.link(\"../../../../app/utils/client/getAvatarURL\",{getAvatarURL:function(e){m=e}},6),t.link(\"../../../../app/utils/client/getUserAvatarURL\",{getUserAvatarURL:function(e){d=e}},7),t.link(\"../../../../definition/IRoomTypeConfig\",{RoomSettingsEnum:function(e){g=e},RoomMemberActions:function(e){p=e},UiTextContext:function(e){v=e}},8),t.link(\"../../../../lib/rooms/roomTypes/direct\",{getDirectMessageRoomType:function(e){E=e}},9),t.link(\"../../federation/Federation\",{\"*\":function(e){R=e}},10),t.link(\"../roomCoordinator\",{roomCoordinator:function(e){_=e}},11);var i,a,r,o,u,s,c,l,f,m,d,g,p,v,E,R,_,h=E(_);_.add(i(i({},h),{},{label:\"Direct_Messages\"}),{allowRoomSettingChange:function(e,n){if(a(e))return R.isRoomSettingAllowed(e,n);switch(n){case g.TYPE:case g.NAME:case g.SYSTEM_MESSAGES:case g.DESCRIPTION:case g.READ_ONLY:case g.REACT_WHEN_READ_ONLY:case g.ARCHIVE_OR_UNARCHIVE:case g.JOIN_CODE:return!1;case g.E2E:return!0===l.get(\"E2E_Enable\");default:return!0}},allowMemberAction:function(e,n,t,i){return a(e)?R.actionAllowed(e,n,t,i):n===p.BLOCK&&!this.isGroupChat(e)},roomName:function(e){var n=e.fname||e.name?{fname:e.fname,name:e.name}:e._id?u.findOne({rid:e._id}):void 0;return n?l.get(\"UI_Use_Real_Name\")&&n.fname?n.fname:n.name:void 0},isGroupChat:function(e){var n;return((null==e?void 0:null===(n=e.uids)||void 0===n?void 0:n.length)||0)>2},getUiText:function(e){switch(e){case v.HIDE_WARNING:return\"Hide_Private_Warning\";case v.LEAVE_WARNING:return\"Leave_Private_Warning\";default:return\"\"}},condition:function(){return f(r.userId(),\"sidebarGroupByType\")&&o([\"view-d-room\",\"view-joined-room\"])},getAvatarPath:function(e){if(!e)return\"\";if(e.name&&e.avatarETag)return d(e.name,e.avatarETag);if(this.isGroupChat(e))return m({username:(e.uids||[]).length+(e.usernames||[]).join(),cache:e.avatarETag});var n=u.findOne({rid:e._id},{fields:{name:1}});if(null!=n&&n.name){var t=s.findOne({username:n.name},{fields:{username:1,avatarETag:1}});return d((null==t?void 0:t.username)||n.name,null==t?void 0:t.avatarETag)}return d(e.name||this.roomName(e)||\"\")},getIcon:function(e){return a(e)?\"globe\":this.isGroupChat(e)?\"balloon\":\"at\"},extractOpenRoomParams:function(e){return{type:\"d\",reference:e.rid}},findRoom:function(e){var n=u.findOne({t:\"d\",$or:[{name:e},{rid:e}]});if(null!=n&&n.rid)return c.findOne(n.rid)}})}","map":"{\"version\":3,\"sources\":[\"client/lib/rooms/roomTypes/direct.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { AtLeast, IRoom, ISubscription, IUser } from '@rocket.chat/core-typings';\\nimport { isRoomFederated } from '@rocket.chat/core-typings';\\nimport { Meteor } from 'meteor/meteor';\\nimport type { Mongo } from 'meteor/mongo';\\n\\nimport { hasAtLeastOnePermission } from '../../../../app/authorization/client';\\nimport { Subscriptions, Users, ChatRoom } from '../../../../app/models/client';\\nimport { settings } from '../../../../app/settings/client';\\nimport { getUserPreference } from '../../../../app/utils/client';\\nimport { getAvatarURL } from '../../../../app/utils/client/getAvatarURL';\\nimport { getUserAvatarURL } from '../../../../app/utils/client/getUserAvatarURL';\\nimport type { IRoomTypeClientDirectives } from '../../../../definition/IRoomTypeConfig';\\nimport { RoomSettingsEnum, RoomMemberActions, UiTextContext } from '../../../../definition/IRoomTypeConfig';\\nimport { getDirectMessageRoomType } from '../../../../lib/rooms/roomTypes/direct';\\nimport * as Federation from '../../federation/Federation';\\nimport { roomCoordinator } from '../roomCoordinator';\\n\\nexport const DirectMessageRoomType = getDirectMessageRoomType(roomCoordinator);\\n\\nroomCoordinator.add(\\n\\t{\\n\\t\\t...DirectMessageRoomType,\\n\\t\\tlabel: 'Direct_Messages',\\n\\t},\\n\\t{\\n\\t\\tallowRoomSettingChange(_room, setting) {\\n\\t\\t\\tif (isRoomFederated(_room as IRoom)) {\\n\\t\\t\\t\\treturn Federation.isRoomSettingAllowed(_room, setting);\\n\\t\\t\\t}\\n\\t\\t\\tswitch (setting) {\\n\\t\\t\\t\\tcase RoomSettingsEnum.TYPE:\\n\\t\\t\\t\\tcase RoomSettingsEnum.NAME:\\n\\t\\t\\t\\tcase RoomSettingsEnum.SYSTEM_MESSAGES:\\n\\t\\t\\t\\tcase RoomSettingsEnum.DESCRIPTION:\\n\\t\\t\\t\\tcase RoomSettingsEnum.READ_ONLY:\\n\\t\\t\\t\\tcase RoomSettingsEnum.REACT_WHEN_READ_ONLY:\\n\\t\\t\\t\\tcase RoomSettingsEnum.ARCHIVE_OR_UNARCHIVE:\\n\\t\\t\\t\\tcase RoomSettingsEnum.JOIN_CODE:\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\tcase RoomSettingsEnum.E2E:\\n\\t\\t\\t\\t\\treturn settings.get('E2E_Enable') === true;\\n\\t\\t\\t\\tdefault:\\n\\t\\t\\t\\t\\treturn true;\\n\\t\\t\\t}\\n\\t\\t},\\n\\n\\t\\tallowMemberAction(room, action, showingUserId, userSubscription) {\\n\\t\\t\\tif (isRoomFederated(room as IRoom)) {\\n\\t\\t\\t\\treturn Federation.actionAllowed(room, action, showingUserId, userSubscription);\\n\\t\\t\\t}\\n\\t\\t\\tswitch (action) {\\n\\t\\t\\t\\tcase RoomMemberActions.BLOCK:\\n\\t\\t\\t\\t\\treturn !this.isGroupChat(room);\\n\\t\\t\\t\\tdefault:\\n\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t}\\n\\t\\t},\\n\\n\\t\\troomName(roomData) {\\n\\t\\t\\tconst subscription = ((): { fname?: string; name?: string } | undefined => {\\n\\t\\t\\t\\tif (roomData.fname || roomData.name) {\\n\\t\\t\\t\\t\\treturn {\\n\\t\\t\\t\\t\\t\\tfname: roomData.fname,\\n\\t\\t\\t\\t\\t\\tname: roomData.name,\\n\\t\\t\\t\\t\\t};\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tif (!roomData._id) {\\n\\t\\t\\t\\t\\treturn undefined;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\treturn Subscriptions.findOne({ rid: roomData._id });\\n\\t\\t\\t})();\\n\\n\\t\\t\\tif (!subscription) {\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tif (settings.get('UI_Use_Real_Name') && subscription.fname) {\\n\\t\\t\\t\\treturn subscription.fname;\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn subscription.name;\\n\\t\\t},\\n\\n\\t\\tisGroupChat(room) {\\n\\t\\t\\treturn (room?.uids?.length || 0) > 2;\\n\\t\\t},\\n\\n\\t\\tgetUiText(context) {\\n\\t\\t\\tswitch (context) {\\n\\t\\t\\t\\tcase UiTextContext.HIDE_WARNING:\\n\\t\\t\\t\\t\\treturn 'Hide_Private_Warning';\\n\\t\\t\\t\\tcase UiTextContext.LEAVE_WARNING:\\n\\t\\t\\t\\t\\treturn 'Leave_Private_Warning';\\n\\t\\t\\t\\tdefault:\\n\\t\\t\\t\\t\\treturn '';\\n\\t\\t\\t}\\n\\t\\t},\\n\\n\\t\\tcondition() {\\n\\t\\t\\tconst groupByType = getUserPreference(Meteor.userId(), 'sidebarGroupByType');\\n\\t\\t\\treturn groupByType && hasAtLeastOnePermission(['view-d-room', 'view-joined-room']);\\n\\t\\t},\\n\\n\\t\\tgetAvatarPath(room) {\\n\\t\\t\\tif (!room) {\\n\\t\\t\\t\\treturn '';\\n\\t\\t\\t}\\n\\n\\t\\t\\t// if coming from sidenav search\\n\\t\\t\\tif (room.name && room.avatarETag) {\\n\\t\\t\\t\\treturn getUserAvatarURL(room.name, room.avatarETag);\\n\\t\\t\\t}\\n\\n\\t\\t\\tif (this.isGroupChat(room)) {\\n\\t\\t\\t\\treturn getAvatarURL({\\n\\t\\t\\t\\t\\tusername: (room.uids || []).length + (room.usernames || []).join(),\\n\\t\\t\\t\\t\\tcache: room.avatarETag,\\n\\t\\t\\t\\t}) as string;\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst sub = Subscriptions.findOne({ rid: room._id }, { fields: { name: 1 } });\\n\\t\\t\\tif (sub?.name) {\\n\\t\\t\\t\\tconst user = Users.findOne({ username: sub.name }, { fields: { username: 1, avatarETag: 1 } }) as IUser | undefined;\\n\\t\\t\\t\\treturn getUserAvatarURL(user?.username || sub.name, user?.avatarETag);\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn getUserAvatarURL(room.name || this.roomName(room) || '');\\n\\t\\t},\\n\\n\\t\\tgetIcon(room) {\\n\\t\\t\\tif (isRoomFederated(room)) {\\n\\t\\t\\t\\treturn 'globe';\\n\\t\\t\\t}\\n\\n\\t\\t\\tif (this.isGroupChat(room)) {\\n\\t\\t\\t\\treturn 'balloon';\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn 'at';\\n\\t\\t},\\n\\n\\t\\textractOpenRoomParams({ rid }) {\\n\\t\\t\\treturn { type: 'd', reference: rid };\\n\\t\\t},\\n\\n\\t\\tfindRoom(identifier) {\\n\\t\\t\\tconst query: Mongo.Selector<ISubscription> = {\\n\\t\\t\\t\\tt: 'd',\\n\\t\\t\\t\\t$or: [{ name: identifier }, { rid: identifier }],\\n\\t\\t\\t};\\n\\n\\t\\t\\tconst subscription = Subscriptions.findOne(query);\\n\\t\\t\\tif (subscription?.rid) {\\n\\t\\t\\t\\treturn ChatRoom.findOne(subscription.rid);\\n\\t\\t\\t}\\n\\t\\t},\\n\\t} as AtLeast<IRoomTypeClientDirectives, 'isGroupChat' | 'roomName'>,\\n);\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_objectSpread\",\"export\",\"DirectMessageRoomType\",\"isRoomFederated\",\"Meteor\",\"hasAtLeastOnePermission\",\"Subscriptions\",\"Users\",\"ChatRoom\",\"settings\",\"getUserPreference\",\"getAvatarURL\",\"getUserAvatarURL\",\"RoomSettingsEnum\",\"RoomMemberActions\",\"UiTextContext\",\"getDirectMessageRoomType\",\"Federation\",\"roomCoordinator\",\"add\",\"label\",\"allowRoomSettingChange\",\"_room\",\"setting\",\"isRoomSettingAllowed\",\"TYPE\",\"NAME\",\"SYSTEM_MESSAGES\",\"DESCRIPTION\",\"READ_ONLY\",\"REACT_WHEN_READ_ONLY\",\"ARCHIVE_OR_UNARCHIVE\",\"JOIN_CODE\",\"E2E\",\"get\",\"allowMemberAction\",\"room\",\"action\",\"showingUserId\",\"userSubscription\",\"actionAllowed\",\"BLOCK\",\"isGroupChat\",\"roomName\",\"roomData\",\"subscription\",\"fname\",\"name\",\"_id\",\"findOne\",\"rid\",\"_room$uids\",\"uids\",\"length\",\"getUiText\",\"context\",\"HIDE_WARNING\",\"LEAVE_WARNING\",\"condition\",\"groupByType\",\"userId\",\"getAvatarPath\",\"avatarETag\",\"username\",\"usernames\",\"join\",\"cache\",\"sub\",\"fields\",\"user\",\"getIcon\",\"extractOpenRoomParams\",\"_ref\",\"type\",\"reference\",\"findRoom\",\"identifier\",\"t\",\"$or\"],\"mappings\":\"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\"}"}