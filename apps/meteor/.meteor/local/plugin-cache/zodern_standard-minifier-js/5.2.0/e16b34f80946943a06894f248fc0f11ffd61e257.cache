{"code":"function module(e,i,n){let t,r,d,o,a;n.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){t=e}},0),n.link(\"meteor/meteor\",{Meteor(e){r=e}},0),n.link(\"../../app/models/client\",{ChatMessage(e){d=e}},1),n.link(\"../../app/ui-cached-collection/client\",{CachedCollectionManager(e){o=e}},2),n.link(\"../../app/utils/client/lib/SDKClient\",{sdk(e){a=e}},3),r.startup(()=>{Tracker.autorun(()=>{r.userId()&&a.stream(\"notify-user\",[\"\".concat(r.userId(),\"/message\")],e=>(e.u=e.u||{username:\"rocket.cat\"},e.private=!0,d.upsert({_id:e._id},e)))}),o.onLogin(()=>{a.stream(\"notify-user\",[\"\".concat(r.userId(),\"/subscriptions-changed\")],(e,i)=>{d.update(t({rid:i.rid},\"ignored\"in i&&i.ignored?{\"u._id\":{$nin:i.ignored}}:{ignored:{$exists:!0}}),{$unset:{ignored:!0}},{multi:!0}),\"ignored\"in i&&i.ignored&&d.update({rid:i.rid,t:{$ne:\"command\"},\"u._id\":{$in:i.ignored}},{$set:{ignored:!0}},{multi:!0})})})})}","map":"{\"version\":3,\"sources\":[\"client/startup/incomingMessages.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IMessage } from '@rocket.chat/core-typings';\\nimport { Meteor } from 'meteor/meteor';\\n\\nimport { ChatMessage } from '../../app/models/client';\\nimport { CachedCollectionManager } from '../../app/ui-cached-collection/client';\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\n\\nMeteor.startup(() => {\\n\\tTracker.autorun(() => {\\n\\t\\tif (!Meteor.userId()) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\t// Only event I found triggers this is from ephemeral messages\\n\\t\\t// Other types of messages come from another stream\\n\\t\\tsdk.stream('notify-user', [`${Meteor.userId()}/message`], (msg: IMessage) => {\\n\\t\\t\\tmsg.u = msg.u || { username: 'rocket.cat' };\\n\\t\\t\\tmsg.private = true;\\n\\n\\t\\t\\treturn ChatMessage.upsert({ _id: msg._id }, msg);\\n\\t\\t});\\n\\t});\\n\\n\\tCachedCollectionManager.onLogin(() => {\\n\\t\\tsdk.stream('notify-user', [`${Meteor.userId()}/subscriptions-changed`], (_action, sub) => {\\n\\t\\t\\tChatMessage.update(\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\trid: sub.rid,\\n\\t\\t\\t\\t\\t...('ignored' in sub && sub.ignored ? { 'u._id': { $nin: sub.ignored } } : { ignored: { $exists: true } }),\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\t{ $unset: { ignored: true } },\\n\\t\\t\\t\\t{ multi: true },\\n\\t\\t\\t);\\n\\t\\t\\tif ('ignored' in sub && sub.ignored) {\\n\\t\\t\\t\\tChatMessage.update(\\n\\t\\t\\t\\t\\t{ 'rid': sub.rid, 't': { $ne: 'command' }, 'u._id': { $in: sub.ignored } },\\n\\t\\t\\t\\t\\t{ $set: { ignored: true } },\\n\\t\\t\\t\\t\\t{ multi: true },\\n\\t\\t\\t\\t);\\n\\t\\t\\t}\\n\\t\\t});\\n\\t});\\n});\\n\",null],\"names\":[\"_objectSpread\",\"Meteor\",\"ChatMessage\",\"CachedCollectionManager\",\"sdk\",\"module\",\"link\",\"default\",\"v\",\"startup\",\"Tracker\",\"autorun\",\"userId\",\"stream\",\"concat\",\"msg\",\"u\",\"username\",\"private\",\"upsert\",\"_id\",\"onLogin\",\"_action\",\"sub\",\"update\",\"rid\",\"ignored\",\"$nin\",\"$exists\",\"$unset\",\"multi\",\"$ne\",\"$in\",\"$set\"],\"mappings\":\"2BACAA,EAAAC,EAAuCC,EAAAC,EAAAC,EAAtBC,EAAMC,IAAA,CAAA,uCAAgB,CAAAC,QAAAC,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAA9BH,EAAQC,IAAA,CAAM,gBAAgB,CAAAL,OAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,0BAAA,CAAAJ,YAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,wCAAA,CAAAH,wBAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAAAH,EAAAC,IAAA,CAAA,uCAAA,CAAAF,IAAAI,CAAA,EAAAJ,EAAAI,CAAA,CAAA,EAAA,GAMvCP,EAAOQ,OAAO,CAAC,KACdC,QAAQC,OAAO,CAAC,KACVV,EAAOW,MAAM,IAMlBR,EAAIS,MAAM,CAAC,cAAe,CAAA,GAAAC,MAAA,CAAIb,EAAOW,MAAM,GAAE,YAAW,CAAGG,IAC1DA,EAAIC,CAAC,CAAGD,EAAIC,CAAC,EAAI,CAAEC,SAAU,YAAY,EACzCF,EAAIG,OAAO,CAAG,CAAA,EAEPhB,EAAYiB,MAAM,CAAC,CAAEC,IAAKL,EAAIK,GAAAA,AAAG,EAAIL,IAE9C,GAEAZ,EAAwBkB,OAAO,CAAC,KAC/BjB,EAAIS,MAAM,CAAC,cAAe,CAAA,GAAAC,MAAA,CAAIb,EAAOW,MAAM,GAAE,0BAAyB,CAAE,CAACU,EAASC,KACjFrB,EAAYsB,MAAM,CAAAxB,EAAA,CAEhByB,IAAKF,EAAIE,GAAAA,AAAG,EACR,YAAaF,GAAOA,EAAIG,OAAO,CAAG,CAAE,QAAS,CAAEC,KAAMJ,EAAIG,OAAAA,AAAO,CAAE,EAAK,CAAEA,QAAS,CAAEE,QAAS,CAAA,CAAI,CAAE,GAExG,CAAEC,OAAQ,CAAEH,QAAS,CAAA,CAAI,CAAE,EAC3B,CAAEI,MAAO,CAAA,CAAI,GAEV,YAAaP,GAAOA,EAAIG,OAAO,EAClCxB,EAAYsB,MAAM,CACjB,CAAE,IAAOD,EAAIE,GAAG,CAAE,EAAK,CAAEM,IAAK,SAAS,EAAI,QAAS,CAAEC,IAAKT,EAAIG,OAAAA,AAAO,CAAE,EACxE,CAAEO,KAAM,CAAEP,QAAS,CAAA,CAAI,CAAE,EACzB,CAAEI,MAAO,CAAA,CAAI,EAGhB,EACD,EACD\"}"}