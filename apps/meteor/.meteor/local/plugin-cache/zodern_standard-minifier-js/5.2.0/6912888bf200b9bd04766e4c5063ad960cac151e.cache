{"code":"function module(e,n,i){var o,t,s,l,r,u,c,a,d,f,k;i.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){o=e}},0),i.link(\"@rocket.chat/fuselage\",{Box:function(e){t=e}},0),i.link(\"@rocket.chat/ui-contexts\",{useUserId:function(e){s=e}},1),i.link(\"@rocket.chat/ui-voip\",{useVoipAPI:function(e){l=e},useVoipState:function(e){r=e}},2),i.link(\"react\",{default:function(e){u=e},useMemo:function(e){c=e}},3),i.link(\"react-i18next\",{useTranslation:function(e){a=e}},4),i.link(\"../../../views/room/composer/messageBox/hooks/useMediaPermissions\",{useMediaPermissions:function(e){d=e}},5),i.link(\"../../../views/room/contexts/RoomContext\",{useRoom:function(e){f=e}},6),i.link(\"../../useUserInfoQuery\",{useUserInfoQuery:function(e){k=e}},7),i.exportDefault(function(){var e=a().t,n=f().uids,i=void 0===n?[]:n,m=s(),h=d(\"microphone\"),_=o(h,1)[0],p=r(),v=p.isEnabled,x=p.isRegistered,g=p.isInCall,b=l().makeCall,w=c(function(){return i.filter(function(e){return e!==m})},[i,m]),I=w[0],E=k({userId:I},{enabled:!!I}),C=E.data,M=(C=void 0===C?{}:C).user,S=E.isLoading,U=!!(null!=M&&M.freeSwitchExtension),V=1===w.length,y=_||!V||!U||!x||g||S,P=c(function(){return _?e(\"Microphone_access_not_allowed\"):g?e(\"Unable_to_make_calls_while_another_is_ongoing\"):y?e(\"Voice_calling_disabled\"):\"\"},[y,g,_,e]);return c(function(){var n=[{id:\"start-voip-call\",icon:\"phone\",disabled:y,onClick:function(){return b(null==M?void 0:M.freeSwitchExtension)},content:u.createElement(t,{is:\"span\",title:P},e(\"Voice_call\"))}];return{items:v?n:[],groups:[\"direct\"],disabled:y,allowed:v,order:4}},[y,P,e,v,b,null==M?void 0:M.freeSwitchExtension])})}","map":"{\"version\":3,\"sources\":[\"client/hooks/roomActions/useStartCallRoomAction/useVoipMenuOptions.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { Box } from '@rocket.chat/fuselage';\\nimport type { GenericMenuItemProps } from '@rocket.chat/ui-client';\\nimport { useUserId } from '@rocket.chat/ui-contexts';\\nimport { useVoipAPI, useVoipState } from '@rocket.chat/ui-voip';\\nimport React, { useMemo } from 'react';\\nimport { useTranslation } from 'react-i18next';\\n\\nimport { useMediaPermissions } from '../../../views/room/composer/messageBox/hooks/useMediaPermissions';\\nimport { useRoom } from '../../../views/room/contexts/RoomContext';\\nimport { useUserInfoQuery } from '../../useUserInfoQuery';\\n\\nconst useVoipMenuOptions = () => {\\n\\tconst { t } = useTranslation();\\n\\tconst { uids = [] } = useRoom();\\n\\tconst ownUserId = useUserId();\\n\\n\\tconst [isMicPermissionDenied] = useMediaPermissions('microphone');\\n\\n\\tconst { isEnabled, isRegistered, isInCall } = useVoipState();\\n\\tconst { makeCall } = useVoipAPI();\\n\\n\\tconst members = useMemo(() => uids.filter((uid) => uid !== ownUserId), [uids, ownUserId]);\\n\\tconst remoteUserId = members[0];\\n\\n\\tconst { data: { user: remoteUser } = {}, isLoading } = useUserInfoQuery({ userId: remoteUserId }, { enabled: Boolean(remoteUserId) });\\n\\n\\tconst isRemoteRegistered = !!remoteUser?.freeSwitchExtension;\\n\\tconst isDM = members.length === 1;\\n\\n\\tconst disabled = isMicPermissionDenied || !isDM || !isRemoteRegistered || !isRegistered || isInCall || isLoading;\\n\\n\\tconst title = useMemo(() => {\\n\\t\\tif (isMicPermissionDenied) {\\n\\t\\t\\treturn t('Microphone_access_not_allowed');\\n\\t\\t}\\n\\n\\t\\tif (isInCall) {\\n\\t\\t\\treturn t('Unable_to_make_calls_while_another_is_ongoing');\\n\\t\\t}\\n\\n\\t\\treturn disabled ? t('Voice_calling_disabled') : '';\\n\\t}, [disabled, isInCall, isMicPermissionDenied, t]);\\n\\n\\treturn useMemo(() => {\\n\\t\\tconst items: GenericMenuItemProps[] = [\\n\\t\\t\\t{\\n\\t\\t\\t\\tid: 'start-voip-call',\\n\\t\\t\\t\\ticon: 'phone',\\n\\t\\t\\t\\tdisabled,\\n\\t\\t\\t\\tonClick: () => makeCall(remoteUser?.freeSwitchExtension as string),\\n\\t\\t\\t\\tcontent: (\\n\\t\\t\\t\\t\\t<Box is='span' title={title}>\\n\\t\\t\\t\\t\\t\\t{t('Voice_call')}\\n\\t\\t\\t\\t\\t</Box>\\n\\t\\t\\t\\t),\\n\\t\\t\\t},\\n\\t\\t];\\n\\n\\t\\treturn {\\n\\t\\t\\titems: isEnabled ? items : [],\\n\\t\\t\\tgroups: ['direct'] as const,\\n\\t\\t\\tdisabled,\\n\\t\\t\\tallowed: isEnabled,\\n\\t\\t\\torder: 4,\\n\\t\\t};\\n\\t}, [disabled, title, t, isEnabled, makeCall, remoteUser?.freeSwitchExtension]);\\n};\\n\\nexport default useVoipMenuOptions;\\n\",null],\"names\":[\"_slicedToArray\",\"Box\",\"useUserId\",\"useVoipAPI\",\"useVoipState\",\"React\",\"useMemo\",\"useTranslation\",\"useMediaPermissions\",\"useRoom\",\"useUserInfoQuery\",\"module\",\"link\",\"default\",\"v\",\"exportDefault\",\"t\",\"_useTranslation\",\"_useRoom$uids\",\"_useRoom\",\"uids\",\"ownUserId\",\"_useMediaPermissions\",\"isMicPermissionDenied\",\"_useMediaPermissions2\",\"_useVoipState\",\"isEnabled\",\"isRegistered\",\"isInCall\",\"makeCall\",\"_useVoipAPI\",\"members\",\"filter\",\"uid\",\"remoteUserId\",\"_useUserInfoQuery\",\"userId\",\"enabled\",\"Boolean\",\"_useUserInfoQuery$dat\",\"data\",\"remoteUser\",\"user\",\"isLoading\",\"isRemoteRegistered\",\"freeSwitchExtension\",\"isDM\",\"length\",\"disabled\",\"title\",\"items\",\"id\",\"icon\",\"onClick\",\"content\",\"createElement\",\"is\",\"groups\",\"allowed\",\"order\"],\"mappings\":\"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\"}"}