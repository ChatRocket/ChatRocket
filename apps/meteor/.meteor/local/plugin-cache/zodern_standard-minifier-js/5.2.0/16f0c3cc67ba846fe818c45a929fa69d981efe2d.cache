{"code":"function module(e,t,l){let n,a,r,o,c,s,u,i,m,d,p,g,h,f,y,E,k,S,b,C,F,x;let _=[\"goToNew\",\"close\",\"onChange\"];l.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){n=e}},0),l.link(\"@babel/runtime/helpers/objectWithoutProperties\",{default(e){a=e}},1),l.link(\"@rocket.chat/fuselage\",{Field(e){r=e},FieldLabel(e){o=e},FieldRow(e){c=e},TextInput(e){s=e},Box(e){u=e},Margins(e){i=e},Button(e){m=e},ButtonGroup(e){d=e},IconButton(e){p=e}},0),l.link(\"@rocket.chat/ui-contexts\",{useToastMessageDispatch(e){g=e},useMethod(e){h=e},useTranslation(e){f=e}},1),l.link(\"react\",{default(e){y=e},useState(e){E=e},useCallback(e){k=e}},2),l.link(\"../../../components/Contextualbar\",{ContextualbarScrollableContent(e){S=e},ContextualbarFooter(e){b=e}},3),l.link(\"../../../hooks/useSingleFileInput\",{useSingleFileInput(e){C=e}},4),l.link(\"./lib\",{validate(e){F=e},createSoundData(e){x=e}},5),l.exportDefault(e=>{let{goToNew:t,close:l,onChange:w}=e,v=a(e,_),B=f(),I=g(),[M,T]=E(\"\"),[D,N]=E(),R=h(\"uploadCustomSound\"),j=h(\"insertOrUpdateSound\"),U=k(e=>{N(e)},[]),[q]=C(U,\"audio/mp3\"),A=k(async(e,t)=>{let l=x(t,e),a=F(l,t);a.forEach(e=>{throw Error(B(\"Required_field\",{field:B(e)}))});try{let e=await j(l);if(!e)return;I({type:\"success\",message:B(\"Uploading_file\")});let a=new FileReader;return a.readAsBinaryString(t),a.onloadend=()=>{try{R(a.result,t.type,n(n({},l),{},{_id:e,random:Math.round(1e3*Math.random())})),I({type:\"success\",message:B(\"File_uploaded\")})}catch(e){(\"string\"==typeof e||e instanceof Error)&&I({type:\"error\",message:e})}},e}catch(e){(\"string\"==typeof e||e instanceof Error)&&I({type:\"error\",message:e})}},[I,j,B,R]),G=k(async()=>{try{let e=await A(M,D);e&&I({type:\"success\",message:B(\"Custom_Sound_Saved_Successfully\")}),e&&t(e),w()}catch(e){I({type:\"error\",message:e})}},[I,t,M,w,A,D,B]);return y.createElement(y.Fragment,null,y.createElement(S,v,y.createElement(r,null,y.createElement(o,null,B(\"Name\")),y.createElement(c,null,y.createElement(s,{value:M,onChange:e=>T(e.currentTarget.value),placeholder:B(\"Name\")}))),y.createElement(r,null,y.createElement(o,{alignSelf:\"stretch\"},B(\"Sound_File_mp3\")),y.createElement(u,{display:\"flex\",flexDirection:\"row\",mbs:\"none\",alignItems:\"center\"},y.createElement(i,{inline:4},y.createElement(p,{secondary:!0,small:!0,icon:\"upload\",onClick:q}),(null==D?void 0:D.name)||B(\"None\"))))),y.createElement(b,null,y.createElement(d,{stretch:!0},y.createElement(m,{onClick:l},B(\"Cancel\")),y.createElement(m,{primary:!0,onClick:G},B(\"Save\")))))})}","map":"{\"version\":3,\"sources\":[\"client/views/admin/customSounds/AddCustomSound.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { Field, FieldLabel, FieldRow, TextInput, Box, Margins, Button, ButtonGroup, IconButton } from '@rocket.chat/fuselage';\\nimport { useToastMessageDispatch, useMethod, useTranslation } from '@rocket.chat/ui-contexts';\\nimport type { ReactElement, FormEvent } from 'react';\\nimport React, { useState, useCallback } from 'react';\\n\\nimport { ContextualbarScrollableContent, ContextualbarFooter } from '../../../components/Contextualbar';\\nimport { useSingleFileInput } from '../../../hooks/useSingleFileInput';\\nimport { validate, createSoundData } from './lib';\\n\\ntype AddCustomSoundProps = {\\n\\tgoToNew: (_id: string) => () => void;\\n\\tclose: () => void;\\n\\tonChange: () => void;\\n};\\n\\nconst AddCustomSound = ({ goToNew, close, onChange, ...props }: AddCustomSoundProps): ReactElement => {\\n\\tconst t = useTranslation();\\n\\tconst dispatchToastMessage = useToastMessageDispatch();\\n\\n\\tconst [name, setName] = useState('');\\n\\tconst [sound, setSound] = useState<{ name: string }>();\\n\\n\\tconst uploadCustomSound = useMethod('uploadCustomSound');\\n\\tconst insertOrUpdateSound = useMethod('insertOrUpdateSound');\\n\\n\\tconst handleChangeFile = useCallback((soundFile) => {\\n\\t\\tsetSound(soundFile);\\n\\t}, []);\\n\\n\\tconst [clickUpload] = useSingleFileInput(handleChangeFile, 'audio/mp3');\\n\\n\\tconst saveAction = useCallback(\\n\\t\\tasync (name, soundFile): Promise<string | undefined> => {\\n\\t\\t\\tconst soundData = createSoundData(soundFile, name);\\n\\t\\t\\tconst validation = validate(soundData, soundFile) as Array<Parameters<typeof t>[0]>;\\n\\n\\t\\t\\tvalidation.forEach((invalidFieldName) => {\\n\\t\\t\\t\\tthrow new Error(t('Required_field', { field: t(invalidFieldName) }));\\n\\t\\t\\t});\\n\\n\\t\\t\\ttry {\\n\\t\\t\\t\\tconst soundId = await insertOrUpdateSound(soundData);\\n\\n\\t\\t\\t\\tif (!soundId) {\\n\\t\\t\\t\\t\\treturn undefined;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tdispatchToastMessage({ type: 'success', message: t('Uploading_file') });\\n\\n\\t\\t\\t\\tconst reader = new FileReader();\\n\\t\\t\\t\\treader.readAsBinaryString(soundFile);\\n\\t\\t\\t\\treader.onloadend = (): void => {\\n\\t\\t\\t\\t\\ttry {\\n\\t\\t\\t\\t\\t\\tuploadCustomSound(reader.result as string, soundFile.type, {\\n\\t\\t\\t\\t\\t\\t\\t...soundData,\\n\\t\\t\\t\\t\\t\\t\\t_id: soundId,\\n\\t\\t\\t\\t\\t\\t\\trandom: Math.round(Math.random() * 1000),\\n\\t\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\t\\tdispatchToastMessage({ type: 'success', message: t('File_uploaded') });\\n\\t\\t\\t\\t\\t} catch (error) {\\n\\t\\t\\t\\t\\t\\t(typeof error === 'string' || error instanceof Error) && dispatchToastMessage({ type: 'error', message: error });\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t};\\n\\t\\t\\t\\treturn soundId;\\n\\t\\t\\t} catch (error) {\\n\\t\\t\\t\\t(typeof error === 'string' || error instanceof Error) && dispatchToastMessage({ type: 'error', message: error });\\n\\t\\t\\t}\\n\\t\\t},\\n\\t\\t[dispatchToastMessage, insertOrUpdateSound, t, uploadCustomSound],\\n\\t);\\n\\n\\tconst handleSave = useCallback(async () => {\\n\\t\\ttry {\\n\\t\\t\\tconst result = await saveAction(name, sound);\\n\\t\\t\\tif (result) {\\n\\t\\t\\t\\tdispatchToastMessage({ type: 'success', message: t('Custom_Sound_Saved_Successfully') });\\n\\t\\t\\t}\\n\\t\\t\\tresult && goToNew(result);\\n\\t\\t\\tonChange();\\n\\t\\t} catch (error) {\\n\\t\\t\\tdispatchToastMessage({ type: 'error', message: error });\\n\\t\\t}\\n\\t}, [dispatchToastMessage, goToNew, name, onChange, saveAction, sound, t]);\\n\\n\\treturn (\\n\\t\\t<>\\n\\t\\t\\t<ContextualbarScrollableContent {...props}>\\n\\t\\t\\t\\t<Field>\\n\\t\\t\\t\\t\\t<FieldLabel>{t('Name')}</FieldLabel>\\n\\t\\t\\t\\t\\t<FieldRow>\\n\\t\\t\\t\\t\\t\\t<TextInput\\n\\t\\t\\t\\t\\t\\t\\tvalue={name}\\n\\t\\t\\t\\t\\t\\t\\tonChange={(e: FormEvent<HTMLInputElement>): void => setName(e.currentTarget.value)}\\n\\t\\t\\t\\t\\t\\t\\tplaceholder={t('Name')}\\n\\t\\t\\t\\t\\t\\t/>\\n\\t\\t\\t\\t\\t</FieldRow>\\n\\t\\t\\t\\t</Field>\\n\\t\\t\\t\\t<Field>\\n\\t\\t\\t\\t\\t<FieldLabel alignSelf='stretch'>{t('Sound_File_mp3')}</FieldLabel>\\n\\t\\t\\t\\t\\t<Box display='flex' flexDirection='row' mbs='none' alignItems='center'>\\n\\t\\t\\t\\t\\t\\t<Margins inline={4}>\\n\\t\\t\\t\\t\\t\\t\\t<IconButton secondary small icon='upload' onClick={clickUpload} />\\n\\t\\t\\t\\t\\t\\t\\t{sound?.name || t('None')}\\n\\t\\t\\t\\t\\t\\t</Margins>\\n\\t\\t\\t\\t\\t</Box>\\n\\t\\t\\t\\t</Field>\\n\\t\\t\\t</ContextualbarScrollableContent>\\n\\t\\t\\t<ContextualbarFooter>\\n\\t\\t\\t\\t<ButtonGroup stretch>\\n\\t\\t\\t\\t\\t<Button onClick={close}>{t('Cancel')}</Button>\\n\\t\\t\\t\\t\\t<Button primary onClick={handleSave}>\\n\\t\\t\\t\\t\\t\\t{t('Save')}\\n\\t\\t\\t\\t\\t</Button>\\n\\t\\t\\t\\t</ButtonGroup>\\n\\t\\t\\t</ContextualbarFooter>\\n\\t\\t</>\\n\\t);\\n};\\n\\nexport default AddCustomSound;\\n\",null],\"names\":[\"_objectSpread\",\"_objectWithoutProperties\",\"Field\",\"FieldLabel\",\"FieldRow\",\"TextInput\",\"Box\",\"Margins\",\"Button\",\"ButtonGroup\",\"IconButton\",\"useToastMessageDispatch\",\"useMethod\",\"useTranslation\",\"React\",\"useState\",\"useCallback\",\"ContextualbarScrollableContent\",\"ContextualbarFooter\",\"useSingleFileInput\",\"validate\",\"createSoundData\",\"module\",\"link\",\"default\",\"v\",\"exportDefault\",\"_ref\",\"goToNew\",\"close\",\"onChange\",\"props\",\"_excluded\",\"t\",\"dispatchToastMessage\",\"name\",\"setName\",\"sound\",\"setSound\",\"uploadCustomSound\",\"insertOrUpdateSound\",\"handleChangeFile\",\"soundFile\",\"clickUpload\",\"saveAction\",\"soundData\",\"validation\",\"forEach\",\"invalidFieldName\",\"Error\",\"field\",\"soundId\",\"type\",\"message\",\"reader\",\"FileReader\",\"readAsBinaryString\",\"onloadend\",\"result\",\"_id\",\"random\",\"Math\",\"round\",\"error\",\"handleSave\",\"createElement\",\"Fragment\",\"value\",\"e\",\"currentTarget\",\"placeholder\",\"alignSelf\",\"display\",\"flexDirection\",\"mbs\",\"alignItems\",\"inline\",\"secondary\",\"small\",\"icon\",\"onClick\",\"stretch\",\"primary\"],\"mappings\":\"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\"}"}