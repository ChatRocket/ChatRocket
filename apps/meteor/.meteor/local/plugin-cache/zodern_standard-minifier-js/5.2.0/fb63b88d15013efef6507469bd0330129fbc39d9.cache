{"code":"function module(e,t,n){n.link(\"@babel/runtime/regenerator\",{default:function(e){r=e}},0),n.link(\"@babel/runtime/helpers/toConsumableArray\",{default:function(e){i=e}},1),n.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){a=e}},2),n.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){o=e}},3),n.link(\"@babel/runtime/helpers/asyncIterator\",{default:function(e){s=e}},4),n.export({useImagesList:function(){return h}}),n.link(\"@rocket.chat/base64\",{Base64:function(e){u=e}},0),n.link(\"@rocket.chat/ui-contexts\",{useEndpoint:function(e){c=e}},1),n.link(\"react\",{useCallback:function(e){l=e},useEffect:function(e){d=e},useState:function(e){f=e}},2),n.link(\"../../../../../app/e2e/client/rocketchat.e2e\",{e2e:function(e){p=e}},3),n.link(\"../../../../hooks/lists/useScrollableRecordList\",{useScrollableRecordList:function(e){m=e}},4),n.link(\"../../../../hooks/useComponentDidUpdate\",{useComponentDidUpdate:function(e){b=e}},5),n.link(\"../../../../lib/lists/ImagesList\",{ImagesList:function(e){k=e}},6);var r,i,a,o,s,u,c,l,d,f,p,m,b,k,h=function(e){var t=f(function(){return new k(e)}),n=o(t,2),h=n[0],x=n[1],v=l(function(){return x(new k(e))},[e]);b(function(){e&&v()},[e,v]),d(function(){h.options!==e&&h.updateFilters(e)},[h,e]);var I=c(\"GET\",\"/v1/rooms.images\"),g=l(function(t,n){var o,c,l,d,f,m,b,k,h,x,v,g,y;return r.async(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,r.awrap(I({roomId:e.roomId,startingFromId:e.startingFromId,offset:t,count:n}));case 2:c=(o=w.sent).files,l=o.total,d=c.map(function(e){return a(a({},e),{},{uploadedAt:e.uploadedAt?new Date(e.uploadedAt):void 0,modifiedAt:e.modifiedAt?new Date(e.modifiedAt):void 0})}),f=!1,m=!1,w.prev=8,k=s(d);case 10:return w.next=12,r.awrap(k.next());case 12:if(!(f=!(h=w.sent).done)){w.next=28;break}if(!((x=h.value).rid&&x.content)){w.next=25;break}return w.next=17,r.awrap(p.getInstanceByRoomId(x.rid));case 17:if(!(null!=(v=w.sent)&&v.shouldConvertReceivedMessages())){w.next=25;break}return w.next=21,r.awrap(p.decryptFileContent(x));case 21:g=w.sent,y=u.encode(JSON.stringify(a(a({},g.encryption),{},{name:String.fromCharCode.apply(String,i(new TextEncoder().encode(g.name))),type:g.type}))),g.path=\"/file-decrypt\"+g.path+\"?key=\"+y,Object.assign(x,g);case 25:f=!1,w.next=10;break;case 28:w.next=34;break;case 30:w.prev=30,w.t0=w.catch(8),m=!0,b=w.t0;case 34:if(w.prev=34,w.prev=35,!(f&&null!=k.return)){w.next=39;break}return w.next=39,r.awrap(k.return());case 39:if(w.prev=39,!m){w.next=42;break}throw b;case 42:return w.finish(39);case 43:return w.finish(34);case 44:return w.abrupt(\"return\",{items:d,itemCount:l});case 45:case\"end\":return w.stop()}},null,null,[[8,30,34,44],[35,,39,43]],Promise)},[I,e.roomId,e.startingFromId]),y=m(h,g,5);return{reload:v,filesList:h,loadMoreItems:y.loadMoreItems,initialItemCount:y.initialItemCount}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/ImageGallery/hooks/useImagesList.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Base64 } from '@rocket.chat/base64';\\nimport type { RoomsImagesProps } from '@rocket.chat/rest-typings';\\nimport { useEndpoint } from '@rocket.chat/ui-contexts';\\nimport { useCallback, useEffect, useState } from 'react';\\n\\nimport { e2e } from '../../../../../app/e2e/client/rocketchat.e2e';\\nimport { useScrollableRecordList } from '../../../../hooks/lists/useScrollableRecordList';\\nimport { useComponentDidUpdate } from '../../../../hooks/useComponentDidUpdate';\\nimport { ImagesList } from '../../../../lib/lists/ImagesList';\\n\\nexport const useImagesList = (\\n\\toptions: RoomsImagesProps,\\n): {\\n\\tfilesList: ImagesList;\\n\\tinitialItemCount: number;\\n\\treload: () => void;\\n\\tloadMoreItems: (start: number) => void;\\n} => {\\n\\tconst [filesList, setFilesList] = useState(() => new ImagesList(options));\\n\\tconst reload = useCallback(() => setFilesList(new ImagesList(options)), [options]);\\n\\n\\tuseComponentDidUpdate(() => {\\n\\t\\toptions && reload();\\n\\t}, [options, reload]);\\n\\n\\tuseEffect(() => {\\n\\t\\tif (filesList.options !== options) {\\n\\t\\t\\tfilesList.updateFilters(options);\\n\\t\\t}\\n\\t}, [filesList, options]);\\n\\n\\tconst apiEndPoint = '/v1/rooms.images';\\n\\n\\tconst getFiles = useEndpoint('GET', apiEndPoint);\\n\\n\\tconst fetchMessages = useCallback(\\n\\t\\tasync (start, end) => {\\n\\t\\t\\tconst { files, total } = await getFiles({\\n\\t\\t\\t\\troomId: options.roomId,\\n\\t\\t\\t\\tstartingFromId: options.startingFromId,\\n\\t\\t\\t\\toffset: start,\\n\\t\\t\\t\\tcount: end,\\n\\t\\t\\t});\\n\\n\\t\\t\\tconst items = files.map((file) => ({\\n\\t\\t\\t\\t...file,\\n\\t\\t\\t\\tuploadedAt: file.uploadedAt ? new Date(file.uploadedAt) : undefined,\\n\\t\\t\\t\\tmodifiedAt: file.modifiedAt ? new Date(file.modifiedAt) : undefined,\\n\\t\\t\\t}));\\n\\n\\t\\t\\tfor await (const file of items) {\\n\\t\\t\\t\\tif (file.rid && file.content) {\\n\\t\\t\\t\\t\\tconst e2eRoom = await e2e.getInstanceByRoomId(file.rid);\\n\\t\\t\\t\\t\\tif (e2eRoom?.shouldConvertReceivedMessages()) {\\n\\t\\t\\t\\t\\t\\tconst decrypted = await e2e.decryptFileContent(file);\\n\\t\\t\\t\\t\\t\\tconst key = Base64.encode(\\n\\t\\t\\t\\t\\t\\t\\tJSON.stringify({\\n\\t\\t\\t\\t\\t\\t\\t\\t...decrypted.encryption,\\n\\t\\t\\t\\t\\t\\t\\t\\tname: String.fromCharCode(...new TextEncoder().encode(decrypted.name)),\\n\\t\\t\\t\\t\\t\\t\\t\\ttype: decrypted.type,\\n\\t\\t\\t\\t\\t\\t\\t}),\\n\\t\\t\\t\\t\\t\\t);\\n\\t\\t\\t\\t\\t\\tdecrypted.path = `/file-decrypt${decrypted.path}?key=${key}`;\\n\\t\\t\\t\\t\\t\\tObject.assign(file, decrypted);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn {\\n\\t\\t\\t\\titems,\\n\\t\\t\\t\\titemCount: total,\\n\\t\\t\\t};\\n\\t\\t},\\n\\t\\t[getFiles, options.roomId, options.startingFromId],\\n\\t);\\n\\n\\tconst { loadMoreItems, initialItemCount } = useScrollableRecordList(filesList, fetchMessages, 5);\\n\\n\\treturn {\\n\\t\\treload,\\n\\t\\tfilesList,\\n\\t\\tloadMoreItems,\\n\\t\\tinitialItemCount,\\n\\t};\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_regeneratorRuntime\",\"_toConsumableArray\",\"_objectSpread\",\"_slicedToArray\",\"_asyncIterator\",\"export\",\"useImagesList\",\"Base64\",\"useEndpoint\",\"useCallback\",\"useEffect\",\"useState\",\"e2e\",\"useScrollableRecordList\",\"useComponentDidUpdate\",\"ImagesList\",\"options\",\"_useState\",\"_useState2\",\"filesList\",\"setFilesList\",\"reload\",\"updateFilters\",\"getFiles\",\"fetchMessages\",\"start\",\"end\",\"_await$getFiles\",\"files\",\"total\",\"items\",\"_iteratorAbruptCompletion\",\"_didIteratorError\",\"_iteratorError\",\"_iterator\",\"_step\",\"file\",\"e2eRoom\",\"decrypted\",\"key\",\"async\",\"_context\",\"prev\",\"next\",\"awrap\",\"roomId\",\"startingFromId\",\"offset\",\"count\",\"sent\",\"map\",\"uploadedAt\",\"Date\",\"undefined\",\"modifiedAt\",\"done\",\"value\",\"rid\",\"content\",\"getInstanceByRoomId\",\"shouldConvertReceivedMessages\",\"decryptFileContent\",\"encode\",\"JSON\",\"stringify\",\"encryption\",\"name\",\"String\",\"fromCharCode\",\"apply\",\"TextEncoder\",\"type\",\"path\",\"Object\",\"assign\",\"t0\",\"return\",\"finish\",\"abrupt\",\"itemCount\",\"stop\",\"Promise\",\"_useScrollableRecordL\",\"loadMoreItems\",\"initialItemCount\"],\"mappings\":\"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\"}"}