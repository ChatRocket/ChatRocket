{"code":"function module(e,i,o){let l,n,t,d,s,a,u,c;o.export({useAudioMessageAction:()=>p}),o.link(\"@rocket.chat/fuselage-hooks\",{useMutableCallback(e){l=e}},0),o.link(\"@rocket.chat/ui-contexts\",{useSetting(e){n=e}},1),o.link(\"react\",{useEffect(e){t=e},useMemo(e){d=e}},2),o.link(\"../../../../../../../app/ui/client/lib/recorderjs/AudioRecorder\",{AudioRecorder(e){s=e}},3),o.link(\"../../../../contexts/ChatContext\",{useChat(e){a=e}},4),o.link(\"../../hooks/useMediaActionTitle\",{useMediaActionTitle(e){u=e}},5),o.link(\"../../hooks/useMediaPermissions\",{useMediaPermissions(e){c=e}},6);let r=new s,p=(e,i)=>{let o=n(\"FileUpload_Enabled\"),s=n(\"Message_AudioRecorderEnabled\"),p=n(\"FileUpload_MediaTypeBlackList\"),k=n(\"FileUpload_MediaTypeWhiteList\"),[m]=c(\"microphone\"),M=d(()=>!!(r.isSupported()&&!i&&o&&s&&!(null!=p&&p.match(/audio\\/mp3|audio\\/\\*/i))&&(!k||k.match(/audio\\/mp3|audio\\/\\*/i))),[p,k,s,o,i]),h=u(\"audio\",m,o,s,M),g=a(),v=l(()=>{var e;null==g||g.action.stop(\"recording\"),null==g||null===(e=g.composer)||void 0===e||e.setRecordingMode(!1)}),A=l(e=>{var i;e&&v(),null==g||null===(i=g.composer)||void 0===i||i.setIsMicrophoneDenied(e)});return t(()=>{A(m)},[A,m]),{id:\"audio-message\",content:h,icon:\"mic\",disabled:!M||!!e,onClick:()=>{var e;return null==g?void 0:null===(e=g.composer)||void 0===e?void 0:e.setRecordingMode(!0)}}}}","map":"{\"version\":3,\"sources\":[\"client/views/room/composer/messageBox/MessageBoxActionsToolbar/hooks/useAudioMessageAction.ts\",\"<anon>\"],\"sourcesContent\":[\"import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\\nimport type { GenericMenuItemProps } from '@rocket.chat/ui-client';\\nimport { useSetting } from '@rocket.chat/ui-contexts';\\nimport { useEffect, useMemo } from 'react';\\n\\nimport { AudioRecorder } from '../../../../../../../app/ui/client/lib/recorderjs/AudioRecorder';\\nimport { useChat } from '../../../../contexts/ChatContext';\\nimport { useMediaActionTitle } from '../../hooks/useMediaActionTitle';\\nimport { useMediaPermissions } from '../../hooks/useMediaPermissions';\\n\\nconst audioRecorder = new AudioRecorder();\\n\\nexport const useAudioMessageAction = (disabled: boolean, isMicrophoneDenied: boolean): GenericMenuItemProps => {\\n\\tconst isFileUploadEnabled = useSetting('FileUpload_Enabled') as boolean;\\n\\tconst isAudioRecorderEnabled = useSetting('Message_AudioRecorderEnabled') as boolean;\\n\\tconst fileUploadMediaTypeBlackList = useSetting('FileUpload_MediaTypeBlackList') as string;\\n\\tconst fileUploadMediaTypeWhiteList = useSetting('FileUpload_MediaTypeWhiteList') as string;\\n\\tconst [isPermissionDenied] = useMediaPermissions('microphone');\\n\\n\\tconst isAllowed = useMemo(\\n\\t\\t() =>\\n\\t\\t\\tBoolean(\\n\\t\\t\\t\\taudioRecorder.isSupported() &&\\n\\t\\t\\t\\t\\t!isMicrophoneDenied &&\\n\\t\\t\\t\\t\\tisFileUploadEnabled &&\\n\\t\\t\\t\\t\\tisAudioRecorderEnabled &&\\n\\t\\t\\t\\t\\t!fileUploadMediaTypeBlackList?.match(/audio\\\\/mp3|audio\\\\/\\\\*/i) &&\\n\\t\\t\\t\\t\\t(!fileUploadMediaTypeWhiteList || fileUploadMediaTypeWhiteList.match(/audio\\\\/mp3|audio\\\\/\\\\*/i)),\\n\\t\\t\\t),\\n\\t\\t[fileUploadMediaTypeBlackList, fileUploadMediaTypeWhiteList, isAudioRecorderEnabled, isFileUploadEnabled, isMicrophoneDenied],\\n\\t);\\n\\n\\tconst getMediaActionTitle = useMediaActionTitle('audio', isPermissionDenied, isFileUploadEnabled, isAudioRecorderEnabled, isAllowed);\\n\\n\\tconst chat = useChat();\\n\\n\\tconst stopRecording = useMutableCallback(() => {\\n\\t\\tchat?.action.stop('recording');\\n\\n\\t\\tchat?.composer?.setRecordingMode(false);\\n\\t});\\n\\n\\tconst setMicrophoneDenied = useMutableCallback((isDenied) => {\\n\\t\\tif (isDenied) {\\n\\t\\t\\tstopRecording();\\n\\t\\t}\\n\\n\\t\\tchat?.composer?.setIsMicrophoneDenied(isDenied);\\n\\t});\\n\\n\\tuseEffect(() => {\\n\\t\\tsetMicrophoneDenied(isPermissionDenied);\\n\\t}, [setMicrophoneDenied, isPermissionDenied]);\\n\\n\\tconst handleRecordButtonClick = () => chat?.composer?.setRecordingMode(true);\\n\\n\\treturn {\\n\\t\\tid: 'audio-message',\\n\\t\\tcontent: getMediaActionTitle,\\n\\t\\ticon: 'mic',\\n\\t\\tdisabled: !isAllowed || Boolean(disabled),\\n\\t\\tonClick: handleRecordButtonClick,\\n\\t};\\n};\\n\",null],\"names\":[\"useMutableCallback\",\"useSetting\",\"useEffect\",\"useMemo\",\"AudioRecorder\",\"useChat\",\"useMediaActionTitle\",\"useMediaPermissions\",\"module\",\"export\",\"useAudioMessageAction\",\"link\",\"v\",\"audioRecorder\",\"disabled\",\"isMicrophoneDenied\",\"isFileUploadEnabled\",\"isAudioRecorderEnabled\",\"fileUploadMediaTypeBlackList\",\"fileUploadMediaTypeWhiteList\",\"isPermissionDenied\",\"isAllowed\",\"Boolean\",\"isSupported\",\"match\",\"getMediaActionTitle\",\"chat\",\"stopRecording\",\"_chat$composer\",\"action\",\"stop\",\"composer\",\"setRecordingMode\",\"setMicrophoneDenied\",\"isDenied\",\"_chat$composer2\",\"setIsMicrophoneDenied\",\"id\",\"content\",\"icon\",\"onClick\",\"handleRecordButtonClick\",\"_chat$composer3\"],\"mappings\":\"2BAAiEA,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAjEC,EAAOC,MAAE,CAAA,CAAAC,sBAA0BA,IAAAA,CAAA,GAA8BF,EAAAG,IAAA,CAAA,8BAAA,CAAAX,mBAAAY,CAAA,EAAAZ,EAAAY,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,2BAAA,CAAAV,WAAAW,CAAA,EAAAX,EAAAW,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,QAAA,CAAAT,UAAAU,CAAA,EAAAV,EAAAU,CAAA,EAAAT,QAAAS,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,kEAAA,CAAAP,cAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,mCAAA,CAAAN,QAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,kCAAA,CAAAL,oBAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,kCAAA,CAAAJ,oBAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAUjE,IAAMC,EAAgB,IAAIT,EAEbM,EAAwBA,CAACI,EAAmBC,KACxD,IAAMC,EAAsBf,EAAW,sBACjCgB,EAAyBhB,EAAW,gCACpCiB,EAA+BjB,EAAW,iCAC1CkB,EAA+BlB,EAAW,iCAC1C,CAACmB,EAAmB,CAAGb,EAAoB,cAE3Cc,EAAYlB,EACjB,IACCmB,CAAAA,CACCT,CAAAA,EAAcU,WAAW,IACxB,CAACR,GACDC,GACAC,GACA,CAACC,CAAAA,MAAAA,GAAAA,EAA8BM,KAAK,CAAC,wBAAuB,GAC3D,CAAA,CAACL,GAAgCA,EAA6BK,KAAK,CAAC,wBAAuB,CAAC,EAEhG,CAACN,EAA8BC,EAA8BF,EAAwBD,EAAqBD,EAAmB,EAGxHU,EAAsBnB,EAAoB,QAASc,EAAoBJ,EAAqBC,EAAwBI,GAEpHK,EAAOrB,IAEPsB,EAAgB3B,EAAmB,KAAK,IAAA4B,CAC7CF,OAAAA,GAAAA,EAAMG,MAAM,CAACC,IAAI,CAAC,aAElBJ,MAAAA,GAAI,AAAU,OAAVE,CAAAA,EAAJF,EAAMK,QAAQ,AAARA,GAAQH,AAAA,KAAA,IAAAA,GAAdA,EAAgBI,gBAAgB,CAAC,CAAA,EAClC,GAEMC,EAAsBjC,EAAoBkC,IAAY,IAAAC,EACvDD,GACHP,IAGDD,MAAAA,GAAI,AAAU,OAAVS,CAAAA,EAAJT,EAAMK,QAAQ,AAARA,GAAQI,AAAA,KAAA,IAAAA,GAAdA,EAAgBC,qBAAqB,CAACF,EACvC,UAEAhC,EAAU,KACT+B,EAAoBb,EACrB,EAAG,CAACa,EAAqBb,EAAmB,EAIrC,CACNiB,GAAI,gBACJC,QAASb,EACTc,KAAM,MACNzB,SAAU,CAACO,GAAaC,CAAAA,CAAQR,EAChC0B,QAP+BC,KAAA,IAAAC,EAAA,OAAMhB,MAAAA,EAAI,KAAA,EAAA,AAAU,OAAVgB,CAAAA,EAAJhB,EAAMK,QAAQ,AAARA,GAAQW,AAAA,KAAA,IAAAA,EAAA,KAAA,EAAdA,EAAgBV,gBAAgB,CAAC,CAAA,EAAK,EAS7E\"}"}