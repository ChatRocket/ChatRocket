{"code":"function module(e,n,t){var r,i,s,a,u,l,o,c,d,f;t.link(\"@babel/runtime/regenerator\",{default:function(e){r=e}},0),t.link(\"meteor/meteor\",{Meteor:function(e){i=e}},0),t.link(\"../../../../client/lib/onClientMessageReceived\",{onClientMessageReceived:function(e){s=e}},1),t.link(\"../../../../client/lib/toast\",{dispatchToastMessage:function(e){a=e}},2),t.link(\"../../../../lib/callbacks\",{callbacks:function(e){u=e}},3),t.link(\"../../../../lib/utils/stringUtils\",{trim:function(e){l=e}},4),t.link(\"../../../models/client\",{ChatMessage:function(e){o=e},ChatRoom:function(e){c=e}},5),t.link(\"../../../settings/client\",{settings:function(e){d=e}},6),t.link(\"../../../utils/lib/i18n\",{t:function(e){f=e}},7),i.methods({sendMessage:function(e){var n,t,m;return r.async(function(b){for(;;)switch(b.prev=b.next){case 0:if(!(!(n=i.userId())||\"\"===l(e.msg))){b.next=3;break}return b.abrupt(\"return\",!1);case 3:if(!(e._id&&o.findOne({_id:e._id}))){b.next=6;break}return b.abrupt(\"return\",a({type:\"error\",message:f(\"Message_Already_Sent\")}));case 6:if(null!=(t=i.user())&&t.username){b.next=9;break}throw new i.Error(\"error-invalid-user\",\"Invalid user\",{method:\"sendMessage\"});case 9:if(e.ts=new Date,e.u={_id:n,username:t.username,name:t.name||\"\"},e.temp=!0,d.get(\"Message_Read_Receipt_Enabled\")&&(e.unread=!0),!(null!=(m=c.findOne({_id:e.rid},{fields:{federated:1,name:1}}))&&m.federated)){b.next=16;break}return b.abrupt(\"return\");case 16:return b.next=18,r.awrap(s(e).then(function(e){return o.insert(e),u.run(\"afterSaveMessage\",e,{room:m})}));case 18:case\"end\":return b.stop()}},null,null,null,Promise)}})}","map":"{\"version\":3,\"sources\":[\"app/lib/client/methods/sendMessage.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IMessage, IUser } from '@rocket.chat/core-typings';\\nimport type { ServerMethods } from '@rocket.chat/ddp-client';\\nimport { Meteor } from 'meteor/meteor';\\n\\nimport { onClientMessageReceived } from '../../../../client/lib/onClientMessageReceived';\\nimport { dispatchToastMessage } from '../../../../client/lib/toast';\\nimport { callbacks } from '../../../../lib/callbacks';\\nimport { trim } from '../../../../lib/utils/stringUtils';\\nimport { ChatMessage, ChatRoom } from '../../../models/client';\\nimport { settings } from '../../../settings/client';\\nimport { t } from '../../../utils/lib/i18n';\\n\\nMeteor.methods<ServerMethods>({\\n\\tasync sendMessage(message) {\\n\\t\\tconst uid = Meteor.userId();\\n\\t\\tif (!uid || trim(message.msg) === '') {\\n\\t\\t\\treturn false;\\n\\t\\t}\\n\\t\\tconst messageAlreadyExists = message._id && ChatMessage.findOne({ _id: message._id });\\n\\t\\tif (messageAlreadyExists) {\\n\\t\\t\\treturn dispatchToastMessage({ type: 'error', message: t('Message_Already_Sent') });\\n\\t\\t}\\n\\t\\tconst user = Meteor.user() as IUser | null;\\n\\t\\tif (!user?.username) {\\n\\t\\t\\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'sendMessage' });\\n\\t\\t}\\n\\t\\tmessage.ts = new Date();\\n\\t\\tmessage.u = {\\n\\t\\t\\t_id: uid,\\n\\t\\t\\tusername: user.username,\\n\\t\\t\\tname: user.name || '',\\n\\t\\t};\\n\\t\\tmessage.temp = true;\\n\\t\\tif (settings.get('Message_Read_Receipt_Enabled')) {\\n\\t\\t\\tmessage.unread = true;\\n\\t\\t}\\n\\n\\t\\t// If the room is federated, send the message to matrix only\\n\\t\\tconst room = ChatRoom.findOne({ _id: message.rid }, { fields: { federated: 1, name: 1 } });\\n\\t\\tif (room?.federated) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tawait onClientMessageReceived(message as IMessage).then((message) => {\\n\\t\\t\\tChatMessage.insert(message);\\n\\t\\t\\treturn callbacks.run('afterSaveMessage', message, { room });\\n\\t\\t});\\n\\t},\\n});\\n\",null],\"names\":[\"_regeneratorRuntime\",\"Meteor\",\"onClientMessageReceived\",\"dispatchToastMessage\",\"callbacks\",\"trim\",\"ChatMessage\",\"ChatRoom\",\"settings\",\"t\",\"module\",\"link\",\"default\",\"v\",\"methods\",\"sendMessage\",\"message\",\"uid\",\"user\",\"room\",\"async\",\"_context\",\"prev\",\"next\",\"userId\",\"msg\",\"abrupt\",\"_id\",\"findOne\",\"type\",\"username\",\"Error\",\"method\",\"ts\",\"Date\",\"u\",\"name\",\"temp\",\"get\",\"unread\",\"rid\",\"fields\",\"federated\",\"awrap\",\"then\",\"insert\",\"run\",\"stop\",\"Promise\"],\"mappings\":\"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\"}"}