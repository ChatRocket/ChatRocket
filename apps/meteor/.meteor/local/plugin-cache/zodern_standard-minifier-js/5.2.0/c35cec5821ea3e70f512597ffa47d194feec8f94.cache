{"code":"function module(e,o,t){let i,n,a,r,l,c,d,u;t.link(\"@babel/runtime/helpers/objectSpread2\",{default(e){i=e}},0),t.link(\"@rocket.chat/random\",{Random(e){n=e}},0),t.link(\"meteor/facebook-oauth\",{Facebook(e){a=e}},1),t.link(\"meteor/meteor\",{Meteor(e){r=e}},2),t.link(\"meteor/oauth\",{OAuth(e){l=e}},3),t.link(\"../../lib/2fa/overrideLoginMethod\",{overrideLoginMethod(e){c=e}},4),t.link(\"../../lib/wrapRequestCredentialFn\",{wrapRequestCredentialFn(e){d=e}},5),t.link(\"./oauth\",{createOAuthTotpLoginMethod(e){u=e}},6);let{loginWithFacebook:s}=r,p=u(a);r.loginWithFacebook=(e,o)=>{c(s,[e],o,p)},a.requestCredential=d(\"facebook\",e=>{var o,t,a,c;let{config:d,loginStyle:u,options:s,credentialRequestCompleteCallback:p}=e,h=n.secret(),k=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone/i.test(navigator.userAgent),b=null!=s&&s.requestPermissions?s.requestPermissions.join(\",\"):\"email\",m=(null===(o=r.settings)||void 0===o?void 0:null===(t=o.public)||void 0===t?void 0:null===(a=t.packages)||void 0===a?void 0:null===(c=a[\"facebook-oauth\"])||void 0===c?void 0:c.apiVersion)||\"17.0\",v=i({client_id:d.appId,redirect_uri:l._redirectUri(\"facebook\",d,s.params,s.absoluteUrlOptions),display:k?\"touch\":\"popup\",scope:b,state:l._stateParam(u,h,null==s?void 0:s.redirectUrl)},s.auth_type&&{auth_type:s.auth_type}),g=\"https://www.facebook.com/v\".concat(m,\"/dialog/oauth?\").concat(Object.keys(v).map(e=>\"\".concat(encodeURIComponent(e),\"=\").concat(encodeURIComponent(v[e]))).join(\"&\"));l.launchLogin({loginService:\"facebook\",loginStyle:u,loginUrl:g,credentialRequestCompleteCallback:p,credentialToken:h})})}","map":"{\"version\":3,\"sources\":[\"client/meteorOverrides/login/facebook.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { FacebookOAuthConfiguration } from '@rocket.chat/core-typings';\\nimport { Random } from '@rocket.chat/random';\\nimport { Facebook } from 'meteor/facebook-oauth';\\nimport { Meteor } from 'meteor/meteor';\\nimport { OAuth } from 'meteor/oauth';\\n\\nimport { overrideLoginMethod } from '../../lib/2fa/overrideLoginMethod';\\nimport { wrapRequestCredentialFn } from '../../lib/wrapRequestCredentialFn';\\nimport { createOAuthTotpLoginMethod } from './oauth';\\n\\nconst { loginWithFacebook } = Meteor;\\nconst loginWithFacebookAndTOTP = createOAuthTotpLoginMethod(Facebook);\\nMeteor.loginWithFacebook = (options, callback) => {\\n\\toverrideLoginMethod(loginWithFacebook, [options], callback, loginWithFacebookAndTOTP);\\n};\\n\\nFacebook.requestCredential = wrapRequestCredentialFn<FacebookOAuthConfiguration>(\\n\\t'facebook',\\n\\t({ config, loginStyle, options: requestOptions, credentialRequestCompleteCallback }) => {\\n\\t\\tconst options = requestOptions as Meteor.LoginWithExternalServiceOptions & {\\n\\t\\t\\tabsoluteUrlOptions?: Record<string, any>;\\n\\t\\t\\tparams?: Record<string, any>;\\n\\t\\t\\tauth_type?: string;\\n\\t\\t};\\n\\n\\t\\tconst credentialToken = Random.secret();\\n\\t\\tconst mobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone/i.test(navigator.userAgent);\\n\\t\\tconst display = mobile ? 'touch' : 'popup';\\n\\n\\t\\tconst scope = options?.requestPermissions ? options.requestPermissions.join(',') : 'email';\\n\\n\\t\\tconst API_VERSION = Meteor.settings?.public?.packages?.['facebook-oauth']?.apiVersion || '17.0';\\n\\n\\t\\tconst loginUrlParameters: Record<string, any> = {\\n\\t\\t\\tclient_id: config.appId,\\n\\t\\t\\tredirect_uri: OAuth._redirectUri('facebook', config, options.params, options.absoluteUrlOptions),\\n\\t\\t\\tdisplay,\\n\\t\\t\\tscope,\\n\\t\\t\\tstate: OAuth._stateParam(loginStyle, credentialToken, options?.redirectUrl),\\n\\t\\t\\t// Handle authentication type (e.g. for force login you need auth_type: \\\"reauthenticate\\\")\\n\\t\\t\\t...(options.auth_type && { auth_type: options.auth_type }),\\n\\t\\t};\\n\\n\\t\\tconst loginUrl = `https://www.facebook.com/v${API_VERSION}/dialog/oauth?${Object.keys(loginUrlParameters)\\n\\t\\t\\t.map((param) => `${encodeURIComponent(param)}=${encodeURIComponent(loginUrlParameters[param])}`)\\n\\t\\t\\t.join('&')}`;\\n\\n\\t\\tOAuth.launchLogin({\\n\\t\\t\\tloginService: 'facebook',\\n\\t\\t\\tloginStyle,\\n\\t\\t\\tloginUrl,\\n\\t\\t\\tcredentialRequestCompleteCallback,\\n\\t\\t\\tcredentialToken,\\n\\t\\t});\\n\\t},\\n);\\n\",null],\"names\":[\"_objectSpread\",\"Random\",\"Facebook\",\"Meteor\",\"OAuth\",\"overrideLoginMethod\",\"wrapRequestCredentialFn\",\"createOAuthTotpLoginMethod\",\"module\",\"link\",\"default\",\"v\",\"loginWithFacebook\",\"loginWithFacebookAndTOTP\",\"options\",\"callback\",\"requestCredential\",\"_ref\",\"_Meteor$settings\",\"_Meteor$settings$publ\",\"_Meteor$settings$publ2\",\"_Meteor$settings$publ3\",\"config\",\"loginStyle\",\"requestOptions\",\"credentialRequestCompleteCallback\",\"credentialToken\",\"secret\",\"mobile\",\"test\",\"navigator\",\"userAgent\",\"scope\",\"requestPermissions\",\"join\",\"API_VERSION\",\"settings\",\"public\",\"packages\",\"apiVersion\",\"loginUrlParameters\",\"client_id\",\"appId\",\"redirect_uri\",\"_redirectUri\",\"params\",\"absoluteUrlOptions\",\"display\",\"state\",\"_stateParam\",\"redirectUrl\",\"auth_type\",\"loginUrl\",\"concat\",\"Object\",\"keys\",\"map\",\"param\",\"encodeURIComponent\",\"launchLogin\",\"loginService\"],\"mappings\":\"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\"}"}