{"code":"function module(e,t,r){let u,l,n;r.export({onToggledFeature:()=>s}),r.link(\"@tanstack/react-query\",{QueryObserver(e){u=e}},0),r.link(\"./fetchFeatures\",{fetchFeatures(e){l=e}},1),r.link(\"./queryClient\",{queryClient(e){n=e}},2);let s=(e,t)=>{let{up:r,down:s}=t,i=new u(n,{queryKey:[\"ee.features\"],queryFn:l,staleTime:1/0}),a=!1;return i.subscribe(t=>{if(!t.isSuccess)return;let u=t.data,l=u.includes(e);!a&&l&&(null==r||r(),a=!0),a&&!l&&(null==s||s(),a=!1)})}}","map":"{\"version\":3,\"sources\":[\"client/lib/onToggledFeature.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { LicenseModule } from '@rocket.chat/core-typings';\\nimport { QueryObserver } from '@tanstack/react-query';\\n\\nimport { fetchFeatures } from './fetchFeatures';\\nimport { queryClient } from './queryClient';\\n\\nexport const onToggledFeature = (\\n\\tfeature: LicenseModule,\\n\\t{\\n\\t\\tup,\\n\\t\\tdown,\\n\\t}: {\\n\\t\\tup?: () => void;\\n\\t\\tdown?: () => void;\\n\\t},\\n): (() => void) => {\\n\\tconst observer = new QueryObserver(queryClient, {\\n\\t\\tqueryKey: ['ee.features'],\\n\\t\\tqueryFn: fetchFeatures,\\n\\t\\tstaleTime: Infinity,\\n\\t});\\n\\n\\tlet enabled = false;\\n\\n\\treturn observer.subscribe((result) => {\\n\\t\\tif (!result.isSuccess) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\tconst features = result.data;\\n\\t\\tconst hasFeature = features.includes(feature);\\n\\n\\t\\tif (!enabled && hasFeature) {\\n\\t\\t\\tup?.();\\n\\t\\t\\tenabled = true;\\n\\t\\t}\\n\\n\\t\\tif (enabled && !hasFeature) {\\n\\t\\t\\tdown?.();\\n\\t\\t\\tenabled = false;\\n\\t\\t}\\n\\t});\\n};\\n\",null],\"names\":[\"QueryObserver\",\"fetchFeatures\",\"queryClient\",\"module\",\"export\",\"onToggledFeature\",\"link\",\"v\",\"feature\",\"_ref\",\"up\",\"down\",\"observer\",\"queryKey\",\"queryFn\",\"staleTime\",\"Infinity\",\"enabled\",\"subscribe\",\"result\",\"isSuccess\",\"features\",\"data\",\"hasFeature\",\"includes\"],\"mappings\":\"2BACsDA,EAAAC,EAAAC,EAAtDC,EAAOC,MAAE,CAAA,CAAAC,iBAAqBA,IAAAA,CAAA,GAAwBF,EAAAG,IAAA,CAAA,wBAAA,CAAAN,cAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,kBAAA,CAAAL,cAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,gBAAA,CAAAJ,YAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,GAK/C,IAAMF,EAAmBA,CAC/BG,EAAsBC,KAQL,GAPjB,CACCC,GAAAA,CAAE,CACFC,KAAAA,CAAAA,CAIA,CAAAF,EAEKG,EAAW,IAAIZ,EAAcE,EAAa,CAC/CW,SAAU,CAAC,cAAc,CACzBC,QAASb,EACTc,UAAWC,MAGRC,EAAU,CAAA,EAEd,OAAOL,EAASM,SAAS,CAAEC,IAC1B,GAAI,CAACA,EAAOC,SAAS,CACpB,OAGD,IAAMC,EAAWF,EAAOG,IAAI,CACtBC,EAAaF,EAASG,QAAQ,CAAChB,EAEjC,EAACS,GAAWM,IACfb,MAAAA,GAAAA,IACAO,EAAU,CAAA,GAGPA,GAAW,CAACM,IACfZ,MAAAA,GAAAA,IACAM,EAAU,CAAA,EAEZ,EACD\"}"}