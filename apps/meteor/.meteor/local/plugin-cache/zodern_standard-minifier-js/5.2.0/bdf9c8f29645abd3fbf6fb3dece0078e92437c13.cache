{"code":"function module(e,n,t){t.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){i=e}},0),t.link(\"@babel/runtime/helpers/typeof\",{default:function(e){r=e}},1),t.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){u=e}},2),t.export({useUiKitView:function(){return b}}),t.link(\"@rocket.chat/fuselage-hooks\",{useSafely:function(e){o=e}},0),t.link(\"@rocket.chat/fuselage-ui-kit\",{extractInitialStateFromLayout:function(e){c=e}},1),t.link(\"react\",{useEffect:function(e){a=e},useMemo:function(e){f=e},useReducer:function(e){l=e},useState:function(e){s=e}},2),t.link(\"./useUiKitActionManager\",{useUiKitActionManager:function(e){d=e}},3);var i,r,u,o,c,a,f,l,s,d,v=function(e,n){var t,i=n.actionId,r=n.payload;return u(u({},e),{},((t={})[i]=r,t))},k=function(e){if(\"id\"in e&&\"string\"==typeof e.id)return e.id;if(\"viewId\"in e&&\"string\"==typeof e.viewId)return e.viewId;throw Error(\"Invalid view\")};function b(e){var n=o(s()),t=i(n,2),b=t[0],p=t[1],w=o(l(v,e.blocks,c)),y=i(w,2),I=y[0],h=y[1],g=o(s(e)),m=i(g,2),S=m[0],j=m[1],A=d(),K=f(function(){return Object.entries(I).reduce(function(e,n){var t=i(n,2),r=t[0],u=t[1];if(!(null!=u&&u.blockId))return e;var o=u.blockId,c=u.value;return e[o]=e[o]||{},e[o][r]=c,e},{})},[I]),M=k(S);return a(function(){var e=function(e){if(\"errors\"===e.type){p(e.errors);return}j(function(n){return u(u({},n),\"view\"in e&&\"object\"===r(e.view)?e.view:\"banner.open\"===e.type?e:void 0)})};return A.on(M,e),function(){A.off(M,e)}},[A,p,j,M]),{view:S,errors:b,values:I,updateValues:h,state:K}}}","map":"{\"version\":3,\"sources\":[\"client/uikit/hooks/useUiKitView.ts\",\"<anon>\"],\"sourcesContent\":[\"import { useSafely } from '@rocket.chat/fuselage-hooks';\\nimport { extractInitialStateFromLayout } from '@rocket.chat/fuselage-ui-kit';\\nimport type * as UiKit from '@rocket.chat/ui-kit';\\nimport type { Dispatch } from 'react';\\nimport { useEffect, useMemo, useReducer, useState } from 'react';\\n\\nimport { useUiKitActionManager } from './useUiKitActionManager';\\n\\nconst reduceValues = (\\n\\tvalues: { [actionId: string]: { value: unknown; blockId?: string } },\\n\\t{ actionId, payload }: { actionId: string; payload: { value: unknown; blockId?: string } },\\n): { [actionId: string]: { value: unknown; blockId?: string } } => ({\\n\\t...values,\\n\\t[actionId]: payload,\\n});\\n\\nconst getViewId = (view: UiKit.View): string => {\\n\\tif ('id' in view && typeof view.id === 'string') {\\n\\t\\treturn view.id;\\n\\t}\\n\\n\\tif ('viewId' in view && typeof view.viewId === 'string') {\\n\\t\\treturn view.viewId;\\n\\t}\\n\\n\\tthrow new Error('Invalid view');\\n};\\n\\nconst getViewFromInteraction = (interaction: UiKit.ServerInteraction): UiKit.View | undefined => {\\n\\tif ('view' in interaction && typeof interaction.view === 'object') {\\n\\t\\treturn interaction.view;\\n\\t}\\n\\n\\tif (interaction.type === 'banner.open') {\\n\\t\\treturn interaction;\\n\\t}\\n\\n\\treturn undefined;\\n};\\n\\ntype UseUiKitViewReturnType<TView extends UiKit.View> = {\\n\\tview: TView;\\n\\terrors?: { [field: string]: string }[];\\n\\tvalues: { [actionId: string]: { value: unknown; blockId?: string } };\\n\\tupdateValues: Dispatch<{ actionId: string; payload: { value: unknown; blockId?: string } }>;\\n\\tstate: {\\n\\t\\t[blockId: string]: {\\n\\t\\t\\t[key: string]: unknown;\\n\\t\\t};\\n\\t};\\n};\\n\\nexport function useUiKitView<S extends UiKit.View>(initialView: S): UseUiKitViewReturnType<S> {\\n\\tconst [errors, setErrors] = useSafely(useState<{ [field: string]: string }[] | undefined>());\\n\\tconst [values, updateValues] = useSafely(useReducer(reduceValues, initialView.blocks, extractInitialStateFromLayout));\\n\\tconst [view, updateView] = useSafely(useState(initialView));\\n\\tconst actionManager = useUiKitActionManager();\\n\\n\\tconst state = useMemo(() => {\\n\\t\\treturn Object.entries(values).reduce<{ [blockId: string]: { [actionId: string]: unknown } }>((obj, [key, payload]) => {\\n\\t\\t\\tif (!payload?.blockId) {\\n\\t\\t\\t\\treturn obj;\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst { blockId, value } = payload;\\n\\t\\t\\tobj[blockId] = obj[blockId] || {};\\n\\t\\t\\tobj[blockId][key] = value;\\n\\n\\t\\t\\treturn obj;\\n\\t\\t}, {});\\n\\t}, [values]);\\n\\n\\tconst viewId = getViewId(view);\\n\\n\\tuseEffect(() => {\\n\\t\\tconst handleUpdate = (interaction: UiKit.ServerInteraction): void => {\\n\\t\\t\\tif (interaction.type === 'errors') {\\n\\t\\t\\t\\tsetErrors(interaction.errors);\\n\\t\\t\\t\\treturn;\\n\\t\\t\\t}\\n\\n\\t\\t\\tupdateView((view) => ({ ...view, ...getViewFromInteraction(interaction) }));\\n\\t\\t};\\n\\n\\t\\tactionManager.on(viewId, handleUpdate);\\n\\n\\t\\treturn (): void => {\\n\\t\\t\\tactionManager.off(viewId, handleUpdate);\\n\\t\\t};\\n\\t}, [actionManager, setErrors, updateView, viewId]);\\n\\n\\treturn { view, errors, values, updateValues, state };\\n}\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_slicedToArray\",\"_typeof\",\"_objectSpread\",\"export\",\"useUiKitView\",\"useSafely\",\"extractInitialStateFromLayout\",\"useEffect\",\"useMemo\",\"useReducer\",\"useState\",\"useUiKitActionManager\",\"reduceValues\",\"values\",\"_ref\",\"_objectSpread2\",\"actionId\",\"payload\",\"getViewId\",\"view\",\"id\",\"viewId\",\"Error\",\"initialView\",\"_useSafely\",\"_useSafely2\",\"errors\",\"setErrors\",\"_useSafely3\",\"blocks\",\"_useSafely4\",\"updateValues\",\"_useSafely5\",\"_useSafely6\",\"updateView\",\"actionManager\",\"state\",\"Object\",\"entries\",\"reduce\",\"obj\",\"_ref2\",\"_ref3\",\"key\",\"blockId\",\"value\",\"handleUpdate\",\"interaction\",\"type\",\"on\",\"off\"],\"mappings\":\"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\"}"}