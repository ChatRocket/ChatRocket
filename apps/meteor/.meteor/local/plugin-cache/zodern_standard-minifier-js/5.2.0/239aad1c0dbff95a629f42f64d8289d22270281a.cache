{"code":"function module(e,i,n){n.link(\"@babel/runtime/helpers/typeof\",{default:function(e){t=e}},0),n.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){u=e}},1),n.export({DeviceProvider:function(){return s}}),n.link(\"@rocket.chat/fuselage-hooks\",{useMutableCallback:function(e){a=e}},0),n.link(\"@rocket.chat/ui-contexts\",{DeviceContext:function(e){o=e}},1),n.link(\"react\",{default:function(e){r=e},useEffect:function(e){c=e},useState:function(e){l=e},useMemo:function(e){d=e}},2),n.link(\"./lib/isSetSinkIdAvailable\",{isSetSinkIdAvailable:function(e){v=e}},3);var t,u,a,o,r,c,l,d,v,s=function(e){var i=e.children,n=l((\"undefined\"==typeof isSecureContext?\"undefined\":t(isSecureContext))&&isSecureContext),s=u(n,1)[0],f=l([]),b=u(f,2),p=b[0],h=b[1],k=l([]),D=u(k,2),m=D[0],S=D[1],A=l({id:\"default\",label:\"\",type:\"audio\"}),x=u(A,2),E=x[0],g=x[1],C=l({id:\"default\",label:\"\",type:\"audio\"}),I=u(C,2),y=I[0],w=I[1],L=function(e){if(!isSecureContext)throw Error(\"Device Changes are not available on insecure contexts\");w(e)},M=a(function(e){var i=e.outputDevice,n=e.HTMLAudioElement;if(!v())throw Error(\"setSinkId is not available in this browser\");if(!s)throw Error(\"Device Changes are not available on insecure contexts\");g(i),n.setSinkId(i.id)});c(function(){if(s){var e,i=function(){var e;null===(e=navigator.mediaDevices)||void 0===e||e.enumerateDevices().then(function(e){var i=[],n=[];e.forEach(function(e){var t={id:e.deviceId,label:e.label,type:e.kind};\"audioinput\"===e.kind?i.push(t):\"audiooutput\"===e.kind&&n.push(t)}),h(n),S(i)})};return null===(e=navigator.mediaDevices)||void 0===e||e.addEventListener(\"devicechange\",i),i(),function(){var e;null===(e=navigator.mediaDevices)||void 0===e||e.removeEventListener(\"devicechange\",i)}}},[s]);var O=d(function(){return s?{enabled:s,availableAudioOutputDevices:p,availableAudioInputDevices:m,selectedAudioOutputDevice:E,selectedAudioInputDevice:y,setAudioOutputDevice:M,setAudioInputDevice:L}:{enabled:s}},[m,p,s,y,E,M]);return r.createElement(o.Provider,{value:O},i)}}","map":"{\"version\":3,\"sources\":[\"client/providers/DeviceProvider/DeviceProvider.tsx\",\"<anon>\"],\"sourcesContent\":[\"import { useMutableCallback } from '@rocket.chat/fuselage-hooks';\\nimport type { Device, DeviceContextValue } from '@rocket.chat/ui-contexts';\\nimport { DeviceContext } from '@rocket.chat/ui-contexts';\\nimport type { ReactElement, ReactNode } from 'react';\\nimport React, { useEffect, useState, useMemo } from 'react';\\n\\nimport { isSetSinkIdAvailable } from './lib/isSetSinkIdAvailable';\\n\\ntype DeviceProviderProps = {\\n\\tchildren?: ReactNode | undefined;\\n};\\n\\nexport const DeviceProvider = ({ children }: DeviceProviderProps): ReactElement => {\\n\\tconst [enabled] = useState(typeof isSecureContext && isSecureContext);\\n\\tconst [availableAudioOutputDevices, setAvailableAudioOutputDevices] = useState<Device[]>([]);\\n\\tconst [availableAudioInputDevices, setAvailableAudioInputDevices] = useState<Device[]>([]);\\n\\tconst [selectedAudioOutputDevice, setSelectedAudioOutputDevice] = useState<Device>({\\n\\t\\tid: 'default',\\n\\t\\tlabel: '',\\n\\t\\ttype: 'audio',\\n\\t});\\n\\tconst [selectedAudioInputDevice, setSelectedAudioInputDevice] = useState<Device>({\\n\\t\\tid: 'default',\\n\\t\\tlabel: '',\\n\\t\\ttype: 'audio',\\n\\t});\\n\\n\\tconst setAudioInputDevice = (device: Device): void => {\\n\\t\\tif (!isSecureContext) {\\n\\t\\t\\tthrow new Error('Device Changes are not available on insecure contexts');\\n\\t\\t}\\n\\t\\tsetSelectedAudioInputDevice(device);\\n\\t};\\n\\n\\tconst setAudioOutputDevice = useMutableCallback(\\n\\t\\t({ outputDevice, HTMLAudioElement }: { outputDevice: Device; HTMLAudioElement: HTMLAudioElement }): void => {\\n\\t\\t\\tif (!isSetSinkIdAvailable()) {\\n\\t\\t\\t\\tthrow new Error('setSinkId is not available in this browser');\\n\\t\\t\\t}\\n\\t\\t\\tif (!enabled) {\\n\\t\\t\\t\\tthrow new Error('Device Changes are not available on insecure contexts');\\n\\t\\t\\t}\\n\\t\\t\\tsetSelectedAudioOutputDevice(outputDevice);\\n\\t\\t\\tHTMLAudioElement.setSinkId(outputDevice.id);\\n\\t\\t},\\n\\t);\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!enabled) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\t\\tconst setMediaDevices = (): void => {\\n\\t\\t\\tnavigator.mediaDevices?.enumerateDevices().then((devices) => {\\n\\t\\t\\t\\tconst audioInput: Device[] = [];\\n\\t\\t\\t\\tconst audioOutput: Device[] = [];\\n\\t\\t\\t\\tdevices.forEach((device) => {\\n\\t\\t\\t\\t\\tconst mediaDevice: Device = {\\n\\t\\t\\t\\t\\t\\tid: device.deviceId,\\n\\t\\t\\t\\t\\t\\tlabel: device.label,\\n\\t\\t\\t\\t\\t\\ttype: device.kind,\\n\\t\\t\\t\\t\\t};\\n\\t\\t\\t\\t\\tif (device.kind === 'audioinput') {\\n\\t\\t\\t\\t\\t\\taudioInput.push(mediaDevice);\\n\\t\\t\\t\\t\\t} else if (device.kind === 'audiooutput') {\\n\\t\\t\\t\\t\\t\\taudioOutput.push(mediaDevice);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t});\\n\\t\\t\\t\\tsetAvailableAudioOutputDevices(audioOutput);\\n\\t\\t\\t\\tsetAvailableAudioInputDevices(audioInput);\\n\\t\\t\\t});\\n\\t\\t};\\n\\n\\t\\tnavigator.mediaDevices?.addEventListener('devicechange', setMediaDevices);\\n\\t\\tsetMediaDevices();\\n\\n\\t\\treturn (): void => {\\n\\t\\t\\tnavigator.mediaDevices?.removeEventListener('devicechange', setMediaDevices);\\n\\t\\t};\\n\\t}, [enabled]);\\n\\n\\tconst contextValue = useMemo((): DeviceContextValue => {\\n\\t\\tif (!enabled) {\\n\\t\\t\\treturn {\\n\\t\\t\\t\\tenabled,\\n\\t\\t\\t};\\n\\t\\t}\\n\\n\\t\\treturn {\\n\\t\\t\\tenabled,\\n\\t\\t\\tavailableAudioOutputDevices,\\n\\t\\t\\tavailableAudioInputDevices,\\n\\t\\t\\tselectedAudioOutputDevice,\\n\\t\\t\\tselectedAudioInputDevice,\\n\\t\\t\\tsetAudioOutputDevice,\\n\\t\\t\\tsetAudioInputDevice,\\n\\t\\t};\\n\\t}, [\\n\\t\\tavailableAudioInputDevices,\\n\\t\\tavailableAudioOutputDevices,\\n\\t\\tenabled,\\n\\t\\tselectedAudioInputDevice,\\n\\t\\tselectedAudioOutputDevice,\\n\\t\\tsetAudioOutputDevice,\\n\\t]);\\n\\treturn <DeviceContext.Provider value={contextValue}>{children}</DeviceContext.Provider>;\\n};\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_typeof\",\"_slicedToArray\",\"export\",\"DeviceProvider\",\"useMutableCallback\",\"DeviceContext\",\"React\",\"useEffect\",\"useState\",\"useMemo\",\"isSetSinkIdAvailable\",\"_ref\",\"children\",\"_useState\",\"isSecureContext\",\"enabled\",\"_useState2\",\"_useState3\",\"_useState4\",\"availableAudioOutputDevices\",\"setAvailableAudioOutputDevices\",\"_useState5\",\"_useState6\",\"availableAudioInputDevices\",\"setAvailableAudioInputDevices\",\"_useState7\",\"id\",\"label\",\"type\",\"_useState8\",\"selectedAudioOutputDevice\",\"setSelectedAudioOutputDevice\",\"_useState9\",\"_useState10\",\"selectedAudioInputDevice\",\"setSelectedAudioInputDevice\",\"setAudioInputDevice\",\"device\",\"Error\",\"setAudioOutputDevice\",\"_ref2\",\"outputDevice\",\"HTMLAudioElement\",\"setSinkId\",\"_navigator$mediaDevic2\",\"setMediaDevices\",\"_navigator$mediaDevic\",\"navigator\",\"mediaDevices\",\"enumerateDevices\",\"then\",\"devices\",\"audioInput\",\"audioOutput\",\"forEach\",\"mediaDevice\",\"deviceId\",\"kind\",\"push\",\"addEventListener\",\"_navigator$mediaDevic3\",\"removeEventListener\",\"contextValue\",\"createElement\",\"Provider\",\"value\"],\"mappings\":\"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\"}"}