{"code":"function module(t,a,e){var n,i,s,o,r,l,u,g,c,d,m,v;e.link(\"meteor/meteor\",{Meteor:function(t){n=t}},0),e.link(\"meteor/tracker\",{Tracker:function(t){i=t}},1),e.link(\"../../../../client/lib/rooms/roomCoordinator\",{roomCoordinator:function(t){s=t}},2),e.link(\"../../../../client/lib/utils/messageArgs\",{messageArgs:function(t){o=t}},3),e.link(\"../../../../client/views/room/MessageList/lib/autoTranslate\",{hasTranslationLanguageInAttachments:function(t){r=t},hasTranslationLanguageInMessage:function(t){l=t}},4),e.link(\"../../../authorization/client\",{hasAtLeastOnePermission:function(t){u=t}},5),e.link(\"../../../models/client\",{Messages:function(t){g=t}},6),e.link(\"../../../settings/client\",{settings:function(t){c=t}},7),e.link(\"../../../ui-utils/client/lib/MessageAction\",{MessageAction:function(t){d=t}},8),e.link(\"../../../utils/client/lib/SDKClient\",{sdk:function(t){m=t}},9),e.link(\"./autotranslate\",{AutoTranslate:function(t){v=t}},10),n.startup(function(){v.init(),i.autorun(function(){c.get(\"AutoTranslate_Enabled\")&&u([\"auto-translate\"])?(d.addButton({id:\"translate\",icon:\"language\",label:\"Translate\",context:[\"message\",\"message-mobile\",\"threads\"],type:\"interaction\",action:function(t,a){var e,n=a.message,i=void 0===n?o(this).msg:n,s=v.getLanguage(i.rid);l(i,s)||r(i.attachments,s)||(v.messageIdsToWait[i._id]=!0,g.update({_id:i._id},{$set:{autoTranslateFetching:!0}}),m.call(\"autoTranslate.translateMessage\",i,s));var u=\"autoTranslateShowInverse\"in i?\"$unset\":\"$set\";g.update({_id:i._id},((e={})[u]={autoTranslateShowInverse:!0},e))},condition:function(t){var a=t.message,e=t.subscription,n=t.user,i=t.room;if(!n)return!1;var o=(null==e?void 0:e.autoTranslateLanguage)||v.getLanguage(a.rid)||\"\",u=s.isLivechatRoom(null==i?void 0:i.t),g=(null==a?void 0:a.u)&&a.u._id!==n._id,c=(null==e?void 0:e.autoTranslate)||u,d=l(a,o)||r(a.attachments,o);return!!(a.autoTranslateShowInverse||g&&c&&!d)},order:90}),d.addButton({id:\"view-original\",icon:\"language\",label:\"View_original\",context:[\"message\",\"message-mobile\",\"threads\"],type:\"interaction\",action:function(t,a){var e,n=a.message,i=void 0===n?o(this).msg:n,s=v.getLanguage(i.rid);l(i,s)||r(i.attachments,s)||(v.messageIdsToWait[i._id]=!0,g.update({_id:i._id},{$set:{autoTranslateFetching:!0}}),m.call(\"autoTranslate.translateMessage\",i,s));var u=\"autoTranslateShowInverse\"in i?\"$unset\":\"$set\";g.update({_id:i._id},((e={})[u]={autoTranslateShowInverse:!0},e))},condition:function(t){var a=t.message,e=t.subscription,n=t.user,i=t.room,o=(null==e?void 0:e.autoTranslateLanguage)||v.getLanguage(a.rid)||\"\",u=s.isLivechatRoom(null==i?void 0:i.t);if(!n)return!1;var g=(null==a?void 0:a.u)&&a.u._id!==n._id,c=(null==e?void 0:e.autoTranslate)||u,d=l(a,o)||r(a.attachments,o);return!!(!a.autoTranslateShowInverse&&g&&c&&d)},order:90})):d.removeButton(\"toggle-language\")})})}","map":"{\"version\":3,\"sources\":[\"app/autotranslate/client/lib/actionButton.ts\",\"<anon>\"],\"sourcesContent\":[\"import { Meteor } from 'meteor/meteor';\\nimport { Tracker } from 'meteor/tracker';\\n\\nimport { roomCoordinator } from '../../../../client/lib/rooms/roomCoordinator';\\nimport { messageArgs } from '../../../../client/lib/utils/messageArgs';\\nimport {\\n\\thasTranslationLanguageInAttachments,\\n\\thasTranslationLanguageInMessage,\\n} from '../../../../client/views/room/MessageList/lib/autoTranslate';\\nimport { hasAtLeastOnePermission } from '../../../authorization/client';\\nimport { Messages } from '../../../models/client';\\nimport { settings } from '../../../settings/client';\\nimport { MessageAction } from '../../../ui-utils/client/lib/MessageAction';\\nimport { sdk } from '../../../utils/client/lib/SDKClient';\\nimport { AutoTranslate } from './autotranslate';\\n\\nMeteor.startup(() => {\\n\\tAutoTranslate.init();\\n\\n\\tTracker.autorun(() => {\\n\\t\\tif (settings.get('AutoTranslate_Enabled') && hasAtLeastOnePermission(['auto-translate'])) {\\n\\t\\t\\tMessageAction.addButton({\\n\\t\\t\\t\\tid: 'translate',\\n\\t\\t\\t\\ticon: 'language',\\n\\t\\t\\t\\tlabel: 'Translate',\\n\\t\\t\\t\\tcontext: ['message', 'message-mobile', 'threads'],\\n\\t\\t\\t\\ttype: 'interaction',\\n\\t\\t\\t\\taction(_, props) {\\n\\t\\t\\t\\t\\tconst { message = messageArgs(this).msg } = props;\\n\\t\\t\\t\\t\\tconst language = AutoTranslate.getLanguage(message.rid);\\n\\t\\t\\t\\t\\tif (!hasTranslationLanguageInMessage(message, language) && !hasTranslationLanguageInAttachments(message.attachments, language)) {\\n\\t\\t\\t\\t\\t\\t(AutoTranslate.messageIdsToWait as any)[message._id] = true;\\n\\t\\t\\t\\t\\t\\tMessages.update({ _id: message._id }, { $set: { autoTranslateFetching: true } });\\n\\t\\t\\t\\t\\t\\tvoid sdk.call('autoTranslate.translateMessage', message, language);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tconst action = 'autoTranslateShowInverse' in message ? '$unset' : '$set';\\n\\t\\t\\t\\t\\tMessages.update({ _id: message._id }, { [action]: { autoTranslateShowInverse: true } });\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\tcondition({ message, subscription, user, room }) {\\n\\t\\t\\t\\t\\tif (!user) {\\n\\t\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tconst language = subscription?.autoTranslateLanguage || AutoTranslate.getLanguage(message.rid) || '';\\n\\t\\t\\t\\t\\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room?.t);\\n\\t\\t\\t\\t\\tconst isDifferentUser = message?.u && message.u._id !== user._id;\\n\\t\\t\\t\\t\\tconst autoTranslateEnabled = subscription?.autoTranslate || isLivechatRoom;\\n\\t\\t\\t\\t\\tconst hasLanguage =\\n\\t\\t\\t\\t\\t\\thasTranslationLanguageInMessage(message, language) || hasTranslationLanguageInAttachments(message.attachments, language);\\n\\n\\t\\t\\t\\t\\treturn Boolean(\\n\\t\\t\\t\\t\\t\\t(message as { autoTranslateShowInverse?: boolean }).autoTranslateShowInverse ||\\n\\t\\t\\t\\t\\t\\t\\t(isDifferentUser && autoTranslateEnabled && !hasLanguage),\\n\\t\\t\\t\\t\\t);\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\torder: 90,\\n\\t\\t\\t});\\n\\t\\t\\tMessageAction.addButton({\\n\\t\\t\\t\\tid: 'view-original',\\n\\t\\t\\t\\ticon: 'language',\\n\\t\\t\\t\\tlabel: 'View_original',\\n\\t\\t\\t\\tcontext: ['message', 'message-mobile', 'threads'],\\n\\t\\t\\t\\ttype: 'interaction',\\n\\t\\t\\t\\taction(_, props) {\\n\\t\\t\\t\\t\\tconst { message = messageArgs(this).msg } = props;\\n\\t\\t\\t\\t\\tconst language = AutoTranslate.getLanguage(message.rid);\\n\\t\\t\\t\\t\\tif (!hasTranslationLanguageInMessage(message, language) && !hasTranslationLanguageInAttachments(message.attachments, language)) {\\n\\t\\t\\t\\t\\t\\t(AutoTranslate.messageIdsToWait as any)[message._id] = true;\\n\\t\\t\\t\\t\\t\\tMessages.update({ _id: message._id }, { $set: { autoTranslateFetching: true } });\\n\\t\\t\\t\\t\\t\\tvoid sdk.call('autoTranslate.translateMessage', message, language);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tconst action = 'autoTranslateShowInverse' in message ? '$unset' : '$set';\\n\\t\\t\\t\\t\\tMessages.update({ _id: message._id }, { [action]: { autoTranslateShowInverse: true } });\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\tcondition({ message, subscription, user, room }) {\\n\\t\\t\\t\\t\\tconst language = subscription?.autoTranslateLanguage || AutoTranslate.getLanguage(message.rid) || '';\\n\\t\\t\\t\\t\\tconst isLivechatRoom = roomCoordinator.isLivechatRoom(room?.t);\\n\\t\\t\\t\\t\\tif (!user) {\\n\\t\\t\\t\\t\\t\\treturn false;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tconst isDifferentUser = message?.u && message.u._id !== user._id;\\n\\t\\t\\t\\t\\tconst autoTranslateEnabled = subscription?.autoTranslate || isLivechatRoom;\\n\\t\\t\\t\\t\\tconst hasLanguage =\\n\\t\\t\\t\\t\\t\\thasTranslationLanguageInMessage(message, language) || hasTranslationLanguageInAttachments(message.attachments, language);\\n\\n\\t\\t\\t\\t\\treturn Boolean(\\n\\t\\t\\t\\t\\t\\t!(message as { autoTranslateShowInverse?: boolean }).autoTranslateShowInverse &&\\n\\t\\t\\t\\t\\t\\t\\tisDifferentUser &&\\n\\t\\t\\t\\t\\t\\t\\tautoTranslateEnabled &&\\n\\t\\t\\t\\t\\t\\t\\thasLanguage,\\n\\t\\t\\t\\t\\t);\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\torder: 90,\\n\\t\\t\\t});\\n\\t\\t} else {\\n\\t\\t\\tMessageAction.removeButton('toggle-language');\\n\\t\\t}\\n\\t});\\n});\\n\",null],\"names\":[\"Meteor\",\"Tracker\",\"roomCoordinator\",\"messageArgs\",\"hasTranslationLanguageInAttachments\",\"hasTranslationLanguageInMessage\",\"hasAtLeastOnePermission\",\"Messages\",\"settings\",\"MessageAction\",\"sdk\",\"AutoTranslate\",\"module\",\"link\",\"v\",\"startup\",\"init\",\"autorun\",\"get\",\"addButton\",\"id\",\"icon\",\"label\",\"context\",\"type\",\"action\",\"_\",\"props\",\"_Messages$update\",\"_props$message\",\"message\",\"msg\",\"language\",\"getLanguage\",\"rid\",\"attachments\",\"messageIdsToWait\",\"_id\",\"update\",\"$set\",\"autoTranslateFetching\",\"call\",\"autoTranslateShowInverse\",\"condition\",\"_ref\",\"subscription\",\"user\",\"room\",\"autoTranslateLanguage\",\"isLivechatRoom\",\"t\",\"isDifferentUser\",\"u\",\"autoTranslateEnabled\",\"autoTranslate\",\"hasLanguage\",\"Boolean\",\"order\",\"_Messages$update2\",\"_props$message2\",\"_ref2\",\"removeButton\"],\"mappings\":\"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\"}"}