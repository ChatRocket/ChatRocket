{"code":"function module(e,t,r){let l,n,a,o,u,i,c,s,d,m,E,b,p,f,v,g,h,k,_,y,F,S,w,C,T,W;let I=[\"_id\"];r.link(\"@babel/runtime/helpers/extends\",{default(e){l=e}},0),r.link(\"@babel/runtime/helpers/objectWithoutProperties\",{default(e){n=e}},1),r.link(\"@rocket.chat/fuselage\",{Modal(e){a=e},Box(e){o=e},Button(e){u=e},FieldGroup(e){i=e},Field(e){c=e},FieldLabel(e){s=e},FieldRow(e){d=e},FieldError(e){m=e},Select(e){E=e},Throbber(e){b=e}},0),r.link(\"@rocket.chat/fuselage-hooks\",{useUniqueId(e){p=e}},1),r.link(\"@rocket.chat/ui-contexts\",{useMethod(e){f=e},useSetting(e){v=e},useToastMessageDispatch(e){g=e},useTranslation(e){h=e}},2),r.link(\"react\",{default(e){k=e},useState(e){_=e},useMemo(e){y=e},useEffect(e){F=e},useRef(e){S=e}},3),r.link(\"react-hook-form\",{useForm(e){w=e},Controller(e){C=e}},4),r.link(\"../../../hooks/webdav/useWebDAVAccountIntegrationsQuery\",{useWebDAVAccountIntegrationsQuery(e){T=e}},5),r.link(\"../../../lib/getWebdavServerName\",{getWebdavServerName(e){W=e}},6),r.exportDefault(e=>{let{onClose:t,data:r}=e,x=h(),[q,A]=_(!1),M=g(),D=f(\"uploadFileToWebdav\"),R=S(null),H=p(),{control:j,handleSubmit:B,formState:{errors:G}}=w({mode:\"all\"}),L=v(\"Webdav_Integration_Enabled\",!1),{data:N}=T({enabled:L}),Q=y(()=>{var e;return null!==(e=null==N?void 0:N.map(e=>{let{_id:t}=e,r=n(e,I);return[t,W(r)]}))&&void 0!==e?e:[]},[N]);F(()=>{var e;return null===(e=R.current)||void 0===e?void 0:e.abort},[]);let U=e=>{let{accountId:l}=e;A(!0);let{url:n,attachment:{title:a}}=r;R.current=new XMLHttpRequest,R.current.open(\"GET\",n,!0),R.current.responseType=\"arraybuffer\",R.current.onload=async()=>{var e;let r=null===(e=R.current)||void 0===e?void 0:e.response;if(r){let e=new Uint8Array(r);try{if(!a)throw Error(\"File name is required\");let t=await D(l,e,a);if(!t.success)throw Error(t.message?x(t.message):\"Error uploading file\");return M({type:\"success\",message:x(\"File_uploaded\")})}catch(e){return M({type:\"error\",message:e})}finally{A(!1),t()}}},R.current.send(null)};return k.createElement(a,{wrapperFunction:e=>k.createElement(o,l({is:\"form\",onSubmit:B(U)},e))},k.createElement(a.Header,null,k.createElement(a.Title,null,x(\"Save_To_Webdav\")),k.createElement(a.Close,{title:x(\"Close\"),onClick:t})),k.createElement(a.Content,null,q&&k.createElement(o,{alignItems:\"center\",display:\"flex\",justifyContent:\"center\",minHeight:\"x32\"},k.createElement(b,null)),!q&&k.createElement(i,null,k.createElement(c,null,k.createElement(s,null,x(\"Select_a_webdav_server\")),k.createElement(d,null,k.createElement(C,{name:\"accountId\",control:j,rules:{required:x(\"Required_field\",{field:x(\"Select_a_webdav_server\")})},render:e=>{let{field:t}=e;return k.createElement(E,l({},t,{options:Q,id:H,placeholder:x(\"Select_an_option\")}))}})),G.accountId&&k.createElement(m,null,G.accountId.message)))),k.createElement(a.Footer,null,k.createElement(a.FooterControllers,null,k.createElement(u,{onClick:t},x(\"Cancel\")),k.createElement(u,{primary:!0,type:\"submit\",loading:q},x(\"Save_To_Webdav\")))))})}","map":"{\"version\":3,\"sources\":[\"client/views/room/webdav/SaveToWebdavModal.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { MessageAttachment, IWebdavAccount } from '@rocket.chat/core-typings';\\nimport type { SelectOption } from '@rocket.chat/fuselage';\\nimport { Modal, Box, Button, FieldGroup, Field, FieldLabel, FieldRow, FieldError, Select, Throbber } from '@rocket.chat/fuselage';\\nimport { useUniqueId } from '@rocket.chat/fuselage-hooks';\\nimport { useMethod, useSetting, useToastMessageDispatch, useTranslation } from '@rocket.chat/ui-contexts';\\nimport type { ReactElement } from 'react';\\nimport React, { useState, useMemo, useEffect, useRef } from 'react';\\nimport { useForm, Controller } from 'react-hook-form';\\n\\nimport { useWebDAVAccountIntegrationsQuery } from '../../../hooks/webdav/useWebDAVAccountIntegrationsQuery';\\nimport { getWebdavServerName } from '../../../lib/getWebdavServerName';\\n\\ntype SaveToWebdavModalProps = {\\n\\tonClose: () => void;\\n\\tdata: {\\n\\t\\tattachment: MessageAttachment;\\n\\t\\turl: string;\\n\\t};\\n};\\n\\nconst SaveToWebdavModal = ({ onClose, data }: SaveToWebdavModalProps): ReactElement => {\\n\\tconst t = useTranslation();\\n\\tconst [isLoading, setIsLoading] = useState(false);\\n\\tconst dispatchToastMessage = useToastMessageDispatch();\\n\\tconst uploadFileToWebdav = useMethod('uploadFileToWebdav');\\n\\tconst fileRequest = useRef<XMLHttpRequest | null>(null);\\n\\tconst accountIdField = useUniqueId();\\n\\n\\tconst {\\n\\t\\tcontrol,\\n\\t\\thandleSubmit,\\n\\t\\tformState: { errors },\\n\\t} = useForm<{ accountId: string }>({ mode: 'all' });\\n\\n\\tconst enabled = useSetting<boolean>('Webdav_Integration_Enabled', false);\\n\\n\\tconst { data: value } = useWebDAVAccountIntegrationsQuery({ enabled });\\n\\n\\tconst accountsOptions: SelectOption[] = useMemo(() => {\\n\\t\\treturn value?.map(({ _id, ...current }) => [_id, getWebdavServerName(current)]) ?? [];\\n\\t}, [value]);\\n\\n\\tuseEffect(() => fileRequest.current?.abort, []);\\n\\n\\tconst handleSaveFile = ({ accountId }: { accountId: IWebdavAccount['_id'] }): void => {\\n\\t\\tsetIsLoading(true);\\n\\n\\t\\tconst {\\n\\t\\t\\turl,\\n\\t\\t\\tattachment: { title },\\n\\t\\t} = data;\\n\\n\\t\\tfileRequest.current = new XMLHttpRequest();\\n\\t\\tfileRequest.current.open('GET', url, true);\\n\\t\\tfileRequest.current.responseType = 'arraybuffer';\\n\\t\\tfileRequest.current.onload = async (): Promise<void> => {\\n\\t\\t\\tconst arrayBuffer = fileRequest.current?.response;\\n\\t\\t\\tif (arrayBuffer) {\\n\\t\\t\\t\\tconst fileData = new Uint8Array(arrayBuffer);\\n\\n\\t\\t\\t\\ttry {\\n\\t\\t\\t\\t\\tif (!title) {\\n\\t\\t\\t\\t\\t\\tthrow new Error('File name is required');\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tconst response = await uploadFileToWebdav(accountId, fileData, title);\\n\\t\\t\\t\\t\\tif (!response.success) {\\n\\t\\t\\t\\t\\t\\tthrow new Error(response.message ? t(response.message) : 'Error uploading file');\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\treturn dispatchToastMessage({ type: 'success', message: t('File_uploaded') });\\n\\t\\t\\t\\t} catch (error) {\\n\\t\\t\\t\\t\\treturn dispatchToastMessage({ type: 'error', message: error });\\n\\t\\t\\t\\t} finally {\\n\\t\\t\\t\\t\\tsetIsLoading(false);\\n\\t\\t\\t\\t\\tonClose();\\n\\t\\t\\t\\t}\\n\\t\\t\\t}\\n\\t\\t};\\n\\t\\tfileRequest.current.send(null);\\n\\t};\\n\\n\\treturn (\\n\\t\\t<Modal wrapperFunction={(props) => <Box is='form' onSubmit={handleSubmit(handleSaveFile)} {...props} />}>\\n\\t\\t\\t<Modal.Header>\\n\\t\\t\\t\\t<Modal.Title>{t('Save_To_Webdav')}</Modal.Title>\\n\\t\\t\\t\\t<Modal.Close title={t('Close')} onClick={onClose} />\\n\\t\\t\\t</Modal.Header>\\n\\t\\t\\t<Modal.Content>\\n\\t\\t\\t\\t{isLoading && (\\n\\t\\t\\t\\t\\t<Box alignItems='center' display='flex' justifyContent='center' minHeight='x32'>\\n\\t\\t\\t\\t\\t\\t<Throbber />\\n\\t\\t\\t\\t\\t</Box>\\n\\t\\t\\t\\t)}\\n\\t\\t\\t\\t{!isLoading && (\\n\\t\\t\\t\\t\\t<FieldGroup>\\n\\t\\t\\t\\t\\t\\t<Field>\\n\\t\\t\\t\\t\\t\\t\\t<FieldLabel>{t('Select_a_webdav_server')}</FieldLabel>\\n\\t\\t\\t\\t\\t\\t\\t<FieldRow>\\n\\t\\t\\t\\t\\t\\t\\t\\t<Controller\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tname='accountId'\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tcontrol={control}\\n\\t\\t\\t\\t\\t\\t\\t\\t\\trules={{ required: t('Required_field', { field: t('Select_a_webdav_server') }) }}\\n\\t\\t\\t\\t\\t\\t\\t\\t\\trender={({ field }): ReactElement => (\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<Select {...field} options={accountsOptions} id={accountIdField} placeholder={t('Select_an_option')} />\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t)}\\n\\t\\t\\t\\t\\t\\t\\t\\t/>\\n\\t\\t\\t\\t\\t\\t\\t</FieldRow>\\n\\t\\t\\t\\t\\t\\t\\t{errors.accountId && <FieldError>{errors.accountId.message}</FieldError>}\\n\\t\\t\\t\\t\\t\\t</Field>\\n\\t\\t\\t\\t\\t</FieldGroup>\\n\\t\\t\\t\\t)}\\n\\t\\t\\t</Modal.Content>\\n\\t\\t\\t<Modal.Footer>\\n\\t\\t\\t\\t<Modal.FooterControllers>\\n\\t\\t\\t\\t\\t<Button onClick={onClose}>{t('Cancel')}</Button>\\n\\t\\t\\t\\t\\t<Button primary type='submit' loading={isLoading}>\\n\\t\\t\\t\\t\\t\\t{t('Save_To_Webdav')}\\n\\t\\t\\t\\t\\t</Button>\\n\\t\\t\\t\\t</Modal.FooterControllers>\\n\\t\\t\\t</Modal.Footer>\\n\\t\\t</Modal>\\n\\t);\\n};\\nexport default SaveToWebdavModal;\\n\",null],\"names\":[\"_extends\",\"_objectWithoutProperties\",\"Modal\",\"Box\",\"Button\",\"FieldGroup\",\"Field\",\"FieldLabel\",\"FieldRow\",\"FieldError\",\"Select\",\"Throbber\",\"useUniqueId\",\"useMethod\",\"useSetting\",\"useToastMessageDispatch\",\"useTranslation\",\"React\",\"useState\",\"useMemo\",\"useEffect\",\"useRef\",\"useForm\",\"Controller\",\"useWebDAVAccountIntegrationsQuery\",\"getWebdavServerName\",\"module\",\"link\",\"default\",\"v\",\"exportDefault\",\"_ref\",\"onClose\",\"data\",\"t\",\"isLoading\",\"setIsLoading\",\"dispatchToastMessage\",\"uploadFileToWebdav\",\"fileRequest\",\"accountIdField\",\"control\",\"handleSubmit\",\"formState\",\"errors\",\"mode\",\"enabled\",\"value\",\"accountsOptions\",\"_value$map\",\"map\",\"_ref2\",\"_id\",\"current\",\"_excluded\",\"_fileRequest$current\",\"abort\",\"handleSaveFile\",\"_ref3\",\"accountId\",\"url\",\"attachment\",\"title\",\"XMLHttpRequest\",\"open\",\"responseType\",\"onload\",\"_fileRequest$current2\",\"arrayBuffer\",\"response\",\"fileData\",\"Uint8Array\",\"Error\",\"success\",\"message\",\"type\",\"error\",\"send\",\"createElement\",\"wrapperFunction\",\"props\",\"is\",\"onSubmit\",\"Header\",\"Title\",\"Close\",\"onClick\",\"Content\",\"alignItems\",\"display\",\"justifyContent\",\"minHeight\",\"name\",\"rules\",\"required\",\"field\",\"render\",\"_ref4\",\"options\",\"id\",\"placeholder\",\"Footer\",\"FooterControllers\",\"primary\",\"loading\"],\"mappings\":\"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\"}"}