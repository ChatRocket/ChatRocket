{"code":"function module(e,t,a){let r,s,n,i,l,o,p;a.export({RealAppsEngineUIHost:()=>U}),a.link(\"@rocket.chat/apps-engine/client/AppsEngineUIHost\",{AppsEngineUIHost(e){r=e}},0),a.link(\"meteor/meteor\",{Meteor(e){s=e}},1),a.link(\"../../app/models/client\",{ChatRoom(e){n=e}},2),a.link(\"../../app/utils/client/getUserAvatarURL\",{getUserAvatarURL(e){i=e}},3),a.link(\"../../app/utils/client/lib/SDKClient\",{sdk(e){l=e}},4),a.link(\"../lib/RoomManager\",{RoomManager(e){o=e}},5),a.link(\"../lib/baseURI\",{baseURI(e){p=e}},6);class U extends r{constructor(){super(),this._baseURL=void 0,this._baseURL=p.replace(/\\/$/,\"\")}getUserAvatarUrl(e){let t=i(e);return t.startsWith(\"http\")||t.startsWith(\"data\")?t:\"\".concat(this._baseURL).concat(t)}async getClientRoomInfo(){let{name:e,_id:t}=n.findOne(o.opened),a=[];try{let{members:e}=await l.rest.get(\"/v1/groups.members\",{roomId:t});a=e.map(e=>{let{_id:t,username:a}=e;return{id:t,username:a,avatarUrl:this.getUserAvatarUrl(a)}})}catch(e){console.warn(e)}return{id:t,slugifiedName:e,members:a}}async getClientUserInfo(){let{username:e,_id:t}=s.user();return{id:t,username:e,avatarUrl:this.getUserAvatarUrl(e)||\"\"}}}}","map":"{\"version\":3,\"sources\":[\"client/apps/RealAppsEngineUIHost.ts\",\"<anon>\"],\"sourcesContent\":[\"import { AppsEngineUIHost } from '@rocket.chat/apps-engine/client/AppsEngineUIHost';\\nimport type { IExternalComponentRoomInfo, IExternalComponentUserInfo } from '@rocket.chat/apps-engine/client/definition';\\nimport { Meteor } from 'meteor/meteor';\\n\\nimport { ChatRoom } from '../../app/models/client';\\nimport { getUserAvatarURL } from '../../app/utils/client/getUserAvatarURL';\\nimport { sdk } from '../../app/utils/client/lib/SDKClient';\\nimport { RoomManager } from '../lib/RoomManager';\\nimport { baseURI } from '../lib/baseURI';\\n\\n// FIXME: replace non-null assertions with proper error handling\\n\\nexport class RealAppsEngineUIHost extends AppsEngineUIHost {\\n\\tprivate _baseURL: string;\\n\\n\\tconstructor() {\\n\\t\\tsuper();\\n\\n\\t\\tthis._baseURL = baseURI.replace(/\\\\/$/, '');\\n\\t}\\n\\n\\tprivate getUserAvatarUrl(username: string) {\\n\\t\\tconst avatarUrl = getUserAvatarURL(username)!;\\n\\n\\t\\tif (!avatarUrl.startsWith('http') && !avatarUrl.startsWith('data')) {\\n\\t\\t\\treturn `${this._baseURL}${avatarUrl}`;\\n\\t\\t}\\n\\n\\t\\treturn avatarUrl;\\n\\t}\\n\\n\\tasync getClientRoomInfo(): Promise<IExternalComponentRoomInfo> {\\n\\t\\tconst { name: slugifiedName, _id: id } = ChatRoom.findOne(RoomManager.opened)!;\\n\\n\\t\\tlet cachedMembers: IExternalComponentUserInfo[] = [];\\n\\t\\ttry {\\n\\t\\t\\tconst { members } = await sdk.rest.get('/v1/groups.members', { roomId: id });\\n\\n\\t\\t\\tcachedMembers = members.map(\\n\\t\\t\\t\\t({ _id, username }): IExternalComponentUserInfo => ({\\n\\t\\t\\t\\t\\tid: _id,\\n\\t\\t\\t\\t\\tusername: username!,\\n\\t\\t\\t\\t\\tavatarUrl: this.getUserAvatarUrl(username!),\\n\\t\\t\\t\\t}),\\n\\t\\t\\t);\\n\\t\\t} catch (error) {\\n\\t\\t\\tconsole.warn(error);\\n\\t\\t}\\n\\n\\t\\treturn {\\n\\t\\t\\tid,\\n\\t\\t\\tslugifiedName: slugifiedName!,\\n\\t\\t\\tmembers: cachedMembers,\\n\\t\\t};\\n\\t}\\n\\n\\tasync getClientUserInfo(): Promise<IExternalComponentUserInfo> {\\n\\t\\tconst { username, _id } = Meteor.user()!;\\n\\n\\t\\treturn {\\n\\t\\t\\tid: _id,\\n\\t\\t\\tusername: username!,\\n\\t\\t\\tavatarUrl: this.getUserAvatarUrl(username!) || '',\\n\\t\\t};\\n\\t}\\n}\\n\",null],\"names\":[\"AppsEngineUIHost\",\"Meteor\",\"ChatRoom\",\"getUserAvatarURL\",\"sdk\",\"RoomManager\",\"baseURI\",\"module\",\"export\",\"RealAppsEngineUIHost\",\"link\",\"v\",\"constructor\",\"_baseURL\",\"replace\",\"getUserAvatarUrl\",\"username\",\"avatarUrl\",\"startsWith\",\"concat\",\"getClientRoomInfo\",\"name\",\"slugifiedName\",\"_id\",\"id\",\"findOne\",\"opened\",\"cachedMembers\",\"members\",\"rest\",\"get\",\"roomId\",\"map\",\"_ref\",\"error\",\"console\",\"warn\",\"getClientUserInfo\",\"user\"],\"mappings\":\"2BAAiCA,EAAmDC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAApFC,EAAOC,MAAE,CAAA,CAAAC,qBAAwBA,IAAAA,CAAA,GAAmDF,EAAAG,IAAA,CAAA,mDAAA,CAAAV,iBAAAW,CAAA,EAAAX,EAAAW,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,gBAAA,CAAAT,OAAAU,CAAA,EAAAV,EAAAU,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,0BAAA,CAAAR,SAAAS,CAAA,EAAAT,EAAAS,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,0CAAA,CAAAP,iBAAAQ,CAAA,EAAAR,EAAAQ,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,uCAAA,CAAAN,IAAAO,CAAA,EAAAP,EAAAO,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,qBAAA,CAAAL,YAAAM,CAAA,EAAAN,EAAAM,CAAA,CAAA,EAAA,GAAAJ,EAAAG,IAAA,CAAA,iBAAA,CAAAJ,QAAAK,CAAA,EAAAL,EAAAK,CAAA,CAAA,EAAA,EAY9E,OAAOF,UAA6BT,EAGzCY,aAAA,CACC,KAAK,GAAG,IAAA,CAHDC,QAAQ,CAAA,KAAA,EAKf,IAAI,CAACA,QAAQ,CAAGP,EAAQQ,OAAO,CAAC,MAAO,GACxC,CAEQC,iBAAiBC,CAAgB,CAAA,CACxC,IAAMC,EAAYd,EAAiBa,UAEnC,AAAI,AAACC,EAAUC,UAAU,CAAC,SAAYD,EAAUC,UAAU,CAAC,QAIpDD,EAHN,GAAAE,MAAA,CAAU,IAAI,CAACN,QAAQ,EAAAM,MAAA,CAAGF,EAI5B,CAEA,MAAMG,mBAAiB,CACtB,GAAM,CAAEC,KAAMC,CAAa,CAAEC,IAAKC,CAAAA,CAAI,CAAGtB,EAASuB,OAAO,CAACpB,EAAYqB,MAAM,EAExEC,EAA8C,EAAE,CACpD,GAAI,CACH,GAAM,CAAEC,QAAAA,CAAAA,CAAS,CAAG,MAAMxB,EAAIyB,IAAI,CAACC,GAAG,CAAC,qBAAsB,CAAEC,OAAQP,CAAE,GAEzEG,EAAgBC,EAAQI,GAAG,CAC1BC,IAAA,GAAC,CAAEV,IAAAA,CAAG,CAAEP,SAAAA,CAAAA,CAAU,CAAAiB,EAAA,MAAkC,CACnDT,GAAID,EACJP,SAAUA,EACVC,UAAW,IAAI,CAACF,gBAAgB,CAACC,GACjC,EAEH,CAAE,MAAOkB,EAAO,CACfC,QAAQC,IAAI,CAACF,EACd,CAEA,MAAO,CACNV,GAAAA,EACAF,cAAeA,EACfM,QAASD,EAEX,CAEA,MAAMU,mBAAiB,CACtB,GAAM,CAAErB,SAAAA,CAAQ,CAAEO,IAAAA,CAAAA,CAAK,CAAGtB,EAAOqC,IAAI,GAErC,MAAO,CACNd,GAAID,EACJP,SAAUA,EACVC,UAAW,IAAI,CAACF,gBAAgB,CAACC,IAAc,GAEjD\"}"}