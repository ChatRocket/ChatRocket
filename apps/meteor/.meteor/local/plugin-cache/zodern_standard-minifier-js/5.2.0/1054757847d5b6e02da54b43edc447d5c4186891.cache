{"code":"function module(e,n,t){var u,r,i,c,a,o,s,l,f,d,b=[\"enabled\"];t.link(\"@babel/runtime/regenerator\",{default:function(e){u=e}},0),t.link(\"@babel/runtime/helpers/objectSpread2\",{default:function(e){r=e}},1),t.link(\"@babel/runtime/helpers/objectWithoutProperties\",{default:function(e){i=e}},2),t.export({useWebDAVAccountIntegrationsQuery:function(){return v}}),t.link(\"@rocket.chat/ui-contexts\",{useUserId:function(e){c=e},useEndpoint:function(e){a=e},useStream:function(e){o=e}},0),t.link(\"@tanstack/react-query\",{useQuery:function(e){s=e},useQueryClient:function(e){l=e}},1),t.link(\"react\",{useEffect:function(e){f=e},useMemo:function(e){d=e}},2);var v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.enabled,t=void 0===n||n,v=i(e,b),y=c(),p=d(function(){return[\"webdav\",\"account-integrations\"]},[]),h=a(\"GET\",\"/v1/webdav.getMyAccounts\"),k=s(r({queryKey:p,queryFn:function(){var e;return u.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.awrap(h());case 2:return e=n.sent.accounts,n.abrupt(\"return\",e);case 5:case\"end\":return n.stop()}},null,null,null,Promise)},enabled:!!y&&t,staleTime:1/0},v)),m=l(),g=o(\"notify-user\");return f(function(){if(y&&t)return g(y+\"/webdav\",function(e){var n=e.type,t=e.account;switch(n){case\"changed\":m.invalidateQueries(p);break;case\"removed\":m.setQueryData(p,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(function(e){return e._id!==t._id})})}})},[t,m,p,y,g]),k}}","map":"{\"version\":3,\"sources\":[\"client/hooks/webdav/useWebDAVAccountIntegrationsQuery.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IWebdavAccountIntegration } from '@rocket.chat/core-typings';\\nimport { useUserId, useEndpoint, useStream } from '@rocket.chat/ui-contexts';\\nimport type { UseQueryOptions } from '@tanstack/react-query';\\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\\nimport { useEffect, useMemo } from 'react';\\n\\ntype UseWebDAVAccountIntegrationsQueryOptions = Omit<\\n\\tUseQueryOptions<IWebdavAccountIntegration[], unknown, IWebdavAccountIntegration[], readonly ['webdav', 'account-integrations']>,\\n\\t'queryKey' | 'queryFn'\\n>;\\n\\nexport const useWebDAVAccountIntegrationsQuery = ({ enabled = true, ...options }: UseWebDAVAccountIntegrationsQueryOptions = {}) => {\\n\\tconst uid = useUserId();\\n\\n\\tconst queryKey = useMemo(() => ['webdav', 'account-integrations'] as const, []);\\n\\n\\tconst getMyAccounts = useEndpoint('GET', '/v1/webdav.getMyAccounts');\\n\\n\\tconst integrationsQuery = useQuery({\\n\\t\\tqueryKey,\\n\\t\\tqueryFn: async (): Promise<IWebdavAccountIntegration[]> => {\\n\\t\\t\\tconst { accounts } = await getMyAccounts();\\n\\t\\t\\treturn accounts;\\n\\t\\t},\\n\\t\\tenabled: !!uid && enabled,\\n\\t\\tstaleTime: Infinity,\\n\\t\\t...options,\\n\\t});\\n\\n\\tconst queryClient = useQueryClient();\\n\\n\\tconst subscribeToNotifyUser = useStream('notify-user');\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!uid || !enabled) {\\n\\t\\t\\treturn;\\n\\t\\t}\\n\\n\\t\\treturn subscribeToNotifyUser(`${uid}/webdav`, ({ type, account }) => {\\n\\t\\t\\tswitch (type) {\\n\\t\\t\\t\\tcase 'changed':\\n\\t\\t\\t\\t\\tqueryClient.invalidateQueries(queryKey);\\n\\t\\t\\t\\t\\tbreak;\\n\\n\\t\\t\\t\\tcase 'removed':\\n\\t\\t\\t\\t\\tqueryClient.setQueryData<IWebdavAccountIntegration[]>(queryKey, (old = []) => {\\n\\t\\t\\t\\t\\t\\treturn old.filter((oldAccount) => oldAccount._id !== account._id);\\n\\t\\t\\t\\t\\t});\\n\\t\\t\\t\\t\\tbreak;\\n\\t\\t\\t}\\n\\t\\t});\\n\\t}, [enabled, queryClient, queryKey, uid, subscribeToNotifyUser]);\\n\\n\\treturn integrationsQuery;\\n};\\n\",null],\"names\":[\"_regeneratorRuntime\",\"_objectSpread\",\"_objectWithoutProperties\",\"useUserId\",\"useEndpoint\",\"useStream\",\"useQuery\",\"useQueryClient\",\"useEffect\",\"useMemo\",\"module\",\"link\",\"default\",\"v\",\"export\",\"useWebDAVAccountIntegrationsQuery\",\"_ref\",\"arguments\",\"length\",\"undefined\",\"_ref$enabled\",\"enabled\",\"options\",\"_excluded\",\"uid\",\"queryKey\",\"getMyAccounts\",\"integrationsQuery\",\"queryFn\",\"accounts\",\"async\",\"_context\",\"prev\",\"next\",\"awrap\",\"_await$getMyAccounts\",\"sent\",\"abrupt\",\"stop\",\"Promise\",\"staleTime\",\"Infinity\",\"queryClient\",\"subscribeToNotifyUser\",\"_ref2\",\"type\",\"account\",\"invalidateQueries\",\"setQueryData\",\"old\",\"filter\",\"oldAccount\",\"_id\"],\"mappings\":\"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\"}"}