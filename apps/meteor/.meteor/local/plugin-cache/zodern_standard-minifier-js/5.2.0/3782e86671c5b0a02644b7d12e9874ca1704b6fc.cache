{"code":"function module(e,n,t){t.link(\"@babel/runtime/helpers/slicedToArray\",{default:function(e){r=e}},0),t.link(\"@babel/runtime/helpers/createClass\",{default:function(e){i=e}},1),t.export({MentionsParser:function(){return o}}),t.link(\"@rocket.chat/string-helpers\",{escapeHTML:function(e){a=e}},0);var r,i,a,u=function(e){var n=e.prefix,t=e.className,r=e.mention,i=e.title,a=void 0===i?\"\":i,u=e.label,l=e.type;return n+'<a class=\"'+t+'\" data-'+(void 0===l?\"username\":l)+'=\"'+r+'\"'+(a?' title=\"'+a+'\"':\"\")+\">\"+u+\"</a>\"},l=function(e){return e.prefix+'<a class=\"mention-link mention-link--room\" data-channel=\"'+e.reference+'\">#'+e.mention+\"</a>\"},o=function(){function e(e){var n=this,t=e.pattern,i=e.useRealName,o=e.me,s=e.roomTemplate,m=void 0===s?l:s,p=e.userTemplate,c=void 0===p?u:p;this.me=void 0,this.pattern=void 0,this.userTemplate=void 0,this.roomTemplate=void 0,this.useRealName=void 0,this.replaceUsers=function(e,t,i){var u=t.mentions,l=t.temp;return e.replace(n.userMentionRegex,function(e,t,o){var s=[\"mention-link\"];\"all\"===o?(s.push(\"mention-link--all\"),s.push(\"mention-link--group\")):\"here\"===o?(s.push(\"mention-link--here\"),s.push(\"mention-link--group\")):(o===i&&s.push(\"mention-link--me\"),s.push(\"mention-link--user\"));var m=s.join(\" \");if(\"all\"===o||\"here\"===o)return n.userTemplate({prefix:t,className:m,mention:o,label:o,type:\"group\"});var p=function(e){var n=e.username,t=e.type;return(!t||\"user\"===t)&&n===o},c=function(e){var n=e.name;return\"team\"===e.type&&n===o},h=(u||[]).filter(function(e){return e&&(p(e)||c(e))}),f=r(h,1)[0],v=l?o&&a(o):f&&a((\"team\"===f.type||n.useRealName()?f.name:f.username)||\"\");return v?n.userTemplate({prefix:t,className:m,mention:o,label:v,type:(null==f?void 0:f.type)===\"team\"?\"team\":\"username\",title:n.useRealName()?o:v}):e})},this.replaceChannels=function(e,t){var r=t.temp,i=t.channels;return e.replace(/&#39;/g,\"'\").replace(n.channelMentionRegex,function(e,t,a){if(!r&&!(null!=i&&i.find(function(e){return e.name===a})))return e;var u=null==i?void 0:i.find(function(e){return e.name===a}),l=u?u._id:a;return n.roomTemplate({prefix:t,reference:l,channel:u,mention:a})})},this.pattern=t,this.useRealName=i||function(){return!1},this.me=o||function(){return\"\"},this.userTemplate=c,this.roomTemplate=m}var n=e.prototype;return n.getUserMentions=function(e){return(e.match(this.userMentionRegex)||[]).map(function(e){return e.trim()})},n.getChannelMentions=function(e){return(e.match(this.channelMentionRegex)||[]).map(function(e){return e.trim()})},n.parse=function(e){var n=(null==e?void 0:e.html)||\"\";return n.trim()&&(n=this.replaceUsers(n,e,this.me()),n=this.replaceChannels(n,e),e.html=n),e},i(e,[{key:\"userMentionRegex\",get:function(){return RegExp(\"(^|\\\\s|>)@(\"+this.pattern()+\"(@(\"+this.pattern()+\"))?(:([0-9a-zA-Z-_.]+))?)\",\"gm\")}},{key:\"channelMentionRegex\",get:function(){return RegExp(\"(^|\\\\s|>)#(\"+this.pattern()+\"(@(\"+this.pattern()+\"))?)\",\"gm\")}}])}()}","map":"{\"version\":3,\"sources\":[\"app/mentions/lib/MentionsParser.ts\",\"<anon>\"],\"sourcesContent\":[\"import type { IMessage } from '@rocket.chat/core-typings';\\nimport { escapeHTML } from '@rocket.chat/string-helpers';\\n\\nexport type MentionsParserArgs = {\\n\\tpattern: () => string;\\n\\tuseRealName?: () => boolean;\\n\\tme?: () => string;\\n\\troomTemplate?: (args: { prefix: string; reference: string; mention: string; channel?: any }) => string;\\n\\tuserTemplate?: (args: { prefix: string; className: string; mention: string; title?: string; label: string; type?: string }) => string;\\n};\\n\\nconst userTemplateDefault = ({\\n\\tprefix,\\n\\tclassName,\\n\\tmention,\\n\\ttitle = '',\\n\\tlabel,\\n\\ttype = 'username',\\n}: {\\n\\tprefix: string;\\n\\tclassName: string;\\n\\tmention: string;\\n\\ttitle?: string;\\n\\tlabel?: string;\\n\\ttype?: string;\\n}) => `${prefix}<a class=\\\"${className}\\\" data-${type}=\\\"${mention}\\\"${title ? ` title=\\\"${title}\\\"` : ''}>${label}</a>`;\\n\\nconst roomTemplateDefault = ({ prefix, reference, mention }: { prefix: string; reference: string; mention: string }) =>\\n\\t`${prefix}<a class=\\\"mention-link mention-link--room\\\" data-channel=\\\"${reference}\\\">${`#${mention}`}</a>`;\\n\\nexport class MentionsParser {\\n\\tme: () => string;\\n\\n\\tpattern: MentionsParserArgs['pattern'];\\n\\n\\tuserTemplate: (args: { prefix: string; className: string; mention: string; title?: string; label: string; type?: string }) => string;\\n\\n\\troomTemplate: (args: { prefix: string; reference: string; mention: string; channel?: any }) => string;\\n\\n\\tuseRealName: () => boolean;\\n\\n\\tconstructor({ pattern, useRealName, me, roomTemplate = roomTemplateDefault, userTemplate = userTemplateDefault }: MentionsParserArgs) {\\n\\t\\tthis.pattern = pattern;\\n\\t\\tthis.useRealName = useRealName || (() => false);\\n\\t\\tthis.me = me || (() => '');\\n\\t\\tthis.userTemplate = userTemplate;\\n\\t\\tthis.roomTemplate = roomTemplate;\\n\\t}\\n\\n\\tget userMentionRegex() {\\n\\t\\treturn new RegExp(`(^|\\\\\\\\s|>)@(${this.pattern()}(@(${this.pattern()}))?(:([0-9a-zA-Z-_.]+))?)`, 'gm');\\n\\t}\\n\\n\\tget channelMentionRegex() {\\n\\t\\treturn new RegExp(`(^|\\\\\\\\s|>)#(${this.pattern()}(@(${this.pattern()}))?)`, 'gm');\\n\\t}\\n\\n\\treplaceUsers = (msg: string, { mentions, temp }: IMessage, me: string) =>\\n\\t\\tmsg.replace(this.userMentionRegex, (match, prefix, mention) => {\\n\\t\\t\\tconst classNames = ['mention-link'];\\n\\n\\t\\t\\tif (mention === 'all') {\\n\\t\\t\\t\\tclassNames.push('mention-link--all');\\n\\t\\t\\t\\tclassNames.push('mention-link--group');\\n\\t\\t\\t} else if (mention === 'here') {\\n\\t\\t\\t\\tclassNames.push('mention-link--here');\\n\\t\\t\\t\\tclassNames.push('mention-link--group');\\n\\t\\t\\t} else if (mention === me) {\\n\\t\\t\\t\\tclassNames.push('mention-link--me');\\n\\t\\t\\t\\tclassNames.push('mention-link--user');\\n\\t\\t\\t} else {\\n\\t\\t\\t\\tclassNames.push('mention-link--user');\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst className = classNames.join(' ');\\n\\n\\t\\t\\tif (mention === 'all' || mention === 'here') {\\n\\t\\t\\t\\treturn this.userTemplate({ prefix, className, mention, label: mention, type: 'group' });\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst filterUser = ({ username, type }: { username?: string; type?: string }) => (!type || type === 'user') && username === mention;\\n\\t\\t\\tconst filterTeam = ({ name, type }: { name?: string; type?: string }) => type === 'team' && name === mention;\\n\\n\\t\\t\\tconst [mentionObj] = (mentions || []).filter((m) => m && (filterUser(m) || filterTeam(m)));\\n\\n\\t\\t\\tconst label = temp\\n\\t\\t\\t\\t? mention && escapeHTML(mention)\\n\\t\\t\\t\\t: mentionObj && escapeHTML((mentionObj.type === 'team' || this.useRealName() ? mentionObj.name : mentionObj.username) || '');\\n\\n\\t\\t\\tif (!label) {\\n\\t\\t\\t\\treturn match;\\n\\t\\t\\t}\\n\\n\\t\\t\\treturn this.userTemplate({\\n\\t\\t\\t\\tprefix,\\n\\t\\t\\t\\tclassName,\\n\\t\\t\\t\\tmention,\\n\\t\\t\\t\\tlabel,\\n\\t\\t\\t\\ttype: mentionObj?.type === 'team' ? 'team' : 'username',\\n\\t\\t\\t\\ttitle: this.useRealName() ? mention : label,\\n\\t\\t\\t});\\n\\t\\t});\\n\\n\\treplaceChannels = (msg: string, { temp, channels }: IMessage) =>\\n\\t\\tmsg.replace(/&#39;/g, \\\"'\\\").replace(this.channelMentionRegex, (match, prefix, mention) => {\\n\\t\\t\\tif (\\n\\t\\t\\t\\t!temp &&\\n\\t\\t\\t\\t!channels?.find((c) => {\\n\\t\\t\\t\\t\\treturn c.name === mention;\\n\\t\\t\\t\\t})\\n\\t\\t\\t) {\\n\\t\\t\\t\\treturn match;\\n\\t\\t\\t}\\n\\n\\t\\t\\tconst channel = channels?.find(({ name }) => {\\n\\t\\t\\t\\treturn name === mention;\\n\\t\\t\\t});\\n\\t\\t\\tconst reference = channel ? channel._id : mention;\\n\\t\\t\\treturn this.roomTemplate({ prefix, reference, channel, mention });\\n\\t\\t});\\n\\n\\tgetUserMentions(str: string) {\\n\\t\\treturn (str.match(this.userMentionRegex) || []).map((match) => match.trim());\\n\\t}\\n\\n\\tgetChannelMentions(str: string) {\\n\\t\\treturn (str.match(this.channelMentionRegex) || []).map((match) => match.trim());\\n\\t}\\n\\n\\tparse(message: IMessage) {\\n\\t\\tlet msg = message?.html || '';\\n\\t\\tif (!msg.trim()) {\\n\\t\\t\\treturn message;\\n\\t\\t}\\n\\t\\tmsg = this.replaceUsers(msg, message, this.me());\\n\\t\\tmsg = this.replaceChannels(msg, message);\\n\\t\\tmessage.html = msg;\\n\\t\\treturn message;\\n\\t}\\n}\\n\",null],\"names\":[\"module\",\"link\",\"default\",\"v\",\"_slicedToArray\",\"_createClass\",\"export\",\"MentionsParser\",\"escapeHTML\",\"userTemplateDefault\",\"_ref\",\"prefix\",\"className\",\"mention\",\"_ref$title\",\"title\",\"label\",\"_ref$type\",\"type\",\"roomTemplateDefault\",\"_ref2\",\"reference\",\"_ref3\",\"_this\",\"pattern\",\"useRealName\",\"me\",\"_ref3$roomTemplate\",\"roomTemplate\",\"_ref3$userTemplate\",\"userTemplate\",\"replaceUsers\",\"msg\",\"_ref4\",\"mentions\",\"temp\",\"replace\",\"userMentionRegex\",\"match\",\"classNames\",\"push\",\"join\",\"filterUser\",\"_ref5\",\"username\",\"filterTeam\",\"_ref6\",\"name\",\"_filter\",\"filter\",\"m\",\"mentionObj\",\"_filter2\",\"replaceChannels\",\"_ref7\",\"channels\",\"channelMentionRegex\",\"find\",\"c\",\"channel\",\"_ref8\",\"_id\",\"_proto\",\"prototype\",\"getUserMentions\",\"str\",\"map\",\"trim\",\"getChannelMentions\",\"parse\",\"message\",\"html\",\"key\",\"get\",\"RegExp\"],\"mappings\":\"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\"}"}