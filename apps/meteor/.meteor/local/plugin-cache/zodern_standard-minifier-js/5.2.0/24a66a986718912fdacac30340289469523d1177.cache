{"code":"function module(e,t,l){let n,i,a,o,r,u,s,c,k,d,g,f,v,p,m,h,y,C,b,R,S;l.link(\"@rocket.chat/fuselage-hooks\",{useLocalStorage(e){n=e}},0),l.link(\"@rocket.chat/ui-contexts\",{UserContext(e){i=e},useEndpoint(e){a=e}},1),l.link(\"meteor/meteor\",{Meteor(e){o=e}},2),l.link(\"react\",{default(e){r=e},useEffect(e){u=e},useMemo(e){s=e},useRef(e){c=e}},3),l.link(\"../../../app/models/client\",{Subscriptions(e){k=e},ChatRoom(e){d=e}},4),l.link(\"../../../app/utils/client\",{getUserPreference(e){g=e}},5),l.link(\"../../../app/utils/client/lib/SDKClient\",{sdk(e){f=e}},6),l.link(\"../../../lib/callbacks/afterLogoutCleanUpCallback\",{afterLogoutCleanUpCallback(e){v=e}},7),l.link(\"../../hooks/useReactiveValue\",{useReactiveValue(e){p=e}},8),l.link(\"../../lib/createReactiveSubscriptionFactory\",{createReactiveSubscriptionFactory(e){m=e}},9),l.link(\"../../lib/queryClient\",{queryClient(e){h=e}},10),l.link(\"../../views/account/accessibility/hooks/useCreateFontStyleElement\",{useCreateFontStyleElement(e){y=e}},11),l.link(\"./hooks/useClearRemovedRoomsHistory\",{useClearRemovedRoomsHistory(e){C=e}},12),l.link(\"./hooks/useDeleteUser\",{useDeleteUser(e){b=e}},13),l.link(\"./hooks/useEmailVerificationWarning\",{useEmailVerificationWarning(e){R=e}},14),l.link(\"./hooks/useUpdateAvatar\",{useUpdateAvatar(e){S=e}},15);let U=()=>o.user(),E=()=>o.userId(),q=()=>new Promise((e,t)=>{let l=U();if(!l)return e();o.logout(async()=>{await v.run(l),f.call(\"logoutCleanUp\",l).then(e,t)})});l.exportDefault(e=>{var t,l;let{children:o}=e,f=p(U),v=p(E),P=c(v),[L,D]=n(\"userLanguage\",\"\"),[F,V]=n(\"preferedLanguage\",\"\"),w=a(\"POST\",\"/v1/users.setPreferences\"),x=y();x(null==f?void 0:null===(t=f.settings)||void 0===t?void 0:null===(l=t.preferences)||void 0===l?void 0:l.fontSize),R(null!=f?f:void 0),C(v),b(),S();let O=s(()=>({userId:v,user:f,queryPreference:m((e,t)=>g(v,e,t)),querySubscription:m((e,t,l)=>k.findOne(e,{fields:t,sort:l})),queryRoom:m((e,t)=>d.findOne(e,{fields:t})),querySubscriptions:m((e,t)=>v?k.find(e,t).fetch():d.find(e,t).fetch()),logout:q}),[v,f]);return u(()=>{v&&F!==L&&(w({data:{language:F}}),D(F)),(null==f?void 0:f.language)!==void 0&&f.language!==L&&(D(f.language),V(f.language))},[F,V,D,null==f?void 0:f.language,L,v,w]),u(()=>{P.current&&P.current!==v&&h.clear(),P.current=v},[v]),r.createElement(i.Provider,{children:o,value:O})})}","map":"{\"version\":3,\"sources\":[\"client/providers/UserProvider/UserProvider.tsx\",\"<anon>\"],\"sourcesContent\":[\"import type { IRoom, ISubscription, IUser } from '@rocket.chat/core-typings';\\nimport { useLocalStorage } from '@rocket.chat/fuselage-hooks';\\nimport type { SubscriptionWithRoom } from '@rocket.chat/ui-contexts';\\nimport { UserContext, useEndpoint } from '@rocket.chat/ui-contexts';\\nimport { Meteor } from 'meteor/meteor';\\nimport type { ContextType, ReactElement, ReactNode } from 'react';\\nimport React, { useEffect, useMemo, useRef } from 'react';\\n\\nimport { Subscriptions, ChatRoom } from '../../../app/models/client';\\nimport { getUserPreference } from '../../../app/utils/client';\\nimport { sdk } from '../../../app/utils/client/lib/SDKClient';\\nimport { afterLogoutCleanUpCallback } from '../../../lib/callbacks/afterLogoutCleanUpCallback';\\nimport { useReactiveValue } from '../../hooks/useReactiveValue';\\nimport { createReactiveSubscriptionFactory } from '../../lib/createReactiveSubscriptionFactory';\\nimport { queryClient } from '../../lib/queryClient';\\nimport { useCreateFontStyleElement } from '../../views/account/accessibility/hooks/useCreateFontStyleElement';\\nimport { useClearRemovedRoomsHistory } from './hooks/useClearRemovedRoomsHistory';\\nimport { useDeleteUser } from './hooks/useDeleteUser';\\nimport { useEmailVerificationWarning } from './hooks/useEmailVerificationWarning';\\nimport { useUpdateAvatar } from './hooks/useUpdateAvatar';\\n\\nconst getUser = (): IUser | null => Meteor.user() as IUser | null;\\n\\nconst getUserId = (): string | null => Meteor.userId();\\n\\nconst logout = (): Promise<void> =>\\n\\tnew Promise((resolve, reject) => {\\n\\t\\tconst user = getUser();\\n\\n\\t\\tif (!user) {\\n\\t\\t\\treturn resolve();\\n\\t\\t}\\n\\n\\t\\tMeteor.logout(async () => {\\n\\t\\t\\tawait afterLogoutCleanUpCallback.run(user);\\n\\t\\t\\tsdk.call('logoutCleanUp', user).then(resolve, reject);\\n\\t\\t});\\n\\t});\\n\\ntype UserProviderProps = {\\n\\tchildren: ReactNode;\\n};\\n\\nconst UserProvider = ({ children }: UserProviderProps): ReactElement => {\\n\\tconst user = useReactiveValue(getUser);\\n\\tconst userId = useReactiveValue(getUserId);\\n\\tconst previousUserId = useRef(userId);\\n\\tconst [userLanguage, setUserLanguage] = useLocalStorage('userLanguage', '');\\n\\tconst [preferedLanguage, setPreferedLanguage] = useLocalStorage('preferedLanguage', '');\\n\\n\\tconst setUserPreferences = useEndpoint('POST', '/v1/users.setPreferences');\\n\\n\\tconst createFontStyleElement = useCreateFontStyleElement();\\n\\tcreateFontStyleElement(user?.settings?.preferences?.fontSize);\\n\\n\\tuseEmailVerificationWarning(user ?? undefined);\\n\\tuseClearRemovedRoomsHistory(userId);\\n\\n\\tuseDeleteUser();\\n\\tuseUpdateAvatar();\\n\\n\\tconst contextValue = useMemo(\\n\\t\\t(): ContextType<typeof UserContext> => ({\\n\\t\\t\\tuserId,\\n\\t\\t\\tuser,\\n\\t\\t\\tqueryPreference: createReactiveSubscriptionFactory(\\n\\t\\t\\t\\t<T,>(key: string, defaultValue?: T) => getUserPreference(userId, key, defaultValue) as T,\\n\\t\\t\\t),\\n\\t\\t\\tquerySubscription: createReactiveSubscriptionFactory<ISubscription | undefined>((query, fields, sort) =>\\n\\t\\t\\t\\tSubscriptions.findOne(query, { fields, sort }),\\n\\t\\t\\t),\\n\\t\\t\\tqueryRoom: createReactiveSubscriptionFactory<IRoom | undefined>((query, fields) => ChatRoom.findOne(query, { fields })),\\n\\t\\t\\tquerySubscriptions: createReactiveSubscriptionFactory<SubscriptionWithRoom[]>((query, options) => {\\n\\t\\t\\t\\tif (userId) {\\n\\t\\t\\t\\t\\treturn Subscriptions.find(query, options).fetch();\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\treturn ChatRoom.find(query, options).fetch();\\n\\t\\t\\t}),\\n\\t\\t\\tlogout,\\n\\t\\t}),\\n\\t\\t[userId, user],\\n\\t);\\n\\n\\tuseEffect(() => {\\n\\t\\tif (!!userId && preferedLanguage !== userLanguage) {\\n\\t\\t\\tsetUserPreferences({ data: { language: preferedLanguage } });\\n\\t\\t\\tsetUserLanguage(preferedLanguage);\\n\\t\\t}\\n\\n\\t\\tif (user?.language !== undefined && user.language !== userLanguage) {\\n\\t\\t\\tsetUserLanguage(user.language);\\n\\t\\t\\tsetPreferedLanguage(user.language);\\n\\t\\t}\\n\\t}, [preferedLanguage, setPreferedLanguage, setUserLanguage, user?.language, userLanguage, userId, setUserPreferences]);\\n\\n\\tuseEffect(() => {\\n\\t\\tif (previousUserId.current && previousUserId.current !== userId) {\\n\\t\\t\\tqueryClient.clear();\\n\\t\\t}\\n\\n\\t\\tpreviousUserId.current = userId;\\n\\t}, [userId]);\\n\\n\\treturn <UserContext.Provider children={children} value={contextValue} />;\\n};\\n\\nexport default UserProvider;\\n\",null],\"names\":[\"useLocalStorage\",\"UserContext\",\"useEndpoint\",\"Meteor\",\"React\",\"useEffect\",\"useMemo\",\"useRef\",\"Subscriptions\",\"ChatRoom\",\"getUserPreference\",\"sdk\",\"afterLogoutCleanUpCallback\",\"useReactiveValue\",\"createReactiveSubscriptionFactory\",\"queryClient\",\"useCreateFontStyleElement\",\"useClearRemovedRoomsHistory\",\"useDeleteUser\",\"useEmailVerificationWarning\",\"useUpdateAvatar\",\"module\",\"link\",\"v\",\"default\",\"getUser\",\"user\",\"getUserId\",\"userId\",\"logout\",\"Promise\",\"resolve\",\"reject\",\"run\",\"call\",\"then\",\"exportDefault\",\"_ref\",\"_user$settings\",\"_user$settings$prefer\",\"children\",\"previousUserId\",\"userLanguage\",\"setUserLanguage\",\"preferedLanguage\",\"setPreferedLanguage\",\"setUserPreferences\",\"createFontStyleElement\",\"settings\",\"preferences\",\"fontSize\",\"undefined\",\"contextValue\",\"queryPreference\",\"key\",\"defaultValue\",\"querySubscription\",\"query\",\"fields\",\"sort\",\"findOne\",\"queryRoom\",\"querySubscriptions\",\"options\",\"find\",\"fetch\",\"data\",\"language\",\"current\",\"clear\",\"createElement\",\"Provider\",\"value\"],\"mappings\":\"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\"}"}