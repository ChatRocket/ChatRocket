[{"type":"js","data":"//////////////////////////////////////////////////////////////////////////\n//                                                                      //\n// This is a generated file. You can view the original                  //\n// source in your browser if your browser supports source maps.         //\n// Source maps are supported by all recent versions of Chrome, Safari,  //\n// and Firefox, and by Internet Explorer 11.                            //\n//                                                                      //\n//////////////////////////////////////////////////////////////////////////\n\n\nPackage[\"core-runtime\"].queue(\"rocketchat:streamer\",function () {/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar DDPCommon = Package['ddp-common'].DDPCommon;\nvar check = Package.check.check;\nvar Match = Package.check.Match;\nvar Tracker = Package.tracker.Tracker;\nvar Deps = Package.tracker.Deps;\nvar meteorInstall = Package.modules.meteorInstall;\nvar meteorBabelHelpers = Package.modules.meteorBabelHelpers;\nvar Promise = Package.promise.Promise;\nvar Symbol = Package['ecmascript-runtime-client'].Symbol;\nvar Map = Package['ecmascript-runtime-client'].Map;\nvar Set = Package['ecmascript-runtime-client'].Set;\n\n/* Package-scope variables */\nvar EV, Streamer;\n\nvar require = meteorInstall({\"node_modules\":{\"meteor\":{\"rocketchat:streamer\":{\"lib\":{\"ev.js\":function module(){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                     //\n// packages/rocketchat_streamer/lib/ev.js                                                                              //\n//                                                                                                                     //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                       //\n/* globals EV:true */\n/* exported EV */\n\nEV = /*#__PURE__*/function () {\n  function EV() {\n    this.handlers = {};\n  }\n  var _proto = EV.prototype;\n  _proto.emit = function () {\n    function emit(event) {\n      var _this = this;\n      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        args[_key - 1] = arguments[_key];\n      }\n      return this.handlers[event] && this.handlers[event].forEach(function (handler) {\n        return handler.apply(_this, args);\n      });\n    }\n    return emit;\n  }();\n  _proto.emitWithScope = function () {\n    function emitWithScope(event, scope) {\n      for (var _len2 = arguments.length, args = new Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {\n        args[_key2 - 2] = arguments[_key2];\n      }\n      return this.handlers[event] && this.handlers[event].forEach(function (handler) {\n        return handler.apply(scope, args);\n      });\n    }\n    return emitWithScope;\n  }();\n  _proto.listenerCount = function () {\n    function listenerCount(event) {\n      return this.handlers[event] && this.handlers[event].length || 0;\n    }\n    return listenerCount;\n  }();\n  _proto.on = function () {\n    function on(event, callback) {\n      if (!this.handlers[event]) {\n        this.handlers[event] = [];\n      }\n      this.handlers[event].push(callback);\n    }\n    return on;\n  }();\n  _proto.once = function () {\n    function once(event, callback) {\n      var self = this;\n      this.on(event, function () {\n        function onetimeCallback() {\n          self.removeListener(event, onetimeCallback);\n          callback.apply(this, arguments);\n        }\n        return onetimeCallback;\n      }());\n    }\n    return once;\n  }();\n  _proto.removeListener = function () {\n    function removeListener(event, callback) {\n      if (!this.handlers[event]) {\n        return;\n      }\n      var index = this.handlers[event].indexOf(callback);\n      if (index > -1) {\n        this.handlers[event].splice(index, 1);\n      }\n    }\n    return removeListener;\n  }();\n  _proto.removeAllListeners = function () {\n    function removeAllListeners(event) {\n      this.handlers[event] = undefined;\n    }\n    return removeAllListeners;\n  }();\n  return EV;\n}();\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"client\":{\"client.js\":function module(require,exports,module){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                     //\n// packages/rocketchat_streamer/client/client.js                                                                       //\n//                                                                                                                     //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                       //\nvar _createClass;\nmodule.link(\"@babel/runtime/helpers/createClass\", {\n  default: function (v) {\n    _createClass = v;\n  }\n}, 0);\nvar _assertThisInitialized;\nmodule.link(\"@babel/runtime/helpers/assertThisInitialized\", {\n  default: function (v) {\n    _assertThisInitialized = v;\n  }\n}, 1);\nvar _inheritsLoose;\nmodule.link(\"@babel/runtime/helpers/inheritsLoose\", {\n  default: function (v) {\n    _inheritsLoose = v;\n  }\n}, 2);\n/* globals DDPCommon, EV */\n/* eslint-disable new-cap */\nvar NonEmptyString = Match.Where(function (x) {\n  check(x, String);\n  return x.length > 0;\n});\nvar StreamerCentral = /*#__PURE__*/function (_EV) {\n  function StreamerCentral() {\n    var _this;\n    _this = _EV.call(this) || this;\n    _this.instances = {};\n    _this.ddpConnections = {}; // since each Streamer instance can provide its own ddp connection, store them by streamer name\n    return _this;\n  }\n  _inheritsLoose(StreamerCentral, _EV);\n  var _proto = StreamerCentral.prototype;\n  _proto.setupDdpConnection = function () {\n    function setupDdpConnection(name, ddpConnection) {\n      var _this2 = this;\n      // make sure we only setup event listeners for each ddp connection once\n      if (ddpConnection.hasMeteorStreamerEventListeners) {\n        return;\n      }\n      ddpConnection._stream.on('message', function (raw_msg) {\n        var msg = DDPCommon.parseDDP(raw_msg);\n        if (msg && msg.msg === 'changed' && msg.collection && msg.fields && msg.fields.eventName && msg.fields.args) {\n          msg.fields.args.unshift(msg.fields.eventName);\n          msg.fields.args.unshift(msg.collection);\n          _this2.emit.apply(_this2, msg.fields.args);\n        }\n      });\n      // store ddp connection\n      this.storeDdpConnection(name, ddpConnection);\n    }\n    return setupDdpConnection;\n  }();\n  _proto.storeDdpConnection = function () {\n    function storeDdpConnection(name, ddpConnection) {\n      // mark the connection as setup for Streamer, and store it\n      ddpConnection.hasMeteorStreamerEventListeners = true;\n      this.ddpConnections[name] = ddpConnection;\n    }\n    return storeDdpConnection;\n  }();\n  return StreamerCentral;\n}(EV);\nMeteor.StreamerCentral = new StreamerCentral();\nMeteor.Streamer = /*#__PURE__*/function (_EV2) {\n  function Streamer(name) {\n    var _this3;\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$useCollection = _ref.useCollection,\n      useCollection = _ref$useCollection === void 0 ? false : _ref$useCollection,\n      _ref$ddpConnection = _ref.ddpConnection,\n      ddpConnection = _ref$ddpConnection === void 0 ? Meteor.connection : _ref$ddpConnection;\n    if (Meteor.StreamerCentral.instances[name]) {\n      console.warn('Streamer instance already exists:', name);\n      return Meteor.StreamerCentral.instances[name] || _assertThisInitialized(_this3);\n    }\n    Meteor.StreamerCentral.setupDdpConnection(name, ddpConnection);\n    _this3 = _EV2.call(this) || this;\n    _this3.ddpConnection = ddpConnection || Meteor.connection;\n    Meteor.StreamerCentral.instances[name] = _this3;\n    _this3.name = name;\n    _this3.useCollection = useCollection;\n    _this3.subscriptions = {};\n    Meteor.StreamerCentral.on(_this3.subscriptionName, function (eventName) {\n      if (_this3.subscriptions[eventName]) {\n        var _EV$prototype$emit;\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n        _this3.subscriptions[eventName].lastMessage = args;\n        (_EV$prototype$emit = EV.prototype.emit).call.apply(_EV$prototype$emit, [_this3, eventName].concat(args));\n      }\n    });\n    _this3.ddpConnection._stream.on('reset', function () {\n      EV.prototype.emit.call(_this3, '__reconnect__');\n    });\n    return _this3;\n  }\n  _inheritsLoose(Streamer, _EV2);\n  var _proto2 = Streamer.prototype;\n  _proto2.stop = function () {\n    function stop(eventName) {\n      return this.subscriptions[eventName] && this.subscriptions[eventName].subscription && this.subscriptions[eventName].subscription.stop();\n    }\n    return stop;\n  }();\n  _proto2.stopAll = function () {\n    function stopAll() {\n      var _this4 = this;\n      Object.keys(this.subscriptions).forEach(function (eventName) {\n        return _this4.removeAllListeners(eventName);\n      });\n    }\n    return stopAll;\n  }();\n  _proto2.unsubscribe = function () {\n    function unsubscribe(eventName) {\n      delete this.subscriptions[eventName];\n      EV.prototype.removeAllListeners.call(this, eventName);\n    }\n    return unsubscribe;\n  }();\n  _proto2.subscribe = function () {\n    function subscribe(eventName, args) {\n      var _this5 = this;\n      return new Promise(function (resolve, reject) {\n        if (_this5.subscriptions[eventName]) {\n          return resolve();\n        }\n        var subscription = Tracker.nonreactive(function () {\n          return _this5.ddpConnection.subscribe(_this5.subscriptionName, eventName, {\n            useCollection: _this5.useCollection,\n            args: args\n          }, {\n            onStop: function () {\n              return reject(_this5.unsubscribe(eventName));\n            },\n            onReady: resolve\n          });\n        });\n        _this5.subscriptions[eventName] = {\n          subscription: subscription\n        };\n      });\n    }\n    return subscribe;\n  }();\n  _proto2.onReconnect = function () {\n    function onReconnect(fn) {\n      if (typeof fn === 'function') {\n        EV.prototype.on.call(this, '__reconnect__', fn);\n      }\n    }\n    return onReconnect;\n  }();\n  _proto2.getLastMessageFromEvent = function () {\n    function getLastMessageFromEvent(eventName) {\n      var subscription = this.subscriptions[eventName];\n      if (subscription && subscription.lastMessage) {\n        return subscription.lastMessage;\n      }\n    }\n    return getLastMessageFromEvent;\n  }();\n  _proto2.removeAllListeners = function () {\n    function removeAllListeners(eventName) {\n      EV.prototype.removeAllListeners.call(this, eventName);\n      return this.stop(eventName);\n    }\n    return removeAllListeners;\n  }();\n  _proto2.removeListener = function () {\n    function removeListener(eventName) {\n      var _EV$prototype$removeL;\n      if (this.listenerCount(eventName) === 1) {\n        this.stop(eventName);\n      }\n      for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n        args[_key2 - 1] = arguments[_key2];\n      }\n      (_EV$prototype$removeL = EV.prototype.removeListener).call.apply(_EV$prototype$removeL, [this, eventName].concat(args));\n    }\n    return removeListener;\n  }();\n  _proto2.on = function () {\n    function on(eventName) {\n      check(eventName, NonEmptyString);\n      for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n        args[_key3 - 1] = arguments[_key3];\n      }\n      var callback = args.pop();\n      check(callback, Function);\n      EV.prototype.on.call(this, eventName, callback);\n      return this.subscribe(eventName, args);\n    }\n    return on;\n  }();\n  _proto2.once = function () {\n    function once(eventName) {\n      var _this6 = this;\n      check(eventName, NonEmptyString);\n      for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n        args[_key4 - 1] = arguments[_key4];\n      }\n      var callback = args.pop();\n      check(callback, Function);\n      EV.prototype.once.call(this, eventName, function () {\n        callback.apply(void 0, arguments);\n        if (_this6.listenerCount(eventName) === 0) {\n          return _this6.stop(eventName);\n        }\n      });\n      return this.subscribe(eventName, args);\n    }\n    return once;\n  }();\n  _proto2.emit = function () {\n    function emit() {\n      var _this$ddpConnection;\n      for (var _len5 = arguments.length, args = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n        args[_key5] = arguments[_key5];\n      }\n      (_this$ddpConnection = this.ddpConnection).call.apply(_this$ddpConnection, [this.subscriptionName].concat(args));\n    }\n    return emit;\n  }();\n  return _createClass(Streamer, [{\n    key: \"name\",\n    get: function () {\n      return this._name;\n    },\n    set: function (name) {\n      check(name, String);\n      this._name = name;\n    }\n  }, {\n    key: \"subscriptionName\",\n    get: function () {\n      return \"stream-\" + this.name;\n    }\n  }, {\n    key: \"useCollection\",\n    get: function () {\n      return this._useCollection;\n    },\n    set: function (useCollection) {\n      check(useCollection, Boolean);\n      this._useCollection = useCollection;\n    }\n  }]);\n}(EV);\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\"\n  ]\n});\n\n\n/* Exports */\nreturn {\n  export: function () { return {\n      Streamer: Streamer\n    };},\n  require: require,\n  eagerModulePaths: [\n    \"/node_modules/meteor/rocketchat:streamer/lib/ev.js\",\n    \"/node_modules/meteor/rocketchat:streamer/client/client.js\"\n  ]\n}});\n","servePath":"/packages/rocketchat_streamer.js","sourceMap":{"version":3,"sources":["packages/rocketchat:streamer/lib/ev.js","packages/rocketchat:streamer/client/client.js"],"names":["EV","handlers","_proto","prototype","emit","event","_this","_len","arguments","length","args","Array","_key","forEach","handler","apply","emitWithScope","scope","_len2","_key2","listenerCount","on","callback","push","once","self","onetimeCallback","removeListener","index","indexOf","splice","removeAllListeners","undefined","_createClass","module","link","default","v","_assertThisInitialized","_inheritsLoose","NonEmptyString","Match","Where","x","check","String","StreamerCentral","_EV","call","instances","ddpConnections","setupDdpConnection","name","ddpConnection","_this2","hasMeteorStreamerEventListeners","_stream","raw_msg","msg","DDPCommon","parseDDP","collection","fields","eventName","unshift","storeDdpConnection","Meteor","Streamer","_EV2","_this3","_ref","_ref$useCollection","useCollection","_ref$ddpConnection","connection","console","warn","subscriptions","subscriptionName","_EV$prototype$emit","lastMessage","concat","_proto2","stop","subscription","stopAll","_this4","Object","keys","unsubscribe","subscribe","_this5","Promise","resolve","reject","Tracker","nonreactive","onStop","onReady","onReconnect","fn","getLastMessageFromEvent","_EV$prototype$removeL","_len3","_key3","pop","Function","_this6","_len4","_key4","_this$ddpConnection","_len5","_key5","key","get","_name","set","_useCollection","Boolean"],"mappings":"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","file":"/packages/rocketchat_streamer.js","sourcesContent":["/* globals EV:true */\n/* exported EV */\n\nEV = class EV {\n\tconstructor() {\n\t\tthis.handlers = {};\n\t}\n\n\temit(event, ...args) {\n\t\treturn this.handlers[event] && this.handlers[event].forEach(handler => handler.apply(this, args));\n\t}\n\n\temitWithScope(event, scope, ...args) {\n\t\treturn this.handlers[event] && this.handlers[event].forEach(handler => handler.apply(scope, args));\n\t}\n\n\tlistenerCount(event) {\n\t\treturn (this.handlers[event] && this.handlers[event].length) || 0;\n\t}\n\n\ton(event, callback) {\n\t\tif (!this.handlers[event]) {\n\t\t\tthis.handlers[event] = [];\n\t\t}\n\t\tthis.handlers[event].push(callback);\n\t}\n\n\tonce(event, callback) {\n\t\tconst self = this;\n\t\tthis.on(event, function onetimeCallback() {\n\t\t\tself.removeListener(event, onetimeCallback);\n\t\t\tcallback.apply(this, arguments);\n\t\t});\n\t}\n\n\tremoveListener(event, callback) {\n\t\tif (!this.handlers[event]) {\n\t\t\treturn;\n\t\t}\n\t\tconst index = this.handlers[event].indexOf(callback);\n\t\tif (index > -1) {\n\t\t\tthis.handlers[event].splice(index, 1);\n\t\t}\n\t}\n\n\tremoveAllListeners(event) {\n\t\tthis.handlers[event] = undefined;\n\t}\n};\n","/* globals DDPCommon, EV */\n/* eslint-disable new-cap */\nconst NonEmptyString = Match.Where(function (x) {\n\tcheck(x, String);\n\treturn x.length > 0;\n});\n\nclass StreamerCentral extends EV {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.instances = {};\n\t\tthis.ddpConnections = {};\t\t// since each Streamer instance can provide its own ddp connection, store them by streamer name\n\t}\n\n\tsetupDdpConnection(name, ddpConnection) {\n\t\t// make sure we only setup event listeners for each ddp connection once\n\t\tif (ddpConnection.hasMeteorStreamerEventListeners) {\n\t\t\treturn;\n\t\t}\n\t\tddpConnection._stream.on('message', (raw_msg) => {\n\t\t\tconst msg = DDPCommon.parseDDP(raw_msg);\n\t\t\tif (msg && msg.msg === 'changed' && msg.collection && msg.fields && msg.fields.eventName && msg.fields.args) {\n\t\t\t\tmsg.fields.args.unshift(msg.fields.eventName);\n\t\t\t\tmsg.fields.args.unshift(msg.collection);\n\t\t\t\tthis.emit.apply(this, msg.fields.args);\n\t\t\t}\n\t\t});\n\t\t// store ddp connection\n\t\tthis.storeDdpConnection(name, ddpConnection);\n\n\t}\n\n\tstoreDdpConnection(name, ddpConnection) {\n\t\t// mark the connection as setup for Streamer, and store it\n\t\tddpConnection.hasMeteorStreamerEventListeners = true;\n\t\tthis.ddpConnections[name] = ddpConnection;\n\t}\n}\n\nMeteor.StreamerCentral = new StreamerCentral;\n\nMeteor.Streamer = class Streamer extends EV {\n\tconstructor(name, { useCollection = false, ddpConnection = Meteor.connection } = {}) {\n\t\tif (Meteor.StreamerCentral.instances[name]) {\n\t\t\tconsole.warn('Streamer instance already exists:', name);\n\t\t\treturn Meteor.StreamerCentral.instances[name];\n\t\t}\n\t\tMeteor.StreamerCentral.setupDdpConnection(name, ddpConnection);\n\n\t\tsuper();\n\n\t\tthis.ddpConnection = ddpConnection || Meteor.connection;\n\n\t\tMeteor.StreamerCentral.instances[name] = this;\n\n\t\tthis.name = name;\n\t\tthis.useCollection = useCollection;\n\t\tthis.subscriptions = {};\n\n\t\tMeteor.StreamerCentral.on(this.subscriptionName, (eventName, ...args) => {\n\t\t\tif (this.subscriptions[eventName]) {\n\t\t\t\tthis.subscriptions[eventName].lastMessage = args;\n\t\t\t\tEV.prototype.emit.call(this, eventName, ...args);\n\t\t\t}\n\t\t});\n\n\t\tthis.ddpConnection._stream.on('reset', () => {\n\t\t\tEV.prototype.emit.call(this, '__reconnect__');\n\t\t});\n\t}\n\n\tget name() {\n\t\treturn this._name;\n\t}\n\n\tset name(name) {\n\t\tcheck(name, String);\n\t\tthis._name = name;\n\t}\n\n\tget subscriptionName() {\n\t\treturn `stream-${this.name}`;\n\t}\n\n\tget useCollection() {\n\t\treturn this._useCollection;\n\t}\n\n\tset useCollection(useCollection) {\n\t\tcheck(useCollection, Boolean);\n\t\tthis._useCollection = useCollection;\n\t}\n\n\tstop(eventName) {\n\t\treturn this.subscriptions[eventName] && this.subscriptions[eventName].subscription && this.subscriptions[eventName].subscription.stop();\n\t}\n\n\tstopAll() {\n\t\tObject.keys(this.subscriptions).forEach(eventName => this.removeAllListeners(eventName));\n\t}\n\n\tunsubscribe(eventName) {\n\t\tdelete this.subscriptions[eventName];\n\t\tEV.prototype.removeAllListeners.call(this, eventName);\n\t}\n\n\tsubscribe(eventName, args) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (this.subscriptions[eventName]) {\n\t\t\t\treturn resolve();\n\t\t\t}\n\t\t\tconst subscription = Tracker.nonreactive(() => this.ddpConnection.subscribe(\n\t\t\t\tthis.subscriptionName,\n\t\t\t\teventName,\n\t\t\t\t{ useCollection: this.useCollection, args },\n\t\t\t\t{\n\t\t\t\t\tonStop: () => reject(this.unsubscribe(eventName)),\n\t\t\t\t\tonReady: resolve\n\t\t\t\t}\n\t\t\t));\n\t\t\tthis.subscriptions[eventName] = { subscription };\n\t\t})\n\t}\n\n\tonReconnect(fn) {\n\t\tif (typeof fn === 'function') {\n\t\t\tEV.prototype.on.call(this, '__reconnect__', fn);\n\t\t}\n\t}\n\n\tgetLastMessageFromEvent(eventName) {\n\t\tconst subscription = this.subscriptions[eventName];\n\t\tif (subscription && subscription.lastMessage) {\n\t\t\treturn subscription.lastMessage;\n\t\t}\n\t}\n\n\tremoveAllListeners(eventName) {\n\t\tEV.prototype.removeAllListeners.call(this, eventName);\n\t\treturn this.stop(eventName);\n\t}\n\n\tremoveListener(eventName, ...args) {\n\t\tif (this.listenerCount(eventName) === 1) {\n\t\t\tthis.stop(eventName);\n\t\t}\n\t\tEV.prototype.removeListener.call(this, eventName, ...args);\n\t}\n\n\ton(eventName, ...args) {\n\t\tcheck(eventName, NonEmptyString);\n\n\t\tconst callback = args.pop();\n\t\tcheck(callback, Function);\n\n\t\tEV.prototype.on.call(this, eventName, callback);\n\n\t\treturn this.subscribe(eventName, args);\n\t}\n\n\tonce(eventName, ...args) {\n\t\tcheck(eventName, NonEmptyString);\n\n\t\tconst callback = args.pop();\n\t\tcheck(callback, Function);\n\n\t\tEV.prototype.once.call(this, eventName, (...args) => {\n\t\t\tcallback(...args);\n\t\t\tif (this.listenerCount(eventName) === 0) {\n\t\t\t\treturn this.stop(eventName);\n\t\t\t}\n\t\t});\n\n\t\treturn this.subscribe(eventName, args);\n\t}\n\n\temit(...args) {\n\t\tthis.ddpConnection.call(this.subscriptionName, ...args);\n\t}\n};\n"]}}]