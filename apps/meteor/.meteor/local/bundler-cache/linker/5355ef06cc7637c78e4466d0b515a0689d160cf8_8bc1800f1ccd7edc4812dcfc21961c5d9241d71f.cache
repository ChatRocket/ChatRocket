[{"type":"js","data":"Package[\"core-runtime\"].queue(\"github-oauth\",function () {/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar EmitterPromise = Package.meteor.EmitterPromise;\nvar ECMAScript = Package.ecmascript.ECMAScript;\nvar OAuth = Package.oauth.OAuth;\nvar fetch = Package.fetch.fetch;\nvar Accounts = Package['accounts-base'].Accounts;\nvar ServiceConfiguration = Package['service-configuration'].ServiceConfiguration;\nvar meteorInstall = Package.modules.meteorInstall;\nvar Promise = Package.promise.Promise;\n\n/* Package-scope variables */\nvar Github;\n\nvar require = meteorInstall({\"node_modules\":{\"meteor\":{\"github-oauth\":{\"github_server.js\":function module(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                           //\n// packages/github-oauth/github_server.js                                                                    //\n//                                                                                                           //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                             //\nGithub = {};\nOAuth.registerService('github', 2, null, async query => {\n  const accessToken = await getAccessToken(query);\n  const identity = await getIdentity(accessToken);\n  const emails = await getEmails(accessToken);\n  const primaryEmail = emails.find(email => email.primary);\n  return {\n    serviceData: {\n      id: identity.id,\n      accessToken: OAuth.sealSecret(accessToken),\n      email: identity.email || primaryEmail && primaryEmail.email || '',\n      username: identity.login,\n      name: identity.name,\n      avatar: identity.avatar_url,\n      company: identity.company,\n      blog: identity.blog,\n      location: identity.location,\n      bio: identity.bio,\n      emails\n    },\n    options: {\n      profile: {\n        name: identity.name\n      }\n    }\n  };\n});\n\n// http://developer.github.com/v3/#user-agent-required\nlet userAgent = 'Meteor';\nif (Meteor.release) userAgent += \"/\".concat(Meteor.release);\nconst getAccessToken = async query => {\n  const config = await ServiceConfiguration.configurations.findOneAsync({\n    service: 'github'\n  });\n  if (!config) throw new ServiceConfiguration.ConfigError();\n  let response;\n  try {\n    const content = new URLSearchParams({\n      client_id: config.clientId,\n      client_secret: config.secret,\n      code: query.code,\n      redirect_uri: OAuth._redirectUri('github', config)\n    });\n    const request = await OAuth._fetch(\"https://github.com/login/oauth/access_token?\".concat(content.toString()), 'POST', {\n      headers: {\n        Accept: 'application/json',\n        'User-Agent': userAgent\n      }\n    });\n    response = await request.json();\n  } catch (err) {\n    throw Object.assign(new Error(\"Failed to complete OAuth handshake with Github. \".concat(err.message)), {\n      response: err.response\n    });\n  }\n  if (response.error) {\n    // if the http response was a json object with an error attribute\n    throw new Error(\"Failed to complete OAuth handshake with GitHub. \".concat(response.error));\n  } else {\n    return response.access_token;\n  }\n};\nconst getIdentity = async accessToken => {\n  try {\n    const request = await OAuth._fetch('https://api.github.com/user', 'GET', {\n      headers: {\n        Accept: 'application/json',\n        'User-Agent': userAgent,\n        Authorization: \"token \".concat(accessToken)\n      } // http://developer.github.com/v3/#user-agent-required\n    });\n    return await request.json();\n  } catch (err) {\n    throw Object.assign(new Error(\"Failed to fetch identity from Github. \".concat(err.message)), {\n      response: err.response\n    });\n  }\n};\nconst getEmails = async accessToken => {\n  try {\n    const request = await OAuth._fetch('https://api.github.com/user/emails', 'GET', {\n      headers: {\n        'User-Agent': userAgent,\n        Accept: 'application/json',\n        Authorization: \"token \".concat(accessToken)\n      } // http://developer.github.com/v3/#user-agent-required\n    });\n    return await request.json();\n  } catch (err) {\n    return [];\n  }\n};\nGithub.retrieveCredential = (credentialToken, credentialSecret) => OAuth.retrieveCredential(credentialToken, credentialSecret);\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\"\n  ]\n});\n\n\n/* Exports */\nreturn {\n  export: function () { return {\n      Github: Github\n    };},\n  require: require,\n  eagerModulePaths: [\n    \"/node_modules/meteor/github-oauth/github_server.js\"\n  ]\n}});\n","servePath":"/packages/github-oauth.js","sourceMap":{"version":3,"sources":["packages/github-oauth/github_server.js"],"names":["Github","OAuth","registerService","query","accessToken","getAccessToken","identity","getIdentity","emails","getEmails","primaryEmail","find","email","primary","serviceData","id","sealSecret","username","login","name","avatar","avatar_url","company","blog","location","bio","options","profile","userAgent","Meteor","release","concat","config","ServiceConfiguration","configurations","findOneAsync","service","ConfigError","response","content","URLSearchParams","client_id","clientId","client_secret","secret","code","redirect_uri","_redirectUri","request","_fetch","toString","headers","Accept","json","err","Object","assign","Error","message","error","access_token","Authorization","retrieveCredential","credentialToken","credentialSecret"],"mappings":"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","file":"/packages/github-oauth.js","sourcesContent":["Github = {};\n\nOAuth.registerService('github', 2, null, async (query) => {\n  const accessToken = await getAccessToken(query);\n  const identity = await getIdentity(accessToken);\n  const emails = await getEmails(accessToken);\n  const primaryEmail = emails.find((email) => email.primary);\n\n  return {\n    serviceData: {\n      id: identity.id,\n      accessToken: OAuth.sealSecret(accessToken),\n      email: identity.email || (primaryEmail && primaryEmail.email) || '',\n      username: identity.login,\n      name: identity.name,\n      avatar: identity.avatar_url,\n      company: identity.company,\n      blog: identity.blog,\n      location: identity.location,\n      bio: identity.bio,\n      emails\n    },\n    options: { profile: { name: identity.name } }\n  };\n});\n\n// http://developer.github.com/v3/#user-agent-required\nlet userAgent = 'Meteor';\nif (Meteor.release) userAgent += `/${Meteor.release}`;\n\nconst getAccessToken = async (query) => {\n  const config = await ServiceConfiguration.configurations.findOneAsync({\n    service: 'github'\n  });\n  if (!config) throw new ServiceConfiguration.ConfigError();\n\n  let response;\n  try {\n    const content = new URLSearchParams({\n      client_id: config.clientId,\n      client_secret: config.secret,\n      code: query.code,\n      redirect_uri: OAuth._redirectUri(\n        'github',\n        config\n      )\n    });\n    const request = await OAuth._fetch(\n      `https://github.com/login/oauth/access_token?${content.toString()}`,\n      'POST',\n      {\n        headers: {\n          Accept: 'application/json',\n          'User-Agent': userAgent\n        }\n      }\n    );\n    response = await request.json();\n  } catch (err) {\n    throw Object.assign(\n      new Error(\n        `Failed to complete OAuth handshake with Github. ${err.message}`\n      ),\n      { response: err.response }\n    );\n  }\n  if (response.error) {\n    // if the http response was a json object with an error attribute\n    throw new Error(\n      `Failed to complete OAuth handshake with GitHub. ${response.error}`\n    );\n  } else {\n    return response.access_token;\n  }\n};\n\nconst getIdentity = async (accessToken) => {\n  try {\n    const request = await OAuth._fetch('https://api.github.com/user', 'GET', {\n      headers: {\n        Accept: 'application/json',\n        'User-Agent': userAgent,\n        Authorization: `token ${accessToken}`\n      } // http://developer.github.com/v3/#user-agent-required\n    });\n    return await request.json();\n  } catch (err) {\n    throw Object.assign(\n      new Error(`Failed to fetch identity from Github. ${err.message}`),\n      { response: err.response }\n    );\n  }\n};\n\nconst getEmails = async (accessToken) => {\n  try {\n    const request = await OAuth._fetch('https://api.github.com/user/emails', 'GET', {\n      headers: {\n        'User-Agent': userAgent,\n        Accept: 'application/json',\n        Authorization: `token ${accessToken}`\n      } // http://developer.github.com/v3/#user-agent-required\n    });\n    return await request.json();\n  } catch (err) {\n    return [];\n  }\n};\n\nGithub.retrieveCredential = (credentialToken, credentialSecret) =>\n  OAuth.retrieveCredential(credentialToken, credentialSecret);\n"]}}]